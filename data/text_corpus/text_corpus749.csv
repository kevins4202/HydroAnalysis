index,text
3745,given the hazardous effects of sudden dam reservoir contamination as might occur upon the intrusion of the fuel additive methyl tert butyl ether mtbe the contaminant s effect on the quality of allocated waters requires careful study employed to determine optimal reservoir operational rules in the case of sudden mtbe pollution a risk based simulation optimization model was developed to simultaneously minimize unsatisfied water demand the risk of violations of water quality standards and the reservoir recovery time risks were assessed by considering various often neglected pollution scenarios as a combination of location quantity and the season of pollution intrusion the appropriateness of operational rules proved to depend upon thermal conditions and mtbe intrusion properties confirming the necessity of considering location quantity season uncertainties social and regional conditions also occupied a dominant role in determining the level of satisfaction achieved under different water allocation strategies accordingly by considering environmental conditions and local rules a graph model for conflict resolution was established and used to reach a set of compromise operational rules the developed framework could serve as a guide for water utilities to determine efficient reservoir operational rules after a sudden contaminant intrusion keywords ce qual w2 simulation model conditional value at risk gmcr decision support system surrogate models 1 introduction dam construction is a common solution to cope with year round agricultural and domestic water demands especially in areas subject to a hot and dry climate generally dam reservoir water withdrawals are scheduled according to specific operational rules that depend on environmental conditions quantity and quality of available water and dam characteristics e g kerachian and karamouz 2006 ashofteh et al 2015 pourshahabi et al 2020 among these influencing factors the danger of large dam reservoirs being intentionally or accidentally subjected to pollutant intrusion is of the utmost importance pollutant intrusion accidents most commonly occur as a result of human error e g failure in the transportation of hazardous chemicals li et al 2014 a sudden toxic chemical discharge into the rhine river from a chemical warehouse fire via fire fighting water runoff in 1986 giger 2009 the accidental contamination of kyrgyzstan s lake issyk kul and barksoon river with sodium cyanide spilled near the kumtor gold mine in may 1998 pannier 1998 pollution of cayuga inlet creek west danby ny with diesel oil following a train derailment lytle and peckarsky 2001 and a spill of arsenic rich tailings from a pyrite mine in southern spain kraus and wiegand 2006 are only a few examples of sudden chemical contamination causing serious damage to aquatic life and contributing to ecosystem degradation this issue is rather more critical in developing countries for example on march 4 2003 a truck accident released 30 400 l of methyl tert butyl ether mtbe into the khalife tarkhan river near sanandaj upper gheshlagh river basin kordestan iran the spill reached the gheshlagh reservoir within 24 hr thereby limiting access to safe water and restricting water allocations afshar et al 2017 since pollutant intrusion accidents can lead to highly hazardous and acutely critical situations with highly undesirable consequences even slight probabilities of contamination should be considered in addition to employing physical barriers such as protective guard rails for accident prevention appropriate operational responses must also be provided when these accidents do occur several studies have employed modified optimization algorithms haddad et al 2008 afshar et al 2011 to provide operational response strategies that balance concerns regarding freshwater quality and the quantity of water available to meet demands chaves et al 2003 kerachian and karamouz 2007 castelletti et al 2014 azadi et al 2019 accordingly it is critical that the operational rules developed and implemented in response to a reservoir s sudden pollution and decline in water quality should be valid and effective a range of simulation optimization models has been applied to determine standard reservoir operational rules and allocate stored water according to water quality quantity limitations liu et al 2020 nourani et al 2020 while operational rules to manage sudden water contamination incidents in reservoirs are essential to avoid adverse effects on the health of water consumers they have not been broadly studied saadatpour and afshar 2013 shokri et al 2014 haddad et al 2014 2015 amirkani et al 2016 a pollution intrusion response management model was developed by saadatpour and afshar 2013 to simultaneously minimize reservoir recovery time and reduce water quality standard violations for different injection masses and locations but it neglected the effects of intrusion timing however it is acknowledged that seasonal changes in water temperature wind speed reservoir surface area and hydraulic conditions can theoretically affect both reservoir dynamics and the fate of pollutants within surface water bodies stocking and kavanaugh 2000 assuming the possibility of injections in each of four seasons shokri et al 2014 and amirkani et al 2016 demonstrated an apparent seasonality effect on the operational rules developed for a volatile pollutant spill for example the numerical experiment designed by shokri et al 2014 showed that in terms of pollutant duration and maximum concentration the intrusion of a volatile pollutant in spring offered fewer risks than at other times while studies investigating the effect of different climatic conditions occurring with seasonal changes tahir et al 2008 ashofteh et al 2015 or various pollutant characteristics e g mass and intrusion location saadatpour and afshar 2013 have successfully generated optimal operational rules appropriate to a particular single factor uncertainties arising from the simultaneous and potentially synergistic effects of multiple factors have not been investigated to reduce the risk of applying inefficient operational rules in the case of unavoidable incidents these uncertainties should clearly be addressed in the process of determining optimization model objectives a further key issue in the case of sudden reservoir pollution is the type of pollutant involved since the transport of petrol gasoline is common in various parts of the world it is important that the intrusion of various petrol additives such as methyl tert butyl ether mtbe iupac 2 methoxy 2 methylpropane into bodies of water receive particular attention however among pollutants threatening the quality of surface water bodies such as dam reservoirs mtbe intrusion has garnered limited attention amirkani et al 2016 shokri et al 2014 shokri et al 2014 added the capacity to simulate the fate and transport of mtbe to the existing two dimensional laterally integrated hydrodynamics and transport reservoir simulation model ce qual w2 this capacity was included in the modified version of the ce qual w2 model and was shown to be reliable in a subsequent study afshar et al 2017 nonetheless the performance of operational rules after mtbe intrusion has not been extensively investigated reliable operational rules should be compatible with social and regional conditions including stakeholders demands and goals daneshmand et al 2014 in most previous studies e g kerachian and karamouz 2006 and 2007 shirangi et al 2008 haddad et al 2014 yang et al 2014 operational rules were obtained from simulation simulation optimization models with conflicting goals in such cases attempts were made to resolve existing conflicts over selecting operational rules using conflict resolution methods such as young or nash bargaining theories among conflict resolution methods the graph model for conflict resolution gmcr has demonstrated an inherent superiority in the analysis of the strategic aspects of water disputes dowlatabadi et al 2020 mooselu et al 2021 wu et al 2019 madani and hipel 2007 by modifying classical game theory gmcr has achieved an uncomplicated flexible structure that requires only minimal information to model and analyze the strategic conflicts disputes between decision makers with multiple conflicting objectives despite the necessity to consider local rules and the priorities of influential decision makers the implementation of gmcr has yet to be considered in selecting optimal compromise reservoir operational rules in the present study a multi objective simulation optimization model was developed to determine optimal dam water withdrawals a k a operational rules from reservoir outlets under sudden mtbe pollution this was carried out by simultaneously minimizing unsatisfied water demand the risk of frequency magnitude violations of water quality standards and the risk of modified reservoir recovery time rrt the developed model sought to address the shortcomings of previous studies and drive progress in establishing operational rules by taking advantage of the following approaches i including uncertainties related to climatic conditions and pollutant characteristics by considering various pollutant intrusion scenarios ii assessing uncertainties arising from the potential synergistic effects of different climatic conditions and various pollutant characteristics iii addressing uncertainties by determining optimization model objectives for the worst case scenarios using the conditional value at risk cvar iv determining the compromise operational rule among the pareto front solutions with the help of conflict resolution models using the gmcr decision support system to facilitate the modeling process and provide a comprehensive framework the following procedures were implemented i repeated executions of the calibrated ce qual w2 water quality and hydrodynamic model in a matlab environment drawing upon thousands of input output sets to train and validate the surrogate model ii replacement of the simulation model by a surrogate model thanks to a combined principal component analysis multilayer perceptron pca mlp artificial neural network serving to reduce the model s runtime and computational burden iii coupling optimization and surrogate models in the matlab environment to determine the optimal reservoir operational rules under sudden mtbe pollution 2 methodology a detailed explanation of the proposed model s main methodological steps in determining optimal reservoir operational rules is illustrated schematically in fig 1 the proposed multi objective framework fig 1 includes five steps i developing pollution scenarios ii running a reservoir simulation iii replacing the calibrated ce qual w2 simulation model with an appropriate reservoir surrogate model iv determining optimal reservoir operational rules and v determining the compromise operational rule these steps are thoroughly discussed in the following sections 2 1 development of pollution scenarios to include the uncertainties related to the pollutant s fate and transport through the reservoir operational rules were developed that considered different pollution scenarios based on a priori knowledge of the processes affecting the fate of mtbe in reservoirs and sensitivity analyses pollutant intrusion time pollutant quantity and intrusion location were identified as parameters of influence accordingly three pollutant concentrations low medium and high three intrusion sites within the reservoir adjacent to the reservoir outlets in the middle of the reservoir and farthest from the outlets and four intrusion times first day of summer spring fall and winter were factorially combined to establish 36 3 3 4 different pollution scenarios fig 2 within this framework the possibility of pollutant intrusion within any season served to address the seasonality effects on thermal conditions i e air and water temperature reservoir surface area interchangeably used with reservoir level wind speed water demands and reservoir inflows the three pollutant intrusion locations were selected to acknowledge the variability of reservoir response to the intrusion location and provide a reliable general optimization model the selection of intrusion locations well distributed across the reservoir s expanse rather than at high risk intrusion locations alone was considered in developing the numerical experiment in this study these scenarios shed light on how changes in water temperature wind speed and reservoir surface area might affect the fate of mtbe drawing upon the observations of stocking and kavanaugh 2000 who evaluated the impact of several environmental variables on the fate of mtbe in standing waters one can postulate that water temperature and wind speed increases might accelerate the elimination of mtbe by increasing the rate of mtbe volatilization and decreasing its half life on the other hand an increase in reservoir surface area would decelerate the elimination of mtbe by decreasing the rate of mtbe volatilization 2 2 reservoir simulation several processes including volatilization advection biodegradation photooxidation adsorption and abiotic degradation are involved in deciding the fate of mtbe in standing water stocking and kavanaugh 2000 however given the physicochemical properties of mtbe i e a high tendency to dissolve in aqueous media a relatively low henry s constant and low adsorption to sediments and its attendant behaviour in a body of water many of these processes were insignificant or slow leaving volatilization advection and decay processes as the preeminent pathways of mtbe elimination afshar et al 2017 accordingly mtbe can be classified as a generic constituent that does not interact significantly with any of the water quality state variables and hydrodynamics wells 2019 a well known two dimensional laterally averaged hydrodynamics and water quality simulation model ce qual w2 has been widely used to model both vertical and horizontal pollutant propagation in reservoirs and lakes kim and kim 2006 yu et al 2010 soleimani et al 2016 heidarzadeh and nejad 2017 azadi et al 2019 burigato et al 2019 wells 2019 considering mtbe as a volatile generic constituent the ce qual w2 model takes into account changes in mtbe concentrations caused by spilling of mtbe into the lake vertical mixing of the water body discharge of mtbe through reservoir outflows surface exchange of mtbe from the reservoir surface and decay processes fig 3 here the ce qual w2 simulation model was calibrated and employed to determine the mtbe concentration at reservoir outlets over a 70 day simulation period for different magnitudes locations and timings of mtbe intrusion the simulation period of 70 days was adjusted to equal the maximum rrt of the various pollution scenarios recognizing the ability of the ce qual w2 model to simulate thermal stratification in reservoirs gelda et al 1998 rangel peraza et al 2012 this model was also used to estimate the temperature of different layers of the reservoir using the data regarding topography inflow weather stream temperatures and release values the ce qual w2 model was calibrated in two stages i reservoir geometry calibration and ii reservoir hydrodynamic calibration to define and calibrate the finite difference model for the reservoir information regarding reservoir geometry was gathered from a topographic map of the region and a viable volume area elevation diagram for the dam s reservoir these served respectively to determine the bathymetric cross sections and evaluate the volume area elevation curve generated by the reservoir model as the calibration of reservoir hydrodynamic features was sensitive to depth temperature profiles and reservoir water surface elevation monthlyvertical temperature profiles and daily water surface elevation wse information was employed in the calibration of the developed reservoir hydrodynamicmodel with respect to the fate and transport of mtbe a modified source sink equation which considered mtbe surface exchanges and biodegradation processes including volatilization and absorption from the top layer water surface and possible zero or first order decay processes eq 1 was solved by the model in the form wells 2019 1 s gvol k 0 θ g t 20 k 1 θ g t 20 φ g 1 h kt k l o 2 c g k l f φ g where s gvol is the source sink term for the volatile generic constituent concentration k 0 is the zero order decay coefficient g m 3 s 1 at 20 c θ g is the temperature correction factor with a typical range of 1 02 1 05 heald et al 2005 t is water temperature oc k 1 is the first order decay coefficient s 1 at 20 c φ g is the volatile generic constituent concentration k l o 2 is the reaeration coefficient for oxygen cgklf is the unitless user defined gas transfer factor 0 776 for mtbe and h kt is depth of the surface layer computational cell m as the focus was to develop a surrogate based optimization model rather than one drawing upon a calibrated ce qual w2 model zero order decay was neglected while first order decay was determined using a k 1 coefficient value of 2 k 1 ln 2 t 0 5 where t 0 5 is the mtbe half life heald et al 2005 in the present context the value of t 0 5 was assumed to be 28 days the correction formulation presented by elmore and west 1961 served to adjust the reaeration and first order decay coefficients for other temperatures in this regard the temperature correction factor θ g was adjusted to 1 024 according to wells 2019 moreover as suggested by o connor 1983 the reaeration coefficient as a function of wind speed was considered to determine the wind effects on mtbe evaporation from the top layer 2 3 reservoir surrogate model generally speaking the implementation of ce qual w2 has been accompanied by considerable computational burdens this limitation worsened when recurrent simulations were required such as within simulation optimization frameworks for fitness evaluations saadatpour et al 2020 to address the simulation optimization model runtime concerns the calibrated ce qual w2 simulation model was replaced by a modified version of the pca mlp surrogate model introduced by vanda et al 2021 based on their proposed framework principal component analysis pca was coupled with a multilayer perceptron architecture mlp artificial neural network ann model to assess the operational responses to pollution intrusion scenarios traditionally a large dataset of inputs and outputs procured by repeated execution of the developed simulation model is required to train and validate the ann based surrogate models however the redundant information in datasets prepared in this manner would not only potentially prevent the ann model from accurately detecting the relationship between the input and output datasets but might also result in an imprecise and time consuming surrogate model within this framework the pca tool therefore served to i reduce the dimensions of input and output data ii reduce the model complexity brought about by high dimensionality and iii minimize the overfitting risk of the mlp surrogate model 2 3 1 development of the pca mlp model in accordance with vanda et al 2021 the two matrices of daily release strategies and their associated daily pollution concentration levels at reservoir outlets whose dimensions had been reduced using the pca tool were respectively introduced to the mlp model as input and output matrices however given that reservoir response can vary significantly according to the time location and magnitude of the pollution intrusion the use of such input output data to train the mlp model was not applicable here to address this a representative training dataset was established in which potential combinations of the four factors of time location and magnitude of the pollution intrusion as well as daily release strategies were included to do so 500 different operational rules release strategies for discharging water from two reservoir outlets applied over a 70 day period a 140 500 matrix were generated individually for each of the four seasons this allowed the inclusion of seasonal effects on initial reservoir storage and daily reservoir inflow making it possible to evaluate the feasibility of operational rules regarding reservoir capacity and the law of continuity on a daily basis karamouz et al 2003 the 3 magnitudes and 3 locations of pollution intrusion were then combined with each release strategy generated resulting in 18 000 500 500 500 500 3 3 possible scenarios each possible pollutant intrusion scenario was introduced to the mlp model through a vector including 140 daily releases and four characteristics of the intrusion scenario i e the values of air temperature location quantity and time of pollutant intrusion this led to a 144 18000 matrix representing the mlp input dataset to estimate seasonal pollution concentrations at reservoir outlets under all scenarios i e 500 3 3 the ce qual w2 model was forced with 500 associated release scenarios 3 quantities and 3 locations of pollution intrusion this process was repeated for four seasons i e the four different times of pollutant intrusion resulting in a 140 18000 matrix of mtbe concentration levels considering the 70 day simulation period and the two reservoir outlets this generated two matrices one of 144 18000 and another of 140 18000 representing the input and output datasets respectively as an mlp neural network model may be subject to overfitting if trained with such a large input output dataset vanda et al 2021 the size of the input output dataset must be reduced while maintaining critical information this necessity was met due to i the development of two distinct mlp models one for each outlet and ii the use of the pca tool for more detail see supplementary material section s 2 the mlp model for each outlet hereafter referred to as pca mlp was then trained and validated against the prepared input target dataset see supplementary material section s 2 included within the optimization model this served to determine mtbe concentrations at reservoir outlets under all pollution scenarios 2 4 optimal reservoir operational rules using a non dominant sorting genetic algorithm nsga ii deb et al 2002 coupled with fixed pca mlp surrogate models a three objective optimization model was developed to determine optimal reservoir operational rules a fast and elitist multi objective genetic algorithm nsga ii employs standard genetic algorithm parameters e g population size operator probabilities etc to determine a trade off curve among conflicting objectives shrestha and rode 2008 to obtain optimal reservoir operational rules three objective functions were prepared i to satisfy agricultural water demand the unsatisfied water demand z 1 was minimized 3 z 1 m i n i m i z e u n d where und was the seasonal maximum unsatisfied water demand calculated using eqs s7 to s10 section s 3 supplementary material ii to maintain the quality of water released for downstream consumption the risk of frequency magnitude violations of water quality standards z 2 was also minimized 4 z 2 m i n i m i z e cvar sv α where cvar sv α is the conditional value at risk cvar of the standard quality violation at a confidence level of α gm 3 determined based on the pollution scenarios calculated frequency magnitude violations of water quality standards eqs s12 and s13 section s 3 supplementary material the frequency magnitude violations were obtained by combining the relative frequency i e the number of standard violations to the total simulation period and magnitude i e the magnitude of standard violations to the total mtbe intrusion mass violations with different weights eqs s14 to s18 section s 3 supplementary material iii to ensure that hydropower generation can proceed at maximum capacity as soon as possible the risk of modified rrt z 3 was minimized 5 z 3 m i n i m i z e cvar rrt α where cvar rrt α is the cvar of modified rrt at a confidence level of α calculated as a function of the losses of modified rrt across the pollution scenarios the losses of modified rrt were determined by assessing the maximum rrt of each outlet and the difference in total mtbe intrusion and discharged mass for all the pollution scenarios eqs s20 to s25 section s 3 supplementary material considering mtbe s high capacity to volatilize from the water surface it can be instructive to explain the importance of including an objective function based on quality restrictions i e z 2 within the framework of this study although by nature mtbe will volatilize from the water surface its low henry s law constant and high aqueous solubility would lead it to more readily dissolve in water than volatilize when released in rivers and streams this property increases its persistence and mobility in the environment such that its half life in rivers and streams can exceed one day squillace et al 1996 for instance following the introduction of mtbe into massachusetts merrimack river january 28 2000 elevated levels of mtbe were detected in the river water for several days us epa 2008 hence for a river reservoir system where a pollutant has been spilled into an upstream reservoir introducing an objective function based on quality restrictions is essential to ensure the attainment and maintenance of downstream water quality standards 2 5 compromise operational rule the gmcr theory is typically modeled with gmcr ii and gmcr decision support systems hipel et al 1997 first explored a strategic groundwater contamination conflict using gmcr ii since then many studies have employed these decision support systems and highlighted their capacity to aid in the investigation of the often challenging disputes over water resource allocation e g kassab et al 2006 kilgour and hipel 2005 kinsara et al 2015 liu et al 2017 the gmcr decision support system was employed in the present study to determine a compromise operational rule among optimal rules local governmental stakeholders were considered decision makers and their options based on their priorities and goals were identified as a conflict model the feasibility reversibility and prioritization of options were then specified to analyze the model finally the stability of the desired resolution was examined based on general metarationality gmr nash stability nash symmetric metarationality smr and sequential stability seq solution concepts nash 1951 howard 1971 takahashi et al 1984 kinsara 2018 3 case study the efficiency of the developed model was tested against data from the narmab dam in golestan province iran constructed to meet the growing agricultural and domestic water demands of the cities of minoo dasht azad shahr and gonbad kavoos the narmab dam supplies water to a cultivated area of 190 km2 as well as generating hydroelectric power at an average level the narmab dam reservoir holds 115 43 106 m3 of water sedghamiz et al 2018 fig 4 the ce qual w2 simulation model of the narmab dam reservoir considered 23 layers and 16 segments in simulating the fate and transport of mtbe within the dam reservoir fig 5 the simulation model was calibrated using the data mentioned in section 2 2 collected over a full year 2012 by the golestan province regional water agency seasonal thermal conditions and other climatic parameters were taken from established values for different climate periods in the study area addressing a multi dimensional issue with several objectives the present study developed compromise operational rules for the narmab dam minimizing unsatisfied water demand violations of water quality standards and modified rrt for its reservoir under sudden pollution intrusion thereby meeting the respective and sometimes competing priorities of the ministries of agriculture environment and energy regarding the quantity and quality of water released in one such scenario the ministry of agriculture wished to see agricultural water demands met all year long under any circumstance in contrast the department of the environment insisted on minimizing environmental pollution preferring the time consuming process of within reservoir pollution control rather than the release of polluted water beyond these water quality magnitude conflicts the ministry of energy which operates the hydroelectric power plant preferred the shortest possible reservoir recovery to generate electricity with the dam at full capacity as often as possible this conflict was further explored using the developed gmcr 4 results and discussion the proposed simulation optimization model determined optimal operational rules by assessing different values of daily releases from reservoir outlets for 36 different pollution scenarios as illustrated in fig 2 including uncertainties the model minimized the risk of modified rrt and frequency magnitude violations of water quality standards after the sudden intrusion of mtbe by coupling the optimization model with the validated pca mlp surrogate model fig 6 shows the 12 pareto front solutions produced by nsga ⅱ for a population size of 1 520 after reaching the specified maximum number 200 of generations values of rrt ranged between 0 6 and 0 9 fig 6 where 0 r r t 1 0 and rrt 0 and rrt 1 0 respectively represent a lack of mtbe contamination in water discharged from reservoir outlets and no reservoir recovery after 70 days of imposed reservoir recovery operational rules the same ranges were followed for the risk of frequency magnitude violations of water quality standards setting out compromise reservoir operational rules based solely on the pareto front solutions was a challenging issue given the conflict between the ministries of agriculture energy and environment regarding two aspects of rrt and the quantity of water discharged from reservoir outlets fig 6 the decision variables corresponding to the pareto front solutions served to determine three affecting parameters from each decision maker s point of view taking advantage of the post processing capability provided in the optimization model one of the affecting parameters was labeled modified rrt which imposed the ministry of energy functions direct effect the released mtbe and satisfied water demand of major concern for the ministries of environment and agriculture respectively were also introduced as affecting parameters the cumulative values of the decision variables daily operational rules over 70 days of the simulation are shown in fig 7 the rrt risk values for the pareto front solutions revealed that the determined operational rules were all capable of completely removing the mtbe pollution in less than 70 days consequently the wide range of cumulative water release values under the operational rules indicated that water releases were not the only factor in mtbe pollution elimination but that considering the volatility of mtbe thermal conditions might also exert potential effects thermal conditions wind speed and reservoir surface vary seasonally accordingly any operational rules determined through this process would only be reliable when seasonal performances are assessed furthermore the time to reach the peak pollutant concentration at reservoir outlets the maximum pollutant concentration and the rrt values of each operational rule might be affected by the reservoir configuration s role in the elimination of pollution which would be significantly different given different pollutant intrusion locations vanda et al 2021 optimal reservoir operational rules were divided into three categories evaporation based rule evapo release based rule and release based rule for low medium and high releases respectively fig 7 the release based rule attempted to control mtbe pollution by massive flow releases this might pose serious hazards to the environment in contrast the evaporation based rule required closing the reservoir outlets and employing the reservoir s capacity to control the mtbe pollution through mtbe volatilization the rrt values of each category as average values of all solutions in the category 1 1 as an example the rrt of the evaporation based rule was equal to the average of rrt values related to the pareto front solutions number 7 and 9 to 12 are shown in fig 8 the fate of mtbe after spilling into surface water strongly depends on specific site characteristics that control chemical processes as well as physical and biological ones in terms of the duration of pollutant presence and its maximum concentration intrusion during the warmer season was expected to be less hazardous than in other seasons regardless of the reservoir operational rules shokri et al 2014 stocking and kavanaugh 2000 indeed in the present case the rrt was significantly shorter during the warmer seasons spring and summer than in the fall or winter fig 8 moreover in spring and summer the rrts of evaporation based and evapo release based rules were substantially shorter usually zero than those of the release based rule in contrast the relative duration of rrts was distinctly longer in the colder seasons at first glance these results may seem surprising as release based rules would apparently benefit from both volatilization and contaminated water release however the high longitudinal transfer rate and vertical mixing of the water body under release based rules transferred mtbe to the underlying reservoir layers which significantly reduced the possibility of mtbe removal by volatilization and resulted in a rational increase of rrt in warm seasons seasonal variations in rrt fig 8 show quantity and intrusion location of mtbe in warm seasons to have a negligible effect on rrt values in the case of evaporation based and evapo release based rules whereas their effect was quite apparent for release based rules the relation between the rrt values and mtbe intrusion location and quantity became more highly significant in the colder seasons for all specified operation rules analogously analysis of the released mtbe fig 9 a shows that in fall and winter considering both the lower air temperatures and the characteristics of release based rules the possibility of removing pollution by volatilization was reduced and a majority of the injected mtbe reached the reservoir outlets moreover as the mtbe intrusion location approached the reservoir outlets the reservoir s role in removing mtbe was diminished thereby increasing the amount of discharged pollution hence the level of impact of mtbe quantity and intrusion location on the effectiveness of operation rules is highly dependent on pollution season thermal conditions and the operation rule selected considering rrt values evaporation based rules were satisfactory in spring and summer while release based rules were a better choice in fall and winter however when other factors fig 9 were included arriving at a decision was more complicated the total quantity of released mtbe was greater under released based rules and this difference was greater in the colder seasons fig 9a the period when these rules should technically have been better alternatives e g fig 8 in a similar manner fig 9b evaporation based rules performed poorly in meeting water demands especially in hot seasons which may raise objections against their selection for such an application the most appropriate compromise solution was selected by examining the strategic conflicts between the ministries using the gmcr decision support system first the decision makers options and preferences were modeled table 1 shows the viable options for the multi ministry conflict over reservoir pollution control considering the possibility of selecting deselecting any of these options 211 2 048 states were possible in this conflict some of which were not feasible each ministry s set of options table 1 was mutually exclusive and should be selected individually for the ministries of energy environment and agriculture respectively there existed 1024 532 and 352 states in which two of a single ministry s options were selected as unfeasible as explained in table s2 supplementary material furthermore a state in which a decision maker chose no option was also deemed non feasible and consequently 76 more states were removed the remaining states not deemed feasible arose from the governing environmental physical conditions simultaneous selections of stand by and controlled release stand by and warn only stand by and fully satisfied controlled release and partially satisfied were impossible making a further 30 states not feasible with 2 014 non feasible states 34 feasible states remained table 2 the complete table is provided in the supplementary material section s 4 next the feasible states were ranked considering each decision maker s relative preferences table s4 supplementary material section s 4 the stability of feasible states was then assessed by four stability criteria nash seq gmr and smr to determine possible equilibrium table 3 since each option corresponds to a certain range of the affecting parameters the affecting parameters were sorted and categorized to determine the compromise solutions among the pareto fronts fig 10 the exact values of affecting parameters are provided in supplementary material section s 5 the relative overlap in the goals of the energy and agriculture ministries is an arguable point with regard to the release of polluted water from reservoir outlets despite such overlaps the inherent conflicts of existing goals and desires needed to be investigated especially when the purpose was to obtain a compatible solution through game theory based gmcr modelling the combination of these two goals as a single objective may accordingly disturb the developed model s robustness and eliminate the bargaining possibility between the authorities selected this is clearly illustrated in fig 10 where considering solution 3 during the warmer seasons spring and summer would fully satisfy the ministry of energy s desires while the ministry of agriculture would find the conditions less desirable but acceptable based on seasonal compromise solutions for the spring fig 11 the ministry of energy could choose between the non stop and stand by options the ministry of environment could select between no release and restricted release while the ministry of agriculture could choose from partially satisfied poorly satisfied or not satisfied options to facilitate conflict resolution solution 3 corresponding to stable state 7 was adopted table 2 and fig 10 the same pattern was followed in other seasons with solution 3 adopted in summer and solution 12 in fall and winter it is noteworthy that in fall and winter the ministry of energy had no choice but to shut down the power generators in agreement with states 2 4 and 6 hence in these seasons state1 was the stable state considering the gmcr unilateral moves fig s3 supplementary material section s 5 the rrt released mtbe and satisfied water demand of solution 3 release based rule and solution 12 evaporation based rule under different pollution scenarios fig 12 showed that solution 12 could control the mtbe pollution in a shorter time fig 12a with less environmentally destructive effects fig 12b than solution 3 however the satisfied water demand of 22 5 vs 46 0 spring and 23 2 vs 46 8 summer fig 12c for solutions 12 and 3 respectively finally led to an agreement on solution 3 fortunately higher temperatures in warmer seasons accelerated the process of pollution control inside the reservoir and the amount of released polluted water in both solutions remained within an acceptable range fig 12b in fall and winter the results given by solutions 3 and 12 were similar solution 12 remained more environmentally friendly in these seasons but required a longer rrt and provided less water demand satisfaction than solution 3 which made a choice difficult with the developed gmcr model fig 11 the decision makers chose solution 12 considering the slight differences in rrt and acceptable values of unsatisfied water demand for both solutions it was apparent that the compromise operational rules developed in this study were in direct contradiction with those chosen by strictly comparing rrt values this contrast indicated the importance of including regional conditions in determining reliable reservoir operational rules after sudden reservoir pollution the mtbe concentrations at the reservoir outlets for solutions 3 and 12 for different pollution scenarios fig 13 and fig s4 respectively show that the maximum daily mtbe release from the reservoir outlets in the cold seasons fall and winter was considerably greater than in the spring and summer fig 13 moreover the time required for the daily released mtbe to reach its maximum was much shorter in the cold seasons confirming the direct effect and importance of reservoir thermal conditions in controlling the amount of mtbe released downstream 5 1 analysis of solution reliability as inadequate calibration of the developed ce qual w2 model and implementation of the surrogate model can lead to errors in the optimization process one must evaluate the reliability of the operational rules obtained a post audit concept was employed in this study to investigate the robustness of the ce qual w2 and pca mlp models employed to estimate the reservoir responses under different pollutant intrusion scenarios the post audit concept requires the introduction of meaningful changes to the model to see whether expected shifts occur in the results considering the model s expected behavior as a reasonable straightforward test post audit evaluates the simulation model s capacities by assessing the occurrence of anticipated changes wells 2019 variations in rrt released mtbe and satisfied water demand values for three operational rule categories and for 36 pollution scenarios were investigated figs 8 and 9 the different operational policies i e evaporation based rule evapo release based rule and release based rule led to responses from the reservoir that were acceptable based on the existing understanding of the processes modeled as well as knowledge of the system being simulated accordingly based on the post audit errors due to the calibration and implementation of a surrogate were deemed negligible 6 summary and conclusions as large dam reservoirs are often exposed to intentional or accidental pollution an appropriate operational response when sudden reservoir pollution occurs is key to avoiding harmful health effects the model developed in this study imposed optimal operational rules by simultaneously minimizing the unsatisfied water demand the risk of frequency magnitude violations of water quality standards and the risk of modified reservoir recovery time rrt it considered 36 different pollution scenarios a combination of location quantity and time of pollution intrusion the gasoline additive mtbe was considered as the injected pollutant a direct effect of thermal conditions on the relative performance of different operational rules used to control mtbe pollution was noted the evaporation based rules performed satisfactorily in spring and summer due to the higher temperatures whereas release based rules provided a superior alternative in the colder seasons accordingly reliable operational rules can only be determined when the pollution intrusion time uncertainties are included similarly the significant difference between the objective values related to the pollution scenarios in each season indicated that the uncertainties related to the location and quantity of mtbe input should also be taken into account to reduce the risk of operational rules inadequacy in the worst possible pollution cases due to the optimization model s conflicting objectives a compromise solution was chosen through a gmcr model the compromise solutions were actually in direct contrast with the preliminary judgments with a release based rule selected for warmer seasons at the same time the decision makers agreed on an evaporation based rule for fall and winter the significant impact of environmental conditions priorities of the decision makers and local rules on selecting appropriate operational rules indicate the importance of implementing conflict resolution models in managing water allocation from reservoirs in ongoing work the proposed framework is being combined with a pollutant detection framework such as that introduced by pourshahabi et al 2018 to examine the possibility of real time reservoir operation under accidental pollution credit authorship contribution statement sadegh vanda investigation methodology software formal analysis visualization validation writing review editing mohammad reza nikoo supervision conceptualization resources methodology software validation writing review editing parnian hashempour bakhtiari writing original draft writing review editing visualization malik al wardy conceptualization writing review editing jan franklin adamowski conceptualization writing review editing jiří šimůnek conceptualization writing review editing amir h gandomi conceptualization writing review editing declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper appendix a supplementary data supplementary data to this article can be found online at https doi org 10 1016 j jhydrol 2021 127313 appendix a supplementary data the following are the supplementary data to this article supplementary data 1 
3745,given the hazardous effects of sudden dam reservoir contamination as might occur upon the intrusion of the fuel additive methyl tert butyl ether mtbe the contaminant s effect on the quality of allocated waters requires careful study employed to determine optimal reservoir operational rules in the case of sudden mtbe pollution a risk based simulation optimization model was developed to simultaneously minimize unsatisfied water demand the risk of violations of water quality standards and the reservoir recovery time risks were assessed by considering various often neglected pollution scenarios as a combination of location quantity and the season of pollution intrusion the appropriateness of operational rules proved to depend upon thermal conditions and mtbe intrusion properties confirming the necessity of considering location quantity season uncertainties social and regional conditions also occupied a dominant role in determining the level of satisfaction achieved under different water allocation strategies accordingly by considering environmental conditions and local rules a graph model for conflict resolution was established and used to reach a set of compromise operational rules the developed framework could serve as a guide for water utilities to determine efficient reservoir operational rules after a sudden contaminant intrusion keywords ce qual w2 simulation model conditional value at risk gmcr decision support system surrogate models 1 introduction dam construction is a common solution to cope with year round agricultural and domestic water demands especially in areas subject to a hot and dry climate generally dam reservoir water withdrawals are scheduled according to specific operational rules that depend on environmental conditions quantity and quality of available water and dam characteristics e g kerachian and karamouz 2006 ashofteh et al 2015 pourshahabi et al 2020 among these influencing factors the danger of large dam reservoirs being intentionally or accidentally subjected to pollutant intrusion is of the utmost importance pollutant intrusion accidents most commonly occur as a result of human error e g failure in the transportation of hazardous chemicals li et al 2014 a sudden toxic chemical discharge into the rhine river from a chemical warehouse fire via fire fighting water runoff in 1986 giger 2009 the accidental contamination of kyrgyzstan s lake issyk kul and barksoon river with sodium cyanide spilled near the kumtor gold mine in may 1998 pannier 1998 pollution of cayuga inlet creek west danby ny with diesel oil following a train derailment lytle and peckarsky 2001 and a spill of arsenic rich tailings from a pyrite mine in southern spain kraus and wiegand 2006 are only a few examples of sudden chemical contamination causing serious damage to aquatic life and contributing to ecosystem degradation this issue is rather more critical in developing countries for example on march 4 2003 a truck accident released 30 400 l of methyl tert butyl ether mtbe into the khalife tarkhan river near sanandaj upper gheshlagh river basin kordestan iran the spill reached the gheshlagh reservoir within 24 hr thereby limiting access to safe water and restricting water allocations afshar et al 2017 since pollutant intrusion accidents can lead to highly hazardous and acutely critical situations with highly undesirable consequences even slight probabilities of contamination should be considered in addition to employing physical barriers such as protective guard rails for accident prevention appropriate operational responses must also be provided when these accidents do occur several studies have employed modified optimization algorithms haddad et al 2008 afshar et al 2011 to provide operational response strategies that balance concerns regarding freshwater quality and the quantity of water available to meet demands chaves et al 2003 kerachian and karamouz 2007 castelletti et al 2014 azadi et al 2019 accordingly it is critical that the operational rules developed and implemented in response to a reservoir s sudden pollution and decline in water quality should be valid and effective a range of simulation optimization models has been applied to determine standard reservoir operational rules and allocate stored water according to water quality quantity limitations liu et al 2020 nourani et al 2020 while operational rules to manage sudden water contamination incidents in reservoirs are essential to avoid adverse effects on the health of water consumers they have not been broadly studied saadatpour and afshar 2013 shokri et al 2014 haddad et al 2014 2015 amirkani et al 2016 a pollution intrusion response management model was developed by saadatpour and afshar 2013 to simultaneously minimize reservoir recovery time and reduce water quality standard violations for different injection masses and locations but it neglected the effects of intrusion timing however it is acknowledged that seasonal changes in water temperature wind speed reservoir surface area and hydraulic conditions can theoretically affect both reservoir dynamics and the fate of pollutants within surface water bodies stocking and kavanaugh 2000 assuming the possibility of injections in each of four seasons shokri et al 2014 and amirkani et al 2016 demonstrated an apparent seasonality effect on the operational rules developed for a volatile pollutant spill for example the numerical experiment designed by shokri et al 2014 showed that in terms of pollutant duration and maximum concentration the intrusion of a volatile pollutant in spring offered fewer risks than at other times while studies investigating the effect of different climatic conditions occurring with seasonal changes tahir et al 2008 ashofteh et al 2015 or various pollutant characteristics e g mass and intrusion location saadatpour and afshar 2013 have successfully generated optimal operational rules appropriate to a particular single factor uncertainties arising from the simultaneous and potentially synergistic effects of multiple factors have not been investigated to reduce the risk of applying inefficient operational rules in the case of unavoidable incidents these uncertainties should clearly be addressed in the process of determining optimization model objectives a further key issue in the case of sudden reservoir pollution is the type of pollutant involved since the transport of petrol gasoline is common in various parts of the world it is important that the intrusion of various petrol additives such as methyl tert butyl ether mtbe iupac 2 methoxy 2 methylpropane into bodies of water receive particular attention however among pollutants threatening the quality of surface water bodies such as dam reservoirs mtbe intrusion has garnered limited attention amirkani et al 2016 shokri et al 2014 shokri et al 2014 added the capacity to simulate the fate and transport of mtbe to the existing two dimensional laterally integrated hydrodynamics and transport reservoir simulation model ce qual w2 this capacity was included in the modified version of the ce qual w2 model and was shown to be reliable in a subsequent study afshar et al 2017 nonetheless the performance of operational rules after mtbe intrusion has not been extensively investigated reliable operational rules should be compatible with social and regional conditions including stakeholders demands and goals daneshmand et al 2014 in most previous studies e g kerachian and karamouz 2006 and 2007 shirangi et al 2008 haddad et al 2014 yang et al 2014 operational rules were obtained from simulation simulation optimization models with conflicting goals in such cases attempts were made to resolve existing conflicts over selecting operational rules using conflict resolution methods such as young or nash bargaining theories among conflict resolution methods the graph model for conflict resolution gmcr has demonstrated an inherent superiority in the analysis of the strategic aspects of water disputes dowlatabadi et al 2020 mooselu et al 2021 wu et al 2019 madani and hipel 2007 by modifying classical game theory gmcr has achieved an uncomplicated flexible structure that requires only minimal information to model and analyze the strategic conflicts disputes between decision makers with multiple conflicting objectives despite the necessity to consider local rules and the priorities of influential decision makers the implementation of gmcr has yet to be considered in selecting optimal compromise reservoir operational rules in the present study a multi objective simulation optimization model was developed to determine optimal dam water withdrawals a k a operational rules from reservoir outlets under sudden mtbe pollution this was carried out by simultaneously minimizing unsatisfied water demand the risk of frequency magnitude violations of water quality standards and the risk of modified reservoir recovery time rrt the developed model sought to address the shortcomings of previous studies and drive progress in establishing operational rules by taking advantage of the following approaches i including uncertainties related to climatic conditions and pollutant characteristics by considering various pollutant intrusion scenarios ii assessing uncertainties arising from the potential synergistic effects of different climatic conditions and various pollutant characteristics iii addressing uncertainties by determining optimization model objectives for the worst case scenarios using the conditional value at risk cvar iv determining the compromise operational rule among the pareto front solutions with the help of conflict resolution models using the gmcr decision support system to facilitate the modeling process and provide a comprehensive framework the following procedures were implemented i repeated executions of the calibrated ce qual w2 water quality and hydrodynamic model in a matlab environment drawing upon thousands of input output sets to train and validate the surrogate model ii replacement of the simulation model by a surrogate model thanks to a combined principal component analysis multilayer perceptron pca mlp artificial neural network serving to reduce the model s runtime and computational burden iii coupling optimization and surrogate models in the matlab environment to determine the optimal reservoir operational rules under sudden mtbe pollution 2 methodology a detailed explanation of the proposed model s main methodological steps in determining optimal reservoir operational rules is illustrated schematically in fig 1 the proposed multi objective framework fig 1 includes five steps i developing pollution scenarios ii running a reservoir simulation iii replacing the calibrated ce qual w2 simulation model with an appropriate reservoir surrogate model iv determining optimal reservoir operational rules and v determining the compromise operational rule these steps are thoroughly discussed in the following sections 2 1 development of pollution scenarios to include the uncertainties related to the pollutant s fate and transport through the reservoir operational rules were developed that considered different pollution scenarios based on a priori knowledge of the processes affecting the fate of mtbe in reservoirs and sensitivity analyses pollutant intrusion time pollutant quantity and intrusion location were identified as parameters of influence accordingly three pollutant concentrations low medium and high three intrusion sites within the reservoir adjacent to the reservoir outlets in the middle of the reservoir and farthest from the outlets and four intrusion times first day of summer spring fall and winter were factorially combined to establish 36 3 3 4 different pollution scenarios fig 2 within this framework the possibility of pollutant intrusion within any season served to address the seasonality effects on thermal conditions i e air and water temperature reservoir surface area interchangeably used with reservoir level wind speed water demands and reservoir inflows the three pollutant intrusion locations were selected to acknowledge the variability of reservoir response to the intrusion location and provide a reliable general optimization model the selection of intrusion locations well distributed across the reservoir s expanse rather than at high risk intrusion locations alone was considered in developing the numerical experiment in this study these scenarios shed light on how changes in water temperature wind speed and reservoir surface area might affect the fate of mtbe drawing upon the observations of stocking and kavanaugh 2000 who evaluated the impact of several environmental variables on the fate of mtbe in standing waters one can postulate that water temperature and wind speed increases might accelerate the elimination of mtbe by increasing the rate of mtbe volatilization and decreasing its half life on the other hand an increase in reservoir surface area would decelerate the elimination of mtbe by decreasing the rate of mtbe volatilization 2 2 reservoir simulation several processes including volatilization advection biodegradation photooxidation adsorption and abiotic degradation are involved in deciding the fate of mtbe in standing water stocking and kavanaugh 2000 however given the physicochemical properties of mtbe i e a high tendency to dissolve in aqueous media a relatively low henry s constant and low adsorption to sediments and its attendant behaviour in a body of water many of these processes were insignificant or slow leaving volatilization advection and decay processes as the preeminent pathways of mtbe elimination afshar et al 2017 accordingly mtbe can be classified as a generic constituent that does not interact significantly with any of the water quality state variables and hydrodynamics wells 2019 a well known two dimensional laterally averaged hydrodynamics and water quality simulation model ce qual w2 has been widely used to model both vertical and horizontal pollutant propagation in reservoirs and lakes kim and kim 2006 yu et al 2010 soleimani et al 2016 heidarzadeh and nejad 2017 azadi et al 2019 burigato et al 2019 wells 2019 considering mtbe as a volatile generic constituent the ce qual w2 model takes into account changes in mtbe concentrations caused by spilling of mtbe into the lake vertical mixing of the water body discharge of mtbe through reservoir outflows surface exchange of mtbe from the reservoir surface and decay processes fig 3 here the ce qual w2 simulation model was calibrated and employed to determine the mtbe concentration at reservoir outlets over a 70 day simulation period for different magnitudes locations and timings of mtbe intrusion the simulation period of 70 days was adjusted to equal the maximum rrt of the various pollution scenarios recognizing the ability of the ce qual w2 model to simulate thermal stratification in reservoirs gelda et al 1998 rangel peraza et al 2012 this model was also used to estimate the temperature of different layers of the reservoir using the data regarding topography inflow weather stream temperatures and release values the ce qual w2 model was calibrated in two stages i reservoir geometry calibration and ii reservoir hydrodynamic calibration to define and calibrate the finite difference model for the reservoir information regarding reservoir geometry was gathered from a topographic map of the region and a viable volume area elevation diagram for the dam s reservoir these served respectively to determine the bathymetric cross sections and evaluate the volume area elevation curve generated by the reservoir model as the calibration of reservoir hydrodynamic features was sensitive to depth temperature profiles and reservoir water surface elevation monthlyvertical temperature profiles and daily water surface elevation wse information was employed in the calibration of the developed reservoir hydrodynamicmodel with respect to the fate and transport of mtbe a modified source sink equation which considered mtbe surface exchanges and biodegradation processes including volatilization and absorption from the top layer water surface and possible zero or first order decay processes eq 1 was solved by the model in the form wells 2019 1 s gvol k 0 θ g t 20 k 1 θ g t 20 φ g 1 h kt k l o 2 c g k l f φ g where s gvol is the source sink term for the volatile generic constituent concentration k 0 is the zero order decay coefficient g m 3 s 1 at 20 c θ g is the temperature correction factor with a typical range of 1 02 1 05 heald et al 2005 t is water temperature oc k 1 is the first order decay coefficient s 1 at 20 c φ g is the volatile generic constituent concentration k l o 2 is the reaeration coefficient for oxygen cgklf is the unitless user defined gas transfer factor 0 776 for mtbe and h kt is depth of the surface layer computational cell m as the focus was to develop a surrogate based optimization model rather than one drawing upon a calibrated ce qual w2 model zero order decay was neglected while first order decay was determined using a k 1 coefficient value of 2 k 1 ln 2 t 0 5 where t 0 5 is the mtbe half life heald et al 2005 in the present context the value of t 0 5 was assumed to be 28 days the correction formulation presented by elmore and west 1961 served to adjust the reaeration and first order decay coefficients for other temperatures in this regard the temperature correction factor θ g was adjusted to 1 024 according to wells 2019 moreover as suggested by o connor 1983 the reaeration coefficient as a function of wind speed was considered to determine the wind effects on mtbe evaporation from the top layer 2 3 reservoir surrogate model generally speaking the implementation of ce qual w2 has been accompanied by considerable computational burdens this limitation worsened when recurrent simulations were required such as within simulation optimization frameworks for fitness evaluations saadatpour et al 2020 to address the simulation optimization model runtime concerns the calibrated ce qual w2 simulation model was replaced by a modified version of the pca mlp surrogate model introduced by vanda et al 2021 based on their proposed framework principal component analysis pca was coupled with a multilayer perceptron architecture mlp artificial neural network ann model to assess the operational responses to pollution intrusion scenarios traditionally a large dataset of inputs and outputs procured by repeated execution of the developed simulation model is required to train and validate the ann based surrogate models however the redundant information in datasets prepared in this manner would not only potentially prevent the ann model from accurately detecting the relationship between the input and output datasets but might also result in an imprecise and time consuming surrogate model within this framework the pca tool therefore served to i reduce the dimensions of input and output data ii reduce the model complexity brought about by high dimensionality and iii minimize the overfitting risk of the mlp surrogate model 2 3 1 development of the pca mlp model in accordance with vanda et al 2021 the two matrices of daily release strategies and their associated daily pollution concentration levels at reservoir outlets whose dimensions had been reduced using the pca tool were respectively introduced to the mlp model as input and output matrices however given that reservoir response can vary significantly according to the time location and magnitude of the pollution intrusion the use of such input output data to train the mlp model was not applicable here to address this a representative training dataset was established in which potential combinations of the four factors of time location and magnitude of the pollution intrusion as well as daily release strategies were included to do so 500 different operational rules release strategies for discharging water from two reservoir outlets applied over a 70 day period a 140 500 matrix were generated individually for each of the four seasons this allowed the inclusion of seasonal effects on initial reservoir storage and daily reservoir inflow making it possible to evaluate the feasibility of operational rules regarding reservoir capacity and the law of continuity on a daily basis karamouz et al 2003 the 3 magnitudes and 3 locations of pollution intrusion were then combined with each release strategy generated resulting in 18 000 500 500 500 500 3 3 possible scenarios each possible pollutant intrusion scenario was introduced to the mlp model through a vector including 140 daily releases and four characteristics of the intrusion scenario i e the values of air temperature location quantity and time of pollutant intrusion this led to a 144 18000 matrix representing the mlp input dataset to estimate seasonal pollution concentrations at reservoir outlets under all scenarios i e 500 3 3 the ce qual w2 model was forced with 500 associated release scenarios 3 quantities and 3 locations of pollution intrusion this process was repeated for four seasons i e the four different times of pollutant intrusion resulting in a 140 18000 matrix of mtbe concentration levels considering the 70 day simulation period and the two reservoir outlets this generated two matrices one of 144 18000 and another of 140 18000 representing the input and output datasets respectively as an mlp neural network model may be subject to overfitting if trained with such a large input output dataset vanda et al 2021 the size of the input output dataset must be reduced while maintaining critical information this necessity was met due to i the development of two distinct mlp models one for each outlet and ii the use of the pca tool for more detail see supplementary material section s 2 the mlp model for each outlet hereafter referred to as pca mlp was then trained and validated against the prepared input target dataset see supplementary material section s 2 included within the optimization model this served to determine mtbe concentrations at reservoir outlets under all pollution scenarios 2 4 optimal reservoir operational rules using a non dominant sorting genetic algorithm nsga ii deb et al 2002 coupled with fixed pca mlp surrogate models a three objective optimization model was developed to determine optimal reservoir operational rules a fast and elitist multi objective genetic algorithm nsga ii employs standard genetic algorithm parameters e g population size operator probabilities etc to determine a trade off curve among conflicting objectives shrestha and rode 2008 to obtain optimal reservoir operational rules three objective functions were prepared i to satisfy agricultural water demand the unsatisfied water demand z 1 was minimized 3 z 1 m i n i m i z e u n d where und was the seasonal maximum unsatisfied water demand calculated using eqs s7 to s10 section s 3 supplementary material ii to maintain the quality of water released for downstream consumption the risk of frequency magnitude violations of water quality standards z 2 was also minimized 4 z 2 m i n i m i z e cvar sv α where cvar sv α is the conditional value at risk cvar of the standard quality violation at a confidence level of α gm 3 determined based on the pollution scenarios calculated frequency magnitude violations of water quality standards eqs s12 and s13 section s 3 supplementary material the frequency magnitude violations were obtained by combining the relative frequency i e the number of standard violations to the total simulation period and magnitude i e the magnitude of standard violations to the total mtbe intrusion mass violations with different weights eqs s14 to s18 section s 3 supplementary material iii to ensure that hydropower generation can proceed at maximum capacity as soon as possible the risk of modified rrt z 3 was minimized 5 z 3 m i n i m i z e cvar rrt α where cvar rrt α is the cvar of modified rrt at a confidence level of α calculated as a function of the losses of modified rrt across the pollution scenarios the losses of modified rrt were determined by assessing the maximum rrt of each outlet and the difference in total mtbe intrusion and discharged mass for all the pollution scenarios eqs s20 to s25 section s 3 supplementary material considering mtbe s high capacity to volatilize from the water surface it can be instructive to explain the importance of including an objective function based on quality restrictions i e z 2 within the framework of this study although by nature mtbe will volatilize from the water surface its low henry s law constant and high aqueous solubility would lead it to more readily dissolve in water than volatilize when released in rivers and streams this property increases its persistence and mobility in the environment such that its half life in rivers and streams can exceed one day squillace et al 1996 for instance following the introduction of mtbe into massachusetts merrimack river january 28 2000 elevated levels of mtbe were detected in the river water for several days us epa 2008 hence for a river reservoir system where a pollutant has been spilled into an upstream reservoir introducing an objective function based on quality restrictions is essential to ensure the attainment and maintenance of downstream water quality standards 2 5 compromise operational rule the gmcr theory is typically modeled with gmcr ii and gmcr decision support systems hipel et al 1997 first explored a strategic groundwater contamination conflict using gmcr ii since then many studies have employed these decision support systems and highlighted their capacity to aid in the investigation of the often challenging disputes over water resource allocation e g kassab et al 2006 kilgour and hipel 2005 kinsara et al 2015 liu et al 2017 the gmcr decision support system was employed in the present study to determine a compromise operational rule among optimal rules local governmental stakeholders were considered decision makers and their options based on their priorities and goals were identified as a conflict model the feasibility reversibility and prioritization of options were then specified to analyze the model finally the stability of the desired resolution was examined based on general metarationality gmr nash stability nash symmetric metarationality smr and sequential stability seq solution concepts nash 1951 howard 1971 takahashi et al 1984 kinsara 2018 3 case study the efficiency of the developed model was tested against data from the narmab dam in golestan province iran constructed to meet the growing agricultural and domestic water demands of the cities of minoo dasht azad shahr and gonbad kavoos the narmab dam supplies water to a cultivated area of 190 km2 as well as generating hydroelectric power at an average level the narmab dam reservoir holds 115 43 106 m3 of water sedghamiz et al 2018 fig 4 the ce qual w2 simulation model of the narmab dam reservoir considered 23 layers and 16 segments in simulating the fate and transport of mtbe within the dam reservoir fig 5 the simulation model was calibrated using the data mentioned in section 2 2 collected over a full year 2012 by the golestan province regional water agency seasonal thermal conditions and other climatic parameters were taken from established values for different climate periods in the study area addressing a multi dimensional issue with several objectives the present study developed compromise operational rules for the narmab dam minimizing unsatisfied water demand violations of water quality standards and modified rrt for its reservoir under sudden pollution intrusion thereby meeting the respective and sometimes competing priorities of the ministries of agriculture environment and energy regarding the quantity and quality of water released in one such scenario the ministry of agriculture wished to see agricultural water demands met all year long under any circumstance in contrast the department of the environment insisted on minimizing environmental pollution preferring the time consuming process of within reservoir pollution control rather than the release of polluted water beyond these water quality magnitude conflicts the ministry of energy which operates the hydroelectric power plant preferred the shortest possible reservoir recovery to generate electricity with the dam at full capacity as often as possible this conflict was further explored using the developed gmcr 4 results and discussion the proposed simulation optimization model determined optimal operational rules by assessing different values of daily releases from reservoir outlets for 36 different pollution scenarios as illustrated in fig 2 including uncertainties the model minimized the risk of modified rrt and frequency magnitude violations of water quality standards after the sudden intrusion of mtbe by coupling the optimization model with the validated pca mlp surrogate model fig 6 shows the 12 pareto front solutions produced by nsga ⅱ for a population size of 1 520 after reaching the specified maximum number 200 of generations values of rrt ranged between 0 6 and 0 9 fig 6 where 0 r r t 1 0 and rrt 0 and rrt 1 0 respectively represent a lack of mtbe contamination in water discharged from reservoir outlets and no reservoir recovery after 70 days of imposed reservoir recovery operational rules the same ranges were followed for the risk of frequency magnitude violations of water quality standards setting out compromise reservoir operational rules based solely on the pareto front solutions was a challenging issue given the conflict between the ministries of agriculture energy and environment regarding two aspects of rrt and the quantity of water discharged from reservoir outlets fig 6 the decision variables corresponding to the pareto front solutions served to determine three affecting parameters from each decision maker s point of view taking advantage of the post processing capability provided in the optimization model one of the affecting parameters was labeled modified rrt which imposed the ministry of energy functions direct effect the released mtbe and satisfied water demand of major concern for the ministries of environment and agriculture respectively were also introduced as affecting parameters the cumulative values of the decision variables daily operational rules over 70 days of the simulation are shown in fig 7 the rrt risk values for the pareto front solutions revealed that the determined operational rules were all capable of completely removing the mtbe pollution in less than 70 days consequently the wide range of cumulative water release values under the operational rules indicated that water releases were not the only factor in mtbe pollution elimination but that considering the volatility of mtbe thermal conditions might also exert potential effects thermal conditions wind speed and reservoir surface vary seasonally accordingly any operational rules determined through this process would only be reliable when seasonal performances are assessed furthermore the time to reach the peak pollutant concentration at reservoir outlets the maximum pollutant concentration and the rrt values of each operational rule might be affected by the reservoir configuration s role in the elimination of pollution which would be significantly different given different pollutant intrusion locations vanda et al 2021 optimal reservoir operational rules were divided into three categories evaporation based rule evapo release based rule and release based rule for low medium and high releases respectively fig 7 the release based rule attempted to control mtbe pollution by massive flow releases this might pose serious hazards to the environment in contrast the evaporation based rule required closing the reservoir outlets and employing the reservoir s capacity to control the mtbe pollution through mtbe volatilization the rrt values of each category as average values of all solutions in the category 1 1 as an example the rrt of the evaporation based rule was equal to the average of rrt values related to the pareto front solutions number 7 and 9 to 12 are shown in fig 8 the fate of mtbe after spilling into surface water strongly depends on specific site characteristics that control chemical processes as well as physical and biological ones in terms of the duration of pollutant presence and its maximum concentration intrusion during the warmer season was expected to be less hazardous than in other seasons regardless of the reservoir operational rules shokri et al 2014 stocking and kavanaugh 2000 indeed in the present case the rrt was significantly shorter during the warmer seasons spring and summer than in the fall or winter fig 8 moreover in spring and summer the rrts of evaporation based and evapo release based rules were substantially shorter usually zero than those of the release based rule in contrast the relative duration of rrts was distinctly longer in the colder seasons at first glance these results may seem surprising as release based rules would apparently benefit from both volatilization and contaminated water release however the high longitudinal transfer rate and vertical mixing of the water body under release based rules transferred mtbe to the underlying reservoir layers which significantly reduced the possibility of mtbe removal by volatilization and resulted in a rational increase of rrt in warm seasons seasonal variations in rrt fig 8 show quantity and intrusion location of mtbe in warm seasons to have a negligible effect on rrt values in the case of evaporation based and evapo release based rules whereas their effect was quite apparent for release based rules the relation between the rrt values and mtbe intrusion location and quantity became more highly significant in the colder seasons for all specified operation rules analogously analysis of the released mtbe fig 9 a shows that in fall and winter considering both the lower air temperatures and the characteristics of release based rules the possibility of removing pollution by volatilization was reduced and a majority of the injected mtbe reached the reservoir outlets moreover as the mtbe intrusion location approached the reservoir outlets the reservoir s role in removing mtbe was diminished thereby increasing the amount of discharged pollution hence the level of impact of mtbe quantity and intrusion location on the effectiveness of operation rules is highly dependent on pollution season thermal conditions and the operation rule selected considering rrt values evaporation based rules were satisfactory in spring and summer while release based rules were a better choice in fall and winter however when other factors fig 9 were included arriving at a decision was more complicated the total quantity of released mtbe was greater under released based rules and this difference was greater in the colder seasons fig 9a the period when these rules should technically have been better alternatives e g fig 8 in a similar manner fig 9b evaporation based rules performed poorly in meeting water demands especially in hot seasons which may raise objections against their selection for such an application the most appropriate compromise solution was selected by examining the strategic conflicts between the ministries using the gmcr decision support system first the decision makers options and preferences were modeled table 1 shows the viable options for the multi ministry conflict over reservoir pollution control considering the possibility of selecting deselecting any of these options 211 2 048 states were possible in this conflict some of which were not feasible each ministry s set of options table 1 was mutually exclusive and should be selected individually for the ministries of energy environment and agriculture respectively there existed 1024 532 and 352 states in which two of a single ministry s options were selected as unfeasible as explained in table s2 supplementary material furthermore a state in which a decision maker chose no option was also deemed non feasible and consequently 76 more states were removed the remaining states not deemed feasible arose from the governing environmental physical conditions simultaneous selections of stand by and controlled release stand by and warn only stand by and fully satisfied controlled release and partially satisfied were impossible making a further 30 states not feasible with 2 014 non feasible states 34 feasible states remained table 2 the complete table is provided in the supplementary material section s 4 next the feasible states were ranked considering each decision maker s relative preferences table s4 supplementary material section s 4 the stability of feasible states was then assessed by four stability criteria nash seq gmr and smr to determine possible equilibrium table 3 since each option corresponds to a certain range of the affecting parameters the affecting parameters were sorted and categorized to determine the compromise solutions among the pareto fronts fig 10 the exact values of affecting parameters are provided in supplementary material section s 5 the relative overlap in the goals of the energy and agriculture ministries is an arguable point with regard to the release of polluted water from reservoir outlets despite such overlaps the inherent conflicts of existing goals and desires needed to be investigated especially when the purpose was to obtain a compatible solution through game theory based gmcr modelling the combination of these two goals as a single objective may accordingly disturb the developed model s robustness and eliminate the bargaining possibility between the authorities selected this is clearly illustrated in fig 10 where considering solution 3 during the warmer seasons spring and summer would fully satisfy the ministry of energy s desires while the ministry of agriculture would find the conditions less desirable but acceptable based on seasonal compromise solutions for the spring fig 11 the ministry of energy could choose between the non stop and stand by options the ministry of environment could select between no release and restricted release while the ministry of agriculture could choose from partially satisfied poorly satisfied or not satisfied options to facilitate conflict resolution solution 3 corresponding to stable state 7 was adopted table 2 and fig 10 the same pattern was followed in other seasons with solution 3 adopted in summer and solution 12 in fall and winter it is noteworthy that in fall and winter the ministry of energy had no choice but to shut down the power generators in agreement with states 2 4 and 6 hence in these seasons state1 was the stable state considering the gmcr unilateral moves fig s3 supplementary material section s 5 the rrt released mtbe and satisfied water demand of solution 3 release based rule and solution 12 evaporation based rule under different pollution scenarios fig 12 showed that solution 12 could control the mtbe pollution in a shorter time fig 12a with less environmentally destructive effects fig 12b than solution 3 however the satisfied water demand of 22 5 vs 46 0 spring and 23 2 vs 46 8 summer fig 12c for solutions 12 and 3 respectively finally led to an agreement on solution 3 fortunately higher temperatures in warmer seasons accelerated the process of pollution control inside the reservoir and the amount of released polluted water in both solutions remained within an acceptable range fig 12b in fall and winter the results given by solutions 3 and 12 were similar solution 12 remained more environmentally friendly in these seasons but required a longer rrt and provided less water demand satisfaction than solution 3 which made a choice difficult with the developed gmcr model fig 11 the decision makers chose solution 12 considering the slight differences in rrt and acceptable values of unsatisfied water demand for both solutions it was apparent that the compromise operational rules developed in this study were in direct contradiction with those chosen by strictly comparing rrt values this contrast indicated the importance of including regional conditions in determining reliable reservoir operational rules after sudden reservoir pollution the mtbe concentrations at the reservoir outlets for solutions 3 and 12 for different pollution scenarios fig 13 and fig s4 respectively show that the maximum daily mtbe release from the reservoir outlets in the cold seasons fall and winter was considerably greater than in the spring and summer fig 13 moreover the time required for the daily released mtbe to reach its maximum was much shorter in the cold seasons confirming the direct effect and importance of reservoir thermal conditions in controlling the amount of mtbe released downstream 5 1 analysis of solution reliability as inadequate calibration of the developed ce qual w2 model and implementation of the surrogate model can lead to errors in the optimization process one must evaluate the reliability of the operational rules obtained a post audit concept was employed in this study to investigate the robustness of the ce qual w2 and pca mlp models employed to estimate the reservoir responses under different pollutant intrusion scenarios the post audit concept requires the introduction of meaningful changes to the model to see whether expected shifts occur in the results considering the model s expected behavior as a reasonable straightforward test post audit evaluates the simulation model s capacities by assessing the occurrence of anticipated changes wells 2019 variations in rrt released mtbe and satisfied water demand values for three operational rule categories and for 36 pollution scenarios were investigated figs 8 and 9 the different operational policies i e evaporation based rule evapo release based rule and release based rule led to responses from the reservoir that were acceptable based on the existing understanding of the processes modeled as well as knowledge of the system being simulated accordingly based on the post audit errors due to the calibration and implementation of a surrogate were deemed negligible 6 summary and conclusions as large dam reservoirs are often exposed to intentional or accidental pollution an appropriate operational response when sudden reservoir pollution occurs is key to avoiding harmful health effects the model developed in this study imposed optimal operational rules by simultaneously minimizing the unsatisfied water demand the risk of frequency magnitude violations of water quality standards and the risk of modified reservoir recovery time rrt it considered 36 different pollution scenarios a combination of location quantity and time of pollution intrusion the gasoline additive mtbe was considered as the injected pollutant a direct effect of thermal conditions on the relative performance of different operational rules used to control mtbe pollution was noted the evaporation based rules performed satisfactorily in spring and summer due to the higher temperatures whereas release based rules provided a superior alternative in the colder seasons accordingly reliable operational rules can only be determined when the pollution intrusion time uncertainties are included similarly the significant difference between the objective values related to the pollution scenarios in each season indicated that the uncertainties related to the location and quantity of mtbe input should also be taken into account to reduce the risk of operational rules inadequacy in the worst possible pollution cases due to the optimization model s conflicting objectives a compromise solution was chosen through a gmcr model the compromise solutions were actually in direct contrast with the preliminary judgments with a release based rule selected for warmer seasons at the same time the decision makers agreed on an evaporation based rule for fall and winter the significant impact of environmental conditions priorities of the decision makers and local rules on selecting appropriate operational rules indicate the importance of implementing conflict resolution models in managing water allocation from reservoirs in ongoing work the proposed framework is being combined with a pollutant detection framework such as that introduced by pourshahabi et al 2018 to examine the possibility of real time reservoir operation under accidental pollution credit authorship contribution statement sadegh vanda investigation methodology software formal analysis visualization validation writing review editing mohammad reza nikoo supervision conceptualization resources methodology software validation writing review editing parnian hashempour bakhtiari writing original draft writing review editing visualization malik al wardy conceptualization writing review editing jan franklin adamowski conceptualization writing review editing jiří šimůnek conceptualization writing review editing amir h gandomi conceptualization writing review editing declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper appendix a supplementary data supplementary data to this article can be found online at https doi org 10 1016 j jhydrol 2021 127313 appendix a supplementary data the following are the supplementary data to this article supplementary data 1 
3746,estuaries are principal sources of pollution in coastal areas estuarine water quality prediction models can provide early warnings to prevent major disasters in coastal ecosystems in this study several machine learning models multiple linear regression artificial neural networks random forest and extreme gradient boosting xgboost were developed to predict nh4 n in the xiaoqing river estuary china the results show that there is a strong nonlinear relationship between estuarine nh4 n and nh4 n of the upper reaches the shapely additive explanations method was used to interpret the xgboost model and discover the influence of the upper reaches of the river on the estuary these explanations showed that two stations monitoring water quality in the upper reaches shicun and sanchakou had a critical impact on estuarine water quality if nh4 n concentration of the upper reaches is below 2 mg l estuarine nh4 n would not be negatively influenced by the upper reaches these results can support pollution warnings for improving estuarine water quality and the integrated environmental management of the river and costal area keywords ammonia nitrogen prediction machine learning shapely additive explanations xiaoqing river estuary 1 introduction an estuary is an intersection of coastal and terrestrial waters estuaries and inshore waters are particularly vulnerable to nutrients flowing from rivers into the sea lawrence 1997 because of the rapid development of coastal cities frequent human activities have greatly accelerated the flow of nutrients into the estuarine and coastal marine ecosystems and have led to the deterioration of water quality in estuary ecosystems handler et al 2006 bugica et al 2020 sun et al 2020 a water quality prediction model for estuaries can provide early warning information for the prevention of disasters in coastal ecosystems therefore establish an estuarine water quality model is essential for water security in coastal areas muller and muller 2015 alizadeh et al 2018 the traditional mechanical model of water quality is based on a physical model or a data driven model nguyen et al 2018 because mechanical models can effectively reproduce the physical process of water quality transport they are widely used to explore the migration and transformation mechanism of water quality chen et al 2018 plew et al 2018 huang et al 2019 nevertheless there are still many deficiencies in the application of mechanical models to water quality prediction and they require numerous observation data and substantial time to calibrate and verify the model parameters in recent years because data driven models can obtain satisfactory results with less time and cost in various water quality prediction applications many researchers have gradually adopted them for water quality prediction aboodi 2017 khadr and elshemy 2017 shaban and farag 2018 data driven methods are divided into two categories traditional statistics based models and emerging machine learning ml models solomatine and ostfeld 2008 most conventional statistics based models usually assume that the relationship between features is linear and normally distributed gardner and dorling 1998 however many water quality variables such as dissolved oxygen nutrients chlorophyll a and turbidity undergo large time fluctuations in the estuarine environment resulting in non normal distributions and nonlinear relationships boyer et al 2000 ortega et al 2009 muller and muller 2014 it is difficult to capture nonlinear relationships between the variables in processes of predicting water quality by using traditional statistical methods li et al 2021 in recent years water resources managers and environmental scientists have begun to develop ml hydrological models to create new methods to predict environmental variables zhou et al 2020 fan et al 2021 zhi et al 2021 ml can capture nonlinear relationships between features and accurately analyze the influencing factors with a simple modeling process without the need to understand the underlying physical process rajaee et al 2020 although all types of ml methods have advantages and disadvantages according to the no free lunch theorem wolpert 1996 no ml model is the best method to solve all engineering problems successfully consequently using multiple ml models to predict water quality may be a better approach than using a single model although many studies of water quality prediction studies alizadeh et al 2018 hu et al 2019 noori et al 2020 deng et al 2021 have achieved satisfactory prediction results they have not explained the effect of each input variable on the model output in other words most ml algorithms are of the black box type therefore many water environment scientists are reluctant to adopt these models nearing et al 2020 recently outstanding progress has been made in the field of interpreting ml algorithms shapely additive explanations shap which originated from game theory štrumbelj and kononenko 2014 can study a single prediction as an additional combination of the influence of each input variable on the output value the predicted value so that the user can understand the extent to which each input variable affects the output value and how it affects the output value lundberg and lee 2017 broeck et al 2021 shap has been successfully applied in many fields wang et al 2021a b wen et al 2021 yang et al 2021 however in the field of water environment research few studies have used interpretable ml to predict estuarine water quality in this study xiaoqing river is selected as the research object xiaoqing river basin is a typical comprehensive area with the development of industry agriculture and urbanization in china wang et al 2019 the upper reaches of xiaoqing river are a typical urbanization area in jinan city the middle reaches gather many industrial sewage enterprises and the lower reaches is the oil base and salt farm with the prosperity and development of economy and the acceleration of urbanization in the xiaoqing river basin the trunk and tributaries of the xiaoqing river have accepted the discharge of many pollutants from point pollution sources such as industrial production and area pollution sources such as agricultural production and gradually become a sewage river it not only affects the economic production activities such as farmland irrigation industrial production and aquaculture in the basin and it has a negative impact on the sustainable development of laizhou bay and its surrounding areas fan et al 2017 the aim of this study was to develop a model to predict estuarine water quality parameters by using monitoring data of the upstream river thereby providing early warning for the prevention of serious disasters in coastal ecosystems by enabling necessary actions to be taken in advance specifically this study had two objectives 1 to evaluate the effectiveness of four ml models multiple linear regression mlr artificial neural networks ann random forest rf and extreme gradient boosting xgboost for predicting estuarine ammonia nitrogen nh4 n at a monthly timescale in the xiaoqing river estuary china 2 to use shap to interpret ml models and understand which input variables have a greater impact on estuarine water quality and how they affect the water quality 2 material and methods 2 1 study area the xiaoqing river 237 km is in the middle of shandong province china fig 1 it originates in jinan city and finally discharges into the laizhou bay jiang et al 2017 the xiaoqing river basin is characterized by a temperate continental climate annual precipitation ranges from 500 to 800 mm but about 85 of the annual precipitation is in summer the zonal vegetation in the xiaoqing river basin is mainly deciduous broad leaved forest and mixed with temperate coniferous forest the soil is mainly cinnamon soil and fluvo aquic soil among the types of land use cultivated land accounts for 63 2 forest land accounts for 9 5 and grassland accounts for 7 7 cultivated land is widely distributed in the basin especially in the north central and eastern regions while woodland and grassland are mainly distributed in the southern mountains the isoline of inorganic nitrogen concentration formed in the sea area of laizhou bay is tongue shaped along the axis of the xiaoqing river estuary indicating that xiaoqing river is the primary source of the inorganic nitrogen pollution in laizhou bay the xiaoqing river and its tributaries receive many pollutants from point sources such as industrial production and nonpoint sources such as agricultural production which adversely affect the sustainable development of the laizhou bay and its surrounding areas jiao et al 2017 therefore water quality prediction in the xiaoqing estuary plays an important role in improving the aquatic ecological environment of laizhou bay nh4 n is an important component of inorganic nitrogen that can cause water blackening and other water quality deterioration problems adams et al 2019 in china nh4 n is one of the most concerning water pollutants 2 2 data the monthly nh4 n monitoring data of xiaoqing river from 2009 to 2018 collected by the environmental protection department of shandong province were used in this study when lead time was 0 month the dependent variable was the nh4 n concentrations measured at the yangkou s8 station and the independent variables were the monthly nh4 n concentrations at seven monitoring stations huixiangdian s1 damatou s2 xinfengzhuang s3 weiqiao s4 jinjiazha s5 shicun s6 and sanchakou s7 in the upper reaches of the river fig 1 with prediction lead times of 1 month and 2 months the dependent variable was the future s8 nh4 n and the independent variables were the s1 s8 nh4 n the dataset contains 824 records it was randomly divided into a training set and test set containing 618 and 206 samples respectively 2 3 methods and implementation four models were developed to predict estuarine nh4 n a schematic diagram of this approach is shown in fig 2 2 3 1 multiple linear regression mlr mlr is a simple and conventional algorithm used in ml its principle is simple and the algorithm runs stably although the principle of linear regression is simple it is still one of the most widely used models in industry the general form of mlr is as follows 1 y a 0 a 1 x 1 a 2 x 2 a i x i where a 1 a 2 a i are i unknown parameters and a 0 is a random error y is the output variable and x 1 x 2 x i reflect all the input variables in this study mlr was used to determine the influence of two or more independent variables on the quantitative variation of a dependent variable 2 3 2 artificial neural networks ann an ann can simulate complex nonlinear relationships by operating with an internal structure similar to that of the human brain lecun et al 2015 it is composed of an input layer a hidden layer and an output layer the main elements of each layer are neurons the input layer is mainly used to import the training data into the model the output layer is used to set training targets for the neural network and the hidden layer performs nonlinear transformation of the data by an activation function an ann uses the error back propagation algorithm to change the weights given to neurons to improve the performance and liveness of the model the overall structure of an ann can be expressed by the following equations 2 z j f i 1 m w ji 1 x i θ j 1 f ne t j j 1 2 l 3 o k g j 1 l w kj 2 z j θ k 2 g ne t k k 1 2 n where θ 1 and θ 2 are the thresholds of neurons in the hidden layer and output layer respectively f and g are the activation functions of the hidden layer and output layer respectively and m l and n are the numbers of nodes in the input layer hidden layer and output layer respectively schematic diagram of ann is shown in fig 3 an ann includes two processes forward propagation of signal and back propagation of error in the process of forward propagation the input signal acts on an output node through the hidden layer and the network output is calculated by using eqs 2 and 3 if the difference error between the actual output and the ideal output is large the error is backpropagated error back propagation is a process in which the output error is transmitted layer by layer to the input layer through the hidden layer the error decreases along the gradient direction by adjusting the weights and thresholds of the input node hidden layer node and output layer node after repeated learning and training the network weight and threshold corresponding to the minimum error are determined and the network stops training 2 3 3 random forest rf rf is an ensemble learning method proposed by breiman 2001 that is composed of a large number of decision trees in the process of forest generation each decision tree uses the method of randomly selecting samples and features to obtain several weak classifiers for local domain learning which are combined into a global strong classifier when the rf solves the classification problem the result is determined by the number of results of each decision tree in contrast when the rf solves the regression problem the result is the average value of each decision tree schematic diagram of rf is shown in fig 4 rf has many advantages it does not suffer from the problem of multivariate collinearity which is a drawback of general regression analysis and there is no need to choose variables it performs well in classification and regression and has a strong ability to handle multidimensional data 2 3 4 extreme gradient boosting xgboost xgboost is an improvement method which differs from the traditional gradient boosting decision tree gbdt chen and guestrin 2016 algorithm the conventional gbdt uses only first order derivative information when optimizing the second taylor expansion is then performed on the loss function and both the first order and second order derivatives are used a regularization term is added to the loss function to control the complexity of the model and prevent the model from overfitting schematic diagram of xgboost is shown in fig 5 the derivation of the xgboost method is as follows 4 y i ϕ x i k 1 k f k x i f k f where f f x w q x q r m t w r t expresses a function space that represents a decision tree and t is the number of leaf nodes of a decision tree the loss function is as follows 5 l ϕ i l y i y i k ω f k 6 ω f γ t 1 2 λ w 2 the first term of the formula in eq 5 penalizes the number of leaves and the second term is the magnitude of the output results thus reducing the variance for each node of the tree xgboost determines whether the new branch is meaningful by calculating gain 7 gain 1 2 gai n l g a i n r g a i n o γ where gain o represents the original gain without branching and γ is the new number of leaves 2 3 5 model evaluation the nash sutcliffe efficiency nse root mean square error rmse and correlation coefficient r were used to evaluate the performance of the four ml models these metrics are defined by the following equations 8 nse 1 i 1 n o i p i 2 i 1 n o i o 2 9 r i 1 n o i o p i p i 1 n o i o 2 i 1 n p i p 2 where o i represents the observed water quality data p i is the value of prediction and o and p denote the mean observed and predicted monthly nh4 n respectively 2 4 shapely additive explanations shap in conventional ml feature importance can only show the degree of influence of input variables on the model output but it fails to show how input variables influence the model output to understand which input variables have a greater impact on the output the water quality of the estuary and how they affect it the shap method was interpreted for ml models lundberg and lee 2017 with input variables x x 1 x p and a trained model f shap can use a model g to determine the contribution of each input variable to model f the model g is defined as follows 11 g z ϕ 0 i 1 q ϕ i t i where q is the number of input variables t is the simplification of the input variable the t value corresponding to the feature used for data prediction is 1 and the t value corresponding to the unused feature is 0 and ϕ i r represents the contribution of each feature to the model the ϕ function is as follows 12 ϕ i f x t x t q t 1 q f t f t i shap can show the influence of each sample feature and show the influence positive or negative of the feature on the model lin and bai 2021 the shap results were derived using the python 3 7 shap package 3 results in this study four ml models mlr ann rf and xgboost were developed to predict the nh4 n concentration at the yangkou s8 monitoring station with lead times ranging from 0 to 2 months the settings for all four models were implemented in the python3 7 scrickit learn package https scikit learn org the values of which can be found in table s1 3 1 results of models table 1 shows the results from using the mlr ann rf and xgboost models to predict nh4 n it is clear from these results that xgboost is superior to other models in all respects for example the nse and r of xgboost are 0 905 and 0 956 respectively which are superior to those of mlr nse 0 819 r 0 908 ann nse 0 836 r 0 916 and rf nse 0 883 r 0 941 during testing with a lead time of 0 months the rmse of xgboost is 1 029 which is smaller than those of mlr 1 148 ann 1 352 and rf 1 141 with a lead time of 0 months notably the results of xgboost are still significantly better than those of the other models with lead times of 1 month and 2 months for xgboost although the nse values of 0 817 and 0 788 indicate that its predictive performance gradually decreases with lead times of 1 month and 2 months the results of mlr nse of 0 760 and 0 617 ann nse of 0 801 and 0 644 and rf nse of 0 779 and 0 718 are slightly inferior for all four models the performance deteriorates gradually as the prediction lead time increases figure 6 shows the predicted results of mlr ann rf and xgboost for lead times of 0 to 2 months on the test set because the curves predicted by xgboost are closer to the observed curves xgboost is slightly better than the other models with respect to its prediction effect fig 6 also shows that the difference between predicted and observed values increases as the lead time increases fig 7 shows a scatter plot of the mlr ann rf and xgboost results during testing in general in fig 7 a scatter distribution close to the regression line corresponds to good prediction performance it is obvious that the scatter distribution of xgboost is closer to the regression line than that of the other models particularly in the case of prediction with a 2 month lead time fig 7 also shows that the difference between the scatter distribution and regression line increases as the lead time increases finally fig 7 shows that several points with observed values lower higher than 4 mg l are significantly above below the regression line indicating a trend of overpredicting low values nh4 n below 4 mg l and underpredicting high values nh4 n above 4 mg l in all models during testing with a lead time of 2 months 3 2 model interpretation because xgboost achieved the best performance in predicting estuarine nh4 n shap was used to interpret xgboost the overall importance of each input variable fig 8 was calculated as the average of the absolute shap values for each variable mangalathu et al 2020 a greater mean shap value corresponds to a greater influence on the output of the model it can be clearly observed from fig 8a that s5 s6 and s7 all have a large influence on the output of the model for a lead time of 0 months however for a lead time of 1 or 2 months s7 has the greatest impact on the output fig 8b and c we present the input variables and further visualize their associations with estuarine nh4 n in fig 9 by using a shap summary plot for a lead time of 0 months fig 9a shows s5 to be the largest affecting the estuarine nh4 n followed by s6 and s7 a greater value of s5 has a higher shap value with a larger positive impact on estuarine nh4 n s6 and s7 are the next most critical factors where an increase in s6 corresponds to an increase in potential impact on estuarine water quality whereas only large values of s7 are strongly positively correlated with estuarine water quality fig 9b shows that with a lead time of 1 month s7 and s6 are the stations that most affect estuarine nh4 n followed by s8 and s2 of these when the value of s7 is larger it is strongly correlated with s8 that is a decrease in s7 also implies an increase in the next month s estuarine nh4 n the influence of s6 on s8 in the next month is second to that of s7 fig 9c shows that with a lead time of 2 months greater values of s7 correspond to higher estuarine nh4 n in summary it is obvious from figs 8 and 9 that nh4 n in the upper reaches affects estuarine nh4 n the shap dependence for xgboost is plotted in fig 10 showing how the shap value of an input variable varies with the input variable s value fig 10 provides a deeper understanding of the distribution and change of shap with input variables mangalathu et al 2020 fig 10a shows that when both s6 and s7 are less than 5 the shap value of s7 is very small and negative indicating that the effect on the change of nh4 n in the estuary is small when s6 and s7 are both greater than 8 s7 has an obvious positive effect on the change of nh4 n fig 10d shows that when both s7 and s8 are less than 4 s7 has a negative shap value this shows that when the nh4 n of s7 and s8 is less than 4 mg l the nh4 n in the estuary will be reduced next month which plays a role in improving the water quality of the estuary in contrast when the values of s7 and s8 are greater than 8 mg l the shap value of s7 is large indicating that the nh4 n concentration in the estuary will be very high in the next month in summary reducing the value of nh4 n at the s6 and s7 stations sufficiently early is helpful for alleviating excessive nh4 n in the estuary in particular constraining shicun s6 and sanchakou s7 to remain below 2 mg l is beneficial for reducing the value of nh4 n in the estuary 4 discussion through figs 6 and 7 we observed the different prediction performance of different ml models from the same large dataset mlr achieved a lower prediction accuracy than the other models ann rf and xgboost this may be because there is a strong nonlinear relationship between the input variables upstream nh4 n and output variable nh4 n in the estuary mlr can handle and capture only linear relationships between variables adamowski et al 2012 whereas ann rf and xgboost can also capture nonlinear relationships between variables according to the comparison of prediction results table 1 xgboost performed best followed by rf ann and mlr considering the application of the models to estuarine nh4 n prediction the performance of xgboost as a prediction model proved to be satisfactory the reason may be that the four learning models have different internal structures tiyasha et al 2021 and the internal structure of xgboost is the most suitable for this dataset the results table 1 of the four models all show that prediction accuracy rapidly declined as the predictive period was extended from 0 months to 2 months nse of mlr 0 819 0 617 nse of ann 0 836 0 644 nse of rf 0 883 0 718 nse of xgboost 0 905 0 788 these results are consistent with those of deng et al 2021 who predicted coastal water quality using ann and svm the time series of nh4 n has strong autocorrelation when the predictive period is short and nh4 n in the upper reaches plays a key role in the prediction of estuarine nh4 n zhou et al 2020 because upstream nh4 n generally has a simple linear relationship with estuarine nh4 n when the predictive lead time is short mlr is able to predict estuarine nh4 n accordingly there is no significant difference between the prediction effects of the different models with a lead time of 0 months the autocorrelation of the nh4 n series rapidly weakens as the lead time is extended and the correlation between estuarine and upstream nh4 n becomes complex and nonlinear maheswaran and khosa 2013 alizadeh et al 2018 and zhou et al 2020 in their study of the prediction of estuarine salinity found that the nonlinearity and complexity between features increases as the lead time is extended it is possible to obtain more data through a variety of technologies or use wavelet based models to enhance the robustness of the model and thereby improve the model s predictive performance quilty et al 2019 quilty and adamowski 2020 the shap plots figs 8 10 show the relationship between water quality at each upstream channel monitoring station and the estuarine water quality with a prediction lead time of 0 months s5 s7 and s6 affect the nh4 n in the estuary most figs 9 and 10 followed by s4 and s2 as fig 1 clearly shows the three stations that have the greatest impact on s8 are also the closest to the s8 station however according to the shap analysis although the s5 station is not the closest to the s8 station the water quality data of s5 has the greatest impact on the estuary the reasons may be as follows in fig 11 the differences between the monitoring data of the four stations are not obvious in the early stage however in the medium stage the values of s5 and s8 are generally higher than those of s6 and s7 this may be because there are more tributaries flowing into the s5 s6 s7 s8 reach and the treatment of pollutants near the s5 s7 reach is better than that upstream of s5 and in the s7 s8 reach furthermore in the medium stage the correlation between the values of s5 and s8 is strong which is regarded as a coincidence however in the later stage the treatment of pollution sources upstream of s5 and s8 has been strengthened and the difference between the four sites has been gradually reduced in summary the combination of shap and fig 11 shows that people have achieved satisfactory results in the sewage treatment of the xiaoqing river basin for many years with prediction lead times of 1 month and 2 months because s7 and s6 are closer to s8 fig 1 fig 9b and 9c show that these two stations have the greatest impact on s8 a high value of s7 predicts a greater threat to s8 in the future this is because the tidal reaches of the xiaoqing river extend from s6 to the estuary huang et al 2012 in addition there are two sewage draining exits qilu ethylene chemical outlet and bamianhe oilfield outlet in the s7 s8 reach li et al 2020 the tidal reach contains many pollutants from upstream and sewage draining exits this pollution is supported by the tide of the sea which lengthens the retention time of pollutants in the river so that the pollutants retained at s7 have a greater impact on s8 in the future therefore the water quality treatment of the s8 upper reaches should be strengthened to improve the ecological safety of the estuary water quality and the ecologically sustainable development of laizhou bay 5 conclusions in this study four ml models were implemented to predict monthly nh4 n in the xiaoqing river estuary china using shap to interpret the ml model it is no longer a black box the relationship between the water quality at each upstream channel monitoring station and the estuarine water quality can be understood the main conclusions reached are as follows 1 as the structure and data series of mlr ann rf and xgboost models are diverse it will lead to different predictions with respect to the model applicability the latter three models can provide reliable prediction of estuarine water quality for this case since the three models are enough to capture the nonlinear relationship between variables indicating a strong nonlinear relationship between nh4 n in the estuary and nh4 n in the upstream channel 2 shap helped us to understand the magnitude and direction of the influence of input variables on the output variable in recent years great progress has been made in the water treatment of xiaoqing river and timely water treatment shicun s6 and sanchakou s7 in the upper reaches of the estuary has proved to be conducive to improving the water ecological security of the estuary according to the shap analysis if the values of shicun s6 and sanchakou s7 are constrained to be below 2 mg l estuarine water quality will be improved because this study mainly focused on the prediction of nh4 n in the xiaoqing river estuary using shap for model interpretation it had more explanatory power than previous studies using ml alizadeh et al 2018 muller and muller 2015 zhou et al 2020 the results of this study can also aid the pollution warning for estuarine water quality and the integrated environmental management of the river and costal area to obtain higher precision of long term nh4 n prediction further research is needed for example this model could be extended to include the impacts of climate and human activities among its input variables in addition because of various uncertainties such as errors in input monitoring data model structure and model parameters certainty and uncertainty prediction are worthy of attention further research should attempt to obtain abundant data or incorporate a mechanical model such as swat or efdc to include the physical mechanism in the ml model and thereby make it more explanatory shen 2018 jiang et al 2020 shap has been proved to be an important development in the field of ml model interpretation mangalathu et al 2020 lin et al 2021 we believe that using shap for ml in water quality research is a promising new direction credit authorship contribution statement shuo wang methodology writing visualization hui peng conceptualization supervision shengkang liang resources declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments this study was financially supported by programs of the national natural science foundation of china u1906215 41731280 we thank liwen bianji edanz www liwenbianji cn for editing the english text of a draft of this manuscript appendix a supplementary data supplementary data to this article can be found online at https doi org 10 1016 j jhydrol 2021 127320 appendix a supplementary data the following are the supplementary data to this article supplementary data 1 
3746,estuaries are principal sources of pollution in coastal areas estuarine water quality prediction models can provide early warnings to prevent major disasters in coastal ecosystems in this study several machine learning models multiple linear regression artificial neural networks random forest and extreme gradient boosting xgboost were developed to predict nh4 n in the xiaoqing river estuary china the results show that there is a strong nonlinear relationship between estuarine nh4 n and nh4 n of the upper reaches the shapely additive explanations method was used to interpret the xgboost model and discover the influence of the upper reaches of the river on the estuary these explanations showed that two stations monitoring water quality in the upper reaches shicun and sanchakou had a critical impact on estuarine water quality if nh4 n concentration of the upper reaches is below 2 mg l estuarine nh4 n would not be negatively influenced by the upper reaches these results can support pollution warnings for improving estuarine water quality and the integrated environmental management of the river and costal area keywords ammonia nitrogen prediction machine learning shapely additive explanations xiaoqing river estuary 1 introduction an estuary is an intersection of coastal and terrestrial waters estuaries and inshore waters are particularly vulnerable to nutrients flowing from rivers into the sea lawrence 1997 because of the rapid development of coastal cities frequent human activities have greatly accelerated the flow of nutrients into the estuarine and coastal marine ecosystems and have led to the deterioration of water quality in estuary ecosystems handler et al 2006 bugica et al 2020 sun et al 2020 a water quality prediction model for estuaries can provide early warning information for the prevention of disasters in coastal ecosystems therefore establish an estuarine water quality model is essential for water security in coastal areas muller and muller 2015 alizadeh et al 2018 the traditional mechanical model of water quality is based on a physical model or a data driven model nguyen et al 2018 because mechanical models can effectively reproduce the physical process of water quality transport they are widely used to explore the migration and transformation mechanism of water quality chen et al 2018 plew et al 2018 huang et al 2019 nevertheless there are still many deficiencies in the application of mechanical models to water quality prediction and they require numerous observation data and substantial time to calibrate and verify the model parameters in recent years because data driven models can obtain satisfactory results with less time and cost in various water quality prediction applications many researchers have gradually adopted them for water quality prediction aboodi 2017 khadr and elshemy 2017 shaban and farag 2018 data driven methods are divided into two categories traditional statistics based models and emerging machine learning ml models solomatine and ostfeld 2008 most conventional statistics based models usually assume that the relationship between features is linear and normally distributed gardner and dorling 1998 however many water quality variables such as dissolved oxygen nutrients chlorophyll a and turbidity undergo large time fluctuations in the estuarine environment resulting in non normal distributions and nonlinear relationships boyer et al 2000 ortega et al 2009 muller and muller 2014 it is difficult to capture nonlinear relationships between the variables in processes of predicting water quality by using traditional statistical methods li et al 2021 in recent years water resources managers and environmental scientists have begun to develop ml hydrological models to create new methods to predict environmental variables zhou et al 2020 fan et al 2021 zhi et al 2021 ml can capture nonlinear relationships between features and accurately analyze the influencing factors with a simple modeling process without the need to understand the underlying physical process rajaee et al 2020 although all types of ml methods have advantages and disadvantages according to the no free lunch theorem wolpert 1996 no ml model is the best method to solve all engineering problems successfully consequently using multiple ml models to predict water quality may be a better approach than using a single model although many studies of water quality prediction studies alizadeh et al 2018 hu et al 2019 noori et al 2020 deng et al 2021 have achieved satisfactory prediction results they have not explained the effect of each input variable on the model output in other words most ml algorithms are of the black box type therefore many water environment scientists are reluctant to adopt these models nearing et al 2020 recently outstanding progress has been made in the field of interpreting ml algorithms shapely additive explanations shap which originated from game theory štrumbelj and kononenko 2014 can study a single prediction as an additional combination of the influence of each input variable on the output value the predicted value so that the user can understand the extent to which each input variable affects the output value and how it affects the output value lundberg and lee 2017 broeck et al 2021 shap has been successfully applied in many fields wang et al 2021a b wen et al 2021 yang et al 2021 however in the field of water environment research few studies have used interpretable ml to predict estuarine water quality in this study xiaoqing river is selected as the research object xiaoqing river basin is a typical comprehensive area with the development of industry agriculture and urbanization in china wang et al 2019 the upper reaches of xiaoqing river are a typical urbanization area in jinan city the middle reaches gather many industrial sewage enterprises and the lower reaches is the oil base and salt farm with the prosperity and development of economy and the acceleration of urbanization in the xiaoqing river basin the trunk and tributaries of the xiaoqing river have accepted the discharge of many pollutants from point pollution sources such as industrial production and area pollution sources such as agricultural production and gradually become a sewage river it not only affects the economic production activities such as farmland irrigation industrial production and aquaculture in the basin and it has a negative impact on the sustainable development of laizhou bay and its surrounding areas fan et al 2017 the aim of this study was to develop a model to predict estuarine water quality parameters by using monitoring data of the upstream river thereby providing early warning for the prevention of serious disasters in coastal ecosystems by enabling necessary actions to be taken in advance specifically this study had two objectives 1 to evaluate the effectiveness of four ml models multiple linear regression mlr artificial neural networks ann random forest rf and extreme gradient boosting xgboost for predicting estuarine ammonia nitrogen nh4 n at a monthly timescale in the xiaoqing river estuary china 2 to use shap to interpret ml models and understand which input variables have a greater impact on estuarine water quality and how they affect the water quality 2 material and methods 2 1 study area the xiaoqing river 237 km is in the middle of shandong province china fig 1 it originates in jinan city and finally discharges into the laizhou bay jiang et al 2017 the xiaoqing river basin is characterized by a temperate continental climate annual precipitation ranges from 500 to 800 mm but about 85 of the annual precipitation is in summer the zonal vegetation in the xiaoqing river basin is mainly deciduous broad leaved forest and mixed with temperate coniferous forest the soil is mainly cinnamon soil and fluvo aquic soil among the types of land use cultivated land accounts for 63 2 forest land accounts for 9 5 and grassland accounts for 7 7 cultivated land is widely distributed in the basin especially in the north central and eastern regions while woodland and grassland are mainly distributed in the southern mountains the isoline of inorganic nitrogen concentration formed in the sea area of laizhou bay is tongue shaped along the axis of the xiaoqing river estuary indicating that xiaoqing river is the primary source of the inorganic nitrogen pollution in laizhou bay the xiaoqing river and its tributaries receive many pollutants from point sources such as industrial production and nonpoint sources such as agricultural production which adversely affect the sustainable development of the laizhou bay and its surrounding areas jiao et al 2017 therefore water quality prediction in the xiaoqing estuary plays an important role in improving the aquatic ecological environment of laizhou bay nh4 n is an important component of inorganic nitrogen that can cause water blackening and other water quality deterioration problems adams et al 2019 in china nh4 n is one of the most concerning water pollutants 2 2 data the monthly nh4 n monitoring data of xiaoqing river from 2009 to 2018 collected by the environmental protection department of shandong province were used in this study when lead time was 0 month the dependent variable was the nh4 n concentrations measured at the yangkou s8 station and the independent variables were the monthly nh4 n concentrations at seven monitoring stations huixiangdian s1 damatou s2 xinfengzhuang s3 weiqiao s4 jinjiazha s5 shicun s6 and sanchakou s7 in the upper reaches of the river fig 1 with prediction lead times of 1 month and 2 months the dependent variable was the future s8 nh4 n and the independent variables were the s1 s8 nh4 n the dataset contains 824 records it was randomly divided into a training set and test set containing 618 and 206 samples respectively 2 3 methods and implementation four models were developed to predict estuarine nh4 n a schematic diagram of this approach is shown in fig 2 2 3 1 multiple linear regression mlr mlr is a simple and conventional algorithm used in ml its principle is simple and the algorithm runs stably although the principle of linear regression is simple it is still one of the most widely used models in industry the general form of mlr is as follows 1 y a 0 a 1 x 1 a 2 x 2 a i x i where a 1 a 2 a i are i unknown parameters and a 0 is a random error y is the output variable and x 1 x 2 x i reflect all the input variables in this study mlr was used to determine the influence of two or more independent variables on the quantitative variation of a dependent variable 2 3 2 artificial neural networks ann an ann can simulate complex nonlinear relationships by operating with an internal structure similar to that of the human brain lecun et al 2015 it is composed of an input layer a hidden layer and an output layer the main elements of each layer are neurons the input layer is mainly used to import the training data into the model the output layer is used to set training targets for the neural network and the hidden layer performs nonlinear transformation of the data by an activation function an ann uses the error back propagation algorithm to change the weights given to neurons to improve the performance and liveness of the model the overall structure of an ann can be expressed by the following equations 2 z j f i 1 m w ji 1 x i θ j 1 f ne t j j 1 2 l 3 o k g j 1 l w kj 2 z j θ k 2 g ne t k k 1 2 n where θ 1 and θ 2 are the thresholds of neurons in the hidden layer and output layer respectively f and g are the activation functions of the hidden layer and output layer respectively and m l and n are the numbers of nodes in the input layer hidden layer and output layer respectively schematic diagram of ann is shown in fig 3 an ann includes two processes forward propagation of signal and back propagation of error in the process of forward propagation the input signal acts on an output node through the hidden layer and the network output is calculated by using eqs 2 and 3 if the difference error between the actual output and the ideal output is large the error is backpropagated error back propagation is a process in which the output error is transmitted layer by layer to the input layer through the hidden layer the error decreases along the gradient direction by adjusting the weights and thresholds of the input node hidden layer node and output layer node after repeated learning and training the network weight and threshold corresponding to the minimum error are determined and the network stops training 2 3 3 random forest rf rf is an ensemble learning method proposed by breiman 2001 that is composed of a large number of decision trees in the process of forest generation each decision tree uses the method of randomly selecting samples and features to obtain several weak classifiers for local domain learning which are combined into a global strong classifier when the rf solves the classification problem the result is determined by the number of results of each decision tree in contrast when the rf solves the regression problem the result is the average value of each decision tree schematic diagram of rf is shown in fig 4 rf has many advantages it does not suffer from the problem of multivariate collinearity which is a drawback of general regression analysis and there is no need to choose variables it performs well in classification and regression and has a strong ability to handle multidimensional data 2 3 4 extreme gradient boosting xgboost xgboost is an improvement method which differs from the traditional gradient boosting decision tree gbdt chen and guestrin 2016 algorithm the conventional gbdt uses only first order derivative information when optimizing the second taylor expansion is then performed on the loss function and both the first order and second order derivatives are used a regularization term is added to the loss function to control the complexity of the model and prevent the model from overfitting schematic diagram of xgboost is shown in fig 5 the derivation of the xgboost method is as follows 4 y i ϕ x i k 1 k f k x i f k f where f f x w q x q r m t w r t expresses a function space that represents a decision tree and t is the number of leaf nodes of a decision tree the loss function is as follows 5 l ϕ i l y i y i k ω f k 6 ω f γ t 1 2 λ w 2 the first term of the formula in eq 5 penalizes the number of leaves and the second term is the magnitude of the output results thus reducing the variance for each node of the tree xgboost determines whether the new branch is meaningful by calculating gain 7 gain 1 2 gai n l g a i n r g a i n o γ where gain o represents the original gain without branching and γ is the new number of leaves 2 3 5 model evaluation the nash sutcliffe efficiency nse root mean square error rmse and correlation coefficient r were used to evaluate the performance of the four ml models these metrics are defined by the following equations 8 nse 1 i 1 n o i p i 2 i 1 n o i o 2 9 r i 1 n o i o p i p i 1 n o i o 2 i 1 n p i p 2 where o i represents the observed water quality data p i is the value of prediction and o and p denote the mean observed and predicted monthly nh4 n respectively 2 4 shapely additive explanations shap in conventional ml feature importance can only show the degree of influence of input variables on the model output but it fails to show how input variables influence the model output to understand which input variables have a greater impact on the output the water quality of the estuary and how they affect it the shap method was interpreted for ml models lundberg and lee 2017 with input variables x x 1 x p and a trained model f shap can use a model g to determine the contribution of each input variable to model f the model g is defined as follows 11 g z ϕ 0 i 1 q ϕ i t i where q is the number of input variables t is the simplification of the input variable the t value corresponding to the feature used for data prediction is 1 and the t value corresponding to the unused feature is 0 and ϕ i r represents the contribution of each feature to the model the ϕ function is as follows 12 ϕ i f x t x t q t 1 q f t f t i shap can show the influence of each sample feature and show the influence positive or negative of the feature on the model lin and bai 2021 the shap results were derived using the python 3 7 shap package 3 results in this study four ml models mlr ann rf and xgboost were developed to predict the nh4 n concentration at the yangkou s8 monitoring station with lead times ranging from 0 to 2 months the settings for all four models were implemented in the python3 7 scrickit learn package https scikit learn org the values of which can be found in table s1 3 1 results of models table 1 shows the results from using the mlr ann rf and xgboost models to predict nh4 n it is clear from these results that xgboost is superior to other models in all respects for example the nse and r of xgboost are 0 905 and 0 956 respectively which are superior to those of mlr nse 0 819 r 0 908 ann nse 0 836 r 0 916 and rf nse 0 883 r 0 941 during testing with a lead time of 0 months the rmse of xgboost is 1 029 which is smaller than those of mlr 1 148 ann 1 352 and rf 1 141 with a lead time of 0 months notably the results of xgboost are still significantly better than those of the other models with lead times of 1 month and 2 months for xgboost although the nse values of 0 817 and 0 788 indicate that its predictive performance gradually decreases with lead times of 1 month and 2 months the results of mlr nse of 0 760 and 0 617 ann nse of 0 801 and 0 644 and rf nse of 0 779 and 0 718 are slightly inferior for all four models the performance deteriorates gradually as the prediction lead time increases figure 6 shows the predicted results of mlr ann rf and xgboost for lead times of 0 to 2 months on the test set because the curves predicted by xgboost are closer to the observed curves xgboost is slightly better than the other models with respect to its prediction effect fig 6 also shows that the difference between predicted and observed values increases as the lead time increases fig 7 shows a scatter plot of the mlr ann rf and xgboost results during testing in general in fig 7 a scatter distribution close to the regression line corresponds to good prediction performance it is obvious that the scatter distribution of xgboost is closer to the regression line than that of the other models particularly in the case of prediction with a 2 month lead time fig 7 also shows that the difference between the scatter distribution and regression line increases as the lead time increases finally fig 7 shows that several points with observed values lower higher than 4 mg l are significantly above below the regression line indicating a trend of overpredicting low values nh4 n below 4 mg l and underpredicting high values nh4 n above 4 mg l in all models during testing with a lead time of 2 months 3 2 model interpretation because xgboost achieved the best performance in predicting estuarine nh4 n shap was used to interpret xgboost the overall importance of each input variable fig 8 was calculated as the average of the absolute shap values for each variable mangalathu et al 2020 a greater mean shap value corresponds to a greater influence on the output of the model it can be clearly observed from fig 8a that s5 s6 and s7 all have a large influence on the output of the model for a lead time of 0 months however for a lead time of 1 or 2 months s7 has the greatest impact on the output fig 8b and c we present the input variables and further visualize their associations with estuarine nh4 n in fig 9 by using a shap summary plot for a lead time of 0 months fig 9a shows s5 to be the largest affecting the estuarine nh4 n followed by s6 and s7 a greater value of s5 has a higher shap value with a larger positive impact on estuarine nh4 n s6 and s7 are the next most critical factors where an increase in s6 corresponds to an increase in potential impact on estuarine water quality whereas only large values of s7 are strongly positively correlated with estuarine water quality fig 9b shows that with a lead time of 1 month s7 and s6 are the stations that most affect estuarine nh4 n followed by s8 and s2 of these when the value of s7 is larger it is strongly correlated with s8 that is a decrease in s7 also implies an increase in the next month s estuarine nh4 n the influence of s6 on s8 in the next month is second to that of s7 fig 9c shows that with a lead time of 2 months greater values of s7 correspond to higher estuarine nh4 n in summary it is obvious from figs 8 and 9 that nh4 n in the upper reaches affects estuarine nh4 n the shap dependence for xgboost is plotted in fig 10 showing how the shap value of an input variable varies with the input variable s value fig 10 provides a deeper understanding of the distribution and change of shap with input variables mangalathu et al 2020 fig 10a shows that when both s6 and s7 are less than 5 the shap value of s7 is very small and negative indicating that the effect on the change of nh4 n in the estuary is small when s6 and s7 are both greater than 8 s7 has an obvious positive effect on the change of nh4 n fig 10d shows that when both s7 and s8 are less than 4 s7 has a negative shap value this shows that when the nh4 n of s7 and s8 is less than 4 mg l the nh4 n in the estuary will be reduced next month which plays a role in improving the water quality of the estuary in contrast when the values of s7 and s8 are greater than 8 mg l the shap value of s7 is large indicating that the nh4 n concentration in the estuary will be very high in the next month in summary reducing the value of nh4 n at the s6 and s7 stations sufficiently early is helpful for alleviating excessive nh4 n in the estuary in particular constraining shicun s6 and sanchakou s7 to remain below 2 mg l is beneficial for reducing the value of nh4 n in the estuary 4 discussion through figs 6 and 7 we observed the different prediction performance of different ml models from the same large dataset mlr achieved a lower prediction accuracy than the other models ann rf and xgboost this may be because there is a strong nonlinear relationship between the input variables upstream nh4 n and output variable nh4 n in the estuary mlr can handle and capture only linear relationships between variables adamowski et al 2012 whereas ann rf and xgboost can also capture nonlinear relationships between variables according to the comparison of prediction results table 1 xgboost performed best followed by rf ann and mlr considering the application of the models to estuarine nh4 n prediction the performance of xgboost as a prediction model proved to be satisfactory the reason may be that the four learning models have different internal structures tiyasha et al 2021 and the internal structure of xgboost is the most suitable for this dataset the results table 1 of the four models all show that prediction accuracy rapidly declined as the predictive period was extended from 0 months to 2 months nse of mlr 0 819 0 617 nse of ann 0 836 0 644 nse of rf 0 883 0 718 nse of xgboost 0 905 0 788 these results are consistent with those of deng et al 2021 who predicted coastal water quality using ann and svm the time series of nh4 n has strong autocorrelation when the predictive period is short and nh4 n in the upper reaches plays a key role in the prediction of estuarine nh4 n zhou et al 2020 because upstream nh4 n generally has a simple linear relationship with estuarine nh4 n when the predictive lead time is short mlr is able to predict estuarine nh4 n accordingly there is no significant difference between the prediction effects of the different models with a lead time of 0 months the autocorrelation of the nh4 n series rapidly weakens as the lead time is extended and the correlation between estuarine and upstream nh4 n becomes complex and nonlinear maheswaran and khosa 2013 alizadeh et al 2018 and zhou et al 2020 in their study of the prediction of estuarine salinity found that the nonlinearity and complexity between features increases as the lead time is extended it is possible to obtain more data through a variety of technologies or use wavelet based models to enhance the robustness of the model and thereby improve the model s predictive performance quilty et al 2019 quilty and adamowski 2020 the shap plots figs 8 10 show the relationship between water quality at each upstream channel monitoring station and the estuarine water quality with a prediction lead time of 0 months s5 s7 and s6 affect the nh4 n in the estuary most figs 9 and 10 followed by s4 and s2 as fig 1 clearly shows the three stations that have the greatest impact on s8 are also the closest to the s8 station however according to the shap analysis although the s5 station is not the closest to the s8 station the water quality data of s5 has the greatest impact on the estuary the reasons may be as follows in fig 11 the differences between the monitoring data of the four stations are not obvious in the early stage however in the medium stage the values of s5 and s8 are generally higher than those of s6 and s7 this may be because there are more tributaries flowing into the s5 s6 s7 s8 reach and the treatment of pollutants near the s5 s7 reach is better than that upstream of s5 and in the s7 s8 reach furthermore in the medium stage the correlation between the values of s5 and s8 is strong which is regarded as a coincidence however in the later stage the treatment of pollution sources upstream of s5 and s8 has been strengthened and the difference between the four sites has been gradually reduced in summary the combination of shap and fig 11 shows that people have achieved satisfactory results in the sewage treatment of the xiaoqing river basin for many years with prediction lead times of 1 month and 2 months because s7 and s6 are closer to s8 fig 1 fig 9b and 9c show that these two stations have the greatest impact on s8 a high value of s7 predicts a greater threat to s8 in the future this is because the tidal reaches of the xiaoqing river extend from s6 to the estuary huang et al 2012 in addition there are two sewage draining exits qilu ethylene chemical outlet and bamianhe oilfield outlet in the s7 s8 reach li et al 2020 the tidal reach contains many pollutants from upstream and sewage draining exits this pollution is supported by the tide of the sea which lengthens the retention time of pollutants in the river so that the pollutants retained at s7 have a greater impact on s8 in the future therefore the water quality treatment of the s8 upper reaches should be strengthened to improve the ecological safety of the estuary water quality and the ecologically sustainable development of laizhou bay 5 conclusions in this study four ml models were implemented to predict monthly nh4 n in the xiaoqing river estuary china using shap to interpret the ml model it is no longer a black box the relationship between the water quality at each upstream channel monitoring station and the estuarine water quality can be understood the main conclusions reached are as follows 1 as the structure and data series of mlr ann rf and xgboost models are diverse it will lead to different predictions with respect to the model applicability the latter three models can provide reliable prediction of estuarine water quality for this case since the three models are enough to capture the nonlinear relationship between variables indicating a strong nonlinear relationship between nh4 n in the estuary and nh4 n in the upstream channel 2 shap helped us to understand the magnitude and direction of the influence of input variables on the output variable in recent years great progress has been made in the water treatment of xiaoqing river and timely water treatment shicun s6 and sanchakou s7 in the upper reaches of the estuary has proved to be conducive to improving the water ecological security of the estuary according to the shap analysis if the values of shicun s6 and sanchakou s7 are constrained to be below 2 mg l estuarine water quality will be improved because this study mainly focused on the prediction of nh4 n in the xiaoqing river estuary using shap for model interpretation it had more explanatory power than previous studies using ml alizadeh et al 2018 muller and muller 2015 zhou et al 2020 the results of this study can also aid the pollution warning for estuarine water quality and the integrated environmental management of the river and costal area to obtain higher precision of long term nh4 n prediction further research is needed for example this model could be extended to include the impacts of climate and human activities among its input variables in addition because of various uncertainties such as errors in input monitoring data model structure and model parameters certainty and uncertainty prediction are worthy of attention further research should attempt to obtain abundant data or incorporate a mechanical model such as swat or efdc to include the physical mechanism in the ml model and thereby make it more explanatory shen 2018 jiang et al 2020 shap has been proved to be an important development in the field of ml model interpretation mangalathu et al 2020 lin et al 2021 we believe that using shap for ml in water quality research is a promising new direction credit authorship contribution statement shuo wang methodology writing visualization hui peng conceptualization supervision shengkang liang resources declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments this study was financially supported by programs of the national natural science foundation of china u1906215 41731280 we thank liwen bianji edanz www liwenbianji cn for editing the english text of a draft of this manuscript appendix a supplementary data supplementary data to this article can be found online at https doi org 10 1016 j jhydrol 2021 127320 appendix a supplementary data the following are the supplementary data to this article supplementary data 1 
3747,dissolved organic carbon doc is an important fraction of organic carbon oc that together with colored dissolved organic matter cdom plays a key role in the carbon cycling of lakes lake võrtsjärv is a large and shallow eutrophic lake where water quality measurements have been carried out for a long time the monthly characteristics of doc and cdom in võrtsjärv and its input output rivers were traced in 5 years observations we attempted to link the hydro morphological indices as lake area a water level wl and volume variations qc with lake doc fluxes and cdom doc relationships to improve understanding of carbon fluxes in a very shallow large and highly eutrophic lake as well as of the possibility to estimate doc fluxes by cdom via remote sensing the research questions were how the properties and quantity of doc its fluxes and cdom doc relationship in a very shallow large and highly eutrophic lake are responding to 1 variable proportions of allochthonous and autochthonous processes and 2 changing hydrological conditions the increased lake volume variation in spring caused the higher level of cdom signifying the terrestrial allochthonous doc docalloch domination in lake võrtsjärv the proportion of docalloch increased together with increasing wl a and cdom concentration although the generally high proportion of docalloch in võrtsjärv the autochthonous doc determines the water color cdom doc in this highly productive ecosystem with short residence time 280 365 days our study on doc flux revealed that the internal carbon sources driven by hydrological factors contribute significantly to the role of large and shallow lakes in global carbon cycling the further development of water color remote sensing could provide novel directions for understanding the feedbacks of lake doc flux and changing hydrology keywords large shallow eutrophic lake dissolved organic carbon flux lake volume remote sensing 1 introduction lakes are extremely active landscapes components for transport transformation and storage of terrestrially derived organic matter om at the global scale cole et al 2007 lakes act as carbon c burial by storing it in sediments as well as the net sources of c to the atmosphere by outgassing co2 and methane wen et al 2017 bastviken et al 2011 thus lakes are an important component in c cycling despite covering only small area of the earth s surface verpoorter et al 2014 each year 2 9 pg c from terrestrial landscapes is discharged into lakes in which 0 6 pg c is buried in sediments and 1 4 pg c is released into the atmosphere the remaining amount of carbon is transported into oceans tranvik et al 2009 traditionally lakes are acting as sinks of autotrophic carbon when the continual primary production exceeds respiration andersson and kumblad 2006 recent studies indicate that the role of autotrophic lakes was altered in the local scale carbon cycles with increased contributions from terrestrial landscapes hanson et al 2014 organic carbon oc entering the lakes from the terrestrial surroundings could result in high degree of respiration and larger carbon dioxide flux into atmosphere del giorgio et al 1997 likewise as om particles can absorb harmful substances and pollutants they could be transported from the catchments to lakes li et al 2018a allochthonous carbon could form more than half of lake carbon cycling components and 90 95 of organic carbon oc could be dissolved doc cole et al 2007 lakes with intensive terrestrial inflow of carbon are sites of intensive carbon processing therefore it is important to understand the dynamics of lake doc in order to understand their importance in the global carbon cycle the fates of lake doc in the global carbon cycle are disproportional to their spatial extent since they are affected by various ecosystem scales and allochthonous inputs from different catchments which in turn depends on hydrological fluctuations bernard jannin et al 2018 gao et al 2020 as a result these environmental uncertainties make the fluctuations of doc fluxes and hinder the estimation of oc loading in terrestrial dominant lakes medici et al 2021 despite mineralization and primary production making only a small contribution to the overall doc flux in such lakes they could be driven by variations in temperature and incident light traditionally the oc budget of a lake can be calculated either by an ecosystem model approach or by mass balance approach cremona et al 2019 hanson et al 2015 the ecosystem model requires a considerable amount of input data e g carbon flows within different organisms describing carbon flow through different food web organisms in mass balance only data on inputs and outputs of oc are used to calculate carbon budgets of lakes and this approach is better applicable for the lakes on a global scale this data is more readily available for global scale observations however the carbon budgets are available for a small number of watersheds as many lakes are in remote locations from where data is not available or limited even for mass balance calculations a feasible method is needed to understand the cycling mechanism of lake doc fluxes in long term temporal and large spatial scales in response to climate change and anthropogenic activities remote sensing could enhance the view of lake carbon dynamics across broad spatial and time scales kutser et al 2015 liu et al 2021 colored dissolved organic matter cdom as an inherently important variable is responsible for most of the radiation absorption 280 500 nm in many lakes the strong effect of cdom on water colour allows to map lake cdom with remote sensing over the past years laurion et al 1997 kutser et al 2005 2009 likewise there is a strong correlation between cdom and doc in many lakes clark et al 2020 griffin et al 2018 kutser 2012 kutser et al 2015 zhang et al 2007 regression based models relating laboratory measured doc to cdom estimated by satellite reflectance enable to track doc both within lake and large scale kutser 2012 therefore cdom has been used as an inexpensive and convenient proxy for doc in laboratory in situ and in remote sensing studies numerous remote sensing studies have aimed to map spatial and temporal lake carbon using cdom as an inexpensive and convenient tool fichot et al 2011 liu et al 2020 further doc fluxes can be estimated from the discharges of input output rivers cdom doc relationships and reflectance based cdom data herrault et al 2016 by optimal cdom algorithm this method could have a great potential for applying remote sensing to monitor doc fluxes however estimating doc fluxes from the remotely sensed cdom via cdom doc relationships could pose large uncertainties due to changeable cdom doc ratio colored proportion in dom and hydrological processes e g lake volume and riverine discharges therefore it is not possible to create a universal cdom retrieved model to estimate doc concentrations in lakes the unstable hydrological processes impact cdom doc ratio by changing the discharge of strongly colored allochthonous substances the input of low colored doc from wastewater effluent agricultural run off and autochthonous production also shifts the cdom doc relationship brezonik et al 2015 moreover the cdom doc relationship is variable in different regions and other optically active substances phytoplankton and particulate matter affect the water reflectance as well all this could increase uncertainty for doc fluxes estimation by cdom remote sensing for example correlations between measured and estimated doc were r2 0 92 in lake mälaren sweden kutser 2012 kutser et al 2015 r2 0 77 in lake taihu china zhang et al 2007 r2 0 93 in minnesota lakes usa olmanson et al 2020 r2 0 51 in estonian and brazilian lakes kutser et al 2016 the mapping lake doc with remote sensing has more success in some parts of the world griffin et al 2018 stedmon et al 2011 yamashita et al 2011 liu et al 2021 and less in others e g colorado rivers spencer et al 2012 yinma river li et al 2018a owing to the changes of cdom doc relationships it may be difficult to find remote sensing algorithm that allows to map lake doc globally or in large scale regions by cdom the cdom doc ratio in aquatic environments is related to external dynamics and structure across the whole watershed these include their sources hydrological processes chemical composition land use types photochemical and microbial degradation and in lake aquatic environmental behavior spencer et al 2012 on the other hand the cdom is the substrate for heterotrophic growth this means that the hydrological processes of lake watershed particularly the lakes and lake influenced rivers linked with fluctuant cdom doc ratios doc fluxes and its available source and sink etc this could also increase uncertainty for doc fluxes estimation if a universal cdom retrieved model were used in doc estimation as well as the variable hydrological processes dissolved iron bound to doc can make the absorption coefficient higher also resulting in a poor cdom doc relationship xiao et al 2013 kutser et al 2015 demonstrated that variable iron to carbon ratio makes remote sensing retrieval of doc more complicated preferential removal of low color doc by photochemical and microbial degradation can shift cdom doc ratio rapidly song et al 2019 as more recalcitrant humic substances are remaining both doc and cdom concentrations and ratios may vary considerably in short term and have also high seasonal and inter annual variance due to changing hydrology this feature can be attributed to temporal modulations as well as to spatial heterogeneity in doc and cdom inputs and removing processes in lake oc budgets considering the ecosystem scale of watershed may decrease uncertainty for c cycling assessments in addition at the within lake scale principal alterations in hydrological processes with shifts in climate could modify the cdom doc ratios and doc fluxes and its available source and sink wetter climate enriched hydrological inputs may lead to more export of doc cdom into lakes then the lesser residence times mean lower effectiveness of carbon degradation the arctic is expected to be disproportionately affected by global warming and become much warmer and wetter and other regions get dryer in the world peterson et al 2002 this change can amplify warming worldwide by causing strong feedback on lake oc loading export and mineralization etc by releasing greenhouse gases into the atmosphere consequently it is necessary to consider dynamic hydrological processes for examining the interactions of lake doc fluxes with terrestrial processes and cdom doc relationships it is essential to understand links between the pathways of carbon fluxes and cdom to reduce uncertainty in remote sensing of doc flux by cdom however studies on the variations of lake doc budgets and their driving mechanisms related to the hydrological processes and cdom doc ratios on c flux are scarce nevertheless we need to examine the correlations between lake doc budgets and cdom doc ratios to predict lake c flux in a long term observation by fitting an ecosystem scale equilibrium model for quantifying loads transformations storage and export of variable doc cycling we aim to increase a more comprehensive understanding of lake c cycling when introducing a lake volume variations model integrating the surface area and water level at a specific time span the relationships of hydrological processes with cdom doc and doc fluxes should be examined these could provide important insights for estimating doc concentration and fluxes from remotely derived cdom following research questions were intended to guide research that ultimately would result in a better understanding of carbon fluxes in lakes how the properties and quantity of doc its fluxes and cdom doc relationship in a very shallow large and highly eutrophic lake are responding to 1 variable proportions of allochthonous and autochthonous processes and 2 changing hydrological conditions 2 materials and methods 2 1 overview of lake võrtsjärv lake võrtsjärv 58 15 7 n 26 1 51 e is located in the southern estonia fig 1 it is a large area 269 19 km2 volume 0 75 km3 shallow averaged depth 2 8 m and eutrophic chl a 41 7 mg m 3 lake according to the estonian environmental register register keskkonnainfo ee võrtsjärv has four main inflowing rivers väike emajõgi õhne tarvastu and tänassilma and one outflow the river emajõgi cremona et al 2014 the ice free period of lake võrtsjärv lasts from april to october approximately 210 days the water residence time varies between 240 and 384 days with the average of one year jaani 1990 the water of the northern and central area is turbid and phytoplankton dominated the large winds fetch and currents erode bottom sediments and make the environment inappropriate for macrophytes in contrast the much smaller sheltered and narrow southern part of the lake has fine grained sediments and is macrophyte dominated we used data from the central part sta 10 of the lake in our study fig 1 2 2 data collection lake water samples were collected from surface water 0 50 cm with 1 l acid cleaned plastic bottles altogether a unique 5 year database was collected from april 2009 to october 2013 the sampling process was aggregated with the monthly time step the water was analysed for cdom absorption coefficient at 380 nm cdom m 1 chemical oxygen demand by permanganate codmn mg o l 1 chlorophyll a chl a mg l 1 and dissolved organic carbon doc mg c l 1 concentrations as described and published by toming et al 2013 in order to characterize the cdom doc relationships and colored proportions in doc the color index ci was calculated from equation below eq 1 1 ci a cdom 380 doc in addition the hydrological data of the lake and lake related rivers i e water level wl inflowing riverine discharges i and outflowing riverine discharges o were also measured once per month by estonian environment agency all lake samples were divided into three seasonal groups for further analysis i e spring april to may summer june to august and autumn september to october respectively 2 3 lake water volume variations estimation model lake volume is the integral of surface area over bottom topography cai et al 2016 the relative lake volume variations q c at a specific time span can be calculated by 2 q c q t 2 q t 1 δ q a b where q t1 is the volume at the moment t 1 q t2 is the volume at the moment t 2 δq is the lake volume variations a and b represent terrain parameters in field surveys it is difficult to characterize the complicated lake bed morphology however for relative variations of lake volume the influence of terrain can be ignored as following 3 q c i m p t 1 i wl t 1 i n p t 2 i wl t 2 where pt1 is the area of signal pixel at the moment t 1 m is the sum of lake pixels pt2 is the area of signal pixel at the moment t 2 n is the sum of lake pixels wlt1 is the water level at the moment t 1 and wlt2 is the water level at the moment t 2 the lake area at different months can be acquired by water index based on remote sensing images verpoorter et al 2012 moderate resolution imaging spectrometer modis can ensure the temporal matching for lake area calculations due to its short temporal resolution twice per day water absorbs light strongly in the red to the near infrared nir part of spectrum therefore water reflectance is usually zero in nir part of spectrum land surface has high reflectance in nir therefore it is recommended to use band ratios incorporating nir bands in delineation of waterbodies võrtsjärv is in flat terrain and there are no many errors of shadows of mountains for extracting lake s areas verpoorter et al 2012 for example the normalized difference water index ndwi threshold method has been successfully applied to delineate surface water using the green and near infrared bands jawak and luis 2014 shah 2011 watson et al 2018 4 n d w i g n i r g n i r where g and nir represent the reflectance in the green band modis band 4 545 565 nm and nir band modis band 2 840 876 nm respectively in this study ndwi histogram and human computer interaction were used to analyze the thresholds of land water interfaces features the detailed information about each modis image used thresholds and cloud cover are shown in table s1 2 4 lake doc variation δdoc estimation we applied lake δdoc estimation model eqs 5 7 fig 2 the conceptual approach of which was provided by molot dillon 1996 mccullough et al 2018 and hanson et al 2014 the doc input to lake ecosystem is described as the sum of allochthonous doc docalloch from surface and groundwater sources atmospheric deposition via precipitation and leaching etc and autochthonous doc docautoch phytoplankton primary production etc inputs doc outputs from the lake involve mineralization processes and export via outflow mccullough et al 2018 more descriptions parameters and equations are defined in tables s2 and s3 here for simplicity the lake δdoc can be seen as a sum of doc sedimentation and doc variations in water column the mass change in doc in the lake was quantified by the monthly variations of lake volume and their levels could define the role of lakes in broader doc cycling 5 lake δdoc in water column δdocalloch δdocautoch 6 δdocalloch inflow i docalloch deposition d docalloch leaching l docalloch mineralization m docalloch export e docalloch 7 δdocautoch net primary production npp doc leaching l docautoch mineralization m docautoch export e docautoch 2 5 statistical analysis pearson correlation and regression analyses were performed for relationships between variables e g water quality parameters cdom doc hydrological parameters and lake doc flux during ice free period in lake võrtsjärv using spss statistical program for social sciences 17 0 software significance levels are presented as non significant p 0 05 significant 0 05 p 0 01 or highly significant p 0 01 3 results 3 1 seasonal and interannual variations of water quality and cdom box plots of doc cdom and other water quality parameters chl a and codmn of all the lake samples from 2009 to 2013 were summarized in table 1 and fig 3 seasonal averages of doc were not significantly different f 1 81 p 0 05 chl a concentrations increased from spring towards autumn f 50 4 p 0 001 while codmn decreased f 7 56 p 0 05 significant seasonal difference of cdom was found f 15 8 p 0 001 the averaged values of cdom in spring were somewhat higher than the values of the same variables in summer and autumn respectively in addition there were no significant correlations t test p 0 05 between doc and cdom in ice free period from 2009 to 2013 fig 3 seasonally the averaged values of color index ci cdom doc in 5 years were spring 0 81 l mg c 1 m 1 summer 0 52 l mg c 1 m 1 autumn 0 38 l mg c 1 m 1 likewise a significant difference was observed between seasonal variation of ci f 9 57 p 0 001 3 2 seasonal and interannual variations of hydrological processes seasonally the averaged values of water level wl in 5 years were spring 34 58 m summer 34 04 m autumn 33 51 m respectively table 2 and fig 4 for averaged lake area a extracted from modis spring 267 56 km2 summer 245 91 km2 autumn 241 78 km2 indicating the consistent tendency for two hydrological parameters likewise there were highly significant for wl and a indicating seasonal difference f 35 9 and 18 1 p 0 001 significant seasonal differences of lake volume variations q c eqs 2 3 were observed fig 4c f 25 3 p 0 001 q c from october to next april was always positive lake gathered more water huge yearly differences could be attributed to the variations of precipitations runoff and ice melting in summer q c was always negative due to the evaporation at intensive sunshine in autumn q c could be either positive or negative depending on variances of individual year precipitations fig 6 3 3 seasonal and interannual changes of lake doc pool according to the model calculation of eq 5 7 and table s2 s3 the δdoc of võrtsjärv varied during 5 years between 14 07 and 226 36 g m 2 month 1 with the average 53 12 39 2 sd g m 2 month 1 fig 5 a in 2009 δdoc δdocalloch and δdocautoch all varied consistently with hydrological parameters fig 4 δdocalloch dominated in the lake doc fluxes the two main hydrological processes load i docalloch and d docalloch and export e docalloch dominated the δdoc whereas m docalloch and l docalloch accounted only for a small proportion of it seasonally d docalloch contributed to δdoc more in summer than in autumn and spring in spring i docalloch brings more doc probably due to the ice melt fig 5b 3 4 how does hydrology influences water color and quality and the color index owing to that the lake volume q c is calculated as the relative variation of volume from the moment t 1 to the moment t 2 eqs 2 3 we also used the relative variations of water quality parameters e g chl a and codmn and lake δdoc parameters see 3 5 from moment t 1 to moment t 2 in order to compare their correlations our analysis of the relationships of ci lake water quality indices chl a cdom and doc and hydrological parameters wl q c revealed no correlation between hydrological parameters and doc concentrations t test p 0 05 chl a variation was negatively correlated with the q c variation and ci was positively correlated to q c variation and so was also cdom with water level fig 6 this indicates that allochthonous inputs contributed more to the cdom in lake võrtsjärv 3 5 how does hydrology influences lake δdoc the results of the matrix plots of pearson correlation related to the hydrological parameters and δdoc is shown in table 3 and fig 6 lake area a water level wl and lake volume q c showed a negative correlation between δdocautoch i e nppdoc netprimaryproductivity ldocautoch mdocautoch edocautoch consistent with the results of hydrological parameters and chl a variations table 3 and fig 6 although δdocalloch dominated the lake δdoc a moderate positive correlation could be found between hydrological parameters with i docalloch and e docalloch 3 6 lake δdoc water color and quality and color index ci the results of the matrix plots of the pearson correlation related to the lake δdoc and ci and water quality parameters are shown in doc exhibited a positive correlation with δdoc consistent with chl a variations and δdocautoch r 0 6 p 0 01 indicating the autochthonous processes the lake δdoc negative correlation between ci and δdocautoch p 0 01 and positive correlation between idocalloch and ci were found table 4 and fig 6 these results showed that import i docalloch and export e docalloch contributed more to the cdom levels 4 discussion 4 1 lake δdoc and its cycling this study revealed seasonal and 5 year interannual changes of doc during the ice free period its components and their fluxes in a large and very shallow temperate lake võrtsjärv the averaged doc concentration 14 78 mg c l 1 in võrtsjärv was higher than those reported in many lakes around the world e g hungary tóth et al 2007 china ye 2012 usa fallon and brock 1979 belarus ostapenya and zhukova 2009 and israel yacobi 2006 the global mean doc concentration in surface water is 3 88 mg c l 1 toming et al 2016 and lake võrtsjärv is a very doc rich lake compared to the global mean during our 5 year study period the doc concentration in lake võrtsjärv did not increase despite the evidence of increasing oc concentrations in northern hemisphere lakes weyhenmeyer and jeppesen 2010 doc concentration in võrtsjärv seems to be controlled mostly by the regional factors such as catchment properties land use management li et al 2018b sulphur deposition evans et al 2006 hydrology and regional climate freeman et al 2001 while the global factors are apparently less influential uncommonly to the eutrophic lakes allochthonous doc fluxes dominated in lake võrtsjärv fig 5 this agrees with toming et al 2013 finding that allochthonous dom prevailed in the total dom pool of võrtsjärv even in the high primary production seasons as a product of incomplete decomposition of organic matter production of doc in catchment soil is favored at high organic matter content and c n ratios aitkenhead and mcdowell 2000 the catchment of lake võrtsjärv comprises of arable land and grassland 45 3 forest 46 1 wetland 0 6 bog 0 4 and marsh 0 1 cremona et al 2014 the soils in estonia are rich in organic matter especially the agricultural soils therefore the catchment soil doc is positively correlated with doc concentration in estonian lakes sepp et al 2019 laudon et al 2004 demonstrated that there is a strong correlation between precipitation and dom in the discharges of forested areas due to the fact that forests are rich in organic matter in the upper parts of the soil thus for catchment dominated by forest concentrations of doc and cdom can be almost two or three times higher than in other eutrophic lakes furthermore our results also indicate that the npp of watershed soil is the key to determining the role of the doc cycle model and even cdom doc relationships see 4 3 the doc and chl a had a distinct seasonal variation with the highest values in the summer autumn vegetation period we found that autochthonous doc flux δdocautoch was more strongly related to water quality indices doc and chl a than the allochthonous doc flux δdocalloch the correspondence of doc and autochthonous primary production was reported also in other studies zhang et al 2010 võrtsjärv is an eutrophic lake with high production of autochthonous doc if compared to other north european lakes the high importance of autochthonous doc flux determining doc in võrtsjärv may be explained also by the intensive export of allochthonous doc ealloch in fig 5 with the residence time approximately 240 384 days cremona et al 2019 hence lake võrtsjärv is an active site for transporting doc from the catchment area cremona et al 2014 cremona et al 2019 4 2 impacts of hydrological processes the links between hydrological and water quality parameters are generally determined by the catchment and lake own morphometry fichot et al 2011 nõges et al 2016 for shallow lakes like lake võrtsjärv the water level area and volume can strongly affect seasonal doc fluxes cdom chlorophyll a and other parameters table 3 and fig 6 we found that the hydrological parameters wl a and q c are significantly associated with cdom wl cdom r 0 84 and chl a q c chl a variations r 0 72 and are showing significant seasonal differences it is largely known that terrestrial inputs through inflowing rivers can bring large amounts of doc and cdm as well as nutrients from the catchments crawford et al 2014 brezonik et al 2015 seasonal monitoring revealed that hydrological processes were dominant in lake cdom levels wl and cdom r 0 80 and inflowing doc fluxes idocalloch wl and a r 0 50 fig 6 and fig 8 such relationships in lake võrtsjärv were reported also by cremona et al 2014 toming et al 2013 and nõges et al 2016 previous studies demonstrated that in estonian rivers cdom is positively correlated with discharge strong correlation between doc and cdom with discharges and rainfall were demonstrated in the snowmelt period in chinese watershed yinma river li et al 2016 these results indicated that the loadings of doc and cdom are more linked to the hydrological variations than to the doc and cdom levels in the tributaries moreover high water level and lake volume could decrease the biogeochemical signals averaged values of doc and chl a concentrations because of the dilution effect from april to october lake area and water level decreased and the lake volume varied significantly fig 4 consistently with the increase of lake δdoc fig 5 nõges et al 2009 reported that the high discharges of inflow rivers in spring bring more colored dom and doc into the lake generally winds blowing across the atlantic bring moist air to europe and european winters are mild and rainy then warm temperature and thawed snow ice in spring cause higher surface runoff of rivers and water levels of lakes and also bring more dom into the lakes in this study we found a higher lake docalloch and δdoc in october 2009 indicating higher δdoc variations from october 2009 to april 2010 fig 5a in the winter of 2009 2010 north atlantic oscillation index in europe was extremely negative showing cold winter fereday et al 2012 the runoffs flowed over frozen soil without effective relation to humic enrich surface layers of soils in spring toming et al 2016 unlike in other years we did not find increased docalloch and δdoc values in april 2010 4 3 variability of color index cdom absorbs light strongly in the blue part of spectrum and can therefore be used as an inexpensive and convenient proxy for doc in many inland waters griffin et al 2018 kutser et al 2015 there have been significant efforts in developing doc and cdom retrieval algorithms for satellite remote sensing brezonik et al 2015 fichot 2011 hestir et al 2015 kutser et al 2005 2015 kowalczuk et al 2013 spencer et al 2012 although the algorithms and r2 varied for each geographical region and seasons previous studies curtis and adams 1995 reported that in arid or semi arid regions saline and fresh water lakes with longer water residence times the doc concentrations are higher because of the accumulation due to intensive evaporation lakes in humid regions with long water residence times tend to have lower doc caused by low loading rates and the higher proportion of uncolored doc proportion due to the photo bleaching processes pace and cole 2002 the relationships between doc and cdom were variable in lake võrtsjärv coinciding both with allochthonous inputs of catchment and inner primary production fig 8 there is a limit in our capability to predict lake organic carbon from cdom due to the high variability in cdom doc ratio in different lakes as well it is shown in this study that there are significant seasonal differences between the cdom doc and ci in our study we found that there is a positive correlation between idocalloch and ci fig 8b this indicates that inflow rivers influence the water color of the lake allochthonous contributions of doc can be changed in several ways e g runoff inputs atmospheric deposition these allochthonous fractions could also increase the concentration of cdom and water colour as the streams are draining into the lake doc and dom from soil organic matter generally have more humic acids than those derived from autochthonous algal and microbial precursor material hood et al 2005 cole et al 2007 also demonstrated that the allochthonous doc is mainly cdom while the autochthonous doc is mostly as un colored fraction in lake võrtsjärv allochthonous dom had higher d13c values than autochthonous dom au dom toming et al 2013 when water goes through the high organic soils these doc dom fractions can be leached and drained into rivers and finally into the lake systems see 4 2 bringing more colored dom it can be found that in fig 6 and fig 3b in our study cdom was positively correlated with idocalloch fig 6 which is a key process contributing to lake doc fluxes in all winter months ice period soil is frozen and there is low microbial activity to degrade the oc in soil this means that more humic materials will be generated in soil and transported with melting ice to rivers in spring than during the other months there is a high microbial activity in summer but usually little rain meaning that the autochthonous part dominates in summer the doc of terrestrial origin starts to increase again in autumn as lots of doc was produced during summer and rains bring it finally into the lake in autumn in addition the association of dissolved iron with doc can change the intensity of light absorption and different decay rates of iron and cdom change the ratio between coloured and non coloured parts of doc kutser et al 2015 in lakes of boreal forest the rapid water exchange and high primary production increase the proportion of autochthonous non colored doc zhang et al 2010 we found that δdocautoch together with chl a concentrations had an important impact on ci in lake võrtsjärv fig 6 for eutrophic lake the high share of autochthonous doc in lake võrtsjärv may limit our ability to map doc with remote sensing nevertheless doc had statistically highly significant correlations collinearity between cdom in 2010 and 2013 r 0 80 r2 0 6 p 0 01 fig s2 there are periods when cdom doc relationship in lake võrtsjärv allows to use cdom as a proxy for doc however the proportions of allochthonous and autochthonous material in doc vary seasonally and interannually on large scale making long time remote sensing studies of lake doc less reliable 4 4 uncertainties and implements of remote sensing first our estimation of lake δdoc did not consider the contribution of doc sedimentation to the whole lake doc budget eq 5 7 in hydrologically passive lakes sedimentation rates are notoriously difficult to measure accurately hanson et al 2011 in some cases the relative contribution of sediment respiration to doc mineralization is strongly affected by water column depth and is comparable to hydrological discharge thus in such shallow lakes as võrtsjärv water level fluctuations also modify lake depth and thus the resuspension of sediment particles affecting the balance of heat water and substances zhang et al 2010 as well as the mineralization rates which also vary in different seasons together with temperature table s3 kankaala et al 2006 showed that oc accumulated in the sediments produces a minor proportion of co2 flux to the atmosphere in finnish lakes cremona et al 2014 simulated that the oc load export sedimentation and respiration for lake võrtsjärv were greater than in other lakes in estonia as retention index ri input output input of oc budgets ranged between 12 nohipalo mustjärv estonia and 99 nohipalo valgõjärv estonia nevertheless during the ice covered period oc fluxes would not be ceased and this could increase uncertainty of lake δdoc still it should be noted that environmental characteristics have determined effect on the cdom doc levels and comprehensive models related to all available environmental datasets need to be considered in estimations of δdoc secondly the calculations of hydrological parameters bring more uncertainty e g lake area by ndwi and image quality modis was used in this study for lake area extraction for the purpose of higher temporal resolution twice per day modis imagery was not always available for the dates when in situ sampling took place table s1 therefore we first had to estimate what kind of uncertainties did it cause in our analysis secondly we had to keep in mind that the modis imagery has 500 m resolution mixed land water pixels cause errors in lake area estimations averaged area 269 19 km2 sun et al 2011 obtained evaluation results that the correlation coefficient between modis and tm landsattmimages water fractions is 0 97 with bias of 4 47 for a total sample number of 50423 this allows to assume that modis is adequate for mapping variations in large lake surface areas however ndwi is not a certain value for each modis scene even in a whole lake or different time table s1 liu 2012 acquired 33 cloud free scenes of modis for surface extraction of ndwi waters and found 90 threshold difference was explained by the temporal factors geometry and atmospheric conditions in our study we also estimated increasing lake area in september 2010 at decreasing water level fig 4 this can be explained that mixed pixels of wetland and small ponds can be misclassified as water because of the coarse resolution at stable water surface area of lake võrtsjärv fig s1 clouds could introduce some uncertainties hence these uncertainties in lake area could bring errors into correlation analysis between hydrological parameters and water quality and color in addition the estimations of lake δdoc could enhance uncertainty as the conventional methods for doc fluxes are generally limited to discrete measurements cdom assessments by remote sensing are increasingly available for estimating lake surface water doc and δdoc allowing the accurate evaluation of total lake c in long term temporal scales remote areas and harsh environments there are moderate correlations between cdom and doc and δdocautoch and idocalloch table 4 actually we only used four main inflow rivers e g rivers väike emajõgi õhne tarvastu and tänassilma in the lake δdoc calculations fig 1 some small inflow streams and ponds around võrtsjärv could have also contributed to the lake doc fluxes owing to that the long time climate models predict warmer and wetter climate in higher latitudes forest productivity in northern europe will increase in a few years morales et al 2007 estonia together with nordic countries have many humic lakes where the cdom concentration is high due to the terrestrial inputs forests proportions in landscape soil characteristics and less anthrophonic activities the high availability and requirements of colored proportions to the lake δdoc and morphometric changes are required to be considered in large scale monitoring in such lakes our results are consistent with the previous studies zhang et al 2010 showing that chl a concentrations have significant influences on water color due to autochthonous non colored doc however further systematic examination of doc doc fluxes and cdom is required 5 conclusions 5 year lake doc flux was modelled to quantify its interactions with hydrological parameters doc and color index cdom doc in a large shallow and eutrophic lake võrtsjärv estonia we drew the following conclusions doc concentrations in lake võrtsjärv are the highest among large shallow eutrophic lakes from which these data are available cdom is not a good predictor for doc concentration in lake võrtsjärv owing to changing hydrological processes seasonal variation of hydrological parameters lake water level area and volume controlled the lake cdom levels relative variation of lake volume correlated negatively with chl a and autochthonous doc flux and positively with color index the allochthonous doc load dominated the lake doc fluxes while autochthonous doc predicted the water colour especially during summer these outcomes demonstrate that the lake volume variation has a potential to indicate the variations of lake water color and doc fluxes the lake volume could be obtained from satellite remote sensing products area and radar altimeter water level in addition the color index could assist both local and large scale decision making on policies management for understanding autochthonous doc fluxes in a large and shallow eutrophic lake credit authorship contribution statement sijia li conceptualization methodology formal analysis visualization writing original draft kaire toming resources supervision project administration funding acquisition writing review editing tiina nõges resources writing review editing tiit kutser writing review editing declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgements for field measurements and laboratory analyses we acknowledge the help of the whole staff from estonian university of life sciences and university of tartu estonia this work was supported by institutional research funding iut21 2 of the estonian ministry of education and research by the estonian research council grants prg709 and prg302 and by the european regional developing fund and the program mobilitas pluss grant number mobtp106 the phd scholarship fellowship of li s was funded by the china scholarship council file no 201806620049 university of tartu file no 2 1 17 lt 13 08 01 2019 and china postdoctoral science foundation 2020m681056 two anonymous reviewers have provided valuable suggestions for improving this manuscript appendix a supplementary data supplementary data to this article can be found online at https doi org 10 1016 j jhydrol 2021 127331 appendix a supplementary data the following are the supplementary data to this article supplementary data 1 
3747,dissolved organic carbon doc is an important fraction of organic carbon oc that together with colored dissolved organic matter cdom plays a key role in the carbon cycling of lakes lake võrtsjärv is a large and shallow eutrophic lake where water quality measurements have been carried out for a long time the monthly characteristics of doc and cdom in võrtsjärv and its input output rivers were traced in 5 years observations we attempted to link the hydro morphological indices as lake area a water level wl and volume variations qc with lake doc fluxes and cdom doc relationships to improve understanding of carbon fluxes in a very shallow large and highly eutrophic lake as well as of the possibility to estimate doc fluxes by cdom via remote sensing the research questions were how the properties and quantity of doc its fluxes and cdom doc relationship in a very shallow large and highly eutrophic lake are responding to 1 variable proportions of allochthonous and autochthonous processes and 2 changing hydrological conditions the increased lake volume variation in spring caused the higher level of cdom signifying the terrestrial allochthonous doc docalloch domination in lake võrtsjärv the proportion of docalloch increased together with increasing wl a and cdom concentration although the generally high proportion of docalloch in võrtsjärv the autochthonous doc determines the water color cdom doc in this highly productive ecosystem with short residence time 280 365 days our study on doc flux revealed that the internal carbon sources driven by hydrological factors contribute significantly to the role of large and shallow lakes in global carbon cycling the further development of water color remote sensing could provide novel directions for understanding the feedbacks of lake doc flux and changing hydrology keywords large shallow eutrophic lake dissolved organic carbon flux lake volume remote sensing 1 introduction lakes are extremely active landscapes components for transport transformation and storage of terrestrially derived organic matter om at the global scale cole et al 2007 lakes act as carbon c burial by storing it in sediments as well as the net sources of c to the atmosphere by outgassing co2 and methane wen et al 2017 bastviken et al 2011 thus lakes are an important component in c cycling despite covering only small area of the earth s surface verpoorter et al 2014 each year 2 9 pg c from terrestrial landscapes is discharged into lakes in which 0 6 pg c is buried in sediments and 1 4 pg c is released into the atmosphere the remaining amount of carbon is transported into oceans tranvik et al 2009 traditionally lakes are acting as sinks of autotrophic carbon when the continual primary production exceeds respiration andersson and kumblad 2006 recent studies indicate that the role of autotrophic lakes was altered in the local scale carbon cycles with increased contributions from terrestrial landscapes hanson et al 2014 organic carbon oc entering the lakes from the terrestrial surroundings could result in high degree of respiration and larger carbon dioxide flux into atmosphere del giorgio et al 1997 likewise as om particles can absorb harmful substances and pollutants they could be transported from the catchments to lakes li et al 2018a allochthonous carbon could form more than half of lake carbon cycling components and 90 95 of organic carbon oc could be dissolved doc cole et al 2007 lakes with intensive terrestrial inflow of carbon are sites of intensive carbon processing therefore it is important to understand the dynamics of lake doc in order to understand their importance in the global carbon cycle the fates of lake doc in the global carbon cycle are disproportional to their spatial extent since they are affected by various ecosystem scales and allochthonous inputs from different catchments which in turn depends on hydrological fluctuations bernard jannin et al 2018 gao et al 2020 as a result these environmental uncertainties make the fluctuations of doc fluxes and hinder the estimation of oc loading in terrestrial dominant lakes medici et al 2021 despite mineralization and primary production making only a small contribution to the overall doc flux in such lakes they could be driven by variations in temperature and incident light traditionally the oc budget of a lake can be calculated either by an ecosystem model approach or by mass balance approach cremona et al 2019 hanson et al 2015 the ecosystem model requires a considerable amount of input data e g carbon flows within different organisms describing carbon flow through different food web organisms in mass balance only data on inputs and outputs of oc are used to calculate carbon budgets of lakes and this approach is better applicable for the lakes on a global scale this data is more readily available for global scale observations however the carbon budgets are available for a small number of watersheds as many lakes are in remote locations from where data is not available or limited even for mass balance calculations a feasible method is needed to understand the cycling mechanism of lake doc fluxes in long term temporal and large spatial scales in response to climate change and anthropogenic activities remote sensing could enhance the view of lake carbon dynamics across broad spatial and time scales kutser et al 2015 liu et al 2021 colored dissolved organic matter cdom as an inherently important variable is responsible for most of the radiation absorption 280 500 nm in many lakes the strong effect of cdom on water colour allows to map lake cdom with remote sensing over the past years laurion et al 1997 kutser et al 2005 2009 likewise there is a strong correlation between cdom and doc in many lakes clark et al 2020 griffin et al 2018 kutser 2012 kutser et al 2015 zhang et al 2007 regression based models relating laboratory measured doc to cdom estimated by satellite reflectance enable to track doc both within lake and large scale kutser 2012 therefore cdom has been used as an inexpensive and convenient proxy for doc in laboratory in situ and in remote sensing studies numerous remote sensing studies have aimed to map spatial and temporal lake carbon using cdom as an inexpensive and convenient tool fichot et al 2011 liu et al 2020 further doc fluxes can be estimated from the discharges of input output rivers cdom doc relationships and reflectance based cdom data herrault et al 2016 by optimal cdom algorithm this method could have a great potential for applying remote sensing to monitor doc fluxes however estimating doc fluxes from the remotely sensed cdom via cdom doc relationships could pose large uncertainties due to changeable cdom doc ratio colored proportion in dom and hydrological processes e g lake volume and riverine discharges therefore it is not possible to create a universal cdom retrieved model to estimate doc concentrations in lakes the unstable hydrological processes impact cdom doc ratio by changing the discharge of strongly colored allochthonous substances the input of low colored doc from wastewater effluent agricultural run off and autochthonous production also shifts the cdom doc relationship brezonik et al 2015 moreover the cdom doc relationship is variable in different regions and other optically active substances phytoplankton and particulate matter affect the water reflectance as well all this could increase uncertainty for doc fluxes estimation by cdom remote sensing for example correlations between measured and estimated doc were r2 0 92 in lake mälaren sweden kutser 2012 kutser et al 2015 r2 0 77 in lake taihu china zhang et al 2007 r2 0 93 in minnesota lakes usa olmanson et al 2020 r2 0 51 in estonian and brazilian lakes kutser et al 2016 the mapping lake doc with remote sensing has more success in some parts of the world griffin et al 2018 stedmon et al 2011 yamashita et al 2011 liu et al 2021 and less in others e g colorado rivers spencer et al 2012 yinma river li et al 2018a owing to the changes of cdom doc relationships it may be difficult to find remote sensing algorithm that allows to map lake doc globally or in large scale regions by cdom the cdom doc ratio in aquatic environments is related to external dynamics and structure across the whole watershed these include their sources hydrological processes chemical composition land use types photochemical and microbial degradation and in lake aquatic environmental behavior spencer et al 2012 on the other hand the cdom is the substrate for heterotrophic growth this means that the hydrological processes of lake watershed particularly the lakes and lake influenced rivers linked with fluctuant cdom doc ratios doc fluxes and its available source and sink etc this could also increase uncertainty for doc fluxes estimation if a universal cdom retrieved model were used in doc estimation as well as the variable hydrological processes dissolved iron bound to doc can make the absorption coefficient higher also resulting in a poor cdom doc relationship xiao et al 2013 kutser et al 2015 demonstrated that variable iron to carbon ratio makes remote sensing retrieval of doc more complicated preferential removal of low color doc by photochemical and microbial degradation can shift cdom doc ratio rapidly song et al 2019 as more recalcitrant humic substances are remaining both doc and cdom concentrations and ratios may vary considerably in short term and have also high seasonal and inter annual variance due to changing hydrology this feature can be attributed to temporal modulations as well as to spatial heterogeneity in doc and cdom inputs and removing processes in lake oc budgets considering the ecosystem scale of watershed may decrease uncertainty for c cycling assessments in addition at the within lake scale principal alterations in hydrological processes with shifts in climate could modify the cdom doc ratios and doc fluxes and its available source and sink wetter climate enriched hydrological inputs may lead to more export of doc cdom into lakes then the lesser residence times mean lower effectiveness of carbon degradation the arctic is expected to be disproportionately affected by global warming and become much warmer and wetter and other regions get dryer in the world peterson et al 2002 this change can amplify warming worldwide by causing strong feedback on lake oc loading export and mineralization etc by releasing greenhouse gases into the atmosphere consequently it is necessary to consider dynamic hydrological processes for examining the interactions of lake doc fluxes with terrestrial processes and cdom doc relationships it is essential to understand links between the pathways of carbon fluxes and cdom to reduce uncertainty in remote sensing of doc flux by cdom however studies on the variations of lake doc budgets and their driving mechanisms related to the hydrological processes and cdom doc ratios on c flux are scarce nevertheless we need to examine the correlations between lake doc budgets and cdom doc ratios to predict lake c flux in a long term observation by fitting an ecosystem scale equilibrium model for quantifying loads transformations storage and export of variable doc cycling we aim to increase a more comprehensive understanding of lake c cycling when introducing a lake volume variations model integrating the surface area and water level at a specific time span the relationships of hydrological processes with cdom doc and doc fluxes should be examined these could provide important insights for estimating doc concentration and fluxes from remotely derived cdom following research questions were intended to guide research that ultimately would result in a better understanding of carbon fluxes in lakes how the properties and quantity of doc its fluxes and cdom doc relationship in a very shallow large and highly eutrophic lake are responding to 1 variable proportions of allochthonous and autochthonous processes and 2 changing hydrological conditions 2 materials and methods 2 1 overview of lake võrtsjärv lake võrtsjärv 58 15 7 n 26 1 51 e is located in the southern estonia fig 1 it is a large area 269 19 km2 volume 0 75 km3 shallow averaged depth 2 8 m and eutrophic chl a 41 7 mg m 3 lake according to the estonian environmental register register keskkonnainfo ee võrtsjärv has four main inflowing rivers väike emajõgi õhne tarvastu and tänassilma and one outflow the river emajõgi cremona et al 2014 the ice free period of lake võrtsjärv lasts from april to october approximately 210 days the water residence time varies between 240 and 384 days with the average of one year jaani 1990 the water of the northern and central area is turbid and phytoplankton dominated the large winds fetch and currents erode bottom sediments and make the environment inappropriate for macrophytes in contrast the much smaller sheltered and narrow southern part of the lake has fine grained sediments and is macrophyte dominated we used data from the central part sta 10 of the lake in our study fig 1 2 2 data collection lake water samples were collected from surface water 0 50 cm with 1 l acid cleaned plastic bottles altogether a unique 5 year database was collected from april 2009 to october 2013 the sampling process was aggregated with the monthly time step the water was analysed for cdom absorption coefficient at 380 nm cdom m 1 chemical oxygen demand by permanganate codmn mg o l 1 chlorophyll a chl a mg l 1 and dissolved organic carbon doc mg c l 1 concentrations as described and published by toming et al 2013 in order to characterize the cdom doc relationships and colored proportions in doc the color index ci was calculated from equation below eq 1 1 ci a cdom 380 doc in addition the hydrological data of the lake and lake related rivers i e water level wl inflowing riverine discharges i and outflowing riverine discharges o were also measured once per month by estonian environment agency all lake samples were divided into three seasonal groups for further analysis i e spring april to may summer june to august and autumn september to october respectively 2 3 lake water volume variations estimation model lake volume is the integral of surface area over bottom topography cai et al 2016 the relative lake volume variations q c at a specific time span can be calculated by 2 q c q t 2 q t 1 δ q a b where q t1 is the volume at the moment t 1 q t2 is the volume at the moment t 2 δq is the lake volume variations a and b represent terrain parameters in field surveys it is difficult to characterize the complicated lake bed morphology however for relative variations of lake volume the influence of terrain can be ignored as following 3 q c i m p t 1 i wl t 1 i n p t 2 i wl t 2 where pt1 is the area of signal pixel at the moment t 1 m is the sum of lake pixels pt2 is the area of signal pixel at the moment t 2 n is the sum of lake pixels wlt1 is the water level at the moment t 1 and wlt2 is the water level at the moment t 2 the lake area at different months can be acquired by water index based on remote sensing images verpoorter et al 2012 moderate resolution imaging spectrometer modis can ensure the temporal matching for lake area calculations due to its short temporal resolution twice per day water absorbs light strongly in the red to the near infrared nir part of spectrum therefore water reflectance is usually zero in nir part of spectrum land surface has high reflectance in nir therefore it is recommended to use band ratios incorporating nir bands in delineation of waterbodies võrtsjärv is in flat terrain and there are no many errors of shadows of mountains for extracting lake s areas verpoorter et al 2012 for example the normalized difference water index ndwi threshold method has been successfully applied to delineate surface water using the green and near infrared bands jawak and luis 2014 shah 2011 watson et al 2018 4 n d w i g n i r g n i r where g and nir represent the reflectance in the green band modis band 4 545 565 nm and nir band modis band 2 840 876 nm respectively in this study ndwi histogram and human computer interaction were used to analyze the thresholds of land water interfaces features the detailed information about each modis image used thresholds and cloud cover are shown in table s1 2 4 lake doc variation δdoc estimation we applied lake δdoc estimation model eqs 5 7 fig 2 the conceptual approach of which was provided by molot dillon 1996 mccullough et al 2018 and hanson et al 2014 the doc input to lake ecosystem is described as the sum of allochthonous doc docalloch from surface and groundwater sources atmospheric deposition via precipitation and leaching etc and autochthonous doc docautoch phytoplankton primary production etc inputs doc outputs from the lake involve mineralization processes and export via outflow mccullough et al 2018 more descriptions parameters and equations are defined in tables s2 and s3 here for simplicity the lake δdoc can be seen as a sum of doc sedimentation and doc variations in water column the mass change in doc in the lake was quantified by the monthly variations of lake volume and their levels could define the role of lakes in broader doc cycling 5 lake δdoc in water column δdocalloch δdocautoch 6 δdocalloch inflow i docalloch deposition d docalloch leaching l docalloch mineralization m docalloch export e docalloch 7 δdocautoch net primary production npp doc leaching l docautoch mineralization m docautoch export e docautoch 2 5 statistical analysis pearson correlation and regression analyses were performed for relationships between variables e g water quality parameters cdom doc hydrological parameters and lake doc flux during ice free period in lake võrtsjärv using spss statistical program for social sciences 17 0 software significance levels are presented as non significant p 0 05 significant 0 05 p 0 01 or highly significant p 0 01 3 results 3 1 seasonal and interannual variations of water quality and cdom box plots of doc cdom and other water quality parameters chl a and codmn of all the lake samples from 2009 to 2013 were summarized in table 1 and fig 3 seasonal averages of doc were not significantly different f 1 81 p 0 05 chl a concentrations increased from spring towards autumn f 50 4 p 0 001 while codmn decreased f 7 56 p 0 05 significant seasonal difference of cdom was found f 15 8 p 0 001 the averaged values of cdom in spring were somewhat higher than the values of the same variables in summer and autumn respectively in addition there were no significant correlations t test p 0 05 between doc and cdom in ice free period from 2009 to 2013 fig 3 seasonally the averaged values of color index ci cdom doc in 5 years were spring 0 81 l mg c 1 m 1 summer 0 52 l mg c 1 m 1 autumn 0 38 l mg c 1 m 1 likewise a significant difference was observed between seasonal variation of ci f 9 57 p 0 001 3 2 seasonal and interannual variations of hydrological processes seasonally the averaged values of water level wl in 5 years were spring 34 58 m summer 34 04 m autumn 33 51 m respectively table 2 and fig 4 for averaged lake area a extracted from modis spring 267 56 km2 summer 245 91 km2 autumn 241 78 km2 indicating the consistent tendency for two hydrological parameters likewise there were highly significant for wl and a indicating seasonal difference f 35 9 and 18 1 p 0 001 significant seasonal differences of lake volume variations q c eqs 2 3 were observed fig 4c f 25 3 p 0 001 q c from october to next april was always positive lake gathered more water huge yearly differences could be attributed to the variations of precipitations runoff and ice melting in summer q c was always negative due to the evaporation at intensive sunshine in autumn q c could be either positive or negative depending on variances of individual year precipitations fig 6 3 3 seasonal and interannual changes of lake doc pool according to the model calculation of eq 5 7 and table s2 s3 the δdoc of võrtsjärv varied during 5 years between 14 07 and 226 36 g m 2 month 1 with the average 53 12 39 2 sd g m 2 month 1 fig 5 a in 2009 δdoc δdocalloch and δdocautoch all varied consistently with hydrological parameters fig 4 δdocalloch dominated in the lake doc fluxes the two main hydrological processes load i docalloch and d docalloch and export e docalloch dominated the δdoc whereas m docalloch and l docalloch accounted only for a small proportion of it seasonally d docalloch contributed to δdoc more in summer than in autumn and spring in spring i docalloch brings more doc probably due to the ice melt fig 5b 3 4 how does hydrology influences water color and quality and the color index owing to that the lake volume q c is calculated as the relative variation of volume from the moment t 1 to the moment t 2 eqs 2 3 we also used the relative variations of water quality parameters e g chl a and codmn and lake δdoc parameters see 3 5 from moment t 1 to moment t 2 in order to compare their correlations our analysis of the relationships of ci lake water quality indices chl a cdom and doc and hydrological parameters wl q c revealed no correlation between hydrological parameters and doc concentrations t test p 0 05 chl a variation was negatively correlated with the q c variation and ci was positively correlated to q c variation and so was also cdom with water level fig 6 this indicates that allochthonous inputs contributed more to the cdom in lake võrtsjärv 3 5 how does hydrology influences lake δdoc the results of the matrix plots of pearson correlation related to the hydrological parameters and δdoc is shown in table 3 and fig 6 lake area a water level wl and lake volume q c showed a negative correlation between δdocautoch i e nppdoc netprimaryproductivity ldocautoch mdocautoch edocautoch consistent with the results of hydrological parameters and chl a variations table 3 and fig 6 although δdocalloch dominated the lake δdoc a moderate positive correlation could be found between hydrological parameters with i docalloch and e docalloch 3 6 lake δdoc water color and quality and color index ci the results of the matrix plots of the pearson correlation related to the lake δdoc and ci and water quality parameters are shown in doc exhibited a positive correlation with δdoc consistent with chl a variations and δdocautoch r 0 6 p 0 01 indicating the autochthonous processes the lake δdoc negative correlation between ci and δdocautoch p 0 01 and positive correlation between idocalloch and ci were found table 4 and fig 6 these results showed that import i docalloch and export e docalloch contributed more to the cdom levels 4 discussion 4 1 lake δdoc and its cycling this study revealed seasonal and 5 year interannual changes of doc during the ice free period its components and their fluxes in a large and very shallow temperate lake võrtsjärv the averaged doc concentration 14 78 mg c l 1 in võrtsjärv was higher than those reported in many lakes around the world e g hungary tóth et al 2007 china ye 2012 usa fallon and brock 1979 belarus ostapenya and zhukova 2009 and israel yacobi 2006 the global mean doc concentration in surface water is 3 88 mg c l 1 toming et al 2016 and lake võrtsjärv is a very doc rich lake compared to the global mean during our 5 year study period the doc concentration in lake võrtsjärv did not increase despite the evidence of increasing oc concentrations in northern hemisphere lakes weyhenmeyer and jeppesen 2010 doc concentration in võrtsjärv seems to be controlled mostly by the regional factors such as catchment properties land use management li et al 2018b sulphur deposition evans et al 2006 hydrology and regional climate freeman et al 2001 while the global factors are apparently less influential uncommonly to the eutrophic lakes allochthonous doc fluxes dominated in lake võrtsjärv fig 5 this agrees with toming et al 2013 finding that allochthonous dom prevailed in the total dom pool of võrtsjärv even in the high primary production seasons as a product of incomplete decomposition of organic matter production of doc in catchment soil is favored at high organic matter content and c n ratios aitkenhead and mcdowell 2000 the catchment of lake võrtsjärv comprises of arable land and grassland 45 3 forest 46 1 wetland 0 6 bog 0 4 and marsh 0 1 cremona et al 2014 the soils in estonia are rich in organic matter especially the agricultural soils therefore the catchment soil doc is positively correlated with doc concentration in estonian lakes sepp et al 2019 laudon et al 2004 demonstrated that there is a strong correlation between precipitation and dom in the discharges of forested areas due to the fact that forests are rich in organic matter in the upper parts of the soil thus for catchment dominated by forest concentrations of doc and cdom can be almost two or three times higher than in other eutrophic lakes furthermore our results also indicate that the npp of watershed soil is the key to determining the role of the doc cycle model and even cdom doc relationships see 4 3 the doc and chl a had a distinct seasonal variation with the highest values in the summer autumn vegetation period we found that autochthonous doc flux δdocautoch was more strongly related to water quality indices doc and chl a than the allochthonous doc flux δdocalloch the correspondence of doc and autochthonous primary production was reported also in other studies zhang et al 2010 võrtsjärv is an eutrophic lake with high production of autochthonous doc if compared to other north european lakes the high importance of autochthonous doc flux determining doc in võrtsjärv may be explained also by the intensive export of allochthonous doc ealloch in fig 5 with the residence time approximately 240 384 days cremona et al 2019 hence lake võrtsjärv is an active site for transporting doc from the catchment area cremona et al 2014 cremona et al 2019 4 2 impacts of hydrological processes the links between hydrological and water quality parameters are generally determined by the catchment and lake own morphometry fichot et al 2011 nõges et al 2016 for shallow lakes like lake võrtsjärv the water level area and volume can strongly affect seasonal doc fluxes cdom chlorophyll a and other parameters table 3 and fig 6 we found that the hydrological parameters wl a and q c are significantly associated with cdom wl cdom r 0 84 and chl a q c chl a variations r 0 72 and are showing significant seasonal differences it is largely known that terrestrial inputs through inflowing rivers can bring large amounts of doc and cdm as well as nutrients from the catchments crawford et al 2014 brezonik et al 2015 seasonal monitoring revealed that hydrological processes were dominant in lake cdom levels wl and cdom r 0 80 and inflowing doc fluxes idocalloch wl and a r 0 50 fig 6 and fig 8 such relationships in lake võrtsjärv were reported also by cremona et al 2014 toming et al 2013 and nõges et al 2016 previous studies demonstrated that in estonian rivers cdom is positively correlated with discharge strong correlation between doc and cdom with discharges and rainfall were demonstrated in the snowmelt period in chinese watershed yinma river li et al 2016 these results indicated that the loadings of doc and cdom are more linked to the hydrological variations than to the doc and cdom levels in the tributaries moreover high water level and lake volume could decrease the biogeochemical signals averaged values of doc and chl a concentrations because of the dilution effect from april to october lake area and water level decreased and the lake volume varied significantly fig 4 consistently with the increase of lake δdoc fig 5 nõges et al 2009 reported that the high discharges of inflow rivers in spring bring more colored dom and doc into the lake generally winds blowing across the atlantic bring moist air to europe and european winters are mild and rainy then warm temperature and thawed snow ice in spring cause higher surface runoff of rivers and water levels of lakes and also bring more dom into the lakes in this study we found a higher lake docalloch and δdoc in october 2009 indicating higher δdoc variations from october 2009 to april 2010 fig 5a in the winter of 2009 2010 north atlantic oscillation index in europe was extremely negative showing cold winter fereday et al 2012 the runoffs flowed over frozen soil without effective relation to humic enrich surface layers of soils in spring toming et al 2016 unlike in other years we did not find increased docalloch and δdoc values in april 2010 4 3 variability of color index cdom absorbs light strongly in the blue part of spectrum and can therefore be used as an inexpensive and convenient proxy for doc in many inland waters griffin et al 2018 kutser et al 2015 there have been significant efforts in developing doc and cdom retrieval algorithms for satellite remote sensing brezonik et al 2015 fichot 2011 hestir et al 2015 kutser et al 2005 2015 kowalczuk et al 2013 spencer et al 2012 although the algorithms and r2 varied for each geographical region and seasons previous studies curtis and adams 1995 reported that in arid or semi arid regions saline and fresh water lakes with longer water residence times the doc concentrations are higher because of the accumulation due to intensive evaporation lakes in humid regions with long water residence times tend to have lower doc caused by low loading rates and the higher proportion of uncolored doc proportion due to the photo bleaching processes pace and cole 2002 the relationships between doc and cdom were variable in lake võrtsjärv coinciding both with allochthonous inputs of catchment and inner primary production fig 8 there is a limit in our capability to predict lake organic carbon from cdom due to the high variability in cdom doc ratio in different lakes as well it is shown in this study that there are significant seasonal differences between the cdom doc and ci in our study we found that there is a positive correlation between idocalloch and ci fig 8b this indicates that inflow rivers influence the water color of the lake allochthonous contributions of doc can be changed in several ways e g runoff inputs atmospheric deposition these allochthonous fractions could also increase the concentration of cdom and water colour as the streams are draining into the lake doc and dom from soil organic matter generally have more humic acids than those derived from autochthonous algal and microbial precursor material hood et al 2005 cole et al 2007 also demonstrated that the allochthonous doc is mainly cdom while the autochthonous doc is mostly as un colored fraction in lake võrtsjärv allochthonous dom had higher d13c values than autochthonous dom au dom toming et al 2013 when water goes through the high organic soils these doc dom fractions can be leached and drained into rivers and finally into the lake systems see 4 2 bringing more colored dom it can be found that in fig 6 and fig 3b in our study cdom was positively correlated with idocalloch fig 6 which is a key process contributing to lake doc fluxes in all winter months ice period soil is frozen and there is low microbial activity to degrade the oc in soil this means that more humic materials will be generated in soil and transported with melting ice to rivers in spring than during the other months there is a high microbial activity in summer but usually little rain meaning that the autochthonous part dominates in summer the doc of terrestrial origin starts to increase again in autumn as lots of doc was produced during summer and rains bring it finally into the lake in autumn in addition the association of dissolved iron with doc can change the intensity of light absorption and different decay rates of iron and cdom change the ratio between coloured and non coloured parts of doc kutser et al 2015 in lakes of boreal forest the rapid water exchange and high primary production increase the proportion of autochthonous non colored doc zhang et al 2010 we found that δdocautoch together with chl a concentrations had an important impact on ci in lake võrtsjärv fig 6 for eutrophic lake the high share of autochthonous doc in lake võrtsjärv may limit our ability to map doc with remote sensing nevertheless doc had statistically highly significant correlations collinearity between cdom in 2010 and 2013 r 0 80 r2 0 6 p 0 01 fig s2 there are periods when cdom doc relationship in lake võrtsjärv allows to use cdom as a proxy for doc however the proportions of allochthonous and autochthonous material in doc vary seasonally and interannually on large scale making long time remote sensing studies of lake doc less reliable 4 4 uncertainties and implements of remote sensing first our estimation of lake δdoc did not consider the contribution of doc sedimentation to the whole lake doc budget eq 5 7 in hydrologically passive lakes sedimentation rates are notoriously difficult to measure accurately hanson et al 2011 in some cases the relative contribution of sediment respiration to doc mineralization is strongly affected by water column depth and is comparable to hydrological discharge thus in such shallow lakes as võrtsjärv water level fluctuations also modify lake depth and thus the resuspension of sediment particles affecting the balance of heat water and substances zhang et al 2010 as well as the mineralization rates which also vary in different seasons together with temperature table s3 kankaala et al 2006 showed that oc accumulated in the sediments produces a minor proportion of co2 flux to the atmosphere in finnish lakes cremona et al 2014 simulated that the oc load export sedimentation and respiration for lake võrtsjärv were greater than in other lakes in estonia as retention index ri input output input of oc budgets ranged between 12 nohipalo mustjärv estonia and 99 nohipalo valgõjärv estonia nevertheless during the ice covered period oc fluxes would not be ceased and this could increase uncertainty of lake δdoc still it should be noted that environmental characteristics have determined effect on the cdom doc levels and comprehensive models related to all available environmental datasets need to be considered in estimations of δdoc secondly the calculations of hydrological parameters bring more uncertainty e g lake area by ndwi and image quality modis was used in this study for lake area extraction for the purpose of higher temporal resolution twice per day modis imagery was not always available for the dates when in situ sampling took place table s1 therefore we first had to estimate what kind of uncertainties did it cause in our analysis secondly we had to keep in mind that the modis imagery has 500 m resolution mixed land water pixels cause errors in lake area estimations averaged area 269 19 km2 sun et al 2011 obtained evaluation results that the correlation coefficient between modis and tm landsattmimages water fractions is 0 97 with bias of 4 47 for a total sample number of 50423 this allows to assume that modis is adequate for mapping variations in large lake surface areas however ndwi is not a certain value for each modis scene even in a whole lake or different time table s1 liu 2012 acquired 33 cloud free scenes of modis for surface extraction of ndwi waters and found 90 threshold difference was explained by the temporal factors geometry and atmospheric conditions in our study we also estimated increasing lake area in september 2010 at decreasing water level fig 4 this can be explained that mixed pixels of wetland and small ponds can be misclassified as water because of the coarse resolution at stable water surface area of lake võrtsjärv fig s1 clouds could introduce some uncertainties hence these uncertainties in lake area could bring errors into correlation analysis between hydrological parameters and water quality and color in addition the estimations of lake δdoc could enhance uncertainty as the conventional methods for doc fluxes are generally limited to discrete measurements cdom assessments by remote sensing are increasingly available for estimating lake surface water doc and δdoc allowing the accurate evaluation of total lake c in long term temporal scales remote areas and harsh environments there are moderate correlations between cdom and doc and δdocautoch and idocalloch table 4 actually we only used four main inflow rivers e g rivers väike emajõgi õhne tarvastu and tänassilma in the lake δdoc calculations fig 1 some small inflow streams and ponds around võrtsjärv could have also contributed to the lake doc fluxes owing to that the long time climate models predict warmer and wetter climate in higher latitudes forest productivity in northern europe will increase in a few years morales et al 2007 estonia together with nordic countries have many humic lakes where the cdom concentration is high due to the terrestrial inputs forests proportions in landscape soil characteristics and less anthrophonic activities the high availability and requirements of colored proportions to the lake δdoc and morphometric changes are required to be considered in large scale monitoring in such lakes our results are consistent with the previous studies zhang et al 2010 showing that chl a concentrations have significant influences on water color due to autochthonous non colored doc however further systematic examination of doc doc fluxes and cdom is required 5 conclusions 5 year lake doc flux was modelled to quantify its interactions with hydrological parameters doc and color index cdom doc in a large shallow and eutrophic lake võrtsjärv estonia we drew the following conclusions doc concentrations in lake võrtsjärv are the highest among large shallow eutrophic lakes from which these data are available cdom is not a good predictor for doc concentration in lake võrtsjärv owing to changing hydrological processes seasonal variation of hydrological parameters lake water level area and volume controlled the lake cdom levels relative variation of lake volume correlated negatively with chl a and autochthonous doc flux and positively with color index the allochthonous doc load dominated the lake doc fluxes while autochthonous doc predicted the water colour especially during summer these outcomes demonstrate that the lake volume variation has a potential to indicate the variations of lake water color and doc fluxes the lake volume could be obtained from satellite remote sensing products area and radar altimeter water level in addition the color index could assist both local and large scale decision making on policies management for understanding autochthonous doc fluxes in a large and shallow eutrophic lake credit authorship contribution statement sijia li conceptualization methodology formal analysis visualization writing original draft kaire toming resources supervision project administration funding acquisition writing review editing tiina nõges resources writing review editing tiit kutser writing review editing declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgements for field measurements and laboratory analyses we acknowledge the help of the whole staff from estonian university of life sciences and university of tartu estonia this work was supported by institutional research funding iut21 2 of the estonian ministry of education and research by the estonian research council grants prg709 and prg302 and by the european regional developing fund and the program mobilitas pluss grant number mobtp106 the phd scholarship fellowship of li s was funded by the china scholarship council file no 201806620049 university of tartu file no 2 1 17 lt 13 08 01 2019 and china postdoctoral science foundation 2020m681056 two anonymous reviewers have provided valuable suggestions for improving this manuscript appendix a supplementary data supplementary data to this article can be found online at https doi org 10 1016 j jhydrol 2021 127331 appendix a supplementary data the following are the supplementary data to this article supplementary data 1 
3748,the gravity recovery and climate experiment grace has recently been identified as a useful tool for monitoring changes in groundwater storage gws especially in areas with sparse groundwater monitoring networks however grace s performance has not been evaluated in the highly heterogeneous indus basin ib to date the objective of this study was thus i to evaluate grace s performance in two distinctively different agro ecological zones of the ib and ii to quantify the trend of groundwater abstraction over 15 years i e from 2002 to 2017 to capture this heterogeneity at the ib the two different agro ecological zones were selected i the kabul river basin krb afghanistan and ii the lower bari doab canal lbdc command area in pakistan the groundwater storage anomalies gwsa for both regions were extracted from random pixels the results show a correlation r2 of 0 46 for lbdc and 0 32 for the krb between the gwsa and in situ measurements the results further reveal a mean annual depletion in gwsa of 304 2 749 and 301 527 mm at the lbdc and the krb respectively overall a net gws depletion during 2002 2017 at the lbdc and krb was 4 87 and 4 82 m respectively the gwsa s response to precipitation analyzed through cross correlation shows a lag of 4 and 3 months at the krb and the lbdc respectively the gwsa s poor correlation with the in situ measurements particularly in the mountainous region of the krb is driven by the 4 months lag time unlike in the lbdc i e 3 months besides the observations wells are sparse and limited the complex geomorphology and slope of the landscape also cause discrepancies in the correlation of the in situ measurements and the grace derived changes in gws at the two different agroecological zones of the ib the spatially averaged gwsa in monthly time steps is another reason for the lower correlation between grace based gwsa estimates and point based in situ measurements therefore care must be taken while using grace s output in regions with heterogeneous geomorphologic features keywords groundwater storage grace indus basin kabul river heterogeneous watersheds 1 introduction groundwater use provides distinct benefits and chances for human development velis et al 2017 it is approachable to a wide number of consumers sakthivadivel 2007 and can be utilized based on its depth the reason for which it is extracted the relationship between recharge rate against withdrawals and the distance between wells when not tainted by human interference the main advantage of groundwater is its high microbiological purity which stems from its underground location and the natural protection by the soil and geological layers and filtration during flow calow et al 1997 globally the rate of groundwater depletion rose from 126 32 km3 year 1 to 283 40 km3 year 1 between 1960 and 2000 respectively wada et al 2010 according to zektser and everett 2004 20 of the global irrigation withdrawals around 40 of total commercial activities and 50 of total urban activities are supported with withdrawals from groundwater thus depletion in groundwater resources will cause a significant interruption of their societal and ecological functions danielopol et al 2003 in both afghanistan and pakistan the population s reliance on groundwater abstraction for municipal agricultural and industrial purposes is growing day by day as a result groundwater levels are falling prompting the consumers in both countries to respond sustainably and adaptively there is a massive withdrawal of groundwater in the region of the indus basin ib according to uhl 2006 the kabul river basin krb experiences a withdrawal of 450 million m3 against recharge of 380 million m3 similarly pakistan is experiencing a mean annual recharge of 83 88 km3 against a groundwater withdrawal of 55 km3 bhutta 2005 more comprehensive groundwater governance is required to ensure the protection of groundwater resources this should include spatial resolution mapping of groundwater aimed at detecting changes in water level and volume which has largely been overlooked thus far megdal et al 2015 to effectively estimate the groundwater resources and associated fluctuations it is necessary to establish an effective groundwater monitoring network wu 2004 there are various tools and methodologies that could be used at different spatial and temporal scales to assess the changes in groundwater usually the groundwater observation wells are mostly used to indirectly extract the groundwater use information it gives point based measurements of water levels to higher accuracy and so far the observation wells both in afghanistan and pakistan are sparsely installed and their spatial and temporal maintenance and monitoring have not been systematically managed either in pakistan the groundwater observations are taken twice a year e g pre and post monsoon season shahzad et al 2020 the systematic errors may be avoided but measurements must be performed exclusively by personnel who have received adequate training rau et al 2019 in addition to systematic errors in the measurements the representativeness of the site selection for the monitoring points is a very important issue to minimize systematic errors for example a location close to main irrigation canals or drainage collectors might systematically influence or disturb the representativeness of measurements yet this approach is practically not cost effective when dealing with large river basins countries or continental geographies instead there is a need to use a system tool method which is less expensive yet accurate and capable to cover larger spatial extents with appropriate time steps therefore accurate and periodic long term measurements of aquifer levels are important to track the storage of groundwater and its changes over space and time taylor and alley 2001 recently gravity recovery and climate experiment grace based groundwater storage gws variation both in space and time and in complex aquifer systems in large heterogeneous river basins has been very instructive singh and saravanan 2020 iqbal et al 2016 the grace satellite project provides new insights into mass redistribution within the earth structure and establishes new hydrological viewpoints tapley et al 2004a tapley et al 2004b the grace satellite tracks spatio temporal changes with an unparalleled resolution in the earth s gravity field and facilitates the analysis of mass changes within hydro systems the detailed estimation of the gws changes derived from the grace satellite could be used for a decision support system in maintaining the recharge and discharge strategies within a catchment or basin since grace measures terrestrial water storage tws deriving gws change out of the tws column requires to be validated with in situ measurements of groundwater levels before being used for water resources management initiatives under local circumstances neves et al 2020 zhong et al 2018 yin et al 2018 the objective of this study was thus i to evaluate the grace s performance in two different agro ecological zones of the ib as well as ii to quantify the trend of groundwater abstraction over 15 years i e 2002 2017 the krb in afghanistan and the lower bari doab canal lbdc command area in pakistan were the two distinct agro ecological zones that were rigorously examined under the auspices of this study the krb and lbdc distinctly differ from each other not only in terms of geomorphologic features but also in terms of having large changes in the irrigation infrastructure elevation slope climatic conditions as well as management hierarchies that undergo transboundary dissociated up and downstream interactions too the addition of such an agro ecological heterogeneity component to the evaluation of grace s performance is an innovative part of this study concerning previous research in the two regions the detailed spatio temporal estimates of grace based gws were also validated against in situ groundwater levels furthermore groundwater storage anomalies gwsa were cross correlated with precipitation data to determine how variations in gws respond to precipitation 2 materials and methods 2 1 study area the ib fig 1 is a trans himalayan river basin located in south asia with an area of around 1 12 million km2 shared between pakistan 47 india 39 china 8 and afghanistan 6 fao aquastat 2011 ib hosts one of the world s biggest contiguous irrigation systems i e the ib irrigation system the key rivers network of the ib includes the kabul indus jhelum chenab ravi beas and sutlej rivers snowmelt and monsoon precipitation received at the different elevation ranges of the hindukush himalayan are the key resources which feed these rivers this study is confined to two distinctly different geographical territories of ib lying within afghanistan i e the kabul river basin krb and pakistan i e the lower bari doab canal lbdc command area experiencing two distinct agro ecological conditions the selected two agro ecological zones differ not only in terms of geomorphology but also in terms of irrigation infrastructure cropping pattern crop growth period elevation slope climatic conditions and the managerial hierarchy for example the krb upstream region is a mono crop whereas lbdc is a double or multiple crop region the growing degree days experienced at the krb are less than those in the lbdc because of the differences in elevation slope and climatic conditions etc the krb is quite large in terms of area but we choose kabul city for comparative analyses due to its agro ecological dissimilarities to the lbdc as well as the fact that the observed groundwater data availability was limited both in space and time similarly the choice of selecting the lbdc in pakistan was driven by the fact that it is part of the second largest irrigation system of pakistan s punjab province where a considerable share of groundwater is being exploited for irrigation purposes nawaz et al 2021 the ib is famous for its sizeable population of about 250 million in 2013 vinca et al 2021 of which around 10 million people are living in the krb akhtar et al 2018 besides differences in terms of precipitation land use and land cover soil and hydro geology irrigated infrastructure are rather more developed in the lbdc compared to that of the krb moreover the lbdc has continuously more irrigated plains than the krb furthermore the krb is experiencing substantial groundwater extraction for municipal reasons whereas in the lbdc groundwater extraction serves both drinking and agricultural purposes but pumping for irrigation is dominating in terms of quantity the northern flank of the krb is mountainous with an elevation range of 383 5982 m above sea level m a s l akhtar 2017 while the lbdc is located at an elevation of 177 m a s l 2 2 climate the krb receives most of its precipitation in the form of snow in the winter december to february whereas in the lbdc most of the precipitation is received in the form of rainfall primarily during the monsoon season june to september during the study period of 2002 to 2017 the mean annual precipitation in the krb and lbdc was 372 and 323 mm respectively huntington et al 2017 the mean annual reference evapotranspiration et0 in the krb at the point where groundwater well is located and lbdc was 1268 mm and 1438 mm respectively huntington et al 2017 in the krb the peak et0 is from june to july while the highest precipitation is received between november and march conversely in the lbdc the peak et0 is between june and july while the peak precipitation is from june to september fig 2 2 3 the methodological framework to analyze the groundwater storage in the indus basin a methodological framework was established for i evaluating the performance of gws changes estimation through the grace satellite in the ib and for ii quantification of the trend in the gws change the key components of this framework were the tws data that was retrieved from the grace and the soil moisture snow water equivalent anomalies which were retrieved from the global land data assimilation system gldas as shown in fig 3 the aforementioned two components retrieved from gldas were subtracted from the tws changes to calculate the gwsa in situ groundwater fluctuation data was used to validate the eventual gwsa the resultant gwsa was then further analyzed at monthly seasonal and annual time scales as a final step gwsa s response to precipitation was analyzed in lbdc groundwater recharge is highly driven by irrigation followed by precipitation being received whereas in krb precipitation is the principle driver for changes in the gws 2 3 1 estimation of groundwater storage from grace and gldas the terrestrial water storage anomaly derived from grace twsgrace has been calculated relative to the 2004 to 2009 mean baseline it is a hydrological component that cumulates various components of the water cycle the following equation 1 shows the key components of twsgrace 1 twsa grace g w s a s w e a s m s a s w s a where gwsa swea smsa and swsa represent the anomalies relative to 2004 2009 of gws snow water equivalent swe soil moisture storage sms and surface water storage sws respectively the gwsa changes can be extracted by rearranging eq 1 2 gwsa twsa grace s w e a s m s a s w s a in eq 2 the twsa grace was derived from the grace while the rest of the components were derived from the gldas the sws particularly in dry and semi arid environments might be overlooked to predict groundwater changes according to hu et al 2019 since it is the invariant constant and twsa is confined to sws only this fact has been also been considered by frappart and ramillien 2018 yang et al 2015 and deng and chen 2017 therefore we extracted gwsa from twsagrace using swea and smsa variables the resultant eq 3 became as follows 3 gwsa t w s a g r a c e s w e a s m s a 2 3 1 1 retrieval of the terrestrial water storage anomalies from grace the grace is a joint mission of nasa and the german aerospace agency dlr and was launched in 2002 it has provided an alternate data source for observing large scale mass changes in the earth s system tapley et al 2004a the grace based derived twsa grace used in this study has a spatial resolution of 10x10 and a temporal resolution of one month the twsgrace covering april 2002 to june 2017 was downloaded from nasa s website https grace jpl nasa gov data get data by using the grace data analysis tool 2 3 1 2 retrieval of sms and swe anomalies from gldas the swe and sms data were retrieved from gldas beaudoing and rodell 2019 rodell et al 2004 fang et al 2009 for this purpose the gldas noah model noah 2 1 monthly 0 250 was chosen the data were retrieved from the nasa goddard earth sciences data and information services center https giovanni gsfc nasa gov giovanni the sms has been modeled into four different depths 0 10 10 40 40 100 and 100 200 cm the aggregate of which covers a depth of 200 cm the anomalies of both the data sets swea and smss were made with respect to 2004 2009 and were subtracted from the twsagrace as shown above in eq 3 2 3 2 aanalysis of the change in groundwater storage anomalies for the detailed analysis of the change in gwsa monthly annual and seasonal time steps were considered changes of gws in monthly time steps will yield details about the recharge and discharge which happens throughout the year in the form of irrigation application rainfall occurrence evapotranspiration groundwater withdrawal etc similarly estimation of groundwater changes at the seasonal and annual scales will provide in depth information about the season to season fluctuation in the gws which is projected to have been depleting from year to year due to excessive and unsustainable withdrawals the seasonal analyses will be based on kharif april september and rabi october march kharif is the season that receives the monsoon rains and is also known as summer whereas rabi season is often called winter season too in the krb kharif and rabi are called summer and winter seasons and the crops grown in these seasons are called summer and winter crops respectively 2 4 performance evaluation of the groundwater storage anomalies the quantitative evaluation of the gwsa changes thus estimated have been carried out at the krb and the lbdc the key indicator used in this case was groundwater level data which was collected from the krb and the lbdc covering a period of october 2006 to june 2013 monthly for the former and of april 2005 to october 2017 for the latter 2 4 1 in situ data collection and conversion of groundwater level into groundwater storage determination of groundwater depth and spatio temporal behavior of groundwater level are essential parameters for understanding the operation ability of an aquifer to validate the fluctuation in gws across the ib groundwater level data were used for the krb data was collected from taher et al 2013 which covers a temporal period of monthly recordings from october 2006 to june 2013 those readings which have been taken under dynamic conditions where pumping has been done the very day or a day earlier were omitted for validating the grace based derived gwsa similarly for lbdc the groundwater level data collected from the punjab irrigation department pid covers the period of april and october of 2005 to 2017 i e the pre monsoon and post monsoon situation the groundwater depth gwd was then converted to groundwater head gwh by subtracting from depth to bedrock dtb equation 4 to obtain gwsaactual the changes in gwh i e δgwh were multiplied by a specific yield of the aquifer system in which the wells are located eq 5 specific yield value for aquifer systems of lbdc and krb was acquired from the literature iqbal et al 2016 the average gws was transformed to gwsa relative to 2004 to 2009 the computed gwsa has been termed gwsa actual the in situ generated gwsaactual and gwsa grace were compared at the krb and lbdc 4 gwh d t b g w d 5 gwsa actual δ g w h s p e c i f i c y i e l d 2 4 2 trend analysis in the groundwater storage anomalies using the mann kendall trend test the mann kendall mk trend test mann 1945 kendall 1975 based on the correlation between the ranks and sequences of a time series was used to find out if there exists a monotonic trend in the changes in gws across the ib for a given time series xi i 1 2 n the null hypothesis h0 assumes it is independently distributed and the alternative hypothesis h1 is that there exists a monotonic trend the test statistic s is given by the following eq 6 6 s i k 1 n 1 l k 1 n s g n x il x ik i 1 12 where in eq 6 k l indices representing year k 1 2 n l 2 3 n i indices representing month i 1 2 12 n number of years si mk statistic for month i xil data point for month i year l xik data point for month j and year k further details about the mk trend test can be found in mann 1945 and kendall 1975 2 4 3 relationship of groundwater storage anomalies and precipitation since the spatial resolution of the grace product is very coarse i e 10 10 it is quite difficult to evaluate the impact of irrigation rainfall and other local processes upon an aquifer s water storage it is even more difficult under conditions where there is high heterogeneity in terms of elevation irrigated lands irrigation strategies and efficiencies cropping patterns and other agro ecological characteristics however in this study we used cross correlation to find out the gws s response lag months to the precipitation in both regions in areas where the strong negative trend of gwsa over time biases the simple correlation coefficients and to incorporate the autocorrelation in gwsa we additionally performed an econometric analysis by employing a simple vector autoregressive model var for both the krb and lbdc 3 results and discussion 3 1 analysis of the changes in groundwater storage anomalies 3 1 1 variation of the groundwater storage anomalies in monthly time steps in fig 4 the temporal analysis of the gws anomalies in lbdc reveals that throughout the year a decrease in the gws starts from february till june recharging the aquifers starts from july onwards coinciding with the start of the monsoon season of june to october overall with 56 97 79 8 mm the lbdc experienced the highest decrease in gws in june conversely in the krb a decrease in the gws starts in august onwards krb experienced the highest mean depletion in gws in february which was about 52 3 54 mm the groundwater aquifers recharge starts with the increase in temperature leading to snowmelt from february onwards 3 1 2 variation of the groundwater storage anomalies in annual time steps fig 5 depicts an analysis of the annual variation of the gws the lbdc and krb experienced a mean decrease in gwsa of 389 2 749 mm and 301 3 527 mm respectively throughout the study period the maximum increase in the gwsa of 1 221 mm was observed for the lbdc in 2003 while the highest increase for the krb of 401 mm was observed for 2002 we recorded with 1 288 5 mm and 1 073 4 mm the largest decreases in the gwsa in 2016 respectively for the lbdc and the krb in general we noted a decreasing trend in the gwsa for both the lbdc and the krb but also inconsistencies in the gwsa in both regions mainly because of the extreme drought in 2004 and 2008 in the krb pervez et al 2014 in 2010 the gwsa in the lbdc was 974 40 mm which was refilled to 487 87 in 2011 raising the gws in this case can be justified with the extreme rainfall and consequent flood events during 2011 haq et al 2012 the net depletions in gwsa throughout the study period experienced in the lbdc are 4868 mm and in the krb 4821 mm fig 5 the average net loss per year at the lbdc and the krb has been 304 and 301 mm respectively mack et al 2013 report a mean decrease of 0 0 7 m year in groundwater level in kabul city during the 2004 2008 against 1 5 m year during the 2008 2012 period due to excessive groundwater withdrawals mack 2018 3 1 3 variation of the groundwater storage anomalies in seasonal time steps the changes in gws were analyzed for two distinct seasons namely kharif april september and rabi october march while analyzing the changes in the gwsa trend between 2002 and 2017 we observed a continuous declination towards the end of the study period the inter seasonal comparison of gwsa fig 6 shows that throughout this period lbdc experienced 189 424 mm the highest declination in the gwsa during the kharif season compared to 72 7 285 mm in the krb similarly during the rabi season krb experienced 241 2 267 mm the highest declination in the gwsa compared to the 94 6 397 6 mm in the lbdc during rabi most of the precipitation is received at the krb in the form of snowfall and its contribution to the gws is delayed by 4 months i e until the snow melts therefore the gws response in terms of recharge is often observed in the kharif season of april to september at the lbdc maximum reduction in gws takes place in kharif driven by irrigation as well as municipal consumption most of the water consuming crops i e rice cotton sugarcane maize etc are grown in the kharif season peña arancibia et al 2021 in the krb withdrawal from groundwater is dominated by municipal consumption as shown in fig 6 there has been a consistent decrease in the gwsa during both kharif and rabi seasons at both the study regions with gwsa is consistently decreasing since 2007 3 2 correlation of the grace derived groundwater storage anomalies and in situ measurements the grace based estimation of the changes in gwsa was compared to in situ measurements 1 observation well each for krb and lbdc for the krb and lbdc in situ measurements were available from 2005 to 2013 and from 2005 to 2017 respectively while comparing the gwsa and in situ measurements the resultant correlation coefficients for the krb and lbdc were 0 32 and 0 46 respectively figs 7 and 8 the weaker correlation for the krb is driven by several factors i the complex geomorphological nature of the mountainous krb and slope of the landscape which cause extended lag i e 4 months for precipitation to reach the groundwater table hence the grace does detect the changes in gwsa even within the subsurface below 200 cm while conversely the in situ measurements tell us only about the variation in groundwater table and certainly not about the moisture which is yet to percolate and join the groundwater ii the grace derived gwsa are spatially averaged while in situ measurements are point specific the aquifer s surface slope has a remarkable effect on the infiltration capacity of surface water generally in a low sloped area the surface water generated by precipitation has more time to retain on the ground surface and to infiltrate and percolate into the soil subsurface conversely in a steeply sloped terrain there is reduced time for precipitation retention on the soil surface and hence reduces the groundwater recharge potential rajaveni et al 2017 as well as leads to a timely mismatch between groundwater observations and those derived from grace satellite 3 3 trend analysis of the annual gwsa through the mann kan kendall trend test analyzing the trend in annual gwsa during the study period for both regions the minimum maximum and mean gwsa values for krb were 1073 38 401 5 and 301 3 mm respectively and those for the lbdc 1288 5 1221 6 and 304 2 mm respectively table 1 an approximation has been used to compute the value of p the resultant statistics for both the sites are summarized in table 2 the value of p both for the krb and lbdc has been less than the alpha value i e p α 0 05 which allowed us to reject the null hypothesis and accept that there is a decreasing trend in the mean annual gwsa the comparative analysis of sen s slope for the lbdc and krb shows a higher magnitude of the decreasing trend for lbdc i e 145 71 compared to that of krb i e 103 187 table 3 the steeper slope and the high value of sen s slope of lbdc reveal rather an increased decline of gws compared to that of the krb fig 9 3 4 relationship of groundwater storage changes and precipitation the fig 10 explains the interactive relationship between precipitation and gwsa the lbdc received most of its precipitation in the monsoon period june to september and the response of gwsa was observed after a lag of three months fig 11 the gws response to precipitation and irrigation in terms of increase in the gws is however dependent on the temperature depth of groundwater hydraulic properties of soil layers and other variables too in kabul the lower aquifer beds are older deposits that have been consolidated and subsided over time as they have been replaced by newer deposits they have become more consolidated and compact as the depth has increased in the case of krb most of the precipitation is usually received from november to february march since the temperatures are cold and the soil profile is mostly frozen the slow melting and infiltration into the groundwater increases the lag time and therefore the peak recharge of the groundwater is visible in may to june against the lowest level in december to january hence the lag between precipitation and gwsa in the krb was observed with a lag of 4 months strong seasonality of both precipitation and gws was observed for both the lbdc and krb we plotted the mean monthly precipitation and monthly gwsa averaged over the entire observational period of 2002 to 2017 and observed that the peak level of gws lags the peak level of precipitation by approximately three months in lbdc and by four months in the krb fig 11 this pattern is confirmed for the krb by looking at cross correlations between gwsa and precipitation where the positive correlation is strongest for the fourth lag of precipitation r 0 21 p value of 0 005 even though the correlation is positive and significant it is lower than one would expect mainly due to the very strong negative trend observed for gws over time fig 11 the cross correlations between gws and precipitation are even less precise in the case of lbdc where the strong negative trend of gwsa over time biases the simple correlation coefficients to account for this and to incorporate the autocorrelation in gws we additionally performed an econometric analysis by employing a simple var for both regions again the strong positive impact of the fourth lag of precipitation is very clear in the case of krb while in the case of the lbdc the positive impact is observed in the case of the first and second precipitation lags however again the precision of the estimates for lbdc is much lower in this case irrigation is the main factor because high percolation and seepage losses in the network and at field level drive the gws i e groundwater recharge in this case especially due to the complex interplay between irrigation and rainfall further and more detailed analyses are needed which can build on the findings of our study a similar study on the response of groundwater storage to precipitation in northern china shows a lag of 3 4 months xu et al 2021 which is similar to our findings in the current study while zhu et al 2021 report a lag of up to 2 months between snow water equivalent and twsa across the ib however the very study doesn t relate the segregated gwsa from twsa with precipitation in terms of lag which might involve the geomorphological characteristics of the landforms 4 summary and conclusion the groundwater aquifers are the key sources of freshwater across the ib there has been increasing dependency on the groundwater resources not only for municipal and agricultural consumption but a heavy amount is being additionally exploited by the industrial sector the quantification of the withdrawal of groundwater by sector is still not clear across the ib meanwhile there are fewer or almost no facilities to replace the ever increasing usage of groundwater for industrial and agricultural consumption yet if the present trend of over exploitation of the groundwater continues the supply of drinking water will be most affected especially in the case of krb where there is an overall 100 dependency on groundwater in addition to overexploitation in terms of quantity groundwater quality is heavily impacted through percolation loaded with fertilizers and plant protective agents from irrigated fields as well as effluent from the textile industry and thereby endangering groundwater as the major source for drinking water provision during the study period of 2002 to 2017 the krb and lbdc experienced a mean annual decline of 30 1 and 30 4 cm respectively of the gws in general from 2002 to 2017 the krb and lbdc experienced a total reduction of 4 82 and 4 87 m in gws respectively based on the results of our analysis there is a decreasing trend in the gwsa at both sites and if it persists in the future it will have dire consequences for the municipal water sector in the krb and irrigated agriculture in the lbdc since the total dependency of the krb on groundwater for the supply of drinking water one of the immediate remedies to partially mitigate the steady decrease in the gws would be to artificially recharge the groundwater aquifers as well as harvest the precipitation as much as possible for the lbdc the farmers and irrigation directorates need to introduce high efficiency irrigation methods or cultivate low delta crops for water saving to lessen the groundwater withdrawal as the only alternative for the time being besides targeted legislation based on improved monitoring of groundwater in terms of quality and quantity as well as advanced analyses of spatiotemporal groundwater behavior is essential to regulate the groundwater recharge and avoid over exploitation of this precious resource while comparing the inter seasonal withdrawal of groundwater throughout the study period during the rabi season of october to march the krb experienced a higher decline in gws i e mean gwsa 241 21 267 17 mm than the lbdc i e mean gwsa 94 6 397 6 mm the reason behind the relatively higher decline in the gwsa in the krb compared to lbdc during october and march is that krb stays dry normally after april while lbdc receives heavy monsoon rains from june to september which infiltrate and contribute to the gws conversely in the kharif season of april to september the lbdc experienced a higher decline i e mean gwsa 189 424 2 mm compared to the krb i e mean gwsa 72 7 285 2 mm as the krb receives most of its precipitation from december to february march which then infiltrates with a lag time of 4 months and replenishes the gws the decreasing trend of gws within just 15 years 2002 2017 highlights the insufficient attention stakeholders and governing bodies are paying to the sustainability of the groundwater resources its management and future planning initiatives for regions like the krb where there is no immediate alternative to groundwater as the source for drinking water the current decreasing trend of gws might be disastrous in the years ahead and as a result shallow water wells will dry up soon the projected climate change scenarios predict more flash floods rajbhandari et al 2015 leading to further reduction of the recharge rate and increased runoffs ahmad et al 2012 as well as the conversion of the snow part of the precipitation into rainfall at the high elevations of the ib besides all other issues conflicts over this precious resource are likely to increase in the long run too these results are improving the information on the spatiotemporal groundwater situation including trends and therefore could be used to draw plans for sustainable groundwater resources management both at the krb and the lbcd as the lives of millions are dependent on these vital groundwater resources credit authorship contribution statement fazlullah akhtar conceptualization data curation visualization methodology writing original draft rana ali nawaz methodology formal analysis writing review editing mohsin hafeez conceptualization writing review editing usman khalid awan conceptualization writing review editing christian borgemeister supervision writing review editing bernhard tischbein formal analysis methodology writing review editing declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgment the corresponding author of this research paper is supported by the sdg fellowship of the university of bonn germany 
3748,the gravity recovery and climate experiment grace has recently been identified as a useful tool for monitoring changes in groundwater storage gws especially in areas with sparse groundwater monitoring networks however grace s performance has not been evaluated in the highly heterogeneous indus basin ib to date the objective of this study was thus i to evaluate grace s performance in two distinctively different agro ecological zones of the ib and ii to quantify the trend of groundwater abstraction over 15 years i e from 2002 to 2017 to capture this heterogeneity at the ib the two different agro ecological zones were selected i the kabul river basin krb afghanistan and ii the lower bari doab canal lbdc command area in pakistan the groundwater storage anomalies gwsa for both regions were extracted from random pixels the results show a correlation r2 of 0 46 for lbdc and 0 32 for the krb between the gwsa and in situ measurements the results further reveal a mean annual depletion in gwsa of 304 2 749 and 301 527 mm at the lbdc and the krb respectively overall a net gws depletion during 2002 2017 at the lbdc and krb was 4 87 and 4 82 m respectively the gwsa s response to precipitation analyzed through cross correlation shows a lag of 4 and 3 months at the krb and the lbdc respectively the gwsa s poor correlation with the in situ measurements particularly in the mountainous region of the krb is driven by the 4 months lag time unlike in the lbdc i e 3 months besides the observations wells are sparse and limited the complex geomorphology and slope of the landscape also cause discrepancies in the correlation of the in situ measurements and the grace derived changes in gws at the two different agroecological zones of the ib the spatially averaged gwsa in monthly time steps is another reason for the lower correlation between grace based gwsa estimates and point based in situ measurements therefore care must be taken while using grace s output in regions with heterogeneous geomorphologic features keywords groundwater storage grace indus basin kabul river heterogeneous watersheds 1 introduction groundwater use provides distinct benefits and chances for human development velis et al 2017 it is approachable to a wide number of consumers sakthivadivel 2007 and can be utilized based on its depth the reason for which it is extracted the relationship between recharge rate against withdrawals and the distance between wells when not tainted by human interference the main advantage of groundwater is its high microbiological purity which stems from its underground location and the natural protection by the soil and geological layers and filtration during flow calow et al 1997 globally the rate of groundwater depletion rose from 126 32 km3 year 1 to 283 40 km3 year 1 between 1960 and 2000 respectively wada et al 2010 according to zektser and everett 2004 20 of the global irrigation withdrawals around 40 of total commercial activities and 50 of total urban activities are supported with withdrawals from groundwater thus depletion in groundwater resources will cause a significant interruption of their societal and ecological functions danielopol et al 2003 in both afghanistan and pakistan the population s reliance on groundwater abstraction for municipal agricultural and industrial purposes is growing day by day as a result groundwater levels are falling prompting the consumers in both countries to respond sustainably and adaptively there is a massive withdrawal of groundwater in the region of the indus basin ib according to uhl 2006 the kabul river basin krb experiences a withdrawal of 450 million m3 against recharge of 380 million m3 similarly pakistan is experiencing a mean annual recharge of 83 88 km3 against a groundwater withdrawal of 55 km3 bhutta 2005 more comprehensive groundwater governance is required to ensure the protection of groundwater resources this should include spatial resolution mapping of groundwater aimed at detecting changes in water level and volume which has largely been overlooked thus far megdal et al 2015 to effectively estimate the groundwater resources and associated fluctuations it is necessary to establish an effective groundwater monitoring network wu 2004 there are various tools and methodologies that could be used at different spatial and temporal scales to assess the changes in groundwater usually the groundwater observation wells are mostly used to indirectly extract the groundwater use information it gives point based measurements of water levels to higher accuracy and so far the observation wells both in afghanistan and pakistan are sparsely installed and their spatial and temporal maintenance and monitoring have not been systematically managed either in pakistan the groundwater observations are taken twice a year e g pre and post monsoon season shahzad et al 2020 the systematic errors may be avoided but measurements must be performed exclusively by personnel who have received adequate training rau et al 2019 in addition to systematic errors in the measurements the representativeness of the site selection for the monitoring points is a very important issue to minimize systematic errors for example a location close to main irrigation canals or drainage collectors might systematically influence or disturb the representativeness of measurements yet this approach is practically not cost effective when dealing with large river basins countries or continental geographies instead there is a need to use a system tool method which is less expensive yet accurate and capable to cover larger spatial extents with appropriate time steps therefore accurate and periodic long term measurements of aquifer levels are important to track the storage of groundwater and its changes over space and time taylor and alley 2001 recently gravity recovery and climate experiment grace based groundwater storage gws variation both in space and time and in complex aquifer systems in large heterogeneous river basins has been very instructive singh and saravanan 2020 iqbal et al 2016 the grace satellite project provides new insights into mass redistribution within the earth structure and establishes new hydrological viewpoints tapley et al 2004a tapley et al 2004b the grace satellite tracks spatio temporal changes with an unparalleled resolution in the earth s gravity field and facilitates the analysis of mass changes within hydro systems the detailed estimation of the gws changes derived from the grace satellite could be used for a decision support system in maintaining the recharge and discharge strategies within a catchment or basin since grace measures terrestrial water storage tws deriving gws change out of the tws column requires to be validated with in situ measurements of groundwater levels before being used for water resources management initiatives under local circumstances neves et al 2020 zhong et al 2018 yin et al 2018 the objective of this study was thus i to evaluate the grace s performance in two different agro ecological zones of the ib as well as ii to quantify the trend of groundwater abstraction over 15 years i e 2002 2017 the krb in afghanistan and the lower bari doab canal lbdc command area in pakistan were the two distinct agro ecological zones that were rigorously examined under the auspices of this study the krb and lbdc distinctly differ from each other not only in terms of geomorphologic features but also in terms of having large changes in the irrigation infrastructure elevation slope climatic conditions as well as management hierarchies that undergo transboundary dissociated up and downstream interactions too the addition of such an agro ecological heterogeneity component to the evaluation of grace s performance is an innovative part of this study concerning previous research in the two regions the detailed spatio temporal estimates of grace based gws were also validated against in situ groundwater levels furthermore groundwater storage anomalies gwsa were cross correlated with precipitation data to determine how variations in gws respond to precipitation 2 materials and methods 2 1 study area the ib fig 1 is a trans himalayan river basin located in south asia with an area of around 1 12 million km2 shared between pakistan 47 india 39 china 8 and afghanistan 6 fao aquastat 2011 ib hosts one of the world s biggest contiguous irrigation systems i e the ib irrigation system the key rivers network of the ib includes the kabul indus jhelum chenab ravi beas and sutlej rivers snowmelt and monsoon precipitation received at the different elevation ranges of the hindukush himalayan are the key resources which feed these rivers this study is confined to two distinctly different geographical territories of ib lying within afghanistan i e the kabul river basin krb and pakistan i e the lower bari doab canal lbdc command area experiencing two distinct agro ecological conditions the selected two agro ecological zones differ not only in terms of geomorphology but also in terms of irrigation infrastructure cropping pattern crop growth period elevation slope climatic conditions and the managerial hierarchy for example the krb upstream region is a mono crop whereas lbdc is a double or multiple crop region the growing degree days experienced at the krb are less than those in the lbdc because of the differences in elevation slope and climatic conditions etc the krb is quite large in terms of area but we choose kabul city for comparative analyses due to its agro ecological dissimilarities to the lbdc as well as the fact that the observed groundwater data availability was limited both in space and time similarly the choice of selecting the lbdc in pakistan was driven by the fact that it is part of the second largest irrigation system of pakistan s punjab province where a considerable share of groundwater is being exploited for irrigation purposes nawaz et al 2021 the ib is famous for its sizeable population of about 250 million in 2013 vinca et al 2021 of which around 10 million people are living in the krb akhtar et al 2018 besides differences in terms of precipitation land use and land cover soil and hydro geology irrigated infrastructure are rather more developed in the lbdc compared to that of the krb moreover the lbdc has continuously more irrigated plains than the krb furthermore the krb is experiencing substantial groundwater extraction for municipal reasons whereas in the lbdc groundwater extraction serves both drinking and agricultural purposes but pumping for irrigation is dominating in terms of quantity the northern flank of the krb is mountainous with an elevation range of 383 5982 m above sea level m a s l akhtar 2017 while the lbdc is located at an elevation of 177 m a s l 2 2 climate the krb receives most of its precipitation in the form of snow in the winter december to february whereas in the lbdc most of the precipitation is received in the form of rainfall primarily during the monsoon season june to september during the study period of 2002 to 2017 the mean annual precipitation in the krb and lbdc was 372 and 323 mm respectively huntington et al 2017 the mean annual reference evapotranspiration et0 in the krb at the point where groundwater well is located and lbdc was 1268 mm and 1438 mm respectively huntington et al 2017 in the krb the peak et0 is from june to july while the highest precipitation is received between november and march conversely in the lbdc the peak et0 is between june and july while the peak precipitation is from june to september fig 2 2 3 the methodological framework to analyze the groundwater storage in the indus basin a methodological framework was established for i evaluating the performance of gws changes estimation through the grace satellite in the ib and for ii quantification of the trend in the gws change the key components of this framework were the tws data that was retrieved from the grace and the soil moisture snow water equivalent anomalies which were retrieved from the global land data assimilation system gldas as shown in fig 3 the aforementioned two components retrieved from gldas were subtracted from the tws changes to calculate the gwsa in situ groundwater fluctuation data was used to validate the eventual gwsa the resultant gwsa was then further analyzed at monthly seasonal and annual time scales as a final step gwsa s response to precipitation was analyzed in lbdc groundwater recharge is highly driven by irrigation followed by precipitation being received whereas in krb precipitation is the principle driver for changes in the gws 2 3 1 estimation of groundwater storage from grace and gldas the terrestrial water storage anomaly derived from grace twsgrace has been calculated relative to the 2004 to 2009 mean baseline it is a hydrological component that cumulates various components of the water cycle the following equation 1 shows the key components of twsgrace 1 twsa grace g w s a s w e a s m s a s w s a where gwsa swea smsa and swsa represent the anomalies relative to 2004 2009 of gws snow water equivalent swe soil moisture storage sms and surface water storage sws respectively the gwsa changes can be extracted by rearranging eq 1 2 gwsa twsa grace s w e a s m s a s w s a in eq 2 the twsa grace was derived from the grace while the rest of the components were derived from the gldas the sws particularly in dry and semi arid environments might be overlooked to predict groundwater changes according to hu et al 2019 since it is the invariant constant and twsa is confined to sws only this fact has been also been considered by frappart and ramillien 2018 yang et al 2015 and deng and chen 2017 therefore we extracted gwsa from twsagrace using swea and smsa variables the resultant eq 3 became as follows 3 gwsa t w s a g r a c e s w e a s m s a 2 3 1 1 retrieval of the terrestrial water storage anomalies from grace the grace is a joint mission of nasa and the german aerospace agency dlr and was launched in 2002 it has provided an alternate data source for observing large scale mass changes in the earth s system tapley et al 2004a the grace based derived twsa grace used in this study has a spatial resolution of 10x10 and a temporal resolution of one month the twsgrace covering april 2002 to june 2017 was downloaded from nasa s website https grace jpl nasa gov data get data by using the grace data analysis tool 2 3 1 2 retrieval of sms and swe anomalies from gldas the swe and sms data were retrieved from gldas beaudoing and rodell 2019 rodell et al 2004 fang et al 2009 for this purpose the gldas noah model noah 2 1 monthly 0 250 was chosen the data were retrieved from the nasa goddard earth sciences data and information services center https giovanni gsfc nasa gov giovanni the sms has been modeled into four different depths 0 10 10 40 40 100 and 100 200 cm the aggregate of which covers a depth of 200 cm the anomalies of both the data sets swea and smss were made with respect to 2004 2009 and were subtracted from the twsagrace as shown above in eq 3 2 3 2 aanalysis of the change in groundwater storage anomalies for the detailed analysis of the change in gwsa monthly annual and seasonal time steps were considered changes of gws in monthly time steps will yield details about the recharge and discharge which happens throughout the year in the form of irrigation application rainfall occurrence evapotranspiration groundwater withdrawal etc similarly estimation of groundwater changes at the seasonal and annual scales will provide in depth information about the season to season fluctuation in the gws which is projected to have been depleting from year to year due to excessive and unsustainable withdrawals the seasonal analyses will be based on kharif april september and rabi october march kharif is the season that receives the monsoon rains and is also known as summer whereas rabi season is often called winter season too in the krb kharif and rabi are called summer and winter seasons and the crops grown in these seasons are called summer and winter crops respectively 2 4 performance evaluation of the groundwater storage anomalies the quantitative evaluation of the gwsa changes thus estimated have been carried out at the krb and the lbdc the key indicator used in this case was groundwater level data which was collected from the krb and the lbdc covering a period of october 2006 to june 2013 monthly for the former and of april 2005 to october 2017 for the latter 2 4 1 in situ data collection and conversion of groundwater level into groundwater storage determination of groundwater depth and spatio temporal behavior of groundwater level are essential parameters for understanding the operation ability of an aquifer to validate the fluctuation in gws across the ib groundwater level data were used for the krb data was collected from taher et al 2013 which covers a temporal period of monthly recordings from october 2006 to june 2013 those readings which have been taken under dynamic conditions where pumping has been done the very day or a day earlier were omitted for validating the grace based derived gwsa similarly for lbdc the groundwater level data collected from the punjab irrigation department pid covers the period of april and october of 2005 to 2017 i e the pre monsoon and post monsoon situation the groundwater depth gwd was then converted to groundwater head gwh by subtracting from depth to bedrock dtb equation 4 to obtain gwsaactual the changes in gwh i e δgwh were multiplied by a specific yield of the aquifer system in which the wells are located eq 5 specific yield value for aquifer systems of lbdc and krb was acquired from the literature iqbal et al 2016 the average gws was transformed to gwsa relative to 2004 to 2009 the computed gwsa has been termed gwsa actual the in situ generated gwsaactual and gwsa grace were compared at the krb and lbdc 4 gwh d t b g w d 5 gwsa actual δ g w h s p e c i f i c y i e l d 2 4 2 trend analysis in the groundwater storage anomalies using the mann kendall trend test the mann kendall mk trend test mann 1945 kendall 1975 based on the correlation between the ranks and sequences of a time series was used to find out if there exists a monotonic trend in the changes in gws across the ib for a given time series xi i 1 2 n the null hypothesis h0 assumes it is independently distributed and the alternative hypothesis h1 is that there exists a monotonic trend the test statistic s is given by the following eq 6 6 s i k 1 n 1 l k 1 n s g n x il x ik i 1 12 where in eq 6 k l indices representing year k 1 2 n l 2 3 n i indices representing month i 1 2 12 n number of years si mk statistic for month i xil data point for month i year l xik data point for month j and year k further details about the mk trend test can be found in mann 1945 and kendall 1975 2 4 3 relationship of groundwater storage anomalies and precipitation since the spatial resolution of the grace product is very coarse i e 10 10 it is quite difficult to evaluate the impact of irrigation rainfall and other local processes upon an aquifer s water storage it is even more difficult under conditions where there is high heterogeneity in terms of elevation irrigated lands irrigation strategies and efficiencies cropping patterns and other agro ecological characteristics however in this study we used cross correlation to find out the gws s response lag months to the precipitation in both regions in areas where the strong negative trend of gwsa over time biases the simple correlation coefficients and to incorporate the autocorrelation in gwsa we additionally performed an econometric analysis by employing a simple vector autoregressive model var for both the krb and lbdc 3 results and discussion 3 1 analysis of the changes in groundwater storage anomalies 3 1 1 variation of the groundwater storage anomalies in monthly time steps in fig 4 the temporal analysis of the gws anomalies in lbdc reveals that throughout the year a decrease in the gws starts from february till june recharging the aquifers starts from july onwards coinciding with the start of the monsoon season of june to october overall with 56 97 79 8 mm the lbdc experienced the highest decrease in gws in june conversely in the krb a decrease in the gws starts in august onwards krb experienced the highest mean depletion in gws in february which was about 52 3 54 mm the groundwater aquifers recharge starts with the increase in temperature leading to snowmelt from february onwards 3 1 2 variation of the groundwater storage anomalies in annual time steps fig 5 depicts an analysis of the annual variation of the gws the lbdc and krb experienced a mean decrease in gwsa of 389 2 749 mm and 301 3 527 mm respectively throughout the study period the maximum increase in the gwsa of 1 221 mm was observed for the lbdc in 2003 while the highest increase for the krb of 401 mm was observed for 2002 we recorded with 1 288 5 mm and 1 073 4 mm the largest decreases in the gwsa in 2016 respectively for the lbdc and the krb in general we noted a decreasing trend in the gwsa for both the lbdc and the krb but also inconsistencies in the gwsa in both regions mainly because of the extreme drought in 2004 and 2008 in the krb pervez et al 2014 in 2010 the gwsa in the lbdc was 974 40 mm which was refilled to 487 87 in 2011 raising the gws in this case can be justified with the extreme rainfall and consequent flood events during 2011 haq et al 2012 the net depletions in gwsa throughout the study period experienced in the lbdc are 4868 mm and in the krb 4821 mm fig 5 the average net loss per year at the lbdc and the krb has been 304 and 301 mm respectively mack et al 2013 report a mean decrease of 0 0 7 m year in groundwater level in kabul city during the 2004 2008 against 1 5 m year during the 2008 2012 period due to excessive groundwater withdrawals mack 2018 3 1 3 variation of the groundwater storage anomalies in seasonal time steps the changes in gws were analyzed for two distinct seasons namely kharif april september and rabi october march while analyzing the changes in the gwsa trend between 2002 and 2017 we observed a continuous declination towards the end of the study period the inter seasonal comparison of gwsa fig 6 shows that throughout this period lbdc experienced 189 424 mm the highest declination in the gwsa during the kharif season compared to 72 7 285 mm in the krb similarly during the rabi season krb experienced 241 2 267 mm the highest declination in the gwsa compared to the 94 6 397 6 mm in the lbdc during rabi most of the precipitation is received at the krb in the form of snowfall and its contribution to the gws is delayed by 4 months i e until the snow melts therefore the gws response in terms of recharge is often observed in the kharif season of april to september at the lbdc maximum reduction in gws takes place in kharif driven by irrigation as well as municipal consumption most of the water consuming crops i e rice cotton sugarcane maize etc are grown in the kharif season peña arancibia et al 2021 in the krb withdrawal from groundwater is dominated by municipal consumption as shown in fig 6 there has been a consistent decrease in the gwsa during both kharif and rabi seasons at both the study regions with gwsa is consistently decreasing since 2007 3 2 correlation of the grace derived groundwater storage anomalies and in situ measurements the grace based estimation of the changes in gwsa was compared to in situ measurements 1 observation well each for krb and lbdc for the krb and lbdc in situ measurements were available from 2005 to 2013 and from 2005 to 2017 respectively while comparing the gwsa and in situ measurements the resultant correlation coefficients for the krb and lbdc were 0 32 and 0 46 respectively figs 7 and 8 the weaker correlation for the krb is driven by several factors i the complex geomorphological nature of the mountainous krb and slope of the landscape which cause extended lag i e 4 months for precipitation to reach the groundwater table hence the grace does detect the changes in gwsa even within the subsurface below 200 cm while conversely the in situ measurements tell us only about the variation in groundwater table and certainly not about the moisture which is yet to percolate and join the groundwater ii the grace derived gwsa are spatially averaged while in situ measurements are point specific the aquifer s surface slope has a remarkable effect on the infiltration capacity of surface water generally in a low sloped area the surface water generated by precipitation has more time to retain on the ground surface and to infiltrate and percolate into the soil subsurface conversely in a steeply sloped terrain there is reduced time for precipitation retention on the soil surface and hence reduces the groundwater recharge potential rajaveni et al 2017 as well as leads to a timely mismatch between groundwater observations and those derived from grace satellite 3 3 trend analysis of the annual gwsa through the mann kan kendall trend test analyzing the trend in annual gwsa during the study period for both regions the minimum maximum and mean gwsa values for krb were 1073 38 401 5 and 301 3 mm respectively and those for the lbdc 1288 5 1221 6 and 304 2 mm respectively table 1 an approximation has been used to compute the value of p the resultant statistics for both the sites are summarized in table 2 the value of p both for the krb and lbdc has been less than the alpha value i e p α 0 05 which allowed us to reject the null hypothesis and accept that there is a decreasing trend in the mean annual gwsa the comparative analysis of sen s slope for the lbdc and krb shows a higher magnitude of the decreasing trend for lbdc i e 145 71 compared to that of krb i e 103 187 table 3 the steeper slope and the high value of sen s slope of lbdc reveal rather an increased decline of gws compared to that of the krb fig 9 3 4 relationship of groundwater storage changes and precipitation the fig 10 explains the interactive relationship between precipitation and gwsa the lbdc received most of its precipitation in the monsoon period june to september and the response of gwsa was observed after a lag of three months fig 11 the gws response to precipitation and irrigation in terms of increase in the gws is however dependent on the temperature depth of groundwater hydraulic properties of soil layers and other variables too in kabul the lower aquifer beds are older deposits that have been consolidated and subsided over time as they have been replaced by newer deposits they have become more consolidated and compact as the depth has increased in the case of krb most of the precipitation is usually received from november to february march since the temperatures are cold and the soil profile is mostly frozen the slow melting and infiltration into the groundwater increases the lag time and therefore the peak recharge of the groundwater is visible in may to june against the lowest level in december to january hence the lag between precipitation and gwsa in the krb was observed with a lag of 4 months strong seasonality of both precipitation and gws was observed for both the lbdc and krb we plotted the mean monthly precipitation and monthly gwsa averaged over the entire observational period of 2002 to 2017 and observed that the peak level of gws lags the peak level of precipitation by approximately three months in lbdc and by four months in the krb fig 11 this pattern is confirmed for the krb by looking at cross correlations between gwsa and precipitation where the positive correlation is strongest for the fourth lag of precipitation r 0 21 p value of 0 005 even though the correlation is positive and significant it is lower than one would expect mainly due to the very strong negative trend observed for gws over time fig 11 the cross correlations between gws and precipitation are even less precise in the case of lbdc where the strong negative trend of gwsa over time biases the simple correlation coefficients to account for this and to incorporate the autocorrelation in gws we additionally performed an econometric analysis by employing a simple var for both regions again the strong positive impact of the fourth lag of precipitation is very clear in the case of krb while in the case of the lbdc the positive impact is observed in the case of the first and second precipitation lags however again the precision of the estimates for lbdc is much lower in this case irrigation is the main factor because high percolation and seepage losses in the network and at field level drive the gws i e groundwater recharge in this case especially due to the complex interplay between irrigation and rainfall further and more detailed analyses are needed which can build on the findings of our study a similar study on the response of groundwater storage to precipitation in northern china shows a lag of 3 4 months xu et al 2021 which is similar to our findings in the current study while zhu et al 2021 report a lag of up to 2 months between snow water equivalent and twsa across the ib however the very study doesn t relate the segregated gwsa from twsa with precipitation in terms of lag which might involve the geomorphological characteristics of the landforms 4 summary and conclusion the groundwater aquifers are the key sources of freshwater across the ib there has been increasing dependency on the groundwater resources not only for municipal and agricultural consumption but a heavy amount is being additionally exploited by the industrial sector the quantification of the withdrawal of groundwater by sector is still not clear across the ib meanwhile there are fewer or almost no facilities to replace the ever increasing usage of groundwater for industrial and agricultural consumption yet if the present trend of over exploitation of the groundwater continues the supply of drinking water will be most affected especially in the case of krb where there is an overall 100 dependency on groundwater in addition to overexploitation in terms of quantity groundwater quality is heavily impacted through percolation loaded with fertilizers and plant protective agents from irrigated fields as well as effluent from the textile industry and thereby endangering groundwater as the major source for drinking water provision during the study period of 2002 to 2017 the krb and lbdc experienced a mean annual decline of 30 1 and 30 4 cm respectively of the gws in general from 2002 to 2017 the krb and lbdc experienced a total reduction of 4 82 and 4 87 m in gws respectively based on the results of our analysis there is a decreasing trend in the gwsa at both sites and if it persists in the future it will have dire consequences for the municipal water sector in the krb and irrigated agriculture in the lbdc since the total dependency of the krb on groundwater for the supply of drinking water one of the immediate remedies to partially mitigate the steady decrease in the gws would be to artificially recharge the groundwater aquifers as well as harvest the precipitation as much as possible for the lbdc the farmers and irrigation directorates need to introduce high efficiency irrigation methods or cultivate low delta crops for water saving to lessen the groundwater withdrawal as the only alternative for the time being besides targeted legislation based on improved monitoring of groundwater in terms of quality and quantity as well as advanced analyses of spatiotemporal groundwater behavior is essential to regulate the groundwater recharge and avoid over exploitation of this precious resource while comparing the inter seasonal withdrawal of groundwater throughout the study period during the rabi season of october to march the krb experienced a higher decline in gws i e mean gwsa 241 21 267 17 mm than the lbdc i e mean gwsa 94 6 397 6 mm the reason behind the relatively higher decline in the gwsa in the krb compared to lbdc during october and march is that krb stays dry normally after april while lbdc receives heavy monsoon rains from june to september which infiltrate and contribute to the gws conversely in the kharif season of april to september the lbdc experienced a higher decline i e mean gwsa 189 424 2 mm compared to the krb i e mean gwsa 72 7 285 2 mm as the krb receives most of its precipitation from december to february march which then infiltrates with a lag time of 4 months and replenishes the gws the decreasing trend of gws within just 15 years 2002 2017 highlights the insufficient attention stakeholders and governing bodies are paying to the sustainability of the groundwater resources its management and future planning initiatives for regions like the krb where there is no immediate alternative to groundwater as the source for drinking water the current decreasing trend of gws might be disastrous in the years ahead and as a result shallow water wells will dry up soon the projected climate change scenarios predict more flash floods rajbhandari et al 2015 leading to further reduction of the recharge rate and increased runoffs ahmad et al 2012 as well as the conversion of the snow part of the precipitation into rainfall at the high elevations of the ib besides all other issues conflicts over this precious resource are likely to increase in the long run too these results are improving the information on the spatiotemporal groundwater situation including trends and therefore could be used to draw plans for sustainable groundwater resources management both at the krb and the lbcd as the lives of millions are dependent on these vital groundwater resources credit authorship contribution statement fazlullah akhtar conceptualization data curation visualization methodology writing original draft rana ali nawaz methodology formal analysis writing review editing mohsin hafeez conceptualization writing review editing usman khalid awan conceptualization writing review editing christian borgemeister supervision writing review editing bernhard tischbein formal analysis methodology writing review editing declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgment the corresponding author of this research paper is supported by the sdg fellowship of the university of bonn germany 
3749,numerical modeling of saturated unsaturated flow in porous media is very challenging due to the strong nonlinearity of the richards equation in the unsaturated flow zone robust and efficient numerical models are essential to simulate the flow dynamics of regional scale subsurface systems accurately in this paper we have presented generalized mass conservative finite volume solvers for pressure head based and mixed forms of richards equation named subsurfaceflowfoam developed using openfoam framework the solution of richards equation often encounters numerical instabilities and convergence issues owing to the inherent nonlinearity of the soil water characteristic relations and sharp variations in hydrological conditions over time in this work we have proposed a stabilized and adaptive time stepping algorithm that adjusts the time step size following the solution requirements ensuring smooth convergence we have further implemented the parallel computation technique through the domain decomposition method to accelerate the computation process for large scale simulations involved in regional scale modeling the numerical results of subsurfaceflowfoam depict excellent correspondence with the data presented in the literature for a wide variety of subsurface flow problems with deficient cumulative mass balance error the solution accuracy and the computational efficiency of the solvers ensure their potential applicability to solve multi dimensional regional scale subsurface flow problems keywords subsurface flow richards equation openfoam stabilized and adaptive time stepping algorithm parallel computation 1 introduction water flow in variably saturated porous media is considered among the most complex hydrological flow processes occurring on earth following the fundamental laws of hydrodynamics richards 1931 established an equation governing the flow of water through partially saturated porous media under the actions of gravity and capillarity the equation is commonly known as richards equation re however re is derived based on the assumption that the non wetting phase air is continuous within the porous media without being trapped in discrete pockets hence air always remains at atmospheric pressure and re does not describe its motion within the porous media based on the choice of the dependent variable we can represent standard re in three alternative forms namely pressure head based form h based moisture content based form θ based and mixed form applying any form mentioned above we can predict water movement only through the unsaturated zone of porous media therefore we cannot use the standard re for various drainage and irrigation problems encountered in agricultural engineering and groundwater hydrology that involve the underlying aquifer system rubin 1968 took the first initiative toward integrated saturated and unsaturated flow modeling to solve a falling water table experiment in a two dimensional rectangular soil slab numerically nonetheless freeze 1971 made a breakthrough attempt by employing a modified form of standard re for modeling the flow of infiltrated water in the unsaturated zone underneath the ground surface and the confined and unconfined aquifers lying further below unlike aquifer systems the hydraulic conductivity within the unsaturated layer of porous media is not constant it varies continuously with the available moisture content which is again a function of the pressure head the constitutive relationships among pressure head moisture content and hydraulic conductivity in the unsaturated zone are highly nonlinear thereby the analytical solution of re is infeasible except for exceptional cases the numerical approach is the best possible alternative for solving variably saturated flow problems acceptance of any numerical scheme depends on its efficiency at predicting a subsurface system s flow dynamics and its capability to conserve mass in the process numerical techniques for solving different forms of re suffer from various stability and mass conservation issues the h based form is the original form of re derived by richards 1931 and has been comprehensively used for solving various one dimensional infiltration and drainage problems whisler and watson 1968 freeze 1969 haverkamp et al 1977 dane and mathis 1981 haverkamp and vauclin 1981 with the modification of re for solving saturated unsaturated subsurface flow the modified h based re has been extended for modeling both two dimensional cooley 1971 neuman 1973 cooley 1983 huyakorn et al 1984 and three dimensional freeze 1971 huyakorn et al 1986 flow through porous media unfortunately the numerical approximation of h based re incurs significant mass balance error due to high nonlinearity of the specific moisture capacity term van genuchten 1982 allen and murphy 1985 celia et al 1990 the numerical formulation of θ based re shows better accuracy in mass balance error relative to the h based form considering θ based re the moisture content is not continuous across the water table or the interfaces of soil layers in case of layered heterogeneity hence the applicability of θ based re is limited to unsaturated flow problems through uniform soils haverkamp et al 1977 huyakorn 2012 the numerical approximation of mixed form re overcomes the respective limitations of the h based and θ based forms and has been successfully applied for saturated unsaturated subsurface flow modeling with high global mass balance accuracy brutsaert 1971 allen and murphy 1986 celia et al 1990 clement et al 1994 dogan and motz 2005 lai and ogden 2015 li et al 2021 in reality we often come across porous media with layered heterogeneity we encounter spatial discontinuities among the soil characteristic parameters in such layered soils which hinder a smooth numerical solution of re at the soil interfaces multidomain discretization of re as proposed by berninger et al 2015 can be considered a generalized approach for modeling subsurface flow through domains decomposed into non overlapping layers suk and park 2019 applied a truncated taylor series expansion to the kirchhoff head at the material interface to avoid the dyadic characteristics arising in the numerical solution of the kirchhoff transformed re to model the effect of discontinuity at the intersection of non overlapping layered soils berardi et al 2020 presented a numerical technique based on mixed mol tmol approach which satisfactorily handles the solution behavior at the layer interfaces kumar et al 2020 overcame the spatial intricacies experienced in numerical modeling of unsaturated flow through porous media containing fractures by developing an effective re where they replaced a fracture in the porous media with an interface for re hence a robust re solver must ensure a smooth solution at the soil interfaces while numerically modeling variably saturated flow problems in heterogeneous layered porous media researchers have employed a wide range of numerical methods for the development of re solver of which finite difference fd and finite element fe methods are the most common fd spatial approximation has been applied for one dimensional unsaturated flow through vertical soil columns day and luthin 1956 whisler and watson 1968 freeze 1969 brandt et al 1971 haverkamp et al 1977 dane and mathis 1981 haverkamp and vauclin 1981 and higher dimensional saturated unsaturated flow through fractured and porous media rubin 1968 freeze 1971 cooley 1971 brutsaert 1971 celia et al 1990 kirkland et al 1992 clement et al 1994 dogan and motz 2005 an improved version of the fd method the integrated finite difference ifd method has also been used for numerical analysis of fluid flow narasimhan and witherspoon 1978 as well as simulation of nonisothermal multiphase flow and reactive transport process in permeable media finsterle et al 2008 researchers have also developed several fe method based models to solve flow and transport problems in variably saturated porous media galerkin fe method based models like unsat2 neuman 1973 femwater yeh and ward 1980 saturn huyakorn et al 1984 flaminco huyakorn et al 1986 adaptive hydrology adh howington et al 1999 hydrus šimu nek et al 2008 and control volume fe method based models like fe heat and mass transfer code fehm zyvoloski 2007 hydrogeosphere hgs brunner and simmons 2012 with the advancement of research on subsurface hydrology scientists have developed generalized computer programs and software packages to model integrated surface subsurface flow and transport phenomena on regional scales kollet and maxwell 2006 presented a generalized model parflow coupling the two dimensional overland flow with an existing three dimensional fd method based subsurface flow model ashby and falgout 1996 jones and woodward 2001 healy 2008 developed an fd method based software package vs2di incorporating the flow and heat transport simulator vs2dh into the previously developed computer program to simulate solute transport in variably saturated porous media vs2dt healy 1990 trefry and muffels 2007 developed a continuous galerkin fe method based computer program feflow to simulate density dependent variably saturated flow and transport including multi species reactive transport to model the process of surface subsurface flow and their interaction camporese et al 2010 presented the catchment hydrology cathy model which couples an fe solver for re with an fd solver for the diffusion wave equation describing the surface flow we can find another instance of coupling of fe and fd methods in the saturated unsaturated flow model developed by gao et al 2019 where they have used fe and fd methods for spatial discretization in the horizontal and vertical directions respectively yeh et al 2011 advanced the concept of catchment modeling and developed a watershed scale numerical model wash123d that combines solvers for one dimensional stream or river flow two dimensional overland flow and three dimensional subsurface flow fd and fe schemes lack robustness as they often suffer from numerical instabilities and convergence issues freeze 1971 celia et al 1990 implicit iterative methods like line successive over relaxation lsor technique or alternating direction implicit adi procedure used in the fd approximation faces convergence difficulties due to time step limitation introduced by the nonlinearity of the soil water parameters freeze 1971 however a fully implicit backward euler time approximation scheme can be a good alternative for fd method based saturated unsaturated flow models in case of problems related to infiltration into parched soil fe method based solvers produce oscillatory solutions celia et al 1990 diagonalisation of the time matrix inherent to fd approximation eliminates oscillations from the numerical solution on the other hand the mass lumping method is adopted in fe schemes to eliminate oscillations in the numerical solution until recent times the finite volume fv method has not been common among researchers for modeling variably saturated subsurface flow owing to the functional nonlinearity of involved parameters re suffers from mass conservation issues since the fv method is highly mass conservative it can be a good numerical tool for solving re eymard et al 1999 pioneered at proving the convergence of the fv scheme for discretization of the elliptic parabolic re since then successful attempts have been made in fv method based modeling of one dimensional lai and ogden 2015 li et al 2021 and two dimensional manzini and ferraris 2004 aravena and dussaillant 2009 infiltration problems horgue et al 2015 developed porousmultiphasefoam using the open source fv method based multiphysics platform openfoam for modeling three dimensional multiphase flow through both isotropic and anisotropic porous media the porousmultiphasefoam package contains multiphase models for relative permeability and capillarity and also includes a customized neumann boundary condition to impose phase velocity on the boundaries deng and wang 2017 presented an fv scheme based saturated unsaturated flow model using three dimensional re in arbitrary coordinates consequently openfoam based three dimensional saturated unsaturated flow models like sugwfoam liu 2013 and richardsfoam orgogozo et al 2014 orgogozo 2015 have also been developed another vital aspect involved in the development of a numerical solver for re is the time discretization technique the convergence of the iterative linearization process depends mainly on the time step size considered by the solver it is necessary to consider small time steps when the hydrological conditions within the flow domain change very sharply with time however small time steps would unnecessarily increase the overall computation time during smooth variations of hydrological conditions making the solver inefficient for modeling regional scale problems hence to restore the efficiency of the numerical scheme an algorithm should be implemented within the solver which continuously alters the time step size based on the evolving hydrological conditions researchers have commonly adopted time stepping algorithms based on the number of iterations required for convergence of the linearization process williams and miller 1999 liu 2013 orgogozo et al 2014 orgogozo 2015 in some numerical models a flux updating algorithm has been implemented where the time step size is adjusted based on the variations in moisture content occurring due to changes in flux kirkland et al 1992 lai and ogden 2015 li et al 2021 therefore a suitable adaptive time stepping algorithm is essential for an efficient re solver to achieve smooth convergence at minimum computation time the parallel computing technique has emerged through which an extensive computation can be broken down into small parts and computed simultaneously through multi core processors the application of parallel computing has dramatically curtailed the computation time involved in solving large scale saturated unsaturated flow problems tracy 2006 coumou et al 2008 herbst et al 2008 maxwell 2013 we can implement the parallelization strategy in a numerical model either by domain decomposition or in the form of loop level parallelism we can use the loop decomposition approach for a few processors thereby being a rare option for hydrological modeling orgogozo et al 2014 have used the domain decomposition method for the development of their open source parallel solver for re richardsfoam hence the development of parallel solvers is essential for accelerating the simulation of watershed scale hydrological problems for large time domains owing to the high nonlinearity of re its numerical solution is computationally expensive and unreliable at times farthing and ogden 2017 the focus thus should be given to the development of a robust numerical technique that is accurate mass conservative and can be applied to natural soil layers and aquifer systems subjected to a wide variety of initial and boundary conditions this paper presents a generalized parallel mathematical model based on fv approximation to evaluate subsurface flow dynamics through heterogeneous porous media we have developed separate solvers with mass conservative numerical approximations of both h based and mixed forms of re we have implemented a stabilized and adaptive time stepping algorithm for smooth convergence and increased computational efficiency we have also utilized the parallelization framework available in openfoam for speeding up the process of large scale simulations the novelty of the presented work lies in the robustness of the developed re solvers verified through their performance in reproducing the results of nine subsurface flow problems that include theoretical examples laboratory scale experiments and field tests we have also proposed an alternative approach for solving the unsteady state pumping test in an unconfined aquifer the proposed methodology considers the actual radius of the pumping well to estimate drawdown in the aquifer which is independent of grid dimensions finally we have conducted a comparative study of h based and mixed form solvers and have commented on their respective efficacies through the solved test examples 2 governing equations in conjunction with darcy s law the law of conservation of mass leads to the derivation of re governing the flow of water in unsaturated porous media the movement of water in porous media primarily takes place due to gravity and variations in the pressure head however the flow of water through the unsaturated zone is sometimes governed by the change in density of water occurring due to temperature fluctuations or alterations in solute concentration in this study we have neglected the effects of changes in temperature and solute concentration and have considered the density of water to remain constant throughout the flow process we have used the modified re presented by freeze 1971 introducing the specific storage term to use a single equation describing the flow of water through both saturated and unsaturated zones of the subsurface we can present the modified re as the following h based form 1 s s θ η c w h h x t t k h h x t z q s mixed form 2 θ t s s θ η h x t t k h h x t z q s x ω t 0 t f we can express specific storage s s with the compressibility terms α and β as 3 s s γ water α η β 3 soil water characteristic model within the unsaturated zone moisture content θ hydraulic conductivity k and specific moisture capacity c w are nonlinear functions of the pressure head h scientists have formulated several empirical models for representing the soil water relationship in the unsaturated zone some of these models are brooks and corey model brooks and corey 1964 brooks corey burdine model brooks and corey 1966 van genuchten mualem model van genuchten 1980 van genuchten and nielsen model van genuchten and nielsen 1985 and general power formula dogan 1999 in this work we have adopted the van genuchten mualem model as it is prevalent and has been widely accepted by researchers the constitutive relationship of pressure head and soil water parameters as presented in the van genuchten mualem model are as the following moisture content θ 4 θ θ r s e h θ s θ r h 0 θ s h 0 where 5 s e h 1 α w h β w γ w γ w 1 1 β w hydraulic conductivity k 6 k h k s s e h 1 2 1 1 s e h 1 γ w γ w 2 h 0 k s h 0 specific moisture capacity c w 7 c w h θ h α w γ w θ s θ r 1 γ w s e h 1 γ w 1 s e h 1 γ w γ w h 0 0 h 0 4 development of subsurfaceflowfoam subsurfaceflowfoam is a three dimensional fv method based model for evaluating the pressure head distribution in the subsurface flow domain in this project we have adopted the fv method for the numerical approximation of re as it is inherently mass conservative and we can apply it to geometrically complex domains overlaid by a regular structured or unstructured grid system dey and dhar 2020 for the development of subsurfaceflowfoam we have used the framework of fv based computational fluid dynamics toolbox openfoam jasak 1996 working in openfoam has helped us to develop our numerical model on a globally acclaimed open source platform using the functions and differential operators from the toolbox library one of the most significant advantages of developing solvers in the openfoam platform is that it facilitates parallel computing the parallel computing technique is implemented in openfoam framework through the process of domain decomposition employing the communication protocols of message passing interface mpi richardsfoam which is an existing re solver developed on openfoam platform is not robust and experiences certain runtime limitations richardsfoam employs the h based form of modified re with the standard chord slope scs approximation for the specific moisture capacity term c w the richardsfoam solver fails when specific storage s s is absent strictly unsaturated flow problems or has a value of zero moreover richardsfoam has been developed for solving variably saturated flow problems through isotropic porous media to guarantee the robustness of a solver we need to overcome the limitations suffered by richardsfoam in subsurfaceflowfoam we have modified the h based re solver of richardsfoam by introducing a switching algorithm for initializing the specific moisture capacity term c w we have also developed a mixed form based re solver in subsurfaceflowfoam following the modified picard iteration scheme celia et al 1990 4 1 approximation of the specific moisture capacity term c w researches in unsaturated zone hydrology claim that the mixed form re guarantees better mass conservation than the h based form the trick at achieving perfect mass balance for re lies in the numerical approximation and representation of the specific moisture capacity term kosugi 2008 in the numerical modeling of re using the h based form we incur significant mass balance error when we use the traditional analytical derivative form of c w given in eq 7 the mass imbalance occurs because the specific moisture capacity function is highly nonlinear and varies significantly from the fd based approximated form at discrete levels celia et al 1990 proposed a mass conservative approach for the numerical approximation of the mixed form re known as the modified picard iteration scheme in their approach they have expanded the unknown moisture content using taylor series expansion with the superscripts m denoting the picard iteration level and n denoting the time level we can express the expanded form of the unknown moisture content θ m 1 n 1 as the following θ m 1 n 1 θ m n 1 θ h m n 1 δ h o δ h 2 8 θ m 1 n 1 θ m n 1 c w h m n 1 δ h where δ h h m 1 n 1 h m n 1 applying eq 8 we can expand the time derivative of moisture content θ as the following 9 θ t θ m n 1 θ n δ t c w h m n 1 h m 1 n 1 h m n 1 δ t rathfelder and abriola 1994 presented a mass conservative approach for numerically approximating the h based re applying standard chord slope scs approximation scheme for discretizing the specific moisture capacity term c w they have also proved that their approach becomes numerically equivalent to the modified picard iteration scheme thereby ensuring mass conservation we can approximate the specific moisture capacity term c w applying the scs scheme like the following 10 c w θ h θ m n 1 θ n h m n 1 h n in subsurfaceflowfoam we have developed solvers based on both h based and mixed forms of re the mixed form solver implements the modified picard iteration scheme whereas the h based solver adopts the scs scheme to approximate specific moisture capacity term c w with the scs approximation scheme the initialization of c w requires special attention in general we begin the iterative process by setting the values of θ m n 1 and θ n to the initial θ values for the entire domain the initial approximation of c w becomes zero when evaluated using the eq 10 in the absence of specific storage s s the time derivative on the left hand side of the eq 1 becomes non existent thereby forcing a steady state solution after the first time step richardsfoam lacks the robustness expected from the solver due to this limitation to address this issue we have proposed an algorithm where we have initialized c w with the traditional analytical derivative form whenever specific storage s s is zero algorithm 1 in the subsequent iterations however we have approximated c w using the scs scheme through this approach the mass balance error increases during the early time steps and later goes down as the solution progresses with time algorithm 1 c w initialization algorithm 4 2 linearization technique due to nonlinear dependence of the soil water parameters θ k c w on the pressure head h re is one of the most complex equations to solve directly hence we need to adopt an iterative linearization procedure to obtain the numerical solution some of the iterative methods commonly used for solving re are newton s method and picard iteration method in subsurfaceflowfoam we have adopted the picard iteration method for linearizing both the h based and mixed forms of re given in the eqs 1 and 2 respectively applying eq 9 we can write the linearized mixed form of re as the following 11 θ m n 1 θ n δ t n 1 c w h m n 1 h m 1 n 1 h m n 1 δ t n 1 s s θ m n 1 η h m 1 n 1 h n δ t n 1 k h m n 1 h m 1 n 1 z q s n 1 rearranging the terms of eq 11 we can rewrite it as the following 12 c w h m n 1 s s θ m n 1 η h m 1 n 1 h m n 1 δ t n 1 k h m n 1 h m 1 n 1 z q s n 1 θ m n 1 θ n δ t n 1 s s θ m n 1 η h m n 1 h n δ t n 1 implementing the scs scheme for approximating the specific moisture capacity term c w we can present the linearized h based form of re as the following 13 s s θ m n 1 η θ m n 1 θ n h m n 1 h n h m 1 n 1 h n δ t n 1 k h m n 1 h m 1 n 1 z q s n 1 we have solved the set of linear algebraic equations given in the eqs 12 and 13 using the pre conditioned conjugate gradient pcg solver with a diagonal incomplete cholesky dic preconditioner the above solver has advantages over other iterative matrix solvers by being computationally inexpensive and showing faster convergence celia et al 1990 clement et al 1994 dogan 1999 4 3 stabilized and adaptive time stepping algorithm in subsurfaceflowfoam we have implemented a stabilized and adaptive time stepping strategy based on empirically based time step ebats scheme williams and miller 1999 not only to facilitate smooth convergence but also to reduce the computation time and expenses if the subsurfaceflowfoam solvers require more than n p u iterations to converge or if the solvers fail to converge even after n p max iterations the algorithm decreases the time step size by the factor δ f to ensure smooth convergence on the other hand if the solvers converge within n p l iterations successively for n st max time steps the algorithm increases the time step size for the next time level by a factor δ f moreover the algorithm bounds the time step size within the prescribed lower and upper limits of δ t min and δ t max respectively the stabilization technique introduced in this time stepping algorithm examines the convergence stability of the solver at the current δ t before increasing the time step size hence if we start the simulation process with a small time step size the chances of convergence failure get reduced a major drawback in the time stepping algorithm adopted in richardsfoam is that whenever convergence fails the algorithm decreases the time step size and proceeds to the next time level without recomputing the solution for the current time level in case of convergence failure at a time level n in subsurfaceflowfoam the algorithm recomputes the solution for time level n with a reduced time step size thus the time stepping algorithm adopted in subsurfaceflowfoam algorithm 2 is flexible at adapting to the convergence requirements of the solvers which ensures smooth convergence for all time steps consistently preserving the mass balance in the system algorithm 2 stabilized and adaptive time stepping algorithm in this paper we have considered the values of n p l 3 n p u 95 n p m a x 100 n s t m a x 10 δ f 1 25 and δ t min δ t 0 for the numerical test cases 4 4 convergence criteria like accuracy another vital aspect of iterative methods for solving nonlinear equations is the required computational effort careful selection of a convergence criterion optimizes the incurred computational expenses by reducing the number of iterations the solver needs to converge huang et al 1996 have mentioned three convergence criteria that we can implement on picard iteration schemes adopted for the numerical solution of the h based and mixed forms of re standard pressure head criterion 14 h m 1 n 1 h m n 1 δ h tol mixed pressure head criterion 15 h m 1 n 1 h m n 1 δ h retol h m 1 n 1 δ h tol standard moisture content criterion 16 θ m 1 n 1 θ m n 1 δ θ tol in this paper we have adopted the standard moisture content criterion with a tolerance of δ θ tol 10 6 for the numerical test cases because of its proven efficiency in terms of both accuracy and acquired computational burden 4 5 mass balance error mass balance accuracy is an essential criterion for the efficiency of a numerical model adopted for hydrological modeling in saturated unsaturated flow modeling mass conservation is dependent not only on the adopted numerical approximation scheme but also on the form of re selected for the flow model mass balance error mbe measures the ability of a model to conserve global mass within the domain of interest ideally the change of mass of water within the domain should equal the mass of water entering or leaving the domain through its boundaries during a specific time interval an error occurs when the masses mentioned above are not equal and we define the error as mass balance error we can calculate the percentage of cumulative mbe within the domain at a given time as the following 17 mbe t n 1 1 i 1 n ele θ i n 1 θ i 0 s s θ n 1 η h i n 1 h i 0 v i k 1 n 1 j 1 n b f f ϕ j k δ t k 100 although mass conservation does not guarantee the accuracy of a numerical solution a cumulative mbe of less than 1 at the end of the total simulation period is desirable for the potential acceptance of a numerical model rathfelder and abriola 1994 5 numerical tests to demonstrate the applicability of subsurfaceflowfoam we have performed a wide variety of one dimensional two dimensional and three dimensional tests including some benchmark problems laboratory tests and field scale tests we have developed some custom boundary conditions in openfoam as required for solving some of the test case problems we have presented an elaborate description of these custom boundary conditions and the boundary conditions used from openfoam library while demonstrating the respective test case problems 5 1 tc1 simple one dimensional infiltration test this simple one dimensional infiltration test is a benchmark problem that has been used for the validation of richardsfoam orgogozo et al 2014 in transient conditions the test domain is a 1 m long homogeneous loamy soil column the top boundary acts as a specified pressure head boundary whereas free drainage occurs from the bottom of the soil column fig 1 specified pressure head boundary we have specified the pressure head on a domain boundary by the following function 18 h x t h c x t we have prescribed specified pressure head boundary in subsurfaceflowfoam using fixedvalue type boundary condition from openfoam library free drainage boundary we have described the free drainage condition on a domain boundary by the following gradient function 19 k h h x t n 0 we have specified free drainage condition in subsurfaceflowfoam using fixedgradient type boundary condition from openfoam library with the gradient value equal to zero we have discretized the soil column into 100 regular elements each size 0 01 m we have considered the soil column initially unsaturated with a uniform pressure head of 1 m throughout its length the specified pressure head on the top boundary is 0 01 m we have listed the soil parameters in table 1 considering δ t 0 1 s and δ t max 3600 s we have run the simulation for 24 h using both h based and mixed form re solvers 5 2 tc2 one dimensional infiltration and redistribution test paniconi et al 1991 presented a one dimensional infiltration and redistribution problem to compare the performance of six different time discretization strategies for solving the unmodified re just like su3d model dogan and motz 2005 and sugwfoam liu 2013 we have used this example as one of the test cases for the validation of subsurfaceflowfoam the test case involves a 10 m long homogeneous soil column whose top and bottom boundaries are subjected to specified time varying flux and specified pressure head respectively fig 1 specified flux boundary we have specified the flux at a domain boundary by the following function 20 k h h x t z n q c x t in subsurfaceflowfoam we have developed specifiedconstantfluxbc type boundary condition for specifying time invariant flux condition on the domain boundary to specify time varying flux on a boundary we have developed problem specific flux boundary conditions namely specifiedtransientfluxbc1 and specifiedtransientfluxbc2 assuming a grid size of 0 01 m we have discretized the soil column into 1000 regular elements we have considered the initial pressure head distribution within the soil column to be hydrostatic with zero pressure head at the bottom boundary to specify the time varying flux at the top boundary we have used specifiedtransientfluxbc1 type boundary condition where the flux function q c is given by 21 q c t 64 m h we have listed the soil parameters considered by paniconi et al 1991 in table 1 we have conducted the simulation for 32 h using δ t 0 1 s and δ t max 20 s 5 3 tc3 free drainage test in this test case we have carried out numerical modeling of the free drainage experiment conducted at the los alamos national laboratory using a 6 m deep lysimeter abeele 1984 forsyth et al 1995 fig 1 we have selected this example because it demonstrates the transition from saturated to unsaturated conditions due to free drainage from the bottom of the soil column to ensure that no water enters the soil column we have imposed zero flux on the top boundary using specifiedconstantfluxbc type boundary condition with q c 0 at the bottom boundary we have maintained a zero pressure head so that water drains off continuously we have discretized the soil column into 600 regular elements and have initialized each element with zero pressure head to establish saturated conditions within the soil column we have presented the soil parameters considered in this study in table 1 then we have considered the adaptive time step parameters δ t 0 0 1 s and δ t max 3600 s to run the simulation for 100 days 5 4 tc4 infiltration test through a heterogeneous column with time varying boundary condition we have chosen the example presented in li et al 2021 to demonstrate the effectiveness of subsurfaceflowfoam in modeling subsurface flow through a soil column with layered heterogeneity the soil column is 1 8 m long with a clay layer bounded by sand layers on the top and bottom as shown in fig 1 the specific properties of sand and clay are summarized in table 2 the top boundary of the soil column acts as a time varying specified flux boundary whereas free drainage occurs from the bottom the time varying flux is the daily infiltration evaporation data for the simulation period of 20 days as displayed in fig 2 in subsurfaceflowfoam to specify time varying flux on a domain boundary where q c is presented in the form of time series data we have developed the boundary condition type specifiedtransientfluxbc2 we have discretized the soil column into 360 regular elements and have initialized each element with a pressure head of 1 m we have performed the flow simulation through the soil column for 20 days assuming δ t 0 1 s and δ t max 20 s 5 5 tc5 laboratory infiltration experiment with falling water table in this example we have attempted to numerically model the laboratory infiltration experiment with a falling water table conducted by childs and poulovassilis 1962 we have computed the steady state moisture content profile above the water table falling at a constant velocity with the top boundary subjected to constant rainfall intensity lai and ogden 2015 have also used this example for the validation of their proposed numerical model they have derived the van genuchten mualem soil water characteristic parameters from the moisture characteristic curve given in childs and poulovassilis 1962 we have considered these calibrated soil parameters for our simulation as listed in table 1 moving water table boundary in the case of a moving water table the pressure head at the bottom boundary varies with time as a function of the velocity of the moving water table we have specified the pressure head at the bottom boundary by the following function 22 h x t z wt v z t we have assumed the velocity v z to be positive when the water table rises and vice versa we have developed the boundary condition type movingwatertablebc in subsurfaceflowfoam to specify the pressure head at the bottom boundary in case of moving water table the sand column considered in this study is 1 5 m long fig 1 we have discretized the sand column into 300 regular elements each size 0 005 m we have assumed the water table to be located at the top boundary at t 0 s initially the sand column is wholly saturated with the hydrostatic distribution of the pressure head assuming different water table fall velocities and rainfall intensities we have carried out seven simulations with 1 v z 0 172 m h and q c 0 0265 0 06 0 1 m h 2 v z 0 344 m h and q c 0 0265 0 06 0 1 0 2 m h we have run the simulations assuming δ t 0 1 s and δ t max 20 s until the falling water table reaches the bottom of the sand column and we achieve a steady moisture content profile within the column 5 6 tc6 two dimensional variably saturated water table recharge test we have validated the applicability of subsurfaceflowfoam for two dimensional problems by modeling the transient two dimensional saturated unsaturated water table recharge experiment conducted by vauclin et al 1979 clement et al 1994 dogan and motz 2005 and liu 2013 have previously considered this benchmark problem to validate their respective numerical models the flow domain in this example is a rectangular soil slab of length 6 m and depth 2 m we have tabulated the soil parameters used by vauclin et al 1979 in their experiment in table 1 initially the water table is at the height of 0 65 m from the bottom of the domain a constant flux of 0 14791 m s is applied at the soil surface throughout 1 m at the center of the top boundary the remaining span of the top surface was kept covered to restrict evaporation losses during the experiment and we have treated it as a no flow boundary during simulation the bottom of the domain is impervious and no flow occurs through it the left and the right boundaries below the water table are specified pressure head boundaries where the pressure head distribution is hydrostatic however no flow occurs through the left and the right boundaries above the water table fig 3 shows a schematic diagram representing the domain geometry alongside the initial and boundary conditions considered for the test example hydrostatic pressure head boundary we have specified hydrostatic distribution of pressure head on a boundary by the following function 23 h x t z wt z in subsurfaceflowfoam we have developed the boundary condition type hydrostaticbc to impose hydrostatic pressure head distribution on a domain boundary we have discretized the study domain into 2400 rectangular elements with δ x 0 1 m and δ z 0 05 m we have assumed the initial distribution of pressure head to be hydrostatic throughout the domain considering δ t 0 1 s and δ t max 360 s we have modeled the flow in the domain for 8 h 5 7 tc7 two dimensional perched water table test in this example we have simulated the problem of developing a perched water table surrounded by arid unsaturated conditions kirkland et al 1992 the flow domain is a 5 m long and 3 m deep layered rectangular soil slab whose all boundaries are closed except where infiltration occurs at a rate of 0 5 m d fig 4 for developing a perched water table sand is bounded by a 1 m thick clay barrier of very low permeability on the left right and bottom the properties of sand and clay are the same as considered for tc4 given in table 2 as the effects of compressibility of the porous medium were neglected by kirkland et al 1992 we have considered the specific storage to be zero for this example we have discretized the domain into an unstructured grid system with 21970 prismatic elements in order to replicate initial arid conditions within the soil layers we have considered an initial pressure head of 500 m within the domain we have run the simulation for 24 h with δ t 0 0 01 s and δ t max 20 s to examine the formation of a perched water table above the clay layer 5 8 tc8 three dimensional water table recharge test in response to rainfall to extend the applicability of subsurfaceflowfoam to three dimensional problems we have utilized the water table recharge test in an unconfined aquifer presented by beegum et al 2018 as shown in fig 5 the hypothetical domain is 4000 m long 8000 m broad and 15 m deep with a bed slope of 0 001 along its length the flow domain is homogeneous with the soil parameters listed in table 1 an impermeable boundary bounds the bottom of the unconfined aquifer on the left and right boundaries the water table is maintained at the height of 7 m and 0 9 m from the bottom respectively hence hydrostatic distribution of pressure head is maintained along these boundaries below the water table however we have specified a constant pressure head of 1 25 m on the left and right boundaries above the water table boundaries on the front and the back along the length of the domain are no flow boundaries initially we have considered hydrostatic distribution of pressure head within the domain with the water table varying linearly between the heights maintained on the left and the right boundaries the monthly precipitation data is specified as the time varying flux on the top boundary as presented in fig 5 we have discretized the domain into a structured regular grid system consisting of 188800 elements the grid size on the horizontal plane x y plane is 100 m by 100 m we have considered δ z 0 3 m up to a height of 0 9 m from the bottom in the vertical direction above that we have assumed a constant value of δ z 0 25 m we have modeled the flow in the unconfined aquifer with a repetition of the monthly precipitation data fig 5 for 5 years considering δ t 0 3600 s and δ t max 86400 s 5 9 tc9 three dimensional field scale unconfined aquifer pumping test we have tested the field scale applicability of subsurfaceflowfoam by modeling the unconfined aquifer pumping test of nwankwor et al 1992 delayed piezometer response is very significant when the hydraulic head changes rapidly near the pumping well one of the significant challenges in evaluating the flow dynamics in an unconfined aquifer system due to extraction through a pumping well is addressing the delayed yield effect moench 1997 the estimated drawdown also depends on the diameter of the pumping well the pumping well is usually considered to be a line source to solve pumping problems in unconfined aquifers the classical analytical solutions developed by boulton 1954 dagan 1967 neuman 1972 neuman 1974 considered the pumping well diameter to be infinitesimally small thereby failing to justify the measured drawdown values at the well and in its vicinity at early times in this test case we have proposed an alternative approach to solving unconfined aquifer pumping problems considering the diameter of the pumping well to be of finite dimensions in subsurfaceflowfoam we have implemented the laplace transform solution of dimensionless drawdown for flow to a partially penetrating well of finite diameter in a slightly compressible unconfined aquifer as presented by moench 1997 assuming the homogeneity of aquifer parameters in the vicinity of the pumping well we have defined a circular time varying specified pressure head boundary around the well we have computed the pressure head from the dimensionless drawdown values obtained by numerically inverting the laplace domain solution moench 1997 we have specified the calculated pressure head on the well boundary at every time step pumping well boundary in an unconfined aquifer we have specified the pressure head along the well boundary by the following function 24 h x t z wt s a o z the derivation of drawdowns at the well boundary s a o and within the pumping well s a w are illustrated in appendix 1 to specify the time varying pressure head on the well boundary in an unconfined aquifer we have developed the boundary condition type wellunconfinedbc in subsurfaceflowfoam the test case considers a square shaped unconfined aquifer of sides 100 m and depth 9 m with a pumping well of inner diameter 0 15 m located at the center of the aquifer the pumping well has a well screen of depth 4 m at the bottom of the aquifer and operates at a constant rate of 3 6 m 3 h throughout the 24 h pumping test the unconfined aquifer is homogeneous with constant saturated hydraulic conductivity values of 5 7 m d and 3 6 m d in horizontal and vertical directions we have considered specific storage of the aquifer to be 3 25 10 4 m the soil characteristic parameter values considered in this study were calibrated by akindunni and gillham 1992 viz θ s 0 37 θ r 0 07 0 37 α w 1 9 m and β w 6 095 a thick deposit of clayey silt bounds the aquifer at the bottom making it an impermeable boundary we have also considered the other boundaries of the domain as no flow boundaries additionally the initial water table is at a depth of 2 3 m from the top of the domain due to symmetry we have modeled only a quarter of the study domain fig 6 we have discretized the selected quarter of the domain into an unstructured grid system with 29160 prismatic elements we have considered the well boundary at a radial distance of 0 5 m from the center of the pumping well initially we have assumed hydrostatic distribution of pressure head both below and above the water table throughout the domain with δ t 0 1 s and δ t max 360 s we have performed the simulation for a time span of 24 h 6 results and discussion we have evaluated the performance of subsurfaceflowfoam by comparing the numerical results of the considered test cases against the experimental data analytical solutions numerical solutions hydrus 1d 2d 3d simulation results or measured field data whenever available we have also carried out a comparative study between the h based and mixed form re solvers to comment on their accuracy efficiency and applicability for solving different variably saturated flow problems for tc1 we have compared the time evolution of average pressure head values in the soil column against the hydrus 1d results from orgogozo et al 2014 in fig 7 a we have also compared the temporal changes in water flux at the top boundary as shown in fig 7b figs 7a fig 7b reveal that the subsurfaceflowfoam results are in close agreement with the computed values of hydrus 1d through this example we have examined the performances of the re solvers and the effect of discretization of the specific moisture capacity term c w on their solution accuracy mass conservation and computational efficiency we have compared the pressure head distributions within the soil column after 16 h of simulation just before the entire soil column attains saturation in fig 8 a the solution of the h based re solver with scs approximation for c w correspond very closely with the mixed form re solver solution however the results of the h based re solver using the analytical derivative of c w lag behind the results of the other two numerical schemes near the free drainage bottom boundary in fig 8b we have shown the comparison of cumulative mbe incurred by the three numerical techniques as previously stated the h based re solver using the analytical derivative form of c w is highly inefficient in conserving mass relative to the other two numerical schemes on the contrary the h based re solver with scs approximation for c w exhibits high mass balance accuracy hence the cause of mass imbalance can be attributed to the representation of the c w term which is the only difference between the two approaches made with the h based re solver it implies that the analytical derivative of c w fails to preserve the fd approximation of θ h employed in the scs approximation scheme the mixed form re solver shows excellent mass balance accuracy using the analytical derivative of c w because the term vanishes as the solution approaches convergence for each time step nonetheless the mass conservative nature of fv approximation has contributed toward achieving low mbe in all the numerical approaches for quantifying the computational efficiency we have evaluated the measure of computational work which we can illustrate as the following rathfelder and abriola 1994 25 w comp log 10 n ts n iter we have presented the cumulative mbe and the computational work done by the three numerical schemes after 24 h of simulation in table 3 looking at table 3 we can comment that despite being mass conservative the mixed form re solver is computationally expensive than the h based solver in terms of both time and work done since mbe and the acquired computational expenses depend on initial time step size convergence criterion and time step adjustment algorithm we have considered the same values of δ t 0 and δ t max for all the numerical schemes for tc2 we have recorded the pressure head values along the length of the column at 1 2 4 10 and 32 h from the commencement of the infiltration process we have compared the recorded pressure head profiles against the results of paniconi et al 1991 in fig 9 and have found that they match perfectly with each other as we have considered hydrostatic pressure head distribution the soil near the top surface is very dry initially hence the soil near the top boundary where the time varying flux is specified requires some time to adapt to the imposed boundary condition at initial times it results in high mbe during the initial time steps that gradually decrease with time in our simulation we have considered very small δ t 0 which has facilitated overcoming the inefficiency of the picard iteration scheme during the initial time steps as experienced in paniconi et al 1991 despite high mass imbalance at early times we have achieved cumulative mbe values of 6 13 10 1 and 6 14 10 1 at the end of 32 h of simulation for the h based scs approximation and mixed form re solvers respectively demonstrating the mass conservative nature of subsurfaceflowfoam in tc3 subsurfaceflowfoam solvers successfully capture the transition from saturated to unsaturated conditions without any issue related to numerical stability and mass conservation as the simulation commences water in the initially saturated soil column starts moving down draining rapidly through the bottom under the action of gravity as a result high mbe is observed during the initial few time steps which diminishes gradually moreover due to immediate drainage from the bottom of the soil column instability arises in the system requiring many picard iterations for convergence the assumption of δ t 0 0 1 s helps smooth convergence control during this initial period as this initial phase gets over the adaptive time stepping algorithm gradually increases δ t until δ t max is reached fig 10 shows the simultaneous variation of δ t and n p with time justifying the effectiveness of the adaptive time stepping algorithm to ensure smooth convergence at reduced computational expenses we can attribute the stepped nature of the δ t curves in fig 10 to the stabilization technique adopted in the time stepping algorithm the stabilization scheme only increases the δ t value if n p is sufficiently low for 10 successive time steps eliminating convergence failure we have compared the subsurfaceflowfoam results of pressure head and moisture content after 1 4 20 and 100 days of simulation with the experimental data of forsyth et al 1995 in fig 11 a fig 11b respectively the numerical results replicate the experimental values satisfactorily thereby justifying the potential applicability of subsurfaceflowfoam for this test case additionally the cumulative mbe values at the end of 100 days simulation are 2 17 10 3 and 2 13 10 3 respectively for h based scs approximation and mixed form re solvers in tc4 we have recorded the pressure head and the moisture content within the heterogeneous soil column after 10 and 20 days of simulation we have compared these results of subsurfaceflowfoam with the numerical results presented in li et al 2021 figs 12 a fig 12b claim that the two results are in perfect agreement with each other as the bottom sand layer is overlain by a clay layer of very low hydraulic conductivity the change in top boundary flux does not affect any change in moisture content and pressure head of that layer due to continuous drainage from the bottom of the soil column the pressure head within the bottom sand layer decreases steadily for 20 days creating arid soil conditions within that layer the pressure head and moisture content increase in the top sand layer due to continuous infiltration for the initial 10 days from 10 to 20 days the top boundary flux shifts from infiltration to evaporation thereby the moisture content and the pressure head decrease within the soil column through this study subsurfaceflowfoam guarantees its robustness as it nicely adapts to the alternating episodes of infiltration and evaporation imposed on the top boundary without encountering any numerical instability both the subsurfaceflowfoam solvers exhibit smooth solution at the soil layer interfaces without any convergence issues which is generally experienced by other numerical schemes due to spatial discontinuity among soil characteristic parameters in heterogeneous layered soils furthermore subsurfaceflowfoam vividly captures the effects of heterogeneity in porous media flow through non overlapping soil layers yielding highly accurate results with cumulative mbe values as low as 5 38 10 4 and 5 37 10 4 respectively for h based scs approximation and mixed form re solvers at the end of the simulation period of 20 days for tc5 we have recorded the moisture content profile on the attainment of steady state conditions within the soil column for each simulation we have accomplished complete steady state conditions within the soil column approximately after 8 h 44 min and 4 h 22 min from the initiation of the movement of the water table with velocities v z 0 172 m h and v z 0 344 m h respectively we have shown the comparison between the simulated and the experimental moisture content profiles for v z 0 172 m h and v z 0 344 m h at different infiltration rates in fig 13 a fig 13b respectively the deviations observed from the measured data are primarily due to the errors incurred in measuring and calibrating the van genuchten mualem soil water characteristic parameters both h based scs approximation and mixed form re solvers have achieved high mass balance accuracy at the end of each simulation with sufficiently low cumulative mbe percentages in the order of 10 3 as the specific storage s s is set to zero for tc6 richardsfoam fails to simulate this problem applying subsurfaceflowfoam we have successfully modeled the spatial and temporal distribution of the phreatic surface in a two dimensional domain with desirable accuracy and guaranteed mass conservation a gradual rise in the water table is observed approximately after 1 h 20 min from the onset of simulation when the infiltrated water meets the initial water table flowing down the vadose zone we have plotted the transient positions of the water table at 2 3 4 and 8 h in fig 14 and have compared them with the experimental results of vauclin et al 1979 both results are in good agreement with each other besides the cumulative mbe values for the h based scs approximation and mixed form re solvers at the end of 8 h are 3 97 10 4 and 2 79 10 5 respectively the simulation of the perched water table problem in tc7 is challenging and requires special attention toward spatial discretization and time step size selection for convergence the solution fails to converge if the unstructured grid is generated with an equivalent characteristic length l c greater than 0 1 m as we have assumed very dry initial conditions with pressure head 500 m we have started the simulation with δ t 0 0 01 s to avoid convergence failure we have drawn the pressure head contours of 0 m and 400 m after 24 h of continuous infiltration in fig 15 a the contours agree quite well with the results of kirkland et al 1992 presented in fig 15b the top sand layer is bounded by a clay layer of very low permeability on its left right and bottom the vertical movement of infiltrated water is obstructed and water starts to get deposited above the clay layer a smooth pressure gradient is observed within the clay layer with the top and bottom interfaces at pressures of 0 m and 500 m respectively a water table starts developing locally much above the impervious bottom boundary approximately after 16 h from the commencement of infiltration if the infiltration process is ceased the water table will gradually disappear with time as water will slowly percolate vertically downward into the bottom sand layer through the clay zone such temporary formations of the local water table are quite common in natural hydrogeologic systems and the capability of the subsurfaceflowfoam solvers in simulating perched water table problem advocate their robustness moreover we have achieved very low cumulative mbe values of 4 64 10 3 and 1 57 10 2 with the h based scs approximation and the mixed form re solvers respectively the example considered in tc8 is an extension of the water table recharge problem in the three dimensional domain to reduce the simulation time we have performed parallel computation using four processors we have displayed the water table profile at the end of 5 years in fig 16 the estimated water table profile matches closely with the profile predicted by beegum et al 2018 using hydrus 2d 3d till midway along the length of the domain however subsurfaceflowfoam underestimates the recessing curvature of the phreatic surface compared to hydrus 2d 3d results presented by beegum et al 2018 the difference between the two profiles increases as we approach the right boundary with a maximum variation of 0 91 m occurring 100 m inward of the right boundary we have achieved reasonably low cumulative mbe values of 1 76 10 1 and 8 37 10 3 respectively for the h based scs approximation and mixed form re solvers at the end of 5 years simulation period the simulation of the unconfined aquifer test studied in tc9 is beyond the capability of richardsfoam since the flow domain is anisotropic we have recorded the temporal variation of pressure head at a depth of 7 m from the top and at radial distances of 5 m and 15 m from the center of the pumping well applying subsurfaceflowfoam we have compared the estimated drawdowns with the field data extracted from the time drawdown curves of nwankwor et al 1992 in fig 17 the results of subsurfaceflowfoam correspond well with the measured values addressing the delayed yield effect that arise in the vicinity of the pumping well in an unconfined aquifer conventionally a pumping well is treated as a singular point source in groundwater modeling pumping wells encountered in practice are minimal radii in the range of 0 1 0 2 m since the well and the domain scales differ significantly representing a well with the actual radius on a grid system results in issues related to grid orthogonality aspect ratio and skewness on the other hand grid convergence issues arise in drawdown calculation if we assume the effective well radius calculated by a well model dey and dhar 2020 therefore the actual well radius specification is essential for numerical modeling of pumping tests in unconfined aquifers the proposed methodology calculates the pressure head on the well boundary considering the actual radius of the pumping well thereby fulfilling the grid convergence criterion for drawdown within the well additionally the methodology successfully conserves mass with cumulative mbe values of 1 64 10 2 and 2 42 10 2 respectively for the h based scs approximation and mixed form re solvers at the end of 24 h simulation we have examined the grid convergence characteristics of subsurfaceflowfoam using the examples presented in tc1 one dimensional tc7 two dimensional and tc9 three dimensional we have parametrized the increase in solution accuracy with spatial grid refinement by calculating the difference between the simulated results for two levels of grid refinement relative to the simulated results for the coarser grid we have investigated the grid convergence characteristics for three levels of grid refinement for each of the above test cases a summary of the grid convergence study for tc1 tc7 and tc9 is presented in table 4 for tc1 we have run the simulation for vertical step sizes of 10 2 10 3 and 10 4 m to inspect the increase in solution accuracy we have compared the evolution of the mean pressure head with time in the soil column for the three levels of vertical discretization for the examples considered in tc7 and tc9 we have performed three levels of spatial discretization of the respective domains into unstructured grid systems the unstructured grids were generated using characteristic lengths l c of 0 04 0 02 and 0 01 m for tc7 and 12 5 6 25 and 3 125 m for tc9 we have compared the temporal variations in pressure head at 2 5 0 2 5 for the three levels of spatial discretization for the perched water table problem on the other hand we have analyzed the drawdowns at a radial distance of 5 m from the center of the pumping well at different times for the three levels of the unstructured grid system in the unconfined aquifer pumping test the results in table 4 reveal a distinct increase in solution accuracy with finer spatial discretization thereby satisfying the grid convergence criteria for any numerical scheme moreover we have also observed that with grid refinement there is a marked decrease in the number of iterations n p required for convergence of the picard iteration scheme in tc7 for the first discretization level l c 0 04 approximately 8 47 of the total time steps required more than 3 picard iterations for convergence however for the other two discretization levels l c 0 02 0 01 convergence was achieved within 3 picard iterations for all time steps in tc9 subsurfaceflowfoam solvers converged within 3 picard iterations for all the three spatial discretization levels the percentage of the time steps that converged within 2 picard iterations increased from 45 17 to 52 36 after the first level of grid refinement and finally to 62 62 after the second level of grid refinement nonetheless we have not observed any considerable variation in the order of mass balance accuracy with changing grid dimensions for the examined test cases 7 conclusions in this research work we have presented a generalized fv based numerical model subsurfaceflowfoam to model subsurface flow through heterogeneous porous media we have developed mass conservative solvers for both h based and mixed forms of re both the solvers estimate the subsurface flow dynamics with desirable accuracy for the considered test cases another important aspect of this study is the ability of the solvers to conserve global mass during simulation in all the test cases the cumulative mbe is less than the desirable limit of 1 for both the subsurfaceflowfoam solvers under the conservative property of the fv method we have presented the comparative representation of the acquired cumulative mbe in fig 18 the comparison between the mbe percentages incurred by two subsurfaceflowfoam solvers reveals that both are efficient at conserving the global mass of water within the flow system the scs approximation of the c w term adopted for the h based re solver successfully overcomes the non conservative nature of the h based re producing results with high mass balance accuracy the computation time for all the test cases tabulated in table 5 reveals that the h based solver is marginally faster between the two solvers the test problems simulated in this study do not involve large scale simulations to utilize the benefits of a parallel solver however the parallelization strategies embedded in openfoam are sufficient to establish the advantages of applying subsurfaceflowfoam to solve regional scale problems on large time scales ranging in the orders of decades and centuries the behavior of the solution of re constantly varies throughout the simulation period due to the strong nonlinearity of the involved parameters an assumption of uniform δ t is inappropriate for an re solver implementation of the stabilized and adaptive time stepping algorithm adjusts the time step size δ t dynamically following the changing hydrological conditions initially the pressure head changes drastically within the system due to imposed initial and boundary conditions hence we have initiated the simulation with a small value of δ t for all the test cases to ensure smooth convergence as the system stabilized or approached steady state conditions the algorithm has increased the value of δ t to preserve the computational efficiency of the solver while simulating the considered test cases we have not encountered any convergence or numerical instability issue the primary objective of this study is to develop a generalized re solver to model a wide variety of subsurface flow problems ranging from laboratory scale experiments to watershed scale regional studies equipped with advanced computation facilities of parallelization the advantage of developing the solvers in a universally acclaimed open source framework like openfoam is that the computer program becomes easily accessible to other users on the other hand standard library operators and functions make the computer program readily interpretable among practitioners enhancing its applicability to practical problems in conclusion the performance evaluation of subsurfaceflowfoam proves its potential applicability at simulating subsurface flow through homogeneous and heterogeneous porous media on both laboratory and regional scales source code availability the source code can be downloaded from the link https github com gwres subsurfaceflowfoam notations c w specific moisture capacity l 1 d depth of the top of the well screen below the initial water table l d s thickness of the well bore skin l f ϕ flux normal to the face of an element l 3 t 1 h pressure head l h c known pressure head function l k hydraulic conductivity tensor lt 1 k r hydraulic conductivity in the horizontal direction lt 1 k s saturated hydraulic conductivity tensor lt 1 k sw hydraulic conductivity of the well bore skin lt 1 k z hydraulic conductivity in the vertical direction lt 1 k 0 zero order modified bessel function of second kind k 1 first order modified bessel function of second kind l depth of the bottom of the well screen below the initial water table l n b f number of boundary faces in the domain of interest n ele number of elements in the domain of interest n iter total number of iterations n p number of picard iterations required for convergence at any time step n p l n p u lower and upper limits of the number of picard iterations respectively for effecting a change in time step size n p max maximum number of allowable picard iterations n s number of terms used in the stehfest algorithm n st max maximum number of stabilization counters for adaptive time stepping algorithm n ts number of time steps n normal vector at the boundary q p volumetric extraction rate of the pumping well l 3 t 1 q c known flux function lt 1 q s internal source or sink term l 3 t 1 l 3 r radial distance of the well boundary from centre of the pumping well l r w radius of the pumping well l r wc inside radius of the pumped well in the interval where water levels change during pumping l s e degree of saturation m 0 l 0 t 0 s s specific storage l 1 s y specific yield m 0 l 0 t 0 s a o drawdown at the well boundary l s a w drawdown at the pumping well l s a o d laplace transform of dimensionless drawdown at the well boundary m 0 l 0 t 0 s a w d laplace transform of dimensionless drawdown at the pumping well m 0 l 0 t 0 s c stabilization counter for adaptive time stepping algorithm t f final solution time t t time coordinate t v volume of an element l 3 v z velocity of the moving water table lt 1 w weighting coefficients in stehfest algorithm w comp measure of computational work x vector of space coordinates in the euclidean space l z vertical coordinate positive upward from the bottom of the domain l z a o hydraulic head at the well boundary l z a w hydraulic head at the pumping well l z wt height of the water table above the bottom of the domain l γ water unit weight of water on earth at 4 c ml 2 t 2 δ t time step size t δ t min δ t max minimum and maximum time step size respectively t δ t 0 initial time step size t δ x δ z grid size in x and z directions respectively l δ f time step adjustment factor δ h retol relative tolerance for mixed pressure head convergence criterion l δ h tol tolerance for standard pressure head convergence criterion l δ θ tol tolerance for standard moisture content convergence criterion m 0 l 0 t 0 η porosity of the medium m 0 l 0 t 0 θ moisture content m 0 l 0 t 0 θ r residual moisture content m 0 l 0 t 0 θ s saturated moisture content m 0 l 0 t 0 α compressibility of the porous medium m 1 lt 2 α uc empirical drainage constant t 1 α w soil specific coefficient equivalent to the capillary length scale l 1 β compressibility of water m 1 lt 2 β w soil specific exponent m 0 l 0 t 0 ω physical domain credit authorship contribution statement saumava dey conceptualization methodology validation writing original draft anirban dhar supervision writing review editing declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper appendix a this appendix provides the steps involved in the computation of drawdown s a o at the well boundary given in eq 24 the expressions for the dimensionless parameters used in drawdown calculation are presented in table 6 we can calculate the laplace transform of the dimensionless drawdown s a o d at a radial distance r from the center of the pumping well as a 1 s a o d r d z d p uc 2 e uc p uc l d d d 1 w d p uc a uc s w where a 2 a uc 2 l d d d n 0 k 0 q 1 n sin n 1 d d sin n 1 l d 2 n q 1 n k 1 q 1 n n 0 5 sin 2 n a 3 e uc 2 n 0 k 0 q 2 n cos n z d sin n 1 d d sin n 1 l d q 1 n k 1 q 1 n n 0 5 sin 2 n a 4 q 1 n p uc n 2 β uc d 0 5 a 5 q 2 n q 1 n r d and n are the roots of a 6 n tan n p uc σ uc β uc d p uc γ uc n 1 2 3 we have computed the summations in eqs a 2 and a 3 for n c terms where n c can be evaluated as a 7 n c max n c min min n c max n c max 2 log 10 β uc 2 in this paper we have assumed the values of n c min and n c max as 4 and 30 respectively to evaluate the dimensionless drawdown s a o d at the well boundary we have performed numerical inversion of the laplace domain solution given in eq a 1 applying stehfest algorithm stehfest 1970 stehfest algorithm calculates the dimensionless drawdown s a o d as follows a 8 s a o d t d ln 2 t d j 1 n s w j s a o d r d z d p u c where a 9 p uc j ln 2 t d a 10 w j 1 n s 2 j k j 1 2 min j n s 2 k n s 2 2 k n s 2 k k k 1 j k 2 k j moreover we can calculate the laplace domain solution of the dimensionless drawdown in the pumping well as follows a 11 s a w d p uc 2 a uc s w p uc l d d d 1 w d p uc a uc s w we can evaluate the dimensionless drawdown at the pumping well s a w d using the stehfest algorithm similarly as done for the well boundary in eqs a 8 a 10 
3749,numerical modeling of saturated unsaturated flow in porous media is very challenging due to the strong nonlinearity of the richards equation in the unsaturated flow zone robust and efficient numerical models are essential to simulate the flow dynamics of regional scale subsurface systems accurately in this paper we have presented generalized mass conservative finite volume solvers for pressure head based and mixed forms of richards equation named subsurfaceflowfoam developed using openfoam framework the solution of richards equation often encounters numerical instabilities and convergence issues owing to the inherent nonlinearity of the soil water characteristic relations and sharp variations in hydrological conditions over time in this work we have proposed a stabilized and adaptive time stepping algorithm that adjusts the time step size following the solution requirements ensuring smooth convergence we have further implemented the parallel computation technique through the domain decomposition method to accelerate the computation process for large scale simulations involved in regional scale modeling the numerical results of subsurfaceflowfoam depict excellent correspondence with the data presented in the literature for a wide variety of subsurface flow problems with deficient cumulative mass balance error the solution accuracy and the computational efficiency of the solvers ensure their potential applicability to solve multi dimensional regional scale subsurface flow problems keywords subsurface flow richards equation openfoam stabilized and adaptive time stepping algorithm parallel computation 1 introduction water flow in variably saturated porous media is considered among the most complex hydrological flow processes occurring on earth following the fundamental laws of hydrodynamics richards 1931 established an equation governing the flow of water through partially saturated porous media under the actions of gravity and capillarity the equation is commonly known as richards equation re however re is derived based on the assumption that the non wetting phase air is continuous within the porous media without being trapped in discrete pockets hence air always remains at atmospheric pressure and re does not describe its motion within the porous media based on the choice of the dependent variable we can represent standard re in three alternative forms namely pressure head based form h based moisture content based form θ based and mixed form applying any form mentioned above we can predict water movement only through the unsaturated zone of porous media therefore we cannot use the standard re for various drainage and irrigation problems encountered in agricultural engineering and groundwater hydrology that involve the underlying aquifer system rubin 1968 took the first initiative toward integrated saturated and unsaturated flow modeling to solve a falling water table experiment in a two dimensional rectangular soil slab numerically nonetheless freeze 1971 made a breakthrough attempt by employing a modified form of standard re for modeling the flow of infiltrated water in the unsaturated zone underneath the ground surface and the confined and unconfined aquifers lying further below unlike aquifer systems the hydraulic conductivity within the unsaturated layer of porous media is not constant it varies continuously with the available moisture content which is again a function of the pressure head the constitutive relationships among pressure head moisture content and hydraulic conductivity in the unsaturated zone are highly nonlinear thereby the analytical solution of re is infeasible except for exceptional cases the numerical approach is the best possible alternative for solving variably saturated flow problems acceptance of any numerical scheme depends on its efficiency at predicting a subsurface system s flow dynamics and its capability to conserve mass in the process numerical techniques for solving different forms of re suffer from various stability and mass conservation issues the h based form is the original form of re derived by richards 1931 and has been comprehensively used for solving various one dimensional infiltration and drainage problems whisler and watson 1968 freeze 1969 haverkamp et al 1977 dane and mathis 1981 haverkamp and vauclin 1981 with the modification of re for solving saturated unsaturated subsurface flow the modified h based re has been extended for modeling both two dimensional cooley 1971 neuman 1973 cooley 1983 huyakorn et al 1984 and three dimensional freeze 1971 huyakorn et al 1986 flow through porous media unfortunately the numerical approximation of h based re incurs significant mass balance error due to high nonlinearity of the specific moisture capacity term van genuchten 1982 allen and murphy 1985 celia et al 1990 the numerical formulation of θ based re shows better accuracy in mass balance error relative to the h based form considering θ based re the moisture content is not continuous across the water table or the interfaces of soil layers in case of layered heterogeneity hence the applicability of θ based re is limited to unsaturated flow problems through uniform soils haverkamp et al 1977 huyakorn 2012 the numerical approximation of mixed form re overcomes the respective limitations of the h based and θ based forms and has been successfully applied for saturated unsaturated subsurface flow modeling with high global mass balance accuracy brutsaert 1971 allen and murphy 1986 celia et al 1990 clement et al 1994 dogan and motz 2005 lai and ogden 2015 li et al 2021 in reality we often come across porous media with layered heterogeneity we encounter spatial discontinuities among the soil characteristic parameters in such layered soils which hinder a smooth numerical solution of re at the soil interfaces multidomain discretization of re as proposed by berninger et al 2015 can be considered a generalized approach for modeling subsurface flow through domains decomposed into non overlapping layers suk and park 2019 applied a truncated taylor series expansion to the kirchhoff head at the material interface to avoid the dyadic characteristics arising in the numerical solution of the kirchhoff transformed re to model the effect of discontinuity at the intersection of non overlapping layered soils berardi et al 2020 presented a numerical technique based on mixed mol tmol approach which satisfactorily handles the solution behavior at the layer interfaces kumar et al 2020 overcame the spatial intricacies experienced in numerical modeling of unsaturated flow through porous media containing fractures by developing an effective re where they replaced a fracture in the porous media with an interface for re hence a robust re solver must ensure a smooth solution at the soil interfaces while numerically modeling variably saturated flow problems in heterogeneous layered porous media researchers have employed a wide range of numerical methods for the development of re solver of which finite difference fd and finite element fe methods are the most common fd spatial approximation has been applied for one dimensional unsaturated flow through vertical soil columns day and luthin 1956 whisler and watson 1968 freeze 1969 brandt et al 1971 haverkamp et al 1977 dane and mathis 1981 haverkamp and vauclin 1981 and higher dimensional saturated unsaturated flow through fractured and porous media rubin 1968 freeze 1971 cooley 1971 brutsaert 1971 celia et al 1990 kirkland et al 1992 clement et al 1994 dogan and motz 2005 an improved version of the fd method the integrated finite difference ifd method has also been used for numerical analysis of fluid flow narasimhan and witherspoon 1978 as well as simulation of nonisothermal multiphase flow and reactive transport process in permeable media finsterle et al 2008 researchers have also developed several fe method based models to solve flow and transport problems in variably saturated porous media galerkin fe method based models like unsat2 neuman 1973 femwater yeh and ward 1980 saturn huyakorn et al 1984 flaminco huyakorn et al 1986 adaptive hydrology adh howington et al 1999 hydrus šimu nek et al 2008 and control volume fe method based models like fe heat and mass transfer code fehm zyvoloski 2007 hydrogeosphere hgs brunner and simmons 2012 with the advancement of research on subsurface hydrology scientists have developed generalized computer programs and software packages to model integrated surface subsurface flow and transport phenomena on regional scales kollet and maxwell 2006 presented a generalized model parflow coupling the two dimensional overland flow with an existing three dimensional fd method based subsurface flow model ashby and falgout 1996 jones and woodward 2001 healy 2008 developed an fd method based software package vs2di incorporating the flow and heat transport simulator vs2dh into the previously developed computer program to simulate solute transport in variably saturated porous media vs2dt healy 1990 trefry and muffels 2007 developed a continuous galerkin fe method based computer program feflow to simulate density dependent variably saturated flow and transport including multi species reactive transport to model the process of surface subsurface flow and their interaction camporese et al 2010 presented the catchment hydrology cathy model which couples an fe solver for re with an fd solver for the diffusion wave equation describing the surface flow we can find another instance of coupling of fe and fd methods in the saturated unsaturated flow model developed by gao et al 2019 where they have used fe and fd methods for spatial discretization in the horizontal and vertical directions respectively yeh et al 2011 advanced the concept of catchment modeling and developed a watershed scale numerical model wash123d that combines solvers for one dimensional stream or river flow two dimensional overland flow and three dimensional subsurface flow fd and fe schemes lack robustness as they often suffer from numerical instabilities and convergence issues freeze 1971 celia et al 1990 implicit iterative methods like line successive over relaxation lsor technique or alternating direction implicit adi procedure used in the fd approximation faces convergence difficulties due to time step limitation introduced by the nonlinearity of the soil water parameters freeze 1971 however a fully implicit backward euler time approximation scheme can be a good alternative for fd method based saturated unsaturated flow models in case of problems related to infiltration into parched soil fe method based solvers produce oscillatory solutions celia et al 1990 diagonalisation of the time matrix inherent to fd approximation eliminates oscillations from the numerical solution on the other hand the mass lumping method is adopted in fe schemes to eliminate oscillations in the numerical solution until recent times the finite volume fv method has not been common among researchers for modeling variably saturated subsurface flow owing to the functional nonlinearity of involved parameters re suffers from mass conservation issues since the fv method is highly mass conservative it can be a good numerical tool for solving re eymard et al 1999 pioneered at proving the convergence of the fv scheme for discretization of the elliptic parabolic re since then successful attempts have been made in fv method based modeling of one dimensional lai and ogden 2015 li et al 2021 and two dimensional manzini and ferraris 2004 aravena and dussaillant 2009 infiltration problems horgue et al 2015 developed porousmultiphasefoam using the open source fv method based multiphysics platform openfoam for modeling three dimensional multiphase flow through both isotropic and anisotropic porous media the porousmultiphasefoam package contains multiphase models for relative permeability and capillarity and also includes a customized neumann boundary condition to impose phase velocity on the boundaries deng and wang 2017 presented an fv scheme based saturated unsaturated flow model using three dimensional re in arbitrary coordinates consequently openfoam based three dimensional saturated unsaturated flow models like sugwfoam liu 2013 and richardsfoam orgogozo et al 2014 orgogozo 2015 have also been developed another vital aspect involved in the development of a numerical solver for re is the time discretization technique the convergence of the iterative linearization process depends mainly on the time step size considered by the solver it is necessary to consider small time steps when the hydrological conditions within the flow domain change very sharply with time however small time steps would unnecessarily increase the overall computation time during smooth variations of hydrological conditions making the solver inefficient for modeling regional scale problems hence to restore the efficiency of the numerical scheme an algorithm should be implemented within the solver which continuously alters the time step size based on the evolving hydrological conditions researchers have commonly adopted time stepping algorithms based on the number of iterations required for convergence of the linearization process williams and miller 1999 liu 2013 orgogozo et al 2014 orgogozo 2015 in some numerical models a flux updating algorithm has been implemented where the time step size is adjusted based on the variations in moisture content occurring due to changes in flux kirkland et al 1992 lai and ogden 2015 li et al 2021 therefore a suitable adaptive time stepping algorithm is essential for an efficient re solver to achieve smooth convergence at minimum computation time the parallel computing technique has emerged through which an extensive computation can be broken down into small parts and computed simultaneously through multi core processors the application of parallel computing has dramatically curtailed the computation time involved in solving large scale saturated unsaturated flow problems tracy 2006 coumou et al 2008 herbst et al 2008 maxwell 2013 we can implement the parallelization strategy in a numerical model either by domain decomposition or in the form of loop level parallelism we can use the loop decomposition approach for a few processors thereby being a rare option for hydrological modeling orgogozo et al 2014 have used the domain decomposition method for the development of their open source parallel solver for re richardsfoam hence the development of parallel solvers is essential for accelerating the simulation of watershed scale hydrological problems for large time domains owing to the high nonlinearity of re its numerical solution is computationally expensive and unreliable at times farthing and ogden 2017 the focus thus should be given to the development of a robust numerical technique that is accurate mass conservative and can be applied to natural soil layers and aquifer systems subjected to a wide variety of initial and boundary conditions this paper presents a generalized parallel mathematical model based on fv approximation to evaluate subsurface flow dynamics through heterogeneous porous media we have developed separate solvers with mass conservative numerical approximations of both h based and mixed forms of re we have implemented a stabilized and adaptive time stepping algorithm for smooth convergence and increased computational efficiency we have also utilized the parallelization framework available in openfoam for speeding up the process of large scale simulations the novelty of the presented work lies in the robustness of the developed re solvers verified through their performance in reproducing the results of nine subsurface flow problems that include theoretical examples laboratory scale experiments and field tests we have also proposed an alternative approach for solving the unsteady state pumping test in an unconfined aquifer the proposed methodology considers the actual radius of the pumping well to estimate drawdown in the aquifer which is independent of grid dimensions finally we have conducted a comparative study of h based and mixed form solvers and have commented on their respective efficacies through the solved test examples 2 governing equations in conjunction with darcy s law the law of conservation of mass leads to the derivation of re governing the flow of water in unsaturated porous media the movement of water in porous media primarily takes place due to gravity and variations in the pressure head however the flow of water through the unsaturated zone is sometimes governed by the change in density of water occurring due to temperature fluctuations or alterations in solute concentration in this study we have neglected the effects of changes in temperature and solute concentration and have considered the density of water to remain constant throughout the flow process we have used the modified re presented by freeze 1971 introducing the specific storage term to use a single equation describing the flow of water through both saturated and unsaturated zones of the subsurface we can present the modified re as the following h based form 1 s s θ η c w h h x t t k h h x t z q s mixed form 2 θ t s s θ η h x t t k h h x t z q s x ω t 0 t f we can express specific storage s s with the compressibility terms α and β as 3 s s γ water α η β 3 soil water characteristic model within the unsaturated zone moisture content θ hydraulic conductivity k and specific moisture capacity c w are nonlinear functions of the pressure head h scientists have formulated several empirical models for representing the soil water relationship in the unsaturated zone some of these models are brooks and corey model brooks and corey 1964 brooks corey burdine model brooks and corey 1966 van genuchten mualem model van genuchten 1980 van genuchten and nielsen model van genuchten and nielsen 1985 and general power formula dogan 1999 in this work we have adopted the van genuchten mualem model as it is prevalent and has been widely accepted by researchers the constitutive relationship of pressure head and soil water parameters as presented in the van genuchten mualem model are as the following moisture content θ 4 θ θ r s e h θ s θ r h 0 θ s h 0 where 5 s e h 1 α w h β w γ w γ w 1 1 β w hydraulic conductivity k 6 k h k s s e h 1 2 1 1 s e h 1 γ w γ w 2 h 0 k s h 0 specific moisture capacity c w 7 c w h θ h α w γ w θ s θ r 1 γ w s e h 1 γ w 1 s e h 1 γ w γ w h 0 0 h 0 4 development of subsurfaceflowfoam subsurfaceflowfoam is a three dimensional fv method based model for evaluating the pressure head distribution in the subsurface flow domain in this project we have adopted the fv method for the numerical approximation of re as it is inherently mass conservative and we can apply it to geometrically complex domains overlaid by a regular structured or unstructured grid system dey and dhar 2020 for the development of subsurfaceflowfoam we have used the framework of fv based computational fluid dynamics toolbox openfoam jasak 1996 working in openfoam has helped us to develop our numerical model on a globally acclaimed open source platform using the functions and differential operators from the toolbox library one of the most significant advantages of developing solvers in the openfoam platform is that it facilitates parallel computing the parallel computing technique is implemented in openfoam framework through the process of domain decomposition employing the communication protocols of message passing interface mpi richardsfoam which is an existing re solver developed on openfoam platform is not robust and experiences certain runtime limitations richardsfoam employs the h based form of modified re with the standard chord slope scs approximation for the specific moisture capacity term c w the richardsfoam solver fails when specific storage s s is absent strictly unsaturated flow problems or has a value of zero moreover richardsfoam has been developed for solving variably saturated flow problems through isotropic porous media to guarantee the robustness of a solver we need to overcome the limitations suffered by richardsfoam in subsurfaceflowfoam we have modified the h based re solver of richardsfoam by introducing a switching algorithm for initializing the specific moisture capacity term c w we have also developed a mixed form based re solver in subsurfaceflowfoam following the modified picard iteration scheme celia et al 1990 4 1 approximation of the specific moisture capacity term c w researches in unsaturated zone hydrology claim that the mixed form re guarantees better mass conservation than the h based form the trick at achieving perfect mass balance for re lies in the numerical approximation and representation of the specific moisture capacity term kosugi 2008 in the numerical modeling of re using the h based form we incur significant mass balance error when we use the traditional analytical derivative form of c w given in eq 7 the mass imbalance occurs because the specific moisture capacity function is highly nonlinear and varies significantly from the fd based approximated form at discrete levels celia et al 1990 proposed a mass conservative approach for the numerical approximation of the mixed form re known as the modified picard iteration scheme in their approach they have expanded the unknown moisture content using taylor series expansion with the superscripts m denoting the picard iteration level and n denoting the time level we can express the expanded form of the unknown moisture content θ m 1 n 1 as the following θ m 1 n 1 θ m n 1 θ h m n 1 δ h o δ h 2 8 θ m 1 n 1 θ m n 1 c w h m n 1 δ h where δ h h m 1 n 1 h m n 1 applying eq 8 we can expand the time derivative of moisture content θ as the following 9 θ t θ m n 1 θ n δ t c w h m n 1 h m 1 n 1 h m n 1 δ t rathfelder and abriola 1994 presented a mass conservative approach for numerically approximating the h based re applying standard chord slope scs approximation scheme for discretizing the specific moisture capacity term c w they have also proved that their approach becomes numerically equivalent to the modified picard iteration scheme thereby ensuring mass conservation we can approximate the specific moisture capacity term c w applying the scs scheme like the following 10 c w θ h θ m n 1 θ n h m n 1 h n in subsurfaceflowfoam we have developed solvers based on both h based and mixed forms of re the mixed form solver implements the modified picard iteration scheme whereas the h based solver adopts the scs scheme to approximate specific moisture capacity term c w with the scs approximation scheme the initialization of c w requires special attention in general we begin the iterative process by setting the values of θ m n 1 and θ n to the initial θ values for the entire domain the initial approximation of c w becomes zero when evaluated using the eq 10 in the absence of specific storage s s the time derivative on the left hand side of the eq 1 becomes non existent thereby forcing a steady state solution after the first time step richardsfoam lacks the robustness expected from the solver due to this limitation to address this issue we have proposed an algorithm where we have initialized c w with the traditional analytical derivative form whenever specific storage s s is zero algorithm 1 in the subsequent iterations however we have approximated c w using the scs scheme through this approach the mass balance error increases during the early time steps and later goes down as the solution progresses with time algorithm 1 c w initialization algorithm 4 2 linearization technique due to nonlinear dependence of the soil water parameters θ k c w on the pressure head h re is one of the most complex equations to solve directly hence we need to adopt an iterative linearization procedure to obtain the numerical solution some of the iterative methods commonly used for solving re are newton s method and picard iteration method in subsurfaceflowfoam we have adopted the picard iteration method for linearizing both the h based and mixed forms of re given in the eqs 1 and 2 respectively applying eq 9 we can write the linearized mixed form of re as the following 11 θ m n 1 θ n δ t n 1 c w h m n 1 h m 1 n 1 h m n 1 δ t n 1 s s θ m n 1 η h m 1 n 1 h n δ t n 1 k h m n 1 h m 1 n 1 z q s n 1 rearranging the terms of eq 11 we can rewrite it as the following 12 c w h m n 1 s s θ m n 1 η h m 1 n 1 h m n 1 δ t n 1 k h m n 1 h m 1 n 1 z q s n 1 θ m n 1 θ n δ t n 1 s s θ m n 1 η h m n 1 h n δ t n 1 implementing the scs scheme for approximating the specific moisture capacity term c w we can present the linearized h based form of re as the following 13 s s θ m n 1 η θ m n 1 θ n h m n 1 h n h m 1 n 1 h n δ t n 1 k h m n 1 h m 1 n 1 z q s n 1 we have solved the set of linear algebraic equations given in the eqs 12 and 13 using the pre conditioned conjugate gradient pcg solver with a diagonal incomplete cholesky dic preconditioner the above solver has advantages over other iterative matrix solvers by being computationally inexpensive and showing faster convergence celia et al 1990 clement et al 1994 dogan 1999 4 3 stabilized and adaptive time stepping algorithm in subsurfaceflowfoam we have implemented a stabilized and adaptive time stepping strategy based on empirically based time step ebats scheme williams and miller 1999 not only to facilitate smooth convergence but also to reduce the computation time and expenses if the subsurfaceflowfoam solvers require more than n p u iterations to converge or if the solvers fail to converge even after n p max iterations the algorithm decreases the time step size by the factor δ f to ensure smooth convergence on the other hand if the solvers converge within n p l iterations successively for n st max time steps the algorithm increases the time step size for the next time level by a factor δ f moreover the algorithm bounds the time step size within the prescribed lower and upper limits of δ t min and δ t max respectively the stabilization technique introduced in this time stepping algorithm examines the convergence stability of the solver at the current δ t before increasing the time step size hence if we start the simulation process with a small time step size the chances of convergence failure get reduced a major drawback in the time stepping algorithm adopted in richardsfoam is that whenever convergence fails the algorithm decreases the time step size and proceeds to the next time level without recomputing the solution for the current time level in case of convergence failure at a time level n in subsurfaceflowfoam the algorithm recomputes the solution for time level n with a reduced time step size thus the time stepping algorithm adopted in subsurfaceflowfoam algorithm 2 is flexible at adapting to the convergence requirements of the solvers which ensures smooth convergence for all time steps consistently preserving the mass balance in the system algorithm 2 stabilized and adaptive time stepping algorithm in this paper we have considered the values of n p l 3 n p u 95 n p m a x 100 n s t m a x 10 δ f 1 25 and δ t min δ t 0 for the numerical test cases 4 4 convergence criteria like accuracy another vital aspect of iterative methods for solving nonlinear equations is the required computational effort careful selection of a convergence criterion optimizes the incurred computational expenses by reducing the number of iterations the solver needs to converge huang et al 1996 have mentioned three convergence criteria that we can implement on picard iteration schemes adopted for the numerical solution of the h based and mixed forms of re standard pressure head criterion 14 h m 1 n 1 h m n 1 δ h tol mixed pressure head criterion 15 h m 1 n 1 h m n 1 δ h retol h m 1 n 1 δ h tol standard moisture content criterion 16 θ m 1 n 1 θ m n 1 δ θ tol in this paper we have adopted the standard moisture content criterion with a tolerance of δ θ tol 10 6 for the numerical test cases because of its proven efficiency in terms of both accuracy and acquired computational burden 4 5 mass balance error mass balance accuracy is an essential criterion for the efficiency of a numerical model adopted for hydrological modeling in saturated unsaturated flow modeling mass conservation is dependent not only on the adopted numerical approximation scheme but also on the form of re selected for the flow model mass balance error mbe measures the ability of a model to conserve global mass within the domain of interest ideally the change of mass of water within the domain should equal the mass of water entering or leaving the domain through its boundaries during a specific time interval an error occurs when the masses mentioned above are not equal and we define the error as mass balance error we can calculate the percentage of cumulative mbe within the domain at a given time as the following 17 mbe t n 1 1 i 1 n ele θ i n 1 θ i 0 s s θ n 1 η h i n 1 h i 0 v i k 1 n 1 j 1 n b f f ϕ j k δ t k 100 although mass conservation does not guarantee the accuracy of a numerical solution a cumulative mbe of less than 1 at the end of the total simulation period is desirable for the potential acceptance of a numerical model rathfelder and abriola 1994 5 numerical tests to demonstrate the applicability of subsurfaceflowfoam we have performed a wide variety of one dimensional two dimensional and three dimensional tests including some benchmark problems laboratory tests and field scale tests we have developed some custom boundary conditions in openfoam as required for solving some of the test case problems we have presented an elaborate description of these custom boundary conditions and the boundary conditions used from openfoam library while demonstrating the respective test case problems 5 1 tc1 simple one dimensional infiltration test this simple one dimensional infiltration test is a benchmark problem that has been used for the validation of richardsfoam orgogozo et al 2014 in transient conditions the test domain is a 1 m long homogeneous loamy soil column the top boundary acts as a specified pressure head boundary whereas free drainage occurs from the bottom of the soil column fig 1 specified pressure head boundary we have specified the pressure head on a domain boundary by the following function 18 h x t h c x t we have prescribed specified pressure head boundary in subsurfaceflowfoam using fixedvalue type boundary condition from openfoam library free drainage boundary we have described the free drainage condition on a domain boundary by the following gradient function 19 k h h x t n 0 we have specified free drainage condition in subsurfaceflowfoam using fixedgradient type boundary condition from openfoam library with the gradient value equal to zero we have discretized the soil column into 100 regular elements each size 0 01 m we have considered the soil column initially unsaturated with a uniform pressure head of 1 m throughout its length the specified pressure head on the top boundary is 0 01 m we have listed the soil parameters in table 1 considering δ t 0 1 s and δ t max 3600 s we have run the simulation for 24 h using both h based and mixed form re solvers 5 2 tc2 one dimensional infiltration and redistribution test paniconi et al 1991 presented a one dimensional infiltration and redistribution problem to compare the performance of six different time discretization strategies for solving the unmodified re just like su3d model dogan and motz 2005 and sugwfoam liu 2013 we have used this example as one of the test cases for the validation of subsurfaceflowfoam the test case involves a 10 m long homogeneous soil column whose top and bottom boundaries are subjected to specified time varying flux and specified pressure head respectively fig 1 specified flux boundary we have specified the flux at a domain boundary by the following function 20 k h h x t z n q c x t in subsurfaceflowfoam we have developed specifiedconstantfluxbc type boundary condition for specifying time invariant flux condition on the domain boundary to specify time varying flux on a boundary we have developed problem specific flux boundary conditions namely specifiedtransientfluxbc1 and specifiedtransientfluxbc2 assuming a grid size of 0 01 m we have discretized the soil column into 1000 regular elements we have considered the initial pressure head distribution within the soil column to be hydrostatic with zero pressure head at the bottom boundary to specify the time varying flux at the top boundary we have used specifiedtransientfluxbc1 type boundary condition where the flux function q c is given by 21 q c t 64 m h we have listed the soil parameters considered by paniconi et al 1991 in table 1 we have conducted the simulation for 32 h using δ t 0 1 s and δ t max 20 s 5 3 tc3 free drainage test in this test case we have carried out numerical modeling of the free drainage experiment conducted at the los alamos national laboratory using a 6 m deep lysimeter abeele 1984 forsyth et al 1995 fig 1 we have selected this example because it demonstrates the transition from saturated to unsaturated conditions due to free drainage from the bottom of the soil column to ensure that no water enters the soil column we have imposed zero flux on the top boundary using specifiedconstantfluxbc type boundary condition with q c 0 at the bottom boundary we have maintained a zero pressure head so that water drains off continuously we have discretized the soil column into 600 regular elements and have initialized each element with zero pressure head to establish saturated conditions within the soil column we have presented the soil parameters considered in this study in table 1 then we have considered the adaptive time step parameters δ t 0 0 1 s and δ t max 3600 s to run the simulation for 100 days 5 4 tc4 infiltration test through a heterogeneous column with time varying boundary condition we have chosen the example presented in li et al 2021 to demonstrate the effectiveness of subsurfaceflowfoam in modeling subsurface flow through a soil column with layered heterogeneity the soil column is 1 8 m long with a clay layer bounded by sand layers on the top and bottom as shown in fig 1 the specific properties of sand and clay are summarized in table 2 the top boundary of the soil column acts as a time varying specified flux boundary whereas free drainage occurs from the bottom the time varying flux is the daily infiltration evaporation data for the simulation period of 20 days as displayed in fig 2 in subsurfaceflowfoam to specify time varying flux on a domain boundary where q c is presented in the form of time series data we have developed the boundary condition type specifiedtransientfluxbc2 we have discretized the soil column into 360 regular elements and have initialized each element with a pressure head of 1 m we have performed the flow simulation through the soil column for 20 days assuming δ t 0 1 s and δ t max 20 s 5 5 tc5 laboratory infiltration experiment with falling water table in this example we have attempted to numerically model the laboratory infiltration experiment with a falling water table conducted by childs and poulovassilis 1962 we have computed the steady state moisture content profile above the water table falling at a constant velocity with the top boundary subjected to constant rainfall intensity lai and ogden 2015 have also used this example for the validation of their proposed numerical model they have derived the van genuchten mualem soil water characteristic parameters from the moisture characteristic curve given in childs and poulovassilis 1962 we have considered these calibrated soil parameters for our simulation as listed in table 1 moving water table boundary in the case of a moving water table the pressure head at the bottom boundary varies with time as a function of the velocity of the moving water table we have specified the pressure head at the bottom boundary by the following function 22 h x t z wt v z t we have assumed the velocity v z to be positive when the water table rises and vice versa we have developed the boundary condition type movingwatertablebc in subsurfaceflowfoam to specify the pressure head at the bottom boundary in case of moving water table the sand column considered in this study is 1 5 m long fig 1 we have discretized the sand column into 300 regular elements each size 0 005 m we have assumed the water table to be located at the top boundary at t 0 s initially the sand column is wholly saturated with the hydrostatic distribution of the pressure head assuming different water table fall velocities and rainfall intensities we have carried out seven simulations with 1 v z 0 172 m h and q c 0 0265 0 06 0 1 m h 2 v z 0 344 m h and q c 0 0265 0 06 0 1 0 2 m h we have run the simulations assuming δ t 0 1 s and δ t max 20 s until the falling water table reaches the bottom of the sand column and we achieve a steady moisture content profile within the column 5 6 tc6 two dimensional variably saturated water table recharge test we have validated the applicability of subsurfaceflowfoam for two dimensional problems by modeling the transient two dimensional saturated unsaturated water table recharge experiment conducted by vauclin et al 1979 clement et al 1994 dogan and motz 2005 and liu 2013 have previously considered this benchmark problem to validate their respective numerical models the flow domain in this example is a rectangular soil slab of length 6 m and depth 2 m we have tabulated the soil parameters used by vauclin et al 1979 in their experiment in table 1 initially the water table is at the height of 0 65 m from the bottom of the domain a constant flux of 0 14791 m s is applied at the soil surface throughout 1 m at the center of the top boundary the remaining span of the top surface was kept covered to restrict evaporation losses during the experiment and we have treated it as a no flow boundary during simulation the bottom of the domain is impervious and no flow occurs through it the left and the right boundaries below the water table are specified pressure head boundaries where the pressure head distribution is hydrostatic however no flow occurs through the left and the right boundaries above the water table fig 3 shows a schematic diagram representing the domain geometry alongside the initial and boundary conditions considered for the test example hydrostatic pressure head boundary we have specified hydrostatic distribution of pressure head on a boundary by the following function 23 h x t z wt z in subsurfaceflowfoam we have developed the boundary condition type hydrostaticbc to impose hydrostatic pressure head distribution on a domain boundary we have discretized the study domain into 2400 rectangular elements with δ x 0 1 m and δ z 0 05 m we have assumed the initial distribution of pressure head to be hydrostatic throughout the domain considering δ t 0 1 s and δ t max 360 s we have modeled the flow in the domain for 8 h 5 7 tc7 two dimensional perched water table test in this example we have simulated the problem of developing a perched water table surrounded by arid unsaturated conditions kirkland et al 1992 the flow domain is a 5 m long and 3 m deep layered rectangular soil slab whose all boundaries are closed except where infiltration occurs at a rate of 0 5 m d fig 4 for developing a perched water table sand is bounded by a 1 m thick clay barrier of very low permeability on the left right and bottom the properties of sand and clay are the same as considered for tc4 given in table 2 as the effects of compressibility of the porous medium were neglected by kirkland et al 1992 we have considered the specific storage to be zero for this example we have discretized the domain into an unstructured grid system with 21970 prismatic elements in order to replicate initial arid conditions within the soil layers we have considered an initial pressure head of 500 m within the domain we have run the simulation for 24 h with δ t 0 0 01 s and δ t max 20 s to examine the formation of a perched water table above the clay layer 5 8 tc8 three dimensional water table recharge test in response to rainfall to extend the applicability of subsurfaceflowfoam to three dimensional problems we have utilized the water table recharge test in an unconfined aquifer presented by beegum et al 2018 as shown in fig 5 the hypothetical domain is 4000 m long 8000 m broad and 15 m deep with a bed slope of 0 001 along its length the flow domain is homogeneous with the soil parameters listed in table 1 an impermeable boundary bounds the bottom of the unconfined aquifer on the left and right boundaries the water table is maintained at the height of 7 m and 0 9 m from the bottom respectively hence hydrostatic distribution of pressure head is maintained along these boundaries below the water table however we have specified a constant pressure head of 1 25 m on the left and right boundaries above the water table boundaries on the front and the back along the length of the domain are no flow boundaries initially we have considered hydrostatic distribution of pressure head within the domain with the water table varying linearly between the heights maintained on the left and the right boundaries the monthly precipitation data is specified as the time varying flux on the top boundary as presented in fig 5 we have discretized the domain into a structured regular grid system consisting of 188800 elements the grid size on the horizontal plane x y plane is 100 m by 100 m we have considered δ z 0 3 m up to a height of 0 9 m from the bottom in the vertical direction above that we have assumed a constant value of δ z 0 25 m we have modeled the flow in the unconfined aquifer with a repetition of the monthly precipitation data fig 5 for 5 years considering δ t 0 3600 s and δ t max 86400 s 5 9 tc9 three dimensional field scale unconfined aquifer pumping test we have tested the field scale applicability of subsurfaceflowfoam by modeling the unconfined aquifer pumping test of nwankwor et al 1992 delayed piezometer response is very significant when the hydraulic head changes rapidly near the pumping well one of the significant challenges in evaluating the flow dynamics in an unconfined aquifer system due to extraction through a pumping well is addressing the delayed yield effect moench 1997 the estimated drawdown also depends on the diameter of the pumping well the pumping well is usually considered to be a line source to solve pumping problems in unconfined aquifers the classical analytical solutions developed by boulton 1954 dagan 1967 neuman 1972 neuman 1974 considered the pumping well diameter to be infinitesimally small thereby failing to justify the measured drawdown values at the well and in its vicinity at early times in this test case we have proposed an alternative approach to solving unconfined aquifer pumping problems considering the diameter of the pumping well to be of finite dimensions in subsurfaceflowfoam we have implemented the laplace transform solution of dimensionless drawdown for flow to a partially penetrating well of finite diameter in a slightly compressible unconfined aquifer as presented by moench 1997 assuming the homogeneity of aquifer parameters in the vicinity of the pumping well we have defined a circular time varying specified pressure head boundary around the well we have computed the pressure head from the dimensionless drawdown values obtained by numerically inverting the laplace domain solution moench 1997 we have specified the calculated pressure head on the well boundary at every time step pumping well boundary in an unconfined aquifer we have specified the pressure head along the well boundary by the following function 24 h x t z wt s a o z the derivation of drawdowns at the well boundary s a o and within the pumping well s a w are illustrated in appendix 1 to specify the time varying pressure head on the well boundary in an unconfined aquifer we have developed the boundary condition type wellunconfinedbc in subsurfaceflowfoam the test case considers a square shaped unconfined aquifer of sides 100 m and depth 9 m with a pumping well of inner diameter 0 15 m located at the center of the aquifer the pumping well has a well screen of depth 4 m at the bottom of the aquifer and operates at a constant rate of 3 6 m 3 h throughout the 24 h pumping test the unconfined aquifer is homogeneous with constant saturated hydraulic conductivity values of 5 7 m d and 3 6 m d in horizontal and vertical directions we have considered specific storage of the aquifer to be 3 25 10 4 m the soil characteristic parameter values considered in this study were calibrated by akindunni and gillham 1992 viz θ s 0 37 θ r 0 07 0 37 α w 1 9 m and β w 6 095 a thick deposit of clayey silt bounds the aquifer at the bottom making it an impermeable boundary we have also considered the other boundaries of the domain as no flow boundaries additionally the initial water table is at a depth of 2 3 m from the top of the domain due to symmetry we have modeled only a quarter of the study domain fig 6 we have discretized the selected quarter of the domain into an unstructured grid system with 29160 prismatic elements we have considered the well boundary at a radial distance of 0 5 m from the center of the pumping well initially we have assumed hydrostatic distribution of pressure head both below and above the water table throughout the domain with δ t 0 1 s and δ t max 360 s we have performed the simulation for a time span of 24 h 6 results and discussion we have evaluated the performance of subsurfaceflowfoam by comparing the numerical results of the considered test cases against the experimental data analytical solutions numerical solutions hydrus 1d 2d 3d simulation results or measured field data whenever available we have also carried out a comparative study between the h based and mixed form re solvers to comment on their accuracy efficiency and applicability for solving different variably saturated flow problems for tc1 we have compared the time evolution of average pressure head values in the soil column against the hydrus 1d results from orgogozo et al 2014 in fig 7 a we have also compared the temporal changes in water flux at the top boundary as shown in fig 7b figs 7a fig 7b reveal that the subsurfaceflowfoam results are in close agreement with the computed values of hydrus 1d through this example we have examined the performances of the re solvers and the effect of discretization of the specific moisture capacity term c w on their solution accuracy mass conservation and computational efficiency we have compared the pressure head distributions within the soil column after 16 h of simulation just before the entire soil column attains saturation in fig 8 a the solution of the h based re solver with scs approximation for c w correspond very closely with the mixed form re solver solution however the results of the h based re solver using the analytical derivative of c w lag behind the results of the other two numerical schemes near the free drainage bottom boundary in fig 8b we have shown the comparison of cumulative mbe incurred by the three numerical techniques as previously stated the h based re solver using the analytical derivative form of c w is highly inefficient in conserving mass relative to the other two numerical schemes on the contrary the h based re solver with scs approximation for c w exhibits high mass balance accuracy hence the cause of mass imbalance can be attributed to the representation of the c w term which is the only difference between the two approaches made with the h based re solver it implies that the analytical derivative of c w fails to preserve the fd approximation of θ h employed in the scs approximation scheme the mixed form re solver shows excellent mass balance accuracy using the analytical derivative of c w because the term vanishes as the solution approaches convergence for each time step nonetheless the mass conservative nature of fv approximation has contributed toward achieving low mbe in all the numerical approaches for quantifying the computational efficiency we have evaluated the measure of computational work which we can illustrate as the following rathfelder and abriola 1994 25 w comp log 10 n ts n iter we have presented the cumulative mbe and the computational work done by the three numerical schemes after 24 h of simulation in table 3 looking at table 3 we can comment that despite being mass conservative the mixed form re solver is computationally expensive than the h based solver in terms of both time and work done since mbe and the acquired computational expenses depend on initial time step size convergence criterion and time step adjustment algorithm we have considered the same values of δ t 0 and δ t max for all the numerical schemes for tc2 we have recorded the pressure head values along the length of the column at 1 2 4 10 and 32 h from the commencement of the infiltration process we have compared the recorded pressure head profiles against the results of paniconi et al 1991 in fig 9 and have found that they match perfectly with each other as we have considered hydrostatic pressure head distribution the soil near the top surface is very dry initially hence the soil near the top boundary where the time varying flux is specified requires some time to adapt to the imposed boundary condition at initial times it results in high mbe during the initial time steps that gradually decrease with time in our simulation we have considered very small δ t 0 which has facilitated overcoming the inefficiency of the picard iteration scheme during the initial time steps as experienced in paniconi et al 1991 despite high mass imbalance at early times we have achieved cumulative mbe values of 6 13 10 1 and 6 14 10 1 at the end of 32 h of simulation for the h based scs approximation and mixed form re solvers respectively demonstrating the mass conservative nature of subsurfaceflowfoam in tc3 subsurfaceflowfoam solvers successfully capture the transition from saturated to unsaturated conditions without any issue related to numerical stability and mass conservation as the simulation commences water in the initially saturated soil column starts moving down draining rapidly through the bottom under the action of gravity as a result high mbe is observed during the initial few time steps which diminishes gradually moreover due to immediate drainage from the bottom of the soil column instability arises in the system requiring many picard iterations for convergence the assumption of δ t 0 0 1 s helps smooth convergence control during this initial period as this initial phase gets over the adaptive time stepping algorithm gradually increases δ t until δ t max is reached fig 10 shows the simultaneous variation of δ t and n p with time justifying the effectiveness of the adaptive time stepping algorithm to ensure smooth convergence at reduced computational expenses we can attribute the stepped nature of the δ t curves in fig 10 to the stabilization technique adopted in the time stepping algorithm the stabilization scheme only increases the δ t value if n p is sufficiently low for 10 successive time steps eliminating convergence failure we have compared the subsurfaceflowfoam results of pressure head and moisture content after 1 4 20 and 100 days of simulation with the experimental data of forsyth et al 1995 in fig 11 a fig 11b respectively the numerical results replicate the experimental values satisfactorily thereby justifying the potential applicability of subsurfaceflowfoam for this test case additionally the cumulative mbe values at the end of 100 days simulation are 2 17 10 3 and 2 13 10 3 respectively for h based scs approximation and mixed form re solvers in tc4 we have recorded the pressure head and the moisture content within the heterogeneous soil column after 10 and 20 days of simulation we have compared these results of subsurfaceflowfoam with the numerical results presented in li et al 2021 figs 12 a fig 12b claim that the two results are in perfect agreement with each other as the bottom sand layer is overlain by a clay layer of very low hydraulic conductivity the change in top boundary flux does not affect any change in moisture content and pressure head of that layer due to continuous drainage from the bottom of the soil column the pressure head within the bottom sand layer decreases steadily for 20 days creating arid soil conditions within that layer the pressure head and moisture content increase in the top sand layer due to continuous infiltration for the initial 10 days from 10 to 20 days the top boundary flux shifts from infiltration to evaporation thereby the moisture content and the pressure head decrease within the soil column through this study subsurfaceflowfoam guarantees its robustness as it nicely adapts to the alternating episodes of infiltration and evaporation imposed on the top boundary without encountering any numerical instability both the subsurfaceflowfoam solvers exhibit smooth solution at the soil layer interfaces without any convergence issues which is generally experienced by other numerical schemes due to spatial discontinuity among soil characteristic parameters in heterogeneous layered soils furthermore subsurfaceflowfoam vividly captures the effects of heterogeneity in porous media flow through non overlapping soil layers yielding highly accurate results with cumulative mbe values as low as 5 38 10 4 and 5 37 10 4 respectively for h based scs approximation and mixed form re solvers at the end of the simulation period of 20 days for tc5 we have recorded the moisture content profile on the attainment of steady state conditions within the soil column for each simulation we have accomplished complete steady state conditions within the soil column approximately after 8 h 44 min and 4 h 22 min from the initiation of the movement of the water table with velocities v z 0 172 m h and v z 0 344 m h respectively we have shown the comparison between the simulated and the experimental moisture content profiles for v z 0 172 m h and v z 0 344 m h at different infiltration rates in fig 13 a fig 13b respectively the deviations observed from the measured data are primarily due to the errors incurred in measuring and calibrating the van genuchten mualem soil water characteristic parameters both h based scs approximation and mixed form re solvers have achieved high mass balance accuracy at the end of each simulation with sufficiently low cumulative mbe percentages in the order of 10 3 as the specific storage s s is set to zero for tc6 richardsfoam fails to simulate this problem applying subsurfaceflowfoam we have successfully modeled the spatial and temporal distribution of the phreatic surface in a two dimensional domain with desirable accuracy and guaranteed mass conservation a gradual rise in the water table is observed approximately after 1 h 20 min from the onset of simulation when the infiltrated water meets the initial water table flowing down the vadose zone we have plotted the transient positions of the water table at 2 3 4 and 8 h in fig 14 and have compared them with the experimental results of vauclin et al 1979 both results are in good agreement with each other besides the cumulative mbe values for the h based scs approximation and mixed form re solvers at the end of 8 h are 3 97 10 4 and 2 79 10 5 respectively the simulation of the perched water table problem in tc7 is challenging and requires special attention toward spatial discretization and time step size selection for convergence the solution fails to converge if the unstructured grid is generated with an equivalent characteristic length l c greater than 0 1 m as we have assumed very dry initial conditions with pressure head 500 m we have started the simulation with δ t 0 0 01 s to avoid convergence failure we have drawn the pressure head contours of 0 m and 400 m after 24 h of continuous infiltration in fig 15 a the contours agree quite well with the results of kirkland et al 1992 presented in fig 15b the top sand layer is bounded by a clay layer of very low permeability on its left right and bottom the vertical movement of infiltrated water is obstructed and water starts to get deposited above the clay layer a smooth pressure gradient is observed within the clay layer with the top and bottom interfaces at pressures of 0 m and 500 m respectively a water table starts developing locally much above the impervious bottom boundary approximately after 16 h from the commencement of infiltration if the infiltration process is ceased the water table will gradually disappear with time as water will slowly percolate vertically downward into the bottom sand layer through the clay zone such temporary formations of the local water table are quite common in natural hydrogeologic systems and the capability of the subsurfaceflowfoam solvers in simulating perched water table problem advocate their robustness moreover we have achieved very low cumulative mbe values of 4 64 10 3 and 1 57 10 2 with the h based scs approximation and the mixed form re solvers respectively the example considered in tc8 is an extension of the water table recharge problem in the three dimensional domain to reduce the simulation time we have performed parallel computation using four processors we have displayed the water table profile at the end of 5 years in fig 16 the estimated water table profile matches closely with the profile predicted by beegum et al 2018 using hydrus 2d 3d till midway along the length of the domain however subsurfaceflowfoam underestimates the recessing curvature of the phreatic surface compared to hydrus 2d 3d results presented by beegum et al 2018 the difference between the two profiles increases as we approach the right boundary with a maximum variation of 0 91 m occurring 100 m inward of the right boundary we have achieved reasonably low cumulative mbe values of 1 76 10 1 and 8 37 10 3 respectively for the h based scs approximation and mixed form re solvers at the end of 5 years simulation period the simulation of the unconfined aquifer test studied in tc9 is beyond the capability of richardsfoam since the flow domain is anisotropic we have recorded the temporal variation of pressure head at a depth of 7 m from the top and at radial distances of 5 m and 15 m from the center of the pumping well applying subsurfaceflowfoam we have compared the estimated drawdowns with the field data extracted from the time drawdown curves of nwankwor et al 1992 in fig 17 the results of subsurfaceflowfoam correspond well with the measured values addressing the delayed yield effect that arise in the vicinity of the pumping well in an unconfined aquifer conventionally a pumping well is treated as a singular point source in groundwater modeling pumping wells encountered in practice are minimal radii in the range of 0 1 0 2 m since the well and the domain scales differ significantly representing a well with the actual radius on a grid system results in issues related to grid orthogonality aspect ratio and skewness on the other hand grid convergence issues arise in drawdown calculation if we assume the effective well radius calculated by a well model dey and dhar 2020 therefore the actual well radius specification is essential for numerical modeling of pumping tests in unconfined aquifers the proposed methodology calculates the pressure head on the well boundary considering the actual radius of the pumping well thereby fulfilling the grid convergence criterion for drawdown within the well additionally the methodology successfully conserves mass with cumulative mbe values of 1 64 10 2 and 2 42 10 2 respectively for the h based scs approximation and mixed form re solvers at the end of 24 h simulation we have examined the grid convergence characteristics of subsurfaceflowfoam using the examples presented in tc1 one dimensional tc7 two dimensional and tc9 three dimensional we have parametrized the increase in solution accuracy with spatial grid refinement by calculating the difference between the simulated results for two levels of grid refinement relative to the simulated results for the coarser grid we have investigated the grid convergence characteristics for three levels of grid refinement for each of the above test cases a summary of the grid convergence study for tc1 tc7 and tc9 is presented in table 4 for tc1 we have run the simulation for vertical step sizes of 10 2 10 3 and 10 4 m to inspect the increase in solution accuracy we have compared the evolution of the mean pressure head with time in the soil column for the three levels of vertical discretization for the examples considered in tc7 and tc9 we have performed three levels of spatial discretization of the respective domains into unstructured grid systems the unstructured grids were generated using characteristic lengths l c of 0 04 0 02 and 0 01 m for tc7 and 12 5 6 25 and 3 125 m for tc9 we have compared the temporal variations in pressure head at 2 5 0 2 5 for the three levels of spatial discretization for the perched water table problem on the other hand we have analyzed the drawdowns at a radial distance of 5 m from the center of the pumping well at different times for the three levels of the unstructured grid system in the unconfined aquifer pumping test the results in table 4 reveal a distinct increase in solution accuracy with finer spatial discretization thereby satisfying the grid convergence criteria for any numerical scheme moreover we have also observed that with grid refinement there is a marked decrease in the number of iterations n p required for convergence of the picard iteration scheme in tc7 for the first discretization level l c 0 04 approximately 8 47 of the total time steps required more than 3 picard iterations for convergence however for the other two discretization levels l c 0 02 0 01 convergence was achieved within 3 picard iterations for all time steps in tc9 subsurfaceflowfoam solvers converged within 3 picard iterations for all the three spatial discretization levels the percentage of the time steps that converged within 2 picard iterations increased from 45 17 to 52 36 after the first level of grid refinement and finally to 62 62 after the second level of grid refinement nonetheless we have not observed any considerable variation in the order of mass balance accuracy with changing grid dimensions for the examined test cases 7 conclusions in this research work we have presented a generalized fv based numerical model subsurfaceflowfoam to model subsurface flow through heterogeneous porous media we have developed mass conservative solvers for both h based and mixed forms of re both the solvers estimate the subsurface flow dynamics with desirable accuracy for the considered test cases another important aspect of this study is the ability of the solvers to conserve global mass during simulation in all the test cases the cumulative mbe is less than the desirable limit of 1 for both the subsurfaceflowfoam solvers under the conservative property of the fv method we have presented the comparative representation of the acquired cumulative mbe in fig 18 the comparison between the mbe percentages incurred by two subsurfaceflowfoam solvers reveals that both are efficient at conserving the global mass of water within the flow system the scs approximation of the c w term adopted for the h based re solver successfully overcomes the non conservative nature of the h based re producing results with high mass balance accuracy the computation time for all the test cases tabulated in table 5 reveals that the h based solver is marginally faster between the two solvers the test problems simulated in this study do not involve large scale simulations to utilize the benefits of a parallel solver however the parallelization strategies embedded in openfoam are sufficient to establish the advantages of applying subsurfaceflowfoam to solve regional scale problems on large time scales ranging in the orders of decades and centuries the behavior of the solution of re constantly varies throughout the simulation period due to the strong nonlinearity of the involved parameters an assumption of uniform δ t is inappropriate for an re solver implementation of the stabilized and adaptive time stepping algorithm adjusts the time step size δ t dynamically following the changing hydrological conditions initially the pressure head changes drastically within the system due to imposed initial and boundary conditions hence we have initiated the simulation with a small value of δ t for all the test cases to ensure smooth convergence as the system stabilized or approached steady state conditions the algorithm has increased the value of δ t to preserve the computational efficiency of the solver while simulating the considered test cases we have not encountered any convergence or numerical instability issue the primary objective of this study is to develop a generalized re solver to model a wide variety of subsurface flow problems ranging from laboratory scale experiments to watershed scale regional studies equipped with advanced computation facilities of parallelization the advantage of developing the solvers in a universally acclaimed open source framework like openfoam is that the computer program becomes easily accessible to other users on the other hand standard library operators and functions make the computer program readily interpretable among practitioners enhancing its applicability to practical problems in conclusion the performance evaluation of subsurfaceflowfoam proves its potential applicability at simulating subsurface flow through homogeneous and heterogeneous porous media on both laboratory and regional scales source code availability the source code can be downloaded from the link https github com gwres subsurfaceflowfoam notations c w specific moisture capacity l 1 d depth of the top of the well screen below the initial water table l d s thickness of the well bore skin l f ϕ flux normal to the face of an element l 3 t 1 h pressure head l h c known pressure head function l k hydraulic conductivity tensor lt 1 k r hydraulic conductivity in the horizontal direction lt 1 k s saturated hydraulic conductivity tensor lt 1 k sw hydraulic conductivity of the well bore skin lt 1 k z hydraulic conductivity in the vertical direction lt 1 k 0 zero order modified bessel function of second kind k 1 first order modified bessel function of second kind l depth of the bottom of the well screen below the initial water table l n b f number of boundary faces in the domain of interest n ele number of elements in the domain of interest n iter total number of iterations n p number of picard iterations required for convergence at any time step n p l n p u lower and upper limits of the number of picard iterations respectively for effecting a change in time step size n p max maximum number of allowable picard iterations n s number of terms used in the stehfest algorithm n st max maximum number of stabilization counters for adaptive time stepping algorithm n ts number of time steps n normal vector at the boundary q p volumetric extraction rate of the pumping well l 3 t 1 q c known flux function lt 1 q s internal source or sink term l 3 t 1 l 3 r radial distance of the well boundary from centre of the pumping well l r w radius of the pumping well l r wc inside radius of the pumped well in the interval where water levels change during pumping l s e degree of saturation m 0 l 0 t 0 s s specific storage l 1 s y specific yield m 0 l 0 t 0 s a o drawdown at the well boundary l s a w drawdown at the pumping well l s a o d laplace transform of dimensionless drawdown at the well boundary m 0 l 0 t 0 s a w d laplace transform of dimensionless drawdown at the pumping well m 0 l 0 t 0 s c stabilization counter for adaptive time stepping algorithm t f final solution time t t time coordinate t v volume of an element l 3 v z velocity of the moving water table lt 1 w weighting coefficients in stehfest algorithm w comp measure of computational work x vector of space coordinates in the euclidean space l z vertical coordinate positive upward from the bottom of the domain l z a o hydraulic head at the well boundary l z a w hydraulic head at the pumping well l z wt height of the water table above the bottom of the domain l γ water unit weight of water on earth at 4 c ml 2 t 2 δ t time step size t δ t min δ t max minimum and maximum time step size respectively t δ t 0 initial time step size t δ x δ z grid size in x and z directions respectively l δ f time step adjustment factor δ h retol relative tolerance for mixed pressure head convergence criterion l δ h tol tolerance for standard pressure head convergence criterion l δ θ tol tolerance for standard moisture content convergence criterion m 0 l 0 t 0 η porosity of the medium m 0 l 0 t 0 θ moisture content m 0 l 0 t 0 θ r residual moisture content m 0 l 0 t 0 θ s saturated moisture content m 0 l 0 t 0 α compressibility of the porous medium m 1 lt 2 α uc empirical drainage constant t 1 α w soil specific coefficient equivalent to the capillary length scale l 1 β compressibility of water m 1 lt 2 β w soil specific exponent m 0 l 0 t 0 ω physical domain credit authorship contribution statement saumava dey conceptualization methodology validation writing original draft anirban dhar supervision writing review editing declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper appendix a this appendix provides the steps involved in the computation of drawdown s a o at the well boundary given in eq 24 the expressions for the dimensionless parameters used in drawdown calculation are presented in table 6 we can calculate the laplace transform of the dimensionless drawdown s a o d at a radial distance r from the center of the pumping well as a 1 s a o d r d z d p uc 2 e uc p uc l d d d 1 w d p uc a uc s w where a 2 a uc 2 l d d d n 0 k 0 q 1 n sin n 1 d d sin n 1 l d 2 n q 1 n k 1 q 1 n n 0 5 sin 2 n a 3 e uc 2 n 0 k 0 q 2 n cos n z d sin n 1 d d sin n 1 l d q 1 n k 1 q 1 n n 0 5 sin 2 n a 4 q 1 n p uc n 2 β uc d 0 5 a 5 q 2 n q 1 n r d and n are the roots of a 6 n tan n p uc σ uc β uc d p uc γ uc n 1 2 3 we have computed the summations in eqs a 2 and a 3 for n c terms where n c can be evaluated as a 7 n c max n c min min n c max n c max 2 log 10 β uc 2 in this paper we have assumed the values of n c min and n c max as 4 and 30 respectively to evaluate the dimensionless drawdown s a o d at the well boundary we have performed numerical inversion of the laplace domain solution given in eq a 1 applying stehfest algorithm stehfest 1970 stehfest algorithm calculates the dimensionless drawdown s a o d as follows a 8 s a o d t d ln 2 t d j 1 n s w j s a o d r d z d p u c where a 9 p uc j ln 2 t d a 10 w j 1 n s 2 j k j 1 2 min j n s 2 k n s 2 2 k n s 2 k k k 1 j k 2 k j moreover we can calculate the laplace domain solution of the dimensionless drawdown in the pumping well as follows a 11 s a w d p uc 2 a uc s w p uc l d d d 1 w d p uc a uc s w we can evaluate the dimensionless drawdown at the pumping well s a w d using the stehfest algorithm similarly as done for the well boundary in eqs a 8 a 10 
