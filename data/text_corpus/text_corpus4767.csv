index,text
23835,oceanic current forcing in spectral wave models have recently been demonstrated to have a large impact on wave heights at scales between one and up to several hundred kilometers here we investigate the impact of such forcing on open ocean wave heights in northern norway using a high resolution spectral wave model with currents from an ocean circulation model of similar resolution we find that the wave model to a large extent resolves regions identified in the norwegian pilot guide for maritime navigation as having dangerous sea states due to wave current interaction this is in contrast to a wave model forced with surface wind fields only we present a novel diagnostic method to map the spatio temporal scales associated with the wave height modulation between the two wave model predictions the method is employed to map areas where significant wave current interaction can be expected in many cases we are also able to confirm the physical mechanisms reported in the pilot guide which are leading to an increase in wave energy due to currents the largest wave height differences between the two models occur when waves and currents are opposing each other in such situations refraction and wave blocking are the dominating effects for the swell and wind sea parts of the spectrum respectively furthermore including current forcing significantly improves the agreement with in situ observations in strong tidal currents here we see an increase in significant wave height of up to 50 even larger relative differences exceeding 100 are found in sheltered areas with one specific region showing a reduction in model errors of 18 due to refraction and advection of wave action keywords wave current interaction tidal dynamics wave trapping water waves 1 introduction inclusion of ocean currents as forcing in spectral wave models is an active field of research since it is one of the least developed and least verified parts in such models babanin et al 2017 2019 this is obviously important for day to day wave forecasting in regions with strong currents but also for other aspects like modeling air sea interactions due to the exchange of properties through the interface which is key for climate predictions cavaleri et al 2012 ocean currents can modulate wave heights significantly and even dominate the variability in the open ocean at scales of 10 100 km ardhuin et al 2017 for shorter scales sub mesoscale fronts have been found to increase significant wave heights up to 30 romero et al 2017 and twin model experiments have revealed wave height modulations up to 80 due to current induced refraction in low wind conditions romero et al 2020 furthermore periodic interactions in tidal currents is known to induce intense local wave height modulations such as reported by masson 1996 northern norway is known for its extraordinarily strong open ocean tidal currents gjevik et al 1997 in addition the region is subject to a turbulent flow field with strong eddies in the norwegian atlantic current nac and the norwegian coastal current ncc mork 1981 see figs 1 2 further to this the northeast atlantic is home to the most extreme wave climate globally aarnes et al 2012 this makes northern norway an interesting region to study wave current interaction as there is a steady influx of swell in addition to local windsea specific areas are known for intense interactions described in detail in the norwegian pilot guide den norske los 2018 hereinafter npg some are also mentioned in the classical literature gjevik et al 1997 in the npg they are referred to as areas of dangerous waves fig 3 this information was collected from an extensive survey among experienced sailors and local fishermen in addition to mapping these areas the survey also addressed the characteristic current and wave conditions presumed responsible for the choppy and sometimes dangerous sea states however there have been no attempts to resolve these areas using spectral wave models in this work we aim to map areas known or not known for high and dangerous sea states presumed due to wave current interaction using state of the art wave and ocean models moreover as different flow regimes e g tidal and sub mesoscale are associated with various temporal and horizontal scales we investigate if such a model coupling also resolves spatio temporal variability in the wave field including the extreme values in specific regions like strong tidal currents only a few studies have investigated the impact of currents on the wave field in northern norway segtnan 2014 used the wave refraction model by mathiesen 1987 and found that the wave propagation direction close to the coast was often misaligned with the wave direction offshore the misalignment was attributed to current induced refraction due to the eddies associated with the ncc saetra et al 2021 hereinafter os21 investigated wave current interaction in the lofoten maelstrom which is one of the world s strongest open ocean tidal currents they found that wave breaking increased during maximum current speeds this was associated with an increase in wave height due to horizontal gradients in the tidal current neither of these studies sufficiently examined the flow fields impact on the wave height and the associated horizontal variability here we investigate the impact of currents by comparing the results from a twin experiment with identical spectral wave models hereinafter wave models with different forcing i e one with wind and currents and one forced with wind only similar model setups have recently been shown to yield acceptable results on large e g marechal and ardhuin 2021 intermediate e g kanarik et al 2021 and small horizontal scales e g romero et al 2020 including tidal currents ardhuin et al 2012 we assess the impact by different current regimes on the wave field by analyzing specific events and by comparing them with in situ and remote sensing observations we also present a novel generic method to map spatio temporal variability in twin experiments based on time series analysis which in this context is used to map regions with strong wave current interaction more generally we assess the usefulness of such an approach for sensitivity analysis in twin model experiments the paper is structured as follows in section 2 we provide a description of the models forcing and observations together with metrics and methods used for validation in section 3 we present our results which are further discussed in section 4 we then present our concluding remarks in section 5 2 materials and methods 2 1 models and observations 2 1 1 model domain and study period the model domain covers the coast of northern norway fig 1 an area with extensive maritime activity including ship traffic fisheries marine engineering and marine harvesting fish farming the domain is identical to the high resolution operational wave forecast model at the norwegian meteorological institute for this region northern norway is located in the belt of westerlies and is thus dominated by westerly winds and waves specific areas in the region are subject to vigorous tidal currents due to the semi diurnal northward propagating kelvin wave one of these is the aforementioned lofoten maelstrom located on the southern tip of lofoten location 7 fig 1 local names are referred to in italic the tidal current s local name is moskstraumen which we will use here see b fig 1 combined with the norwegian coastal current that meanders northward loosely following the bathymetry of the shelf these strong tidal currents give rise to very strong current gradients this study covers the period from 2018 12 01 until 2019 02 28 which includes six spring tide periods and some storms mainly approaching the continental shelf from the west outside lofoten six times during the period h s reached values above 6 m not shown the particular period was chosen since it overlaps with in situ observations from a measurement campaign in moskstraumen saetra et al 2021 we pay particular attention to the locations denoted a and b and those numbered 2 8 in fig 1 the first a and b denote the location of the in situ observations while the latter 2 8 denote areas known for dangerous waves according to their numbering in the npg see fig 3 the reason why we start counting on 2 is that area 1 is outside our model domain 2 1 2 the wam spectral wave model we used a recent version of the wave model wam cycle 4 7 komen et al 1994 behrens et al 2013 wam solves the wave action balance equation 1 n t 1 cos ϕ ϕ ϕ cos ϕ n λ λ n ω ω n θ θ n s in s nl s ds s bot σ 1 where n e σ the wave action density is the ratio of the spectral wave energy density e e t ϕ λ ω θ and the intrinsic wave angular frequency σ furthermore t ϕ λ ω and θ denote time latitude longitude angular frequency and direction respectively the right hand side in 1 denotes the parameterized physical processes which represents the wind input s in from ardhuin et al 2010 non linear wave wave interactions s nl from hasselmann et al 1985 wave dissipation due to white capping s ds from ardhuin et al 2010 and bottom friction s bot from hasselmann et al 1985 the terms denoted with overdots in eq 1 describe the wave kinematics governed by 2 ϕ c g cos θ u r 1 3 λ c g sin θ v r cos θ 1 4 ω ω t 5 θ c g sin θ tan ϕ r 1 θ d where u u v is the horizontal surface current velocity vector r is the radius of the earth c g is the wave group velocity and 6 θ d sin θ ϕ ω cos θ cos ϕ λ ω k r 1 here k is the wave number vector and k k latitudinal and longitudinal advection of wave action by the wave group velocity and the ambient current are represented by eqs 2 3 the temporal change of angular frequency is given by eq 4 where ω is the doppler shift dispersion relation 7 ω ω k x t σ k u where x x y is the horizontal positional vector the intrinsic frequency follows the linear dispersion relation 8 σ g k tanh k d here g d are the gravitational acceleration and water depth respectively the refraction or turning of waves due to gradients in the ambient current and bathymetry is dictated by eq 5 the model was set up on a regular grid with 800 m horizontal grid resolution it had a spectral resolution of 24 directional and 30 frequency bins ranging from f 0 0 034523 hz to f 29 0 5476419 hz in logarithmic increments such that f i f 0 1 1 i where i 1 2 29 model integration time steps of 30 s were used for both the propagation and source term computations for the boundaries we used hourly 2d spectra from the european centre for medium range weather forecasts ecmwf we performed a twin model experiment using the same model specifications and physical parameterizations both were forced with surface winds but one also included current forcing these two runs are hereinafter referred to as the reference run wam ref i e with zero currents and the run including currents wam curr the current forcing is not part of the source term calculations but is included in the wave kinematics the left hand side of eq 1 as shown in eqs 2 5 2 1 3 wave model forcing norkyst800 provided the ocean surface currents fields used to force wam curr this is an operational configuration of the regional ocean modelling system roms see shchepetkin and mcwilliams 2005 operated by the norwegian meteorological institute it is a three dimensional ocean circulation model hereinafter ocean model with 800 m horizontal resolution and 42 vertical levels using topography following coordinates the ocean model is forced at the boundaries by the hybrid coordinate ocean model which is part of the topaz system operated for the pan european copernicus marine service https cmems met no arc mfc eight tidal constituents are included in the barotropic boundary conditions further specifications of the ocean model setup are given by albretsen et al 2011 the ocean model gives a good representation of the currents along the coast of norway which is dominated by the nac and the ncc together with the tides christensen et al 2018 kristensen and gusdal 2021 the ncc on average flows northwards fig 2b and is loosely following the isobaths of the continental shelf fig 1 smaller scale dynamics includes sub mesoscale eddies i e of the order of 0 1 10 km see mcwilliams 2016 originating from baroclinic instabilities fig 2a and inertial currents resulting from the wind forcing röhrs and christensen 2015 the appearance of eddies are readily observed indirectly by optical satellite instruments if algal blooms are present fig 2c their exact location in the ocean model is however associated with larger uncertainty compared with the mean flow baroclinic dynamics associated with the ncc are also transient as they are advected northwards by the mean flow the variability of the ncc is also strongly modulated by the tides fig 2d further to this several areas close to the shoreline have high variability but with a weak mean flow this includes moskstraumen where os21 found the horizontal extent magnitude direction and phase of the modeled current field to be in reasonable agreement with in situ and satellite observations wind forcing was taken from the operational forecasts generated by the arome arctic numerical weather prediction model operated by the norwegian meteorological institute it is a 2 5 km horizontal resolution non hydrostatic model with 65 vertical levels and is primarily based on the high resolution limited area model hirlam aladin research on mesoscale operational nwp in euromed harmonie arome configuration further specifications are given in müller et al 2017 we used the surface wind fields u 10 as input to s in 2 1 4 in situ observations observations from two instruments located in the southern part of the model domain were available during the period studied see a b fig 1 the first a nortek signature 500 acoustic doppler current profiler adcp was located east in moskstraumen these measurements were reported by os21 where a more complete description of the data set and the area can be found the observations include standard integrated wave parameters like significant wave height and the mean wave period together with wave directional information in addition the adcp measured the vertical profile of the current which is barotropic during the tidal cycles os21 wave measurements during two of the spring tide events were sometimes flagged as invalid at maximum current speed because the instrument tilted beyond the operating range 10 from zenith the second in situ instrument is a datawell mk3 waverider buoy wr moored near the island of tennholmen this buoy reported significant wave height and mean zero upcrossing period t z with hourly temporal resolution for practical purposes we denote both the observed and spectral estimate of significant wave height as h s since they are very similar holthuijsen 2007 the same applies for the mean wave period hereafter denoted t m 02 the maximum observed h s values were about 8 5 m and 10 5 m from the adcp and the wr respectively not shown 2 1 5 remote sensing observations several satellite altimeter missions are archived and openly accessible through the esa sea state climate change initiative cci https data ceda ac uk neodc esacci sea state data v1 1 release l2p and the copernicus marine service https marine copernicus eu this includes the copernicus sentinel 3 missions together with the saral altika and cryosat 2 it is common to filter and resample level 2 20 hz approx 350 m resolution retrievals to level 3 1 hz approx 7 km resolution bohlinger et al 2019 for december 2018 we used the level 3 multimission dataset from cci for january and february 2019 we used the sentinel 3 level 3 data since the multi mission dataset does not yet cover this period 2 2 verification 2 2 1 verification metrics for verification against observations we computed the normalized root mean squared error nrmse and normalized bias nbias using the same definition as that of ardhuin et al 2010 9 nrmse x x o x m 2 x o 2 10 nbias x x o x m x o here subscripts o and m denote observation and model respectively and x denotes the variable for model intercomparison we denote the absolute difference between the two wave model integrations as δ x wam curr wam ref relative changes between the model runs are denoted as 11 rc x δ x x ref where the subscript ref indicates values from wam ref instead of the nrmse we computed the rmse in this respect further we computed the mean standard deviation σ and minimum maximum difference 2 2 2 spatio temporal variability since the ocean circulation within the model domain is dominated by the ncc inertial currents and the tides we expect wave heights to be modulated on the associated temporal scales for tides we consider the m2 semidiurnal tidal constituent the inertial frequency is the about the same as m2 in the area making it difficult to discriminate these in the open ocean close to shore however the topography cancels the inertial response for baroclinic instabilities associated with the ncc namely fronts and eddies we consider frequencies between hours to a couple of days which generally reflect their life cycle mcwilliams 2016 in order to separate the dominant temporal modes and their associated energy we conducted a time series analysis for all grid points in our model domain similar to the single point analysis by gemmrich and garrett 2012 and os21 that is power spectral densities psds for each model grid point i j were computed for a specific difference variable δ x i e wam curr wam ref we now compute the energy associated with the low frequency band f 0 f 1 namely the ncc denoted by index 1 and the high frequency band f 2 f 3 namely m2 denoted by index 2 as 12 e ˆ 1 i j f 0 f 1 psd δ x i j d f 13 e ˆ 2 i j f 2 f 3 psd δ x i j d f for convenience we here consider h s since it is proportional to the square root of the wave energy note that e ˆ represents the variance of δ x summed over a specific frequency range and should not be confused with the wave energy density e to help visualize the variability of the two frequency bands we now create a red green blue rgb color composite showing the spatio temporal variability of e ˆ as r g b e ˆ 1 e ˆ 2 e ˆ 1 variations associated with the low frequencies 1 appear as purple equal amounts of red and blue while variations associated with high frequencies 2 appear as green black then comes to represent zero variability while white means both temporal scales are present in equal amounts this is a method which is frequently used in remote sensing applications for multitemporal change detection analysis e g marin et al 2015 but to our knowledge has not been applied to spatial spectral analysis of wave model fields before 3 results 3 1 wave model validation against observations 3 1 1 in situ observations and bulk validation energy fluctuations at each observation location are investigated through a power spectral density psd analysis of δ h s fig 4a and h s observations fig 4b for wam curr in moskstraumen the most distinct frequency peaks are located around the tidal constituents m2 and m4 as well as near the inertial frequency f which is about the same as m2 in the area fig 4a this is in accordance with the observations with pronounced peaks around m2 and m4 fig 4b where the latter is shifted slightly toward lower frequencies in wam curr at tennholmen the m2 signal in δ h s is about two orders of magnitude smaller than moskstraumen which makes sense since the area is not exposed to strong tidal currents fig 4 for frequencies below m2 the underlying causes for the inter model discrepancies are many fig 4a firstly there is a delayed response in the mean flow due to the synoptic weather systems os21 found wave breaking in moskstraumen to correspond well with the passage of such systems for frequencies below 0 75 cycles per day see their fig 4c secondly the refraction of wave action density due to eddies and whirls affects the wave height variability on longer time scales than those of the tides this will be discussed in detail later thirdly during one of the storms within our study period e g h s 6 m δ h s exceeded 2 m in moskstraumen thus strong wave height modulations occurred infrequently such a storm event is further elaborated in appendix in terms of verification metrics the overall performance of the wave model compared against the observations is listed in table 1 both model runs have a negative bias of about 10 in h s compared with the in situ observations the nrmses are in the range 17 22 and inter model differences are below 1 we find slightly higher differences in nbias and nrmse for t m02 table 1 this is similar to the results of palmer and saulter 2016 who also reported inconclusive bulk validation metrics but found a more realistic representation of the wave field sub regions dominated by tides model errors accumulate in such metrics if the spatio temporal variations between model output and observations are slightly out of phase due to this ardhuin et al 2012 found increasing wave model errors in tidal currents against a wave model forced with wind only 3 1 2 altimeter observations when considering the entire domain the nbias and nrsme against altimeter observations of h s are virtually identical for both model runs table 1 however sub regions expected to have significant wave current interaction fig 5 do reveal a systematic improvement for all validation parameters for wam ref in vestfjorden location 8 in fig 1 with a 16 reduction in bias in december 2018 p5 table 2 albeit a bit less a decrease in model error and bias can also be seen for p5 from the cmems product here there are twice as many samples as in december 2018 n 76 vs n 29 3 2 large scale model inter comparison 3 2 1 temporal modes in horizontal h s variability in addition to the lowest frequencies see section 3 1 1 we find that δ h s exhibits two main temporal scales controlled by the baroclinic instabilities associated with the ncc t e and the m2 semidiurnal tidal constituent t t in general the life cycle of eddies and fronts lasts from hours to days depending on their generating mechanism and the prevailing conditions mcwilliams 2016 in our domain we find that normally t e t t not shown since the wind forcing is the same in wam curr and wam ref t e and t t should be resolved by wam curr only we used eqs 12 13 to discriminate these temporal modes as follows 14 e ˆ e i j δ f 0 m 1 δ f psd δ h s i j d f 15 e ˆ t i j m 2 δ f m 2 δ f psd δ h s i j d f here δ f 0 correspond to about 0 4 cycles per day and constitute a low pass filter and δ f correspond to about 3 h an rgb composite showing the spatio temporal variability of δ h s is given in fig 6 it is clear that the tides impact the wave height in the area surrounding lofoten in particular in moskstraumen i 7 fig 6 here the energy modulation at m2 is an order of magnitude larger compared with other areas dominated by tidal currents lines i and i i fig 6 furthermore tidal processes mostly dominate close to the coast including in narrow sounds and channels in addition to bathymetric effects some of these are also affected by corner effects that locally accelerate the tidal current we also performed an analysis including the m4 components which gave more or less the same result not shown in some regions t e and t t appear simultaneously but spatially separated as in the highlighted box in these cases the wave height modulation is most often associated with the tides but e ˆ m2 can be orders of magnitudes lower than e ˆ m1 not shown thus the wave current interaction is dominated by tidal processes but local topographic conditions like the corner effect can affect the flow field and also and the incoming wave field for the latter refraction is very sensitive to the incoming wave direction and waves can at times be refracted into sheltered areas between areas 6 and 7 modulation on t e is most pronounced fig 6 here some places have a strong m1 signal while others are modulated on longer time scales similar to the shallow banks outside senja see i i i 6 fig 6 further away from the coast t e is more pronounced but with less variability as seen south and west of lofoten 7 fig 6 this also includes the strip north of rolvsøya location 4 figs 1 6 where the ncc is meandering with strong eddy activity and large current variability figs 2a d as expected this suggests that wave refraction due to eddies and whirls is what drives the differences between the two wave model runs in such areas furthermore it shows that wave current interaction becomes more intense in areas close to the coast with strong tides than further away from the coast 3 2 2 statistical variability there are some systematic differences in the twin model experiment an area which stands out is vestfjorden 8 fig 1 where on average δ h s 0 i e wam curr wam ref in fig 7a the region stands out even more clearly in terms of the relative change rc with mean δ h s values from 20 and above and maximum values well above 100 figs 8a c for δ t m 02 the mean value in vestfjorden is between 0 5 1 s with maxima around 3 s not shown considering the doppler shift and conservation of wave action one would expect the increasing wave periods to be associated with decreasing wave amplitude however δ h s is positive suggesting other dominating mechanisms figs 7a 8a vestfjorden is sheltered from the strongest winds and has in general lower waves compared with the more exposed areas in the lofoten archipelago the systematic increase in h s is mainly caused by advection of wave action due to the tidal oscillations and the ncc together with current induced refraction to illustrate the impact of these effects we inspect a case on 2019 01 05 shown in fig 9 here the area was dominated by eastward propagating swell and calm westerly winds and h s about 0 1 m and 0 6 m in wam ref and wam curr respectively not shown the wind sea wave height was more or less the same in both models lower middle left panel of fig 9 the swell heights however were larger in wam curr and the mean swell direction was more northwards compared with wam ref upper middle right panel of fig 9 swell enters vestfjorden through moskstraumen and meets strong current dipoles caused by the tidal current see fig 9 os21 and fig 8 børve et al 2021 current induced refraction is strongly connected to the vertical vorticity ζ of the current dysthe 2001 and the dipoles thus have a strong influence on the wave propagation paths when propagating through moskstraumen as shown by os21 their fig 12 the influence of current refraction on swell can also explain the aforementioned mean increase in δ t m 02 with longer swell propagating into vestfjorden in wam curr upper right hand panel of fig 9 in addition to refraction in moskstraumen the advection of wave action from the south by the ncc see fig 1 also modulates the wave field the mean h s difference for a 24 hour period was higher in wam curr despite the changing vorticity field in moskstraumen due to the tidal current lower right panel of fig 9 the accumulation of wave action in vestfjorden is in accordance with the results of ardhuin et al 2017 who found refraction and advection effects to dominate and partially cancel each other for scales larger than 30 km inclusion of current forcing tends to also reduce the horizontal difference in h s across the lofoten peninsula not shown the shallow banks outside senja reveal a positive mean and large maximum δ h s location 6 fig 7 there are also several locations in lee of the mean ncc that exhibit substantial differences in wave energy connected to flow acceleration from corner effects fig 7a it is also interesting to note the separation between areas of positive and negative mean δ h s in the northernmost part of the model domain e g between areas 3 and 4 in fig 7 here areas with on average positive δ h s are located away from the coast i e collocated with regions of higher eddy activity and large current variability figs 2a d and areas that are on average negative are located closer to the coast the σ rmse and min max values indicate some hot spots mostly located close to the shoreline and associated with strong tidal currents fig 7 panels b e these coincide with the strongest signal in the spatio temporal analysis in fig 6 3 3 mapping regions with dangerous sea states the regions identified by the npg have been analyzed using the twin model experiment and observations fig 3 we chose to investigate the areas where the ocean and wave models are expected to represent the dominating physical processes and where the npg gives a sufficient description of the phenomenon and underlying cause hence area 2 is excluded in the analysis in the subsequent sections the regions are categorized according to their dominant cause moskstraumen area 7 is highlighted because of the intense wave current interactions as well as the availability of in situ observations 3 3 1 area 3 and 4 opposing waves and tidal currents area 3 is exposed to the open ocean as well as being subjected to a shallow plateau between 30 70 m location 3 fig 1 which causes additional acceleration of the current there is a clear tidal modulation of the wave field close to shore where wam curr predicts higher mean wave height values 3 figs 6 7a the sharp transition to negative δ h s values further away from the coast is due to the mean flow direction of the ncc being eastward together with waves primarily coming from west in addition the counter flowing m2 component is much weaker further out maximum increase in wave heights for this area was up to 40 in the period studied fig 8c although not confirmed with in situ measurements the current in rolvsøysundet and breisundet rs and bs in fig 10 is estimated to exceed 1 ms 1 den norske los 2018 during spring tide the current is reported to set up a rough sea state a model snapshot is shown in fig 10 here the current meets the waves in rs and bs resulting in an accompanying rc of about 20 and 40 respectively maximum δ h s is about 0 7 m in bs for the entire study period and maximum rc is about 50 the location of the areas with increased wave heights are well predicted by wam curr together with their associated time scale as seen in the highlighted rectangle in fig 6 the area with the largest positive δ h s north of rs is not mentioned in the npg one reason could be that it is located on a shallow plateau with depths between 20 70 m and is thus not used extensively for ship traffic 3 3 2 area 5 and 6 refraction over shallows area 5 exhibits mostly positive mean rc over the shallows banks in the area sometimes exceeding 25 figs 1 8 even though the area is reported in npg the shallows are not denoted in the nautical charts provided by the norwegian mapping authorities contrary to all the other areas https norgeskart no project norgeskart layers 1008 nevertheless the area is qualitatively resolved in terms of increased wave heights over the shallow regions according to the npg the shallow banks outside area 6 are also resolved in wam curr with their on average positive rc in h s up to 15 figs 1 8a the shallow banks are also clearly visible in fig 6 with temporal modes associated with t e according to the npg dangerous waves occur when the tidal cycle is in phase with the ncc the wave heights for northernmost shallow bank outside area 6 increase up to 40 fig 8c in order to quantify the impact of refraction we conducted a wave ray tracing analysis as shown in fig 11 here we have implemented a wave ray tracing solver for the cartesian version of eqs 2 5 to qualitatively assess the importance of refraction switching off the ambient current the wave rays for a 14 s period swell converge over the shallow ridge due to depth induced refraction fig 11d however when currents are included additional wave rays converge over the shallow due to current induced refraction causing the increase in h s in wam curr fig 11c thus the ambient current acts as a wave guide towards the shallower regions by which the waves becomes trapped by the bathymetry which in turn yield increasing wave heights 3 3 3 area 7 moskstraumen intense wave current interaction due to moskstraumen occur on both sides of the southern tip of lofoten location 7 fig 1 the west side is known for the maximum h s modulation but the in situ observations were collected on the east side b fig 1 here the observed interactions are presented first followed by a detailed analysis on the west side the time series of h s and the associated wave spectrum during an 8 day spring tide period in january 2019 are shown in fig 12 at the end of the period wam curr h s compares well with the observations at tidal cycles see black triangles in figs 12a g beginning on 23 january the mean wave propagation direction gradually shifts from west to east following a shift in wind direction figs 12c and d thus wind waves and currents are coming into opposition as the current reaches its maximum this leads to an increase in energy for the wind sea part of the observed and the wam curr spectrum figs 12f g a current of 2 m s 1 fig 12b will block opposing wind waves with periods t 5 s and shorter which correspond well with the observed and modeled wind wave periods of around 0 2 hz figs 12f g the modeled current maximum is more or less in phase with the observations fig 12b however the peak after current maximum is at times out of phase see black arrows fig 12b here the northernmost part of the tidal current that has turned as it turns westward before the rest of the tidal current not shown the turning induces a local horizontal shear of opposing surface currents known locally as strinna which gives rise to a complicated sea state den norske los 2018 thus for the first highlighted h s peak wam curr is out of phase with the observations as the eastward not shown propagating swell undergo an increase in wave energy due to strinna see lowest frequencies about 01 23t12 00 utc fig 12f nevertheless the 1d spectrum also reveal enhanced wave energy for the wind sea at current maximum which corresponds well with the observations figs 12f g however at current maximum the energy of the aforementioned swell decreases due to following waves and currents leading the decrease in h s in the context of numerical ocean modeling a local phenomenon like strinna can contaminate neighboring grid points due to limited horizontal resolution this can in turn lead to a mismatch between wave predictions and observations like in the case just described above this highlights the challenges of comparing individual model grid points with observations upon inspection of the 1d spectrum during current maxima we see that the wave energy around the peak frequency is two orders of magnitude larger in wam curr than wam ref and correspond better with the observations see fig 12h however the energy decay for the higher frequencies are less compared with the observations suggesting that the wave dissipation parameterization is too conservative in cases like this even though wave growth due to blocking waves seems to be the dominant mechanism it most likely occurs in combination with the relative wind and the radiation stresses as also reported by ardhuin et al 2012 vincent 1979 the impact of the relative wind is however not quantified in wam curr section 2 1 2 nevertheless the wind sea modulation at the peak of the tidal cycle corresponds well with the enhanced wave breaking reported by os21 see their fig 7 from fig 12c it is perhaps not obvious that the waves and currents oppose each other near the current maximum since the observed mean wave direction can change erratically and sometimes record westward propagating waves as the adcp is an eulerian measurement these spikes around the current maximum are a result of blocked waves which are advected westward by the strong tidal current additional selected cases comparing observations with model results in moskstraumen are given in appendix from the twin experiment intercomparison maximum h s modulation in moskstraumen occurs on the western side of lofoten when the tidal current is heading westward during a falling tide see area 7 in fig 7e a snapshot from 2019 01 24t05 utc is shown in fig 13 here eastward propagating swell opposes the tidal current using the aforementioned wave ray tracing method a t 12 s period wave train was propagated through the domain this wave period is representative of the peak period in wam curr not shown we find the focusing of wave ray paths to agree with δ h s in the current branch right panel fig 13 local wind sea is also present but the swell part of the spectrum is more strongly modulated by the tidal current not shown trapped waves due to tidal currents were also reported by ardhuin et al 2012 from their field and model study in the fromveur passage in our case however the horizontal extent of the tidal current is not sufficiently long for the swell to be reflected back to the center from the edges of the current branch the largest δ h s west in moskstraumen was about 90 during periods of relatively calm winds with h s between 2 3 m δ h s was about 1 5 m not shown giving a relative difference of about 50 this implies that the current can modify the wave field to the same extent as that of the wind field variations we also found minimum δ t m 02 3 s in moskstraumen which is caused by the increase in wave frequency due to the doppler shift eq 7 4 discussion in moskstraumen the observed temporal scales of wave field modulations are resolved in wam curr figs 4 6 the wave energy density spectrum and the associated h s are at times also correctly represented by wam curr contrary to wam ref see fig 12 this is in agreement with ardhuin et al 2012 who also found their wave model capable of representing the current induced effects using the same wave dissipation parameterization as in our study furthermore and as shown explicitly in appendix the current forcing can impact the wave field to a similar degree to that of wind field and also provide a more realistic representation of h s during strong storms u 10 35 m s 1 δ h s 2 m see fig 15d we find that the largest wave height modulations in tidal currents occur when waves oppose the current for wind sea the increase in wave heights are due to wave blocking and energy bunching due to the doppler shift whereas refraction is most important for swell this is also in agreement with previous work e g baschek 2005 ardhuin et al 2012 masson 1996 romero et al 2017 2020 however deviations between observations and model results suggest that some wave current interactions are not properly resolved by the wave model which is expected due to the limitations of linear theory babanin et al 2017 it is also a reminder of the inaccuracy of comparing single model grid cells with observations as the tidal cycles are well resolved wam curr fig 12f we consider it valid to extrapolate our analysis from moskstraumen to other areas exposed to tidal currents despite the lack of observations this is of particular interest for dangerous wave areas fig 3 and includes area 3 area 4 fig 10 and the west side of moskstraumen fig 13 where we have no in situ measurements for the latter the model inter comparison reveals an increase in h s of up to 90 in the study period on longer time scales wam curr qualitatively resolves areas 5 and 6 in the mean fig 7a but also for single cases fig 11 we find the ambient current to act as a wave guide such that additional wave trains gets trapped by the local bathymetry ultimately leading to increasing wave heights the wave and current conditions correspond to what is reported in the npg den norske los 2018 we find the proposed method of mapping the spatio temporal variability differences between two runs in a twin experiment to be useful in identifying regions with intense wave current interaction fig 6 the information thus provided complements that from the maps of σ and rmse see figs 7b c by clearly distinguishing the dominant spectral regimes at work when overlaying the most dominant areas in fig 6 with the maximum δ h s fig 7e together with the dangerous waves areas fig 3 we see that those that are exposed to strong tidal currents stand out fig 14 as all of these areas were characterized independently in the npg i e the areas 2 8 we conclude that this demonstrates the importance of including current forcing in high resolution wave models in areas with strong currents their use is two fold first the sort of twin model runs shown here can be used to identify areas where the sea state is influenced by strong currents and associated gradients this can best be done by running twin model hindcasts over sufficiently long periods and then analyze the difference fields of the two runs using the methodology presented here in particular mapping the average fig 7 and maximum fig 14 differences in significant wave height δ h s and assessing the associated spectral distribution through rgb composites fig 6 are efficient ways to identify such potentially dangerous regions secondly the same method can be employed for real time forecasting as is done operationally at the norwegian meteorological institute by providing maps of the wave height difference from such twin model forecasts it is immediately evident when and where situations with strong wave current interaction can be expected in area 8 in vestfjorden we do not find spiky values in δ h s indicating large waves however we do find that wam curr reduces the bias and nrmse in h s against altimeter observations p5 table 2 and figs 5 7 and 8 for the remainder of the domain wave height variations mostly occur on shorter horizontal scales than the vestfjorden basin like p1 p4 in fig 5 such that the coarse resolution of level 3 altimeter observations about 7 km is insufficient to reveal the differences utilizing level 2 observations using novel filtering methods such as bohlinger et al 2019 for characterizing wave height variability will be the focus of future studies an area that stands out with strong wave field modulation which is not reported in the npg is located between area 6 and 7 in fig 3 our findings show that e ˆ t e ˆ e fig 14 however e ˆ m1 is in the northernmost part similar to that in moskstraumen see line i fig 6 further south the wave field modulation occur on frequencies below m1 suggesting that refraction due to eddies and whirls dominate more field work experiments is needed to properly assess wave current interaction in this area a limitation in the present study is the use of surface currents and not taking into account the vertical shear of the currents even though this can be considered a second order effect it is expected to have an impact on the wave field quinn et al 2017 on the other hand tidal currents are often barotropic like moskstraumen see fig 7 in os21 which justifies the use of surface currents in these areas to summarize five out of seven areas known for dangerous waves are qualitatively resolved in wam curr in terms of increased wave heights i e 3 7 fig 14 for these areas the dominating cause leading to wave growth agrees with the reports in the npg the two remaining areas i e 2 and 8 wam curr does neither indicate situations with particularly large waves in our study period nor does it imply large local horizontal wave height gradients nevertheless the large mean relative h s increase in vestfjorden together with the bias reduction against altimeter observations show that the wave field representation in this region is improved in wam curr based on the results and the discussion above we argue that current forcing should be included in wave forecasts in our study region in particular tidal currents as they enforce the largest wave field variability and makes a large impact on the wave heights spectral wave models have for decades proven to yield good predictions of the sea state including under extreme storm events aarnes et al 2012 however with the advent of high resolution operational ocean models capable of faithfully resolving the tidal and baroclinic current field the modulation of the wave field by spatially varying currents should also be taken into account 5 conclusion in a twin wave model study in northern norway we have investigated the impact of current forcing in spectral wave models this is an area exposed to waves from the open ocean and an ocean circulation which is dominated by tides and energetic currents with associated eddies we find the wave model with current forcing to qualitatively resolve several areas that are reported in the norwegian pilot guide for their large and sometimes dangerous waves due to intense wave current interaction this is in contrast to the wave model without current forcing the dominating physical mechanism leading to increased wave heights also correspond to the reports in the pilot guide further to this our results indicate that some areas undergo strong wave height modulations which are not reported in the pilot guide we find the proposed diagnostic method for mapping temporal variability in twin model experiments to be convenient in analyzing regions dominated by ocean dynamics on different time scales it is easy to implement and simple to adjust in terms of frequency ranges of interest in this work we focused mainly on the modulation of the significant wave height tidal currents induce the largest absolute wave height discrepancies between the two model runs we find the magnitude and phase in wave height variability to be well represented in moskstraumen which is one of the world s strongest tidal currents in the open ocean here we find wave height deviations between the twin model runs up to 50 to corroborate with observations furthermore and in absence of direct observations we find inter model h s differences up to 90 in tidal currents maximum relative wave height discrepancies were found in areas sheltered from the open ocean and with less energetic currents like vestfjorden here we find a better correspondence between altimeter observations of h s and the wave model predictions with current forcing refraction and advection of wave action reduces the bias and rmse by up to 16 and 18 respectively for specific periods the spatial extent of vestfjorden is also large enough to be sufficiently resolved by conventional level 3 altimeter observations inclusion of current forcing is still uncommon at operational centers palmer and saulter 2016 staneva et al 2015 kanarik et al 2021 rapizo et al 2018 we would suggest to include current forcing in the wave forecast models covering northern norway particularly in areas with strong tidal currents the current forcing enforce an improved representation of the wave field for the end users credit authorship contribution statement trygve halsne conceptualization methodology investigation writing original draft patrik bohlinger validation writing original draft kai håkon christensen writing original draft supervision ana carrasco resources øyvind breivik writing original draft supervision declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments this research was partly funded by the research council of norway through the project matnoc grant no 308796 we greatly appreciate all the help from employees at nortek as and the norwegian coastal administration who made possible the instrument deployment as well as acquiring processing and analyzing the adcp data øb gratefully acknowledges the support by the research council of norway through the stormrisk project grant no 300608 th would like to thank thomas lavergne for fruitful discussions concerning data visualization appendix additional selected cases in moskstraumen five additional segments to section 3 3 3 concerning the impact of moskstraumen on the wave field are presented in fig 15 all during rising tide i e with an eastward oriented current in fig 15a h s increases as wind waves meet an opposing current prior to this model snapshot the h s observations are invalid due to the tilt of the adcp here indicated by the missing line in the time series panel nevertheless as the current speed starts decreasing there is a good agreement between the observations and h s predicted by wam curr during maximum current speed otherwise wam ref is actually closer there are however large horizontal gradients in δ h s as is evident from the two dimensional 2d views lower panels in fig 15 thus comparing instead with neighboring grid points yielded slightly different results except near the peak not shown similarly the event in fig 15c is also exposed to opposing wind waves and currents the first and last peak in h s are resolved by wam curr but not by wam ref for the event in fig 15b both wave model runs predict a strong large scale gradient in h s between the west 5 m and east side 2 m of the moskens sound not shown there is also a shear in the ocean current between the tidal current heading eastward and a current following the coast west off lofotodden ending in a clockwise rotating eddy the area sees frequent generation of eddies and dipoles due to the tidal current see fig 9 os21 and fig 8 børve et al 2021 the positive doppler shift due to the wave following tidal current stretches the waves and increases the wave period with an accompanied decrease in wave amplitude in wam curr waves are also advected both by the tidal current and the ncc giving rise to a region where wave action density accumulates in addition when escaping the tidal current the waves experience a negative doppler shift and thus an increase energy as also reported by romero et al 2017 the most extreme wave conditions in the study period occurred in late february with h s modeled to be around 9 m and 11 m by wam curr and wam ref respectively fig 15d the observations were just below 8 5 m the tidal current although weaker than in the other cases was oriented in the same overall direction as the waves giving a strong reduction in h s within the branch of the tidal current negative δ h s region in fig 15d there is an increase in h s towards the coast most likely due to refraction since the current speed is weaker towards the coast palmer and saulter 2016 for the last event the current exceeded 2 m s 1 and the wind speed was below 10 m s 1 heading north west fig 15e between the two tidal cycles both wave models over predict h s but only wam curr resolved the wave height modulations this example demonstrates that the tidal current can impact the wave field to a similar degree to that of the wind field with variations in h s of the order of 50 the second peak in fig 15e covered the maximum relative change in our measurement period which was 55 6 at 2019 02 21t22 utc 
23835,oceanic current forcing in spectral wave models have recently been demonstrated to have a large impact on wave heights at scales between one and up to several hundred kilometers here we investigate the impact of such forcing on open ocean wave heights in northern norway using a high resolution spectral wave model with currents from an ocean circulation model of similar resolution we find that the wave model to a large extent resolves regions identified in the norwegian pilot guide for maritime navigation as having dangerous sea states due to wave current interaction this is in contrast to a wave model forced with surface wind fields only we present a novel diagnostic method to map the spatio temporal scales associated with the wave height modulation between the two wave model predictions the method is employed to map areas where significant wave current interaction can be expected in many cases we are also able to confirm the physical mechanisms reported in the pilot guide which are leading to an increase in wave energy due to currents the largest wave height differences between the two models occur when waves and currents are opposing each other in such situations refraction and wave blocking are the dominating effects for the swell and wind sea parts of the spectrum respectively furthermore including current forcing significantly improves the agreement with in situ observations in strong tidal currents here we see an increase in significant wave height of up to 50 even larger relative differences exceeding 100 are found in sheltered areas with one specific region showing a reduction in model errors of 18 due to refraction and advection of wave action keywords wave current interaction tidal dynamics wave trapping water waves 1 introduction inclusion of ocean currents as forcing in spectral wave models is an active field of research since it is one of the least developed and least verified parts in such models babanin et al 2017 2019 this is obviously important for day to day wave forecasting in regions with strong currents but also for other aspects like modeling air sea interactions due to the exchange of properties through the interface which is key for climate predictions cavaleri et al 2012 ocean currents can modulate wave heights significantly and even dominate the variability in the open ocean at scales of 10 100 km ardhuin et al 2017 for shorter scales sub mesoscale fronts have been found to increase significant wave heights up to 30 romero et al 2017 and twin model experiments have revealed wave height modulations up to 80 due to current induced refraction in low wind conditions romero et al 2020 furthermore periodic interactions in tidal currents is known to induce intense local wave height modulations such as reported by masson 1996 northern norway is known for its extraordinarily strong open ocean tidal currents gjevik et al 1997 in addition the region is subject to a turbulent flow field with strong eddies in the norwegian atlantic current nac and the norwegian coastal current ncc mork 1981 see figs 1 2 further to this the northeast atlantic is home to the most extreme wave climate globally aarnes et al 2012 this makes northern norway an interesting region to study wave current interaction as there is a steady influx of swell in addition to local windsea specific areas are known for intense interactions described in detail in the norwegian pilot guide den norske los 2018 hereinafter npg some are also mentioned in the classical literature gjevik et al 1997 in the npg they are referred to as areas of dangerous waves fig 3 this information was collected from an extensive survey among experienced sailors and local fishermen in addition to mapping these areas the survey also addressed the characteristic current and wave conditions presumed responsible for the choppy and sometimes dangerous sea states however there have been no attempts to resolve these areas using spectral wave models in this work we aim to map areas known or not known for high and dangerous sea states presumed due to wave current interaction using state of the art wave and ocean models moreover as different flow regimes e g tidal and sub mesoscale are associated with various temporal and horizontal scales we investigate if such a model coupling also resolves spatio temporal variability in the wave field including the extreme values in specific regions like strong tidal currents only a few studies have investigated the impact of currents on the wave field in northern norway segtnan 2014 used the wave refraction model by mathiesen 1987 and found that the wave propagation direction close to the coast was often misaligned with the wave direction offshore the misalignment was attributed to current induced refraction due to the eddies associated with the ncc saetra et al 2021 hereinafter os21 investigated wave current interaction in the lofoten maelstrom which is one of the world s strongest open ocean tidal currents they found that wave breaking increased during maximum current speeds this was associated with an increase in wave height due to horizontal gradients in the tidal current neither of these studies sufficiently examined the flow fields impact on the wave height and the associated horizontal variability here we investigate the impact of currents by comparing the results from a twin experiment with identical spectral wave models hereinafter wave models with different forcing i e one with wind and currents and one forced with wind only similar model setups have recently been shown to yield acceptable results on large e g marechal and ardhuin 2021 intermediate e g kanarik et al 2021 and small horizontal scales e g romero et al 2020 including tidal currents ardhuin et al 2012 we assess the impact by different current regimes on the wave field by analyzing specific events and by comparing them with in situ and remote sensing observations we also present a novel generic method to map spatio temporal variability in twin experiments based on time series analysis which in this context is used to map regions with strong wave current interaction more generally we assess the usefulness of such an approach for sensitivity analysis in twin model experiments the paper is structured as follows in section 2 we provide a description of the models forcing and observations together with metrics and methods used for validation in section 3 we present our results which are further discussed in section 4 we then present our concluding remarks in section 5 2 materials and methods 2 1 models and observations 2 1 1 model domain and study period the model domain covers the coast of northern norway fig 1 an area with extensive maritime activity including ship traffic fisheries marine engineering and marine harvesting fish farming the domain is identical to the high resolution operational wave forecast model at the norwegian meteorological institute for this region northern norway is located in the belt of westerlies and is thus dominated by westerly winds and waves specific areas in the region are subject to vigorous tidal currents due to the semi diurnal northward propagating kelvin wave one of these is the aforementioned lofoten maelstrom located on the southern tip of lofoten location 7 fig 1 local names are referred to in italic the tidal current s local name is moskstraumen which we will use here see b fig 1 combined with the norwegian coastal current that meanders northward loosely following the bathymetry of the shelf these strong tidal currents give rise to very strong current gradients this study covers the period from 2018 12 01 until 2019 02 28 which includes six spring tide periods and some storms mainly approaching the continental shelf from the west outside lofoten six times during the period h s reached values above 6 m not shown the particular period was chosen since it overlaps with in situ observations from a measurement campaign in moskstraumen saetra et al 2021 we pay particular attention to the locations denoted a and b and those numbered 2 8 in fig 1 the first a and b denote the location of the in situ observations while the latter 2 8 denote areas known for dangerous waves according to their numbering in the npg see fig 3 the reason why we start counting on 2 is that area 1 is outside our model domain 2 1 2 the wam spectral wave model we used a recent version of the wave model wam cycle 4 7 komen et al 1994 behrens et al 2013 wam solves the wave action balance equation 1 n t 1 cos ϕ ϕ ϕ cos ϕ n λ λ n ω ω n θ θ n s in s nl s ds s bot σ 1 where n e σ the wave action density is the ratio of the spectral wave energy density e e t ϕ λ ω θ and the intrinsic wave angular frequency σ furthermore t ϕ λ ω and θ denote time latitude longitude angular frequency and direction respectively the right hand side in 1 denotes the parameterized physical processes which represents the wind input s in from ardhuin et al 2010 non linear wave wave interactions s nl from hasselmann et al 1985 wave dissipation due to white capping s ds from ardhuin et al 2010 and bottom friction s bot from hasselmann et al 1985 the terms denoted with overdots in eq 1 describe the wave kinematics governed by 2 ϕ c g cos θ u r 1 3 λ c g sin θ v r cos θ 1 4 ω ω t 5 θ c g sin θ tan ϕ r 1 θ d where u u v is the horizontal surface current velocity vector r is the radius of the earth c g is the wave group velocity and 6 θ d sin θ ϕ ω cos θ cos ϕ λ ω k r 1 here k is the wave number vector and k k latitudinal and longitudinal advection of wave action by the wave group velocity and the ambient current are represented by eqs 2 3 the temporal change of angular frequency is given by eq 4 where ω is the doppler shift dispersion relation 7 ω ω k x t σ k u where x x y is the horizontal positional vector the intrinsic frequency follows the linear dispersion relation 8 σ g k tanh k d here g d are the gravitational acceleration and water depth respectively the refraction or turning of waves due to gradients in the ambient current and bathymetry is dictated by eq 5 the model was set up on a regular grid with 800 m horizontal grid resolution it had a spectral resolution of 24 directional and 30 frequency bins ranging from f 0 0 034523 hz to f 29 0 5476419 hz in logarithmic increments such that f i f 0 1 1 i where i 1 2 29 model integration time steps of 30 s were used for both the propagation and source term computations for the boundaries we used hourly 2d spectra from the european centre for medium range weather forecasts ecmwf we performed a twin model experiment using the same model specifications and physical parameterizations both were forced with surface winds but one also included current forcing these two runs are hereinafter referred to as the reference run wam ref i e with zero currents and the run including currents wam curr the current forcing is not part of the source term calculations but is included in the wave kinematics the left hand side of eq 1 as shown in eqs 2 5 2 1 3 wave model forcing norkyst800 provided the ocean surface currents fields used to force wam curr this is an operational configuration of the regional ocean modelling system roms see shchepetkin and mcwilliams 2005 operated by the norwegian meteorological institute it is a three dimensional ocean circulation model hereinafter ocean model with 800 m horizontal resolution and 42 vertical levels using topography following coordinates the ocean model is forced at the boundaries by the hybrid coordinate ocean model which is part of the topaz system operated for the pan european copernicus marine service https cmems met no arc mfc eight tidal constituents are included in the barotropic boundary conditions further specifications of the ocean model setup are given by albretsen et al 2011 the ocean model gives a good representation of the currents along the coast of norway which is dominated by the nac and the ncc together with the tides christensen et al 2018 kristensen and gusdal 2021 the ncc on average flows northwards fig 2b and is loosely following the isobaths of the continental shelf fig 1 smaller scale dynamics includes sub mesoscale eddies i e of the order of 0 1 10 km see mcwilliams 2016 originating from baroclinic instabilities fig 2a and inertial currents resulting from the wind forcing röhrs and christensen 2015 the appearance of eddies are readily observed indirectly by optical satellite instruments if algal blooms are present fig 2c their exact location in the ocean model is however associated with larger uncertainty compared with the mean flow baroclinic dynamics associated with the ncc are also transient as they are advected northwards by the mean flow the variability of the ncc is also strongly modulated by the tides fig 2d further to this several areas close to the shoreline have high variability but with a weak mean flow this includes moskstraumen where os21 found the horizontal extent magnitude direction and phase of the modeled current field to be in reasonable agreement with in situ and satellite observations wind forcing was taken from the operational forecasts generated by the arome arctic numerical weather prediction model operated by the norwegian meteorological institute it is a 2 5 km horizontal resolution non hydrostatic model with 65 vertical levels and is primarily based on the high resolution limited area model hirlam aladin research on mesoscale operational nwp in euromed harmonie arome configuration further specifications are given in müller et al 2017 we used the surface wind fields u 10 as input to s in 2 1 4 in situ observations observations from two instruments located in the southern part of the model domain were available during the period studied see a b fig 1 the first a nortek signature 500 acoustic doppler current profiler adcp was located east in moskstraumen these measurements were reported by os21 where a more complete description of the data set and the area can be found the observations include standard integrated wave parameters like significant wave height and the mean wave period together with wave directional information in addition the adcp measured the vertical profile of the current which is barotropic during the tidal cycles os21 wave measurements during two of the spring tide events were sometimes flagged as invalid at maximum current speed because the instrument tilted beyond the operating range 10 from zenith the second in situ instrument is a datawell mk3 waverider buoy wr moored near the island of tennholmen this buoy reported significant wave height and mean zero upcrossing period t z with hourly temporal resolution for practical purposes we denote both the observed and spectral estimate of significant wave height as h s since they are very similar holthuijsen 2007 the same applies for the mean wave period hereafter denoted t m 02 the maximum observed h s values were about 8 5 m and 10 5 m from the adcp and the wr respectively not shown 2 1 5 remote sensing observations several satellite altimeter missions are archived and openly accessible through the esa sea state climate change initiative cci https data ceda ac uk neodc esacci sea state data v1 1 release l2p and the copernicus marine service https marine copernicus eu this includes the copernicus sentinel 3 missions together with the saral altika and cryosat 2 it is common to filter and resample level 2 20 hz approx 350 m resolution retrievals to level 3 1 hz approx 7 km resolution bohlinger et al 2019 for december 2018 we used the level 3 multimission dataset from cci for january and february 2019 we used the sentinel 3 level 3 data since the multi mission dataset does not yet cover this period 2 2 verification 2 2 1 verification metrics for verification against observations we computed the normalized root mean squared error nrmse and normalized bias nbias using the same definition as that of ardhuin et al 2010 9 nrmse x x o x m 2 x o 2 10 nbias x x o x m x o here subscripts o and m denote observation and model respectively and x denotes the variable for model intercomparison we denote the absolute difference between the two wave model integrations as δ x wam curr wam ref relative changes between the model runs are denoted as 11 rc x δ x x ref where the subscript ref indicates values from wam ref instead of the nrmse we computed the rmse in this respect further we computed the mean standard deviation σ and minimum maximum difference 2 2 2 spatio temporal variability since the ocean circulation within the model domain is dominated by the ncc inertial currents and the tides we expect wave heights to be modulated on the associated temporal scales for tides we consider the m2 semidiurnal tidal constituent the inertial frequency is the about the same as m2 in the area making it difficult to discriminate these in the open ocean close to shore however the topography cancels the inertial response for baroclinic instabilities associated with the ncc namely fronts and eddies we consider frequencies between hours to a couple of days which generally reflect their life cycle mcwilliams 2016 in order to separate the dominant temporal modes and their associated energy we conducted a time series analysis for all grid points in our model domain similar to the single point analysis by gemmrich and garrett 2012 and os21 that is power spectral densities psds for each model grid point i j were computed for a specific difference variable δ x i e wam curr wam ref we now compute the energy associated with the low frequency band f 0 f 1 namely the ncc denoted by index 1 and the high frequency band f 2 f 3 namely m2 denoted by index 2 as 12 e ˆ 1 i j f 0 f 1 psd δ x i j d f 13 e ˆ 2 i j f 2 f 3 psd δ x i j d f for convenience we here consider h s since it is proportional to the square root of the wave energy note that e ˆ represents the variance of δ x summed over a specific frequency range and should not be confused with the wave energy density e to help visualize the variability of the two frequency bands we now create a red green blue rgb color composite showing the spatio temporal variability of e ˆ as r g b e ˆ 1 e ˆ 2 e ˆ 1 variations associated with the low frequencies 1 appear as purple equal amounts of red and blue while variations associated with high frequencies 2 appear as green black then comes to represent zero variability while white means both temporal scales are present in equal amounts this is a method which is frequently used in remote sensing applications for multitemporal change detection analysis e g marin et al 2015 but to our knowledge has not been applied to spatial spectral analysis of wave model fields before 3 results 3 1 wave model validation against observations 3 1 1 in situ observations and bulk validation energy fluctuations at each observation location are investigated through a power spectral density psd analysis of δ h s fig 4a and h s observations fig 4b for wam curr in moskstraumen the most distinct frequency peaks are located around the tidal constituents m2 and m4 as well as near the inertial frequency f which is about the same as m2 in the area fig 4a this is in accordance with the observations with pronounced peaks around m2 and m4 fig 4b where the latter is shifted slightly toward lower frequencies in wam curr at tennholmen the m2 signal in δ h s is about two orders of magnitude smaller than moskstraumen which makes sense since the area is not exposed to strong tidal currents fig 4 for frequencies below m2 the underlying causes for the inter model discrepancies are many fig 4a firstly there is a delayed response in the mean flow due to the synoptic weather systems os21 found wave breaking in moskstraumen to correspond well with the passage of such systems for frequencies below 0 75 cycles per day see their fig 4c secondly the refraction of wave action density due to eddies and whirls affects the wave height variability on longer time scales than those of the tides this will be discussed in detail later thirdly during one of the storms within our study period e g h s 6 m δ h s exceeded 2 m in moskstraumen thus strong wave height modulations occurred infrequently such a storm event is further elaborated in appendix in terms of verification metrics the overall performance of the wave model compared against the observations is listed in table 1 both model runs have a negative bias of about 10 in h s compared with the in situ observations the nrmses are in the range 17 22 and inter model differences are below 1 we find slightly higher differences in nbias and nrmse for t m02 table 1 this is similar to the results of palmer and saulter 2016 who also reported inconclusive bulk validation metrics but found a more realistic representation of the wave field sub regions dominated by tides model errors accumulate in such metrics if the spatio temporal variations between model output and observations are slightly out of phase due to this ardhuin et al 2012 found increasing wave model errors in tidal currents against a wave model forced with wind only 3 1 2 altimeter observations when considering the entire domain the nbias and nrsme against altimeter observations of h s are virtually identical for both model runs table 1 however sub regions expected to have significant wave current interaction fig 5 do reveal a systematic improvement for all validation parameters for wam ref in vestfjorden location 8 in fig 1 with a 16 reduction in bias in december 2018 p5 table 2 albeit a bit less a decrease in model error and bias can also be seen for p5 from the cmems product here there are twice as many samples as in december 2018 n 76 vs n 29 3 2 large scale model inter comparison 3 2 1 temporal modes in horizontal h s variability in addition to the lowest frequencies see section 3 1 1 we find that δ h s exhibits two main temporal scales controlled by the baroclinic instabilities associated with the ncc t e and the m2 semidiurnal tidal constituent t t in general the life cycle of eddies and fronts lasts from hours to days depending on their generating mechanism and the prevailing conditions mcwilliams 2016 in our domain we find that normally t e t t not shown since the wind forcing is the same in wam curr and wam ref t e and t t should be resolved by wam curr only we used eqs 12 13 to discriminate these temporal modes as follows 14 e ˆ e i j δ f 0 m 1 δ f psd δ h s i j d f 15 e ˆ t i j m 2 δ f m 2 δ f psd δ h s i j d f here δ f 0 correspond to about 0 4 cycles per day and constitute a low pass filter and δ f correspond to about 3 h an rgb composite showing the spatio temporal variability of δ h s is given in fig 6 it is clear that the tides impact the wave height in the area surrounding lofoten in particular in moskstraumen i 7 fig 6 here the energy modulation at m2 is an order of magnitude larger compared with other areas dominated by tidal currents lines i and i i fig 6 furthermore tidal processes mostly dominate close to the coast including in narrow sounds and channels in addition to bathymetric effects some of these are also affected by corner effects that locally accelerate the tidal current we also performed an analysis including the m4 components which gave more or less the same result not shown in some regions t e and t t appear simultaneously but spatially separated as in the highlighted box in these cases the wave height modulation is most often associated with the tides but e ˆ m2 can be orders of magnitudes lower than e ˆ m1 not shown thus the wave current interaction is dominated by tidal processes but local topographic conditions like the corner effect can affect the flow field and also and the incoming wave field for the latter refraction is very sensitive to the incoming wave direction and waves can at times be refracted into sheltered areas between areas 6 and 7 modulation on t e is most pronounced fig 6 here some places have a strong m1 signal while others are modulated on longer time scales similar to the shallow banks outside senja see i i i 6 fig 6 further away from the coast t e is more pronounced but with less variability as seen south and west of lofoten 7 fig 6 this also includes the strip north of rolvsøya location 4 figs 1 6 where the ncc is meandering with strong eddy activity and large current variability figs 2a d as expected this suggests that wave refraction due to eddies and whirls is what drives the differences between the two wave model runs in such areas furthermore it shows that wave current interaction becomes more intense in areas close to the coast with strong tides than further away from the coast 3 2 2 statistical variability there are some systematic differences in the twin model experiment an area which stands out is vestfjorden 8 fig 1 where on average δ h s 0 i e wam curr wam ref in fig 7a the region stands out even more clearly in terms of the relative change rc with mean δ h s values from 20 and above and maximum values well above 100 figs 8a c for δ t m 02 the mean value in vestfjorden is between 0 5 1 s with maxima around 3 s not shown considering the doppler shift and conservation of wave action one would expect the increasing wave periods to be associated with decreasing wave amplitude however δ h s is positive suggesting other dominating mechanisms figs 7a 8a vestfjorden is sheltered from the strongest winds and has in general lower waves compared with the more exposed areas in the lofoten archipelago the systematic increase in h s is mainly caused by advection of wave action due to the tidal oscillations and the ncc together with current induced refraction to illustrate the impact of these effects we inspect a case on 2019 01 05 shown in fig 9 here the area was dominated by eastward propagating swell and calm westerly winds and h s about 0 1 m and 0 6 m in wam ref and wam curr respectively not shown the wind sea wave height was more or less the same in both models lower middle left panel of fig 9 the swell heights however were larger in wam curr and the mean swell direction was more northwards compared with wam ref upper middle right panel of fig 9 swell enters vestfjorden through moskstraumen and meets strong current dipoles caused by the tidal current see fig 9 os21 and fig 8 børve et al 2021 current induced refraction is strongly connected to the vertical vorticity ζ of the current dysthe 2001 and the dipoles thus have a strong influence on the wave propagation paths when propagating through moskstraumen as shown by os21 their fig 12 the influence of current refraction on swell can also explain the aforementioned mean increase in δ t m 02 with longer swell propagating into vestfjorden in wam curr upper right hand panel of fig 9 in addition to refraction in moskstraumen the advection of wave action from the south by the ncc see fig 1 also modulates the wave field the mean h s difference for a 24 hour period was higher in wam curr despite the changing vorticity field in moskstraumen due to the tidal current lower right panel of fig 9 the accumulation of wave action in vestfjorden is in accordance with the results of ardhuin et al 2017 who found refraction and advection effects to dominate and partially cancel each other for scales larger than 30 km inclusion of current forcing tends to also reduce the horizontal difference in h s across the lofoten peninsula not shown the shallow banks outside senja reveal a positive mean and large maximum δ h s location 6 fig 7 there are also several locations in lee of the mean ncc that exhibit substantial differences in wave energy connected to flow acceleration from corner effects fig 7a it is also interesting to note the separation between areas of positive and negative mean δ h s in the northernmost part of the model domain e g between areas 3 and 4 in fig 7 here areas with on average positive δ h s are located away from the coast i e collocated with regions of higher eddy activity and large current variability figs 2a d and areas that are on average negative are located closer to the coast the σ rmse and min max values indicate some hot spots mostly located close to the shoreline and associated with strong tidal currents fig 7 panels b e these coincide with the strongest signal in the spatio temporal analysis in fig 6 3 3 mapping regions with dangerous sea states the regions identified by the npg have been analyzed using the twin model experiment and observations fig 3 we chose to investigate the areas where the ocean and wave models are expected to represent the dominating physical processes and where the npg gives a sufficient description of the phenomenon and underlying cause hence area 2 is excluded in the analysis in the subsequent sections the regions are categorized according to their dominant cause moskstraumen area 7 is highlighted because of the intense wave current interactions as well as the availability of in situ observations 3 3 1 area 3 and 4 opposing waves and tidal currents area 3 is exposed to the open ocean as well as being subjected to a shallow plateau between 30 70 m location 3 fig 1 which causes additional acceleration of the current there is a clear tidal modulation of the wave field close to shore where wam curr predicts higher mean wave height values 3 figs 6 7a the sharp transition to negative δ h s values further away from the coast is due to the mean flow direction of the ncc being eastward together with waves primarily coming from west in addition the counter flowing m2 component is much weaker further out maximum increase in wave heights for this area was up to 40 in the period studied fig 8c although not confirmed with in situ measurements the current in rolvsøysundet and breisundet rs and bs in fig 10 is estimated to exceed 1 ms 1 den norske los 2018 during spring tide the current is reported to set up a rough sea state a model snapshot is shown in fig 10 here the current meets the waves in rs and bs resulting in an accompanying rc of about 20 and 40 respectively maximum δ h s is about 0 7 m in bs for the entire study period and maximum rc is about 50 the location of the areas with increased wave heights are well predicted by wam curr together with their associated time scale as seen in the highlighted rectangle in fig 6 the area with the largest positive δ h s north of rs is not mentioned in the npg one reason could be that it is located on a shallow plateau with depths between 20 70 m and is thus not used extensively for ship traffic 3 3 2 area 5 and 6 refraction over shallows area 5 exhibits mostly positive mean rc over the shallows banks in the area sometimes exceeding 25 figs 1 8 even though the area is reported in npg the shallows are not denoted in the nautical charts provided by the norwegian mapping authorities contrary to all the other areas https norgeskart no project norgeskart layers 1008 nevertheless the area is qualitatively resolved in terms of increased wave heights over the shallow regions according to the npg the shallow banks outside area 6 are also resolved in wam curr with their on average positive rc in h s up to 15 figs 1 8a the shallow banks are also clearly visible in fig 6 with temporal modes associated with t e according to the npg dangerous waves occur when the tidal cycle is in phase with the ncc the wave heights for northernmost shallow bank outside area 6 increase up to 40 fig 8c in order to quantify the impact of refraction we conducted a wave ray tracing analysis as shown in fig 11 here we have implemented a wave ray tracing solver for the cartesian version of eqs 2 5 to qualitatively assess the importance of refraction switching off the ambient current the wave rays for a 14 s period swell converge over the shallow ridge due to depth induced refraction fig 11d however when currents are included additional wave rays converge over the shallow due to current induced refraction causing the increase in h s in wam curr fig 11c thus the ambient current acts as a wave guide towards the shallower regions by which the waves becomes trapped by the bathymetry which in turn yield increasing wave heights 3 3 3 area 7 moskstraumen intense wave current interaction due to moskstraumen occur on both sides of the southern tip of lofoten location 7 fig 1 the west side is known for the maximum h s modulation but the in situ observations were collected on the east side b fig 1 here the observed interactions are presented first followed by a detailed analysis on the west side the time series of h s and the associated wave spectrum during an 8 day spring tide period in january 2019 are shown in fig 12 at the end of the period wam curr h s compares well with the observations at tidal cycles see black triangles in figs 12a g beginning on 23 january the mean wave propagation direction gradually shifts from west to east following a shift in wind direction figs 12c and d thus wind waves and currents are coming into opposition as the current reaches its maximum this leads to an increase in energy for the wind sea part of the observed and the wam curr spectrum figs 12f g a current of 2 m s 1 fig 12b will block opposing wind waves with periods t 5 s and shorter which correspond well with the observed and modeled wind wave periods of around 0 2 hz figs 12f g the modeled current maximum is more or less in phase with the observations fig 12b however the peak after current maximum is at times out of phase see black arrows fig 12b here the northernmost part of the tidal current that has turned as it turns westward before the rest of the tidal current not shown the turning induces a local horizontal shear of opposing surface currents known locally as strinna which gives rise to a complicated sea state den norske los 2018 thus for the first highlighted h s peak wam curr is out of phase with the observations as the eastward not shown propagating swell undergo an increase in wave energy due to strinna see lowest frequencies about 01 23t12 00 utc fig 12f nevertheless the 1d spectrum also reveal enhanced wave energy for the wind sea at current maximum which corresponds well with the observations figs 12f g however at current maximum the energy of the aforementioned swell decreases due to following waves and currents leading the decrease in h s in the context of numerical ocean modeling a local phenomenon like strinna can contaminate neighboring grid points due to limited horizontal resolution this can in turn lead to a mismatch between wave predictions and observations like in the case just described above this highlights the challenges of comparing individual model grid points with observations upon inspection of the 1d spectrum during current maxima we see that the wave energy around the peak frequency is two orders of magnitude larger in wam curr than wam ref and correspond better with the observations see fig 12h however the energy decay for the higher frequencies are less compared with the observations suggesting that the wave dissipation parameterization is too conservative in cases like this even though wave growth due to blocking waves seems to be the dominant mechanism it most likely occurs in combination with the relative wind and the radiation stresses as also reported by ardhuin et al 2012 vincent 1979 the impact of the relative wind is however not quantified in wam curr section 2 1 2 nevertheless the wind sea modulation at the peak of the tidal cycle corresponds well with the enhanced wave breaking reported by os21 see their fig 7 from fig 12c it is perhaps not obvious that the waves and currents oppose each other near the current maximum since the observed mean wave direction can change erratically and sometimes record westward propagating waves as the adcp is an eulerian measurement these spikes around the current maximum are a result of blocked waves which are advected westward by the strong tidal current additional selected cases comparing observations with model results in moskstraumen are given in appendix from the twin experiment intercomparison maximum h s modulation in moskstraumen occurs on the western side of lofoten when the tidal current is heading westward during a falling tide see area 7 in fig 7e a snapshot from 2019 01 24t05 utc is shown in fig 13 here eastward propagating swell opposes the tidal current using the aforementioned wave ray tracing method a t 12 s period wave train was propagated through the domain this wave period is representative of the peak period in wam curr not shown we find the focusing of wave ray paths to agree with δ h s in the current branch right panel fig 13 local wind sea is also present but the swell part of the spectrum is more strongly modulated by the tidal current not shown trapped waves due to tidal currents were also reported by ardhuin et al 2012 from their field and model study in the fromveur passage in our case however the horizontal extent of the tidal current is not sufficiently long for the swell to be reflected back to the center from the edges of the current branch the largest δ h s west in moskstraumen was about 90 during periods of relatively calm winds with h s between 2 3 m δ h s was about 1 5 m not shown giving a relative difference of about 50 this implies that the current can modify the wave field to the same extent as that of the wind field variations we also found minimum δ t m 02 3 s in moskstraumen which is caused by the increase in wave frequency due to the doppler shift eq 7 4 discussion in moskstraumen the observed temporal scales of wave field modulations are resolved in wam curr figs 4 6 the wave energy density spectrum and the associated h s are at times also correctly represented by wam curr contrary to wam ref see fig 12 this is in agreement with ardhuin et al 2012 who also found their wave model capable of representing the current induced effects using the same wave dissipation parameterization as in our study furthermore and as shown explicitly in appendix the current forcing can impact the wave field to a similar degree to that of wind field and also provide a more realistic representation of h s during strong storms u 10 35 m s 1 δ h s 2 m see fig 15d we find that the largest wave height modulations in tidal currents occur when waves oppose the current for wind sea the increase in wave heights are due to wave blocking and energy bunching due to the doppler shift whereas refraction is most important for swell this is also in agreement with previous work e g baschek 2005 ardhuin et al 2012 masson 1996 romero et al 2017 2020 however deviations between observations and model results suggest that some wave current interactions are not properly resolved by the wave model which is expected due to the limitations of linear theory babanin et al 2017 it is also a reminder of the inaccuracy of comparing single model grid cells with observations as the tidal cycles are well resolved wam curr fig 12f we consider it valid to extrapolate our analysis from moskstraumen to other areas exposed to tidal currents despite the lack of observations this is of particular interest for dangerous wave areas fig 3 and includes area 3 area 4 fig 10 and the west side of moskstraumen fig 13 where we have no in situ measurements for the latter the model inter comparison reveals an increase in h s of up to 90 in the study period on longer time scales wam curr qualitatively resolves areas 5 and 6 in the mean fig 7a but also for single cases fig 11 we find the ambient current to act as a wave guide such that additional wave trains gets trapped by the local bathymetry ultimately leading to increasing wave heights the wave and current conditions correspond to what is reported in the npg den norske los 2018 we find the proposed method of mapping the spatio temporal variability differences between two runs in a twin experiment to be useful in identifying regions with intense wave current interaction fig 6 the information thus provided complements that from the maps of σ and rmse see figs 7b c by clearly distinguishing the dominant spectral regimes at work when overlaying the most dominant areas in fig 6 with the maximum δ h s fig 7e together with the dangerous waves areas fig 3 we see that those that are exposed to strong tidal currents stand out fig 14 as all of these areas were characterized independently in the npg i e the areas 2 8 we conclude that this demonstrates the importance of including current forcing in high resolution wave models in areas with strong currents their use is two fold first the sort of twin model runs shown here can be used to identify areas where the sea state is influenced by strong currents and associated gradients this can best be done by running twin model hindcasts over sufficiently long periods and then analyze the difference fields of the two runs using the methodology presented here in particular mapping the average fig 7 and maximum fig 14 differences in significant wave height δ h s and assessing the associated spectral distribution through rgb composites fig 6 are efficient ways to identify such potentially dangerous regions secondly the same method can be employed for real time forecasting as is done operationally at the norwegian meteorological institute by providing maps of the wave height difference from such twin model forecasts it is immediately evident when and where situations with strong wave current interaction can be expected in area 8 in vestfjorden we do not find spiky values in δ h s indicating large waves however we do find that wam curr reduces the bias and nrmse in h s against altimeter observations p5 table 2 and figs 5 7 and 8 for the remainder of the domain wave height variations mostly occur on shorter horizontal scales than the vestfjorden basin like p1 p4 in fig 5 such that the coarse resolution of level 3 altimeter observations about 7 km is insufficient to reveal the differences utilizing level 2 observations using novel filtering methods such as bohlinger et al 2019 for characterizing wave height variability will be the focus of future studies an area that stands out with strong wave field modulation which is not reported in the npg is located between area 6 and 7 in fig 3 our findings show that e ˆ t e ˆ e fig 14 however e ˆ m1 is in the northernmost part similar to that in moskstraumen see line i fig 6 further south the wave field modulation occur on frequencies below m1 suggesting that refraction due to eddies and whirls dominate more field work experiments is needed to properly assess wave current interaction in this area a limitation in the present study is the use of surface currents and not taking into account the vertical shear of the currents even though this can be considered a second order effect it is expected to have an impact on the wave field quinn et al 2017 on the other hand tidal currents are often barotropic like moskstraumen see fig 7 in os21 which justifies the use of surface currents in these areas to summarize five out of seven areas known for dangerous waves are qualitatively resolved in wam curr in terms of increased wave heights i e 3 7 fig 14 for these areas the dominating cause leading to wave growth agrees with the reports in the npg the two remaining areas i e 2 and 8 wam curr does neither indicate situations with particularly large waves in our study period nor does it imply large local horizontal wave height gradients nevertheless the large mean relative h s increase in vestfjorden together with the bias reduction against altimeter observations show that the wave field representation in this region is improved in wam curr based on the results and the discussion above we argue that current forcing should be included in wave forecasts in our study region in particular tidal currents as they enforce the largest wave field variability and makes a large impact on the wave heights spectral wave models have for decades proven to yield good predictions of the sea state including under extreme storm events aarnes et al 2012 however with the advent of high resolution operational ocean models capable of faithfully resolving the tidal and baroclinic current field the modulation of the wave field by spatially varying currents should also be taken into account 5 conclusion in a twin wave model study in northern norway we have investigated the impact of current forcing in spectral wave models this is an area exposed to waves from the open ocean and an ocean circulation which is dominated by tides and energetic currents with associated eddies we find the wave model with current forcing to qualitatively resolve several areas that are reported in the norwegian pilot guide for their large and sometimes dangerous waves due to intense wave current interaction this is in contrast to the wave model without current forcing the dominating physical mechanism leading to increased wave heights also correspond to the reports in the pilot guide further to this our results indicate that some areas undergo strong wave height modulations which are not reported in the pilot guide we find the proposed diagnostic method for mapping temporal variability in twin model experiments to be convenient in analyzing regions dominated by ocean dynamics on different time scales it is easy to implement and simple to adjust in terms of frequency ranges of interest in this work we focused mainly on the modulation of the significant wave height tidal currents induce the largest absolute wave height discrepancies between the two model runs we find the magnitude and phase in wave height variability to be well represented in moskstraumen which is one of the world s strongest tidal currents in the open ocean here we find wave height deviations between the twin model runs up to 50 to corroborate with observations furthermore and in absence of direct observations we find inter model h s differences up to 90 in tidal currents maximum relative wave height discrepancies were found in areas sheltered from the open ocean and with less energetic currents like vestfjorden here we find a better correspondence between altimeter observations of h s and the wave model predictions with current forcing refraction and advection of wave action reduces the bias and rmse by up to 16 and 18 respectively for specific periods the spatial extent of vestfjorden is also large enough to be sufficiently resolved by conventional level 3 altimeter observations inclusion of current forcing is still uncommon at operational centers palmer and saulter 2016 staneva et al 2015 kanarik et al 2021 rapizo et al 2018 we would suggest to include current forcing in the wave forecast models covering northern norway particularly in areas with strong tidal currents the current forcing enforce an improved representation of the wave field for the end users credit authorship contribution statement trygve halsne conceptualization methodology investigation writing original draft patrik bohlinger validation writing original draft kai håkon christensen writing original draft supervision ana carrasco resources øyvind breivik writing original draft supervision declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments this research was partly funded by the research council of norway through the project matnoc grant no 308796 we greatly appreciate all the help from employees at nortek as and the norwegian coastal administration who made possible the instrument deployment as well as acquiring processing and analyzing the adcp data øb gratefully acknowledges the support by the research council of norway through the stormrisk project grant no 300608 th would like to thank thomas lavergne for fruitful discussions concerning data visualization appendix additional selected cases in moskstraumen five additional segments to section 3 3 3 concerning the impact of moskstraumen on the wave field are presented in fig 15 all during rising tide i e with an eastward oriented current in fig 15a h s increases as wind waves meet an opposing current prior to this model snapshot the h s observations are invalid due to the tilt of the adcp here indicated by the missing line in the time series panel nevertheless as the current speed starts decreasing there is a good agreement between the observations and h s predicted by wam curr during maximum current speed otherwise wam ref is actually closer there are however large horizontal gradients in δ h s as is evident from the two dimensional 2d views lower panels in fig 15 thus comparing instead with neighboring grid points yielded slightly different results except near the peak not shown similarly the event in fig 15c is also exposed to opposing wind waves and currents the first and last peak in h s are resolved by wam curr but not by wam ref for the event in fig 15b both wave model runs predict a strong large scale gradient in h s between the west 5 m and east side 2 m of the moskens sound not shown there is also a shear in the ocean current between the tidal current heading eastward and a current following the coast west off lofotodden ending in a clockwise rotating eddy the area sees frequent generation of eddies and dipoles due to the tidal current see fig 9 os21 and fig 8 børve et al 2021 the positive doppler shift due to the wave following tidal current stretches the waves and increases the wave period with an accompanied decrease in wave amplitude in wam curr waves are also advected both by the tidal current and the ncc giving rise to a region where wave action density accumulates in addition when escaping the tidal current the waves experience a negative doppler shift and thus an increase energy as also reported by romero et al 2017 the most extreme wave conditions in the study period occurred in late february with h s modeled to be around 9 m and 11 m by wam curr and wam ref respectively fig 15d the observations were just below 8 5 m the tidal current although weaker than in the other cases was oriented in the same overall direction as the waves giving a strong reduction in h s within the branch of the tidal current negative δ h s region in fig 15d there is an increase in h s towards the coast most likely due to refraction since the current speed is weaker towards the coast palmer and saulter 2016 for the last event the current exceeded 2 m s 1 and the wind speed was below 10 m s 1 heading north west fig 15e between the two tidal cycles both wave models over predict h s but only wam curr resolved the wave height modulations this example demonstrates that the tidal current can impact the wave field to a similar degree to that of the wind field with variations in h s of the order of 50 the second peak in fig 15e covered the maximum relative change in our measurement period which was 55 6 at 2019 02 21t22 utc 
23836,large scale macro vortices could be formed in the lee or around natural obstacles such as islands and headlands during the interaction between geographical features and coastal circulations induced by tides and winds tidal and wind induced vortices play a fundamental role in transport processes of sediments and nutrients and the effects are then reflected on water quality of estuaries and coastal areas in the present study the coastal hydrodynamics of the pearl river estuary and hong kong waters was analyzed in detail using a high resolution model based on the finite volume coastal ocean model fvcom forced by tides and seasonal winds the results showed that the local dynamics was strongly affected by the continuous shedding of macro vortices a classification of these coherent structures was suggested based on their typical evolution to distinguish between tidal vortices and wake vortices using four non dimensional parameters the spatial distribution the seasonality and the probability density functions of their geometrical characteristics were presented and discussed in detail the results suggested that tidal currents played a dominant role in most of the pearl river estuary and the hong kong waters generating for the entire year a high and constant number of macro vortices that occupied most of the north channels of hong kong finally we linked the vortices distribution and their typical features with several important water quality parameters suggesting possible explanations of the observed trends keywords island wake vortex hong kong water quality pearl river estuary tidal circulation vortex dynamics fvcom 1 introduction great efforts have been made to investigate the interaction between oceanic currents and local geometry in estuarine areas where the non linear effects and quadratic friction cannot be neglected lu et al 2015 lai et al 2018 zu and gan 2015 pan et al 2020a wind and tidal forcing are always playing important roles in adjusting the estuarine circulation which has strong relationship with sediment transport zhu et al 2021 seawater quality and biochemical dynamics li et al 2020 yu and gan 2021 the wind stress stirs the ocean surface thus increases the vertical mixing in the water column kato and phillips 1969 besides monsoon wind can generate steady wind stress which together with the coriolis force produces a transport of seawater aligning with the direction of wind price et al 1987 tidal currents carrying huge energy from the deep ocean can make a great difference to the energy and momentum balance in coastal areas due to the tidal distortion and asymmetry in shallow water particularly local circulation can be far more complicated when tidal and wind induced currents interacting with massive nature obstacles where macro vortices could be generated and transported vortices have two main features the first of which is concentrated regions with high vorticity obstacles facing the current could modulate the direction and magnitude of velocity and form a lower velocity zone behind during this process the area around the obstacle exhibits high vorticity and generates vortices the famous tea cup effect brought up by wolanski and hamner wolanski and hamner 1988 illustrated that the unbalanced inward pressure gradient drove the near bottom fluid towards the rotation center and formed upwelling exactly like the tea leaves in the cup this is also the reason that the formation and transport of the vortices are important for sediment and contaminants transport hasegawa et al 2004 2009 coastal vortices can either aid or hinder the transport of nutrients or sediment and may control the distribution of passive larvae between different bodies of water nicolau del roure et al 2009 vouriot et al 2019 currents passing obstacles like islands and headlands in shallow water is much more complex due to irregular shape of geometry and unsteady velocity several simulations and experiments have been made to explore the mechanism of the formation of island wakes and vortex shedding but mechanistic description is still not sufficient up to date wolanski et al 1984 signell and geyer 1991 lloyd et al 2001 branson et al 2019a cenedese et al 2005 did a scaled experiment on mesoscale vortices interacting with two islands and investigated the interaction between a self propagating cyclonic vortex with two right vertical cylinders several dimensionless parameters have been suggested to describe the different types of wakes that could be generated around islands or headlands most of these parameters take into account the balance among local advection water depth and the dissipation owing to bottom friction e g the island wake parameter wolanski et al 1984 or the stability parameter chen and jirka 1995 branson et al 2019b explored the cylinder wakes in shallow oscillatory flow and characterized the wake using the stability parameter moving from laboratory scale to geophysical scale poses several challenges in fact wakes and macro vortices can be generated by the simultaneous effect of several factors wind circulation tidal circulation etc besides the complex geometry of coastlines is also a factor that may complicate this scenario the role of tidally or wind induced macrovortices in coastal waters on the local water quality still deserves attention in this paper a whole year simulation of 2017 was conducted considering tides winds and river discharge to investigate the estuarine circulation and flow pattern around the pearl river estuary pre and hong kong hk waters this simulation was based on the unstructured grid finite volume coastal ocean model fvcom chen et al 2003 and it has been validated the generation and distribution of macro vortices generated as island wakes or as tidally induced were characterized as well as the quantification of their main geometrical characteristics one of the goal of the present study was to suggest a classification of the coastal macro vortices generated by the tidal currents or by the wake past islands or headlands based on well known non dimensional numbers used in past studies in particular we employed the island wake parameter wolanski et al 1984 and the length scale ratio introduced by signell and geyer 1991 the suggested classification could possibly be used in any coastal area where the currents are mainly driven by tides and winds finally the general flow pattern and macro vortices dynamics around the pre hk were linked to the water quality parameters observed possible links between the pattern of several water quality indicators and the local dynamics was finally suggested 2 material and methods 2 1 study area in the present study we concentrate our attention to the area of the pre and more precisely to the hk waters the pearl river is the third longest river in china delivering 3 26 1 0 11 m 3 freshwater every year into the south china sea scs through eight outlets namely modaomen humen hongqimen jiaomen jitimen hengmen yamen and hutiaomen wu et al 2016 as shown in fig 1 a during summer season the river runoff can reach 20000 m 3 s while decreasing to 3600 m 3 s in winter season lai et al 2018 and nearly half of the river discharge passes through the pearl river estuary pre dong et al 2004 two longitudinal channels connect the pre with the coastal region of the scs the east channel passes through hong kong urmston road and the other one lying in the middle of the pre runs through the lantau channel fig 1 a majority of the pre is shallow with water depth ranging from 2 to 10 m apart from these two channels where the water depth changes from 5 to 15 m outside the pre water depth can be larger than 20 m hong kong hk is located in the downstream of the pre consisting of more than 200 islands such as the hong kong island the lantau island and the po tai island except for complicated bathymetry and the pearl river discharge tides and surface wind stresses are another two essential factors that govern the circulation around the pre hk tidal elevation ranges from 1 0 to 1 7 m near pre hk region where the semi diurnal tidal component m 2 dominates followed by k 1 o 1 and s 2 mao et al 2004 the tidal currents strongly impact on the stratification structures and vertical mixing in the pre especially when entering the shallow near shore region and narrow channels zu and gan 2015 pan et al 2020a monsoon winds cover the whole pre hk region with strong northeast wind in winter season and weaker southwest winds in summer 2 2 model setup fvcom was implemented with unstructured grid finite volume three dimensional 3d primitive equations chen et al 2003 it has been widely used for the study of coastal oceanic and estuarine circulation such as the chesapeake bay jiang and xia 2016 the okatee river huang et al 2008 pearl river estuary lai et al 2018 and changjiang river estuary chen et al 2008 our study area covered the whole pre and hk regions 113 e 115 e 21 n 23 n with an open boundary in the scs as shown in fig 1 a one area of interest aoi has been chosen in the domain for further analysis reported in 1 a with a red rectangle aoi1 which is our main focus included the southeast part of the pre and the entire hk district the horizontal triangular mesh contained 103690 cells and 55525 nodes displayed in fig 1 b the spatial resolution varied from 50 m to 12 km over the whole domain with 0 2 1 0 km inside the pre aoi2 50 500 m near hk region aoi1 12 km close to the open boundary in the vertical direction there were 10 uniform sigma layers the wet dry treatment was used in case that the nearshore area was periodically dry and inundation especially near the upstream coastal area pan et al 2020b the mode splitting solver was used in fvcom with 1 s for the external mode and 5 s for the internal mode the horizontal diffusion coefficients were calculated by the smagorinsky eddy parameterization method smagorinsky 1963 while the vertical eddy viscosity was calculated by k ω model menter 1993 the stable output of the spin up test served as the initial status and simulation started from 1 january to 31 december 2017 as mentioned above the pre hk experiences an energetic hydrodynamic conditions mainly affecting by periodical tides monsoon wind and river discharge tidal elevation was applied to the open boundary containing eight tidal components of m 2 k 2 k 1 o 1 s 2 n 2 p 1 and q 1 which were calculated by tpxo tide models egbert and erofeeva 2002 six hourly wind speed data u10 v10 and air pressure data were obtained from national oceanic and atmospheric administration physical sciences laboratory noaa psl https psl noaa gov and were applied to the surface layer of fvcom model in addition temperature and salinity which were also obtained from noaa psl were implemented to the whole domain at different water depth as the initial condition the spatial resolution of wind fields taken from the noaa ncep doe reanalysis ii is two degrees in both longitude and latitude 12 points were selected around the study area and then interpolated over the mesh nodes during the simulations the monthly averaged data of salinity and temperature were obtained from ncep godas ocean analysis with 0 333 degrees spaced in latitude and 1 0 degree spaced in longitude in addition salinity and temperature were distributed according to specific water depths in vertical direction monthly averaged pearl river discharge from eight outlets was gained from the ministry of water resources china http www mwr gov cn as well as water resources department of guangdong province http slt gd gov cn regarding the boundary conditions along the open boundaries of the domain we imposed the tidal elevation whereas for the bottom and free surface conditions on velocities salinity temperature and turbulent quantities k ω we used the default boundary conditions as in chen et al 2003 in the present study we performed a series of numerical experiments including excluding different forcing in table 1 we report the main conditions for each numerical run in particular the label tw refers to the most complete simulation that is performed with all forcing wind tides and atmospheric pressure runs labeled t and w refer to simulation where only tides or wind atmospheric pressure is included respectively 2 3 model validation the observed sea levels provided by the hong kong hydrographic office https www hydro gov hk eng index php were used to validate against model elevation output at four tide gauge stations from 1 december to 31 december 2017 as shown in fig si 1 of the supplementary information si the location of cheung chau station ma wan station kwai chung station ko lau wan were presented as a b c d respectively presented in fig 1 a four statistic parameters were used to further quantify the accuracy of this simulation against the observation root mean square error re and average error ae showed the differences between observation and simulation and reflect the accuracy of our model pan et al 2020a correlation coefficient cc pan et al 2020a and skill parameter skill warner et al 2005 were used to evaluate the consistency between observation and simulation perfect match occurs when cc and skill equal to 1 the skill parameter was calculated by 1 s k i l l 1 i 1 n x m o d e l x o b s 2 i 1 n x m o d e l x o b s x o b s x o b s 2 where x m o d e l and x o b s represent the simulated and observed sea level data respectively and the overbar represents the temporal average performance levels were categorized as follows 0 65 excellent 0 65 0 50 very good 0 5 0 2 good and 0 2 poor zhu et al 2021 table 2 shows the statistic analysis of tidal elevation results at four tidal gauge stations both root mean square errors and average errors of four stations were below 0 15 m referring to water depth of 15 20 m correlation coefficients exceeded 0 95 presenting strong consistency between simulated and observed sea level in addition skill parameters showed excellent performance even reaching a number of 0 98 which indicates an outstanding accuracy of the model output velocity comparison between simulation and observation was conducted to estimate the accuracy of velocity field of model output two simulations were operated to validate against observed cruise velocity data of transect d in may 2014 pan et al 2020a and velocity data in time series of four velocity gauge stations in august 2007 zhu et al 2021 by adjusting the bottom roughness lengthscale z 0 fig s2 shows the velocity comparison between modeled and observed results of transect d as shown in fig s2 a and b the majority of transact d showed negative value of u in both simulation and observation which indicated the current had velocity component towards west the maximum of the simulated u reaching 0 20 m s appeared on the east side around 113 77 e where the observed velocity also showed intense flow with a comparable magnitude in the along estuary north south direction northward velocity component dominated the bulk of transact d and the highest v occurred on the east side of transact d as displayed in both fig s2 c and d it can be concluded that the direction of the observed velocity was northwest and the intensest velocity appeared on the east side of the transact d which were accurately captured by our model output the comparison of simulated velocities against four stations ld2 ld3 pnd gs were displayed in fig si 3 and skill number were shown in table 3 these four stations are all inside the pre and close to the outlets of the pearl river the station gs is in the northernmost among them and located in the most convergent area flow velocities were divided into eastward u and northward v it can be seen from table 3 that the skill of all the v component in four stations exceeded 0 8 excellent performance and even reached 0 95 whereas the skill of u component exceeded 0 4 good performance except surface u of ld2 and pnd the station gs showed the exceptional performance with all skill numbers above 0 83 flow velocity is always more sensitive than the sea surface elevation when entering the local bathymetry especially shallow water estuary in our case tidal current from the scs propagated into the estuary and was forced by the local geometry resulting in strong along estuary flow it is worth noting that the simulated velocity in along estuary north south direction was much intenser and had better performance than that of cross estuary direction east west verifying against observation this indicates that tidal current could be accurately captured by our model the inconsistency between the observation and simulation could be caused by the grid resolution which may be not fine enough inside the pre 0 2 1 0 km another reason may due to the dredging and dumping process in recent decades which brought unpredictable differences between the bathymetry in reality and bed level in the model water depth can make huge differences to hydrodynamic processes such as the mass transport and tidal propagation particularly in shallow water region zhu et al 2021 in conclusion both tidal elevation and velocity of the fvcom output showed satisfying or even excellent performances against observed data which ensures the accuracy of our simulation based on the fvcom 3 results 3 1 general circulation patterns hong kong acts as a bridge between the pre and the scs generating interesting local flow patterns when islands interact with currents ekman current and tidal current meet at the mouth of the pre and knock against hundreds of islands around hk several studies have investigated the current pattern and the relative importance of the three main drivers namely tides winds and the influence of the river discharge wai et al 1996 2004 july and december in 2017 were selected as the representatives of the summer and winter monsoon period which experience southwest wind and stronger northeast wind respectively moreover these two months are characterized by intense monthly average river flow discharge wet season during july and a relative low discharge dry season during the winter fig 2 shows two examples of current patterns of the tw simulation in july corresponding to two snapshots during low and high spring tide panel c and d respectively the corresponding free surface elevation η t is reported in panels a and b the control point of η t is indicated by the blue circle two streams of high velocities were clearly visible in the velocity maps which corresponded to the lantau channel and urmston road two deep channels that characterize the pre with depth about 15 m compared to a mean depth of the lateral tidal flats of about 5 m the two high velocity streams entered into the hong kong waters surrounding the lantau island leading to strong tidal currents especially in the north lantau island low and high spring tides produced velocities with maximum magnitude in a range between 0 9 1 2 m s with ebb velocities largely exceeding flood velocities below latitudes around 22 n the pre entered the south china sea and the flow pattern assumed a different character in fact the circulations were mainly driven by atmospheric forcing leading in july to a circulation mostly pointing to north east following the summer monsoons see fig 2 and in winter to south west pushed by the winter monsoon not shown the relative importance of the tidal and wind forcing on the coastal circulations was even clearer when the monthly averages were analyzed fig 3 shows the modulus of monthly averaged velocities in aoi1 together with the normalized velocity vectors to show the current direction panels a and b report the results of the simulations with both tides and atmospheric forcing tw for december and july 2017 respectively intense velocity occurred in the southeast of aoi1 which was closer to the scs and without further blocking from island chains besides strong velocity appeared around headlands capes and in narrow channels such as channels around the northeast of lantau island and north of hong kong island lower velocity wakes were generated behind islands in the same direction of monsoon wind such as po toi island and wailingding island the area north to lantau island and hong kong island seems to be much less affected by the seasonal winds owing to the strongest influence of the tides to better understand the behavior of the tides we investigated the tidal propagation from the open boundary deep into the pre and around hong kong in the latter case tidal current interacting with hk islands can be interesting due to the complex coastlines and the bridge role between the pre and the scs the nonlinear effects such as cross section constraints and quadratic friction give rise to the development of overtides and compound tides when tidal current interacts with local bathymetry lu et al 2015 le provost 1991 the subordinate tidal components are formed at the cost of nonlinear transfer of energy and momentum of original components and increase as tides propagating into the pre or approaching the shallower waters around hong kong damping and amplification of the tidal range along the estuary is non negligible especially when considering such a strongly convergent estuary van rijn 2011 for the present study two groups of stations were selected to investigate tidal propagation for the entire 2017 starting from the open boundary and gradually entering into the pre group a and the urmston road near the lantau island group b as shown in fig 1 b as tides propagating landwards the tidal range invariably increases stations at the northernmost of group a inside the pre and group b near north lantau island had the largest tidal range reaching 2 83 m and 2 26 m respectively regarding the amplification of the tidal components we computed the non dimensional amplitude δ of the four dominant components namely m 2 k 1 o 1 and s 2 using the peak amplitude normalized with the local water depth outside the estuary and with the average water depth inside the pre moreover we defined δ η as the non dimensional tidal range the results are displayed in fig 4 showing the relationship between the non dimensional amplitude of the four constituents and the tidal range and distance in the upward direction northward for group b panel a and group a panel b for both the group stations we observed sensitive amplifications of the single constituent and for the overall tidal range in particular the harmonic m 2 had the largest amplification followed by k 1 o 1 and s 2 similar behavior was reported by mao et al 2004 in fact the dimensional amplitude increased more than 60 comparing stations from the open boundary with the northernmost stations of both group a and b interestingly the non dimensional amplitude δ increased 4 times for the stations of group b and about 15 times for the pre stations implying that tidal levels became increasingly important with respect to the local depth or mean depth inside the pre the observed amplification in the pre was caused by the convergent geometry the effect of which was much more significant than frictional dampening toffolon et al 2006 the non dimensional tidal range δ η is reported in the same panels a and b on a secondary vertical axis on the right of the graphs it can be noted that the tidal range reached values of about 0 4 inside the pre and about 0 12 in the north lantau island the analysis of the constituent amplitudes was also useful to understand the relative importance of the semi diurnal and diurnal components which can be expressed through the form factor f defined as f a k 1 a o 1 a m 2 a s 2 lee and chang 2019 the form factor can be used to discriminate the different types of astronomical tide from semi diurnal to mixed tides and fully diurnal tides in the present case f assumed values between 1 1 and 0 85 following the control stations inside the pre and between 1 4 and 1 1 along the lantau island path in all cases the tides can be classified as mixed and mainly diurnal finally to understand the harmonic contents of the signals of η t the fast fourier transform fft was used to estimate the power of simulated tidal levels at different frequencies the modeled surface elevation of each control station was analyzed by the above spectral method to discuss the energy transfer process among tidal constituents lu et al 2015 fig 4 panel c summarizes the most relevant tidal constituents for the two groups of stations in terms of non dimensional amplitudes δ grouping the harmonics in three main classes with periods around 22 28 h 12 h and 6 8 h which corresponded to the diurnal tides semidiurnal tides and shallow water overtides among all the diurnal components only one components named m m with period larger than all the applied eight components was generated during the propagation into the pre red column whereas o o 1 and j 1 had shorter periods than k 1 these may be caused by nonlinear tidal oscillations when tidal currents collided with the solid boundary around less convergent area besides several overtides components were generated amplitude with much smaller than m2 reflecting that the amplification of dominant components was more significant than the evolution of nonlinear effects in the estuary as expected we found that the seasonal behavior of the pre circulation of the present study was consistent with previous studies see zu and gan 2015 gan et al 2013 among others 3 2 identification of tidal and wake vortices among the various vortex identification methods we employed the q criterion that requires the computation of the second invariant of the velocity gradient tensor jeong and hussain 1995 that in a 3d divergence free flow reads 2 q 1 2 ω 2 s 2 where ω is the vorticity vector s is the strain and denotes the euclidean norm of a tensor then q criterion considers a connected region to be a vortex if the second invariant is positive i e q 0 regions where q 0 are dominated by the shear strain s note that in 2d flows this criterion can be considered identical to the use of the okubo weiss parameter okubo 1970 weiss 1991 i e λ 0 1 4 s 2 ω 2 where s 2 s n 2 s s 2 is the total square strain and ω 2 is the square vorticity the sign of λ 0 discriminates between locally hyperbolic flow regions λ 0 0 strain dominated and locally elliptical flow regions λ 0 0 rotation dominated the q criterion or its 2d counterpart have been often used not only for vortex identification but also to distinguish flow regions with dynamically different characteristics and their impact on water quality d ovidio et al 2009 in fig 5 we report the maps of the second invariant q the q maps appeared as a set of vorticity dominated q 0 red regions surrounded by strain dominated lobular structures q 0 blue embedded in a background field of small values of q regardless the tidal phase macro vortices were generated as the flow interacted with the domain features these coherent flow structures were periodically generated and then convected away in the direction of the local circulation the dynamics of these macro vortices strongly depended on the main mechanisms that triggered their formation in particular we identified two main class of macro vortices tidal generated and wind generated moreover these vortices can arise in the lee of islands or be generated by interaction with headlands the distinction between tidal and wind vortices has implication on the typical frequency of formation and on the lifetime of the single flow structure to enter into the details of these mechanisms we focus our attention of the three sub areas see colored rectangles in fig 5 around the north lantau island black rectangle the po toi island red rectangle and finally around an isolated island namely the wailingding island orange rectangle the most dynamically active area of the entire aoi1 occurred around the north lantau island where the urmston road made a 90 turn and currents collided with a small island in the middle of the channel and a sharp headland of the lantau island fig 6 shows four q maps together with the superficial velocity vectors during ebb tide panels a and b and flood tide panels c and d the intense flow along the urmston road coming from the pre found a convergent coastlines during ebb tide that substantially accelerated the flow leading to an intense generation of vorticity along the boundaries as a consequence macro vortices were generated in this area and transported for a quite short distance along the channel because the vortices were quickly dissipated and affected by the narrow geometry and the periodical change of tidal currents the driving mechanism for this area was clearly the tidal periodical flow and this implied that these flow structures were persistent during the entire year and they showed low seasonality but only related to the long period tidal variations in fact the same features were detected regardless the month of simulation it is also important to note how this area together with the victoria channel north hong kong island are also characterized by intense negative values of q revealing strain dominated regions the presence of so high strain together with periodic vortex generation is expected to have a strong impact on mass transport and water quality typical examples of vortex generation as island wakes is shown in fig 7 this particular location presented several interesting processes the island of po toi is not isolated but is close to two smaller islands one to the north beufort island less than 1 km apart and one to the north east sung kong island about 1 5 km distant along the northwest main direction of the summer monsoon this group of islands are close to two capes of the southern part of the hong kong island namely the bluff head to the west of po toi and cape d aguilar to northern po toi at the same longitude the first observation regarding the vortex generation in this area concerned the direction of the vortex streets that were aligned with the main direction of the wind regardless the tidal phase islands and headlands triggered the formation of leeward macro vortices that then were advected by the flow following the superficial circulation secondly we observed strong interactions among the vortical structures and the islands or headlands around them in fact sung kong island and cape d aguilar block or deviate the vortices formed windward similar processes have been investigated by cenedese et al 2005 cenedese et al 2005 where the interaction of a meso scale vortex with two islands has been investigated differently from the area around po toi island the third sub domain orange rectangle reported in fig 5 shows an example of isolated island wake around the wailingding island the latter is reasonably isolated from the surrounding coastal features islands or headlands and the main mechanism of vortex generation was again the wind circulation see fig 8 panels a c and e report three q maps clearly showing the generation and detachment of a couple of vortices leeward the island in the direction of the summer monsoon the q together with the velocity vector fields were taken 4 h apart the present results were in accordance to several previous studies on shallow water island wakes wolanski et al 1984 dietrich et al 1996 young and zawislak 2006 dong and mcwilliams 2007 we also used this isolated island to investigate the three dimensionality of the macro vortices to this end we extracted a vertical slice from the 3d domain and map onto it the values of q the position of the slice is shown in panels a c and e the slices have been placed cutting the core of the macro vortices and this is the reason why in each frame the orientation is slightly different the contours of q onto the vertical slice are shown in panels b d and f note that the vertical scale has been distorted to help the visualization the macro vortices seemed to be mainly 2d flow structures that occupied the entire flow depth the typical size of the macro vortices were around 500 1000 m in radius that compared to the mean flow depth of about 20 30 m yielded to a ratio between the vertical length scale flow depth and the horizontal length scale smaller than 0 1 this has been observed for all vortices identified regardless their generation mechanisms and their location the 2d nature of wake vortices has been already discussed in previous studies where detailed numerical simulations or experiments have been performed chen and jirka 1995 lloyd et al 2001 cenedese et al 2005 hasegawa et al 2009 to better appreciate the dynamical process of the vortex generation we have provided movies for the three areas described as supplementary material movie 1 2 and 3 4 discussion 4 1 spatial distribution of vortices in the previous section we have shown how in the different sub domains of the hong kong waters macro vortices were generated as a result from a combination of mechanisms related to tidal and wind circulation in the following we discuss in detail the geometrical characteristics of the macro vortices their distribution in the hong kong waters aoi1 their seasonality and stability this analysis is performed using 2d maps of the okubo weiss parameter instead of the 3d q maps taking advantage of the 2d nature of the macro vortices to assess the distribution of macro vortices we have computed monthly maps superimposing the trace of the vortices identified using the okubo weiss parameter λ 0 on a hourly basis for all months and for all three simulations namely tw t and w repeating this procedure for the three simulations further helps in understanding the local role of tides and winds examples of the computed monthly averaged maps for the months of december and july are shown in fig 9 for the run tw are shown in panels a and b the results of run t and run w of december and july are presented in fig si 4 c f the densest concentration of vortices appeared around the north lantau island and around the hong kong island where tidal currents were the intensest especially in ebb phase the fact that this area was substantially unaltered in the run t fig si 4 c and d further demonstrated that the major driver for macro vortices generation was the tidal currents it is worth noting that the behavior shown was typical for the entire year suggesting that macro vortices were persistent flow structure with no seasonality owing to their persistence their role in the mass and sediment transport is expected to be extremely relevant the monsoon wind was able to provoke vortices around the headlands and islands but with low intensity wind acting as a promoting role which helped transport the vortices and enlarge the area affected by vortices especially in the wind dominated area such as the wailingding island and the po tai islands strong wakes were discovered around the po toi islands under the summer monsoon wind whereas no clear wake was observed under the winter monsoon this difference may be caused by the interaction between tidal currents and wind induced currents the southwest wake in december was broken by the tidal currents in the front of the urmston road through which tides entered the pre and experienced huge convergence around on the other hand the northeast wake in july remained its shape which were protected by the mainland coastlines from tides breaking effect 4 2 geometrical features of vortices we are now interested to analyze the main geometrical features of the detected macro vortices considering each vortex as a single flow feature we could infer the position of the core of the vortex the radius of the area equivalent circle r e q and other geometrical characteristics of interest e g the eccentricity ε of the vortices defined as the ratio between the minor and major axes of the vortex which is a measure of the vortex symmetry ε 1 represents a perfectly circular vortex the computation have been performed on a monthly basis on aoi1 and four sub domains the monthly distribution of r e q and ε are used to produce probability density function pdf in order to summarize the main results fig 10 shows the results obtained during july with the simulation tw five areas have been considered a0 that coincided with the entire aoi1 and four sub domains from a1 to a4 for each area the pdfs of r e q and ε are shown around the geographical map panels a and b report for the same month the comparison between the pdfs for the equivalent radius and eccentricity for the largest area a0 computed based on the data from the simulations tw t and w separately regarding the distribution of the mean size i e the equivalent radius r e q all pdfs were positively skewed with a single strong peak regardless the sub region where they have been evaluated the peak was always found around values of about 500 600 m whereas the skewness of the distribution seemed to be more related to the area of computation in fact the pdfs of a1 and a4 were more skewed towards larger sizes where the vortices were more related to a wake generation mechanism on the contrary pdfs of r e q of region a2 and a3 were more concentrated around their peaks in these areas the vortices were generated mostly by the action of the tidal currents resulting in an average size of the vortices that was smaller compared to other sub domains areas a1 and a4 the pdfs of the entire area a0 are shown in blue in fig 10 and repeated in panel b together with the pdfs computed on the same area using the simulations t tides only and w wind only in all three cases the peaks of the distributions were very similar whereas their shapes were quite different wind forcing run w seemed to generate smaller vortices compared to the tidal circulation interestingly the simulation tw with both wind and tides resulted in a larger vortices compared to the other two cases moving to the analysis of the eccentricity fig 10 reports the pdfs for all areas and in panel a the comparison among the different simulations no statistical differences were detected in the pdfs of ε in the different areas and either for the different simulations the distributions obtained were all negatively skewed with the presence of more than one peak the most probable value was around 0 82 however other peaks were detected for smaller values i e ε 0 6 and ε 0 7 thus the vortices observed tended to be more elliptical than circular and this had consequence on their potential stability in fact it is known that in the case of 2d free turbulence elliptical vorticity patches are in general unstable due to the difference in rotation between the vortex core and the edges elliptical vortices are subjected to filamentation and ultimately they tend to become circular and this process is known as axisymmetrization tabeling 2002 in the present case the latter process is likely to be inhibited by the periodicity of the flow that does not allow for a fully development of this process causing the vortical structure to remain more elongated the statistical analysis for all months showed that the pdfs of r e q and ε do not change significantly in the supplementary information see fig s5 we show the results obtained during december 2017 and the difference with fig 10 panels a and b is not statistically significant the reason might be sought in the generation mechanism of the observed coastal macro vortices and the main role played by the typical length scale of the islands headlands that trigger the vortex generation it is worth noting that the analysis was based on a number of identified macro vortices of the order of 1 0 6 during the entire year 4 3 classification of wind wake and tidal vortices finally we are interested to understand the nature of the wakes and vortices generated by the action of the tidal and wind circulation to this end we rely of previous studies where island and headland wakes or in general bluff body wakes have been studied and featured by some non dimensional parameters regardless the specific non dimensional group the main variables that influence the establishment and the type of wakes are the characteristic amplitude of velocity oscillations u 0 the oscillation period t in the present case the tidal period of the principal constituent the bed shear stress τ 0 or the corresponding friction coefficient c f the typical flow depth h around the island headland the typical length scale of the island headland d among the several non dimensional parameters suggested in the literature we employed in the present study the island wake parameter p defined as p u 0 h 2 k z d wolanski et al 1984 where k z is the vertical eddy viscosity values of p 1 are associated to wakes in the form of vortex streets where the bottom friction has a weak effect on the contrary wakes assume the form of quasi potential flows for p 1 moreover signell and geyer 1991 suggested that wake behavior was well described by the comparison of two length scales namely the tidal excursion l t u 0 t 2 π and the fiction length scale l f h c f l f indicates the distance over which a vortex is dissipated by bottom frictional loss we have performed a detailed analysis of the kind of vortex wakes we observed in the aoi1 computing the two dimensionless groups for 71 sites island and coastal headlands we have divided the 71 sites between tidal vortices and wind wake vortices based on the monthly averaged circulation maps fig 3 and the vortex density maps fig 9 we selected the period of m 2 tide as typical time scale c f 0 003 as bottom friction coefficient and the depth averaged eddy viscosity k z was calculated from the output of fvcom and set in the range between 0 1 0 2 m 2 s the results of the main non dimensional parameters are shown as box plot in fig 11 the island parameter p in panel a the length scale ratio l t l f in panel b firstly the two classes of vortices were fairly well distinguished in the parameter spaces in the two parameters most of the sites showed an island parameter greater than 1 however sites controlled by tides tended to have higher values this was mainly due to the higher velocity observed in the domain where tidal currents were quite intense consistently tidal vortices were less sensitive to the action of the bottom friction demonstrated by values of the length scale ratio l t l f most often greater than one on the contrary almost all sites dominated by the wind resulted in more dissipative wakes with l t l f 1 higher values of p and length ratio observed for the tidal dominated vortices could imply a longer lived flow structures with an higher transport ability which could influence the water quality in terms of spatial distribution of the main indicators although the above classification has the limitation to not consider the time evolution of the process which especially in the case of tidal circulation may play an important role it could be extended to any coastal region where tides and winds are the main drivers of the local circulations the clear separation in the parameter space could also provide an estimate of the type of vortices that can be expected depending on the main generation mechanism 4 4 implication on the main water quality parameters in this final section we try to link the results obtained from the hydrodynamic analyses and the observation of the space and time distribution of coastal vortices with water quality wq parameters measured in the hong kong waters in particular the environmental protection department epd of the hong kong sar government monitors the water quality of the territory s marine waters on a monthly basis at 76 monitoring stations a range of physical and chemical parameters including temperature ph salinity turbidity and dissolved oxygen are measured in situ sampling the superficial the medium and bottom waters at each station in addition water and sediment samples are collected and sent to the laboratories for analysis of some 40 parameters such as nutrients metals organics and coliform bacteria the epd has been monitoring the water quality since the 1988 and the data are available from its official website cd epic epd gov hk epicriver marine for the present purposes we have downloaded from the epd database the measurements in 50 stations for the entire time series available however we focus our attention mostly on the 2017 measurements since we are interested to understand the spatial distribution of the wq parameters we transformed the point wise information into spatial maps using an inverse distance interpolation techniques then the data of the 2017 have been used to compute different averages such as annual averages retaining the different water compartments surface mid and bottom waters or averages along the water column fig 12 reports the annual mean of depth averaged distributions of dissolved oxygen do a suspended solids ss b chlorophyll a chl c we report in panel d a typical map of the distribution of the q parameter to help in the discussion the red squares indicate the position of the stations considered inspecting the spatial distribution of the wq parameters some typical features appear the wq measures suggest that the domain can be divided in different compartments with reasonably distinct values of do ss and chl in particular the area around the north lantau island and the hong kong island victoria channel show lower values of do ss and chl as we discussed this part of the hong kong waters are linked to the pre through urmston road one of the two deep channels in the pre waters entering from the channel generate the most intense circulation see fig 2 and they are characterized by a continuous emission of tidal vortices see fig 9 moreover the q parameter maps show the presence of intense straining regions blue areas in fig 12 with a persisting straining street connecting the lantau island with the lamma island and the po toi island high strain filaments can be associated to strong hyperbolic flow regions haller 2011 and ultimately causes a disconnection between waters masses this could be the reason related to the lower levels of do and chl observed on average in the north part of the domain finally we tried to find possible correlations between the typical vortex parameters discusses in section 4 3 and the measurements in different wq stations to this end we associate to a single station the vortex parameters estimated from the numerical simulations in a surrounding of the station location fig 13 shows the scatter plots of the concentration of chl and ss against the length scale ratio l t l f and the island parameter p together with the best fit using a power law in the vortex parameters the dependence of chl and ss on the ratio l t l f panels a and b shows a relatively high correlation whereas the same wq indicators seem to be less correlated inversely with the island parameter values of l t l f greater than unity describe vortices that tend to dissipate on longer distances thus producing a more effective transport and this could be the reason why chl and ss tend to be directly proportional to the ratio l t l f linking this conclusion with the classification of the vortices we suggested higher concentrations are expected to be found where the vortices are mainly generated and influenced by tides more than by wind 5 conclusions the fvcom numerical suite was implemented to build up a high resolution model around the pre hk area one year simulations of the 2017 varying the forcing conditions were performed in order to understand the role of the tides and seasonal winds typical of the study area the complex coastlines and the presence of numerous islands with different sizes were responsible for the generation of hundreds of coherent macro vortices that dominated the coastal hydrodynamics a detail analysis of the vortices generation spatial time distributions and typical shapes size and eccentricity has been performed we distinguished two major classes of macro vortices depending on their evolution tidal macro vortices were generated by the interaction of strong tidal currents with coastal features islands and headlands the second class of macro vortices can be classically described as wind wake vortices they were mostly observed in the sea basin dominated by the seasonal monsoons especially in the summer season several islands showed typical signature of persistent wakes characterized by a continuous vortex shedding clearly forming vortex streets this classification is sustained by a clear separation in the dimensional parameter space the proposed classification could be extended to any coastal areas where tides and winds are the main drivers of the circulation then provided which of the two drivers is dominant in the area and provided the typical length scale of islands headlands the main characteristics of the macro vortices could be inferred a possible link to the spatial distribution of dissolved oxygen chlorophyll and suspended solids have been discussed showing a reasonably clear disconnection between different water compartments caused by the persistence of high straining filaments that seemed to separated the north waters to the southern ones local values of chl and ss seemed to be correlated with the length scale ratio l t l f and the island parameter higher values are linked to longer lived vortices associated to tidal forcing vortices associated to higher values of the parameters tend to be more coherent and they might increase locally the mixing processes and finally they might be able to transport nutrients and fine sediments on longer distances a deeper analysis of the link between wq parameters and hydrodynamics characteristics of the vortical structures is necessary also planning water sampling with a higher time frequency to understand the variability over several tidal periods finally further research is needed to deeply investigate this apparent disconnection using a purely lagrangian framework computing the so called lagrangian coherent structures haller 2015 credit authorship contribution statement chang he investigation data curation writing original draft zhen yu yin writing review editing methodology resources alessandro stocchino conceptualization methodology data curation writing review editing onyx wing hong wai methodology writing review editing siqi li methodology writing review editing declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments this work is financially supported by the hong kong polytechnic university strategic importance fund ze2t and project of research institute of land and space cd78 and the research impact fund of the research grants council of hong kong rgc r5037 18 the finite volume coastal ocean model fvcom source code was obtained from the marine ecosystem dynamics modeling laboratory http fvcom smast umassd edu appendix a supplementary data supplementary material related to this article can be found online at https doi org 10 1016 j ocemod 2022 102034 appendix a supplementary data the following is the supplementary material related to this article video s1 video s2 video s3 mmc s1 
23836,large scale macro vortices could be formed in the lee or around natural obstacles such as islands and headlands during the interaction between geographical features and coastal circulations induced by tides and winds tidal and wind induced vortices play a fundamental role in transport processes of sediments and nutrients and the effects are then reflected on water quality of estuaries and coastal areas in the present study the coastal hydrodynamics of the pearl river estuary and hong kong waters was analyzed in detail using a high resolution model based on the finite volume coastal ocean model fvcom forced by tides and seasonal winds the results showed that the local dynamics was strongly affected by the continuous shedding of macro vortices a classification of these coherent structures was suggested based on their typical evolution to distinguish between tidal vortices and wake vortices using four non dimensional parameters the spatial distribution the seasonality and the probability density functions of their geometrical characteristics were presented and discussed in detail the results suggested that tidal currents played a dominant role in most of the pearl river estuary and the hong kong waters generating for the entire year a high and constant number of macro vortices that occupied most of the north channels of hong kong finally we linked the vortices distribution and their typical features with several important water quality parameters suggesting possible explanations of the observed trends keywords island wake vortex hong kong water quality pearl river estuary tidal circulation vortex dynamics fvcom 1 introduction great efforts have been made to investigate the interaction between oceanic currents and local geometry in estuarine areas where the non linear effects and quadratic friction cannot be neglected lu et al 2015 lai et al 2018 zu and gan 2015 pan et al 2020a wind and tidal forcing are always playing important roles in adjusting the estuarine circulation which has strong relationship with sediment transport zhu et al 2021 seawater quality and biochemical dynamics li et al 2020 yu and gan 2021 the wind stress stirs the ocean surface thus increases the vertical mixing in the water column kato and phillips 1969 besides monsoon wind can generate steady wind stress which together with the coriolis force produces a transport of seawater aligning with the direction of wind price et al 1987 tidal currents carrying huge energy from the deep ocean can make a great difference to the energy and momentum balance in coastal areas due to the tidal distortion and asymmetry in shallow water particularly local circulation can be far more complicated when tidal and wind induced currents interacting with massive nature obstacles where macro vortices could be generated and transported vortices have two main features the first of which is concentrated regions with high vorticity obstacles facing the current could modulate the direction and magnitude of velocity and form a lower velocity zone behind during this process the area around the obstacle exhibits high vorticity and generates vortices the famous tea cup effect brought up by wolanski and hamner wolanski and hamner 1988 illustrated that the unbalanced inward pressure gradient drove the near bottom fluid towards the rotation center and formed upwelling exactly like the tea leaves in the cup this is also the reason that the formation and transport of the vortices are important for sediment and contaminants transport hasegawa et al 2004 2009 coastal vortices can either aid or hinder the transport of nutrients or sediment and may control the distribution of passive larvae between different bodies of water nicolau del roure et al 2009 vouriot et al 2019 currents passing obstacles like islands and headlands in shallow water is much more complex due to irregular shape of geometry and unsteady velocity several simulations and experiments have been made to explore the mechanism of the formation of island wakes and vortex shedding but mechanistic description is still not sufficient up to date wolanski et al 1984 signell and geyer 1991 lloyd et al 2001 branson et al 2019a cenedese et al 2005 did a scaled experiment on mesoscale vortices interacting with two islands and investigated the interaction between a self propagating cyclonic vortex with two right vertical cylinders several dimensionless parameters have been suggested to describe the different types of wakes that could be generated around islands or headlands most of these parameters take into account the balance among local advection water depth and the dissipation owing to bottom friction e g the island wake parameter wolanski et al 1984 or the stability parameter chen and jirka 1995 branson et al 2019b explored the cylinder wakes in shallow oscillatory flow and characterized the wake using the stability parameter moving from laboratory scale to geophysical scale poses several challenges in fact wakes and macro vortices can be generated by the simultaneous effect of several factors wind circulation tidal circulation etc besides the complex geometry of coastlines is also a factor that may complicate this scenario the role of tidally or wind induced macrovortices in coastal waters on the local water quality still deserves attention in this paper a whole year simulation of 2017 was conducted considering tides winds and river discharge to investigate the estuarine circulation and flow pattern around the pearl river estuary pre and hong kong hk waters this simulation was based on the unstructured grid finite volume coastal ocean model fvcom chen et al 2003 and it has been validated the generation and distribution of macro vortices generated as island wakes or as tidally induced were characterized as well as the quantification of their main geometrical characteristics one of the goal of the present study was to suggest a classification of the coastal macro vortices generated by the tidal currents or by the wake past islands or headlands based on well known non dimensional numbers used in past studies in particular we employed the island wake parameter wolanski et al 1984 and the length scale ratio introduced by signell and geyer 1991 the suggested classification could possibly be used in any coastal area where the currents are mainly driven by tides and winds finally the general flow pattern and macro vortices dynamics around the pre hk were linked to the water quality parameters observed possible links between the pattern of several water quality indicators and the local dynamics was finally suggested 2 material and methods 2 1 study area in the present study we concentrate our attention to the area of the pre and more precisely to the hk waters the pearl river is the third longest river in china delivering 3 26 1 0 11 m 3 freshwater every year into the south china sea scs through eight outlets namely modaomen humen hongqimen jiaomen jitimen hengmen yamen and hutiaomen wu et al 2016 as shown in fig 1 a during summer season the river runoff can reach 20000 m 3 s while decreasing to 3600 m 3 s in winter season lai et al 2018 and nearly half of the river discharge passes through the pearl river estuary pre dong et al 2004 two longitudinal channels connect the pre with the coastal region of the scs the east channel passes through hong kong urmston road and the other one lying in the middle of the pre runs through the lantau channel fig 1 a majority of the pre is shallow with water depth ranging from 2 to 10 m apart from these two channels where the water depth changes from 5 to 15 m outside the pre water depth can be larger than 20 m hong kong hk is located in the downstream of the pre consisting of more than 200 islands such as the hong kong island the lantau island and the po tai island except for complicated bathymetry and the pearl river discharge tides and surface wind stresses are another two essential factors that govern the circulation around the pre hk tidal elevation ranges from 1 0 to 1 7 m near pre hk region where the semi diurnal tidal component m 2 dominates followed by k 1 o 1 and s 2 mao et al 2004 the tidal currents strongly impact on the stratification structures and vertical mixing in the pre especially when entering the shallow near shore region and narrow channels zu and gan 2015 pan et al 2020a monsoon winds cover the whole pre hk region with strong northeast wind in winter season and weaker southwest winds in summer 2 2 model setup fvcom was implemented with unstructured grid finite volume three dimensional 3d primitive equations chen et al 2003 it has been widely used for the study of coastal oceanic and estuarine circulation such as the chesapeake bay jiang and xia 2016 the okatee river huang et al 2008 pearl river estuary lai et al 2018 and changjiang river estuary chen et al 2008 our study area covered the whole pre and hk regions 113 e 115 e 21 n 23 n with an open boundary in the scs as shown in fig 1 a one area of interest aoi has been chosen in the domain for further analysis reported in 1 a with a red rectangle aoi1 which is our main focus included the southeast part of the pre and the entire hk district the horizontal triangular mesh contained 103690 cells and 55525 nodes displayed in fig 1 b the spatial resolution varied from 50 m to 12 km over the whole domain with 0 2 1 0 km inside the pre aoi2 50 500 m near hk region aoi1 12 km close to the open boundary in the vertical direction there were 10 uniform sigma layers the wet dry treatment was used in case that the nearshore area was periodically dry and inundation especially near the upstream coastal area pan et al 2020b the mode splitting solver was used in fvcom with 1 s for the external mode and 5 s for the internal mode the horizontal diffusion coefficients were calculated by the smagorinsky eddy parameterization method smagorinsky 1963 while the vertical eddy viscosity was calculated by k ω model menter 1993 the stable output of the spin up test served as the initial status and simulation started from 1 january to 31 december 2017 as mentioned above the pre hk experiences an energetic hydrodynamic conditions mainly affecting by periodical tides monsoon wind and river discharge tidal elevation was applied to the open boundary containing eight tidal components of m 2 k 2 k 1 o 1 s 2 n 2 p 1 and q 1 which were calculated by tpxo tide models egbert and erofeeva 2002 six hourly wind speed data u10 v10 and air pressure data were obtained from national oceanic and atmospheric administration physical sciences laboratory noaa psl https psl noaa gov and were applied to the surface layer of fvcom model in addition temperature and salinity which were also obtained from noaa psl were implemented to the whole domain at different water depth as the initial condition the spatial resolution of wind fields taken from the noaa ncep doe reanalysis ii is two degrees in both longitude and latitude 12 points were selected around the study area and then interpolated over the mesh nodes during the simulations the monthly averaged data of salinity and temperature were obtained from ncep godas ocean analysis with 0 333 degrees spaced in latitude and 1 0 degree spaced in longitude in addition salinity and temperature were distributed according to specific water depths in vertical direction monthly averaged pearl river discharge from eight outlets was gained from the ministry of water resources china http www mwr gov cn as well as water resources department of guangdong province http slt gd gov cn regarding the boundary conditions along the open boundaries of the domain we imposed the tidal elevation whereas for the bottom and free surface conditions on velocities salinity temperature and turbulent quantities k ω we used the default boundary conditions as in chen et al 2003 in the present study we performed a series of numerical experiments including excluding different forcing in table 1 we report the main conditions for each numerical run in particular the label tw refers to the most complete simulation that is performed with all forcing wind tides and atmospheric pressure runs labeled t and w refer to simulation where only tides or wind atmospheric pressure is included respectively 2 3 model validation the observed sea levels provided by the hong kong hydrographic office https www hydro gov hk eng index php were used to validate against model elevation output at four tide gauge stations from 1 december to 31 december 2017 as shown in fig si 1 of the supplementary information si the location of cheung chau station ma wan station kwai chung station ko lau wan were presented as a b c d respectively presented in fig 1 a four statistic parameters were used to further quantify the accuracy of this simulation against the observation root mean square error re and average error ae showed the differences between observation and simulation and reflect the accuracy of our model pan et al 2020a correlation coefficient cc pan et al 2020a and skill parameter skill warner et al 2005 were used to evaluate the consistency between observation and simulation perfect match occurs when cc and skill equal to 1 the skill parameter was calculated by 1 s k i l l 1 i 1 n x m o d e l x o b s 2 i 1 n x m o d e l x o b s x o b s x o b s 2 where x m o d e l and x o b s represent the simulated and observed sea level data respectively and the overbar represents the temporal average performance levels were categorized as follows 0 65 excellent 0 65 0 50 very good 0 5 0 2 good and 0 2 poor zhu et al 2021 table 2 shows the statistic analysis of tidal elevation results at four tidal gauge stations both root mean square errors and average errors of four stations were below 0 15 m referring to water depth of 15 20 m correlation coefficients exceeded 0 95 presenting strong consistency between simulated and observed sea level in addition skill parameters showed excellent performance even reaching a number of 0 98 which indicates an outstanding accuracy of the model output velocity comparison between simulation and observation was conducted to estimate the accuracy of velocity field of model output two simulations were operated to validate against observed cruise velocity data of transect d in may 2014 pan et al 2020a and velocity data in time series of four velocity gauge stations in august 2007 zhu et al 2021 by adjusting the bottom roughness lengthscale z 0 fig s2 shows the velocity comparison between modeled and observed results of transect d as shown in fig s2 a and b the majority of transact d showed negative value of u in both simulation and observation which indicated the current had velocity component towards west the maximum of the simulated u reaching 0 20 m s appeared on the east side around 113 77 e where the observed velocity also showed intense flow with a comparable magnitude in the along estuary north south direction northward velocity component dominated the bulk of transact d and the highest v occurred on the east side of transact d as displayed in both fig s2 c and d it can be concluded that the direction of the observed velocity was northwest and the intensest velocity appeared on the east side of the transact d which were accurately captured by our model output the comparison of simulated velocities against four stations ld2 ld3 pnd gs were displayed in fig si 3 and skill number were shown in table 3 these four stations are all inside the pre and close to the outlets of the pearl river the station gs is in the northernmost among them and located in the most convergent area flow velocities were divided into eastward u and northward v it can be seen from table 3 that the skill of all the v component in four stations exceeded 0 8 excellent performance and even reached 0 95 whereas the skill of u component exceeded 0 4 good performance except surface u of ld2 and pnd the station gs showed the exceptional performance with all skill numbers above 0 83 flow velocity is always more sensitive than the sea surface elevation when entering the local bathymetry especially shallow water estuary in our case tidal current from the scs propagated into the estuary and was forced by the local geometry resulting in strong along estuary flow it is worth noting that the simulated velocity in along estuary north south direction was much intenser and had better performance than that of cross estuary direction east west verifying against observation this indicates that tidal current could be accurately captured by our model the inconsistency between the observation and simulation could be caused by the grid resolution which may be not fine enough inside the pre 0 2 1 0 km another reason may due to the dredging and dumping process in recent decades which brought unpredictable differences between the bathymetry in reality and bed level in the model water depth can make huge differences to hydrodynamic processes such as the mass transport and tidal propagation particularly in shallow water region zhu et al 2021 in conclusion both tidal elevation and velocity of the fvcom output showed satisfying or even excellent performances against observed data which ensures the accuracy of our simulation based on the fvcom 3 results 3 1 general circulation patterns hong kong acts as a bridge between the pre and the scs generating interesting local flow patterns when islands interact with currents ekman current and tidal current meet at the mouth of the pre and knock against hundreds of islands around hk several studies have investigated the current pattern and the relative importance of the three main drivers namely tides winds and the influence of the river discharge wai et al 1996 2004 july and december in 2017 were selected as the representatives of the summer and winter monsoon period which experience southwest wind and stronger northeast wind respectively moreover these two months are characterized by intense monthly average river flow discharge wet season during july and a relative low discharge dry season during the winter fig 2 shows two examples of current patterns of the tw simulation in july corresponding to two snapshots during low and high spring tide panel c and d respectively the corresponding free surface elevation η t is reported in panels a and b the control point of η t is indicated by the blue circle two streams of high velocities were clearly visible in the velocity maps which corresponded to the lantau channel and urmston road two deep channels that characterize the pre with depth about 15 m compared to a mean depth of the lateral tidal flats of about 5 m the two high velocity streams entered into the hong kong waters surrounding the lantau island leading to strong tidal currents especially in the north lantau island low and high spring tides produced velocities with maximum magnitude in a range between 0 9 1 2 m s with ebb velocities largely exceeding flood velocities below latitudes around 22 n the pre entered the south china sea and the flow pattern assumed a different character in fact the circulations were mainly driven by atmospheric forcing leading in july to a circulation mostly pointing to north east following the summer monsoons see fig 2 and in winter to south west pushed by the winter monsoon not shown the relative importance of the tidal and wind forcing on the coastal circulations was even clearer when the monthly averages were analyzed fig 3 shows the modulus of monthly averaged velocities in aoi1 together with the normalized velocity vectors to show the current direction panels a and b report the results of the simulations with both tides and atmospheric forcing tw for december and july 2017 respectively intense velocity occurred in the southeast of aoi1 which was closer to the scs and without further blocking from island chains besides strong velocity appeared around headlands capes and in narrow channels such as channels around the northeast of lantau island and north of hong kong island lower velocity wakes were generated behind islands in the same direction of monsoon wind such as po toi island and wailingding island the area north to lantau island and hong kong island seems to be much less affected by the seasonal winds owing to the strongest influence of the tides to better understand the behavior of the tides we investigated the tidal propagation from the open boundary deep into the pre and around hong kong in the latter case tidal current interacting with hk islands can be interesting due to the complex coastlines and the bridge role between the pre and the scs the nonlinear effects such as cross section constraints and quadratic friction give rise to the development of overtides and compound tides when tidal current interacts with local bathymetry lu et al 2015 le provost 1991 the subordinate tidal components are formed at the cost of nonlinear transfer of energy and momentum of original components and increase as tides propagating into the pre or approaching the shallower waters around hong kong damping and amplification of the tidal range along the estuary is non negligible especially when considering such a strongly convergent estuary van rijn 2011 for the present study two groups of stations were selected to investigate tidal propagation for the entire 2017 starting from the open boundary and gradually entering into the pre group a and the urmston road near the lantau island group b as shown in fig 1 b as tides propagating landwards the tidal range invariably increases stations at the northernmost of group a inside the pre and group b near north lantau island had the largest tidal range reaching 2 83 m and 2 26 m respectively regarding the amplification of the tidal components we computed the non dimensional amplitude δ of the four dominant components namely m 2 k 1 o 1 and s 2 using the peak amplitude normalized with the local water depth outside the estuary and with the average water depth inside the pre moreover we defined δ η as the non dimensional tidal range the results are displayed in fig 4 showing the relationship between the non dimensional amplitude of the four constituents and the tidal range and distance in the upward direction northward for group b panel a and group a panel b for both the group stations we observed sensitive amplifications of the single constituent and for the overall tidal range in particular the harmonic m 2 had the largest amplification followed by k 1 o 1 and s 2 similar behavior was reported by mao et al 2004 in fact the dimensional amplitude increased more than 60 comparing stations from the open boundary with the northernmost stations of both group a and b interestingly the non dimensional amplitude δ increased 4 times for the stations of group b and about 15 times for the pre stations implying that tidal levels became increasingly important with respect to the local depth or mean depth inside the pre the observed amplification in the pre was caused by the convergent geometry the effect of which was much more significant than frictional dampening toffolon et al 2006 the non dimensional tidal range δ η is reported in the same panels a and b on a secondary vertical axis on the right of the graphs it can be noted that the tidal range reached values of about 0 4 inside the pre and about 0 12 in the north lantau island the analysis of the constituent amplitudes was also useful to understand the relative importance of the semi diurnal and diurnal components which can be expressed through the form factor f defined as f a k 1 a o 1 a m 2 a s 2 lee and chang 2019 the form factor can be used to discriminate the different types of astronomical tide from semi diurnal to mixed tides and fully diurnal tides in the present case f assumed values between 1 1 and 0 85 following the control stations inside the pre and between 1 4 and 1 1 along the lantau island path in all cases the tides can be classified as mixed and mainly diurnal finally to understand the harmonic contents of the signals of η t the fast fourier transform fft was used to estimate the power of simulated tidal levels at different frequencies the modeled surface elevation of each control station was analyzed by the above spectral method to discuss the energy transfer process among tidal constituents lu et al 2015 fig 4 panel c summarizes the most relevant tidal constituents for the two groups of stations in terms of non dimensional amplitudes δ grouping the harmonics in three main classes with periods around 22 28 h 12 h and 6 8 h which corresponded to the diurnal tides semidiurnal tides and shallow water overtides among all the diurnal components only one components named m m with period larger than all the applied eight components was generated during the propagation into the pre red column whereas o o 1 and j 1 had shorter periods than k 1 these may be caused by nonlinear tidal oscillations when tidal currents collided with the solid boundary around less convergent area besides several overtides components were generated amplitude with much smaller than m2 reflecting that the amplification of dominant components was more significant than the evolution of nonlinear effects in the estuary as expected we found that the seasonal behavior of the pre circulation of the present study was consistent with previous studies see zu and gan 2015 gan et al 2013 among others 3 2 identification of tidal and wake vortices among the various vortex identification methods we employed the q criterion that requires the computation of the second invariant of the velocity gradient tensor jeong and hussain 1995 that in a 3d divergence free flow reads 2 q 1 2 ω 2 s 2 where ω is the vorticity vector s is the strain and denotes the euclidean norm of a tensor then q criterion considers a connected region to be a vortex if the second invariant is positive i e q 0 regions where q 0 are dominated by the shear strain s note that in 2d flows this criterion can be considered identical to the use of the okubo weiss parameter okubo 1970 weiss 1991 i e λ 0 1 4 s 2 ω 2 where s 2 s n 2 s s 2 is the total square strain and ω 2 is the square vorticity the sign of λ 0 discriminates between locally hyperbolic flow regions λ 0 0 strain dominated and locally elliptical flow regions λ 0 0 rotation dominated the q criterion or its 2d counterpart have been often used not only for vortex identification but also to distinguish flow regions with dynamically different characteristics and their impact on water quality d ovidio et al 2009 in fig 5 we report the maps of the second invariant q the q maps appeared as a set of vorticity dominated q 0 red regions surrounded by strain dominated lobular structures q 0 blue embedded in a background field of small values of q regardless the tidal phase macro vortices were generated as the flow interacted with the domain features these coherent flow structures were periodically generated and then convected away in the direction of the local circulation the dynamics of these macro vortices strongly depended on the main mechanisms that triggered their formation in particular we identified two main class of macro vortices tidal generated and wind generated moreover these vortices can arise in the lee of islands or be generated by interaction with headlands the distinction between tidal and wind vortices has implication on the typical frequency of formation and on the lifetime of the single flow structure to enter into the details of these mechanisms we focus our attention of the three sub areas see colored rectangles in fig 5 around the north lantau island black rectangle the po toi island red rectangle and finally around an isolated island namely the wailingding island orange rectangle the most dynamically active area of the entire aoi1 occurred around the north lantau island where the urmston road made a 90 turn and currents collided with a small island in the middle of the channel and a sharp headland of the lantau island fig 6 shows four q maps together with the superficial velocity vectors during ebb tide panels a and b and flood tide panels c and d the intense flow along the urmston road coming from the pre found a convergent coastlines during ebb tide that substantially accelerated the flow leading to an intense generation of vorticity along the boundaries as a consequence macro vortices were generated in this area and transported for a quite short distance along the channel because the vortices were quickly dissipated and affected by the narrow geometry and the periodical change of tidal currents the driving mechanism for this area was clearly the tidal periodical flow and this implied that these flow structures were persistent during the entire year and they showed low seasonality but only related to the long period tidal variations in fact the same features were detected regardless the month of simulation it is also important to note how this area together with the victoria channel north hong kong island are also characterized by intense negative values of q revealing strain dominated regions the presence of so high strain together with periodic vortex generation is expected to have a strong impact on mass transport and water quality typical examples of vortex generation as island wakes is shown in fig 7 this particular location presented several interesting processes the island of po toi is not isolated but is close to two smaller islands one to the north beufort island less than 1 km apart and one to the north east sung kong island about 1 5 km distant along the northwest main direction of the summer monsoon this group of islands are close to two capes of the southern part of the hong kong island namely the bluff head to the west of po toi and cape d aguilar to northern po toi at the same longitude the first observation regarding the vortex generation in this area concerned the direction of the vortex streets that were aligned with the main direction of the wind regardless the tidal phase islands and headlands triggered the formation of leeward macro vortices that then were advected by the flow following the superficial circulation secondly we observed strong interactions among the vortical structures and the islands or headlands around them in fact sung kong island and cape d aguilar block or deviate the vortices formed windward similar processes have been investigated by cenedese et al 2005 cenedese et al 2005 where the interaction of a meso scale vortex with two islands has been investigated differently from the area around po toi island the third sub domain orange rectangle reported in fig 5 shows an example of isolated island wake around the wailingding island the latter is reasonably isolated from the surrounding coastal features islands or headlands and the main mechanism of vortex generation was again the wind circulation see fig 8 panels a c and e report three q maps clearly showing the generation and detachment of a couple of vortices leeward the island in the direction of the summer monsoon the q together with the velocity vector fields were taken 4 h apart the present results were in accordance to several previous studies on shallow water island wakes wolanski et al 1984 dietrich et al 1996 young and zawislak 2006 dong and mcwilliams 2007 we also used this isolated island to investigate the three dimensionality of the macro vortices to this end we extracted a vertical slice from the 3d domain and map onto it the values of q the position of the slice is shown in panels a c and e the slices have been placed cutting the core of the macro vortices and this is the reason why in each frame the orientation is slightly different the contours of q onto the vertical slice are shown in panels b d and f note that the vertical scale has been distorted to help the visualization the macro vortices seemed to be mainly 2d flow structures that occupied the entire flow depth the typical size of the macro vortices were around 500 1000 m in radius that compared to the mean flow depth of about 20 30 m yielded to a ratio between the vertical length scale flow depth and the horizontal length scale smaller than 0 1 this has been observed for all vortices identified regardless their generation mechanisms and their location the 2d nature of wake vortices has been already discussed in previous studies where detailed numerical simulations or experiments have been performed chen and jirka 1995 lloyd et al 2001 cenedese et al 2005 hasegawa et al 2009 to better appreciate the dynamical process of the vortex generation we have provided movies for the three areas described as supplementary material movie 1 2 and 3 4 discussion 4 1 spatial distribution of vortices in the previous section we have shown how in the different sub domains of the hong kong waters macro vortices were generated as a result from a combination of mechanisms related to tidal and wind circulation in the following we discuss in detail the geometrical characteristics of the macro vortices their distribution in the hong kong waters aoi1 their seasonality and stability this analysis is performed using 2d maps of the okubo weiss parameter instead of the 3d q maps taking advantage of the 2d nature of the macro vortices to assess the distribution of macro vortices we have computed monthly maps superimposing the trace of the vortices identified using the okubo weiss parameter λ 0 on a hourly basis for all months and for all three simulations namely tw t and w repeating this procedure for the three simulations further helps in understanding the local role of tides and winds examples of the computed monthly averaged maps for the months of december and july are shown in fig 9 for the run tw are shown in panels a and b the results of run t and run w of december and july are presented in fig si 4 c f the densest concentration of vortices appeared around the north lantau island and around the hong kong island where tidal currents were the intensest especially in ebb phase the fact that this area was substantially unaltered in the run t fig si 4 c and d further demonstrated that the major driver for macro vortices generation was the tidal currents it is worth noting that the behavior shown was typical for the entire year suggesting that macro vortices were persistent flow structure with no seasonality owing to their persistence their role in the mass and sediment transport is expected to be extremely relevant the monsoon wind was able to provoke vortices around the headlands and islands but with low intensity wind acting as a promoting role which helped transport the vortices and enlarge the area affected by vortices especially in the wind dominated area such as the wailingding island and the po tai islands strong wakes were discovered around the po toi islands under the summer monsoon wind whereas no clear wake was observed under the winter monsoon this difference may be caused by the interaction between tidal currents and wind induced currents the southwest wake in december was broken by the tidal currents in the front of the urmston road through which tides entered the pre and experienced huge convergence around on the other hand the northeast wake in july remained its shape which were protected by the mainland coastlines from tides breaking effect 4 2 geometrical features of vortices we are now interested to analyze the main geometrical features of the detected macro vortices considering each vortex as a single flow feature we could infer the position of the core of the vortex the radius of the area equivalent circle r e q and other geometrical characteristics of interest e g the eccentricity ε of the vortices defined as the ratio between the minor and major axes of the vortex which is a measure of the vortex symmetry ε 1 represents a perfectly circular vortex the computation have been performed on a monthly basis on aoi1 and four sub domains the monthly distribution of r e q and ε are used to produce probability density function pdf in order to summarize the main results fig 10 shows the results obtained during july with the simulation tw five areas have been considered a0 that coincided with the entire aoi1 and four sub domains from a1 to a4 for each area the pdfs of r e q and ε are shown around the geographical map panels a and b report for the same month the comparison between the pdfs for the equivalent radius and eccentricity for the largest area a0 computed based on the data from the simulations tw t and w separately regarding the distribution of the mean size i e the equivalent radius r e q all pdfs were positively skewed with a single strong peak regardless the sub region where they have been evaluated the peak was always found around values of about 500 600 m whereas the skewness of the distribution seemed to be more related to the area of computation in fact the pdfs of a1 and a4 were more skewed towards larger sizes where the vortices were more related to a wake generation mechanism on the contrary pdfs of r e q of region a2 and a3 were more concentrated around their peaks in these areas the vortices were generated mostly by the action of the tidal currents resulting in an average size of the vortices that was smaller compared to other sub domains areas a1 and a4 the pdfs of the entire area a0 are shown in blue in fig 10 and repeated in panel b together with the pdfs computed on the same area using the simulations t tides only and w wind only in all three cases the peaks of the distributions were very similar whereas their shapes were quite different wind forcing run w seemed to generate smaller vortices compared to the tidal circulation interestingly the simulation tw with both wind and tides resulted in a larger vortices compared to the other two cases moving to the analysis of the eccentricity fig 10 reports the pdfs for all areas and in panel a the comparison among the different simulations no statistical differences were detected in the pdfs of ε in the different areas and either for the different simulations the distributions obtained were all negatively skewed with the presence of more than one peak the most probable value was around 0 82 however other peaks were detected for smaller values i e ε 0 6 and ε 0 7 thus the vortices observed tended to be more elliptical than circular and this had consequence on their potential stability in fact it is known that in the case of 2d free turbulence elliptical vorticity patches are in general unstable due to the difference in rotation between the vortex core and the edges elliptical vortices are subjected to filamentation and ultimately they tend to become circular and this process is known as axisymmetrization tabeling 2002 in the present case the latter process is likely to be inhibited by the periodicity of the flow that does not allow for a fully development of this process causing the vortical structure to remain more elongated the statistical analysis for all months showed that the pdfs of r e q and ε do not change significantly in the supplementary information see fig s5 we show the results obtained during december 2017 and the difference with fig 10 panels a and b is not statistically significant the reason might be sought in the generation mechanism of the observed coastal macro vortices and the main role played by the typical length scale of the islands headlands that trigger the vortex generation it is worth noting that the analysis was based on a number of identified macro vortices of the order of 1 0 6 during the entire year 4 3 classification of wind wake and tidal vortices finally we are interested to understand the nature of the wakes and vortices generated by the action of the tidal and wind circulation to this end we rely of previous studies where island and headland wakes or in general bluff body wakes have been studied and featured by some non dimensional parameters regardless the specific non dimensional group the main variables that influence the establishment and the type of wakes are the characteristic amplitude of velocity oscillations u 0 the oscillation period t in the present case the tidal period of the principal constituent the bed shear stress τ 0 or the corresponding friction coefficient c f the typical flow depth h around the island headland the typical length scale of the island headland d among the several non dimensional parameters suggested in the literature we employed in the present study the island wake parameter p defined as p u 0 h 2 k z d wolanski et al 1984 where k z is the vertical eddy viscosity values of p 1 are associated to wakes in the form of vortex streets where the bottom friction has a weak effect on the contrary wakes assume the form of quasi potential flows for p 1 moreover signell and geyer 1991 suggested that wake behavior was well described by the comparison of two length scales namely the tidal excursion l t u 0 t 2 π and the fiction length scale l f h c f l f indicates the distance over which a vortex is dissipated by bottom frictional loss we have performed a detailed analysis of the kind of vortex wakes we observed in the aoi1 computing the two dimensionless groups for 71 sites island and coastal headlands we have divided the 71 sites between tidal vortices and wind wake vortices based on the monthly averaged circulation maps fig 3 and the vortex density maps fig 9 we selected the period of m 2 tide as typical time scale c f 0 003 as bottom friction coefficient and the depth averaged eddy viscosity k z was calculated from the output of fvcom and set in the range between 0 1 0 2 m 2 s the results of the main non dimensional parameters are shown as box plot in fig 11 the island parameter p in panel a the length scale ratio l t l f in panel b firstly the two classes of vortices were fairly well distinguished in the parameter spaces in the two parameters most of the sites showed an island parameter greater than 1 however sites controlled by tides tended to have higher values this was mainly due to the higher velocity observed in the domain where tidal currents were quite intense consistently tidal vortices were less sensitive to the action of the bottom friction demonstrated by values of the length scale ratio l t l f most often greater than one on the contrary almost all sites dominated by the wind resulted in more dissipative wakes with l t l f 1 higher values of p and length ratio observed for the tidal dominated vortices could imply a longer lived flow structures with an higher transport ability which could influence the water quality in terms of spatial distribution of the main indicators although the above classification has the limitation to not consider the time evolution of the process which especially in the case of tidal circulation may play an important role it could be extended to any coastal region where tides and winds are the main drivers of the local circulations the clear separation in the parameter space could also provide an estimate of the type of vortices that can be expected depending on the main generation mechanism 4 4 implication on the main water quality parameters in this final section we try to link the results obtained from the hydrodynamic analyses and the observation of the space and time distribution of coastal vortices with water quality wq parameters measured in the hong kong waters in particular the environmental protection department epd of the hong kong sar government monitors the water quality of the territory s marine waters on a monthly basis at 76 monitoring stations a range of physical and chemical parameters including temperature ph salinity turbidity and dissolved oxygen are measured in situ sampling the superficial the medium and bottom waters at each station in addition water and sediment samples are collected and sent to the laboratories for analysis of some 40 parameters such as nutrients metals organics and coliform bacteria the epd has been monitoring the water quality since the 1988 and the data are available from its official website cd epic epd gov hk epicriver marine for the present purposes we have downloaded from the epd database the measurements in 50 stations for the entire time series available however we focus our attention mostly on the 2017 measurements since we are interested to understand the spatial distribution of the wq parameters we transformed the point wise information into spatial maps using an inverse distance interpolation techniques then the data of the 2017 have been used to compute different averages such as annual averages retaining the different water compartments surface mid and bottom waters or averages along the water column fig 12 reports the annual mean of depth averaged distributions of dissolved oxygen do a suspended solids ss b chlorophyll a chl c we report in panel d a typical map of the distribution of the q parameter to help in the discussion the red squares indicate the position of the stations considered inspecting the spatial distribution of the wq parameters some typical features appear the wq measures suggest that the domain can be divided in different compartments with reasonably distinct values of do ss and chl in particular the area around the north lantau island and the hong kong island victoria channel show lower values of do ss and chl as we discussed this part of the hong kong waters are linked to the pre through urmston road one of the two deep channels in the pre waters entering from the channel generate the most intense circulation see fig 2 and they are characterized by a continuous emission of tidal vortices see fig 9 moreover the q parameter maps show the presence of intense straining regions blue areas in fig 12 with a persisting straining street connecting the lantau island with the lamma island and the po toi island high strain filaments can be associated to strong hyperbolic flow regions haller 2011 and ultimately causes a disconnection between waters masses this could be the reason related to the lower levels of do and chl observed on average in the north part of the domain finally we tried to find possible correlations between the typical vortex parameters discusses in section 4 3 and the measurements in different wq stations to this end we associate to a single station the vortex parameters estimated from the numerical simulations in a surrounding of the station location fig 13 shows the scatter plots of the concentration of chl and ss against the length scale ratio l t l f and the island parameter p together with the best fit using a power law in the vortex parameters the dependence of chl and ss on the ratio l t l f panels a and b shows a relatively high correlation whereas the same wq indicators seem to be less correlated inversely with the island parameter values of l t l f greater than unity describe vortices that tend to dissipate on longer distances thus producing a more effective transport and this could be the reason why chl and ss tend to be directly proportional to the ratio l t l f linking this conclusion with the classification of the vortices we suggested higher concentrations are expected to be found where the vortices are mainly generated and influenced by tides more than by wind 5 conclusions the fvcom numerical suite was implemented to build up a high resolution model around the pre hk area one year simulations of the 2017 varying the forcing conditions were performed in order to understand the role of the tides and seasonal winds typical of the study area the complex coastlines and the presence of numerous islands with different sizes were responsible for the generation of hundreds of coherent macro vortices that dominated the coastal hydrodynamics a detail analysis of the vortices generation spatial time distributions and typical shapes size and eccentricity has been performed we distinguished two major classes of macro vortices depending on their evolution tidal macro vortices were generated by the interaction of strong tidal currents with coastal features islands and headlands the second class of macro vortices can be classically described as wind wake vortices they were mostly observed in the sea basin dominated by the seasonal monsoons especially in the summer season several islands showed typical signature of persistent wakes characterized by a continuous vortex shedding clearly forming vortex streets this classification is sustained by a clear separation in the dimensional parameter space the proposed classification could be extended to any coastal areas where tides and winds are the main drivers of the circulation then provided which of the two drivers is dominant in the area and provided the typical length scale of islands headlands the main characteristics of the macro vortices could be inferred a possible link to the spatial distribution of dissolved oxygen chlorophyll and suspended solids have been discussed showing a reasonably clear disconnection between different water compartments caused by the persistence of high straining filaments that seemed to separated the north waters to the southern ones local values of chl and ss seemed to be correlated with the length scale ratio l t l f and the island parameter higher values are linked to longer lived vortices associated to tidal forcing vortices associated to higher values of the parameters tend to be more coherent and they might increase locally the mixing processes and finally they might be able to transport nutrients and fine sediments on longer distances a deeper analysis of the link between wq parameters and hydrodynamics characteristics of the vortical structures is necessary also planning water sampling with a higher time frequency to understand the variability over several tidal periods finally further research is needed to deeply investigate this apparent disconnection using a purely lagrangian framework computing the so called lagrangian coherent structures haller 2015 credit authorship contribution statement chang he investigation data curation writing original draft zhen yu yin writing review editing methodology resources alessandro stocchino conceptualization methodology data curation writing review editing onyx wing hong wai methodology writing review editing siqi li methodology writing review editing declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments this work is financially supported by the hong kong polytechnic university strategic importance fund ze2t and project of research institute of land and space cd78 and the research impact fund of the research grants council of hong kong rgc r5037 18 the finite volume coastal ocean model fvcom source code was obtained from the marine ecosystem dynamics modeling laboratory http fvcom smast umassd edu appendix a supplementary data supplementary material related to this article can be found online at https doi org 10 1016 j ocemod 2022 102034 appendix a supplementary data the following is the supplementary material related to this article video s1 video s2 video s3 mmc s1 
23837,two types of generalized vertical coordinates are introduced to reduce model errors in calculating the baroclinic pressure gradient bpg advection term and horizontal mixing in tracer equations in a three dimensional 3d ocean circulation model these two types of vertical coordinates are defined as the generalized terrain following coordinate gtc and generalized piecewise terrain following coordinate gptc the main feature of the gtc is the use of a series of constant depth levels in the water column above the sea bottom the gptc differs from the gtc in which the depth differences between two adjacent grids are reduced especially in the bottom layer over steep topography performances of these two vertical coordinate systems are assessed first in two types of idealized numerical experiments with a tall seamount and continuously varying bottom slope respectively the model results in the tall seamount experiment demonstrate that both the gtc and gptc perform well in reducing the model errors in the bpg over the steep topography and greatly alleviate the spurious diapycnal mixing in terrain following coordinate models in the continuously varying bottom slope experiment both the gtc and gptc perform better than the z level coordinate in simulating the 3d currents the performances of the gtc and gptc are further assessed by examining prognostic simulations of 3d currents and hydrography in the yellow and east china seas with realistic external forcing and bottom topography the model results in the third experiment demonstrate that the gptc restrains the overestimated upward climbing of the bottom cold water in comparison with other coordinates the gptc also performs better than the gtc and the conventional sigma layer coordinate in simulating the shoreward intrusion of relatively high salinity subsurface waters intermediate low salinity waters and the yellow sea bottom cold waters by comparison the gtc simulates the kuroshio the slope counter current and their seasonal variability significantly better than other coordinates keywords generalized vertical coordinate ocean circulation model terrain following reduction of spurious diapycnal mixing baroclinic pressure gradient advection 1 introduction numerical ocean circulation models have increasingly been used to study three dimensional 3d circulation wang et al 2014 xia et al 2006 and the effects of physical environmental conditions on marine creatures in the ocean béguer pon et al 2016 xue et al 2008 in order to have reliable simulations of three dimensional 3d circulation and hydrography a 3d circulation model should have enough vertical resolutions resolve bottom topography and retain the water characteristics in the lower layer in the deep ocean for a long time model integration the choice of vertical coordinate systems in a 3d ocean circulation model has been one of major concerns in the ocean modeling community there are three general types of vertical coordinate systems widely used in the ocean general circulation models including the constant geopotential z level terrain following sigma level or σ level and layered typically isopycnal layers vertical coordinates among these three types the z level coordinate zlc is the simplest and has been used in the modular ocean model pacanowski et al 1993 and nucleus for european modelling of the ocean madec 2008 one of main drawbacks of the zlc however is that the bathymetry in the z level model is represented by a series of steps which have problems in resolving barotropic and baroclinic coastal trapped waves gerdes 1993 the step like interfaces also make it difficult to properly resolve the bottom boundary layers pietrzak et al 2002 the sigma level coordinate uses sigma surfaces which follow the ocean bottom in the model this allows for model variables such as currents temperature and salinity to be resolved smoothly in the bottom boundary layers the princeton ocean model pom blumberg and mellor 1987 semi spectral ocean model som haidvogel et al 1991 and regional ocean modeling system roms shchepetkin and mcwilliams 2005 employ the sigma vertical coordinates the main drawback of the conventional sigma coordinate csc is that large numerical errors occur in calculating the baroclinic pressure gradient bpg in the model especially in regions with steep topography and large density gradients gary 1973 haney 1991 mellor et al 1994 ocean circulation models using the zlc or the csc suffer from model errors of spurious diapycnal diffusion associated with inconsistent vertical coordinate iso surfaces and local isopycnal directions griffies et al 2000 lee et al 2002 marchesiello et al 2009 lee et al 2002 demonstrated that the z coordinate circulation models have the spurious diapycnal diffusion if the diffusive horizontal advection schemes are used marchesiello et al 2009 proposed a new advection scheme named as rsup3 to alleviate the considerably spurious diapycnal mixing in a terrain following coordinate model berntsen and oey 2010 demonstrated that errors in the internal pressure gradient in csc models can be reduced using a simple 4 th order accurate scheme lemarié et al 2012 developed a method of stabilizing corrections msc for the time integration of the rotated harmonic and biharmonic operators to retain the stability and accuracy of general circulation models legg et al 2006 suggested that the use of the isopycnal vertical coordinate in the ocean circulation model can control this error in fact the isopycnal surface is a natural vertical coordinate system for studying ocean dynamics and has successfully been used in the hybrid coordinate ocean model halliwell et al 1998 and miami university isopycnal coordinate ocean model bleck and boudra 1981 for simulating large scale circulations and sharp fronts the layers of predefined constant density can be used in the vertically well stratified condition but collapse into one layer in the well mixed coastal waters several methods were developed in the past to improve the performances of vertical coordinates in ocean circulation models increasing both the horizontal and vertical resolutions ezer and mellor 2004 is the simplest but computationally less efficient for improving the model performance a widely used approach in z level models is to allow bottom most grid cells to be partial cells pacanowski and gnanadesikan 1998 which adjusts the thickness of the bottom grids artificially to better resolve the bathymetry beckmann and döscher 1997 proposed a hybrid approach by coupling a simple terrain following bottom boundary layer model to the zlc model to improve the representation of dense water spreading over topography becker et al 2000 suggested the use of a rotated diffusion operator for the accurate calculation of isopycnal diffusion in the zlc model the horizontal pressure gradient is calculated based on the reconstruction of the density field and z levels as continuously differentiable polynomial functions of transformed coordinates with subsequent analytical integration shchepetkin and mcwilliams 2003 2008 2009 in ocean circulation models to achieve a higher order of accuracy the internal pressure gradient errors can also be substantially reduced by using the simple fourth order method berntsen and oey 2010 or the optimal σ method berntsen 2011 the general vertical coordinates gvcs suggested previously are the combination of the zlc and csc bruciaferri et al 2018 burchard and petersen 1997 gerdes 1993 pietrzak et al 2002 zhuang et al 2018 most of previous gvcs belong to a hybridization between z level and sigma level coordinates using different methods pietrzak et al 2002 developed a generalized sigma level coordinate which refines the grid towards the sea surface with a series of constant depth levels in the upper water column zhuang et al 2018 suggested a gvc method by dividing the water column into three parts vertically and using the sigma coordinate in the near surface and near bottom layers and the z level coordinate in the intermediate layer bruciaferri et al 2018 suggested a multi envelope generalized coordinate system which adjusts the computational levels according to multiple virtual bottoms rather than following geopotential levels or the actual bathymetry although the gvcs developed previously pietrzak et al 2002 bruciaferri et al 2018 are useful in reducing numerical errors in the bpg large numerical errors can still exist in the bottom layer especially over the steep topography the main objective of this study is to present and validate two types of new gvcs which use the constant depth levels in the water columns above the sea bottom to reduce the model errors in calculating the bpg and diapycnal mixing including advection terms and horizontal diffusivity in the temperature and salinity equations the bpg and advection terms in this study are calculated using the conventional centered difference scheme with the second order of accuracy the performances of these two new gvcs are assessed by examining model results in different vertical coordinates in three types of numerical experiments the first two types of experiments are the idealized model setup and forcing used in previous studies with an idealized tall seamount and continuously varying slope respectively the third type is a realistic numerical experiment with a model domain covering the yellow and east china seas yecs and adjacent deep waters of the northwestern pacific ocean this paper is structured as follows section 2 introduces two new gvcs section 3 presents performance assessments of the newly developed vertical coordinates in three types of numerical experiments summary and conclusions are given in section 4 2 the generalized piecewise terrain following vertical coordinates the terrain following sigma or σ coordinate has widely been used in ocean circulation models to simulate 3d circulation and hydrography over coastal and shelf waters and in the deep ocean with the complicated bathymetry the sigma coordinate σ can be expressed as 1 σ z η h η z η d where η is the sea surface elevation h is the static water depth and d h η is the total water depth at the sea surface z η σ 0 at the sea bottom z h σ 1 eq 1 can also be written as 2 z η σ d as shown in the appendix the conventional sigma coordinate csc has a constant σ value on each vertical layer the csc suffers from the problem of large numerical errors in calculating the bpg haney 1991 mellor et al 1994 under the hydrostatic approximation the equations for the bpg in a cartesian coordinate system x y z with the z axis to be upward and z 0 at the mean sea surface can be written as auclair et al 2000 3 b x g ρ 0 z η ρ x d z b y g ρ 0 z η ρ y d z where ρ is the density of sea water g is gravity acceleration and ρ 0 is the reference density to a constant or a function of the vertical coordinate only in the csc the horizontal density gradients are calculated by 4 ρ x z ρ x σ ρ σ σ x ρ y z ρ y σ ρ σ σ y substituting eq 4 into eq 3 the equations of bpg in the csc are 5 b x g d ρ 0 σ 0 ρ x ρ σ σ x d σ g d ρ 0 σ 0 ρ x σ d d x η x ρ σ d σ b y g d ρ 0 σ 0 ρ y ρ σ σ y d σ g d ρ 0 σ 0 ρ y σ d d y η y ρ σ d σ the expression shown in eq 5 is a special form of eq a 12 in appendix both ρ x σ and ρ σ σ x are large numerically in the region with a steep slope and strong stratification the sum of these two large terms should be equal to a small term of ρ x z mathematically however numerical errors in calculating these two large terms can lead to considerable numerical errors in the horizontal density gradients therefore small numerical errors in temperature and salinity can lead to significant errors in the bpg over the region with steep topography and stratification in a csc model the generalized terrain following coordinate gtc was suggested to reduce the slopes of sigma levels over steep topography in the general coordinate system of the pom pomgcs mellor et al 2002 the main feature of the gtc is to have nonconstant σ values on a given vertical level fig 1a presents the schematic view of the gtc used in the pomgcs in which a series of z levels are used in the water column above the sea bottom positions of z levels are labeled as z 0 1 λ z where λ z is the maximum number of z layers the actual number of z levels used in some grids may be smaller than λ z the lowermost z level λ p 1 λ p λ z is determined by the restriction of z 0 λ p 0 9 h x y z 0 λ p 1 the selected z levels are set in the upper water columns and the values of z 0 1 λ p are transformed to the sigma coordinate by 6 σ σ b x y k z 0 k 1 η 0 x y h x y η 0 x y 2 k λ p 1 where η 0 x y η x y 0 is the surface elevation at the initial time some nonconstant depth layers are set in the lower water column in order to satisfy σ b x y k b 1 where k b is the total number of vertical levels the surface level should satisfy σ b x y k 1 0 the numerical ocean circulation model with the gtc presented above however was found to be computationally unstable since too many nonconstant depth layers in the lower water columns over the shallow water region as a result an improved gtc is first introduced in this study which combines the csc and the z level coordinate fig 1b this hybrid coordinate system is constructed in three steps firstly a csc σ a k defined in the appendix is applied to the whole model domain secondly the series of z layers z 0 are transformed to σ 1 x y k based on eq 6 thirdly the gtc is determined based on 7 σ σ b x y k max σ a k σ 1 x y k 2 k λ p 1 and σ b x y k σ a k is set at the sea surface and sea bottom as shown in fig 1b the improved gtc based on eq 7 connects smoothly the csc and zlc without too many layers in the lower water columns over the shallow water region the problem of large bpg errors in the terrain following ocean circulation model has long been recognized auclair et al 2000 mellor et al 1998 robertson et al 2001 another general type of model errors namely spurious diapycnal diffusion was also recognized griffies et al 2000 diagnosed the effective diapycnal diffusivity corresponding to any numerical transport process in a z level coordinate model using the equivalent sorted fluid state their results showed that the horizontal diffusivity is mainly responsible for the spurious diapycnal mixing marchesiello et al 2009 analyzed the spurious diapycnal mixing in the sigma coordinate models and showed that the spurious mixing decreases with resolution is generally false similar problems of using large terms to calculate small term also occur in calculating advection term in the tracer equations which result in serious spurious diapycnal mixing a new and effective method using the gvcs to reduce the spurious diapycnal mixing is presented in this study for simplicity of presentation we consider the tracer equation for temperature t in a cartesian coordinate system with the z level vertical coordinate 8 t t u t x 8 a v t y 8 b w t z f h f v r z where u v and w are components of the velocity vector in the x y and z directions respectively f h and f v represent horizontal and vertical eddy mixing terms respectively and r represents the solar radiation the temperature equation in the csc can be expressed as 9 t t u t x 9 a v t y 9 b ω σ d t σ f h f v r d σ 10 ω σ w u σ d x η x v σ d y η y σ d t η t it should be noted that terms 8 a and b in eq 8 are usually small terms in the z level coordinate in comparison with terms 9 a and b in the csc particularly over steep topography with high vertical stratification the vertical temperature or salinity gradients are large in the thermocline terms 9 a and b are significantly amplified if the sigma surfaces cross the isotherms mathematically terms 9 a and u σ d d x t σ are very large and should almost cancel out each other numerically however any numerical errors of these two large terms should result in considerable errors to their sum the same errors also occur in term 9 b and v σ d d y t σ the numerical errors discussed above also occur in numerical models with the temperature and salinity equations in the flux format as shown in eqs a 12 and 5 the bpg is determined by the vertical integration of horizontal density gradients in the gtc the bpg is determined jointly by the zlc and csc the z levels can work well in reducing the bpg errors although there are still negative effects caused by the csc levels as shown in eqs a 10 and 9 the temperature advection terms do not involve directly the vertical integration the calculations of temperature advection terms on one level are mainly affected by the adjacent variables the gtc has steep csc levels near the bottom over steep topography where the problem of using large terms to calculate small terms for the temperature advection terms is not resolved therefore the generalized piecewise terrain following coordinate gptc is suggested to address this problem the gptc uses the gtc layers in the shallow waters and piecewise terrain following layers in the deep waters fig 2 the demarcation depth h c of the shallow and deep waters equals to z 0 k u 1 where k u is the number of total vertical layers in the shallow waters in the shallow waters including the upper water columns of deep waters the gtc is first set according to eqs 6 and 7 except that h x y is replaced by the virtual bottom of min h c h x y then the sigma values in the gtc is transformed to the gptc system 11 σ σ c x y k σ b x y k min h c h x y η 0 x y h x y η 0 x y 1 k k u the series of z levels z 0 k u k d 1 is firstly set in the lower water columns of deep waters k d is determined by z 0 k d 1 h x y z 0 k d secondly some extra levels are supplemented between the lowermost z level and the sea bottom therefore the gptc in the lower water columns of deep waters can be expressed as 12 σ σ c x y k z 0 k 1 η 0 x y h x y η 0 x y k u k k d σ c x y k 1 1 σ c x y k d k n k d k k d k n where k n is the total number of the supplemented layers near the sea bottom the value of k n is determined according to h x y z 0 k d 1 the gptc has σ values of 0 at the sea surface and 1 at the sea bottom but the number of total vertical layers is variable at each grid which differs from the roms generalized coordinate system shchepetkin and mcwilliams 2005 the shallow waters have less vertical layers than the deep waters in summary both the gtc and gptc satisfy σ 0 at the sea surface and σ 1 at the sea bottom which are same as the csc however both the gtc and gptc allow to have nonconstant sigma values on a particular vertical layer in the interior of the model domain the gtc and csc divide the water columns into identical number of vertical layers while the gptc has various numbers of vertical layers in shallow and deep waters 3 performance assessments of the generalized vertical coordinates the performances of the gtc and gptc are assessed in two types of idealized numerical experiments and one realistic experiment with the model domain covering the yecs and adjacent waters the tall seamount and continuously varying bottom slope topography were used in these idealized experiments respectively the 3d currents and hydrography over the yecs and adjacent waters were simulated with realistic external forcing and bottom topography in the third experiment the numerical circulation model in all three experiments is based on pomgcs mellor et al 2002 using the default second order accurate numerical scheme the model results from these three experiments are compared to the counterparts using the csc and zlc 3 1 a tall seamount topography the tall seamount experiments were used in the past for examining model errors in the bpg in a numerical ocean circulation model appendix using different vertical coordinates over the steep topography with strong vertical stratification mellor et al 1994 song and haidvogel 1994 a gaussian seamount is placed in the central area of a rectangular basin with four closed lateral boundaries 13 h x y h 0 1 0 δ h exp x 2 y 2 r 2 where h 0 4500 m δ h 0 9 m and r 25 km in eq 13 x and y are eastward and northward coordinates respectively with the origin of the coordinate defined at the center of the rectangular basin the dimension of the rectangular basin is approximately 400 km long and 300 km wide which are more than ten times larger than the radius of the seamount the model domain is divided into 69 51 grid cells horizontally the grid resolution is refined near the center of the domain with the horizontal resolution varying from 4 8 km over the seamount to 8 0 km at the model boundaries fig 3 the vertical stratification is specified by setting an exponential varying temperature c in the form of 14 t 5 0 20 0 exp z 1000 where z is the upward vertical coordinate with z 0 at the mean sea surface in units of m the salinity is set to be 35 psu and invariant in time and space over the whole model domain the initial condition of the model is a state of no motion other parameters used in the experiment are listed in table 1 in the idealized numerical experiments the kinetic energy and maximum velocity at each time step on the c grid are computed based on 15 e k i n 1 2 v o i j k δ v i j k u u i j k 2 δ v i j k v v i j k 2 for the kinetic energy and 16 v m a x m a x u i j k v i j k for the maximum velocity in the equation above 17 v o i j k δ v i j k d is the total volume of the model domain and δ v i j k d δ v i j k u δ v i j k v represent respectively the control volumes for the density u and v points in the above expressions i j k are indices for the grid points in the eastward northward and upward directions 3 1 1 diagnostic run the ocean circulation model in the seamount experiment is run firstly in diagnostic mode for 100 days to assess the performance of the gtc and gptc in reducing the bpg errors the horizontal viscosity and horizontal diffusivity coefficients a m a h in the experiment are set equal to 100 m2 s 1 and zero and the vertical viscosity and diffusivity coefficients μ m μ h are set to 2 0 10 4 m2 s 1 since no external forcing is used to drive the circulation model with the temperature and salinity fields specified in this experiment the true solution of circulation in this case is zero currents everywhere at any given time four model runs are conducted using the csc zlc gtc and gptc respectively with the same model setup as described above the constant depths z 0 in the gtc and gptc are set to z 0 2 4 6 8 10 15 22 30 39 50 64 81 100 120 140 160 180 200 222 248 278 312 352 400 456 522 600 692 802 934 1092 1278 1498 1762 2078 2450 2890 3418 4000 4500 m the gptc is constructed with h c 200 m k u 19 k n 2 and the maximum number of total vertical layers is set to 41 a finer vertical resolution is set in the surface layer in the model runs using the csc by using a parabolic distribution of vertical levels the maximum velocity v m a x and spatially averaged kinetic energy e k i n in three runs csc gtc and gptc are shown in fig 4 as mentioned above the true solution in this test case is zero currents everywhere at any time and non zero values of v m a x and e k i n are indications of model errors in each run fig 4 demonstrates that the model errors are sensitive to the choice of vertical coordinates in run csc the values of v m a x increase from zero to a large value of 0 53 m s 1 within a few days after the model initialization and then oscillate with time around this large value and the values of e k i n increase from zero to about 4 0 10 4 m2 s 2 within 60 days and then oscillate with time around this large value after 60 days of the model integration the growth trend of v m a x in run gtc is similar to the trend in run csc before getting the steady state 0 53 m s 1 however the e k i n in run gtc is about 6 times smaller than in run csc the v m a x in run gptc is only about 15 of the counterpart in run csc and the e k i n value in run gptc is almost negligible in comparison with the value in run csc which indicates the gptc has the smallest model errors among these three runs in terms of v m a x and e k i n fig 5 presents distributions of bpgs and vertical currents along the east west transect at y 0 and distributions of horizontal currents at 1000 m at model day 100 after the model initialization in three different model runs using the csc gtc and gptc the model results using the zlc are the same as the true solution of zero currents everywhere as a result the model results in run zlc are not considered here fig 5a demonstrates that large bpg errors occur around the steep slope in run csc with the maximum value of about 4 32 10 5 n kg 1 table 2 model results in run csc also has large errors in the vertical and horizontal currents with the maximum errors of about 3 48 10 2 m s 1 fig 5b and 0 55 m s 1 fig 5c respectively by comparison model results in run gtc fig 5d f have smaller errors in bpg vertical and horizontal currents the maximum errors in run gtc are about 4 04 10 5 n kg 1 3 03 10 2 m s 1 and 0 54 m s 1 respectively the model errors in run gptc fig 5g i are about one order of magnitude smaller than the errors in run csc the maximum errors in run gptc are about 0 45 10 5 n kg 1 6 30 10 3 m s 1 and 0 09 m s 1 for the bpg vertical and horizontal currents respectively as shown in right panels of fig 5 the model errors in horizontal currents differ significantly in three different runs csc gtc and gptc to further quantify the model errors in three different runs we compute the area averaged amplitudes of horizontal currents at 1000 m over the area marked by the red circle shown in right panels of fig 5 the radius of the circle is 50 km with both the centers of the circle and seamount to be collocated since the true solution in this seamount experiment is zero currents everywhere the area averaged amplitudes of horizontal currents can also be used to represent the area averaged model errors in horizontal currents the area averaged errors are about 11 15 10 2 4 00 10 2 and 0 95 10 2 m s 1 in runs csc gtc and gptc respectively this indicates that both the gtc and gptc perform better than the csc in reducing the model errors over the steep topography in the seamount experiment 3 1 2 prognostic run the circulation model in the seamount experiment is also run in prognostic mode to examine the sensitivity of spurious diapycnal mixing to the choice of different vertical coordinates four basic prognostic runs are conducted using four different vertical coordinates i e zlc csc gtc and gptc these four prognostic runs have the same model configuration of the diagnostic calculation including the advection term horizontal mixing and vertical mixing except that the model temperature is updated with the model currents and the horizontal diffusivity coefficient is set to 20 m2 s 1 furthermore twelve additional process oriented experiments are conducted to examine major physical processes that contributes to the spurious diapycnal mixing the circulation model in each of these twelve additional experiments is integrated for 300 days with the only inclusion of the advection term horizontal mixing and vertical mixing respectively by using one of the zlc csc gtc and gptc fig 6 presents the time evolution of v m a x and e k i n calculated from model results in the four basic prognostic seamount experiments the values of v m a x in run zlc are very small within 140 days after the model integration and increase with time with a large value of about 0 2 m s 1 around 260 days as stated in mellor et al 1998 and davidson et al 1998 the true solution in the prognostic seamount case or a large lake with horizontal homogeneous but vertically stratified waters and non zero horizontal and vertical mixing has non zero currents after the long model integration the values of v m a x in run csc rise to a large value of about 0 40 m s 1 within 5 days and then oscillate with time after 10 days of the model integration fig 6a the values of v m a x in run gtc also rise to a large value of about 0 30 m s 1 within 5 days and then reach a constant value of 0 28 m s 1 after 10 days of the model integration the values of v m a x in run gptc reach a constant value of 0 07 m s 1 after 5 days of the model integration the values of e k i n in run csc increase to a large value of about 2 20 10 3 m2 s 2 at model day 150 0 and then decrease with temporal oscillations fig 6b the values of e k i n in run gtc slowly increase with time within 230 days of the model integration after reaching a maximum value of 3 75 10 4 m2 s 2 at about day 240 the values of e k i n in run gtc gradually decrease with time and reach a value similar to the counterparts in run zlc at day 300 by comparison the values of e k i n in run gptc reach a very small and constant value of about 2 75 10 5 m2 s 2 within 150 days of the model integration fig 6b fig 7 presents vertical distributions of density differences between the initial density and the model density at model day 300 0 along the east west transect through the center of the seamount in the prognostic seamount experiments using four different vertical coordinates the zlc csc gtc and gptc respectively the spurious diapycnal mixing in model results is sensitive to the choice of vertical coordinates the model errors in run csc are significantly more severe than the errors in run zlc since the vertical stratification of the initial density field determined from the model temperature is horizontally uniform there is almost no diapycnal mixing in run zlc with the horizontal mixing alone fig 7c small differences induced mainly by the numerical errors occur around the tall seamount in run zlc with the advection term alone fig 7b a comparison of fig 7f and g demonstrates that in run csc the diapycnal mixing introduced by the horizontal mixing is much larger than the advection term especially around the steep slope the maximum value of density differences in the subsurface layer is greatly reduced from 0 38 kg m 3 in run csc to 0 26 and 0 08 kg m 3 in runs gtc and gptc respectively fig 7i and m the gvcs introduced in this study alleviate the model errors associated with the horizontal mixing and advection terms to small values fig 7j k n and o 3 2 a continuously varying slope the continuously varying slope experiment was also used previously for examining the effects of different vertical coordinates on ocean circulations especially in the bottom boundary layer mizuta and hogg 2004 using the cartesian coordinate system with its origin defined at the sea surface at the southwestern corner of the modal domain fig 8 the continuously varying slope is specified as 18 h x h 0 α x x x 1 h 0 α x 1 l t sinh x x 1 l t x x 1 where h 0 4000 m α 8 0 1 0 4 x 1 480 km and l t 150 km eq 18 indicates that the bottom slope is linear for x x 1 and hyperbolic sinusoid for x x 1 fig 8 the dimension of the model domain is 960 km in the x direction by 240 km in the y direction the model domain is uniformly divided into 120 30 grid cells in the horizontal dimension the northern and southern boundaries are closed and the eastern and western boundaries are open a constant inflow of 48 sv sv 106 m3 s 1 is specified at the western open boundary and an outflow of the same amount in sv is specified at the eastern open boundary the vertical distributions of the salinity and temperature are the same as in the idealized seamount experiment discussed in section 3 1 four model runs are conducted using the ocean circulation model with the four different vertical coordinates zlc csc gtc and gptc respectively the configurations of the gtc and gptc are the same as in the seamount experiment discussed in section 3 1 other model parameters used in this experiment are listed in table 1 the circulation model in each run is integrated for 150 days from a state of rest analytically the currents increase gradually from the western side to the eastern side and flow along the northern closed boundary fig 9 presents the time evolution of the v m a x and e k i n calculated from model results in four runs the values of v m a x in the four runs increase quickly to large values about 1 1 m s 1 at about 20 days and then relax to smaller values about 0 9 m s 1 after 30 days of the model integration the values of v m a x in the four runs have some temporal oscillations after 20 model days with the largest oscillations in run zlc the maximum value of e k i n in run zlc is about 1 5 10 2 m2 s 2 which is slightly larger than in the other three model runs the time evolutions of v m a x and e k i n are highly similar in the three model runs using the csc gtc and gptc fig 10 shows distributions of vertical currents along channel currents and cross channel currents at the east west transect of y 216 km at model day 150 after the model initialization in four different runs zlc csc gtc and gptc in run zlc strong bottom intensified currents occur fig 10a c especially over the steep slope which are in a general agreement with the analytical solution mizuta and hogg 2004 the main problem using the z level coordinate run zlc fig 10a is highly fluctuated vertical currents associated with the step wise grids particularly over the region of x 800 km the maximum vertical current is about 1 01 10 2 m s 1 at x 920 km the model results in run zlc differ significantly however from the analytical solution of which the currents should flow smoothly along the continuously varying slope and climb upward the cross channel currents in run zlc also have large fluctuations near the bottom grids due to large model errors with the maximum northward current of about 0 33 m s 1 in examining the model problem of simulating the gulf stream separation using different types of vertical grids ezer 2016 also found that step like topography in the zlc model has problems in resolving properly bottom boundary layer and topographic waves the 3d currents produced by the circulation model in run csc fig 10d f are in good agreement with the analytical solution mizuta and hogg 2004 with the maximum vertical current is about 3 6 10 3 m s 1 at the steepest position of the slope the along channel and cross channel velocities in run csc are vertically uniform this indicates that the conventional sigma coordinate defined in eq 1 is an ideal coordinate for simulating 3d currents in the continuously varying slope experiment fig 10g i demonstrates that the 3d currents produced by the circulation model in run gtc are highly similar to the currents in run csc except for some weak fluctuated currents at the connection points of constant depth levels and sigma levels by comparison the vertical currents in run gptc fig 10j have relatively larger fluctuations than the counterparts in run gtc but the model results in run gptc are better than the results in run zlc the maximum vertical current is about 3 5 10 3 m s 1 in both runs gtc and gptc which is smaller than the counterpart in run zlc to further assess the performance of different vertical coordinates in simulating circulation in the bottom boundary layer we calculate the vertical currents at the bottom at the steepest point based on the slip boundary condition defined as 19 w u h x the maximum along channel current u is about 0 4 m s 1 and the bottom slope is h x 0 96 at the bottom at the eastern open boundary of the model domain the estimated vertical current at this point can be calculated according to eq 19 which is about 3 84 10 3 m s 1 runs csc gtc and gptc produce the largest vertical currents in the bottom layer with the maximum vertical current of 3 6 10 3 m s 1 at the steepest point fig 10d g and j which is in a good agreement with the estimated maximum value of the true solution with the model error of 0 24 10 3 m s 1 by comparison the model error in the maximum vertical currents using the z level coordinate run zlc is almost one order of magnitude larger than the errors in runs gtc and gptc 3 3 yellow and east china seas the 3d circulation model with four different vertical coordinates zlc csc gtc and gptc is also applied to the yellow and east china seas yecs and adjacent waters fig 11 including the bohai sea bhs yellow sea ys east china sea ecs and part of the northwestern pacific ocean nwpo the average water depths are about 18 m 44 m and 349 m respectively for the bhs ys and ecs the steep continental slope over the outer ecs links the continental shelf with the deep okinawa trough of which the maximum water depth is greater than 2000 m the yangtze river is the largest river in china which has the annual mean discharge of about 3 01 1 0 4 m 3 s 1 with significant seasonal and synoptic variability chang and isobe 2003 the yangtze river is the 5th largest river in the world based on the annual mean discharges the large freshwater discharge from the yangtze river affects significantly the 3d circulation and hydrography in the ecs and ys chang and isobe 2003 kako et al 2016 the general circulation and hydrography in the ecs and ys were studied in the past based on observations yu et al 2006 lie and cho 2016 and numerical results hirose et al 1999 wang et al 2014 yu et al 2006 previous studies demonstrated that the ys basin is occupied by cold waters lower than 10 c below the strong thermocline in summer xia et al 2006 which is known as the yellow sea bottom cold water ysbcw strong upwelling and temperature fronts can occur around the ysbcw lu et al 2010 kuroshio is an intense western boundary current which enters the ecs through the east taiwan channel and flows into the nwpo through the tokara strait yang et al 2011 the kuroshio significantly influences the water and heat exchanges of the ecs li et al 2013 therefore it is important for a regional ocean model to reproduce the main characteristics of the kuroshio and the circulation and hydrography over the cs 3 3 1 circulation model setup and observations the 3d ocean circulation model appendix is applied to the ys ecs and adjacent waters with a horizontal resolution of 1 12 1 12 the model domain covers the region of 117 e 135 e and 19 n 41 n the smagorinsky 1962 horizontal mixing scheme with a coefficient of 0 1 is used for the horizontal viscosity and diffusivity coefficients a m and a h the modified my 2 5 turbulence closure scheme galperin et al 1988 mellor and yamada 1982 is used for the vertical viscosity and diffusivity coefficients k m and k h the circulation model is driven by a suite of external forcing including the atmospheric forcing tides freshwater discharge and lateral open boundary conditions the atmospheric forcing includes the 6 hourly wind fields taken from the dataset produced by the japan meteorological agency jma using the global spectral model gsm the bulk formula of kondo 1975 is used to convert the wind speed to wind stress the net heat flux at the sea surface is calculated in the circulation model using the shortwave radiation long wave radiation sensible and latent heat fluxes all these components are calculated using the empirical formulas of hirose et al 1999 the bulk coefficients for sensible and latent heat fluxes are the values modified by hirose et al 1999 the meteorological conditions used to compute the surface heat fluxes based on the bulk method in the circulation model were obtained from the daily mean gsm dataset okamoto et al 2008 the net freshwater flux at the sea surface is calculated based on precipitation and evaporation the precipitation data were also obtained from the daily mean gsm dataset the amount of the freshwater discharge of the yangtze river is specified based on the monthly mean data published in the chinese river sediment bulletin no relaxations are used for the sea surface temperature sst and sea surface salinity sss tidal forces are specified at model open boundaries using the radiation conditions for the depth averaged currents and tidal elevations davies and flather 1987 four major tidal constituents m2 s2 k1 o1 are used in this study the non tidal components of the open boundary conditions are taken from the monthly mean reanalysis of the 1 2 1 2 sea surface height currents temperature and salinity produced by using a 3d circulation model using a simple ocean data assimilation carton et al 2018 four model runs were conducted using four different vertical coordinates csc zlc gtc and gptc the parameters in constructing the gtc and gptc are the same as in the seamount experiment the circulation model in each run is integrated for three years from 1 january 2014 to 31 december 2016 utc the results of the last two years are used for the analyses in this paper the in situ observations of temperature salinity and currents extracted from datasets constructed by the korea oceanographic data center kodc national marine data center nmdc and jma are used in this study to assess the performance of the circulation model using four different vertical coordinates the observation stations of kodc and jma are marked by black and pink dots respectively in fig 11 model results at two standard transects pn and tn shown in fig 11 are compared with observations transect pn is a transect cross the kuroshio used by the nagasaki marine observatory of the jma for conducting in situ hydrographic and current observations since 1972 the daily satellite remote sensing sea surface temperature sst derived from the advanced very high resolution radiometers avhrr reynolds et al 2007 are also used to examine the performances of different vertical coordinates in simulating ssts over the study region 3 3 2 evaluation of different vertical coordinates fig 12a presents the monthly mean sst in august 2015 calculated from the satellite observations the august mean sst in 2015 was about 29 c over the southeastern region of the model domain and gradually decreased towards the northwestern region several cold water patches occurred in the ys lu et al 2010 the sst was about 22 c in korea bay and about 25 c over coastal waters of the southwestern ys sharp temperature gradients occurred between the warmer ecs and the cooler ys in august 2015 fig 12a fig 12b e present the differences of the august mean ssts produced by the circulation model in four different runs csc zlc gtc and gptc from the monthly mean satellite sst observations the sst differences are used to represent the model errors in simulating sst over the study region the sst differences are within 1 0 c over most parts of the model domain in four runs however large sst differences occur over the coastal waters among four runs the sst differences in korea bay and coastal waters of the southwestern ys are relatively large and up to 3 5 c in runs csc and gtc fig 12b and d and relatively small in runs zlc and gptc fig 12c and e the observed and simulated sst values have correlation coefficients of about 0 81 0 86 0 83 and 0 90 for the csc zlc gtc and gptc respectively the root mean squared differences rmsd are about 0 71 0 63 0 67 and 0 54 c for the csc zlc gtc and gptc we next examine the model performances with different vertical coordinates in simulating the ysbcw fig 13a presents the august mean temperature at 50 m in 2015 interpolated from the kodc observations the observations demonstrate that in august 2015 the central region of the ys at 50 m was occupied by the waters lower than 10 0 c with a sharp temperature front nearly in the north southern direction fig 13a the subsurface 50 m temperature was about 8 c over the western part and increased to about 20 c over the southeastern part of the observation area fig 13b e present the monthly mean subsurface temperature at 50 m in august 2015 produced by the circulation model in runs csc zlc gtc and gptc the circulation model in the four runs generate highly similar subsurface waters of colder than 8 c at 50 m significant differences occur however in the positions and areas of the cold waters among these four runs both runs csc and zlc have the cold waters off the eastern side of the shandong peninsula while run gtc has one additional cold core located off the eastern side of southern ys by comparison run gptc has the largest pear like cold waters in the central region of the ys which is in a good agreement with previous studies yu et al 2006 fig 14a presents the temperature distribution along transect pn based on the nmdc observations on 16 january 2015 the observed temperature was nearly uniform and relatively warm of about 20 22 c in the upper mixed layer and strongly stratified with the vertical decrease of temperature from 20 to 6 c in the middle water column along the transect the observed temperature was uniform and about 6 c in the bottom layer below 800 m fig 14a also shows a warm temperature core about 22 c in the upper mixed layer near the shelf break of the ecs of which the maximum depth was about 125 m the observed temperature along the transect had large along transect gradients associated with particularly in the middle water column indicating intense baroclinic dynamics associated with the kuroshio over this area yang et al 2011 it should be noted that the observed temperature shown in fig 14a represents the typical distribution of temperature in the winter months over the area with transect pn the observed temperature on 5 july 2016 fig 14f was warm and about 29 c in the top 30 m which are different from the observed temperature shown in fig 14a this indicates that the observed temperature in the upper water column had strong seasonal variability over the area the warm temperature core in the surface layer rose to about 30 c and its center moved slightly southeastward on 5 july 2016 in comparison with the observed temperature on 16 january 2015 the observed temperature on 5 july 2016 fig 14f had large vertical and horizontal stratifications associated with the kuroshio and relatively uniform in the bottom layer which are similar to the observations on 16 january 2015 fig 14a vertical distributions of daily mean temperature along transect pn produced by the circulation model using four different vertical coordinates runs csc zlc gtc and gptc are shown in fig 14b e for 16 january 2015 and in fig 14g j for 5 july 2016 the circulation model in the four different runs reproduces reasonably well the general features of vertical distributions and associated seasonal variability of observed temperatures along transect pn significant differences occur however among the four model runs the widths of the surface warm core associated with the kuroshio in runs csc and gtc are twice of the observations the upward climbing of the bottom cold waters along the steep slope is also overestimated in runs csc and gtc in comparison with the observations the simulated temperature in the subsurface layer in run zlc is in a general agreement with the observations however the surface warm temperature core in run zlc splits into two parts furthermore the circulation model using the zlc cannot reproduce the observed temperature salinity near the sea bottom among the four runs the simulated temperature in run gptc agrees best with the observations along transect pn with the observed surface warm water and bottom cold waters well resolved in both seasons to quantify the model performance in simulating the bottom cold water the 10 c contour lines of simulated temperatures in four runs are compared to the observations on both 16 january 2015 and 5 july 2016 fig 14a and f the 10 c contour lines produced by the model in runs csc and gtc climb up to 270 m over the shelf break of the ecs which are 105 m shallower than that in observations the 10 c contour lines in runs zlc and gptc show similar position and tilt angle with the observations in both two observation days the observed and simulated temperatures along transect pn have correlation coefficients of about 0 96 0 97 0 97 0 98 on utc 16 january 2015 and 0 98 0 99 0 99 0 99 for on utc 5 july 2016 respectively for runs csc zlc gtc and gptc the rmsd are about 1 59 1 21 1 49 1 16 c on utc 16 january 2015 and 1 46 1 00 1 09 0 91 c on utc 5 july 2016 respectively for runs csc zlc gtc and gptc table 3 vertical distributions of observed salinity along transect pn are shown in fig 15a and f based on observations on 16 january 2015 and 5 july 2016 respectively the observed salinity along the transect had significant seasonal variability in the top 200 m and relatively weak seasonal variability below 200 m in the deep water region off the shelf break of the ecs along the transect the observed salinity on 16 january 2015 was almost vertically uniform and about 34 9 psu in the top 180 m fig 15a subsurface low salinity water lower than 34 3 psu was centered around 600 m in the deep water region of the transect which slanted upward from the okinawa trough to the continental slope of the ecs on the shelf water region of the ecs along the transect the observed salinity on 16 january 2015 was vertically uniform in the upper layer of shallower than 40 m and weakly stratified in the bottom boundary layer the observed salinity on 5 july 2016 had seaward spreading of low salinity waters in the surface layer and shoreward intrusion of relatively high salinity waters into the shelf water region in the subsurface layer fig 15f a subsurface high salinity core centered at about 150 m below the sea surface is located in the deep water region off the shelf break of the ecs subsurface low salinity waters lower than 34 3 were centered around 600 m in the deep water region of the transect on 5 july 2016 fig 15f which is similar to the observations on 16 january 2015 fig 15a vertical distributions of daily mean salinity along transect pn produced by the circulation model in four different runs csc zlc gtc and gptc are also shown in fig 15 the model results in four different runs reproduce the general vertical distributions of observed salinities between 100 m and 400 m along the transect considerable differences occur however in the daily mean salinities among the four model runs particularly in the top 100 m and below 400 m on 16 january 2015 the simulated salinities over the shelf region of the transect in runs csc zlc and gtc fig 15b d are too low in comparison with the observations on 5 july 2016 the simulated subsurface high salinity cores in the deep waters of the transect in runs csc and zlc are smaller than the observations furthermore run csc has relatively large model deficiencies in maintaining the structure of the subsurface low salinity waters the simulated salinity in run gptc is in a very good agreement with the salinity observations in comparison with model results in other three runs csc zlc and gtc particularly in the top 600 m as discussed in section 2 model results using the conventional terrain following vertical coordinate suffer from the errors from the sum of two large terms and diapycnal mixing by comparison the zlc is not sensitive to this problem as shown in fig 15c and h run zlc does not have the low salinity waters in the bottom layer and reproduces reasonably well the structure of the sub surface low salinity waters centered at about 500 m the observed and simulated salinities along transect pn have correlation coefficients of about 0 41 0 58 0 47 0 85 on 16 january 2015 and 0 81 0 86 0 81 0 84 on 5 july 2016 respectively for runs csc zlc gtc and gptc the rmsd are about 0 30 0 23 0 29 0 11 psu on 16 january 2015 and 0 56 0 49 0 31 0 29 psu on 5 july 2016 respectively for runs csc zlc gtc and gptc table 3 the values of the statistical error metrices indicate that the circulation model using the gptc performs the best in simulating temperature and salinity along transect pn among the four different vertical coordinates fig 16a and f present distributions of observed currents normal to transect pn i e along slope flow based the jma current observations respectively on 16 january 2015 and on 5 july 2016 on these two days the observed along slope flow known as the kuroshio was strong and positive northeastward over the upper part of the slope at water depths of 300 600 m the maximum northeastward speeds of the observed kuroshio were about 1 2 m s 1 on 16 january 2015 fig 16a and about 1 4 m s 1 on 5 july 2016 fig 16f the main features of the observed kuroshio shown in fig 16a and f are consistent with previous studies ichikawa and beardsley 2002 liu and gan 2012 a weak and southwestward flow known as the slope counter current ichikawa and beardsley 2002 was observed in the bottom boundary layer over the lower part of the slope fig 16a f the slope counter current is a belt like southwestward bottom current which spread from water depths of 450 m to 850 m in the lower part of the slope on 16 january 2015 fig 16a and became a weak and narrow bottom current centered at water depths of about 800 m on 5 july 2016 fig 16f to the south of the kuroshio the current observations on these two days also had a southwestward flow of which the maximum southwestward speed of about 0 2 m s 1 on 16 january 2015 fig 16a and about 0 4 m s 1 on 5 july 2016 fig 16f the daily mean along slope currents at transect pn produced by the circulation model in four different runs are shown in fig 16b e for 16 january 2015 and fig 16g j for 5 july 2016 the circulation model using four different vertical coordinates csc zlc gtc and gptc reproduces the general features of the observed along slope currents on the two observation days large differences occur among the four runs run zlc overpredicts the strength of the kuroshio with the simulated maximum speeds to be about 0 2 m s 1 faster fig 16c and h than observations on both 16 january 2015 and 5 july 2016 the width of the observed kuroshio along transect pn at the sea surface was about 22 km on 16 january 2015 and about 28 km on 5 july 2016 by comparison the widths of the kuroshio in runs csc zlc gtc and gptc are about 25 3 30 8 25 3 1 3 km wider on 16 january 2015 and about 38 5 25 3 25 3 18 7 km wider on 5 july 2016 than the observations in comparison with in situ observations and model results in other three runs run zlc does not generate the slope counter current and overestimates the southwestward flow to the east of the kuroshio the shapes of the slope counter current in run csc fig 16b and g are similar and in a general agreement with observations on the two observation days run gtc reproduces the observed maximum speeds and spatial features of the currents along transect pn although the circulation model using gptc performs well in reproducing the spatial features of the kuroshio along transect pn the maximum speed of the kuroshio in run gptc is weaker up to 0 2 m s 1 than observations in both two observation days furthermore the simulated currents in run gptc have noticeable deficiency between the real topography and lowermost steplike grids the observed and simulated along slope currents at transect pn have correlation coefficients of about 0 90 0 92 0 90 0 90 on 16 january 2015 and 0 89 0 90 0 86 0 94 on 5 july 2016 respectively for runs csc zlc gtc and gptc the rmsd are about 0 18 0 22 0 17 0 16 m s 1 on 16 january 2015 and 0 21 0 24 0 21 0 13 m s 1 on 5 july 2016 respectively for runs csc zlc gtc and gptc table 3 this indicates that run gtc performs best among the four runs in simulating the style of normal current along transect pn in comparison with the current observations to examine the model errors in computing the bpg we calculate differences in the bpg values in runs csc gtc and gptc from the counterparts in run zlc along transect tn marked in fig 11 by considering the bpg values in run zlc as the ground truth the bpg differences shown in fig 17 can be considered as the model errors in the bpg the maximum bpg errors along transect tn are about 4 5 10 6 n kg 1 2 9 10 6 n kg 1 and 0 9 10 6 n kg 1 respectively in runs csc gtc and gptc fig 17 it indicates that the model errors in the bpg are smallest in run gptc in comparison with the model errors in runs csc and gtc finally we compare the 3d monthly mean currents produced by the circulation model using four different vertical coordinates the monthly mean surface currents in august 2015 produced by the circulation model have very similar large scale features in runs csc gtc and gptc fig 18 the monthly mean surface circulation in august 2015 in runs csc gtc and gptc features the kuroshio taiwan strait throughflow tst and tsushima warm current twc which is consistent with previous studies guo et al 2003 isobe 2008 lie and cho 2016 the kuroshio up to 1 6 m s 1 flows northeastward along the 200 m isobath over the continental slope of the ecs turns southeastward at about 30 n to flow through the tokara strait and then skirts the east coast of kyushu the tst up to 0 6 m s 1 flows northeastward into the ecs from the taiwan strait and bifurcates into two branches with one branch known as the taiwan warm current tawc flowing northward and another branch merging to the kuroshio the basin scale anticlockwise circulation in the ys consists of the yellow sea coastal current yscc and the korean coastal current kcc significant differences occur in the monthly mean surface currents between run zlc and other three runs fig 18b shows that run zlc has a strong eddy off southeastern taiwan island before the kuroshio flowing into the ecs which may be associated with the step like z level vertical grids using in the model the strength of the kuroshio in run zlc is also stronger than the counterparts in other three runs particularly over the tokara strait and adjacent waters fig 19 presents the monthly mean sub surface 200 m currents on 200 m in august 2015 in runs csc zlc gtc and gptc the monthly mean sub surface circulation has very similar structures in runs csc gtc and gptc which features the sub surface kuroshio up to 1 3 m s 1 flowing northeastward along the continental slope of the ecs large differences also occur in the sub surface currents between run zlc and other three runs run zlc has a strong eddy off southeastern taiwan island before the kuroshio flowing into the ecs at 200 m which differs from the counterparts in other three runs another obvious difference is that the curvature of the large meander of the kuroshio at the southern of kyushu in run zlc is relatively larger than other three runs 4 summary and conclusions two types of generalized vertical coordinates were developed to eliminate large model errors in calculating the baroclinic pressure gradient bpg the advection term and horizontal diffusion for temperature and salinity in a terrain following ocean circulation model these two new coordinate systems are defined as the generalized terrain following coordinate gtc and generalized piecewise terrain following coordinate gptc the gtc is generated by substituting the sigma levels in the interior of a conventional sigma coordinate csc with a series of constant depth levels the gptc is constructed by dividing the model domain into two parts in the vertical direction the upper part covering the shallow coastal waters and highly stratified waters and the lower part including the continental slopes and deep basins in the gptc the upper part uses the gtc and the lower part uses the piecewise terrain following coordinate the depth differences between two adjacent grids are reduced by using the gptc especially in the bottom layer over steep topography the main reason for introducing the gptc is to reduce large model errors in computing advection terms and horizontal diffusion in the temperature and salinity equations using the conventional sigma layers near the bottom over steep topography where the conventional sigma layers cross the isotherms or isohalines performances of the gtc and gptc were assessed first in two types of idealized numerical experiments with a tall seamount and continuously varying bottom slope respectively the model results from the diagnostic seamount experiment show that the use of the gtc reduces the model errors in the bpg vertical and horizontal currents these model errors however still occur in the sigma layers near the bottom over the steep topography if the gtc is used as the vertical coordinate the gptc reduces these model errors of the csc by one order of magnitude the model results from the prognostic seamount experiment show that the gtc and gptc greatly alleviate the spurious diapycnal mixing in csc models especially for calculating horizontal diffusion the circulation model in the continuously varying slope experiment using the z level coordinate zlc overestimates the bottom intensified currents which indicates that the advantage of terrain following coordinates over the zlc in simulating the 3d currents the performances of the gtc and gptc were further assessed by examining prognostic simulations of 3d currents and hydrography over the yecs and adjacent waters with realistic external forcing and bottom topography the model results using the gtc and gptc were also compared to the counterparts using the csc and zlc the temperature salinity and currents produced by these experiments were examined by comparing to the in situ and remote sensing observations taken from the nmdc jma kodc and avhrr it was found that the gptc performs better in reproducing observed hydrography than the csc zlc and gtc the gptc significantly reduces the overestimated upward climbing of the bottom cold water along the steep slope which is a common problem in the terrain following coordinate models furthermore the gptc reproduces the shoreward intrusion of relatively high salinity subsurface water and seaward spreading of intermediate low salinity waters better than other three coordinates the gptc eliminates the low salinity waters in the bottom layer different from temperature and salinity simulations the observed currents were better simulated by the model using the gtc than the other three coordinates csc zlc and gptc the gtc reproduces the observed maximum speeds and spatial features of the kuroshio the slope counter current and their seasonal variability along transect pn better than other three coordinates although the circulation model using gptc performs best in reproducing the 3d field of temperature and salinity among the four coordinates the model results in case gptc have noticeable deficiency between the real topography and lowermost steplike grids furthermore it is an inherent problem that the steplike vertical grids are non differentiable and can lead to overestimated currents as suggested in the previous studies beckmann and döscher 1997 pacanowski and gnanadesikan 1998 ezer 2016 a bottom boundary layer model suggested by beckmann and döscher 1997 can be coupled to the gptc or zlc model to get realistic simulations of near bottom tracers and the corresponding circulation by taking the performances of four vertical coordinates in simulating both the hydrography and currents into consideration the gptc is recommended to be used in the general ocean circulation model it should be noted that both the gtc and gptc proposed in this study reduce significantly the model errors in the bpg and spurious diapycnal mixing but do not completely eliminate them in the ocean circulation model using the terrain following coordinate furthermore the performances of the four vertical coordinates were accessed in this study using the pomgcs mellor et al 2002 with the second order accurate centered difference numerical scheme it was shown that a 4th order numerical scheme for the bpg berntsen and oey 2010 and a rotated mixing operator for the accurate calculation of isopycnal diffusion becker et al 2000 lemarié et al 2012 are very useful to further reduce model errors in the ocean circulation model using the gtc and gptc credit authorship contribution statement zhanyuan he conceptualization methodology software validation writing original draft writing review editing shouxian zhu conceptualization methodology writing review editing funding acquisition jinyu sheng methodology validation writing review editing funding acquisition bin wang software writing review editing declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments we thank the national science and technology infrastructure national marine data center for providing data shouxian zhu was supported by the national natural science foundation of china nsfc grants 41076048 41376012 41206163 and the fundamental research funds for the central universities grant 2011b05714 jinyu sheng was also supported by the natural sciences and engineering research council of canada nserc grant 217081 and ocean frontier institute ofi zhanyuan he was also supported by the china scholarship council to study at dalhousie university the authors wish to thank two anonymous reviewers and the editor for their useful and constructive comments appendix governing equations in generalized vertical coordinates system the governing equations for the ocean circulation model used in this study are based on the general vertical coordinate system used in the princeton ocean model mellor et al 2002 considering a cartesian coordinate system with the x axis to be eastward y axis to be northward and z axis to be upward the vertical position z x y k t for level k is written as a 1 z x y k t η x y t s x y k t where η x y t is the sea surface elevation and s x y k t specifies the type of a vertical coordinate for the z level coordinate i e a quasi z level coordinate we have a 2 s x y k t σ 0 k h m a x η x y t where h m a x is the maximum value of the static water depth defined as h x y and σ 0 k is a series values between 1 and 0 for the conventional sigma level coordinate csc we have a 3 s x y k t σ a k h x y η x y t in which each vertical level has a constant sigma value σ σ a k for the generalized terrain following coordinate gtc we have a 4 s x y k t σ b x y k h x y η x y t with σ b 0 at surface and σ b 1 at bottom as the csc however may have nonconstant sigma value on one vertical level in the interior of the model domain the vertical velocity in the generalized vertical coordinate system is given as a 5 ω s k d k d t s k d k d t the relation between ω and the vertical velocity in the z level coordinate w is given as a 6 ω w s x η x u s y η y v s t η t where u and v are the velocities in the x and y directions the governing equations of currents u v temperature t and salinity s in the generalized vertical coordinate are given as mellor et al 2002 a 7 s k t u s k x v s k y ω k 0 a 8 u s k t u 2 s k x u v s k y u ω k f v s k g s k η x g s k ρ 0 k 0 s k ρ x s x η x ρ k d k k μ m s k u k s k t x x x s k t x y y v s k t u v s k x v 2 s k y v ω k f u s k a 9 g s k η y g s k ρ 0 k 0 s k ρ y s y η y ρ k d k k μ m s k v k s k t x y x s k t y y y a 10 t s k t t u s k x t v s k y t ω k k μ h s k t k s k q t x s k q t y r k a 11 s s k t s u s k x s v s k y s ω k k μ h s k s k s k q s x s k q s y where t x x a m 2 u x t y y a m 2 v y t x y a m u y v x q t x a h t x q t y a h t y q s x a h s x q s y a h s y here a m and a h are the horizontal viscosity and diffusivity coefficients μ m and μ h are the vertical viscosity and diffusivity coefficients respectively the baroclinic pressure gradient bpg in eqs a 8 and a 9 are given as a 12 b x g ρ 0 k 0 s k ρ x s x η x ρ k d k b y g ρ 0 k 0 s k ρ y s y η y ρ k d k the area averaged density ρ m e a n has been subtracted from the density ρ before calculation 
23837,two types of generalized vertical coordinates are introduced to reduce model errors in calculating the baroclinic pressure gradient bpg advection term and horizontal mixing in tracer equations in a three dimensional 3d ocean circulation model these two types of vertical coordinates are defined as the generalized terrain following coordinate gtc and generalized piecewise terrain following coordinate gptc the main feature of the gtc is the use of a series of constant depth levels in the water column above the sea bottom the gptc differs from the gtc in which the depth differences between two adjacent grids are reduced especially in the bottom layer over steep topography performances of these two vertical coordinate systems are assessed first in two types of idealized numerical experiments with a tall seamount and continuously varying bottom slope respectively the model results in the tall seamount experiment demonstrate that both the gtc and gptc perform well in reducing the model errors in the bpg over the steep topography and greatly alleviate the spurious diapycnal mixing in terrain following coordinate models in the continuously varying bottom slope experiment both the gtc and gptc perform better than the z level coordinate in simulating the 3d currents the performances of the gtc and gptc are further assessed by examining prognostic simulations of 3d currents and hydrography in the yellow and east china seas with realistic external forcing and bottom topography the model results in the third experiment demonstrate that the gptc restrains the overestimated upward climbing of the bottom cold water in comparison with other coordinates the gptc also performs better than the gtc and the conventional sigma layer coordinate in simulating the shoreward intrusion of relatively high salinity subsurface waters intermediate low salinity waters and the yellow sea bottom cold waters by comparison the gtc simulates the kuroshio the slope counter current and their seasonal variability significantly better than other coordinates keywords generalized vertical coordinate ocean circulation model terrain following reduction of spurious diapycnal mixing baroclinic pressure gradient advection 1 introduction numerical ocean circulation models have increasingly been used to study three dimensional 3d circulation wang et al 2014 xia et al 2006 and the effects of physical environmental conditions on marine creatures in the ocean béguer pon et al 2016 xue et al 2008 in order to have reliable simulations of three dimensional 3d circulation and hydrography a 3d circulation model should have enough vertical resolutions resolve bottom topography and retain the water characteristics in the lower layer in the deep ocean for a long time model integration the choice of vertical coordinate systems in a 3d ocean circulation model has been one of major concerns in the ocean modeling community there are three general types of vertical coordinate systems widely used in the ocean general circulation models including the constant geopotential z level terrain following sigma level or σ level and layered typically isopycnal layers vertical coordinates among these three types the z level coordinate zlc is the simplest and has been used in the modular ocean model pacanowski et al 1993 and nucleus for european modelling of the ocean madec 2008 one of main drawbacks of the zlc however is that the bathymetry in the z level model is represented by a series of steps which have problems in resolving barotropic and baroclinic coastal trapped waves gerdes 1993 the step like interfaces also make it difficult to properly resolve the bottom boundary layers pietrzak et al 2002 the sigma level coordinate uses sigma surfaces which follow the ocean bottom in the model this allows for model variables such as currents temperature and salinity to be resolved smoothly in the bottom boundary layers the princeton ocean model pom blumberg and mellor 1987 semi spectral ocean model som haidvogel et al 1991 and regional ocean modeling system roms shchepetkin and mcwilliams 2005 employ the sigma vertical coordinates the main drawback of the conventional sigma coordinate csc is that large numerical errors occur in calculating the baroclinic pressure gradient bpg in the model especially in regions with steep topography and large density gradients gary 1973 haney 1991 mellor et al 1994 ocean circulation models using the zlc or the csc suffer from model errors of spurious diapycnal diffusion associated with inconsistent vertical coordinate iso surfaces and local isopycnal directions griffies et al 2000 lee et al 2002 marchesiello et al 2009 lee et al 2002 demonstrated that the z coordinate circulation models have the spurious diapycnal diffusion if the diffusive horizontal advection schemes are used marchesiello et al 2009 proposed a new advection scheme named as rsup3 to alleviate the considerably spurious diapycnal mixing in a terrain following coordinate model berntsen and oey 2010 demonstrated that errors in the internal pressure gradient in csc models can be reduced using a simple 4 th order accurate scheme lemarié et al 2012 developed a method of stabilizing corrections msc for the time integration of the rotated harmonic and biharmonic operators to retain the stability and accuracy of general circulation models legg et al 2006 suggested that the use of the isopycnal vertical coordinate in the ocean circulation model can control this error in fact the isopycnal surface is a natural vertical coordinate system for studying ocean dynamics and has successfully been used in the hybrid coordinate ocean model halliwell et al 1998 and miami university isopycnal coordinate ocean model bleck and boudra 1981 for simulating large scale circulations and sharp fronts the layers of predefined constant density can be used in the vertically well stratified condition but collapse into one layer in the well mixed coastal waters several methods were developed in the past to improve the performances of vertical coordinates in ocean circulation models increasing both the horizontal and vertical resolutions ezer and mellor 2004 is the simplest but computationally less efficient for improving the model performance a widely used approach in z level models is to allow bottom most grid cells to be partial cells pacanowski and gnanadesikan 1998 which adjusts the thickness of the bottom grids artificially to better resolve the bathymetry beckmann and döscher 1997 proposed a hybrid approach by coupling a simple terrain following bottom boundary layer model to the zlc model to improve the representation of dense water spreading over topography becker et al 2000 suggested the use of a rotated diffusion operator for the accurate calculation of isopycnal diffusion in the zlc model the horizontal pressure gradient is calculated based on the reconstruction of the density field and z levels as continuously differentiable polynomial functions of transformed coordinates with subsequent analytical integration shchepetkin and mcwilliams 2003 2008 2009 in ocean circulation models to achieve a higher order of accuracy the internal pressure gradient errors can also be substantially reduced by using the simple fourth order method berntsen and oey 2010 or the optimal σ method berntsen 2011 the general vertical coordinates gvcs suggested previously are the combination of the zlc and csc bruciaferri et al 2018 burchard and petersen 1997 gerdes 1993 pietrzak et al 2002 zhuang et al 2018 most of previous gvcs belong to a hybridization between z level and sigma level coordinates using different methods pietrzak et al 2002 developed a generalized sigma level coordinate which refines the grid towards the sea surface with a series of constant depth levels in the upper water column zhuang et al 2018 suggested a gvc method by dividing the water column into three parts vertically and using the sigma coordinate in the near surface and near bottom layers and the z level coordinate in the intermediate layer bruciaferri et al 2018 suggested a multi envelope generalized coordinate system which adjusts the computational levels according to multiple virtual bottoms rather than following geopotential levels or the actual bathymetry although the gvcs developed previously pietrzak et al 2002 bruciaferri et al 2018 are useful in reducing numerical errors in the bpg large numerical errors can still exist in the bottom layer especially over the steep topography the main objective of this study is to present and validate two types of new gvcs which use the constant depth levels in the water columns above the sea bottom to reduce the model errors in calculating the bpg and diapycnal mixing including advection terms and horizontal diffusivity in the temperature and salinity equations the bpg and advection terms in this study are calculated using the conventional centered difference scheme with the second order of accuracy the performances of these two new gvcs are assessed by examining model results in different vertical coordinates in three types of numerical experiments the first two types of experiments are the idealized model setup and forcing used in previous studies with an idealized tall seamount and continuously varying slope respectively the third type is a realistic numerical experiment with a model domain covering the yellow and east china seas yecs and adjacent deep waters of the northwestern pacific ocean this paper is structured as follows section 2 introduces two new gvcs section 3 presents performance assessments of the newly developed vertical coordinates in three types of numerical experiments summary and conclusions are given in section 4 2 the generalized piecewise terrain following vertical coordinates the terrain following sigma or σ coordinate has widely been used in ocean circulation models to simulate 3d circulation and hydrography over coastal and shelf waters and in the deep ocean with the complicated bathymetry the sigma coordinate σ can be expressed as 1 σ z η h η z η d where η is the sea surface elevation h is the static water depth and d h η is the total water depth at the sea surface z η σ 0 at the sea bottom z h σ 1 eq 1 can also be written as 2 z η σ d as shown in the appendix the conventional sigma coordinate csc has a constant σ value on each vertical layer the csc suffers from the problem of large numerical errors in calculating the bpg haney 1991 mellor et al 1994 under the hydrostatic approximation the equations for the bpg in a cartesian coordinate system x y z with the z axis to be upward and z 0 at the mean sea surface can be written as auclair et al 2000 3 b x g ρ 0 z η ρ x d z b y g ρ 0 z η ρ y d z where ρ is the density of sea water g is gravity acceleration and ρ 0 is the reference density to a constant or a function of the vertical coordinate only in the csc the horizontal density gradients are calculated by 4 ρ x z ρ x σ ρ σ σ x ρ y z ρ y σ ρ σ σ y substituting eq 4 into eq 3 the equations of bpg in the csc are 5 b x g d ρ 0 σ 0 ρ x ρ σ σ x d σ g d ρ 0 σ 0 ρ x σ d d x η x ρ σ d σ b y g d ρ 0 σ 0 ρ y ρ σ σ y d σ g d ρ 0 σ 0 ρ y σ d d y η y ρ σ d σ the expression shown in eq 5 is a special form of eq a 12 in appendix both ρ x σ and ρ σ σ x are large numerically in the region with a steep slope and strong stratification the sum of these two large terms should be equal to a small term of ρ x z mathematically however numerical errors in calculating these two large terms can lead to considerable numerical errors in the horizontal density gradients therefore small numerical errors in temperature and salinity can lead to significant errors in the bpg over the region with steep topography and stratification in a csc model the generalized terrain following coordinate gtc was suggested to reduce the slopes of sigma levels over steep topography in the general coordinate system of the pom pomgcs mellor et al 2002 the main feature of the gtc is to have nonconstant σ values on a given vertical level fig 1a presents the schematic view of the gtc used in the pomgcs in which a series of z levels are used in the water column above the sea bottom positions of z levels are labeled as z 0 1 λ z where λ z is the maximum number of z layers the actual number of z levels used in some grids may be smaller than λ z the lowermost z level λ p 1 λ p λ z is determined by the restriction of z 0 λ p 0 9 h x y z 0 λ p 1 the selected z levels are set in the upper water columns and the values of z 0 1 λ p are transformed to the sigma coordinate by 6 σ σ b x y k z 0 k 1 η 0 x y h x y η 0 x y 2 k λ p 1 where η 0 x y η x y 0 is the surface elevation at the initial time some nonconstant depth layers are set in the lower water column in order to satisfy σ b x y k b 1 where k b is the total number of vertical levels the surface level should satisfy σ b x y k 1 0 the numerical ocean circulation model with the gtc presented above however was found to be computationally unstable since too many nonconstant depth layers in the lower water columns over the shallow water region as a result an improved gtc is first introduced in this study which combines the csc and the z level coordinate fig 1b this hybrid coordinate system is constructed in three steps firstly a csc σ a k defined in the appendix is applied to the whole model domain secondly the series of z layers z 0 are transformed to σ 1 x y k based on eq 6 thirdly the gtc is determined based on 7 σ σ b x y k max σ a k σ 1 x y k 2 k λ p 1 and σ b x y k σ a k is set at the sea surface and sea bottom as shown in fig 1b the improved gtc based on eq 7 connects smoothly the csc and zlc without too many layers in the lower water columns over the shallow water region the problem of large bpg errors in the terrain following ocean circulation model has long been recognized auclair et al 2000 mellor et al 1998 robertson et al 2001 another general type of model errors namely spurious diapycnal diffusion was also recognized griffies et al 2000 diagnosed the effective diapycnal diffusivity corresponding to any numerical transport process in a z level coordinate model using the equivalent sorted fluid state their results showed that the horizontal diffusivity is mainly responsible for the spurious diapycnal mixing marchesiello et al 2009 analyzed the spurious diapycnal mixing in the sigma coordinate models and showed that the spurious mixing decreases with resolution is generally false similar problems of using large terms to calculate small term also occur in calculating advection term in the tracer equations which result in serious spurious diapycnal mixing a new and effective method using the gvcs to reduce the spurious diapycnal mixing is presented in this study for simplicity of presentation we consider the tracer equation for temperature t in a cartesian coordinate system with the z level vertical coordinate 8 t t u t x 8 a v t y 8 b w t z f h f v r z where u v and w are components of the velocity vector in the x y and z directions respectively f h and f v represent horizontal and vertical eddy mixing terms respectively and r represents the solar radiation the temperature equation in the csc can be expressed as 9 t t u t x 9 a v t y 9 b ω σ d t σ f h f v r d σ 10 ω σ w u σ d x η x v σ d y η y σ d t η t it should be noted that terms 8 a and b in eq 8 are usually small terms in the z level coordinate in comparison with terms 9 a and b in the csc particularly over steep topography with high vertical stratification the vertical temperature or salinity gradients are large in the thermocline terms 9 a and b are significantly amplified if the sigma surfaces cross the isotherms mathematically terms 9 a and u σ d d x t σ are very large and should almost cancel out each other numerically however any numerical errors of these two large terms should result in considerable errors to their sum the same errors also occur in term 9 b and v σ d d y t σ the numerical errors discussed above also occur in numerical models with the temperature and salinity equations in the flux format as shown in eqs a 12 and 5 the bpg is determined by the vertical integration of horizontal density gradients in the gtc the bpg is determined jointly by the zlc and csc the z levels can work well in reducing the bpg errors although there are still negative effects caused by the csc levels as shown in eqs a 10 and 9 the temperature advection terms do not involve directly the vertical integration the calculations of temperature advection terms on one level are mainly affected by the adjacent variables the gtc has steep csc levels near the bottom over steep topography where the problem of using large terms to calculate small terms for the temperature advection terms is not resolved therefore the generalized piecewise terrain following coordinate gptc is suggested to address this problem the gptc uses the gtc layers in the shallow waters and piecewise terrain following layers in the deep waters fig 2 the demarcation depth h c of the shallow and deep waters equals to z 0 k u 1 where k u is the number of total vertical layers in the shallow waters in the shallow waters including the upper water columns of deep waters the gtc is first set according to eqs 6 and 7 except that h x y is replaced by the virtual bottom of min h c h x y then the sigma values in the gtc is transformed to the gptc system 11 σ σ c x y k σ b x y k min h c h x y η 0 x y h x y η 0 x y 1 k k u the series of z levels z 0 k u k d 1 is firstly set in the lower water columns of deep waters k d is determined by z 0 k d 1 h x y z 0 k d secondly some extra levels are supplemented between the lowermost z level and the sea bottom therefore the gptc in the lower water columns of deep waters can be expressed as 12 σ σ c x y k z 0 k 1 η 0 x y h x y η 0 x y k u k k d σ c x y k 1 1 σ c x y k d k n k d k k d k n where k n is the total number of the supplemented layers near the sea bottom the value of k n is determined according to h x y z 0 k d 1 the gptc has σ values of 0 at the sea surface and 1 at the sea bottom but the number of total vertical layers is variable at each grid which differs from the roms generalized coordinate system shchepetkin and mcwilliams 2005 the shallow waters have less vertical layers than the deep waters in summary both the gtc and gptc satisfy σ 0 at the sea surface and σ 1 at the sea bottom which are same as the csc however both the gtc and gptc allow to have nonconstant sigma values on a particular vertical layer in the interior of the model domain the gtc and csc divide the water columns into identical number of vertical layers while the gptc has various numbers of vertical layers in shallow and deep waters 3 performance assessments of the generalized vertical coordinates the performances of the gtc and gptc are assessed in two types of idealized numerical experiments and one realistic experiment with the model domain covering the yecs and adjacent waters the tall seamount and continuously varying bottom slope topography were used in these idealized experiments respectively the 3d currents and hydrography over the yecs and adjacent waters were simulated with realistic external forcing and bottom topography in the third experiment the numerical circulation model in all three experiments is based on pomgcs mellor et al 2002 using the default second order accurate numerical scheme the model results from these three experiments are compared to the counterparts using the csc and zlc 3 1 a tall seamount topography the tall seamount experiments were used in the past for examining model errors in the bpg in a numerical ocean circulation model appendix using different vertical coordinates over the steep topography with strong vertical stratification mellor et al 1994 song and haidvogel 1994 a gaussian seamount is placed in the central area of a rectangular basin with four closed lateral boundaries 13 h x y h 0 1 0 δ h exp x 2 y 2 r 2 where h 0 4500 m δ h 0 9 m and r 25 km in eq 13 x and y are eastward and northward coordinates respectively with the origin of the coordinate defined at the center of the rectangular basin the dimension of the rectangular basin is approximately 400 km long and 300 km wide which are more than ten times larger than the radius of the seamount the model domain is divided into 69 51 grid cells horizontally the grid resolution is refined near the center of the domain with the horizontal resolution varying from 4 8 km over the seamount to 8 0 km at the model boundaries fig 3 the vertical stratification is specified by setting an exponential varying temperature c in the form of 14 t 5 0 20 0 exp z 1000 where z is the upward vertical coordinate with z 0 at the mean sea surface in units of m the salinity is set to be 35 psu and invariant in time and space over the whole model domain the initial condition of the model is a state of no motion other parameters used in the experiment are listed in table 1 in the idealized numerical experiments the kinetic energy and maximum velocity at each time step on the c grid are computed based on 15 e k i n 1 2 v o i j k δ v i j k u u i j k 2 δ v i j k v v i j k 2 for the kinetic energy and 16 v m a x m a x u i j k v i j k for the maximum velocity in the equation above 17 v o i j k δ v i j k d is the total volume of the model domain and δ v i j k d δ v i j k u δ v i j k v represent respectively the control volumes for the density u and v points in the above expressions i j k are indices for the grid points in the eastward northward and upward directions 3 1 1 diagnostic run the ocean circulation model in the seamount experiment is run firstly in diagnostic mode for 100 days to assess the performance of the gtc and gptc in reducing the bpg errors the horizontal viscosity and horizontal diffusivity coefficients a m a h in the experiment are set equal to 100 m2 s 1 and zero and the vertical viscosity and diffusivity coefficients μ m μ h are set to 2 0 10 4 m2 s 1 since no external forcing is used to drive the circulation model with the temperature and salinity fields specified in this experiment the true solution of circulation in this case is zero currents everywhere at any given time four model runs are conducted using the csc zlc gtc and gptc respectively with the same model setup as described above the constant depths z 0 in the gtc and gptc are set to z 0 2 4 6 8 10 15 22 30 39 50 64 81 100 120 140 160 180 200 222 248 278 312 352 400 456 522 600 692 802 934 1092 1278 1498 1762 2078 2450 2890 3418 4000 4500 m the gptc is constructed with h c 200 m k u 19 k n 2 and the maximum number of total vertical layers is set to 41 a finer vertical resolution is set in the surface layer in the model runs using the csc by using a parabolic distribution of vertical levels the maximum velocity v m a x and spatially averaged kinetic energy e k i n in three runs csc gtc and gptc are shown in fig 4 as mentioned above the true solution in this test case is zero currents everywhere at any time and non zero values of v m a x and e k i n are indications of model errors in each run fig 4 demonstrates that the model errors are sensitive to the choice of vertical coordinates in run csc the values of v m a x increase from zero to a large value of 0 53 m s 1 within a few days after the model initialization and then oscillate with time around this large value and the values of e k i n increase from zero to about 4 0 10 4 m2 s 2 within 60 days and then oscillate with time around this large value after 60 days of the model integration the growth trend of v m a x in run gtc is similar to the trend in run csc before getting the steady state 0 53 m s 1 however the e k i n in run gtc is about 6 times smaller than in run csc the v m a x in run gptc is only about 15 of the counterpart in run csc and the e k i n value in run gptc is almost negligible in comparison with the value in run csc which indicates the gptc has the smallest model errors among these three runs in terms of v m a x and e k i n fig 5 presents distributions of bpgs and vertical currents along the east west transect at y 0 and distributions of horizontal currents at 1000 m at model day 100 after the model initialization in three different model runs using the csc gtc and gptc the model results using the zlc are the same as the true solution of zero currents everywhere as a result the model results in run zlc are not considered here fig 5a demonstrates that large bpg errors occur around the steep slope in run csc with the maximum value of about 4 32 10 5 n kg 1 table 2 model results in run csc also has large errors in the vertical and horizontal currents with the maximum errors of about 3 48 10 2 m s 1 fig 5b and 0 55 m s 1 fig 5c respectively by comparison model results in run gtc fig 5d f have smaller errors in bpg vertical and horizontal currents the maximum errors in run gtc are about 4 04 10 5 n kg 1 3 03 10 2 m s 1 and 0 54 m s 1 respectively the model errors in run gptc fig 5g i are about one order of magnitude smaller than the errors in run csc the maximum errors in run gptc are about 0 45 10 5 n kg 1 6 30 10 3 m s 1 and 0 09 m s 1 for the bpg vertical and horizontal currents respectively as shown in right panels of fig 5 the model errors in horizontal currents differ significantly in three different runs csc gtc and gptc to further quantify the model errors in three different runs we compute the area averaged amplitudes of horizontal currents at 1000 m over the area marked by the red circle shown in right panels of fig 5 the radius of the circle is 50 km with both the centers of the circle and seamount to be collocated since the true solution in this seamount experiment is zero currents everywhere the area averaged amplitudes of horizontal currents can also be used to represent the area averaged model errors in horizontal currents the area averaged errors are about 11 15 10 2 4 00 10 2 and 0 95 10 2 m s 1 in runs csc gtc and gptc respectively this indicates that both the gtc and gptc perform better than the csc in reducing the model errors over the steep topography in the seamount experiment 3 1 2 prognostic run the circulation model in the seamount experiment is also run in prognostic mode to examine the sensitivity of spurious diapycnal mixing to the choice of different vertical coordinates four basic prognostic runs are conducted using four different vertical coordinates i e zlc csc gtc and gptc these four prognostic runs have the same model configuration of the diagnostic calculation including the advection term horizontal mixing and vertical mixing except that the model temperature is updated with the model currents and the horizontal diffusivity coefficient is set to 20 m2 s 1 furthermore twelve additional process oriented experiments are conducted to examine major physical processes that contributes to the spurious diapycnal mixing the circulation model in each of these twelve additional experiments is integrated for 300 days with the only inclusion of the advection term horizontal mixing and vertical mixing respectively by using one of the zlc csc gtc and gptc fig 6 presents the time evolution of v m a x and e k i n calculated from model results in the four basic prognostic seamount experiments the values of v m a x in run zlc are very small within 140 days after the model integration and increase with time with a large value of about 0 2 m s 1 around 260 days as stated in mellor et al 1998 and davidson et al 1998 the true solution in the prognostic seamount case or a large lake with horizontal homogeneous but vertically stratified waters and non zero horizontal and vertical mixing has non zero currents after the long model integration the values of v m a x in run csc rise to a large value of about 0 40 m s 1 within 5 days and then oscillate with time after 10 days of the model integration fig 6a the values of v m a x in run gtc also rise to a large value of about 0 30 m s 1 within 5 days and then reach a constant value of 0 28 m s 1 after 10 days of the model integration the values of v m a x in run gptc reach a constant value of 0 07 m s 1 after 5 days of the model integration the values of e k i n in run csc increase to a large value of about 2 20 10 3 m2 s 2 at model day 150 0 and then decrease with temporal oscillations fig 6b the values of e k i n in run gtc slowly increase with time within 230 days of the model integration after reaching a maximum value of 3 75 10 4 m2 s 2 at about day 240 the values of e k i n in run gtc gradually decrease with time and reach a value similar to the counterparts in run zlc at day 300 by comparison the values of e k i n in run gptc reach a very small and constant value of about 2 75 10 5 m2 s 2 within 150 days of the model integration fig 6b fig 7 presents vertical distributions of density differences between the initial density and the model density at model day 300 0 along the east west transect through the center of the seamount in the prognostic seamount experiments using four different vertical coordinates the zlc csc gtc and gptc respectively the spurious diapycnal mixing in model results is sensitive to the choice of vertical coordinates the model errors in run csc are significantly more severe than the errors in run zlc since the vertical stratification of the initial density field determined from the model temperature is horizontally uniform there is almost no diapycnal mixing in run zlc with the horizontal mixing alone fig 7c small differences induced mainly by the numerical errors occur around the tall seamount in run zlc with the advection term alone fig 7b a comparison of fig 7f and g demonstrates that in run csc the diapycnal mixing introduced by the horizontal mixing is much larger than the advection term especially around the steep slope the maximum value of density differences in the subsurface layer is greatly reduced from 0 38 kg m 3 in run csc to 0 26 and 0 08 kg m 3 in runs gtc and gptc respectively fig 7i and m the gvcs introduced in this study alleviate the model errors associated with the horizontal mixing and advection terms to small values fig 7j k n and o 3 2 a continuously varying slope the continuously varying slope experiment was also used previously for examining the effects of different vertical coordinates on ocean circulations especially in the bottom boundary layer mizuta and hogg 2004 using the cartesian coordinate system with its origin defined at the sea surface at the southwestern corner of the modal domain fig 8 the continuously varying slope is specified as 18 h x h 0 α x x x 1 h 0 α x 1 l t sinh x x 1 l t x x 1 where h 0 4000 m α 8 0 1 0 4 x 1 480 km and l t 150 km eq 18 indicates that the bottom slope is linear for x x 1 and hyperbolic sinusoid for x x 1 fig 8 the dimension of the model domain is 960 km in the x direction by 240 km in the y direction the model domain is uniformly divided into 120 30 grid cells in the horizontal dimension the northern and southern boundaries are closed and the eastern and western boundaries are open a constant inflow of 48 sv sv 106 m3 s 1 is specified at the western open boundary and an outflow of the same amount in sv is specified at the eastern open boundary the vertical distributions of the salinity and temperature are the same as in the idealized seamount experiment discussed in section 3 1 four model runs are conducted using the ocean circulation model with the four different vertical coordinates zlc csc gtc and gptc respectively the configurations of the gtc and gptc are the same as in the seamount experiment discussed in section 3 1 other model parameters used in this experiment are listed in table 1 the circulation model in each run is integrated for 150 days from a state of rest analytically the currents increase gradually from the western side to the eastern side and flow along the northern closed boundary fig 9 presents the time evolution of the v m a x and e k i n calculated from model results in four runs the values of v m a x in the four runs increase quickly to large values about 1 1 m s 1 at about 20 days and then relax to smaller values about 0 9 m s 1 after 30 days of the model integration the values of v m a x in the four runs have some temporal oscillations after 20 model days with the largest oscillations in run zlc the maximum value of e k i n in run zlc is about 1 5 10 2 m2 s 2 which is slightly larger than in the other three model runs the time evolutions of v m a x and e k i n are highly similar in the three model runs using the csc gtc and gptc fig 10 shows distributions of vertical currents along channel currents and cross channel currents at the east west transect of y 216 km at model day 150 after the model initialization in four different runs zlc csc gtc and gptc in run zlc strong bottom intensified currents occur fig 10a c especially over the steep slope which are in a general agreement with the analytical solution mizuta and hogg 2004 the main problem using the z level coordinate run zlc fig 10a is highly fluctuated vertical currents associated with the step wise grids particularly over the region of x 800 km the maximum vertical current is about 1 01 10 2 m s 1 at x 920 km the model results in run zlc differ significantly however from the analytical solution of which the currents should flow smoothly along the continuously varying slope and climb upward the cross channel currents in run zlc also have large fluctuations near the bottom grids due to large model errors with the maximum northward current of about 0 33 m s 1 in examining the model problem of simulating the gulf stream separation using different types of vertical grids ezer 2016 also found that step like topography in the zlc model has problems in resolving properly bottom boundary layer and topographic waves the 3d currents produced by the circulation model in run csc fig 10d f are in good agreement with the analytical solution mizuta and hogg 2004 with the maximum vertical current is about 3 6 10 3 m s 1 at the steepest position of the slope the along channel and cross channel velocities in run csc are vertically uniform this indicates that the conventional sigma coordinate defined in eq 1 is an ideal coordinate for simulating 3d currents in the continuously varying slope experiment fig 10g i demonstrates that the 3d currents produced by the circulation model in run gtc are highly similar to the currents in run csc except for some weak fluctuated currents at the connection points of constant depth levels and sigma levels by comparison the vertical currents in run gptc fig 10j have relatively larger fluctuations than the counterparts in run gtc but the model results in run gptc are better than the results in run zlc the maximum vertical current is about 3 5 10 3 m s 1 in both runs gtc and gptc which is smaller than the counterpart in run zlc to further assess the performance of different vertical coordinates in simulating circulation in the bottom boundary layer we calculate the vertical currents at the bottom at the steepest point based on the slip boundary condition defined as 19 w u h x the maximum along channel current u is about 0 4 m s 1 and the bottom slope is h x 0 96 at the bottom at the eastern open boundary of the model domain the estimated vertical current at this point can be calculated according to eq 19 which is about 3 84 10 3 m s 1 runs csc gtc and gptc produce the largest vertical currents in the bottom layer with the maximum vertical current of 3 6 10 3 m s 1 at the steepest point fig 10d g and j which is in a good agreement with the estimated maximum value of the true solution with the model error of 0 24 10 3 m s 1 by comparison the model error in the maximum vertical currents using the z level coordinate run zlc is almost one order of magnitude larger than the errors in runs gtc and gptc 3 3 yellow and east china seas the 3d circulation model with four different vertical coordinates zlc csc gtc and gptc is also applied to the yellow and east china seas yecs and adjacent waters fig 11 including the bohai sea bhs yellow sea ys east china sea ecs and part of the northwestern pacific ocean nwpo the average water depths are about 18 m 44 m and 349 m respectively for the bhs ys and ecs the steep continental slope over the outer ecs links the continental shelf with the deep okinawa trough of which the maximum water depth is greater than 2000 m the yangtze river is the largest river in china which has the annual mean discharge of about 3 01 1 0 4 m 3 s 1 with significant seasonal and synoptic variability chang and isobe 2003 the yangtze river is the 5th largest river in the world based on the annual mean discharges the large freshwater discharge from the yangtze river affects significantly the 3d circulation and hydrography in the ecs and ys chang and isobe 2003 kako et al 2016 the general circulation and hydrography in the ecs and ys were studied in the past based on observations yu et al 2006 lie and cho 2016 and numerical results hirose et al 1999 wang et al 2014 yu et al 2006 previous studies demonstrated that the ys basin is occupied by cold waters lower than 10 c below the strong thermocline in summer xia et al 2006 which is known as the yellow sea bottom cold water ysbcw strong upwelling and temperature fronts can occur around the ysbcw lu et al 2010 kuroshio is an intense western boundary current which enters the ecs through the east taiwan channel and flows into the nwpo through the tokara strait yang et al 2011 the kuroshio significantly influences the water and heat exchanges of the ecs li et al 2013 therefore it is important for a regional ocean model to reproduce the main characteristics of the kuroshio and the circulation and hydrography over the cs 3 3 1 circulation model setup and observations the 3d ocean circulation model appendix is applied to the ys ecs and adjacent waters with a horizontal resolution of 1 12 1 12 the model domain covers the region of 117 e 135 e and 19 n 41 n the smagorinsky 1962 horizontal mixing scheme with a coefficient of 0 1 is used for the horizontal viscosity and diffusivity coefficients a m and a h the modified my 2 5 turbulence closure scheme galperin et al 1988 mellor and yamada 1982 is used for the vertical viscosity and diffusivity coefficients k m and k h the circulation model is driven by a suite of external forcing including the atmospheric forcing tides freshwater discharge and lateral open boundary conditions the atmospheric forcing includes the 6 hourly wind fields taken from the dataset produced by the japan meteorological agency jma using the global spectral model gsm the bulk formula of kondo 1975 is used to convert the wind speed to wind stress the net heat flux at the sea surface is calculated in the circulation model using the shortwave radiation long wave radiation sensible and latent heat fluxes all these components are calculated using the empirical formulas of hirose et al 1999 the bulk coefficients for sensible and latent heat fluxes are the values modified by hirose et al 1999 the meteorological conditions used to compute the surface heat fluxes based on the bulk method in the circulation model were obtained from the daily mean gsm dataset okamoto et al 2008 the net freshwater flux at the sea surface is calculated based on precipitation and evaporation the precipitation data were also obtained from the daily mean gsm dataset the amount of the freshwater discharge of the yangtze river is specified based on the monthly mean data published in the chinese river sediment bulletin no relaxations are used for the sea surface temperature sst and sea surface salinity sss tidal forces are specified at model open boundaries using the radiation conditions for the depth averaged currents and tidal elevations davies and flather 1987 four major tidal constituents m2 s2 k1 o1 are used in this study the non tidal components of the open boundary conditions are taken from the monthly mean reanalysis of the 1 2 1 2 sea surface height currents temperature and salinity produced by using a 3d circulation model using a simple ocean data assimilation carton et al 2018 four model runs were conducted using four different vertical coordinates csc zlc gtc and gptc the parameters in constructing the gtc and gptc are the same as in the seamount experiment the circulation model in each run is integrated for three years from 1 january 2014 to 31 december 2016 utc the results of the last two years are used for the analyses in this paper the in situ observations of temperature salinity and currents extracted from datasets constructed by the korea oceanographic data center kodc national marine data center nmdc and jma are used in this study to assess the performance of the circulation model using four different vertical coordinates the observation stations of kodc and jma are marked by black and pink dots respectively in fig 11 model results at two standard transects pn and tn shown in fig 11 are compared with observations transect pn is a transect cross the kuroshio used by the nagasaki marine observatory of the jma for conducting in situ hydrographic and current observations since 1972 the daily satellite remote sensing sea surface temperature sst derived from the advanced very high resolution radiometers avhrr reynolds et al 2007 are also used to examine the performances of different vertical coordinates in simulating ssts over the study region 3 3 2 evaluation of different vertical coordinates fig 12a presents the monthly mean sst in august 2015 calculated from the satellite observations the august mean sst in 2015 was about 29 c over the southeastern region of the model domain and gradually decreased towards the northwestern region several cold water patches occurred in the ys lu et al 2010 the sst was about 22 c in korea bay and about 25 c over coastal waters of the southwestern ys sharp temperature gradients occurred between the warmer ecs and the cooler ys in august 2015 fig 12a fig 12b e present the differences of the august mean ssts produced by the circulation model in four different runs csc zlc gtc and gptc from the monthly mean satellite sst observations the sst differences are used to represent the model errors in simulating sst over the study region the sst differences are within 1 0 c over most parts of the model domain in four runs however large sst differences occur over the coastal waters among four runs the sst differences in korea bay and coastal waters of the southwestern ys are relatively large and up to 3 5 c in runs csc and gtc fig 12b and d and relatively small in runs zlc and gptc fig 12c and e the observed and simulated sst values have correlation coefficients of about 0 81 0 86 0 83 and 0 90 for the csc zlc gtc and gptc respectively the root mean squared differences rmsd are about 0 71 0 63 0 67 and 0 54 c for the csc zlc gtc and gptc we next examine the model performances with different vertical coordinates in simulating the ysbcw fig 13a presents the august mean temperature at 50 m in 2015 interpolated from the kodc observations the observations demonstrate that in august 2015 the central region of the ys at 50 m was occupied by the waters lower than 10 0 c with a sharp temperature front nearly in the north southern direction fig 13a the subsurface 50 m temperature was about 8 c over the western part and increased to about 20 c over the southeastern part of the observation area fig 13b e present the monthly mean subsurface temperature at 50 m in august 2015 produced by the circulation model in runs csc zlc gtc and gptc the circulation model in the four runs generate highly similar subsurface waters of colder than 8 c at 50 m significant differences occur however in the positions and areas of the cold waters among these four runs both runs csc and zlc have the cold waters off the eastern side of the shandong peninsula while run gtc has one additional cold core located off the eastern side of southern ys by comparison run gptc has the largest pear like cold waters in the central region of the ys which is in a good agreement with previous studies yu et al 2006 fig 14a presents the temperature distribution along transect pn based on the nmdc observations on 16 january 2015 the observed temperature was nearly uniform and relatively warm of about 20 22 c in the upper mixed layer and strongly stratified with the vertical decrease of temperature from 20 to 6 c in the middle water column along the transect the observed temperature was uniform and about 6 c in the bottom layer below 800 m fig 14a also shows a warm temperature core about 22 c in the upper mixed layer near the shelf break of the ecs of which the maximum depth was about 125 m the observed temperature along the transect had large along transect gradients associated with particularly in the middle water column indicating intense baroclinic dynamics associated with the kuroshio over this area yang et al 2011 it should be noted that the observed temperature shown in fig 14a represents the typical distribution of temperature in the winter months over the area with transect pn the observed temperature on 5 july 2016 fig 14f was warm and about 29 c in the top 30 m which are different from the observed temperature shown in fig 14a this indicates that the observed temperature in the upper water column had strong seasonal variability over the area the warm temperature core in the surface layer rose to about 30 c and its center moved slightly southeastward on 5 july 2016 in comparison with the observed temperature on 16 january 2015 the observed temperature on 5 july 2016 fig 14f had large vertical and horizontal stratifications associated with the kuroshio and relatively uniform in the bottom layer which are similar to the observations on 16 january 2015 fig 14a vertical distributions of daily mean temperature along transect pn produced by the circulation model using four different vertical coordinates runs csc zlc gtc and gptc are shown in fig 14b e for 16 january 2015 and in fig 14g j for 5 july 2016 the circulation model in the four different runs reproduces reasonably well the general features of vertical distributions and associated seasonal variability of observed temperatures along transect pn significant differences occur however among the four model runs the widths of the surface warm core associated with the kuroshio in runs csc and gtc are twice of the observations the upward climbing of the bottom cold waters along the steep slope is also overestimated in runs csc and gtc in comparison with the observations the simulated temperature in the subsurface layer in run zlc is in a general agreement with the observations however the surface warm temperature core in run zlc splits into two parts furthermore the circulation model using the zlc cannot reproduce the observed temperature salinity near the sea bottom among the four runs the simulated temperature in run gptc agrees best with the observations along transect pn with the observed surface warm water and bottom cold waters well resolved in both seasons to quantify the model performance in simulating the bottom cold water the 10 c contour lines of simulated temperatures in four runs are compared to the observations on both 16 january 2015 and 5 july 2016 fig 14a and f the 10 c contour lines produced by the model in runs csc and gtc climb up to 270 m over the shelf break of the ecs which are 105 m shallower than that in observations the 10 c contour lines in runs zlc and gptc show similar position and tilt angle with the observations in both two observation days the observed and simulated temperatures along transect pn have correlation coefficients of about 0 96 0 97 0 97 0 98 on utc 16 january 2015 and 0 98 0 99 0 99 0 99 for on utc 5 july 2016 respectively for runs csc zlc gtc and gptc the rmsd are about 1 59 1 21 1 49 1 16 c on utc 16 january 2015 and 1 46 1 00 1 09 0 91 c on utc 5 july 2016 respectively for runs csc zlc gtc and gptc table 3 vertical distributions of observed salinity along transect pn are shown in fig 15a and f based on observations on 16 january 2015 and 5 july 2016 respectively the observed salinity along the transect had significant seasonal variability in the top 200 m and relatively weak seasonal variability below 200 m in the deep water region off the shelf break of the ecs along the transect the observed salinity on 16 january 2015 was almost vertically uniform and about 34 9 psu in the top 180 m fig 15a subsurface low salinity water lower than 34 3 psu was centered around 600 m in the deep water region of the transect which slanted upward from the okinawa trough to the continental slope of the ecs on the shelf water region of the ecs along the transect the observed salinity on 16 january 2015 was vertically uniform in the upper layer of shallower than 40 m and weakly stratified in the bottom boundary layer the observed salinity on 5 july 2016 had seaward spreading of low salinity waters in the surface layer and shoreward intrusion of relatively high salinity waters into the shelf water region in the subsurface layer fig 15f a subsurface high salinity core centered at about 150 m below the sea surface is located in the deep water region off the shelf break of the ecs subsurface low salinity waters lower than 34 3 were centered around 600 m in the deep water region of the transect on 5 july 2016 fig 15f which is similar to the observations on 16 january 2015 fig 15a vertical distributions of daily mean salinity along transect pn produced by the circulation model in four different runs csc zlc gtc and gptc are also shown in fig 15 the model results in four different runs reproduce the general vertical distributions of observed salinities between 100 m and 400 m along the transect considerable differences occur however in the daily mean salinities among the four model runs particularly in the top 100 m and below 400 m on 16 january 2015 the simulated salinities over the shelf region of the transect in runs csc zlc and gtc fig 15b d are too low in comparison with the observations on 5 july 2016 the simulated subsurface high salinity cores in the deep waters of the transect in runs csc and zlc are smaller than the observations furthermore run csc has relatively large model deficiencies in maintaining the structure of the subsurface low salinity waters the simulated salinity in run gptc is in a very good agreement with the salinity observations in comparison with model results in other three runs csc zlc and gtc particularly in the top 600 m as discussed in section 2 model results using the conventional terrain following vertical coordinate suffer from the errors from the sum of two large terms and diapycnal mixing by comparison the zlc is not sensitive to this problem as shown in fig 15c and h run zlc does not have the low salinity waters in the bottom layer and reproduces reasonably well the structure of the sub surface low salinity waters centered at about 500 m the observed and simulated salinities along transect pn have correlation coefficients of about 0 41 0 58 0 47 0 85 on 16 january 2015 and 0 81 0 86 0 81 0 84 on 5 july 2016 respectively for runs csc zlc gtc and gptc the rmsd are about 0 30 0 23 0 29 0 11 psu on 16 january 2015 and 0 56 0 49 0 31 0 29 psu on 5 july 2016 respectively for runs csc zlc gtc and gptc table 3 the values of the statistical error metrices indicate that the circulation model using the gptc performs the best in simulating temperature and salinity along transect pn among the four different vertical coordinates fig 16a and f present distributions of observed currents normal to transect pn i e along slope flow based the jma current observations respectively on 16 january 2015 and on 5 july 2016 on these two days the observed along slope flow known as the kuroshio was strong and positive northeastward over the upper part of the slope at water depths of 300 600 m the maximum northeastward speeds of the observed kuroshio were about 1 2 m s 1 on 16 january 2015 fig 16a and about 1 4 m s 1 on 5 july 2016 fig 16f the main features of the observed kuroshio shown in fig 16a and f are consistent with previous studies ichikawa and beardsley 2002 liu and gan 2012 a weak and southwestward flow known as the slope counter current ichikawa and beardsley 2002 was observed in the bottom boundary layer over the lower part of the slope fig 16a f the slope counter current is a belt like southwestward bottom current which spread from water depths of 450 m to 850 m in the lower part of the slope on 16 january 2015 fig 16a and became a weak and narrow bottom current centered at water depths of about 800 m on 5 july 2016 fig 16f to the south of the kuroshio the current observations on these two days also had a southwestward flow of which the maximum southwestward speed of about 0 2 m s 1 on 16 january 2015 fig 16a and about 0 4 m s 1 on 5 july 2016 fig 16f the daily mean along slope currents at transect pn produced by the circulation model in four different runs are shown in fig 16b e for 16 january 2015 and fig 16g j for 5 july 2016 the circulation model using four different vertical coordinates csc zlc gtc and gptc reproduces the general features of the observed along slope currents on the two observation days large differences occur among the four runs run zlc overpredicts the strength of the kuroshio with the simulated maximum speeds to be about 0 2 m s 1 faster fig 16c and h than observations on both 16 january 2015 and 5 july 2016 the width of the observed kuroshio along transect pn at the sea surface was about 22 km on 16 january 2015 and about 28 km on 5 july 2016 by comparison the widths of the kuroshio in runs csc zlc gtc and gptc are about 25 3 30 8 25 3 1 3 km wider on 16 january 2015 and about 38 5 25 3 25 3 18 7 km wider on 5 july 2016 than the observations in comparison with in situ observations and model results in other three runs run zlc does not generate the slope counter current and overestimates the southwestward flow to the east of the kuroshio the shapes of the slope counter current in run csc fig 16b and g are similar and in a general agreement with observations on the two observation days run gtc reproduces the observed maximum speeds and spatial features of the currents along transect pn although the circulation model using gptc performs well in reproducing the spatial features of the kuroshio along transect pn the maximum speed of the kuroshio in run gptc is weaker up to 0 2 m s 1 than observations in both two observation days furthermore the simulated currents in run gptc have noticeable deficiency between the real topography and lowermost steplike grids the observed and simulated along slope currents at transect pn have correlation coefficients of about 0 90 0 92 0 90 0 90 on 16 january 2015 and 0 89 0 90 0 86 0 94 on 5 july 2016 respectively for runs csc zlc gtc and gptc the rmsd are about 0 18 0 22 0 17 0 16 m s 1 on 16 january 2015 and 0 21 0 24 0 21 0 13 m s 1 on 5 july 2016 respectively for runs csc zlc gtc and gptc table 3 this indicates that run gtc performs best among the four runs in simulating the style of normal current along transect pn in comparison with the current observations to examine the model errors in computing the bpg we calculate differences in the bpg values in runs csc gtc and gptc from the counterparts in run zlc along transect tn marked in fig 11 by considering the bpg values in run zlc as the ground truth the bpg differences shown in fig 17 can be considered as the model errors in the bpg the maximum bpg errors along transect tn are about 4 5 10 6 n kg 1 2 9 10 6 n kg 1 and 0 9 10 6 n kg 1 respectively in runs csc gtc and gptc fig 17 it indicates that the model errors in the bpg are smallest in run gptc in comparison with the model errors in runs csc and gtc finally we compare the 3d monthly mean currents produced by the circulation model using four different vertical coordinates the monthly mean surface currents in august 2015 produced by the circulation model have very similar large scale features in runs csc gtc and gptc fig 18 the monthly mean surface circulation in august 2015 in runs csc gtc and gptc features the kuroshio taiwan strait throughflow tst and tsushima warm current twc which is consistent with previous studies guo et al 2003 isobe 2008 lie and cho 2016 the kuroshio up to 1 6 m s 1 flows northeastward along the 200 m isobath over the continental slope of the ecs turns southeastward at about 30 n to flow through the tokara strait and then skirts the east coast of kyushu the tst up to 0 6 m s 1 flows northeastward into the ecs from the taiwan strait and bifurcates into two branches with one branch known as the taiwan warm current tawc flowing northward and another branch merging to the kuroshio the basin scale anticlockwise circulation in the ys consists of the yellow sea coastal current yscc and the korean coastal current kcc significant differences occur in the monthly mean surface currents between run zlc and other three runs fig 18b shows that run zlc has a strong eddy off southeastern taiwan island before the kuroshio flowing into the ecs which may be associated with the step like z level vertical grids using in the model the strength of the kuroshio in run zlc is also stronger than the counterparts in other three runs particularly over the tokara strait and adjacent waters fig 19 presents the monthly mean sub surface 200 m currents on 200 m in august 2015 in runs csc zlc gtc and gptc the monthly mean sub surface circulation has very similar structures in runs csc gtc and gptc which features the sub surface kuroshio up to 1 3 m s 1 flowing northeastward along the continental slope of the ecs large differences also occur in the sub surface currents between run zlc and other three runs run zlc has a strong eddy off southeastern taiwan island before the kuroshio flowing into the ecs at 200 m which differs from the counterparts in other three runs another obvious difference is that the curvature of the large meander of the kuroshio at the southern of kyushu in run zlc is relatively larger than other three runs 4 summary and conclusions two types of generalized vertical coordinates were developed to eliminate large model errors in calculating the baroclinic pressure gradient bpg the advection term and horizontal diffusion for temperature and salinity in a terrain following ocean circulation model these two new coordinate systems are defined as the generalized terrain following coordinate gtc and generalized piecewise terrain following coordinate gptc the gtc is generated by substituting the sigma levels in the interior of a conventional sigma coordinate csc with a series of constant depth levels the gptc is constructed by dividing the model domain into two parts in the vertical direction the upper part covering the shallow coastal waters and highly stratified waters and the lower part including the continental slopes and deep basins in the gptc the upper part uses the gtc and the lower part uses the piecewise terrain following coordinate the depth differences between two adjacent grids are reduced by using the gptc especially in the bottom layer over steep topography the main reason for introducing the gptc is to reduce large model errors in computing advection terms and horizontal diffusion in the temperature and salinity equations using the conventional sigma layers near the bottom over steep topography where the conventional sigma layers cross the isotherms or isohalines performances of the gtc and gptc were assessed first in two types of idealized numerical experiments with a tall seamount and continuously varying bottom slope respectively the model results from the diagnostic seamount experiment show that the use of the gtc reduces the model errors in the bpg vertical and horizontal currents these model errors however still occur in the sigma layers near the bottom over the steep topography if the gtc is used as the vertical coordinate the gptc reduces these model errors of the csc by one order of magnitude the model results from the prognostic seamount experiment show that the gtc and gptc greatly alleviate the spurious diapycnal mixing in csc models especially for calculating horizontal diffusion the circulation model in the continuously varying slope experiment using the z level coordinate zlc overestimates the bottom intensified currents which indicates that the advantage of terrain following coordinates over the zlc in simulating the 3d currents the performances of the gtc and gptc were further assessed by examining prognostic simulations of 3d currents and hydrography over the yecs and adjacent waters with realistic external forcing and bottom topography the model results using the gtc and gptc were also compared to the counterparts using the csc and zlc the temperature salinity and currents produced by these experiments were examined by comparing to the in situ and remote sensing observations taken from the nmdc jma kodc and avhrr it was found that the gptc performs better in reproducing observed hydrography than the csc zlc and gtc the gptc significantly reduces the overestimated upward climbing of the bottom cold water along the steep slope which is a common problem in the terrain following coordinate models furthermore the gptc reproduces the shoreward intrusion of relatively high salinity subsurface water and seaward spreading of intermediate low salinity waters better than other three coordinates the gptc eliminates the low salinity waters in the bottom layer different from temperature and salinity simulations the observed currents were better simulated by the model using the gtc than the other three coordinates csc zlc and gptc the gtc reproduces the observed maximum speeds and spatial features of the kuroshio the slope counter current and their seasonal variability along transect pn better than other three coordinates although the circulation model using gptc performs best in reproducing the 3d field of temperature and salinity among the four coordinates the model results in case gptc have noticeable deficiency between the real topography and lowermost steplike grids furthermore it is an inherent problem that the steplike vertical grids are non differentiable and can lead to overestimated currents as suggested in the previous studies beckmann and döscher 1997 pacanowski and gnanadesikan 1998 ezer 2016 a bottom boundary layer model suggested by beckmann and döscher 1997 can be coupled to the gptc or zlc model to get realistic simulations of near bottom tracers and the corresponding circulation by taking the performances of four vertical coordinates in simulating both the hydrography and currents into consideration the gptc is recommended to be used in the general ocean circulation model it should be noted that both the gtc and gptc proposed in this study reduce significantly the model errors in the bpg and spurious diapycnal mixing but do not completely eliminate them in the ocean circulation model using the terrain following coordinate furthermore the performances of the four vertical coordinates were accessed in this study using the pomgcs mellor et al 2002 with the second order accurate centered difference numerical scheme it was shown that a 4th order numerical scheme for the bpg berntsen and oey 2010 and a rotated mixing operator for the accurate calculation of isopycnal diffusion becker et al 2000 lemarié et al 2012 are very useful to further reduce model errors in the ocean circulation model using the gtc and gptc credit authorship contribution statement zhanyuan he conceptualization methodology software validation writing original draft writing review editing shouxian zhu conceptualization methodology writing review editing funding acquisition jinyu sheng methodology validation writing review editing funding acquisition bin wang software writing review editing declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments we thank the national science and technology infrastructure national marine data center for providing data shouxian zhu was supported by the national natural science foundation of china nsfc grants 41076048 41376012 41206163 and the fundamental research funds for the central universities grant 2011b05714 jinyu sheng was also supported by the natural sciences and engineering research council of canada nserc grant 217081 and ocean frontier institute ofi zhanyuan he was also supported by the china scholarship council to study at dalhousie university the authors wish to thank two anonymous reviewers and the editor for their useful and constructive comments appendix governing equations in generalized vertical coordinates system the governing equations for the ocean circulation model used in this study are based on the general vertical coordinate system used in the princeton ocean model mellor et al 2002 considering a cartesian coordinate system with the x axis to be eastward y axis to be northward and z axis to be upward the vertical position z x y k t for level k is written as a 1 z x y k t η x y t s x y k t where η x y t is the sea surface elevation and s x y k t specifies the type of a vertical coordinate for the z level coordinate i e a quasi z level coordinate we have a 2 s x y k t σ 0 k h m a x η x y t where h m a x is the maximum value of the static water depth defined as h x y and σ 0 k is a series values between 1 and 0 for the conventional sigma level coordinate csc we have a 3 s x y k t σ a k h x y η x y t in which each vertical level has a constant sigma value σ σ a k for the generalized terrain following coordinate gtc we have a 4 s x y k t σ b x y k h x y η x y t with σ b 0 at surface and σ b 1 at bottom as the csc however may have nonconstant sigma value on one vertical level in the interior of the model domain the vertical velocity in the generalized vertical coordinate system is given as a 5 ω s k d k d t s k d k d t the relation between ω and the vertical velocity in the z level coordinate w is given as a 6 ω w s x η x u s y η y v s t η t where u and v are the velocities in the x and y directions the governing equations of currents u v temperature t and salinity s in the generalized vertical coordinate are given as mellor et al 2002 a 7 s k t u s k x v s k y ω k 0 a 8 u s k t u 2 s k x u v s k y u ω k f v s k g s k η x g s k ρ 0 k 0 s k ρ x s x η x ρ k d k k μ m s k u k s k t x x x s k t x y y v s k t u v s k x v 2 s k y v ω k f u s k a 9 g s k η y g s k ρ 0 k 0 s k ρ y s y η y ρ k d k k μ m s k v k s k t x y x s k t y y y a 10 t s k t t u s k x t v s k y t ω k k μ h s k t k s k q t x s k q t y r k a 11 s s k t s u s k x s v s k y s ω k k μ h s k s k s k q s x s k q s y where t x x a m 2 u x t y y a m 2 v y t x y a m u y v x q t x a h t x q t y a h t y q s x a h s x q s y a h s y here a m and a h are the horizontal viscosity and diffusivity coefficients μ m and μ h are the vertical viscosity and diffusivity coefficients respectively the baroclinic pressure gradient bpg in eqs a 8 and a 9 are given as a 12 b x g ρ 0 k 0 s k ρ x s x η x ρ k d k b y g ρ 0 k 0 s k ρ y s y η y ρ k d k the area averaged density ρ m e a n has been subtracted from the density ρ before calculation 
23838,we study attenuation of free waves in the homogeneous ocean using the cauchy riemann relations and then energy equation we derive a novel equation that relates temporal and spatial decay to the energy dissipation in the fluid in particular for spatially damped waves we find that the attenuation coefficient is inversely proportional to the group velocity we discuss the consequences of this for continental shelf waves where the group velocity may tend to zero in wave number space and hence the spatial attenuation coefficient may become infinitely large we show that generally for a travelling wave solution the spatial damping will remain unchanged in a frame of reference moving with the group velocity revealing the different physics behind temporal wave damping and spatial wave damping keywords temporal and spatial damping group velocity surface gravity waves continental shelf waves 1 introduction in an elegant note on hydrodynamic stability gaster 1962 compares temporally growing disturbances and spatially growing disturbances having the same wave number he shows that for small amplification rates the frequencies are equal to a high order of approximation and that the temporal growth is equal to the spatial growth times the group velocity of the unstable wave the same results apply to small decay rates i e the temporal decay is equal to the spatial decay times the group velocity of the damped wave although gaster s pioneering note only contains three references the study of spatio temporal wavy disturbances in hydrodynamic stability has a long history see for example the extensive account in schmid and henningson 2001 in his derivation gaster 1962 refers to instability governed by the orr sommerfeld equation however his result is not restricted to disturbances in shear flow it is equally valid in fluids originally at rest where the wavy perturbation attenuates due to friction one such phenomenon is ocean waves subject to viscous dissipation which is the topic studied here along the line of gaster we apply the cauchy riemann relations and extend the analysis to periodic ocean waves where the amplitude decays slowly in space and time this yields a novel relation between temporal damping spatial damping and the dissipation in the wave motion this note is organized as follows in section 2 we apply the cauchy riemann relations and the energy equation to derive the general result relating the temporal and spatial damping to the energy dissipation furthermore we display an explicit form of this relation for surface gravity waves with viscosity when the ocean depth is finite in section 3 we consider frictionally damped continental shelf waves and in section 4 we discuss briefly the case when the group velocity may tend to zero as may happen in continental shelf waves finally section 5 contains some concluding remarks including a discussion of the different physical nature of temporal wave damping and spatial wave damping 2 general theory in the ocean freely propagating waves suffer attenuation due to friction for two dimensional motion in an incompressible fluid with waves propagating along the x axis we introduce a stream function ψ such that 1 ψ ψ 0 exp i κ x n t where 2 κ k i α 3 n ω i β here k ω are the real wave number and angular frequency respectively while α β are the real and small spatial and temporal damping rates due to friction the dispersion relation for the wave problem can be written in general terms as 4 n g κ t where t is a constant that may depend on parameters like topography the earth s rotation etc we assume that n is an analytic function of κ then from the cauchy riemann relations we have using the notation 2 3 that 5 ω k β α 6 ω α β k here ω k c g is the group velocity in the inviscid case the dispersion relation is ω g k t in our problem the attenuation rates α and β are assumed to be small and 5 implies that o α o β if c g 0 and finite 1 1 actually for continental shelf waves we may have c g 0 for a certain value of k we discuss this interesting problem in section 4 furthermore from 6 we find 7 ω g k t o α 2 k t we then obtain from 5 that 8 β c g α q where q is a small quantity that does not depend on α and c g is the group velocity to the lowest approximation actually q is determined by the energy dissipation in the system which is seen as follows let e be the energy density of a monochromatic wave subjected to temporal and spatial decay the equation for the energy balance of the fluctuating wave motion in the absence of mean currents is phillips 1977 9 e t c g e x ɛ here c g e is the advection of mean wave energy by the group velocity and ɛ is the rate of energy dissipation per unit area due to friction in the fluid since e exp 2 α x 2 β t we obtain from 9 that 10 β c g α ɛ 2 e hence in 8 11 q ɛ 2 e as postulated above from 8 we note that if α 0 temporal attenuation then β q if β 0 spatial attenuation then α q c g accordingly when comparing the two different cases we have β c g α as shown by gaster 1962 specific examples of 10 may be found in the literature see for example jenkins 1986 for surface gravity waves in an infinitely deep viscous ocean in the case of finite depth h we find from weber 2019 eq 34 when we neglect the atmospheric stress at the ocean surface 12 β c g α ω k γ 1 2 sinh 2 k h k γ where 13 c g ω 2 k 1 2 k h sinh 2 k h and 14 γ ω 1 2 2 ν 1 2 here ν is the small eddy viscosity the quantity γ 1 represents the viscous boundary layer thickness the analysis assumes that k γ 1 the first term in the parenthesis on the right hand side of 12 arises from the viscous boundary layer at the free surface while the second term is due to a no slip condition at the ocean bottom in the limit h 12 was first derived by jenkins 1986 we note that for spatial damping in a fluid with dissipation q 0 β 0 we obtain from 8 that 15 α q c g for gravity waves this result poses no problems since c g is non zero and finite on the other hand for a wave type like continental shelf waves buchwald and adams 1968 we have the possibility that c g 0 for a certain wave number k then from 15 it follows that α we discuss this intriguing problem in section 4 before that we derive the complex dispersion relation for continental shelf waves subject to linear bottom friction this is done to display the explicit form of 10 for this case 3 continental shelf waves continental shelf waves are fundamentally different from gravity waves in these waves the motion is basically governed by the conservation of potential vorticity longuet higgins 1965 since the classic papers of buchwald and adams 1968 and gill and schumann 1974 work on continental shelf waves have been steadily increasing some updated references can be found in drivdal et al 2016 we here idealize the shelf geometry as in buchwald and adams 1968 and place the horizontal axes at the ocean surface with the x axis along the coast and the y axis towards the sea the bottom profile is given by z h y where 16 h h 0 exp 2 b y 0 y b h 0 exp 2 b b y b here b is a constant describing the steepness of the shelf slope and b is the shelf width we assume that b 2 a 0 2 1 where a 0 is the barotropic rossby radius defined by mid depth this means that we can make the rigid lid approximation gill and schumann 1974 the continuity equation then allows for the introduction of a stream function ψ such that u h ψ y and v h ψ x where u and v are the horizontal velocity components we take that the waves are so long that the pressure is hydrostatic in the vertical direction the effect of bottom friction on the barotropic wave field is discussed at some length in weber and drivdal 2012 a robust formulation is obtained by taking the bottom stress to vary linearly with the horizontal fluxes the mathematical derivation is standard and we give some details for didactic reasons the linearized momentum equations for this problem can be written 17 2 ψ t y f ψ x g h η x r ψ y 18 2 ψ t x f ψ y g h η y r ψ x here η is the surface elevation f is the constant coriolis parameter and r is a small bottom friction coefficient we take that the coast is impermeable hence 19 ψ 0 y 0 at the edge of the shelf y b we must generally have continuity of pressure here surface elevation and normal fluxes utilizing that the deep ocean has a flat bottom it easy to show that the continuity conditions imply for the stream function over the shelf that weber and drivdal 2012 20 ψ y κ ψ 0 y b where κ is the complex wave number in the direction along the coast it is convenient to write ψ as gill 1982 21 ψ h 1 2 ϕ y exp i κ x n t introducing 21 into 17 18 and utilizing 16 we find by performing the curl that 22 ϕ l 2 ϕ 0 where the prime denotes derivation with respect to y furthermore the cross shelf wave number is given 23 l 2 2 f b κ n i r b 2 κ 2 in terms of ϕ in 21 the boundary conditions become 24 ϕ 0 y 0 25 ϕ b κ ϕ 0 y b using 24 the solution of 22 is 26 ϕ c sin l y where the constant c is arbitrary inserting from 26 we then find from 25 that 27 b κ sin b l l cos b l 0 the spatial and temporal damping coefficients in 2 and 3 are small quantities of o r in this problem in weber and drivdal 2012 it was assumed that the cross shelf wave number l in 23 was real this actually corresponds to placing an impermeable wall at y b more generally it is seen from 23 that l also contains a small imaginary part we can then write 28 l l i δ where the imaginary part δ is of o r the presence of damping will also modify the frequency the modification will be of o r 2 to be verified later see also 7 3 1 the dispersion relation the complex equations 23 and 27 arising from the governing equation for the wave motion and the boundary condition respectively form an eigen value problem that determine the dispersion properties for these waves from 23 the real part to lowest order yields the well known dispersion relation 29 ω 2 f b k b 2 l 2 k 2 where l is determined from the boundary condition 27 as shown below the imaginary part of 23 becomes to o r 30 δ b 2 l 2 k 2 β r c b 2 l 2 k 2 α 2 ω l where c ω k is the lowest order wave speed it is then easily seen from the real part of 23 that the second order correction to ω is of o r 2 as anticipated from the real part of 27 we find to lowest order that 31 tan l b l b k as shown by buchwald and adams 1968 for given bottom topography this transcendental equation yields infinitely many discrete values of l transverse eigen modes for each k in general n 1 2 π l n b n π n 1 2 3 buchwald and adams 1968 finally from the imaginary part of 27 we obtain for the spatial damping rate to o r 32 α b k b k 2 b l 2 b δ l we remark that 32 is a linear relation between α and δ while 30 relates α β and δ by eliminating δ between 30 and 32 we finally arrive at 33 β c b 2 l 2 k 2 b 2 l 2 k 2 2 k l 2 b k b k 2 b l 2 b α r from weber and drivdal 2012 their eq a 12 we can write the group velocity c g for continental shelf waves when the bottom topography is given by 16 as 34 c g c b 2 l 2 k 2 2 k l 2 b k b k 2 b l 2 b b 2 l 2 k 2 comparing 33 and 34 we see right away that 35 β c g α r as we expect from 10 we note that q ɛ 2 e r in this case 4 spatial damping an intriguing aspect of the wave damping problem was mentioned in section 2 in many cases of practical interest it is natural to consider spatial damping an example here is the operation of a wave maker at a given frequency at one end of a wave tank in experimental studies for continental shelf waves we have from 34 that c g 0 for certain wave numbers k then from 15 it follows that α obviously our calculations assuming a small damping rate is not valid here but this singular behaviour indicates that wave energy accumulates in the region where c g is close to zero such energy accumulation appears to occur on the narrow steep continental slope north west of norway for continental shelf waves with the diurnal tidal frequency k 1 at this frequency the local group velocity is close to zero see the dispersion diagrams in fig 1 at three different locations outside vesterålen north norway weber and børve 2022 the intersection between the dashed and full lines in fig 1 shows that continental shelf waves can be generated by the action of the diurnal tidal k 1 component outside vesterålen in a wave number region centred around zero group velocity a study of this problem when c g 0 is found in weber and børve 2021 2022 where the interested reader also may find references to similar studies of tidally forced continental shelf waves in the two cited papers the wave damping is not due to bottom friction but is caused by the energy loss in the exchange of water between the shelf and the inner island archipelago through a permeable coastline this confirms that the damping relation 10 is general and not dependent on how we specifically model energy loss in the problem 5 concluding remarks inserting from 8 we may write the stream function 1 as 36 ψ ψ 0 exp α x c g t q t exp i k x ω t we thus see that for a travelling wave solution the spatial damping will remain unchanged in a frame of reference moving with the group velocity the different physical nature of temporal and spatial damping should be noted whatever value of the group velocity the temporal attenuation of the wave field remains small thus temporal damping is related to the kinematics of the waves if we have wave motion at a fixed location in space the temporal damping is just the measured decrease of wave amplitude at that location the spatial attenuation on the other hand is related to the wave energetics as we have seen the spatial attenuation increases without bounds as the group velocity approaches zero in this case the wave energy will accumulate in the region of wave generation declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgement the author gratefully acknowledgessupport from the research council of norway through grant 280625 
23838,we study attenuation of free waves in the homogeneous ocean using the cauchy riemann relations and then energy equation we derive a novel equation that relates temporal and spatial decay to the energy dissipation in the fluid in particular for spatially damped waves we find that the attenuation coefficient is inversely proportional to the group velocity we discuss the consequences of this for continental shelf waves where the group velocity may tend to zero in wave number space and hence the spatial attenuation coefficient may become infinitely large we show that generally for a travelling wave solution the spatial damping will remain unchanged in a frame of reference moving with the group velocity revealing the different physics behind temporal wave damping and spatial wave damping keywords temporal and spatial damping group velocity surface gravity waves continental shelf waves 1 introduction in an elegant note on hydrodynamic stability gaster 1962 compares temporally growing disturbances and spatially growing disturbances having the same wave number he shows that for small amplification rates the frequencies are equal to a high order of approximation and that the temporal growth is equal to the spatial growth times the group velocity of the unstable wave the same results apply to small decay rates i e the temporal decay is equal to the spatial decay times the group velocity of the damped wave although gaster s pioneering note only contains three references the study of spatio temporal wavy disturbances in hydrodynamic stability has a long history see for example the extensive account in schmid and henningson 2001 in his derivation gaster 1962 refers to instability governed by the orr sommerfeld equation however his result is not restricted to disturbances in shear flow it is equally valid in fluids originally at rest where the wavy perturbation attenuates due to friction one such phenomenon is ocean waves subject to viscous dissipation which is the topic studied here along the line of gaster we apply the cauchy riemann relations and extend the analysis to periodic ocean waves where the amplitude decays slowly in space and time this yields a novel relation between temporal damping spatial damping and the dissipation in the wave motion this note is organized as follows in section 2 we apply the cauchy riemann relations and the energy equation to derive the general result relating the temporal and spatial damping to the energy dissipation furthermore we display an explicit form of this relation for surface gravity waves with viscosity when the ocean depth is finite in section 3 we consider frictionally damped continental shelf waves and in section 4 we discuss briefly the case when the group velocity may tend to zero as may happen in continental shelf waves finally section 5 contains some concluding remarks including a discussion of the different physical nature of temporal wave damping and spatial wave damping 2 general theory in the ocean freely propagating waves suffer attenuation due to friction for two dimensional motion in an incompressible fluid with waves propagating along the x axis we introduce a stream function ψ such that 1 ψ ψ 0 exp i κ x n t where 2 κ k i α 3 n ω i β here k ω are the real wave number and angular frequency respectively while α β are the real and small spatial and temporal damping rates due to friction the dispersion relation for the wave problem can be written in general terms as 4 n g κ t where t is a constant that may depend on parameters like topography the earth s rotation etc we assume that n is an analytic function of κ then from the cauchy riemann relations we have using the notation 2 3 that 5 ω k β α 6 ω α β k here ω k c g is the group velocity in the inviscid case the dispersion relation is ω g k t in our problem the attenuation rates α and β are assumed to be small and 5 implies that o α o β if c g 0 and finite 1 1 actually for continental shelf waves we may have c g 0 for a certain value of k we discuss this interesting problem in section 4 furthermore from 6 we find 7 ω g k t o α 2 k t we then obtain from 5 that 8 β c g α q where q is a small quantity that does not depend on α and c g is the group velocity to the lowest approximation actually q is determined by the energy dissipation in the system which is seen as follows let e be the energy density of a monochromatic wave subjected to temporal and spatial decay the equation for the energy balance of the fluctuating wave motion in the absence of mean currents is phillips 1977 9 e t c g e x ɛ here c g e is the advection of mean wave energy by the group velocity and ɛ is the rate of energy dissipation per unit area due to friction in the fluid since e exp 2 α x 2 β t we obtain from 9 that 10 β c g α ɛ 2 e hence in 8 11 q ɛ 2 e as postulated above from 8 we note that if α 0 temporal attenuation then β q if β 0 spatial attenuation then α q c g accordingly when comparing the two different cases we have β c g α as shown by gaster 1962 specific examples of 10 may be found in the literature see for example jenkins 1986 for surface gravity waves in an infinitely deep viscous ocean in the case of finite depth h we find from weber 2019 eq 34 when we neglect the atmospheric stress at the ocean surface 12 β c g α ω k γ 1 2 sinh 2 k h k γ where 13 c g ω 2 k 1 2 k h sinh 2 k h and 14 γ ω 1 2 2 ν 1 2 here ν is the small eddy viscosity the quantity γ 1 represents the viscous boundary layer thickness the analysis assumes that k γ 1 the first term in the parenthesis on the right hand side of 12 arises from the viscous boundary layer at the free surface while the second term is due to a no slip condition at the ocean bottom in the limit h 12 was first derived by jenkins 1986 we note that for spatial damping in a fluid with dissipation q 0 β 0 we obtain from 8 that 15 α q c g for gravity waves this result poses no problems since c g is non zero and finite on the other hand for a wave type like continental shelf waves buchwald and adams 1968 we have the possibility that c g 0 for a certain wave number k then from 15 it follows that α we discuss this intriguing problem in section 4 before that we derive the complex dispersion relation for continental shelf waves subject to linear bottom friction this is done to display the explicit form of 10 for this case 3 continental shelf waves continental shelf waves are fundamentally different from gravity waves in these waves the motion is basically governed by the conservation of potential vorticity longuet higgins 1965 since the classic papers of buchwald and adams 1968 and gill and schumann 1974 work on continental shelf waves have been steadily increasing some updated references can be found in drivdal et al 2016 we here idealize the shelf geometry as in buchwald and adams 1968 and place the horizontal axes at the ocean surface with the x axis along the coast and the y axis towards the sea the bottom profile is given by z h y where 16 h h 0 exp 2 b y 0 y b h 0 exp 2 b b y b here b is a constant describing the steepness of the shelf slope and b is the shelf width we assume that b 2 a 0 2 1 where a 0 is the barotropic rossby radius defined by mid depth this means that we can make the rigid lid approximation gill and schumann 1974 the continuity equation then allows for the introduction of a stream function ψ such that u h ψ y and v h ψ x where u and v are the horizontal velocity components we take that the waves are so long that the pressure is hydrostatic in the vertical direction the effect of bottom friction on the barotropic wave field is discussed at some length in weber and drivdal 2012 a robust formulation is obtained by taking the bottom stress to vary linearly with the horizontal fluxes the mathematical derivation is standard and we give some details for didactic reasons the linearized momentum equations for this problem can be written 17 2 ψ t y f ψ x g h η x r ψ y 18 2 ψ t x f ψ y g h η y r ψ x here η is the surface elevation f is the constant coriolis parameter and r is a small bottom friction coefficient we take that the coast is impermeable hence 19 ψ 0 y 0 at the edge of the shelf y b we must generally have continuity of pressure here surface elevation and normal fluxes utilizing that the deep ocean has a flat bottom it easy to show that the continuity conditions imply for the stream function over the shelf that weber and drivdal 2012 20 ψ y κ ψ 0 y b where κ is the complex wave number in the direction along the coast it is convenient to write ψ as gill 1982 21 ψ h 1 2 ϕ y exp i κ x n t introducing 21 into 17 18 and utilizing 16 we find by performing the curl that 22 ϕ l 2 ϕ 0 where the prime denotes derivation with respect to y furthermore the cross shelf wave number is given 23 l 2 2 f b κ n i r b 2 κ 2 in terms of ϕ in 21 the boundary conditions become 24 ϕ 0 y 0 25 ϕ b κ ϕ 0 y b using 24 the solution of 22 is 26 ϕ c sin l y where the constant c is arbitrary inserting from 26 we then find from 25 that 27 b κ sin b l l cos b l 0 the spatial and temporal damping coefficients in 2 and 3 are small quantities of o r in this problem in weber and drivdal 2012 it was assumed that the cross shelf wave number l in 23 was real this actually corresponds to placing an impermeable wall at y b more generally it is seen from 23 that l also contains a small imaginary part we can then write 28 l l i δ where the imaginary part δ is of o r the presence of damping will also modify the frequency the modification will be of o r 2 to be verified later see also 7 3 1 the dispersion relation the complex equations 23 and 27 arising from the governing equation for the wave motion and the boundary condition respectively form an eigen value problem that determine the dispersion properties for these waves from 23 the real part to lowest order yields the well known dispersion relation 29 ω 2 f b k b 2 l 2 k 2 where l is determined from the boundary condition 27 as shown below the imaginary part of 23 becomes to o r 30 δ b 2 l 2 k 2 β r c b 2 l 2 k 2 α 2 ω l where c ω k is the lowest order wave speed it is then easily seen from the real part of 23 that the second order correction to ω is of o r 2 as anticipated from the real part of 27 we find to lowest order that 31 tan l b l b k as shown by buchwald and adams 1968 for given bottom topography this transcendental equation yields infinitely many discrete values of l transverse eigen modes for each k in general n 1 2 π l n b n π n 1 2 3 buchwald and adams 1968 finally from the imaginary part of 27 we obtain for the spatial damping rate to o r 32 α b k b k 2 b l 2 b δ l we remark that 32 is a linear relation between α and δ while 30 relates α β and δ by eliminating δ between 30 and 32 we finally arrive at 33 β c b 2 l 2 k 2 b 2 l 2 k 2 2 k l 2 b k b k 2 b l 2 b α r from weber and drivdal 2012 their eq a 12 we can write the group velocity c g for continental shelf waves when the bottom topography is given by 16 as 34 c g c b 2 l 2 k 2 2 k l 2 b k b k 2 b l 2 b b 2 l 2 k 2 comparing 33 and 34 we see right away that 35 β c g α r as we expect from 10 we note that q ɛ 2 e r in this case 4 spatial damping an intriguing aspect of the wave damping problem was mentioned in section 2 in many cases of practical interest it is natural to consider spatial damping an example here is the operation of a wave maker at a given frequency at one end of a wave tank in experimental studies for continental shelf waves we have from 34 that c g 0 for certain wave numbers k then from 15 it follows that α obviously our calculations assuming a small damping rate is not valid here but this singular behaviour indicates that wave energy accumulates in the region where c g is close to zero such energy accumulation appears to occur on the narrow steep continental slope north west of norway for continental shelf waves with the diurnal tidal frequency k 1 at this frequency the local group velocity is close to zero see the dispersion diagrams in fig 1 at three different locations outside vesterålen north norway weber and børve 2022 the intersection between the dashed and full lines in fig 1 shows that continental shelf waves can be generated by the action of the diurnal tidal k 1 component outside vesterålen in a wave number region centred around zero group velocity a study of this problem when c g 0 is found in weber and børve 2021 2022 where the interested reader also may find references to similar studies of tidally forced continental shelf waves in the two cited papers the wave damping is not due to bottom friction but is caused by the energy loss in the exchange of water between the shelf and the inner island archipelago through a permeable coastline this confirms that the damping relation 10 is general and not dependent on how we specifically model energy loss in the problem 5 concluding remarks inserting from 8 we may write the stream function 1 as 36 ψ ψ 0 exp α x c g t q t exp i k x ω t we thus see that for a travelling wave solution the spatial damping will remain unchanged in a frame of reference moving with the group velocity the different physical nature of temporal and spatial damping should be noted whatever value of the group velocity the temporal attenuation of the wave field remains small thus temporal damping is related to the kinematics of the waves if we have wave motion at a fixed location in space the temporal damping is just the measured decrease of wave amplitude at that location the spatial attenuation on the other hand is related to the wave energetics as we have seen the spatial attenuation increases without bounds as the group velocity approaches zero in this case the wave energy will accumulate in the region of wave generation declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgement the author gratefully acknowledgessupport from the research council of norway through grant 280625 
23839,accurate modelling of tsunami waves requires complete boundary and initial data coupled with the appropriate mathematical model however necessary data is often missing or inaccurate and may not have sufficient resolution to capture the dynamics of such nonlinear waves accurately we demonstrate that variational data assimilation for the continuous shallow water equations swe is a feasible approach for recovering initial conditions we showed that the necessary conditions for reconstructing one dimensional initial conditions in kevlahan et al 2019 can be extended to the maximum euclidean distance between pairwise observations to two dimensions we use sadourny finite difference finite volume simulations to verify convergence to the true initial conditions can be achieved for observations arranged in multiple configurations for both isotropic and anisotropic initial conditions and with realistic bathymetry data in two dimensions we compare observations arranged in straight lines in a grid and along concentric circles and assess the optimal number and configuration of observation points such that convergence to the true initial conditions is achieved these idealised results with simplified two dimensional geometry are a first step towards more physically realistic settings recent advances in altimetry observation data now permit much denser measurements of sea surface height than is possible with a fixed buoy network this provides the opportunity to use the method developed here for more accurate tsunami forecasts in realistic settings keywords shallow water equations observations characteristics grid arc 1 introduction the 2004 indian ocean tsunami and the 2011 japanese tsunami have highlighted the need for more effective forecasting models that can be used to create and implement evacuation and emergency protocols effectively in a limited amount of time however existing methods are challenged by the limitations of the necessary sets of data nakamura et al 2006 consequently information on the initial conditions of tsunamis is likely to be incomplete or inaccurate tsunamis are series of waves caused by large scale disturbances in the ocean such as seismic activity in this study we focus on tsunami propagation in the deep ocean and not on the interaction of tsunami waves with the coast where the dispersive boussinesq equation may be a better model they are characterised by very long wavelengths relative to the ocean depth sometimes hundreds of kilometres categorising them as shallow water waves however the perturbation of the free surface in the deep ocean can be less than a metre rendering it virtually imperceptible away from the shore the wave speed c is directly proportional to the square root of the water depth and with an average deep ocean depth of 4000 m tsunamis can travel faster than 700 km h and are capable of generating atmospheric gravity waves that can travel into the upper atmosphere in this study we formulate a variational data assimilation scheme for the two dimensional shallow water equations swe where observations of sea surface height are used to reconstruct missing initial conditions data the two dimensional swe system includes an additional conservation of momentum equation in the horizontal y direction the state vector is subsequently η u v t and the full system is given in 2 1f for the one dimensional swe considered in kevlahan et al 2019 the wavefront is simply a moving point on one side therefore in one dimension the only degrees of freedom in observation placement are their spacing and their number however in the two dimensional extension considered here the wavefront is a one dimensional curve and the observations can be placed along curves or in various two dimensional arrays additional features that increase the complexity of the this case include nonlinear characteristic curves of the hyperbolic partial differential equation and the wave focusing effects of two dimensional bathymetry features our goal is to investigate if the minimum spacing requirement in kevlahan et al 2019 can be extended to two dimensions we are particularly interested in exploring the effects of greater choice in observation placement and the richer nonlinear wave front geometry allowed by the two dimensional problem in practice zou et al 1992 have demonstrated that the discretised two dimensional swe are observable even with measurements of only one of the three variables η u v however existing data assimilation methods have been applied mostly for tsunami forecasts in north america and japan where relatively large observation networks exist wang et al 2019 primary sources of observations include the deep ocean assessment and reporting of tsunamis dart buoy system consisting of a bottom pressure recorder residing on the ocean floor which transmits data to a surface buoy the data is then relayed to shore via noaa s geostationary operational environmental satellite goes gonzalez et al 1998 the large investment required for such apparatus limits the feasibility of a dense network and currently the global network consists of approximately 60 systems spread over the entire pacific ocean and located mostly near coastlines at depths of 1 6 km other observations used for tsunami detection and reporting include ocean bottom seismometer obs pressure gauges however these are sparsely distributed in the indian ocean wang et al 2019 angove et al 2019 state that one of the major limitations to accurate tsunami forecasts is their inability to quickly measure and represent the tsunami source the placement and number of dart tsunameters and ocean bottom seismometers obs is currently not extensive enough to simultaneously provide i early warning of impending tsunamis and ii enough observational data to for data assimilation methods to accurately reconstruct the displacement at the source and subsequently predict wave height and velocity at coastlines therefore our objective with this work is to outline a theoretical data assimilation framework that could make use of satellite altimetry data where considerable progress has been made in data availability and precision existing data assimilation schemes are able to utilise multiple sources and techniques for assimilating off shore observations maeda et al 2015 assimilated real time data from an ocean bottom network of tsunameters to simulate the wave field directly in real time instead of approximating initial conditions and thus mitigating the uncertainties of modelling the seismic source wang et al 2019 used interpolation of observed waveforms to create virtual observational data and demonstrated the success of the assimilation scheme when applied to forecasting simulations of the 2004 indian ocean tsunami kalman filtering techniques have also been used extensively for both parameter estimation and initial condition reconstruction in ocean models mayo et al 2014 use variants of an ensemble kalman filter enkf where error statistics of the model are represented by an ensemble of forecasted model states to estimate bottom stress terms in the advanced circulation adcirc coastal model using observations of sea surface elevations they demonstrate accurate estimation of friction parameters in lagoons and estuaries and highlight the influence of the bottom surface roughness motivating the need for high resolution bathymetry ghorbanidehno et al 2019 also use kalman filtering to estimate near shore bathymetry using a novel compressed state kalman filter to recover both constant and temporally evolving bathymetry profiles and demonstrate superior accuracy compared to ensemble based methods with comparable computational costs statistical data assimilation has also been used in tsunami modelling efforts yang et al 2019 use optimal interpolation oi a variant of the enkf to reconstruct real time tsunami wave fields using measurements of pressure changes on the ocean floor however accurate prediction in real time using kalman filtering techniques can be challenging as forecast accuracy depends on the choice of initial error covariance matrices and often the error statistics for true state variables are not available nor easily estimated additionally the ability to resolve details of covariance structure is proportional to the ensemble size and larger ensembles may be too computationally expensive for predictions in real time nevertheless comparison between kalman filtering and variational data assimilation given a perfect model and same observations and domain determined that performance was equivalent for both fletcher 2017 lorenc 1986 in this study we implement a variational data assimilation scheme using optimal control theory to minimise the error between the state variables and observations the novelty of our variational approach is that we consider the infinite dimensional case unlike previous works on 4d var for the swe like zou et al 1992 and maeda et al 2015 and kalman filtering techniques consequently our data assimilation algorithm is independent of the discretisation used in its numerical implementation our model for tsunami wave propagation is based on the two dimensional non dispersive swe however tsunami waves can also be modelled using the boussinesq water wave approximation while both shallow water and boussinesq approximations are widely used for analysing solitary wave propagation studies such as dongfang et al 2013 have compared the two processes finding that in certain run up processes the two approximations are identical and that boussinesq approximation is most often used to model near shore hydrodynamic behaviour however our analysis addresses the optimal configuration of deep ocean observations required to accurately reconstruct initial conditions and bathymetry and the necessary and or sufficient conditions for convergence before coastal dynamics are observed therefore we do not take near shore behaviour into account in our analysis additionally we neglect coriolis effects bottom friction and kinematic viscosity this idealised configuration with simplified two dimensional geometry is intended to be a first step for more complex analyses for this reason we also assume there are no errors in measurements we aim to validate the basic approach by demonstrating the feasibility of variational data assimilation for tsunami wave prediction and investigate fundamental questions for the idealised case first before considering more physically realistic settings the purpose of the current study is not to determine optimal placement of observations or to develop new assimilation techniques based on observability criteria instead we extend our one dimensional initial condition variational assimilation technique kevlahan et al 2019 from one dimension to two dimensions and analyse results from a variety of numerical experiments assessing its performance and flexibility the problem of finding an optimal observation configuration has been considered in king et al 2015 they derive a measure of how well information about the system state can be inferred using observation sensors and provide an approximation for a partial observability index their findings suggest that optimised observations reduced the root mean square error rmse by approximately 20 compared to equally spaced observations similarly kang and xu 2014 also introduce a gradient projection method for maximising partial observability however king et al 2015 provide results showing the efficacy of their observability index for the one dimensional shallow water equations and optimal observations are arranged in a straight line with variable spacing comparisons are given with equidistant points and the extension to higher dimensions is not discussed kang and xu 2014 also only provide results for the one dimensional burger s equation we note that the core contribution of these works is the mathematical approximation of partial observability framing it as an eigenvalue optimisation problem whereas our goal is not to develop an algorithm to determine optimal placement of observations but to extend the one dimensional algorithm derived in kevlahan et al 2019 to two dimensions and verify its performance in a situation where there is much more freedom in observation placement in kevlahan et al 2019 we have proven sufficient conditions for optimal reconstruction of the true initial conditions using sparse observations for the one dimensional swe our objective was to determine the optimal number and locations of wave height measurements such that the optimally reconstructed initial conditions obtained via data assimilation converged to the true form in order to extend the analysis to more realistic dynamics in tsunami models here we implement an analogous scheme on the two dimensional swe system and investigate whether the key results of our previous study extend to the more complex case with full dimensionality due to the sparsity of observations in tsunami models our aim for the two dimensional case is to find the minimum information in the form of observations of surface wave height such as their configuration number and spacing between adjacent points required for convergence to the true initial conditions this focus also differentiates the current work from existing literature on data assimilation for the two dimensional swe like zou et al 1992 as they do not analyse the choice of the observation configuration and focus instead on the minimum number of observational fields additionally while they derive a variational scheme for the discrete two dimensional swe system a novelty of our approach is that we consider the infinite dimensional case unlike previous works on 4d var our purpose is to extend the one dimensional data assimilation scheme derived in kevlahan et al 2019 to two dimensional subsequently we investigate whether the conditions for convergence observed for the one dimensional case also hold for the more complex two dimensional system we recall that for the one dimensional assimilation optimal convergence to the true initial conditions occurs when at least one pair of observation points are spaced more closely than half the effective minimum wavelength of the energy spectrum of the initial conditions in the one dimensional case we were able to exploit the fact that the linear one dimensional swe system can be formulated as the one dimensional wave equation and subsequently we used its analytic properties to derive an exact solution for the adjoint system solved in the variational scheme this solution was used to prove sufficient conditions for convergence to the true initial conditions however this method fails to extend to the two dimensional case as the analytical solution to the adjoint system is not easily found existing works such as iacono 2005 on analytical solutions of the two dimensional swe involve drastic simplifications of the equilibrium problem such simplifications would not help us adequately investigate the minimum observation information required for tsunami models with high dimensionality therefore our approach is focused on a qualitative investigation of the applicability of results from the one dimensional analysis for the two dimensional data assimilation and on a comparison of different observation spacings configurations and numbers we begin in section 2 by extending the data assimilation to two dimensional and implement this algorithm numerically in section 3 the results and complementary analyses are divided into the following three topics 1 section 4 assess the optimal number and configuration of observation points such that convergence to the true initial conditions is achieved in the data assimilation for the two dimensional swe 2 section 4 1 investigate whether the sufficient conditions for convergence in kevlahan et al 2019 for the one dimensional case extends to the two dimensional data assimilation 3 section 5 implement the data assimilation algorithm for a relatively realistic tsunami forecasting model using non flat bathymetry our final analysis uses realistic bathymetry data from the etopo2 global topographical relief database and the optimal observation configurations identified in this study we conclude with a summary of the main results and future considerations in section 6 2 derivation the two dimensional shallow water equations swe are 2 1a η t x η h β u y η h β v 0 2 1b u t u u x v u y η x 0 2 1c v t u v x v v y η y 0 2 1d η x y 0 ϕ x y 2 1e u x y 0 0 2 1f v x y 0 0 where h is the average depth of the fluid and the system has been normalised such that g h 1 η and β are the perturbation of the free surface and sea floor respectively and u and v are the velocities in the x and y direction we assume the initial conditions ϕ l 2 ω is compactly supported on the spatial domain ω x y x l l y l l and is periodic at the boundaries the notation used in the data assimilation algorithm is summarised in table 1 let us define m j o t to be observations of the surface wave at positions x y j for j 1 n o b s at continuous times t our objective is to minimise the least squares error between the observations m j o t and the forecast solution of the wave height η f x y t given some initial conditions ϕ we express this as a cost functional j l 2 ω r constrained by the system 2 1f 2 2 j ϕ 1 2 0 t i 1 m η f x j y j t ϕ m j o t 2 d t then the optimal initial conditions ϕ b is the minimiser defined as 2 3 ϕ b argmin ϕ l 2 ω j ϕ since the minimum of 2 2 is achieved when 2 4 l 2 j ϕ b 0 we formulate a dual adjoint system in terms of some appropriately chosen adjoint variables such that l 2 j ϕ b can be derived more efficiently than direct computation of the gradient of 2 2 given ϕ the first variation of j given some arbitrary perturbation ϕ of scale ɛ is given by the gateaux derivative 2 5 j ϕ ϕ lim ɛ 0 j ϕ ɛ η j ϕ ɛ expanding the perturbation to o ɛ we can reformulate 2 5 as 2 6 j ϕ ϕ 0 t η f x j y j t ϕ m o t η d t where η u v are the solutions of the perturbed system given the perturbation in the initial conditions ϕ found by linearising about η u v and extracting the o ɛ system as the gateaux derivative is a directional derivative in the direction of the perturbation ϕ we can express 2 6 as the inner product between j and ϕ 2 7 j ϕ ϕ j ϕ l 2 ω ω l 2 j η d ω then the following forms of j β β are equivalent 2 8 j ϕ ϕ 0 t η f x j y j t β m o t η d t ω l 2 j ϕ d ω if we form a lagrangian of our linearised shallow water system with some arbitrary adjoint variables η u v 2 9 0 t ω η x y t η x x u η h η β u y v η h η β v u x t u t u u x v u y η x v x t v t u v x v v y η y d ω d t 0 we observe that by formulating the following system in terms of the adjoint variables η u v 2 10a η t u η x v η y u x v y m x i y i t h η x y t β 2 10b u t u u x v u y h η β η x 0 2 10c v t u v x v v y h η β η y 0 2 10d η x y t 0 2 10e u x y t 0 2 10f v x y t 0 and integrating 2 9 by parts in space and time due to the periodicity of the boundary conditions the lagrangian 2 9 is reduced to 2 11 0 t ω η f x j y j t ϕ m o t η d ω d t ω η η t 0 d ω combining this result with the equivalence given by 2 8 we have 2 12 ω η η t 0 d ω ω η t 0 ϕ d ω ω l 2 j ϕ d ω and thus since our functional is linear and bounded and belongs to the space of square integrable functions we can use the riesz representation theorem for the equivalence of inner products to extract l 2 j giving us 2 13 l 2 j ϕ η x y 0 for a detailed derivation we refer the reader to kevlahan et al 2019 we utilise an iterative steepest descent algorithm to find our minimiser ϕ b yielding l 2 j 0 given some starting guess ϕ g we also used a polak ribière conjugate gradient descent method and found results to be equivalent to steepest descent the steps of the process at each iteration are summarised in algorithm 1 3 numerical implementation our spatial domain is ω l l l l where l 3 the assimilation is carried out in the time interval 0 t where the final time t 2 is selected such that there are no boundary effects for the spatial discretisation we implement a second order finite difference finite volume sadourny energy conserving scheme on a c grid the sadourny scheme ensures that this discretisation inherits the conservation properties such as energy or enstrophy conservation of the original system sadourny 1975 if the swe are expressed in the following equivalent form 3 3 η t x η h β u y η h β v 0 3 4 u t v x u y v x g η 1 2 u 2 1 2 v 2 0 3 5 v t v x u y v y g η 1 2 u 2 1 2 v 2 0 then the discretisation 3 6 u t 1 δ x δ i g η 1 2 u 2 1 2 v 2 v x u y 1 η β j v i j 3 7 v t 1 δ y δ i g η 1 2 u 2 1 2 v 2 v x u y 1 η β i u j i where 3 8 δ i f f i 1 2 f i 1 2 3 9 f i 1 2 f i 1 2 f i 1 2 ensures that the total energy is conserved such that 3 10 0 i j δ x δ y g η η t 1 2 u 2 1 2 v 2 t 1 η β i j δ x δ y 1 η β u u t i j δ y δ x 1 η β v v t where the staggered centre difference operator 3 8 and centre linear interpolation operator 3 9 ensure that the velocities u and v and their time derivatives are discretised at the centre of the cell boundaries and η and β and their derivatives are located at cell centres the spatial derivations are discretised using a second order finite difference scheme with periodic boundary conditions the system is then integrated using a four stage third order runge kutta scheme spiteri and ruuth 2002 the resolution is 128 128 due to computational cost considerations as the memory requirements for the solver are quite high the time step δ t δ x 3 is chosen to satisfy the courant friedrichs lewy cfl condition and subsequently the solutions for η u v are 128 128 193 matrices which need to be stored for all time steps the line minimisation for is carried out using the matlab function fminunc we consider the following isotropic gaussian initial conditions where the gaussian has the same variance and physical properties in every direction 3 11 ϕ t x y 1 20 exp x 2 y 2 0 1 2 for cases where anisotropic initial conditions are used the variance of the gaussian in the x and y directions is different and the gaussian has been rotated by π 4 radians 3 12 ϕ t x y 1 20 exp x r 2 y r 5 2 0 1 5 2 3 13 x r x cos π 4 y sin π 4 3 14 y r x cos π 4 y sin π 4 fig 1 shows the isotropic and anisotropic initial conditions in the results we indicate an approximation of this support spatial domain where the initial condition is non zero to highlight the position of the observation points relative to the initial conditions while gaussian initial conditions are not technically compactly supported they are in practise for numerical simulations for example when the exponential is smaller than machine precision the results in section 4 are for assimilation with flat bathymetry β x y 0 as in kevlahan et al 2019 however in section 5 we implement the data assimilation algorithm with i a gaussian form bathymetry and ii realistic bathymetry data taken from the etopo2 database for global topography and bathymetry 3 1 verification test to verify our numerical implementation we conduct a test using the equivalent forms for j ϕ ϕ used in our derivation the gateaux derivative and the riesz gradient if the implementation is correct the parameter κ should converge to 1 as ɛ 0 3 15 κ ɛ lim ɛ 0 1 ɛ j ϕ ɛ ϕ j ϕ ω η x y 0 ϕ d ω the results of the verification test are shown in fig 2 with a non zero bathymetry 4 numerical results the analysis for the two dimensional data assimilation is more complex than the one dimensional case due to the more complex geometry of nonlinear wavefronts propagating in two dimensions and the increased geometric complexity in the placement of the observation points with this in mind in this section we explore the effect of configuration and number of observations on the overall convergence of the reconstructed initial conditions we classify a result as convergent if the relative l 2 error is lower than 10 based on convergence observed in kevlahan et al 2019 noting that all results where the minimum distance criteria 4 1 was not met had a relative convergence error higher than 10 in the 1 d case in kevlahan et al 2019 all observation points were located to one side of the initial condition support in the present analysis we consider observations in all quadrants of our spatial domain where the initial conditions is centred at 0 0 we note that in most cases our initial conditions are isotropic and the subsequent wave propagation is radially symmetric given a flat bathymetry this azimuthal symmetry property cannot be observed by observation points along characteristics in a single quadrant alone this suggests that to capture the isotropic nature of the initial conditions it may be beneficial to place observations along an arc of the circle x 2 y 2 r t 2 where r t is the radial position of the propagating wave η x y t at each time t 0 t we qualitatively investigate this claim by analysing results for three observation configurations i in a square grid centred at 0 0 ii along the characteristics x y and x y and iii on circular arcs along x 2 y 2 r i 2 for i 1 2 in section 4 1 we extend the analysis for observation spacing from the one dimensional case as in kevlahan et al 2019 for each configuration for all cases we assume the initial guess ϕ g 0 in section 4 2 we build on the optimal results for observation spacing and investigate whether convergence improves when increasing the number of observation points in reality it is unlikely there will be many observations within the support of the initial conditions of a tsunami therefore we also investigate the effect of removing all observation points located within the support of both isotropic and anisotropic initial conditions on convergence 4 1 observation spacing in order to investigate the effect of observation spacing for the two dimensional initial conditions assimilation we use the results of kevlahan et al 2019 as a benchmark we recall that for the one dimensional assimilation optimal convergence to the true initial conditions ϕ t occurs when at least one pair of observation points are spaced more closely than half the effective minimum wavelength of the energy spectrum of the initial conditions subsequently given a pair of observation points m 1 m 2 we require 4 1 m 1 m 2 π k m a x where k m a x is the largest effective wavenumber of ϕ t in the absence of a rigorous equivalent result for the two dimensional assimilation we qualitatively investigate whether convergence improves when 4 1 is satisfied for the two dimensional wavenumbers k and l to find k m a x and l m a x we examined the energy spectrum of the true isotropic two dimensional initial conditions we observed that the modes for k l 40 have relatively negligible magnitudes and thus k m a x l m a x 40 is a good approximation thus the distance between at least two observation points should be less than 0 0785 in the one dimensional case at least one pair of points was required to satisfy 4 1 however it may be that a greater number of points satisfying this condition is correlated with improved convergence in the two dimensional case due to the need to resolve the two dimensional shape of the initial conditions e g azimuthal symmetry to investigate this we compare results with different spacing of observations δ x δ y δ r for the arc configurations in a grid along characteristics x y and in radial arcs centred on the initial conditions we also investigate convergence with different numbers of pairwise observations with a euclidean distance fulfilling 4 1 we begin with observations along characteristic lines x y 4 1 1 observations along characteristic x y for this case we initially choose n o b s 36 this initial choice of n o b s is larger than those considered in kevlahan et al 2019 where n o b s 5 was considered however given the higher dimensionality of the two dimensional problem we scale up our initial choice of n o b s we evaluate results for the δ x δ y 0 07 0 0785 0 1 and 0 2 these values were chosen to include cases both when 4 1 is satisfied and when it is violated since observations are placed along x y the euclidean distance between points is δ x 2 δ y 2 comparing pairwise distances between any two observation points in the configuration we observe that at least 8 out of a total of 36 36 1 pairwise observations have a euclidean distance less than 0 0785 for δ x 0 07 0 0785 and 0 1 there are zero pairs satisfying 4 1 for δ x 0 2 the characteristic configurations can be seen in fig 3 a b c and d the red circle represents the boundary of the initial condition it is an approximate representation intended for reference only and the actual region where ϕ t 0 may be slightly larger and corresponds to fig 1 the configurations in 3 a 3 b and 3 c satisfy 4 1 and those in 3 d do not we wish to determine whether convergence is worse where spacing is larger than 0 0785 the convergence results for both cases are given in 3 e the relative l 2 error in the reconstruction after 1000 iterations we observe that the assimilation converges for the three cases with δ x 0 1 as 0 0785 is just an estimate of the minimum spacing it is not surprising that the slightly larger 0 1 case also converges there is no significant difference between the three cases and the error is reduced to o 1 0 3 however the configuration with δ x 0 2 fails to converge these results confirm condition 4 1 and therefore are consistent with the minimum spacing theorem in kevlahan et al 2019 as δ x 0 2 was the only case where there were no pairs of observations with a euclidean distance less than 0 0785 to analyse the smoothness of the convergence we considered the relative l 2 error for an extended range of δ x and observed that the error with spacing of observations such that 0 1 δ x 0 2 still converged despite having a higher error compared to δ x 0 1 and no configuration with δ x 0 2 achieved convergence of the l 2 error less than 10 we observe that the placement along characteristics in all four quadrants appears to sufficiently capture the radial symmetry of the propagating wave and reconstruct the initial conditions accurately we verify whether these results by considering observations placed in a grid and along concentric circles centred at the initial conditions 4 1 2 observations in a grid formation the second configuration of observation points we consider is a grid layout in the x y plane to maintain comparison with the characteristic configuration we initially choose n o b s 6 2 and observations are arranged in a six by six square grid centred at 0 0 these configurations are presented in fig 4 a b c and d with the same values of δ x as for the characteristic case the trend in the relative error decrease over 1000 iterations are presented in fig 4 e we can see that like the characteristic configuration the results for observations in a grid configuration show increasing convergence to zero as the spacing between adjacent observation points in the x and y directions decrease even the worst performing configuration 4 d has a relative error at the final iteration of o 1 0 2 this suggests that given the convergence criteria of a relative l 2 error lower than 10 each spacing considered in fig 4 convergences though it is clear the lower values δ x 0 07 and δ x 0 0785 perform better by an order of magnitude once again we note that these configurations both had 64 pairwise observations satisfying 4 1 whereas the ones with δ x 0 1 and δ x 0 2 had none confirming the hypothesis that 4 1 is a sufficient condition for convergence with a grid configuration for the two dimensional case while convergence with δ x 0 07 is marginally better for the grid configuration than the characteristic configuration they are both o 1 0 3 and we may consider them equivalent in performance thus far we note that these results are also consistent with the one dimensional theorem in kevlahan et al 2019 it should be noted however that in fig 4 most of the observations are placed within the support of the initial conditions this is a consequence of having a grid centred at the initial conditions support with only n o b s 36 and small spacing δ x and δ y between adjacent observations consequently in section 4 2 we investigate the effect of increasing the number of observation points and subsequently in section 4 3 the effect of removing all points that lie in the initial conditions support 4 1 3 observations along arcs current observations used for detection and forecasting of tsunamis such as dart buoys are usually arrayed in an arc like formation along coastlines gonzalez et al 1998 therefore we consider a circular arc configuration for observations as shown in fig 5 a d the observation points are placed along two concentric circles x 2 y 2 r i 2 for i 1 2 we vary the spacing δ r r 1 r 2 such that figs 5 a and 5 b satisfy 4 1 and figs 5 c and 5 d do not similar to the characteristic and grid configurations we observe in fig 5 e that the error does not converge for any of the values of δ r considered and is o 1 0 1 this is despite the fact that there are 14 pairwise observations satisfying 4 1 for δ r 0 07 and 8 pairs for δ r 0 0785 we present the reconstructed initial conditions for each δ r in fig 5 f i we observe that in each case the gaussian peak is not fully resolved and the amplitude is smaller than the exact initial conditions 0 05 additionally in each case there is small scale noise in the reconstruction in theory observations placed in concentric circles around the true initial conditions should be able to capture the radial propagation of the free surface wave in all directions however these results suggest that either small spacing between pairwise observations is not sufficient for convergence with an arc configuration or that a larger number of pairwise observations satisfying 4 1 is necessary in the following section we investigate the minimum number of observations necessary for convergence and assess whether convergence improves as we increase the number of observations in each of the three configurations 4 2 results with large or small number of observations in this section observe the convergence of the assimilation when the number of observation points is either large or small for the characteristic grid and arc configurations respectively the spacing δ x and δ r is fixed at the best performing case considered in section 4 1 δ x 0 07 or δ x 0 0785 we first show convergence for large n o b s and then subsequently investigate the minimum number of observations required for convergence for the grid and arc configurations we initially consider results for n o b s 1 0 2 1 2 2 1 4 2 respectively with δ x δ r 0 07 for the characteristic configuration we chose n o b s 60 80 100 and δ x 0 0785 the comparatively smaller values for the characteristic configuration are due to the fact that we required all observation points to interact with the propagating wave in the assimilation time t and this would not have been possible for larger values of n o b s placed along characteristics the results for the error convergence given a characteristic configuration of the observations are presented in fig 6 a we observe that the relative reconstruction error does not change significantly with the number of observation points and is o 1 0 3 we note that the same level of convergence was achieved with only 36 observations as seen in fig 3 e this is encouraging from a tsunami modelling perspective as it would suggest that a smaller observation network placed along characteristics is sufficient to recreate the initial conditions effectively the error convergence results for observations placed in a grid format with varying number of observation points are given in fig 6 b as with the characteristic configuration we observe that the convergence of the l 2 relative error does not significantly change for the large values of n o b s and is o 1 0 3 to determine whether having a large number of observations is a sufficient condition for convergence we consider results where n o b s 1 2 2 but δ x 0 44 we see from fig 6 e that the assimilation does not converge and therefore large n o b s is not a sufficient condition for convergence to verify whether it is a necessary condition for convergence we explore results when n o b s is small in section 4 2 1 we observed in fig 5 that unlike the characteristic or grid configurations the results for the arc configuration failed to converge for all spacings δ r consequently it would be of significant interest to see whether these results can be improved by increasing n o b s we present the configurations for n o b s 1 0 2 1 2 2 and 1 4 2 in fig 6 c the relative l 2 error converges to o 1 0 2 for each values of n o b s and consequently all three cases are convergent this result suggests that a relatively larger network of observations is required to fully resolve the initial conditions for arc configurations a rigorous verification would be to analyse results with a larger values of n o b s and δ r 0 2 however this is not possible with our current problem setup as a case where both n o b s and δ r or m i m j with a single circular arc are large enough such that no points satisfy 4 1 would result in some observations not interacting with the free surface wave in the assimilation time t 2 as the latter was chosen to prevent boundary effects from effecting the reconstruction it cannot be altered without impacting the results 4 2 1 results with small n obs in this section we investigate the minimum number of observation points required for convergence we have shown that when n o b s is large greater than 60 increasing the number of points does not have a significant impact on the convergence of the relative minimum error for the characteristic and grid configurations we now consider results when 4 n o b s 16 to determine if there is a significant increase in the relative l 2 reconstruction error when n o b s is small we do not consider n o b s 1 2 or 3 as the smallest number of points we can have while still having points positioned in each quadrant to capture the azimuthal symmetry of the initial conditions is 4 results for observations along a characteristic with n o b s 4 10 and 16 with spacing δ x 0 0785 are presented in fig 7 a d we observe that the minimum relative l 2 error is less than 1 for each case therefore we conclude that for the characteristic configuration the minimum number of observation points necessary to achieve convergence of an isotropic initial condition is n o b s 4 results for observations in a grid configuration for n o b s 2 2 3 2 and 4 2 are presented in 7 e h we observe that the relative l 2 error for all three configurations converges configurations with 2 2 and 4 2 have a minimum relative l 2 error of 5 and 3 respectively the best convergence is for n o b s 3 2 with a minimum error of 0 2 suggesting that convergence does not necessarily improve with an increase in n o b s even with a small number of observations to summarise we have demonstrated that convergence can be achieved for the characteristic and grid configurations with a relatively small number of points and does not necessarily improve as n o b s is increased and so we conclude that based on the results so far having a large number of observation points is neither necessary nor sufficient for convergence with observations in a grid or along two characteristics in the results observed thus far we note that for all cases that converge such as in fig 7 there were multiple observations inside the support of the initial conditions however there were no points within the initial conditions support for the arc configuration consequently we must consider whether convergence can be achieved for the characteristics and grid configurations when there are no observation points inside the support of the initial conditions in tsunami models it is unrealistic to assume such observations are available and thus a logistically applicable forecasting scheme should avoid such assumptions the results of this analysis are presented in section 4 3 4 3 results with no observations within the support of the initial conditions in this section we present results for the characteristic and grid configurations with points inside the initial conditions support removed the spacing δ x is fixed at the sufficient value for convergence of 0 07 as removal of these points results in smaller values of n o b s the initial number of n o b s before removal is increased slightly so that the resulting number of observation points are comparable to the results in section 4 2 first we consider results for small numbers of observation points such that δ x 0 07 and there are no points within the support of the initial condition in fig 8 we observe that even with n o b s 28 the configuration in fig 8 c with observations in a grid fails to converge when there are no points in the support of the initial conditions despite having converged when n o b s 4 in fig 7 e similarly a configuration of 16 observations along the characteristics x y fails to converge when there are no points within the support of the initial conditions as shown in fig 8 a consequently we investigate whether convergence can be achieved when n o b s is relatively large fig 9 a d shows the configurations and results for observations along characteristics with n o b s 48 68 and 88 after removal the relative l 2 error at the final iteration for each case is approximately 7 as shown in 9 d we note that the error is almost two orders of magnitude higher than it was in fig 6 a these results are not surprising as having observations that are able to measure the true initial conditions may significantly improve the reconstructed initial conditions it is therefore to be expected that convergence is slightly worse when such observations are no longer included in the assimilation however based on the tolerance that the relative l 2 error be less than 10 these results are still convergent the configurations and result for observations in a grid format are presented in fig 9 e h we note some significant differences between the results here and those in fig 6 b first it is clear from fig 9 h that there is improved convergence for cases with n o b s 80 suggesting that the number of observations is an important factor when we do not have observations in the support of the initial conditions in contrast the results in fig 6 b did not indicate difference in convergence for the different values of n o b s secondly the best convergence in fig 9 h is a relative l 2 error of approximately 0 1 indicating better convergence than observed in fig 6 b despite the overall number of observations being comparable it is interesting to note that in fig 6 b the error stagnated after approximately 400 iterations this suggests that perhaps there is some overfitting that results in small scale noise in the reconstructed initial conditions when there are too many observations of the true initial conditions this would impact the convergence of the gradient descent algorithm used in the data assimilation in comparison in fig 9 h we observe that the error is still maintaining a negative slope even at the final iteration suggesting improved convergence to verify this hypothesis fig 10 shows the energy spectra of the relative absolute error of the reconstructed initial conditions for configurations 6 b and 9 h with n o b s 144 and n o b s 132 respectively we can see that the energy of larger wavenumbers in the reconstruction error ϕ t ϕ b ϕ t l 2 is higher for configuration 6 b verifying our initial hypothesis regarding small scale noise present in the reconstruction that impacted convergence on the other hand the energy of the error spectrum for configuration 9 h is mostly restricted to smaller wave numbers this may explain why the latter showed convergence of the l 2 error to 0 1 whereas the former converged to 0 3 in summary we conclude that a necessary but not sufficient for all configurations condition for convergence is that δ x be small enough that the euclidean distance between some pairwise observations satisfies the condition 4 1 the convergent configurations for the grid configuration in fig 4 had 64 pairwise observations satisfying the spacing condition 4 1 while the non convergent cases with spacing δ x 0 1 had none similarly the non convergent arc configurations in fig 5 had at most 14 pairwise observations with a euclidean distance less than 0 0785 this may suggest that there is a minimum number of pairwise observations required that satisfy the spacing condition 4 1 however as the minimum spacing observed in this analysis is a qualitative estimate and not analytically derived we cannot conclusively quantify the minimum number of observations based on this value alone additionally we observed that much larger numbers of observations were required for convergence in the arc configuration and this was also true for the grid configuration when observations inside the support of the initial conditions were removed in fact we found that the assimilation error was lower in the grid configuration when there were no observations within the support of the initial conditions this is likely due to overfitting generating small scale noise in the reconstructed initial conditions as shown in fig 10 to extend these results for more realistic conditions we conducted equivalent analyses with the anisotropic initial conditions given in 3 12 4 4 results for anisotropic initial conditions we have observed convergence for each of the observation point configurations considered in this study characteristic grid and arc by varying the spacing between observations and the number of observation points we have also demonstrated convergence even when there are no observations within the support of the initial conditions we now verify whether convergence is still achieved with anisotropic initial conditions our goal is to investigate the observability at measurement points when the surface wave is no longer azimuthally symmetric and contrast with results for isotropic gaussian initial conditions our aim is to provide results that are more comparable with realistic scenarios for tsunami observations where the both the initial conditions and bathymetry produces highly anisotropic surface waves briefly we found that there was no significant impact on convergence with anisotropic initial conditions as given in 3 12 compared to results in section 4 3 the convergence of the relative l 2 error for each of the three configurations is presented in fig 11 we observe that the convergence of the relative l 2 error for the characteristic and arc configurations is o 1 0 2 and there is little difference between results with different values of n o b s the convergence for the grid configuration is o 1 0 4 with n o b s 208 and o 1 0 3 for the other values of n o b s 4 4 1 summary of main results for observation configurations flat bathymetry to summarise the main results we have observed are as follows convergence was achieved a relative l 2 error less than 10 for each of the three configuration with both isotropic and anisotropic initial conditions respectively the best convergence in the present analysis was achieved with observations placed in a grid formation even with no points inside the initial conditions support the relative l 2 error in the reconstruction error was 0 1 with both isotropic and anisotropic initial conditions convergence was achieved for the characteristic and grid configurations with as few as 4 observation points the minimum number required to capture the azimuthal symmetry of the initial conditions a necessary condition for convergence was that the spacing δ x for grid and characteristic configurations be chosen such that at least some pairwise observations satisfy 4 1 however convergence was not achieved for the arc configuration even with small δ r the difference between radii of observations placed in two concentric circles suggesting this is not a sufficient condition for convergence or there is a minimum number of pairwise observations with a euclidean distance satisfying 4 1 which the arc configuration did not satisfy having only 14 such points whereas the convergent results for the grid configurations in fig 4 had 64 such pairwise observations increasing the number of observation points improved convergence of the arc configuration but had little effect on the grid and characteristic configurations when there were points placed inside the initial conditions support however without any observations in the support of the initial conditions larger numbers of observations n o b s resulted in improved convergence with the grid configuration and even surpassed convergence achieved in the former case points inside initial conditions support this suggests that observations of the true initial conditions can lead to overfitting and small scale noise in the reconstruction as demonstrated in fig 10 5 results with non zero bathymetry we now consider results for simulations where the bathymetry is no longer flat bathymetry can have a significant impact on propagating shallow water waves where wave speed c g h changes as depth h varies a tsunami s energy flux remains relatively constant and so as the tsunami s speed varies so does wave height shoaling effects the purpose of this section is to take the best results observed thus far and integrate them into a more realistic model adding some features of an operational tsunami forecast model to this end we limit our results to n o b s 88 even though we observed higher convergence with a greater number of n o b s for example in fig 9 h there are practical difficulties in employing such dense observation networks therefore we limit the maximum number of observation locations on the basis that convergence of the relative l 2 error to o 1 0 2 in the initial conditions reconstruction was achieved with 88 points in each of the three configurations considered in this study we begin with a simple gaussian bathymetry model simulating peaks and basins and then subsequently extend our analysis to a subsample of etopo2 a digital database of land elevation and sea floor topography where the datum represents the vertical deviation in metres from the mean sea level 5 1 gaussian bathymetry in this section we analyse results with the gaussian bathymetry described by 5 1 β x y 3 10 exp x 0 5 2 y 0 1 2 0 6 5 2 3 10 exp x 1 2 y 0 5 2 0 7 2 3 10 exp x 0 75 2 y 1 2 0 6 5 2 3 10 exp x 0 8 2 y 0 7 2 0 2 2 where a representation is given in fig 12 this shape was chosen as it contains gaussian peaks that are 30 of the average depth h and with varying widths simulating underwater mountains additionally a negative gaussian represents a basin and all features are placed such that there are relatively quick changes in the depth within the assimilation time t the amplitude of the true initial conditions is set to 0 001 h in order to accurately simulate tsunami conditions where amplitude of the surface wave in the deep ocean can be just a few metres depending on the generating mechanism we demonstrate the effect of the bathymetry on the free surface propagation in fig 12 where fig 12 c is the free surface wave η x y t at t t with a flat bottom bathymetry and fig 12 d is the free surface η x y t β x y at t t with the bathymetry given in 5 1 we observe in fig 12 d that due to bathymetry effects we no longer have azimuthal symmetry in the free surface wave propagation and the wave amplitude is higher at positions close to 1 1 and 3 2 3 2 this suggests the influence of the peaks in fig 12 a similarly the amplitude of the wave is slightly damped in the first quadrant indicating the effect of the basin the results with isotropic initial conditions and no points inside the initial conditions support are shown in fig 12 h we note that observations placed along the lines x y can no longer be referred to as observations placed along characteristics as these are no longer characteristics of the distorted wave due to bathymetry effects however we include the configuration to demonstrate convergence when observations are placed along lines in each case we have n o b s 88 and δ x δ r 0 07 we observe that the grid configuration has the best convergence of the relative l 2 error at 0 5 the results for the line and arc configuration also converge however with a larger error of 5 there is a relative decrease in convergence compared to results for with a flat bottom bathymetry as shown in section 4 3 this is most likely due to the fact that there is no longer azimuthal symmetry in the surface wave propagation and not all observation points are able to capture the interaction of the free surface wave with localised bathymetry despite this we note that results for each case do converge this is encouraging considering our results included effects of localised bathymetry features with amplitudes as much as 30 of the fluid depth another possible reason for convergence is that the amplitude of the initial conditions is relatively small which would mitigate wave breaking effects that could hinder convergence we now investigate whether similar results can be observed with realistic bathymetry 5 2 etopo2 bathymetry etopo2 is a database of two minute global relief data hosted by the national geophysical data centre at noaa 2006 this is an amalgamation of data collected via multiple sources including satellite altimetry observations and shipboard echo sounding measurements noaa national geophysical data center 2006 the grid values represent elevation at the cell edges averaged over the cell area the horizontal grid spacing is 2 min of latitude and longitude where 1 min of latitude represents 1 853 km at the equator and the vertical precision is 1 m where z 0 represents the mean sea level for the current analysis a square sub interval of the etopo2v2c database was chosen within the specified latitude and longitude limits 15 s 25 s and 90 e 100 e respectively this is equivalent to a rectangular grid of approximately 1100 km 1100 km accounting for slight differences between degrees of longitude due to the equatorial bulge where the maximum variation is approximately 60 km this bathymetry section represents the wharton basin a topographical feature in the ocean floor located off the western coast of australia it was chosen because it includes both basin and ridge features and because of the relative ease with which periodic boundary conditions could be implemented additionally it has been a documented source for seismic activity and strike slip events such as the 2012 and 2016 events in the region as most earthquakes are of strike slip mechanisms such events are potential sources of tsunamis in the wharton basin heidarzadeh et al 2017 a visual representation of the region and a relief map as taken directly from the etopo2v2c database are given in fig 13 a and 13 b in order to find classical solutions of the shallow water equations we require the bathymetry β x y and its first derivative to be smoother than the raw etopo2 data additionally we require periodic boundaries thus the boundaries are artificially padded with zeros and a low pass filter is used to damp all frequencies after the lowest 5 modes to zero a moving average filter was implemented to remove sharp curves at the boundaries using the matlab smooth function the control time t was adjusted so that the free surface wave does not actually reach the padded boundary region the average depth h 5000 m was normalised to 1 and the length scales adjusted to l l in both x and y directions the amplitude of the initial conditions was set to 0 001 h equivalent to 5 m the smoothed and scaled relief map and 3 d plot of the bathymetry can be seen in fig 13 c and 13 f we implement the data assimilation for observations along the lines x y a grid and an arc with isotropic initial conditions and anisotropic initial conditions respectively figs 13 d and 13 e show the free surface wave at the final time t for each initial conditions case the effect of the bathymetry on the free surface wave is relatively small compared to the flat bottom case in fig 12 c than for the gaussian bathymetry as in fig 12 d however we note that the highest amplitude in the etopo2 bathymetry as shown in fig 13 c is only approximately 0 06 which is significantly less than the bathymetry in 5 1 nevertheless we observe slightly deeper troughs in the free surface wave indicated by the dark blue regions in 13 d which are indicative of bathymetry effects we conclude that changes in the wave speed due to the bathymetry structure may result in different coastal communities having varied arrival time and wave energy the observation configurations and results with isotropic initial conditions and anisotropic initial conditions are presents in fig 14 for the isotropic initial conditions we see in fig 14 d that the lowest relative error is for the grid configuration with a minimum error of 0 3 the straight line configuration has minimum a relative error of 5 and thus is convergent however as in the idealised case with gaussian bathymetry it is again the worst performing configuration the results for the arc configuration are a bit better than those observed for the gaussian bathymetry with a minimum error of 5 subsequently we conclude that the main results of this study extend to realistic bathymetry such as the smoothed topography of the wharton basin we consider analogous results with a anisotropic initial conditions in fig 14 e h the main trends in the relative l 2 error shown are similar to the results with isotropic initial conditions as shown in fig 14 d in that the grid formation has the lowest minimum relative error 0 2 however in this case the straight line configuration performs better than observations along the arc although both are convergent this is not surprising as we have already observed in section 4 4 that the arc and straight line configurations show relatively worse convergence with a radially asymmetric surface wave and bathymetry features the main difference across the two cases is the relatively better performance of the straight line formation nevertheless overall convergence for both isotropic and anisotropic initial conditions is relatively equivalent 6 conclusion and further considerations in this study we implemented a data assimilation scheme for the two dimensional swe to reconstruct the initial conditions using observations of free surface wave height our objective was to investigate configurations of observations that minimise the reconstruction error in the presence of increased complexity compared to one dimension these new features include curved non linear wave fronts and bathymetry features we did this by comparing cases where observations satisfied the minimum distance criterion 4 1 between pairwise observations kevlahan et al 2019 and when they did not we compared observations placed along straight lines i e characteristics of the surface wave with isotropic initial conditions and flat bathymetry in a grid array and along concentric arcs we analysed the effect of a small or large number of observations and the effect on convergence when observations inside the initial conditions support were removed the algorithm was implemented for both isotropic and anisotropic true initial conditions both with both flat and non flat bathymetry summarising the main results we observed that a necessary but not sufficient condition for convergence was that some of the pairwise observations are sufficiently closely spaced to observe the minimum lengthscales of the initial condition i e satisfy eq 4 1 while this confirms results from the one dimensional case in part the main difference is that for the one dimensional assimilation the spacing condition 4 1 was sufficient for convergence we have demonstrated that this is not the case as for results in fig 5 in the two dimensional assimilation and we may require a minimum number of points satisfying 4 1 in order to achieve convergence this could be due to the need to capture the shape of true initial conditions with higher dimensionality we recall that eq 4 1 was not analytically derived for the two dimensional case and therefore is not expected to account for its complexities nonetheless it is a useful reference tool for the qualitative analysis in this study for the arc configuration we observed that a higher number of observations was necessary for convergence whereas convergence was achieved for the straight line and grid configurations with as few as 4 observation points however small n o b s was insufficient for convergence when there were no observations within the support of the initial conditions increasing the number of observation points improved convergence for the grid and characteristic configurations when observation points were removed from the support of the initial conditions the grid configuration showed the best convergence of the relative l 2 error in the reconstructed initial conditions we concluded that observations are not required within the support of the initial conditions and that this can actually degrade the results due to over fitting the error was o 1 0 4 with a flat bottom bathymetry and o 1 0 3 with a gaussian bathymetry and bathymetry from the etopo2v2 database convergence was slightly worse for the characteristic configuration with anisotropic initial conditions and when bathymetry features were included but overall all configurations showed convergence a relative error in the reconstructed initial conditions less than 10 with 88 observations for both isotropic and anisotropic initial conditions and with bathymetry the main results for the analyses conducted in this study are summarised in table 2 we now consider the feasibility of integrating these idealised findings with a realistic tsunami model the primary questions are 1 is it realistic to assume that we have a sufficient number of observations for convergence int the case of a grid of observations centred on the initial conditions 2 is it realistic to have a sufficient number of observations of surface wave heights for potential locations of initial conditions i e associated with known seismically active regions addressing these we note that the most destructive tsunamis are those generated by shallow earthquakes with epicentres along fault lines of these tectonic subduction at the plate boundaries are the most likely causes of tsunamis and subsequently their position coincides with the support of the initial conditions schellart et al 2011 provide a comprehensive overview of global subduction sites as well as the velocities of the respective plates concentrating observations around subduction zones may sufficiently capture the propagation of waves triggered by seismic events originating here however this is not necessarily exhaustive as we have indicated the wharton basin which does not lie on a subduction zone is a potential zone for small tsunamis due to strike slip earthquakes heidarzadeh et al 2017 and there are many such regions however the most destructive tsunamis in recent history such as the 2004 indian ocean tsunami have been due to earthquakes with epicentres falling on subduction zones and hence merit primary focus the scope of positioning observations at all possible such locations brings us to the logistical feasibility of such configurations angove et al 2019 provide a comprehensive review of the major limitations to accurate tsunami forecasts today and detail key areas where uncertainties associated with observing tsunamis can be quantified and reduced they highlight the need for updated methods to accurately capture initial displacement and detail possible solutions such as using data from the ever expanding global navigation satellite system gnss bottom pressure recorders bprs and limited area cabled observation systems they conclude that instrumenting commercial fibre optic cables with bprs and accelerometers is the most promising approach but it comes with complexities and costs that cannot be covered by scientific revenue streams alone this is especially problematic when we consider that requiring observation configurations around subduction zones with the highest probability of tsunamis occurring requires a large number of observations in the present analysis we have demonstrated convergence with n o b s 88 placed around a single source of potential tsunamis and in reality there are several such regions however as we previously noted innovative methods have already been introduced to generate observations even when existing networks are relatively sparse for example introducing virtual observation data interpolated from neighbouring real observations as demonstrated by wang et al 2019 these methodologies can be implemented to pad the existing observational network such that requirements for n o b s are satisfied additionally there have been significant advancements in altimetry observations taken from geospatial satellite data angove et al 2019 note that the process to constrain a tsunami source from altimetric data is similar to that currently employed and has the advantage of providing both spatial and temporal variation not present in the static time series reported by tsunameters despite this they stipulate that due to limitations in sensitivity limited satellite coverage and extended data processing times operational use of satellite altimetry in real time tsunami forecasting has not been a viable solution to date however improvements in remote sensing of ocean waves using altimetry have come a long way since the geodynamics experimental ocean satellite 3 geos 3 satellite was first launched in 1975 even then remote sensing of ocean wave height from space was predicted to provide a quantum increase in forecasting capabilities barrick and fedor 1978 recent projects such as the esa s globwave project 2010 2013 have expanded upon this by providing access to consolidated datasets on ocean waves to the scientific community for the purpose of modelling and forecasting in 2017 the copernicus marine environment monitoring service cmems released the first real time global wave product containing wave height data collected via multiple satellites available within three hours of acquisition additionally these observations have been collected and made accessible for forecasting models as in ribal and young 2019 with a global spatial resolution of 7 km 7 km the observation network is very similar to the optimal grid configuration observed in this study and thus has the potential to generate similar results while tsunami waves are characteristic of relatively small amplitudes smith et al 2005 demonstrated that it is still possible to measure tsunamis using altimetry data and restrictions for forecasting in real time were due to the delay in access to data with innovated products such as the cmems data sets accessible in under three hours these restrictions can be mitigated and real time forecasting capabilities for tsunamis using altimetry data are on the horizon ultimately the efficacy of such modelling frameworks in a realistic setting also depends on related factors not considered in the present work such as positioning of observations such that detection time of tsunami waves is optimised ferrolino et al 2020 demonstrate a promising methodology using population based algorithms that optimises placement of deep ocean sensors around subduction zones and finds the minimal time it takes for the disturbance on the source to arrive at sensor locations while this work does not focus on reconstruction of missing initial condition information or wave accuracy as it propagates away from the source it is nonetheless a necessary consideration for realistic tsunami observational needs earlier detection can potentially mitigate the delay in receiving and processing altimetry data as this work is restricted to the extension of the results in kevlahan et al 2019 to two dimensions future development would benefit from considering the observability framework outlined by kang and xu 2014 and king et al 2015 this may provide a more rigorous mathematical justification for optimal two dimensional configurations of observations we recall that the mathematical proof of theorem 4 1 is applicable only for the one dimensional case and consequently the results shown here are qualitative a similar concept to the minimum distance criterion considered here was provided in hinson 2014 where a lower bound on the radius of attraction to satisfy observability was found future work aimed at determining optimal configurations of observations in two dimensions would benefit from exploring the effects of placing sensors within and outside this observability radius the analysis provided here can also be made more rigorous by considering the well posedness of the inverse problem and the possible issues of non uniqueness and discontinuities in the mapping used to reconstruct missing parameters such as initial conditions from the model and observations these considerations are addressed in detail by navon 1998 where regularisation methods such as tikhonov regularisation inclusion of background information and sensitivity analyses are suggested to address such issues and to identify influential parameters within the system subsequently a next step for this work would be to conduct sensitivity analyses as in kevlahan and khan 2020 and khan and kevlahan 2021 and to include regularisation and background information terms in the cost function optimisation global optimisation may be a more efficient and reliable method to minimise the cost function than the gradient minimisation method used here in particular global optimisation may avoid the algorithm getting stuck in a local minimum ferreiro ferreiro et al 2020 consider a similar problem for tsunami models where the shallow water model is discretised using a positivity preserving second order path conservative finite volume scheme and the data assimilation problem is posed in a global optimisation framework our work is based on the optimise then discretise approach and our goal is to extend the methodology derived in kevlahan et al 2019 to two dimensions therefore data assimilation with a global optimisation algorithm is outside the scope of the current work however realistic extensions of our results may benefit greatly from the automatic data assimilation methods provided by ferreiro ferreiro et al 2020 in conclusion we have developed a two dimensional variational data assimilation algorithm for reconstruction of initial conditions of surface waves with the primary aim of extending the results of the one dimensional variational assimilation outlined in kevlahan et al 2019 we have confirmed the feasibility of variationally data assimilation for tsunami waves in idealised 2d configurations and have qualitatively demonstrated the necessary and or sufficient conditions for convergence of the reconstructed initial conditions to the true shape we have analysed different configurations of observations their spacing and their number with a variety of bathymetry and initial conditions importantly we have extended the one dimensional results regarding necessary conditions for the maximum distance between pairwise observations as given by eq 4 1 i e resolving the smallest scales of initial surface displacement and have additionally shown that for the two dimensional case this is not a sufficient condition we have demonstrated that when there are no observations within the support of the initial conditions a sufficiently large number of observations is a necessary condition for convergence based on these criteria we have shown that convergence can be achieved for observations arranged in straight lines grids and along concentric circular arcs for both isotropic and anisotropic initial conditions and with realistic bathymetry data with advances in altimetry observation data availability and accuracy there is scope to use these results for more accurate tsunami models with real observation data credit authorship contribution statement r a khan conceptualisation methodology formal analysis software data curation writing original draft visualisation investigation n k r kevlahan supervision conceptualisation methodology validation writing review editing funding acquisition declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgements we would like to thank dr bartosz protas for his ongoing contribution and feedback on this research additionally we would like to thank dr laurent debreau and dr arthur vidard at the laboratoire jean kuntzmann for their suggestions funding this project was funded by the nserc canada discovery grant of dr nicholas kevlahan and research exchange at the laboratoire jean kuntzmann was facilitated by the mcmaster cnrs canada fund travel grant 
23839,accurate modelling of tsunami waves requires complete boundary and initial data coupled with the appropriate mathematical model however necessary data is often missing or inaccurate and may not have sufficient resolution to capture the dynamics of such nonlinear waves accurately we demonstrate that variational data assimilation for the continuous shallow water equations swe is a feasible approach for recovering initial conditions we showed that the necessary conditions for reconstructing one dimensional initial conditions in kevlahan et al 2019 can be extended to the maximum euclidean distance between pairwise observations to two dimensions we use sadourny finite difference finite volume simulations to verify convergence to the true initial conditions can be achieved for observations arranged in multiple configurations for both isotropic and anisotropic initial conditions and with realistic bathymetry data in two dimensions we compare observations arranged in straight lines in a grid and along concentric circles and assess the optimal number and configuration of observation points such that convergence to the true initial conditions is achieved these idealised results with simplified two dimensional geometry are a first step towards more physically realistic settings recent advances in altimetry observation data now permit much denser measurements of sea surface height than is possible with a fixed buoy network this provides the opportunity to use the method developed here for more accurate tsunami forecasts in realistic settings keywords shallow water equations observations characteristics grid arc 1 introduction the 2004 indian ocean tsunami and the 2011 japanese tsunami have highlighted the need for more effective forecasting models that can be used to create and implement evacuation and emergency protocols effectively in a limited amount of time however existing methods are challenged by the limitations of the necessary sets of data nakamura et al 2006 consequently information on the initial conditions of tsunamis is likely to be incomplete or inaccurate tsunamis are series of waves caused by large scale disturbances in the ocean such as seismic activity in this study we focus on tsunami propagation in the deep ocean and not on the interaction of tsunami waves with the coast where the dispersive boussinesq equation may be a better model they are characterised by very long wavelengths relative to the ocean depth sometimes hundreds of kilometres categorising them as shallow water waves however the perturbation of the free surface in the deep ocean can be less than a metre rendering it virtually imperceptible away from the shore the wave speed c is directly proportional to the square root of the water depth and with an average deep ocean depth of 4000 m tsunamis can travel faster than 700 km h and are capable of generating atmospheric gravity waves that can travel into the upper atmosphere in this study we formulate a variational data assimilation scheme for the two dimensional shallow water equations swe where observations of sea surface height are used to reconstruct missing initial conditions data the two dimensional swe system includes an additional conservation of momentum equation in the horizontal y direction the state vector is subsequently η u v t and the full system is given in 2 1f for the one dimensional swe considered in kevlahan et al 2019 the wavefront is simply a moving point on one side therefore in one dimension the only degrees of freedom in observation placement are their spacing and their number however in the two dimensional extension considered here the wavefront is a one dimensional curve and the observations can be placed along curves or in various two dimensional arrays additional features that increase the complexity of the this case include nonlinear characteristic curves of the hyperbolic partial differential equation and the wave focusing effects of two dimensional bathymetry features our goal is to investigate if the minimum spacing requirement in kevlahan et al 2019 can be extended to two dimensions we are particularly interested in exploring the effects of greater choice in observation placement and the richer nonlinear wave front geometry allowed by the two dimensional problem in practice zou et al 1992 have demonstrated that the discretised two dimensional swe are observable even with measurements of only one of the three variables η u v however existing data assimilation methods have been applied mostly for tsunami forecasts in north america and japan where relatively large observation networks exist wang et al 2019 primary sources of observations include the deep ocean assessment and reporting of tsunamis dart buoy system consisting of a bottom pressure recorder residing on the ocean floor which transmits data to a surface buoy the data is then relayed to shore via noaa s geostationary operational environmental satellite goes gonzalez et al 1998 the large investment required for such apparatus limits the feasibility of a dense network and currently the global network consists of approximately 60 systems spread over the entire pacific ocean and located mostly near coastlines at depths of 1 6 km other observations used for tsunami detection and reporting include ocean bottom seismometer obs pressure gauges however these are sparsely distributed in the indian ocean wang et al 2019 angove et al 2019 state that one of the major limitations to accurate tsunami forecasts is their inability to quickly measure and represent the tsunami source the placement and number of dart tsunameters and ocean bottom seismometers obs is currently not extensive enough to simultaneously provide i early warning of impending tsunamis and ii enough observational data to for data assimilation methods to accurately reconstruct the displacement at the source and subsequently predict wave height and velocity at coastlines therefore our objective with this work is to outline a theoretical data assimilation framework that could make use of satellite altimetry data where considerable progress has been made in data availability and precision existing data assimilation schemes are able to utilise multiple sources and techniques for assimilating off shore observations maeda et al 2015 assimilated real time data from an ocean bottom network of tsunameters to simulate the wave field directly in real time instead of approximating initial conditions and thus mitigating the uncertainties of modelling the seismic source wang et al 2019 used interpolation of observed waveforms to create virtual observational data and demonstrated the success of the assimilation scheme when applied to forecasting simulations of the 2004 indian ocean tsunami kalman filtering techniques have also been used extensively for both parameter estimation and initial condition reconstruction in ocean models mayo et al 2014 use variants of an ensemble kalman filter enkf where error statistics of the model are represented by an ensemble of forecasted model states to estimate bottom stress terms in the advanced circulation adcirc coastal model using observations of sea surface elevations they demonstrate accurate estimation of friction parameters in lagoons and estuaries and highlight the influence of the bottom surface roughness motivating the need for high resolution bathymetry ghorbanidehno et al 2019 also use kalman filtering to estimate near shore bathymetry using a novel compressed state kalman filter to recover both constant and temporally evolving bathymetry profiles and demonstrate superior accuracy compared to ensemble based methods with comparable computational costs statistical data assimilation has also been used in tsunami modelling efforts yang et al 2019 use optimal interpolation oi a variant of the enkf to reconstruct real time tsunami wave fields using measurements of pressure changes on the ocean floor however accurate prediction in real time using kalman filtering techniques can be challenging as forecast accuracy depends on the choice of initial error covariance matrices and often the error statistics for true state variables are not available nor easily estimated additionally the ability to resolve details of covariance structure is proportional to the ensemble size and larger ensembles may be too computationally expensive for predictions in real time nevertheless comparison between kalman filtering and variational data assimilation given a perfect model and same observations and domain determined that performance was equivalent for both fletcher 2017 lorenc 1986 in this study we implement a variational data assimilation scheme using optimal control theory to minimise the error between the state variables and observations the novelty of our variational approach is that we consider the infinite dimensional case unlike previous works on 4d var for the swe like zou et al 1992 and maeda et al 2015 and kalman filtering techniques consequently our data assimilation algorithm is independent of the discretisation used in its numerical implementation our model for tsunami wave propagation is based on the two dimensional non dispersive swe however tsunami waves can also be modelled using the boussinesq water wave approximation while both shallow water and boussinesq approximations are widely used for analysing solitary wave propagation studies such as dongfang et al 2013 have compared the two processes finding that in certain run up processes the two approximations are identical and that boussinesq approximation is most often used to model near shore hydrodynamic behaviour however our analysis addresses the optimal configuration of deep ocean observations required to accurately reconstruct initial conditions and bathymetry and the necessary and or sufficient conditions for convergence before coastal dynamics are observed therefore we do not take near shore behaviour into account in our analysis additionally we neglect coriolis effects bottom friction and kinematic viscosity this idealised configuration with simplified two dimensional geometry is intended to be a first step for more complex analyses for this reason we also assume there are no errors in measurements we aim to validate the basic approach by demonstrating the feasibility of variational data assimilation for tsunami wave prediction and investigate fundamental questions for the idealised case first before considering more physically realistic settings the purpose of the current study is not to determine optimal placement of observations or to develop new assimilation techniques based on observability criteria instead we extend our one dimensional initial condition variational assimilation technique kevlahan et al 2019 from one dimension to two dimensions and analyse results from a variety of numerical experiments assessing its performance and flexibility the problem of finding an optimal observation configuration has been considered in king et al 2015 they derive a measure of how well information about the system state can be inferred using observation sensors and provide an approximation for a partial observability index their findings suggest that optimised observations reduced the root mean square error rmse by approximately 20 compared to equally spaced observations similarly kang and xu 2014 also introduce a gradient projection method for maximising partial observability however king et al 2015 provide results showing the efficacy of their observability index for the one dimensional shallow water equations and optimal observations are arranged in a straight line with variable spacing comparisons are given with equidistant points and the extension to higher dimensions is not discussed kang and xu 2014 also only provide results for the one dimensional burger s equation we note that the core contribution of these works is the mathematical approximation of partial observability framing it as an eigenvalue optimisation problem whereas our goal is not to develop an algorithm to determine optimal placement of observations but to extend the one dimensional algorithm derived in kevlahan et al 2019 to two dimensions and verify its performance in a situation where there is much more freedom in observation placement in kevlahan et al 2019 we have proven sufficient conditions for optimal reconstruction of the true initial conditions using sparse observations for the one dimensional swe our objective was to determine the optimal number and locations of wave height measurements such that the optimally reconstructed initial conditions obtained via data assimilation converged to the true form in order to extend the analysis to more realistic dynamics in tsunami models here we implement an analogous scheme on the two dimensional swe system and investigate whether the key results of our previous study extend to the more complex case with full dimensionality due to the sparsity of observations in tsunami models our aim for the two dimensional case is to find the minimum information in the form of observations of surface wave height such as their configuration number and spacing between adjacent points required for convergence to the true initial conditions this focus also differentiates the current work from existing literature on data assimilation for the two dimensional swe like zou et al 1992 as they do not analyse the choice of the observation configuration and focus instead on the minimum number of observational fields additionally while they derive a variational scheme for the discrete two dimensional swe system a novelty of our approach is that we consider the infinite dimensional case unlike previous works on 4d var our purpose is to extend the one dimensional data assimilation scheme derived in kevlahan et al 2019 to two dimensional subsequently we investigate whether the conditions for convergence observed for the one dimensional case also hold for the more complex two dimensional system we recall that for the one dimensional assimilation optimal convergence to the true initial conditions occurs when at least one pair of observation points are spaced more closely than half the effective minimum wavelength of the energy spectrum of the initial conditions in the one dimensional case we were able to exploit the fact that the linear one dimensional swe system can be formulated as the one dimensional wave equation and subsequently we used its analytic properties to derive an exact solution for the adjoint system solved in the variational scheme this solution was used to prove sufficient conditions for convergence to the true initial conditions however this method fails to extend to the two dimensional case as the analytical solution to the adjoint system is not easily found existing works such as iacono 2005 on analytical solutions of the two dimensional swe involve drastic simplifications of the equilibrium problem such simplifications would not help us adequately investigate the minimum observation information required for tsunami models with high dimensionality therefore our approach is focused on a qualitative investigation of the applicability of results from the one dimensional analysis for the two dimensional data assimilation and on a comparison of different observation spacings configurations and numbers we begin in section 2 by extending the data assimilation to two dimensional and implement this algorithm numerically in section 3 the results and complementary analyses are divided into the following three topics 1 section 4 assess the optimal number and configuration of observation points such that convergence to the true initial conditions is achieved in the data assimilation for the two dimensional swe 2 section 4 1 investigate whether the sufficient conditions for convergence in kevlahan et al 2019 for the one dimensional case extends to the two dimensional data assimilation 3 section 5 implement the data assimilation algorithm for a relatively realistic tsunami forecasting model using non flat bathymetry our final analysis uses realistic bathymetry data from the etopo2 global topographical relief database and the optimal observation configurations identified in this study we conclude with a summary of the main results and future considerations in section 6 2 derivation the two dimensional shallow water equations swe are 2 1a η t x η h β u y η h β v 0 2 1b u t u u x v u y η x 0 2 1c v t u v x v v y η y 0 2 1d η x y 0 ϕ x y 2 1e u x y 0 0 2 1f v x y 0 0 where h is the average depth of the fluid and the system has been normalised such that g h 1 η and β are the perturbation of the free surface and sea floor respectively and u and v are the velocities in the x and y direction we assume the initial conditions ϕ l 2 ω is compactly supported on the spatial domain ω x y x l l y l l and is periodic at the boundaries the notation used in the data assimilation algorithm is summarised in table 1 let us define m j o t to be observations of the surface wave at positions x y j for j 1 n o b s at continuous times t our objective is to minimise the least squares error between the observations m j o t and the forecast solution of the wave height η f x y t given some initial conditions ϕ we express this as a cost functional j l 2 ω r constrained by the system 2 1f 2 2 j ϕ 1 2 0 t i 1 m η f x j y j t ϕ m j o t 2 d t then the optimal initial conditions ϕ b is the minimiser defined as 2 3 ϕ b argmin ϕ l 2 ω j ϕ since the minimum of 2 2 is achieved when 2 4 l 2 j ϕ b 0 we formulate a dual adjoint system in terms of some appropriately chosen adjoint variables such that l 2 j ϕ b can be derived more efficiently than direct computation of the gradient of 2 2 given ϕ the first variation of j given some arbitrary perturbation ϕ of scale ɛ is given by the gateaux derivative 2 5 j ϕ ϕ lim ɛ 0 j ϕ ɛ η j ϕ ɛ expanding the perturbation to o ɛ we can reformulate 2 5 as 2 6 j ϕ ϕ 0 t η f x j y j t ϕ m o t η d t where η u v are the solutions of the perturbed system given the perturbation in the initial conditions ϕ found by linearising about η u v and extracting the o ɛ system as the gateaux derivative is a directional derivative in the direction of the perturbation ϕ we can express 2 6 as the inner product between j and ϕ 2 7 j ϕ ϕ j ϕ l 2 ω ω l 2 j η d ω then the following forms of j β β are equivalent 2 8 j ϕ ϕ 0 t η f x j y j t β m o t η d t ω l 2 j ϕ d ω if we form a lagrangian of our linearised shallow water system with some arbitrary adjoint variables η u v 2 9 0 t ω η x y t η x x u η h η β u y v η h η β v u x t u t u u x v u y η x v x t v t u v x v v y η y d ω d t 0 we observe that by formulating the following system in terms of the adjoint variables η u v 2 10a η t u η x v η y u x v y m x i y i t h η x y t β 2 10b u t u u x v u y h η β η x 0 2 10c v t u v x v v y h η β η y 0 2 10d η x y t 0 2 10e u x y t 0 2 10f v x y t 0 and integrating 2 9 by parts in space and time due to the periodicity of the boundary conditions the lagrangian 2 9 is reduced to 2 11 0 t ω η f x j y j t ϕ m o t η d ω d t ω η η t 0 d ω combining this result with the equivalence given by 2 8 we have 2 12 ω η η t 0 d ω ω η t 0 ϕ d ω ω l 2 j ϕ d ω and thus since our functional is linear and bounded and belongs to the space of square integrable functions we can use the riesz representation theorem for the equivalence of inner products to extract l 2 j giving us 2 13 l 2 j ϕ η x y 0 for a detailed derivation we refer the reader to kevlahan et al 2019 we utilise an iterative steepest descent algorithm to find our minimiser ϕ b yielding l 2 j 0 given some starting guess ϕ g we also used a polak ribière conjugate gradient descent method and found results to be equivalent to steepest descent the steps of the process at each iteration are summarised in algorithm 1 3 numerical implementation our spatial domain is ω l l l l where l 3 the assimilation is carried out in the time interval 0 t where the final time t 2 is selected such that there are no boundary effects for the spatial discretisation we implement a second order finite difference finite volume sadourny energy conserving scheme on a c grid the sadourny scheme ensures that this discretisation inherits the conservation properties such as energy or enstrophy conservation of the original system sadourny 1975 if the swe are expressed in the following equivalent form 3 3 η t x η h β u y η h β v 0 3 4 u t v x u y v x g η 1 2 u 2 1 2 v 2 0 3 5 v t v x u y v y g η 1 2 u 2 1 2 v 2 0 then the discretisation 3 6 u t 1 δ x δ i g η 1 2 u 2 1 2 v 2 v x u y 1 η β j v i j 3 7 v t 1 δ y δ i g η 1 2 u 2 1 2 v 2 v x u y 1 η β i u j i where 3 8 δ i f f i 1 2 f i 1 2 3 9 f i 1 2 f i 1 2 f i 1 2 ensures that the total energy is conserved such that 3 10 0 i j δ x δ y g η η t 1 2 u 2 1 2 v 2 t 1 η β i j δ x δ y 1 η β u u t i j δ y δ x 1 η β v v t where the staggered centre difference operator 3 8 and centre linear interpolation operator 3 9 ensure that the velocities u and v and their time derivatives are discretised at the centre of the cell boundaries and η and β and their derivatives are located at cell centres the spatial derivations are discretised using a second order finite difference scheme with periodic boundary conditions the system is then integrated using a four stage third order runge kutta scheme spiteri and ruuth 2002 the resolution is 128 128 due to computational cost considerations as the memory requirements for the solver are quite high the time step δ t δ x 3 is chosen to satisfy the courant friedrichs lewy cfl condition and subsequently the solutions for η u v are 128 128 193 matrices which need to be stored for all time steps the line minimisation for is carried out using the matlab function fminunc we consider the following isotropic gaussian initial conditions where the gaussian has the same variance and physical properties in every direction 3 11 ϕ t x y 1 20 exp x 2 y 2 0 1 2 for cases where anisotropic initial conditions are used the variance of the gaussian in the x and y directions is different and the gaussian has been rotated by π 4 radians 3 12 ϕ t x y 1 20 exp x r 2 y r 5 2 0 1 5 2 3 13 x r x cos π 4 y sin π 4 3 14 y r x cos π 4 y sin π 4 fig 1 shows the isotropic and anisotropic initial conditions in the results we indicate an approximation of this support spatial domain where the initial condition is non zero to highlight the position of the observation points relative to the initial conditions while gaussian initial conditions are not technically compactly supported they are in practise for numerical simulations for example when the exponential is smaller than machine precision the results in section 4 are for assimilation with flat bathymetry β x y 0 as in kevlahan et al 2019 however in section 5 we implement the data assimilation algorithm with i a gaussian form bathymetry and ii realistic bathymetry data taken from the etopo2 database for global topography and bathymetry 3 1 verification test to verify our numerical implementation we conduct a test using the equivalent forms for j ϕ ϕ used in our derivation the gateaux derivative and the riesz gradient if the implementation is correct the parameter κ should converge to 1 as ɛ 0 3 15 κ ɛ lim ɛ 0 1 ɛ j ϕ ɛ ϕ j ϕ ω η x y 0 ϕ d ω the results of the verification test are shown in fig 2 with a non zero bathymetry 4 numerical results the analysis for the two dimensional data assimilation is more complex than the one dimensional case due to the more complex geometry of nonlinear wavefronts propagating in two dimensions and the increased geometric complexity in the placement of the observation points with this in mind in this section we explore the effect of configuration and number of observations on the overall convergence of the reconstructed initial conditions we classify a result as convergent if the relative l 2 error is lower than 10 based on convergence observed in kevlahan et al 2019 noting that all results where the minimum distance criteria 4 1 was not met had a relative convergence error higher than 10 in the 1 d case in kevlahan et al 2019 all observation points were located to one side of the initial condition support in the present analysis we consider observations in all quadrants of our spatial domain where the initial conditions is centred at 0 0 we note that in most cases our initial conditions are isotropic and the subsequent wave propagation is radially symmetric given a flat bathymetry this azimuthal symmetry property cannot be observed by observation points along characteristics in a single quadrant alone this suggests that to capture the isotropic nature of the initial conditions it may be beneficial to place observations along an arc of the circle x 2 y 2 r t 2 where r t is the radial position of the propagating wave η x y t at each time t 0 t we qualitatively investigate this claim by analysing results for three observation configurations i in a square grid centred at 0 0 ii along the characteristics x y and x y and iii on circular arcs along x 2 y 2 r i 2 for i 1 2 in section 4 1 we extend the analysis for observation spacing from the one dimensional case as in kevlahan et al 2019 for each configuration for all cases we assume the initial guess ϕ g 0 in section 4 2 we build on the optimal results for observation spacing and investigate whether convergence improves when increasing the number of observation points in reality it is unlikely there will be many observations within the support of the initial conditions of a tsunami therefore we also investigate the effect of removing all observation points located within the support of both isotropic and anisotropic initial conditions on convergence 4 1 observation spacing in order to investigate the effect of observation spacing for the two dimensional initial conditions assimilation we use the results of kevlahan et al 2019 as a benchmark we recall that for the one dimensional assimilation optimal convergence to the true initial conditions ϕ t occurs when at least one pair of observation points are spaced more closely than half the effective minimum wavelength of the energy spectrum of the initial conditions subsequently given a pair of observation points m 1 m 2 we require 4 1 m 1 m 2 π k m a x where k m a x is the largest effective wavenumber of ϕ t in the absence of a rigorous equivalent result for the two dimensional assimilation we qualitatively investigate whether convergence improves when 4 1 is satisfied for the two dimensional wavenumbers k and l to find k m a x and l m a x we examined the energy spectrum of the true isotropic two dimensional initial conditions we observed that the modes for k l 40 have relatively negligible magnitudes and thus k m a x l m a x 40 is a good approximation thus the distance between at least two observation points should be less than 0 0785 in the one dimensional case at least one pair of points was required to satisfy 4 1 however it may be that a greater number of points satisfying this condition is correlated with improved convergence in the two dimensional case due to the need to resolve the two dimensional shape of the initial conditions e g azimuthal symmetry to investigate this we compare results with different spacing of observations δ x δ y δ r for the arc configurations in a grid along characteristics x y and in radial arcs centred on the initial conditions we also investigate convergence with different numbers of pairwise observations with a euclidean distance fulfilling 4 1 we begin with observations along characteristic lines x y 4 1 1 observations along characteristic x y for this case we initially choose n o b s 36 this initial choice of n o b s is larger than those considered in kevlahan et al 2019 where n o b s 5 was considered however given the higher dimensionality of the two dimensional problem we scale up our initial choice of n o b s we evaluate results for the δ x δ y 0 07 0 0785 0 1 and 0 2 these values were chosen to include cases both when 4 1 is satisfied and when it is violated since observations are placed along x y the euclidean distance between points is δ x 2 δ y 2 comparing pairwise distances between any two observation points in the configuration we observe that at least 8 out of a total of 36 36 1 pairwise observations have a euclidean distance less than 0 0785 for δ x 0 07 0 0785 and 0 1 there are zero pairs satisfying 4 1 for δ x 0 2 the characteristic configurations can be seen in fig 3 a b c and d the red circle represents the boundary of the initial condition it is an approximate representation intended for reference only and the actual region where ϕ t 0 may be slightly larger and corresponds to fig 1 the configurations in 3 a 3 b and 3 c satisfy 4 1 and those in 3 d do not we wish to determine whether convergence is worse where spacing is larger than 0 0785 the convergence results for both cases are given in 3 e the relative l 2 error in the reconstruction after 1000 iterations we observe that the assimilation converges for the three cases with δ x 0 1 as 0 0785 is just an estimate of the minimum spacing it is not surprising that the slightly larger 0 1 case also converges there is no significant difference between the three cases and the error is reduced to o 1 0 3 however the configuration with δ x 0 2 fails to converge these results confirm condition 4 1 and therefore are consistent with the minimum spacing theorem in kevlahan et al 2019 as δ x 0 2 was the only case where there were no pairs of observations with a euclidean distance less than 0 0785 to analyse the smoothness of the convergence we considered the relative l 2 error for an extended range of δ x and observed that the error with spacing of observations such that 0 1 δ x 0 2 still converged despite having a higher error compared to δ x 0 1 and no configuration with δ x 0 2 achieved convergence of the l 2 error less than 10 we observe that the placement along characteristics in all four quadrants appears to sufficiently capture the radial symmetry of the propagating wave and reconstruct the initial conditions accurately we verify whether these results by considering observations placed in a grid and along concentric circles centred at the initial conditions 4 1 2 observations in a grid formation the second configuration of observation points we consider is a grid layout in the x y plane to maintain comparison with the characteristic configuration we initially choose n o b s 6 2 and observations are arranged in a six by six square grid centred at 0 0 these configurations are presented in fig 4 a b c and d with the same values of δ x as for the characteristic case the trend in the relative error decrease over 1000 iterations are presented in fig 4 e we can see that like the characteristic configuration the results for observations in a grid configuration show increasing convergence to zero as the spacing between adjacent observation points in the x and y directions decrease even the worst performing configuration 4 d has a relative error at the final iteration of o 1 0 2 this suggests that given the convergence criteria of a relative l 2 error lower than 10 each spacing considered in fig 4 convergences though it is clear the lower values δ x 0 07 and δ x 0 0785 perform better by an order of magnitude once again we note that these configurations both had 64 pairwise observations satisfying 4 1 whereas the ones with δ x 0 1 and δ x 0 2 had none confirming the hypothesis that 4 1 is a sufficient condition for convergence with a grid configuration for the two dimensional case while convergence with δ x 0 07 is marginally better for the grid configuration than the characteristic configuration they are both o 1 0 3 and we may consider them equivalent in performance thus far we note that these results are also consistent with the one dimensional theorem in kevlahan et al 2019 it should be noted however that in fig 4 most of the observations are placed within the support of the initial conditions this is a consequence of having a grid centred at the initial conditions support with only n o b s 36 and small spacing δ x and δ y between adjacent observations consequently in section 4 2 we investigate the effect of increasing the number of observation points and subsequently in section 4 3 the effect of removing all points that lie in the initial conditions support 4 1 3 observations along arcs current observations used for detection and forecasting of tsunamis such as dart buoys are usually arrayed in an arc like formation along coastlines gonzalez et al 1998 therefore we consider a circular arc configuration for observations as shown in fig 5 a d the observation points are placed along two concentric circles x 2 y 2 r i 2 for i 1 2 we vary the spacing δ r r 1 r 2 such that figs 5 a and 5 b satisfy 4 1 and figs 5 c and 5 d do not similar to the characteristic and grid configurations we observe in fig 5 e that the error does not converge for any of the values of δ r considered and is o 1 0 1 this is despite the fact that there are 14 pairwise observations satisfying 4 1 for δ r 0 07 and 8 pairs for δ r 0 0785 we present the reconstructed initial conditions for each δ r in fig 5 f i we observe that in each case the gaussian peak is not fully resolved and the amplitude is smaller than the exact initial conditions 0 05 additionally in each case there is small scale noise in the reconstruction in theory observations placed in concentric circles around the true initial conditions should be able to capture the radial propagation of the free surface wave in all directions however these results suggest that either small spacing between pairwise observations is not sufficient for convergence with an arc configuration or that a larger number of pairwise observations satisfying 4 1 is necessary in the following section we investigate the minimum number of observations necessary for convergence and assess whether convergence improves as we increase the number of observations in each of the three configurations 4 2 results with large or small number of observations in this section observe the convergence of the assimilation when the number of observation points is either large or small for the characteristic grid and arc configurations respectively the spacing δ x and δ r is fixed at the best performing case considered in section 4 1 δ x 0 07 or δ x 0 0785 we first show convergence for large n o b s and then subsequently investigate the minimum number of observations required for convergence for the grid and arc configurations we initially consider results for n o b s 1 0 2 1 2 2 1 4 2 respectively with δ x δ r 0 07 for the characteristic configuration we chose n o b s 60 80 100 and δ x 0 0785 the comparatively smaller values for the characteristic configuration are due to the fact that we required all observation points to interact with the propagating wave in the assimilation time t and this would not have been possible for larger values of n o b s placed along characteristics the results for the error convergence given a characteristic configuration of the observations are presented in fig 6 a we observe that the relative reconstruction error does not change significantly with the number of observation points and is o 1 0 3 we note that the same level of convergence was achieved with only 36 observations as seen in fig 3 e this is encouraging from a tsunami modelling perspective as it would suggest that a smaller observation network placed along characteristics is sufficient to recreate the initial conditions effectively the error convergence results for observations placed in a grid format with varying number of observation points are given in fig 6 b as with the characteristic configuration we observe that the convergence of the l 2 relative error does not significantly change for the large values of n o b s and is o 1 0 3 to determine whether having a large number of observations is a sufficient condition for convergence we consider results where n o b s 1 2 2 but δ x 0 44 we see from fig 6 e that the assimilation does not converge and therefore large n o b s is not a sufficient condition for convergence to verify whether it is a necessary condition for convergence we explore results when n o b s is small in section 4 2 1 we observed in fig 5 that unlike the characteristic or grid configurations the results for the arc configuration failed to converge for all spacings δ r consequently it would be of significant interest to see whether these results can be improved by increasing n o b s we present the configurations for n o b s 1 0 2 1 2 2 and 1 4 2 in fig 6 c the relative l 2 error converges to o 1 0 2 for each values of n o b s and consequently all three cases are convergent this result suggests that a relatively larger network of observations is required to fully resolve the initial conditions for arc configurations a rigorous verification would be to analyse results with a larger values of n o b s and δ r 0 2 however this is not possible with our current problem setup as a case where both n o b s and δ r or m i m j with a single circular arc are large enough such that no points satisfy 4 1 would result in some observations not interacting with the free surface wave in the assimilation time t 2 as the latter was chosen to prevent boundary effects from effecting the reconstruction it cannot be altered without impacting the results 4 2 1 results with small n obs in this section we investigate the minimum number of observation points required for convergence we have shown that when n o b s is large greater than 60 increasing the number of points does not have a significant impact on the convergence of the relative minimum error for the characteristic and grid configurations we now consider results when 4 n o b s 16 to determine if there is a significant increase in the relative l 2 reconstruction error when n o b s is small we do not consider n o b s 1 2 or 3 as the smallest number of points we can have while still having points positioned in each quadrant to capture the azimuthal symmetry of the initial conditions is 4 results for observations along a characteristic with n o b s 4 10 and 16 with spacing δ x 0 0785 are presented in fig 7 a d we observe that the minimum relative l 2 error is less than 1 for each case therefore we conclude that for the characteristic configuration the minimum number of observation points necessary to achieve convergence of an isotropic initial condition is n o b s 4 results for observations in a grid configuration for n o b s 2 2 3 2 and 4 2 are presented in 7 e h we observe that the relative l 2 error for all three configurations converges configurations with 2 2 and 4 2 have a minimum relative l 2 error of 5 and 3 respectively the best convergence is for n o b s 3 2 with a minimum error of 0 2 suggesting that convergence does not necessarily improve with an increase in n o b s even with a small number of observations to summarise we have demonstrated that convergence can be achieved for the characteristic and grid configurations with a relatively small number of points and does not necessarily improve as n o b s is increased and so we conclude that based on the results so far having a large number of observation points is neither necessary nor sufficient for convergence with observations in a grid or along two characteristics in the results observed thus far we note that for all cases that converge such as in fig 7 there were multiple observations inside the support of the initial conditions however there were no points within the initial conditions support for the arc configuration consequently we must consider whether convergence can be achieved for the characteristics and grid configurations when there are no observation points inside the support of the initial conditions in tsunami models it is unrealistic to assume such observations are available and thus a logistically applicable forecasting scheme should avoid such assumptions the results of this analysis are presented in section 4 3 4 3 results with no observations within the support of the initial conditions in this section we present results for the characteristic and grid configurations with points inside the initial conditions support removed the spacing δ x is fixed at the sufficient value for convergence of 0 07 as removal of these points results in smaller values of n o b s the initial number of n o b s before removal is increased slightly so that the resulting number of observation points are comparable to the results in section 4 2 first we consider results for small numbers of observation points such that δ x 0 07 and there are no points within the support of the initial condition in fig 8 we observe that even with n o b s 28 the configuration in fig 8 c with observations in a grid fails to converge when there are no points in the support of the initial conditions despite having converged when n o b s 4 in fig 7 e similarly a configuration of 16 observations along the characteristics x y fails to converge when there are no points within the support of the initial conditions as shown in fig 8 a consequently we investigate whether convergence can be achieved when n o b s is relatively large fig 9 a d shows the configurations and results for observations along characteristics with n o b s 48 68 and 88 after removal the relative l 2 error at the final iteration for each case is approximately 7 as shown in 9 d we note that the error is almost two orders of magnitude higher than it was in fig 6 a these results are not surprising as having observations that are able to measure the true initial conditions may significantly improve the reconstructed initial conditions it is therefore to be expected that convergence is slightly worse when such observations are no longer included in the assimilation however based on the tolerance that the relative l 2 error be less than 10 these results are still convergent the configurations and result for observations in a grid format are presented in fig 9 e h we note some significant differences between the results here and those in fig 6 b first it is clear from fig 9 h that there is improved convergence for cases with n o b s 80 suggesting that the number of observations is an important factor when we do not have observations in the support of the initial conditions in contrast the results in fig 6 b did not indicate difference in convergence for the different values of n o b s secondly the best convergence in fig 9 h is a relative l 2 error of approximately 0 1 indicating better convergence than observed in fig 6 b despite the overall number of observations being comparable it is interesting to note that in fig 6 b the error stagnated after approximately 400 iterations this suggests that perhaps there is some overfitting that results in small scale noise in the reconstructed initial conditions when there are too many observations of the true initial conditions this would impact the convergence of the gradient descent algorithm used in the data assimilation in comparison in fig 9 h we observe that the error is still maintaining a negative slope even at the final iteration suggesting improved convergence to verify this hypothesis fig 10 shows the energy spectra of the relative absolute error of the reconstructed initial conditions for configurations 6 b and 9 h with n o b s 144 and n o b s 132 respectively we can see that the energy of larger wavenumbers in the reconstruction error ϕ t ϕ b ϕ t l 2 is higher for configuration 6 b verifying our initial hypothesis regarding small scale noise present in the reconstruction that impacted convergence on the other hand the energy of the error spectrum for configuration 9 h is mostly restricted to smaller wave numbers this may explain why the latter showed convergence of the l 2 error to 0 1 whereas the former converged to 0 3 in summary we conclude that a necessary but not sufficient for all configurations condition for convergence is that δ x be small enough that the euclidean distance between some pairwise observations satisfies the condition 4 1 the convergent configurations for the grid configuration in fig 4 had 64 pairwise observations satisfying the spacing condition 4 1 while the non convergent cases with spacing δ x 0 1 had none similarly the non convergent arc configurations in fig 5 had at most 14 pairwise observations with a euclidean distance less than 0 0785 this may suggest that there is a minimum number of pairwise observations required that satisfy the spacing condition 4 1 however as the minimum spacing observed in this analysis is a qualitative estimate and not analytically derived we cannot conclusively quantify the minimum number of observations based on this value alone additionally we observed that much larger numbers of observations were required for convergence in the arc configuration and this was also true for the grid configuration when observations inside the support of the initial conditions were removed in fact we found that the assimilation error was lower in the grid configuration when there were no observations within the support of the initial conditions this is likely due to overfitting generating small scale noise in the reconstructed initial conditions as shown in fig 10 to extend these results for more realistic conditions we conducted equivalent analyses with the anisotropic initial conditions given in 3 12 4 4 results for anisotropic initial conditions we have observed convergence for each of the observation point configurations considered in this study characteristic grid and arc by varying the spacing between observations and the number of observation points we have also demonstrated convergence even when there are no observations within the support of the initial conditions we now verify whether convergence is still achieved with anisotropic initial conditions our goal is to investigate the observability at measurement points when the surface wave is no longer azimuthally symmetric and contrast with results for isotropic gaussian initial conditions our aim is to provide results that are more comparable with realistic scenarios for tsunami observations where the both the initial conditions and bathymetry produces highly anisotropic surface waves briefly we found that there was no significant impact on convergence with anisotropic initial conditions as given in 3 12 compared to results in section 4 3 the convergence of the relative l 2 error for each of the three configurations is presented in fig 11 we observe that the convergence of the relative l 2 error for the characteristic and arc configurations is o 1 0 2 and there is little difference between results with different values of n o b s the convergence for the grid configuration is o 1 0 4 with n o b s 208 and o 1 0 3 for the other values of n o b s 4 4 1 summary of main results for observation configurations flat bathymetry to summarise the main results we have observed are as follows convergence was achieved a relative l 2 error less than 10 for each of the three configuration with both isotropic and anisotropic initial conditions respectively the best convergence in the present analysis was achieved with observations placed in a grid formation even with no points inside the initial conditions support the relative l 2 error in the reconstruction error was 0 1 with both isotropic and anisotropic initial conditions convergence was achieved for the characteristic and grid configurations with as few as 4 observation points the minimum number required to capture the azimuthal symmetry of the initial conditions a necessary condition for convergence was that the spacing δ x for grid and characteristic configurations be chosen such that at least some pairwise observations satisfy 4 1 however convergence was not achieved for the arc configuration even with small δ r the difference between radii of observations placed in two concentric circles suggesting this is not a sufficient condition for convergence or there is a minimum number of pairwise observations with a euclidean distance satisfying 4 1 which the arc configuration did not satisfy having only 14 such points whereas the convergent results for the grid configurations in fig 4 had 64 such pairwise observations increasing the number of observation points improved convergence of the arc configuration but had little effect on the grid and characteristic configurations when there were points placed inside the initial conditions support however without any observations in the support of the initial conditions larger numbers of observations n o b s resulted in improved convergence with the grid configuration and even surpassed convergence achieved in the former case points inside initial conditions support this suggests that observations of the true initial conditions can lead to overfitting and small scale noise in the reconstruction as demonstrated in fig 10 5 results with non zero bathymetry we now consider results for simulations where the bathymetry is no longer flat bathymetry can have a significant impact on propagating shallow water waves where wave speed c g h changes as depth h varies a tsunami s energy flux remains relatively constant and so as the tsunami s speed varies so does wave height shoaling effects the purpose of this section is to take the best results observed thus far and integrate them into a more realistic model adding some features of an operational tsunami forecast model to this end we limit our results to n o b s 88 even though we observed higher convergence with a greater number of n o b s for example in fig 9 h there are practical difficulties in employing such dense observation networks therefore we limit the maximum number of observation locations on the basis that convergence of the relative l 2 error to o 1 0 2 in the initial conditions reconstruction was achieved with 88 points in each of the three configurations considered in this study we begin with a simple gaussian bathymetry model simulating peaks and basins and then subsequently extend our analysis to a subsample of etopo2 a digital database of land elevation and sea floor topography where the datum represents the vertical deviation in metres from the mean sea level 5 1 gaussian bathymetry in this section we analyse results with the gaussian bathymetry described by 5 1 β x y 3 10 exp x 0 5 2 y 0 1 2 0 6 5 2 3 10 exp x 1 2 y 0 5 2 0 7 2 3 10 exp x 0 75 2 y 1 2 0 6 5 2 3 10 exp x 0 8 2 y 0 7 2 0 2 2 where a representation is given in fig 12 this shape was chosen as it contains gaussian peaks that are 30 of the average depth h and with varying widths simulating underwater mountains additionally a negative gaussian represents a basin and all features are placed such that there are relatively quick changes in the depth within the assimilation time t the amplitude of the true initial conditions is set to 0 001 h in order to accurately simulate tsunami conditions where amplitude of the surface wave in the deep ocean can be just a few metres depending on the generating mechanism we demonstrate the effect of the bathymetry on the free surface propagation in fig 12 where fig 12 c is the free surface wave η x y t at t t with a flat bottom bathymetry and fig 12 d is the free surface η x y t β x y at t t with the bathymetry given in 5 1 we observe in fig 12 d that due to bathymetry effects we no longer have azimuthal symmetry in the free surface wave propagation and the wave amplitude is higher at positions close to 1 1 and 3 2 3 2 this suggests the influence of the peaks in fig 12 a similarly the amplitude of the wave is slightly damped in the first quadrant indicating the effect of the basin the results with isotropic initial conditions and no points inside the initial conditions support are shown in fig 12 h we note that observations placed along the lines x y can no longer be referred to as observations placed along characteristics as these are no longer characteristics of the distorted wave due to bathymetry effects however we include the configuration to demonstrate convergence when observations are placed along lines in each case we have n o b s 88 and δ x δ r 0 07 we observe that the grid configuration has the best convergence of the relative l 2 error at 0 5 the results for the line and arc configuration also converge however with a larger error of 5 there is a relative decrease in convergence compared to results for with a flat bottom bathymetry as shown in section 4 3 this is most likely due to the fact that there is no longer azimuthal symmetry in the surface wave propagation and not all observation points are able to capture the interaction of the free surface wave with localised bathymetry despite this we note that results for each case do converge this is encouraging considering our results included effects of localised bathymetry features with amplitudes as much as 30 of the fluid depth another possible reason for convergence is that the amplitude of the initial conditions is relatively small which would mitigate wave breaking effects that could hinder convergence we now investigate whether similar results can be observed with realistic bathymetry 5 2 etopo2 bathymetry etopo2 is a database of two minute global relief data hosted by the national geophysical data centre at noaa 2006 this is an amalgamation of data collected via multiple sources including satellite altimetry observations and shipboard echo sounding measurements noaa national geophysical data center 2006 the grid values represent elevation at the cell edges averaged over the cell area the horizontal grid spacing is 2 min of latitude and longitude where 1 min of latitude represents 1 853 km at the equator and the vertical precision is 1 m where z 0 represents the mean sea level for the current analysis a square sub interval of the etopo2v2c database was chosen within the specified latitude and longitude limits 15 s 25 s and 90 e 100 e respectively this is equivalent to a rectangular grid of approximately 1100 km 1100 km accounting for slight differences between degrees of longitude due to the equatorial bulge where the maximum variation is approximately 60 km this bathymetry section represents the wharton basin a topographical feature in the ocean floor located off the western coast of australia it was chosen because it includes both basin and ridge features and because of the relative ease with which periodic boundary conditions could be implemented additionally it has been a documented source for seismic activity and strike slip events such as the 2012 and 2016 events in the region as most earthquakes are of strike slip mechanisms such events are potential sources of tsunamis in the wharton basin heidarzadeh et al 2017 a visual representation of the region and a relief map as taken directly from the etopo2v2c database are given in fig 13 a and 13 b in order to find classical solutions of the shallow water equations we require the bathymetry β x y and its first derivative to be smoother than the raw etopo2 data additionally we require periodic boundaries thus the boundaries are artificially padded with zeros and a low pass filter is used to damp all frequencies after the lowest 5 modes to zero a moving average filter was implemented to remove sharp curves at the boundaries using the matlab smooth function the control time t was adjusted so that the free surface wave does not actually reach the padded boundary region the average depth h 5000 m was normalised to 1 and the length scales adjusted to l l in both x and y directions the amplitude of the initial conditions was set to 0 001 h equivalent to 5 m the smoothed and scaled relief map and 3 d plot of the bathymetry can be seen in fig 13 c and 13 f we implement the data assimilation for observations along the lines x y a grid and an arc with isotropic initial conditions and anisotropic initial conditions respectively figs 13 d and 13 e show the free surface wave at the final time t for each initial conditions case the effect of the bathymetry on the free surface wave is relatively small compared to the flat bottom case in fig 12 c than for the gaussian bathymetry as in fig 12 d however we note that the highest amplitude in the etopo2 bathymetry as shown in fig 13 c is only approximately 0 06 which is significantly less than the bathymetry in 5 1 nevertheless we observe slightly deeper troughs in the free surface wave indicated by the dark blue regions in 13 d which are indicative of bathymetry effects we conclude that changes in the wave speed due to the bathymetry structure may result in different coastal communities having varied arrival time and wave energy the observation configurations and results with isotropic initial conditions and anisotropic initial conditions are presents in fig 14 for the isotropic initial conditions we see in fig 14 d that the lowest relative error is for the grid configuration with a minimum error of 0 3 the straight line configuration has minimum a relative error of 5 and thus is convergent however as in the idealised case with gaussian bathymetry it is again the worst performing configuration the results for the arc configuration are a bit better than those observed for the gaussian bathymetry with a minimum error of 5 subsequently we conclude that the main results of this study extend to realistic bathymetry such as the smoothed topography of the wharton basin we consider analogous results with a anisotropic initial conditions in fig 14 e h the main trends in the relative l 2 error shown are similar to the results with isotropic initial conditions as shown in fig 14 d in that the grid formation has the lowest minimum relative error 0 2 however in this case the straight line configuration performs better than observations along the arc although both are convergent this is not surprising as we have already observed in section 4 4 that the arc and straight line configurations show relatively worse convergence with a radially asymmetric surface wave and bathymetry features the main difference across the two cases is the relatively better performance of the straight line formation nevertheless overall convergence for both isotropic and anisotropic initial conditions is relatively equivalent 6 conclusion and further considerations in this study we implemented a data assimilation scheme for the two dimensional swe to reconstruct the initial conditions using observations of free surface wave height our objective was to investigate configurations of observations that minimise the reconstruction error in the presence of increased complexity compared to one dimension these new features include curved non linear wave fronts and bathymetry features we did this by comparing cases where observations satisfied the minimum distance criterion 4 1 between pairwise observations kevlahan et al 2019 and when they did not we compared observations placed along straight lines i e characteristics of the surface wave with isotropic initial conditions and flat bathymetry in a grid array and along concentric arcs we analysed the effect of a small or large number of observations and the effect on convergence when observations inside the initial conditions support were removed the algorithm was implemented for both isotropic and anisotropic true initial conditions both with both flat and non flat bathymetry summarising the main results we observed that a necessary but not sufficient condition for convergence was that some of the pairwise observations are sufficiently closely spaced to observe the minimum lengthscales of the initial condition i e satisfy eq 4 1 while this confirms results from the one dimensional case in part the main difference is that for the one dimensional assimilation the spacing condition 4 1 was sufficient for convergence we have demonstrated that this is not the case as for results in fig 5 in the two dimensional assimilation and we may require a minimum number of points satisfying 4 1 in order to achieve convergence this could be due to the need to capture the shape of true initial conditions with higher dimensionality we recall that eq 4 1 was not analytically derived for the two dimensional case and therefore is not expected to account for its complexities nonetheless it is a useful reference tool for the qualitative analysis in this study for the arc configuration we observed that a higher number of observations was necessary for convergence whereas convergence was achieved for the straight line and grid configurations with as few as 4 observation points however small n o b s was insufficient for convergence when there were no observations within the support of the initial conditions increasing the number of observation points improved convergence for the grid and characteristic configurations when observation points were removed from the support of the initial conditions the grid configuration showed the best convergence of the relative l 2 error in the reconstructed initial conditions we concluded that observations are not required within the support of the initial conditions and that this can actually degrade the results due to over fitting the error was o 1 0 4 with a flat bottom bathymetry and o 1 0 3 with a gaussian bathymetry and bathymetry from the etopo2v2 database convergence was slightly worse for the characteristic configuration with anisotropic initial conditions and when bathymetry features were included but overall all configurations showed convergence a relative error in the reconstructed initial conditions less than 10 with 88 observations for both isotropic and anisotropic initial conditions and with bathymetry the main results for the analyses conducted in this study are summarised in table 2 we now consider the feasibility of integrating these idealised findings with a realistic tsunami model the primary questions are 1 is it realistic to assume that we have a sufficient number of observations for convergence int the case of a grid of observations centred on the initial conditions 2 is it realistic to have a sufficient number of observations of surface wave heights for potential locations of initial conditions i e associated with known seismically active regions addressing these we note that the most destructive tsunamis are those generated by shallow earthquakes with epicentres along fault lines of these tectonic subduction at the plate boundaries are the most likely causes of tsunamis and subsequently their position coincides with the support of the initial conditions schellart et al 2011 provide a comprehensive overview of global subduction sites as well as the velocities of the respective plates concentrating observations around subduction zones may sufficiently capture the propagation of waves triggered by seismic events originating here however this is not necessarily exhaustive as we have indicated the wharton basin which does not lie on a subduction zone is a potential zone for small tsunamis due to strike slip earthquakes heidarzadeh et al 2017 and there are many such regions however the most destructive tsunamis in recent history such as the 2004 indian ocean tsunami have been due to earthquakes with epicentres falling on subduction zones and hence merit primary focus the scope of positioning observations at all possible such locations brings us to the logistical feasibility of such configurations angove et al 2019 provide a comprehensive review of the major limitations to accurate tsunami forecasts today and detail key areas where uncertainties associated with observing tsunamis can be quantified and reduced they highlight the need for updated methods to accurately capture initial displacement and detail possible solutions such as using data from the ever expanding global navigation satellite system gnss bottom pressure recorders bprs and limited area cabled observation systems they conclude that instrumenting commercial fibre optic cables with bprs and accelerometers is the most promising approach but it comes with complexities and costs that cannot be covered by scientific revenue streams alone this is especially problematic when we consider that requiring observation configurations around subduction zones with the highest probability of tsunamis occurring requires a large number of observations in the present analysis we have demonstrated convergence with n o b s 88 placed around a single source of potential tsunamis and in reality there are several such regions however as we previously noted innovative methods have already been introduced to generate observations even when existing networks are relatively sparse for example introducing virtual observation data interpolated from neighbouring real observations as demonstrated by wang et al 2019 these methodologies can be implemented to pad the existing observational network such that requirements for n o b s are satisfied additionally there have been significant advancements in altimetry observations taken from geospatial satellite data angove et al 2019 note that the process to constrain a tsunami source from altimetric data is similar to that currently employed and has the advantage of providing both spatial and temporal variation not present in the static time series reported by tsunameters despite this they stipulate that due to limitations in sensitivity limited satellite coverage and extended data processing times operational use of satellite altimetry in real time tsunami forecasting has not been a viable solution to date however improvements in remote sensing of ocean waves using altimetry have come a long way since the geodynamics experimental ocean satellite 3 geos 3 satellite was first launched in 1975 even then remote sensing of ocean wave height from space was predicted to provide a quantum increase in forecasting capabilities barrick and fedor 1978 recent projects such as the esa s globwave project 2010 2013 have expanded upon this by providing access to consolidated datasets on ocean waves to the scientific community for the purpose of modelling and forecasting in 2017 the copernicus marine environment monitoring service cmems released the first real time global wave product containing wave height data collected via multiple satellites available within three hours of acquisition additionally these observations have been collected and made accessible for forecasting models as in ribal and young 2019 with a global spatial resolution of 7 km 7 km the observation network is very similar to the optimal grid configuration observed in this study and thus has the potential to generate similar results while tsunami waves are characteristic of relatively small amplitudes smith et al 2005 demonstrated that it is still possible to measure tsunamis using altimetry data and restrictions for forecasting in real time were due to the delay in access to data with innovated products such as the cmems data sets accessible in under three hours these restrictions can be mitigated and real time forecasting capabilities for tsunamis using altimetry data are on the horizon ultimately the efficacy of such modelling frameworks in a realistic setting also depends on related factors not considered in the present work such as positioning of observations such that detection time of tsunami waves is optimised ferrolino et al 2020 demonstrate a promising methodology using population based algorithms that optimises placement of deep ocean sensors around subduction zones and finds the minimal time it takes for the disturbance on the source to arrive at sensor locations while this work does not focus on reconstruction of missing initial condition information or wave accuracy as it propagates away from the source it is nonetheless a necessary consideration for realistic tsunami observational needs earlier detection can potentially mitigate the delay in receiving and processing altimetry data as this work is restricted to the extension of the results in kevlahan et al 2019 to two dimensions future development would benefit from considering the observability framework outlined by kang and xu 2014 and king et al 2015 this may provide a more rigorous mathematical justification for optimal two dimensional configurations of observations we recall that the mathematical proof of theorem 4 1 is applicable only for the one dimensional case and consequently the results shown here are qualitative a similar concept to the minimum distance criterion considered here was provided in hinson 2014 where a lower bound on the radius of attraction to satisfy observability was found future work aimed at determining optimal configurations of observations in two dimensions would benefit from exploring the effects of placing sensors within and outside this observability radius the analysis provided here can also be made more rigorous by considering the well posedness of the inverse problem and the possible issues of non uniqueness and discontinuities in the mapping used to reconstruct missing parameters such as initial conditions from the model and observations these considerations are addressed in detail by navon 1998 where regularisation methods such as tikhonov regularisation inclusion of background information and sensitivity analyses are suggested to address such issues and to identify influential parameters within the system subsequently a next step for this work would be to conduct sensitivity analyses as in kevlahan and khan 2020 and khan and kevlahan 2021 and to include regularisation and background information terms in the cost function optimisation global optimisation may be a more efficient and reliable method to minimise the cost function than the gradient minimisation method used here in particular global optimisation may avoid the algorithm getting stuck in a local minimum ferreiro ferreiro et al 2020 consider a similar problem for tsunami models where the shallow water model is discretised using a positivity preserving second order path conservative finite volume scheme and the data assimilation problem is posed in a global optimisation framework our work is based on the optimise then discretise approach and our goal is to extend the methodology derived in kevlahan et al 2019 to two dimensions therefore data assimilation with a global optimisation algorithm is outside the scope of the current work however realistic extensions of our results may benefit greatly from the automatic data assimilation methods provided by ferreiro ferreiro et al 2020 in conclusion we have developed a two dimensional variational data assimilation algorithm for reconstruction of initial conditions of surface waves with the primary aim of extending the results of the one dimensional variational assimilation outlined in kevlahan et al 2019 we have confirmed the feasibility of variationally data assimilation for tsunami waves in idealised 2d configurations and have qualitatively demonstrated the necessary and or sufficient conditions for convergence of the reconstructed initial conditions to the true shape we have analysed different configurations of observations their spacing and their number with a variety of bathymetry and initial conditions importantly we have extended the one dimensional results regarding necessary conditions for the maximum distance between pairwise observations as given by eq 4 1 i e resolving the smallest scales of initial surface displacement and have additionally shown that for the two dimensional case this is not a sufficient condition we have demonstrated that when there are no observations within the support of the initial conditions a sufficiently large number of observations is a necessary condition for convergence based on these criteria we have shown that convergence can be achieved for observations arranged in straight lines grids and along concentric circular arcs for both isotropic and anisotropic initial conditions and with realistic bathymetry data with advances in altimetry observation data availability and accuracy there is scope to use these results for more accurate tsunami models with real observation data credit authorship contribution statement r a khan conceptualisation methodology formal analysis software data curation writing original draft visualisation investigation n k r kevlahan supervision conceptualisation methodology validation writing review editing funding acquisition declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgements we would like to thank dr bartosz protas for his ongoing contribution and feedback on this research additionally we would like to thank dr laurent debreau and dr arthur vidard at the laboratoire jean kuntzmann for their suggestions funding this project was funded by the nserc canada discovery grant of dr nicholas kevlahan and research exchange at the laboratoire jean kuntzmann was facilitated by the mcmaster cnrs canada fund travel grant 
