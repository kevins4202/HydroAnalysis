index,text
23825,oceanic melting beneath ice shelves is the main driver of the current mass loss of the antarctic ice sheet the resultant meltwater plumes influence the basal melting of ice shelves and contribute to the development of the unique two layer stratified ice shelf ocean boundary currents underlain by warmer saltier and stationary source waters however knowledge of the dynamics and thermodynamics within these meltwater plumes controlling the heat available for melting ice remains outstanding here we investigate that important issue by developing a 2 5 dimensional nonhydrostatic vertical slice model with 1 5 m vertical resolution and conduct the reference run based on a representative ice shelf water isw high salinity shelf water hssw boundary current beneath the amery ice shelf east antarctica based on that we identify two dominating vertical thermal processes regulating the local temperature the turbulent diffusion and the shear instabilities induced convection i e vertical advection and carry out a quantitative thermal budget analysis in the framework of plume model including deriving an analytical expression for the entrainment induced heat flux moreover after evaluating the entrainment parametrizations it is suggested that the common assumption of neglecting the velocity at the lower boundary of meltwater plume potentially leads to a considerable deviation from the real entrainment the sensitivity of the simulated results to model configuration and model resolution are also investigated the findings in this study imply that we need to improve the model resolution of current ocean cavity models to capture the interfacial processes between lighter denser waters keywords ice shelf boundary current thermal processes stratification entrainment numerical modeling 1 introduction antarctic ice shelves the floating parts of the marine terminating ice sheets have been profoundly thinning which is likely related to their accelerated basal melting in recent decades paolo et al 2015 the interactions of underlying ocean with ice shelves responsible for the basal melting are imperative for mean sea level rise since the shelves provide a buttressing backstress on vast amounts of inland ice bell and seroussi 2020 increased heat flux to the base of warm water ice shelves in west antarctica arising from the on shelf transport of circumpolar deep water cdw has become an increasing source of concern for the community dutrieux et al 2014 jenkins et al 2018 the high salinity shelf water hssw driven melt generally occurs by contrast within the cold water cavities such as for three major ice shelves the filchner ronne ross and amery ice shelves ais adusumilli et al 2020 that is because hssw can effectively block offshore cdw from getting onto the continental shelf holland et al 2020 but which is thus vulnerable to any decrease in polynya activity that allows cdw to enter the cavity gwyther et al 2020a the coastal polynya formation by persistent offshore wintertime winds and ensuing ice production leads to brine rejection and the generation of hssw on the continental shelf herraiz borreguero et al 2016 dense hssw accesses the cold water cavities with little modification along the retrograde bed slope towards the grounding zones jacobs et al 1992 for either warm or cold water ice shelves when cdw or hssw arrives at the grounding lines it causes basal melting because of positive thermal forcing and the formation of glacially modified water gmw naveira garabato et al 2017 or ice shelf water isw respectively both water masses are relatively fresh but the former is above and the latter is below the surface freezing point these buoyant plumes ascend along the ice shelf base and continue to melt the ice shelf base owing to the fact that the heat source of warm water ice shelves cdw is typically several degrees warmer than that of cold water ice shelves hssw the warm water ice shelves generally experience much higher basal melting rignot et al 2013 unless the cold water ice shelves are exceptionally deeply grounded ais a representative cold water ice shelf embedded in the prydz bay east antarctica has the potentially deepest groundling line 2500 m in the southmost inland yang et al 2021 consequently the dramatic drop in the melting point at several kilometers depth generates a large difference i e thermal forcing between in situ ocean temperature and local melting point which drives a comparable local basal melt to that of warm water ice shelves adusumilli et al 2020 the ice shelf basal melting crucially controls the mass balance dynamics and thus stability of antarctic ice sheets pritchard et al 2012 pattyn and morlighem 2020 one of the pivotal questions for basal melting is how heat is vertically transported from the lower heat reservoirs of hssw or cdw into the upper plumes however knowledge of this process is lacking due to the inaccessibility of the underside of deep parts of ice shelves sugiyama et al 2014 begeman et al 2018 and the restriction of vertical resolution of ocean cavity modeling gwyther et al 2020b 2 motivation the inland deep part of antarctic ice shelves several kilometers away from the grounding zones generally have the overall steepest basal slope o 10 2 fretwell et al 2013 in view of this despite the absence of direct observational evidence a handful of simulated results obtained by plume models holland et al 2007 payne et al 2007 and regional coupled ice shelf ocean models galton fenzi et al 2012 dansereau et al 2014 have indicated that vigorous meltwater gmw or isw plumes o 10 1 m s 1 originates from the strong melting near grounding lines rignot and jacobs 2002 wen et al 2010 and or the subglacial freshwater outflows at grounding lines jenkins 2011 wei et al 2020 the process of that swift flow has tended to be dominated by the plume theory which was first applied by macayeal 1985 and was then first developed into a simple one dimensional model of meltwater plume treated as a turbulent gravity current by jenkins 1991 hereinafter referred to as j91 the renowned meltwater plume model of j91 has hitherto been extensively used to study diverse aspects of ice shelf ocean interactions jenkins 2011 jenkins and bombosch 1995 parizek and walker 2010 holland and feltham 2006 cheng et al 2017 2019 however almost all the studies listed above routinely supposed every property as well as the velocity within the plume except at its vertical boundaries to be vertically uniform because of which the adopted plume models cannot represent a continuous pycnocline see e g fig 1 in j91 such a simplification of two layer system characterized by an intermediate break in all properties had never been substantially improved until the pioneering work of jenkins 2016 by developing a vertical one dimensional model with the assumption of constant eddy viscosity diffusivity jenkins 2016 first gained fundamental insights into the vertical structure of the ice shelf ocean boundary current iobc that consists of an interior ekman layer and a geostrophic flow below lately cheng et al 2020 extended the model of jenkins 2016 by incorporating a frazil ice module and k ɛ turbulence closure to underscore the influences of frazil induced stratification on the vertical structure of the iobc even so restriction to only the vertical dimension is a severe limitation in that the nonlinear horizontal advection terms are all inevitably neglected jenkins 2016 consequently the vertical heat transport by the convection i e vertical advection inherent with the shear instabilities engendered at the interface between the two layer waters cannot be resolved by vertical one dimensional models nevertheless the mechanism by which heat is transferred from the ambient waters to the interior of the stratified iobc crucially sets the meltwater properties and in turn constrains the ice shelf basal melting which has received little attention as of now it is worth mentioning that even though the meltwater plumes are discernible in some coupled ice shelf ocean simulations the detailed representation of corresponding vertical heat transport is extremely constrained by their vertical resolution galton fenzi et al 2012 liu et al 2017 on the other hand considering the inability of resolving the shear instabilities that drive heat transport in coarse resolution models used for pan antarctic studies one must resort to an entrainment parameterization involved in a plume model bo pederson 1980 originally derived an entrainment parameterization for stream tube models which is essentially the same as that adopted in holland and feltham 2006 hereinafter referred to as hf06 1 e e 0 u c d r i and 2a r i g d u 2 2b g δ ρ g ρ p a i ρ g ρ 0 where e is the entrainment velocity e 0 is a dimensionless constant u is the plume velocity c d is the drag coefficient r i is the bulk richardson number d is the plume thickness and g is the reduced gravity δ ρ is the nondimensional density deficit ρ p a i is the density at the plume ambient interface pai which is defined later ρ is the depth averaged denoted by the overline and over the whole plume thickness plume density ρ 0 1030 kg m 3 is the reference seawater density g 9 81 m s 2 is the gravitational acceleration based on the momentum balance that is the balance between the buoyancy and friction terms and assuming the plume velocity rapidly adjusts towards an equilibrium value a simplified version of eq 1 was used in the seminal j91 model as 3 e e 0 u s i n α where α is the ice shelf basal sloping angle and j91 suggested a value of e 0 0 036 in view of the extensive applications of j91 model eq 3 along with the canonical value of e 0 0 036 was frequently adopted however without any validations thus far to this end it is of paramount importance to examine the validity of the entrainment parameterizations in the existing meltwater plume models the plume velocity u adopted in the entrainment parameterizations is intrinsically the velocity drop i e relative plume velocity that can be from the bulk plume velocity to the velocity at the pai hf06 however in the conceptual framework of meltwater plume models the vertically uniform plume velocity is supposed to be abruptly decreased to zero because of the supposedly stationary ambient waters in other words the velocity at the pai is to the best of our knowledge seldom taken into account in the entrainment parameterizations of all the existing meltwater plume studies which potentially means that the estimated entrainment rates deviate significantly from the realistic values therefore there are real gaps in our understanding of the dynamics and thermodynamics within the boundary current abutting the ice shelf base particularly for the deep inland part of ice shelves because of the inaccessibility here we present a 2 5 dimensional nonhydrostatic vertical slice model developed based on the prototype of kämpf 2010 with first ever high vertical resolution 1 5 m compared with that used in the existing coupled ice shelf ocean models to investigate in detail a variety of thermal processes responsible for the heat content of this unique boundary current it is worth mentioning that to our knowledge the minimum vertical spacing used by full cavity simulations to date to be 0 1 m in both yeager 2018 and gwyther et al 2020b but which only corresponds to the upmost mesh or grid layer and the mean and maximum vertical spacing are 10 and 23 m in yeager 2018 and 2 and 5 m in gwyther et al 2020b respectively in addition our 2 5 dimensional nonhydrostatic model is designed to persistently follow the plume as it evolves downstream by using the cyclic lateral boundary conditions here a presumed rising rate of melting point with time is accordingly applied elucidated later to take into account the accompanying continuously elevated melting point owing to the release of pressure 3 model the stratified iobc system of two layer waters is illustrated in fig 1 the vertical profiles of velocity and seawater density no longer unrealistically break at the pai but rather continuously vary within that interface with steep gradients of velocity strong shear and density strong stratification the model adopted here compatible with the unique aspects of the current system is a 2 5 dimensional extension of the vertical one dimensional iobc model developed by jenkins 2016 2021 the rotated coordinate system used in the model is depicted in fig 1 i e x parallel to the principal slope of ice shelf base upslope y perpendicular to the principal slope across slope and z normal to the ice shelf base the depth it is important to state that the total water column thickness is assumed to be large enough that the vertical domain can be regarded as the near ice base zone which is not affected by the seabed boundary as such the cavity scale overturning caused by the buoyant meltwater plume jourdain et al 2017 and even the far field controls from open ocean changes sun et al 2019 cannot be considered in this model even so following jenkins 2016 2021 in the later sensitivity tests we introduce a geostrophic velocity driven by the background pressure gradient that can provide additional current shear and makes the iobc stronger 3 1 governing equations the seawater density ρ is described by 4 ρ ρ 0 1 χ s s s 0 χ t t t 0 where t is the temperature s is the salinity t 0 2 c and s 0 34 5 are the reference temperature and reference salinity respectively χ t 3 87 10 5 c 1 and χ s 7 86 10 4 are thermal expansion and haline contraction coefficients combined with the continuity equation the 2 5 dimensional with gradients of variables in the y direction assumed to vanish extension of the vertical one dimensional momentum equations adopted from in jenkins 2016 2021 are 5 u x w z 0 6 u t u u x w u z 2 ω cos θ c o s β w ϕ v ρ a ρ ρ 0 g s i n α g c o s α η x g ρ 0 c o s α z 0 ρ x d z 1 ρ 0 q x x a h u x z a z u z 7 v t u v x w v z ϕ u 2 ω c o s θ s i n β c o s α s i n θ s i n α w x a h v x z a z v z and 8 w t u w x w w z 2 ω c o s θ s i n β c o s α s i n θ s i n α v cos θ c o s β u 1 ρ 0 q z x a h w x z a z w z where u v and w are components of the current vector in the x y and z directions respectively q is the nonhydrostatic pressure t is time ρ a is the ambient hssw density a h is the horizontal along x y plane eddy viscosity and is set to 0 01 m2 s 1 here a z is the vertical along z direction eddy viscosity and is calculated here by the k ɛ model rodi 1993 shown later ω is the magnitude of earth s rotation θ is latitude β is the angle between northward and positive across slope directions ϕ 2 ω c o s θ s i n β s i n α s i n θ c o s α is the coriolis parameter and η is the instantaneous deviation of ice shelf base from its equilibrium position z 0 m following jenkins 2016 2021 the gradient of η i e η x in our 2 5 dimensional model can be treated as a constant background far field geostrophic flow the conservation equations for t and s are 9 t t u t x w t z x k h t x z k z t z and 10 s t u s x w s z x k h s x z k z s z here the vertical eddy diffusivity k z a z p r z the vertical prandtl number p r z 0 7 1 10 r i g 0 5 1 10 3 r i g 1 5 is calculated by the classic formulation of munk and anderson 1948 r i g g c o s α ρ 0 ρ z u z 2 v z 2 is the gradient richardson number to the best of our knowledge there is little literature to guide the determination of the horizontal prandtl number to avoid increasing the uncertainty in our model configuration the horizontal eddy diffusivity k h is thus assumed to equal a h hf06 and derivatives thereof the k ɛ model is exploited here to characterize the turbulence conditions within the plume the corresponding governing equations for both turbulent kinetic energy k and its dissipation rate ɛ are given by 11 k t u k x w k z z a z σ k k z p s p b ɛ 12 ɛ t u ɛ x w ɛ z z a z σ ɛ ɛ z ɛ k c 1 ɛ p s c 3 ɛ p b c 2 ɛ ɛ 13 p s a z u z 2 v z 2 14 p b a z g ρ 0 c o s α ρ z and 15 a z c μ k 2 ɛ where p s is the vertical shear production that has been demonstrated to dominate the turbulent kinetic energy budget near the ice shelf base begeman et al 2022 p b is the buoyant production destruction σ k 1 4 and σ ɛ 1 3 are the schmidt numbers for the eddy diffusivity of k and ɛ respectively c μ 0 09 c 1 ɛ 1 44 c 2 ɛ 1 92 and c 3 ɛ 0 8 are constants all the governing equations above are discretized in finite difference form of which the coriolis terms are treated using a semi implicit scheme the nonlinear advection convection terms are discretized based on the total variation diminishing tvd schemes and the nonhydrostatic pressure q is solved using the successive over relaxation s o r method see kämpf 2010 for more details 3 2 boundary conditions the gradients of all quantities vanish at the lower boundary and the upper boundary conditions that is at the ice shelf ocean interface are the same as those set in cheng et al 2020 so only a relatively brief outline is presented here the nonslip condition is applied for u and v w is set to equal the opposite of basal melt rate m 0 that is directly calculated by the commonly used three equation formulations describing the thermohaline equilibrium conditions within a thin viscous sublayer adhering to the ice shelf base holland and jenkins 1999 nevertheless the flow divergence at the ice base can be neglected in the time scale considered here since m is so much typically six orders of magnitude smaller than the other velocities jenkins 2016 2021 the upper boundary conditions for t and s can be specified by their corresponding fluxes that can also be dictated by the three equation formulations intrinsically following the conservation of t and s within the viscous sublayer following wu et al 2000 we set k and ɛ at the ice shelf base as k u 2 c μ 0 5 and ɛ u 3 κ δ z where u is the shear velocity κ 0 4 is von kármán constant δ z is the vertical grid spacing in an attempt to make the boundary current system evolve endlessly we use the cyclic lateral boundary conditions kämpf 2010 that is 16 ψ j 0 ψ j n x 17 ψ j n x 1 ψ j 1 where j is the index of grid point in the x direction n x is the corresponding total grid point number and ψ stands for any quantity of concern the utilization of eqs 16 and 17 thus implies the model is designed to follow the evolving plume as it is advected by means of the cyclic boundary conditions rather than to focus on the plume evolution in a fixed box besides eqs 16 and 17 also indicate that the lateral gradients of the variables at the inlet ψ j 1 ψ j 0 ψ j 1 ψ j n x and outlet ψ j n x 1 ψ j n x ψ j 1 ψ j n x of our domain are equal rather than the values of the variables i e this is a periodic neumann condition not a periodic dirichlet condition lastly the rise of melting point in our limited along slope domain presented later is considerably constrained underneath a shallowly sloped ice shelf base to this end in order to consider continuously elevated melting point in our model and in light of the linear ice shelf draft here we introduce an approximate constant rising rate of melting point with time at every grid point that is c v s i n α where the constant c 7 61 10 4 c m 1 v is the characteristic plume velocity of o 10 1 m s 1 accordingly we surmise a rising rate of melting point of 1 10 4 s i n α c s 1 and an in depth discussion on this supposed rising rate of melting point is made in due course 4 reference run 4 1 model setup the values adopted for the parameters of the reference model configuration are summarized in table 1 as alluded to earlier the ais is a likely candidate for an energetic isw plume originating from its deep grounding line this branch of robust o 10 1 m s 1 cold and fresh isw flow propagates along the base of the western side of ais exchanging with the underlying hssw but hardly departure from the ice shelf base galton fenzi et al 2012 liu et al 2017 it becomes evidently supercooled at a distance of 200 km away from the deepest grounding line galton fenzi et al 2012 and finally outflows from beneath the ais front suppressing the local antarctic bottom water formation williams et al 2016 to avoid the complexities of supercooling and possible plume detachment from the ice shelf base we configure our reference run hereinafter referred to as ref for the isw plume underneath the deep inland part of ais before it becomes supercooled i e the early stage in the perspective of its whole journey as follows the domain size along the x and z coordinates are 300 and 150 m the grid spacing in the x and z coordinates are 2 5 and 1 5 m the time step is 0 2 s the ice draft at the origin of coordinates is set to 2500 m the basal slope s i n α is set to 0 021 in accordance with the mean basal slope of the deepest inland part of ais fretwell et al 2013 the ambient temperature t a and salinity s a of local hssw are set to 1 9 c and 34 55 respectively that is the median of the range of the observed hssw properties according to herraiz borreguero et al 2013 on account of the complete absence of direct observations beneath such a deep draught the initial isw salinity is set to 34 1 in line with the simulated freshest isw within the ais cavity from galton fenzi et al 2012 see their fig 9b the initial isw temperature is accordingly set to 3 13 c determined by using a gade line gade 1979 we constrain the drag coefficient at the ice shelf base c d 5 10 3 consistent with that needed to coincide with the recent derived basal melt rates multi year minimum average and maximum are respectively 0 71 2 9 and 6 m yr 1 for 1994 2018 of the southern deep parts of ais from the combination of surface height data from satellite radar altimeters satellite derived ice velocities and a model of firn layer evolution adusumilli et al 2020 in addition the whole system is at rest initially and there are no background pressure gradients i e η 0 the initial thickness of the upper well mixed isw layer is set to 30 m then the isw properties are set to linearly transition from z 30 m to the values of respective quantities of the lower hssw within a thin 9 m interfacial zone as illustrated in fig 1 such a relatively sharp pycnocline is assigned in view of the specified coldest and freshest initial isw layer with least modification by the underlying hssw all the runs in this study are integrated for 144 h last it is important to mention that the sensitivity of the simulated results of ref to changes in the initial thickness of isw layer and interfacial zone is also discussed in detail in the next section 4 2 results a central focus of this work is to understand the dynamics and thermodynamics within an iobc underlain by a significant pycnocline over a wide parameter space by utilizing relatively small scale simulations to this end we diagnose the various processes responsible for heat transport examine the validity of typical entrainment parameterizations and identify potential issues in the current large scale meltwater plume modeling 4 2 1 temperature filed field evolution the richardson number is of paramount importance to our analysis through the whole study however before its calculation according to eq 2 we have to define the lower limit of isw plume first for the depth averaged values at each value of x that is the depth z p a i i e the plume thickness d z p a i where the pai density ρ p a i satisfies 18 ρ a ρ p a i ϕ δ ρ ϕ ρ a ρ z 0 m where δ ρ is the instantaneous maximum of density contrast in the z directional dimension here two proportions of ϕ 75 following chu and soong 1997 and 90 are adopted which represents the pai located within and at the upper boundary of the interfacial zone respectively thence the field averaged bulk richardson number r i representing the relative magnitude of the overall stratification and shear production for the whole plume zone could be expressed by 19 r i g d u r e l 2 g d u u p a i 2 v v p a i 2 where u r e l is the relative plume velocity the angle bracket signifies averaging along l x i e l x averaging and the overline denotes averaging over the plume thickness that is from z 0 m to z p a i first we deem the 90 δ ρ criterion of the pai depth lowering 3 m relative to its initial depth to be the spin up phase of ref and later sensitivity runs we regard the iobc after that period in each run as being fairly developed which is thus our sole focus of subsequent analysis accordingly the spin up period of ref is deemed to be 10 8 h and simultaneously the 75 δ ρ criterion of the pai depth has also lowered nearly 3 m fig 2a and b show the development of the iobc during the spin up phase of ref the iobc is found to be largely established including the upper frictional ekman layer and the lower geostrophic v component beginning to evolve with the density at about 2 5 h from the totally stationary state the large buoyancy forcing imposed by the fairly large basal slope 0 021 and relatively fresh isw is principally responsible for such a quick iobc establishment ref without using the assumed rising rate of melting point i e 1 10 4 s i n α c s 1 is also conducted for comparison fig 2c d in this additional ref the iobc shows almost the same development as in ref which thus demonstrates little influence exerted by the slowly elevated artificial melting point on the relatively short spin up phase the time series of r i based on the 75 and 90 δ ρ criteria of pai in ref are shown in fig 3a both in general exhibit similar trend whereas the one associated with the 75 δ ρ criterion pai within the interfacial zone i e the core of shear instability presents larger fluctuations therefore as evident from the time series of r i based on the 75 δ ρ criterion there exist three distinct regimes at the early stage r i decreases first regime i which essentially results from the effect of the enhanced bulk shear an increase in the denominator of eq 19 red solid line in fig 3b then r i rises at a visibly lower rate compared with the decreasing rate in regime i that is because the bulk shear starts gradually declining at t 20 h red solid line in fig 3b while the bulk stratification gets slightly enhanced blue solid line in fig 3b we term the increasing period of r i from t 20 to 72 h as regime ii after t 72 h r i continues increasing but at a smaller rate and the fluctuations in r i become pronounced because of the minimal bulk shear red solid line in fig 3b moreover the bulk stratification keeps steady to the end of ref blue solid line in fig 3b we term this increasing period of r i from t 72 h to the end of ref as regime iii the results of the bulk shear and stratification based on the 90 δ ρ criterion are also shown in fig 3b compared with the results based on the 75 δ ρ criterion the bulk shear presents a delayed peak on the other hand the bulk stratification is notably weakened closer to the upper well mixed layer and appears to be steadier as shown in fig 3c to l we select successive snapshots of the temperature field at some certain times indicated in fig 3a in each regime two lifecycles of the kelvin helmholtz k h billows within regime i are exhibited in fig 3c to f and their dimensions further develop within regime ii fig 3 g h so the k h instabilities appear to be cyclical they form roll up into billows grow collapse and after some time they form again which aligns with the experimental study conducted by sullivan and list 1994 then in regime iii the k h instabilities convert to the larger scale distortion of the pai characterized by successively occurred wave distortion and breaking by shear fig 3i l these dramatic spatiotemporal deformation of the pai unequivocally leads to the remarkable fluctuation of the variation in the bulk shear red lines in fig 3b and thus in r i fig 3a 4 2 2 vertical dynamical structure the evolution of the vertical structure of dynamical quantities after l x averaging of ice ocean boundary current in ref is illustrated in hovmöller diagrams fig 4 the vertical profiles of both velocity components shown in fig 4a and b are analogous to those described in jenkins 2016 2021 the maximum of v is larger than that of u the boundary layer of u frictional ekman layer reaches a steady state earlier but that of v continues to grow along with the depth of isw plume that is because the purely geostrophic part of v beyond the ekman layer is balanced by the buoyancy forcing ρ a ρ ρ 0 g s i n α corresponding to the temporally varying density deficit thus the flow speeds near the ice shelf base and at depth are respectively dominated by u and v fig 4c the evolving upper mixed layer and its lower interfacial zone can be readily ascertained from fig 4d the chosen 90 δ ρ criterion of pai fairly well depicts the lower boundary of mixed layer and the 75 δ ρ criterion is located within the top region of interfacial zone the dominating turbulence produced within the upper 45 m water column fig 4e and thus exclusively maintaining the mixed layer is significantly vertically constrained by the underlying strong stratification fig 4f h whilst the corresponding shear is also robust therein fig 4 g we also note that the pai depths for both density deficit criteria shown in fig 4f are within the upper portion of the pycnocline which thus means the velocity at the pai determined by momentum transfer from the plume across the pycnocline alone where the ageostrophic u tends towards zero 4 2 3 vertical thermodynamical structure in this subsection we intend to illuminate each thermal process contributing to the local time cumulative temperature change over the whole water column using the continuity equation eq 5 and after l x averaging the conservation equation for temperature eq 9 can be rewritten in the spatial derivative of heat fluxes which is conducive to the thermal analysis carried out here as 20 t t u t x w t z z k z t z here the horizontal diffusion term is vanished because of the adoption of the cyclic lateral boundary conditions and the l x averaging for all the other terms performed here and hereinafter is across the real model domain between the inlet j 1 and outlet j n x excluding the boundary ghost points of j 0 and j n x 1 it is worth mentioning that the continuity equation can be satisfactorily fulfilled by the present numerical scheme the thermal terms relevant to the flow divergence are therefore all discarded in the subsequent analysis time integrating eq 20 we have 21 δ t t 0 t u t x d t t 0 t w t z d t t 0 t z k z t z d t here the reference point t 0 is set to the end time of spin up phase hence the cumulative temperature variation at a certain depth δ t can be attributed to the contributors to advection t 0 t u t x d t convection t 0 t w t z d t and vertical diffusion t 0 t z k z t z d t it should be stated that the diffusive contributors correspond to the sub grid i e parameterized heat fluxes while other contributors correspond to the resolved heat fluxes to this end the evolution of the vertical profiles of the cumulative temperature variation fig 5a and the associated respective thermal contributors fig 5b d in ref can be reproduced based on eq 21 as shown in fig 5a above the depth of 30 m the upper well mixed layer gradually gets warm with a decreasing rate gradually reaching the quasi steady state to the end of simulation below that depth the seawater cools and the cooling extent increases with time within the depth range of the major δ t the vertical components i e vertical diffusion fig 5b and convection fig 5c are principally responsible for δ t compared with the advective process fig 5d in regards to the vertical diffusion fig 5b it is predominantly responsible for the warming of the upper 30 m well mixed layer fig 5a consequently an over simplified turbulence closure scheme e g constant eddy viscosity diffusivity jenkins 2016 is unlikely to provide reasonable near ice base turbulence conditions fig 4e and thus quantitatively reliable melt rates as stated in jenkins 2016 and cheng et al 2020 beneath the initial 30 m depth of isw layer the interlaced cooling warming cooling zone emerges and evolves with time as such the thermal structure exhibited in fig 5b notably illustrates a vertical diffusive exchange between the growing cooler isw plume corresponding to the warming subzone and its underlying warmer water corresponding to the cooling subzone within the iobc system with regard to the convection fig 5c we find that it overall behaves reversely with the role of vertical diffusion but is only prominent within the interval between the depth of 30 m and the 75 δ ρ limit of the plume where the shear instabilities i e overturing effects mainly occur fig 3c l 4 2 4 thermal budget for isw plume in this subsection we intend to conduct the quantitative thermal budget analysis following concepts from plume theory and to analytically obtain the constitutions of the entrainment induced heat transport for meltwater plumes vertically integrating the conservation equation for t eq 9 from z 0 m to z p a i and after some manipulations we obtain the following evolution equation of isw plume temperature 22 t t 1 d d t t p a i t 1 d w t z z p a i 1 d w t z 0 u t x 1 d a z t z z 0 1 d a z t z z z p a i x k h t x after time integrating and l x averaging eq 22 we have 23 δ t t 0 t 1 d d t t p a i t d t t 0 t 1 d w t z z p a i d t t 0 t 1 d w t z 0 d t t 0 t u t x d t t 0 t 1 d a z t z z 0 d t t 0 t 1 d a z t z z z p a i d t t 0 t x k h t x d t the cumulative plume temperature variation δ t can be thus attributed to seven contributors to the interfacial displacement t 0 t 1 d d t t p a i t d t convection at the pai t 0 t 1 d w t z z p a i d t convection at the ice base t 0 t 1 d w t z 0 d t advection t 0 t u t x d t vertical diffusion at the ice base t 0 t 1 d a z t z z 0 d t vertical diffusion at the pai t 0 t 1 d a z t z z z p a i d t and horizontal diffusion t 0 t x k h t x d t that is retained because of the difference in the z p a i across the model domain based on eq 23 we can thus calculate the time series of δ t and its contributing components in ref as shown in fig 6a and b 75 δ ρ and fig 6d and e 90 δ ρ the thermal compositions based on both criteria coincide with each other first the component of the convection at the ice base is negligible overall the convection at the pai has the relatively largest positive warming contribution to δ t fig 6a d the interfacial displacement comes second fig 6a d the third are the diffusion at the pai and the almost equivalent horizontal diffusion fig 6b e on the other hand the advective component for δ t shown in fig 6a and d is essentially the cumulative net advection induced change in the plume averaged temperature with different plume thicknesses i e vertical averaging intervals across the model domain this advective heat transport from the upstream is the dominating process for the negative contribution to δ t which is largely compensated by the warming from the intense shear instabilities induced convection at the pai fig 6a d in addition it should be distinguished from the advective component for δ t shown in fig 5d that is also the cumulative net advection induced δ t but at a fixed depth lastly the vertical diffusion at the ice base inherent with the basal melting only accounts for rather limited negative proportion of δ t fig 6b e as in the literatures alluded to earlier in the conventional depth integrated meltwater plume models the entrainment of ambient fluid into the plume is the arguably exclusive heat source for the plume however the constitutions of the entrainment induced heat flux e h f has not been explicitly analyzed to this end eq 22 can be rewritten as 24 d t t d t t p a i t w t z z p a i w t z 0 d t w z d u t x a z t z z 0 a z t z z z p a i d x k h t x applying the conventional vertically uniform assumption that is t and u are always uniform in the vertical with their depth averaged values t and u to the depth averaged terms in eq 24 we have d t w z t w z 0 w z z p a i t m w z z p a i w z z p a i t d u t x u d t x and d x k h t x x k h d t x k h t x d x x k h d t x substituting these approximations into eq 24 we have the plume temperature transport equation under the vertically uniform assumption as following 25 d t t d t t p a i t w z z p a i t p a i t a z t z z z p a i m t z 0 t u d t x a z t z z 0 x k h d t x contrasting eq 25 with the corresponding equation proposed by hf06 26 d t t e t p a i t m t z 0 t u d t x γ t t z 0 t x k h d t x where e t p a i t corresponds to the e h f e denotes the entrainment rate that is the central issue of the next subsection γ t t z 0 t corresponds to the basal melting related heat flux that is expressed as a z t z z 0 in eq 25 γ t signifies the heat transferring rate then discarding the vertically uniform assumption the analytical expression for the e h f is accordingly obtained as 27 e h f d t t p a i t w t z z p a i d t w z a z t z z z p a i which intrinsically includes three components of the interfacial displacement d t t p a i t net convection w t z z p a i d t w z and vertical diffusion at the pai a z t z z z p a i which is the subgrid contribution based on eq 27 we can therefore calculate the contributions of e h f and its respective components to δ t in ref for both criteria as shown in fig 6c 75 δ ρ and 6f 90 δ ρ for either criterion among these components the interfacial displacement shown to be the largest proportion of the entrainment induced warming and the net convection has the nearly equivalent contribution as the vertical diffusion at the pai in ref 4 2 5 entrainment parameterization parameterizing the entrainment is an indispensable part of the existing depth integrated meltwater plume models as a result to examine the validity of the commonly used entrainment parameterizations eqs 1 and 2 in meltwater plume models is one of the main purposes of this study following hf06 the entrainment velocity is defined as 28 e d t u d x m however we have to use the time integration of eq 28 to evaluate the entrainment parameterization formulations because the vertical grid spacing δ z 1 5 m is far from sufficiently resolving the major term of d t the magnitude of e is about o 10 4 m s 1 to this end in the sense of l x averaging we instead use the following time integrated expression for evaluation 29 δ d t 0 t e d t d d 0 t 0 t m 1 l x u d x 0 u d x l x d t where δ d is the relative plume thickness caused by the entrainment to the value d 0 at t t 0 previous stratified mixed layer deepening experiments have focused on delineating the entrainment law i e the relationship between e and r i which can be rewritten here in the form fernando 1991 30 e e 0 u r e l c d r i n where r i is calculated by using eq 19 and n is the constant associated with much uncertainty fernando 1991 has given an excellent review of the diverse entrainment laws for stratified shear flows from 30 references see his table 1 and the determination of the value of n is yet to be generalized sullivan and list 1994 strang and fernando 2001 pham and sarkar 2017 it is worth reminding that the n 1 case corresponds to hf06 eq 1 and j91 eq 3 is an idealized approximation of the former and can be regarded as n 0 case if the basal slope s i n α is constant as in this study fig 7a and b in the case of 75 δ ρ criterion of pai show a comparison between the simulated plume thickness the rhs of eq 29 and seven time integrated best fit with respective to e 0 entrainment laws the lhs of eq 29 in view of its large uncertainty we set the power n in eq 30 as wide as possible i e from n 0 virtually j91 here to 3 with 0 5 interval first the simulated thickness behaves like a power law with a power larger than one resulting in a nonlinear increase with time initially fig 7b then gradually levels off with further increasing time fig 7a with regard to the behavior of seven best fit entrainment laws it is noticeable that the larger the power n is the more nonlinearly the formulation behaves in detail j91 has the smallest nonlinearity but the largest values in the beginning and the end of simulation n 3 case in contrast has the largest nonlinearity and values in the intermediate phase but the calculated thickness levels off most quickly particularly hf06 performs best with the best fit e 0 0 09 the root mean square error rmse is 0 68 m and j91 in contrast performs poorly with the best fit e 0 0 023 which is nevertheless comparable to the pervasively adopted value of 0 036 it is possible that the chosen initial states considered here are far from providing a balanced plume state which implies that the approximation adopted by j91 would not be expected to hold moreover the time series of the nondimensional e proportional to u r e l for hf06 in essence r i 1 is exhibited in fig 7c the nondimensional e has a sudden increase initially and quickly reaches the peak values then it progressively declines at a relatively lower rate and tends towards a nearly steady value to the end the behaviors of both simulated and parameterized plume thickness based on the 90 δ ρ criterion of pai see fig 7d e resemble those for the 75 δ ρ criterion even though the entrainment is demonstrated to be some weaker for the former case fig 7a d in addition for the 90 δ ρ criterion n 2 case performs best with e 0 0 0057 fig 7f is accordingly for n 2 case in essence r i 2 analogous to fig 7c and e 0 0 019 for j91 as elaborated above neglecting the velocity at the pai i e u p a i 0 v p a i 0 is an inherent and unavoidable deficiency of all the depth integrated meltwater plume models in which the information about the interfacial zone is completely lacking although the vertical relatively far field velocity can be simulated in the ocean cavity models as elucidated earlier the spatiotemporally varying interfacial zone between lighter denser waters is far from being sufficiently resolved owing to the coarse vertical resolutions as shown in fig 8a black dashed line the plume speed u p u 2 v 2 u p 2 v p 2 based on the 75 δ ρ criterion increases with time then decreases slightly with more significant fluctuation in the second half of simulation in contrast the variation in u r e l u p u p a i 2 v p v p a i 2 black solid line in fig 8a perfectly synchronizes with that in r i 1 see fig 7c because of the quadratic dependence of r i 1 on velocity eq 19 and shows conspicuously wider variability and more pronounced fluctuations that are caused by the velocity at the pai fig 8b according to eqs 19 and 30 the entrainment velocity predominantly scales with u 2 n 1 consequently the quasi steady behavior of u p in other words taking no account of u p a i v p a i as done in plume models black dashed line in fig 8a leads to a quasi linear isw plume thickening regardless of the n values exceeding and progressively deviating from the simulated plume thickness dashed lines in fig 8c compared with the simulated thickness taking account of u p a i v p a i by contrast significantly improve the entrainment parameterization performance which behaves much more nonlinearly especially for hf06 solid lines in fig 8c furthermore the above findings can also be obtained in the case of 90 δ ρ criterion fig 8d f in conclusion only considering the bulk plume velocity in the entrainment parameterizations may introduce a large deviation from the real entrainment which implies a potential adverse influence on estimating the basal melt rate by using the depth integrated meltwater plume models it is noteworthy that we also examine the parameterized entrainment for the 10 δ ρ criterion of pai that is the pai is defined within the lower marginal part of the interfacial zone as shown in fig 9a the difference of parameterizing the entrainment arising from whether taking into account the pai velocity vanishes because of the weak ambient speed sufficiently away from the upper solid boundary fig 4c the behaviors of the j91 and hf06 parameterizations collapse i e irrespective of r i which results from the relatively steady small values of r i 1 for the 10 δ ρ criterion fig 9b in addition the generally poor performance of the conventional entrainment parameterization of eq 30 for the 10 δ ρ criterion shown in fig 9a compared with that shown in fig 8c and f seems to imply that it is not suggested to define the lower limit of the plume within the lower marginal part of the interfacial zone away from the core of shear instabilities and characterized by strong stratification reflected by the minimal r i 1 for the 10 δ ρ criterion fig 9b 4 3 supposed rising rate of melting point in view of the fact that the horizontal domain size 300 m adopted here is much smaller than the typical horizontal resolutions 1 km of the existing coupled ice shelf ocean models the l x averaged temporal evolution of the iobc exhibited above can thus be comprehended in the sense of the evolution along the ice shelf base towards shallower depths to this end by time integrating the time series of u p dashed line in fig 8a in ref the corresponding spatial scale of 75 km for the deep inland part of ais is obtained that spatial scale corresponds to a shallowing of 1575 m under s i n α 0 021 in ref and thus indicates a significant rise of 1 2 c in melting point which has been approximately considered by using the above supposed rising rate of melting point 1 10 4 s i n α c s 1 a comparison of the calculated melt rate with and without the rising rate of melting point in ref is shown in fig 10 the melt rate increases first then plateaus with time if the raising melting point is not considered dashed line in fig 10 that deviates from the fact that along the western route of an energetic isw plume the amery ice shelf basal melting decreases with distance from the grounding line and transitions to basal freezing towards the calving front fricker et al 2001 galton fenzi et al 2012 liu et al 2017 the never steady simulated result for a moving box following the evolving plume is coincident with that fact when the rising rate of melting point is considered solid line in fig 10 while we acknowledge that this is an artificial and somewhat crude treatment we are convinced that it would not influence the key findings substantially and the effects of the rising melting point should be considered here 5 sensitivity tests in this section we use ref for a sensitivity study for isw plume with all parameters except the one under investigation held fixed all the sensitivity tests conducted here are summarized in table 2 including changing basal slope j0 016 and j0 025 changing ambient hssw salinity s34 50 and s34 60 adding a constant far field across slope geostrophic velocity v g g c o s α ϕ η x vg0 03 and adding an oscillating v g with different periods and amplitudes td0 025 10 h td0 025 20 h and td0 040 10 h the sensitivity to the initial isw thickness ini24 and ini36 and initial interfacial thickness gradual and sharp is also examined it is important to state that the reference point t 0 is unified to the latest end time of spin up phases among the selected sensitivity runs for the following comparisons to ensure the iobc in each run is fairly developed 5 1 thermal analysis for isw plume first the cumulative plume temperature variation δ t in all runs are shown in fig 11 the results based on both criteria are almost the same as each other so only the case of 75 δ ρ criterion is shown in fig 11 the bulk warming in the plume is heightened with the reinforced buoyant forcing manifested in an increase in basal slope fig 11a or vertical density deficit despite the nonmonotonicity with increasing density contrast fig 11b adding a constant positive across slope geostrophic velocity v g 0 03 m s 1 can enhance both upslope and across slope velocity components see fig 5a c in jenkins 2016 which corresponds to a strengthened warming trend to the end of simulation fig 11c tides underneath the ais which are mixed semidiurnal with four main tidal constituents m 2 s 2 k 1 o 1 hemer et al 2006 have been proved to be much weaker than those beneath e g filchner ronne and ross ice shelves padman et al 2018 and likely have little influence on the oceanographic properties for the ais cavity hemer et al 2006 on the other hand the heat content for the ais cavity and the associated basal melt rate can feature obvious tidal oscillations in an ocean cavity modeling including tides at open boundaries galton fenzi et al 2012 notwithstanding following jenkins 2016 and cheng et al 2020 we also add an oscillating background geostrophic velocity instead employing a tide model into our idealized model to represent a simplified tidal forcing it can be inferred from fig 11d that the influence of the oscillating v g on the plume warming is rather limited here to sum up it is suggested from fig 11a to 11c that the bulk warming of the isw plume can become more significant if the iobc is reinforced by virtue of some certain dynamic reasons in addition the response of the variation in δ t to the differing initial isw thickness fig 11e is shown to be more sensitive than that to the initial interfacial thickness here fig 11f similar to fig 11 we have also investigated the sensitivity of each major contributive component that is the interfacial displacement convection at the pai advection vertical diffusion at the pai and horizontal diffusion shown in fig 6a however no general trends with the differing dynamic forcing conditions like illustrated in fig 11 are found except for the entrainment fig 12 the response of the warming caused by entrainment to the varying forcing conditions are more conspicuous than that of the bulk warming shown in fig 11 that further confirms the predominant role of entrainment on controlling the bulk isw plume temperature and also implies the modulation of other secondary thermal processes it is worth noting that the magnitude of the entrainment induced warming in our steepest case j0 025 declines slightly fig 12a compared with ref because the vertical thermal deficit also decreases synchronously owing to the enhanced mixed layer warming similarly the influence of initial interfacial thickness on the entrainment induced warming is less significant than that of initial isw thickness here fig 12e f moreover for the l x averaged melt rate there is an inconspicuous sensitivity to the tested factors in fig 13 except for the runs of varying buoyant forcing featuring relatively more sensitivity fig 13a b 5 2 entrainment parameterization first the simulated isw plume thickness in all runs is compared in fig 14 and the entrainment for the 75 δ ρ criterion of pai fig 14a is entirely seen to be larger than that for the 90 δ ρ criterion fig 14b besides it is also illustrated for both criteria that the entrainment can be heightened when the buoyant iobc gets dynamically stronger the comparison between the simulated plume thickness and the thickness calculated by seven best fit entrainment formulations with different power n in all sensitivity runs is presented in figs 15 and 16 for the 75 and 90 δ ρ criteria respectively in each sensitivity run for either criterion there exists a best performing entrainment formulation that can fairly well match with the simulated plume thickness the best fit values of n and e 0 as well as rmse for each best performing entrainment formulation are given in table 3 in view of great complexity and much uncertainty as elucidated above it is unlikely hitherto to propose a universal value of n still we calculate the average n of 0 88 and 1 15 for the 75 and 90 δ ρ criteria respectively based on all our runs for the energetic buoyantly forced stratified iobcs that is in line with the adoption of hf06 i e n 1 however the fact that j91 formulation performs poorly potentially indicates that the influence of the variation in r i on the entrainment cannot be ignored 6 impacts of resolution in this section we examine how the model resolution impacts the isw plume growth and temperature variation as well as melt rate for varying basal slope runs j0 016 and j0 025 and ref to this end we additionally conduct j0 016 coarse ref coarse and j0 025 coarse at a coarser resolution of δ x δ z equaling 3 m 2 m and j0 016 fine ref fine and j0 025 fine at a finer resolution of δ x δ z equaling 2 m 1 2 m with all parameters kept constant the comparisons of the simulated time series of isw plume thickness and temperature variation at varying resolutions are presented in fig 17a to d with the plume getting stronger by increasing the basal slope on the whole the difference in the plume thickness and temperature variation caused by the different resolutions for either 75 fig 17a b or 90 δ ρ fig 17c d criterion becomes more obvious furthermore the absolute difference in the simulated melt rate at this range of resolutions is somewhat amplified with increasing basal slope and the simulated melt rate monotonously decreases with fining resolution fig 17e we attribute this decrease in melt rate to the diffusive heat flux near the ice base fig 17f as the vertical resolution is coarsened the stratification near the ice base is artificially attenuated and the near ice base turbulence is thus more sufficiently developed 7 discussion owing to the considerably coarse resolution adopted here compared with that in either large eddy simulations vreugdenhil and taylor 2019 rosevear et al 2021 begeman et al 2022 or direct numerical simulations mondal et al 2019 which concern the ice shelf ocean boundary layer dynamics but for much weaker o 10 2 m s 1 buoyant flows than here with purpose of investigating the near base turbulence and examining the thermohaline transfer coefficients for melting our simulations cannot be regarded as being turbulence resolving moreover the mixing generated in our 2 5 dimensional model configuration results from two dimensional turbulence that is likely to be quite different to three dimensional turbulence even so some of our simulated results are consistent with some published evidence in a qualitative manner which lends a certain degree of confidence to our model first as shown in fig 3c to l the simulated temperature field evolution is in close consonance with the laboratorial observations including k h billowing and wave breaking events of strang and fernando 2001 second our simulated evolution of isw plume thickness e g in ref to a large degree resembles a simulated variation in the thickness of the wind driven ocean mixed layer atop a strongly stratified barrier layer that is an initial rapid deepening and a late time slow entrainment as shown in results from large eddy simulation see fig 3a in pham and sarkar 2017 moreover the calculated trend of the variation in e shown in fig 7c and f is virtually the same as that with respect to the propagation distance in a gravity current modeled by a high order three dimensional nonhydrostatic spectral element model see fig 4a in xu et al 2006 more importantly the average values of the best fit e 0 in j91 for all sensitivity runs are 0 024 and 0 019 for the 75 and 90 δ ρ criteria of pai respectively which are comparable to the canonical value of 0 036 that implies our simulated entrainment rate is quantitatively reasonable to a certain extent other than the adopted resolution the limitation of 2 5 dimensional model even though allowing for the inclusion of the coriolis force omits all the processes relating to the across slope gradient y and cannot take into account the influences exerted by the unique topographic features i e basal channels and keels dallaston et al 2015 marsh et al 2016 of the underside of ice shelves three dimensionally modeling the stratified iobcs in much more complicated dynamic environments would be a natural but formidable challenge that is left for a later study a key finding of jenkins 2016 is the division of the iobc into an external geostrophic flow and an internal frictional boundary layer features that are averaged together by depth integration in the plume framework lately jenkins 2021 provided more details about the shear stability and mixing within the iobcs by using a mixing length model however the restriction to only one dimension in both jenkins 2016 2021 represents a severe limitation that makes the vertical diffusion become the only one thermal process lastly we acknowledge that the ref and its sensitivity tests are designed based on the instance of the ais that is one of the typical cold water ice shelves in antarctica even so examining in detail the thermodynamics of the iobcs beneath the warm water ice shelves for example along the coast of west antarctic would be a straightforward later investigation by using the same methodology 8 conclusion compared with the resolution of current coupled ice shelf ocean models a relatively high resolution 1 5 m in vertical 2 5 dimensional nonhydrostatic vertical slice model was developed to investigate in detail the thermal processes within a stratified iobc underneath a cold water ice shelf we draw the following conclusions based on our simulations 1 according to the variation in the calculated richardson number the evolution of the shear instabilities manifested by temperature field can be divided into three regimes which are respectively characterized by small scale k h billows large scale k h billows and much severer distortion of the pai characterized by wave distortion and breaking at the pai 2 the vertical diffusion predominantly controls the heat content of the near ice base water column while the shear instabilities induced convection at depth is active between the initial depth of plume and the deepening pai 3 the most important contributor to the meltwater plume warming is demonstrated to be the convection at the pai whereas the advective heat transport is illustrated to be the predominant sink term for the bulk heat content of the meltwater plume 4 an analytical expression of the e h f for the meltwater plumes is obtained which consists of three contributors to the interfacial displacement net convection and vertical diffusion at the pai and the first is confirmed to be of primary importance 5 the routinely employed entrainment formulation of j91 performs poorly in our examination and the velocity at the pai ought to be considered in the existing entrainment parameterizations for meltwater plume models 6 if the buoyancy associated forcing conditions are reinforced the bulk plume temperature gets warmer dominated by the enhanced entrainment induced warming 7 the sensitivity of the simulated thickness and bulk plume temperature to varying resolutions becomes more evident if the buoyancy forcing gets stronger besides the deviation in the calculated basal melt rate caused by varying resolutions is somewhat amplified with stronger buoyancy forcing which is determined by the near ice base turbulence condition to conclude the shear instabilities induced entrainment occurring at the pai plays a vital role of warming the meltwater plumes beneath the ice shelves in antarctic accordingly there is a pressing need to improve the model resolution of ocean cavity models to sufficiently resolve the entrainment at the pai for evaluating basal melting in addition the conventional depth integrated plume models may in the future need to be coupled with e g a sort of boundary layer model like in jenkins 2016 2021 to consider the velocity at the pai for entrainment parameterization credit authorship contribution statement chen cheng conceptualization methodology software formal analysis writing original draft visualization zhaomin wang investigation writing review editing funding acquisition luyu shen validation formal analysis visualization chengyan liu validation formal analysis visualization declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments we would like to thank xylar s asay davis and one anonymous reviewer for their thorough review and helpful commentaries and improvements this work was supported by the national natural science foundation of china 41941007 the natural science foundation of jiangsu province bk20191405 the national natural science foundation of china 41876220 and the project supported by innovation group project of southern marine science and engineering guangdong laboratory zhuhai 311021008 
23825,oceanic melting beneath ice shelves is the main driver of the current mass loss of the antarctic ice sheet the resultant meltwater plumes influence the basal melting of ice shelves and contribute to the development of the unique two layer stratified ice shelf ocean boundary currents underlain by warmer saltier and stationary source waters however knowledge of the dynamics and thermodynamics within these meltwater plumes controlling the heat available for melting ice remains outstanding here we investigate that important issue by developing a 2 5 dimensional nonhydrostatic vertical slice model with 1 5 m vertical resolution and conduct the reference run based on a representative ice shelf water isw high salinity shelf water hssw boundary current beneath the amery ice shelf east antarctica based on that we identify two dominating vertical thermal processes regulating the local temperature the turbulent diffusion and the shear instabilities induced convection i e vertical advection and carry out a quantitative thermal budget analysis in the framework of plume model including deriving an analytical expression for the entrainment induced heat flux moreover after evaluating the entrainment parametrizations it is suggested that the common assumption of neglecting the velocity at the lower boundary of meltwater plume potentially leads to a considerable deviation from the real entrainment the sensitivity of the simulated results to model configuration and model resolution are also investigated the findings in this study imply that we need to improve the model resolution of current ocean cavity models to capture the interfacial processes between lighter denser waters keywords ice shelf boundary current thermal processes stratification entrainment numerical modeling 1 introduction antarctic ice shelves the floating parts of the marine terminating ice sheets have been profoundly thinning which is likely related to their accelerated basal melting in recent decades paolo et al 2015 the interactions of underlying ocean with ice shelves responsible for the basal melting are imperative for mean sea level rise since the shelves provide a buttressing backstress on vast amounts of inland ice bell and seroussi 2020 increased heat flux to the base of warm water ice shelves in west antarctica arising from the on shelf transport of circumpolar deep water cdw has become an increasing source of concern for the community dutrieux et al 2014 jenkins et al 2018 the high salinity shelf water hssw driven melt generally occurs by contrast within the cold water cavities such as for three major ice shelves the filchner ronne ross and amery ice shelves ais adusumilli et al 2020 that is because hssw can effectively block offshore cdw from getting onto the continental shelf holland et al 2020 but which is thus vulnerable to any decrease in polynya activity that allows cdw to enter the cavity gwyther et al 2020a the coastal polynya formation by persistent offshore wintertime winds and ensuing ice production leads to brine rejection and the generation of hssw on the continental shelf herraiz borreguero et al 2016 dense hssw accesses the cold water cavities with little modification along the retrograde bed slope towards the grounding zones jacobs et al 1992 for either warm or cold water ice shelves when cdw or hssw arrives at the grounding lines it causes basal melting because of positive thermal forcing and the formation of glacially modified water gmw naveira garabato et al 2017 or ice shelf water isw respectively both water masses are relatively fresh but the former is above and the latter is below the surface freezing point these buoyant plumes ascend along the ice shelf base and continue to melt the ice shelf base owing to the fact that the heat source of warm water ice shelves cdw is typically several degrees warmer than that of cold water ice shelves hssw the warm water ice shelves generally experience much higher basal melting rignot et al 2013 unless the cold water ice shelves are exceptionally deeply grounded ais a representative cold water ice shelf embedded in the prydz bay east antarctica has the potentially deepest groundling line 2500 m in the southmost inland yang et al 2021 consequently the dramatic drop in the melting point at several kilometers depth generates a large difference i e thermal forcing between in situ ocean temperature and local melting point which drives a comparable local basal melt to that of warm water ice shelves adusumilli et al 2020 the ice shelf basal melting crucially controls the mass balance dynamics and thus stability of antarctic ice sheets pritchard et al 2012 pattyn and morlighem 2020 one of the pivotal questions for basal melting is how heat is vertically transported from the lower heat reservoirs of hssw or cdw into the upper plumes however knowledge of this process is lacking due to the inaccessibility of the underside of deep parts of ice shelves sugiyama et al 2014 begeman et al 2018 and the restriction of vertical resolution of ocean cavity modeling gwyther et al 2020b 2 motivation the inland deep part of antarctic ice shelves several kilometers away from the grounding zones generally have the overall steepest basal slope o 10 2 fretwell et al 2013 in view of this despite the absence of direct observational evidence a handful of simulated results obtained by plume models holland et al 2007 payne et al 2007 and regional coupled ice shelf ocean models galton fenzi et al 2012 dansereau et al 2014 have indicated that vigorous meltwater gmw or isw plumes o 10 1 m s 1 originates from the strong melting near grounding lines rignot and jacobs 2002 wen et al 2010 and or the subglacial freshwater outflows at grounding lines jenkins 2011 wei et al 2020 the process of that swift flow has tended to be dominated by the plume theory which was first applied by macayeal 1985 and was then first developed into a simple one dimensional model of meltwater plume treated as a turbulent gravity current by jenkins 1991 hereinafter referred to as j91 the renowned meltwater plume model of j91 has hitherto been extensively used to study diverse aspects of ice shelf ocean interactions jenkins 2011 jenkins and bombosch 1995 parizek and walker 2010 holland and feltham 2006 cheng et al 2017 2019 however almost all the studies listed above routinely supposed every property as well as the velocity within the plume except at its vertical boundaries to be vertically uniform because of which the adopted plume models cannot represent a continuous pycnocline see e g fig 1 in j91 such a simplification of two layer system characterized by an intermediate break in all properties had never been substantially improved until the pioneering work of jenkins 2016 by developing a vertical one dimensional model with the assumption of constant eddy viscosity diffusivity jenkins 2016 first gained fundamental insights into the vertical structure of the ice shelf ocean boundary current iobc that consists of an interior ekman layer and a geostrophic flow below lately cheng et al 2020 extended the model of jenkins 2016 by incorporating a frazil ice module and k ɛ turbulence closure to underscore the influences of frazil induced stratification on the vertical structure of the iobc even so restriction to only the vertical dimension is a severe limitation in that the nonlinear horizontal advection terms are all inevitably neglected jenkins 2016 consequently the vertical heat transport by the convection i e vertical advection inherent with the shear instabilities engendered at the interface between the two layer waters cannot be resolved by vertical one dimensional models nevertheless the mechanism by which heat is transferred from the ambient waters to the interior of the stratified iobc crucially sets the meltwater properties and in turn constrains the ice shelf basal melting which has received little attention as of now it is worth mentioning that even though the meltwater plumes are discernible in some coupled ice shelf ocean simulations the detailed representation of corresponding vertical heat transport is extremely constrained by their vertical resolution galton fenzi et al 2012 liu et al 2017 on the other hand considering the inability of resolving the shear instabilities that drive heat transport in coarse resolution models used for pan antarctic studies one must resort to an entrainment parameterization involved in a plume model bo pederson 1980 originally derived an entrainment parameterization for stream tube models which is essentially the same as that adopted in holland and feltham 2006 hereinafter referred to as hf06 1 e e 0 u c d r i and 2a r i g d u 2 2b g δ ρ g ρ p a i ρ g ρ 0 where e is the entrainment velocity e 0 is a dimensionless constant u is the plume velocity c d is the drag coefficient r i is the bulk richardson number d is the plume thickness and g is the reduced gravity δ ρ is the nondimensional density deficit ρ p a i is the density at the plume ambient interface pai which is defined later ρ is the depth averaged denoted by the overline and over the whole plume thickness plume density ρ 0 1030 kg m 3 is the reference seawater density g 9 81 m s 2 is the gravitational acceleration based on the momentum balance that is the balance between the buoyancy and friction terms and assuming the plume velocity rapidly adjusts towards an equilibrium value a simplified version of eq 1 was used in the seminal j91 model as 3 e e 0 u s i n α where α is the ice shelf basal sloping angle and j91 suggested a value of e 0 0 036 in view of the extensive applications of j91 model eq 3 along with the canonical value of e 0 0 036 was frequently adopted however without any validations thus far to this end it is of paramount importance to examine the validity of the entrainment parameterizations in the existing meltwater plume models the plume velocity u adopted in the entrainment parameterizations is intrinsically the velocity drop i e relative plume velocity that can be from the bulk plume velocity to the velocity at the pai hf06 however in the conceptual framework of meltwater plume models the vertically uniform plume velocity is supposed to be abruptly decreased to zero because of the supposedly stationary ambient waters in other words the velocity at the pai is to the best of our knowledge seldom taken into account in the entrainment parameterizations of all the existing meltwater plume studies which potentially means that the estimated entrainment rates deviate significantly from the realistic values therefore there are real gaps in our understanding of the dynamics and thermodynamics within the boundary current abutting the ice shelf base particularly for the deep inland part of ice shelves because of the inaccessibility here we present a 2 5 dimensional nonhydrostatic vertical slice model developed based on the prototype of kämpf 2010 with first ever high vertical resolution 1 5 m compared with that used in the existing coupled ice shelf ocean models to investigate in detail a variety of thermal processes responsible for the heat content of this unique boundary current it is worth mentioning that to our knowledge the minimum vertical spacing used by full cavity simulations to date to be 0 1 m in both yeager 2018 and gwyther et al 2020b but which only corresponds to the upmost mesh or grid layer and the mean and maximum vertical spacing are 10 and 23 m in yeager 2018 and 2 and 5 m in gwyther et al 2020b respectively in addition our 2 5 dimensional nonhydrostatic model is designed to persistently follow the plume as it evolves downstream by using the cyclic lateral boundary conditions here a presumed rising rate of melting point with time is accordingly applied elucidated later to take into account the accompanying continuously elevated melting point owing to the release of pressure 3 model the stratified iobc system of two layer waters is illustrated in fig 1 the vertical profiles of velocity and seawater density no longer unrealistically break at the pai but rather continuously vary within that interface with steep gradients of velocity strong shear and density strong stratification the model adopted here compatible with the unique aspects of the current system is a 2 5 dimensional extension of the vertical one dimensional iobc model developed by jenkins 2016 2021 the rotated coordinate system used in the model is depicted in fig 1 i e x parallel to the principal slope of ice shelf base upslope y perpendicular to the principal slope across slope and z normal to the ice shelf base the depth it is important to state that the total water column thickness is assumed to be large enough that the vertical domain can be regarded as the near ice base zone which is not affected by the seabed boundary as such the cavity scale overturning caused by the buoyant meltwater plume jourdain et al 2017 and even the far field controls from open ocean changes sun et al 2019 cannot be considered in this model even so following jenkins 2016 2021 in the later sensitivity tests we introduce a geostrophic velocity driven by the background pressure gradient that can provide additional current shear and makes the iobc stronger 3 1 governing equations the seawater density ρ is described by 4 ρ ρ 0 1 χ s s s 0 χ t t t 0 where t is the temperature s is the salinity t 0 2 c and s 0 34 5 are the reference temperature and reference salinity respectively χ t 3 87 10 5 c 1 and χ s 7 86 10 4 are thermal expansion and haline contraction coefficients combined with the continuity equation the 2 5 dimensional with gradients of variables in the y direction assumed to vanish extension of the vertical one dimensional momentum equations adopted from in jenkins 2016 2021 are 5 u x w z 0 6 u t u u x w u z 2 ω cos θ c o s β w ϕ v ρ a ρ ρ 0 g s i n α g c o s α η x g ρ 0 c o s α z 0 ρ x d z 1 ρ 0 q x x a h u x z a z u z 7 v t u v x w v z ϕ u 2 ω c o s θ s i n β c o s α s i n θ s i n α w x a h v x z a z v z and 8 w t u w x w w z 2 ω c o s θ s i n β c o s α s i n θ s i n α v cos θ c o s β u 1 ρ 0 q z x a h w x z a z w z where u v and w are components of the current vector in the x y and z directions respectively q is the nonhydrostatic pressure t is time ρ a is the ambient hssw density a h is the horizontal along x y plane eddy viscosity and is set to 0 01 m2 s 1 here a z is the vertical along z direction eddy viscosity and is calculated here by the k ɛ model rodi 1993 shown later ω is the magnitude of earth s rotation θ is latitude β is the angle between northward and positive across slope directions ϕ 2 ω c o s θ s i n β s i n α s i n θ c o s α is the coriolis parameter and η is the instantaneous deviation of ice shelf base from its equilibrium position z 0 m following jenkins 2016 2021 the gradient of η i e η x in our 2 5 dimensional model can be treated as a constant background far field geostrophic flow the conservation equations for t and s are 9 t t u t x w t z x k h t x z k z t z and 10 s t u s x w s z x k h s x z k z s z here the vertical eddy diffusivity k z a z p r z the vertical prandtl number p r z 0 7 1 10 r i g 0 5 1 10 3 r i g 1 5 is calculated by the classic formulation of munk and anderson 1948 r i g g c o s α ρ 0 ρ z u z 2 v z 2 is the gradient richardson number to the best of our knowledge there is little literature to guide the determination of the horizontal prandtl number to avoid increasing the uncertainty in our model configuration the horizontal eddy diffusivity k h is thus assumed to equal a h hf06 and derivatives thereof the k ɛ model is exploited here to characterize the turbulence conditions within the plume the corresponding governing equations for both turbulent kinetic energy k and its dissipation rate ɛ are given by 11 k t u k x w k z z a z σ k k z p s p b ɛ 12 ɛ t u ɛ x w ɛ z z a z σ ɛ ɛ z ɛ k c 1 ɛ p s c 3 ɛ p b c 2 ɛ ɛ 13 p s a z u z 2 v z 2 14 p b a z g ρ 0 c o s α ρ z and 15 a z c μ k 2 ɛ where p s is the vertical shear production that has been demonstrated to dominate the turbulent kinetic energy budget near the ice shelf base begeman et al 2022 p b is the buoyant production destruction σ k 1 4 and σ ɛ 1 3 are the schmidt numbers for the eddy diffusivity of k and ɛ respectively c μ 0 09 c 1 ɛ 1 44 c 2 ɛ 1 92 and c 3 ɛ 0 8 are constants all the governing equations above are discretized in finite difference form of which the coriolis terms are treated using a semi implicit scheme the nonlinear advection convection terms are discretized based on the total variation diminishing tvd schemes and the nonhydrostatic pressure q is solved using the successive over relaxation s o r method see kämpf 2010 for more details 3 2 boundary conditions the gradients of all quantities vanish at the lower boundary and the upper boundary conditions that is at the ice shelf ocean interface are the same as those set in cheng et al 2020 so only a relatively brief outline is presented here the nonslip condition is applied for u and v w is set to equal the opposite of basal melt rate m 0 that is directly calculated by the commonly used three equation formulations describing the thermohaline equilibrium conditions within a thin viscous sublayer adhering to the ice shelf base holland and jenkins 1999 nevertheless the flow divergence at the ice base can be neglected in the time scale considered here since m is so much typically six orders of magnitude smaller than the other velocities jenkins 2016 2021 the upper boundary conditions for t and s can be specified by their corresponding fluxes that can also be dictated by the three equation formulations intrinsically following the conservation of t and s within the viscous sublayer following wu et al 2000 we set k and ɛ at the ice shelf base as k u 2 c μ 0 5 and ɛ u 3 κ δ z where u is the shear velocity κ 0 4 is von kármán constant δ z is the vertical grid spacing in an attempt to make the boundary current system evolve endlessly we use the cyclic lateral boundary conditions kämpf 2010 that is 16 ψ j 0 ψ j n x 17 ψ j n x 1 ψ j 1 where j is the index of grid point in the x direction n x is the corresponding total grid point number and ψ stands for any quantity of concern the utilization of eqs 16 and 17 thus implies the model is designed to follow the evolving plume as it is advected by means of the cyclic boundary conditions rather than to focus on the plume evolution in a fixed box besides eqs 16 and 17 also indicate that the lateral gradients of the variables at the inlet ψ j 1 ψ j 0 ψ j 1 ψ j n x and outlet ψ j n x 1 ψ j n x ψ j 1 ψ j n x of our domain are equal rather than the values of the variables i e this is a periodic neumann condition not a periodic dirichlet condition lastly the rise of melting point in our limited along slope domain presented later is considerably constrained underneath a shallowly sloped ice shelf base to this end in order to consider continuously elevated melting point in our model and in light of the linear ice shelf draft here we introduce an approximate constant rising rate of melting point with time at every grid point that is c v s i n α where the constant c 7 61 10 4 c m 1 v is the characteristic plume velocity of o 10 1 m s 1 accordingly we surmise a rising rate of melting point of 1 10 4 s i n α c s 1 and an in depth discussion on this supposed rising rate of melting point is made in due course 4 reference run 4 1 model setup the values adopted for the parameters of the reference model configuration are summarized in table 1 as alluded to earlier the ais is a likely candidate for an energetic isw plume originating from its deep grounding line this branch of robust o 10 1 m s 1 cold and fresh isw flow propagates along the base of the western side of ais exchanging with the underlying hssw but hardly departure from the ice shelf base galton fenzi et al 2012 liu et al 2017 it becomes evidently supercooled at a distance of 200 km away from the deepest grounding line galton fenzi et al 2012 and finally outflows from beneath the ais front suppressing the local antarctic bottom water formation williams et al 2016 to avoid the complexities of supercooling and possible plume detachment from the ice shelf base we configure our reference run hereinafter referred to as ref for the isw plume underneath the deep inland part of ais before it becomes supercooled i e the early stage in the perspective of its whole journey as follows the domain size along the x and z coordinates are 300 and 150 m the grid spacing in the x and z coordinates are 2 5 and 1 5 m the time step is 0 2 s the ice draft at the origin of coordinates is set to 2500 m the basal slope s i n α is set to 0 021 in accordance with the mean basal slope of the deepest inland part of ais fretwell et al 2013 the ambient temperature t a and salinity s a of local hssw are set to 1 9 c and 34 55 respectively that is the median of the range of the observed hssw properties according to herraiz borreguero et al 2013 on account of the complete absence of direct observations beneath such a deep draught the initial isw salinity is set to 34 1 in line with the simulated freshest isw within the ais cavity from galton fenzi et al 2012 see their fig 9b the initial isw temperature is accordingly set to 3 13 c determined by using a gade line gade 1979 we constrain the drag coefficient at the ice shelf base c d 5 10 3 consistent with that needed to coincide with the recent derived basal melt rates multi year minimum average and maximum are respectively 0 71 2 9 and 6 m yr 1 for 1994 2018 of the southern deep parts of ais from the combination of surface height data from satellite radar altimeters satellite derived ice velocities and a model of firn layer evolution adusumilli et al 2020 in addition the whole system is at rest initially and there are no background pressure gradients i e η 0 the initial thickness of the upper well mixed isw layer is set to 30 m then the isw properties are set to linearly transition from z 30 m to the values of respective quantities of the lower hssw within a thin 9 m interfacial zone as illustrated in fig 1 such a relatively sharp pycnocline is assigned in view of the specified coldest and freshest initial isw layer with least modification by the underlying hssw all the runs in this study are integrated for 144 h last it is important to mention that the sensitivity of the simulated results of ref to changes in the initial thickness of isw layer and interfacial zone is also discussed in detail in the next section 4 2 results a central focus of this work is to understand the dynamics and thermodynamics within an iobc underlain by a significant pycnocline over a wide parameter space by utilizing relatively small scale simulations to this end we diagnose the various processes responsible for heat transport examine the validity of typical entrainment parameterizations and identify potential issues in the current large scale meltwater plume modeling 4 2 1 temperature filed field evolution the richardson number is of paramount importance to our analysis through the whole study however before its calculation according to eq 2 we have to define the lower limit of isw plume first for the depth averaged values at each value of x that is the depth z p a i i e the plume thickness d z p a i where the pai density ρ p a i satisfies 18 ρ a ρ p a i ϕ δ ρ ϕ ρ a ρ z 0 m where δ ρ is the instantaneous maximum of density contrast in the z directional dimension here two proportions of ϕ 75 following chu and soong 1997 and 90 are adopted which represents the pai located within and at the upper boundary of the interfacial zone respectively thence the field averaged bulk richardson number r i representing the relative magnitude of the overall stratification and shear production for the whole plume zone could be expressed by 19 r i g d u r e l 2 g d u u p a i 2 v v p a i 2 where u r e l is the relative plume velocity the angle bracket signifies averaging along l x i e l x averaging and the overline denotes averaging over the plume thickness that is from z 0 m to z p a i first we deem the 90 δ ρ criterion of the pai depth lowering 3 m relative to its initial depth to be the spin up phase of ref and later sensitivity runs we regard the iobc after that period in each run as being fairly developed which is thus our sole focus of subsequent analysis accordingly the spin up period of ref is deemed to be 10 8 h and simultaneously the 75 δ ρ criterion of the pai depth has also lowered nearly 3 m fig 2a and b show the development of the iobc during the spin up phase of ref the iobc is found to be largely established including the upper frictional ekman layer and the lower geostrophic v component beginning to evolve with the density at about 2 5 h from the totally stationary state the large buoyancy forcing imposed by the fairly large basal slope 0 021 and relatively fresh isw is principally responsible for such a quick iobc establishment ref without using the assumed rising rate of melting point i e 1 10 4 s i n α c s 1 is also conducted for comparison fig 2c d in this additional ref the iobc shows almost the same development as in ref which thus demonstrates little influence exerted by the slowly elevated artificial melting point on the relatively short spin up phase the time series of r i based on the 75 and 90 δ ρ criteria of pai in ref are shown in fig 3a both in general exhibit similar trend whereas the one associated with the 75 δ ρ criterion pai within the interfacial zone i e the core of shear instability presents larger fluctuations therefore as evident from the time series of r i based on the 75 δ ρ criterion there exist three distinct regimes at the early stage r i decreases first regime i which essentially results from the effect of the enhanced bulk shear an increase in the denominator of eq 19 red solid line in fig 3b then r i rises at a visibly lower rate compared with the decreasing rate in regime i that is because the bulk shear starts gradually declining at t 20 h red solid line in fig 3b while the bulk stratification gets slightly enhanced blue solid line in fig 3b we term the increasing period of r i from t 20 to 72 h as regime ii after t 72 h r i continues increasing but at a smaller rate and the fluctuations in r i become pronounced because of the minimal bulk shear red solid line in fig 3b moreover the bulk stratification keeps steady to the end of ref blue solid line in fig 3b we term this increasing period of r i from t 72 h to the end of ref as regime iii the results of the bulk shear and stratification based on the 90 δ ρ criterion are also shown in fig 3b compared with the results based on the 75 δ ρ criterion the bulk shear presents a delayed peak on the other hand the bulk stratification is notably weakened closer to the upper well mixed layer and appears to be steadier as shown in fig 3c to l we select successive snapshots of the temperature field at some certain times indicated in fig 3a in each regime two lifecycles of the kelvin helmholtz k h billows within regime i are exhibited in fig 3c to f and their dimensions further develop within regime ii fig 3 g h so the k h instabilities appear to be cyclical they form roll up into billows grow collapse and after some time they form again which aligns with the experimental study conducted by sullivan and list 1994 then in regime iii the k h instabilities convert to the larger scale distortion of the pai characterized by successively occurred wave distortion and breaking by shear fig 3i l these dramatic spatiotemporal deformation of the pai unequivocally leads to the remarkable fluctuation of the variation in the bulk shear red lines in fig 3b and thus in r i fig 3a 4 2 2 vertical dynamical structure the evolution of the vertical structure of dynamical quantities after l x averaging of ice ocean boundary current in ref is illustrated in hovmöller diagrams fig 4 the vertical profiles of both velocity components shown in fig 4a and b are analogous to those described in jenkins 2016 2021 the maximum of v is larger than that of u the boundary layer of u frictional ekman layer reaches a steady state earlier but that of v continues to grow along with the depth of isw plume that is because the purely geostrophic part of v beyond the ekman layer is balanced by the buoyancy forcing ρ a ρ ρ 0 g s i n α corresponding to the temporally varying density deficit thus the flow speeds near the ice shelf base and at depth are respectively dominated by u and v fig 4c the evolving upper mixed layer and its lower interfacial zone can be readily ascertained from fig 4d the chosen 90 δ ρ criterion of pai fairly well depicts the lower boundary of mixed layer and the 75 δ ρ criterion is located within the top region of interfacial zone the dominating turbulence produced within the upper 45 m water column fig 4e and thus exclusively maintaining the mixed layer is significantly vertically constrained by the underlying strong stratification fig 4f h whilst the corresponding shear is also robust therein fig 4 g we also note that the pai depths for both density deficit criteria shown in fig 4f are within the upper portion of the pycnocline which thus means the velocity at the pai determined by momentum transfer from the plume across the pycnocline alone where the ageostrophic u tends towards zero 4 2 3 vertical thermodynamical structure in this subsection we intend to illuminate each thermal process contributing to the local time cumulative temperature change over the whole water column using the continuity equation eq 5 and after l x averaging the conservation equation for temperature eq 9 can be rewritten in the spatial derivative of heat fluxes which is conducive to the thermal analysis carried out here as 20 t t u t x w t z z k z t z here the horizontal diffusion term is vanished because of the adoption of the cyclic lateral boundary conditions and the l x averaging for all the other terms performed here and hereinafter is across the real model domain between the inlet j 1 and outlet j n x excluding the boundary ghost points of j 0 and j n x 1 it is worth mentioning that the continuity equation can be satisfactorily fulfilled by the present numerical scheme the thermal terms relevant to the flow divergence are therefore all discarded in the subsequent analysis time integrating eq 20 we have 21 δ t t 0 t u t x d t t 0 t w t z d t t 0 t z k z t z d t here the reference point t 0 is set to the end time of spin up phase hence the cumulative temperature variation at a certain depth δ t can be attributed to the contributors to advection t 0 t u t x d t convection t 0 t w t z d t and vertical diffusion t 0 t z k z t z d t it should be stated that the diffusive contributors correspond to the sub grid i e parameterized heat fluxes while other contributors correspond to the resolved heat fluxes to this end the evolution of the vertical profiles of the cumulative temperature variation fig 5a and the associated respective thermal contributors fig 5b d in ref can be reproduced based on eq 21 as shown in fig 5a above the depth of 30 m the upper well mixed layer gradually gets warm with a decreasing rate gradually reaching the quasi steady state to the end of simulation below that depth the seawater cools and the cooling extent increases with time within the depth range of the major δ t the vertical components i e vertical diffusion fig 5b and convection fig 5c are principally responsible for δ t compared with the advective process fig 5d in regards to the vertical diffusion fig 5b it is predominantly responsible for the warming of the upper 30 m well mixed layer fig 5a consequently an over simplified turbulence closure scheme e g constant eddy viscosity diffusivity jenkins 2016 is unlikely to provide reasonable near ice base turbulence conditions fig 4e and thus quantitatively reliable melt rates as stated in jenkins 2016 and cheng et al 2020 beneath the initial 30 m depth of isw layer the interlaced cooling warming cooling zone emerges and evolves with time as such the thermal structure exhibited in fig 5b notably illustrates a vertical diffusive exchange between the growing cooler isw plume corresponding to the warming subzone and its underlying warmer water corresponding to the cooling subzone within the iobc system with regard to the convection fig 5c we find that it overall behaves reversely with the role of vertical diffusion but is only prominent within the interval between the depth of 30 m and the 75 δ ρ limit of the plume where the shear instabilities i e overturing effects mainly occur fig 3c l 4 2 4 thermal budget for isw plume in this subsection we intend to conduct the quantitative thermal budget analysis following concepts from plume theory and to analytically obtain the constitutions of the entrainment induced heat transport for meltwater plumes vertically integrating the conservation equation for t eq 9 from z 0 m to z p a i and after some manipulations we obtain the following evolution equation of isw plume temperature 22 t t 1 d d t t p a i t 1 d w t z z p a i 1 d w t z 0 u t x 1 d a z t z z 0 1 d a z t z z z p a i x k h t x after time integrating and l x averaging eq 22 we have 23 δ t t 0 t 1 d d t t p a i t d t t 0 t 1 d w t z z p a i d t t 0 t 1 d w t z 0 d t t 0 t u t x d t t 0 t 1 d a z t z z 0 d t t 0 t 1 d a z t z z z p a i d t t 0 t x k h t x d t the cumulative plume temperature variation δ t can be thus attributed to seven contributors to the interfacial displacement t 0 t 1 d d t t p a i t d t convection at the pai t 0 t 1 d w t z z p a i d t convection at the ice base t 0 t 1 d w t z 0 d t advection t 0 t u t x d t vertical diffusion at the ice base t 0 t 1 d a z t z z 0 d t vertical diffusion at the pai t 0 t 1 d a z t z z z p a i d t and horizontal diffusion t 0 t x k h t x d t that is retained because of the difference in the z p a i across the model domain based on eq 23 we can thus calculate the time series of δ t and its contributing components in ref as shown in fig 6a and b 75 δ ρ and fig 6d and e 90 δ ρ the thermal compositions based on both criteria coincide with each other first the component of the convection at the ice base is negligible overall the convection at the pai has the relatively largest positive warming contribution to δ t fig 6a d the interfacial displacement comes second fig 6a d the third are the diffusion at the pai and the almost equivalent horizontal diffusion fig 6b e on the other hand the advective component for δ t shown in fig 6a and d is essentially the cumulative net advection induced change in the plume averaged temperature with different plume thicknesses i e vertical averaging intervals across the model domain this advective heat transport from the upstream is the dominating process for the negative contribution to δ t which is largely compensated by the warming from the intense shear instabilities induced convection at the pai fig 6a d in addition it should be distinguished from the advective component for δ t shown in fig 5d that is also the cumulative net advection induced δ t but at a fixed depth lastly the vertical diffusion at the ice base inherent with the basal melting only accounts for rather limited negative proportion of δ t fig 6b e as in the literatures alluded to earlier in the conventional depth integrated meltwater plume models the entrainment of ambient fluid into the plume is the arguably exclusive heat source for the plume however the constitutions of the entrainment induced heat flux e h f has not been explicitly analyzed to this end eq 22 can be rewritten as 24 d t t d t t p a i t w t z z p a i w t z 0 d t w z d u t x a z t z z 0 a z t z z z p a i d x k h t x applying the conventional vertically uniform assumption that is t and u are always uniform in the vertical with their depth averaged values t and u to the depth averaged terms in eq 24 we have d t w z t w z 0 w z z p a i t m w z z p a i w z z p a i t d u t x u d t x and d x k h t x x k h d t x k h t x d x x k h d t x substituting these approximations into eq 24 we have the plume temperature transport equation under the vertically uniform assumption as following 25 d t t d t t p a i t w z z p a i t p a i t a z t z z z p a i m t z 0 t u d t x a z t z z 0 x k h d t x contrasting eq 25 with the corresponding equation proposed by hf06 26 d t t e t p a i t m t z 0 t u d t x γ t t z 0 t x k h d t x where e t p a i t corresponds to the e h f e denotes the entrainment rate that is the central issue of the next subsection γ t t z 0 t corresponds to the basal melting related heat flux that is expressed as a z t z z 0 in eq 25 γ t signifies the heat transferring rate then discarding the vertically uniform assumption the analytical expression for the e h f is accordingly obtained as 27 e h f d t t p a i t w t z z p a i d t w z a z t z z z p a i which intrinsically includes three components of the interfacial displacement d t t p a i t net convection w t z z p a i d t w z and vertical diffusion at the pai a z t z z z p a i which is the subgrid contribution based on eq 27 we can therefore calculate the contributions of e h f and its respective components to δ t in ref for both criteria as shown in fig 6c 75 δ ρ and 6f 90 δ ρ for either criterion among these components the interfacial displacement shown to be the largest proportion of the entrainment induced warming and the net convection has the nearly equivalent contribution as the vertical diffusion at the pai in ref 4 2 5 entrainment parameterization parameterizing the entrainment is an indispensable part of the existing depth integrated meltwater plume models as a result to examine the validity of the commonly used entrainment parameterizations eqs 1 and 2 in meltwater plume models is one of the main purposes of this study following hf06 the entrainment velocity is defined as 28 e d t u d x m however we have to use the time integration of eq 28 to evaluate the entrainment parameterization formulations because the vertical grid spacing δ z 1 5 m is far from sufficiently resolving the major term of d t the magnitude of e is about o 10 4 m s 1 to this end in the sense of l x averaging we instead use the following time integrated expression for evaluation 29 δ d t 0 t e d t d d 0 t 0 t m 1 l x u d x 0 u d x l x d t where δ d is the relative plume thickness caused by the entrainment to the value d 0 at t t 0 previous stratified mixed layer deepening experiments have focused on delineating the entrainment law i e the relationship between e and r i which can be rewritten here in the form fernando 1991 30 e e 0 u r e l c d r i n where r i is calculated by using eq 19 and n is the constant associated with much uncertainty fernando 1991 has given an excellent review of the diverse entrainment laws for stratified shear flows from 30 references see his table 1 and the determination of the value of n is yet to be generalized sullivan and list 1994 strang and fernando 2001 pham and sarkar 2017 it is worth reminding that the n 1 case corresponds to hf06 eq 1 and j91 eq 3 is an idealized approximation of the former and can be regarded as n 0 case if the basal slope s i n α is constant as in this study fig 7a and b in the case of 75 δ ρ criterion of pai show a comparison between the simulated plume thickness the rhs of eq 29 and seven time integrated best fit with respective to e 0 entrainment laws the lhs of eq 29 in view of its large uncertainty we set the power n in eq 30 as wide as possible i e from n 0 virtually j91 here to 3 with 0 5 interval first the simulated thickness behaves like a power law with a power larger than one resulting in a nonlinear increase with time initially fig 7b then gradually levels off with further increasing time fig 7a with regard to the behavior of seven best fit entrainment laws it is noticeable that the larger the power n is the more nonlinearly the formulation behaves in detail j91 has the smallest nonlinearity but the largest values in the beginning and the end of simulation n 3 case in contrast has the largest nonlinearity and values in the intermediate phase but the calculated thickness levels off most quickly particularly hf06 performs best with the best fit e 0 0 09 the root mean square error rmse is 0 68 m and j91 in contrast performs poorly with the best fit e 0 0 023 which is nevertheless comparable to the pervasively adopted value of 0 036 it is possible that the chosen initial states considered here are far from providing a balanced plume state which implies that the approximation adopted by j91 would not be expected to hold moreover the time series of the nondimensional e proportional to u r e l for hf06 in essence r i 1 is exhibited in fig 7c the nondimensional e has a sudden increase initially and quickly reaches the peak values then it progressively declines at a relatively lower rate and tends towards a nearly steady value to the end the behaviors of both simulated and parameterized plume thickness based on the 90 δ ρ criterion of pai see fig 7d e resemble those for the 75 δ ρ criterion even though the entrainment is demonstrated to be some weaker for the former case fig 7a d in addition for the 90 δ ρ criterion n 2 case performs best with e 0 0 0057 fig 7f is accordingly for n 2 case in essence r i 2 analogous to fig 7c and e 0 0 019 for j91 as elaborated above neglecting the velocity at the pai i e u p a i 0 v p a i 0 is an inherent and unavoidable deficiency of all the depth integrated meltwater plume models in which the information about the interfacial zone is completely lacking although the vertical relatively far field velocity can be simulated in the ocean cavity models as elucidated earlier the spatiotemporally varying interfacial zone between lighter denser waters is far from being sufficiently resolved owing to the coarse vertical resolutions as shown in fig 8a black dashed line the plume speed u p u 2 v 2 u p 2 v p 2 based on the 75 δ ρ criterion increases with time then decreases slightly with more significant fluctuation in the second half of simulation in contrast the variation in u r e l u p u p a i 2 v p v p a i 2 black solid line in fig 8a perfectly synchronizes with that in r i 1 see fig 7c because of the quadratic dependence of r i 1 on velocity eq 19 and shows conspicuously wider variability and more pronounced fluctuations that are caused by the velocity at the pai fig 8b according to eqs 19 and 30 the entrainment velocity predominantly scales with u 2 n 1 consequently the quasi steady behavior of u p in other words taking no account of u p a i v p a i as done in plume models black dashed line in fig 8a leads to a quasi linear isw plume thickening regardless of the n values exceeding and progressively deviating from the simulated plume thickness dashed lines in fig 8c compared with the simulated thickness taking account of u p a i v p a i by contrast significantly improve the entrainment parameterization performance which behaves much more nonlinearly especially for hf06 solid lines in fig 8c furthermore the above findings can also be obtained in the case of 90 δ ρ criterion fig 8d f in conclusion only considering the bulk plume velocity in the entrainment parameterizations may introduce a large deviation from the real entrainment which implies a potential adverse influence on estimating the basal melt rate by using the depth integrated meltwater plume models it is noteworthy that we also examine the parameterized entrainment for the 10 δ ρ criterion of pai that is the pai is defined within the lower marginal part of the interfacial zone as shown in fig 9a the difference of parameterizing the entrainment arising from whether taking into account the pai velocity vanishes because of the weak ambient speed sufficiently away from the upper solid boundary fig 4c the behaviors of the j91 and hf06 parameterizations collapse i e irrespective of r i which results from the relatively steady small values of r i 1 for the 10 δ ρ criterion fig 9b in addition the generally poor performance of the conventional entrainment parameterization of eq 30 for the 10 δ ρ criterion shown in fig 9a compared with that shown in fig 8c and f seems to imply that it is not suggested to define the lower limit of the plume within the lower marginal part of the interfacial zone away from the core of shear instabilities and characterized by strong stratification reflected by the minimal r i 1 for the 10 δ ρ criterion fig 9b 4 3 supposed rising rate of melting point in view of the fact that the horizontal domain size 300 m adopted here is much smaller than the typical horizontal resolutions 1 km of the existing coupled ice shelf ocean models the l x averaged temporal evolution of the iobc exhibited above can thus be comprehended in the sense of the evolution along the ice shelf base towards shallower depths to this end by time integrating the time series of u p dashed line in fig 8a in ref the corresponding spatial scale of 75 km for the deep inland part of ais is obtained that spatial scale corresponds to a shallowing of 1575 m under s i n α 0 021 in ref and thus indicates a significant rise of 1 2 c in melting point which has been approximately considered by using the above supposed rising rate of melting point 1 10 4 s i n α c s 1 a comparison of the calculated melt rate with and without the rising rate of melting point in ref is shown in fig 10 the melt rate increases first then plateaus with time if the raising melting point is not considered dashed line in fig 10 that deviates from the fact that along the western route of an energetic isw plume the amery ice shelf basal melting decreases with distance from the grounding line and transitions to basal freezing towards the calving front fricker et al 2001 galton fenzi et al 2012 liu et al 2017 the never steady simulated result for a moving box following the evolving plume is coincident with that fact when the rising rate of melting point is considered solid line in fig 10 while we acknowledge that this is an artificial and somewhat crude treatment we are convinced that it would not influence the key findings substantially and the effects of the rising melting point should be considered here 5 sensitivity tests in this section we use ref for a sensitivity study for isw plume with all parameters except the one under investigation held fixed all the sensitivity tests conducted here are summarized in table 2 including changing basal slope j0 016 and j0 025 changing ambient hssw salinity s34 50 and s34 60 adding a constant far field across slope geostrophic velocity v g g c o s α ϕ η x vg0 03 and adding an oscillating v g with different periods and amplitudes td0 025 10 h td0 025 20 h and td0 040 10 h the sensitivity to the initial isw thickness ini24 and ini36 and initial interfacial thickness gradual and sharp is also examined it is important to state that the reference point t 0 is unified to the latest end time of spin up phases among the selected sensitivity runs for the following comparisons to ensure the iobc in each run is fairly developed 5 1 thermal analysis for isw plume first the cumulative plume temperature variation δ t in all runs are shown in fig 11 the results based on both criteria are almost the same as each other so only the case of 75 δ ρ criterion is shown in fig 11 the bulk warming in the plume is heightened with the reinforced buoyant forcing manifested in an increase in basal slope fig 11a or vertical density deficit despite the nonmonotonicity with increasing density contrast fig 11b adding a constant positive across slope geostrophic velocity v g 0 03 m s 1 can enhance both upslope and across slope velocity components see fig 5a c in jenkins 2016 which corresponds to a strengthened warming trend to the end of simulation fig 11c tides underneath the ais which are mixed semidiurnal with four main tidal constituents m 2 s 2 k 1 o 1 hemer et al 2006 have been proved to be much weaker than those beneath e g filchner ronne and ross ice shelves padman et al 2018 and likely have little influence on the oceanographic properties for the ais cavity hemer et al 2006 on the other hand the heat content for the ais cavity and the associated basal melt rate can feature obvious tidal oscillations in an ocean cavity modeling including tides at open boundaries galton fenzi et al 2012 notwithstanding following jenkins 2016 and cheng et al 2020 we also add an oscillating background geostrophic velocity instead employing a tide model into our idealized model to represent a simplified tidal forcing it can be inferred from fig 11d that the influence of the oscillating v g on the plume warming is rather limited here to sum up it is suggested from fig 11a to 11c that the bulk warming of the isw plume can become more significant if the iobc is reinforced by virtue of some certain dynamic reasons in addition the response of the variation in δ t to the differing initial isw thickness fig 11e is shown to be more sensitive than that to the initial interfacial thickness here fig 11f similar to fig 11 we have also investigated the sensitivity of each major contributive component that is the interfacial displacement convection at the pai advection vertical diffusion at the pai and horizontal diffusion shown in fig 6a however no general trends with the differing dynamic forcing conditions like illustrated in fig 11 are found except for the entrainment fig 12 the response of the warming caused by entrainment to the varying forcing conditions are more conspicuous than that of the bulk warming shown in fig 11 that further confirms the predominant role of entrainment on controlling the bulk isw plume temperature and also implies the modulation of other secondary thermal processes it is worth noting that the magnitude of the entrainment induced warming in our steepest case j0 025 declines slightly fig 12a compared with ref because the vertical thermal deficit also decreases synchronously owing to the enhanced mixed layer warming similarly the influence of initial interfacial thickness on the entrainment induced warming is less significant than that of initial isw thickness here fig 12e f moreover for the l x averaged melt rate there is an inconspicuous sensitivity to the tested factors in fig 13 except for the runs of varying buoyant forcing featuring relatively more sensitivity fig 13a b 5 2 entrainment parameterization first the simulated isw plume thickness in all runs is compared in fig 14 and the entrainment for the 75 δ ρ criterion of pai fig 14a is entirely seen to be larger than that for the 90 δ ρ criterion fig 14b besides it is also illustrated for both criteria that the entrainment can be heightened when the buoyant iobc gets dynamically stronger the comparison between the simulated plume thickness and the thickness calculated by seven best fit entrainment formulations with different power n in all sensitivity runs is presented in figs 15 and 16 for the 75 and 90 δ ρ criteria respectively in each sensitivity run for either criterion there exists a best performing entrainment formulation that can fairly well match with the simulated plume thickness the best fit values of n and e 0 as well as rmse for each best performing entrainment formulation are given in table 3 in view of great complexity and much uncertainty as elucidated above it is unlikely hitherto to propose a universal value of n still we calculate the average n of 0 88 and 1 15 for the 75 and 90 δ ρ criteria respectively based on all our runs for the energetic buoyantly forced stratified iobcs that is in line with the adoption of hf06 i e n 1 however the fact that j91 formulation performs poorly potentially indicates that the influence of the variation in r i on the entrainment cannot be ignored 6 impacts of resolution in this section we examine how the model resolution impacts the isw plume growth and temperature variation as well as melt rate for varying basal slope runs j0 016 and j0 025 and ref to this end we additionally conduct j0 016 coarse ref coarse and j0 025 coarse at a coarser resolution of δ x δ z equaling 3 m 2 m and j0 016 fine ref fine and j0 025 fine at a finer resolution of δ x δ z equaling 2 m 1 2 m with all parameters kept constant the comparisons of the simulated time series of isw plume thickness and temperature variation at varying resolutions are presented in fig 17a to d with the plume getting stronger by increasing the basal slope on the whole the difference in the plume thickness and temperature variation caused by the different resolutions for either 75 fig 17a b or 90 δ ρ fig 17c d criterion becomes more obvious furthermore the absolute difference in the simulated melt rate at this range of resolutions is somewhat amplified with increasing basal slope and the simulated melt rate monotonously decreases with fining resolution fig 17e we attribute this decrease in melt rate to the diffusive heat flux near the ice base fig 17f as the vertical resolution is coarsened the stratification near the ice base is artificially attenuated and the near ice base turbulence is thus more sufficiently developed 7 discussion owing to the considerably coarse resolution adopted here compared with that in either large eddy simulations vreugdenhil and taylor 2019 rosevear et al 2021 begeman et al 2022 or direct numerical simulations mondal et al 2019 which concern the ice shelf ocean boundary layer dynamics but for much weaker o 10 2 m s 1 buoyant flows than here with purpose of investigating the near base turbulence and examining the thermohaline transfer coefficients for melting our simulations cannot be regarded as being turbulence resolving moreover the mixing generated in our 2 5 dimensional model configuration results from two dimensional turbulence that is likely to be quite different to three dimensional turbulence even so some of our simulated results are consistent with some published evidence in a qualitative manner which lends a certain degree of confidence to our model first as shown in fig 3c to l the simulated temperature field evolution is in close consonance with the laboratorial observations including k h billowing and wave breaking events of strang and fernando 2001 second our simulated evolution of isw plume thickness e g in ref to a large degree resembles a simulated variation in the thickness of the wind driven ocean mixed layer atop a strongly stratified barrier layer that is an initial rapid deepening and a late time slow entrainment as shown in results from large eddy simulation see fig 3a in pham and sarkar 2017 moreover the calculated trend of the variation in e shown in fig 7c and f is virtually the same as that with respect to the propagation distance in a gravity current modeled by a high order three dimensional nonhydrostatic spectral element model see fig 4a in xu et al 2006 more importantly the average values of the best fit e 0 in j91 for all sensitivity runs are 0 024 and 0 019 for the 75 and 90 δ ρ criteria of pai respectively which are comparable to the canonical value of 0 036 that implies our simulated entrainment rate is quantitatively reasonable to a certain extent other than the adopted resolution the limitation of 2 5 dimensional model even though allowing for the inclusion of the coriolis force omits all the processes relating to the across slope gradient y and cannot take into account the influences exerted by the unique topographic features i e basal channels and keels dallaston et al 2015 marsh et al 2016 of the underside of ice shelves three dimensionally modeling the stratified iobcs in much more complicated dynamic environments would be a natural but formidable challenge that is left for a later study a key finding of jenkins 2016 is the division of the iobc into an external geostrophic flow and an internal frictional boundary layer features that are averaged together by depth integration in the plume framework lately jenkins 2021 provided more details about the shear stability and mixing within the iobcs by using a mixing length model however the restriction to only one dimension in both jenkins 2016 2021 represents a severe limitation that makes the vertical diffusion become the only one thermal process lastly we acknowledge that the ref and its sensitivity tests are designed based on the instance of the ais that is one of the typical cold water ice shelves in antarctica even so examining in detail the thermodynamics of the iobcs beneath the warm water ice shelves for example along the coast of west antarctic would be a straightforward later investigation by using the same methodology 8 conclusion compared with the resolution of current coupled ice shelf ocean models a relatively high resolution 1 5 m in vertical 2 5 dimensional nonhydrostatic vertical slice model was developed to investigate in detail the thermal processes within a stratified iobc underneath a cold water ice shelf we draw the following conclusions based on our simulations 1 according to the variation in the calculated richardson number the evolution of the shear instabilities manifested by temperature field can be divided into three regimes which are respectively characterized by small scale k h billows large scale k h billows and much severer distortion of the pai characterized by wave distortion and breaking at the pai 2 the vertical diffusion predominantly controls the heat content of the near ice base water column while the shear instabilities induced convection at depth is active between the initial depth of plume and the deepening pai 3 the most important contributor to the meltwater plume warming is demonstrated to be the convection at the pai whereas the advective heat transport is illustrated to be the predominant sink term for the bulk heat content of the meltwater plume 4 an analytical expression of the e h f for the meltwater plumes is obtained which consists of three contributors to the interfacial displacement net convection and vertical diffusion at the pai and the first is confirmed to be of primary importance 5 the routinely employed entrainment formulation of j91 performs poorly in our examination and the velocity at the pai ought to be considered in the existing entrainment parameterizations for meltwater plume models 6 if the buoyancy associated forcing conditions are reinforced the bulk plume temperature gets warmer dominated by the enhanced entrainment induced warming 7 the sensitivity of the simulated thickness and bulk plume temperature to varying resolutions becomes more evident if the buoyancy forcing gets stronger besides the deviation in the calculated basal melt rate caused by varying resolutions is somewhat amplified with stronger buoyancy forcing which is determined by the near ice base turbulence condition to conclude the shear instabilities induced entrainment occurring at the pai plays a vital role of warming the meltwater plumes beneath the ice shelves in antarctic accordingly there is a pressing need to improve the model resolution of ocean cavity models to sufficiently resolve the entrainment at the pai for evaluating basal melting in addition the conventional depth integrated plume models may in the future need to be coupled with e g a sort of boundary layer model like in jenkins 2016 2021 to consider the velocity at the pai for entrainment parameterization credit authorship contribution statement chen cheng conceptualization methodology software formal analysis writing original draft visualization zhaomin wang investigation writing review editing funding acquisition luyu shen validation formal analysis visualization chengyan liu validation formal analysis visualization declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments we would like to thank xylar s asay davis and one anonymous reviewer for their thorough review and helpful commentaries and improvements this work was supported by the national natural science foundation of china 41941007 the natural science foundation of jiangsu province bk20191405 the national natural science foundation of china 41876220 and the project supported by innovation group project of southern marine science and engineering guangdong laboratory zhuhai 311021008 
23826,simulated antarctic sea ice sensitivity to parameter variation is tested in a global coupled climate model parameter changes affect areal coverage thickness and seasonality of sea ice beyond the bounds of internal variability with a tendency for several parameters to substantially impact sea ice retreat the largest sea ice response occurs with changes to the sea ice turning angle parameter enhanced northward transport of ice leads to a thinner ice cover that more readily melts while lower turning angles permit greater convergence in the interior resulting in a thicker more persistent ice pack setting snow and ice albedo above the default value increased mean sea ice year round including at the sea ice minimum while other parameter experiments did not increase minimum sea ice beyond internal variability low values of heat exchange between the ocean and base of the sea ice ocean ice heat flux parameter sharply reduce bottom melt and slow sea ice retreat high density sampling in both the control scenario identical parameters but differing initial conditions and the parameter tests shows large simulated internal variability suggesting that the signal of the sea ice response could be overwhelmed in a low density sample test large ensemble testing is a valuable tool for testing sensitivity in coupled systems where variability and feedbacks are more complex than in stand alone sea ice models keywords sea ice antarctic modelling parameter sensitivity variability 1 introduction sea ice modulates the exchange of heat gas and momentum between the atmosphere and the high latitude oceans dieckmann and hellmer 2010 massom and stammerjohn 2010 weeks and schroeter 2019 given its fundamental importance to the global climate it is vital that the mean sea ice state is reproduced as accurately as possible by climate models however current and previous state of the art global coupled climate models gcms in the coupled model intercomparison project cmip generally do not capture observed historical since 1979 trends and many also produce substantial biases in mean antarctic sea ice hobbs et al 2016 roach et al 2020 schroeter et al 2018 2017 shu et al 2020 vaughan et al 2013 this limits confidence in the veracity of future projections of sea ice in these models the disparity between observed sea ice extent seasonality and trends and those simulated by gcms has prompted attempts to optimise parameterisations of the dynamic and thermodynamic processes driving sea ice in models and to identify ideal ranges for sea ice parameters to tune models and improve the representation of the simulated climate dorn et al 2007 hunke 2010 ma et al 2020 massonnet et al 2014 miller et al 2006 roach et al 2018 uotila et al 2012 parameter tuning has been shown to reduce model bias in reproducing historical sea ice trends particularly in the arctic roach et al 2018 however the integrity of sea ice in tuned model simulations has been the subject of intense debate for example it has been argued that tuning parameters such as ice albedo artificially compensates for model biases masking atmospheric deficiencies that would otherwise lead to unrealistic sea ice conditions eisenman et al 2007 others in contrast argue that more sophisticated representation of mechanical sea ice processes reduces ice thickness sensitivity to albedo tuning björk et al 2013 and that error compensation can also result from credible physical processes and feedbacks deweaver et al 2008 uotila et al 2014 decomposed the sea ice concentration budget in 2 cmip5 models and an ocean sea ice model revealing that excessive convergence at the coast and advection at the ice edge in these models was balanced by enhanced sea ice melt with the competing biases resulting in a seemingly realistic representation of the seasonal sea ice cycle indeed while several state of the art gcms have been shown to have good representation of the observed seasonal sea ice cycle the reliability of simulated dynamic and thermodynamic processes underpinning the seasonal cycle varies substantially holmes et al 2019 confidence in future projections of sea ice is constrained by the accuracy of simulated historical sea ice and it is therefore imperative to consider not just the sensitivity of sea ice metrics but also of the underlying physical processes driving seasonal sea ice evolution to changes in key sea ice parameters holland and kimura 2016 lecomte et al 2016 uotila et al 2014 in the southern ocean antarctic sea ice is geographically unbounded to the north subjecting it to strong prevailing winds powerful waves and high snowfall rates maksym et al 2012 this extremely dynamic sea ice environment has high internal variability which adds to uncertainty surrounding the inconsistency of antarctic sea ice representation in gcms seasonal sea ice evolution occurs through complex interdependent thermodynamic and dynamic processes antarctic sea ice is predominantly divergent in the ice interior holland and kwok 2012 massom et al 1998 worby et al 1998 coastal polynyas maintain large areas of open ocean within the ice pack encouraging winter sea ice growth as water is exposed to the cold overlying atmosphere with ice then transported northwards away from the coast drucker et al 2011 in other regions coastal easterly winds cause ice near the continent to converge against land fast ice and the coastline where sea ice is compressed and mechanically deformed through ridging and rafting which can thicken ice substantially more than thermodynamic production maksym et al 2012 during the spring solar heating of open ocean water caused by diverging ice such as leads combined with upwelling heat from the sub pycnocline into the surface ocean drives sea ice retreat gordon 1981 martinson 2012 towards the ice edge winds shift ice north to warmer latitudes where its presence is thermodynamically unsustainable inducing melting the location of freezing and melting sea ice denotes the location of brine rejection and freshwater input which has important implications for ocean stratification and water mass formation abernathey et al 2016 haumann et al 2016 as well as ocean sea ice feedback mechanisms goosse and zunz 2014 furthermore the thickness and coverage of sea ice determines surface albedo which denotes the amount of solar radiation that is reflected brandt et al 2005 and hence atmosphere ocean heat transfer and the timing and rate of spring ice melt however not all of the aforementioned processes are explicitly resolved in current coupled global climate models due to high computational expense limiting model resolution necessitating the use of parameters that occur at unresolved spatiotemporal scales the parameters themselves also possess uncertainty and may directly influence model bias understanding the response of dynamic and thermodynamic sea ice processes to changes in sea ice parameters is therefore of paramount importance in seeking to optimise a model particularly in the southern ocean where the ocean heat flux contributes strongly to the seasonal cycle of sea ice uotila et al 2014 the present study uses a coupled global climate model and ensemble prediction system to initialise forecasts from a wide range of initial conditions to investigate the sensitivity of sea ice parameters detailed in section 3 1 with respect to a 90 member control run previous studies have sought to use the results from parameter explorations to tune the model towards sea ice observations however our analysis seeks to improve understanding of how changes in parameters affect the underlying processes driving seasonal sea ice evolution the large ensemble of states provides a unique opportunity to sample the sensitivity of sea ice parameters in the model and thoroughly compare the envelope of simulated internal variability to variability resulting from changes to the parameter values 2 model we use the csiro climate retrospective analysis and forecast ensemble system cafe o kane et al 2021 2019 sandery et al 2020 which couples the modular ocean model version 4 1 mom4 griffies et al 2003 with the land model version 2 lm2 atmospheric model version 2 am2 and sea ice simulator sis components from the geophysical fluid dynamics laboratory climate model version 2 1 gfdl cm2 1 delworth et al 2006 both am2 and lm2 have a 2 latitude x 2 5 longitude horizontal resolution and am2 has 24 vertical levels the mom4 ocean grid resolution is 1 in the zonal direction and nominally 1 in the meridional direction though with gradually increasing resolution from 30 s and 30 n towards the equator resulting in 0 33 resolution between 10 s and 10 n and increasing resolution towards the southern ocean resulting in 0 25 meridional resolution at 78 s bi et al 2013 mom4 has 50 vertical levels ranging from 10 m resolution in the upper ocean to approximately 300 m resolution in the deep ocean which does not resolve ekman spirals sis uses the same horizontal ocean grid with a modified three layer semtner 1976 thermodynamic scheme with 2 equally sized ice layers a snow layer and 5 ice thickness categories delworth et al 2006 winton 2000 the thickness categories have upper and lower thresholds to represent the rapid ice growth and melt as well as the formation of leads frazil ice from the ocean is added to the thinnest ice category and ice is moved from thinner to thicker categories as ice grows and reaches the upper threshold of each category and vice versa delworth et al 2006 variable heat capacity exists in the upper ice layer in order to represent brine pockets whereas the lower ice layer is given a fixed heat capacity and the snow layer has zero heat capacity winton 2000 3 method 3 1 sea ice parameters the sea ice simulator sis component of cafe permits explicit values to be set for a number of parameters see https www gfdl noaa gov sea ice simulator a 10 member sample sensitivity test is run on a set of nine available parameters the details of which are described below and the values summarised in table 1 based on the results from the sample test 5 parameters were chosen for the full 90 member sensitivity analysis see section 4 1 it should be noted that while several sea ice parameters are known to vary spatially only a single global value for each member was selected for the purpose of this study 3 1 1 sea ice turning angle thickness of sea ice is sensitive to changes in the ice ocean stress turning angle with non zero values leading to larger amounts of sea ice transported north to warmer latitudes and less ice converging near production zones hunke 2010 ma et al 2020 uotila et al 2012 this has important implications for atmosphere ocean interactions such as increasing freshwater input into the surface ocean further north increasing sea ice cover in the ice interior and thus the albedo and changes to surface air temperature and surface winds ma et al 2020 while some coupled models are capable of resolving ekman spirals models such as mom with a 10 m ocean resolution in the upper ocean do not and hence momentum flux does not pass into the ocean and cannot drive an ekman layer i e a 0 turning angle turns the ice alongside wind stress with ice motion approximately equally driven by geostrophic wind and ocean circulation thorndike and colony 1982 turning angle parameterisation for sea ice is an important method of tuning antarctic sea ice dynamics and thus southern hemisphere climate in models with low vertical ocean resolution antarctic ice has been shown to drift at angles of approximately 20 30 to the left of the surface wind direction increasing to up to 40 during the summer when ice concentrations are low allison 1997 kottmeier et al 1992 wamser and martinson 1993 however values in previous antarctic parameter experiments span only 0 23 hunke 2010 ma et al 2020 uotila et al 2012 and the sis default value is 25 denoted in the sis namelist as wd turn for this analysis values are assigned from 0 to 40 3 1 2 ocean ice drag coefficient the coefficient describing the drag force between the base of the sea ice and the surface of the underlying ocean water is an important parameter for representing sea ice dynamical processes through horizontal momentum exchange from wind and ocean currents lu et al 2011 in previous testing in an multivariate ice only model the ocean ice drag coefficient proved to be highly sensitive throughout the year strongly influencing regional sea ice volume kim et al 2006 observation based estimates and previous modelling studies yield a range for the ice ocean drag coefficient of between 1 13 5 36 10 3 kim et al 2006 lu et al 2011 massonnet et al 2011 stopa et al 2018 wamser and martinson 1993 the default value for the ice ocean drag coefficient denoted as cdw in sis is 3 24 10 3 we consider the range 0 87 5 5 10 3 3 1 3 ice strength the strength of sea ice impacts its mechanical redistribution as it sets the resistance of the ice to compression and deformation hibler 1979 sea ice strength is related to the distribution of sea ice thickness with dynamic processes causing an increase or decrease in the fraction of open water as sea ice diverges or converges and is widely described as in hibler 1979 p p 0 h exp c 0 1 a where a represents sea ice concentration h is mean ice thickness and p 0 and c 0 are two strength parameters available for tuning in sis p 0 denotes the compressive ice strength determining the internal ice stress at which deformation or yielding is permitted while c 0 relates ice strength to the fraction of open ocean water in this equation sea ice exponentially strengthens as the fraction of open water decreases and linearly strengthens with increasing ice thickness and vice versa miller et al 2006 the default sis values are 2 75 10 4 pa for p 0 and 20 for c 0 the literature spans 0 5 10 0 10 4 pa for p 0 hibler 1979 miller et al 2006 zhang and hibler 1997 while c 0 is usually set to between 10 20 with doubling of c 0 advised by hibler 1979 to test the effect of open water on ice strength particularly in summer we therefore use parameter ranges of 0 5 10 0 10 4 pa for p 0 and 10 40 for c 0 3 1 4 ice albedo surface albedo characterises the efficiency with which the surface absorbs or reflects solar radiation presented as a unitless fraction while the open ocean generally has an albedo of approximately 0 07 i e reflects only 7 of incoming solar radiation spectral radiometer measurements of sea ice in east antarctica show snow free ice albedos ranging from 0 09 for grease ice to 0 25 ice less than 0 15 m thickness 0 35 ice between 0 15 0 30 m thickness 0 42 first year ice between 0 30 0 70 m thickness and 0 49 first year ice greater than 0 70 m thickness massom et al 2001 previous studies have used constant ice albedo parameters of between 0 45 and 0 64 roach et al 2018 semtner 1976 while the default ice albedo in sis is 0 65 the present analysis uses values between 0 5 and 0 8 for ice 3 1 5 snow albedo the albedo of sea ice is strongly influenced by the presence and depth of snow for ice with a thin layer of snow up to 3 cm depth observed values range between 0 42 and 0 82 while ice with a thick snow layer ranges from 0 7 0 85 though cloudy conditions can further increase albedo up to 0 87 under either thin or thick snow brandt et al 2005 the default snow albedo in sis is 0 8 we use values between 0 6 and 0 9 3 1 6 fraction unreflected shortwave radiation penetrating ice the effect of penetrating solar radiation on sea ice thickness is an important consideration this energy represents latent heat of fusion within the ice that initiates melting in high salinity pockets within the ice with the liquid remaining trapped in the ice unless the ice melts completely as a source of latent heat inhibiting autumn thickening of the ice maykut and untersteiner 1971 semtner 1976 energy absorption into the sea ice is calculated using a constant value to depict the fraction of unreflected shortwave radiation that penetrates the ice i o the default value in sis denoted as pen ice in the sis namelist is 0 3 previous studies have used a wide range of values such as 0 17 maykut and untersteiner 1971 semtner 1976 0 18 lecomte et al 2011 0 3 bitz and lipscomb 1999 winton 2000 0 32 untersteiner 1964 and 0 34 untersteiner 1961 the present analysis uses a range of values evenly spaced between 0 and 0 35 3 1 7 snow conductivity the insulative snow cover overlying sea ice is an important component of simulating growth and melt of sea ice as it has a relatively low thermal conductivity and therefore reduces heat loss from the sea ice into the atmosphere lecomte et al 2013 massom et al 2001 as this can slow or halt basal ice growth snow conductivity is closely tied to the heat flux from the ocean into the base of the sea ice see section 3 1 8 massom et al 2001 previous studies have assigned snow conductivity denoted as ks in sis values between 0 112 0 35 w m 1 k 1 kim et al 2006 massom et al 2001 and the default sis value is 0 31 w m 1 k 1 for this analysis ks was assigned values between 0 1 0 35 w m 1 k 1 3 1 8 ocean sea ice heat flux ocean atmosphere heat exchange and upwelling of relatively warm deeper ocean water to the surface plays a strong role in melting sea ice during retreat gordon 1981 simulations with an ice only model show that increased ocean heat flux to the base of the ice results in substantially thinner sea ice hunke 2010 sis explicitly sets the heat flux between the ocean and the bottom of the sea ice denoted in the sis namelist as kmelt w m 2 with the model then calculating bottom heat and thus growth or melt at the base of the sea ice maykut and untersteiner 1971 semtner 1976 winton 2000 ocean sea ice heat flux can be written as k ρ c p c h u t o t f m u t s where ρ is ocean water density 1030 0 kg m 3 c p is the specific heat capacity of ocean water 4200 0 j kg 1 k 1 c h is a heat transfer coefficient of 0 006 frew et al 2019 mcphee 1992 uotila et al 2012 u is the friction velocity at the interface of the sea ice and ocean mclaren et al 2006 mcphee 1992 roach et al 2018 the remaining terms are multiplied with kmelt to produce the bottom heat t o is the surface ocean temperature t f is the freezing temperature of ocean water and mu ts is a parameter to relate the freezing temperature to salinity mcphee 1992 found instances of u up to 0 02 m s 1 and several modelling studies have set a minimum u value of between 0 0005 and 0 005 mclaren et al 2006 uotila et al 2012 the default sis value for kmelt is 243 6 w m 2 indicating a value of approximately 0 0094 for u with u values of between 0 0005 and 0 02 kmelt could equal anywhere from 12 6 to 519 w m 2 however although heat fluxes of up to 500 w m 2 have been observed in the southern ocean mcphee 1992 average values would presumably be lower in the present analysis we choose 200 w m 2 either side of the default with kmelt assigned values between 43 u 0 00167 and 433 u 0 0167 w m 2 3 2 experiments and data the control experiment uses the default model parameters see table 1 for 90 members each taking initial conditions from january of a single year from the last 90 years of a 500 year cafe climate state run taking initial conditions from 90 consecutive years of a spun up climate introduces large internal variability into the ensemble in which context the parameter varying experiments are considered consistent interannual atmospheric forcing across the ensemble adopts the use of the cmip5 standard of monthly mean distributions of interannual tropospheric ozone and aerosols from anthropogenic and biomass emissions lamarque et al 2010 o kane et al 2019 nine 10 member parameter varying sensitivity experiments are run with each member using a different set of initial conditions taken arbitrarily from the set used by the control experiment and varying values for a single parameter in all members of each experiment all experiments are run for a 14 year period 2005 2018 with the first four years removed from analysis to account for the time required for the model to reach the new climatology after parameter perturbation based on initial results see section 4 1 two dynamic and three thermodynamic parameters are selected for a second 90 member test using the same parameter range with a higher density sampling monthly output from all experiments are regridded from the 360 x 300 logically rectangular horizontal mesh bi et al 2013 onto a 1 x 1 rectilinear grid sea ice volume siv is calculated as the product of sea ice concentration thickness and grid cell area areal sea ice extent sie is calculated as the integrated coverage per degree of longitude using grid cells with at least 15 ice concentration and sea ice area sia is calculated as the integrated area of grid cells with ice cover multiplied by the fraction of grid cell coverage calculations of the components of seasonal sea ice evolution follow methods from previous studies holland and kwok 2012 lecomte et al 2016 uotila et al 2014 though given the cafe model produces sea ice thickness as well as concentration our budget decomposes total sea ice volume schroeter et al 2018 total monthly siv change siv t left hand side is composed of two dynamic processes advection first right hand term and divergence second right hand term and a residual term encompassing thermodynamic freeze melt f and the effects of ridging and rafting r where u denotes the sea ice velocity vector s i v t u siv siv u f r to aid interpretation of the volume budget decomposition the sign of the divergence term has been reversed so it becomes convergence where increasing values indicate the increasing density of sea ice within a cell i e convergent sea ice and decreasing values show the reverse i e divergent sea ice climatologies of siv sie siv t and its constituent components as well as model diagnostics of incoming and outgoing surface shortwave radiation ocean ice heat flux and upper and lower ice melting energy flux were computed for all variables for all members to delineate the ice edge from the interior the northern bounding line of 15 sea ice concentration during the seasons of advance and retreat is calculated for each member and the ice edge taken to encompass the area of 4 latitude south of that bounding line previous studies have used a smaller area to delineate sea ice edge and interior e g 37 5 km kimura and wakatsuchi 2011 1 longitude schroeter et al 2018 however in a qualitative examination of this bounding line in the default and individual ensemble members from the parameter experiment not shown we find this insufficient to encompass the distinct regions of different sea ice processes in the decomposition of siv t for longitudes where the ice edge area intersected with the coastline particularly during retreat due to low ice cover the longitude is taken to have no ice interior during that season we temporally average sea ice evolution into the seasons of advance march august and retreat october february raphael and hobbs 2014 schroeter et al 2018 2017 in order to summarise seasonally distinct behaviour three observation based sea ice concentration products are obtained for the period 1979 2020 national snow and ice data center nsidc goddard merged sea ice concentration meier et al 2017 ocean and sea ice satellite application facility osi saf climate data record osi 450 lavergne et al 2019 met office hadley centre sea ice and sea surface temperature dataset version 2 hadisst 2 2 0 0 titchner and rayner 2014 4 results compared with satellite based observations the ensemble mean of the 90 member control experiment has a substantial negative bias fig 1 summer ice coverage is extremely low with underestimated sie outside of the winter maximum and too low sia year round antarctic sea ice seasonality is asymmetric with a 7 month advance season march september and a 5 month retreat season october february roach et al 2022 in the control experiment mean however the rate of gain during advance is so slow that the sie maximum is reached a month late in october instead of september leaving only 4 months for ice melt fig 1a despite the skewed simulated seasonality the extremely rapid rate of sie and sia decline between october and december combined with slow ice gain during autumn leads to an extensive low ice or ice free season and a relatively short compared with observations ice covered season as can be seen in the pale grey lines depicting the mean sie and sia climatology of 60 pre industrial control coupled model intercomparison project phase 6 cmip6 simulations eyring et al 2016 low ice coverage particularly in the summer is a common bias among global coupled climate models fig 1 and remains a key focal point for future model development roach et al 2020 shu et al 2020 in testing the sensitivity of simulated sea ice in a global coupled climate model with clear common sea ice biases we seek to understand how changes to sea ice parameters affect the representation of sea ice seasonality as well as the magnitude of mean antarctic sea ice 4 1 initial parameter sample tests the ensemble mean of the 90 member control experiment is subtracted from all members of the control and 10 member sample experiments to show how each member deviates from this mean state the minimum and maximum deviation among the control members for each month depict the bounds of simulated internal variability termed the envelope of the control experiment fig 2 black lines internal variability is smallest at the sea ice minimum in february march when low ice coverage leads to relatively low variability and largest in late spring early summer when the steepest period of simulated ice retreat occurs the sample experiment member deviations show several parameters in which the climatology falls outside the control envelope indicating greater sensitivity to parameter choice fig 2 coloured lines however due to the computational expense of 90 member tests only parameters for which the sample climatologies of both sie fig 2 and sia supplementary material fall substantially upwards of the control envelope i e increased climatological sea ice relative to the control mean are chosen the selected parameters are cdw ice albedo kmelt snow albedo and wd turn however it is worth noting that snow conductivity ks and ice strength p0 and c0 show some sensitivity as well and could warrant further investigation in future work 4 2 simulated mean antarctic sea ice in 90 member tests high density sampling of the same parameter ranges as in fig 2 for the selected sea ice parameters clearly shows the sensitivity of mean sie sia and siv to parameter variation in the context of the control envelope fig 3 for example december sie in some wd turn members is more than 3 x 106 km2 above the control envelope fig 3a and in snow albedo is spread 1 x 106 km2 beyond the control ensemble mean fig 3i deviation from the control envelope persists year round including summer in many members of the albedo and cdw experiments fig 3d f and j o indicating a substantial impact on ice coverage and volume around the sea ice minimum for these parameters by comparison wd turn members tend to deviate between april december fig 3a c and kmelt members only deviate during late spring and early summer fig 3g i with few if any members deviating from the control envelope at the sea ice minimum examination of climatology deviations of each experiment member from the control ensemble mean reveals the tendency within each experiment fig 4 there is a high level of internal variability in the simulated mean sea ice reducing the linearity of the sea ice response to monotonically increasing parameter variation for example average september sie deviations from the control ensemble mean in wd turn are 0 67x 106 km2 for wd turn 9 68 0 24 106 km2 for wd turn 10 95 and 0 53 106 km2 for wd turn 12 63 in low density sampling such as the 10 member tests initially conducted the tendency could appear much weaker or disappear altogether as a result of this high internal variability whereas the high density 90 member sampling runs shown here permit the signal of sea ice sensitivity to parameter variation to dominate despite the high internal variability there are clear tendencies in all five parameter varying experiments most strongly in the ice turning angle wd turn ocean sea ice drag coefficient cdw and snow albedo in the wd turn experiment an ice turning angle set to 22 0 or lower substantially increases while values above 28 0 decrease sia and siv between april and december fig 4a c the impact on sie is highest in late autumn to mid winter and again in mid to late spring which are the most intense periods of sea ice accumulation and loss the tendency in the other dynamic parameter cdw fig 4d f and both the albedo experiments fig 4j o is for reduced mean sea ice for values below the default and vice versa while the effect of parameter variation is lowest at the february sea ice minimum the sea ice response for most members of these experiments continues year round by comparison changes to the ocean ice heat flux parameter kmelt are more seasonally variable fig 4g i low magnitude kmelt values tend to produce more sea ice in the spring but less sia in winter and vice versa for high magnitude values the decreased sia despite increased sie implies that the low magnitude kmelt values tend to increase low concentration coverage but still exceeding 15 while reducing the proportion of cells with high concentration ice cover the tendency is less clear for kmelt than in other experiments however with adjacent members i e very similar parameter values producing ice anomalies of opposing signs indicating a more pronounced effect of internal variability than in other experiments given the high magnitude deviations from the control experiment during the seasons of ice gain and melt we now consider individual member deviations from monthly sea ice tendency to show how parameter variation impacts seasonal sea ice evolution fig 5 the timing and rate of simulated sea ice advance and retreat is important as it indicates the duration of the open water season i e length of the ice free summer with a longer open water season leading to greater solar driven surface warming and an amplifying feedback reducing sea ice further maksym et al 2012 a low turning angle wd turn delays autumn gain in sie despite an increase in the gain of sia and siv implying a more constrained ice cover with slower northward expansion fig 4a c low magnitude wd turn members also reduce spring sia and siv decline with enhanced summer melting instead but the spring sie loss is increased low ice turning angles therefore tend to produce a more compact and thicker ice cover and retain ice in the interior for longer but lose ice at the northernmost edge earlier the reverse is true for members with high magnitude turning angles the monthly autumn and winter gain of sia and siv is reduced despite enhanced sie gain in autumn and spring implying a looser but more extensive ice cover with lower summer melt owing to less ice gain during winter greater ocean ice drag coefficients cdw increase autumn ice gain in all three metrics with volume continuing to increase through winter even as areal expansion ceases fig 5d f due to greater ice presence than the default value there is enhanced siv loss in december and enhanced sie and sia decline from january indicating thinning of ice before areal loss for low magnitude cdw members the effect is reversed and is also stronger a large reduction in ice advance delays areal expansion until later in the winter but siv gain remains lower than default throughout autumn winter and spring an apparent reduction in summer ice melt results from the relatively low and thin ice cover the seasonal evolution of sea ice in kmelt is strongly affected during spring and summer with lower ocean iceheat flux retaining more ice through spring and delaying melt until summer and vice versa though to a lesser extent for higher flux values fig 5g i a small tendency towards greater winter sie but smaller sia occurs in the lowest magnitude kmelt members the difference between sie and sia being that in the former entire grid cell area is counted as long as the areal fraction exceeds 15 whereas in the latter only the ice covered fraction of grid cell area is counted the contrasting winter sea ice behaviour in low magnitude kmelt values implies a regional response i e that less ocean heat into the base of the sea ice allows more ice at lower latitudes to reach the 15 isoline but reduces higher concentration interior ice sea ice is more strongly influenced by atmospheric influences during the season of advance with a greater oceanic influence during retreat explaining why the effect of varying the ocean ice heat flux is most notable in the season of sea ice melt the areal coverage response to varying ice or snow albedo fig 5j o is similar to that of cdw with members above the default in both experiments producing increased autumn gain decreased winter gain and delayed summer melt however while high magnitude cdw members showed volume gain throughout autumn spring the high magnitude albedo members only gain volume during autumn with less gain from june as the dark winter months set in 4 3 changes to dynamical redistribution the gfdl cm2 1 model delworth et al 2006 and its successor gfdl cm3 griffies et al 2011 both have warm ocean biases and seasonal sea ice evolution in the latter is dominated by thermodynamic processes with far less sea ice mass transport than other global coupled climate models schroeter et al 2018 it is thus interesting to note the high sensitivity of the two dynamic sea ice parameters tested in this analysis fig 3a f modifying these parameters can alter the relative balance of the underlying dynamic processes e g changing the ice turning angle can move more or less ice away from the coast changing the divergence convergence of sea ice and as a consequence seasonal thermodynamic freeze and melt whereas alterations to thermodynamic parameters are unlikely to have a substantial effect on dynamic processes we now show the effect of varying the two dynamic parameters on the processes driving sea ice evolution the seasonal gain and loss of siv over time siv t can be decomposed into dynamical redistribution processes advection and convergence and thermodynamic freeze and melt processes shown for control ensemble mean fig 6 holland and kwok 2012 lecomte et al 2016 schroeter et al 2018 uotila et al 2014 while seasonal siv gain and loss is spatially homogeneous fig 6a b the constituent processes are more spatially heterogeneous fig 6c h regions where the sign of the contributing term matches the sign of the corresponding siv t seasonal change indicate where the contributing term works towards the overall seasonal sea ice evolution opposing signs indicate the contributing term working against siv t for example the contribution of sea ice advection is generally positive throughout the sea ice zone aiding ice gain during advance fig 6c but affecting sea ice melt particularly at the ice edge as it continues to transport ice northward during retreat fig 6f along the coastline easterly winds push sea ice coastwards where geographical constraints prevent further advection of the ice so advection appears to work against ice gain the convergence term fig 6d g indicates whether the flow of ice is divergent negative which is dominant in the sea ice interior or convergent positive such as around the coast where ice tends to accumulate it is closely linked to the thermodynamic freeze positive and melt negative term fig 6e h during advance divergent sea ice motion reduces ice cover in the interior fig 6d however by opening up ice cover to cold surface temperatures it permits a strong positive thermodynamic contribution as more ice can be produced in the interior fig 6e similarly divergent ice motion during retreat fig 6 g enables greater heat transfer between the ocean and atmosphere supporting ice melt fig 6h at the ice edge the thermodynamic contribution can be negative during both advance fig 6e and retreat fig 6h as ice is mechanically increased at the ice edge through advection and divergence but surface temperatures are too warm to sustain ice presence thus the ice melts a ratio is computed for the advection convergence and thermodynamic freeze melt components comprising spatially averaged siv t during advance and retreat fig 7 these ratios depict the relative dominance of the underlying processes driving the seasonal cycle in each member rather than explicitly quantifying the magnitude of the processes and sea ice evolution it should be noted that due to the complex interactions and compensating influences of the components the resulting ratios for individual components can be values above or below 100 at the ice edge lower values of wd turn in which mean sea ice is amplified see fig 4a c show vastly reduced contributions from northward ice advection fig 7a and convergence owing to more convergent sea ice compared to the control ensemble fig 7b conversely high magnitude ice turning angles produce greater northward advection of sea ice to the ice edge contributing positively to winter ice gain but impeding spring ice retreat while more divergent sea ice motion at the ice edge does the reverse there is a small tendency for thermodynamic gain freeze at the ice edge to increase in relative importance as the magnitude of the turning angle increases as divergent ice motion opens the ice pack to the cold atmosphere fig 7c but this is largely within the envelope of the control ensemble during retreat the relative importance of thermodynamic melting shows no change as the ocean ice drag coefficient reduces the negative contribution of advection towards sea ice retreat at the ice edge becomes stronger fig 7d however there is no change in the convergence term in either season with variation in cdw fig 7e in low magnitude members the relative importance of the thermodynamic freeze melt contribution is less than the control ensemble during advance but is much stronger during retreat fig 7f where it compensates for the enhanced ice transport to the ice edge through advection fig 7d in the ice interior fig 8 wd turn members with high ice turning angles transporting ice northwards away from the interior have a more strongly negative dynamic influence on ice gain during advance fig 8a b compensated by thermodynamic freezing fig 8c however this does not translate to more ice overall fig 4a c during the retreat season advection remains within the control spread for all members of wd turn however the opposing influences of convergence and thermodynamic melt is strongly enhanced with melt becoming negative in some of the highest magnitude members implying additional spring freeze in the interior under the highest ice turning angles in contrast low ice turning angles produce a weaker influence of convergence in both seasons and thermodynamic freeze melt dominates instead varying the ocean ice drag coefficient only affects the relative influence of the underlying processes driving sea ice evolution in the lowest magnitude members with the remaining members remaining within the control envelope for low values of cdw in which mean sea ice is reduced compared to the control ensemble mean advection and convergence work more strongly against sea ice advance fig 8d e and in some members additional freeze occurs during retreat fig 8f 4 4 sea ice melting heat fluxes the lack of solar heating limits melting at the top surface of sea ice for half the year but a substantial amount of melting at the bottom of the sea ice occurs year round indeed basal sea ice melt is the proportionately most dominant melt component during the cooler months followed by melting at the top and then a small contribution from lateral melt tsamados et al 2015 the model provides diagnostic fields for the melting energy flux at the base bmelt and top tmelt of the sea ice which we average across the ice edge and interior for the seasons of ice advance and retreat as in section 4 3 fig 9 unsurprisingly the effect of parameter variation on bmelt and tmelt is greatest among members of kmelt fig 9i l the parameter which modifies the heat flux from the ocean into the base of the ice where lower ocean ice heat flux values increase the melting energy flux at the top of the sea ice to compensate for the reduction at the sea ice base at both the ice edge and interior and vice versa for high kmelt values in the albedo experiments higher albedo values reduce melting energy flux at the top of the sea ice during retreat fig 9 m o q and s however basal melt at the ice edge during retreat is increased fig 9n r and freezing at the base of the ice is strongly reduced in the interior ice zone fig 9p and t a small tendency towards additional basal sea ice melting at the ice edge is also seen in both seasons in high albedo members fig 9n and r for the dynamic parameters the effect on melting energy fluxes is smaller basal melt in the retreat season is increased with higher turning angles and basal freeze during advance is decreased indicative of a thinner ice cover in high magnitude wd turn members fig 9d compared with the thermodynamic parameters there is little notable tendency among members of cdw fig 9e h 5 discussion and conclusions many sensitivity tests of antarctic sea ice have been conducted using stand alone sea ice models coupled ocean sea ice models or low density parameter sampling in coupled climate models dorn et al 2007 hunke 2010 ma et al 2020 massonnet et al 2014 miller et al 2006 roach et al 2018 uotila et al 2012 the present analysis however examines high density parameter testing of antarctic sea ice sensitivity in the context of large simulated internal variability in coupled global climate model our experiments analysed the model response to variation in 5 sea ice parameters with the largest effect seen in wd turn sea ice turning angle cdw ocean ice drag coefficient and snow albedo a smaller level of sensitivity is seen in ice albedo and kmelt ocean ice heat diffusivity coefficient while modified parameters produce some changes to the timing of sea ice advance and ice presence during the autumn and winter a much stronger effect occurs in spring and early summer ocean heat is a strong contributor driving sea ice evolution during spring gordon 1981 and the model is known to have a warm ocean bias low relative to observations mean sea ice low sea ice mass transport and dominance of thermodynamic processes sea ice in the model is clearly strongly affected by ocean ice interactions and given that the thickness and coverage of sea ice affects the amount of solar radiation that is reflected during the sunlit months brandt et al 2005 parameter variation also strongly impacts spring and summer atmosphere ocean heat flux several parameter experiments show capacity to alter simulated sea ice seasonality which is skewed towards a too slow advance with maximum extent reached a month late and a rapid too short retreat depending on the parameter ice gain in autumn can be increased and ice loss in the early months of retreat reduced resulting in greater mean sea ice cover than the control ensemble mean throughout much of the year however outside the albedo experiments the climatological sea ice minimum february bias remains largely unchanged when placed in the context of the 90 member control simulation with increased climatological mean sea ice for much of the year and a continuing negative late summer sea ice bias the underlying reasons for any bias reduction require careful consideration to ensure that unrealistic processes are not introduced into the coupled system for example amplification of sea ice freeze has implications for convection and deep water formation as greater sea ice production induces more vertical mixing deepening the ocean winter mixed layer indeed too much ice production can destabilise the water column and stimulate deep convection martinson 1990 unrealistic open ocean deep convection is a known issue in several global climate models with strong seasonality heuzé et al 2013 thus parameter tuning that results in an amplified seasonal cycle warrants close monitoring to avoid exaggerated destabilisation of the water column in the ice interior uotila et al 2014 note that it is not sufficient to merely choose parameter values that produce a more realistic metric of sea ice e g sie climatology rather it is important that the parameter set most accurately reflect components of the sea ice budget sea ice thickness resulting from thermodynamic processes is physically limited by a balance of snow accumulation ice atmosphere heat loss and ocean ice heat flux maksym et al 2012 thick ice above 2 m occurs largely through mechanical deformation allison 1997 maksym et al 2012 opening water within the ice interior inhibits mechanical thickening while advection shifts ice away from the coast into the interior and towards lower latitudes where it more readily melts the dynamic parameters show that the balance between advection divergence convergence and thermodynamic freeze and melt can be altered with parameter variation for example high sea ice turning angles increase divergent ice motion in the interior transporting more ice away from the coast and permitting more ocean atmosphere heat exchange greater advection and divergent motion assist sea ice retreat by dispersing and moving the ice northwards to warmer latitudes it may appear logical that increased mechanical redistribution northwards with a higher ice turning angle would increase ice cover ma et al 2020 uotila et al 2012 however in our experiment these members have less basal freezing producing thinner winter ice that readily melts in early retreat low magnitude turning angles instead retain ice near the coast reducing areal coverage but leading to higher winter ice volume by also reducing melt in early retreat these members extend the season of ice cover and reduce the ice free season it is important to note however that as model development continues to advance into the future towards increased vertical ocean and boundary layer resolution processes such as ekman spirals may be simulated explicitly in coupled climate models removing the need for parameterisation of these boundary layer processes thermodynamic sea ice growth requires the venting of ocean heat to the atmosphere as ocean water is cooled by the atmosphere ice is formed and the cooled water sinks entraining warmer water from below which then works to limit ice growth by warming the base of the ice maksym et al 2012 if the competing processes continue towards net growth eventually the ice thickens enough to prevent ocean atmosphere heat transfer which inhibits further ice production and thermodynamic growth slows or halts entirely martinson 1990 generally ice would thicken beyond this point only by mechanical deformation however low values of ocean ice heat diffusivity tip the balance away from thermodynamic equilibrium towards net ice production and with low or near zero values of kmelt heat flux at the base of the sea ice is constrained and the negative feedback effect of entrained warm water on the base of the ice is inhibited melt at the top surface of the sea ice increases instead a compensation which perhaps explains why despite less melt at the bottom surface of the sea ice there is little change to the surface radiative balance and only a moderate change in seasonal ice cover overall thermodynamic freeze and melt dominate changes in the magnitude of the sea ice seasonal cycle in the albedo experiments with greater reflection of shortwave radiation at the surface throughout more of the year in members with high magnitude ice and snow albedos melting at the upper ice surface is reduced and a larger volume of ice persists through the year the underlying ocean is unable to vent heat through the thickened ice that would otherwise be passed through the ice to the atmosphere and thus vertical heat flux into the base of the ice is increased preventing the ice from thickening further maksym et al 2012 the large ensemble sensitivity analysis presented here suggests that some biases in the cafe control run can be substantially reduced by simply altering sea ice parameters however it is important to understand the method by which these parameter variations have changed the mean climatology in order to identify potential error compensation or unrealistic driving processes it is also worth noting though beyond the scope of this analysis that bias reduction could potentially be amplified or cancelled out by varying more than one parameter at a time if those parameters produce different sea ice responses the distinct sea ice behaviour resulting from changes in different parameters provides additional evidence that multi variate parameter sensitivity testing is required to tune a model to better represent mean antarctic sea ice and its variability uotila et al 2012 future work will aim to improve the representation of antarctic sea ice and its underpinning physical processes by extending the present work to a multi variate ensemble parameter analysis credit authorship contribution statement serena schroeter methodology investigation analysis writing visualisation paul a sandery methodology investigation analysis writing visualisation declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgements serena schroeter was supported by a csiro early career research fellowship model runs and data analysis were undertaken with the assistance of resources and services from the national computational infrastructure nci which is supported by the australian government data analysis and visualisation were performed using the ncar command language https doi org 10 5065 d6wd3xh5 the ncar command language 2019 all authors approved the version of the manuscript to be published appendix a supplementary data supplementary material related to this article can be found online at https doi org 10 1016 j ocemod 2022 102090 appendix a supplementary data the following is the supplementary material related to this article mmc s1 
23826,simulated antarctic sea ice sensitivity to parameter variation is tested in a global coupled climate model parameter changes affect areal coverage thickness and seasonality of sea ice beyond the bounds of internal variability with a tendency for several parameters to substantially impact sea ice retreat the largest sea ice response occurs with changes to the sea ice turning angle parameter enhanced northward transport of ice leads to a thinner ice cover that more readily melts while lower turning angles permit greater convergence in the interior resulting in a thicker more persistent ice pack setting snow and ice albedo above the default value increased mean sea ice year round including at the sea ice minimum while other parameter experiments did not increase minimum sea ice beyond internal variability low values of heat exchange between the ocean and base of the sea ice ocean ice heat flux parameter sharply reduce bottom melt and slow sea ice retreat high density sampling in both the control scenario identical parameters but differing initial conditions and the parameter tests shows large simulated internal variability suggesting that the signal of the sea ice response could be overwhelmed in a low density sample test large ensemble testing is a valuable tool for testing sensitivity in coupled systems where variability and feedbacks are more complex than in stand alone sea ice models keywords sea ice antarctic modelling parameter sensitivity variability 1 introduction sea ice modulates the exchange of heat gas and momentum between the atmosphere and the high latitude oceans dieckmann and hellmer 2010 massom and stammerjohn 2010 weeks and schroeter 2019 given its fundamental importance to the global climate it is vital that the mean sea ice state is reproduced as accurately as possible by climate models however current and previous state of the art global coupled climate models gcms in the coupled model intercomparison project cmip generally do not capture observed historical since 1979 trends and many also produce substantial biases in mean antarctic sea ice hobbs et al 2016 roach et al 2020 schroeter et al 2018 2017 shu et al 2020 vaughan et al 2013 this limits confidence in the veracity of future projections of sea ice in these models the disparity between observed sea ice extent seasonality and trends and those simulated by gcms has prompted attempts to optimise parameterisations of the dynamic and thermodynamic processes driving sea ice in models and to identify ideal ranges for sea ice parameters to tune models and improve the representation of the simulated climate dorn et al 2007 hunke 2010 ma et al 2020 massonnet et al 2014 miller et al 2006 roach et al 2018 uotila et al 2012 parameter tuning has been shown to reduce model bias in reproducing historical sea ice trends particularly in the arctic roach et al 2018 however the integrity of sea ice in tuned model simulations has been the subject of intense debate for example it has been argued that tuning parameters such as ice albedo artificially compensates for model biases masking atmospheric deficiencies that would otherwise lead to unrealistic sea ice conditions eisenman et al 2007 others in contrast argue that more sophisticated representation of mechanical sea ice processes reduces ice thickness sensitivity to albedo tuning björk et al 2013 and that error compensation can also result from credible physical processes and feedbacks deweaver et al 2008 uotila et al 2014 decomposed the sea ice concentration budget in 2 cmip5 models and an ocean sea ice model revealing that excessive convergence at the coast and advection at the ice edge in these models was balanced by enhanced sea ice melt with the competing biases resulting in a seemingly realistic representation of the seasonal sea ice cycle indeed while several state of the art gcms have been shown to have good representation of the observed seasonal sea ice cycle the reliability of simulated dynamic and thermodynamic processes underpinning the seasonal cycle varies substantially holmes et al 2019 confidence in future projections of sea ice is constrained by the accuracy of simulated historical sea ice and it is therefore imperative to consider not just the sensitivity of sea ice metrics but also of the underlying physical processes driving seasonal sea ice evolution to changes in key sea ice parameters holland and kimura 2016 lecomte et al 2016 uotila et al 2014 in the southern ocean antarctic sea ice is geographically unbounded to the north subjecting it to strong prevailing winds powerful waves and high snowfall rates maksym et al 2012 this extremely dynamic sea ice environment has high internal variability which adds to uncertainty surrounding the inconsistency of antarctic sea ice representation in gcms seasonal sea ice evolution occurs through complex interdependent thermodynamic and dynamic processes antarctic sea ice is predominantly divergent in the ice interior holland and kwok 2012 massom et al 1998 worby et al 1998 coastal polynyas maintain large areas of open ocean within the ice pack encouraging winter sea ice growth as water is exposed to the cold overlying atmosphere with ice then transported northwards away from the coast drucker et al 2011 in other regions coastal easterly winds cause ice near the continent to converge against land fast ice and the coastline where sea ice is compressed and mechanically deformed through ridging and rafting which can thicken ice substantially more than thermodynamic production maksym et al 2012 during the spring solar heating of open ocean water caused by diverging ice such as leads combined with upwelling heat from the sub pycnocline into the surface ocean drives sea ice retreat gordon 1981 martinson 2012 towards the ice edge winds shift ice north to warmer latitudes where its presence is thermodynamically unsustainable inducing melting the location of freezing and melting sea ice denotes the location of brine rejection and freshwater input which has important implications for ocean stratification and water mass formation abernathey et al 2016 haumann et al 2016 as well as ocean sea ice feedback mechanisms goosse and zunz 2014 furthermore the thickness and coverage of sea ice determines surface albedo which denotes the amount of solar radiation that is reflected brandt et al 2005 and hence atmosphere ocean heat transfer and the timing and rate of spring ice melt however not all of the aforementioned processes are explicitly resolved in current coupled global climate models due to high computational expense limiting model resolution necessitating the use of parameters that occur at unresolved spatiotemporal scales the parameters themselves also possess uncertainty and may directly influence model bias understanding the response of dynamic and thermodynamic sea ice processes to changes in sea ice parameters is therefore of paramount importance in seeking to optimise a model particularly in the southern ocean where the ocean heat flux contributes strongly to the seasonal cycle of sea ice uotila et al 2014 the present study uses a coupled global climate model and ensemble prediction system to initialise forecasts from a wide range of initial conditions to investigate the sensitivity of sea ice parameters detailed in section 3 1 with respect to a 90 member control run previous studies have sought to use the results from parameter explorations to tune the model towards sea ice observations however our analysis seeks to improve understanding of how changes in parameters affect the underlying processes driving seasonal sea ice evolution the large ensemble of states provides a unique opportunity to sample the sensitivity of sea ice parameters in the model and thoroughly compare the envelope of simulated internal variability to variability resulting from changes to the parameter values 2 model we use the csiro climate retrospective analysis and forecast ensemble system cafe o kane et al 2021 2019 sandery et al 2020 which couples the modular ocean model version 4 1 mom4 griffies et al 2003 with the land model version 2 lm2 atmospheric model version 2 am2 and sea ice simulator sis components from the geophysical fluid dynamics laboratory climate model version 2 1 gfdl cm2 1 delworth et al 2006 both am2 and lm2 have a 2 latitude x 2 5 longitude horizontal resolution and am2 has 24 vertical levels the mom4 ocean grid resolution is 1 in the zonal direction and nominally 1 in the meridional direction though with gradually increasing resolution from 30 s and 30 n towards the equator resulting in 0 33 resolution between 10 s and 10 n and increasing resolution towards the southern ocean resulting in 0 25 meridional resolution at 78 s bi et al 2013 mom4 has 50 vertical levels ranging from 10 m resolution in the upper ocean to approximately 300 m resolution in the deep ocean which does not resolve ekman spirals sis uses the same horizontal ocean grid with a modified three layer semtner 1976 thermodynamic scheme with 2 equally sized ice layers a snow layer and 5 ice thickness categories delworth et al 2006 winton 2000 the thickness categories have upper and lower thresholds to represent the rapid ice growth and melt as well as the formation of leads frazil ice from the ocean is added to the thinnest ice category and ice is moved from thinner to thicker categories as ice grows and reaches the upper threshold of each category and vice versa delworth et al 2006 variable heat capacity exists in the upper ice layer in order to represent brine pockets whereas the lower ice layer is given a fixed heat capacity and the snow layer has zero heat capacity winton 2000 3 method 3 1 sea ice parameters the sea ice simulator sis component of cafe permits explicit values to be set for a number of parameters see https www gfdl noaa gov sea ice simulator a 10 member sample sensitivity test is run on a set of nine available parameters the details of which are described below and the values summarised in table 1 based on the results from the sample test 5 parameters were chosen for the full 90 member sensitivity analysis see section 4 1 it should be noted that while several sea ice parameters are known to vary spatially only a single global value for each member was selected for the purpose of this study 3 1 1 sea ice turning angle thickness of sea ice is sensitive to changes in the ice ocean stress turning angle with non zero values leading to larger amounts of sea ice transported north to warmer latitudes and less ice converging near production zones hunke 2010 ma et al 2020 uotila et al 2012 this has important implications for atmosphere ocean interactions such as increasing freshwater input into the surface ocean further north increasing sea ice cover in the ice interior and thus the albedo and changes to surface air temperature and surface winds ma et al 2020 while some coupled models are capable of resolving ekman spirals models such as mom with a 10 m ocean resolution in the upper ocean do not and hence momentum flux does not pass into the ocean and cannot drive an ekman layer i e a 0 turning angle turns the ice alongside wind stress with ice motion approximately equally driven by geostrophic wind and ocean circulation thorndike and colony 1982 turning angle parameterisation for sea ice is an important method of tuning antarctic sea ice dynamics and thus southern hemisphere climate in models with low vertical ocean resolution antarctic ice has been shown to drift at angles of approximately 20 30 to the left of the surface wind direction increasing to up to 40 during the summer when ice concentrations are low allison 1997 kottmeier et al 1992 wamser and martinson 1993 however values in previous antarctic parameter experiments span only 0 23 hunke 2010 ma et al 2020 uotila et al 2012 and the sis default value is 25 denoted in the sis namelist as wd turn for this analysis values are assigned from 0 to 40 3 1 2 ocean ice drag coefficient the coefficient describing the drag force between the base of the sea ice and the surface of the underlying ocean water is an important parameter for representing sea ice dynamical processes through horizontal momentum exchange from wind and ocean currents lu et al 2011 in previous testing in an multivariate ice only model the ocean ice drag coefficient proved to be highly sensitive throughout the year strongly influencing regional sea ice volume kim et al 2006 observation based estimates and previous modelling studies yield a range for the ice ocean drag coefficient of between 1 13 5 36 10 3 kim et al 2006 lu et al 2011 massonnet et al 2011 stopa et al 2018 wamser and martinson 1993 the default value for the ice ocean drag coefficient denoted as cdw in sis is 3 24 10 3 we consider the range 0 87 5 5 10 3 3 1 3 ice strength the strength of sea ice impacts its mechanical redistribution as it sets the resistance of the ice to compression and deformation hibler 1979 sea ice strength is related to the distribution of sea ice thickness with dynamic processes causing an increase or decrease in the fraction of open water as sea ice diverges or converges and is widely described as in hibler 1979 p p 0 h exp c 0 1 a where a represents sea ice concentration h is mean ice thickness and p 0 and c 0 are two strength parameters available for tuning in sis p 0 denotes the compressive ice strength determining the internal ice stress at which deformation or yielding is permitted while c 0 relates ice strength to the fraction of open ocean water in this equation sea ice exponentially strengthens as the fraction of open water decreases and linearly strengthens with increasing ice thickness and vice versa miller et al 2006 the default sis values are 2 75 10 4 pa for p 0 and 20 for c 0 the literature spans 0 5 10 0 10 4 pa for p 0 hibler 1979 miller et al 2006 zhang and hibler 1997 while c 0 is usually set to between 10 20 with doubling of c 0 advised by hibler 1979 to test the effect of open water on ice strength particularly in summer we therefore use parameter ranges of 0 5 10 0 10 4 pa for p 0 and 10 40 for c 0 3 1 4 ice albedo surface albedo characterises the efficiency with which the surface absorbs or reflects solar radiation presented as a unitless fraction while the open ocean generally has an albedo of approximately 0 07 i e reflects only 7 of incoming solar radiation spectral radiometer measurements of sea ice in east antarctica show snow free ice albedos ranging from 0 09 for grease ice to 0 25 ice less than 0 15 m thickness 0 35 ice between 0 15 0 30 m thickness 0 42 first year ice between 0 30 0 70 m thickness and 0 49 first year ice greater than 0 70 m thickness massom et al 2001 previous studies have used constant ice albedo parameters of between 0 45 and 0 64 roach et al 2018 semtner 1976 while the default ice albedo in sis is 0 65 the present analysis uses values between 0 5 and 0 8 for ice 3 1 5 snow albedo the albedo of sea ice is strongly influenced by the presence and depth of snow for ice with a thin layer of snow up to 3 cm depth observed values range between 0 42 and 0 82 while ice with a thick snow layer ranges from 0 7 0 85 though cloudy conditions can further increase albedo up to 0 87 under either thin or thick snow brandt et al 2005 the default snow albedo in sis is 0 8 we use values between 0 6 and 0 9 3 1 6 fraction unreflected shortwave radiation penetrating ice the effect of penetrating solar radiation on sea ice thickness is an important consideration this energy represents latent heat of fusion within the ice that initiates melting in high salinity pockets within the ice with the liquid remaining trapped in the ice unless the ice melts completely as a source of latent heat inhibiting autumn thickening of the ice maykut and untersteiner 1971 semtner 1976 energy absorption into the sea ice is calculated using a constant value to depict the fraction of unreflected shortwave radiation that penetrates the ice i o the default value in sis denoted as pen ice in the sis namelist is 0 3 previous studies have used a wide range of values such as 0 17 maykut and untersteiner 1971 semtner 1976 0 18 lecomte et al 2011 0 3 bitz and lipscomb 1999 winton 2000 0 32 untersteiner 1964 and 0 34 untersteiner 1961 the present analysis uses a range of values evenly spaced between 0 and 0 35 3 1 7 snow conductivity the insulative snow cover overlying sea ice is an important component of simulating growth and melt of sea ice as it has a relatively low thermal conductivity and therefore reduces heat loss from the sea ice into the atmosphere lecomte et al 2013 massom et al 2001 as this can slow or halt basal ice growth snow conductivity is closely tied to the heat flux from the ocean into the base of the sea ice see section 3 1 8 massom et al 2001 previous studies have assigned snow conductivity denoted as ks in sis values between 0 112 0 35 w m 1 k 1 kim et al 2006 massom et al 2001 and the default sis value is 0 31 w m 1 k 1 for this analysis ks was assigned values between 0 1 0 35 w m 1 k 1 3 1 8 ocean sea ice heat flux ocean atmosphere heat exchange and upwelling of relatively warm deeper ocean water to the surface plays a strong role in melting sea ice during retreat gordon 1981 simulations with an ice only model show that increased ocean heat flux to the base of the ice results in substantially thinner sea ice hunke 2010 sis explicitly sets the heat flux between the ocean and the bottom of the sea ice denoted in the sis namelist as kmelt w m 2 with the model then calculating bottom heat and thus growth or melt at the base of the sea ice maykut and untersteiner 1971 semtner 1976 winton 2000 ocean sea ice heat flux can be written as k ρ c p c h u t o t f m u t s where ρ is ocean water density 1030 0 kg m 3 c p is the specific heat capacity of ocean water 4200 0 j kg 1 k 1 c h is a heat transfer coefficient of 0 006 frew et al 2019 mcphee 1992 uotila et al 2012 u is the friction velocity at the interface of the sea ice and ocean mclaren et al 2006 mcphee 1992 roach et al 2018 the remaining terms are multiplied with kmelt to produce the bottom heat t o is the surface ocean temperature t f is the freezing temperature of ocean water and mu ts is a parameter to relate the freezing temperature to salinity mcphee 1992 found instances of u up to 0 02 m s 1 and several modelling studies have set a minimum u value of between 0 0005 and 0 005 mclaren et al 2006 uotila et al 2012 the default sis value for kmelt is 243 6 w m 2 indicating a value of approximately 0 0094 for u with u values of between 0 0005 and 0 02 kmelt could equal anywhere from 12 6 to 519 w m 2 however although heat fluxes of up to 500 w m 2 have been observed in the southern ocean mcphee 1992 average values would presumably be lower in the present analysis we choose 200 w m 2 either side of the default with kmelt assigned values between 43 u 0 00167 and 433 u 0 0167 w m 2 3 2 experiments and data the control experiment uses the default model parameters see table 1 for 90 members each taking initial conditions from january of a single year from the last 90 years of a 500 year cafe climate state run taking initial conditions from 90 consecutive years of a spun up climate introduces large internal variability into the ensemble in which context the parameter varying experiments are considered consistent interannual atmospheric forcing across the ensemble adopts the use of the cmip5 standard of monthly mean distributions of interannual tropospheric ozone and aerosols from anthropogenic and biomass emissions lamarque et al 2010 o kane et al 2019 nine 10 member parameter varying sensitivity experiments are run with each member using a different set of initial conditions taken arbitrarily from the set used by the control experiment and varying values for a single parameter in all members of each experiment all experiments are run for a 14 year period 2005 2018 with the first four years removed from analysis to account for the time required for the model to reach the new climatology after parameter perturbation based on initial results see section 4 1 two dynamic and three thermodynamic parameters are selected for a second 90 member test using the same parameter range with a higher density sampling monthly output from all experiments are regridded from the 360 x 300 logically rectangular horizontal mesh bi et al 2013 onto a 1 x 1 rectilinear grid sea ice volume siv is calculated as the product of sea ice concentration thickness and grid cell area areal sea ice extent sie is calculated as the integrated coverage per degree of longitude using grid cells with at least 15 ice concentration and sea ice area sia is calculated as the integrated area of grid cells with ice cover multiplied by the fraction of grid cell coverage calculations of the components of seasonal sea ice evolution follow methods from previous studies holland and kwok 2012 lecomte et al 2016 uotila et al 2014 though given the cafe model produces sea ice thickness as well as concentration our budget decomposes total sea ice volume schroeter et al 2018 total monthly siv change siv t left hand side is composed of two dynamic processes advection first right hand term and divergence second right hand term and a residual term encompassing thermodynamic freeze melt f and the effects of ridging and rafting r where u denotes the sea ice velocity vector s i v t u siv siv u f r to aid interpretation of the volume budget decomposition the sign of the divergence term has been reversed so it becomes convergence where increasing values indicate the increasing density of sea ice within a cell i e convergent sea ice and decreasing values show the reverse i e divergent sea ice climatologies of siv sie siv t and its constituent components as well as model diagnostics of incoming and outgoing surface shortwave radiation ocean ice heat flux and upper and lower ice melting energy flux were computed for all variables for all members to delineate the ice edge from the interior the northern bounding line of 15 sea ice concentration during the seasons of advance and retreat is calculated for each member and the ice edge taken to encompass the area of 4 latitude south of that bounding line previous studies have used a smaller area to delineate sea ice edge and interior e g 37 5 km kimura and wakatsuchi 2011 1 longitude schroeter et al 2018 however in a qualitative examination of this bounding line in the default and individual ensemble members from the parameter experiment not shown we find this insufficient to encompass the distinct regions of different sea ice processes in the decomposition of siv t for longitudes where the ice edge area intersected with the coastline particularly during retreat due to low ice cover the longitude is taken to have no ice interior during that season we temporally average sea ice evolution into the seasons of advance march august and retreat october february raphael and hobbs 2014 schroeter et al 2018 2017 in order to summarise seasonally distinct behaviour three observation based sea ice concentration products are obtained for the period 1979 2020 national snow and ice data center nsidc goddard merged sea ice concentration meier et al 2017 ocean and sea ice satellite application facility osi saf climate data record osi 450 lavergne et al 2019 met office hadley centre sea ice and sea surface temperature dataset version 2 hadisst 2 2 0 0 titchner and rayner 2014 4 results compared with satellite based observations the ensemble mean of the 90 member control experiment has a substantial negative bias fig 1 summer ice coverage is extremely low with underestimated sie outside of the winter maximum and too low sia year round antarctic sea ice seasonality is asymmetric with a 7 month advance season march september and a 5 month retreat season october february roach et al 2022 in the control experiment mean however the rate of gain during advance is so slow that the sie maximum is reached a month late in october instead of september leaving only 4 months for ice melt fig 1a despite the skewed simulated seasonality the extremely rapid rate of sie and sia decline between october and december combined with slow ice gain during autumn leads to an extensive low ice or ice free season and a relatively short compared with observations ice covered season as can be seen in the pale grey lines depicting the mean sie and sia climatology of 60 pre industrial control coupled model intercomparison project phase 6 cmip6 simulations eyring et al 2016 low ice coverage particularly in the summer is a common bias among global coupled climate models fig 1 and remains a key focal point for future model development roach et al 2020 shu et al 2020 in testing the sensitivity of simulated sea ice in a global coupled climate model with clear common sea ice biases we seek to understand how changes to sea ice parameters affect the representation of sea ice seasonality as well as the magnitude of mean antarctic sea ice 4 1 initial parameter sample tests the ensemble mean of the 90 member control experiment is subtracted from all members of the control and 10 member sample experiments to show how each member deviates from this mean state the minimum and maximum deviation among the control members for each month depict the bounds of simulated internal variability termed the envelope of the control experiment fig 2 black lines internal variability is smallest at the sea ice minimum in february march when low ice coverage leads to relatively low variability and largest in late spring early summer when the steepest period of simulated ice retreat occurs the sample experiment member deviations show several parameters in which the climatology falls outside the control envelope indicating greater sensitivity to parameter choice fig 2 coloured lines however due to the computational expense of 90 member tests only parameters for which the sample climatologies of both sie fig 2 and sia supplementary material fall substantially upwards of the control envelope i e increased climatological sea ice relative to the control mean are chosen the selected parameters are cdw ice albedo kmelt snow albedo and wd turn however it is worth noting that snow conductivity ks and ice strength p0 and c0 show some sensitivity as well and could warrant further investigation in future work 4 2 simulated mean antarctic sea ice in 90 member tests high density sampling of the same parameter ranges as in fig 2 for the selected sea ice parameters clearly shows the sensitivity of mean sie sia and siv to parameter variation in the context of the control envelope fig 3 for example december sie in some wd turn members is more than 3 x 106 km2 above the control envelope fig 3a and in snow albedo is spread 1 x 106 km2 beyond the control ensemble mean fig 3i deviation from the control envelope persists year round including summer in many members of the albedo and cdw experiments fig 3d f and j o indicating a substantial impact on ice coverage and volume around the sea ice minimum for these parameters by comparison wd turn members tend to deviate between april december fig 3a c and kmelt members only deviate during late spring and early summer fig 3g i with few if any members deviating from the control envelope at the sea ice minimum examination of climatology deviations of each experiment member from the control ensemble mean reveals the tendency within each experiment fig 4 there is a high level of internal variability in the simulated mean sea ice reducing the linearity of the sea ice response to monotonically increasing parameter variation for example average september sie deviations from the control ensemble mean in wd turn are 0 67x 106 km2 for wd turn 9 68 0 24 106 km2 for wd turn 10 95 and 0 53 106 km2 for wd turn 12 63 in low density sampling such as the 10 member tests initially conducted the tendency could appear much weaker or disappear altogether as a result of this high internal variability whereas the high density 90 member sampling runs shown here permit the signal of sea ice sensitivity to parameter variation to dominate despite the high internal variability there are clear tendencies in all five parameter varying experiments most strongly in the ice turning angle wd turn ocean sea ice drag coefficient cdw and snow albedo in the wd turn experiment an ice turning angle set to 22 0 or lower substantially increases while values above 28 0 decrease sia and siv between april and december fig 4a c the impact on sie is highest in late autumn to mid winter and again in mid to late spring which are the most intense periods of sea ice accumulation and loss the tendency in the other dynamic parameter cdw fig 4d f and both the albedo experiments fig 4j o is for reduced mean sea ice for values below the default and vice versa while the effect of parameter variation is lowest at the february sea ice minimum the sea ice response for most members of these experiments continues year round by comparison changes to the ocean ice heat flux parameter kmelt are more seasonally variable fig 4g i low magnitude kmelt values tend to produce more sea ice in the spring but less sia in winter and vice versa for high magnitude values the decreased sia despite increased sie implies that the low magnitude kmelt values tend to increase low concentration coverage but still exceeding 15 while reducing the proportion of cells with high concentration ice cover the tendency is less clear for kmelt than in other experiments however with adjacent members i e very similar parameter values producing ice anomalies of opposing signs indicating a more pronounced effect of internal variability than in other experiments given the high magnitude deviations from the control experiment during the seasons of ice gain and melt we now consider individual member deviations from monthly sea ice tendency to show how parameter variation impacts seasonal sea ice evolution fig 5 the timing and rate of simulated sea ice advance and retreat is important as it indicates the duration of the open water season i e length of the ice free summer with a longer open water season leading to greater solar driven surface warming and an amplifying feedback reducing sea ice further maksym et al 2012 a low turning angle wd turn delays autumn gain in sie despite an increase in the gain of sia and siv implying a more constrained ice cover with slower northward expansion fig 4a c low magnitude wd turn members also reduce spring sia and siv decline with enhanced summer melting instead but the spring sie loss is increased low ice turning angles therefore tend to produce a more compact and thicker ice cover and retain ice in the interior for longer but lose ice at the northernmost edge earlier the reverse is true for members with high magnitude turning angles the monthly autumn and winter gain of sia and siv is reduced despite enhanced sie gain in autumn and spring implying a looser but more extensive ice cover with lower summer melt owing to less ice gain during winter greater ocean ice drag coefficients cdw increase autumn ice gain in all three metrics with volume continuing to increase through winter even as areal expansion ceases fig 5d f due to greater ice presence than the default value there is enhanced siv loss in december and enhanced sie and sia decline from january indicating thinning of ice before areal loss for low magnitude cdw members the effect is reversed and is also stronger a large reduction in ice advance delays areal expansion until later in the winter but siv gain remains lower than default throughout autumn winter and spring an apparent reduction in summer ice melt results from the relatively low and thin ice cover the seasonal evolution of sea ice in kmelt is strongly affected during spring and summer with lower ocean iceheat flux retaining more ice through spring and delaying melt until summer and vice versa though to a lesser extent for higher flux values fig 5g i a small tendency towards greater winter sie but smaller sia occurs in the lowest magnitude kmelt members the difference between sie and sia being that in the former entire grid cell area is counted as long as the areal fraction exceeds 15 whereas in the latter only the ice covered fraction of grid cell area is counted the contrasting winter sea ice behaviour in low magnitude kmelt values implies a regional response i e that less ocean heat into the base of the sea ice allows more ice at lower latitudes to reach the 15 isoline but reduces higher concentration interior ice sea ice is more strongly influenced by atmospheric influences during the season of advance with a greater oceanic influence during retreat explaining why the effect of varying the ocean ice heat flux is most notable in the season of sea ice melt the areal coverage response to varying ice or snow albedo fig 5j o is similar to that of cdw with members above the default in both experiments producing increased autumn gain decreased winter gain and delayed summer melt however while high magnitude cdw members showed volume gain throughout autumn spring the high magnitude albedo members only gain volume during autumn with less gain from june as the dark winter months set in 4 3 changes to dynamical redistribution the gfdl cm2 1 model delworth et al 2006 and its successor gfdl cm3 griffies et al 2011 both have warm ocean biases and seasonal sea ice evolution in the latter is dominated by thermodynamic processes with far less sea ice mass transport than other global coupled climate models schroeter et al 2018 it is thus interesting to note the high sensitivity of the two dynamic sea ice parameters tested in this analysis fig 3a f modifying these parameters can alter the relative balance of the underlying dynamic processes e g changing the ice turning angle can move more or less ice away from the coast changing the divergence convergence of sea ice and as a consequence seasonal thermodynamic freeze and melt whereas alterations to thermodynamic parameters are unlikely to have a substantial effect on dynamic processes we now show the effect of varying the two dynamic parameters on the processes driving sea ice evolution the seasonal gain and loss of siv over time siv t can be decomposed into dynamical redistribution processes advection and convergence and thermodynamic freeze and melt processes shown for control ensemble mean fig 6 holland and kwok 2012 lecomte et al 2016 schroeter et al 2018 uotila et al 2014 while seasonal siv gain and loss is spatially homogeneous fig 6a b the constituent processes are more spatially heterogeneous fig 6c h regions where the sign of the contributing term matches the sign of the corresponding siv t seasonal change indicate where the contributing term works towards the overall seasonal sea ice evolution opposing signs indicate the contributing term working against siv t for example the contribution of sea ice advection is generally positive throughout the sea ice zone aiding ice gain during advance fig 6c but affecting sea ice melt particularly at the ice edge as it continues to transport ice northward during retreat fig 6f along the coastline easterly winds push sea ice coastwards where geographical constraints prevent further advection of the ice so advection appears to work against ice gain the convergence term fig 6d g indicates whether the flow of ice is divergent negative which is dominant in the sea ice interior or convergent positive such as around the coast where ice tends to accumulate it is closely linked to the thermodynamic freeze positive and melt negative term fig 6e h during advance divergent sea ice motion reduces ice cover in the interior fig 6d however by opening up ice cover to cold surface temperatures it permits a strong positive thermodynamic contribution as more ice can be produced in the interior fig 6e similarly divergent ice motion during retreat fig 6 g enables greater heat transfer between the ocean and atmosphere supporting ice melt fig 6h at the ice edge the thermodynamic contribution can be negative during both advance fig 6e and retreat fig 6h as ice is mechanically increased at the ice edge through advection and divergence but surface temperatures are too warm to sustain ice presence thus the ice melts a ratio is computed for the advection convergence and thermodynamic freeze melt components comprising spatially averaged siv t during advance and retreat fig 7 these ratios depict the relative dominance of the underlying processes driving the seasonal cycle in each member rather than explicitly quantifying the magnitude of the processes and sea ice evolution it should be noted that due to the complex interactions and compensating influences of the components the resulting ratios for individual components can be values above or below 100 at the ice edge lower values of wd turn in which mean sea ice is amplified see fig 4a c show vastly reduced contributions from northward ice advection fig 7a and convergence owing to more convergent sea ice compared to the control ensemble fig 7b conversely high magnitude ice turning angles produce greater northward advection of sea ice to the ice edge contributing positively to winter ice gain but impeding spring ice retreat while more divergent sea ice motion at the ice edge does the reverse there is a small tendency for thermodynamic gain freeze at the ice edge to increase in relative importance as the magnitude of the turning angle increases as divergent ice motion opens the ice pack to the cold atmosphere fig 7c but this is largely within the envelope of the control ensemble during retreat the relative importance of thermodynamic melting shows no change as the ocean ice drag coefficient reduces the negative contribution of advection towards sea ice retreat at the ice edge becomes stronger fig 7d however there is no change in the convergence term in either season with variation in cdw fig 7e in low magnitude members the relative importance of the thermodynamic freeze melt contribution is less than the control ensemble during advance but is much stronger during retreat fig 7f where it compensates for the enhanced ice transport to the ice edge through advection fig 7d in the ice interior fig 8 wd turn members with high ice turning angles transporting ice northwards away from the interior have a more strongly negative dynamic influence on ice gain during advance fig 8a b compensated by thermodynamic freezing fig 8c however this does not translate to more ice overall fig 4a c during the retreat season advection remains within the control spread for all members of wd turn however the opposing influences of convergence and thermodynamic melt is strongly enhanced with melt becoming negative in some of the highest magnitude members implying additional spring freeze in the interior under the highest ice turning angles in contrast low ice turning angles produce a weaker influence of convergence in both seasons and thermodynamic freeze melt dominates instead varying the ocean ice drag coefficient only affects the relative influence of the underlying processes driving sea ice evolution in the lowest magnitude members with the remaining members remaining within the control envelope for low values of cdw in which mean sea ice is reduced compared to the control ensemble mean advection and convergence work more strongly against sea ice advance fig 8d e and in some members additional freeze occurs during retreat fig 8f 4 4 sea ice melting heat fluxes the lack of solar heating limits melting at the top surface of sea ice for half the year but a substantial amount of melting at the bottom of the sea ice occurs year round indeed basal sea ice melt is the proportionately most dominant melt component during the cooler months followed by melting at the top and then a small contribution from lateral melt tsamados et al 2015 the model provides diagnostic fields for the melting energy flux at the base bmelt and top tmelt of the sea ice which we average across the ice edge and interior for the seasons of ice advance and retreat as in section 4 3 fig 9 unsurprisingly the effect of parameter variation on bmelt and tmelt is greatest among members of kmelt fig 9i l the parameter which modifies the heat flux from the ocean into the base of the ice where lower ocean ice heat flux values increase the melting energy flux at the top of the sea ice to compensate for the reduction at the sea ice base at both the ice edge and interior and vice versa for high kmelt values in the albedo experiments higher albedo values reduce melting energy flux at the top of the sea ice during retreat fig 9 m o q and s however basal melt at the ice edge during retreat is increased fig 9n r and freezing at the base of the ice is strongly reduced in the interior ice zone fig 9p and t a small tendency towards additional basal sea ice melting at the ice edge is also seen in both seasons in high albedo members fig 9n and r for the dynamic parameters the effect on melting energy fluxes is smaller basal melt in the retreat season is increased with higher turning angles and basal freeze during advance is decreased indicative of a thinner ice cover in high magnitude wd turn members fig 9d compared with the thermodynamic parameters there is little notable tendency among members of cdw fig 9e h 5 discussion and conclusions many sensitivity tests of antarctic sea ice have been conducted using stand alone sea ice models coupled ocean sea ice models or low density parameter sampling in coupled climate models dorn et al 2007 hunke 2010 ma et al 2020 massonnet et al 2014 miller et al 2006 roach et al 2018 uotila et al 2012 the present analysis however examines high density parameter testing of antarctic sea ice sensitivity in the context of large simulated internal variability in coupled global climate model our experiments analysed the model response to variation in 5 sea ice parameters with the largest effect seen in wd turn sea ice turning angle cdw ocean ice drag coefficient and snow albedo a smaller level of sensitivity is seen in ice albedo and kmelt ocean ice heat diffusivity coefficient while modified parameters produce some changes to the timing of sea ice advance and ice presence during the autumn and winter a much stronger effect occurs in spring and early summer ocean heat is a strong contributor driving sea ice evolution during spring gordon 1981 and the model is known to have a warm ocean bias low relative to observations mean sea ice low sea ice mass transport and dominance of thermodynamic processes sea ice in the model is clearly strongly affected by ocean ice interactions and given that the thickness and coverage of sea ice affects the amount of solar radiation that is reflected during the sunlit months brandt et al 2005 parameter variation also strongly impacts spring and summer atmosphere ocean heat flux several parameter experiments show capacity to alter simulated sea ice seasonality which is skewed towards a too slow advance with maximum extent reached a month late and a rapid too short retreat depending on the parameter ice gain in autumn can be increased and ice loss in the early months of retreat reduced resulting in greater mean sea ice cover than the control ensemble mean throughout much of the year however outside the albedo experiments the climatological sea ice minimum february bias remains largely unchanged when placed in the context of the 90 member control simulation with increased climatological mean sea ice for much of the year and a continuing negative late summer sea ice bias the underlying reasons for any bias reduction require careful consideration to ensure that unrealistic processes are not introduced into the coupled system for example amplification of sea ice freeze has implications for convection and deep water formation as greater sea ice production induces more vertical mixing deepening the ocean winter mixed layer indeed too much ice production can destabilise the water column and stimulate deep convection martinson 1990 unrealistic open ocean deep convection is a known issue in several global climate models with strong seasonality heuzé et al 2013 thus parameter tuning that results in an amplified seasonal cycle warrants close monitoring to avoid exaggerated destabilisation of the water column in the ice interior uotila et al 2014 note that it is not sufficient to merely choose parameter values that produce a more realistic metric of sea ice e g sie climatology rather it is important that the parameter set most accurately reflect components of the sea ice budget sea ice thickness resulting from thermodynamic processes is physically limited by a balance of snow accumulation ice atmosphere heat loss and ocean ice heat flux maksym et al 2012 thick ice above 2 m occurs largely through mechanical deformation allison 1997 maksym et al 2012 opening water within the ice interior inhibits mechanical thickening while advection shifts ice away from the coast into the interior and towards lower latitudes where it more readily melts the dynamic parameters show that the balance between advection divergence convergence and thermodynamic freeze and melt can be altered with parameter variation for example high sea ice turning angles increase divergent ice motion in the interior transporting more ice away from the coast and permitting more ocean atmosphere heat exchange greater advection and divergent motion assist sea ice retreat by dispersing and moving the ice northwards to warmer latitudes it may appear logical that increased mechanical redistribution northwards with a higher ice turning angle would increase ice cover ma et al 2020 uotila et al 2012 however in our experiment these members have less basal freezing producing thinner winter ice that readily melts in early retreat low magnitude turning angles instead retain ice near the coast reducing areal coverage but leading to higher winter ice volume by also reducing melt in early retreat these members extend the season of ice cover and reduce the ice free season it is important to note however that as model development continues to advance into the future towards increased vertical ocean and boundary layer resolution processes such as ekman spirals may be simulated explicitly in coupled climate models removing the need for parameterisation of these boundary layer processes thermodynamic sea ice growth requires the venting of ocean heat to the atmosphere as ocean water is cooled by the atmosphere ice is formed and the cooled water sinks entraining warmer water from below which then works to limit ice growth by warming the base of the ice maksym et al 2012 if the competing processes continue towards net growth eventually the ice thickens enough to prevent ocean atmosphere heat transfer which inhibits further ice production and thermodynamic growth slows or halts entirely martinson 1990 generally ice would thicken beyond this point only by mechanical deformation however low values of ocean ice heat diffusivity tip the balance away from thermodynamic equilibrium towards net ice production and with low or near zero values of kmelt heat flux at the base of the sea ice is constrained and the negative feedback effect of entrained warm water on the base of the ice is inhibited melt at the top surface of the sea ice increases instead a compensation which perhaps explains why despite less melt at the bottom surface of the sea ice there is little change to the surface radiative balance and only a moderate change in seasonal ice cover overall thermodynamic freeze and melt dominate changes in the magnitude of the sea ice seasonal cycle in the albedo experiments with greater reflection of shortwave radiation at the surface throughout more of the year in members with high magnitude ice and snow albedos melting at the upper ice surface is reduced and a larger volume of ice persists through the year the underlying ocean is unable to vent heat through the thickened ice that would otherwise be passed through the ice to the atmosphere and thus vertical heat flux into the base of the ice is increased preventing the ice from thickening further maksym et al 2012 the large ensemble sensitivity analysis presented here suggests that some biases in the cafe control run can be substantially reduced by simply altering sea ice parameters however it is important to understand the method by which these parameter variations have changed the mean climatology in order to identify potential error compensation or unrealistic driving processes it is also worth noting though beyond the scope of this analysis that bias reduction could potentially be amplified or cancelled out by varying more than one parameter at a time if those parameters produce different sea ice responses the distinct sea ice behaviour resulting from changes in different parameters provides additional evidence that multi variate parameter sensitivity testing is required to tune a model to better represent mean antarctic sea ice and its variability uotila et al 2012 future work will aim to improve the representation of antarctic sea ice and its underpinning physical processes by extending the present work to a multi variate ensemble parameter analysis credit authorship contribution statement serena schroeter methodology investigation analysis writing visualisation paul a sandery methodology investigation analysis writing visualisation declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgements serena schroeter was supported by a csiro early career research fellowship model runs and data analysis were undertaken with the assistance of resources and services from the national computational infrastructure nci which is supported by the australian government data analysis and visualisation were performed using the ncar command language https doi org 10 5065 d6wd3xh5 the ncar command language 2019 all authors approved the version of the manuscript to be published appendix a supplementary data supplementary material related to this article can be found online at https doi org 10 1016 j ocemod 2022 102090 appendix a supplementary data the following is the supplementary material related to this article mmc s1 
23827,in situ observations of subsurface ocean temperatures are in many regions inconsistently distributed in time and space these spatio temporal inconsistencies in the observational network lead to difficulties in utilizing those observations effectively for ocean model evaluation or understanding larger scale ocean characteristics model accuracy of subsurface ocean characteristics is especially important within regions that contain complex ocean structures one such region is the european arctic which not only contains several types of water masses with unique characteristics but also wintertime sea ice coverage and complex bathymetry this study presents an unsupervised neural networking technique that can be used in combination with traditional ocean model evaluation techniques to provide additional information on the accuracy of modeled vertical ocean temperature profiles self organizing maps is an unsupervised machine learning technique that we apply to approximately twenty thousand argo and ctd temperature profiles from 2012 to 2020 in the european arctic to categorize the observed vertical ocean temperature structures in the top 150 m the observed ocean profile categories or neurons defined by the self organizing map show strong spatial and temporal dependencies we then use the neuron weights or the learned temperature profile structure of each neuron to validate the spatial and temporal variability of modeled vertical temperature structures this analysis gives us new insights about the model s capabilities to reproduce specific vertical structures of the top most ocean layer within different regions and seasons mapping modeled ocean temperature profiles onto the neuron space of the observationally defined self organized map highlights the potential of this method to advance our understanding of model deficiencies in that region keywords self organizing maps unsupervised neural network arctic ocean vertical temperature structures argo ctd data availability all argo ctd observations as well as the topaz model forecast data used in this study are accessible through the copernicus marine environmental monitoring service the topaz output products are available here https doi org 10 48670 moi 00001 and in situ observations argo and ctd are available here https doi org 10 48670 moi 00036 1 introduction in coupled ocean atmosphere model systems many challenges are connected to the accurate representation of the air sea heat momentum and mass fluxes cronin et al 2019 giorgi 2019 in order to advance simulations of the ocean atmosphere heat exchange accurately simulating the upper few hundred meters of the ocean water column is necessary due to its large impact on sea surface temperature variability and in turn the heat and moisture fluxes to the atmosphere d asaro 2014 thus not only sea surface temperature but also ocean subsurface observations are critical to understand coupled ocean atmosphere model characteristics the main observation source for upper ocean temperature is provided by autonomous floats of the argo program and ship based ctd measurements wong et al 2020 the spatio temporal patterns of those in situ observations are however highly irregular in space and time thus using observed profiles for model evaluation is difficult and further challenged by the issue of representativeness of a point observation versus a gridded model solution due to these inconsistencies model verification studies often use climatological products e g the world ocean atlas or ocean reanalysis products however in order to preserve the fine scale structure of upper ocean profiles which is crucial for the short term development of the sea surface temperature by vertical convective processes it would be preferable to not smooth out for example a sharp mixed layer which is presented in the raw data or other small spatial scale features such as eddies this is especially important and especially challenging within regions that contain complex ocean structures and multiple types of water masses with unique temperature characteristics utilizing an unsupervised categorization methodology in order to find systematic spatio temporal patterns between upper ocean temperature profiles has the potential to make additional use of the large amount of existing argo and ctd profiles jones et al 2019 sonnewald et al 2021 the self organizing map hereafter referred to as som kohonen 2001 is an unsupervised artificial neural network that is often used in meteorological and oceanographic applications liu and weisberg 2011 iskandar et al 2008 richardson et al 2003 liu et al 2016 to simplify and map highly complex spatio temporal data onto a simplified 2 dimensional space in the present study we apply som to a set of argo and ctd profiles of the upper 150 m for the region of the nordic and barents seas and show how this method can be complimentary to more traditional ocean model evaluation techniques to provide additional information on the accuracy of modeled vertical ocean temperature profiles this paper is organized as follows section 2 describes the data used section 3 describes the som methodology section 4 presents the results of the som analysis as well as the model evaluation while section 5 contains a discussion 2 data 2 1 observations we use a combination of in situ temperature observations primarily argo and ctd profiles between 2012 and 2020 obtained through the copernicus marine service monitoring service wong et al 2020 wehde et al 2021 we interpolate each temperature profile within the european arctic domain to vertical coordinates every 1 m and only keep data in the top 150 m of the water column profiles that either do not reach a depth of at least 150 m or do not contain temperature data in the top 10 m are ignored the resulting total number of observed temperature profiles used in this study equals 24 742 2 2 ocean model ocean model simulation output of the topaz4 model is used for comparison the topaz4 model is part of the copernicus marine environmental monitoring service cmems arctic marine forecasting center arc mfc which is a forecasting system producing daily 10 day ensemble forecasts sakov et al 2012 the forecasting system is based on the hybrid coordinate ocean model hycom coupled to a sea ice model with the sea ice thermodynamics and the elastic viscous plastic rheology described in hunke and dukowicz 1997 the weekly data assimilation system used in topaz4 is the ensemble kalman filter this is a multivariate assimilation technique that depends on the 100 member best estimate ensemble sakov et al 2012 a suite of 10 member 10 day forecasts is performed daily forced by the european centre for medium range weather forecasts ecmwf high resolution hres weather forecast model bauer et al 2013 topaz uses the turbulent mixing sub model from the goddard institute for space studies as described in canuto et al 2002 the native horizontal grid of the topaz model contains a resolution of approximately 12 16 km however output products are interpolated onto a grid with 12 5 km resolution the native vertical resolution of the topaz model uses 28 hybrid layers the hybrid layers are defined so that the minimum thickness of the top most layer is 3 m while the maximum thickness of other layers is 450 m the output products however are only archived for 12 vertical z layers sakov et al 2012 and melsom et al 2012 provide additional details about the native topaz model setup we use the daily ensemble mean topaz4 ocean temperature profiles for the year 2020 the topaz model simulations are accessible through the copernicus marine environmental monitoring service on a z level vertical grid with depths of 5 30 50 100 200 and 400 m in the upper ocean we interpolate all topaz temperature profiles at each spatial location for every day to 1 m depth intervals at spatial locations where temperature profiles are at least 200 m to ensure correct interpolation to a depth of 150 m each interpolated topaz profile is truncated at a depth of 150 m 3 self organizing map self organizing mapping is an unsupervised artificial neural network that is used for pattern recognition classification and clustering analysis kohonen 2001 it has been widely used in the context of meteorological and oceanographic observation and model analysis liu and weisberg 2011 liu et al 2016 landschützer et al 2013 2014 unsupervised machine learning algorithms including som are able to learn and adjust their own classifications based on the input data alone without any external or user input in order to learn without external input unsupervised algorithms assume that shared patterns exist within the input data this assumption is appropriate for our application since temperature profiles within a given region share many characteristics soms are defined as a 2 dimensional map comprised of neurons each neuron is defined with a neuron weight which are trained using a competitive learning algorithm this means as each piece of data in our case a piece of data is a single observed vertical temperature profile is input during the iterative training process there is only one winning neuron also referred to as the best matching unit hereafter referred to as the bmu to which that piece of data is assigned in other words only one neuron within the som can be activated during each iteration of the training process for each piece of input data the structure of the activated neuron is adjusted to closer match the new data assigned to it however it is possible to allow each activated neuron to also influence the structure of the neighboring neurons neurons in a som are therefore more similar to their neighboring neurons than they are to neurons located farther away in the 2 d som space this competitive learning process and neighborhood influence leads to the neurons within the som organizing themselves 3 1 defining the som before training the som to the observational temperature data the spatial structure of the 2 dimensional som space must be defined in most cases the best results occur when the physical space of the observations is similar in shape to that of the som since our arctic domain is approximately square the best results occur from a som also containing a square shape increasing the total number of neurons in the som generally results in a better fit meaning each individual temperature profile better matches their assigned neurons however using too many neurons does not sufficiently reduce the data to provide useful information about the characteristics of the data on the other hand defining a som with very few neurons generally results in a poor fit between any given profile and its assigned neuron weight we use the som quantization error q error to determine the fit of a data set to the trained som weights the q error is calculated as the mean euclidean distance between the data and neuron weights where smaller q error values indicate stronger fit of the data to the neuron weight the euclidean distance in units k between any two temperature profiles such as an observation and a neuron weight is calculated as follows 1 d i 0 d m a x t i a t i b 2 where d is the euclidean distance d m a x is 150 m the maximum depth of the profiles and t i a and t i b are the temperatures of profiles a and b respectively at a depth of i m although the size of the som is ultimately selected by the user a suite of sensitivity studies testing multiple som sizes results shown in fig 1 helps determine an appropriate size fig 1 shows the q error is relatively constant at large som sizes in other words small som sizes result in large errors due to inadequate separation between profile types however very large som sizes are not useful either as they do not strongly improve the q error nor sufficiently reduce the dimensionality of complex data fig 1 shows a som with the size of 6 6 neurons for a total of 36 neurons results in a low q error meaning the raw data agrees well with the learned neuron weights this size both simplifies the complexity of the original data while adequately separating unique vertical temperature structures which is important for classification and model evaluation the q error of the 6 6 som trained to the observation temperature data is 5 75 k fig 1 3 2 training the som the first step of training the som is initializing each neuron weight we initialize the weights using a randomly selected observed temperature profile from the data set the som is then trained on the observed temperature profiles through an iterative process one randomly selected temperature profile from the data set is input at a time and the som algorithm determines which neuron weight it best matches the winning neuron or best matching unit bmu is determined by minimizing the euclidean distance between the observation and the neuron weight see eq 1 the structure of the bmu weight is then adjusted toward the structure of the new data assigned to it during the training of the som we allow the winning neurons to weakly influence the structure of their neighbors this results in the som organizing itself so that neurons will share similar characteristics to their neighbors the neighborhood function of the som defines how the winning neurons influence their neighbors we define the neighborhood function to be gaussian in space with a sigma value of 1 25 the training process also depends on a learning rate parameter and the total number of iterations the 6 6 som in this study is trained using a learning rate of 7 and 20 000 iterations several sensitivity tests not shown determined the structures of the som neuron weights are not sensitive to adjustments in the learning rate or the number of iterations used assuming the number of iterations used to train the som is appropriate for the size of the input data set we found that for our data set containing approximately 24 000 temperature profiles values between 10 000 iterations and 20 000 iterations in the training process had a negligible impact on the results as previously mentioned in section 3 1 the q error which estimates the fit of the data to the som weights is strongly influenced by the som size used however the structures identified within a given som size are robust in other words re training a 6 6 som on the observational temperature data consistently produces similar temperature structures although the location of any given structures within the 6 6 som space changes we have high confidence in the ability of the som temperature classifications due to the robustness of temperature structures that result 4 results 4 1 the study region nordic and barents seas our study region is a part of the european arctic including the greenland sea lofoten basin and barents sea fig 2 the norwegian meteorological institute operates a convective scale weather forecasting system müller et al 2017 for this region with future endeavors to couple the atmospheric system to more realistic representations of ocean sea ice and wave dynamics batrak and müller 2018 2019 thomas et al 2021b the upper ocean in this area is characterized by cold polar water masses from the north and the intrusion of warm atlantic waters with its origin in the north atlantic current nac rossby 1996 the boundary between the north atlantic water mass and the arctic water mass containing large gradients in temperature and salinity is called the arctic front swift and aagaard 1981 raj et al 2019 the inflow of relatively warm atlantic water into the frontal region is through two nac branches first the norwegian atlantic slope current nwasc following the norwegian shelf edge as a barotropic slope current skagseth et al 2004 and second the norwegian atlantic front current nwafc flowing as a topography guided front current along the ridges dividing the norwegian lofoten and greenland basins mork and skagseth 2010 the nwasc further branches into a northward current towards the western side of the svalbard archipelago west spitsbergen current wsc and into the barents sea though the barents sea opening helland hansen and nansen 1909 aagaard et al 1985 the spatial characteristics of the sea surface temperature sst in this area reflect the northward flowing warm atlantic waters from the nwasc and nwafc areas of seasonal sea ice and the arctic front fig 3 again the arctic front is characterized as the boundary between warm atlantic water and arctic water which is most easily discussed through the behavior of the nwasc nwafc and wsc as seen in fig 2 the sst varies seasonally in all regions and a warm surface layer develops during summer in particular strong vertical temperature contrasts develop seasonally in basins which are not strongly influenced by the nwasc and nwafc for example the greenland basin or eastern barents sea raj et al 2019 4 2 observed structures in the following we highlight the potential of the som methods to reveal insights into the vertical structure of the upper o 100 m of the ocean which can be further used for evaluation purposes of gridded subsurface temperature products we will first show the spatial and temporal patterns resulting from the som as applied to in situ ocean temperature observations we note that we only characterize upper ocean temperature profiles herein thus the results and discussion below only characterize the vertical thermal stratification in the top 150 m of the water column and not the true stability of the water column as we do not include salinity in this analysis fig 4 shows the result of the som as applied to the observed temperature profiles the som learned profiles that define each neuron numbered 1 36 also referred to as the neuron weights are plotted with the thick black lines the neuron weights represent the different types of temperature profiles observed in our region the thin colored lines show each individual in situ temperature profile sorted according to their best matching unit again the bmu is determined by minimizing the euclidean distance between the observed profile and the neuron weight the structure of the 6 6 map of neurons can be summarized as follows see also schematic in fig 5 the upper left neuron 1 is characterized by a cold surface layer which deepens and becomes colder towards the right moving from neuron 1 across the row towards neuron 6 neuron 3 is unique in this series and contains a very distinct thin cold surface layer in the top 20 m this top row represents temperature profiles that are non thermally stratified the neurons in the second and third rows neurons 7 to 18 contain temperature profiles roughly described as well mixed similar to row 1 these well mixed profiles become colder towards the right decreasing from approximately 5 c to 0 c the bottom three rows neurons 19 to 36 contain profiles with stable thermal stratification temperature decreases with increasing depth these profiles typically become warmer as you move down through the rows and increase in thermal stratification as you move downward and towards the right neuron 36 in the lower right corner of the som contains profiles that exhibit a relatively warm surface layer a distinct thermocline at a depth of approximately 40 m and relatively cold water below the thermocline the boreal winter djf and summer jja distribution of observations sorted according to their bmu are shown in supplemental figures s2 and s3 respectively supplemental figure s2 shows that wintertime observations are clustered in the neurons located in the top left corner of the som space indicating wintertime profiles in this region are dominated by non thermally stratified and well mixed temperature profiles the summer observations contain larger spread in temperature characteristics and thus are distributed across a larger number of neurons than the winter profiles furthermore the summer profiles contain thermally stratified profiles seen in the bottom left corner of the som structures that are not observed during winter months the color scheme shown in fig 4 is specifically designed to be a two dimensional color gradient that visually represents similar characteristics shared between neighboring neurons this color scheme which represents profile similarities is useful in spatial plots of the bmu in the following discussion we ask readers to refer to the neuron color scheme as defined in fig 4 fig 6 shows the spatial distribution of observed temperature profiles for each season djf mam jja son the color of each observation is based on the profile s bmu as defined in fig 4 fig 6 shows strong spatial and temporal patterns in the observed temperature profile characteristics captured by the som technique temperature profiles north of 80n in every season are dominated by characteristics of very cold sst and upper ocean temperatures and contain increasing temperatures with depth these characteristics occur primarily in the magenta colored neurons i e neurons 4 6 see fig 4 during djf and mam fig 6 shows the greenland basin refer to fig 2 for the location is dominated by cold temperature profiles as seen by the magenta and dark orange colored neurons for example neurons 11 12 17 and 18 these temperature profiles are either thermally non stratified or are cold and well mixed to a depth of 150 m specifically these profiles are characterized by surface temperatures slightly above 0 c while the waters below 50 m are very close to 0 c during jja and son however the greenland basin typically contains profiles with high thermal stratification characterized by light orange and yellow colored neurons such as neurons 24 30 or 36 the upper ocean in this region during the summer and fall contains relatively warm with respect to the wintertime sst in the same region shallow surface layers with depths of approximately 25 m that contain temperatures of approximately 5 c the water temperature below the shallow surface layer is similar in structure and temperature as observed in the winter months characterized by cold temperatures of approximately 0 c the lofoten basin again for the location refer to fig 2 is dominated by profiles containing much warmer ocean temperatures throughout the upper 150 m during all seasons than observed in the greenland basin fig 6 during djf the ocean temperature structure is characterized by well mixed profiles to a depth of 150 m and contains temperatures approximately 5 c these profiles are characterized by for example neurons 7 8 13 and 14 during jja however the lofoten basin contains temperature profiles with slight temperature stratification that the som categorizes as for example neurons 25 26 and 31 33 colored in royal blue and blue gray these stratified profiles contain warmer sst than the corresponding winter profiles all the profiles in the lofoten basin regardless of the season share a key characteristic relatively warm temperatures between 50 150 m that remains above 5 c all year as opposed to the profiles in the greenland basin which contain very cold waters close to 0 c at depths below 50 m the spatial and temporal patterns of observed ocean temperatures captured by the som shown in fig 6 correctly identify several key oceanographic characteristics of this region the som captures the relatively warm norwegian atlantic current flowing into the region from the south a portion of which continues as the west spitsbergen current flowing northwards on the western side of svalbard som clearly identifies a distinct separation between the upper ocean temperature characteristics seen in greenland basin versus the lofoten basin additionally this technique captures the seasonal surface warming throughout the domain during the summer months as well as the persistent cold subsurface temperatures in the greenland basin the som technique described above is thus capable of identifying observed characteristics of upper ocean temperature structure in the european arctic furthermore som simplifies a potentially complex analysis by clustering vertical temperature profiles with similar characteristics together into neurons essentially reducing the complexity of the original data in the following section we show how the observationally based neuron weights can be leveraged to provide useful information to analyze the spatial and temporal characteristics of gridded ocean products for example from an ocean model 4 3 model evaluation this section presents the results comparing the upper ocean temperature simulated by the topaz model against observations rather than performing temporal or spatial averaging on the observations which smooths out important fine scale spatio temporal characteristics we leverage the observation based som presented in the previous section we note the purpose of this section is not to provide a robust evaluation of the topaz model performance in the european arctic but rather we use the topaz model to highlight additional insights of using som which are complimentary to more traditional model evaluation techniques while using the som neuron weights alone for evaluation may not be sufficient since they only show dominant profile characteristics smoothing out small scale features fig 4 as well as supplemental figures s2 and s3 also show the raw observations providing an estimate of the observed variability for any given neuron we use these figures to analyze the topaz model s ability to represent the fine scale patterns of variability seen in observations we first plot all djf and jja topaz temperature profiles sorted according to the profile s bmu fig 7 shows the djf profiles while fig 8 shows the jja profiles the bmu of each topaz profile is determined by the minimum euclidean distance between the topaz temperature profile and each som neuron weight as in fig 4 the som neuron weights are shown in the thick black lines in each figure the most striking feature of the djf and jja topaz profiles seen in figs 7 and 8 is the coarse vertical resolution of the model data to quantify how well the topaz model data fits the observed neuron weights we calculate the q error for each season for both observations and topaz data table 1 shows the topaz model contains larger q errors than the observations for every season unsurprisingly this indicates the coarse vertical resolution topaz data fits the neuron weights slightly worse than the observations do the coarse vertical resolution and spatial smoothness of the model results in a loss of small scale variability thus the topaz data poorly captures the small scale vertical features observed such as the exact depth and temperature gradient of thermocline additionally topaz shows much greater variability in the sst for many neurons especially neurons with thermal stratification this large spread in sst can be seen for example in neurons 18 24 30 and 36 to determine specific instances where the topaz model may be under performing we compare seasonal temperature profiles plotted in som space supplemental figures s2 and s3 are identical to fig 4 however only contain djf or jja observations respectively plotted according to their bmu comparing supplemental figures s2 and s3 against figs 7 and 8 we can determine which observed temperature structures topaz captures poorly in both djf and jja topaz generally reproduces the non stratified and well mixed profiles well one exception to this is neuron 3 where topaz systematically fails to generate the thin cold surface layer seen in observations just north of the svalbard archipelago another example of profile structures that are poorly represented in topaz are the strongly stratified profiles observed in jja i e neurons 30 and 36 topaz poorly represents the depth and gradient of the thermocline in these structures lastly topaz overestimates the sst in many of the thermally stratified neurons during jja next we analyze how topaz reproduces the observed spatial patterns of the profile types during each season similar to fig 6 fig 9 shows the spatial distribution of the neurons classified by topaz for each season djf mam jja and son since we use ensemble mean daily topaz data in order to retain high frequency temporal variability we determine topaz model bmu for each day at every grid cell fig 9 plots the bmu that occurs most often at every spatial point in each season i e the colors represent the bmu mode for the season overall topaz captures the general spatial distribution of the profiles well similar to observations topaz contains very cold well mixed profiles north of 80n additionally it captures a general difference of profile characteristics between profiles in the greenland basin versus the lofoten basin in topaz similar to observations the greenland basin is generally dominated by non thermally stratified or cold well mixed temperature profiles in djf and mam while more thermally stratified profile types occur during jja and son as observed in the lofoten basin topaz also contains profiles that are well mixed or thermally stratified lastly topaz captures the observed seasonal warming patterns observed which are particularly apparent in the lofoten basin where the top most ocean layer temperatures of the stratified profiles are warmer in jja and son than the temperatures captured in djf and mam although topaz captures some of the observed large scale temperature patterns fig 9 also shows that topaz fails to capture several key observed upper ocean temperature characteristics for example topaz does not capture the distinct separation of temperature characteristics between in the greenland basin and lofoten basin profiles instead topaz contains a gentle gradient of profile characteristics between these two regions additionally topaz poorly captures the ocean structures observed in the west spitsbergen current along the west coast of svalbard observations show the profiles in the west spitsbergen current are dominated by either relatively warm well mixed profiles or slightly stable profiles topaz however fails to capture these profile characteristics in every season with the worst representation occurring during jja where the temperature structures in topaz contain too much vertical temperature stratification 5 discussion a thorough understanding of the observed upper ocean temperature patterns especially in high latitude regions is critical to accurately model the upper ocean the accuracy of simulated upper ocean temperatures directly impacts the accuracy of modeled upper ocean mixing and surface heat fluxes thus accurately simulating the upper ocean has large implications on the accuracy of coupled arctic weather forecasts which are becoming increasingly critical as ship traffic in the arctic due to industry and tourism is increasing and will continue to increase in the future hall and saarinen 2010 smith and stephenson 2013 stocker et al 2020 unfortunately many ocean models and gridded ocean temperature products are either spatially smooth in the horizontal temporally smooth such as climatology products and or have relatively coarse vertical resolution such as the archived output from the topaz ocean model these characteristics increase the difficulty of regional model evaluation since gridded products typically under represent the observed spatial and temporal variability in the upper ocean in this study we use a machine learning technique called self organizing maps which has great potential in earth and climate sciences kohonen 2001 liu and weisberg 2011 landschützer et al 2013 2014 the use of som and other unsupervised machine learning approaches are becoming increasingly common in oceanography and have many possible applications in observational and model analysis liu and weisberg 2011 liu et al 2016 jones et al 2019 rosso et al 2020 sonnewald et al 2021 boehme and rosso 2021 for example lu et al 2019 use unsupervised clustering and a neural network to estimate subsurface temperature anomalies from surface data we show that som analysis not only improves understanding of observed patterns but also can be leveraged to aid in the evaluation of a regional model to highlight the benefits of som in model evaluation we train the som against argo and ctd temperature profiles the som an unsupervised neural network algorithm is able to classify or group similar ocean temperature profiles together the som analysis highlights observed spatio temporal patterns within the upper ocean temperature we then leverage the learned vertical temperature structures as determined by the som algorithm in order to validate the topaz ocean model the som technique better retains small scale features seen in observations which are often lost due to spatial and temporal smoothing when validating model performance against gridded reanalysis or climatology products we show the topaz ocean model captures the general spatial and temporal distribution of observed upper ocean characteristics however the som technique highlights several instances where the topaz model contains critical deficiencies that would benefit from further improvement in particular the som technique captures instances where the topaz ocean model is unable to reproduce the spatial variability and upper ocean temperature features seen in observations most notably topaz fails to capture the distinct separation of profile structures between the greenland basin and lofoten basin in all four seasons additionally the som technique highlights how topaz fails to simulate the observed upper ocean structures in the west spitsbergen current observations show the west spitsbergen current should be a tightly confined region with profiles closely representing the characteristics observed in the lofoten basin extending northward into the arctic ocean along the west and north sides of the svalbard archipelago topaz on the other hand shows the west spitsbergen current contains characteristics of temperature profiles observed in the greenland basin while the lofoten basin like temperature structures do not extend far enough north additionally the current within topaz appears overly diffuse covering a larger region than observed on the west side of svalbard more generally many structures simulated in topaz especially in jja contain too much thermal stratification and subsurface water temperatures below 50 m depth that are too cold furthermore topaz struggles to capture the depth and temperature gradient of the observed thermocline not only in the west spitsbergen current where topaz performance is generally poor but throughout the domain this is especially true during summer months where warm sst is more prevalent the poorly simulated thermocline structure within our domain appears to be intricately linked to the coarse vertical resolution archived from the topaz model forecasts the native vertical resolution of the topaz model uses 28 hybrid layers but the topaz output products are only archived at 12 vertical levels this suggests there is a need not only for archiving more vertical levels from the topaz ocean model to improve our understanding of the model deficiencies but also for maintaining a minimum vertical resolution in the upper ocean within other ocean models used for arctic forecasting purposes this will become increasingly important as fully coupled forecasting systems become more prevalent in the arctic region failing to simulate the observed upper ocean temperature characteristics in the arctic could have serious implications on the accuracy of short term forecasts not capturing the observed thermocline structures suggests the model will likely also contain problems in simulating upper ocean mixing and surface heat fluxes the som analysis showed the topaz upper ocean stratification performs the worst in the boundary between the greenland and lofoten basins as well as in the west spitsbergen current the incorrect upper ocean temperature structures and the spatially diffuse nature of the simulated west spitsbergen current in topaz could also impact the model s ability to simulate the correct sea ice behavior such as melting and freeze rates in this region however further analysis is needed to determine the exact relationship between the modeled topaz upper ocean temperatures and any direct impacts on the ocean mixing surface heat fluxes or sea ice behavior we recognize that the topaz ocean model forecasting product contains data assimilation of argo and ctd temperature data thus the topaz forecast data used is not purely independent from the observations used to train the som in this analysis however we would like to mention the purpose of this study was not to perform a robust evaluation of the topaz model against independent observations but rather to highlight an underutilized machine learning technique that has great potential in oceanography and earth sciences in this study we highlight one potential application of som to the evaluation of gridded ocean products we initially tested the som technique using normalized temperature profiles however the observed separation in som space between the greenland and lofoten basin profiles is much less distinct when using normalized temperature profiles in other words the som is unable to clearly categorize profiles in our region when using normalized temperature profiles non normalized temperature profiles provide clean spatial and temporal separation between various oceanographic features thus allowing the best assessment of model performance however we expect many applications of self organizing maps in earth sciences and oceanography would benefit more from the use of normalized data one future effort utilizing normalized data will be to expand this analysis to multivariate data such as integrating salinity into the som analysis although salinity profiles are neglected in the present study they will be included in future efforts in order to analyze the density structure and vertical stability of this region similar to the gaussian mixture modeling technique used by thomas et al 2021a a multivariate approach may also help classify oceanographic features identifiable through salinity or density characteristics as opposed to temperature characteristics alone one benefit of som and other common unsupervised clustering techniques such as k means clustering over supervised machine learning techniques is requiring no user input during the training process this allows the model itself to identify and isolate characteristics and patterns within complex non linear data sets one difference between som and k means clustering is the self organizing nature of the neurons in som k means clustering contains exclusive partitioning where each piece of data can only belong to one neuron or cluster within a pre defined number of clusters while som also contains exclusive partitioning the som training process allows the structure of each neuron to influence the structures of the neighboring neurons therefore neighboring neurons in the som share common features which helps when identifying large scale spatial and temporal patterns and shared characteristics within the data without requiring the data to exist within the exact same cluster or neuron this self organization of the clusters and shared features between neighboring neurons made som an appropriate choice for our purpose of quickly identifying spatial and temporal patterns in observations and model data containing large variability such as upper ocean temperatures in the arctic one significant caveat of som and machine learning techniques in general is the inability of the algorithm to learn when large gaps in the training data exist the types of temperature structures identified by som the neuron weights are limited by the available observations used to train the neural network for example the eastern barents sea region is under sampled in every season if unique temperature structures exist in this poorly sampled region and are not represented in the training data set som is unable to identify and categorize these types of profile structures like all model evaluation techniques model evaluation with som is particularly challenging and results in larger uncertainties in regions with poor observational coverage another limitation of som is the sensitivity to the number of neurons used using too many neurons does not generate useful distinct clusters and provides little useful information about characteristics within the data on the other hand too few neurons results in a poor fit between the data and its assigned neuron weight this is due to overly large volumes of data assigned to any given neuron which smooths distinctive structures of the neuron weights it is worth noting that k means clustering also suffers from this limitation unsupervised machine learning techniques like self organizing maps have great potential in future oceanography and earth science research som can provide additional beneficial knowledge when used in combination with other evaluation techniques of modeled subsurface ocean temperature the som technique presented here is able to classify upper ocean temperature characteristics while retaining some of the observed small scale variability that is typically lost when validating models against reanalysis data sets which highlights instances where ocean models under represent observations in order to continue improving model representation of upper ocean temperature variability and the accuracy of coupled forecasting systems the results shown here indicate continued need for ocean model development advances in data assimilation of ocean observations into ocean models and increased observational coverage in the arctic credit authorship contribution statement erin e thomas conceptualization methodology investigation formal analysis visualization writing original draft malte müller formal analysis visualization writing review editing declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments financial support for this work was provided by the norwegian research council under the nansen legacy nfr 276730 and focus nfr 301450 projects appendix a supplementary data supplementary material related to this article can be found online at https doi org 10 1016 j ocemod 2022 102092 appendix a supplementary data the following is the supplementary material related to this article mmc s1 supplemental material contains supplemental figures showing djf and jja observations plotted according to their bmu 
23827,in situ observations of subsurface ocean temperatures are in many regions inconsistently distributed in time and space these spatio temporal inconsistencies in the observational network lead to difficulties in utilizing those observations effectively for ocean model evaluation or understanding larger scale ocean characteristics model accuracy of subsurface ocean characteristics is especially important within regions that contain complex ocean structures one such region is the european arctic which not only contains several types of water masses with unique characteristics but also wintertime sea ice coverage and complex bathymetry this study presents an unsupervised neural networking technique that can be used in combination with traditional ocean model evaluation techniques to provide additional information on the accuracy of modeled vertical ocean temperature profiles self organizing maps is an unsupervised machine learning technique that we apply to approximately twenty thousand argo and ctd temperature profiles from 2012 to 2020 in the european arctic to categorize the observed vertical ocean temperature structures in the top 150 m the observed ocean profile categories or neurons defined by the self organizing map show strong spatial and temporal dependencies we then use the neuron weights or the learned temperature profile structure of each neuron to validate the spatial and temporal variability of modeled vertical temperature structures this analysis gives us new insights about the model s capabilities to reproduce specific vertical structures of the top most ocean layer within different regions and seasons mapping modeled ocean temperature profiles onto the neuron space of the observationally defined self organized map highlights the potential of this method to advance our understanding of model deficiencies in that region keywords self organizing maps unsupervised neural network arctic ocean vertical temperature structures argo ctd data availability all argo ctd observations as well as the topaz model forecast data used in this study are accessible through the copernicus marine environmental monitoring service the topaz output products are available here https doi org 10 48670 moi 00001 and in situ observations argo and ctd are available here https doi org 10 48670 moi 00036 1 introduction in coupled ocean atmosphere model systems many challenges are connected to the accurate representation of the air sea heat momentum and mass fluxes cronin et al 2019 giorgi 2019 in order to advance simulations of the ocean atmosphere heat exchange accurately simulating the upper few hundred meters of the ocean water column is necessary due to its large impact on sea surface temperature variability and in turn the heat and moisture fluxes to the atmosphere d asaro 2014 thus not only sea surface temperature but also ocean subsurface observations are critical to understand coupled ocean atmosphere model characteristics the main observation source for upper ocean temperature is provided by autonomous floats of the argo program and ship based ctd measurements wong et al 2020 the spatio temporal patterns of those in situ observations are however highly irregular in space and time thus using observed profiles for model evaluation is difficult and further challenged by the issue of representativeness of a point observation versus a gridded model solution due to these inconsistencies model verification studies often use climatological products e g the world ocean atlas or ocean reanalysis products however in order to preserve the fine scale structure of upper ocean profiles which is crucial for the short term development of the sea surface temperature by vertical convective processes it would be preferable to not smooth out for example a sharp mixed layer which is presented in the raw data or other small spatial scale features such as eddies this is especially important and especially challenging within regions that contain complex ocean structures and multiple types of water masses with unique temperature characteristics utilizing an unsupervised categorization methodology in order to find systematic spatio temporal patterns between upper ocean temperature profiles has the potential to make additional use of the large amount of existing argo and ctd profiles jones et al 2019 sonnewald et al 2021 the self organizing map hereafter referred to as som kohonen 2001 is an unsupervised artificial neural network that is often used in meteorological and oceanographic applications liu and weisberg 2011 iskandar et al 2008 richardson et al 2003 liu et al 2016 to simplify and map highly complex spatio temporal data onto a simplified 2 dimensional space in the present study we apply som to a set of argo and ctd profiles of the upper 150 m for the region of the nordic and barents seas and show how this method can be complimentary to more traditional ocean model evaluation techniques to provide additional information on the accuracy of modeled vertical ocean temperature profiles this paper is organized as follows section 2 describes the data used section 3 describes the som methodology section 4 presents the results of the som analysis as well as the model evaluation while section 5 contains a discussion 2 data 2 1 observations we use a combination of in situ temperature observations primarily argo and ctd profiles between 2012 and 2020 obtained through the copernicus marine service monitoring service wong et al 2020 wehde et al 2021 we interpolate each temperature profile within the european arctic domain to vertical coordinates every 1 m and only keep data in the top 150 m of the water column profiles that either do not reach a depth of at least 150 m or do not contain temperature data in the top 10 m are ignored the resulting total number of observed temperature profiles used in this study equals 24 742 2 2 ocean model ocean model simulation output of the topaz4 model is used for comparison the topaz4 model is part of the copernicus marine environmental monitoring service cmems arctic marine forecasting center arc mfc which is a forecasting system producing daily 10 day ensemble forecasts sakov et al 2012 the forecasting system is based on the hybrid coordinate ocean model hycom coupled to a sea ice model with the sea ice thermodynamics and the elastic viscous plastic rheology described in hunke and dukowicz 1997 the weekly data assimilation system used in topaz4 is the ensemble kalman filter this is a multivariate assimilation technique that depends on the 100 member best estimate ensemble sakov et al 2012 a suite of 10 member 10 day forecasts is performed daily forced by the european centre for medium range weather forecasts ecmwf high resolution hres weather forecast model bauer et al 2013 topaz uses the turbulent mixing sub model from the goddard institute for space studies as described in canuto et al 2002 the native horizontal grid of the topaz model contains a resolution of approximately 12 16 km however output products are interpolated onto a grid with 12 5 km resolution the native vertical resolution of the topaz model uses 28 hybrid layers the hybrid layers are defined so that the minimum thickness of the top most layer is 3 m while the maximum thickness of other layers is 450 m the output products however are only archived for 12 vertical z layers sakov et al 2012 and melsom et al 2012 provide additional details about the native topaz model setup we use the daily ensemble mean topaz4 ocean temperature profiles for the year 2020 the topaz model simulations are accessible through the copernicus marine environmental monitoring service on a z level vertical grid with depths of 5 30 50 100 200 and 400 m in the upper ocean we interpolate all topaz temperature profiles at each spatial location for every day to 1 m depth intervals at spatial locations where temperature profiles are at least 200 m to ensure correct interpolation to a depth of 150 m each interpolated topaz profile is truncated at a depth of 150 m 3 self organizing map self organizing mapping is an unsupervised artificial neural network that is used for pattern recognition classification and clustering analysis kohonen 2001 it has been widely used in the context of meteorological and oceanographic observation and model analysis liu and weisberg 2011 liu et al 2016 landschützer et al 2013 2014 unsupervised machine learning algorithms including som are able to learn and adjust their own classifications based on the input data alone without any external or user input in order to learn without external input unsupervised algorithms assume that shared patterns exist within the input data this assumption is appropriate for our application since temperature profiles within a given region share many characteristics soms are defined as a 2 dimensional map comprised of neurons each neuron is defined with a neuron weight which are trained using a competitive learning algorithm this means as each piece of data in our case a piece of data is a single observed vertical temperature profile is input during the iterative training process there is only one winning neuron also referred to as the best matching unit hereafter referred to as the bmu to which that piece of data is assigned in other words only one neuron within the som can be activated during each iteration of the training process for each piece of input data the structure of the activated neuron is adjusted to closer match the new data assigned to it however it is possible to allow each activated neuron to also influence the structure of the neighboring neurons neurons in a som are therefore more similar to their neighboring neurons than they are to neurons located farther away in the 2 d som space this competitive learning process and neighborhood influence leads to the neurons within the som organizing themselves 3 1 defining the som before training the som to the observational temperature data the spatial structure of the 2 dimensional som space must be defined in most cases the best results occur when the physical space of the observations is similar in shape to that of the som since our arctic domain is approximately square the best results occur from a som also containing a square shape increasing the total number of neurons in the som generally results in a better fit meaning each individual temperature profile better matches their assigned neurons however using too many neurons does not sufficiently reduce the data to provide useful information about the characteristics of the data on the other hand defining a som with very few neurons generally results in a poor fit between any given profile and its assigned neuron weight we use the som quantization error q error to determine the fit of a data set to the trained som weights the q error is calculated as the mean euclidean distance between the data and neuron weights where smaller q error values indicate stronger fit of the data to the neuron weight the euclidean distance in units k between any two temperature profiles such as an observation and a neuron weight is calculated as follows 1 d i 0 d m a x t i a t i b 2 where d is the euclidean distance d m a x is 150 m the maximum depth of the profiles and t i a and t i b are the temperatures of profiles a and b respectively at a depth of i m although the size of the som is ultimately selected by the user a suite of sensitivity studies testing multiple som sizes results shown in fig 1 helps determine an appropriate size fig 1 shows the q error is relatively constant at large som sizes in other words small som sizes result in large errors due to inadequate separation between profile types however very large som sizes are not useful either as they do not strongly improve the q error nor sufficiently reduce the dimensionality of complex data fig 1 shows a som with the size of 6 6 neurons for a total of 36 neurons results in a low q error meaning the raw data agrees well with the learned neuron weights this size both simplifies the complexity of the original data while adequately separating unique vertical temperature structures which is important for classification and model evaluation the q error of the 6 6 som trained to the observation temperature data is 5 75 k fig 1 3 2 training the som the first step of training the som is initializing each neuron weight we initialize the weights using a randomly selected observed temperature profile from the data set the som is then trained on the observed temperature profiles through an iterative process one randomly selected temperature profile from the data set is input at a time and the som algorithm determines which neuron weight it best matches the winning neuron or best matching unit bmu is determined by minimizing the euclidean distance between the observation and the neuron weight see eq 1 the structure of the bmu weight is then adjusted toward the structure of the new data assigned to it during the training of the som we allow the winning neurons to weakly influence the structure of their neighbors this results in the som organizing itself so that neurons will share similar characteristics to their neighbors the neighborhood function of the som defines how the winning neurons influence their neighbors we define the neighborhood function to be gaussian in space with a sigma value of 1 25 the training process also depends on a learning rate parameter and the total number of iterations the 6 6 som in this study is trained using a learning rate of 7 and 20 000 iterations several sensitivity tests not shown determined the structures of the som neuron weights are not sensitive to adjustments in the learning rate or the number of iterations used assuming the number of iterations used to train the som is appropriate for the size of the input data set we found that for our data set containing approximately 24 000 temperature profiles values between 10 000 iterations and 20 000 iterations in the training process had a negligible impact on the results as previously mentioned in section 3 1 the q error which estimates the fit of the data to the som weights is strongly influenced by the som size used however the structures identified within a given som size are robust in other words re training a 6 6 som on the observational temperature data consistently produces similar temperature structures although the location of any given structures within the 6 6 som space changes we have high confidence in the ability of the som temperature classifications due to the robustness of temperature structures that result 4 results 4 1 the study region nordic and barents seas our study region is a part of the european arctic including the greenland sea lofoten basin and barents sea fig 2 the norwegian meteorological institute operates a convective scale weather forecasting system müller et al 2017 for this region with future endeavors to couple the atmospheric system to more realistic representations of ocean sea ice and wave dynamics batrak and müller 2018 2019 thomas et al 2021b the upper ocean in this area is characterized by cold polar water masses from the north and the intrusion of warm atlantic waters with its origin in the north atlantic current nac rossby 1996 the boundary between the north atlantic water mass and the arctic water mass containing large gradients in temperature and salinity is called the arctic front swift and aagaard 1981 raj et al 2019 the inflow of relatively warm atlantic water into the frontal region is through two nac branches first the norwegian atlantic slope current nwasc following the norwegian shelf edge as a barotropic slope current skagseth et al 2004 and second the norwegian atlantic front current nwafc flowing as a topography guided front current along the ridges dividing the norwegian lofoten and greenland basins mork and skagseth 2010 the nwasc further branches into a northward current towards the western side of the svalbard archipelago west spitsbergen current wsc and into the barents sea though the barents sea opening helland hansen and nansen 1909 aagaard et al 1985 the spatial characteristics of the sea surface temperature sst in this area reflect the northward flowing warm atlantic waters from the nwasc and nwafc areas of seasonal sea ice and the arctic front fig 3 again the arctic front is characterized as the boundary between warm atlantic water and arctic water which is most easily discussed through the behavior of the nwasc nwafc and wsc as seen in fig 2 the sst varies seasonally in all regions and a warm surface layer develops during summer in particular strong vertical temperature contrasts develop seasonally in basins which are not strongly influenced by the nwasc and nwafc for example the greenland basin or eastern barents sea raj et al 2019 4 2 observed structures in the following we highlight the potential of the som methods to reveal insights into the vertical structure of the upper o 100 m of the ocean which can be further used for evaluation purposes of gridded subsurface temperature products we will first show the spatial and temporal patterns resulting from the som as applied to in situ ocean temperature observations we note that we only characterize upper ocean temperature profiles herein thus the results and discussion below only characterize the vertical thermal stratification in the top 150 m of the water column and not the true stability of the water column as we do not include salinity in this analysis fig 4 shows the result of the som as applied to the observed temperature profiles the som learned profiles that define each neuron numbered 1 36 also referred to as the neuron weights are plotted with the thick black lines the neuron weights represent the different types of temperature profiles observed in our region the thin colored lines show each individual in situ temperature profile sorted according to their best matching unit again the bmu is determined by minimizing the euclidean distance between the observed profile and the neuron weight the structure of the 6 6 map of neurons can be summarized as follows see also schematic in fig 5 the upper left neuron 1 is characterized by a cold surface layer which deepens and becomes colder towards the right moving from neuron 1 across the row towards neuron 6 neuron 3 is unique in this series and contains a very distinct thin cold surface layer in the top 20 m this top row represents temperature profiles that are non thermally stratified the neurons in the second and third rows neurons 7 to 18 contain temperature profiles roughly described as well mixed similar to row 1 these well mixed profiles become colder towards the right decreasing from approximately 5 c to 0 c the bottom three rows neurons 19 to 36 contain profiles with stable thermal stratification temperature decreases with increasing depth these profiles typically become warmer as you move down through the rows and increase in thermal stratification as you move downward and towards the right neuron 36 in the lower right corner of the som contains profiles that exhibit a relatively warm surface layer a distinct thermocline at a depth of approximately 40 m and relatively cold water below the thermocline the boreal winter djf and summer jja distribution of observations sorted according to their bmu are shown in supplemental figures s2 and s3 respectively supplemental figure s2 shows that wintertime observations are clustered in the neurons located in the top left corner of the som space indicating wintertime profiles in this region are dominated by non thermally stratified and well mixed temperature profiles the summer observations contain larger spread in temperature characteristics and thus are distributed across a larger number of neurons than the winter profiles furthermore the summer profiles contain thermally stratified profiles seen in the bottom left corner of the som structures that are not observed during winter months the color scheme shown in fig 4 is specifically designed to be a two dimensional color gradient that visually represents similar characteristics shared between neighboring neurons this color scheme which represents profile similarities is useful in spatial plots of the bmu in the following discussion we ask readers to refer to the neuron color scheme as defined in fig 4 fig 6 shows the spatial distribution of observed temperature profiles for each season djf mam jja son the color of each observation is based on the profile s bmu as defined in fig 4 fig 6 shows strong spatial and temporal patterns in the observed temperature profile characteristics captured by the som technique temperature profiles north of 80n in every season are dominated by characteristics of very cold sst and upper ocean temperatures and contain increasing temperatures with depth these characteristics occur primarily in the magenta colored neurons i e neurons 4 6 see fig 4 during djf and mam fig 6 shows the greenland basin refer to fig 2 for the location is dominated by cold temperature profiles as seen by the magenta and dark orange colored neurons for example neurons 11 12 17 and 18 these temperature profiles are either thermally non stratified or are cold and well mixed to a depth of 150 m specifically these profiles are characterized by surface temperatures slightly above 0 c while the waters below 50 m are very close to 0 c during jja and son however the greenland basin typically contains profiles with high thermal stratification characterized by light orange and yellow colored neurons such as neurons 24 30 or 36 the upper ocean in this region during the summer and fall contains relatively warm with respect to the wintertime sst in the same region shallow surface layers with depths of approximately 25 m that contain temperatures of approximately 5 c the water temperature below the shallow surface layer is similar in structure and temperature as observed in the winter months characterized by cold temperatures of approximately 0 c the lofoten basin again for the location refer to fig 2 is dominated by profiles containing much warmer ocean temperatures throughout the upper 150 m during all seasons than observed in the greenland basin fig 6 during djf the ocean temperature structure is characterized by well mixed profiles to a depth of 150 m and contains temperatures approximately 5 c these profiles are characterized by for example neurons 7 8 13 and 14 during jja however the lofoten basin contains temperature profiles with slight temperature stratification that the som categorizes as for example neurons 25 26 and 31 33 colored in royal blue and blue gray these stratified profiles contain warmer sst than the corresponding winter profiles all the profiles in the lofoten basin regardless of the season share a key characteristic relatively warm temperatures between 50 150 m that remains above 5 c all year as opposed to the profiles in the greenland basin which contain very cold waters close to 0 c at depths below 50 m the spatial and temporal patterns of observed ocean temperatures captured by the som shown in fig 6 correctly identify several key oceanographic characteristics of this region the som captures the relatively warm norwegian atlantic current flowing into the region from the south a portion of which continues as the west spitsbergen current flowing northwards on the western side of svalbard som clearly identifies a distinct separation between the upper ocean temperature characteristics seen in greenland basin versus the lofoten basin additionally this technique captures the seasonal surface warming throughout the domain during the summer months as well as the persistent cold subsurface temperatures in the greenland basin the som technique described above is thus capable of identifying observed characteristics of upper ocean temperature structure in the european arctic furthermore som simplifies a potentially complex analysis by clustering vertical temperature profiles with similar characteristics together into neurons essentially reducing the complexity of the original data in the following section we show how the observationally based neuron weights can be leveraged to provide useful information to analyze the spatial and temporal characteristics of gridded ocean products for example from an ocean model 4 3 model evaluation this section presents the results comparing the upper ocean temperature simulated by the topaz model against observations rather than performing temporal or spatial averaging on the observations which smooths out important fine scale spatio temporal characteristics we leverage the observation based som presented in the previous section we note the purpose of this section is not to provide a robust evaluation of the topaz model performance in the european arctic but rather we use the topaz model to highlight additional insights of using som which are complimentary to more traditional model evaluation techniques while using the som neuron weights alone for evaluation may not be sufficient since they only show dominant profile characteristics smoothing out small scale features fig 4 as well as supplemental figures s2 and s3 also show the raw observations providing an estimate of the observed variability for any given neuron we use these figures to analyze the topaz model s ability to represent the fine scale patterns of variability seen in observations we first plot all djf and jja topaz temperature profiles sorted according to the profile s bmu fig 7 shows the djf profiles while fig 8 shows the jja profiles the bmu of each topaz profile is determined by the minimum euclidean distance between the topaz temperature profile and each som neuron weight as in fig 4 the som neuron weights are shown in the thick black lines in each figure the most striking feature of the djf and jja topaz profiles seen in figs 7 and 8 is the coarse vertical resolution of the model data to quantify how well the topaz model data fits the observed neuron weights we calculate the q error for each season for both observations and topaz data table 1 shows the topaz model contains larger q errors than the observations for every season unsurprisingly this indicates the coarse vertical resolution topaz data fits the neuron weights slightly worse than the observations do the coarse vertical resolution and spatial smoothness of the model results in a loss of small scale variability thus the topaz data poorly captures the small scale vertical features observed such as the exact depth and temperature gradient of thermocline additionally topaz shows much greater variability in the sst for many neurons especially neurons with thermal stratification this large spread in sst can be seen for example in neurons 18 24 30 and 36 to determine specific instances where the topaz model may be under performing we compare seasonal temperature profiles plotted in som space supplemental figures s2 and s3 are identical to fig 4 however only contain djf or jja observations respectively plotted according to their bmu comparing supplemental figures s2 and s3 against figs 7 and 8 we can determine which observed temperature structures topaz captures poorly in both djf and jja topaz generally reproduces the non stratified and well mixed profiles well one exception to this is neuron 3 where topaz systematically fails to generate the thin cold surface layer seen in observations just north of the svalbard archipelago another example of profile structures that are poorly represented in topaz are the strongly stratified profiles observed in jja i e neurons 30 and 36 topaz poorly represents the depth and gradient of the thermocline in these structures lastly topaz overestimates the sst in many of the thermally stratified neurons during jja next we analyze how topaz reproduces the observed spatial patterns of the profile types during each season similar to fig 6 fig 9 shows the spatial distribution of the neurons classified by topaz for each season djf mam jja and son since we use ensemble mean daily topaz data in order to retain high frequency temporal variability we determine topaz model bmu for each day at every grid cell fig 9 plots the bmu that occurs most often at every spatial point in each season i e the colors represent the bmu mode for the season overall topaz captures the general spatial distribution of the profiles well similar to observations topaz contains very cold well mixed profiles north of 80n additionally it captures a general difference of profile characteristics between profiles in the greenland basin versus the lofoten basin in topaz similar to observations the greenland basin is generally dominated by non thermally stratified or cold well mixed temperature profiles in djf and mam while more thermally stratified profile types occur during jja and son as observed in the lofoten basin topaz also contains profiles that are well mixed or thermally stratified lastly topaz captures the observed seasonal warming patterns observed which are particularly apparent in the lofoten basin where the top most ocean layer temperatures of the stratified profiles are warmer in jja and son than the temperatures captured in djf and mam although topaz captures some of the observed large scale temperature patterns fig 9 also shows that topaz fails to capture several key observed upper ocean temperature characteristics for example topaz does not capture the distinct separation of temperature characteristics between in the greenland basin and lofoten basin profiles instead topaz contains a gentle gradient of profile characteristics between these two regions additionally topaz poorly captures the ocean structures observed in the west spitsbergen current along the west coast of svalbard observations show the profiles in the west spitsbergen current are dominated by either relatively warm well mixed profiles or slightly stable profiles topaz however fails to capture these profile characteristics in every season with the worst representation occurring during jja where the temperature structures in topaz contain too much vertical temperature stratification 5 discussion a thorough understanding of the observed upper ocean temperature patterns especially in high latitude regions is critical to accurately model the upper ocean the accuracy of simulated upper ocean temperatures directly impacts the accuracy of modeled upper ocean mixing and surface heat fluxes thus accurately simulating the upper ocean has large implications on the accuracy of coupled arctic weather forecasts which are becoming increasingly critical as ship traffic in the arctic due to industry and tourism is increasing and will continue to increase in the future hall and saarinen 2010 smith and stephenson 2013 stocker et al 2020 unfortunately many ocean models and gridded ocean temperature products are either spatially smooth in the horizontal temporally smooth such as climatology products and or have relatively coarse vertical resolution such as the archived output from the topaz ocean model these characteristics increase the difficulty of regional model evaluation since gridded products typically under represent the observed spatial and temporal variability in the upper ocean in this study we use a machine learning technique called self organizing maps which has great potential in earth and climate sciences kohonen 2001 liu and weisberg 2011 landschützer et al 2013 2014 the use of som and other unsupervised machine learning approaches are becoming increasingly common in oceanography and have many possible applications in observational and model analysis liu and weisberg 2011 liu et al 2016 jones et al 2019 rosso et al 2020 sonnewald et al 2021 boehme and rosso 2021 for example lu et al 2019 use unsupervised clustering and a neural network to estimate subsurface temperature anomalies from surface data we show that som analysis not only improves understanding of observed patterns but also can be leveraged to aid in the evaluation of a regional model to highlight the benefits of som in model evaluation we train the som against argo and ctd temperature profiles the som an unsupervised neural network algorithm is able to classify or group similar ocean temperature profiles together the som analysis highlights observed spatio temporal patterns within the upper ocean temperature we then leverage the learned vertical temperature structures as determined by the som algorithm in order to validate the topaz ocean model the som technique better retains small scale features seen in observations which are often lost due to spatial and temporal smoothing when validating model performance against gridded reanalysis or climatology products we show the topaz ocean model captures the general spatial and temporal distribution of observed upper ocean characteristics however the som technique highlights several instances where the topaz model contains critical deficiencies that would benefit from further improvement in particular the som technique captures instances where the topaz ocean model is unable to reproduce the spatial variability and upper ocean temperature features seen in observations most notably topaz fails to capture the distinct separation of profile structures between the greenland basin and lofoten basin in all four seasons additionally the som technique highlights how topaz fails to simulate the observed upper ocean structures in the west spitsbergen current observations show the west spitsbergen current should be a tightly confined region with profiles closely representing the characteristics observed in the lofoten basin extending northward into the arctic ocean along the west and north sides of the svalbard archipelago topaz on the other hand shows the west spitsbergen current contains characteristics of temperature profiles observed in the greenland basin while the lofoten basin like temperature structures do not extend far enough north additionally the current within topaz appears overly diffuse covering a larger region than observed on the west side of svalbard more generally many structures simulated in topaz especially in jja contain too much thermal stratification and subsurface water temperatures below 50 m depth that are too cold furthermore topaz struggles to capture the depth and temperature gradient of the observed thermocline not only in the west spitsbergen current where topaz performance is generally poor but throughout the domain this is especially true during summer months where warm sst is more prevalent the poorly simulated thermocline structure within our domain appears to be intricately linked to the coarse vertical resolution archived from the topaz model forecasts the native vertical resolution of the topaz model uses 28 hybrid layers but the topaz output products are only archived at 12 vertical levels this suggests there is a need not only for archiving more vertical levels from the topaz ocean model to improve our understanding of the model deficiencies but also for maintaining a minimum vertical resolution in the upper ocean within other ocean models used for arctic forecasting purposes this will become increasingly important as fully coupled forecasting systems become more prevalent in the arctic region failing to simulate the observed upper ocean temperature characteristics in the arctic could have serious implications on the accuracy of short term forecasts not capturing the observed thermocline structures suggests the model will likely also contain problems in simulating upper ocean mixing and surface heat fluxes the som analysis showed the topaz upper ocean stratification performs the worst in the boundary between the greenland and lofoten basins as well as in the west spitsbergen current the incorrect upper ocean temperature structures and the spatially diffuse nature of the simulated west spitsbergen current in topaz could also impact the model s ability to simulate the correct sea ice behavior such as melting and freeze rates in this region however further analysis is needed to determine the exact relationship between the modeled topaz upper ocean temperatures and any direct impacts on the ocean mixing surface heat fluxes or sea ice behavior we recognize that the topaz ocean model forecasting product contains data assimilation of argo and ctd temperature data thus the topaz forecast data used is not purely independent from the observations used to train the som in this analysis however we would like to mention the purpose of this study was not to perform a robust evaluation of the topaz model against independent observations but rather to highlight an underutilized machine learning technique that has great potential in oceanography and earth sciences in this study we highlight one potential application of som to the evaluation of gridded ocean products we initially tested the som technique using normalized temperature profiles however the observed separation in som space between the greenland and lofoten basin profiles is much less distinct when using normalized temperature profiles in other words the som is unable to clearly categorize profiles in our region when using normalized temperature profiles non normalized temperature profiles provide clean spatial and temporal separation between various oceanographic features thus allowing the best assessment of model performance however we expect many applications of self organizing maps in earth sciences and oceanography would benefit more from the use of normalized data one future effort utilizing normalized data will be to expand this analysis to multivariate data such as integrating salinity into the som analysis although salinity profiles are neglected in the present study they will be included in future efforts in order to analyze the density structure and vertical stability of this region similar to the gaussian mixture modeling technique used by thomas et al 2021a a multivariate approach may also help classify oceanographic features identifiable through salinity or density characteristics as opposed to temperature characteristics alone one benefit of som and other common unsupervised clustering techniques such as k means clustering over supervised machine learning techniques is requiring no user input during the training process this allows the model itself to identify and isolate characteristics and patterns within complex non linear data sets one difference between som and k means clustering is the self organizing nature of the neurons in som k means clustering contains exclusive partitioning where each piece of data can only belong to one neuron or cluster within a pre defined number of clusters while som also contains exclusive partitioning the som training process allows the structure of each neuron to influence the structures of the neighboring neurons therefore neighboring neurons in the som share common features which helps when identifying large scale spatial and temporal patterns and shared characteristics within the data without requiring the data to exist within the exact same cluster or neuron this self organization of the clusters and shared features between neighboring neurons made som an appropriate choice for our purpose of quickly identifying spatial and temporal patterns in observations and model data containing large variability such as upper ocean temperatures in the arctic one significant caveat of som and machine learning techniques in general is the inability of the algorithm to learn when large gaps in the training data exist the types of temperature structures identified by som the neuron weights are limited by the available observations used to train the neural network for example the eastern barents sea region is under sampled in every season if unique temperature structures exist in this poorly sampled region and are not represented in the training data set som is unable to identify and categorize these types of profile structures like all model evaluation techniques model evaluation with som is particularly challenging and results in larger uncertainties in regions with poor observational coverage another limitation of som is the sensitivity to the number of neurons used using too many neurons does not generate useful distinct clusters and provides little useful information about characteristics within the data on the other hand too few neurons results in a poor fit between the data and its assigned neuron weight this is due to overly large volumes of data assigned to any given neuron which smooths distinctive structures of the neuron weights it is worth noting that k means clustering also suffers from this limitation unsupervised machine learning techniques like self organizing maps have great potential in future oceanography and earth science research som can provide additional beneficial knowledge when used in combination with other evaluation techniques of modeled subsurface ocean temperature the som technique presented here is able to classify upper ocean temperature characteristics while retaining some of the observed small scale variability that is typically lost when validating models against reanalysis data sets which highlights instances where ocean models under represent observations in order to continue improving model representation of upper ocean temperature variability and the accuracy of coupled forecasting systems the results shown here indicate continued need for ocean model development advances in data assimilation of ocean observations into ocean models and increased observational coverage in the arctic credit authorship contribution statement erin e thomas conceptualization methodology investigation formal analysis visualization writing original draft malte müller formal analysis visualization writing review editing declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments financial support for this work was provided by the norwegian research council under the nansen legacy nfr 276730 and focus nfr 301450 projects appendix a supplementary data supplementary material related to this article can be found online at https doi org 10 1016 j ocemod 2022 102092 appendix a supplementary data the following is the supplementary material related to this article mmc s1 supplemental material contains supplemental figures showing djf and jja observations plotted according to their bmu 
23828,in this work the four dimensional variational 4d var data assimilation da of the regional ocean modelling system roms is applied in the east china sea ecs the unique capability of optimizing the initial condition ic boundary condition bc and surface forcing fc in roms 4d var facilitate the simulation of dynamical processes associated with both local and remote forcing the assimilated data in this study include sea surface temperature sst sea surface height ssh in situ temperature and salinity profiles as well as surface drifters and a surface ocean current analysis oscar overall 4d var performs well in reducing model data misfit for all observation types as tidal forcing plays important roles in the shelf circulations of the ecs tidal forcing was included in 4d var and its impact was evaluated by comparing two experiments with and without tides the biases of sst in da analyses are small on the continental shelf in both experiments however compared with experiments with tides the absence of tidal forcing will make temperature higher near the surface layer and lower below mixed layer in the background simulation 3 day forecast using da analyses as ic in the warm season of 2014 the difference in temperature profile is associated with two factors stratification and tidal mixing the relative importance of the two factors varies with depth with the aid of the adjoint model the impacts on the kuroshio volume transport kvt and the kuroshio onshore intrusion koi contributed by different types of observations are evaluated as well as the contributions of ic bc and fc ssh sst and in situ temperatures have large total impacts while in situ temperatures have the largest impact per datum the geographical distributions of observation impacts are similar for different observation types large observation impacts extend along the kuroshio path from the northeast of taiwan to the southwest of japan several factors control the geographical distribution which include the model forecast skills the dynamic processes that are responsible for the transferring of assimilated information and the specified error covariance tracking how the assimilated information propagate in space helps to advance the understanding of the dynamics of kvt and koi keywords 4d var tidal forcing the east china sea observation impact kuroshio transport kuroshio onshore intrusion 1 introduction the east china sea ecs is a marginal sea influenced by complex dynamic processes the taiwan warm current the yellow sea coastal current the discharging of yangtze river and the kuroshio intrusion su et al 1994 yang et al 2011 hu and wang 2016 besides the ecs is well known for its strong tidal forcing which modulates the vertical temperature structure and circulations in this region qiao et al 2006 lü et al 2007 moon et al 2009 the tidal residual flow plays important roles in coastal flows and tidal mixing can induce tidal mixing fronts leading to upwelling and surface cold patches lü et al 2010 wu et al 2018 the complicated dynamics of the ecs brings challenges to modelling of this region the kuroshio current significantly regulates the regional ocean environment and global climate nakamura et al 2004 hu et al 2015 and it controls the water and heat exchanges of the ecs with the open ocean yang et al 2011 therefore it is crucial to reproduce the variability of kuroshio when modelling the dynamics of the ecs the variability of the kuroshio volume transport kvt has been widely investigated with observations and ocean models chang and oey 2011 shen et al 2014 andres et al 2017 as the western boundary current of the north pacific subtropical gyre the large scale kvt is mainly controlled by basin scale wind stress curls pedlosky 1987 and thus remote forcings matter more than local effects for the large scale variation of kvt as a result for a regional ocean model to reproduce kvt variability it is critical to impose accurate boundary conditions which is very challenging for regional ocean models yang et al 2011 on intraseasonal or shorter time scales the kvt is modulated by the impingement of westward propagating mesoscale eddies tsai et al 2015 yan et al 2016 jan et al 2017 kamidaira et al 2017 chang et al 2018 most of the mesoscale eddies originate in the north pacific subtropical countercurrent stcc see fig 1 region due to baroclinic instability qiu and chen 2010b and these eddies frequently impinge on the kuroshio current when they moving westward directly changing the kvt due to the mesoscale instability processes ocean models cannot predict the accurate time and location of mesoscale eddies without da kerry et al 2018 therefore it is essential to combine observations with model dynamics when predicting intraseasonal variations in kvt kuroshio onshore intrusion koi to the continental shelf plays an important role in ocean circulations in the ecs and is an important nutrient source in coastal regions yang et al 2013 most koi takes place near the shelf break northeast of taiwan guo et al 2006 wu et al 2014 yang et al 2018 yang et al 2018 proposed a topography beta spiral theory showing that the intrusion flow rotates counterclockwise from the sea surface down to the bottom blue arrows in fig 1 therefore it is the bottom flow that intrudes onshore and reaches the zhejiang coast using a nested ocean model guo et al 2006 found that the variation in koi is controlled by ekman transport and changes in the density field koi is also found to be affected by kvt on an interannual scale liu et al 2014 yin et al 2017 reported that koi is modulated by mesoscale eddies impinging on the kuroshio current as well in summary the koi is controlled by both remote and local forcings and its complicated dynamics need to be studied with both observations and ocean models data assimilation da is a common method that combines observations and model dynamics to obtain better state estimates in a least square sense kalnay 2003 in recent years the development of the regional ocean modelling system roms four dimensional variational data assimilation 4d var system has enabled adjustments of the model initial condition ic boundary condition bc and surface forcing fc towards observations using the state of the art variational da technique moore et al 2011b a the important capability of adjusting surface forcing and boundary conditions will facilitate the simulation of phenomena associated with both local and remote forcings an important feature of 4d var is that it can assimilate observations at a finite time window while studies of three dimensional da method usually used the first guess at appropriate time fgat method and put observations at a single time huang et al 2002 therefore 4d var shows advantage when assimilating observations that vary both in space and time such as argo and glider observations besides as introduced above tidal forcing plays important roles in the shelf circulations of the ecs so including tidal forcing in da system is essential when modelling the dynamics of the ecs however da in a tide driven eddy resolving model is challenging because the time and length scales of tides and mesoscale variability are different and require different corrections using the ensemble optimal interpolation enoi method xie et al 2011 had to filter out tides before da and only included tides in the forecast between da cycles however this method might introduce errors when filtering out tides and tides and mesoscale flows may not be fully coupled in their method in spite of the disadvantages their results showed improvements in experiments with tides several studies have proved the feasibility of including tide forcing in roms 4d var and the feature of 4d var allows fully coupled tides and mesoscale flows within the da window matthews et al 2012 janeković et al 2013 wilkin et al 2018 levin et al 2019 in their work da was used to adjust mesoscale variability and leave tidal signals unchanged to achieve this goal they filtered out the tide signal of observations and then added the model predicated tides to observations as a result tidal signals were identical in observations and model so tides were not considered in da in this work similar method was used to modelling tides in 4d var in ecs despite the advantage of roms 4d var application in the ecs is rare and no study has investigated the impact of tidal forcing in 4d var in this region this work aims to investigate how 4d var impacts the modelling of the ecs dynamics particularly with tide one way to achieve this goal is by comparing model results before and after da with observations the main source of errors can be identified in this process which can help us understand the model performance limitation and how 4d var adjust the model towards observation another way to quantify the impact of 4d var is to calculate the observation impact on certain circulation metrics with the aid of adjoint model moore et al 2011c this method can quantify how each observation affects certain ocean circulation metrics through adjustments of ic bc and fc which may indicate the relative importance of local and remote forcing in addition by integrating backward the adjoint model can provide the information of how the assimilated information propagate in space these information may advance our understanding of ocean dynamics associated with the ocean circulation metrics veneziani et al 2009 masuda et al 2010 levin et al 2019 the goal of this work is to investigate how 4d var could impact the modelling of the ecs dynamics the first step is to evaluate the improvement after da by comparing with observations then the observation impacts on kvt and koi are quantified with the aid of adjoint model starting from jan 2014 the da simulation spanned the whole year of 2014 the remainder of the paper is organized as follows section 2 describes the model configuration assimilated data and observation impact method used in this work section 3 shows impact of 4d var on model skills in the ecs section 4 discusses the impact of including tidal forcing in 4d var based on the comparison between da experiments with and without tides section 5 shows the results of observation impact on kvt and koi and an interpretation of the spatial distribution of observation impact is also shown a brief summary is given in section 6 2 model configuration data and method the model used in this study is roms http www myroms org which is a free surface split explicit terrain following ocean model shchepetkin and mcwilliams 2005 before running 4d var a free run without da is needed to provide the model standard deviation statistics to construct model background error covariance moore et al 2011a the free run model and 4d var configurations are listed below followed by the introduction of the observation impact method 2 1 free run model configuration the model domain is shown in fig 1 with a horizontal resolution of 1 12 1 12 cos φ 8 km where φ is latitude and 26 terrain following levels the model grid setting is the same as nest2 in yang et al 2011 the ic and bc were linearly interpolated from the hybrid coordinate ocean model hycom 1 12 global analysis https www hycom org the advection schemes used in this work were the third order upstream biased horizontal advection scheme and the fourth order centred differences vertical advection scheme the boundary conditions were set to chapman condition for the free surface chapman 1985 flather condition for the 2d momentum and clamped condition for the 3d momentum temperature and salinity marchesiello et al 2001 to reduce noise near the boundary sponge layers with widths of approximately 100 km were set where the viscosity and diffusion coefficients increased from 4 m 2 s 1 inside the domain to 400 m 2 s 1 at the boundary following neveu et al 2016 the model was also forced with 8 primary tidal constitutes m 2 s 2 n 2 k 2 k 1 o 1 p 1 q 1 from the topex poseidon tidal product tpxo 7 2 egbert et al 1994 the daily averaged surface forcing fields including wind at 10 m temperature and humidity at 2 m longwave and shortwave radiation fluxes rain and sst were extracted from the era5 global reanalysis product hersbach et al 2020 the sst data extracted from era5 product were used in a surface heat flux correction scheme barnier et al 1995 the wind stress was calculated using the bulk flux scheme liu et al 1979 fairall et al 1996b a the mellor and yamada level 2 5 closure scheme mellor and yamada 1982 and quadratic bottom drag were used in this work the daily river discharge of the yangtze river was added to the model using the daily river runoff data obtained from the yangtze river water resource bureau http www cjh com cn index html the monthly discharges of other major rivers the yellow river the huai river and the qiantang river around the east china sea were obtained from the river discharge dataset of dai 2017 which is an updated version of dai et al 2009 a weak surface salt flux correction was used to restore the sea surface salinity to climatology the surface salinity climatology was obtained from the world ocean atlas woa dataset boyer et al 2018 the 10 year free run spans from jan 2010 to december 2019 and the results of 2014 will be compared with the da analysis in section 3 2 2 configuration of 4d var as an advanced da system roms 4d var has prevalent usage in ocean research around the world powell et al 2008 li et al 2015 da rocha fragoso et al 2016 janeković et al 2020 here only a brief introduction to 4d var will be given for a more detailed description please refer to moore et al 2011a b details of 4d var configurations are also introduced below the configurations of nonlinear model in 4d var algorithm are the same as those in the free run given a model background first guess model state roms 4d var seeks to minimize the cost function which includes changes in model background j b and model data discrepancy j o 1 j δ z j b j o 1 2 δ z t d 1 δ z 1 2 g δ z d t r 1 g δ z d where δ z is the control vector which includes increments to model ic bc and fc within the da window moore et al 2011a d and r are the background and observation error covariance matrix respectively d y o h x b is the innovation vector representing the difference between observations and model value at observation locations h is the observation operator that maps the background model state variable x b to the observation location g is the tangent linear model sampled at observation locations g and h are connected by the relation 2 h δ x t i h m t i t 0 δ z g δ z where δ x t i is the model state increments at time t i which can be obtained by integrating tangent linear model δ x t i m t i t 0 δ x t 0 m t i t 0 is an alternative form of tangent linear operator moore et al 2011a the solution of minimization of 1 can be expressed as follows 3 δ z a z a z b kd where k is the kalman gain matrix which can be expressed as follows 4 k d g t g d g t r 1 roms 4d var uses tangent linear and adjoint models in the iteration to minimize the cost function inner loops with the nonlinear trajectories updated periodically outer loops after some experiments it was found that 1 outer loop and 20 inner loops are sufficient to reduce the cost function with affordable computational cost the length of the da window was set to 3 days following weaver and courtier 2001 the background model covariance in roms 4d var is factorized as follows 5 d k b σ c σ t k b t where k b is the multivariate balance operator which uses hydrostatic and geostrophic balance to constrain different model variables in this work due to the rough topography the balance operator was disabled because the tangent linear model and adjoint model enable the transfer of information between variables through model dynamics disabling the usage of k b would not destroy the solutions σ is the standard deviation matrix which was calculated using the free run model results introduced in section 2 1 σ was calculated based on monthly statistics so it includes seasonal variation c is the univariate correlation matrix and can be separated as horizontal and vertical correlation functions weaver and courtier 2001 the horizontal decorrelation scale for the ic was set to 50 km which was set based on the averaged rossby deformation scale in the domain chelton et al 1998 the vertical decorrelation scale for the ic was 10 m which was set according to the shortest vertical decorrelation length scale estimated over the whole model domain this is because an overestimation of vertical decorrelation length scale in areas with strong stratification would lead to unphysical subsurface temperature profile levin et al 2019 especially in the yellow sea in warm seasons where the stratification is strong due to the yellow sea cold water mass yscwm zhang et al 2008 lü et al 2010 with the small vertical decorrelation scale the tangent linear and adjoint model would play an important role in propagating error information vertically the horizontal decorrelation scales for the bc and fc were 100 km 2 3 assimilated observation the assimilated observation data are listed below as roms 4d var is unable to handle observations near the boundary observations less than 100 km from the boundary were excluded from da matthews et al 2012 sea surface temperature sst a daily gridded 0 25 0 25 blended product of satellite and in situ observations from the national oceanic and atmospheric administration noaa reynolds et al 2007 data sources include the advanced very high resolution radiometer avhrr ship observations and buoys due to data uncertainty sst observations that were less than 100 km from the coast were excluded from da ssh along track observations from multiple satellites were obtained from archiving validation and interpretation of satellite oceanographic aviso data supported by the centre national d etudes spatiales cnes the resolution of the along track data is about 7 km ssh data need to be corrected to ensure that the model and observations had the same reference sea level before assimilation powell et al 2008 besides as roms uses boussinesq approximation it cannot resolve sea level variation due to steric effects researches have revealed that the steric effects can be corrected with a spatial uniform time dependent η e t in a boussinesq ocean model greatbatch 1994 mellor and ezer 1995 griffies et al 2014 in a global model the steric height can be diagnosed from model output but in a regional model it has to be removed from the observations in this work the steric effects were diagnosed from the global hycom reanalysis storto et al 2019 and removed from observations sea level variation due to fresh water fluxes was diagnosed from era5 data and was neglected due to its small magnitude 10 4cm to correct the ssh data to model reference sea level the long term model mean dynamic topography mdt were calculated from the 10 year free run output and then the aviso sea level anomaly sla data with steric effects removed were added to the model mdt and the results plus appropriate tidal elevation were assimilated into the model to avoid adjusting tidal elevation predicted tides from harmonic analysis of model tides were added to the observations so that tidal signals need not be considered in da matthews et al 2012 janeković et al 2013 wilkin et al 2018 levin et al 2019 as ssh data in shallow water are known to be unreliable ssh observations that were less than 100 km from the coast and that were taken over water depths less than 150 m were excluded from da yuan et al 2007 hao et al 2021 currently roms 4d var has no time correlation in the observation error covariance as a result the assimilation of along track ssh data would excite gravity waves unless the observations persist with time to deal with this problem following matthews et al 2012 ssh observations at t 0 were replicated to t 0 6 t 0 4 t 0 2 t 0 2 t 0 4 and t 0 6 h with appropriate tidal elevations to suppress spurious gravity waves en4 a temperature and salinity profile dataset obtained from the met office hadley center good et al 2013 this dataset is quality controlled and includes profiles measured by argo conductivity temperature and depth ctd instruments expendable bathythermographs xbts from several sources such as argo global data assembly centres and the global temperature and salinity profile program gtspp the en4 dataset has a maximum of 400 levels in each profile profiles with more than 400 levels are thinned so that observations are spaced about 1 m apart in the upper 100 m of the ocean 10 m apart above 1500 m depth and 50 m below 1500 m observations with suspect depth values 11000 m are rejected cruise data the cruises were carried out by the institute of oceanology chinese academy of sciences iocas in the ecs and the yellow sea fig 2 the data include observations from two separate cruises one was carried out in warm season from may 25 2014 to jun 11 2014 the other covered the time period from october 17 2014 to november 8 2014 several transects were designed and temperature and salinity profiles were measured with shipboard ctd along these transects surface drifters six hourly interpolated ocean current velocities at 15 m depths and ssts measured by the drifter sensors are provided by the global drifter program gdp and obtained from https www aoml noaa gov phod gdp the current velocities are derived from 6 hourly interpolated drifter trajectories a drogue attached to the drifter makes it possible to measure ocean current velocities at a depth of 15 m to avoid adjusting tides a 36 h low pass filter was applied to the positions and velocities of drifters to remove tide signals and then the model predicted tides were added to drifter data ocean surface current analysis real time oscar oscar is a gridded diagnostic 5 day mean surface ocean current product with a resolution of 1 3 the product combines geostrophic currents derived from satellite ssh ekman currents inferred from surface winds stommel shear dynamics and a complementary term from the surface buoyancy gradient derived from sst alone bonjean and lagerloef 2002 the product provides mean ocean currents in the upper 30 m of the ocean and was assimilated into roms at a depth of 15 m model predicted tides are also added to oscar before da the observation errors are assumed to be uncorrelated so the observation error covariance is diagonal the assumption of uncorrelated observation error is reasonable especially for in situ observations but it might be questionable for satellite observations despite this it is commonly used in roms 4d var and many other da systems etherton and bishop 2004 moore et al 2011a waters et al 2015 baduru et al 2019 because some observations have high resolution than the model observations were first arranged into bins that correspond to model grid cell if multiple observations fall into the same model cell at the same time those observations were averaged to form super observations by doing this the sub grid feature which cannot be represented by the model was removed following matthews et al 2012 the observation errors were prescribed as follows 6 σ o max σ i n s t r σ s u p σ v a r where σ i n s t r is the instrumental error σ s u p is the observation standard deviation obtained when forming super observations and σ v a r is the geographical and temporal variability of each observation product the instrumental error σ i n s t r was set according to the literature and was 4 cm for ssh 0 4 c for satellite sst 0 1 c for in situ temperature 0 03 psu for in situ salinity 0 12 m s for oscar currents 0 04 m s for drifter velocities and 0 2 c for drifter sst moore et al 2011b li et al 2015 da rocha fragoso et al 2016 phillipson and toumi 2017 in the procedure of forming super observation if multiple observations fall into the same grid cell at the same time then σ s u p was assigned as the standard deviation of all the observations falling into the cell to calculate σ v a r the monthly maps of time variance of each observation product were generated on regular grids 0 25 0 25 for sst and ssh 1 3 1 3 for oscar 1 1 and a depth interval of 20 m for en4 1 1 for drifters using 20 year 2000 2019 observation statistics then σ v a r was assigned as the square root of the time variance in the monthly maps therefore σ v a r include seasonal variation σ v a r was then scaled to account for the spatial temporal variation of the representativeness error based on consistency check in section 2 4 and some preliminary experiments matthews et al 2012 kerry et al 2016 baduru et al 2019 for cruise ctd data on the continental shelf as there are no available long term observations σ v a r was scaled with model standard deviation following previous studies wilkin et al 2018 levin et al 2019 2020 in preliminary experiments it was found that σ s u p was much larger than σ v a r for ctd salinity observations so that observation errors were dominated by σ s u p which was much larger than the background error as a result the improvements of salinity errors were small therefore we only used σ v a r to set the observation error of cruise ctd salinity observations on the continental shelf background quality control was applied to eliminate bad observations or observations that are poorly represented due to model limitations neveu et al 2016 levin et al 2020 specifically if d i 2 α 2 σ b 2 σ o 2 then the observation is rejected here d i is the innovation associated with each observation and σ b and σ o are the background error standard deviation and observation error respectively the background quality control parameter α was set to 5 for ssh 4 for sst 4 for velocity and 6 for in situ temperature and salinity observations according to preliminary experiments and literature neveu et al 2016 levin et al 2019 the numbers of super observations in each 3 day assimilation window are shown in fig 2a with the distribution of in situ observations and surface drifters shown in fig 2b and fig 2c respectively most argo floats and drifters are in the open ocean and these data are supplemented by ctd xbt and cruise data near coastal seas fig 2b and fig 2c fig 2a also shows the number of rejected observations due to background quality control in each 4d var cycle on average only 0 71 of observations are rejected 2 4 consistency check of background and observation error covariance the 4d var algorithm will only work properly if the specified background and observation error covariance are correct to ensure this point a consistency check of the specified background and observation error covariance was done using the diagnostic tools described by desroziers et al 2005 and moore et al 2011b the diagnostic tools use the innovation vectors to project background and observation error into observation space specifically the diagnosed background and observation error variance can be expressed as 7 σ i b 2 1 p i j 1 p i y j a y j b y j o y j b 8 σ i o 2 1 p i j 1 p i y j o y j a y j o y j b where σ i b 2 is the diagnosed background error variance for observation type i σ i o 2 is the diagnosed observation error variance for observation type i p i is the number of observation for observation type i y j o y j a and y j b are the j th observation value analysis simulation value and background simulation value at observation location respectively fig 3 shows the time serials of the diagnosed background error σ b diagnosed observation error σ o specified observation error σ o specified background error σ b for sst ssh in situ temperature and salinity to be consistent with the diagnosed error the specified observation error σ o specified background error σ b were calculated as the square roots of the corresponding mean error variance for the same observation points as can be seen from fig 3 the specified and diagnosed errors are consistent within a reasonable range the diagnosed background error of sst has a seasonal variation and increases in summer while the specified background error has no such variation the observation error of sst is overestimated by approximately a factor of two the large prescribed observation error of salinity is associated with the cruise ctd observations on the continental shelf where the salinity variability is large the level of agreement between diagnosed and specified error is typical of that presented in previous studies moore et al 2011b matthews et al 2012 kerry et al 2016 indicating the specified background and observation error covariance are appropriate consistency check for other observations shows similar results not shown 2 5 observation impact method the observation impact method is described in detail in moore et al 2011a c this method has been used to evaluate observation networks in many marginal seas around the world moore et al 2017 powell 2017 kerry et al 2018 levin et al 2019 2020 2021 the impact of observations on the analysis can be quantified in terms of certain circulation metrics i x which are a function of the state vector with the aid of eqs 2 and 3 the analysis can be expressed as follows 9 x a x b δ x x b m t i t 0 δ z x b m t i t 0 kd then using taylor expansion the change in i x due to assimilation can be expressed as follows 10 δ i i x a i x b d t k t m t t 0 t i i x x b d t g where m t t 0 t i is the adjoint model that integrating the adjoint forcing backward to initial time as shown in eq 10 the observation impact consists of two terms the innovation d and the sensitivity g the innovation depends d on model forecast skills while the sensitivity g does not depend directly on observation and model forecast values detailed discussion will be shown in section 5 3 as the approximation of the kalman gain matrix k is saved when running 4d var the observation impact can be calculated with some additional computational cost 3 impact of 4d var on model skills in the ecs in this section the impact of 4d var on model skills in the ecs is evaluated the da experiments include consecutive 3 day da cycles spanning the whole year of 2014 in the 4d var algorithm the nonlinear simulation from the first guess model state is called background and the final nonlinear simulation after the adjustment of da is referred to as analysis the last snapshot of da analysis in each 4d var cycle was used as the ic of the next da cycle so the background simulation was actually a 3 day prediction initiated from da analyses of the last da cycle except the first da cycle 3 1 overall evaluation of 4d var performance the performance of 4d var is first evaluated by the reduction in cost function j fig 4 for most of the cycles j is reduced by 60 90 indicating that the minimization algorithm generally performs well the nonlinear cost function j n l is a measurement of the misfit between analysis and prior model background as well as the misfit between observations and nonlinear model estimates overall j agrees well with j n l which shows that the tangent linear approximation is appropriate in the 3 day da window but for some cycles the discrepancies become larger indicating stronger nonlinearity in those cycles neveu et al 2016 showed that the discrepancies may be attributed to the high resolution surface forcing which enhanced the nonlinear circulation effects in the model to evaluate the performance of the 4d var system a normalized error metric is used as follows carrier et al 2014 phillipson and toumi 2017 11 j f i t 1 n i 1 n y i o y i m e i where y i o is the observation y i m is the model value at the observation location and e i is the observation error j f i t is a dimensionless metric that measures the model and observation misfit normalized by observation error a value close to or less than 1 indicates good agreement between the model and observations table 1 shows the assessment of 4d var performance for each observation type the magnitude of j f i t depends on not only the model performance but also the prescribed observation error the reduced percentage of j f i t shows the improvement after da overall 4d var reduces model data discrepancies effectively for all variables for sst ssh in situ temperature and drifter temperature 4d var reduces more than 60 of the j f i t in the free run simulation the improvements for in situ salinity and velocity are not as significant but the reduced percentages still exceed 35 the background simulation shows the model forecast skills if the da analyses are used as ic for temperature observations sst in situ temperature and drifter sst the j f i t of the background simulation increases by more than 50 compared with that of the analysis simulation table 1 this suggests that the assimilated information would be lost rapidly in a 3 day forecast although the improvements of the analysis simulation compared with the free run simulation are significant for temperature observations for ssh observations the assimilated information would last longer with j f i t of the background simulation increasing by 42 compared with that of the analysis simulation for velocity and salinity observations the percentages are about 30 suggesting the assimilated information would mostly remain in the forecast 3 2 impact of 4d var on sst and ssh fig 5 shows the temporal variation and spatial distribution of simulated sst error metrics the error metrics include j f i t root mean square error rmse and bias j f i t and rmse of sst show similar variation the rmse of the analysis fluctuates at approximately 0 4 c suggesting a good sst assimilation performance the background simulation performance is generally between the free run and da analyses the average sst rmses are 1 04 c for the free run 0 61 c for the background simulation and 0 38 c for the analysis the free run has an apparently positive bias in summer and a negative bias from january to mid march in the da analysis the bias is corrected and the analysis becomes nearly unbiased throughout the year the sst shows large rmses on the ecs continental shelf around coastal seas and near the subpolar front in the east japan sea park et al 2004 2007 in the free run simulation and these errors can be significantly reduced after da fig 5d f similarly the ssh errors are significantly reduced after da fig 6 the model bias of the ssh fluctuates around zero and has no consistent trend fig 6c distinct from sst large rmses of ssh are mainly found in the open ocean and the rmses are reduced significantly after da fig 6d f the rmses in the stcc region in the free run simulation may be associated with mesoscale eddies there chelton et al 2011 which cannot be accurately predicted by the free run model however it is captured by the analysis simulation a large rmse is also present near the kuroshio south of japan where meanders were frequently observed the formation of meanders in the kuroshio extension region was found to be closely associated with mesoscale eddies mitsudera et al 2001 miyazawa et al 2008 qiu and chen 2010a thus the predictability of meanders is also affected by mesoscale eddies in summary the large sst errors occur near the coast and the frontal zone in the east japan sea large ssh errors are associated with mesoscale variability such as mesoscale eddies and kuroshio meanders these errors can be reduced significantly by 4d var 3 3 impact of 4d var on vertical profiles of temperature and salinity fig 7 shows the profiles of bias and rmse of temperature and salinity averaged in 2014 as the structures of vertical profiles are distinct on the continental shelf and in the open ocean two regions are chosen to show their respect vertical structures polygon a in fig 2 for the ecs continental shelf and box b for the open ocean the model generally shows a negative temperature bias in the open ocean with two peaks of bias in the subsurface layer and near 500 m fig 7a an inspection of the free run model shows that the negative bias is mainly attributed to the bias in the hycom initial condition not shown the vertical structure temperature rmse profile agrees well with the temperature bias and great improvement can be observed after da in the upper 800 m of the ocean fig 7b on the continental shelf the structure of bias is different the largest error of temperature is present below 30 m on the continental shelf with significant improvement after da for salinity profiles the vertical structures of errors are very different in the open ocean and on the continental shelf salinity bias is small in the open ocean less than 0 1 psu for most part of the vertical profile fig 7e however on the continental shelf a large positive bias is present at sea surface fig 7 g large values of salinity rmses are present near surface layer in both regions but the magnitude of rmse is different fig 7f h da reduces salinity rmses effectively in both regions 4 impact of including tidal forcing in 4d var in this section the impact of including tidal forcing in 4d var is investigated by comparing two experiments with and without tidal forcing as the important role of tidal forcing in the ecs has been documented by many previous results qiao et al 2006 lü et al 2007 moon et al 2009 lü et al 2010 wu et al 2018 this work focuses on the impact of tidal forcing on modelling of sst and temperature profiles using 4d var preliminary experiments showed that the difference induced by tidal forcing was significant in warm season on the ecs continental shelf to reduce computational cost the 4d var experiment without tides only runs from may 1 2014 to the end of august 2014 the configuration of 4d var experiment without tides was the same as that with tides except that the tidal signals were excluded from ic bc and observations the result of free run without tide on may 1 2014 was used as the initial condition of 4d var experiments without tides for simplicity the experiments with and without tides are referred to as expt and expnt below fig 8a shows the bias of sst on the ecs continental shelf in the warm season of 2014 for free run background and analysis simulations in expt and expnt in the free run of expnt the model shows positive bias on the continental shelf red dashed line in fig 8a the bias is 1 31 c on average this bias is significantly reduced in the free run of expt red solid line in fig 8a the bias is 0 75 c on average the results are reasonable as tidal forcing can increase vertical mixing induce upwelling and lead to cold patches of sst in the yellow sea as revealed by previous studies lü et al 2007 2010 after da the positive bias in the analysis simulation is significantly reduced in both experiments blue solid and dashed lines in fig 8a and the analysis simulation of expnt has slightly larger positive bias than that of expt 0 08 c 0 06 c on average for analysis simulation of expnt expt as mentioned above the background simulation is a 3 day forecast using the analysis as ic so the background simulation indicates the forecast skills of the model the background simulation of expt has smaller bias than that of expnt orange solid and dashed lines in fig 8a the averaged bias is 0 41 c 0 28 c for background simulation of expnt expt indicating that including tidal forcing improves the sst forecast skills fig 8b shows the profiles of vertical temperature bias for the cruise ctd observation in the warm season of 2014 from may 25 to june 11 in 2014 on the ecs continental shelf generally the free run of expnt shows positive bias on the continental shelf red dashed line in fig 8b including tidal forcing reduces the positive bias of vertical temperature profile especially near surface layer red solid line in fig 8b however the background simulation of expt and expnt show distinct bias in expnt the background simulation shows negative bias in the temperature profile orange dashed line in fig 8b while in expt the bias remains positive for most part of the profile orange solid line in fig 8b the negative bias of temperature in the background simulation of expt has important impact on the vertical stratification which will be discussed below in the analysis simulation the bias is reduced in both experiments so why the background simulation of expt shows better forecast skills of sst why the background simulation of expt and expnt show different bias in the vertical temperature profile to interpret the above results the vertical profiles of brunt vaisala frequency and temperature vertical diffusion coefficients are shown in fig 9a the profiles are averaged for the background simulation over the continental shelf polygon a in fig 2 during the cruise time period in the warm season of 2014 from may 25 to june 14 in 2014 fig 9a shows the background simulation of expnt has larger brunt vaisala frequency than that of expt thus the coastal seas are more stratified as tidal forcing will increase vertical mixing it is a reasonable result that the lack of tidal mixing will make coastal seas more stratified what is more in warm season stronger stratification will prevent heat from solar radiation transferring downward melet et al 2022 which will in turn strengthen the stratification of coastal seas the feedback between stratification and downward heat flux will make the temperature in expnt higher near the sea surface and lower below the mixed layer upper 10 m according to fig 9a compared with that in expt as shown in fig 8 on the other hand the temperature vertical diffusion coefficients are larger in expt than in expnt below the mixed layer indicating the effect of tidal mixing the relative importance of stratification and tidal mixing to vertical mixing varies with depth as stratification is stronger in the upper layer this effect works mainly in the upper 20 m strong stratification in expnt prevents heat flux from transferring downward so more heat is trapped in the mixed layer making the mixed layer warm in expnt in contrast as tidal mixing is bottom intensified the contribution of tidal mixing is mainly below the mixed layer according to the temperature vertical diffusion coefficients shown in fig 9a note fig 9 shows the average profile over the continental shelf due to the different water depths in different regions the tidal mixing is important in all depth below the mixed layer in the averaged profile to further illustrate the question the corresponding profile of vertical heat budget is shown in fig 9b the heat budget equation can be written as follows 12 t t t e n d e n c y v h h t h a d v w t z v a d v d t h d i f f z k t t z v d i f f where t is temperature v h is horizontal velocity w is vertical velocity and k t is the vertical temperature diffusion coefficient the surface boundary condition is 13 k t t z q c ρ 0 c p where q c is surface heat flux ρ 0 is reference density and c p is specific heat at constant pressure the bottom boundary condition is 14 k t t z 0 the heat budget profile is averaged over the same area for the same time period as the profiles in fig 9a using the diagnostics module of roms the heat budget was first calculated as the 3 day average of each da window then the results of all the cycles were averaged to get the final heat budget profile the steps were used to ensure the heat budget was closed during this period the basin scale warming is evident from the temperature tendency black lines in fig 9b the vertical diffusion term is the major contributor of the warming tendency and it is responsible for transferring the positive surface heat flux downward the horizontal advection and vertical advection balance each other and the combination of the two terms also contribute to part of the warming tendency the horizontal diffusion term is negligible compared with the other terms after a comparison between expt and expnt it is found that the vertical diffusion term is stronger in expnt in the mixed layer which suggests heat flux is trapped in the mixed layer due to strong stratification making the mixed layer warmer in contrast the vertical diffusion below mixed layer in expnt is weaker than that in expt the larger vertical diffusion in expt is probably due to tidal mixing it is noteworthy that the horizontal and vertical advection terms shows difference between expt and expnt suggesting the modulation of tides on mean circulation in summary although the analysis simulations in expt and expnt have similar performance in sst the background simulation 3 day forecast initiated from da results of expnt has larger positive bias in sst than that of expt expnt has negative bias in subsurface temperature profile the biases in expnt are attributed to stratification and tidal mixing the relative importance of the two factors varies with depth 5 observation impact on kvt and koi in this work two circulation metrics kvt and koi are used to evaluate observation impacts following yang et al 2012 kvt is defined as the volume transport in the upper 500 m layer through a cross section east of taiwan red dashed line in fig 1 koi is defined as the volume transport through the 200 m isobath northeast of taiwan red solid line in fig 1 where most of the onshore intrusion occurs liu et al 2014 5 1 time series and statistics of observation impact the time series of kvt and koi from the background and analysis simulation are shown in fig 10 generally the corrections made by 4d var are small this feature is desirable as small increments are necessary conditions for linear assumptions most of the kvt corrections are negative suggesting that the background simulation may overestimate the kvt the time series of the observation impact calculated from eq 10 referred to as the tangent linear impact is also shown in fig 10 which generally shows good agreement with those calculated from the nonlinear model indicating that the tangent linear assumption is reliable the correlation coefficient between the nonlinear model observation impact and tangent linear impact is 0 99 for kvt and 0 95 for koi which suggests that the nonlinearity of koi is stronger than that of kvt this result is appropriate because koi is affected by both the local wind forcing and the interaction of the kuroshio with steep topography guo et al 2006 the time series of observation impacts for each 4d var cycle are shown in fig 11 the rms and average percentage of observation impact of ic bc and fc for each 4d var cycle are presented in table 2 as there are positive and negative impacts the percentages are calculated in terms of the absolute value of the observation impact kerry et al 2018 the ic has the largest observation impact on both kvt and koi table 2 the fc accounts for less than 6 of total impact the bc accounts for 27 of the total impact on kvt and 34 78 on koi the results indicate that remote forcing are more import for kvt and koi than local forcing as kvt is mainly controlled by basin scale wind stress curl and this remote forcing takes the form of bc in a regional model it is reasonable result that adjusting bc will have a large impact on kvt because kvt and koi are closely related adjusting bc will also influence koi liu et al 2014 the observation impact of each observation type is shown in fig 11c d and table 3 considering the different observation numbers the observation impact per datum for each observation type is also shown in table 3 the observation impacts of u and v are averaged for simplicity for both kvt and koi sst ssh and in situ temperature are the most impactful observations and their impact accounts for more than 85 of the total impact notably the in situ temperature observation impact per datum is much larger than other observations the observation impact per datum is comparable for in situ s oscar and drifter data but due to the very limited number of drifter data the total impact of drifter data is nearly negligible 5 2 spatial distribution and vertical profile of observation impact fig 12 shows the spatial distribution of observation impacts on kvt and koi for the three observation types with the largest observation impact ssh sst and in situ temperature the observation impacts on kvt and koi show similar spatial distribution but differ in magnitude the similarity indicates that kvt and koi are closely related as revealed by liu et al 2014 for sst and ssh the largest observation impacts are present near the cross section where kvt or koi is defined large observation impacts can also be observed along the kuroshio path extending from the northeast of taiwan to the southwest of japan for in situ temperature observations the distribution pattern of observation impact is a little noisy and more observations are needed in future studies to give statistically more reliable results in spite of this limitation the distribution pattern of in situ temperature is similar to that of sst large observation impact can also be observed along the kuroshio path the remote upstream and downstream distribution of high observation impact was also noticed by kerry et al 2018 the reason why observation impact would show such a spatial distribution will be analysed in section 5 3 fig 13 shows the vertical profiles of observation impacts of in situ temperature and salinity for kvt in situ temperature has two peaks of observation impact one is in subsurface layer at around 40 m the other at about 400 m solid red line in fig 13a in situ salinity observations only have large impacts above the upper 100 m solid blue line in fig 13a as for observation impact per datum in situ temperature have maximum value at about 400 m and in situ salinity have maximum value near sea surface dashed lines in fig 13a for koi in situ temperature has strong observation impact peak in subsurface layer at about 40 m the other peaks below are relatively weak compared with observation impact on kvt vertical profiles of in situ salinity are similar for kvt and koi to interpret the vertical profile of observation impact the observation impacts are separated into two terms according to eq 10 the innovation d and sensitivity g and the results are shown in figs 13b and 13d innovation d represents the difference between the observation value and background model value at observation location the innovation d depends on model forecast skills and the innovation will be large where the model prediction deteriorate rapidly the temperature innovation d has strong peak in the subsurface layer near 100 m depth the reason might be associated with the relatively poor model forecast skills in predicting the variability of thermocline besides the assimilated sst observations provide constraint of sst preventing it from deviating too far from the observation as a result the largest innovation would occur in subsurface layer instead of at sea surface the large value of salinity innovation near sea surface is probably caused by coastal salinity bias fig 7 g and 7 h the sensitivity g shows fluctuation with depth and has slightly large values in the middle level 300 1300 m depth the interpretation of sensitivity g is complicated and examples will be shown in section 5 3 the relatively large sensitivity g might also be associated with relatively sparse observation density in the middle level see section 5 4 for further discussion the vertical structure of observation impact is determined by the combination of both terms the subsurface peak of observation impact of temperature is attributed to the peak of innovation d for koi the observation impact is mainly determined by innovation d since the vertical profile of sensitivity g does not vary much with depth 5 3 interpretation of the observation impact spatial distribution due to the similar spatial distribution patterns of observation impacts on kvt and koi only the results of kvt are analysed observation impacts of sst and ssh are explored due to the good data coverage as discussed in section 5 2 the observation impact consists of two terms the innovation d and sensitivity g the rmss of innovation d and sensitivity g for kvt are shown in fig 14 compared with figs 12a and 12b it is found that both d and g contribute to the distribution patterns of observation impact large innovations usually occur where model forecast skills degrade very quickly large innovation of sst can be seen in the east japan sea on the ecs continental shelf and in coastal seas large innovation of ssh is present near the boundary and also in the east japan sea the distribution patterns of sensitivity g are different from those of innovation d to interpret the distribution of g g can be expressed as g gd g t r 1 gd m t t 0 t i i x x b with the aid of eqs 4 and 10 fig 15 shows the results of each step of calculating g for ssh so that the main factor controlling the spatial distribution can be identified the spatial distributions are averaged over all da cycles fig 15a shows the distribution of m t t 0 t i i x x b which is obtained by integrating the adjoint model backward to initial time forced by the functional i x x b this step is actually an adjoint sensitivity analysis veneziani et al 2009 as the circulation metric i only depends on meridional velocity i x x b is zero everywhere except along the cross section used to define kvt on the meridional velocity grid the most remarkable feature in fig 15a is the wave like pattern indicating how the information propagate in space previous studies mentioned the roles of different dynamics in spreading the assimilated information moore et al 2015 used information horizons to address the question considering the main dynamic processes of advection diffusion and wave propagation the maximum distance each process can propagate in the assimilation window can be estimated by its propagation speed for example assuming an average kuroshio current speed of 1 m s in a 3 day assimilation window the assimilated information can travel nearly 260 km thus only observations near taiwan can influence kvt through advection the fastest baroclinic waves are the inertial gravity waves which propagate at the first baroclinic mode phase speed and have the maximum phase speed of 3 m s in this region chelton et al 1998 so it can travel 780 km in the open ocean the barotropic gravity wave represents the fastest wave mode and can potentially influence any part of the whole domain the output from the adjoint model was checked to see how the assimilated information spread in model space through multiple processes as the adjoint forcing functional i x x b is constant the results of the adjoint model are similar for different da cycles the three major routes of wave propagation are shown by arrows in fig 15a the arrow shows wave propagation direction when the adjoint model is integrated from the end of da window to initial time the first routes marked by a shows the signal propagates through external gravity waves on the continental shelf the routes b shows the kelvin like waves along the ryukyu island chain in the open ocean multiple waves such as barotropic waves rossby waves baroclinic inertial gravity waves marked by arrow c might be responsible for the transferring of assimilated information the waves generally weakens as they propagate further apart from waves other processes such as advection and diffusion are also important and the impacts of these processes are confined around the cross section used to define kvt so they are responsible for the strong signals around the cross section another feature in fig 15a is that negative values are present mainly on the continental shelf and positive values mainly appear in the open ocean as kuroshio current is mainly geostrophic flow kvt is largely controlled by the sea surface slope across the main stream of the kuroshio yan et al 2016 thus a negative increment of ssh on the continental shelf or a positive increment on the right side of kuroshio will lead to an increase in kvt the results of d m t t 0 t i i x x b after a multiplication by the background error covariance d are shown in fig 15b this operation has the effects of spreading the information in space within decorrelation scales so the fields obtained from last step are smoothed after the operation the prior uncertainties are also taken into consideration in d with the aid of standard deviation matrix σ in eq 5 as a result where the standard deviations are small d will lower the weight of the corresponding signal and vice versa for example the signals on the continental shelf in fig 15b become relatively weak as a result of low standard deviations of ssh in fig 16a the signals in the open ocean and near tokara strait marked by the letter d are amplified which correspond to the large standard deviation in fig 16a the next step is to integrate the tangent linear model forward and sample at observation location so that g d m t t 0 t i i x x b is obtained to better illustrator how the spatial pattern evolve the operator g is replaced by m which means integrating the tangent linear model to the end of the da window and the results are shown in fig 15c without the forcing functional signals from the last step are advected or propagate under the constraint of model dynamics on the continental shelf the direction of wave propagation is opposite to that in the adjoint model marked by the arrows in fig 15c the large values east of taiwan further spread out by multiple waves the last step is a multiplication by the inverse stabilized representer matrix gd g t r 1 which removes the total prior covariance between the observation locations it is found that gd g t r 1 account for much of the spatial patterns of g which has been noticed by levin et al 2019 in this step regions with large observation error are penalized and g is reduced this is apparent in the open ocean east of rukyu island fig 15d and fig 16c the spatial distribution of sensitivity g for sst can be interpreted in a similar way fig 17 but fig 17 shows some different features from ssh in the result of m t t 0 t i i x x b fig 17a the external gravity waves have little impact in the yellow sea and bohai sea probably because the shallow waves decrease with depth vallis 2017 which are unable to penetrate the mixed layer in contrast in the open ocean as the adjoint forcing extends to 500 m deep water waves are able to induce large temperature variation in the result of fig 17a another important feature is the large adjoint sensitivity along the boundary in fig 17a similar phenomenon was also found in the adjoint analysis of veneziani et al 2009 according to their study the strong adjoint sensitivity is attributed to waves propagating along the boundary which results from the type of boundary condition clamped boundary condition and the regional nature of the model due to the strong adjoint sensitivity along the boundary roms 4d var is unable to handle observations near the boundary after the multiplication by the background error covariance d the strong signals along the kuroshio path remain and the signals near the boundary are significantly reduced fig 17b the next step is the tangent linear model integration in which the signals spread further through short length scale waves fig 17c after a multiplication of gd g t r 1 the signals along the kuroshio are enhanced due to the small observation error along the kuroshio fig 16d and fig 17d 5 4 discussion of observation impact in summary the distribution of observation impact is controlled by several factors 1 model forecast skills the factor control the observation impact through the innovation vector d 2 dynamic processes responsible for the transferring of assimilated information different waves transfer the assimilated information in different regions which regulates the spatial distribution of observation impacts 3 background and observation error covariance large background error will enhance the sensitivity g while large observation error will be penalized and the sensitivity g will be reduced as a result due to the important role of error covariance a consistency check as in section 2 4 is needed to ensure the specified background and observation error covariance are appropriate tracking how the assimilated information propagate in space helps to advance the understanding of the dynamics in ecs various waves play important roles in transferring assimilated information so understanding the characteristics of the waves are important due to the assumption of uncorrelated observation error the observation impacts are not independent of other observations for example the decorrelation scale of satellite data are typically large if the satellite observations are sampled at a larger spatial interval the observation impact per datum may increase since each observation can provide more additional information similar conclusion may also be true for the vertical structure of in situ observations since more observations are available near sea surface compared with in deeper levels the observation impact per datum may be smaller near sea surface as shown in fig 13 and section 5 2 oscar and ssh share some satellite data source so if either type of observation is removed the observation impact of the other type is expected to increase 6 summary in this work the impact of 4d var da on modelling of the ecs dynamics is investigated the unique capability of adjusting ic bc and fc in roms 4d var makes it a powerful tool to simulate processes associated with both local and remote forcings as the strong tidal forcing in the ecs plays important roles in the ecs shelf circulation tidal forcing was included in 4d var and the impact of tidal forcing was investigated by comparing two experiments with and without tidal forcing the assimilated data in this study include sst ssh in situ temperature and salinity profiles as well as surface drifters and a surface ocean current analysis oscar overall 4d var performs well in reducing model data misfit for all observation types the main error sources of the model are identified by comparing with the observations and 4d var is very effective in reducing these errors the largest sst errors are present near the subpolar front in the east japan sea on the continental shelf and in coastal seas the largest ssh errors are associated with the abundant mesoscale eddies in the stcc region and kuroshio meanders the accurate time and location of these signals cannot be well predicted by a free run model due to the instability process and 4d var is very effective in assimilating these mesoscale signals compared with experiments with tides the absence of tidal forcing will make temperature higher near sea surface and lower below mixed layer on the continental shelf in the background simulation 3 day forecast using da results as ic the difference in temperature profile is associated with two factors stratification and tidal mixing the importance of the two factors varies with depth using a first order taylor approximation the observation impacts on koi and kvt are evaluated with the aid adjoint models ic always has a larger impact than bc and fc and bc accounts for approximately 27 of the total impact on kvt and 34 78 on koi fc has less than 6 of the total impact on kvt and koi suggesting the two metrics rely more on remote than local forcings sst ssh and in situ temperature account for most of the observation impacts and in situ temperature is several times more impactful per datum than other observations the observation impact per datum is comparable for in situ s oscar and drifter data but the total impacts of surface drifters are very small due to the limited observation number the geographical distribution of observation impact shares similar features for different observation type the largest observation impacts are present near the cross section used to define kvt or koi a band of large observation impacts extends along the kuroshio path from the northeast of taiwan to the southwest of japan the vertical profile of in situ temperature observation impact shows two peaks of observation impact one is in subsurface layer at around 40 m the other at about 400 m in situ salinity observations only have large impacts above the upper 100 m several factors controls the geographical distribution of observation impact which include the model forecast skills the dynamic processes that are responsible for the transferring of assimilated information and the specified error covariance different waves transfer the assimilated information in different regions which regulates the spatial distribution of observation impacts tracking how the assimilated information propagate in space helps to advance the understanding of the dynamics in ecs this work is an overall assessment of 4d var performances in the ecs the results show that including tidal forcing in 4d var improves the model performance on the ecs continental shelf the observation impact on the most important western boundary current in this region the kuroshio is investigated the results reveal the most impactful observations and how the assimilated information propagate through wave dynamics these findings advance our understanding of the dynamics associated with the kuroshio current and the ecs due to data availability most of the data are publicly available through the internet except the cruise data provided by iocas in spite of this limitation this work could provide a reference for building operational ocean forecasting systems because of the large costs of building and maintaining ocean observation networks it is valuable to assess observation networks before deployment in future work the observation impact method could be used in observing system simulation experiments osses in which synthetic observations generated by one model can be assimilated into another model to evaluate the possible impact of potential observations oke et al 2009 fujii et al 2019 therefore a design scheme of the observation network could be assessed at a minimum cost without the need to repeatedly run da experiments credit authorship contribution statement zhiwei he conceptualization methodology formal analysis visualization writing original draft writing review editing dezhou yang conceptualization resources writing review editing supervision funding acquisition yonggang wang writing review editing supervision baoshu yin supervision funding acquisition declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgements this study was supported by the national natural science foundation of china nos 92158202 41876019 and 42076022 the strategic priority research program of the chinese academy of sciences nos xdb42000000 xda19060203 and xda19060202 the key deployment project of centre for ocean mega research of science chinese academy of sciences no coms2020q01 the nsfc shandong joint fund for marine science research centers u1806227 the marine s t fund of shandong province for pilot national laboratory for marine science and technology qingdao no 2021qnlm040001 and no 2022qnlm010302 and the cas csiro bau project no 133137kysb20180141 it was also supported by the high performance computing center at the iocas yellow sea east china sea ocean observation and research station of omorn all the assimilated data are publicly available from the internet except the cruise data from iocas we thank all the efforts for making the data available on the internet 
23828,in this work the four dimensional variational 4d var data assimilation da of the regional ocean modelling system roms is applied in the east china sea ecs the unique capability of optimizing the initial condition ic boundary condition bc and surface forcing fc in roms 4d var facilitate the simulation of dynamical processes associated with both local and remote forcing the assimilated data in this study include sea surface temperature sst sea surface height ssh in situ temperature and salinity profiles as well as surface drifters and a surface ocean current analysis oscar overall 4d var performs well in reducing model data misfit for all observation types as tidal forcing plays important roles in the shelf circulations of the ecs tidal forcing was included in 4d var and its impact was evaluated by comparing two experiments with and without tides the biases of sst in da analyses are small on the continental shelf in both experiments however compared with experiments with tides the absence of tidal forcing will make temperature higher near the surface layer and lower below mixed layer in the background simulation 3 day forecast using da analyses as ic in the warm season of 2014 the difference in temperature profile is associated with two factors stratification and tidal mixing the relative importance of the two factors varies with depth with the aid of the adjoint model the impacts on the kuroshio volume transport kvt and the kuroshio onshore intrusion koi contributed by different types of observations are evaluated as well as the contributions of ic bc and fc ssh sst and in situ temperatures have large total impacts while in situ temperatures have the largest impact per datum the geographical distributions of observation impacts are similar for different observation types large observation impacts extend along the kuroshio path from the northeast of taiwan to the southwest of japan several factors control the geographical distribution which include the model forecast skills the dynamic processes that are responsible for the transferring of assimilated information and the specified error covariance tracking how the assimilated information propagate in space helps to advance the understanding of the dynamics of kvt and koi keywords 4d var tidal forcing the east china sea observation impact kuroshio transport kuroshio onshore intrusion 1 introduction the east china sea ecs is a marginal sea influenced by complex dynamic processes the taiwan warm current the yellow sea coastal current the discharging of yangtze river and the kuroshio intrusion su et al 1994 yang et al 2011 hu and wang 2016 besides the ecs is well known for its strong tidal forcing which modulates the vertical temperature structure and circulations in this region qiao et al 2006 lü et al 2007 moon et al 2009 the tidal residual flow plays important roles in coastal flows and tidal mixing can induce tidal mixing fronts leading to upwelling and surface cold patches lü et al 2010 wu et al 2018 the complicated dynamics of the ecs brings challenges to modelling of this region the kuroshio current significantly regulates the regional ocean environment and global climate nakamura et al 2004 hu et al 2015 and it controls the water and heat exchanges of the ecs with the open ocean yang et al 2011 therefore it is crucial to reproduce the variability of kuroshio when modelling the dynamics of the ecs the variability of the kuroshio volume transport kvt has been widely investigated with observations and ocean models chang and oey 2011 shen et al 2014 andres et al 2017 as the western boundary current of the north pacific subtropical gyre the large scale kvt is mainly controlled by basin scale wind stress curls pedlosky 1987 and thus remote forcings matter more than local effects for the large scale variation of kvt as a result for a regional ocean model to reproduce kvt variability it is critical to impose accurate boundary conditions which is very challenging for regional ocean models yang et al 2011 on intraseasonal or shorter time scales the kvt is modulated by the impingement of westward propagating mesoscale eddies tsai et al 2015 yan et al 2016 jan et al 2017 kamidaira et al 2017 chang et al 2018 most of the mesoscale eddies originate in the north pacific subtropical countercurrent stcc see fig 1 region due to baroclinic instability qiu and chen 2010b and these eddies frequently impinge on the kuroshio current when they moving westward directly changing the kvt due to the mesoscale instability processes ocean models cannot predict the accurate time and location of mesoscale eddies without da kerry et al 2018 therefore it is essential to combine observations with model dynamics when predicting intraseasonal variations in kvt kuroshio onshore intrusion koi to the continental shelf plays an important role in ocean circulations in the ecs and is an important nutrient source in coastal regions yang et al 2013 most koi takes place near the shelf break northeast of taiwan guo et al 2006 wu et al 2014 yang et al 2018 yang et al 2018 proposed a topography beta spiral theory showing that the intrusion flow rotates counterclockwise from the sea surface down to the bottom blue arrows in fig 1 therefore it is the bottom flow that intrudes onshore and reaches the zhejiang coast using a nested ocean model guo et al 2006 found that the variation in koi is controlled by ekman transport and changes in the density field koi is also found to be affected by kvt on an interannual scale liu et al 2014 yin et al 2017 reported that koi is modulated by mesoscale eddies impinging on the kuroshio current as well in summary the koi is controlled by both remote and local forcings and its complicated dynamics need to be studied with both observations and ocean models data assimilation da is a common method that combines observations and model dynamics to obtain better state estimates in a least square sense kalnay 2003 in recent years the development of the regional ocean modelling system roms four dimensional variational data assimilation 4d var system has enabled adjustments of the model initial condition ic boundary condition bc and surface forcing fc towards observations using the state of the art variational da technique moore et al 2011b a the important capability of adjusting surface forcing and boundary conditions will facilitate the simulation of phenomena associated with both local and remote forcings an important feature of 4d var is that it can assimilate observations at a finite time window while studies of three dimensional da method usually used the first guess at appropriate time fgat method and put observations at a single time huang et al 2002 therefore 4d var shows advantage when assimilating observations that vary both in space and time such as argo and glider observations besides as introduced above tidal forcing plays important roles in the shelf circulations of the ecs so including tidal forcing in da system is essential when modelling the dynamics of the ecs however da in a tide driven eddy resolving model is challenging because the time and length scales of tides and mesoscale variability are different and require different corrections using the ensemble optimal interpolation enoi method xie et al 2011 had to filter out tides before da and only included tides in the forecast between da cycles however this method might introduce errors when filtering out tides and tides and mesoscale flows may not be fully coupled in their method in spite of the disadvantages their results showed improvements in experiments with tides several studies have proved the feasibility of including tide forcing in roms 4d var and the feature of 4d var allows fully coupled tides and mesoscale flows within the da window matthews et al 2012 janeković et al 2013 wilkin et al 2018 levin et al 2019 in their work da was used to adjust mesoscale variability and leave tidal signals unchanged to achieve this goal they filtered out the tide signal of observations and then added the model predicated tides to observations as a result tidal signals were identical in observations and model so tides were not considered in da in this work similar method was used to modelling tides in 4d var in ecs despite the advantage of roms 4d var application in the ecs is rare and no study has investigated the impact of tidal forcing in 4d var in this region this work aims to investigate how 4d var impacts the modelling of the ecs dynamics particularly with tide one way to achieve this goal is by comparing model results before and after da with observations the main source of errors can be identified in this process which can help us understand the model performance limitation and how 4d var adjust the model towards observation another way to quantify the impact of 4d var is to calculate the observation impact on certain circulation metrics with the aid of adjoint model moore et al 2011c this method can quantify how each observation affects certain ocean circulation metrics through adjustments of ic bc and fc which may indicate the relative importance of local and remote forcing in addition by integrating backward the adjoint model can provide the information of how the assimilated information propagate in space these information may advance our understanding of ocean dynamics associated with the ocean circulation metrics veneziani et al 2009 masuda et al 2010 levin et al 2019 the goal of this work is to investigate how 4d var could impact the modelling of the ecs dynamics the first step is to evaluate the improvement after da by comparing with observations then the observation impacts on kvt and koi are quantified with the aid of adjoint model starting from jan 2014 the da simulation spanned the whole year of 2014 the remainder of the paper is organized as follows section 2 describes the model configuration assimilated data and observation impact method used in this work section 3 shows impact of 4d var on model skills in the ecs section 4 discusses the impact of including tidal forcing in 4d var based on the comparison between da experiments with and without tides section 5 shows the results of observation impact on kvt and koi and an interpretation of the spatial distribution of observation impact is also shown a brief summary is given in section 6 2 model configuration data and method the model used in this study is roms http www myroms org which is a free surface split explicit terrain following ocean model shchepetkin and mcwilliams 2005 before running 4d var a free run without da is needed to provide the model standard deviation statistics to construct model background error covariance moore et al 2011a the free run model and 4d var configurations are listed below followed by the introduction of the observation impact method 2 1 free run model configuration the model domain is shown in fig 1 with a horizontal resolution of 1 12 1 12 cos φ 8 km where φ is latitude and 26 terrain following levels the model grid setting is the same as nest2 in yang et al 2011 the ic and bc were linearly interpolated from the hybrid coordinate ocean model hycom 1 12 global analysis https www hycom org the advection schemes used in this work were the third order upstream biased horizontal advection scheme and the fourth order centred differences vertical advection scheme the boundary conditions were set to chapman condition for the free surface chapman 1985 flather condition for the 2d momentum and clamped condition for the 3d momentum temperature and salinity marchesiello et al 2001 to reduce noise near the boundary sponge layers with widths of approximately 100 km were set where the viscosity and diffusion coefficients increased from 4 m 2 s 1 inside the domain to 400 m 2 s 1 at the boundary following neveu et al 2016 the model was also forced with 8 primary tidal constitutes m 2 s 2 n 2 k 2 k 1 o 1 p 1 q 1 from the topex poseidon tidal product tpxo 7 2 egbert et al 1994 the daily averaged surface forcing fields including wind at 10 m temperature and humidity at 2 m longwave and shortwave radiation fluxes rain and sst were extracted from the era5 global reanalysis product hersbach et al 2020 the sst data extracted from era5 product were used in a surface heat flux correction scheme barnier et al 1995 the wind stress was calculated using the bulk flux scheme liu et al 1979 fairall et al 1996b a the mellor and yamada level 2 5 closure scheme mellor and yamada 1982 and quadratic bottom drag were used in this work the daily river discharge of the yangtze river was added to the model using the daily river runoff data obtained from the yangtze river water resource bureau http www cjh com cn index html the monthly discharges of other major rivers the yellow river the huai river and the qiantang river around the east china sea were obtained from the river discharge dataset of dai 2017 which is an updated version of dai et al 2009 a weak surface salt flux correction was used to restore the sea surface salinity to climatology the surface salinity climatology was obtained from the world ocean atlas woa dataset boyer et al 2018 the 10 year free run spans from jan 2010 to december 2019 and the results of 2014 will be compared with the da analysis in section 3 2 2 configuration of 4d var as an advanced da system roms 4d var has prevalent usage in ocean research around the world powell et al 2008 li et al 2015 da rocha fragoso et al 2016 janeković et al 2020 here only a brief introduction to 4d var will be given for a more detailed description please refer to moore et al 2011a b details of 4d var configurations are also introduced below the configurations of nonlinear model in 4d var algorithm are the same as those in the free run given a model background first guess model state roms 4d var seeks to minimize the cost function which includes changes in model background j b and model data discrepancy j o 1 j δ z j b j o 1 2 δ z t d 1 δ z 1 2 g δ z d t r 1 g δ z d where δ z is the control vector which includes increments to model ic bc and fc within the da window moore et al 2011a d and r are the background and observation error covariance matrix respectively d y o h x b is the innovation vector representing the difference between observations and model value at observation locations h is the observation operator that maps the background model state variable x b to the observation location g is the tangent linear model sampled at observation locations g and h are connected by the relation 2 h δ x t i h m t i t 0 δ z g δ z where δ x t i is the model state increments at time t i which can be obtained by integrating tangent linear model δ x t i m t i t 0 δ x t 0 m t i t 0 is an alternative form of tangent linear operator moore et al 2011a the solution of minimization of 1 can be expressed as follows 3 δ z a z a z b kd where k is the kalman gain matrix which can be expressed as follows 4 k d g t g d g t r 1 roms 4d var uses tangent linear and adjoint models in the iteration to minimize the cost function inner loops with the nonlinear trajectories updated periodically outer loops after some experiments it was found that 1 outer loop and 20 inner loops are sufficient to reduce the cost function with affordable computational cost the length of the da window was set to 3 days following weaver and courtier 2001 the background model covariance in roms 4d var is factorized as follows 5 d k b σ c σ t k b t where k b is the multivariate balance operator which uses hydrostatic and geostrophic balance to constrain different model variables in this work due to the rough topography the balance operator was disabled because the tangent linear model and adjoint model enable the transfer of information between variables through model dynamics disabling the usage of k b would not destroy the solutions σ is the standard deviation matrix which was calculated using the free run model results introduced in section 2 1 σ was calculated based on monthly statistics so it includes seasonal variation c is the univariate correlation matrix and can be separated as horizontal and vertical correlation functions weaver and courtier 2001 the horizontal decorrelation scale for the ic was set to 50 km which was set based on the averaged rossby deformation scale in the domain chelton et al 1998 the vertical decorrelation scale for the ic was 10 m which was set according to the shortest vertical decorrelation length scale estimated over the whole model domain this is because an overestimation of vertical decorrelation length scale in areas with strong stratification would lead to unphysical subsurface temperature profile levin et al 2019 especially in the yellow sea in warm seasons where the stratification is strong due to the yellow sea cold water mass yscwm zhang et al 2008 lü et al 2010 with the small vertical decorrelation scale the tangent linear and adjoint model would play an important role in propagating error information vertically the horizontal decorrelation scales for the bc and fc were 100 km 2 3 assimilated observation the assimilated observation data are listed below as roms 4d var is unable to handle observations near the boundary observations less than 100 km from the boundary were excluded from da matthews et al 2012 sea surface temperature sst a daily gridded 0 25 0 25 blended product of satellite and in situ observations from the national oceanic and atmospheric administration noaa reynolds et al 2007 data sources include the advanced very high resolution radiometer avhrr ship observations and buoys due to data uncertainty sst observations that were less than 100 km from the coast were excluded from da ssh along track observations from multiple satellites were obtained from archiving validation and interpretation of satellite oceanographic aviso data supported by the centre national d etudes spatiales cnes the resolution of the along track data is about 7 km ssh data need to be corrected to ensure that the model and observations had the same reference sea level before assimilation powell et al 2008 besides as roms uses boussinesq approximation it cannot resolve sea level variation due to steric effects researches have revealed that the steric effects can be corrected with a spatial uniform time dependent η e t in a boussinesq ocean model greatbatch 1994 mellor and ezer 1995 griffies et al 2014 in a global model the steric height can be diagnosed from model output but in a regional model it has to be removed from the observations in this work the steric effects were diagnosed from the global hycom reanalysis storto et al 2019 and removed from observations sea level variation due to fresh water fluxes was diagnosed from era5 data and was neglected due to its small magnitude 10 4cm to correct the ssh data to model reference sea level the long term model mean dynamic topography mdt were calculated from the 10 year free run output and then the aviso sea level anomaly sla data with steric effects removed were added to the model mdt and the results plus appropriate tidal elevation were assimilated into the model to avoid adjusting tidal elevation predicted tides from harmonic analysis of model tides were added to the observations so that tidal signals need not be considered in da matthews et al 2012 janeković et al 2013 wilkin et al 2018 levin et al 2019 as ssh data in shallow water are known to be unreliable ssh observations that were less than 100 km from the coast and that were taken over water depths less than 150 m were excluded from da yuan et al 2007 hao et al 2021 currently roms 4d var has no time correlation in the observation error covariance as a result the assimilation of along track ssh data would excite gravity waves unless the observations persist with time to deal with this problem following matthews et al 2012 ssh observations at t 0 were replicated to t 0 6 t 0 4 t 0 2 t 0 2 t 0 4 and t 0 6 h with appropriate tidal elevations to suppress spurious gravity waves en4 a temperature and salinity profile dataset obtained from the met office hadley center good et al 2013 this dataset is quality controlled and includes profiles measured by argo conductivity temperature and depth ctd instruments expendable bathythermographs xbts from several sources such as argo global data assembly centres and the global temperature and salinity profile program gtspp the en4 dataset has a maximum of 400 levels in each profile profiles with more than 400 levels are thinned so that observations are spaced about 1 m apart in the upper 100 m of the ocean 10 m apart above 1500 m depth and 50 m below 1500 m observations with suspect depth values 11000 m are rejected cruise data the cruises were carried out by the institute of oceanology chinese academy of sciences iocas in the ecs and the yellow sea fig 2 the data include observations from two separate cruises one was carried out in warm season from may 25 2014 to jun 11 2014 the other covered the time period from october 17 2014 to november 8 2014 several transects were designed and temperature and salinity profiles were measured with shipboard ctd along these transects surface drifters six hourly interpolated ocean current velocities at 15 m depths and ssts measured by the drifter sensors are provided by the global drifter program gdp and obtained from https www aoml noaa gov phod gdp the current velocities are derived from 6 hourly interpolated drifter trajectories a drogue attached to the drifter makes it possible to measure ocean current velocities at a depth of 15 m to avoid adjusting tides a 36 h low pass filter was applied to the positions and velocities of drifters to remove tide signals and then the model predicted tides were added to drifter data ocean surface current analysis real time oscar oscar is a gridded diagnostic 5 day mean surface ocean current product with a resolution of 1 3 the product combines geostrophic currents derived from satellite ssh ekman currents inferred from surface winds stommel shear dynamics and a complementary term from the surface buoyancy gradient derived from sst alone bonjean and lagerloef 2002 the product provides mean ocean currents in the upper 30 m of the ocean and was assimilated into roms at a depth of 15 m model predicted tides are also added to oscar before da the observation errors are assumed to be uncorrelated so the observation error covariance is diagonal the assumption of uncorrelated observation error is reasonable especially for in situ observations but it might be questionable for satellite observations despite this it is commonly used in roms 4d var and many other da systems etherton and bishop 2004 moore et al 2011a waters et al 2015 baduru et al 2019 because some observations have high resolution than the model observations were first arranged into bins that correspond to model grid cell if multiple observations fall into the same model cell at the same time those observations were averaged to form super observations by doing this the sub grid feature which cannot be represented by the model was removed following matthews et al 2012 the observation errors were prescribed as follows 6 σ o max σ i n s t r σ s u p σ v a r where σ i n s t r is the instrumental error σ s u p is the observation standard deviation obtained when forming super observations and σ v a r is the geographical and temporal variability of each observation product the instrumental error σ i n s t r was set according to the literature and was 4 cm for ssh 0 4 c for satellite sst 0 1 c for in situ temperature 0 03 psu for in situ salinity 0 12 m s for oscar currents 0 04 m s for drifter velocities and 0 2 c for drifter sst moore et al 2011b li et al 2015 da rocha fragoso et al 2016 phillipson and toumi 2017 in the procedure of forming super observation if multiple observations fall into the same grid cell at the same time then σ s u p was assigned as the standard deviation of all the observations falling into the cell to calculate σ v a r the monthly maps of time variance of each observation product were generated on regular grids 0 25 0 25 for sst and ssh 1 3 1 3 for oscar 1 1 and a depth interval of 20 m for en4 1 1 for drifters using 20 year 2000 2019 observation statistics then σ v a r was assigned as the square root of the time variance in the monthly maps therefore σ v a r include seasonal variation σ v a r was then scaled to account for the spatial temporal variation of the representativeness error based on consistency check in section 2 4 and some preliminary experiments matthews et al 2012 kerry et al 2016 baduru et al 2019 for cruise ctd data on the continental shelf as there are no available long term observations σ v a r was scaled with model standard deviation following previous studies wilkin et al 2018 levin et al 2019 2020 in preliminary experiments it was found that σ s u p was much larger than σ v a r for ctd salinity observations so that observation errors were dominated by σ s u p which was much larger than the background error as a result the improvements of salinity errors were small therefore we only used σ v a r to set the observation error of cruise ctd salinity observations on the continental shelf background quality control was applied to eliminate bad observations or observations that are poorly represented due to model limitations neveu et al 2016 levin et al 2020 specifically if d i 2 α 2 σ b 2 σ o 2 then the observation is rejected here d i is the innovation associated with each observation and σ b and σ o are the background error standard deviation and observation error respectively the background quality control parameter α was set to 5 for ssh 4 for sst 4 for velocity and 6 for in situ temperature and salinity observations according to preliminary experiments and literature neveu et al 2016 levin et al 2019 the numbers of super observations in each 3 day assimilation window are shown in fig 2a with the distribution of in situ observations and surface drifters shown in fig 2b and fig 2c respectively most argo floats and drifters are in the open ocean and these data are supplemented by ctd xbt and cruise data near coastal seas fig 2b and fig 2c fig 2a also shows the number of rejected observations due to background quality control in each 4d var cycle on average only 0 71 of observations are rejected 2 4 consistency check of background and observation error covariance the 4d var algorithm will only work properly if the specified background and observation error covariance are correct to ensure this point a consistency check of the specified background and observation error covariance was done using the diagnostic tools described by desroziers et al 2005 and moore et al 2011b the diagnostic tools use the innovation vectors to project background and observation error into observation space specifically the diagnosed background and observation error variance can be expressed as 7 σ i b 2 1 p i j 1 p i y j a y j b y j o y j b 8 σ i o 2 1 p i j 1 p i y j o y j a y j o y j b where σ i b 2 is the diagnosed background error variance for observation type i σ i o 2 is the diagnosed observation error variance for observation type i p i is the number of observation for observation type i y j o y j a and y j b are the j th observation value analysis simulation value and background simulation value at observation location respectively fig 3 shows the time serials of the diagnosed background error σ b diagnosed observation error σ o specified observation error σ o specified background error σ b for sst ssh in situ temperature and salinity to be consistent with the diagnosed error the specified observation error σ o specified background error σ b were calculated as the square roots of the corresponding mean error variance for the same observation points as can be seen from fig 3 the specified and diagnosed errors are consistent within a reasonable range the diagnosed background error of sst has a seasonal variation and increases in summer while the specified background error has no such variation the observation error of sst is overestimated by approximately a factor of two the large prescribed observation error of salinity is associated with the cruise ctd observations on the continental shelf where the salinity variability is large the level of agreement between diagnosed and specified error is typical of that presented in previous studies moore et al 2011b matthews et al 2012 kerry et al 2016 indicating the specified background and observation error covariance are appropriate consistency check for other observations shows similar results not shown 2 5 observation impact method the observation impact method is described in detail in moore et al 2011a c this method has been used to evaluate observation networks in many marginal seas around the world moore et al 2017 powell 2017 kerry et al 2018 levin et al 2019 2020 2021 the impact of observations on the analysis can be quantified in terms of certain circulation metrics i x which are a function of the state vector with the aid of eqs 2 and 3 the analysis can be expressed as follows 9 x a x b δ x x b m t i t 0 δ z x b m t i t 0 kd then using taylor expansion the change in i x due to assimilation can be expressed as follows 10 δ i i x a i x b d t k t m t t 0 t i i x x b d t g where m t t 0 t i is the adjoint model that integrating the adjoint forcing backward to initial time as shown in eq 10 the observation impact consists of two terms the innovation d and the sensitivity g the innovation depends d on model forecast skills while the sensitivity g does not depend directly on observation and model forecast values detailed discussion will be shown in section 5 3 as the approximation of the kalman gain matrix k is saved when running 4d var the observation impact can be calculated with some additional computational cost 3 impact of 4d var on model skills in the ecs in this section the impact of 4d var on model skills in the ecs is evaluated the da experiments include consecutive 3 day da cycles spanning the whole year of 2014 in the 4d var algorithm the nonlinear simulation from the first guess model state is called background and the final nonlinear simulation after the adjustment of da is referred to as analysis the last snapshot of da analysis in each 4d var cycle was used as the ic of the next da cycle so the background simulation was actually a 3 day prediction initiated from da analyses of the last da cycle except the first da cycle 3 1 overall evaluation of 4d var performance the performance of 4d var is first evaluated by the reduction in cost function j fig 4 for most of the cycles j is reduced by 60 90 indicating that the minimization algorithm generally performs well the nonlinear cost function j n l is a measurement of the misfit between analysis and prior model background as well as the misfit between observations and nonlinear model estimates overall j agrees well with j n l which shows that the tangent linear approximation is appropriate in the 3 day da window but for some cycles the discrepancies become larger indicating stronger nonlinearity in those cycles neveu et al 2016 showed that the discrepancies may be attributed to the high resolution surface forcing which enhanced the nonlinear circulation effects in the model to evaluate the performance of the 4d var system a normalized error metric is used as follows carrier et al 2014 phillipson and toumi 2017 11 j f i t 1 n i 1 n y i o y i m e i where y i o is the observation y i m is the model value at the observation location and e i is the observation error j f i t is a dimensionless metric that measures the model and observation misfit normalized by observation error a value close to or less than 1 indicates good agreement between the model and observations table 1 shows the assessment of 4d var performance for each observation type the magnitude of j f i t depends on not only the model performance but also the prescribed observation error the reduced percentage of j f i t shows the improvement after da overall 4d var reduces model data discrepancies effectively for all variables for sst ssh in situ temperature and drifter temperature 4d var reduces more than 60 of the j f i t in the free run simulation the improvements for in situ salinity and velocity are not as significant but the reduced percentages still exceed 35 the background simulation shows the model forecast skills if the da analyses are used as ic for temperature observations sst in situ temperature and drifter sst the j f i t of the background simulation increases by more than 50 compared with that of the analysis simulation table 1 this suggests that the assimilated information would be lost rapidly in a 3 day forecast although the improvements of the analysis simulation compared with the free run simulation are significant for temperature observations for ssh observations the assimilated information would last longer with j f i t of the background simulation increasing by 42 compared with that of the analysis simulation for velocity and salinity observations the percentages are about 30 suggesting the assimilated information would mostly remain in the forecast 3 2 impact of 4d var on sst and ssh fig 5 shows the temporal variation and spatial distribution of simulated sst error metrics the error metrics include j f i t root mean square error rmse and bias j f i t and rmse of sst show similar variation the rmse of the analysis fluctuates at approximately 0 4 c suggesting a good sst assimilation performance the background simulation performance is generally between the free run and da analyses the average sst rmses are 1 04 c for the free run 0 61 c for the background simulation and 0 38 c for the analysis the free run has an apparently positive bias in summer and a negative bias from january to mid march in the da analysis the bias is corrected and the analysis becomes nearly unbiased throughout the year the sst shows large rmses on the ecs continental shelf around coastal seas and near the subpolar front in the east japan sea park et al 2004 2007 in the free run simulation and these errors can be significantly reduced after da fig 5d f similarly the ssh errors are significantly reduced after da fig 6 the model bias of the ssh fluctuates around zero and has no consistent trend fig 6c distinct from sst large rmses of ssh are mainly found in the open ocean and the rmses are reduced significantly after da fig 6d f the rmses in the stcc region in the free run simulation may be associated with mesoscale eddies there chelton et al 2011 which cannot be accurately predicted by the free run model however it is captured by the analysis simulation a large rmse is also present near the kuroshio south of japan where meanders were frequently observed the formation of meanders in the kuroshio extension region was found to be closely associated with mesoscale eddies mitsudera et al 2001 miyazawa et al 2008 qiu and chen 2010a thus the predictability of meanders is also affected by mesoscale eddies in summary the large sst errors occur near the coast and the frontal zone in the east japan sea large ssh errors are associated with mesoscale variability such as mesoscale eddies and kuroshio meanders these errors can be reduced significantly by 4d var 3 3 impact of 4d var on vertical profiles of temperature and salinity fig 7 shows the profiles of bias and rmse of temperature and salinity averaged in 2014 as the structures of vertical profiles are distinct on the continental shelf and in the open ocean two regions are chosen to show their respect vertical structures polygon a in fig 2 for the ecs continental shelf and box b for the open ocean the model generally shows a negative temperature bias in the open ocean with two peaks of bias in the subsurface layer and near 500 m fig 7a an inspection of the free run model shows that the negative bias is mainly attributed to the bias in the hycom initial condition not shown the vertical structure temperature rmse profile agrees well with the temperature bias and great improvement can be observed after da in the upper 800 m of the ocean fig 7b on the continental shelf the structure of bias is different the largest error of temperature is present below 30 m on the continental shelf with significant improvement after da for salinity profiles the vertical structures of errors are very different in the open ocean and on the continental shelf salinity bias is small in the open ocean less than 0 1 psu for most part of the vertical profile fig 7e however on the continental shelf a large positive bias is present at sea surface fig 7 g large values of salinity rmses are present near surface layer in both regions but the magnitude of rmse is different fig 7f h da reduces salinity rmses effectively in both regions 4 impact of including tidal forcing in 4d var in this section the impact of including tidal forcing in 4d var is investigated by comparing two experiments with and without tidal forcing as the important role of tidal forcing in the ecs has been documented by many previous results qiao et al 2006 lü et al 2007 moon et al 2009 lü et al 2010 wu et al 2018 this work focuses on the impact of tidal forcing on modelling of sst and temperature profiles using 4d var preliminary experiments showed that the difference induced by tidal forcing was significant in warm season on the ecs continental shelf to reduce computational cost the 4d var experiment without tides only runs from may 1 2014 to the end of august 2014 the configuration of 4d var experiment without tides was the same as that with tides except that the tidal signals were excluded from ic bc and observations the result of free run without tide on may 1 2014 was used as the initial condition of 4d var experiments without tides for simplicity the experiments with and without tides are referred to as expt and expnt below fig 8a shows the bias of sst on the ecs continental shelf in the warm season of 2014 for free run background and analysis simulations in expt and expnt in the free run of expnt the model shows positive bias on the continental shelf red dashed line in fig 8a the bias is 1 31 c on average this bias is significantly reduced in the free run of expt red solid line in fig 8a the bias is 0 75 c on average the results are reasonable as tidal forcing can increase vertical mixing induce upwelling and lead to cold patches of sst in the yellow sea as revealed by previous studies lü et al 2007 2010 after da the positive bias in the analysis simulation is significantly reduced in both experiments blue solid and dashed lines in fig 8a and the analysis simulation of expnt has slightly larger positive bias than that of expt 0 08 c 0 06 c on average for analysis simulation of expnt expt as mentioned above the background simulation is a 3 day forecast using the analysis as ic so the background simulation indicates the forecast skills of the model the background simulation of expt has smaller bias than that of expnt orange solid and dashed lines in fig 8a the averaged bias is 0 41 c 0 28 c for background simulation of expnt expt indicating that including tidal forcing improves the sst forecast skills fig 8b shows the profiles of vertical temperature bias for the cruise ctd observation in the warm season of 2014 from may 25 to june 11 in 2014 on the ecs continental shelf generally the free run of expnt shows positive bias on the continental shelf red dashed line in fig 8b including tidal forcing reduces the positive bias of vertical temperature profile especially near surface layer red solid line in fig 8b however the background simulation of expt and expnt show distinct bias in expnt the background simulation shows negative bias in the temperature profile orange dashed line in fig 8b while in expt the bias remains positive for most part of the profile orange solid line in fig 8b the negative bias of temperature in the background simulation of expt has important impact on the vertical stratification which will be discussed below in the analysis simulation the bias is reduced in both experiments so why the background simulation of expt shows better forecast skills of sst why the background simulation of expt and expnt show different bias in the vertical temperature profile to interpret the above results the vertical profiles of brunt vaisala frequency and temperature vertical diffusion coefficients are shown in fig 9a the profiles are averaged for the background simulation over the continental shelf polygon a in fig 2 during the cruise time period in the warm season of 2014 from may 25 to june 14 in 2014 fig 9a shows the background simulation of expnt has larger brunt vaisala frequency than that of expt thus the coastal seas are more stratified as tidal forcing will increase vertical mixing it is a reasonable result that the lack of tidal mixing will make coastal seas more stratified what is more in warm season stronger stratification will prevent heat from solar radiation transferring downward melet et al 2022 which will in turn strengthen the stratification of coastal seas the feedback between stratification and downward heat flux will make the temperature in expnt higher near the sea surface and lower below the mixed layer upper 10 m according to fig 9a compared with that in expt as shown in fig 8 on the other hand the temperature vertical diffusion coefficients are larger in expt than in expnt below the mixed layer indicating the effect of tidal mixing the relative importance of stratification and tidal mixing to vertical mixing varies with depth as stratification is stronger in the upper layer this effect works mainly in the upper 20 m strong stratification in expnt prevents heat flux from transferring downward so more heat is trapped in the mixed layer making the mixed layer warm in expnt in contrast as tidal mixing is bottom intensified the contribution of tidal mixing is mainly below the mixed layer according to the temperature vertical diffusion coefficients shown in fig 9a note fig 9 shows the average profile over the continental shelf due to the different water depths in different regions the tidal mixing is important in all depth below the mixed layer in the averaged profile to further illustrate the question the corresponding profile of vertical heat budget is shown in fig 9b the heat budget equation can be written as follows 12 t t t e n d e n c y v h h t h a d v w t z v a d v d t h d i f f z k t t z v d i f f where t is temperature v h is horizontal velocity w is vertical velocity and k t is the vertical temperature diffusion coefficient the surface boundary condition is 13 k t t z q c ρ 0 c p where q c is surface heat flux ρ 0 is reference density and c p is specific heat at constant pressure the bottom boundary condition is 14 k t t z 0 the heat budget profile is averaged over the same area for the same time period as the profiles in fig 9a using the diagnostics module of roms the heat budget was first calculated as the 3 day average of each da window then the results of all the cycles were averaged to get the final heat budget profile the steps were used to ensure the heat budget was closed during this period the basin scale warming is evident from the temperature tendency black lines in fig 9b the vertical diffusion term is the major contributor of the warming tendency and it is responsible for transferring the positive surface heat flux downward the horizontal advection and vertical advection balance each other and the combination of the two terms also contribute to part of the warming tendency the horizontal diffusion term is negligible compared with the other terms after a comparison between expt and expnt it is found that the vertical diffusion term is stronger in expnt in the mixed layer which suggests heat flux is trapped in the mixed layer due to strong stratification making the mixed layer warmer in contrast the vertical diffusion below mixed layer in expnt is weaker than that in expt the larger vertical diffusion in expt is probably due to tidal mixing it is noteworthy that the horizontal and vertical advection terms shows difference between expt and expnt suggesting the modulation of tides on mean circulation in summary although the analysis simulations in expt and expnt have similar performance in sst the background simulation 3 day forecast initiated from da results of expnt has larger positive bias in sst than that of expt expnt has negative bias in subsurface temperature profile the biases in expnt are attributed to stratification and tidal mixing the relative importance of the two factors varies with depth 5 observation impact on kvt and koi in this work two circulation metrics kvt and koi are used to evaluate observation impacts following yang et al 2012 kvt is defined as the volume transport in the upper 500 m layer through a cross section east of taiwan red dashed line in fig 1 koi is defined as the volume transport through the 200 m isobath northeast of taiwan red solid line in fig 1 where most of the onshore intrusion occurs liu et al 2014 5 1 time series and statistics of observation impact the time series of kvt and koi from the background and analysis simulation are shown in fig 10 generally the corrections made by 4d var are small this feature is desirable as small increments are necessary conditions for linear assumptions most of the kvt corrections are negative suggesting that the background simulation may overestimate the kvt the time series of the observation impact calculated from eq 10 referred to as the tangent linear impact is also shown in fig 10 which generally shows good agreement with those calculated from the nonlinear model indicating that the tangent linear assumption is reliable the correlation coefficient between the nonlinear model observation impact and tangent linear impact is 0 99 for kvt and 0 95 for koi which suggests that the nonlinearity of koi is stronger than that of kvt this result is appropriate because koi is affected by both the local wind forcing and the interaction of the kuroshio with steep topography guo et al 2006 the time series of observation impacts for each 4d var cycle are shown in fig 11 the rms and average percentage of observation impact of ic bc and fc for each 4d var cycle are presented in table 2 as there are positive and negative impacts the percentages are calculated in terms of the absolute value of the observation impact kerry et al 2018 the ic has the largest observation impact on both kvt and koi table 2 the fc accounts for less than 6 of total impact the bc accounts for 27 of the total impact on kvt and 34 78 on koi the results indicate that remote forcing are more import for kvt and koi than local forcing as kvt is mainly controlled by basin scale wind stress curl and this remote forcing takes the form of bc in a regional model it is reasonable result that adjusting bc will have a large impact on kvt because kvt and koi are closely related adjusting bc will also influence koi liu et al 2014 the observation impact of each observation type is shown in fig 11c d and table 3 considering the different observation numbers the observation impact per datum for each observation type is also shown in table 3 the observation impacts of u and v are averaged for simplicity for both kvt and koi sst ssh and in situ temperature are the most impactful observations and their impact accounts for more than 85 of the total impact notably the in situ temperature observation impact per datum is much larger than other observations the observation impact per datum is comparable for in situ s oscar and drifter data but due to the very limited number of drifter data the total impact of drifter data is nearly negligible 5 2 spatial distribution and vertical profile of observation impact fig 12 shows the spatial distribution of observation impacts on kvt and koi for the three observation types with the largest observation impact ssh sst and in situ temperature the observation impacts on kvt and koi show similar spatial distribution but differ in magnitude the similarity indicates that kvt and koi are closely related as revealed by liu et al 2014 for sst and ssh the largest observation impacts are present near the cross section where kvt or koi is defined large observation impacts can also be observed along the kuroshio path extending from the northeast of taiwan to the southwest of japan for in situ temperature observations the distribution pattern of observation impact is a little noisy and more observations are needed in future studies to give statistically more reliable results in spite of this limitation the distribution pattern of in situ temperature is similar to that of sst large observation impact can also be observed along the kuroshio path the remote upstream and downstream distribution of high observation impact was also noticed by kerry et al 2018 the reason why observation impact would show such a spatial distribution will be analysed in section 5 3 fig 13 shows the vertical profiles of observation impacts of in situ temperature and salinity for kvt in situ temperature has two peaks of observation impact one is in subsurface layer at around 40 m the other at about 400 m solid red line in fig 13a in situ salinity observations only have large impacts above the upper 100 m solid blue line in fig 13a as for observation impact per datum in situ temperature have maximum value at about 400 m and in situ salinity have maximum value near sea surface dashed lines in fig 13a for koi in situ temperature has strong observation impact peak in subsurface layer at about 40 m the other peaks below are relatively weak compared with observation impact on kvt vertical profiles of in situ salinity are similar for kvt and koi to interpret the vertical profile of observation impact the observation impacts are separated into two terms according to eq 10 the innovation d and sensitivity g and the results are shown in figs 13b and 13d innovation d represents the difference between the observation value and background model value at observation location the innovation d depends on model forecast skills and the innovation will be large where the model prediction deteriorate rapidly the temperature innovation d has strong peak in the subsurface layer near 100 m depth the reason might be associated with the relatively poor model forecast skills in predicting the variability of thermocline besides the assimilated sst observations provide constraint of sst preventing it from deviating too far from the observation as a result the largest innovation would occur in subsurface layer instead of at sea surface the large value of salinity innovation near sea surface is probably caused by coastal salinity bias fig 7 g and 7 h the sensitivity g shows fluctuation with depth and has slightly large values in the middle level 300 1300 m depth the interpretation of sensitivity g is complicated and examples will be shown in section 5 3 the relatively large sensitivity g might also be associated with relatively sparse observation density in the middle level see section 5 4 for further discussion the vertical structure of observation impact is determined by the combination of both terms the subsurface peak of observation impact of temperature is attributed to the peak of innovation d for koi the observation impact is mainly determined by innovation d since the vertical profile of sensitivity g does not vary much with depth 5 3 interpretation of the observation impact spatial distribution due to the similar spatial distribution patterns of observation impacts on kvt and koi only the results of kvt are analysed observation impacts of sst and ssh are explored due to the good data coverage as discussed in section 5 2 the observation impact consists of two terms the innovation d and sensitivity g the rmss of innovation d and sensitivity g for kvt are shown in fig 14 compared with figs 12a and 12b it is found that both d and g contribute to the distribution patterns of observation impact large innovations usually occur where model forecast skills degrade very quickly large innovation of sst can be seen in the east japan sea on the ecs continental shelf and in coastal seas large innovation of ssh is present near the boundary and also in the east japan sea the distribution patterns of sensitivity g are different from those of innovation d to interpret the distribution of g g can be expressed as g gd g t r 1 gd m t t 0 t i i x x b with the aid of eqs 4 and 10 fig 15 shows the results of each step of calculating g for ssh so that the main factor controlling the spatial distribution can be identified the spatial distributions are averaged over all da cycles fig 15a shows the distribution of m t t 0 t i i x x b which is obtained by integrating the adjoint model backward to initial time forced by the functional i x x b this step is actually an adjoint sensitivity analysis veneziani et al 2009 as the circulation metric i only depends on meridional velocity i x x b is zero everywhere except along the cross section used to define kvt on the meridional velocity grid the most remarkable feature in fig 15a is the wave like pattern indicating how the information propagate in space previous studies mentioned the roles of different dynamics in spreading the assimilated information moore et al 2015 used information horizons to address the question considering the main dynamic processes of advection diffusion and wave propagation the maximum distance each process can propagate in the assimilation window can be estimated by its propagation speed for example assuming an average kuroshio current speed of 1 m s in a 3 day assimilation window the assimilated information can travel nearly 260 km thus only observations near taiwan can influence kvt through advection the fastest baroclinic waves are the inertial gravity waves which propagate at the first baroclinic mode phase speed and have the maximum phase speed of 3 m s in this region chelton et al 1998 so it can travel 780 km in the open ocean the barotropic gravity wave represents the fastest wave mode and can potentially influence any part of the whole domain the output from the adjoint model was checked to see how the assimilated information spread in model space through multiple processes as the adjoint forcing functional i x x b is constant the results of the adjoint model are similar for different da cycles the three major routes of wave propagation are shown by arrows in fig 15a the arrow shows wave propagation direction when the adjoint model is integrated from the end of da window to initial time the first routes marked by a shows the signal propagates through external gravity waves on the continental shelf the routes b shows the kelvin like waves along the ryukyu island chain in the open ocean multiple waves such as barotropic waves rossby waves baroclinic inertial gravity waves marked by arrow c might be responsible for the transferring of assimilated information the waves generally weakens as they propagate further apart from waves other processes such as advection and diffusion are also important and the impacts of these processes are confined around the cross section used to define kvt so they are responsible for the strong signals around the cross section another feature in fig 15a is that negative values are present mainly on the continental shelf and positive values mainly appear in the open ocean as kuroshio current is mainly geostrophic flow kvt is largely controlled by the sea surface slope across the main stream of the kuroshio yan et al 2016 thus a negative increment of ssh on the continental shelf or a positive increment on the right side of kuroshio will lead to an increase in kvt the results of d m t t 0 t i i x x b after a multiplication by the background error covariance d are shown in fig 15b this operation has the effects of spreading the information in space within decorrelation scales so the fields obtained from last step are smoothed after the operation the prior uncertainties are also taken into consideration in d with the aid of standard deviation matrix σ in eq 5 as a result where the standard deviations are small d will lower the weight of the corresponding signal and vice versa for example the signals on the continental shelf in fig 15b become relatively weak as a result of low standard deviations of ssh in fig 16a the signals in the open ocean and near tokara strait marked by the letter d are amplified which correspond to the large standard deviation in fig 16a the next step is to integrate the tangent linear model forward and sample at observation location so that g d m t t 0 t i i x x b is obtained to better illustrator how the spatial pattern evolve the operator g is replaced by m which means integrating the tangent linear model to the end of the da window and the results are shown in fig 15c without the forcing functional signals from the last step are advected or propagate under the constraint of model dynamics on the continental shelf the direction of wave propagation is opposite to that in the adjoint model marked by the arrows in fig 15c the large values east of taiwan further spread out by multiple waves the last step is a multiplication by the inverse stabilized representer matrix gd g t r 1 which removes the total prior covariance between the observation locations it is found that gd g t r 1 account for much of the spatial patterns of g which has been noticed by levin et al 2019 in this step regions with large observation error are penalized and g is reduced this is apparent in the open ocean east of rukyu island fig 15d and fig 16c the spatial distribution of sensitivity g for sst can be interpreted in a similar way fig 17 but fig 17 shows some different features from ssh in the result of m t t 0 t i i x x b fig 17a the external gravity waves have little impact in the yellow sea and bohai sea probably because the shallow waves decrease with depth vallis 2017 which are unable to penetrate the mixed layer in contrast in the open ocean as the adjoint forcing extends to 500 m deep water waves are able to induce large temperature variation in the result of fig 17a another important feature is the large adjoint sensitivity along the boundary in fig 17a similar phenomenon was also found in the adjoint analysis of veneziani et al 2009 according to their study the strong adjoint sensitivity is attributed to waves propagating along the boundary which results from the type of boundary condition clamped boundary condition and the regional nature of the model due to the strong adjoint sensitivity along the boundary roms 4d var is unable to handle observations near the boundary after the multiplication by the background error covariance d the strong signals along the kuroshio path remain and the signals near the boundary are significantly reduced fig 17b the next step is the tangent linear model integration in which the signals spread further through short length scale waves fig 17c after a multiplication of gd g t r 1 the signals along the kuroshio are enhanced due to the small observation error along the kuroshio fig 16d and fig 17d 5 4 discussion of observation impact in summary the distribution of observation impact is controlled by several factors 1 model forecast skills the factor control the observation impact through the innovation vector d 2 dynamic processes responsible for the transferring of assimilated information different waves transfer the assimilated information in different regions which regulates the spatial distribution of observation impacts 3 background and observation error covariance large background error will enhance the sensitivity g while large observation error will be penalized and the sensitivity g will be reduced as a result due to the important role of error covariance a consistency check as in section 2 4 is needed to ensure the specified background and observation error covariance are appropriate tracking how the assimilated information propagate in space helps to advance the understanding of the dynamics in ecs various waves play important roles in transferring assimilated information so understanding the characteristics of the waves are important due to the assumption of uncorrelated observation error the observation impacts are not independent of other observations for example the decorrelation scale of satellite data are typically large if the satellite observations are sampled at a larger spatial interval the observation impact per datum may increase since each observation can provide more additional information similar conclusion may also be true for the vertical structure of in situ observations since more observations are available near sea surface compared with in deeper levels the observation impact per datum may be smaller near sea surface as shown in fig 13 and section 5 2 oscar and ssh share some satellite data source so if either type of observation is removed the observation impact of the other type is expected to increase 6 summary in this work the impact of 4d var da on modelling of the ecs dynamics is investigated the unique capability of adjusting ic bc and fc in roms 4d var makes it a powerful tool to simulate processes associated with both local and remote forcings as the strong tidal forcing in the ecs plays important roles in the ecs shelf circulation tidal forcing was included in 4d var and the impact of tidal forcing was investigated by comparing two experiments with and without tidal forcing the assimilated data in this study include sst ssh in situ temperature and salinity profiles as well as surface drifters and a surface ocean current analysis oscar overall 4d var performs well in reducing model data misfit for all observation types the main error sources of the model are identified by comparing with the observations and 4d var is very effective in reducing these errors the largest sst errors are present near the subpolar front in the east japan sea on the continental shelf and in coastal seas the largest ssh errors are associated with the abundant mesoscale eddies in the stcc region and kuroshio meanders the accurate time and location of these signals cannot be well predicted by a free run model due to the instability process and 4d var is very effective in assimilating these mesoscale signals compared with experiments with tides the absence of tidal forcing will make temperature higher near sea surface and lower below mixed layer on the continental shelf in the background simulation 3 day forecast using da results as ic the difference in temperature profile is associated with two factors stratification and tidal mixing the importance of the two factors varies with depth using a first order taylor approximation the observation impacts on koi and kvt are evaluated with the aid adjoint models ic always has a larger impact than bc and fc and bc accounts for approximately 27 of the total impact on kvt and 34 78 on koi fc has less than 6 of the total impact on kvt and koi suggesting the two metrics rely more on remote than local forcings sst ssh and in situ temperature account for most of the observation impacts and in situ temperature is several times more impactful per datum than other observations the observation impact per datum is comparable for in situ s oscar and drifter data but the total impacts of surface drifters are very small due to the limited observation number the geographical distribution of observation impact shares similar features for different observation type the largest observation impacts are present near the cross section used to define kvt or koi a band of large observation impacts extends along the kuroshio path from the northeast of taiwan to the southwest of japan the vertical profile of in situ temperature observation impact shows two peaks of observation impact one is in subsurface layer at around 40 m the other at about 400 m in situ salinity observations only have large impacts above the upper 100 m several factors controls the geographical distribution of observation impact which include the model forecast skills the dynamic processes that are responsible for the transferring of assimilated information and the specified error covariance different waves transfer the assimilated information in different regions which regulates the spatial distribution of observation impacts tracking how the assimilated information propagate in space helps to advance the understanding of the dynamics in ecs this work is an overall assessment of 4d var performances in the ecs the results show that including tidal forcing in 4d var improves the model performance on the ecs continental shelf the observation impact on the most important western boundary current in this region the kuroshio is investigated the results reveal the most impactful observations and how the assimilated information propagate through wave dynamics these findings advance our understanding of the dynamics associated with the kuroshio current and the ecs due to data availability most of the data are publicly available through the internet except the cruise data provided by iocas in spite of this limitation this work could provide a reference for building operational ocean forecasting systems because of the large costs of building and maintaining ocean observation networks it is valuable to assess observation networks before deployment in future work the observation impact method could be used in observing system simulation experiments osses in which synthetic observations generated by one model can be assimilated into another model to evaluate the possible impact of potential observations oke et al 2009 fujii et al 2019 therefore a design scheme of the observation network could be assessed at a minimum cost without the need to repeatedly run da experiments credit authorship contribution statement zhiwei he conceptualization methodology formal analysis visualization writing original draft writing review editing dezhou yang conceptualization resources writing review editing supervision funding acquisition yonggang wang writing review editing supervision baoshu yin supervision funding acquisition declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgements this study was supported by the national natural science foundation of china nos 92158202 41876019 and 42076022 the strategic priority research program of the chinese academy of sciences nos xdb42000000 xda19060203 and xda19060202 the key deployment project of centre for ocean mega research of science chinese academy of sciences no coms2020q01 the nsfc shandong joint fund for marine science research centers u1806227 the marine s t fund of shandong province for pilot national laboratory for marine science and technology qingdao no 2021qnlm040001 and no 2022qnlm010302 and the cas csiro bau project no 133137kysb20180141 it was also supported by the high performance computing center at the iocas yellow sea east china sea ocean observation and research station of omorn all the assimilated data are publicly available from the internet except the cruise data from iocas we thank all the efforts for making the data available on the internet 
23829,a high order hybrid continuous galerkin numerical method designed for the simulation of non linear non hydrostatic internal waves and turbulence in long computational domains with complex bathymetry is presented the spatial discretization in the non periodic wave propagating directions utilizes the nodal spectral element method such a high order element based discretization allows the highly accurate representation of complex domain geometry along with the flexibility of concentrating resolution in areas of interest under the assumption of the normal to isobath propagation of non linear internal waves a third periodic direction is incorporated via a fourier galerkin discretization the distinct non hydrostatic nature of non linear internal waves and any instabilities and turbulence therein necessitates the numerically challenging solution of the pressure poisson problem a defining feature of this work is the application of a domain decomposition approach combined with block jacobi deflation based preconditioning to the pressure poisson problem such a combined approach is particularly suitable for the long high aspect ratio complex domains of interest and enables the efficient high accuracy reproduction of the non hydrostatic dynamics of non linear internal waves implementation details are also described in the context of the stability of the solver and its parallelization strategy a series of benchmarks of increasing complexity demonstrate the robustness of the flow solver the benchmarks culminate with the three dimensional simulation of a convectively breaking mode one non linear internal wave over a realistic south china sea bathymetric transect and background current stratification profiles keywords spectral methods domain decomposition deflation non linear internal waves 1 introduction 1 1 non linear internal waves and turbulence non linear internal waves nliws in the ocean are at the receiving end of the cascade of energy originally injected into the water column by winds and tides alford et al 2015 egbert and ray 2000 propagating over long distances nliws dissipate and mix the water column along their propagation path and deposit energy away from their generation site through breaking as a result of turbulence and instabilities in wave interior and wave seafloor interactions rivera rosario et al 2017 boegman and stastna 2019 inherently strongly non linear and non hydrostatic phenomena nliws are often encountered in the form of mode one internal solitary waves isws of depression characterized by a precarious balance between their non linearity and physical dispersion the breaking of an isw is a process of critical significance to ocean energetics where the associated turbulence and mixing are induced via either a shear instability moum et al 2003 or a convective instability lien et al 2012 2014 lamb et al 2019 as they shoal into shallower coastal waters the simulation of a shoaling isw over an actual bathymetry poses a challenge to state of the art numerical modeling essentially the wave scale response to the bathymetry given the particular background shear and stratification has to be effectively captured over long propagation distances without being spuriously altered by numerical dispersion and dissipation furthermore the numerical discretization has to be carefully chosen for any finer scale motions developing within the simulated wave to be as close as possible to their oceanic counterparts by reproducing for a given grid resolution the broad range of scales within a turbulent flow occurring inside the wave 1 2 high order element based techniques in this regard high accuracy pseudo spectral discretizations have emerged as powerful approaches for simulating stratified flows aside from triply periodic discretizations de bruyn kops 2015 winters et al 2004 features such as complex boundary conditions and geometries necessary for the simulation of nliws have been recently developed for fourier based winters and de la fuente 2012 and chebyshev collocation techniques subich et al 2013 an alternative to global spectral discretizations such as those discussed above are high order element based techniques sporadically used for the simulation of stratified flows diamessis et al 2005 rivera rosario et al 2020 özgökmen et al 2004 high order element based discretizations are attractive for the simulation of nliws and their resultant instabilities turbulence since they support the exponential convergence of global spectral methods with the inherent flexibility of elemental discretizations that can localize resolution in areas of interest deville et al 2002 kopriva 2009 as such high order element based discretizations are a powerful potential alternative to adaptive mesh refinement techniques barad et al 2009 santilli and scotti 2015 in this study a continuous galerkin spectral element method sem patera 1984 is used for discretizing the along wave propagation and vertical directions as well as representing any complex topographic features by employing curvilinear quadrilateral elements first localized flow resolution in the vertical allows the reliable representation of background stratification and currents along with any finer scale motions in wave interior typically concentrated in the upper layer of the water column for isws of depression lien et al 2012 or at the bottom boundary when studying their bottom boundary layer induced by the wave sakai et al 2020a b second as in the case for a convectively breaking shoaling isws grid resolution in the along wave propagating direction is increased in the breaking region i e shallower waters while remaining coarse in deep waters enabling a reduction to the computational cost compared to the uniform grid case lastly by adhering to a high polynomial order n 7 within each element the smallest resolved scales are not numerically damped as any artificial dissipation is minimized at these scales for the particular resolution in tandem a high polynomial order also ensures that any error introduced by the commonly used linear interpolation of the bathymetry is avoided steinmoeller et al 2016 it is worth noting that high polynomial orders introduce minimal numerical dispersion which does not artificially impact the physical dispersion of the wave this is essential for preserving the isw s waveform over long propagating distances and ensuring that any numerical phase errors which may lead to the development of artificial trailing waves are mitigated note that the authors have established a significant knowledge base in the context of high order element discretizations through the adaptation and implementation of the spectral multidomain penalty method smpm i e a discontinuous collocation based numerical method hesthaven 1998 escobar vargas et al 2014 diamessis et al 2005 in the framework of the incompressible navier stokes equations inse nonetheless on account of its inherently discontinuous nature the smpm is found to develop elevated spurious divergence at the elemental interfaces for highly under resolved simulations joshi et al 2016a consequently the spatial discretization is replaced by the sem i e a weak form based continuous numerical method 1 3 pressure poisson equation a crucial aspect of implementation which has to be addressed when using a high order element wise discretization for the inse is the numerical linear algebra associated with the solution of the pressure poisson equation ppe which is essential for the accurate reproduction of non hydrostatic dynamics joshi et al 2016b scotti and mitran 2008 lamb et al 2019 admittedly the most computationally costly part of an inse solver the ppe solver design is constrained by the leptic grids scotti and mitran 2008 which are inherited from the high aspect ratio nature of nliws and the long shallow computational domains connected to their propagation properties consequently when simulating nliws the ppe solver to be used and its adopted preconditioning strategy need to carefully take into account these design considerations to achieve convergence with the minimum number of iterations possible as such the numerical solution of the pressure poisson problem in this work is broken down into the following steps first the discretized ppe is reformulated via the use of multi level static condensation iterative substructuring couzy and deville 1995 karniadakis and sherwin 2013 a domain decomposition technique which takes into account the geometry of the discretization and local support of the elemental basis functions canuto et al 2007 this domain decomposition approach which leads to a smaller global system of equations is one of the main advantages of the sem when solving an elliptic equation compared to other high order galerkin discretizations yakovlev et al 2016 hence the discretized system of equations is condensed via block gaussian eliminations into a hierarchy of smaller schur complement problems where each matrix division takes place locally except for the last level of the condensation secondly the last schur complement problem is solved iteratively via a two level deflated preconditioned conjugate gradient solver based on the work of joshi et al 2016b albeit for a symmetric discretization in this case deflation enchanced by a block jacobi preconditioner is an effective preconditioning approach irrespective of the grid s aspect ratio number of elements used and polynomial order of the approximation 1 4 hybrid element based fourier numerical methods the extension of the sem two dimensional solver and the respective ppe computational kernel into three dimensions is guided by in situ observations regarding the propagation of nliws lien et al 2012 2014 since the propagation of nliws may be reasonably approximated as operating along a trajectory normal to the isobaths an additional third periodic direction is incorporated via a fourier galerkin fg discretization kopriva 2009 although hybrid sem fg have been developed in the past karniadakis 1990 moxey et al 2020 blackburn et al 2019 to the best of the authors knowledge a high order hybrid sem fg discretization specifically designed for high aspect ratio complex long domains combined with a robust ppe preconditioning strategy has yet to appear in the literature 1 5 implementation the development of a new solver is not a light undertaking and requires significant resources to develop a method scalably implement the technique verify correctness and maintain the tool over its lifetime so that it is both flexible and performant as such utilizing or adapting existing high performance frameworks balay et al 2021 paul f fischer and kerkemeier 2008 moxey et al 2020 for one s application is the obvious and best approach for most while a fully three dimensional element based discretization in the form of hexahedral or tetrahedral elements offers a more general framework the discretized three dimensional sem operator has a larger condition number than its two dimensional counterpart canuto et al 2007 in addition to the increased iteration counts of the conjugate gradient solver used for the ppe and viscous diffusive solves cf section 1 3 the work done per iteration increases as the elemental matrix is proportional to the problem size o n 3 where n is the order of the polynomial expansion per element in the flow solver considered in this paper the choice of a two dimensional discretization motivated by physical considerations enables the use of an identical computational grid for of each transverse plane as such each x z plane may be solved concurrently rather than having to resort to the fully coupled solve of its three dimensional counterpart to best of the authors knowledge there are no existing solvers that allow exploitation of high aspect ratio long domain physics of interest and thus creating sem fg in terms of discretization and implementation to solve loosely coupled two dimensional subproblems was a necessary path forward from an implementation standpoint the predecessor smpm flow solver uses a one dimensional parallelization strategy joshi et al 2016b where a subset of the computational domain in the x direction is assigned to each parallel process this choice restricts the overall resolution and parallel scalability for three dimensional simulations therefore in the newly developed sem flow solver the parallelization strategy takes place in two dimensions enabling the use of much larger number of parallel processes with the associated decrease of the memory footprint per parallel process 1 6 paper structure this paper is organized as follows in section 2 the main model equations are presented section 3 presents the implicit explicit stiffly stable splitting scheme of the inse along with the necessary implicit solves needed to integrate the field variables in time section 4 discusses the spatial discretization and the associated domain decomposition and preconditioning strategies adopted for the pressure poisson problem along with a brief discussion of the viscous term treatment section 5 discusses the implementation of the discretization and analyzes its major components to understand its potential performance bottlenecks and scalability section 6 covers the stabilization techniques used in the sem fg discretization in section 7 a series of unstratified and stratified benchmarks are shown with the latter culminating in the simulation of a convectively breaking shoaling isw thereby demonstrating the efficacy of the flow solver section 8 consists of the concluding remarks 2 equations of motion the equations of motion of an incompressible fluid under the boussinesq approximation are typically written as 1 u t u u g ρ 0 ρ k 1 ρ 0 p ν 2 u 2 ρ t u ρ ρ κ 2 ρ 3 u 0 where u is the velocity vector field with components u v w in the x y z directions respectively for stratified flows the horizontal velocity component u is decomposed into a fluctuating u and a steady state background current u u z which leads to the following notation 4 u u u w w v v where the prime symbol denotes the deviation of the velocity field from the background state ρ 0 is the reference density g is the gravitational acceleration and k is the unit vector in the upward positive vertical direction in the momentum equation 1 p is the pressure perturbation from the background hydrostatic pressure and ν κ are the molecular diffusivities which are assumed to be constant note that the representation of the viscous terms i e vector laplacian is a direct result of incompressibility diamantopoulos et al 2021 additionally ρ is the density perturbation which originates from the decomposition kundu and cohen 2008 5 ρ ρ 0 ρ x y z ρ x y z t with ρ ρ ρ 0 where ρ is the background density 3 time discretization the semi discrete equations which arise from the velocity projection scheme karniadakis et al 1991 are comprised of three fractional steps treated separately and in succession 1 the advective non linear term 2 the pressure and 3 the viscous term 3 1 non linear term the non linear term is advanced in time using an explicit extrapolation j 3 karniadakis et al 1991 where an intermediate velocity field u is obtained 6 u i 0 j 1 α i u n i δ t i 0 j 1 β i u n i u n i g ρ 0 ρ n i k where α i and β i are the respective time stepping coefficients which depend on the time discretization order and time step δ t for a variable time step peyret 2002 details regarding the spatial discretization and implementation of the non linear term are provided in appendix b 3 2 pressure poisson equation and projection step the equation for the pressure arises from the time advancement of the first intermediate velocity field u into a second intermediate divergent free velocity field u ˆ ˆ 7 u ˆ ˆ u δ t p n 1 where p is the temporal mean of the pressure perturbation calculated over one time step not to be confused with the instantaneous pressure diamessis et al 2005 eq 7 can be reformulated as 8 1 δ t u ˆ ˆ p n 1 1 δ t u the equation above is effectively the helmholtz decomposition of the first intermediate velocity field u into a solenoidal vector field u ˆ ˆ and an irrotational vector field p n 1 taking the divergence of eq 8 a poisson equation arises for the pressure 9 2 p n 1 1 δ t u the consistent boundary conditions for the pressure poisson equation aimed towards ensuring o δ t 2 accuracy of the time discretization scheme are specified in karniadakis et al 1991 once the pressure is computed the second intermediate velocity u ˆ ˆ is computed from the projection 10 u ˆ ˆ u δ t p n 1 3 3 viscous equation the evaluation of the velocity field at the next time step is computed implicitly by solving a vector helmholtz equation notice that as written in eq 1 the viscous term of the incompressible navier stokes equations is expressed in the form of a vector laplacian under the assumption of a constant kinematic viscosity 11 α 2 u n 1 u n 1 f here α ν δ t γ 0 is a positive scaling coefficient with γ 0 a time stepping coefficient and f u ˆ ˆ γ 0 is the right hand side note that for viscous flows with complex boundaries of non zero curvature enforcement of free slip boundary condition is performed by solving each component of eq 11 separately diamantopoulos et al 2021 3 4 density equation the advection diffusion equation for the density perturbation eq 2 follows the same implicit explicit temporal discretization first an intermediate density perturbation is computed through the explicit advancement of the advective term second an implicit solve of a scalar helmholtz equation i e the diffusive term takes place for computing the density perturbation at the next time step it is during this last step where boundary conditions are imposed for the density perturbation throughout this work the boundary conditions for the density perturbation are considered of the homogeneous neumann type i e zero flux 4 spatial discretization of elliptic equation in this section the spatial discretization of the pressure poisson equation ppe and the ensuing domain decomposition technique along with its underlying numerical linear algebra are presented in detail to avoid redundancy the rest of the field variables adhere to the same spatial discretization as for the pressure during their respective implicit steps of the solver see eq 11 and section 3 4 nevertheless the overall computational kernel for the ppe differs drastically in terms of complexity with respect to the velocity density implicit solves see section 4 5 therefore emphasis is given to the numerical linear algebra when solving the poisson problem which is inextricably linked to long computational complex domains encountered in the simulation of nliws and their non hydrostatic dynamics the overall preconditioning strategy along with the adopted domain decomposition parallelization scheme which are tailored specifically to solve robustly the ppe under these computational meshes are then further discussed 4 1 periodic direction denoting as ω r 2 a two dimensional domain and as ω ω 0 l y the extruded three dimensional domain in the transverse periodic direction y 0 l y and a field variable p which can be any of the field variables is approximated by the truncated fourier series as 12 p x z y n 0 n y 2 1 p ˆ n x z ϕ n y where ϕ n e i k n y are the fourier basis functions n y the number of grid points in the transverse direction k n is the wavenumber and p ˆ n x k n z p ˆ n x z ℂ is the respective fourier coefficient following a fourier galerkin discretization in y kopriva 2009 the poisson problem see eq 9 for a single transverse wavenumber becomes 13 x z 2 p ˆ n x z k n 2 p ˆ n x z f ˆ n where x z 2 stands for the laplacian operator in the non homogeneous directions and f ˆ n x z f ˆ n x z k n corresponds to the fourier coefficients of the right hand side of the poisson problem now by virtue of the orthogonality of the fourier basis functions and for all of the transverse non zero wavenumbers k n eq 13 is a two dimensional complex helmholtz equation in fourier space therefore a series of two dimensional solves in the x z plane of the helmholtz equation eq 13 one for each transverse wavenumber has to be performed to compute p in ω 4 2 non homogeneous directions the discretization in the non homogeneous directions x z is presented for a single transverse wavenumber with each of the two parts real and imaginary of the complex fourier coefficient p ˆ n following naturally the discretization herein let v n h 1 ω be a finite subspace where p v v n are a part of the solution i e the real or imaginary part of a fourier coefficient and the test function respectively note that the wavenumber dependence of p and right hand side f are not included here to simplify notation accordingly the weak form of eq 13 under the galerkin approximation becomes 14 ω v p d ω k n 2 ω v p d ω ω v f d ω ω v p n d s where p n p n is the natural boundary condition deville et al 2002 by defining v n as the finite subspace spanned by two dimensional lagrangian basis functions up to order n v n span h 1 x z h n x z p and v are approximated as p k p k h k and v k v k h k where k 1 n is the corresponding index set and n is the total number of degrees of freedom in the x z plane note that each element has the same polynomial order thus the discretized eq 14 is written in a matrix form 15 h k n p m f h k n p g where h k n is the discrete weak form based helmholtz operator 16 h k n k k n 2 m and k i j ω h i h j d ω and m i j ω h i h j d ω are the respective entries of the assembled stiffness and mass matrices deville et al 2002 where i j 1 n for eq 15 and without loss of generality homogeneous neumann boundary conditions are assumed for p since non homogeneous neumann boundary conditions contribute only on the left hand side of the equation deville et al 2002 note that the viscous diffusive equations for the velocity and density field follow the same weak form based formulation and discretization as further discussed in section 4 5 4 2 1 domain decomposition of the ppe and the schur complement problem a non overlapping domain decomposition dd method with iterative substructuring static condensation is used for each transverse wavenumber when solving for the pressure karniadakis and sherwin 2013 in tandem with a logically cartesian topology eq 15 is broken down into a hierarchy of smaller trivially parallel problems with homogeneous dirichlet boundary conditions for the two levels of the condensation karniadakis and sherwin 2013 huismann et al 2017 deville et al 2002 once the second and last stage of the dd is reached a schur complement problem on the vertical interfaces γ v of the subdomains is iteratively solved in the context of hierarchy of problems a subsequent backwards sweep ensures the solution on the global computational domain an example grid demonstrating the decomposition is shown in fig 1 usingaconforming nodal sem discretization the solutionofeq 15 is sought for exactly at the grid points for the dd to take place the unknowns are first ordered in groups based on their grid point location on the x z plane three groups of unknowns are therefore identified a the interior elemental unknowns p i ω i b the unknowns which reside on the horizontal edges of the computational domain p h γ h and c the vertical edge s degrees of freedom p v γ v where γ v ω ω i γ h the resulting diagonal block matrices which then emerge in eq 17 and are shown in fig 2 correspond to the self interaction between unknowns of the same group of unknowns with the off diagonal block matrices expressing the coupling across different groups 17 h i i h i h h i v h h i h h h h h v h v i h v h h v v p i p h p v g i g h g v fig 2 demonstrates the sparsity structure of the block based representation of the h matrix in eq 17 for the computational grid shown in the top panel of fig 1 although this corresponds to the assembled i e global matrix in practice global matrices are not explicitly built due to memory limitations for large problem sizes nevertheless for the better illustration of the dd technique all of the resulting matrices and their sparsity structures correspond to the assembled ones shown in fig 2 as a first stage of the dd the elemental interior unknowns u i are eliminated via a block gaussian elimination condensing eq 17 to a schur complement matrix s 1 on the horizontal and vertical edges skeleton mesh with the following algebraic structure 18 s h h 1 s h v 1 s v h 1 s v v 1 p h p v g h 1 g v 1 where s m n 1 h m n h m i h i i 1 h i n are the block matrices of the first schur problem g m 1 g m h m i h i i 1 g i is its right hand side and m n h v note that each level of condensation entails the division by the self interaction block matrix of the group of unknowns eliminated by the condensed equations in this first level of condensation the elimination group refers to the interior elemental unknowns p i and thus the inversion of the h i i matrix is required now since the h i i matrix is block diagonal canuto et al 2007 karniadakis and sherwin 2013 cf black blocks of fig 2 with each block corresponding strictly to the interior unknowns of each quadrilateral element its inversion is trivially parallel consequently the block entries of the s 1 matrix in eq 18 are computed first in an element wise fashion with a subsequent assembly of the shared interfaces i e direct stiffness summation to enforce continuity deville et al 2002 patera 1986 the second and last level of condensation refers to the computation of a second schur matrix eq 19 for the vertical edges of the computational domain cf fig 1 c which results from the block gaussian elimination when solving for the p v group of unknowns in eq 19 19 s 2 s v v 1 s v h 1 s h h 1 1 s h v 1 s 2 p v g v 2 where g v 2 g v 1 s v h 1 s h h 1 1 g h 1 is the respective right hand side notice the division with the s h h 1 matrix for the computation of the second schur matrix and its right hand side similar to the case of h i i s h h 1 is block diagonal but now each block geometrically belongs to the horizontal edges of a vertical collection of elements i e subdomain cf fig 3 once the second schur system of equations is solved iteratively two successive dirichlet problems eq 20 are solved directly following the backward substitution step of the block gaussian elimination eq 17 18 first the horizontal edge unknowns are computed with a subsequent computation of the elemental interior unknowns eq 20 these inversions are local at a subdomain element level with corresponding dirichlet boundary conditions enforced by lifting the known solution karniadakis and sherwin 2013 lifting is a commonly used strategy for prescribing the contribution of the dirichlet boundary conditions to the interior unknowns by updating accordingly the right hand side of the system of equations cf eq 20 blackburn et al 2019 20 p h s h h 1 1 g h 1 s h v 1 p v p i h i i 1 g i h i h p h h i v p v 4 3 solving the second schur problem the second schur problem of eq 19 represents geometrically the coupling among the vertical edges of the computational domain s 2 is block tridiagonal fig 4 since each vertical edge has at most two neighboring edges with a bandwidth directly proportional to the vertical grid point count n z for high aspect ratio grids where the number of elements in x m x is much larger than that of the elements in z m z m x m z as in the simulation of highly nliws s 2 is a large matrix with a relatively small bandwidth furthermore s 2 is symmetric positive definite a property inherited from the original matrix h of eq 17 note that for k n 0 the s 2 matrix is positive semi definite and thus it is regularized via a nullspace projection of the right hand side vector pozrikidis 2001 essentially the inverse of s 2 is a full matrix which effectively enforces the coupling of all of the vertical edges degrees of freedom therefore imposing a global communication pattern among computational processes tufo and fischer 2001 consequently once a solution is obtained for the vertical edges the remaining solves eq 20 are local and embarrassingly parallel the block tridiagonal structure of the condensed schur matrix s 2 is amenable to the use of a direct solver in a purely serial framework nonetheless since a naive parallel block thomas algorithm performs poorly hirshman et al 2010 various techniques have been proposed for the solution of statically condensed coarse grid problems with efforts being concentrated on mitigating memory limitations and overall parallelization bottlenecks borrell et al 2011 tufo and fischer 2001 lee and wright 2014 seal et al 2013 nevertheless for computationally intensive simulations the use of an iterative solver is preferred due to efficiency considerations offermans et al 2019 4 4 deflation block jacobi preconditioned conjugate gradient solver a deflation based block jacobi preconditioned conjugate gradient solver is utilized for the solution of the second schur system of equations see eq 19 aubry et al 2008 saad et al 2000 mansfield 1990 as demonstrated in joshi et al 2016b for high aspect ratio leptic grids the combination of a block jacobi preconditioner with deflation ensures convergence independent of the domain aspect ratio the polynomial order of the elemental expansion and the number of elements used in the x direction although the convergence properties of this combined approach have been demonstrated for a high order collocation discontinuous element based method the effectiveness of this approach is transferable to symmetric discretizations like the spectral element method nicolaides 1987 as such for the domain decomposed second schur matrix its main block diagonal see fig 4 is used as a block jacobi preconditioner note that the choice of a non overlapping block jacobi preconditioner is a commonly adopted strategy fischer and rønquist 1994 couzy and deville 1995 joshi et al 2016b huismann et al 2017 which ensures that no communication overhead among processes is introduced during its application in parallel more specifically the block preconditioner is factorized during the set up stage of the solver with the overall factorization cost being amortized over the many pressure poisson solves per simulation for the deflation component of the iterative solver a deflation matrix z r n v n c is defined where n v dim s 2 is the total number of unknowns which reside on all of the vertical edges and n c m x 1 is the number of vertical edges whose columns are the deflation vectors z j with their entries given by joshi et al 2016b 21 z j i 1 if x i γ j v 0 if x i γ j v where i 1 n v j 1 n c and x i is a grid point that if resides on the γ j v vertical edge then the respective entry of the deflation vector is unity and zero if otherwise note that the choice of deflation vectors may affect the convergence rate of the iterative solver vermolen et al 2004 and the investigation of optimal deflation vectors is left for future work essentially z and z t can been interpreted as the prolongation and restriction operators commonly used in multigrid methods tang et al 2009 a coarse grid matrix c k n z t s 2 k n z r n c n c of the second schur matrix is then constructed this coarse schur matrix c is a good approximation of s 2 and is subsequently used to update the search direction of the deflated preconditioned conjugate gradient method achieving faster convergence aubry et al 2008 saad et al 2000 note that the coarse version of the second schur complement c k n is tridiagonal and can be seen as the one dimensional x direction equivalent of eq 13 using linear basis functions i e the helmholtz matrix for the fem joshi et al 2016b particularly for a high polynomial order where fewer elements are used in the x direction than in the equivalent in resolution lower polynomial order case the c matrix is much smaller in size than the original schur complement matrix i e n c n v therefore the coarse problem is solved directly and redundantly within each process to avoid any introduced communication overhead notice that the rank deficiency of the second schur complement matrix s 2 for the zeroth mode is passed onto c k n 0 nonetheless since the coarse matrix c is solved directly a regularization technique via householder matrices escobar vargas 2012 equivalent to the right hand side null space projection of the s 2 matrix see also section 4 3 is used pozrikidis 2001 however since the regularization technique on c is not sparsity preserving a one dimensional dd technique is adopted between the interior and the two boundary unknowns of the c k n 0 matrix first a 2 2 schur complement matrix is computed corresponding to the first and last unknowns of c k n 0 once this schur complement matrix is regularized and the two boundary values are computed a final tridiagonal solve is performed for the interior unknowns of c k n 0 matrix 4 5 viscous diffusive solves a simple strategy is adopted for the numerical solution of the viscous eq 11 and diffusive see section 3 4 parts of the solver it is during this step of the solver where boundary conditions for the velocity field and the density perturbation are enforced diamantopoulos et al 2021 consequently adhering to a dd approach for these implicit solves such as that described in section 4 2 1 would introduce an additional complexity regarding the enforcement of different types of boundary conditions for instance the dimensionality of the discretized system of equations will be accordingly reduced as for the case of dirichlet boundary conditions where the solution is already known at the boundaries karniadakis and sherwin 2013 following the discretization presented in section 4 1 4 2 the respective helmholtz matrix h u k n of eq 11 for a given transverse wavenumber k n is given by 22 h u k n α k 1 k n 2 m where the time step coefficient α eq 11 scales linearly with ν δ t or κ δ t thus for high reynolds number flows h u is diagonally dominant and h u 1 k n 2 m therefore the implicit viscous diffusive solves are performed iteratively for the uncondensed system of equations using the diagonal mass matrix m as a preconditioner blackburn et al 2019 which is an efficient preconditioning strategy for achieving convergence in a few iterations 5 implementation this section assesses the implementation s scalability and ability to tackle environmental scale domains for the temporal and spatial discretizations outlined in section 4 specifically the implementation of the sem fg flow solver is evaluated against its design goals to understand its bottlenecks and identify areas of interest for a future scaling study the sem fg flow solver s implementation was guided by three objectives to support scaling to large node and core counts 1 loose coupling between two dimensional subproblems 2 minimize communication and 3 maximize arithmetic intensity of computations nonetheless these goals alone are not sufficient for an efficient implementation e g use of efficient vendor libraries for computation is required but provide the foundations that frame its scalability both loose coupling and minimizing communication are necessary to maximize parallel execution and set an upper bound on performance through amdahl s law magoulès et al 2016 though the former is necessary to maximize gains from the method s parallel domain decomposition structuring computations to maximize arithmetic intensity provides opportunities for efficient execution often through external acceleration libraries for ffts and dense linear algebra each of these objectives drives towards an implementation that can be applied to large environmental scale problems the sem fg solver was designed as a pure mpi solver targeting a single rank per core on multi core hpc systems the structured nature of solver s computations admits flexible distribution of work to either mpi ranks or threads though a hybrid mpi openmp implementation was not pursued since the anticipated performance was comparable moreover a hybrid approach increases complexity in both maintenance and execution the analysis presented is limited to the parallel domain decomposition and the viscous and pressure solvers as their implementations directly reflect the discretization as outlined in section 4 2 1 components such as solver setup input and output and post processing are omitted as they are independent of the method for each component of interest an outline on how the method maps onto its implementation is provided along with a qualitative assessment of bottlenecks with respect to the aforementioned objectives 5 1 parallel domain decomposition following the hybrid approach of bolis et al 2016 a two dimensional parallel decomposition in the x and y directions is used the y dimension is a natural choice due to the fourier discretization allowing the solution of a three dimensional system to be pursued through solving parallel two dimensional subproblems the x dimension is chosen over the z since sem fg target problems have a high horizontal aspect ratio 10 1 and the parallel decomposition along x provides greater opportunities for scaling due to significantly more horizontal elements additionally this results in minimizing the data exchanged between ranks as the vertical surface area between subdomains is significantly smaller than the horizontal surface area two communication patterns emerge when decomposing in x and y 1 along x z planes with point to point exchanges of vertical subdomain edges and collective communications during conjugate gradient iterations and 2 along x y planes with all to all data exchanges coupling all the transverse fourier modes during non linear advection term computations each two dimensional subproblem spends the majority of its time communicating with the ranks in its x z plane with the coupling communications in the y direction occurring a fixed number of times per time step ultimately framing sem fg s execution as a collection of loosely coupled two dimensional subproblems from an implementation standpoint sem fg maps its mpi ranks p i onto a two dimensional cartesian topology p i p x y subsets of the computational domain are assigned to each process both in the subdomain x and wavenumber y sense such that each process p x y holds one or more subdomains in x and one or more transverse wavenumbers in y directions respectively fig 5 illustrates the aforementioned decomposition topology and communication patterns as part of the pressure and viscous solves vertical edge exchanges are performed between adjacent ranks within an x z plane to enforce c 0 continuity and are performed simultaneously across all ranks within a local two dimensional subproblem due to the parallel decomposition in x the data size transferred between adjacent ranks is fixed at n v m z n 1 values i e the grid resolution in the vertical direction collective communication within each two dimensional subproblem occurs as a small fixed number of reductions to compute dot products during conjugate gradient iterations due to deflation based preconditioning the pressure solve also has a collective exchange to distribute deflation vectors computation of non linear advective terms is done in physical space which necessitates transforming grid points from fourier space and back since wavenumbers are distributed along y collective exchange amongst ranks in the transverse dimension is required to compute each fourier transform the exact number of ffts depends whether the flow is stratified and thus eq 2 is solved though needs to compute o 10 m z n 2 n y point real valued ffts per timestep the volume of data exchanged between ranks is o 8 m z n y n 2 bytes per transform advection terms are computed once per timestep and result in the only synchronization point across all ranks in the y dimension to better understand loose coupling and explore sem fg s scalability limitations the aforementioned communication patterns are qualitatively analyzed this is performed by examining the choices for allocating subdomains to individual ranks and assessing the bottlenecks that emerge for the scaling analysis discussed below one dimension either x or y is fixed to an arbitrary size and the other dimension is varied between extremes choices for distributing vertical subdomains amongst ranks in x range from all subdomains on a single rank to one subdomain per rank while it eliminates communications the extreme where a single rank has an entire x z plane is infeasible due to memory requirements and is not considered further on the other extreme mapping a single subdomain to one rank results in minimal computation per rank with a slight increase in communications overhead as more ranks participate in the collective reductions the time saved in per rank computation is expected to exceed the increased communication overhead for all environmental scale problems resulting in an overall smaller time per timestep finally execution with more than one subdomain per rank results in a larger time per timestep than in the single subdomain per rank though by how much is unknown without a strong scaling study distributing transverse subdomains amongst ranks in y follows a similar argument though differs in that the time per timestep is limited by the slowest two dimensional subproblem since each subproblem s wavenumber correlates to its condition number cf eq 16 22 which is proportional to the number of conjugate gradient iterations required the time per timestep is max i t i where the i th rank s total time t i k t i k is the sum total time of each of its k many two dimensional subproblems as a result the extreme case where each rank solves a single two dimensional subproblem minimizes the total time per timestep the case where ranks solve multiple subproblems results in a load imbalance requiring partitioning wavenumbers across ranks to avoid such an inefficiency the current implementation of sem fg naively partitions wavenumbers in sequential order and leaves load balancing in y as a future effort given the aforementioned communication patterns the method described in section 4 maps well to the parallel domain decomposition increasing ranks in y reduces total time per timestep while increasing ranks in x trades per rank computation for slightly increased collective communication overhead increasing ranks in both x and y will reduce time per timestep for environmental scale problems though cannot be quantified without a scaling study 5 2 pressure solve the method s domain decomposition results in a smaller isolated problem where only the shared vertical edges are collectively solved allowing the shared horizontal edges and interior elements to be computed locally and without additional communication as a direct result of the two level static condensation since κ s 2 κ h carvalho et al 2001 this results in fewer iterations of deflation based preconditioned conjugate gradient dpcg each operating only on the vertical edges rather than the entire subdomain both solving d 1 x v f where d stands for the block jacobi preconditioner and computing s 2 x v operate on matrices sized n v n v which are a factor of n 1 2 smaller than the entire subdomain additionally these operations map directly onto lapack and blas routines dpotrs and dgemv respectively that are accelerated by vendor implementations in addition to reducing the size of the collective problem the method s two level condensation also trades communications for local work first the coarse direct solve of c 1 z t x v in the dpcg iterations is redundantly computed in each rank rather than collectively given the tridiagonal symmetric positive definite nature of c 1 z t this can be efficiently solved o 8 m x flops golub and van loan 2013 and is an obvious trade for fewer collective communications within each iteration once an iterative solution is computed for the shared vertical edges each rank can compute solutions to horizontal edges and interior elements without any further communication within the x z plane the matrices involved in lifting and solving the rhs for the interior the elements cf eq 20 sized 4 n n 1 2 and n 1 2 n 1 2 respectively lends itself to exploring acceleration libraries tailored to small sizes and batched execution both blasfeo frison et al 2018 and libxsmm heinecke et al 2016 provide tuned implementations for small dense linear algebra problems including matrix vector operations while blasfeo also solves systems of equations with cholesky factorization while increasing the efficiency of the dpcg iterations reduces the total time per timestep potentially larger gains are available by reducing the number of iterations required as seen in eq 15 and described in section 4 sem fg s time per timestep is directly limited by the number of iterations required by the k y 0 wavenumber subproblem as such improvements to the preconditioning strategy have a significant impact in reducing the time spent in the pressure solve identifying a better selection of deflation vectors is an area of future work 5 3 viscous solve compared to the pressure solve sem fg s viscous solve is both a smaller and better conditioned problem due to its dominant diagonal structure c f second term of right hand side of eq 22 application of boundary conditions and lifting the rhs result in per element matrix vector multiplications of m and h all of size n 1 2 n 1 2 preconditioned conjugate gradient pcg iterations consist of per element matrix vector multiplications with h though the conjugate gradient solution operates on vertical edges due to the domain decomposition resulting in scalar operations of size n v m x s n 1 where m x s stands for the number of subdomains per mpi process of note the block jacobi preconditioner is applied through an element by element hadamard product golub and van loan 2013 since the matrix m 1 can be precomputed during solver setup due to its diagonal structure as a result all of the viscous solve s operations are either matrix vector multiplications that map directly onto blas routines or vectorizable array operations similar to the pressure problem the viscous solve may benefit from a blas implementation tuned for small matrices so as to accelerate the small matrix vector multiplications contained in pcg iterations 6 stabilization techniques in under resolved simulations which is predominately the case in environmental flow modeling sem fg uses an exponential filter diamessis et al 2005 vandeven 1991 as a surrogate of a hyperviscous operator moura et al 2016 both in the periodic y and non homogeneous directions x z each velocity component and density perturbation are filtered once every time step after the computation of the non linear eq 6 and advective terms respectively the filter orders in y q y and x z directions q x z are reported for each benchmark in section 7 additional stabilization is achieved in the x z non homogeneous directions via polynomial over integration or equivalently referred to as polynomial dealiasing kirby and karniadakis 2003 of the non linear and advective terms malm et al 2013 details regarding the stabilization techniques used in this work are provided on appendices a and b 7 benchmarks in this section the overall accuracy of the solver is demonstrated for a series of benchmarks of increasing complexity ultimately building up to a three dimensional benchmark of a convectively breaking isw propagating over a realistic bathymetry rivera rosario et al 2022 results are validated when applicable with analytical solutions or with other studies for both unstratified and stratified flows 7 1 kovasznay flow the steady state kovasznay flow kovasznay 1948 is a commonly used test case for the validation of high order two dimensional incompressible flow solvers it is based on an exact solution of the incompressible navier stokes equations for a laminar flow past a two dimensional grid eq 23 hesthaven and warburton 2007 manzanero et al 2020 kirby and sherwin 2006 on ω 0 5 1 0 5 1 5 m 2 a time step of d t 1 0 3 s is chosen for a constant number of equally sized elements 8 8 and a varying polynomial order i e p refinement hesthaven and warburton 2007 simulations are initialized with the exact solution of the velocity field given in eq 23 for non homogeneous dirichlet boundary conditions and performed over a time span of t 0 1 s lastly viscosity is uniform and set equal to ν 1 40 m2 s no exponential filtering is used since the flow is laminar and well resolved the l 2 error norm of the field variables is shown in fig 6 at time t 1 s as a function of the polynomial order per element per dimension notice the exponential convergence kopriva 2009 of sem similar to a global spectral method achieving an error close to machine precision as the polynomial order within each element increases 23 λ 1 2 ν 1 4 ν 2 4 π 2 u 1 exp λ x cos 2 π z w λ 2 π exp λ x sin 2 π z p 1 exp 2 λ x 2 7 2 normal collision of a vortex dipole with a no slip wall the normal collision of a vortex dipole enables the validation of the fully non linear time dependent inse by examining the propagation of a distinct flow feature namely the vortex dipole and its interaction with the finer scale boundary induced vorticity as it reaches the bottom wall the work of subich et al 2013 is used as a reference since it offers a detailed comparison with previous numerical experiments in the context of high order discretizations clercx and bruneau 2006 kramer et al 2007 the two dimensional collision is initially investigated with a subsequent extension to three dimensions by incorporating a third periodic transverse direction as in subich et al 2013 in this study simulations were performed for a moderate reynolds number of r e u h ν 1250 clercx and bruneau 2006 where h 1 m is the half length of the normalized computational domain ω 1 1 1 1 and u is the computed full domain averaged rms velocity 24 u 1 4 ω u 2 x t 0 d ω 1 m s the initial two dimensional velocity field u u w induced by the dipole is given by the following expressions 25 u u ω 0 2 z z 1 exp r 1 2 r 0 2 ω 0 2 z z 2 exp r 2 2 r 0 2 w u ω 0 2 x x 2 exp r 2 2 r 0 2 ω 0 2 x x 1 exp r 1 2 r 0 2 where x 1 z 1 0 1 0 is the initial dimensionless location of the positive monopole x 2 z 2 0 1 0 is the initial dimensionless location of the negative monopole r 1 r 2 is the distance from the center of the positive and negative monopole respectively r 0 is the radius of each monopole and ω 0 299 5284 is the amplitude of the monopole s vorticity ω computed from eq 24 note that the x z plane is used for this benchmark therefore the y component of vorticity is reported throughout the presentation of two dimensional and three dimensional results in particular the sign of vorticity not its direction is inverted due to a different choice of cartesian axes when compared to previous studies clercx and bruneau 2006 kramer et al 2007 subich et al 2013 a constant polynomial order of n 8 per element per direction is used for a varying number of elements m x m z with m x m z additionally a grid stretching strategy is used in the bottom half of the domain to better resolve the fine bottom boundary layer features resulting from the dipole collision with the wall the ratio of the heights of two adjacent elements in the vertical is equal to a constant φ z δ z i 1 δ z i 1 varying width elements with a constant ratio of φ x 0 92 symmetrically placed around the center of the domain are used for two of the cases fig 7 in total three simulations were performed by increasing the grid resolution in x and z directions through an increase of the number of elements with the corresponding minimum horizontal δ x m i n and vertical grid spacings δ z m i n shown in table 1 a weak filter of q x z 14 order is used for both the two dimensional and three dimensional simulations with a transverse filter order of q y 48 affecting only the top 23 of the transverse wavenumber range is used for the three dimensional test case three metrics are used to assess the efficacy of the simulations the total kinetic energy 26 k e t 1 2 ω u x t u 2 d ω the magnitude and time of occurence of the maximum enstrophy 27 e t 1 2 ω ω x t u h 2 d ω and the location and strength of the maximum negative vorticity of the primary monopole as described in subich et al 2013 as the dipole propagates downward and comes sufficiently close to the wall a bottom boundary layer is formed with an induced vorticity of opposite sign from that of the primary monopole once the boundary layer induced vorticity interacts with the primary monopole fig 8 the total enstrophy assumes a maximum value and dissipation of kinetic energy increases fig 9 a secondary smaller increase of enstrophy occurs later in time when the primary vortex recirculates and interacts again with the bottom boundary generated vortices the maximum enstrophy and time of its occurence for different grid resolutions as compared to previous studies clercx and bruneau 2006 kramer et al 2007 subich et al 2013 are reported in table 2 lastly the strength of the maximum negative vorticity of the primary monopole at t h u 0 6 and the corresponding location of this maximum are reported in table 3 for all the reported quantities in both tables 2 and 3 agreement with previous studies improves for increasing resolution 7 2 1 extension to three dimensions the three dimensional benchmark of the vortex dipole collision is performed by extruding the x z computational domain ω into ω ω 0 0 4 the x z resolution corresponds to the 513 513 grid shown in table 1 along with a discretized y direction of n y 96 grid points white gaussian noise is added onto every velocity component at each grid point of the computational domain following the same approach as in subich et al 2013 in total two three dimensional runs are performed for the same grid resolution albeit with different noise amplitudes determined by the standard deviation σ of the gaussian white noise which is set equal to σ 1 0 2 as in subich et al 2013 and σ 1 0 3 for the stronger and for the weaker noise run respectively the evolution of averaged in y enstrophy and kinetic energy ke for the three dimensional benchmarks is shown in fig 9 the σ 1 0 2 test case follows the same behavior as the two dimensional simulation up until the first interaction of the dipole with the no slip driven vorticity at the bottom boundary at this point enstrophy continues increasing which is a signature of fine structure assuming larger values due to vortex stretching with a concurrent increase of ke dissipation when compared to its two dimensional counterpart although the standard deviation of the noise is equal to the one reported in subich et al 2013 the three dimensionalization of the flow starts much earlier where any initial secondary transverse instabilities harris and williamson 2012 are bypassed due to the strong amplitude noise this deviation is attributed to the weak filtering order q y 48 in the periodic direction which is further enforced by examining the evolution of the enstrophy and ke for the σ 1 0 3 run and possible subtle changes in the structure of the noise in that case due to the weaker perturbations which drive a slower growth rate of any transverse flow structure enstrophy starts deviating later in time from the two dimensional benchmark after the first interaction of the dipole with the bottom generated vorticity a second peak of enstrophy of almost equal strength with the first one is now observed during the second interaction of the dipole with the bottom boundary generated vorticity similar to the one reported in subich et al 2013 the second enstrophy peak drives an increase in ke dissipation as in the σ 1 0 2 case albeit less intense lastly in fig 10 two isosurfaces of the transverse vorticity ω y and one iso surface of the magnitude of vorticity ω ω x 2 ω y 2 ω z 2 1 2 are shown for the σ 1 0 3 test case soon after the second enstrophy peak the almost parallel to the x z plane generated vorticity indicates the three dimensionalization of the flow similar patterns are also observed in subich et al 2013 7 3 stratified test cases the stratified test cases share the common theme of the propagation of an internal solitary wave isw of depression under different conditions starting from an idealized configuration i e two layer continuous stratification with no background current uniform depth and inviscid flow the complexity of the simulations is gradually increased initially a small bathymetric feature is incorporated culminating into a study of the three dimensional propagation of an isw over a realistic bathymetry with realistic background currents and stratification inspired by actual measurement in the south china sea scs lien et al 2012 2014 the propagation of an isw is used as a platform to assess the robustness of the flow solver because of the delicate inherent balance between their non linear steepening and physical dispersion consequently if a numerical discretization is not carefully chosen any spurious flow features such as non physical dispersive trailing waves erroneous propagation speed or artificial amplitude attenuation due to numerical diffusion introduced by the flow solver will eventually compromise the simulation by virtue of the hybrid sem fg numerical method used the dynamic nature of the two dimensional convectively breaking isw is successfully captured along with the three dimensional scales down to grid resolution 7 3 1 tankscale isw in uniform depth water the initial isw satisfies the dubreil jacotin long djl equation long 1953 dunphy et al 2011 for an initial available potential energy ape of a p e 0 05 j m under a continuous two layer stratification 28 ρ ρ 0 1 δ ρ 2 ρ 0 tanh z h 1 δ where ρ 0 1000 kg m3 is the reference density δ ρ 40 kg m3 is the difference between the lower and upper densities h 1 3 cm is the upper layer depth and δ 0 5 cm is the interface thickness the isw propagates inviscidly where the viscous diffusive terms in eqs 1 2 are deactivated and the time discretization is adjusted accordingly the wave is expected to propagate in a uniform depth tank of h 15 cm and length l 10 l w 6 9 m where l w 0 69 m is the isw s width with a djl prescribed constant propagation speed of c 0 1145412 m s in regards to spatial discretization a resolution of n x n z 513 257 grid points is used in the x and z directions respectively for a polynomial order n 8 per element in each dimension and uniform sized quadrilateral elements fig 11 a shows the djl based isw which is used as an initial condition for the tankscale uniform depth propagation as well as for the wave propagation over a small bathymetric feature as examined in section 7 3 2 the overall numerical dissipation of the flow solver as generated by the numerical filtering is investigated by calculating the kinetic energy k e ρ 0 2 ω u 2 x t d ω of the isw as a function of time in the case of the inviscid propagation of an isw in a constant depth waveguide on purely physical grounds the ke of the isw should remain constant in practice however when a high order discretization is used mitigation of any aliasing induced instabilities attributed to the non linear terms of inse requires the introduction of an artificial albeit controlled dissipative mechanism an initial increase of the ke dissipation rate is observed due to the reduced order of the time integration scheme for the first two time steps of the solver fig 12 once the high order time integration is established the dominant source of dissipation is the weak exponential filter of order q x z 14 used more specifically the ke assumes a constant value of ke t 1 6 1 0 4 which corresponds to 0 1 ke loss per width of propagation where ke is the isw s kinetic energy normalized by the initial ke of the wave note that the overall loss of ke can be used as a useful metric to assess the artificial dissipation introduced by a stratified flow solver for a uniform depth waveguide inviscidly propagating isws should have a constant propagation speed c consequently by tracking the position of the wave as a function of time one should expect a straight line of slope c the ability of the flow solver to perform reliably in this context is shown in fig 13 where the position of the trough of the wave is given as a function of time obtained through linear regression the numerically computed propagation speed of the wave c n u m 0 1145173 m s is in excellent agreement with the djl based initial propagation speed of the isw with a relative error of 2 1 1 0 4 7 3 2 tankscale isw over a gaussian bump an additional level of complexity is now introduced by inserting a small bathymetric feature in the propagation path of the djl based isw considered in section 7 3 1 to accurately represent the gaussian bump the computational mesh and the respective elements in the vicinity of the topographic feature are curvilinear and highly deformed as shown in fig 11 thus the capability of the solver for supporting complex boundary geometries is tested the isw propagates over a gaussian bump of height h b 0 03 h and width l b 3 l w 4 with the initial configuration shown in fig 11 a the dimensions of the bump are chosen for the isw to propagate over this feature without inducing any convective or shear instabilities over such a gentle bathymetric feature the isw responds to the bathymetric change by slightly adjusting its waveform but recovers its original shape fig 11 b and propagation speed as soon as it moves back into uniform depth water therefore this adjustment and recovery of the isw waveform are an additional aspect of the flow solver testing provided by this benchmark as the wave approaches the bump it slows down and its ke is converted into available potential energy ape lamb and nguyen 2009 note that the computation of the isw s ape is not included in this work the reverse energy exchange is observed once the isw goes over the bump the wave accelerates its ape decreases with an accompanying increase of its ke the evolution of the isw s ke as it propagates over the bump are shown in fig 12 notice when the isw has gone over the bump its ke assumes values close to the uniform bottom test case indicating how the isw recuperates its original waveform as it propagates again over a uniform bottom the position of the trough of the wave as function of time is shown in fig 13 as the wave propagates over the bump the slope i e the propagation speed changes but quickly returns close to the original values as the water depth becomes uniform lastly no error is introduced by the representation of the complex boundary due to the high polynomial order used for each element steinmoeller et al 2016 7 4 south china sea shoaling isw in this section the three dimensional inviscid shoaling of an isw of depression over a realistic gentle bathymetric slope in the south china sea scs and its three dimensional convective instability are explored this benchmark problem consists of the ultimate objective of code development regarding the three dimensional propagation of isws and nliws in general over realistic configurations namely the flow solver has to successfully capture the isw adjustment over long distances on a constantly varying waveguide by combining realistic background stratification current profiles based on the observational work of lien et al 2012 2014 in the scs simulations towns et al 2014 are performed primarily following the methodology of rivera rosario et al 2020 2022 albeit for a different numerical method filtering order used and value of viscosity in regards to the three dimensional shoaling isw simulation adhering to a hybrid spatial discretization may at first seem restrictive since transverse bathymetric variations cannot be represented nonetheless the restriction to such a bathymetric homogeneity in the y direction is offset by the solver s implementation and the resulting performance gains as such the decoupling of the transverse direction during the implicit solves greatly reduces the computational cost per time step and hence allows the optimal resolution of as large as possible a range of turbulent length scales diamantopoulos 2021 consequently and without deviating from the observed normal to isobath propagation of isws in the scs this hybrid approach allows in an optimized fashion the investigation of the onset of the convective instability and the subsequent development of turbulence induced solely by bathymetric variations on the x z plane the initial isw is the baseline wave of amplitude a 143 m as in rivera rosario et al 2020 initially the isw starts propagating from an artificial plateau of 921m to bypass any artificial shoaling response at the wavescale the simulation is originally performed in two dimensions up to approximately the 25 7km of the transect fig 14 at this stage of the simulation the computational domain is extruded in the y direction with a width of l y 50 m in this work a weak filtering is utilized until the onset of the convective instability where the flow is highly energetic and thus the filtering becomes slightly stronger in the x z plane as shown in table 4 other modeling parameters and grid resolution for the whole computational domain are shown in the same table notice the variation of the resolution in the x direction for increasing range values although the minimum resolution in the x direction is restricted to δ x 2 m as the wave becomes convectively unstable finer scale three dimensional structures within the core of the wave can still be identified cf fig 18 further quantitative results outside of the scope of this paper are needed to determine whether the observed finer scale three dimensional structure developed inside the wave is truly turbulent such computationally demanding turbulence resolving simulations will be the topic of a future study diamantopoulos 2021 both the two dimensional and three dimensional simulations were performed in overlapping windows i e successive subsets of the computational domain on the x z plane which encompass the wave as it propagates over approximately 7 wavelengths across each window fig 15 for the three dimensional runs each window spans approximately 13km of the transect with an overlapping region of 6km this overlapping technique greatly reduces the overall computational cost per time step since only a fraction of the degrees of freedom which account for the full scs transect are solved during each fractional step of the solver rivera rosario et al 2020 therefore the resulting flops the introduced parallel communication overhead per time step as well as the memory footprint are substantially smaller when compared to a simulation that would be performed over the full scs transect upon the initialization of the first three dimensional windowed run perturbations rivera rosario et al 2022 of amplitude equal to 3 1 0 5 units are m s for velocity and kg m3 for density are inserted to each field variable the noise is added once in every velocity component and in the density perturbation on every grid point of the computational domain specifically white noise is inserted on each x z plane adhering to a 5 3 slope spectra in the transverse y direction as the isw shoals and enters shallower waters its propagation speed decreases below the maximum induced horizontal velocity c f fig 19 consequently it undergoes a distinct convective instability at a critical depth unlike the setup of vlasenko et al 2005 where the rear of the wave significantly steepens because of the much higher proximity of pycnocline to the bottom the scs shoaling isw preserves its symmetric waveform fig 16 shows the onset of the trapped core formation and evolution of the convective instability for the scs shoaling isw as the wave shoals heavier isopycnals than those in its interior detach from the rear of the wave fig 16a and eventually plunge in the form of an inclined gravity current into the interior of the wave fig 16b c the resulting flow structure inside the wave resembles the corresponding one reported in recent studies on subsurface trapped cores he et al 2019 rivera rosario et al 2020 2022 the onset of the convective instability leads to the development of a lateral instability fig 17 which eventually grows in amplitude as the core develops this heavy over light configuration eventually drives the formation of the subsurface core he et al 2019 and the associated turbulent like structure and localized mixed regions inside the wave in three dimensions fig 18 once the isw starts to become convectively unstable a secondary transverse instability gradually grows in amplitude fig 17 which drives the three dimensionalization of the flow field as the isw continues to shoal fig 18 as previously stated the transition to turbulence from the formation of the trapped core its persistence as well as the induced mixing will be further explored via higher resolution simulations in a future study note that the initial transverse mode differs from the one reported in rivera rosario et al 2022 possibly due to differences in the inserted perturbations specifically perturbations are inserted only in two of the velocity components with the transverse velocity component being computed by virtue of the projection onto a solenoidal velocity field during the time advancement of inse eq 10 the development of three dimensional transition fig 17 and turbulent like structure of the isw s interior fig 18 is delayed as compared to field measurements lien et al 2014 where a fully turbulent trapped core at approximately the 54th km of the transect was observed for further comparison to field data and different noise insertion strategies for accelerating the three dimensionalization of the flow field the reader is referred to the study of rivera rosario et al 2022 fig 19 shows the variations of the maximum induced horizontal velocity u m a x and propagation speed c as the wave shoals for more details on the methodology of computing c the reader is referred to the work of rivera rosario et al 2020 2022 both of these properties are computed from the y averaged velocity field since it is shown that their differences per x z plane are negligible the along propagation path location of the onset of the convective instability which takes place when the maximum horizontal induced velocity exceeds the propagation speed of the wave i e u m a x c 1 is consistent with the locations of snapshots of the isopycnal overturning shown in fig 16 furthermore as the wave shoals the u m a x c ratio follows the same evolution fig 19 as in rivera rosario et al 2020 8 conclusions and future work in this work a continuous hybrid nodal spectral element fourier galerkin flow solver for the simulation of fully non hydrostatic stratified flows is presented the solver is specifically designed for the long high aspect ratio and variable bathymetry computational domains encountered in the normal to isobaths propagation of non linear internal waves and the resulting turbulence in the wave interior a defining feature of the non linear internal waves is their strong non hydrostatic nature which necessitates the solution of a pressure poisson problem when combined with the high aspect ratio complex bathymetry domains the efficacy of numerically solving the pressure poisson equation is of paramount importance for the overall performance of the flow solver adopting a domain decomposition technique for the pressure poisson equation the resulting condensed schur complement problem is solved via a block jacobi deflated preconditioned conjugate gradient iterative solver a robust preconditioning technique is used which ensures favorable convergence properties i e low iteration count for the examined domains and flow problems as recently demonstrated in joshi et al 2016b the initial flow solver implementation meets its design goals of producing three dimensional physics from a collection of coupled two dimensional problems minimizing communications and expressing the method as regions of structured computations qualitative assessments indicate the implementation will scale well to tackle environmental scale problems and will be validated with a future scaling study future performance improvements include identifying more efficient choices of deflation vectors to reduce the pressure solver s iteration count as well as exploring acceleration libraries providing tuned implementations for small dense linear algebra problems as reported in section 5 2 the overall accuracy of the flow solver is demonstrated through a suite of benchmarks showing a good agreement when compared to analytical solutions and previous studies the benchmarking effort culminates with the three dimensional shoaling of an internal solitary wave of depression over realistic bathymetry and background conditions in the south china sea motivated by in situ observations of lien et al 2012 2014 the flow solver captures the key features of the shoaling wave along with turbulent like structures in its interior showing a really good agreement with previous studies rivera rosario et al 2020 2022 future turbulence resolving computationally intensive simulations of the shoaling internal solitary wave in the south china sea will be performed utilizing this solver diamantopoulos 2021 additional applications in stratified flows such as the simulation of internal swash zones emery and gunnerson 1973 thorpe and lemmin 1999 davis et al 2020 and the potentially related boundary interior exchange mcphee shaw et al 2021 excited by deep water waves will also be investigated credit authorship contribution statement theodoros diamantopoulos conceptualization data curation formal analysis investigation methodology software visualization writing original draft sumedh m joshi conceptualization methodology software greg n thomsen software writing original draft gustavo rivera rosario conceptualization methodology software writing review editing peter j diamessis conceptualization funding acquisition project administration resources supervision writing original draft kristopher l rowe conceptualization declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments the authors would like to thank professor charles f van loan for his comments on the domain decomposition and schur complement matrices the authors would also like to thank professors larry redekopp and jan hesthaven for sparking the original inspiration to develop a high order element based flow solver to simulate shoaling nonlinear internal waves jorge escobar vargas was instrumental in the very early stages of model development sumedh joshi made critical contributions in the earlier stages of this effort the authors are additionally grateful to dr ren chieh lien and professor kevin lamb for their patience and ceaseless encouragement in this long development endeavor the authors would also like to thank professor marek stastna for his suggestions during the revision of the manuscript this work used the extreme science and engineering discovery environment xsede which is supported by national science foundation grant number aci 1548562 the shoaling isw simulations used the extreme science and engineering discovery environment xsede stampede2 at the texas advanced computing center tacc through allocation tg ees200010 financial support is gratefully acknowledged from national science foundation division of ocean sciences oce grant number 1634257 the work in this paper is the culmination of a 15 year long grass roots effort obsessively pursued by a small highly dedicated number of individuals we have persevered past adversity and have brought our labor of love to completion this publication is dedicated to the memory of sumedh m joshi who sadly does not get to see the results of his efforts appendix a exponential filtering since a continuous galerkin discretization is used in the x z directions it is crucial for the filtered quantity to preserve the c 0 continuity of the numerical method boyd 1998 therefore a discrete polynomial transform dpt takes place before the application of the exponential filter using appropriate basis functions which ensure the c 0 continuity among elemental interfaces essentially a dpt is the mapping from the nodal coefficient space i e lagrange polynomials to the modal coefficient space instead of the commonly used legendre basis functions the modal coefficients of a field variable are computed for the boundary adaptive basis functions canuto et al 2007 karniadakis and sherwin 2013 in one dimension the boundary adaptive basis functions are comprised of two linear basis functions which are non zero at the two boundaries and a series of basis functions or bubble modes of increasing polynomial order i e hierarchical which are zero at the boundaries thus a subsequent filtering only of the respective bubble modes ensures the continuity among element interfaces let σ r n 1 n 1 be an exponential filtering diagonal matrix with corresponding entries the values of the filtering function evaluated at a given polynomial mode see eq 36 in diamessis et al 2005 where n is the polynomial order of the expansion then the one dimensional filtering matrix f r n 1 n 1 is given by the following expression a 1 f v σ v 1 where v r n 1 n 1 is the forward discrete polynomial transform matrix with columns the computed boundary adaptive basis at the gauss lobatto legendre points canuto et al 2007 lastly the inverse v 1 denotes the backward transform from nodal to modal coefficient space note that the two dimensional equivalent filter matrix is simply computed by taking the kronecker product of the one dimensional filter matrix f with itself appendix b non linear terms calculation the explicit step of the time splitting scheme eq 6 for any velocity component u of the velocity vector is shown following a galerkin approximation in the non periodic domain ω to simplify notation the density perturbation term is omitted and the intermediate velocity u is time advanced using a first order time integration scheme j 1 i e euler method which can be easily extended to a higher accuracy time integration therefore eq 6 for a given test function v is written as b 1 ω v u d ω ω v u d ω δ t ω v n u d ω where n u u u is the non linear operator based on the discretization presented on section 4 the non linear term n u is approximated in ω as a linear combination of two dimensional lagrange polynomials b 2 n u x y z k 1 n n u k y h k x z where n are the degrees of freedom within a x z plane note that the test function v the intermediate velocity u and the previous time step velocity u adhere to the same discretization thus eq b 1 is discretized into the following matrix form b 3 m u y mu y δ t m n u y where m is the mass matrix and n u y n u k y u y u k y u y u k y are the nodal values of n u u and u respectively now the second term of the right hand side of eq b 3 is equal to b 4 m n u y c u y where c i j ω h i u h j d ω is the weak form based discrete non linear operator in high r e advection dominated flows such as the propagation of non linear internal waves and the associated turbulence aliasing induced instabilities due to inexact integration of the entries of c matrix may compromise the simulation this is of particular importance on complex computational domains where the integrand of c i j includes the associated metric terms for the mapping of the physical domain to the computational domain furthermore since it is a common practice for the use of an isoparametric mapping kopriva 2009 see appendix c for more details the integrand of c i j has an elevated polynomial order and thus any inexact numerical integration using the gauss lobatto legendre points karniadakis and sherwin 2013 is exacerbated if not properly treated on this account stability is ensured via polynomial over integration on c to retain its skew symmetry malm et al 2013 briefly the integrand of c i j is spectrally interpolated into an over integration grid for its integral to be computed exactly through numerical integration for more details regarding the computation of c in deformed geometries the reader is referred to deville et al 2002 malm et al 2013 lastly the fourier coefficients of the intermediate velocity u are obtained by first inverting the diagonal mass matrix m of eq b 3 followed by a discrete fourier transform in y f y b 5 u k n f y u y δ t n u y where k n is a transverse in y wavenumber appendix c mapping to curvilinear elements an isoparametric approximation kopriva 2009 is adopted for representing the mapping between the computational grid coordinates of the reference quadrilateral element ξ η ω e 1 1 1 1 and the physical coordinates x e ξ η z e ξ η r 2 for each element c 1 x e ξ η i 0 n j 0 n x i j l i ξ l j η z e ξ η i 0 n j 0 n z i j l i ξ l j η where x i j z i j are the physical grid coordinates within a quadrilateral element and l i l j are the one dimensional lagrange polynomials in the reference domain from eq c 1 the partial derivatives of x e z e with respect to the reference coordinates ξ η can be easily computed numerically via the use of two dimensional spectral differentiation matrices costa and don 2000 furthermore the derivatives of the inverse mapping in two dimensions are computed as kopriva 2009 c 2 ξ x η x ξ z η z 1 j z η z ξ x η x ξ where j x ξ z η z ξ x η 0 is the jacobian of the transformation notice that both the derivatives of the inverse mapping with respect to the physical coordinates and the jacobian are used throughout the computation of derivatives and integrals respectively e g first left hand side term of eq 14 for more details regarding the computation of the elemental stiffness and mass matrices cf eq 16 for curvilinear elements the reader is referred to the textbook of deville et al 2002 in the context of a domain decomposition the use of curvilinear elements dictated by complex computational geometries requires a unique mapping to the reference element ω e as such each elemental matrix differs from element to element since the jacobian of the transformation j assumes different values per grid point deville et al 2002 consequently any tensor product based calculations for the inversion of the self interaction matrices h i i and s h h 1 see eq 20 are not in this case applicable huismann et al 2019 couzy and deville 1995 
23829,a high order hybrid continuous galerkin numerical method designed for the simulation of non linear non hydrostatic internal waves and turbulence in long computational domains with complex bathymetry is presented the spatial discretization in the non periodic wave propagating directions utilizes the nodal spectral element method such a high order element based discretization allows the highly accurate representation of complex domain geometry along with the flexibility of concentrating resolution in areas of interest under the assumption of the normal to isobath propagation of non linear internal waves a third periodic direction is incorporated via a fourier galerkin discretization the distinct non hydrostatic nature of non linear internal waves and any instabilities and turbulence therein necessitates the numerically challenging solution of the pressure poisson problem a defining feature of this work is the application of a domain decomposition approach combined with block jacobi deflation based preconditioning to the pressure poisson problem such a combined approach is particularly suitable for the long high aspect ratio complex domains of interest and enables the efficient high accuracy reproduction of the non hydrostatic dynamics of non linear internal waves implementation details are also described in the context of the stability of the solver and its parallelization strategy a series of benchmarks of increasing complexity demonstrate the robustness of the flow solver the benchmarks culminate with the three dimensional simulation of a convectively breaking mode one non linear internal wave over a realistic south china sea bathymetric transect and background current stratification profiles keywords spectral methods domain decomposition deflation non linear internal waves 1 introduction 1 1 non linear internal waves and turbulence non linear internal waves nliws in the ocean are at the receiving end of the cascade of energy originally injected into the water column by winds and tides alford et al 2015 egbert and ray 2000 propagating over long distances nliws dissipate and mix the water column along their propagation path and deposit energy away from their generation site through breaking as a result of turbulence and instabilities in wave interior and wave seafloor interactions rivera rosario et al 2017 boegman and stastna 2019 inherently strongly non linear and non hydrostatic phenomena nliws are often encountered in the form of mode one internal solitary waves isws of depression characterized by a precarious balance between their non linearity and physical dispersion the breaking of an isw is a process of critical significance to ocean energetics where the associated turbulence and mixing are induced via either a shear instability moum et al 2003 or a convective instability lien et al 2012 2014 lamb et al 2019 as they shoal into shallower coastal waters the simulation of a shoaling isw over an actual bathymetry poses a challenge to state of the art numerical modeling essentially the wave scale response to the bathymetry given the particular background shear and stratification has to be effectively captured over long propagation distances without being spuriously altered by numerical dispersion and dissipation furthermore the numerical discretization has to be carefully chosen for any finer scale motions developing within the simulated wave to be as close as possible to their oceanic counterparts by reproducing for a given grid resolution the broad range of scales within a turbulent flow occurring inside the wave 1 2 high order element based techniques in this regard high accuracy pseudo spectral discretizations have emerged as powerful approaches for simulating stratified flows aside from triply periodic discretizations de bruyn kops 2015 winters et al 2004 features such as complex boundary conditions and geometries necessary for the simulation of nliws have been recently developed for fourier based winters and de la fuente 2012 and chebyshev collocation techniques subich et al 2013 an alternative to global spectral discretizations such as those discussed above are high order element based techniques sporadically used for the simulation of stratified flows diamessis et al 2005 rivera rosario et al 2020 özgökmen et al 2004 high order element based discretizations are attractive for the simulation of nliws and their resultant instabilities turbulence since they support the exponential convergence of global spectral methods with the inherent flexibility of elemental discretizations that can localize resolution in areas of interest deville et al 2002 kopriva 2009 as such high order element based discretizations are a powerful potential alternative to adaptive mesh refinement techniques barad et al 2009 santilli and scotti 2015 in this study a continuous galerkin spectral element method sem patera 1984 is used for discretizing the along wave propagation and vertical directions as well as representing any complex topographic features by employing curvilinear quadrilateral elements first localized flow resolution in the vertical allows the reliable representation of background stratification and currents along with any finer scale motions in wave interior typically concentrated in the upper layer of the water column for isws of depression lien et al 2012 or at the bottom boundary when studying their bottom boundary layer induced by the wave sakai et al 2020a b second as in the case for a convectively breaking shoaling isws grid resolution in the along wave propagating direction is increased in the breaking region i e shallower waters while remaining coarse in deep waters enabling a reduction to the computational cost compared to the uniform grid case lastly by adhering to a high polynomial order n 7 within each element the smallest resolved scales are not numerically damped as any artificial dissipation is minimized at these scales for the particular resolution in tandem a high polynomial order also ensures that any error introduced by the commonly used linear interpolation of the bathymetry is avoided steinmoeller et al 2016 it is worth noting that high polynomial orders introduce minimal numerical dispersion which does not artificially impact the physical dispersion of the wave this is essential for preserving the isw s waveform over long propagating distances and ensuring that any numerical phase errors which may lead to the development of artificial trailing waves are mitigated note that the authors have established a significant knowledge base in the context of high order element discretizations through the adaptation and implementation of the spectral multidomain penalty method smpm i e a discontinuous collocation based numerical method hesthaven 1998 escobar vargas et al 2014 diamessis et al 2005 in the framework of the incompressible navier stokes equations inse nonetheless on account of its inherently discontinuous nature the smpm is found to develop elevated spurious divergence at the elemental interfaces for highly under resolved simulations joshi et al 2016a consequently the spatial discretization is replaced by the sem i e a weak form based continuous numerical method 1 3 pressure poisson equation a crucial aspect of implementation which has to be addressed when using a high order element wise discretization for the inse is the numerical linear algebra associated with the solution of the pressure poisson equation ppe which is essential for the accurate reproduction of non hydrostatic dynamics joshi et al 2016b scotti and mitran 2008 lamb et al 2019 admittedly the most computationally costly part of an inse solver the ppe solver design is constrained by the leptic grids scotti and mitran 2008 which are inherited from the high aspect ratio nature of nliws and the long shallow computational domains connected to their propagation properties consequently when simulating nliws the ppe solver to be used and its adopted preconditioning strategy need to carefully take into account these design considerations to achieve convergence with the minimum number of iterations possible as such the numerical solution of the pressure poisson problem in this work is broken down into the following steps first the discretized ppe is reformulated via the use of multi level static condensation iterative substructuring couzy and deville 1995 karniadakis and sherwin 2013 a domain decomposition technique which takes into account the geometry of the discretization and local support of the elemental basis functions canuto et al 2007 this domain decomposition approach which leads to a smaller global system of equations is one of the main advantages of the sem when solving an elliptic equation compared to other high order galerkin discretizations yakovlev et al 2016 hence the discretized system of equations is condensed via block gaussian eliminations into a hierarchy of smaller schur complement problems where each matrix division takes place locally except for the last level of the condensation secondly the last schur complement problem is solved iteratively via a two level deflated preconditioned conjugate gradient solver based on the work of joshi et al 2016b albeit for a symmetric discretization in this case deflation enchanced by a block jacobi preconditioner is an effective preconditioning approach irrespective of the grid s aspect ratio number of elements used and polynomial order of the approximation 1 4 hybrid element based fourier numerical methods the extension of the sem two dimensional solver and the respective ppe computational kernel into three dimensions is guided by in situ observations regarding the propagation of nliws lien et al 2012 2014 since the propagation of nliws may be reasonably approximated as operating along a trajectory normal to the isobaths an additional third periodic direction is incorporated via a fourier galerkin fg discretization kopriva 2009 although hybrid sem fg have been developed in the past karniadakis 1990 moxey et al 2020 blackburn et al 2019 to the best of the authors knowledge a high order hybrid sem fg discretization specifically designed for high aspect ratio complex long domains combined with a robust ppe preconditioning strategy has yet to appear in the literature 1 5 implementation the development of a new solver is not a light undertaking and requires significant resources to develop a method scalably implement the technique verify correctness and maintain the tool over its lifetime so that it is both flexible and performant as such utilizing or adapting existing high performance frameworks balay et al 2021 paul f fischer and kerkemeier 2008 moxey et al 2020 for one s application is the obvious and best approach for most while a fully three dimensional element based discretization in the form of hexahedral or tetrahedral elements offers a more general framework the discretized three dimensional sem operator has a larger condition number than its two dimensional counterpart canuto et al 2007 in addition to the increased iteration counts of the conjugate gradient solver used for the ppe and viscous diffusive solves cf section 1 3 the work done per iteration increases as the elemental matrix is proportional to the problem size o n 3 where n is the order of the polynomial expansion per element in the flow solver considered in this paper the choice of a two dimensional discretization motivated by physical considerations enables the use of an identical computational grid for of each transverse plane as such each x z plane may be solved concurrently rather than having to resort to the fully coupled solve of its three dimensional counterpart to best of the authors knowledge there are no existing solvers that allow exploitation of high aspect ratio long domain physics of interest and thus creating sem fg in terms of discretization and implementation to solve loosely coupled two dimensional subproblems was a necessary path forward from an implementation standpoint the predecessor smpm flow solver uses a one dimensional parallelization strategy joshi et al 2016b where a subset of the computational domain in the x direction is assigned to each parallel process this choice restricts the overall resolution and parallel scalability for three dimensional simulations therefore in the newly developed sem flow solver the parallelization strategy takes place in two dimensions enabling the use of much larger number of parallel processes with the associated decrease of the memory footprint per parallel process 1 6 paper structure this paper is organized as follows in section 2 the main model equations are presented section 3 presents the implicit explicit stiffly stable splitting scheme of the inse along with the necessary implicit solves needed to integrate the field variables in time section 4 discusses the spatial discretization and the associated domain decomposition and preconditioning strategies adopted for the pressure poisson problem along with a brief discussion of the viscous term treatment section 5 discusses the implementation of the discretization and analyzes its major components to understand its potential performance bottlenecks and scalability section 6 covers the stabilization techniques used in the sem fg discretization in section 7 a series of unstratified and stratified benchmarks are shown with the latter culminating in the simulation of a convectively breaking shoaling isw thereby demonstrating the efficacy of the flow solver section 8 consists of the concluding remarks 2 equations of motion the equations of motion of an incompressible fluid under the boussinesq approximation are typically written as 1 u t u u g ρ 0 ρ k 1 ρ 0 p ν 2 u 2 ρ t u ρ ρ κ 2 ρ 3 u 0 where u is the velocity vector field with components u v w in the x y z directions respectively for stratified flows the horizontal velocity component u is decomposed into a fluctuating u and a steady state background current u u z which leads to the following notation 4 u u u w w v v where the prime symbol denotes the deviation of the velocity field from the background state ρ 0 is the reference density g is the gravitational acceleration and k is the unit vector in the upward positive vertical direction in the momentum equation 1 p is the pressure perturbation from the background hydrostatic pressure and ν κ are the molecular diffusivities which are assumed to be constant note that the representation of the viscous terms i e vector laplacian is a direct result of incompressibility diamantopoulos et al 2021 additionally ρ is the density perturbation which originates from the decomposition kundu and cohen 2008 5 ρ ρ 0 ρ x y z ρ x y z t with ρ ρ ρ 0 where ρ is the background density 3 time discretization the semi discrete equations which arise from the velocity projection scheme karniadakis et al 1991 are comprised of three fractional steps treated separately and in succession 1 the advective non linear term 2 the pressure and 3 the viscous term 3 1 non linear term the non linear term is advanced in time using an explicit extrapolation j 3 karniadakis et al 1991 where an intermediate velocity field u is obtained 6 u i 0 j 1 α i u n i δ t i 0 j 1 β i u n i u n i g ρ 0 ρ n i k where α i and β i are the respective time stepping coefficients which depend on the time discretization order and time step δ t for a variable time step peyret 2002 details regarding the spatial discretization and implementation of the non linear term are provided in appendix b 3 2 pressure poisson equation and projection step the equation for the pressure arises from the time advancement of the first intermediate velocity field u into a second intermediate divergent free velocity field u ˆ ˆ 7 u ˆ ˆ u δ t p n 1 where p is the temporal mean of the pressure perturbation calculated over one time step not to be confused with the instantaneous pressure diamessis et al 2005 eq 7 can be reformulated as 8 1 δ t u ˆ ˆ p n 1 1 δ t u the equation above is effectively the helmholtz decomposition of the first intermediate velocity field u into a solenoidal vector field u ˆ ˆ and an irrotational vector field p n 1 taking the divergence of eq 8 a poisson equation arises for the pressure 9 2 p n 1 1 δ t u the consistent boundary conditions for the pressure poisson equation aimed towards ensuring o δ t 2 accuracy of the time discretization scheme are specified in karniadakis et al 1991 once the pressure is computed the second intermediate velocity u ˆ ˆ is computed from the projection 10 u ˆ ˆ u δ t p n 1 3 3 viscous equation the evaluation of the velocity field at the next time step is computed implicitly by solving a vector helmholtz equation notice that as written in eq 1 the viscous term of the incompressible navier stokes equations is expressed in the form of a vector laplacian under the assumption of a constant kinematic viscosity 11 α 2 u n 1 u n 1 f here α ν δ t γ 0 is a positive scaling coefficient with γ 0 a time stepping coefficient and f u ˆ ˆ γ 0 is the right hand side note that for viscous flows with complex boundaries of non zero curvature enforcement of free slip boundary condition is performed by solving each component of eq 11 separately diamantopoulos et al 2021 3 4 density equation the advection diffusion equation for the density perturbation eq 2 follows the same implicit explicit temporal discretization first an intermediate density perturbation is computed through the explicit advancement of the advective term second an implicit solve of a scalar helmholtz equation i e the diffusive term takes place for computing the density perturbation at the next time step it is during this last step where boundary conditions are imposed for the density perturbation throughout this work the boundary conditions for the density perturbation are considered of the homogeneous neumann type i e zero flux 4 spatial discretization of elliptic equation in this section the spatial discretization of the pressure poisson equation ppe and the ensuing domain decomposition technique along with its underlying numerical linear algebra are presented in detail to avoid redundancy the rest of the field variables adhere to the same spatial discretization as for the pressure during their respective implicit steps of the solver see eq 11 and section 3 4 nevertheless the overall computational kernel for the ppe differs drastically in terms of complexity with respect to the velocity density implicit solves see section 4 5 therefore emphasis is given to the numerical linear algebra when solving the poisson problem which is inextricably linked to long computational complex domains encountered in the simulation of nliws and their non hydrostatic dynamics the overall preconditioning strategy along with the adopted domain decomposition parallelization scheme which are tailored specifically to solve robustly the ppe under these computational meshes are then further discussed 4 1 periodic direction denoting as ω r 2 a two dimensional domain and as ω ω 0 l y the extruded three dimensional domain in the transverse periodic direction y 0 l y and a field variable p which can be any of the field variables is approximated by the truncated fourier series as 12 p x z y n 0 n y 2 1 p ˆ n x z ϕ n y where ϕ n e i k n y are the fourier basis functions n y the number of grid points in the transverse direction k n is the wavenumber and p ˆ n x k n z p ˆ n x z ℂ is the respective fourier coefficient following a fourier galerkin discretization in y kopriva 2009 the poisson problem see eq 9 for a single transverse wavenumber becomes 13 x z 2 p ˆ n x z k n 2 p ˆ n x z f ˆ n where x z 2 stands for the laplacian operator in the non homogeneous directions and f ˆ n x z f ˆ n x z k n corresponds to the fourier coefficients of the right hand side of the poisson problem now by virtue of the orthogonality of the fourier basis functions and for all of the transverse non zero wavenumbers k n eq 13 is a two dimensional complex helmholtz equation in fourier space therefore a series of two dimensional solves in the x z plane of the helmholtz equation eq 13 one for each transverse wavenumber has to be performed to compute p in ω 4 2 non homogeneous directions the discretization in the non homogeneous directions x z is presented for a single transverse wavenumber with each of the two parts real and imaginary of the complex fourier coefficient p ˆ n following naturally the discretization herein let v n h 1 ω be a finite subspace where p v v n are a part of the solution i e the real or imaginary part of a fourier coefficient and the test function respectively note that the wavenumber dependence of p and right hand side f are not included here to simplify notation accordingly the weak form of eq 13 under the galerkin approximation becomes 14 ω v p d ω k n 2 ω v p d ω ω v f d ω ω v p n d s where p n p n is the natural boundary condition deville et al 2002 by defining v n as the finite subspace spanned by two dimensional lagrangian basis functions up to order n v n span h 1 x z h n x z p and v are approximated as p k p k h k and v k v k h k where k 1 n is the corresponding index set and n is the total number of degrees of freedom in the x z plane note that each element has the same polynomial order thus the discretized eq 14 is written in a matrix form 15 h k n p m f h k n p g where h k n is the discrete weak form based helmholtz operator 16 h k n k k n 2 m and k i j ω h i h j d ω and m i j ω h i h j d ω are the respective entries of the assembled stiffness and mass matrices deville et al 2002 where i j 1 n for eq 15 and without loss of generality homogeneous neumann boundary conditions are assumed for p since non homogeneous neumann boundary conditions contribute only on the left hand side of the equation deville et al 2002 note that the viscous diffusive equations for the velocity and density field follow the same weak form based formulation and discretization as further discussed in section 4 5 4 2 1 domain decomposition of the ppe and the schur complement problem a non overlapping domain decomposition dd method with iterative substructuring static condensation is used for each transverse wavenumber when solving for the pressure karniadakis and sherwin 2013 in tandem with a logically cartesian topology eq 15 is broken down into a hierarchy of smaller trivially parallel problems with homogeneous dirichlet boundary conditions for the two levels of the condensation karniadakis and sherwin 2013 huismann et al 2017 deville et al 2002 once the second and last stage of the dd is reached a schur complement problem on the vertical interfaces γ v of the subdomains is iteratively solved in the context of hierarchy of problems a subsequent backwards sweep ensures the solution on the global computational domain an example grid demonstrating the decomposition is shown in fig 1 usingaconforming nodal sem discretization the solutionofeq 15 is sought for exactly at the grid points for the dd to take place the unknowns are first ordered in groups based on their grid point location on the x z plane three groups of unknowns are therefore identified a the interior elemental unknowns p i ω i b the unknowns which reside on the horizontal edges of the computational domain p h γ h and c the vertical edge s degrees of freedom p v γ v where γ v ω ω i γ h the resulting diagonal block matrices which then emerge in eq 17 and are shown in fig 2 correspond to the self interaction between unknowns of the same group of unknowns with the off diagonal block matrices expressing the coupling across different groups 17 h i i h i h h i v h h i h h h h h v h v i h v h h v v p i p h p v g i g h g v fig 2 demonstrates the sparsity structure of the block based representation of the h matrix in eq 17 for the computational grid shown in the top panel of fig 1 although this corresponds to the assembled i e global matrix in practice global matrices are not explicitly built due to memory limitations for large problem sizes nevertheless for the better illustration of the dd technique all of the resulting matrices and their sparsity structures correspond to the assembled ones shown in fig 2 as a first stage of the dd the elemental interior unknowns u i are eliminated via a block gaussian elimination condensing eq 17 to a schur complement matrix s 1 on the horizontal and vertical edges skeleton mesh with the following algebraic structure 18 s h h 1 s h v 1 s v h 1 s v v 1 p h p v g h 1 g v 1 where s m n 1 h m n h m i h i i 1 h i n are the block matrices of the first schur problem g m 1 g m h m i h i i 1 g i is its right hand side and m n h v note that each level of condensation entails the division by the self interaction block matrix of the group of unknowns eliminated by the condensed equations in this first level of condensation the elimination group refers to the interior elemental unknowns p i and thus the inversion of the h i i matrix is required now since the h i i matrix is block diagonal canuto et al 2007 karniadakis and sherwin 2013 cf black blocks of fig 2 with each block corresponding strictly to the interior unknowns of each quadrilateral element its inversion is trivially parallel consequently the block entries of the s 1 matrix in eq 18 are computed first in an element wise fashion with a subsequent assembly of the shared interfaces i e direct stiffness summation to enforce continuity deville et al 2002 patera 1986 the second and last level of condensation refers to the computation of a second schur matrix eq 19 for the vertical edges of the computational domain cf fig 1 c which results from the block gaussian elimination when solving for the p v group of unknowns in eq 19 19 s 2 s v v 1 s v h 1 s h h 1 1 s h v 1 s 2 p v g v 2 where g v 2 g v 1 s v h 1 s h h 1 1 g h 1 is the respective right hand side notice the division with the s h h 1 matrix for the computation of the second schur matrix and its right hand side similar to the case of h i i s h h 1 is block diagonal but now each block geometrically belongs to the horizontal edges of a vertical collection of elements i e subdomain cf fig 3 once the second schur system of equations is solved iteratively two successive dirichlet problems eq 20 are solved directly following the backward substitution step of the block gaussian elimination eq 17 18 first the horizontal edge unknowns are computed with a subsequent computation of the elemental interior unknowns eq 20 these inversions are local at a subdomain element level with corresponding dirichlet boundary conditions enforced by lifting the known solution karniadakis and sherwin 2013 lifting is a commonly used strategy for prescribing the contribution of the dirichlet boundary conditions to the interior unknowns by updating accordingly the right hand side of the system of equations cf eq 20 blackburn et al 2019 20 p h s h h 1 1 g h 1 s h v 1 p v p i h i i 1 g i h i h p h h i v p v 4 3 solving the second schur problem the second schur problem of eq 19 represents geometrically the coupling among the vertical edges of the computational domain s 2 is block tridiagonal fig 4 since each vertical edge has at most two neighboring edges with a bandwidth directly proportional to the vertical grid point count n z for high aspect ratio grids where the number of elements in x m x is much larger than that of the elements in z m z m x m z as in the simulation of highly nliws s 2 is a large matrix with a relatively small bandwidth furthermore s 2 is symmetric positive definite a property inherited from the original matrix h of eq 17 note that for k n 0 the s 2 matrix is positive semi definite and thus it is regularized via a nullspace projection of the right hand side vector pozrikidis 2001 essentially the inverse of s 2 is a full matrix which effectively enforces the coupling of all of the vertical edges degrees of freedom therefore imposing a global communication pattern among computational processes tufo and fischer 2001 consequently once a solution is obtained for the vertical edges the remaining solves eq 20 are local and embarrassingly parallel the block tridiagonal structure of the condensed schur matrix s 2 is amenable to the use of a direct solver in a purely serial framework nonetheless since a naive parallel block thomas algorithm performs poorly hirshman et al 2010 various techniques have been proposed for the solution of statically condensed coarse grid problems with efforts being concentrated on mitigating memory limitations and overall parallelization bottlenecks borrell et al 2011 tufo and fischer 2001 lee and wright 2014 seal et al 2013 nevertheless for computationally intensive simulations the use of an iterative solver is preferred due to efficiency considerations offermans et al 2019 4 4 deflation block jacobi preconditioned conjugate gradient solver a deflation based block jacobi preconditioned conjugate gradient solver is utilized for the solution of the second schur system of equations see eq 19 aubry et al 2008 saad et al 2000 mansfield 1990 as demonstrated in joshi et al 2016b for high aspect ratio leptic grids the combination of a block jacobi preconditioner with deflation ensures convergence independent of the domain aspect ratio the polynomial order of the elemental expansion and the number of elements used in the x direction although the convergence properties of this combined approach have been demonstrated for a high order collocation discontinuous element based method the effectiveness of this approach is transferable to symmetric discretizations like the spectral element method nicolaides 1987 as such for the domain decomposed second schur matrix its main block diagonal see fig 4 is used as a block jacobi preconditioner note that the choice of a non overlapping block jacobi preconditioner is a commonly adopted strategy fischer and rønquist 1994 couzy and deville 1995 joshi et al 2016b huismann et al 2017 which ensures that no communication overhead among processes is introduced during its application in parallel more specifically the block preconditioner is factorized during the set up stage of the solver with the overall factorization cost being amortized over the many pressure poisson solves per simulation for the deflation component of the iterative solver a deflation matrix z r n v n c is defined where n v dim s 2 is the total number of unknowns which reside on all of the vertical edges and n c m x 1 is the number of vertical edges whose columns are the deflation vectors z j with their entries given by joshi et al 2016b 21 z j i 1 if x i γ j v 0 if x i γ j v where i 1 n v j 1 n c and x i is a grid point that if resides on the γ j v vertical edge then the respective entry of the deflation vector is unity and zero if otherwise note that the choice of deflation vectors may affect the convergence rate of the iterative solver vermolen et al 2004 and the investigation of optimal deflation vectors is left for future work essentially z and z t can been interpreted as the prolongation and restriction operators commonly used in multigrid methods tang et al 2009 a coarse grid matrix c k n z t s 2 k n z r n c n c of the second schur matrix is then constructed this coarse schur matrix c is a good approximation of s 2 and is subsequently used to update the search direction of the deflated preconditioned conjugate gradient method achieving faster convergence aubry et al 2008 saad et al 2000 note that the coarse version of the second schur complement c k n is tridiagonal and can be seen as the one dimensional x direction equivalent of eq 13 using linear basis functions i e the helmholtz matrix for the fem joshi et al 2016b particularly for a high polynomial order where fewer elements are used in the x direction than in the equivalent in resolution lower polynomial order case the c matrix is much smaller in size than the original schur complement matrix i e n c n v therefore the coarse problem is solved directly and redundantly within each process to avoid any introduced communication overhead notice that the rank deficiency of the second schur complement matrix s 2 for the zeroth mode is passed onto c k n 0 nonetheless since the coarse matrix c is solved directly a regularization technique via householder matrices escobar vargas 2012 equivalent to the right hand side null space projection of the s 2 matrix see also section 4 3 is used pozrikidis 2001 however since the regularization technique on c is not sparsity preserving a one dimensional dd technique is adopted between the interior and the two boundary unknowns of the c k n 0 matrix first a 2 2 schur complement matrix is computed corresponding to the first and last unknowns of c k n 0 once this schur complement matrix is regularized and the two boundary values are computed a final tridiagonal solve is performed for the interior unknowns of c k n 0 matrix 4 5 viscous diffusive solves a simple strategy is adopted for the numerical solution of the viscous eq 11 and diffusive see section 3 4 parts of the solver it is during this step of the solver where boundary conditions for the velocity field and the density perturbation are enforced diamantopoulos et al 2021 consequently adhering to a dd approach for these implicit solves such as that described in section 4 2 1 would introduce an additional complexity regarding the enforcement of different types of boundary conditions for instance the dimensionality of the discretized system of equations will be accordingly reduced as for the case of dirichlet boundary conditions where the solution is already known at the boundaries karniadakis and sherwin 2013 following the discretization presented in section 4 1 4 2 the respective helmholtz matrix h u k n of eq 11 for a given transverse wavenumber k n is given by 22 h u k n α k 1 k n 2 m where the time step coefficient α eq 11 scales linearly with ν δ t or κ δ t thus for high reynolds number flows h u is diagonally dominant and h u 1 k n 2 m therefore the implicit viscous diffusive solves are performed iteratively for the uncondensed system of equations using the diagonal mass matrix m as a preconditioner blackburn et al 2019 which is an efficient preconditioning strategy for achieving convergence in a few iterations 5 implementation this section assesses the implementation s scalability and ability to tackle environmental scale domains for the temporal and spatial discretizations outlined in section 4 specifically the implementation of the sem fg flow solver is evaluated against its design goals to understand its bottlenecks and identify areas of interest for a future scaling study the sem fg flow solver s implementation was guided by three objectives to support scaling to large node and core counts 1 loose coupling between two dimensional subproblems 2 minimize communication and 3 maximize arithmetic intensity of computations nonetheless these goals alone are not sufficient for an efficient implementation e g use of efficient vendor libraries for computation is required but provide the foundations that frame its scalability both loose coupling and minimizing communication are necessary to maximize parallel execution and set an upper bound on performance through amdahl s law magoulès et al 2016 though the former is necessary to maximize gains from the method s parallel domain decomposition structuring computations to maximize arithmetic intensity provides opportunities for efficient execution often through external acceleration libraries for ffts and dense linear algebra each of these objectives drives towards an implementation that can be applied to large environmental scale problems the sem fg solver was designed as a pure mpi solver targeting a single rank per core on multi core hpc systems the structured nature of solver s computations admits flexible distribution of work to either mpi ranks or threads though a hybrid mpi openmp implementation was not pursued since the anticipated performance was comparable moreover a hybrid approach increases complexity in both maintenance and execution the analysis presented is limited to the parallel domain decomposition and the viscous and pressure solvers as their implementations directly reflect the discretization as outlined in section 4 2 1 components such as solver setup input and output and post processing are omitted as they are independent of the method for each component of interest an outline on how the method maps onto its implementation is provided along with a qualitative assessment of bottlenecks with respect to the aforementioned objectives 5 1 parallel domain decomposition following the hybrid approach of bolis et al 2016 a two dimensional parallel decomposition in the x and y directions is used the y dimension is a natural choice due to the fourier discretization allowing the solution of a three dimensional system to be pursued through solving parallel two dimensional subproblems the x dimension is chosen over the z since sem fg target problems have a high horizontal aspect ratio 10 1 and the parallel decomposition along x provides greater opportunities for scaling due to significantly more horizontal elements additionally this results in minimizing the data exchanged between ranks as the vertical surface area between subdomains is significantly smaller than the horizontal surface area two communication patterns emerge when decomposing in x and y 1 along x z planes with point to point exchanges of vertical subdomain edges and collective communications during conjugate gradient iterations and 2 along x y planes with all to all data exchanges coupling all the transverse fourier modes during non linear advection term computations each two dimensional subproblem spends the majority of its time communicating with the ranks in its x z plane with the coupling communications in the y direction occurring a fixed number of times per time step ultimately framing sem fg s execution as a collection of loosely coupled two dimensional subproblems from an implementation standpoint sem fg maps its mpi ranks p i onto a two dimensional cartesian topology p i p x y subsets of the computational domain are assigned to each process both in the subdomain x and wavenumber y sense such that each process p x y holds one or more subdomains in x and one or more transverse wavenumbers in y directions respectively fig 5 illustrates the aforementioned decomposition topology and communication patterns as part of the pressure and viscous solves vertical edge exchanges are performed between adjacent ranks within an x z plane to enforce c 0 continuity and are performed simultaneously across all ranks within a local two dimensional subproblem due to the parallel decomposition in x the data size transferred between adjacent ranks is fixed at n v m z n 1 values i e the grid resolution in the vertical direction collective communication within each two dimensional subproblem occurs as a small fixed number of reductions to compute dot products during conjugate gradient iterations due to deflation based preconditioning the pressure solve also has a collective exchange to distribute deflation vectors computation of non linear advective terms is done in physical space which necessitates transforming grid points from fourier space and back since wavenumbers are distributed along y collective exchange amongst ranks in the transverse dimension is required to compute each fourier transform the exact number of ffts depends whether the flow is stratified and thus eq 2 is solved though needs to compute o 10 m z n 2 n y point real valued ffts per timestep the volume of data exchanged between ranks is o 8 m z n y n 2 bytes per transform advection terms are computed once per timestep and result in the only synchronization point across all ranks in the y dimension to better understand loose coupling and explore sem fg s scalability limitations the aforementioned communication patterns are qualitatively analyzed this is performed by examining the choices for allocating subdomains to individual ranks and assessing the bottlenecks that emerge for the scaling analysis discussed below one dimension either x or y is fixed to an arbitrary size and the other dimension is varied between extremes choices for distributing vertical subdomains amongst ranks in x range from all subdomains on a single rank to one subdomain per rank while it eliminates communications the extreme where a single rank has an entire x z plane is infeasible due to memory requirements and is not considered further on the other extreme mapping a single subdomain to one rank results in minimal computation per rank with a slight increase in communications overhead as more ranks participate in the collective reductions the time saved in per rank computation is expected to exceed the increased communication overhead for all environmental scale problems resulting in an overall smaller time per timestep finally execution with more than one subdomain per rank results in a larger time per timestep than in the single subdomain per rank though by how much is unknown without a strong scaling study distributing transverse subdomains amongst ranks in y follows a similar argument though differs in that the time per timestep is limited by the slowest two dimensional subproblem since each subproblem s wavenumber correlates to its condition number cf eq 16 22 which is proportional to the number of conjugate gradient iterations required the time per timestep is max i t i where the i th rank s total time t i k t i k is the sum total time of each of its k many two dimensional subproblems as a result the extreme case where each rank solves a single two dimensional subproblem minimizes the total time per timestep the case where ranks solve multiple subproblems results in a load imbalance requiring partitioning wavenumbers across ranks to avoid such an inefficiency the current implementation of sem fg naively partitions wavenumbers in sequential order and leaves load balancing in y as a future effort given the aforementioned communication patterns the method described in section 4 maps well to the parallel domain decomposition increasing ranks in y reduces total time per timestep while increasing ranks in x trades per rank computation for slightly increased collective communication overhead increasing ranks in both x and y will reduce time per timestep for environmental scale problems though cannot be quantified without a scaling study 5 2 pressure solve the method s domain decomposition results in a smaller isolated problem where only the shared vertical edges are collectively solved allowing the shared horizontal edges and interior elements to be computed locally and without additional communication as a direct result of the two level static condensation since κ s 2 κ h carvalho et al 2001 this results in fewer iterations of deflation based preconditioned conjugate gradient dpcg each operating only on the vertical edges rather than the entire subdomain both solving d 1 x v f where d stands for the block jacobi preconditioner and computing s 2 x v operate on matrices sized n v n v which are a factor of n 1 2 smaller than the entire subdomain additionally these operations map directly onto lapack and blas routines dpotrs and dgemv respectively that are accelerated by vendor implementations in addition to reducing the size of the collective problem the method s two level condensation also trades communications for local work first the coarse direct solve of c 1 z t x v in the dpcg iterations is redundantly computed in each rank rather than collectively given the tridiagonal symmetric positive definite nature of c 1 z t this can be efficiently solved o 8 m x flops golub and van loan 2013 and is an obvious trade for fewer collective communications within each iteration once an iterative solution is computed for the shared vertical edges each rank can compute solutions to horizontal edges and interior elements without any further communication within the x z plane the matrices involved in lifting and solving the rhs for the interior the elements cf eq 20 sized 4 n n 1 2 and n 1 2 n 1 2 respectively lends itself to exploring acceleration libraries tailored to small sizes and batched execution both blasfeo frison et al 2018 and libxsmm heinecke et al 2016 provide tuned implementations for small dense linear algebra problems including matrix vector operations while blasfeo also solves systems of equations with cholesky factorization while increasing the efficiency of the dpcg iterations reduces the total time per timestep potentially larger gains are available by reducing the number of iterations required as seen in eq 15 and described in section 4 sem fg s time per timestep is directly limited by the number of iterations required by the k y 0 wavenumber subproblem as such improvements to the preconditioning strategy have a significant impact in reducing the time spent in the pressure solve identifying a better selection of deflation vectors is an area of future work 5 3 viscous solve compared to the pressure solve sem fg s viscous solve is both a smaller and better conditioned problem due to its dominant diagonal structure c f second term of right hand side of eq 22 application of boundary conditions and lifting the rhs result in per element matrix vector multiplications of m and h all of size n 1 2 n 1 2 preconditioned conjugate gradient pcg iterations consist of per element matrix vector multiplications with h though the conjugate gradient solution operates on vertical edges due to the domain decomposition resulting in scalar operations of size n v m x s n 1 where m x s stands for the number of subdomains per mpi process of note the block jacobi preconditioner is applied through an element by element hadamard product golub and van loan 2013 since the matrix m 1 can be precomputed during solver setup due to its diagonal structure as a result all of the viscous solve s operations are either matrix vector multiplications that map directly onto blas routines or vectorizable array operations similar to the pressure problem the viscous solve may benefit from a blas implementation tuned for small matrices so as to accelerate the small matrix vector multiplications contained in pcg iterations 6 stabilization techniques in under resolved simulations which is predominately the case in environmental flow modeling sem fg uses an exponential filter diamessis et al 2005 vandeven 1991 as a surrogate of a hyperviscous operator moura et al 2016 both in the periodic y and non homogeneous directions x z each velocity component and density perturbation are filtered once every time step after the computation of the non linear eq 6 and advective terms respectively the filter orders in y q y and x z directions q x z are reported for each benchmark in section 7 additional stabilization is achieved in the x z non homogeneous directions via polynomial over integration or equivalently referred to as polynomial dealiasing kirby and karniadakis 2003 of the non linear and advective terms malm et al 2013 details regarding the stabilization techniques used in this work are provided on appendices a and b 7 benchmarks in this section the overall accuracy of the solver is demonstrated for a series of benchmarks of increasing complexity ultimately building up to a three dimensional benchmark of a convectively breaking isw propagating over a realistic bathymetry rivera rosario et al 2022 results are validated when applicable with analytical solutions or with other studies for both unstratified and stratified flows 7 1 kovasznay flow the steady state kovasznay flow kovasznay 1948 is a commonly used test case for the validation of high order two dimensional incompressible flow solvers it is based on an exact solution of the incompressible navier stokes equations for a laminar flow past a two dimensional grid eq 23 hesthaven and warburton 2007 manzanero et al 2020 kirby and sherwin 2006 on ω 0 5 1 0 5 1 5 m 2 a time step of d t 1 0 3 s is chosen for a constant number of equally sized elements 8 8 and a varying polynomial order i e p refinement hesthaven and warburton 2007 simulations are initialized with the exact solution of the velocity field given in eq 23 for non homogeneous dirichlet boundary conditions and performed over a time span of t 0 1 s lastly viscosity is uniform and set equal to ν 1 40 m2 s no exponential filtering is used since the flow is laminar and well resolved the l 2 error norm of the field variables is shown in fig 6 at time t 1 s as a function of the polynomial order per element per dimension notice the exponential convergence kopriva 2009 of sem similar to a global spectral method achieving an error close to machine precision as the polynomial order within each element increases 23 λ 1 2 ν 1 4 ν 2 4 π 2 u 1 exp λ x cos 2 π z w λ 2 π exp λ x sin 2 π z p 1 exp 2 λ x 2 7 2 normal collision of a vortex dipole with a no slip wall the normal collision of a vortex dipole enables the validation of the fully non linear time dependent inse by examining the propagation of a distinct flow feature namely the vortex dipole and its interaction with the finer scale boundary induced vorticity as it reaches the bottom wall the work of subich et al 2013 is used as a reference since it offers a detailed comparison with previous numerical experiments in the context of high order discretizations clercx and bruneau 2006 kramer et al 2007 the two dimensional collision is initially investigated with a subsequent extension to three dimensions by incorporating a third periodic transverse direction as in subich et al 2013 in this study simulations were performed for a moderate reynolds number of r e u h ν 1250 clercx and bruneau 2006 where h 1 m is the half length of the normalized computational domain ω 1 1 1 1 and u is the computed full domain averaged rms velocity 24 u 1 4 ω u 2 x t 0 d ω 1 m s the initial two dimensional velocity field u u w induced by the dipole is given by the following expressions 25 u u ω 0 2 z z 1 exp r 1 2 r 0 2 ω 0 2 z z 2 exp r 2 2 r 0 2 w u ω 0 2 x x 2 exp r 2 2 r 0 2 ω 0 2 x x 1 exp r 1 2 r 0 2 where x 1 z 1 0 1 0 is the initial dimensionless location of the positive monopole x 2 z 2 0 1 0 is the initial dimensionless location of the negative monopole r 1 r 2 is the distance from the center of the positive and negative monopole respectively r 0 is the radius of each monopole and ω 0 299 5284 is the amplitude of the monopole s vorticity ω computed from eq 24 note that the x z plane is used for this benchmark therefore the y component of vorticity is reported throughout the presentation of two dimensional and three dimensional results in particular the sign of vorticity not its direction is inverted due to a different choice of cartesian axes when compared to previous studies clercx and bruneau 2006 kramer et al 2007 subich et al 2013 a constant polynomial order of n 8 per element per direction is used for a varying number of elements m x m z with m x m z additionally a grid stretching strategy is used in the bottom half of the domain to better resolve the fine bottom boundary layer features resulting from the dipole collision with the wall the ratio of the heights of two adjacent elements in the vertical is equal to a constant φ z δ z i 1 δ z i 1 varying width elements with a constant ratio of φ x 0 92 symmetrically placed around the center of the domain are used for two of the cases fig 7 in total three simulations were performed by increasing the grid resolution in x and z directions through an increase of the number of elements with the corresponding minimum horizontal δ x m i n and vertical grid spacings δ z m i n shown in table 1 a weak filter of q x z 14 order is used for both the two dimensional and three dimensional simulations with a transverse filter order of q y 48 affecting only the top 23 of the transverse wavenumber range is used for the three dimensional test case three metrics are used to assess the efficacy of the simulations the total kinetic energy 26 k e t 1 2 ω u x t u 2 d ω the magnitude and time of occurence of the maximum enstrophy 27 e t 1 2 ω ω x t u h 2 d ω and the location and strength of the maximum negative vorticity of the primary monopole as described in subich et al 2013 as the dipole propagates downward and comes sufficiently close to the wall a bottom boundary layer is formed with an induced vorticity of opposite sign from that of the primary monopole once the boundary layer induced vorticity interacts with the primary monopole fig 8 the total enstrophy assumes a maximum value and dissipation of kinetic energy increases fig 9 a secondary smaller increase of enstrophy occurs later in time when the primary vortex recirculates and interacts again with the bottom boundary generated vortices the maximum enstrophy and time of its occurence for different grid resolutions as compared to previous studies clercx and bruneau 2006 kramer et al 2007 subich et al 2013 are reported in table 2 lastly the strength of the maximum negative vorticity of the primary monopole at t h u 0 6 and the corresponding location of this maximum are reported in table 3 for all the reported quantities in both tables 2 and 3 agreement with previous studies improves for increasing resolution 7 2 1 extension to three dimensions the three dimensional benchmark of the vortex dipole collision is performed by extruding the x z computational domain ω into ω ω 0 0 4 the x z resolution corresponds to the 513 513 grid shown in table 1 along with a discretized y direction of n y 96 grid points white gaussian noise is added onto every velocity component at each grid point of the computational domain following the same approach as in subich et al 2013 in total two three dimensional runs are performed for the same grid resolution albeit with different noise amplitudes determined by the standard deviation σ of the gaussian white noise which is set equal to σ 1 0 2 as in subich et al 2013 and σ 1 0 3 for the stronger and for the weaker noise run respectively the evolution of averaged in y enstrophy and kinetic energy ke for the three dimensional benchmarks is shown in fig 9 the σ 1 0 2 test case follows the same behavior as the two dimensional simulation up until the first interaction of the dipole with the no slip driven vorticity at the bottom boundary at this point enstrophy continues increasing which is a signature of fine structure assuming larger values due to vortex stretching with a concurrent increase of ke dissipation when compared to its two dimensional counterpart although the standard deviation of the noise is equal to the one reported in subich et al 2013 the three dimensionalization of the flow starts much earlier where any initial secondary transverse instabilities harris and williamson 2012 are bypassed due to the strong amplitude noise this deviation is attributed to the weak filtering order q y 48 in the periodic direction which is further enforced by examining the evolution of the enstrophy and ke for the σ 1 0 3 run and possible subtle changes in the structure of the noise in that case due to the weaker perturbations which drive a slower growth rate of any transverse flow structure enstrophy starts deviating later in time from the two dimensional benchmark after the first interaction of the dipole with the bottom generated vorticity a second peak of enstrophy of almost equal strength with the first one is now observed during the second interaction of the dipole with the bottom boundary generated vorticity similar to the one reported in subich et al 2013 the second enstrophy peak drives an increase in ke dissipation as in the σ 1 0 2 case albeit less intense lastly in fig 10 two isosurfaces of the transverse vorticity ω y and one iso surface of the magnitude of vorticity ω ω x 2 ω y 2 ω z 2 1 2 are shown for the σ 1 0 3 test case soon after the second enstrophy peak the almost parallel to the x z plane generated vorticity indicates the three dimensionalization of the flow similar patterns are also observed in subich et al 2013 7 3 stratified test cases the stratified test cases share the common theme of the propagation of an internal solitary wave isw of depression under different conditions starting from an idealized configuration i e two layer continuous stratification with no background current uniform depth and inviscid flow the complexity of the simulations is gradually increased initially a small bathymetric feature is incorporated culminating into a study of the three dimensional propagation of an isw over a realistic bathymetry with realistic background currents and stratification inspired by actual measurement in the south china sea scs lien et al 2012 2014 the propagation of an isw is used as a platform to assess the robustness of the flow solver because of the delicate inherent balance between their non linear steepening and physical dispersion consequently if a numerical discretization is not carefully chosen any spurious flow features such as non physical dispersive trailing waves erroneous propagation speed or artificial amplitude attenuation due to numerical diffusion introduced by the flow solver will eventually compromise the simulation by virtue of the hybrid sem fg numerical method used the dynamic nature of the two dimensional convectively breaking isw is successfully captured along with the three dimensional scales down to grid resolution 7 3 1 tankscale isw in uniform depth water the initial isw satisfies the dubreil jacotin long djl equation long 1953 dunphy et al 2011 for an initial available potential energy ape of a p e 0 05 j m under a continuous two layer stratification 28 ρ ρ 0 1 δ ρ 2 ρ 0 tanh z h 1 δ where ρ 0 1000 kg m3 is the reference density δ ρ 40 kg m3 is the difference between the lower and upper densities h 1 3 cm is the upper layer depth and δ 0 5 cm is the interface thickness the isw propagates inviscidly where the viscous diffusive terms in eqs 1 2 are deactivated and the time discretization is adjusted accordingly the wave is expected to propagate in a uniform depth tank of h 15 cm and length l 10 l w 6 9 m where l w 0 69 m is the isw s width with a djl prescribed constant propagation speed of c 0 1145412 m s in regards to spatial discretization a resolution of n x n z 513 257 grid points is used in the x and z directions respectively for a polynomial order n 8 per element in each dimension and uniform sized quadrilateral elements fig 11 a shows the djl based isw which is used as an initial condition for the tankscale uniform depth propagation as well as for the wave propagation over a small bathymetric feature as examined in section 7 3 2 the overall numerical dissipation of the flow solver as generated by the numerical filtering is investigated by calculating the kinetic energy k e ρ 0 2 ω u 2 x t d ω of the isw as a function of time in the case of the inviscid propagation of an isw in a constant depth waveguide on purely physical grounds the ke of the isw should remain constant in practice however when a high order discretization is used mitigation of any aliasing induced instabilities attributed to the non linear terms of inse requires the introduction of an artificial albeit controlled dissipative mechanism an initial increase of the ke dissipation rate is observed due to the reduced order of the time integration scheme for the first two time steps of the solver fig 12 once the high order time integration is established the dominant source of dissipation is the weak exponential filter of order q x z 14 used more specifically the ke assumes a constant value of ke t 1 6 1 0 4 which corresponds to 0 1 ke loss per width of propagation where ke is the isw s kinetic energy normalized by the initial ke of the wave note that the overall loss of ke can be used as a useful metric to assess the artificial dissipation introduced by a stratified flow solver for a uniform depth waveguide inviscidly propagating isws should have a constant propagation speed c consequently by tracking the position of the wave as a function of time one should expect a straight line of slope c the ability of the flow solver to perform reliably in this context is shown in fig 13 where the position of the trough of the wave is given as a function of time obtained through linear regression the numerically computed propagation speed of the wave c n u m 0 1145173 m s is in excellent agreement with the djl based initial propagation speed of the isw with a relative error of 2 1 1 0 4 7 3 2 tankscale isw over a gaussian bump an additional level of complexity is now introduced by inserting a small bathymetric feature in the propagation path of the djl based isw considered in section 7 3 1 to accurately represent the gaussian bump the computational mesh and the respective elements in the vicinity of the topographic feature are curvilinear and highly deformed as shown in fig 11 thus the capability of the solver for supporting complex boundary geometries is tested the isw propagates over a gaussian bump of height h b 0 03 h and width l b 3 l w 4 with the initial configuration shown in fig 11 a the dimensions of the bump are chosen for the isw to propagate over this feature without inducing any convective or shear instabilities over such a gentle bathymetric feature the isw responds to the bathymetric change by slightly adjusting its waveform but recovers its original shape fig 11 b and propagation speed as soon as it moves back into uniform depth water therefore this adjustment and recovery of the isw waveform are an additional aspect of the flow solver testing provided by this benchmark as the wave approaches the bump it slows down and its ke is converted into available potential energy ape lamb and nguyen 2009 note that the computation of the isw s ape is not included in this work the reverse energy exchange is observed once the isw goes over the bump the wave accelerates its ape decreases with an accompanying increase of its ke the evolution of the isw s ke as it propagates over the bump are shown in fig 12 notice when the isw has gone over the bump its ke assumes values close to the uniform bottom test case indicating how the isw recuperates its original waveform as it propagates again over a uniform bottom the position of the trough of the wave as function of time is shown in fig 13 as the wave propagates over the bump the slope i e the propagation speed changes but quickly returns close to the original values as the water depth becomes uniform lastly no error is introduced by the representation of the complex boundary due to the high polynomial order used for each element steinmoeller et al 2016 7 4 south china sea shoaling isw in this section the three dimensional inviscid shoaling of an isw of depression over a realistic gentle bathymetric slope in the south china sea scs and its three dimensional convective instability are explored this benchmark problem consists of the ultimate objective of code development regarding the three dimensional propagation of isws and nliws in general over realistic configurations namely the flow solver has to successfully capture the isw adjustment over long distances on a constantly varying waveguide by combining realistic background stratification current profiles based on the observational work of lien et al 2012 2014 in the scs simulations towns et al 2014 are performed primarily following the methodology of rivera rosario et al 2020 2022 albeit for a different numerical method filtering order used and value of viscosity in regards to the three dimensional shoaling isw simulation adhering to a hybrid spatial discretization may at first seem restrictive since transverse bathymetric variations cannot be represented nonetheless the restriction to such a bathymetric homogeneity in the y direction is offset by the solver s implementation and the resulting performance gains as such the decoupling of the transverse direction during the implicit solves greatly reduces the computational cost per time step and hence allows the optimal resolution of as large as possible a range of turbulent length scales diamantopoulos 2021 consequently and without deviating from the observed normal to isobath propagation of isws in the scs this hybrid approach allows in an optimized fashion the investigation of the onset of the convective instability and the subsequent development of turbulence induced solely by bathymetric variations on the x z plane the initial isw is the baseline wave of amplitude a 143 m as in rivera rosario et al 2020 initially the isw starts propagating from an artificial plateau of 921m to bypass any artificial shoaling response at the wavescale the simulation is originally performed in two dimensions up to approximately the 25 7km of the transect fig 14 at this stage of the simulation the computational domain is extruded in the y direction with a width of l y 50 m in this work a weak filtering is utilized until the onset of the convective instability where the flow is highly energetic and thus the filtering becomes slightly stronger in the x z plane as shown in table 4 other modeling parameters and grid resolution for the whole computational domain are shown in the same table notice the variation of the resolution in the x direction for increasing range values although the minimum resolution in the x direction is restricted to δ x 2 m as the wave becomes convectively unstable finer scale three dimensional structures within the core of the wave can still be identified cf fig 18 further quantitative results outside of the scope of this paper are needed to determine whether the observed finer scale three dimensional structure developed inside the wave is truly turbulent such computationally demanding turbulence resolving simulations will be the topic of a future study diamantopoulos 2021 both the two dimensional and three dimensional simulations were performed in overlapping windows i e successive subsets of the computational domain on the x z plane which encompass the wave as it propagates over approximately 7 wavelengths across each window fig 15 for the three dimensional runs each window spans approximately 13km of the transect with an overlapping region of 6km this overlapping technique greatly reduces the overall computational cost per time step since only a fraction of the degrees of freedom which account for the full scs transect are solved during each fractional step of the solver rivera rosario et al 2020 therefore the resulting flops the introduced parallel communication overhead per time step as well as the memory footprint are substantially smaller when compared to a simulation that would be performed over the full scs transect upon the initialization of the first three dimensional windowed run perturbations rivera rosario et al 2022 of amplitude equal to 3 1 0 5 units are m s for velocity and kg m3 for density are inserted to each field variable the noise is added once in every velocity component and in the density perturbation on every grid point of the computational domain specifically white noise is inserted on each x z plane adhering to a 5 3 slope spectra in the transverse y direction as the isw shoals and enters shallower waters its propagation speed decreases below the maximum induced horizontal velocity c f fig 19 consequently it undergoes a distinct convective instability at a critical depth unlike the setup of vlasenko et al 2005 where the rear of the wave significantly steepens because of the much higher proximity of pycnocline to the bottom the scs shoaling isw preserves its symmetric waveform fig 16 shows the onset of the trapped core formation and evolution of the convective instability for the scs shoaling isw as the wave shoals heavier isopycnals than those in its interior detach from the rear of the wave fig 16a and eventually plunge in the form of an inclined gravity current into the interior of the wave fig 16b c the resulting flow structure inside the wave resembles the corresponding one reported in recent studies on subsurface trapped cores he et al 2019 rivera rosario et al 2020 2022 the onset of the convective instability leads to the development of a lateral instability fig 17 which eventually grows in amplitude as the core develops this heavy over light configuration eventually drives the formation of the subsurface core he et al 2019 and the associated turbulent like structure and localized mixed regions inside the wave in three dimensions fig 18 once the isw starts to become convectively unstable a secondary transverse instability gradually grows in amplitude fig 17 which drives the three dimensionalization of the flow field as the isw continues to shoal fig 18 as previously stated the transition to turbulence from the formation of the trapped core its persistence as well as the induced mixing will be further explored via higher resolution simulations in a future study note that the initial transverse mode differs from the one reported in rivera rosario et al 2022 possibly due to differences in the inserted perturbations specifically perturbations are inserted only in two of the velocity components with the transverse velocity component being computed by virtue of the projection onto a solenoidal velocity field during the time advancement of inse eq 10 the development of three dimensional transition fig 17 and turbulent like structure of the isw s interior fig 18 is delayed as compared to field measurements lien et al 2014 where a fully turbulent trapped core at approximately the 54th km of the transect was observed for further comparison to field data and different noise insertion strategies for accelerating the three dimensionalization of the flow field the reader is referred to the study of rivera rosario et al 2022 fig 19 shows the variations of the maximum induced horizontal velocity u m a x and propagation speed c as the wave shoals for more details on the methodology of computing c the reader is referred to the work of rivera rosario et al 2020 2022 both of these properties are computed from the y averaged velocity field since it is shown that their differences per x z plane are negligible the along propagation path location of the onset of the convective instability which takes place when the maximum horizontal induced velocity exceeds the propagation speed of the wave i e u m a x c 1 is consistent with the locations of snapshots of the isopycnal overturning shown in fig 16 furthermore as the wave shoals the u m a x c ratio follows the same evolution fig 19 as in rivera rosario et al 2020 8 conclusions and future work in this work a continuous hybrid nodal spectral element fourier galerkin flow solver for the simulation of fully non hydrostatic stratified flows is presented the solver is specifically designed for the long high aspect ratio and variable bathymetry computational domains encountered in the normal to isobaths propagation of non linear internal waves and the resulting turbulence in the wave interior a defining feature of the non linear internal waves is their strong non hydrostatic nature which necessitates the solution of a pressure poisson problem when combined with the high aspect ratio complex bathymetry domains the efficacy of numerically solving the pressure poisson equation is of paramount importance for the overall performance of the flow solver adopting a domain decomposition technique for the pressure poisson equation the resulting condensed schur complement problem is solved via a block jacobi deflated preconditioned conjugate gradient iterative solver a robust preconditioning technique is used which ensures favorable convergence properties i e low iteration count for the examined domains and flow problems as recently demonstrated in joshi et al 2016b the initial flow solver implementation meets its design goals of producing three dimensional physics from a collection of coupled two dimensional problems minimizing communications and expressing the method as regions of structured computations qualitative assessments indicate the implementation will scale well to tackle environmental scale problems and will be validated with a future scaling study future performance improvements include identifying more efficient choices of deflation vectors to reduce the pressure solver s iteration count as well as exploring acceleration libraries providing tuned implementations for small dense linear algebra problems as reported in section 5 2 the overall accuracy of the flow solver is demonstrated through a suite of benchmarks showing a good agreement when compared to analytical solutions and previous studies the benchmarking effort culminates with the three dimensional shoaling of an internal solitary wave of depression over realistic bathymetry and background conditions in the south china sea motivated by in situ observations of lien et al 2012 2014 the flow solver captures the key features of the shoaling wave along with turbulent like structures in its interior showing a really good agreement with previous studies rivera rosario et al 2020 2022 future turbulence resolving computationally intensive simulations of the shoaling internal solitary wave in the south china sea will be performed utilizing this solver diamantopoulos 2021 additional applications in stratified flows such as the simulation of internal swash zones emery and gunnerson 1973 thorpe and lemmin 1999 davis et al 2020 and the potentially related boundary interior exchange mcphee shaw et al 2021 excited by deep water waves will also be investigated credit authorship contribution statement theodoros diamantopoulos conceptualization data curation formal analysis investigation methodology software visualization writing original draft sumedh m joshi conceptualization methodology software greg n thomsen software writing original draft gustavo rivera rosario conceptualization methodology software writing review editing peter j diamessis conceptualization funding acquisition project administration resources supervision writing original draft kristopher l rowe conceptualization declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments the authors would like to thank professor charles f van loan for his comments on the domain decomposition and schur complement matrices the authors would also like to thank professors larry redekopp and jan hesthaven for sparking the original inspiration to develop a high order element based flow solver to simulate shoaling nonlinear internal waves jorge escobar vargas was instrumental in the very early stages of model development sumedh joshi made critical contributions in the earlier stages of this effort the authors are additionally grateful to dr ren chieh lien and professor kevin lamb for their patience and ceaseless encouragement in this long development endeavor the authors would also like to thank professor marek stastna for his suggestions during the revision of the manuscript this work used the extreme science and engineering discovery environment xsede which is supported by national science foundation grant number aci 1548562 the shoaling isw simulations used the extreme science and engineering discovery environment xsede stampede2 at the texas advanced computing center tacc through allocation tg ees200010 financial support is gratefully acknowledged from national science foundation division of ocean sciences oce grant number 1634257 the work in this paper is the culmination of a 15 year long grass roots effort obsessively pursued by a small highly dedicated number of individuals we have persevered past adversity and have brought our labor of love to completion this publication is dedicated to the memory of sumedh m joshi who sadly does not get to see the results of his efforts appendix a exponential filtering since a continuous galerkin discretization is used in the x z directions it is crucial for the filtered quantity to preserve the c 0 continuity of the numerical method boyd 1998 therefore a discrete polynomial transform dpt takes place before the application of the exponential filter using appropriate basis functions which ensure the c 0 continuity among elemental interfaces essentially a dpt is the mapping from the nodal coefficient space i e lagrange polynomials to the modal coefficient space instead of the commonly used legendre basis functions the modal coefficients of a field variable are computed for the boundary adaptive basis functions canuto et al 2007 karniadakis and sherwin 2013 in one dimension the boundary adaptive basis functions are comprised of two linear basis functions which are non zero at the two boundaries and a series of basis functions or bubble modes of increasing polynomial order i e hierarchical which are zero at the boundaries thus a subsequent filtering only of the respective bubble modes ensures the continuity among element interfaces let σ r n 1 n 1 be an exponential filtering diagonal matrix with corresponding entries the values of the filtering function evaluated at a given polynomial mode see eq 36 in diamessis et al 2005 where n is the polynomial order of the expansion then the one dimensional filtering matrix f r n 1 n 1 is given by the following expression a 1 f v σ v 1 where v r n 1 n 1 is the forward discrete polynomial transform matrix with columns the computed boundary adaptive basis at the gauss lobatto legendre points canuto et al 2007 lastly the inverse v 1 denotes the backward transform from nodal to modal coefficient space note that the two dimensional equivalent filter matrix is simply computed by taking the kronecker product of the one dimensional filter matrix f with itself appendix b non linear terms calculation the explicit step of the time splitting scheme eq 6 for any velocity component u of the velocity vector is shown following a galerkin approximation in the non periodic domain ω to simplify notation the density perturbation term is omitted and the intermediate velocity u is time advanced using a first order time integration scheme j 1 i e euler method which can be easily extended to a higher accuracy time integration therefore eq 6 for a given test function v is written as b 1 ω v u d ω ω v u d ω δ t ω v n u d ω where n u u u is the non linear operator based on the discretization presented on section 4 the non linear term n u is approximated in ω as a linear combination of two dimensional lagrange polynomials b 2 n u x y z k 1 n n u k y h k x z where n are the degrees of freedom within a x z plane note that the test function v the intermediate velocity u and the previous time step velocity u adhere to the same discretization thus eq b 1 is discretized into the following matrix form b 3 m u y mu y δ t m n u y where m is the mass matrix and n u y n u k y u y u k y u y u k y are the nodal values of n u u and u respectively now the second term of the right hand side of eq b 3 is equal to b 4 m n u y c u y where c i j ω h i u h j d ω is the weak form based discrete non linear operator in high r e advection dominated flows such as the propagation of non linear internal waves and the associated turbulence aliasing induced instabilities due to inexact integration of the entries of c matrix may compromise the simulation this is of particular importance on complex computational domains where the integrand of c i j includes the associated metric terms for the mapping of the physical domain to the computational domain furthermore since it is a common practice for the use of an isoparametric mapping kopriva 2009 see appendix c for more details the integrand of c i j has an elevated polynomial order and thus any inexact numerical integration using the gauss lobatto legendre points karniadakis and sherwin 2013 is exacerbated if not properly treated on this account stability is ensured via polynomial over integration on c to retain its skew symmetry malm et al 2013 briefly the integrand of c i j is spectrally interpolated into an over integration grid for its integral to be computed exactly through numerical integration for more details regarding the computation of c in deformed geometries the reader is referred to deville et al 2002 malm et al 2013 lastly the fourier coefficients of the intermediate velocity u are obtained by first inverting the diagonal mass matrix m of eq b 3 followed by a discrete fourier transform in y f y b 5 u k n f y u y δ t n u y where k n is a transverse in y wavenumber appendix c mapping to curvilinear elements an isoparametric approximation kopriva 2009 is adopted for representing the mapping between the computational grid coordinates of the reference quadrilateral element ξ η ω e 1 1 1 1 and the physical coordinates x e ξ η z e ξ η r 2 for each element c 1 x e ξ η i 0 n j 0 n x i j l i ξ l j η z e ξ η i 0 n j 0 n z i j l i ξ l j η where x i j z i j are the physical grid coordinates within a quadrilateral element and l i l j are the one dimensional lagrange polynomials in the reference domain from eq c 1 the partial derivatives of x e z e with respect to the reference coordinates ξ η can be easily computed numerically via the use of two dimensional spectral differentiation matrices costa and don 2000 furthermore the derivatives of the inverse mapping in two dimensions are computed as kopriva 2009 c 2 ξ x η x ξ z η z 1 j z η z ξ x η x ξ where j x ξ z η z ξ x η 0 is the jacobian of the transformation notice that both the derivatives of the inverse mapping with respect to the physical coordinates and the jacobian are used throughout the computation of derivatives and integrals respectively e g first left hand side term of eq 14 for more details regarding the computation of the elemental stiffness and mass matrices cf eq 16 for curvilinear elements the reader is referred to the textbook of deville et al 2002 in the context of a domain decomposition the use of curvilinear elements dictated by complex computational geometries requires a unique mapping to the reference element ω e as such each elemental matrix differs from element to element since the jacobian of the transformation j assumes different values per grid point deville et al 2002 consequently any tensor product based calculations for the inversion of the self interaction matrices h i i and s h h 1 see eq 20 are not in this case applicable huismann et al 2019 couzy and deville 1995 
