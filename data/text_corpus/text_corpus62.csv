index,text
310,the dynamic pore network modeling as an efficient pore scale tool has been used to understand imbibition in porous media which plays an important role in many subsurface applications in this work we aim to develop a dynamic pore network model for imaged based modeling of spontaneous imbibition in porous media the µct scanning of a porous medium of sintered glass beads is selected as our study domain we extract its pore network by using an open source software of porespy and further project the extracted information of individual watersheds into multiform idealized pore elements a number of case studies of primary spontaneous imbibition have been conducted by using both the pore network model and a vof model under different wettability values and viscosity ratios we compare those model predictions in terms of imbibition rates and temporal saturation profiles along the flow direction we show that our pore network model can well predict imbibition rates and temporal saturation profiles under different viscosity ratios and wetting conditions in comparison to the vof model we explore the effect of viscosity ratio on the trapping of nonwetting phase moreover we discuss the difference between spontaneous imbibition and quasi static imbibition in terms of pore filling mechanisms 1 introduction spontaneous imbibition plays an important role in many subsurface applications such as oil recovery in fractured reservoirs liu et al 2020 morrow and mason 2001 shale gas extraction zheng et al 2018 and geological sequestration of carbon dioxide guo et al 2016 in those applications the imbibition rate and the trapping of nonwetting phase are of great interest spontaneous imbibition is usually categorized into cocurrent and countercurrent spontaneous imbibition in cocurrent spontaneous imbibition the wetting phase enters a porous medium through one boundary while the nonwetting phase is displaced from the medium via other boundaries by contrast in countercurrent spontaneous imbibition the wetting and nonwetting phases respectively enter and leave a porous medium via the same boundary in this work we focus on cocurrent spontaneous imbibition henceforth spontaneous imbibition is referred to as cocurrent spontaneous imbibition unless otherwise stated to predict the imbibition rate by the two phase darcy model a number of material properties need to be determined such as capillary pressure and relative permeability alyafei et al 2016 schmid et al 2016 moreover sharp wetting fronts observed in many core scale experiments akin et al 2000 alyafei et al 2016 kuijpers et al 2017 indicate that dynamics in spontaneous imbibition is strong particularly at its early stage this challenges conventional measurements of material properties which were mostly conducted in equilibrium or steady state zhuang et al 2017 in this regard pore scale models of spontaneous imbibition are invaluable to explore the dynamic effect on those material properties furthermore it helps to improve darcy scale imbibition models there have been extensive pore scale numerical studies of two phase flow in porous media which cover a wide spectrum of research interests aker et al 1998 chen et al 2020 joekar niasar et al 2010 joekar niasar and hassanizadeh 2012 kunz et al 2016 qin 2015 raeini et al 2015 sweijen et al 2016 in general pore scale models can be classified into first principle models based on the navier stokes equation and pore network models first principle models in porous media research are also called dns direct numerical simulation models popular dns models include vof volume of fluid model brackbill et al 1992 lbm lattice boltzmann method chen et al 2014 sph smoothed particle hydrodynamics tartakovsky et al 2016 and phase field models shokrpour roudbari et al 2016 yue and feng 2011 although dns models resolve complex porous structures directly they are restricted by severe computational efforts in addition favorable contact angle values have been often used in simulations due to the deficiency of embedded contact line dynamics in dns models alternatively pore network models first discretize complex pore structures into connected pore elements then in conjunction with local rules mass conversation of each phase is solved with the help of element scale constitutive relations in such way pore network models not only reduce computational efforts considerably but also represent the pore structure information adequately aghaei piri 2015 qin van brummelen 2019 if dynamic effects can be neglected pore network models reduce to be quasi static quasi static pore network models have been widely used in obtaining material properties such as relative permeability and capillary pressure patzek 2001 raeini et al 2019 they have been widely used in the study of co2 trapping in the geological carbon storage valvatne and blunt 2004 up to now dynamic pore network models have been mostly used to qualitatively investigate fundamentals of two phase flow in porous media huang et al 2016 joekar niasar et al 2010 li et al 2017 médici and allen 2013 qin 2015 qin et al 2019 sheng and thompson 2016 although a few imbibition models aghaei and piri 2015 hughes and blunt 2000 li et al 2017 nguyen et al 2006 sun et al 2016 tørå et al 2012 wang et al 2015 yang et al 2017 under the constant flux condition have been reported either the used pore networks did not represent complex pore structures or the used local rules are not adequate to spontaneous imbibition verification studies of the dynamic pore network modeling are scant in the open literature because for a core plug 1 experimental data with high temporal resolution is difficult to obtain and 2 oversimplified pore elements may not represent complex pore spaces recently a verification of pore scale models against experimental data of oil water two phase displacements in patterned microfluidics has been conducted zhao et al 2019 which considered different wetting conditions under different injection rates of water i e different capillary number values zhao et al 2016 the capabilities and limitations of their dynamic pore network models were discussed in detail however for spontaneous imbibition instead of a flux boundary condition a pressure boundary condition is relevant in principle pore scale events in spontaneous imbibition processes are different from those in drainage processes thus a pore network model for spontaneous imbibition requires specifically defined local rules such as the competition of arc menisci ams filling and main terminal meniscus mtm movement mason and morrow 1991 we have developed a dynamic pore network model specifically for spontaneous imbibition in porous media qin and van brummelen 2019 multiform idealized pore elements have been used to represent complex pore structures so that our model bears the potential to quantitatively predict spontaneous imbibition in a real porous medium preliminary case studies show that our model captures essentials of spontaneous imbibition such as imbibition rates and sharp wetting fronts gruener et al 2012 in this work we further develop the model to investigate spontaneous imbibition in a digital porous medium obtained by µct moreover as a first attempt we compare our pore network predictions with direct numerical simulations by the vof model in terms of imbibition rates and temporal saturation profiles under different wettability values and viscosity ratios although direct numerical simulations are computationally heavy they could provide us good references to study the efficient pore network model raeini et al 2015 to this end we use a small piece of µct scanning of sintered glass beads hoang et al 2018 which resembles highly permeable sandstones or carbonate rocks in terms of the complexity of pore spaces yang et al 2019 in this work we focus on the early stage of primary spontaneous imbibition in porous media where dynamics is strongest in other words the mtm move in a pore is predominant porespy gostick 2017 is used to extract the pore network information which is properly projected into well defined idealized pore elements it is worth noting that the verification of vof simulations or the pore network modeling of spontaneous imbibition against experiments is excluded in this work because benchmark data of spontaneous imbibition for the verification of pore scale models are still absent in the open literature to the best of our knowledge the remainder of the paper is structured as follows in section 2 we introduce the dynamic pore network model for spontaneous imbibition in porous media in section 3 we present the used vof model which is implemented in the commercial solver fluent a comprehensive comparison of pore network modeling results and vof results is given and discussed in section 4 which is followed by main conclusions in section 5 2 pore network model our dynamic pore network model comprises three elements 1 a pore network representing the topology and the morphology of porous structures 2 governing equations of mass conservation and 3 constitutive relations assisted by local rules the details of the pore network model can be found in qin and van brummelen 2019 here we briefly present governing equations and key local rules we focus on the pore network extraction via porespy gostick 2017 and the preparation of the pore network to be used in the modeling 2 1 pore network extraction an open source extraction code porespy has been used to obtain the pore network connectivity and geometric information of individual pores gostick 2017 watershed segmentation is used in the construction of pore bodies while pore throats connecting pore bodies are volumeless rabbani et al 2016 the key steps in the porespy algorithm include 1 peak identification in the distance map 2 removal of peaks on saddles and peaks which are too close to each other and 3 watershed segmentation of pore spaces into pore bodies by porespy we obtain the following pore network information 1 the connectivity map 2 pore body locations inscribed and extended radii and surface areas and 3 pore throat locations inscribed and extended radii perimeters and cross sectional areas we project those information into idealized pore elements used in the dynamic pore network model as follows first the inscribed radius in a pore body is equal to the inscribed radius of the corresponding watershed as rpnm rct where the subscripts pnm and ct refer to the pore network and the original ct data respectively second the pore body length is approximated as rct rct where rct denotes the extended radius third by virtue of volume conservation the cross sectional area of the pore body can be calculated as 1 a p n m v c t r c t r c t where vct is the watershed volume fourth together with rpnm the cross sectional perimeter is given as patzek and kristensen 2001a 2 p p n m 2 v c t r c t r c t r c t finally the shape factor of the pore body is calculated according to g p n m a p n m p p n m 2 once the shape factor is known an idealized pore body can be generated patzek and kristensen 2001a we notice that surface areas cannot be directly projected due to the limitation of used idealized pore bodies although they would determine the flow resistance between neighbouring pore bodies in this work we obtain the flow conductance of each pair of watersheds by the lbm modeling zhao et al 2020a 2020b the shape factor of a pore throat is approximated as gij 0 5 gi gj where the subscripts i and j denote the pair of pore bodies the µct image of sintered glass beads in the case studies has 200 100 and 100 voxels along the x y and z directions respectively the voxel resolution is 25 µm after segmentation the pore voxels are shown in fig 1 b fig 1a shows the extracted pore network by porespy which has 346 pore bodies and 779 pore throats fig 1c and d shows the pore body and pore throat size i e the inscribed radius distributions and the shape factor distribution of pore bodies with pore throat sizes from the porespy the calculated pore network intrinsic permeability is 35 darcy which is around half of the dns result 60 darcy this may indicate that the current network extraction needs to be improved gerke et al 2020 or a new approach to parameterizing hydraulic conductance would be needed miao et al 2017 as mentioned above on the early stage of primary spontaneous imbibition the mtm move is predominant so that the imbibition rate would strongly depend on the intrinsic permeability therefore we run lbm simulations of each pair of watersheds to obtain its single phase conductance and assign it to the corresponding pore throat zhao et al 2020b in this way the pore network intrinsic permeability is 61 darcy which is very close to the dns result the details of the µct data and the pore network information are given in table 1 2 2 governing equations by virtue of the incompressibility assumption conservation of mass of the two phases translates into conservation of volume the volumetric conservation of each phase is given as thompson 2002 3 v i d s i α d t j 1 n i k i j α p i α p j α α n w where i is the pore body index ij is the pore throat index n and w indicate the nonwetting and wetting phases respectively ni is the coordination number of pore body i v m3 is the volume s is the saturation k m3 pa s is the conductivity and p pa is the pressure the gravity is neglected since bond number in our case studies is much smaller than 1 with the definition of mixture pressure p p n s n p w s w and adding the two conservation equations together eq 3 for the wetting phase and for the nonwetting phase the pressure equation is derived as joekar niasar et al 2010 4 j 1 n i k i j n k i j w p i p j j 1 n i k i j n s i w k i j w 1 s i w p i c k i j w 1 s j w k i j n s j w p j c where the capillary pressure in pore body i is defined as pc pn pw 2 3 local rules and constitutive relations to consider a wide range of wetting conditions and real pore spaces we have used capillary tubes of circular square and triangular cross sections as our idealized pore elements qin and van brummelen 2019 pioneering work has been done on the development of their local rules and constitutive relations e g single phase and two phase conductance blunt 1997 patzek 2001 patzek and kristensen 2001a 2001b valvatne and blunt 2004 however most previous studies have been focused on quasi static displacements to obtain two phase material properties we notice that distinct from quasi static displacements and dynamic drainage spontaneous imbibition possesses a key feature of the competition of mtm move and ams filling as shown by the insert in fig 2 mason and morrow 1991 therefore we cannot simply reverse a drainage process to simulate spontaneous imbibition instead we should specifically develop local rules for facilitating the above mentioned competition mechanism in our model development the following local rules have been used as shown in the flow chart in fig 3 first the wetting filling in a pore body is flagged as the mtm move if one of the following three conditions is satisfied 1 the ams filling is unfavorable in the pore body 2 any of its connected pore bodies is with the mtm move as well as its wetting saturation is larger than 0 5 and its capillary pressure is smaller than the mtm pressure of the pore body 3 snap off happens in any of its connected pore bodies and its capillary pressure is smaller than the mtm pressure of the pore body second when a pore body is with the mtm move all of its pore throats are assumed to be wetting filled meanwhile the nonwetting is allowed to escape from the pore body third when the mtm move is triggered in a pore body with the ams filling the wetting at corners instantaneously joins into the mtm fourth when a pore body is with the mtm move we assume single phase conductance of both the wetting and nonwetting in the pore body when the wetting saturation is close to 1 0 e g 0 98 which is used in this work we assume all of its connected pore throats are blocked to the nonwetting fifth when the wetting saturation in a pore body is close to 1 0 we switch to a transition function of capillary pressure which forces capillary pressure to fast approach to the inlet wetting pressure zero in spontaneous imbibition by default obviously implementing the above local rules not only allows our dynamic pore network model to simulate primary spontaneous imbibition of great interest but also makes our model applicable to other imbibition conditions such as main imbibition and imbibition under a flux condition it is worth noting that another proposed mechanism of remobilization of the nonwetting phase has been proposed in the modeling of spontaneous imbibition in a regular pore network with pore bodies of regular octahedron joekar niasar and hassanizadeh 2012 however this mechanism at least has been proven to be not applicable to our idealized pore elements i e capillary tubes with circular square and triangular cross sections patzek 2001 fig 2 shows the effect of several local rules on the prediction of imbibition rate for the air water system water is the wetting it is seen that the model drastically underestimates the imbibition rate and cause severe trapping of air with the local rule of neglecting mtm move i e sole ams filling or the local rule of combining ams filling and remobilization although we concentrate on spontaneous imbibition in an initially nonwetting filled porous medium in the model development we set a thin pre wetting film at corners of a dry pore body when the wetting reaches any of its neighboring pore bodies additionally the pore throat capillary pressure is approximated by the smaller capillary pressure value of its two connected pore bodies the governing eqs 3 4 are numerically solved for the primary variables wetting saturation s i w and mixture pressure p i at the end of each time step the remaining quantities such as capillary pressure and phase conductivity are updated based on the primary variables the details of the calculation of constitutive relations of the used idealized pore elements are presented elsewhere qin and van brummelen 2019 for all case studies in this work the mass imbalance of the wetting phase can be negligible see appendix c for the detail 3 vof volume of fluid model regarding direct numerical simulations of spontaneous imbibition we use the vof model to explicitly track interfaces between the nonwetting and wetting phases both phases are incompressible and the flow is isothermal in the vof model each computational cell is either one phase or two phase occupied the phase fraction is defined as 5 a α v α v c e l l α n w where α is the phase indicator v α m3 is the volume of phase α in the computational cell and vcell is the volume of the computational cell neglecting the gravity the governing equations of an isothermal incompressible two phase flow of newtonian fluids are given as shams et al 2018 6 v 0 7 ρ v t ρ v v p μ 2 v f 8 a w t a w v 0 here ρ kg m3 and μ pa s are the mixture density and viscosity respectively which are defined as 9 ρ a w ρ w 1 a w ρ n 10 μ a w μ w 1 a w μ n in eq 7 the source term f pa m due to the addition of surface tension is calculated by the continuum surface force csf model brackbill et al 1992 as 11 f σ 2 ρ k a w ρ w ρ n where σ is the surface tension n m and k 1 m is the curvature of the nonwetting wetting interface calculated by aw aw to consider the wall adhesion the meniscus normal in a two phase occupied computational cell next to the wall is given as 12 n n s cos θ t s sin θ where n s and t s are the unit vectors normal and tangential to the wall respectively and θ is the static contact angle the commercial solver fluent 17 2 which is finite volume method fvm based is used to solve the governing eqs 6 8 the simple scheme is used to solve the navier stokes eqs 6 7 the second order upwind scheme is used for the momentum discretization eq 8 describes the transport of the volume fraction of wetting phase which is a hyperbolic partial differential equation its discretization is crucial to vof simulations in this work we use the geometric reconstruction scheme which represents the nonwetting wetting interface in a computational cell by a piecewise linear approach fluent 17 2 user s guide for transient vof simulations the time step is crucial to numerical accuracy and computational cost a large time step would give rise to smeared interfaces and even unreliable results while a small time step entails huge computational efforts to balance the two effects we choose time steps such that the global courant number is less than 0 5 for all simulated cases in each time step either the globally scaled residuals of all the equations are less than 10 6 or the maximum iteration number is over 50 the results show that before breakthrough of the wetting phase the residual of 10 6 can be always reached the pore voxels of the µct scanning as seen in fig 1b have been used as the computational cells in the vof simulations since the mean pore size in radius is around 97 3 µm this means that we have at least 8 8 cells of an average flow cross section initially the domain is saturated with the nonwetting phase air or oil the inlet pressure is set to zero while the volume fraction of water is set to 1 0 the outlet pressure is set to zero only allowing the nonwetting phase to flow back 4 results and discussion a number of case studies of spontaneous imbibition in an initially nonwetting filled porous medium are conducted by both the pore network model and the vof model under different contact angle values and viscosity ratios the used physical parameters and boundary conditions are given in table 1 we compare the prediction results of pore network modeling and vof simulations in term of imbibition rates and temporal saturation profiles along the flow direction we explore the effect of viscosity ratio on the trapping of nonwetting phase moreover we discuss the difference between spontaneous imbibition and quasi static imbibition in terms of pore filling mechanisms regarding the mesh study and the verification of the used vof model one can refer to appendix b for the detail in summary a mesh density with the voxel resolution of 25 µm is adequate for our vof simulations of spontaneous imbibition in the µct scanning of sintered glass beads similar mesh densities have been also reported in the vof simulations of two phase flow in porous media ferrari et al 2015 raeini et al 2014 4 1 imbibition for the air water system fig 4 shows the imbibition rates under four different static contact angle values predicted by the vof model the wetting and nonwetting phases are water and air respectively it is seen that the vof model predicts two almost overlapping imbibition curves for the contact angle values of 20 and 40 there are two possible reasons for this observation 1 the current mesh density cannot resolve highly curving interfaces particularly when interfaces move through converging pore spaces and 2 voxel induced roughness impacts the wall adhesion model used in the vof simulations when the contact angle is set to 80 corresponding to a weakly water wet medium the imbibition front ceases near the inlet region as shown by the inset in fig 4 this is mainly due to diverging pore spaces which may locally flatten the nonwetting wetting interfaces so that the imbibition driving force approaches to zero pavuluri et al 2019 furthermore the csf model see eq 11 for calculating capillary forces may fail under extremely small capillary number values shams et al 2018 which would numerically halt the wetting front movement it is worth noting that experimental data show that the water imbibition front can continuously travel through porous materials with the static contact angle even larger than 80 kuijpers et al 2017 to sum up for our case studies the vof model does not work well on the strongly or weakly water wet porous medium which is represented by pore space voxels therefore in this work we select vof simulations with the contact angle values of 40 and 60 corresponding to intermediately water wet porous media to compare with pore network modeling results furthermore in appendix c we show that for all case studies in this work the capillary number values are smaller than 10 3 this indicates that the dynamic effect on the contact angle is minor heshmati and piri 2014 fig 5 a shows the comparison of the imbibition rates predicted by the vof model and the pore network model still for the air water system two contact angle values of 40 and 60 are used it is seen that the two model predictions match very well the pore network model has the big advantage of computational efficiency it takes less than one minute for one case study running on a single core while the vof model needs a few days of 16 core parallel computation fig 5b shows the comparison of the slope values predicted by the vof model and the pore network model the slope value is calculated by δ s δ t where s denotes the overall saturation and t is the square root of the imbibition time it is seen that the two models predict close slope values as the overall saturation increases from fig 5 however we observe slight mismatch of the amount of trapped air in the end of the imbibition this is because in the development of imbibition local rules we set a maximum value of the wetting saturation of 0 98 in a pore body above which all connected pore throats will be blocked of the nonwetting phase while the vof results show slightly less amount of trapped air nevertheless this parameter does not impact the prediction of imbibition rates and the trapping due to the connectivity topology of pores fig 6 a shows the water distributions in the porous medium under different overall saturation values predicted by the vof model and the pore network model the nonwetting phase is air the static contact angle is 40 it is seen that the two models predict very close water distributions as expected a sharp wetting front propagates in the flow direction the imbibition is predominated by the mtm move along with minor corner fillings observed in the wetting front fig 6b shows the corresponding water saturation profiles along the flow direction for the pore network modeling results the cross sectional saturation at each location is calculated by averaging a domain length of 500 µm while for the vof results the cross sectional saturation values are directly calculated at the same locations it is found that the saturation profiles match each other at each overall saturation value 4 2 effect of viscosity ratio on imbibition so far we have shown that our dynamic pore network model can adequately predict spontaneous imbibition in a complex porous medium in comparison to vof based direct numerical simulations in this subsection we extend the comparison to cases with a more viscous nonwetting phase fig 7 a shows the comparison of the imbibition rates predicted by the vof model and the pore network model for the oil water system the viscosity ratio is assumed to be unity the static contact angle is 60 it is seen that the two model predictions match well in comparison to the air water system oil is more viscous and much harder to be displaced so that the water front advances much slower fig 7b shows the corresponding distributions of water saturation along the flow direction under different overall saturation values the pore network model predicts slightly rougher wetting fronts in comparison to those predicted by the vof model this discrepancy is partially due to that for the pore network modeling results we calculate cross sectional saturation values by averaging a domain length moreover in the local rules section 2 3 the assumption of nonwetting conductance in a pore body with the mtm move may deteriorate the prediction of wetting front which is seen to be more pronounced in the case of a smaller viscosity ratio we further increase the viscosity of the nonwetting phase to 0 01 pa s to test our dynamic pore network model fig 8 a shows the comparison of the imbibition rates predicted by the vof model and the pore network model for the viscosity ratio of 0 1 surprisingly the imbibition rate predicted by the pore network model matches well with that by the vof model also the saturation profiles are comparable as shown in fig 8b in comparison to the saturation profiles under the viscosity ratios of 55 9 i e the air water system and 1 0 the saturation profiles under the viscosity ratio of 0 1 are much spreading in other words the imbibition fronts are much rougher which are in consistent with experimental observations akin et al 2000 from the above studies we see that the viscosity ratio of the wetting to the nonwetting phases influences the roughness of wetting fronts it further influences the trapping of the nonwetting phase for the air water system the wetting phase itself depresses the roughness growth of the wetting front gruener et al 2012 while much less viscous air does not play a role both experimental data akin et al 2000 kuijpers et al 2017 and numerical results in this work show that a sharp wetting front advances through porous media moreover a sharp wetting front is maintained over a long distance alyafei et al 2016 schmid et al 2016 with little air trapped as the increase of the nonwetting viscosity wetting fronts in spontaneous imbibition become rougher and rougher in principle the nonwetting phase assists the roughness growth of the wetting front so that a diffusion type wetting front is seen in the distributions of wetting saturation along the flow direction schembre and kovscek 1998 vizika et al 1994 meanwhile more and more nonwetting phase is trapped in the medium mainly due to the topology of pores for instance in the case of fig 8 around 40 of the nonwetting phase is trapped in the end of imbibition under the viscosity of 0 1 given the fact that the wetting phase flow deviates from the assumption of sing phase regime we would expect that the single phase darcy model is not applicable to a highly viscous nonwetting phase to confirm this we compare the darcy predictions of imbibition rates with those by the pore network model the single phase darcy model for spontaneous imbibition is presented in appendix a the key assumption in the single phase darcy model is that a sharp wetting front holds in the imbibition process the ordinary differential equation eq a6 for the imbibition rate is numerically solved by matlab we use the effective mean pore size to approximate the rev scale capillary pressure which is estimated by r m 1 2 r m by considering a mean shape factor of the pore bodies qin and van brummelen 2019 rm is the mean pore size given in table 1 the water saturation behind the wetting front is set to 0 9 fig 9 shows the comparison of the imbibition rates predicted by the vof model and the single phase darcy model under different viscosity ratios the contact angle is 60 it is seen that the darcy model well predicts the imbibition rate for the air water system even though the porous medium under study is smaller than its rev size the predictions by the darcy model however deviates from those by the pore network model under the viscosity ratios of 1 0 and 0 1 which show faster imbibition obviously this is mainly due to the failure of the assumption of a sharp wetting front moreover it is seen that the discrepancy is larger in the case of the viscosity ratio of 0 1 in the case of small viscosity ratios and the case that the late stage of spontaneous imbibition is of interest f zarandi and pillai 2018 the single phase darcy model will not be applicable any more then one would resort to the two phase darcy model in which capillary pressure and relative permeability curves are needed to obtain two phase material properties of spontaneous imbibition the pore scale modeling of a whole porous core up to several centimeters would be needed in this context an efficient and reliable pore network model will be very useful given the fact that dns simulations are computationally prohibitive 4 3 comparison between spontaneous and quasi static imbibition the trapping of nonwetting phase is of great interest in a number of subsurface applications such as oil recovery and co2 storage in practice different imbibition conditions may be encountered such as cocurrent spontaneous imbibition countercurrent spontaneous imbibition and imbibition processes which are close to quasi static it is acknowledged that cocurrent spontaneous imbibition is fast and its microscale dynamics is strong mason and morrow 2013 here with the help of our pore network model as a first attempt we compare cocurrent spontaneous imbibition with quasi static one in terms of nonwetting phase trapping and pore filling mechanisms i e the sequence of pore fillings in the case of cocurrent spontaneous imbibition we simulate the air water system i e the wicking process the static contact angle is set to 40 regarding the quasi static modeling we use an in house quasi static pore network code hefny et al 2020 which considers key two phase displacement mechanisms such as cooperative filling of pore bodies piston type move and snap off jackson et al 2003 patzek 2001 we put the wetting reservoir at the inlet and the nonwetting reservoir at the outlet as shown in fig 10 we first run the primary drainage to the irreducible saturation of 0 05 then we run the imbibition to the end i e the nonwetting reservoir pressure reduces to zero fig 10 left shows the water distribution in the end of spontaneous imbibition it is seen that most pores are fully filled with water with a few partially filled large pores the total amount of trapped air is only around 6 this value is close to experimental data of a relatively homogeneous porous medium kuijpers et al 2017 for the quasi static imbibition in fig 10 right as expected water prefers to fill small pores while much air is trapped in large pores the resultant amount of trapped air is up to 48 which is much higher than that in the spontaneous imbibition the difference in the air trapping is because the two imbibition processes have different pore filling mechanisms in the spontaneous imbibition we observe a co filling mechanism between small and large pores which results in a sharp wetting front it is expected there will be less and less co filling events as the increase of the nonwetting viscosity in the quasi static imbibition however the wetting filling shows a capillary finger pattern this is because in the absence of imbibition dynamics the wetting filling follows the mechanism of percolation invasion 5 conclusions we have presented a dynamic pore network model with specifically developed local rules for image based modeling of spontaneous imbibition in porous media a piece of µct scanning of sintered glass beads is used as our porous domain we have compared and verified our pore network model against a widely used vof model a number of case studies of primary imbibition by both the pore network model and the vof model have been conducted under different contact angle values and viscosity ratios based on those case studies we arrive at the following main conclusions 1 it is challenging for the vof model to simulate spontaneous imbibition in a strongly or weakly water wet porous medium which is represented by pore space voxels 2 our dynamic pore network model can well predict imbibition rates and temporal saturation profiles along the flow direction under a wide range of viscosity ratios in comparison to the vof model 3 for the air water system the wetting phase itself depresses the roughness growth of the wetting front as the increase of the nonwetting viscosity wetting fronts in spontaneous imbibition become rougher and rougher meanwhile more and more nonwetting phase is trapped in large pores 4 in spontaneous imbibition we see a co filling mechanism between small and large pores which results in much less trapping of the nonwetting phase in comparison to the quasi static imbibition 5 our pore network model is much more computationally efficient than the vof model the pore network model running on a single core takes less than one minute for one case study while the vof model typically needs a few days of 16 core parallel computation finally we notice that a real sandstone or carbonate rock has distinct features of mixed wettability roughness of grain surfaces and pore scale heterogeneity etc up to now for a dns model it is still challenging to quantitatively predict their influence on two phase flow dynamics therefore the present pore network model needs to be further improved and verified against lab experiments of spontaneous imbibition declaration of competing interest none acknowledgment c z q acknowledges the support of national natural science foundation of china no 12072053 the support of human resources and social security bureau of chongqing no cx2020087 and the support of darcy center of utrecht university and technology university of eindhoven this work is part of the research programme fundamental fluid dynamic challenges in inkjet printing with project number fip11 which is financed by the dutch research council nwo the support of océ technologies within this program is acknowledged the dataset associated with the present work is available via https doi org 10 6084 m9 figshare 10093676 appendix a spontaneous imbibition into a porous medium initially saturated with the nonwetting phase by assuming a sharp wetting front here we present the derivation of the 1d darcy scale model for spontaneous imbibition into a dry homogeneous porous medium as shown in fig a1 first for the wetting phase neglecting the gravity its darcy flux is given as a1 q w k w μ w p w l where the superscript w denotes the wetting phase q m s is the flux k m2 is the permeability μ pa s is the dynamic viscosity l m is the wetting penetration length and p pa is the pressure then we can write the rate of wetting saturation of the whole porous domain as follows a2 a l ε d s d t a k w μ w p w l where s is the wetting saturation of the whole porous domain a is the cross sectional area l is the domain length and ε is the porosity by virtue of volumetric conservation and the condition of pn pc pw at the wetting front we can write the nonwetting flux as a3 q n q w k n μ n p c p w l l substitution of eq a1 into eq a3 and after some arithmetic manipulations we can express the wetting phase pressure as a4 p w p c 1 l l l k w μ n k n μ w substitution of eq a4 into eq a2 we can obtain a5 d s d t 1 l ε k w μ w 1 l p c 1 l l l k w μ n k n μ w we assume a constant wetting saturation of sf behind the wetting front so that the wetting penetration length can be expressed as l sl sf further the wetting permeability is approximated by kw k 0 sf where k 0 is the intrinsic permeability because the medium is initially nonwetting saturated the nonwetting permeability is given by kn k 0 finally the ordinary differential equation for the imbibition rate is written as a6 d s d t s f l 2 ε s k 0 s f μ w p c 1 s f μ n μ w s f s s appendix b test cases of spontaneous imbibition by the vof model we conduct case studies of spontaneous imbibition in simple capillary tubes in order to understand the impact of mesh density and mesh type i e conforming mesh and voxel mesh on the predicted imbibition rate by the vof model fig b1 a shows the tube scale saturation versus the imbibition time under four different contact angle values in a capillary tube of circular cross section the inset shows the used fine mesh this mesh has 19 elements along the diagonal and 36 elements along the circumference fig b1 b shows the corresponding scaled imbibition slope values versus saturation the imbibition slope is defined as s t in which s is the tube scale water saturation and t is the imbibition time for each contact angle value θ the scaling is cos 40 0 cos θ it is seen that all curves collapse into the master curve of the contact angle value of 40 except for some initial fluctuations due to the so called inlet effect in dns simulations yin et al 2019 in fig b1 c we decrease the mesh density by 2 and compare the predicted imbibition rates which are also compared with that by the lw equation i e s r σ cos θ 2 μ l 2 in which r is the radius σ is the surface tension μ is the water dynamic viscosity and l is the tube length the differences in the imbibition rates predicted by the vof model with a fine mesh and a coarse mesh are negligible in addition the imbibition rates predicted by the vof model match with that of the lw equation for spontaneous imbibition in a capillary tube of triangular cross section as shown in fig b1 d the predicted imbibition rate of the coarse mesh is slightly larger than that under the fine mesh however both results match well with that of the lw equation notice that in the calculation of imbibition rate by the lw equation for the capillary tube of right triangular cross section the entry pressure i e the capillary pressure is calculated by the ms p theory mayer and stowe 1965 princen 1970 we further study the impact of mesh type and mesh refinement on the imbibition rate for a single 2d curved capillary tube the left graph in fig b2 shows the voxel representation and smooth geometry representation of the half of a 2d capillary tube the wall boundary length of the voxel representation due to voxel induced roughness is longer than that of the smooth representation by 27 the computational domain includes the wetting reservoir and the converging and diverging tube the radius of the tube throat and the radius of the outlet are 20 µm and 80 µm respectively the length of the tube is 150 µm initially the tube is saturated with air then water imbibes in the right graph of fig b2 shows the imbibition rates under different mesh types and mesh densities first it is seen that for the smooth geometry representation the mesh size of 4 µm and 2 µm give the same imbibition rate while for the voxel representation reducing the mesh size of 4 µm to 2 µm gives slightly slower imbibition rate in the converging part of the tube but much slower imbibition rate in the diverging part of the tube we note that the refinement of the voxel representation here is different from a higher voxel resolution of the porous medium the refinement here is conducted on the fixed voxel resolution of 4 µm second with the same mesh density the vof model predicts a faster imbibition process for the smooth geometry representation than that for the voxel representation this is mainly due to the voxel induced roughness of the wall owing to the fact that a rough wall increases the dissipation energy around three phase contact lines forsberg et al 2010 based on the above case studies of single capillary tubes we may conclude that the mesh density with the voxel resolution of 25 µm is adequate for vof simulations of spontaneous imbibition in the µct scanning of sintered glass beads a voxel representation would slightly slow down the predicted imbibition rate in comparison to a smooth representation however it can avoid the meshing of a complex porous medium appendix c mass balance and capillary number in the pore network simulations based on the constructed pore network the discretized mass balance eq 3 is in the conservative form which is solved by the first order explicit scheme to avoid extremely small time steps at the end of each time step we truncate the wetting saturation in a pore body as follows when s i w is smaller than 10 6 we set s i w 0 when 1 s i w is smaller than 10 6 we set s i w 1 this truncation practice may impact the mass imbalance in our case studies we calculate the mass imbalance of the wetting phase as c1 m t t 0 t i 1 n q i w i 1 n v i s i w t i 1 n v i where m t is the mass imbalance at the imbibition time of t q i w m3 s is the net wetting flow rate of pore body i and n is the number of pore bodies fig c1 shows the wetting phase mass imbalance in the pore network modeling of spontaneous imbibition under different contact angle values and viscosity ratios it is seen that for all case studies the mass imbalance is smaller than 10 3 which is negligible furthermore our case studies indicate that the truncation threshold has little impact on the mass imbalance fig c2 shows the temporal capillary number values in the pore network modeling of spontaneous imbibition under different contact angle values and viscosity ratios obviously for the air water system the capillary number decreases as the imbibition proceeds at the viscosity ratio of unity the capillary number keeps roughly constant before the wetting phase breakthrough at the viscosity ratio of 0 1 interestingly the capillary number also keeps roughly flat rather than increase this is because the sharp wetting front does not hold any more see fig 8b though the porous medium of sintered glass beads is highly permeable for all case studies in this work the capillary number values are smaller than 10 3 this indicates that the dynamic effect on the contact angle is minor 
310,the dynamic pore network modeling as an efficient pore scale tool has been used to understand imbibition in porous media which plays an important role in many subsurface applications in this work we aim to develop a dynamic pore network model for imaged based modeling of spontaneous imbibition in porous media the µct scanning of a porous medium of sintered glass beads is selected as our study domain we extract its pore network by using an open source software of porespy and further project the extracted information of individual watersheds into multiform idealized pore elements a number of case studies of primary spontaneous imbibition have been conducted by using both the pore network model and a vof model under different wettability values and viscosity ratios we compare those model predictions in terms of imbibition rates and temporal saturation profiles along the flow direction we show that our pore network model can well predict imbibition rates and temporal saturation profiles under different viscosity ratios and wetting conditions in comparison to the vof model we explore the effect of viscosity ratio on the trapping of nonwetting phase moreover we discuss the difference between spontaneous imbibition and quasi static imbibition in terms of pore filling mechanisms 1 introduction spontaneous imbibition plays an important role in many subsurface applications such as oil recovery in fractured reservoirs liu et al 2020 morrow and mason 2001 shale gas extraction zheng et al 2018 and geological sequestration of carbon dioxide guo et al 2016 in those applications the imbibition rate and the trapping of nonwetting phase are of great interest spontaneous imbibition is usually categorized into cocurrent and countercurrent spontaneous imbibition in cocurrent spontaneous imbibition the wetting phase enters a porous medium through one boundary while the nonwetting phase is displaced from the medium via other boundaries by contrast in countercurrent spontaneous imbibition the wetting and nonwetting phases respectively enter and leave a porous medium via the same boundary in this work we focus on cocurrent spontaneous imbibition henceforth spontaneous imbibition is referred to as cocurrent spontaneous imbibition unless otherwise stated to predict the imbibition rate by the two phase darcy model a number of material properties need to be determined such as capillary pressure and relative permeability alyafei et al 2016 schmid et al 2016 moreover sharp wetting fronts observed in many core scale experiments akin et al 2000 alyafei et al 2016 kuijpers et al 2017 indicate that dynamics in spontaneous imbibition is strong particularly at its early stage this challenges conventional measurements of material properties which were mostly conducted in equilibrium or steady state zhuang et al 2017 in this regard pore scale models of spontaneous imbibition are invaluable to explore the dynamic effect on those material properties furthermore it helps to improve darcy scale imbibition models there have been extensive pore scale numerical studies of two phase flow in porous media which cover a wide spectrum of research interests aker et al 1998 chen et al 2020 joekar niasar et al 2010 joekar niasar and hassanizadeh 2012 kunz et al 2016 qin 2015 raeini et al 2015 sweijen et al 2016 in general pore scale models can be classified into first principle models based on the navier stokes equation and pore network models first principle models in porous media research are also called dns direct numerical simulation models popular dns models include vof volume of fluid model brackbill et al 1992 lbm lattice boltzmann method chen et al 2014 sph smoothed particle hydrodynamics tartakovsky et al 2016 and phase field models shokrpour roudbari et al 2016 yue and feng 2011 although dns models resolve complex porous structures directly they are restricted by severe computational efforts in addition favorable contact angle values have been often used in simulations due to the deficiency of embedded contact line dynamics in dns models alternatively pore network models first discretize complex pore structures into connected pore elements then in conjunction with local rules mass conversation of each phase is solved with the help of element scale constitutive relations in such way pore network models not only reduce computational efforts considerably but also represent the pore structure information adequately aghaei piri 2015 qin van brummelen 2019 if dynamic effects can be neglected pore network models reduce to be quasi static quasi static pore network models have been widely used in obtaining material properties such as relative permeability and capillary pressure patzek 2001 raeini et al 2019 they have been widely used in the study of co2 trapping in the geological carbon storage valvatne and blunt 2004 up to now dynamic pore network models have been mostly used to qualitatively investigate fundamentals of two phase flow in porous media huang et al 2016 joekar niasar et al 2010 li et al 2017 médici and allen 2013 qin 2015 qin et al 2019 sheng and thompson 2016 although a few imbibition models aghaei and piri 2015 hughes and blunt 2000 li et al 2017 nguyen et al 2006 sun et al 2016 tørå et al 2012 wang et al 2015 yang et al 2017 under the constant flux condition have been reported either the used pore networks did not represent complex pore structures or the used local rules are not adequate to spontaneous imbibition verification studies of the dynamic pore network modeling are scant in the open literature because for a core plug 1 experimental data with high temporal resolution is difficult to obtain and 2 oversimplified pore elements may not represent complex pore spaces recently a verification of pore scale models against experimental data of oil water two phase displacements in patterned microfluidics has been conducted zhao et al 2019 which considered different wetting conditions under different injection rates of water i e different capillary number values zhao et al 2016 the capabilities and limitations of their dynamic pore network models were discussed in detail however for spontaneous imbibition instead of a flux boundary condition a pressure boundary condition is relevant in principle pore scale events in spontaneous imbibition processes are different from those in drainage processes thus a pore network model for spontaneous imbibition requires specifically defined local rules such as the competition of arc menisci ams filling and main terminal meniscus mtm movement mason and morrow 1991 we have developed a dynamic pore network model specifically for spontaneous imbibition in porous media qin and van brummelen 2019 multiform idealized pore elements have been used to represent complex pore structures so that our model bears the potential to quantitatively predict spontaneous imbibition in a real porous medium preliminary case studies show that our model captures essentials of spontaneous imbibition such as imbibition rates and sharp wetting fronts gruener et al 2012 in this work we further develop the model to investigate spontaneous imbibition in a digital porous medium obtained by µct moreover as a first attempt we compare our pore network predictions with direct numerical simulations by the vof model in terms of imbibition rates and temporal saturation profiles under different wettability values and viscosity ratios although direct numerical simulations are computationally heavy they could provide us good references to study the efficient pore network model raeini et al 2015 to this end we use a small piece of µct scanning of sintered glass beads hoang et al 2018 which resembles highly permeable sandstones or carbonate rocks in terms of the complexity of pore spaces yang et al 2019 in this work we focus on the early stage of primary spontaneous imbibition in porous media where dynamics is strongest in other words the mtm move in a pore is predominant porespy gostick 2017 is used to extract the pore network information which is properly projected into well defined idealized pore elements it is worth noting that the verification of vof simulations or the pore network modeling of spontaneous imbibition against experiments is excluded in this work because benchmark data of spontaneous imbibition for the verification of pore scale models are still absent in the open literature to the best of our knowledge the remainder of the paper is structured as follows in section 2 we introduce the dynamic pore network model for spontaneous imbibition in porous media in section 3 we present the used vof model which is implemented in the commercial solver fluent a comprehensive comparison of pore network modeling results and vof results is given and discussed in section 4 which is followed by main conclusions in section 5 2 pore network model our dynamic pore network model comprises three elements 1 a pore network representing the topology and the morphology of porous structures 2 governing equations of mass conservation and 3 constitutive relations assisted by local rules the details of the pore network model can be found in qin and van brummelen 2019 here we briefly present governing equations and key local rules we focus on the pore network extraction via porespy gostick 2017 and the preparation of the pore network to be used in the modeling 2 1 pore network extraction an open source extraction code porespy has been used to obtain the pore network connectivity and geometric information of individual pores gostick 2017 watershed segmentation is used in the construction of pore bodies while pore throats connecting pore bodies are volumeless rabbani et al 2016 the key steps in the porespy algorithm include 1 peak identification in the distance map 2 removal of peaks on saddles and peaks which are too close to each other and 3 watershed segmentation of pore spaces into pore bodies by porespy we obtain the following pore network information 1 the connectivity map 2 pore body locations inscribed and extended radii and surface areas and 3 pore throat locations inscribed and extended radii perimeters and cross sectional areas we project those information into idealized pore elements used in the dynamic pore network model as follows first the inscribed radius in a pore body is equal to the inscribed radius of the corresponding watershed as rpnm rct where the subscripts pnm and ct refer to the pore network and the original ct data respectively second the pore body length is approximated as rct rct where rct denotes the extended radius third by virtue of volume conservation the cross sectional area of the pore body can be calculated as 1 a p n m v c t r c t r c t where vct is the watershed volume fourth together with rpnm the cross sectional perimeter is given as patzek and kristensen 2001a 2 p p n m 2 v c t r c t r c t r c t finally the shape factor of the pore body is calculated according to g p n m a p n m p p n m 2 once the shape factor is known an idealized pore body can be generated patzek and kristensen 2001a we notice that surface areas cannot be directly projected due to the limitation of used idealized pore bodies although they would determine the flow resistance between neighbouring pore bodies in this work we obtain the flow conductance of each pair of watersheds by the lbm modeling zhao et al 2020a 2020b the shape factor of a pore throat is approximated as gij 0 5 gi gj where the subscripts i and j denote the pair of pore bodies the µct image of sintered glass beads in the case studies has 200 100 and 100 voxels along the x y and z directions respectively the voxel resolution is 25 µm after segmentation the pore voxels are shown in fig 1 b fig 1a shows the extracted pore network by porespy which has 346 pore bodies and 779 pore throats fig 1c and d shows the pore body and pore throat size i e the inscribed radius distributions and the shape factor distribution of pore bodies with pore throat sizes from the porespy the calculated pore network intrinsic permeability is 35 darcy which is around half of the dns result 60 darcy this may indicate that the current network extraction needs to be improved gerke et al 2020 or a new approach to parameterizing hydraulic conductance would be needed miao et al 2017 as mentioned above on the early stage of primary spontaneous imbibition the mtm move is predominant so that the imbibition rate would strongly depend on the intrinsic permeability therefore we run lbm simulations of each pair of watersheds to obtain its single phase conductance and assign it to the corresponding pore throat zhao et al 2020b in this way the pore network intrinsic permeability is 61 darcy which is very close to the dns result the details of the µct data and the pore network information are given in table 1 2 2 governing equations by virtue of the incompressibility assumption conservation of mass of the two phases translates into conservation of volume the volumetric conservation of each phase is given as thompson 2002 3 v i d s i α d t j 1 n i k i j α p i α p j α α n w where i is the pore body index ij is the pore throat index n and w indicate the nonwetting and wetting phases respectively ni is the coordination number of pore body i v m3 is the volume s is the saturation k m3 pa s is the conductivity and p pa is the pressure the gravity is neglected since bond number in our case studies is much smaller than 1 with the definition of mixture pressure p p n s n p w s w and adding the two conservation equations together eq 3 for the wetting phase and for the nonwetting phase the pressure equation is derived as joekar niasar et al 2010 4 j 1 n i k i j n k i j w p i p j j 1 n i k i j n s i w k i j w 1 s i w p i c k i j w 1 s j w k i j n s j w p j c where the capillary pressure in pore body i is defined as pc pn pw 2 3 local rules and constitutive relations to consider a wide range of wetting conditions and real pore spaces we have used capillary tubes of circular square and triangular cross sections as our idealized pore elements qin and van brummelen 2019 pioneering work has been done on the development of their local rules and constitutive relations e g single phase and two phase conductance blunt 1997 patzek 2001 patzek and kristensen 2001a 2001b valvatne and blunt 2004 however most previous studies have been focused on quasi static displacements to obtain two phase material properties we notice that distinct from quasi static displacements and dynamic drainage spontaneous imbibition possesses a key feature of the competition of mtm move and ams filling as shown by the insert in fig 2 mason and morrow 1991 therefore we cannot simply reverse a drainage process to simulate spontaneous imbibition instead we should specifically develop local rules for facilitating the above mentioned competition mechanism in our model development the following local rules have been used as shown in the flow chart in fig 3 first the wetting filling in a pore body is flagged as the mtm move if one of the following three conditions is satisfied 1 the ams filling is unfavorable in the pore body 2 any of its connected pore bodies is with the mtm move as well as its wetting saturation is larger than 0 5 and its capillary pressure is smaller than the mtm pressure of the pore body 3 snap off happens in any of its connected pore bodies and its capillary pressure is smaller than the mtm pressure of the pore body second when a pore body is with the mtm move all of its pore throats are assumed to be wetting filled meanwhile the nonwetting is allowed to escape from the pore body third when the mtm move is triggered in a pore body with the ams filling the wetting at corners instantaneously joins into the mtm fourth when a pore body is with the mtm move we assume single phase conductance of both the wetting and nonwetting in the pore body when the wetting saturation is close to 1 0 e g 0 98 which is used in this work we assume all of its connected pore throats are blocked to the nonwetting fifth when the wetting saturation in a pore body is close to 1 0 we switch to a transition function of capillary pressure which forces capillary pressure to fast approach to the inlet wetting pressure zero in spontaneous imbibition by default obviously implementing the above local rules not only allows our dynamic pore network model to simulate primary spontaneous imbibition of great interest but also makes our model applicable to other imbibition conditions such as main imbibition and imbibition under a flux condition it is worth noting that another proposed mechanism of remobilization of the nonwetting phase has been proposed in the modeling of spontaneous imbibition in a regular pore network with pore bodies of regular octahedron joekar niasar and hassanizadeh 2012 however this mechanism at least has been proven to be not applicable to our idealized pore elements i e capillary tubes with circular square and triangular cross sections patzek 2001 fig 2 shows the effect of several local rules on the prediction of imbibition rate for the air water system water is the wetting it is seen that the model drastically underestimates the imbibition rate and cause severe trapping of air with the local rule of neglecting mtm move i e sole ams filling or the local rule of combining ams filling and remobilization although we concentrate on spontaneous imbibition in an initially nonwetting filled porous medium in the model development we set a thin pre wetting film at corners of a dry pore body when the wetting reaches any of its neighboring pore bodies additionally the pore throat capillary pressure is approximated by the smaller capillary pressure value of its two connected pore bodies the governing eqs 3 4 are numerically solved for the primary variables wetting saturation s i w and mixture pressure p i at the end of each time step the remaining quantities such as capillary pressure and phase conductivity are updated based on the primary variables the details of the calculation of constitutive relations of the used idealized pore elements are presented elsewhere qin and van brummelen 2019 for all case studies in this work the mass imbalance of the wetting phase can be negligible see appendix c for the detail 3 vof volume of fluid model regarding direct numerical simulations of spontaneous imbibition we use the vof model to explicitly track interfaces between the nonwetting and wetting phases both phases are incompressible and the flow is isothermal in the vof model each computational cell is either one phase or two phase occupied the phase fraction is defined as 5 a α v α v c e l l α n w where α is the phase indicator v α m3 is the volume of phase α in the computational cell and vcell is the volume of the computational cell neglecting the gravity the governing equations of an isothermal incompressible two phase flow of newtonian fluids are given as shams et al 2018 6 v 0 7 ρ v t ρ v v p μ 2 v f 8 a w t a w v 0 here ρ kg m3 and μ pa s are the mixture density and viscosity respectively which are defined as 9 ρ a w ρ w 1 a w ρ n 10 μ a w μ w 1 a w μ n in eq 7 the source term f pa m due to the addition of surface tension is calculated by the continuum surface force csf model brackbill et al 1992 as 11 f σ 2 ρ k a w ρ w ρ n where σ is the surface tension n m and k 1 m is the curvature of the nonwetting wetting interface calculated by aw aw to consider the wall adhesion the meniscus normal in a two phase occupied computational cell next to the wall is given as 12 n n s cos θ t s sin θ where n s and t s are the unit vectors normal and tangential to the wall respectively and θ is the static contact angle the commercial solver fluent 17 2 which is finite volume method fvm based is used to solve the governing eqs 6 8 the simple scheme is used to solve the navier stokes eqs 6 7 the second order upwind scheme is used for the momentum discretization eq 8 describes the transport of the volume fraction of wetting phase which is a hyperbolic partial differential equation its discretization is crucial to vof simulations in this work we use the geometric reconstruction scheme which represents the nonwetting wetting interface in a computational cell by a piecewise linear approach fluent 17 2 user s guide for transient vof simulations the time step is crucial to numerical accuracy and computational cost a large time step would give rise to smeared interfaces and even unreliable results while a small time step entails huge computational efforts to balance the two effects we choose time steps such that the global courant number is less than 0 5 for all simulated cases in each time step either the globally scaled residuals of all the equations are less than 10 6 or the maximum iteration number is over 50 the results show that before breakthrough of the wetting phase the residual of 10 6 can be always reached the pore voxels of the µct scanning as seen in fig 1b have been used as the computational cells in the vof simulations since the mean pore size in radius is around 97 3 µm this means that we have at least 8 8 cells of an average flow cross section initially the domain is saturated with the nonwetting phase air or oil the inlet pressure is set to zero while the volume fraction of water is set to 1 0 the outlet pressure is set to zero only allowing the nonwetting phase to flow back 4 results and discussion a number of case studies of spontaneous imbibition in an initially nonwetting filled porous medium are conducted by both the pore network model and the vof model under different contact angle values and viscosity ratios the used physical parameters and boundary conditions are given in table 1 we compare the prediction results of pore network modeling and vof simulations in term of imbibition rates and temporal saturation profiles along the flow direction we explore the effect of viscosity ratio on the trapping of nonwetting phase moreover we discuss the difference between spontaneous imbibition and quasi static imbibition in terms of pore filling mechanisms regarding the mesh study and the verification of the used vof model one can refer to appendix b for the detail in summary a mesh density with the voxel resolution of 25 µm is adequate for our vof simulations of spontaneous imbibition in the µct scanning of sintered glass beads similar mesh densities have been also reported in the vof simulations of two phase flow in porous media ferrari et al 2015 raeini et al 2014 4 1 imbibition for the air water system fig 4 shows the imbibition rates under four different static contact angle values predicted by the vof model the wetting and nonwetting phases are water and air respectively it is seen that the vof model predicts two almost overlapping imbibition curves for the contact angle values of 20 and 40 there are two possible reasons for this observation 1 the current mesh density cannot resolve highly curving interfaces particularly when interfaces move through converging pore spaces and 2 voxel induced roughness impacts the wall adhesion model used in the vof simulations when the contact angle is set to 80 corresponding to a weakly water wet medium the imbibition front ceases near the inlet region as shown by the inset in fig 4 this is mainly due to diverging pore spaces which may locally flatten the nonwetting wetting interfaces so that the imbibition driving force approaches to zero pavuluri et al 2019 furthermore the csf model see eq 11 for calculating capillary forces may fail under extremely small capillary number values shams et al 2018 which would numerically halt the wetting front movement it is worth noting that experimental data show that the water imbibition front can continuously travel through porous materials with the static contact angle even larger than 80 kuijpers et al 2017 to sum up for our case studies the vof model does not work well on the strongly or weakly water wet porous medium which is represented by pore space voxels therefore in this work we select vof simulations with the contact angle values of 40 and 60 corresponding to intermediately water wet porous media to compare with pore network modeling results furthermore in appendix c we show that for all case studies in this work the capillary number values are smaller than 10 3 this indicates that the dynamic effect on the contact angle is minor heshmati and piri 2014 fig 5 a shows the comparison of the imbibition rates predicted by the vof model and the pore network model still for the air water system two contact angle values of 40 and 60 are used it is seen that the two model predictions match very well the pore network model has the big advantage of computational efficiency it takes less than one minute for one case study running on a single core while the vof model needs a few days of 16 core parallel computation fig 5b shows the comparison of the slope values predicted by the vof model and the pore network model the slope value is calculated by δ s δ t where s denotes the overall saturation and t is the square root of the imbibition time it is seen that the two models predict close slope values as the overall saturation increases from fig 5 however we observe slight mismatch of the amount of trapped air in the end of the imbibition this is because in the development of imbibition local rules we set a maximum value of the wetting saturation of 0 98 in a pore body above which all connected pore throats will be blocked of the nonwetting phase while the vof results show slightly less amount of trapped air nevertheless this parameter does not impact the prediction of imbibition rates and the trapping due to the connectivity topology of pores fig 6 a shows the water distributions in the porous medium under different overall saturation values predicted by the vof model and the pore network model the nonwetting phase is air the static contact angle is 40 it is seen that the two models predict very close water distributions as expected a sharp wetting front propagates in the flow direction the imbibition is predominated by the mtm move along with minor corner fillings observed in the wetting front fig 6b shows the corresponding water saturation profiles along the flow direction for the pore network modeling results the cross sectional saturation at each location is calculated by averaging a domain length of 500 µm while for the vof results the cross sectional saturation values are directly calculated at the same locations it is found that the saturation profiles match each other at each overall saturation value 4 2 effect of viscosity ratio on imbibition so far we have shown that our dynamic pore network model can adequately predict spontaneous imbibition in a complex porous medium in comparison to vof based direct numerical simulations in this subsection we extend the comparison to cases with a more viscous nonwetting phase fig 7 a shows the comparison of the imbibition rates predicted by the vof model and the pore network model for the oil water system the viscosity ratio is assumed to be unity the static contact angle is 60 it is seen that the two model predictions match well in comparison to the air water system oil is more viscous and much harder to be displaced so that the water front advances much slower fig 7b shows the corresponding distributions of water saturation along the flow direction under different overall saturation values the pore network model predicts slightly rougher wetting fronts in comparison to those predicted by the vof model this discrepancy is partially due to that for the pore network modeling results we calculate cross sectional saturation values by averaging a domain length moreover in the local rules section 2 3 the assumption of nonwetting conductance in a pore body with the mtm move may deteriorate the prediction of wetting front which is seen to be more pronounced in the case of a smaller viscosity ratio we further increase the viscosity of the nonwetting phase to 0 01 pa s to test our dynamic pore network model fig 8 a shows the comparison of the imbibition rates predicted by the vof model and the pore network model for the viscosity ratio of 0 1 surprisingly the imbibition rate predicted by the pore network model matches well with that by the vof model also the saturation profiles are comparable as shown in fig 8b in comparison to the saturation profiles under the viscosity ratios of 55 9 i e the air water system and 1 0 the saturation profiles under the viscosity ratio of 0 1 are much spreading in other words the imbibition fronts are much rougher which are in consistent with experimental observations akin et al 2000 from the above studies we see that the viscosity ratio of the wetting to the nonwetting phases influences the roughness of wetting fronts it further influences the trapping of the nonwetting phase for the air water system the wetting phase itself depresses the roughness growth of the wetting front gruener et al 2012 while much less viscous air does not play a role both experimental data akin et al 2000 kuijpers et al 2017 and numerical results in this work show that a sharp wetting front advances through porous media moreover a sharp wetting front is maintained over a long distance alyafei et al 2016 schmid et al 2016 with little air trapped as the increase of the nonwetting viscosity wetting fronts in spontaneous imbibition become rougher and rougher in principle the nonwetting phase assists the roughness growth of the wetting front so that a diffusion type wetting front is seen in the distributions of wetting saturation along the flow direction schembre and kovscek 1998 vizika et al 1994 meanwhile more and more nonwetting phase is trapped in the medium mainly due to the topology of pores for instance in the case of fig 8 around 40 of the nonwetting phase is trapped in the end of imbibition under the viscosity of 0 1 given the fact that the wetting phase flow deviates from the assumption of sing phase regime we would expect that the single phase darcy model is not applicable to a highly viscous nonwetting phase to confirm this we compare the darcy predictions of imbibition rates with those by the pore network model the single phase darcy model for spontaneous imbibition is presented in appendix a the key assumption in the single phase darcy model is that a sharp wetting front holds in the imbibition process the ordinary differential equation eq a6 for the imbibition rate is numerically solved by matlab we use the effective mean pore size to approximate the rev scale capillary pressure which is estimated by r m 1 2 r m by considering a mean shape factor of the pore bodies qin and van brummelen 2019 rm is the mean pore size given in table 1 the water saturation behind the wetting front is set to 0 9 fig 9 shows the comparison of the imbibition rates predicted by the vof model and the single phase darcy model under different viscosity ratios the contact angle is 60 it is seen that the darcy model well predicts the imbibition rate for the air water system even though the porous medium under study is smaller than its rev size the predictions by the darcy model however deviates from those by the pore network model under the viscosity ratios of 1 0 and 0 1 which show faster imbibition obviously this is mainly due to the failure of the assumption of a sharp wetting front moreover it is seen that the discrepancy is larger in the case of the viscosity ratio of 0 1 in the case of small viscosity ratios and the case that the late stage of spontaneous imbibition is of interest f zarandi and pillai 2018 the single phase darcy model will not be applicable any more then one would resort to the two phase darcy model in which capillary pressure and relative permeability curves are needed to obtain two phase material properties of spontaneous imbibition the pore scale modeling of a whole porous core up to several centimeters would be needed in this context an efficient and reliable pore network model will be very useful given the fact that dns simulations are computationally prohibitive 4 3 comparison between spontaneous and quasi static imbibition the trapping of nonwetting phase is of great interest in a number of subsurface applications such as oil recovery and co2 storage in practice different imbibition conditions may be encountered such as cocurrent spontaneous imbibition countercurrent spontaneous imbibition and imbibition processes which are close to quasi static it is acknowledged that cocurrent spontaneous imbibition is fast and its microscale dynamics is strong mason and morrow 2013 here with the help of our pore network model as a first attempt we compare cocurrent spontaneous imbibition with quasi static one in terms of nonwetting phase trapping and pore filling mechanisms i e the sequence of pore fillings in the case of cocurrent spontaneous imbibition we simulate the air water system i e the wicking process the static contact angle is set to 40 regarding the quasi static modeling we use an in house quasi static pore network code hefny et al 2020 which considers key two phase displacement mechanisms such as cooperative filling of pore bodies piston type move and snap off jackson et al 2003 patzek 2001 we put the wetting reservoir at the inlet and the nonwetting reservoir at the outlet as shown in fig 10 we first run the primary drainage to the irreducible saturation of 0 05 then we run the imbibition to the end i e the nonwetting reservoir pressure reduces to zero fig 10 left shows the water distribution in the end of spontaneous imbibition it is seen that most pores are fully filled with water with a few partially filled large pores the total amount of trapped air is only around 6 this value is close to experimental data of a relatively homogeneous porous medium kuijpers et al 2017 for the quasi static imbibition in fig 10 right as expected water prefers to fill small pores while much air is trapped in large pores the resultant amount of trapped air is up to 48 which is much higher than that in the spontaneous imbibition the difference in the air trapping is because the two imbibition processes have different pore filling mechanisms in the spontaneous imbibition we observe a co filling mechanism between small and large pores which results in a sharp wetting front it is expected there will be less and less co filling events as the increase of the nonwetting viscosity in the quasi static imbibition however the wetting filling shows a capillary finger pattern this is because in the absence of imbibition dynamics the wetting filling follows the mechanism of percolation invasion 5 conclusions we have presented a dynamic pore network model with specifically developed local rules for image based modeling of spontaneous imbibition in porous media a piece of µct scanning of sintered glass beads is used as our porous domain we have compared and verified our pore network model against a widely used vof model a number of case studies of primary imbibition by both the pore network model and the vof model have been conducted under different contact angle values and viscosity ratios based on those case studies we arrive at the following main conclusions 1 it is challenging for the vof model to simulate spontaneous imbibition in a strongly or weakly water wet porous medium which is represented by pore space voxels 2 our dynamic pore network model can well predict imbibition rates and temporal saturation profiles along the flow direction under a wide range of viscosity ratios in comparison to the vof model 3 for the air water system the wetting phase itself depresses the roughness growth of the wetting front as the increase of the nonwetting viscosity wetting fronts in spontaneous imbibition become rougher and rougher meanwhile more and more nonwetting phase is trapped in large pores 4 in spontaneous imbibition we see a co filling mechanism between small and large pores which results in much less trapping of the nonwetting phase in comparison to the quasi static imbibition 5 our pore network model is much more computationally efficient than the vof model the pore network model running on a single core takes less than one minute for one case study while the vof model typically needs a few days of 16 core parallel computation finally we notice that a real sandstone or carbonate rock has distinct features of mixed wettability roughness of grain surfaces and pore scale heterogeneity etc up to now for a dns model it is still challenging to quantitatively predict their influence on two phase flow dynamics therefore the present pore network model needs to be further improved and verified against lab experiments of spontaneous imbibition declaration of competing interest none acknowledgment c z q acknowledges the support of national natural science foundation of china no 12072053 the support of human resources and social security bureau of chongqing no cx2020087 and the support of darcy center of utrecht university and technology university of eindhoven this work is part of the research programme fundamental fluid dynamic challenges in inkjet printing with project number fip11 which is financed by the dutch research council nwo the support of océ technologies within this program is acknowledged the dataset associated with the present work is available via https doi org 10 6084 m9 figshare 10093676 appendix a spontaneous imbibition into a porous medium initially saturated with the nonwetting phase by assuming a sharp wetting front here we present the derivation of the 1d darcy scale model for spontaneous imbibition into a dry homogeneous porous medium as shown in fig a1 first for the wetting phase neglecting the gravity its darcy flux is given as a1 q w k w μ w p w l where the superscript w denotes the wetting phase q m s is the flux k m2 is the permeability μ pa s is the dynamic viscosity l m is the wetting penetration length and p pa is the pressure then we can write the rate of wetting saturation of the whole porous domain as follows a2 a l ε d s d t a k w μ w p w l where s is the wetting saturation of the whole porous domain a is the cross sectional area l is the domain length and ε is the porosity by virtue of volumetric conservation and the condition of pn pc pw at the wetting front we can write the nonwetting flux as a3 q n q w k n μ n p c p w l l substitution of eq a1 into eq a3 and after some arithmetic manipulations we can express the wetting phase pressure as a4 p w p c 1 l l l k w μ n k n μ w substitution of eq a4 into eq a2 we can obtain a5 d s d t 1 l ε k w μ w 1 l p c 1 l l l k w μ n k n μ w we assume a constant wetting saturation of sf behind the wetting front so that the wetting penetration length can be expressed as l sl sf further the wetting permeability is approximated by kw k 0 sf where k 0 is the intrinsic permeability because the medium is initially nonwetting saturated the nonwetting permeability is given by kn k 0 finally the ordinary differential equation for the imbibition rate is written as a6 d s d t s f l 2 ε s k 0 s f μ w p c 1 s f μ n μ w s f s s appendix b test cases of spontaneous imbibition by the vof model we conduct case studies of spontaneous imbibition in simple capillary tubes in order to understand the impact of mesh density and mesh type i e conforming mesh and voxel mesh on the predicted imbibition rate by the vof model fig b1 a shows the tube scale saturation versus the imbibition time under four different contact angle values in a capillary tube of circular cross section the inset shows the used fine mesh this mesh has 19 elements along the diagonal and 36 elements along the circumference fig b1 b shows the corresponding scaled imbibition slope values versus saturation the imbibition slope is defined as s t in which s is the tube scale water saturation and t is the imbibition time for each contact angle value θ the scaling is cos 40 0 cos θ it is seen that all curves collapse into the master curve of the contact angle value of 40 except for some initial fluctuations due to the so called inlet effect in dns simulations yin et al 2019 in fig b1 c we decrease the mesh density by 2 and compare the predicted imbibition rates which are also compared with that by the lw equation i e s r σ cos θ 2 μ l 2 in which r is the radius σ is the surface tension μ is the water dynamic viscosity and l is the tube length the differences in the imbibition rates predicted by the vof model with a fine mesh and a coarse mesh are negligible in addition the imbibition rates predicted by the vof model match with that of the lw equation for spontaneous imbibition in a capillary tube of triangular cross section as shown in fig b1 d the predicted imbibition rate of the coarse mesh is slightly larger than that under the fine mesh however both results match well with that of the lw equation notice that in the calculation of imbibition rate by the lw equation for the capillary tube of right triangular cross section the entry pressure i e the capillary pressure is calculated by the ms p theory mayer and stowe 1965 princen 1970 we further study the impact of mesh type and mesh refinement on the imbibition rate for a single 2d curved capillary tube the left graph in fig b2 shows the voxel representation and smooth geometry representation of the half of a 2d capillary tube the wall boundary length of the voxel representation due to voxel induced roughness is longer than that of the smooth representation by 27 the computational domain includes the wetting reservoir and the converging and diverging tube the radius of the tube throat and the radius of the outlet are 20 µm and 80 µm respectively the length of the tube is 150 µm initially the tube is saturated with air then water imbibes in the right graph of fig b2 shows the imbibition rates under different mesh types and mesh densities first it is seen that for the smooth geometry representation the mesh size of 4 µm and 2 µm give the same imbibition rate while for the voxel representation reducing the mesh size of 4 µm to 2 µm gives slightly slower imbibition rate in the converging part of the tube but much slower imbibition rate in the diverging part of the tube we note that the refinement of the voxel representation here is different from a higher voxel resolution of the porous medium the refinement here is conducted on the fixed voxel resolution of 4 µm second with the same mesh density the vof model predicts a faster imbibition process for the smooth geometry representation than that for the voxel representation this is mainly due to the voxel induced roughness of the wall owing to the fact that a rough wall increases the dissipation energy around three phase contact lines forsberg et al 2010 based on the above case studies of single capillary tubes we may conclude that the mesh density with the voxel resolution of 25 µm is adequate for vof simulations of spontaneous imbibition in the µct scanning of sintered glass beads a voxel representation would slightly slow down the predicted imbibition rate in comparison to a smooth representation however it can avoid the meshing of a complex porous medium appendix c mass balance and capillary number in the pore network simulations based on the constructed pore network the discretized mass balance eq 3 is in the conservative form which is solved by the first order explicit scheme to avoid extremely small time steps at the end of each time step we truncate the wetting saturation in a pore body as follows when s i w is smaller than 10 6 we set s i w 0 when 1 s i w is smaller than 10 6 we set s i w 1 this truncation practice may impact the mass imbalance in our case studies we calculate the mass imbalance of the wetting phase as c1 m t t 0 t i 1 n q i w i 1 n v i s i w t i 1 n v i where m t is the mass imbalance at the imbibition time of t q i w m3 s is the net wetting flow rate of pore body i and n is the number of pore bodies fig c1 shows the wetting phase mass imbalance in the pore network modeling of spontaneous imbibition under different contact angle values and viscosity ratios it is seen that for all case studies the mass imbalance is smaller than 10 3 which is negligible furthermore our case studies indicate that the truncation threshold has little impact on the mass imbalance fig c2 shows the temporal capillary number values in the pore network modeling of spontaneous imbibition under different contact angle values and viscosity ratios obviously for the air water system the capillary number decreases as the imbibition proceeds at the viscosity ratio of unity the capillary number keeps roughly constant before the wetting phase breakthrough at the viscosity ratio of 0 1 interestingly the capillary number also keeps roughly flat rather than increase this is because the sharp wetting front does not hold any more see fig 8b though the porous medium of sintered glass beads is highly permeable for all case studies in this work the capillary number values are smaller than 10 3 this indicates that the dynamic effect on the contact angle is minor 
311,in this article we present new random walk methods to solve flow and transport problems in saturated unsaturated porous media including coupled flow and transport processes in soils heterogeneous systems modeled through random hydraulic conductivity and recharge fields processes at the field and regional scales the numerical schemes are based on global random walk algorithms grw which approximate the solution by moving large numbers of computational particles on regular lattices according to specific random walk rules to cope with the nonlinearity and the degeneracy of the richards equation and of the coupled system we implemented the grw algorithms by employing linearization techniques similar to the l scheme developed in finite element volume approaches the resulting grw l schemes converge with the number of iterations and provide numerical solutions that are first order accurate in time and second order in space a remarkable property of the flow and transport grw solutions is that they are practically free of numerical diffusion the grw solvers are validated by comparisons with mixed finite element and finite volume solvers in one and two dimensional benchmark problems they include richards equation fully coupled with the advection diffusion reaction equation and capture the transition from unsaturated to saturated flow regimes keywords richards equation coupled flow and transport linearization iterative schemes global random walk msc 76s05 65n12 86a05 65c35 76r50 1 introduction the accuracy and the robustness of the numerical schemes is the primary requirement for reliable and meaningful results of the current efforts to improve the understanding of the complexity and interdependence of the flow and transport processes in subsurface hydrology through numerical investigations numerical solvers for partial differential equations modeling individual or coupled processes are often used as basic elements in the formulation of the more complex problems of practical interest such as parameter identification franssen et al 2009 hydraulic tomography bellin et al 2020 monte carlo approaches for systems with randomly distributed parameters pasetto et al 2011 or upscaling for mutiphase flows in heterogeneous subsurface formations hajibeygi et al 2020 among others a central issue in subsurface hydrology is the need of robust and computationally efficient numerical models for partially saturated soil groundwater systems the transition between unsaturated and saturated zones is particularly challenging in unsaturated flows the water content θ and the hydraulic conductivity k depend nonlinearly on the pressure head ψ through material laws based on experiments as far as ψ 0 the evolution of ψ is governed by the parabolic richards equation which degenerates to a generally linear elliptic equation i e the equation for steady state flow in aquifers if ψ 0 alt and luckhaus 1983 since the regions where degeneracy takes place depend on the evolution of the pressure ψ in time and space they are not known a priori to cope with the nonlinearity and degeneracy of the richards equation different linearization methods are needed such as the newton scheme schneid 2000 hajibeygi et al 2020 knabner and angermann 2003 which is second order convergent but converges only locally requires a starting point close enough to the solution or the more robust but only first order convergent picard modified picard or l schemes slodicka 2002 pop et al 2004 list and radu 2016 radu et al 2018 explicit and implicit schemes proposed for nonlinear flows in unsaturated regime provide solutions with comparable accuracy but are generally ambiguous to compare in terms of computing time since they do not need to solve systems of linear algebraic equations at every time step explicit schemes are in principle faster liu et al 2020 but their speed may be seriously affected by the need to use very small time steps haverkamp et al 1977 caviedes voullième et al 2013 alecsa et al 2019 the time step in explicit schemes is constraint by stability conditions strikwerda 2004 liu et al 2020 caviedes voullième et al 2013 and has to be significantly reduced to ensure small local péclet number pé defined with respect to the space step large global pé characterizes advection dominated transport problems bause and knabner 2004 kuzmin 2009 in such cases reducing the local pé is a remedy to avoid the numerical diffusion and the oscillatory behavior of the solution radu et al 2011 the criterion of small local pé is also recommended for numerical schemes solving the pressure equation in saturated flows gotovac et al 2009 and since richards equation has the structure of the advection diffusion equation the recommendation holds for the unsaturated flows as well well known approaches to avoid the numerical diffusion are the particle tracking in continuous space and the discrete random walk on lattices suciu 2019 the accuracy of these schemes is determined by the number of computational particles undergoing random jumps in continuous space or on discrete lattices in random walk schemes the increase of the computation time with the number of particles is simply avoided by randomly distributing the particles along the spatial directions with a global procedure according to appropriate jump probabilities in this way one obtains a global random walk grw which performs the spreading of all the particles from a given site with computational costs that are practically the same as for generating the jump of a single random walker in sequential procedures vamoş et al 2003 in particular cases e g when using biased jump probabilities to account for variable coefficients or for advective displacements the grw algorithms are equivalent to explicit finite difference schemes with time step size constrained by stability requirements in unbiased grw schemes for transport problems with variable coefficients which still satisfy stability conditions no restrictions on the time step are needed to reduce the local pé number which renders the approach particularly efficient in large scale simulations of transport in groundwater see suciu 2019 for details and examples the elliptic and parabolic equations governing the pressure head for flows in unsaturated saturated porous media are essentially diffusion equations with second order operator in stratonovich form they can be recast as fokker planck equations with drift augmented by the row derivative of the coefficient tensor and further solved by random walk approaches suciu 2019 an alternative approach starts with a staggered finite difference scheme further used to derive biased random walk rules governing the movement on a regular lattice of a system of computational particles the particle density at lattice sites provides a numerical approximation of the pressure head solution this approach has been already illustrated for flows in saturated porous media with heterogeneous hydraulic conductivity alecsa et al 2019 suciu 2020 in this article we present new grw schemes for nonlinear and non steady flows in soils which model the transition from unsaturated to saturated regime in a way consistent with the continuity of the constitutive relationships θ ψ and k ψ following list and radu 2016 radu et al 2018 the nonlinearity of the richards equation is solved with an iterative procedure similar to the l scheme used in finite element volume approaches numerical tests demonstrate the convergence of the l scheme for unsaturated saturated flows for fully saturated flow regime with constant water content θ and time independent boundary conditions the grw l scheme is equivalent to a transient finite difference scheme coupled flow and reactive transport problems for partially saturated soils rise new stability and consistency issues and demand augmented computational resources our grw approach in this case consists of coupling the flow solver described above with existing grw transport solvers suciu 2019 adapted for nonlinear problems which are implemented as l schemes as well the flow and transport solvers are coupled via an alternating splitting procedure illiano et al 2020 which successively iterates the corresponding l schemes until the convergence of the pressure head and concentration solutions is reached within the same tolerance at every time step code verification tests using analytical manufactured solutions are employed to verify the convergence of the iterations and the accuracy of the splitting scheme the grw scheme for one dimensional solutions of the richards equation which captures the transition from unsaturated to saturated flow regimes is validated by comparisons with solutions provided by richy software based on the mixed finite element method mfem with backward euler discretization in time and newton linearization developed at the mathematics department of the friedrich alexander university of erlangen nürnberg schneid et al 2000 schneid 2000 for the particular case of unsaturated flows the one dimensional grw solutions are also tested by comparisons with experimental data zadeh 2011 zambra et al 2012 and exact solutions published in the literature warrick et al 1985 watson et al 1995 the two dimensional grw solutions are compared on benchmark problems with two point flux approximation tpfa finite volume solvers using backward euler discretization in time and l scheme linearization illiano et al 2020 the tpfa codes are implemented in mrst the matlab reservoir simulation toolbox lie 2019 the paper is organized as follows section 2 presents the grw algorithm and the linearization approach for one dimensional flow problems the one dimensional solver is further validated through comparisons with mfem solutions experimental data and exact analytical solutions in section 3 two dimensional grw algorithms for fully coupled and decoupled flow and transport problems are introduced in section 4 code verification tests and comparisons with tpfa solutions for benchmark problems are presented in section 5 some examples of flow and transport solutions for groundwater problems at the field and regional scale are presented in section 6 the main conclusions of this work are finally presented in section 7 grw codes implemented in matlab for model problems considered in this article are stored in the git repository richardsequation suciu et al 2021 2 one dimensional grw algorithm for unsaturated saturated flow in soils we consider the water flow in unsaturated saturated porous media described by the one dimensional richards equation haverkamp et al 1977 schneid et al 2000 knabner and angermann 2003 in the space time domain 0 l z 0 t 1 θ ψ t z k θ ψ z ψ z 0 where ψ z t is the pressure head expressed in length units θ is the volumetric water content k stands for the hydraulic conductivity of the medium and z is the height oriented positively upward according to 1 the water flux given by darcy s law is q k θ ψ z ψ z to design a grw algorithm we start with the staggered finite difference scheme with backward discretization in time which approximates the solution of eq 1 at positions z i δ z i 1 i i l z δ z and time points t k δ t k 1 t δ t according to 2 θ ψ i k θ ψ i k 1 δ t δ z 2 k ψ i 1 2 k ψ i 1 k ψ i k k ψ i 1 2 k ψ i k ψ i 1 k k ψ i 1 2 k k ψ i 1 2 k δ z to cope with the double nonlinearity due to the dependencies k θ and θ ψ we propose an explicit scheme similar to the linearization approach known as l scheme originally developed for implicit methods e g pop et al 2004 list and radu 2016 radu et al 2018 the approach consists of the addition of a stabilization term l ψ i k s 1 ψ i k s l c o n s t in the left hand side of 2 and of performing successive iterations s 1 2 of the modified scheme until the discrete l 2 norm of the solution ψ k s ψ i k s ψ i k s verifies 3 ψ k s ψ k s 1 ε a ε r ψ k s for some given tolerances ε a and ε r the adapted l scheme reads 4 ψ i k s 1 1 r i 1 2 k s r i 1 2 k s ψ i k s r i 1 2 k s ψ i 1 k s r i 1 2 k s ψ i 1 k s r i 1 2 k s r i 1 2 k s δ z θ ψ i k s θ ψ i k 1 l where 5 r i 1 2 k s k ψ i 1 2 k s δ t l δ z 2 for fixed time step k the iterations start with the solution after the last iteration at the previous time k 1 ψ i k 1 ψ i k 1 i 1 i note that unlike implicit l schemes e g slodicka 2002 pop et al 2004 list and radu 2016 the explicit scheme 4 uses forward increments of ψ in this way the solution ψ i k s 1 is obtained from values of ψ and r evaluated at the previous iteration without solving systems of algebraic equations the solution ψ i k s is further represented by the distribution of n computational particles at the sites of the one dimensional lattice ψ i k s n i k s a n with a being a constant equal to a unit length and the l scheme 4 becomes 6 n i k s 1 1 r i 1 2 k s r i 1 2 k s n i k s r i 1 2 k s n i 1 k s r i 1 2 k s n i 1 k s n f s where the source term is defined as f s r i 1 2 k s r i 1 2 k s δ z θ n i k s θ n i k 1 l and denotes the floor function the physical dimension of the parameter l of the scheme is that of an inverse length unit to ensure that r i 1 2 k s defined by 5 are non dimensional parameters as needed in random walk approaches vamoş et al 2003 suciu 2019 by imposing the constraint r i 1 2 k s 1 2 the parameters r i 1 2 k s can be thought of as biased jump probabilities hence the contributions to n i k s 1 from neighboring sites i 1 summed up in 6 can be obtained with the grw algorithm which moves particles from sites j to neighboring sites i j 1 according to the rule 7 n j k s δ n j j k s δ n j 1 j k s δ n j 1 j k s for consistency with 6 the quantities δ n s in 7 have to satisfy in the mean suciu 2019 sect 3 3 4 1 8 δ n j j k s 1 r j 1 2 k s r j 1 2 k s n j k s δ n j 1 2 j k s r j 1 2 k s n j k s the quantities δ n s are binomial random variables approximated by using the unaveraged relations 8 for the mean summing up the reminders of multiplication by r and of the floor function n f s δ t and allocating one particle to the lattice site where the sum reaches the unity remark 1 the finite difference l scheme 4 and the derived grw relation 6 are explicit iterative schemes for richards equation in mixed form 1 the essential difference of the l schemes from explicit schemes in mixed formulation designed for unsaturated regime haverkamp et al 1977 caviedes voullième et al 2013 liu et al 2020 is that they apply to both unsaturated and saturated flow conditions remark 2 consider the saturated regime θ c o n s t with space variable hydraulic conductivity k and a given source term f with the parameter l set to l 1 a after disregarding the time index k the scheme 6 solves the following equation for the hydraulic head h ψ z 9 1 a h s z k h z f for boundary conditions independent of s the solution of eq 9 approaches a steady state regime corresponding to the saturated flow see also alecsa et al 2019 suciu 2020 the modified grw scheme 6 is equivalent to a convergent finite difference scheme first order accurate in time and second order in space suciu et al 2020 remark 1 3 validation of the one dimensional grw flow algorithm 3 1 transition from unsaturated to saturated flow regime the one dimensional algorithm for flow in unsaturated saturated soils is validated in the following by comparisons with mfem solutions obtained with the richy software schneid et al 2000 schneid 2000 for this purpose we solve one dimensional model problems for the vertical infiltration of the water through both homogeneous and non homogeneous soil columns srivastava and yeh 1991 previously used in schneid 2000 to assess the accuracy and the convergence of the mfem solutions we consider the domain z 0 2 and the boundary conditions specified by a constant pressure ψ 0 t ψ 0 at the bottom of the soil column and a constant water flux q 0 at the top together these constant conditions determine the initial pressure distribution ψ z 0 as solution of the steady state flow problem for t 0 the pressure ψ 0 is kept constant at the bottom and the water flux at the top of the column is increased linearly from q 0 to q 1 until t t 1 and is kept constant for t t 1 for the unsaturated regions ψ 0 we consider the constitutive relationships given by the simple exponential model gardner 1958 10 θ ψ θ r e s θ s a t θ r e s e α ψ 11 k θ ψ k s a t θ ψ θ r e s θ s a t θ r e s where θ θ s a t and k k s a t denote the constant water content respectively the constant hydraulic conductivity in the saturated regions ψ 0 and θ r e s is the residual water content the flow problem for eq 1 with the parameterization 10 11 is solved in two scenarios 1 homogeneous soil with k s a t 2 77 10 6 θ r e s 0 06 θ s a t 0 36 α 10 q 0 2 77 10 7 q 1 2 50 10 6 which are representative for a sandy soil and 2 non homogeneous soil with the same parameters as in scenario 1 except the saturated hydraulic conductivity which takes two constant values k s a t 2 77 10 6 for z 1 and 500 k s a t for z 1 modeling for instance a column filled with sand and gravel to capture the transition from unsaturated to saturated regime the pressure at the bottom boundary is fixed at ψ 0 0 5 for the parameters of the one dimensional flow problems solved in this section we consider meters as length units and seconds as time units the simulations are conducted up to t 10 4 about 2 78 h and the intermediate time is taken as t 1 t 10 2 we consider a uniform grw lattice with δ z 10 2 equal to the length of the linear elements in the mfem solver the grw computations are initialized by multiplying the initial condition by n 10 24 particles since as shown by 11 the hydraulic conductivity varies in time the length of the time step determined by 5 for the maximum of k at every time iteration and by specifying a maximum r m a x 0 8 of the parameter r i 1 2 k may vary in time see fig 1 the parameter of the regularization term in the l scheme is set to l 1 for the computation of the initial condition solution of the stationary problem i e for θ t 0 in 1 and to l 2 for the solution of the non stationary problem in both cases the convergence criterion 3 is verified by choosing ε a 0 and a relative tolerance ε r 10 9 the comparison with the mfem solutions presented in figs 2 3 4 shows a quite good accuracy of the grw solutions for pressure water content and water flux the relative errors computed with the aid of the l 2 norms by ε ψ ψ g r w ψ m f e m ψ m f e m and similarly for θ and q are presented in table 1 the l scheme converges with speeds depending on the problem to solve the problem for the initial condition one needs 3 5 10 4 iterations in scenario 1 and 6 5 10 6 iterations in scenario 2 instead to solve the non stationary problem for a final time t 10 4 one needs about 70 iterations in scenario 1 and about 700 iterations in scenario 2 see figs 5 and 6 the convergence of the iterative grw l scheme can be further investigated through assessments of the computational order of convergence of the sequence of successive correction norms ψ k s ψ k s 1 cătinaş 2019 cătinaş 2020 estimations provided in suciu et al 2020 appendix a indicate a linear convergence for scenario 1 but only a power law convergence s 1 which is slower than the linear convergence cătinaş 2020 for scenario 2 supplementary tests done in scenario 1 indicate the existence of a lower bound of the constant l which ensures the convergence suciu et al 2020 sect 3 1 it is found that increasing l above the value which ensures the convergence of the grw l scheme with a desired accuracy only results in increasing number of iterations and more computing time the parameter l has to be established experimentally by checking the convergence and as highlighted by the examples presented in section 5 below it depends on the complexity of the problem to be solved 3 2 comparison with experiments and exact solutions for unsaturated flows an experiment consisting of free drainage in a 600 cm deep lysimeter filled with a material with silty sand texture conducted at the los alamos national laboratory abeele 1984 is often used to validate one dimensional schemes for unsaturated flows see e g zadeh 2011 zambra et al 2012 caviedes voullième et al 2013 this example is provided with the hydrus 1d software simunek et al 2008 which is also used for validation purposes in the papers cited above the relationships defining the water content θ ψ and the hydraulic conductivity k θ ψ are given by the van genuchten mualem model 12 θ ψ 1 α ψ n m ψ 0 1 ψ 0 13 k θ ψ k s a t θ ψ 1 2 1 1 θ ψ 1 m m 2 ψ 0 k s a t ψ 0 where θ r e s θ s a t and k s a t represent the same parameters as for the exponential model considered in section 3 1 θ θ θ r e s θ s a t θ r e s is the normalized water content and α n and m 1 1 n are model parameters depending on the soil type with the parameters given in the hydrus 1d example θ r e s 0 0 θ s a t 0 331 k s a t 25 cm d α 0 0143 cm 1 n 1 5 for initial and boundary conditions for free drainage given by ψ z 0 0 cm and q 0 t 0 cm d zadeh 2011 the solutions provided by the grw l scheme 6 8 for simulation times from 1 d to 100 d are obtained with stabilization parameter l 0 5 after a number of 9 to 35 iterations tolerance specified by ε a ε r 5 10 6 in 3 the spatial resolution is set to δ z 10 cm while the time step varies slightly between 10 2 d and 3 16 10 2 d according to 5 the results are compared in figs 7 and 8 with hydrus 1d results and experimental data the water content profiles fig 7 are quite close to measurements and similar to those presented in zambra et al 2012 caviedes voullième et al 2013 the pressure profiles fig 8 deviate from experiment mainly for t 1 d and t 100 d with approximately the same amount as in caviedes voullième et al 2013 fig 12 an improved prediction of the pressure profiles is obtained in zadeh 2011 with slightly modified parameters of the van genuchten mualem model but with the price of larger deviations for the water content the θ based form of richards equation has shown significantly improved performance in numerical schemes for unsaturated flows in spatially homogeneous soils e g constant k s a t especially in modeling infiltration into dry media zadeh 2011 and is well suited to analytical approaches philip 1969 warrick et al 1985 sander et al 1988 philip philip 1969 derived an exact solution for infiltration problems expressed in the form z θ t that is the depth where the water content takes specified values at given time points t philip s solution has been used in warrick et al 1985 to construct a table of coefficients which allow the computation of z θ t for three different θ and arbitrary t the solution verifies the dimensionless form the θ based richards equation 14 θ t z d θ z θ d k θ d θ θ z where z is positive downward d θ k θ d ψ d θ and k θ is given according to the van genuchten mualem model by the upper branch of 13 such analytical solutions have been used in phoon et al 2007 caviedes voullième et al 2013 to verify various one dimensional numerical schemes based on finite volume and finite element approaches in order to test the grw l scheme 6 8 we solve the same infiltration problem soil column 100 cm deep constant unsaturated initial water content θ i and infiltration imposed by ψ 0 on the upper boundary we use a van genuchten mualem parameter n 1 5 together with the parameters of the hypothetical loam soil used in warrick et al 1985 k s a t 6 10 4 cm s θ s a t 0 45 θ r e s 0 1 θ i 0 17 α 0 01 cm 1 the pressure corresponding to the initial water content is obtained by 12 ψ θ i 24 87 cm the computations are carried out with δ z 1 cm δ t between 9 26 10 4 h and 5 23 10 4 h l 0 2 and the convergence is achieved after a number of 15 to 160 iterations ε a ε r 5 10 6 the analytical solutions z θ t for θ 0 24 0 31 and 0 38 at successive times between 0 5 h and 2 h are obtained with the coefficients for n 1 5 and θ θ i 0 2 given in warrick et al 1985 table 3 the grw results z θ t for the same θ and t are obtained by linear interpolation of the numerical solution θ z t relative errors z z z of the numerical solution z θ t with respect to the analytical solution z θ t are shown in table 2 an exact solution for constant flux infiltration with dry initial condition θ z 0 0 has been derived in sander et al 1988 and further used to verify the numerical solution provided by a pressure formulation of the richards equation watson et al 1995 the solution solves eq 14 with coefficient given by fujita s model fujita 1952 d θ d 0 1 v θ 2 where d 0 and v are positive constants since θ z 0 0 implies ψ θ z 0 as initial condition for the numerical scheme in pressure formulation the singularity was avoided in watson et al 1995 by considering θ z 0 3 4483 10 6 as a numerical simulation parameter as for the grw scheme 6 8 we would have k θ z 0 0 and according to 5 the condition r i 1 2 k s 1 2 implies δ t for finite δ z using the same initial ψ as in watson et al 1995 requires a very fine discretization which would slow down considerably the computation therefore we opt for the direct approach of solving 14 as a diffusion equation with drift coefficient defined by v θ d k θ d θ the latter will be computed analytically from the parameterization k θ used in watson et al 1995 proceeding as in section 2 we start with a forward time centered space finite difference discretization of eq 14 θ i k 1 θ i k 1 δ t δ z 2 d θ i 1 2 k θ i 1 k θ i k d θ i 1 2 k θ i k θ i 1 k δ t 2 δ z v i k θ i 1 k θ i 1 k we approximate the solution by a distribution of n particles on a regular lattice θ i k n i k n and end up with 15 n i k 1 1 r i 1 2 k r i 1 2 k n i k 1 2 r i 1 2 k v i k n i 1 k 1 2 r i 1 2 k v i k n i 1 k the dimensionless parameters in eq 15 are given by r i 1 2 k 2 δ t δ z 2 d i 1 2 k v i k δ t δ z r i 1 2 k 1 v i k r i 1 2 k eq 15 sums up contributions of random walkers jumping on the lattice according to the rule 16 n j k δ n j j k δ n j 1 j k δ n j 1 j k which defines a biased global random walk algorithm bgrw suciu 2019 sect 3 3 3 the numbers of particles δ n in 16 are binomial random variables determined by the same procedure as in section 2 and their ensemble averages verify δ n j j k 1 r i 1 2 k r i 1 2 k n i k δ n j 1 j k 1 2 r i 1 k v i k n i k following watson et al 1995 we set on the top boundary the constant flux condition q q θ s a t θ r e s 0 2759 cm min with θ s a t 0 35 θ r e s 0 06 and consider the constant parameters d 0 2 75862 cm 2 min and v 0 85 of the fujita s model the bgrw results for the final time t 0 3625 min obtained with δ z 10 2 cm and δ t between 1 51 10 5 min and 1 23 10 5 min are compared in table 3 with the analytical solution presented in watson et al 1995 table 1 the tests for unsaturated one dimensional flows presented above are completed in suciu et al 2020 sect 5 2 4 by convergence investigations and estimations of convergence order of the grw algorithms for fully coupled nonlinear flow and transport problems for saturated unsaturated porous systems 4 two dimensional grw solutions 4 1 two dimensional grw algorithm for flow in soils and aquifers in two spatial dimensions the pressure head ψ x z t satisfies the equation 17 t θ ψ k θ ψ ψ z 0 the two dimensional grw algorithm on regular staggered grids δ x δ z which approximates the solution of 17 by computational particles ψ n a n is constructed similarly to 6 8 the solution at iteration s 1 is obtained by gathering particles from neighboring sites according to 18 n i j k s 1 1 r i 1 2 j k s r i 1 2 j k s r i j 1 2 k s r i j 1 2 k s n i j k s r i 1 2 j k s n i 1 j k r i 1 2 j k s n i 1 j k r i j 1 2 k s n i j 1 k r i j 1 2 k s n i j 1 k n f s where the source term is defined as f s r i j 1 2 k s r i j 1 2 k s δ z θ n i j k s θ n i j k 1 l the two dimensional grw rule which at time k moves particles from sites l m to neighboring sites l 1 m 1 reads as follows 19 n l m k s δ n l m l m k s δ n l 1 m l m k s δ n l 1 m l m k s δ n l m 1 l m k s δ n l m 1 l m k s for consistency with 18 the numbers of particles δ n s verify in the mean 20 δ n l m l m k s 1 r l 1 2 m k s r l 1 2 m k s r l m 1 2 k s r l m 1 2 k s n l m k s δ n l 1 m l m k s r l 1 2 m k s n l m k s δ n l m 1 l m k s r l m 1 2 k s n l m k s the parameters r l 1 2 m k s and r l m 1 2 k s defined by relations similar to 5 are dimensionless positive real numbers they represent biased jump probabilities on the four allowed spatial directions of the grw lattice and are constraint by the first relation 20 such that their sum be less or equal to one a sufficient condition would be that each of them verifies r 1 4 the binomial random variables variables δ n are approximated in the same way as in the one dimensional case by giving up the particle indivisibility one obtains deterministic grw algorithms which represent the solution n by real numbers and use the unaveraged relations 20 for the computation of the δ n terms in the following we use this deterministic implementation of the grw algorithm to compute flow solutions for unsaturated saturated porous media remark 3 after disregarding the index k and letting l 1 a θ c o n s t the algorithm 18 20 becomes a transient scheme to solve the equation governing flows in saturated porous media alecsa et al 2019 suciu 2020 see also remark 2 4 2 grw algorithms for two dimensional fully coupled flow and surfactant transport let the pressure ψ x z t and the concentration c x z t solve the equations of the following model of fully coupled flow and surfactant transport in unsaturated saturated porous media knabner et al 2003 illiano et al 2020 21 t θ ψ c k θ ψ c ψ z 0 22 t θ ψ c c d c q c r c where q k θ ψ c ψ z is the water flux darcy velocity and r c is a nonlinear reaction term equations 21 22 are coupled in both directions through the nonlinear functions θ ψ c and θ ψ c c the pressure eq 21 is solved with the grw l scheme described in the previous subsection with a slight modification due to the dependence of θ on both ψ and c new algorithms are needed instead to solve the coupled nonlinear transport eq 22 4 2 1 biased grw algorithm for transport problems to derive a grw algorithm for the transport equation we start with a backward time central space finite difference scheme for eq 22 considering a diagonal diffusion tensor with constant components d 1 and d 2 and denoting by u and v the components of the darcy velocity along the horizontal axis x and the vertical axis z by δ t the time step and by δ x and δ z the spatial steps the scheme reads as 23 θ ψ i j k c i j k c i j k θ ψ i j k 1 c i j k 1 c i j k 1 δ t 2 δ x u i 1 j k c i 1 j k u i 1 j k c i 1 j k δ t 2 δ z v i j 1 k c i j 1 k v i j 1 k c i j 1 k d 1 δ t δ x 2 c i 1 j k 2 c i j k c i 1 j k d 2 δ t δ z 2 c i j 1 k 2 c i j k c i j 1 k r c i j k δ t 2 d 1 δ t δ x 2 2 d 2 δ t δ z 2 c i j k d 1 δ t δ x 2 δ t 2 δ x u i 1 j k c i 1 j k d 1 δ t δ x 2 δ t 2 δ x u i 1 j k c i 1 j k d 2 δ t δ z 2 δ t 2 δ z v i j 1 k c i j 1 k d 2 δ t δ z 2 δ t 2 δ z v i j 1 k c i j 1 k r c i j k δ t next similarly to the scheme for the flow equation we add a regularization term l c i j k s 1 c i j k s in eq 23 define the dimensional parameters 24 r x 2 d 1 δ t l δ x 2 r z 2 d 2 δ t l δ z 2 u i 1 j k s δ t l δ x u i 1 j k s v i j 1 k s δ t l δ z v i j 1 k s approximate the concentration by the density of the number of computational particles c i j k s n i j k s n and finally we obtain 25 n i j k s 1 1 r x r z n i j k s 1 2 r x u i 1 j k s n i 1 j k s 1 2 r x u i 1 j k s n i 1 j k s 1 2 r z v i j 1 k s n i j 1 k s 1 2 r z v i j 1 k s n i j 1 k s n g s where g s r n i j k s δ t l θ ψ i j k s n i j k s n i j k s θ ψ i j k 1 n i j k 1 n i j k 1 l with ψ approximated by the distribution of particles in the flow solver for eq 21 note that the definition of the dimensionless numbers 24 implies that the parameter l has to be a dimensionless number as well the contributions to n i j k s 1 in eq 25 are obtained with the bgrw algorithm 26 n l m k s δ n l m l m k s δ n l 1 m l m k s δ n l 1 m l m k s δ n l m 1 l m k s δ n l m 1 l m k s where for consistency with the finite difference scheme 25 the quantities δ n verify in the mean 27 δ n l m l m k s 1 r x r z n i j k s δ n l 1 m l m k s 1 2 r x u l m k s n l m k s δ n l m 1 l m k s 1 2 r z v l m k s n l m k s the binomial random variables δ n used in the bgrw algorithm are approximated similarly to the algorithms described in the previous sections by summing up to unity reminders of multiplication and floor operations a deterministic bgrw algorithm can be obtained similarly to the flow solver presented in section 4 1 above by giving up the particle s indivisibility and using the un averaged relations 27 however for the computations presented in the next section we use a randomized implementation of the bgrw algorithm as follows from 27 the bgrw algorithm is subject to the following restrictions 28 r x r z 1 u l m k s r x v l m k s r z remark 4 the constraints 28 impose a limitation on the maximum allowable value of the local péclet number assume a constant flow velocity v and a constant diffusion coefficient d then according to 28 and 24 the condition v r implies pé v δ z d 2 remark 5 taking into account that the iterations start with n i j k 1 setting l 1 θ 1 and dropping the superscripts s the relation 25 becomes 29 n i j k 1 r x r z n i j k 1 1 2 r x u i 1 j k 1 n i 1 j k 1 1 2 r x u i 1 j k 1 n i 1 j k 1 1 2 r z v i j 1 k 1 n i j 1 k 1 1 2 r z v i j 1 k 1 n i j 1 k 1 n r n i j k 1 δ t relation 29 together with 26 28 define a bgrw algorithm for decoupled reactive transport described by eq 22 with θ ψ c 1 4 2 2 unbiased grw algorithm for transport problems the unbiased grw algorithm is obtained by globally moving groups of particles according to the rule 30 n i j k s δ n i u i j k s j v i j k s i j k s δ n i u i j k s d j v i j k s i j k s δ n i u i j k s d j v i j k s i j k s δ n i u i j k s j v i j k s d i j k s δ n i u i j k s j v i j k s d i j k s where d is a constant amplitude of diffusion jumps and the dimensionless variables r x r z u and v are defined similarly to 24 by 31 r x 2 d 1 δ t l d δ x 2 r z 2 d 2 δ t l d δ z 2 u i j k s δ t l δ x u i j k s 0 5 v i j k s δ t l δ z v i j k s 0 5 the particles distribution is updated at every time step by 32 n l m k s 1 δ n l m k s i l j m δ n l m i j k s n g s the averages over grw runs of the terms from 30 are now related by 33 δ n i u i j k s j v i j k s i j k s 1 r x r z n i j k s δ n i u i j k s d j v i j k s i j k s r x 2 n i j k s δ n i u i j k s j v i j k s d i j k s r z 2 n i j k s comparing with the bgrw relations 27 we remark that 31 defines unbiased jump probabilities r x 2 and r y 2 on the two spatial directions the unbiased grw algorithm for decoupled transport is obtained by letting l 1 and dropping the superscripts s see also remark 5 the binomial random variables δ n used in the unbiased grw algorithm are approximated by the procedure used for the flow solver and for the bgrw algorithm presented in the previous subsection for fixed space steps the time step is chosen such that the dimensionless parameters u i j k s and v i j k s take integer values larger than unity which ensure the desired resolution of the velocity components suciu 2019 sect 3 3 2 1 further the jumps amplitude d is chosen such that the jump probabilities verify the constraint r x r z 1 imposed by the first relation 33 the unbiased grw as well as the bgrw algorithm introduced in section 4 2 1 above have been tailored to solve problems with constant diffusion coefficients as those considered in sections 5 2 and 6 3 below in case of diagonal diffusion tensors with space time variable coefficients d 1 and d 2 the algorithms for the transport problem are straightforwardly obtained by assigning to r x and r z superscripts s and appropriate subscripts i j k 5 validation of the two dimensional grw algorithms 5 1 grw flow solutions for the beginning we conduct verification tests of the grw flow code by comparisons with an analytical solution and compute numerical estimates of the order of convergence the results are further compared with those obtained by a tpfa code implemented in the mrst software lie 2019 illiano et al 2020 the two codes are tested by solving a problem with manufactured solution previously considered in radu and wang 2014 the domain is the unit square 0 1 0 1 and the final time is t 1 the manufactured solution for the pressure head ψ m is given by 34 ψ m x z t t x x 1 z z 1 1 the water content θ and the conductivity k are expressed as 35 θ ψ 1 1 ψ k θ ψ ψ 2 the analytical solution 34 defines the boundary and initial conditions and induces a source term f computed analytically from eq 17 with parameters given by the expressions 35 we start the computations on a uniform mesh with δ x δ z 0 1 and halve the mesh size step three times successively the accuracy of the numerical solutions at the final time t t is quantified by the l 2 norm ε l ψ l ψ m l 1 4 where l 1 corresponds to the original mesh the estimated order of convergence eoc that describes the decrease of the error in logarithmic scale is computed according to 36 e o c log ε l ε l 1 log 2 l 1 3 the computations with the tpfa code start with a time step δ t 0 1 which is also halved at each refinement of the mesh the parameters of the convergence indicator 3 are set to ε a 10 6 and ε r 0 finally the linearization parameter l is set equal to 1 2 and the convergence of the l scheme is achieved after circa 100 iterations per time step independently of the mesh size in the grw computations we use the same spatial refinement of the grid and tolerances ε a and ε r as above but according to 5 we have to use adaptive time steps δ t o δ z 1 2 see discussion in section 3 1 the convergence criterion 3 is already fulfilled by the grw l scheme with parameter l 1 for numbers of iterations increasing from s 2 to s 5 as the space step decreases the accuracy ε l instead is strongly influenced by l for l 800 the ε l values may increase with the refinement of the mesh leading to negative eoc that is the grw solution does not converge to the exact solution ψ m however it is found that the increase of ε l is prevented by using a sufficiently large parameter l the results presented in table 4 indicate the convergence of order 1 in space for tpfa and of order 2 for the grw solutions the higher order of convergence also leads to much smaller errors of the grw code after the first refinement of the mesh further we solve the benchmark problem from list and radu 2016 sect 4 2 which describes the recharge of a groundwater reservoir from a drainage trench in a two dimensional geometry the groundwater table is fixed by a dirichlet boundary condition on the right hand side the drainage process is driven by a dirichlet boundary condition changing in time on the upper boundary of ω the precise structure of the domain is defined by ω 0 2 0 3 γ d 1 x z ω x 0 1 z 3 γ d 2 x z ω x 2 z 0 1 γ d γ d 1 γ d 2 γ n ω γ d the dirichlet and neumann boundary conditions on γ d and γ n respectively as well as the initial condition consisting of hydrostatic equilibrium are specified as follows ψ x z t 2 2 2 t δ t d on γ d 1 t δ t d 0 2 on γ d 1 t δ t d 1 z on γ d 2 k θ ψ x z t ψ x z t z n 0 on γ n ψ x z 0 1 z on ω where n represents the outward pointing normal vector we consider here two sets of soil parameters presented in table 5 which correspond to a silt loam and a beit netofa clay respectively the time unit is 1 day and spatial dimensions are given in meters furthermore we consider a regular mesh consisting of 651 nodes i e δ x δ z 0 1 by setting the stabilization parameters to l 0 5 for loam and for l 0 12 for clay the convergence criterion 3 with ε a ε r 5 10 6 is fulfilled after about 120 iterations of the grw l scheme for both soil models figs 9 and 10 the results shown in figs 11 and 12 are as expected for this benchmark problem see schneid 2000 list and radu 2016 the drainage process in the clay soil is much slower so that the pressure distribution after three days is similar to that established in the loam soil after 4 5 h the results obtained with the tpfa l scheme with l 1 for both soil models are used as reference to compute the relative errors ε ψ ε θ ε q x and ε q z shown in table 6 one remarks that ε ψ and ε θ are close to the corresponding errors for the one dimensional case presented in table 1 but ε q x and ε q z are one order of magnitude larger than ε q in shown in table 1 a possible explanation could be the occurrence of the numerical diffusion in the flow tpfa code see discussion at the end of section 5 2 3 below the computational times of the grw code are 1 s and 1 6 s for loam and clay cases respectively the times of the tpfa runs on the same computer are one order of magnitude larger i e 25 s and 38 s respectively 5 2 grw bgrw solutions for fully coupled flow and transport problems 5 2 1 code verification tests the code verification tests for coupled flow and transport problems are conducted similarly to those for the flow solver presented in the previous subsection by considering along with the exact flow solution 34 the exact solution for the concentration field given by 37 c m x z t t x x 1 z z 1 1 after setting r 0 and d 1 the coupled system of equations 21 22 is solved in the unit square for a total time t 1 with source terms initial conditions and boundary conditions resulted from the exact solutions 34 and 37 with a new parameterization given by 38 θ ψ c 1 1 ψ c 10 k θ ψ ψ 2 the grw flow algorithm 18 20 with θ and k given by 38 is coupled with the bgrw transport algorithm 25 28 initialized with n 10 24 particles into an alternating splitting scheme illiano et al 2020 the approach alternates iterations of flow and transport solvers until the convergence criterion 3 with ε a 10 6 and ε r 0 is fulfilled by the numerical solutions for both ψ and c in order to highlight the approach to the convergence order 2 the stabilization parameters of the flow and the transport solvers are set to l p l c 100 the grw results presented in tables 7 and 8 are compared with results obtained with a tpfa solver applying the same alternating linearized splitting procedure with parameters l p l c 1 which ensure the convergence of order 1 the grw flow solver approximates the darcy velocity by centered differences only in the interior ω of the computational domain therefore the velocity q ω needed to compute the number of biased jumps from the boundary ω in the bgrw relation 25 has to be provided in some way the straightforward approach is to compute the velocity by using an approximate forward finite difference discretization of darcy s law another option is to extend on the boundary the velocity from the first neighboring interior site thanks to the manufactured solution 34 on which the code verification test is based we also have the exact velocity computed analytically the latter allows accuracy assessments for the above approximations we note that the grw results for the pressure solver obtained with analytical approximate and extend q ω are identical in the precision of three significant digits table 7 for the concentration solutions table 8 we note the remarkably good performance of approximate and extended q ω 5 2 2 estimates of numerical diffusion the small errors shown in table 8 indicate that the numerical diffusion in solving the transport step of the coupled problem does not play a significant role this is somewhat expected for the small péclet numbers of order pé 10 2 encountered in these computations but for the numerical setup of the benchmark problem presented in section 5 1 and realistic transport parameters pé can be significantly larger than unity therefore we proceed to estimate the numerical diffusion of the codes compared here by following the procedure used in radu et al 2011 we consider the analytical gaussian solution c x z t of eq 22 with θ 1 r 0 and constant coefficients d 0 001 and v 0 0331 corresponding to the cauchy problem with a dirac initial concentration pulse located at the coordinates 1 2 1 the constant velocity v oriented downwards along the z axis is the steady state solution of the benchmark flow problem from section 5 1 with k k s a t corresponding to the loam soil initial condition ψ x z 0 1 z 3 dirichlet boundary conditions ψ x 0 t 1 ψ x 3 t 0 and no flow neumann conditions on the vertical boundaries the initial condition c x z 0 is the same gaussian function evaluated at t 1 and the final time is t 3 for decreasing mesh sizes δ x and pé v δ x d the number of time steps was restricted by the requirement that the support of the numerical solution does not extend beyond the boundaries ω to mimic diffusion in unbounded domains the effective diffusion coefficients d x and d z are computed from the spatial moments along the x and z directions of the numerical solution see radu et al 2011 eqs 38 41 the numerical diffusion is estimated by relative errors ε d x d x d d and ε d z d z d d averaged over the time interval 0 t table 9 shows that while the tpfa results are strongly influenced by the mesh size similarly to the finite volume results from radu et al 2011 the unbiased grw algorithm is practically unconditionally free of numerical diffusion the bgrw algorithm is also free of numerical diffusion provided that pé 2 see also remark 4 we also note that δ x 0 05 defines the coarsest grid acceptable for solving the benchmark problem for coupled flow and transport with bgrw and tpfa codes 5 2 3 fully coupled water flow and surfactant transport in the following we solve the coupled flow and transport problem 21 22 by using the setup of the benchmark flow problem problem from section 5 1 completed by parameters and initial boundary conditions modeling a situation of coupled water flow and surfactant transport the surfactant concentration in the domain ω has a stratified distribution described by the plane c x z 0 z 1 2 further the concentration is set to c 1 on the dirichlet boundary γ d 1 and to c 0 on γ d 2 and no flow neumann conditions are imposed on the vertical boundaries the flow and transport are coupled in both directions through the van genuchten mualem parameterization 12 13 with θ ψ c θ γ c ψ where γ c 1 1 b ln c a 1 models the concentration dependent surface tension between water and air knabner et al 2003 the constant parameters of γ c are set to a 0 44 and b 0 0046 illiano et al 2020 to describe a more realistic heterogeneous soil the saturated conductivity k s a t is modeled as a log normal space random function with a small variance σ 2 0 5 and gaussian correlation of correlation lengths λ x 0 1 m and λ z 0 01 m in horizontal and vertical directions respectively the ln k field is generated by summing up 100 random periodic modes with the kraichnan algorithm presented in suciu 2019 appendix c 3 1 2 the diffusion coefficient is set to a constant value d 10 3 m day which is representative for soils and aquifers radu et al 2011 schneid 2000 suciu 2019 following illiano et al 2020 the nonlinear reaction term is specified as r c 10 3 c 1 c instead of using a fixed number of time steps as in the flow benchmark presented in section 5 1 now we fix the total time to t 3 days set the intermediate time controlling the drainage process to δ t d t 3 and keep the original time steps δ t which ensure the appropriate resolution for contrasting fast and slow processes in loam and clay soils respectively preliminary tests showed that in order to obtain an acceptable resolution of the velocity components in the benchmark setup the unbiased grw requires extremely fine discretizations with δ x o 10 5 therefore the transport step is solved with the bgrw algorithm for the mesh size δ x 0 05 suggested by the above investigations on numerical diffusion the velocity q ω on boundaries is approximated by forward finite differences the convergence of the flow and transport l schemes using grw algorithms requires relatively large linearization parameters l p l c 20 for loam soil and l p l c 100 for clay soil models these are two order of magnitude larger than for the decoupled flow benchmark presented in section 5 1 probably due to the increased complexity of the coupled problem by setting the tolerances of the convergence criterion 3 to ε a ε r 5 10 6 the convergence is achieved after about 2000 iterations for the loam soil and about 14000 iterations for the clay soil see figs 13 14 15 16 the results obtained by coupling the grw flow and bgrw transport solvers are presented in figs 17 18 19 20 21 22 23 24 25 26 the randomness of k s a t is especially felt by the pressure distribution in the more permeable loam soil fig 17 while in the clay soil the pressure remains almost stratified fig 18 the same contrast is shown by the water content with almost saturated loam soil fig 19 and partially stratified saturation in the clay soil fig 20 since the darcy velocity is proportional to the gradient of the random pressure the heterogeneity of the advective component of the transport process is mainly manifest in the final distribution of the concentration in the loam and clay soils compare figs 21 and fig 22 significant differences between the loan and clay soils are also illustrated by the spatial distribution of the velocity components figs 23 24 25 26 the results obtained with the grw bgrw flow and transport solvers are compared with those provided by a tpfa code using l p l c 1 for both soils and l c 2 l p the convergence is achieved in reasonable computing times of 263 s loam and 177 s clay only when using the anderson acceleration procedure anderson 1965 walker and ni 2011 both et al 2019 note that the grw times on the same computer are of the same order of magnitude 526 and 178 respectively without appealing to the acceleration procedure the errors for pressure water content and velocity components shown in table 10 are more or less similar to those for the flow benchmark problem given in table 6 the difference of one order of magnitude between the ε c values for the two soils can be traced back to the amount of numerical diffusion of the tpfa transport solver see table 9 the estimated mean péclet number for the loam soil pé 1 3 is much larger than the value pé 4 10 3 estimated for the clay soil and can partially explain the larger ε c value in the first case since the pressure equation is essentially an advection diffusion equation with velocity given by the derivatives of the coefficient k e g gotovac et al 2009 suciu 2020 the errors ε q x and e q z of order 10 1 also could be produced by numerical diffusion in the flow solver in the setup of the benchmark problems for both coupled flow and transport and decoupled flow we estimate a mean péclet number pé 0 9 for both loam and clay soil models for comparison in the one dimensional case with smaller ε q pé was about 0 03 in scenario 1 and 0 3 in scenario 2 since the flow and transport solvers implemented in mrst basically use the same tpfa finite volume method we may expect that the flow solver produces a numerical diffusion comparable to that of the transport solver shown in table 9 a one dimensional version of the benchmark problem for flow and surfactant transport can be readily obtained and solved with one dimensional grw algorithms suciu et al 2020 sect 5 2 4 even though the lateral heterogeneity of the two dimensional benchmark is ignored the main features are also revealed by the one dimensional drainage model the discrepancy between fast loam and slow clay flow and transport processes the same intervals of variation of the solutions and similar behavior on the vertical direction 6 two dimensional grw solutions for groundwater flow and transport at regional and field scales for saturated aquifers θ c o n s t eq 17 reduces to a linear equation solved by the steady state hydraulic head solution in h x y under time independent boundary conditions as noted in remark 3 the grw l scheme 18 20 becomes in this case a transient scheme for the linear flow equation in the following examples we consider flow problems formulated in two dimensional domains x y 0 l x 0 l y with dirichlet boundary conditions h 0 y h 1 and h l x y h 2 and no flow neumann conditions on top and bottom boundaries in the saturated flow regime the transport eq 22 is also linear and decoupled from the linear flow equation decoupled transport problems can be solved by either biased or unbiased grw algorithms see remark 5 and section 4 2 2 on the same lattice as that used to compute the flow velocity 6 1 flow in heterogeneous aquifers at regional scale for the beginning we follow the setup for regional scale used in franssen et al 2009 to compare approaches for inverse modeling of groundwater flow the domain and the boundary conditions are specified by l x 4900 m l y 5000 m h 1 0 m h 2 5 m the hydraulic conductivity k is a log normally distributed random field defined by the mean k 12 10 4 m s the correlation length λ 500 m and the variance σ 2 1 of the ln k field the k field is generated as in section 5 2 3 above by summing 100 random periodic modes with the kraichnan algorithm besides the exponential correlation considered in franssen et al 2009 we also investigate the behavior of the flow solution for gaussian correlation of the ln k field with the same correlation length as well as in case of the smaller variance σ 2 0 1 for both correlation models the two correlation models of the ln k field are of the form c r σ 2 exp r λ α where r r x 2 r y 2 1 2 is the spatial lag the exponent α 1 corresponds to the exponential model and α 2 to the gaussian one since the correlation functions depend on spatial variables through r λ the computation can be done for spatial dimensions scaled by λ that is fields of dimensionless correlation length λ 1 and a domain 0 l x λ 0 l y λ the results on the original grid are finally obtained after the multiplication by λ of the solution h x y and of the spatial coordinates the solutions h x y of the stationary eq 17 corresponding to θ c o n s t for given realizations of the k field with σ 2 0 1 are obtained under the initial condition h 0 x y which is the plane defined by the dirichlet boundary conditions h 0 y 0 and h l x λ y h 2 λ with space steps set to δ x δ y 0 2 m the steady state is reached after about 4 10 5 iterations of the grw solver the relative errors of the solution h obtained with the scaled geometry with respect to the solution of the unscaled problem are of the order 10 14 that is close to the machine precision suciu et al 2020 sect 6 1 to estimate the order of convergence of the grw scheme for this particular flow problem we use manufactured analytical solutions provided in the git repository https github com pmflow flowbenchmark and similarly to estimations performed in section 5 1 we compute the eoc according to 36 by successively halving the space steps from δ x δ y 2 10 1 up to δ x δ y 2 5 10 2 we note that the eoc approach presented here differers somewhat from that used in alecsa et al 2019 suciu 2020 the reference solution is now the manufactured solution instead of the solution on the finest grid and the error norm is no longer computed after the first iteration but after large numbers of iterations from 10 5 to more than 10 7 when the grw solution approaches the stationarity due to the limited number of iterations the solutions are not yet strictly stationary and the order of convergence may be not accurately estimated in some cases therefore we also use a tpfa flow solver to compute eoc values for the same scenarios the results presented in tables 11 and 12 show significant differences between the two correlation models for gaussian correlation the errors obtained with the two approaches are relatively small in all cases instead for exponential correlation despite the strong eoc obtained after the first two refinements the errors are extremely large for σ 2 1 and become smaller than one only for σ 2 0 1 after the second refinement of the grid these results are consistent with those presented in alecsa et al 2019 where similar benchmark problems were solved for a larger range of parameters of the ln k field 6 2 flow in conditions of random recharge we consider in the following a flow problem formulated for the same geometry and boundary conditions as in the previous subsection which has been used in pasetto et al 2011 to design a new monte carlo approach for flow driven by spatially distributed stochastic sources now the hydraulic conductivity is constant k 12 10 4 m s and the groundwater recharge is described by a source term f in eq 17 modeled as a random space function of mean f 362 912 mm year log normally distributed with exponential correlation specified by different correlation lengths and variances of the ln f field among different scenarios presented inpasetto et al 2011 we consider for comparison with the present computations only the case λ 500 m and the variance σ 2 1 as in the previous subsection we use the setup for the problem s geometry scaled by λ for which the random recharge problem with σ 2 1 is solved with relative errors of the order 10 15 suciu et al 2020 sect 6 2 in a first validation test we compare the grw and tpfa solutions of the random recharge problem on the computational domain scaled by λ 500 m for single realizations of the random recharge with both exponential and gaussian correlation of the ln f field and two variances σ 2 0 1 and σ 2 1 the absolute and relative differences ε a h g r w h t p f a and ε r h g r w h t p f a h t p f a presented in table 13 indicate a good agreement between the two approaches further we perform statistical inferences of the mean and variance obtained from an ensemble of 100 monte carlo simulations within the setup of pasetto et al 2011 for random recharge term with exponential correlation and variance σ 2 1 the mean and the variance of the hydraulic head h are computed as averages over realizations of the ln f field followed by spatial averages with standard deviation estimated by spatial averaging the results presented in table 14 show again that the grw and tpfa results are in good statistical agreement finally we compare the mean and the variance estimated at the center of the computational domain by grw and tpfa simulations with the results presented in pasetto et al 2011 as seen in table 15 the mean values compare quite well but both the grw and tpfa approaches overestimate the variance computed for the same parameters in pasetto et al 2011 fig 6 this discrepancy can be attributed either to the large errors expected for exponential correlation model see tables 11 and 12 or to the statistical inhomogeneity of the monte carlo ensemble of 100 realizations indicated by the large standard deviations shown in table 14 6 3 flow and advection dispersion transport in aquifers in the following we consider an incompressible flow in the domain 0 20 0 10 driven by dirichlet boundary conditions h 0 y 1 and h 20 y 0 and zero neumann conditions on top and bottom boundaries the hydraulic conductivity is a random space function with mean k 15 m day with gaussian correlation of the ln k field correlation length λ 1 m and variance σ 2 0 1 generated by summing 10 random modes with the kraichnan algorithm an ensemble of velocity fields corresponding to 100 realizations of the k field is obtained with the flow solver used in section 6 1 for the resolution of the grw lattice defined by space steps δ x δ y 0 1 further monte carlo simulations of advection diffusion are carried out using the velocity realizations and the isotropic local dispersion coefficient d 0 01 m 2 day the linear transport equation obtained by setting θ c o n s t in eq 22 is solved with the unbiased grw algorithm described in section 4 2 2 by using n 10 24 particles to represent the concentration the final time t 10 days is chosen such that the support of the concentration does not reach the boundaries during the simulation hence the monte carlo inferences can be compared with results of linear theory which provides first order approximations of dispersion coefficients for small variances σ 2 bellin et al 1992 in turn such linear approximations are accurately retrieved by averaging over ensembles of particle tracking simulations of diffusion in realizations of velocity fields approximated to the first order in σ 2 by a kraichnan procedure schwarze et al 2001 following this approach to infer dispersion coefficients in linear approximation we use an ensemble of 10 4 realizations of krainchan velocity fields computed with 100 random modes by the algorithm described in suciu 2019 appendix c 3 2 2 and the unbiased grw solver with n 10 24 particles in each realization longitudinal and transverse ensemble dispersion coefficients d x and d y are computed as half the slope of the ensemble average of the second spatial moments of the concentration distribution centered at the ensemble average center of mass bellin et al 1992 radu et al 2011 schwarze et al 2001 the results presented in fig 27 show a that in spite of relatively small ensemble of velocity realizations the ensemble dispersion coefficients obtained with the 100 grw solutions of the full flow problem are quite close to the reference linear results the computation of the velocity realizations with the transient grw flow solver requires 10 4 to 10 5 iterations to fulfill the convergence criterion 3 with tolerances ε a ε r 5 10 7 and about 160 s per realization for the chosen discretization δ x δ y 0 1 the unbiased grw transport solver requires according to 31 a relatively rough time discretization of δ t 0 5 this leads to a total computation time of about 1 4 s for the estimation of the dispersion coefficients by averaging over the 100 realizations of the statistical ensemble by comparison the tpfa codes needs about 3 8 s to compute a velocity realization and about 13 s for a single transport realization by using the same spatial resolution and a time step δ t 0 05 but the tpfa estimates of the dispersion coefficients deviate by more than one order of magnitude from the linear reference solution since reducing the spatial steps and the local pé to reduce the numerical diffusion dramatically increases the computational burden for the tpfa codes we solved a rescaled problem so to preserve the mean and the spatial variability of the velocity field we chose a smaller domain 0 2 0 1 correlation length of the ln k field λ 0 1 and a new dirichlet condition h 0 y 0 1 now the tpfa codes require about 60 s to compute one flow realization and about 3 h for a transport realization with δ x δ y 0 001 and δ t 0 0005 the computation times for the grw codes to solve the rescaled problem by using δ x δ y 0 01 and δ t 0 07 are practically unchanged figure 28 shows that the grw estimations of the dispersion coefficients are again close to the linear approximation instead the tpfa results overestimate the linear approximation by 10 to 20 the deviations of the tpfa coefficients shown in fig 28 are comparable with the numerical diffusion estimated for constant velocity in case of the longitudinal coefficient d x but two orders of magnitude larger for the transverse coefficient d y suciu et al 2020 table 17 7 conclusions the grw schemes for simulating flow in either unsaturated or saturated porous media are equivalent to finite difference schemes in their deterministic implementation or for sufficiently large numbers of particles in randomized implementations the same in case of bgrw solver for transport problems instead the unbiased grw is a superposition of euler schemes for itô equation suciu 2019 which is no longer equivalent with a finite difference scheme unless the coefficients of the transport equation are constant in simulations of reactive transport grw algorithms can use huge numbers of computational particles even as large as the number of molecules involved in reactions allowing simple and intuitive representations of the process while unbiased grw algorithms are mainly efficient in obtaining fast solutions for large scale transport in aquifers bgrw solvers are appropriate for computing solutions of fully coupled flow and transport problems in soil systems with fine variation of the parameters the algorithms are implemented as iterative l schemes which linearize the richards equation and describe the transition from unsaturated to saturated regime the grw bgrw solutions are first order accurate in time and second order accurate in space for saturated regimes the flow solver becomes a transient scheme solving steady state flows in aquifers since the grw algorithms are explicit schemes which do not need to solve systems of algebraic equations they are simpler and in some cases faster than finite element volume schemes the grw l schemes for non steady coupled problems for flow and transport in soils as well as for transport simulations in saturated aquifers are indeed much faster than the tpfa codes used as reference in this study however the flow solutions for saturated porous media in large domains e g field or regional scale require much larger computing time than classical numerical schemes due to the large number of iterations needed to achieve the convergence of the transitory scheme used to compute steady state solutions see also a detailed analysis in alecsa et al 2019 the obvious advantage of the grw schemes is that they are practically free of numerical diffusion this is demonstrated by the results for decoupled transport presented in table 9 but as shown by the discussion at the end of section 5 2 3 the flow solvers also can be affected by numerical diffusion which is difficult to isolate from other errors occurring in coupled flow and transport problems such errors are avoided by grw algorithms which prevent the occurrence of the numerical diffusion by using consistent definitions of the jump probabilities as functions of the coefficients of the flow and transport equations credit authorship contribution statement nicolae suciu conceptualization methodology software writing original draft supervision davide illiano methodology software writing review editing alexander prechtel methodology software writing review editing florin a radu conceptualization writing review editing supervision declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgements the authors are grateful to dr emil cătinaş for fruitful discussions on convergent sequences and successive approximation approaches nicolae suciu acknowledges the financial support of the deutsche forschungsgemeinschaft dfg german research foundation under grant su 415 4 1 405338726 integrated global random walk model for reactive transport in groundwater adapted to measurement spatio temporal scales vista a collaboration between the norwegian academy of science and letters and equinor funded the research of davide illiano project number 6367 project name adaptive model and solver simulation of enhanced oil recovery 
311,in this article we present new random walk methods to solve flow and transport problems in saturated unsaturated porous media including coupled flow and transport processes in soils heterogeneous systems modeled through random hydraulic conductivity and recharge fields processes at the field and regional scales the numerical schemes are based on global random walk algorithms grw which approximate the solution by moving large numbers of computational particles on regular lattices according to specific random walk rules to cope with the nonlinearity and the degeneracy of the richards equation and of the coupled system we implemented the grw algorithms by employing linearization techniques similar to the l scheme developed in finite element volume approaches the resulting grw l schemes converge with the number of iterations and provide numerical solutions that are first order accurate in time and second order in space a remarkable property of the flow and transport grw solutions is that they are practically free of numerical diffusion the grw solvers are validated by comparisons with mixed finite element and finite volume solvers in one and two dimensional benchmark problems they include richards equation fully coupled with the advection diffusion reaction equation and capture the transition from unsaturated to saturated flow regimes keywords richards equation coupled flow and transport linearization iterative schemes global random walk msc 76s05 65n12 86a05 65c35 76r50 1 introduction the accuracy and the robustness of the numerical schemes is the primary requirement for reliable and meaningful results of the current efforts to improve the understanding of the complexity and interdependence of the flow and transport processes in subsurface hydrology through numerical investigations numerical solvers for partial differential equations modeling individual or coupled processes are often used as basic elements in the formulation of the more complex problems of practical interest such as parameter identification franssen et al 2009 hydraulic tomography bellin et al 2020 monte carlo approaches for systems with randomly distributed parameters pasetto et al 2011 or upscaling for mutiphase flows in heterogeneous subsurface formations hajibeygi et al 2020 among others a central issue in subsurface hydrology is the need of robust and computationally efficient numerical models for partially saturated soil groundwater systems the transition between unsaturated and saturated zones is particularly challenging in unsaturated flows the water content θ and the hydraulic conductivity k depend nonlinearly on the pressure head ψ through material laws based on experiments as far as ψ 0 the evolution of ψ is governed by the parabolic richards equation which degenerates to a generally linear elliptic equation i e the equation for steady state flow in aquifers if ψ 0 alt and luckhaus 1983 since the regions where degeneracy takes place depend on the evolution of the pressure ψ in time and space they are not known a priori to cope with the nonlinearity and degeneracy of the richards equation different linearization methods are needed such as the newton scheme schneid 2000 hajibeygi et al 2020 knabner and angermann 2003 which is second order convergent but converges only locally requires a starting point close enough to the solution or the more robust but only first order convergent picard modified picard or l schemes slodicka 2002 pop et al 2004 list and radu 2016 radu et al 2018 explicit and implicit schemes proposed for nonlinear flows in unsaturated regime provide solutions with comparable accuracy but are generally ambiguous to compare in terms of computing time since they do not need to solve systems of linear algebraic equations at every time step explicit schemes are in principle faster liu et al 2020 but their speed may be seriously affected by the need to use very small time steps haverkamp et al 1977 caviedes voullième et al 2013 alecsa et al 2019 the time step in explicit schemes is constraint by stability conditions strikwerda 2004 liu et al 2020 caviedes voullième et al 2013 and has to be significantly reduced to ensure small local péclet number pé defined with respect to the space step large global pé characterizes advection dominated transport problems bause and knabner 2004 kuzmin 2009 in such cases reducing the local pé is a remedy to avoid the numerical diffusion and the oscillatory behavior of the solution radu et al 2011 the criterion of small local pé is also recommended for numerical schemes solving the pressure equation in saturated flows gotovac et al 2009 and since richards equation has the structure of the advection diffusion equation the recommendation holds for the unsaturated flows as well well known approaches to avoid the numerical diffusion are the particle tracking in continuous space and the discrete random walk on lattices suciu 2019 the accuracy of these schemes is determined by the number of computational particles undergoing random jumps in continuous space or on discrete lattices in random walk schemes the increase of the computation time with the number of particles is simply avoided by randomly distributing the particles along the spatial directions with a global procedure according to appropriate jump probabilities in this way one obtains a global random walk grw which performs the spreading of all the particles from a given site with computational costs that are practically the same as for generating the jump of a single random walker in sequential procedures vamoş et al 2003 in particular cases e g when using biased jump probabilities to account for variable coefficients or for advective displacements the grw algorithms are equivalent to explicit finite difference schemes with time step size constrained by stability requirements in unbiased grw schemes for transport problems with variable coefficients which still satisfy stability conditions no restrictions on the time step are needed to reduce the local pé number which renders the approach particularly efficient in large scale simulations of transport in groundwater see suciu 2019 for details and examples the elliptic and parabolic equations governing the pressure head for flows in unsaturated saturated porous media are essentially diffusion equations with second order operator in stratonovich form they can be recast as fokker planck equations with drift augmented by the row derivative of the coefficient tensor and further solved by random walk approaches suciu 2019 an alternative approach starts with a staggered finite difference scheme further used to derive biased random walk rules governing the movement on a regular lattice of a system of computational particles the particle density at lattice sites provides a numerical approximation of the pressure head solution this approach has been already illustrated for flows in saturated porous media with heterogeneous hydraulic conductivity alecsa et al 2019 suciu 2020 in this article we present new grw schemes for nonlinear and non steady flows in soils which model the transition from unsaturated to saturated regime in a way consistent with the continuity of the constitutive relationships θ ψ and k ψ following list and radu 2016 radu et al 2018 the nonlinearity of the richards equation is solved with an iterative procedure similar to the l scheme used in finite element volume approaches numerical tests demonstrate the convergence of the l scheme for unsaturated saturated flows for fully saturated flow regime with constant water content θ and time independent boundary conditions the grw l scheme is equivalent to a transient finite difference scheme coupled flow and reactive transport problems for partially saturated soils rise new stability and consistency issues and demand augmented computational resources our grw approach in this case consists of coupling the flow solver described above with existing grw transport solvers suciu 2019 adapted for nonlinear problems which are implemented as l schemes as well the flow and transport solvers are coupled via an alternating splitting procedure illiano et al 2020 which successively iterates the corresponding l schemes until the convergence of the pressure head and concentration solutions is reached within the same tolerance at every time step code verification tests using analytical manufactured solutions are employed to verify the convergence of the iterations and the accuracy of the splitting scheme the grw scheme for one dimensional solutions of the richards equation which captures the transition from unsaturated to saturated flow regimes is validated by comparisons with solutions provided by richy software based on the mixed finite element method mfem with backward euler discretization in time and newton linearization developed at the mathematics department of the friedrich alexander university of erlangen nürnberg schneid et al 2000 schneid 2000 for the particular case of unsaturated flows the one dimensional grw solutions are also tested by comparisons with experimental data zadeh 2011 zambra et al 2012 and exact solutions published in the literature warrick et al 1985 watson et al 1995 the two dimensional grw solutions are compared on benchmark problems with two point flux approximation tpfa finite volume solvers using backward euler discretization in time and l scheme linearization illiano et al 2020 the tpfa codes are implemented in mrst the matlab reservoir simulation toolbox lie 2019 the paper is organized as follows section 2 presents the grw algorithm and the linearization approach for one dimensional flow problems the one dimensional solver is further validated through comparisons with mfem solutions experimental data and exact analytical solutions in section 3 two dimensional grw algorithms for fully coupled and decoupled flow and transport problems are introduced in section 4 code verification tests and comparisons with tpfa solutions for benchmark problems are presented in section 5 some examples of flow and transport solutions for groundwater problems at the field and regional scale are presented in section 6 the main conclusions of this work are finally presented in section 7 grw codes implemented in matlab for model problems considered in this article are stored in the git repository richardsequation suciu et al 2021 2 one dimensional grw algorithm for unsaturated saturated flow in soils we consider the water flow in unsaturated saturated porous media described by the one dimensional richards equation haverkamp et al 1977 schneid et al 2000 knabner and angermann 2003 in the space time domain 0 l z 0 t 1 θ ψ t z k θ ψ z ψ z 0 where ψ z t is the pressure head expressed in length units θ is the volumetric water content k stands for the hydraulic conductivity of the medium and z is the height oriented positively upward according to 1 the water flux given by darcy s law is q k θ ψ z ψ z to design a grw algorithm we start with the staggered finite difference scheme with backward discretization in time which approximates the solution of eq 1 at positions z i δ z i 1 i i l z δ z and time points t k δ t k 1 t δ t according to 2 θ ψ i k θ ψ i k 1 δ t δ z 2 k ψ i 1 2 k ψ i 1 k ψ i k k ψ i 1 2 k ψ i k ψ i 1 k k ψ i 1 2 k k ψ i 1 2 k δ z to cope with the double nonlinearity due to the dependencies k θ and θ ψ we propose an explicit scheme similar to the linearization approach known as l scheme originally developed for implicit methods e g pop et al 2004 list and radu 2016 radu et al 2018 the approach consists of the addition of a stabilization term l ψ i k s 1 ψ i k s l c o n s t in the left hand side of 2 and of performing successive iterations s 1 2 of the modified scheme until the discrete l 2 norm of the solution ψ k s ψ i k s ψ i k s verifies 3 ψ k s ψ k s 1 ε a ε r ψ k s for some given tolerances ε a and ε r the adapted l scheme reads 4 ψ i k s 1 1 r i 1 2 k s r i 1 2 k s ψ i k s r i 1 2 k s ψ i 1 k s r i 1 2 k s ψ i 1 k s r i 1 2 k s r i 1 2 k s δ z θ ψ i k s θ ψ i k 1 l where 5 r i 1 2 k s k ψ i 1 2 k s δ t l δ z 2 for fixed time step k the iterations start with the solution after the last iteration at the previous time k 1 ψ i k 1 ψ i k 1 i 1 i note that unlike implicit l schemes e g slodicka 2002 pop et al 2004 list and radu 2016 the explicit scheme 4 uses forward increments of ψ in this way the solution ψ i k s 1 is obtained from values of ψ and r evaluated at the previous iteration without solving systems of algebraic equations the solution ψ i k s is further represented by the distribution of n computational particles at the sites of the one dimensional lattice ψ i k s n i k s a n with a being a constant equal to a unit length and the l scheme 4 becomes 6 n i k s 1 1 r i 1 2 k s r i 1 2 k s n i k s r i 1 2 k s n i 1 k s r i 1 2 k s n i 1 k s n f s where the source term is defined as f s r i 1 2 k s r i 1 2 k s δ z θ n i k s θ n i k 1 l and denotes the floor function the physical dimension of the parameter l of the scheme is that of an inverse length unit to ensure that r i 1 2 k s defined by 5 are non dimensional parameters as needed in random walk approaches vamoş et al 2003 suciu 2019 by imposing the constraint r i 1 2 k s 1 2 the parameters r i 1 2 k s can be thought of as biased jump probabilities hence the contributions to n i k s 1 from neighboring sites i 1 summed up in 6 can be obtained with the grw algorithm which moves particles from sites j to neighboring sites i j 1 according to the rule 7 n j k s δ n j j k s δ n j 1 j k s δ n j 1 j k s for consistency with 6 the quantities δ n s in 7 have to satisfy in the mean suciu 2019 sect 3 3 4 1 8 δ n j j k s 1 r j 1 2 k s r j 1 2 k s n j k s δ n j 1 2 j k s r j 1 2 k s n j k s the quantities δ n s are binomial random variables approximated by using the unaveraged relations 8 for the mean summing up the reminders of multiplication by r and of the floor function n f s δ t and allocating one particle to the lattice site where the sum reaches the unity remark 1 the finite difference l scheme 4 and the derived grw relation 6 are explicit iterative schemes for richards equation in mixed form 1 the essential difference of the l schemes from explicit schemes in mixed formulation designed for unsaturated regime haverkamp et al 1977 caviedes voullième et al 2013 liu et al 2020 is that they apply to both unsaturated and saturated flow conditions remark 2 consider the saturated regime θ c o n s t with space variable hydraulic conductivity k and a given source term f with the parameter l set to l 1 a after disregarding the time index k the scheme 6 solves the following equation for the hydraulic head h ψ z 9 1 a h s z k h z f for boundary conditions independent of s the solution of eq 9 approaches a steady state regime corresponding to the saturated flow see also alecsa et al 2019 suciu 2020 the modified grw scheme 6 is equivalent to a convergent finite difference scheme first order accurate in time and second order in space suciu et al 2020 remark 1 3 validation of the one dimensional grw flow algorithm 3 1 transition from unsaturated to saturated flow regime the one dimensional algorithm for flow in unsaturated saturated soils is validated in the following by comparisons with mfem solutions obtained with the richy software schneid et al 2000 schneid 2000 for this purpose we solve one dimensional model problems for the vertical infiltration of the water through both homogeneous and non homogeneous soil columns srivastava and yeh 1991 previously used in schneid 2000 to assess the accuracy and the convergence of the mfem solutions we consider the domain z 0 2 and the boundary conditions specified by a constant pressure ψ 0 t ψ 0 at the bottom of the soil column and a constant water flux q 0 at the top together these constant conditions determine the initial pressure distribution ψ z 0 as solution of the steady state flow problem for t 0 the pressure ψ 0 is kept constant at the bottom and the water flux at the top of the column is increased linearly from q 0 to q 1 until t t 1 and is kept constant for t t 1 for the unsaturated regions ψ 0 we consider the constitutive relationships given by the simple exponential model gardner 1958 10 θ ψ θ r e s θ s a t θ r e s e α ψ 11 k θ ψ k s a t θ ψ θ r e s θ s a t θ r e s where θ θ s a t and k k s a t denote the constant water content respectively the constant hydraulic conductivity in the saturated regions ψ 0 and θ r e s is the residual water content the flow problem for eq 1 with the parameterization 10 11 is solved in two scenarios 1 homogeneous soil with k s a t 2 77 10 6 θ r e s 0 06 θ s a t 0 36 α 10 q 0 2 77 10 7 q 1 2 50 10 6 which are representative for a sandy soil and 2 non homogeneous soil with the same parameters as in scenario 1 except the saturated hydraulic conductivity which takes two constant values k s a t 2 77 10 6 for z 1 and 500 k s a t for z 1 modeling for instance a column filled with sand and gravel to capture the transition from unsaturated to saturated regime the pressure at the bottom boundary is fixed at ψ 0 0 5 for the parameters of the one dimensional flow problems solved in this section we consider meters as length units and seconds as time units the simulations are conducted up to t 10 4 about 2 78 h and the intermediate time is taken as t 1 t 10 2 we consider a uniform grw lattice with δ z 10 2 equal to the length of the linear elements in the mfem solver the grw computations are initialized by multiplying the initial condition by n 10 24 particles since as shown by 11 the hydraulic conductivity varies in time the length of the time step determined by 5 for the maximum of k at every time iteration and by specifying a maximum r m a x 0 8 of the parameter r i 1 2 k may vary in time see fig 1 the parameter of the regularization term in the l scheme is set to l 1 for the computation of the initial condition solution of the stationary problem i e for θ t 0 in 1 and to l 2 for the solution of the non stationary problem in both cases the convergence criterion 3 is verified by choosing ε a 0 and a relative tolerance ε r 10 9 the comparison with the mfem solutions presented in figs 2 3 4 shows a quite good accuracy of the grw solutions for pressure water content and water flux the relative errors computed with the aid of the l 2 norms by ε ψ ψ g r w ψ m f e m ψ m f e m and similarly for θ and q are presented in table 1 the l scheme converges with speeds depending on the problem to solve the problem for the initial condition one needs 3 5 10 4 iterations in scenario 1 and 6 5 10 6 iterations in scenario 2 instead to solve the non stationary problem for a final time t 10 4 one needs about 70 iterations in scenario 1 and about 700 iterations in scenario 2 see figs 5 and 6 the convergence of the iterative grw l scheme can be further investigated through assessments of the computational order of convergence of the sequence of successive correction norms ψ k s ψ k s 1 cătinaş 2019 cătinaş 2020 estimations provided in suciu et al 2020 appendix a indicate a linear convergence for scenario 1 but only a power law convergence s 1 which is slower than the linear convergence cătinaş 2020 for scenario 2 supplementary tests done in scenario 1 indicate the existence of a lower bound of the constant l which ensures the convergence suciu et al 2020 sect 3 1 it is found that increasing l above the value which ensures the convergence of the grw l scheme with a desired accuracy only results in increasing number of iterations and more computing time the parameter l has to be established experimentally by checking the convergence and as highlighted by the examples presented in section 5 below it depends on the complexity of the problem to be solved 3 2 comparison with experiments and exact solutions for unsaturated flows an experiment consisting of free drainage in a 600 cm deep lysimeter filled with a material with silty sand texture conducted at the los alamos national laboratory abeele 1984 is often used to validate one dimensional schemes for unsaturated flows see e g zadeh 2011 zambra et al 2012 caviedes voullième et al 2013 this example is provided with the hydrus 1d software simunek et al 2008 which is also used for validation purposes in the papers cited above the relationships defining the water content θ ψ and the hydraulic conductivity k θ ψ are given by the van genuchten mualem model 12 θ ψ 1 α ψ n m ψ 0 1 ψ 0 13 k θ ψ k s a t θ ψ 1 2 1 1 θ ψ 1 m m 2 ψ 0 k s a t ψ 0 where θ r e s θ s a t and k s a t represent the same parameters as for the exponential model considered in section 3 1 θ θ θ r e s θ s a t θ r e s is the normalized water content and α n and m 1 1 n are model parameters depending on the soil type with the parameters given in the hydrus 1d example θ r e s 0 0 θ s a t 0 331 k s a t 25 cm d α 0 0143 cm 1 n 1 5 for initial and boundary conditions for free drainage given by ψ z 0 0 cm and q 0 t 0 cm d zadeh 2011 the solutions provided by the grw l scheme 6 8 for simulation times from 1 d to 100 d are obtained with stabilization parameter l 0 5 after a number of 9 to 35 iterations tolerance specified by ε a ε r 5 10 6 in 3 the spatial resolution is set to δ z 10 cm while the time step varies slightly between 10 2 d and 3 16 10 2 d according to 5 the results are compared in figs 7 and 8 with hydrus 1d results and experimental data the water content profiles fig 7 are quite close to measurements and similar to those presented in zambra et al 2012 caviedes voullième et al 2013 the pressure profiles fig 8 deviate from experiment mainly for t 1 d and t 100 d with approximately the same amount as in caviedes voullième et al 2013 fig 12 an improved prediction of the pressure profiles is obtained in zadeh 2011 with slightly modified parameters of the van genuchten mualem model but with the price of larger deviations for the water content the θ based form of richards equation has shown significantly improved performance in numerical schemes for unsaturated flows in spatially homogeneous soils e g constant k s a t especially in modeling infiltration into dry media zadeh 2011 and is well suited to analytical approaches philip 1969 warrick et al 1985 sander et al 1988 philip philip 1969 derived an exact solution for infiltration problems expressed in the form z θ t that is the depth where the water content takes specified values at given time points t philip s solution has been used in warrick et al 1985 to construct a table of coefficients which allow the computation of z θ t for three different θ and arbitrary t the solution verifies the dimensionless form the θ based richards equation 14 θ t z d θ z θ d k θ d θ θ z where z is positive downward d θ k θ d ψ d θ and k θ is given according to the van genuchten mualem model by the upper branch of 13 such analytical solutions have been used in phoon et al 2007 caviedes voullième et al 2013 to verify various one dimensional numerical schemes based on finite volume and finite element approaches in order to test the grw l scheme 6 8 we solve the same infiltration problem soil column 100 cm deep constant unsaturated initial water content θ i and infiltration imposed by ψ 0 on the upper boundary we use a van genuchten mualem parameter n 1 5 together with the parameters of the hypothetical loam soil used in warrick et al 1985 k s a t 6 10 4 cm s θ s a t 0 45 θ r e s 0 1 θ i 0 17 α 0 01 cm 1 the pressure corresponding to the initial water content is obtained by 12 ψ θ i 24 87 cm the computations are carried out with δ z 1 cm δ t between 9 26 10 4 h and 5 23 10 4 h l 0 2 and the convergence is achieved after a number of 15 to 160 iterations ε a ε r 5 10 6 the analytical solutions z θ t for θ 0 24 0 31 and 0 38 at successive times between 0 5 h and 2 h are obtained with the coefficients for n 1 5 and θ θ i 0 2 given in warrick et al 1985 table 3 the grw results z θ t for the same θ and t are obtained by linear interpolation of the numerical solution θ z t relative errors z z z of the numerical solution z θ t with respect to the analytical solution z θ t are shown in table 2 an exact solution for constant flux infiltration with dry initial condition θ z 0 0 has been derived in sander et al 1988 and further used to verify the numerical solution provided by a pressure formulation of the richards equation watson et al 1995 the solution solves eq 14 with coefficient given by fujita s model fujita 1952 d θ d 0 1 v θ 2 where d 0 and v are positive constants since θ z 0 0 implies ψ θ z 0 as initial condition for the numerical scheme in pressure formulation the singularity was avoided in watson et al 1995 by considering θ z 0 3 4483 10 6 as a numerical simulation parameter as for the grw scheme 6 8 we would have k θ z 0 0 and according to 5 the condition r i 1 2 k s 1 2 implies δ t for finite δ z using the same initial ψ as in watson et al 1995 requires a very fine discretization which would slow down considerably the computation therefore we opt for the direct approach of solving 14 as a diffusion equation with drift coefficient defined by v θ d k θ d θ the latter will be computed analytically from the parameterization k θ used in watson et al 1995 proceeding as in section 2 we start with a forward time centered space finite difference discretization of eq 14 θ i k 1 θ i k 1 δ t δ z 2 d θ i 1 2 k θ i 1 k θ i k d θ i 1 2 k θ i k θ i 1 k δ t 2 δ z v i k θ i 1 k θ i 1 k we approximate the solution by a distribution of n particles on a regular lattice θ i k n i k n and end up with 15 n i k 1 1 r i 1 2 k r i 1 2 k n i k 1 2 r i 1 2 k v i k n i 1 k 1 2 r i 1 2 k v i k n i 1 k the dimensionless parameters in eq 15 are given by r i 1 2 k 2 δ t δ z 2 d i 1 2 k v i k δ t δ z r i 1 2 k 1 v i k r i 1 2 k eq 15 sums up contributions of random walkers jumping on the lattice according to the rule 16 n j k δ n j j k δ n j 1 j k δ n j 1 j k which defines a biased global random walk algorithm bgrw suciu 2019 sect 3 3 3 the numbers of particles δ n in 16 are binomial random variables determined by the same procedure as in section 2 and their ensemble averages verify δ n j j k 1 r i 1 2 k r i 1 2 k n i k δ n j 1 j k 1 2 r i 1 k v i k n i k following watson et al 1995 we set on the top boundary the constant flux condition q q θ s a t θ r e s 0 2759 cm min with θ s a t 0 35 θ r e s 0 06 and consider the constant parameters d 0 2 75862 cm 2 min and v 0 85 of the fujita s model the bgrw results for the final time t 0 3625 min obtained with δ z 10 2 cm and δ t between 1 51 10 5 min and 1 23 10 5 min are compared in table 3 with the analytical solution presented in watson et al 1995 table 1 the tests for unsaturated one dimensional flows presented above are completed in suciu et al 2020 sect 5 2 4 by convergence investigations and estimations of convergence order of the grw algorithms for fully coupled nonlinear flow and transport problems for saturated unsaturated porous systems 4 two dimensional grw solutions 4 1 two dimensional grw algorithm for flow in soils and aquifers in two spatial dimensions the pressure head ψ x z t satisfies the equation 17 t θ ψ k θ ψ ψ z 0 the two dimensional grw algorithm on regular staggered grids δ x δ z which approximates the solution of 17 by computational particles ψ n a n is constructed similarly to 6 8 the solution at iteration s 1 is obtained by gathering particles from neighboring sites according to 18 n i j k s 1 1 r i 1 2 j k s r i 1 2 j k s r i j 1 2 k s r i j 1 2 k s n i j k s r i 1 2 j k s n i 1 j k r i 1 2 j k s n i 1 j k r i j 1 2 k s n i j 1 k r i j 1 2 k s n i j 1 k n f s where the source term is defined as f s r i j 1 2 k s r i j 1 2 k s δ z θ n i j k s θ n i j k 1 l the two dimensional grw rule which at time k moves particles from sites l m to neighboring sites l 1 m 1 reads as follows 19 n l m k s δ n l m l m k s δ n l 1 m l m k s δ n l 1 m l m k s δ n l m 1 l m k s δ n l m 1 l m k s for consistency with 18 the numbers of particles δ n s verify in the mean 20 δ n l m l m k s 1 r l 1 2 m k s r l 1 2 m k s r l m 1 2 k s r l m 1 2 k s n l m k s δ n l 1 m l m k s r l 1 2 m k s n l m k s δ n l m 1 l m k s r l m 1 2 k s n l m k s the parameters r l 1 2 m k s and r l m 1 2 k s defined by relations similar to 5 are dimensionless positive real numbers they represent biased jump probabilities on the four allowed spatial directions of the grw lattice and are constraint by the first relation 20 such that their sum be less or equal to one a sufficient condition would be that each of them verifies r 1 4 the binomial random variables variables δ n are approximated in the same way as in the one dimensional case by giving up the particle indivisibility one obtains deterministic grw algorithms which represent the solution n by real numbers and use the unaveraged relations 20 for the computation of the δ n terms in the following we use this deterministic implementation of the grw algorithm to compute flow solutions for unsaturated saturated porous media remark 3 after disregarding the index k and letting l 1 a θ c o n s t the algorithm 18 20 becomes a transient scheme to solve the equation governing flows in saturated porous media alecsa et al 2019 suciu 2020 see also remark 2 4 2 grw algorithms for two dimensional fully coupled flow and surfactant transport let the pressure ψ x z t and the concentration c x z t solve the equations of the following model of fully coupled flow and surfactant transport in unsaturated saturated porous media knabner et al 2003 illiano et al 2020 21 t θ ψ c k θ ψ c ψ z 0 22 t θ ψ c c d c q c r c where q k θ ψ c ψ z is the water flux darcy velocity and r c is a nonlinear reaction term equations 21 22 are coupled in both directions through the nonlinear functions θ ψ c and θ ψ c c the pressure eq 21 is solved with the grw l scheme described in the previous subsection with a slight modification due to the dependence of θ on both ψ and c new algorithms are needed instead to solve the coupled nonlinear transport eq 22 4 2 1 biased grw algorithm for transport problems to derive a grw algorithm for the transport equation we start with a backward time central space finite difference scheme for eq 22 considering a diagonal diffusion tensor with constant components d 1 and d 2 and denoting by u and v the components of the darcy velocity along the horizontal axis x and the vertical axis z by δ t the time step and by δ x and δ z the spatial steps the scheme reads as 23 θ ψ i j k c i j k c i j k θ ψ i j k 1 c i j k 1 c i j k 1 δ t 2 δ x u i 1 j k c i 1 j k u i 1 j k c i 1 j k δ t 2 δ z v i j 1 k c i j 1 k v i j 1 k c i j 1 k d 1 δ t δ x 2 c i 1 j k 2 c i j k c i 1 j k d 2 δ t δ z 2 c i j 1 k 2 c i j k c i j 1 k r c i j k δ t 2 d 1 δ t δ x 2 2 d 2 δ t δ z 2 c i j k d 1 δ t δ x 2 δ t 2 δ x u i 1 j k c i 1 j k d 1 δ t δ x 2 δ t 2 δ x u i 1 j k c i 1 j k d 2 δ t δ z 2 δ t 2 δ z v i j 1 k c i j 1 k d 2 δ t δ z 2 δ t 2 δ z v i j 1 k c i j 1 k r c i j k δ t next similarly to the scheme for the flow equation we add a regularization term l c i j k s 1 c i j k s in eq 23 define the dimensional parameters 24 r x 2 d 1 δ t l δ x 2 r z 2 d 2 δ t l δ z 2 u i 1 j k s δ t l δ x u i 1 j k s v i j 1 k s δ t l δ z v i j 1 k s approximate the concentration by the density of the number of computational particles c i j k s n i j k s n and finally we obtain 25 n i j k s 1 1 r x r z n i j k s 1 2 r x u i 1 j k s n i 1 j k s 1 2 r x u i 1 j k s n i 1 j k s 1 2 r z v i j 1 k s n i j 1 k s 1 2 r z v i j 1 k s n i j 1 k s n g s where g s r n i j k s δ t l θ ψ i j k s n i j k s n i j k s θ ψ i j k 1 n i j k 1 n i j k 1 l with ψ approximated by the distribution of particles in the flow solver for eq 21 note that the definition of the dimensionless numbers 24 implies that the parameter l has to be a dimensionless number as well the contributions to n i j k s 1 in eq 25 are obtained with the bgrw algorithm 26 n l m k s δ n l m l m k s δ n l 1 m l m k s δ n l 1 m l m k s δ n l m 1 l m k s δ n l m 1 l m k s where for consistency with the finite difference scheme 25 the quantities δ n verify in the mean 27 δ n l m l m k s 1 r x r z n i j k s δ n l 1 m l m k s 1 2 r x u l m k s n l m k s δ n l m 1 l m k s 1 2 r z v l m k s n l m k s the binomial random variables δ n used in the bgrw algorithm are approximated similarly to the algorithms described in the previous sections by summing up to unity reminders of multiplication and floor operations a deterministic bgrw algorithm can be obtained similarly to the flow solver presented in section 4 1 above by giving up the particle s indivisibility and using the un averaged relations 27 however for the computations presented in the next section we use a randomized implementation of the bgrw algorithm as follows from 27 the bgrw algorithm is subject to the following restrictions 28 r x r z 1 u l m k s r x v l m k s r z remark 4 the constraints 28 impose a limitation on the maximum allowable value of the local péclet number assume a constant flow velocity v and a constant diffusion coefficient d then according to 28 and 24 the condition v r implies pé v δ z d 2 remark 5 taking into account that the iterations start with n i j k 1 setting l 1 θ 1 and dropping the superscripts s the relation 25 becomes 29 n i j k 1 r x r z n i j k 1 1 2 r x u i 1 j k 1 n i 1 j k 1 1 2 r x u i 1 j k 1 n i 1 j k 1 1 2 r z v i j 1 k 1 n i j 1 k 1 1 2 r z v i j 1 k 1 n i j 1 k 1 n r n i j k 1 δ t relation 29 together with 26 28 define a bgrw algorithm for decoupled reactive transport described by eq 22 with θ ψ c 1 4 2 2 unbiased grw algorithm for transport problems the unbiased grw algorithm is obtained by globally moving groups of particles according to the rule 30 n i j k s δ n i u i j k s j v i j k s i j k s δ n i u i j k s d j v i j k s i j k s δ n i u i j k s d j v i j k s i j k s δ n i u i j k s j v i j k s d i j k s δ n i u i j k s j v i j k s d i j k s where d is a constant amplitude of diffusion jumps and the dimensionless variables r x r z u and v are defined similarly to 24 by 31 r x 2 d 1 δ t l d δ x 2 r z 2 d 2 δ t l d δ z 2 u i j k s δ t l δ x u i j k s 0 5 v i j k s δ t l δ z v i j k s 0 5 the particles distribution is updated at every time step by 32 n l m k s 1 δ n l m k s i l j m δ n l m i j k s n g s the averages over grw runs of the terms from 30 are now related by 33 δ n i u i j k s j v i j k s i j k s 1 r x r z n i j k s δ n i u i j k s d j v i j k s i j k s r x 2 n i j k s δ n i u i j k s j v i j k s d i j k s r z 2 n i j k s comparing with the bgrw relations 27 we remark that 31 defines unbiased jump probabilities r x 2 and r y 2 on the two spatial directions the unbiased grw algorithm for decoupled transport is obtained by letting l 1 and dropping the superscripts s see also remark 5 the binomial random variables δ n used in the unbiased grw algorithm are approximated by the procedure used for the flow solver and for the bgrw algorithm presented in the previous subsection for fixed space steps the time step is chosen such that the dimensionless parameters u i j k s and v i j k s take integer values larger than unity which ensure the desired resolution of the velocity components suciu 2019 sect 3 3 2 1 further the jumps amplitude d is chosen such that the jump probabilities verify the constraint r x r z 1 imposed by the first relation 33 the unbiased grw as well as the bgrw algorithm introduced in section 4 2 1 above have been tailored to solve problems with constant diffusion coefficients as those considered in sections 5 2 and 6 3 below in case of diagonal diffusion tensors with space time variable coefficients d 1 and d 2 the algorithms for the transport problem are straightforwardly obtained by assigning to r x and r z superscripts s and appropriate subscripts i j k 5 validation of the two dimensional grw algorithms 5 1 grw flow solutions for the beginning we conduct verification tests of the grw flow code by comparisons with an analytical solution and compute numerical estimates of the order of convergence the results are further compared with those obtained by a tpfa code implemented in the mrst software lie 2019 illiano et al 2020 the two codes are tested by solving a problem with manufactured solution previously considered in radu and wang 2014 the domain is the unit square 0 1 0 1 and the final time is t 1 the manufactured solution for the pressure head ψ m is given by 34 ψ m x z t t x x 1 z z 1 1 the water content θ and the conductivity k are expressed as 35 θ ψ 1 1 ψ k θ ψ ψ 2 the analytical solution 34 defines the boundary and initial conditions and induces a source term f computed analytically from eq 17 with parameters given by the expressions 35 we start the computations on a uniform mesh with δ x δ z 0 1 and halve the mesh size step three times successively the accuracy of the numerical solutions at the final time t t is quantified by the l 2 norm ε l ψ l ψ m l 1 4 where l 1 corresponds to the original mesh the estimated order of convergence eoc that describes the decrease of the error in logarithmic scale is computed according to 36 e o c log ε l ε l 1 log 2 l 1 3 the computations with the tpfa code start with a time step δ t 0 1 which is also halved at each refinement of the mesh the parameters of the convergence indicator 3 are set to ε a 10 6 and ε r 0 finally the linearization parameter l is set equal to 1 2 and the convergence of the l scheme is achieved after circa 100 iterations per time step independently of the mesh size in the grw computations we use the same spatial refinement of the grid and tolerances ε a and ε r as above but according to 5 we have to use adaptive time steps δ t o δ z 1 2 see discussion in section 3 1 the convergence criterion 3 is already fulfilled by the grw l scheme with parameter l 1 for numbers of iterations increasing from s 2 to s 5 as the space step decreases the accuracy ε l instead is strongly influenced by l for l 800 the ε l values may increase with the refinement of the mesh leading to negative eoc that is the grw solution does not converge to the exact solution ψ m however it is found that the increase of ε l is prevented by using a sufficiently large parameter l the results presented in table 4 indicate the convergence of order 1 in space for tpfa and of order 2 for the grw solutions the higher order of convergence also leads to much smaller errors of the grw code after the first refinement of the mesh further we solve the benchmark problem from list and radu 2016 sect 4 2 which describes the recharge of a groundwater reservoir from a drainage trench in a two dimensional geometry the groundwater table is fixed by a dirichlet boundary condition on the right hand side the drainage process is driven by a dirichlet boundary condition changing in time on the upper boundary of ω the precise structure of the domain is defined by ω 0 2 0 3 γ d 1 x z ω x 0 1 z 3 γ d 2 x z ω x 2 z 0 1 γ d γ d 1 γ d 2 γ n ω γ d the dirichlet and neumann boundary conditions on γ d and γ n respectively as well as the initial condition consisting of hydrostatic equilibrium are specified as follows ψ x z t 2 2 2 t δ t d on γ d 1 t δ t d 0 2 on γ d 1 t δ t d 1 z on γ d 2 k θ ψ x z t ψ x z t z n 0 on γ n ψ x z 0 1 z on ω where n represents the outward pointing normal vector we consider here two sets of soil parameters presented in table 5 which correspond to a silt loam and a beit netofa clay respectively the time unit is 1 day and spatial dimensions are given in meters furthermore we consider a regular mesh consisting of 651 nodes i e δ x δ z 0 1 by setting the stabilization parameters to l 0 5 for loam and for l 0 12 for clay the convergence criterion 3 with ε a ε r 5 10 6 is fulfilled after about 120 iterations of the grw l scheme for both soil models figs 9 and 10 the results shown in figs 11 and 12 are as expected for this benchmark problem see schneid 2000 list and radu 2016 the drainage process in the clay soil is much slower so that the pressure distribution after three days is similar to that established in the loam soil after 4 5 h the results obtained with the tpfa l scheme with l 1 for both soil models are used as reference to compute the relative errors ε ψ ε θ ε q x and ε q z shown in table 6 one remarks that ε ψ and ε θ are close to the corresponding errors for the one dimensional case presented in table 1 but ε q x and ε q z are one order of magnitude larger than ε q in shown in table 1 a possible explanation could be the occurrence of the numerical diffusion in the flow tpfa code see discussion at the end of section 5 2 3 below the computational times of the grw code are 1 s and 1 6 s for loam and clay cases respectively the times of the tpfa runs on the same computer are one order of magnitude larger i e 25 s and 38 s respectively 5 2 grw bgrw solutions for fully coupled flow and transport problems 5 2 1 code verification tests the code verification tests for coupled flow and transport problems are conducted similarly to those for the flow solver presented in the previous subsection by considering along with the exact flow solution 34 the exact solution for the concentration field given by 37 c m x z t t x x 1 z z 1 1 after setting r 0 and d 1 the coupled system of equations 21 22 is solved in the unit square for a total time t 1 with source terms initial conditions and boundary conditions resulted from the exact solutions 34 and 37 with a new parameterization given by 38 θ ψ c 1 1 ψ c 10 k θ ψ ψ 2 the grw flow algorithm 18 20 with θ and k given by 38 is coupled with the bgrw transport algorithm 25 28 initialized with n 10 24 particles into an alternating splitting scheme illiano et al 2020 the approach alternates iterations of flow and transport solvers until the convergence criterion 3 with ε a 10 6 and ε r 0 is fulfilled by the numerical solutions for both ψ and c in order to highlight the approach to the convergence order 2 the stabilization parameters of the flow and the transport solvers are set to l p l c 100 the grw results presented in tables 7 and 8 are compared with results obtained with a tpfa solver applying the same alternating linearized splitting procedure with parameters l p l c 1 which ensure the convergence of order 1 the grw flow solver approximates the darcy velocity by centered differences only in the interior ω of the computational domain therefore the velocity q ω needed to compute the number of biased jumps from the boundary ω in the bgrw relation 25 has to be provided in some way the straightforward approach is to compute the velocity by using an approximate forward finite difference discretization of darcy s law another option is to extend on the boundary the velocity from the first neighboring interior site thanks to the manufactured solution 34 on which the code verification test is based we also have the exact velocity computed analytically the latter allows accuracy assessments for the above approximations we note that the grw results for the pressure solver obtained with analytical approximate and extend q ω are identical in the precision of three significant digits table 7 for the concentration solutions table 8 we note the remarkably good performance of approximate and extended q ω 5 2 2 estimates of numerical diffusion the small errors shown in table 8 indicate that the numerical diffusion in solving the transport step of the coupled problem does not play a significant role this is somewhat expected for the small péclet numbers of order pé 10 2 encountered in these computations but for the numerical setup of the benchmark problem presented in section 5 1 and realistic transport parameters pé can be significantly larger than unity therefore we proceed to estimate the numerical diffusion of the codes compared here by following the procedure used in radu et al 2011 we consider the analytical gaussian solution c x z t of eq 22 with θ 1 r 0 and constant coefficients d 0 001 and v 0 0331 corresponding to the cauchy problem with a dirac initial concentration pulse located at the coordinates 1 2 1 the constant velocity v oriented downwards along the z axis is the steady state solution of the benchmark flow problem from section 5 1 with k k s a t corresponding to the loam soil initial condition ψ x z 0 1 z 3 dirichlet boundary conditions ψ x 0 t 1 ψ x 3 t 0 and no flow neumann conditions on the vertical boundaries the initial condition c x z 0 is the same gaussian function evaluated at t 1 and the final time is t 3 for decreasing mesh sizes δ x and pé v δ x d the number of time steps was restricted by the requirement that the support of the numerical solution does not extend beyond the boundaries ω to mimic diffusion in unbounded domains the effective diffusion coefficients d x and d z are computed from the spatial moments along the x and z directions of the numerical solution see radu et al 2011 eqs 38 41 the numerical diffusion is estimated by relative errors ε d x d x d d and ε d z d z d d averaged over the time interval 0 t table 9 shows that while the tpfa results are strongly influenced by the mesh size similarly to the finite volume results from radu et al 2011 the unbiased grw algorithm is practically unconditionally free of numerical diffusion the bgrw algorithm is also free of numerical diffusion provided that pé 2 see also remark 4 we also note that δ x 0 05 defines the coarsest grid acceptable for solving the benchmark problem for coupled flow and transport with bgrw and tpfa codes 5 2 3 fully coupled water flow and surfactant transport in the following we solve the coupled flow and transport problem 21 22 by using the setup of the benchmark flow problem problem from section 5 1 completed by parameters and initial boundary conditions modeling a situation of coupled water flow and surfactant transport the surfactant concentration in the domain ω has a stratified distribution described by the plane c x z 0 z 1 2 further the concentration is set to c 1 on the dirichlet boundary γ d 1 and to c 0 on γ d 2 and no flow neumann conditions are imposed on the vertical boundaries the flow and transport are coupled in both directions through the van genuchten mualem parameterization 12 13 with θ ψ c θ γ c ψ where γ c 1 1 b ln c a 1 models the concentration dependent surface tension between water and air knabner et al 2003 the constant parameters of γ c are set to a 0 44 and b 0 0046 illiano et al 2020 to describe a more realistic heterogeneous soil the saturated conductivity k s a t is modeled as a log normal space random function with a small variance σ 2 0 5 and gaussian correlation of correlation lengths λ x 0 1 m and λ z 0 01 m in horizontal and vertical directions respectively the ln k field is generated by summing up 100 random periodic modes with the kraichnan algorithm presented in suciu 2019 appendix c 3 1 2 the diffusion coefficient is set to a constant value d 10 3 m day which is representative for soils and aquifers radu et al 2011 schneid 2000 suciu 2019 following illiano et al 2020 the nonlinear reaction term is specified as r c 10 3 c 1 c instead of using a fixed number of time steps as in the flow benchmark presented in section 5 1 now we fix the total time to t 3 days set the intermediate time controlling the drainage process to δ t d t 3 and keep the original time steps δ t which ensure the appropriate resolution for contrasting fast and slow processes in loam and clay soils respectively preliminary tests showed that in order to obtain an acceptable resolution of the velocity components in the benchmark setup the unbiased grw requires extremely fine discretizations with δ x o 10 5 therefore the transport step is solved with the bgrw algorithm for the mesh size δ x 0 05 suggested by the above investigations on numerical diffusion the velocity q ω on boundaries is approximated by forward finite differences the convergence of the flow and transport l schemes using grw algorithms requires relatively large linearization parameters l p l c 20 for loam soil and l p l c 100 for clay soil models these are two order of magnitude larger than for the decoupled flow benchmark presented in section 5 1 probably due to the increased complexity of the coupled problem by setting the tolerances of the convergence criterion 3 to ε a ε r 5 10 6 the convergence is achieved after about 2000 iterations for the loam soil and about 14000 iterations for the clay soil see figs 13 14 15 16 the results obtained by coupling the grw flow and bgrw transport solvers are presented in figs 17 18 19 20 21 22 23 24 25 26 the randomness of k s a t is especially felt by the pressure distribution in the more permeable loam soil fig 17 while in the clay soil the pressure remains almost stratified fig 18 the same contrast is shown by the water content with almost saturated loam soil fig 19 and partially stratified saturation in the clay soil fig 20 since the darcy velocity is proportional to the gradient of the random pressure the heterogeneity of the advective component of the transport process is mainly manifest in the final distribution of the concentration in the loam and clay soils compare figs 21 and fig 22 significant differences between the loan and clay soils are also illustrated by the spatial distribution of the velocity components figs 23 24 25 26 the results obtained with the grw bgrw flow and transport solvers are compared with those provided by a tpfa code using l p l c 1 for both soils and l c 2 l p the convergence is achieved in reasonable computing times of 263 s loam and 177 s clay only when using the anderson acceleration procedure anderson 1965 walker and ni 2011 both et al 2019 note that the grw times on the same computer are of the same order of magnitude 526 and 178 respectively without appealing to the acceleration procedure the errors for pressure water content and velocity components shown in table 10 are more or less similar to those for the flow benchmark problem given in table 6 the difference of one order of magnitude between the ε c values for the two soils can be traced back to the amount of numerical diffusion of the tpfa transport solver see table 9 the estimated mean péclet number for the loam soil pé 1 3 is much larger than the value pé 4 10 3 estimated for the clay soil and can partially explain the larger ε c value in the first case since the pressure equation is essentially an advection diffusion equation with velocity given by the derivatives of the coefficient k e g gotovac et al 2009 suciu 2020 the errors ε q x and e q z of order 10 1 also could be produced by numerical diffusion in the flow solver in the setup of the benchmark problems for both coupled flow and transport and decoupled flow we estimate a mean péclet number pé 0 9 for both loam and clay soil models for comparison in the one dimensional case with smaller ε q pé was about 0 03 in scenario 1 and 0 3 in scenario 2 since the flow and transport solvers implemented in mrst basically use the same tpfa finite volume method we may expect that the flow solver produces a numerical diffusion comparable to that of the transport solver shown in table 9 a one dimensional version of the benchmark problem for flow and surfactant transport can be readily obtained and solved with one dimensional grw algorithms suciu et al 2020 sect 5 2 4 even though the lateral heterogeneity of the two dimensional benchmark is ignored the main features are also revealed by the one dimensional drainage model the discrepancy between fast loam and slow clay flow and transport processes the same intervals of variation of the solutions and similar behavior on the vertical direction 6 two dimensional grw solutions for groundwater flow and transport at regional and field scales for saturated aquifers θ c o n s t eq 17 reduces to a linear equation solved by the steady state hydraulic head solution in h x y under time independent boundary conditions as noted in remark 3 the grw l scheme 18 20 becomes in this case a transient scheme for the linear flow equation in the following examples we consider flow problems formulated in two dimensional domains x y 0 l x 0 l y with dirichlet boundary conditions h 0 y h 1 and h l x y h 2 and no flow neumann conditions on top and bottom boundaries in the saturated flow regime the transport eq 22 is also linear and decoupled from the linear flow equation decoupled transport problems can be solved by either biased or unbiased grw algorithms see remark 5 and section 4 2 2 on the same lattice as that used to compute the flow velocity 6 1 flow in heterogeneous aquifers at regional scale for the beginning we follow the setup for regional scale used in franssen et al 2009 to compare approaches for inverse modeling of groundwater flow the domain and the boundary conditions are specified by l x 4900 m l y 5000 m h 1 0 m h 2 5 m the hydraulic conductivity k is a log normally distributed random field defined by the mean k 12 10 4 m s the correlation length λ 500 m and the variance σ 2 1 of the ln k field the k field is generated as in section 5 2 3 above by summing 100 random periodic modes with the kraichnan algorithm besides the exponential correlation considered in franssen et al 2009 we also investigate the behavior of the flow solution for gaussian correlation of the ln k field with the same correlation length as well as in case of the smaller variance σ 2 0 1 for both correlation models the two correlation models of the ln k field are of the form c r σ 2 exp r λ α where r r x 2 r y 2 1 2 is the spatial lag the exponent α 1 corresponds to the exponential model and α 2 to the gaussian one since the correlation functions depend on spatial variables through r λ the computation can be done for spatial dimensions scaled by λ that is fields of dimensionless correlation length λ 1 and a domain 0 l x λ 0 l y λ the results on the original grid are finally obtained after the multiplication by λ of the solution h x y and of the spatial coordinates the solutions h x y of the stationary eq 17 corresponding to θ c o n s t for given realizations of the k field with σ 2 0 1 are obtained under the initial condition h 0 x y which is the plane defined by the dirichlet boundary conditions h 0 y 0 and h l x λ y h 2 λ with space steps set to δ x δ y 0 2 m the steady state is reached after about 4 10 5 iterations of the grw solver the relative errors of the solution h obtained with the scaled geometry with respect to the solution of the unscaled problem are of the order 10 14 that is close to the machine precision suciu et al 2020 sect 6 1 to estimate the order of convergence of the grw scheme for this particular flow problem we use manufactured analytical solutions provided in the git repository https github com pmflow flowbenchmark and similarly to estimations performed in section 5 1 we compute the eoc according to 36 by successively halving the space steps from δ x δ y 2 10 1 up to δ x δ y 2 5 10 2 we note that the eoc approach presented here differers somewhat from that used in alecsa et al 2019 suciu 2020 the reference solution is now the manufactured solution instead of the solution on the finest grid and the error norm is no longer computed after the first iteration but after large numbers of iterations from 10 5 to more than 10 7 when the grw solution approaches the stationarity due to the limited number of iterations the solutions are not yet strictly stationary and the order of convergence may be not accurately estimated in some cases therefore we also use a tpfa flow solver to compute eoc values for the same scenarios the results presented in tables 11 and 12 show significant differences between the two correlation models for gaussian correlation the errors obtained with the two approaches are relatively small in all cases instead for exponential correlation despite the strong eoc obtained after the first two refinements the errors are extremely large for σ 2 1 and become smaller than one only for σ 2 0 1 after the second refinement of the grid these results are consistent with those presented in alecsa et al 2019 where similar benchmark problems were solved for a larger range of parameters of the ln k field 6 2 flow in conditions of random recharge we consider in the following a flow problem formulated for the same geometry and boundary conditions as in the previous subsection which has been used in pasetto et al 2011 to design a new monte carlo approach for flow driven by spatially distributed stochastic sources now the hydraulic conductivity is constant k 12 10 4 m s and the groundwater recharge is described by a source term f in eq 17 modeled as a random space function of mean f 362 912 mm year log normally distributed with exponential correlation specified by different correlation lengths and variances of the ln f field among different scenarios presented inpasetto et al 2011 we consider for comparison with the present computations only the case λ 500 m and the variance σ 2 1 as in the previous subsection we use the setup for the problem s geometry scaled by λ for which the random recharge problem with σ 2 1 is solved with relative errors of the order 10 15 suciu et al 2020 sect 6 2 in a first validation test we compare the grw and tpfa solutions of the random recharge problem on the computational domain scaled by λ 500 m for single realizations of the random recharge with both exponential and gaussian correlation of the ln f field and two variances σ 2 0 1 and σ 2 1 the absolute and relative differences ε a h g r w h t p f a and ε r h g r w h t p f a h t p f a presented in table 13 indicate a good agreement between the two approaches further we perform statistical inferences of the mean and variance obtained from an ensemble of 100 monte carlo simulations within the setup of pasetto et al 2011 for random recharge term with exponential correlation and variance σ 2 1 the mean and the variance of the hydraulic head h are computed as averages over realizations of the ln f field followed by spatial averages with standard deviation estimated by spatial averaging the results presented in table 14 show again that the grw and tpfa results are in good statistical agreement finally we compare the mean and the variance estimated at the center of the computational domain by grw and tpfa simulations with the results presented in pasetto et al 2011 as seen in table 15 the mean values compare quite well but both the grw and tpfa approaches overestimate the variance computed for the same parameters in pasetto et al 2011 fig 6 this discrepancy can be attributed either to the large errors expected for exponential correlation model see tables 11 and 12 or to the statistical inhomogeneity of the monte carlo ensemble of 100 realizations indicated by the large standard deviations shown in table 14 6 3 flow and advection dispersion transport in aquifers in the following we consider an incompressible flow in the domain 0 20 0 10 driven by dirichlet boundary conditions h 0 y 1 and h 20 y 0 and zero neumann conditions on top and bottom boundaries the hydraulic conductivity is a random space function with mean k 15 m day with gaussian correlation of the ln k field correlation length λ 1 m and variance σ 2 0 1 generated by summing 10 random modes with the kraichnan algorithm an ensemble of velocity fields corresponding to 100 realizations of the k field is obtained with the flow solver used in section 6 1 for the resolution of the grw lattice defined by space steps δ x δ y 0 1 further monte carlo simulations of advection diffusion are carried out using the velocity realizations and the isotropic local dispersion coefficient d 0 01 m 2 day the linear transport equation obtained by setting θ c o n s t in eq 22 is solved with the unbiased grw algorithm described in section 4 2 2 by using n 10 24 particles to represent the concentration the final time t 10 days is chosen such that the support of the concentration does not reach the boundaries during the simulation hence the monte carlo inferences can be compared with results of linear theory which provides first order approximations of dispersion coefficients for small variances σ 2 bellin et al 1992 in turn such linear approximations are accurately retrieved by averaging over ensembles of particle tracking simulations of diffusion in realizations of velocity fields approximated to the first order in σ 2 by a kraichnan procedure schwarze et al 2001 following this approach to infer dispersion coefficients in linear approximation we use an ensemble of 10 4 realizations of krainchan velocity fields computed with 100 random modes by the algorithm described in suciu 2019 appendix c 3 2 2 and the unbiased grw solver with n 10 24 particles in each realization longitudinal and transverse ensemble dispersion coefficients d x and d y are computed as half the slope of the ensemble average of the second spatial moments of the concentration distribution centered at the ensemble average center of mass bellin et al 1992 radu et al 2011 schwarze et al 2001 the results presented in fig 27 show a that in spite of relatively small ensemble of velocity realizations the ensemble dispersion coefficients obtained with the 100 grw solutions of the full flow problem are quite close to the reference linear results the computation of the velocity realizations with the transient grw flow solver requires 10 4 to 10 5 iterations to fulfill the convergence criterion 3 with tolerances ε a ε r 5 10 7 and about 160 s per realization for the chosen discretization δ x δ y 0 1 the unbiased grw transport solver requires according to 31 a relatively rough time discretization of δ t 0 5 this leads to a total computation time of about 1 4 s for the estimation of the dispersion coefficients by averaging over the 100 realizations of the statistical ensemble by comparison the tpfa codes needs about 3 8 s to compute a velocity realization and about 13 s for a single transport realization by using the same spatial resolution and a time step δ t 0 05 but the tpfa estimates of the dispersion coefficients deviate by more than one order of magnitude from the linear reference solution since reducing the spatial steps and the local pé to reduce the numerical diffusion dramatically increases the computational burden for the tpfa codes we solved a rescaled problem so to preserve the mean and the spatial variability of the velocity field we chose a smaller domain 0 2 0 1 correlation length of the ln k field λ 0 1 and a new dirichlet condition h 0 y 0 1 now the tpfa codes require about 60 s to compute one flow realization and about 3 h for a transport realization with δ x δ y 0 001 and δ t 0 0005 the computation times for the grw codes to solve the rescaled problem by using δ x δ y 0 01 and δ t 0 07 are practically unchanged figure 28 shows that the grw estimations of the dispersion coefficients are again close to the linear approximation instead the tpfa results overestimate the linear approximation by 10 to 20 the deviations of the tpfa coefficients shown in fig 28 are comparable with the numerical diffusion estimated for constant velocity in case of the longitudinal coefficient d x but two orders of magnitude larger for the transverse coefficient d y suciu et al 2020 table 17 7 conclusions the grw schemes for simulating flow in either unsaturated or saturated porous media are equivalent to finite difference schemes in their deterministic implementation or for sufficiently large numbers of particles in randomized implementations the same in case of bgrw solver for transport problems instead the unbiased grw is a superposition of euler schemes for itô equation suciu 2019 which is no longer equivalent with a finite difference scheme unless the coefficients of the transport equation are constant in simulations of reactive transport grw algorithms can use huge numbers of computational particles even as large as the number of molecules involved in reactions allowing simple and intuitive representations of the process while unbiased grw algorithms are mainly efficient in obtaining fast solutions for large scale transport in aquifers bgrw solvers are appropriate for computing solutions of fully coupled flow and transport problems in soil systems with fine variation of the parameters the algorithms are implemented as iterative l schemes which linearize the richards equation and describe the transition from unsaturated to saturated regime the grw bgrw solutions are first order accurate in time and second order accurate in space for saturated regimes the flow solver becomes a transient scheme solving steady state flows in aquifers since the grw algorithms are explicit schemes which do not need to solve systems of algebraic equations they are simpler and in some cases faster than finite element volume schemes the grw l schemes for non steady coupled problems for flow and transport in soils as well as for transport simulations in saturated aquifers are indeed much faster than the tpfa codes used as reference in this study however the flow solutions for saturated porous media in large domains e g field or regional scale require much larger computing time than classical numerical schemes due to the large number of iterations needed to achieve the convergence of the transitory scheme used to compute steady state solutions see also a detailed analysis in alecsa et al 2019 the obvious advantage of the grw schemes is that they are practically free of numerical diffusion this is demonstrated by the results for decoupled transport presented in table 9 but as shown by the discussion at the end of section 5 2 3 the flow solvers also can be affected by numerical diffusion which is difficult to isolate from other errors occurring in coupled flow and transport problems such errors are avoided by grw algorithms which prevent the occurrence of the numerical diffusion by using consistent definitions of the jump probabilities as functions of the coefficients of the flow and transport equations credit authorship contribution statement nicolae suciu conceptualization methodology software writing original draft supervision davide illiano methodology software writing review editing alexander prechtel methodology software writing review editing florin a radu conceptualization writing review editing supervision declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgements the authors are grateful to dr emil cătinaş for fruitful discussions on convergent sequences and successive approximation approaches nicolae suciu acknowledges the financial support of the deutsche forschungsgemeinschaft dfg german research foundation under grant su 415 4 1 405338726 integrated global random walk model for reactive transport in groundwater adapted to measurement spatio temporal scales vista a collaboration between the norwegian academy of science and letters and equinor funded the research of davide illiano project number 6367 project name adaptive model and solver simulation of enhanced oil recovery 
312,over the past years tomographic scanning techniques like micro ct have become popular for the acquisition of high fidelity void space geometries of natural porous media e g bultreys et al 2016 raeini et al 2017 limitations both in computing time and memory prohibit however direct numerical simulations of flow and transport in large resp detailed sample geometries flow or pore networks derived from scans alleviate this limitation but still necessitate a methodology to extrapolate to larger samples in this work we present a network generation algorithm that is particularly suited for heterogeneous irregular networks while emulating from an existing base network new networks of equal or larger sizes the outlined algorithm scales approximately linearly with the network node or pore count and maintains 1 node connectivity resp pore coordination number statistics 2 geometrical pore throat properties as well as 3 the potentially inhomogeneous spatial clustering of pores while existing methods address the first two properties the third point is crucial especially in heterogeneous media to match flow transport properties like the permeability that have a strong dependence on the spatial distance between connected pores moreover the cubical networks generated by our algorithm are periodic in all spatial directions thus eliminating topological boundary effects which are not present in natural media bounded networks of arbitrary sizes can then be recovered by cutting the generated networks and thus flow transport processes at larger scales can be studied while incorporating physically based descriptions of pore scale processes keywords dendrogram clustering networks generator connectivity heterogeneity 1 introduction flow networks arise in diverse disciplines such as information transmission lambiotte et al 2019 or transport in fractured subsurface formations jiang et al 2017 viswanathan et al 2018 while the methodology outlined here may be of general relevance we focus in the following on natural porous media which play a role in many applications e g dentz et al 2011 blunt et al 2013 bultreys et al 2016 for example in the context of groundwater flow transport properties of chemical compounds are determined by the pore arrangement and geometry in rocks and soils de vries et al 2017 here narrow or stagnant flow zones delay transport while porous sections or vugs comprising preferential flow channels enable transport at high rates moreover in connection with multi phase flow the trapping of blobs ganglia of non wetting fluids in imbibition experiments depends on the geometry connectivity of the void or pore space raoof and hassanizadeh 2010 sok et al 2002 pore space geometries resulting from segmented tomographic scans come in the form of three dimensional voxel arrays each voxel represents a cube occupied by either void or solid to translate these memory intense 3d images into more compact networks geometric methods such as the maximal ball algorithm silin and patzek 2006 figure 6 are applied bultreys et al 2016 section 4 2 in this algorithm the largest spheres inscribed in the void space and centered at each voxel are determined pore bodies are then identified based on the largest spheres that contain the centers of smaller spheres connections between these pore bodies or simply pores are represented through tubes or throats leading to a simplified network based representation of the void space geometry besides several multi phase flow studies e g joekar niasar et al 2010 al dhahli et al 2012 comparisons between single phase flow characteristics of pore networks and the full pore geometry were found to be in good agreement e g dong and blunt 2009 thus pore networks are a valuable idealization of natural porous media that can account for the spatial heterogeneities in pore arrangement and pore connectivity while basic principles are available at the pore scale in many engineering applications the pore scale is orders of magnitude smaller than the field scale of interest the upscaling of pore scale physics to the field scale however is still an open challenge in areas such as reactive flows e g dentz et al 2011 or tracer dispersion e g de vries et al 2017 lester et al 2016 moreover upscaling based on pore network models has a long tradition in the multi phase flow community for example blunt and king 1990 1991 have studied the imbibition of a less viscous wetting phase in random pore networks saturated with a non wetting phase fluid and have inspected the effects of flow rate and viscosity ratio on relative permeability curves dynamic pore network modeling of imbibition and drainage has for example been conducted by joekar niasar and hassanizadeh 2011 with an emphasis on non equilibrium capillary pressure effects recent multi phase studies apply pore networks to inspect the significance of corner flow in pore bodies raoof and hassanizadeh 2012 to extract information about porosity and absolute permeability godoy et al 2019 or to obtain data about transfer terms in refined sub phase models khayrat and jenny 2017 in order to address the upscaling challenge common to these works large scale pore networks will serve as a bridging element between pore scale physics and effective field scale models blunt et al 2013 due to computational and experimental limitations cnudde and boone 2013 section 2 3 the scanning and processing of large pore networks is limited however probabilistic pore network generators that are able to extrapolate from a smaller scanned base network to a larger network with the same characteristics are one viable option which shall be explored here in greater detail to our knowledge few such generation methods have been documented ye et al 2017 describe a generation algorithm based on regular lattices for networks in non cubic domains they study the impact of network structure and outer shape on the chemical properties of porous catalyst particles raoof and hassanizadeh 2010 present a network generator which is applicable for multi phase flows and operates on lattice grids the resulting networks enable a greater flexibility in terms of coordination number compared to conventional networks and thus can match the connectivity of real networks the work of raoof and hassanizadeh 2010 and the contributions cited therein arns et al 2004 sok et al 2002 emphasize the importance of network connectivity for accurate multi phase flow modeling in the work of idowu and blunt 2010 pores are randomly placed with a uniform spatial density and neighboring pores are connected pore properties such as the pore radius and the connectivity to other pores that is the coordination number are sampled from the base network similarly throat radii are sampled from the base network and are assigned such that they are correlated with the radii of the connected pores jiang et al 2012 distribute pores uniformly as well and present techniques for sampling pore and throat properties from statistics that were perviously extracted from available base networks while most network generation algorithms provide good results for bead packs and sandstones with well connected uniformly distributed pores the spatial clustering of pores arising in more complex media such as carbonate rocks has not been addressed pore networks with clustered pores tend to be less connected and thus display different flow transport characteristics compared to well connected regular networks e g meyer and bijeljic 2016 figure 3 vs 6 in addition to the previous studies optimization guided algorithms are applied to construct pore networks based on available effective quantities for example jamshidi et al 2009 have devised a pore network generator based on lindenmayer systems borrowed from biology their generator is combined with a genetic optimization algorithm to find the network candidate that best approximates prescribed quantities such as relative permeability curves or porosity and absolute permeability jamshidi et al 2009 eq 10 similar to most of the previous contributions we assume in this work that one base network from the porous medium of interest is available this base network should be representative of the spatial heterogeneity present in the pore space geometry of the medium under consideration the algorithm presented here then generates new random network realizations that share with the base network the same pore clustering and connectivity as well as pore throat statistics our method involves one cutoff parameter and is outlined in section 2 comparisons of effective flow properties for different media are provided in section 3 the paper concludes with a discussion about the role of the cutoff parameter and future perspectives in section 4 2 methods 2 1 dendrogram and cluster size distribution to characterize the spatial arrangement of network nodes or more specifically pore bodies in cubical sample volumes centroid dendrograms and cluster size distribution csd graphs are applied both concepts are defined and discussed in fig 1 since the pore volume has no effect on network connectivity pore bodies have equal weights when computing centroid locations dendrograms are a non parametric concept that is applied in various applications to quantify clustering james et al 2013 section 10 3 2 given the impact of node clustering on the flow properties of a network the generator outlined in this work randomly perturbs the base network in a way that essentially preserves the dendrogram 2 2 network generation algorithm random rotations of individual network clusters are one way of achieving a random perturbation while preserving at least within one rotated cluster the distances of its nodes the following listing provides more details about our rotation based network perturbation algorithm the outlined algorithm generates random network realizations that are periodic in all spatial directions compare meyer and gomolinski 2019 figure 1 periodic networks have the advantage that they do not suffer from boundary effects and are statistically homogeneous in space periodic throat connections can easily be cut open at the periodic faces and thus such networks converted to conventional ones with open faces 1 a base network composed of a set of pores and cylindrical throats that connect the pores is the main prerequisite its size in each spatial direction should be sufficiently large in order to represent the spatial variability in the pore space geometry and is given by lengths l 1 l 2 and l 3 moreover the size of the network to be generated is specified through the integer values n 1 n 2 and n 3 1 leading to a new network spanned by the intervals 0 n 1 l 1 0 n 2 l 2 and 0 n 3 l 3 the length of the largest permissible throat connection l m is prescribed under the precondition l m l i i from 1 to 3 and the specification of a cutoff size allows to control the degree of randomness in the realization 1 1 more specifically the cutoff limits the size of the clusters to be perturbed in step 3 thus clusters smaller than the cutoff are presumed to contain non uniformly distributed pores that will be randomly rearranged in step 3 while clusters larger than the cutoff are assumed to be uniformly distributed or are comparable to the domain size following this last condition a sensible upper limit for the cutoff is 50 of min l 1 l 2 l 3 2 the dendrogram of the base network is determined as described in fig 1a 3 in each of the n 1 n 2 n 3 sub volumes of the realization the set of pores from the base network is placed and each set is perturbed as follows by propagating from the top down along each dendrogram branch to clusters of decreasing size compare fig 1b clusters and their sub clusters are randomly rotated this process starts with clusters that are smaller than the cutoff size and recursively progresses down from clusters to their respective sub clusters or pores for a cutoff of infinity the recursion starts with the biggest cluster at the top of the dendrogram on the other hand choosing a cutoff of zero will leave the base network unchanged during cluster rotation the axis connecting the two sub clusters of a cluster see fig 1b is rotated around the cluster centroid and aligned parallel to a random direction vector which points on the unit sphere to a uniformly distributed point while this approach is suitable for isotropic media non uniform angle distributions could be applied in anisotropic media 4 to avoid loosing pores that are placed after the perturbation step outside of the network domain ω 0 n 1 l 1 0 n 2 l 2 0 n 3 l 3 such pores are shifted by addition or subtraction of n i l i with i being 1 2 or 3 such that their final position is ω for example a pore with a negative x 1 being outside ω is repositioned inside ω by replacing x 1 by x 1 n 1 l 1 2 2 due to the periodicity of the throats generated in steps 5 and 6 shifted pores may get reconnected with some of their original neighbors residing at the opposite domain boundary 5 as a preparatory step for establishing throat connections between pores buffer layers of thickness l m with periodic pore copies are added outside of the network domain this is done by firstly copying resp shifting all pores in the x 1 intervals 0 l m and n 1 l 1 l m n 1 l 1 to n 1 l 1 n 1 l 1 l m resp l m 0 next pores and pore copies are copied from x 2 intervals 0 l m and n 2 l 2 l m n 2 l 2 to n 2 l 2 n 2 l 2 l m resp l m 0 finally corresponding copies are added in the x 3 direction 6 pores inside the network domain ω are connected in random sequential order through throats with other pores ω or pore copies from the periodic buffer layers since each pore in the random realization originates from the base network it carries a coordination number and a corresponding set of throats with given original pore distances l t and throat radii r t for each of these throats to be realized ttbr the neighboring pore which induces a pore distance l t closest to l t is identified more specifically valid neighboring pores must not yet be fully connected empty list of ttbr must not induce a throat connection longer than l m and must not establish a second connection between the same pore pair in case no valid neighboring pore can be found the corresponding throat connection is not realized for the networks generated in this work the fraction of throats that could not be realized was found to be 1 on the other hand when the connection is realized the throat radius is set to r t and from the list of ttbr of the neighboring pore the one with a distance closest to l t is removed moreover when connecting to a neighboring pore copy from a buffer layer l t is computed based on the periodic copy while the throat connection is established with the original pore inside ω incl update of ttbr list random realizations resulting from the above algorithm match the throat and pore statistics of the base network and display a similar pore cluster structure the network topology however is altered below the prescribed cutoff size the outlined algorithm has been implemented in a python package while making use of the available functionality for dendrogram construction and nearest neighbor search scipy cluster hierarchy and scipy spatial delaunay 2 3 flow in periodic networks in order to inspect flow properties such as the permeability of the resulting periodic networks the flow setup outlined in our earlier contribution meyer and gomolinski 2019 section 2 2 is applied in this setup a driving mean pressure gradient is prescribed and pressure fluctuations are determined that are periodic over opposing network faces like the throats that cross periodic network boundaries after solving a linear system of pressure fluctuation equations resulting from volume balances for individual pores the network permeability e g in the x 1 direction is calculable as 1 k μ q 1 l 2 l 3 l 1 p where p l 1 quantifies the mean pressure gradient driving the flow in x 1 direction and q 1 is the total volumetric flux over a plane perpendicular to the x 1 direction the choice of the dynamic viscosity μ is irrelevant as μ q 1 is independent of μ this is because the volumetric flux through an individual throat with diameter d and length l is resulting from the product of the pressure drop over that throat times the throat conductivity given by π d 4 128 μ l 3 results 3 1 natural porous media after having outlined the generator methodology we inspect in this section the properties of random realizations resulting from base networks of different natural porous media unless mentioned otherwise the generated realizations have the same size as the original base network towards the end of section 3 we report computing times necessary for the generation of differently sized realizations since existing methods do not perform well for irregular networks with non uniform pore distributions we focus in a first step on the highly irregular estaillades carbonate network obtained from bijeljic and raeini 2016 and depicted in fig 2a compared with the bentheimer sandstone network shown in fig 2b pores appear clustered and relatively few flow paths connect opposing faces nevertheless the networks from the two media are similar in size both in terms of physical extension as well as pore and throat counts the mean coordination numbers twice the number of throats divided by the number of pores are thus similar too moreover the throat radius statistics are similar min 0 8 µm mean 11 µm max 77 µm st dev 6 µm for carbonate vs min 0 8 µm mean 11 µm max 87 µm st dev 7 µm for sandstone but the reduced connectivity leads to a permeability in the carbonate i e 2 0 10 14 m 2 being more than ten times smaller than in the sandstone i e 23 7 10 14 m 2 3 2 bentheimer sandstone before turning to the carbonate network the algorithm of idowu and blunt 2010 or more precisely a slight generalization producing periodic networks meyer and gomolinski 2019 section 2 1 shall be deployed for the generation of a random sandstone realization the resulting network is of the same size as the base network and has a permeability of 50 10 14 m 2 using uniformly distributed pores like in the algorithm idowu and blunt 2010 in combination with the throat connection method outlined in step 6 from section 2 2 leads to permeability values depicted in fig 3 and having a mean 19 8 10 14 m 2 and standard deviation 0 9 10 14 m 2 permeabilities resulting from the complete dendrogram based generator with a cutoff of 10 of l 1 l 2 l 3 2 7 mm are included in fig 3 as well the corresponding mean permeability is 19 1 10 14 m 2 and a standard deviation of 1 0 10 14 m 2 results these results demonstrate that simple uniform pore placement as proposed for example in idowu and blunt 2010 in combination with a throat connection method that accounts for the joint throat radius length statistics leads to acceptable results for the regular sandstone network noteworthy seems also that the dendrogram method leads to the same degree of variability in the permeability like uniform pore placement as there are no large scale clusters identifiable in the bentheimer sandstone network see fig 2b a relatively small cutoff of 10 was applied in the dendrogram algorithm this cutoff leaves the largest 9 5 of all clusters in the dendrogram unchanged not accounting for individual pores preserves the uniform pore distribution quite well as discussed next but at the same time leads to randomly perturbed throat connections compared to the base network a comparison of the cluster size distributions obtained from random realizations and the base network is provided in fig 4 comparing the network resulting from uniformly placed pores with the base network reveals that pores are indeed uniformly distributed in the sandstone the csd from the dendrogram based method starts to deviate from the one of the base network for clusters smaller than the cutoff size this deviation is due to the fact that rotating clusters may lead to the formation of smaller clusters with shorter throats which is illustrated in fig 1a and c grey circles and lines and which may further be the reason for the permeability reduction seen in fig 3 relative to uniform networks 3 3 estaillades carbonate in a next step the generation algorithms are applied to produce random realizations of the more complex estaillades carbonate network depicted in fig 2a as seen in the figure clusters are non uniformly distributed up to scales comparable to the domain size thus a cutoff of 50 was applied in the dendrogram based generator which leaves the largest 0 05 of the clusters unchanged the cutoff size was not chosen larger than 50 to avoid spatially overlapping clusters as a result of step 4 in the algorithm see section 2 2 exemplary realizations that illustrate the degree of variability resulting from the dendrogram based method are shown in fig 5 a csd graph resulting from a dendrogram based realization is compared in fig 6 against the graph from the estaillades base network and a csd obtained from the generator with uniform pore placement like in the sandstone case smaller clusters are forming when performing random rotations in the dendrogram on the other hand when distributing pores uniformly there are fewer small clusters as in the original base network moreover having pores uniformly distributed leads to a more inter connected sample volume with several parallel flow paths connecting opposing faces this eventually induces permeabilities that are in the range of sandstones which is not surprising given the similarities between the estaillades and bentheimer networks discussed in section 3 1 the dendrogram based realizations on the other hand display permeabilities that are in the range of the base carbonate network with mean 3 77 10 14 m 2 standard deviation 1 77 10 14 m 2 and distribution provided in fig 7 given the spatial irregularity seen in the estaillades base network compare fig 2a the permeability variability seen in fig 7 seems reasonable 3 4 large networks in addition to the quality of the generated network realizations inspected so far the computational costs shall be explored next to this end realizations of the estaillades network of increasing extensions have been created and the associated cpu times recorded the largest reported network involves 1 37 million pores and has a volume of 2 4 1 2 1 2 cm 3 it s construction took around four cpu hours since the construction of the dendrogram is determined by the size of the base network but is independent of the size of the realization to be created the corresponding computing time of 460 cpu seconds has been subtracted from the cpu times plotted in fig 8 it is seen that thanks to the efficient implementation of the dendrogram based generator the cpu time scales linearly with the network volume resp the number of pores which enables the generation of large network in addition to the cpu time scaling permeabilities resulting from the differently sized estaillades realizations are reported in fig 9 similar to the analysis of zhang et al 2000 concerned with representative elementary volumes rev of sandstones and samples with crushed beads one can observe that the permeability converges for increasing network size 4 discussion a comparison of the characteristics of the sandstone and carbonate network has shown that while these networks have very similar pore throat counts and similar throat radius statistics pores appear clustered in the less conductive carbonate while they are uniformly distributed in the more conductive sandstone accordingly random network generation methods that do not account for the pore clustering were found to match the permeability of the sandstone reasonably well while overestimating the carbonate permeability by tenfold in this respect centroid based dendrograms were found to be a useful tool to represent pore clustering furthermore to generate new network realizations dendrograms enable through the definition of a cutoff size the controlled random perturbation of an existing network the resulting realizations match both the joint pore throat statistics and the permeability of base networks for uniform and clustered pore distributions and at the same time display a realistic statistical variability the dendrogram based generation algorithm has been implemented in a computationally efficient manner producing network realizations at a computational cost that scales linearly with the size or pore count of the network the dendrogram based algorithm however has a tendency to enhance clustering during random rotations as the original node distances in clusters are preserved while smaller distances may get introduced see fig 1a and c or previously isolated cluster sections may overlap in order to reduce such effects a cutoff size was introduced that sets an upper size limit to clusters that are randomly and recursively rotated in the dendrogram in this work and as a guideline for other media the cutoff size was resp shall be chosen such that the positions of clusters that are uniformly distributed in the base network remain unchanged while the inner non uniform or irregular structure of these clusters is randomly perturbed with the generated networks being periodic in space thus implying a uniform cluster distribution at scales above the base network size an upper limit for the cutoff of half the smallest base network side length is implied alternative measures to counteract cluster enhancement would be the addition of a diffusive pore displacement or a mechanism that restricts the random rotation angles in order to avoid overlapping clusters while the networks studied in this contribution were isotropic anisotropic ones could be treated by using non uniform rotation angle distributions in the random perturbation step alternatively the base network could be simply scaled to arrive at an isotropic network followed by a rescaling step of the generated realizations moreover interesting will be the application of the new generation method to multi phase flows since the random network realizations closely emulate the geometrical reality of the base network viscous capillary and inertial forces scaling each differently with respect to the geometric network properties are expected to be statistically in close agreement with their counterparts in the base network credit authorship contribution statement daniel w meyer conceptualization formal analysis investigation methodology software validation writing original draft declaration of competing interest author have no conflict of interest acknowledgments the author gratefully acknowledges very helpful input from anastasios papageorgiou eth zürich during several discussions at the early stages of this work furthermore he is very thankful to branko bijeljic and ali raeini from the imperial college london for making the network data available and acknowledges financial support from eth zürich finally very helpful comments by branko bijeljic on the initial version of the manuscript are gratefully acknowledged 
312,over the past years tomographic scanning techniques like micro ct have become popular for the acquisition of high fidelity void space geometries of natural porous media e g bultreys et al 2016 raeini et al 2017 limitations both in computing time and memory prohibit however direct numerical simulations of flow and transport in large resp detailed sample geometries flow or pore networks derived from scans alleviate this limitation but still necessitate a methodology to extrapolate to larger samples in this work we present a network generation algorithm that is particularly suited for heterogeneous irregular networks while emulating from an existing base network new networks of equal or larger sizes the outlined algorithm scales approximately linearly with the network node or pore count and maintains 1 node connectivity resp pore coordination number statistics 2 geometrical pore throat properties as well as 3 the potentially inhomogeneous spatial clustering of pores while existing methods address the first two properties the third point is crucial especially in heterogeneous media to match flow transport properties like the permeability that have a strong dependence on the spatial distance between connected pores moreover the cubical networks generated by our algorithm are periodic in all spatial directions thus eliminating topological boundary effects which are not present in natural media bounded networks of arbitrary sizes can then be recovered by cutting the generated networks and thus flow transport processes at larger scales can be studied while incorporating physically based descriptions of pore scale processes keywords dendrogram clustering networks generator connectivity heterogeneity 1 introduction flow networks arise in diverse disciplines such as information transmission lambiotte et al 2019 or transport in fractured subsurface formations jiang et al 2017 viswanathan et al 2018 while the methodology outlined here may be of general relevance we focus in the following on natural porous media which play a role in many applications e g dentz et al 2011 blunt et al 2013 bultreys et al 2016 for example in the context of groundwater flow transport properties of chemical compounds are determined by the pore arrangement and geometry in rocks and soils de vries et al 2017 here narrow or stagnant flow zones delay transport while porous sections or vugs comprising preferential flow channels enable transport at high rates moreover in connection with multi phase flow the trapping of blobs ganglia of non wetting fluids in imbibition experiments depends on the geometry connectivity of the void or pore space raoof and hassanizadeh 2010 sok et al 2002 pore space geometries resulting from segmented tomographic scans come in the form of three dimensional voxel arrays each voxel represents a cube occupied by either void or solid to translate these memory intense 3d images into more compact networks geometric methods such as the maximal ball algorithm silin and patzek 2006 figure 6 are applied bultreys et al 2016 section 4 2 in this algorithm the largest spheres inscribed in the void space and centered at each voxel are determined pore bodies are then identified based on the largest spheres that contain the centers of smaller spheres connections between these pore bodies or simply pores are represented through tubes or throats leading to a simplified network based representation of the void space geometry besides several multi phase flow studies e g joekar niasar et al 2010 al dhahli et al 2012 comparisons between single phase flow characteristics of pore networks and the full pore geometry were found to be in good agreement e g dong and blunt 2009 thus pore networks are a valuable idealization of natural porous media that can account for the spatial heterogeneities in pore arrangement and pore connectivity while basic principles are available at the pore scale in many engineering applications the pore scale is orders of magnitude smaller than the field scale of interest the upscaling of pore scale physics to the field scale however is still an open challenge in areas such as reactive flows e g dentz et al 2011 or tracer dispersion e g de vries et al 2017 lester et al 2016 moreover upscaling based on pore network models has a long tradition in the multi phase flow community for example blunt and king 1990 1991 have studied the imbibition of a less viscous wetting phase in random pore networks saturated with a non wetting phase fluid and have inspected the effects of flow rate and viscosity ratio on relative permeability curves dynamic pore network modeling of imbibition and drainage has for example been conducted by joekar niasar and hassanizadeh 2011 with an emphasis on non equilibrium capillary pressure effects recent multi phase studies apply pore networks to inspect the significance of corner flow in pore bodies raoof and hassanizadeh 2012 to extract information about porosity and absolute permeability godoy et al 2019 or to obtain data about transfer terms in refined sub phase models khayrat and jenny 2017 in order to address the upscaling challenge common to these works large scale pore networks will serve as a bridging element between pore scale physics and effective field scale models blunt et al 2013 due to computational and experimental limitations cnudde and boone 2013 section 2 3 the scanning and processing of large pore networks is limited however probabilistic pore network generators that are able to extrapolate from a smaller scanned base network to a larger network with the same characteristics are one viable option which shall be explored here in greater detail to our knowledge few such generation methods have been documented ye et al 2017 describe a generation algorithm based on regular lattices for networks in non cubic domains they study the impact of network structure and outer shape on the chemical properties of porous catalyst particles raoof and hassanizadeh 2010 present a network generator which is applicable for multi phase flows and operates on lattice grids the resulting networks enable a greater flexibility in terms of coordination number compared to conventional networks and thus can match the connectivity of real networks the work of raoof and hassanizadeh 2010 and the contributions cited therein arns et al 2004 sok et al 2002 emphasize the importance of network connectivity for accurate multi phase flow modeling in the work of idowu and blunt 2010 pores are randomly placed with a uniform spatial density and neighboring pores are connected pore properties such as the pore radius and the connectivity to other pores that is the coordination number are sampled from the base network similarly throat radii are sampled from the base network and are assigned such that they are correlated with the radii of the connected pores jiang et al 2012 distribute pores uniformly as well and present techniques for sampling pore and throat properties from statistics that were perviously extracted from available base networks while most network generation algorithms provide good results for bead packs and sandstones with well connected uniformly distributed pores the spatial clustering of pores arising in more complex media such as carbonate rocks has not been addressed pore networks with clustered pores tend to be less connected and thus display different flow transport characteristics compared to well connected regular networks e g meyer and bijeljic 2016 figure 3 vs 6 in addition to the previous studies optimization guided algorithms are applied to construct pore networks based on available effective quantities for example jamshidi et al 2009 have devised a pore network generator based on lindenmayer systems borrowed from biology their generator is combined with a genetic optimization algorithm to find the network candidate that best approximates prescribed quantities such as relative permeability curves or porosity and absolute permeability jamshidi et al 2009 eq 10 similar to most of the previous contributions we assume in this work that one base network from the porous medium of interest is available this base network should be representative of the spatial heterogeneity present in the pore space geometry of the medium under consideration the algorithm presented here then generates new random network realizations that share with the base network the same pore clustering and connectivity as well as pore throat statistics our method involves one cutoff parameter and is outlined in section 2 comparisons of effective flow properties for different media are provided in section 3 the paper concludes with a discussion about the role of the cutoff parameter and future perspectives in section 4 2 methods 2 1 dendrogram and cluster size distribution to characterize the spatial arrangement of network nodes or more specifically pore bodies in cubical sample volumes centroid dendrograms and cluster size distribution csd graphs are applied both concepts are defined and discussed in fig 1 since the pore volume has no effect on network connectivity pore bodies have equal weights when computing centroid locations dendrograms are a non parametric concept that is applied in various applications to quantify clustering james et al 2013 section 10 3 2 given the impact of node clustering on the flow properties of a network the generator outlined in this work randomly perturbs the base network in a way that essentially preserves the dendrogram 2 2 network generation algorithm random rotations of individual network clusters are one way of achieving a random perturbation while preserving at least within one rotated cluster the distances of its nodes the following listing provides more details about our rotation based network perturbation algorithm the outlined algorithm generates random network realizations that are periodic in all spatial directions compare meyer and gomolinski 2019 figure 1 periodic networks have the advantage that they do not suffer from boundary effects and are statistically homogeneous in space periodic throat connections can easily be cut open at the periodic faces and thus such networks converted to conventional ones with open faces 1 a base network composed of a set of pores and cylindrical throats that connect the pores is the main prerequisite its size in each spatial direction should be sufficiently large in order to represent the spatial variability in the pore space geometry and is given by lengths l 1 l 2 and l 3 moreover the size of the network to be generated is specified through the integer values n 1 n 2 and n 3 1 leading to a new network spanned by the intervals 0 n 1 l 1 0 n 2 l 2 and 0 n 3 l 3 the length of the largest permissible throat connection l m is prescribed under the precondition l m l i i from 1 to 3 and the specification of a cutoff size allows to control the degree of randomness in the realization 1 1 more specifically the cutoff limits the size of the clusters to be perturbed in step 3 thus clusters smaller than the cutoff are presumed to contain non uniformly distributed pores that will be randomly rearranged in step 3 while clusters larger than the cutoff are assumed to be uniformly distributed or are comparable to the domain size following this last condition a sensible upper limit for the cutoff is 50 of min l 1 l 2 l 3 2 the dendrogram of the base network is determined as described in fig 1a 3 in each of the n 1 n 2 n 3 sub volumes of the realization the set of pores from the base network is placed and each set is perturbed as follows by propagating from the top down along each dendrogram branch to clusters of decreasing size compare fig 1b clusters and their sub clusters are randomly rotated this process starts with clusters that are smaller than the cutoff size and recursively progresses down from clusters to their respective sub clusters or pores for a cutoff of infinity the recursion starts with the biggest cluster at the top of the dendrogram on the other hand choosing a cutoff of zero will leave the base network unchanged during cluster rotation the axis connecting the two sub clusters of a cluster see fig 1b is rotated around the cluster centroid and aligned parallel to a random direction vector which points on the unit sphere to a uniformly distributed point while this approach is suitable for isotropic media non uniform angle distributions could be applied in anisotropic media 4 to avoid loosing pores that are placed after the perturbation step outside of the network domain ω 0 n 1 l 1 0 n 2 l 2 0 n 3 l 3 such pores are shifted by addition or subtraction of n i l i with i being 1 2 or 3 such that their final position is ω for example a pore with a negative x 1 being outside ω is repositioned inside ω by replacing x 1 by x 1 n 1 l 1 2 2 due to the periodicity of the throats generated in steps 5 and 6 shifted pores may get reconnected with some of their original neighbors residing at the opposite domain boundary 5 as a preparatory step for establishing throat connections between pores buffer layers of thickness l m with periodic pore copies are added outside of the network domain this is done by firstly copying resp shifting all pores in the x 1 intervals 0 l m and n 1 l 1 l m n 1 l 1 to n 1 l 1 n 1 l 1 l m resp l m 0 next pores and pore copies are copied from x 2 intervals 0 l m and n 2 l 2 l m n 2 l 2 to n 2 l 2 n 2 l 2 l m resp l m 0 finally corresponding copies are added in the x 3 direction 6 pores inside the network domain ω are connected in random sequential order through throats with other pores ω or pore copies from the periodic buffer layers since each pore in the random realization originates from the base network it carries a coordination number and a corresponding set of throats with given original pore distances l t and throat radii r t for each of these throats to be realized ttbr the neighboring pore which induces a pore distance l t closest to l t is identified more specifically valid neighboring pores must not yet be fully connected empty list of ttbr must not induce a throat connection longer than l m and must not establish a second connection between the same pore pair in case no valid neighboring pore can be found the corresponding throat connection is not realized for the networks generated in this work the fraction of throats that could not be realized was found to be 1 on the other hand when the connection is realized the throat radius is set to r t and from the list of ttbr of the neighboring pore the one with a distance closest to l t is removed moreover when connecting to a neighboring pore copy from a buffer layer l t is computed based on the periodic copy while the throat connection is established with the original pore inside ω incl update of ttbr list random realizations resulting from the above algorithm match the throat and pore statistics of the base network and display a similar pore cluster structure the network topology however is altered below the prescribed cutoff size the outlined algorithm has been implemented in a python package while making use of the available functionality for dendrogram construction and nearest neighbor search scipy cluster hierarchy and scipy spatial delaunay 2 3 flow in periodic networks in order to inspect flow properties such as the permeability of the resulting periodic networks the flow setup outlined in our earlier contribution meyer and gomolinski 2019 section 2 2 is applied in this setup a driving mean pressure gradient is prescribed and pressure fluctuations are determined that are periodic over opposing network faces like the throats that cross periodic network boundaries after solving a linear system of pressure fluctuation equations resulting from volume balances for individual pores the network permeability e g in the x 1 direction is calculable as 1 k μ q 1 l 2 l 3 l 1 p where p l 1 quantifies the mean pressure gradient driving the flow in x 1 direction and q 1 is the total volumetric flux over a plane perpendicular to the x 1 direction the choice of the dynamic viscosity μ is irrelevant as μ q 1 is independent of μ this is because the volumetric flux through an individual throat with diameter d and length l is resulting from the product of the pressure drop over that throat times the throat conductivity given by π d 4 128 μ l 3 results 3 1 natural porous media after having outlined the generator methodology we inspect in this section the properties of random realizations resulting from base networks of different natural porous media unless mentioned otherwise the generated realizations have the same size as the original base network towards the end of section 3 we report computing times necessary for the generation of differently sized realizations since existing methods do not perform well for irregular networks with non uniform pore distributions we focus in a first step on the highly irregular estaillades carbonate network obtained from bijeljic and raeini 2016 and depicted in fig 2a compared with the bentheimer sandstone network shown in fig 2b pores appear clustered and relatively few flow paths connect opposing faces nevertheless the networks from the two media are similar in size both in terms of physical extension as well as pore and throat counts the mean coordination numbers twice the number of throats divided by the number of pores are thus similar too moreover the throat radius statistics are similar min 0 8 µm mean 11 µm max 77 µm st dev 6 µm for carbonate vs min 0 8 µm mean 11 µm max 87 µm st dev 7 µm for sandstone but the reduced connectivity leads to a permeability in the carbonate i e 2 0 10 14 m 2 being more than ten times smaller than in the sandstone i e 23 7 10 14 m 2 3 2 bentheimer sandstone before turning to the carbonate network the algorithm of idowu and blunt 2010 or more precisely a slight generalization producing periodic networks meyer and gomolinski 2019 section 2 1 shall be deployed for the generation of a random sandstone realization the resulting network is of the same size as the base network and has a permeability of 50 10 14 m 2 using uniformly distributed pores like in the algorithm idowu and blunt 2010 in combination with the throat connection method outlined in step 6 from section 2 2 leads to permeability values depicted in fig 3 and having a mean 19 8 10 14 m 2 and standard deviation 0 9 10 14 m 2 permeabilities resulting from the complete dendrogram based generator with a cutoff of 10 of l 1 l 2 l 3 2 7 mm are included in fig 3 as well the corresponding mean permeability is 19 1 10 14 m 2 and a standard deviation of 1 0 10 14 m 2 results these results demonstrate that simple uniform pore placement as proposed for example in idowu and blunt 2010 in combination with a throat connection method that accounts for the joint throat radius length statistics leads to acceptable results for the regular sandstone network noteworthy seems also that the dendrogram method leads to the same degree of variability in the permeability like uniform pore placement as there are no large scale clusters identifiable in the bentheimer sandstone network see fig 2b a relatively small cutoff of 10 was applied in the dendrogram algorithm this cutoff leaves the largest 9 5 of all clusters in the dendrogram unchanged not accounting for individual pores preserves the uniform pore distribution quite well as discussed next but at the same time leads to randomly perturbed throat connections compared to the base network a comparison of the cluster size distributions obtained from random realizations and the base network is provided in fig 4 comparing the network resulting from uniformly placed pores with the base network reveals that pores are indeed uniformly distributed in the sandstone the csd from the dendrogram based method starts to deviate from the one of the base network for clusters smaller than the cutoff size this deviation is due to the fact that rotating clusters may lead to the formation of smaller clusters with shorter throats which is illustrated in fig 1a and c grey circles and lines and which may further be the reason for the permeability reduction seen in fig 3 relative to uniform networks 3 3 estaillades carbonate in a next step the generation algorithms are applied to produce random realizations of the more complex estaillades carbonate network depicted in fig 2a as seen in the figure clusters are non uniformly distributed up to scales comparable to the domain size thus a cutoff of 50 was applied in the dendrogram based generator which leaves the largest 0 05 of the clusters unchanged the cutoff size was not chosen larger than 50 to avoid spatially overlapping clusters as a result of step 4 in the algorithm see section 2 2 exemplary realizations that illustrate the degree of variability resulting from the dendrogram based method are shown in fig 5 a csd graph resulting from a dendrogram based realization is compared in fig 6 against the graph from the estaillades base network and a csd obtained from the generator with uniform pore placement like in the sandstone case smaller clusters are forming when performing random rotations in the dendrogram on the other hand when distributing pores uniformly there are fewer small clusters as in the original base network moreover having pores uniformly distributed leads to a more inter connected sample volume with several parallel flow paths connecting opposing faces this eventually induces permeabilities that are in the range of sandstones which is not surprising given the similarities between the estaillades and bentheimer networks discussed in section 3 1 the dendrogram based realizations on the other hand display permeabilities that are in the range of the base carbonate network with mean 3 77 10 14 m 2 standard deviation 1 77 10 14 m 2 and distribution provided in fig 7 given the spatial irregularity seen in the estaillades base network compare fig 2a the permeability variability seen in fig 7 seems reasonable 3 4 large networks in addition to the quality of the generated network realizations inspected so far the computational costs shall be explored next to this end realizations of the estaillades network of increasing extensions have been created and the associated cpu times recorded the largest reported network involves 1 37 million pores and has a volume of 2 4 1 2 1 2 cm 3 it s construction took around four cpu hours since the construction of the dendrogram is determined by the size of the base network but is independent of the size of the realization to be created the corresponding computing time of 460 cpu seconds has been subtracted from the cpu times plotted in fig 8 it is seen that thanks to the efficient implementation of the dendrogram based generator the cpu time scales linearly with the network volume resp the number of pores which enables the generation of large network in addition to the cpu time scaling permeabilities resulting from the differently sized estaillades realizations are reported in fig 9 similar to the analysis of zhang et al 2000 concerned with representative elementary volumes rev of sandstones and samples with crushed beads one can observe that the permeability converges for increasing network size 4 discussion a comparison of the characteristics of the sandstone and carbonate network has shown that while these networks have very similar pore throat counts and similar throat radius statistics pores appear clustered in the less conductive carbonate while they are uniformly distributed in the more conductive sandstone accordingly random network generation methods that do not account for the pore clustering were found to match the permeability of the sandstone reasonably well while overestimating the carbonate permeability by tenfold in this respect centroid based dendrograms were found to be a useful tool to represent pore clustering furthermore to generate new network realizations dendrograms enable through the definition of a cutoff size the controlled random perturbation of an existing network the resulting realizations match both the joint pore throat statistics and the permeability of base networks for uniform and clustered pore distributions and at the same time display a realistic statistical variability the dendrogram based generation algorithm has been implemented in a computationally efficient manner producing network realizations at a computational cost that scales linearly with the size or pore count of the network the dendrogram based algorithm however has a tendency to enhance clustering during random rotations as the original node distances in clusters are preserved while smaller distances may get introduced see fig 1a and c or previously isolated cluster sections may overlap in order to reduce such effects a cutoff size was introduced that sets an upper size limit to clusters that are randomly and recursively rotated in the dendrogram in this work and as a guideline for other media the cutoff size was resp shall be chosen such that the positions of clusters that are uniformly distributed in the base network remain unchanged while the inner non uniform or irregular structure of these clusters is randomly perturbed with the generated networks being periodic in space thus implying a uniform cluster distribution at scales above the base network size an upper limit for the cutoff of half the smallest base network side length is implied alternative measures to counteract cluster enhancement would be the addition of a diffusive pore displacement or a mechanism that restricts the random rotation angles in order to avoid overlapping clusters while the networks studied in this contribution were isotropic anisotropic ones could be treated by using non uniform rotation angle distributions in the random perturbation step alternatively the base network could be simply scaled to arrive at an isotropic network followed by a rescaling step of the generated realizations moreover interesting will be the application of the new generation method to multi phase flows since the random network realizations closely emulate the geometrical reality of the base network viscous capillary and inertial forces scaling each differently with respect to the geometric network properties are expected to be statistically in close agreement with their counterparts in the base network credit authorship contribution statement daniel w meyer conceptualization formal analysis investigation methodology software validation writing original draft declaration of competing interest author have no conflict of interest acknowledgments the author gratefully acknowledges very helpful input from anastasios papageorgiou eth zürich during several discussions at the early stages of this work furthermore he is very thankful to branko bijeljic and ali raeini from the imperial college london for making the network data available and acknowledges financial support from eth zürich finally very helpful comments by branko bijeljic on the initial version of the manuscript are gratefully acknowledged 
313,fine temporal resolution streamflow records offer valuable information to further our understanding of watershed function among the many tools to decipher watershed processes recession analysis can be used to gain insight into storage discharge properties and watershed storage by analyzing portions of stream hydrographs whose behavior is attributed to the relationship between aquifer structure and groundwater outflow to the steam channel although numerous methods have been employed to advance recession analysis methodology no comprehensive approach to identify the cessation or continuation of recession events from fine temporal resolution data has been established a new extraction algorithm the hydrograph recession extraction algorithm hydra is proposed to improve identification of recession events from fine temporal resolution hydrographs hydra exploits site specific stage discharge relations to qualify the beginning or end of a hydrograph recession by accounting for stage measurement error which translates to uncertainty in the stream hydrograph experiments compared hydra to previous published methods revealing that hydra led to significant improvements in identifying the continuation of recession events resulting in superior estimation of theoretical recession parameter values additional case studies assert that hydra robustly identifies recession events across a spectrum of temporal resolution discharge records affirming that the extraction algorithm provides a functional tool to identify recession events for further recession based theoretical analysis keywords recession analysis recession parameters watershed function 1 introduction and background extracting information from a stream hydrograph to decipher the interplay of how a watershed stores transmits and discharges water applies a variety of statistical methods including hydrograph recession analysis barnes 1939 brutsaert and nieber 1977 hydrograph recession analysis has played an important role in defining watershed function by combining the nature of storage and discharge in watershed processes black 1997 the central hypothesis of hydrograph recession analysis is that the dynamic balance between watershed storage and discharge is identifiable in the streamflow hydrograph and that consistent and reproducible methods allow for the characterization between surface water and groundwater systems stoelzle et al 2013 a key factor in applying hydrograph recession theory is the extraction of recession hydrographs that represent discharge derived exclusively from long term watershed storage hall 1968 referred to in this analysis as a recession event as stated by brutsaert and nieber 1977 it is practically impossible to determine in any consistent way the beginning of each recession from a continuous flow record with intermitted dry and wet periods reflecting the difficulty in extracting recession events from streamflow records numerous investigations have applied streamflow recession theories to detangle complex watershed processes biswal and marani 2010 brutsaert and lopez 1998 kirchner 2009 szilagyi et al 2007 tashie et al 2020 zecharias and brutsaert 1988 in these applications the power law model suggested by brutsaert and nieber 1977 was applied given as 1 d q d t a q b where a and b are recession parameters that collectively define the shape of the recession hydrograph curve originally applied to daily streamflow in glacially influenced watersheds the methods to evaluate watershed scale processes applied simple difference estimators to extract the rate of streamflow change dq dt attributed to the relation between watershed storage s and streamflow q although numerous studies have shown that the estimation of recession parameters are sensitive to the methods applied chen and krajewski 2016 roques et al 2017 stoelzle et al 2013 thomas et al 2015 the approach of brutsaert and nieber has been successfully employed to further our understanding of watershed processes smakhtin 2001 tallaksen 1995 advances in methods to estimate the time derivative of streamflow dq dt from hydrograph recessions requires streamflow hydrographs with suitable temporal resolution roques et al 2017 rupp and selker 2006 to provide flexibility in scaled time increments δt the u s geological survey usgs was historically tasked to quantify irrigation supplies in the arid southwestern us follansbee 1994 a task fulfilled by analyzing daily streamflow estimates the need for accurate watershed discharge data has resulted in daily streamflow record archives dating back to the 1880s for many large watersheds in the us advances in statistical hydrology data needs to support a plethora of environmental concerns and advances in data logging equipment resulted in the increased number of gage sites with recorded sub daily streamflow records fig 1 the rapid increase in streamflow records available at sub daily temporal resolution when combined with improved methods to estimate the time derivative of streamflow are supposed to elucidate watershed processes that were previously undetectable when applying daily records here it is argued that robust identification of recession events becomes an impediment to compelling recession analysis as the temporal resolution of discharge records improve the nuance in identifying the start and end of recession hydrographs increases as temporal resolution of streamflow observations increases algorithms were originally introduced applying moving average inflections to identify the start and end of a candidate recession vogel and kroll 1992 a myriad of approaches later followed evolving to include derivative analyses dralle et al 2017 and finite difference thresholds chen and krajewski 2016 jachens et al 2020 shaw and riha 2012 auxiliary datasets were incorporated to identify suitable hydrograph recessions based on the assumption that the rising limb of the hydrograph is driven by precipitation events in the watershed brutsaert and nieber 1977 kirchner 2009 thomas et al 2013 thomas et al 2015 identification of recession events employing methods applied to daily discharge records are presumed to be ineffective as the temporal resolution of the discharge records increases i e 5 min discharge data fig 1 identifying useful information from hydrograph records to apply recession analysis requires an explicit and reproducible algorithm to extract recession events numerous factors may influence streamflow uncertainty hamilton and moore 2012 kiang et al 2018 uncertainty in flow estimation derived from rating curves can be significant mcmillan et al 2012 representing statistically consistent error into discharge estimates that can be applied to identify recession events the goal of this study is to develop and test a recession event extraction algorithm that may be applied to stream hydrographs without regard to temporal resolution of the discharge data by accounting for errors attributed to rating curve estimation the central assumption of this analysis is that robust and reproducible extraction of recession events that capture the influence of slow release of water from watershed storage to a stream will result in optimal characterization of groundwater surface water interaction 2 material and methods 2 1 recession analysis methods 2 1 1 extraction of hydrograph events hydra whereas previous algorithms to identify and extract recession events were originally applied to daily streamflow hydrographs there remains no comprehensive scientific approach to extract recession events from sub daily streamflow records the proposed hydrograph recession extraction algorithm hydra seeks to employ a source of discharge uncertainty arising from the formulation of rating curves and streamflow estimation to evaluate the cessation or continuation of the recession pelletier 1988 summarized numerous factors that influence the magnitude of uncertainty in the estimation of stream discharge pelletier s summary largely focused on uncertainty in applying the velocity area method to retrieve an estimate of discharge a valuable tool applied by the usgs to derive rating curves from field based measurements numerous factors attribute to discharge uncertainty di baldassarre and montanari 2009 horner et al 2018 kiang et al 2018 mcmillan and westerberg 2015 of interest here the indirect estimation of continuous flow from stage measures generate uncertainties related to measurement error and approximating the stage discharge relation by some mathematical function kiang et al 2018 applied several methods to evaluate uncertainty in streamflow records derived from stage measurements and rating curve formulations usgs applies numerous streamflow measurements standards to mitigate uncertainties to produce robust discharge records sauer 2002 sauer and meyer 1992 whilst acknowledging stage height measurement errors of 0 01ft 3 048 mm propagation of uncertainties due to these numerous factors is amplified within nonlinear rating curve formulations spurring numerous approaches in which to relate stage and discharge guerrero et al 2012 herschy 1985 manfreda 2018 sikorska et al 2013 tomkins 2014 westerberg et al 2011 whilst the streamflow uncertainty applied in hydra do not account for the countless sources of error and uncertainty in streamflow use of rating curves and stage error provides an easily applied and reproducible methodology to identify recession events at question in determining the continuation or cessation of a recession event is our ability to decide if a streamflow hydrograph segment is in fact a continuation of the recession event that may provide information to express the theoretical relationship between aquifer structure and groundwater outflow to the stream channel in the simplest approach the uncertainty in discharge propagated from stage measurement uncertainty is used to estimate an upper and lower bound of the previous qt 1 and current qt discharge put directly is the previous time step flow plus uncertainty larger than the current time step flow minus uncertainty an answer of yes implies that the hydrograph remains in decline and thus collection of hydrograph flows representing the draining of the watershed should continue as the method relies only on the comparison between the current and previous discharge observation the method is invariant to temporal resolution of the flow records to estimate discharge uncertainty bounds the stage measurement error of 0 01 ft 3 048 mm is applied with a 2nd order polynomial equation to relate stage and discharge application of polynomial equations for rating curves are advantageous in hydra since polynomials have been shown to accurately account for the nonlinear relation between stage and discharge herschy 1985 sivapragasam and muttil 2005 yu 2000 gage specific rating curve data were retrieved from the usgs and fit to a 2nd order polynomial given by 2 q a β 1 x β 2 x 2 where x represents stage height l and q represents discharge l3 t in this algorithm 20 neighboring paired stage discharge values matched to qt and qt 1 were fit with eq 2 to extract upper and lower flow bounds respectively hydra applies 20 neighboring paired stage discharge values in the algorithm as the bias in retrieving stage discharge values from synthetic recession discharges section 2 2 1 decreased while increasing the number of neighboring stage discharge points up to 20 after which no marked decrease in bias was noted an exact stage measure corresponding to qt and qt 1 was calculated using eq 2 to which a constant error of 0 01ft 3 048 mm was added subtracted to estimate an upper lower limit δ for qt and qt 1 respectively hydra proceeds by comparing the resulting factors i e if qt 1 δ t 1 qt δ t to continue or end the recession event and is thus invariant to the temporal resolution of the discharge data applied alternative extraction methods numerous authors have tested the influence of recession hydrograph extraction in the interpretation of recession parameters these approaches have often been applied for daily discharge records vogel and kroll 1996 1992 with few identified extraction approaches applicable to sub daily records recent studies by dralle et al 2017 applied combinations of 4 extraction factors including flow peaks to identify the start of a recession event and first second derivatives of the hydrograph to identify the end of the recession event jachens et al 2020 applied a stage uncertainty criterion for synthetic hydrographs chen and krajewski 2016 applied a fixed uncertainty of discharge following estimates by shaw and riha 2012 where an uncertainty of 0 1 mm d for basins of 100 km2 were estimated these previous extraction methods are applied here as a comparison to hydra following dralle et al 2017 a recession was deemed to begin at a peak flow and continue until the first derivative dq dt changes from negative to positive and the concavity d 2 q dt 2 changes from positive to negative the usgs cites errors of 2 for any given discharge considered a maximum uncertainty in flow sauer 2002 relating to the approach of shaw and riha 2012 an error uncertainty was applied whereby a 2 error in flow is used to identify an upper and lower bound further a 1 error was tested as small watersheds may not exhibit the maximum uncertainty recognized by the usgs 2 1 2 estimation of the time derivative of streamflow dq dt the exponential time step ets method roques et al 2017 exploits the exponential like decay often observed in hydrograph recessions barnes 1939 singh and stall 1971 the ets method additionally applies the variable time step approach of rupp and selker 2006 to reduce artifacts in the recession plot by incrementing the time step δt exponentially through the recession the ets method applies an integer m representing the number of streamflow values within an interval of time δti t i m t i given by 3 m t 1 n e 1 γ t where γ is related to the characteristic timescale of a basin determined by fitting an exponential function q t qoe γt for individual hydrograph recession curves in eq 3 n is a user defined variable to set a maximum interval of the hydrograph recession curve to compute dq dt we may thus estimate dq dt where 4 d q d t q i q i m t i m t i given that q represents discharge from an exponential function fit roques et al 2017 identified the method sensitivity to n or the fraction of the hydrograph recession used to estimate dq dt whereby n dt 15 days was found to extract consistent results from a single synthetic recession hydrograph with hourly discharge over a period of 118 days in many instances hydrograph recessions may not continue for a similar length of time thus requiring inspection of n values to estimate dq dt here n was set to 0 25 for all evaluations for a full description of the ets method development the reader is referred to roques et al 2017 2 1 3 fitting envelopes quantile regression derivatives of noisy streamflow time series can unduly influence estimation of recession parameters in eq 1 due to outlier data when applying ordinary linear regression quantile regression methods can mitigate influence and leverage of outlier data within the recession plot thomas et al 2015 when fitting envelopes to the recession cloud in this study median characteristics are hypothesized to reflect attributes extracted from the recession events thus median envelopes were fit to the single recession data cloud such that a fixed percentage of 50 of data falls above and below the envelope the approach applied here deviates from previous applications including brutsaert and nieber 1977 who suggested an envelope fit such that 95 of the data cloud was above the envelope to allow for measurement errors associated with flow estimation during low flow conditions and uncertainty associated with the determination of baseflow conditions 2 2 data 2 2 1 synthetic hydrograph recessions analytical approximations for recession discharges parlange et al 2001 were used to produce synthetic hydrographs which take the value of b 3 during early portions of the recession hydrograph transitioning to a value of b 3 2 for late recessions the synthetic recessions were produced using values as applied by roques et al 2017 at 15 min intervals for a period of 30 days appendix a as we are interested in applying hydra stream stage was retrieved by routing the generated recession discharges qsyn through a rectangular stream channel with various widths 0 5 m 0 75 m 1 0 m 1 5 m 2 0 m applying the manning equation a roughness coefficient n 0 066 was selected to emulate a natural rocky riverbed for all simulations having both streamflow and corresponding stream stage ssyn a synthetic rating curve was generated using eq 2 routing discharge through various width channels results stage ranges for a given discharge time series effectively creating sensitivity in the rating curve to retrieve measures of discharge from stage measurements to account for this sensitivity a rating curve metric is applied given as the ratio of coefficient of variation of discharge to the coefficient of variation of stage the range of rating curve metric values for the synthetic hydrographs is provided in table 1 noise e t was introduced into the stage time series following chen and krajewski 2016 where it was assumed that streamflow errors are correlated uncorrelated errors ε t were generated from a normal distribution n 0 σ while applying a first order autoregressive model 5 e t ρ e t 1 ε t where ρ 0 5 based on an average correlation evaluated by chen and krajewski 2016 translation of error to standard deviation assumed that the error reported by usgs 0 01ft 3 048 mm represented 2 σ thus accounting for correlation equates to a standard deviation of 1 ρ 2 σ 1 31 mm the resulting stage with error s syn t e t was fed through eq 2 to produce a hydrograph recession curve that exhibited flow variability attributed to stage uncertainty 2 2 2 usgs streamflow records real time usgs streamflow records were filtered to identify sites with limited human interaction lins 2012 additional site selection filtering was applied to identify small 10 100 km2 watersheds with 10 year wy2010 wy2020 records and at least 15 min temporal resolution an inherent assumption in the characterization of groundwater surface water interactions is that a hydraulic connection between the stream channel and the aquifer contributing baseflow to the stream exists and is perceptible within the stream hydrograph to relate possible groundwater surface water interaction within the watershed the baseflow index bfi is applied where site bfi ranges from 0 23 to 0 74 table 2 further to characterize relations between the variability in stage and discharge records within the rating curve data a ratio of the coefficient of variation of discharge to the coefficient of variation of stage measures was estimated watershed general characteristics are summarized in table 2 2 3 experiments performed the central hypothesis of the analysis is that robust extraction of recession events that represent the slow release of water from watershed storage enhance our ability to evaluate watershed responses influenced by groundwater surface water interactions experiments were performed to test this hypothesis using synthetic recession curves derived from groundwater theory with known late recession exponent values in these experiments channel width translates to a range in stage for an identical discharge thus reflecting conditions whereby incremental changes in stage correspond to increases in discharge a robust recession algorithm is further hypothesized to identify concurrent recession events invariant to temporal resolution of the discharge data additional tests were performed using time steps of 15 min 1 h 6 h and 24 h using usgs streamflow records at 40 sites to assess algorithm extraction performance in applying hydra stage uncertainty was fixed at 3 048 mm in the monte carlo evaluation of synthetic hydrograph recessions a total of 1000 iterations were performed whereby suitable hydrograph recessions were extracted using the various algorithms identical recession extraction algorithms were applied to usgs streamflow whereby the entire hydrograph records were fed through the algorithms to identify recession events 3 results 3 1 synthetic hydrograph results results obtained from the synthetic hydrograph monte carlo experiments are depicted in fig 2 for each iteration noise was introduced to the stage time series to produce random irregularities to the recession discharge eq 5 each algorithm extraction method was applied to the same recession event to identify a suitable discharge time series to which the ets method was applied to estimate the time derivative of streamflow dq dt and quantile regression to estimate the recession exponent from the data cloud within the recession plot the panels in fig 2 isolate results based on the recession event extraction algorithm and within each panel estimates of the recession exponent are further parsed on the temporal resolution of the discharge data the hypothesis tested here assumed that robust extraction algorithms identify continuation of the recession event thus the focus of the test is on late time recession behavior where b 3 2 to capture late time response in the discharge data recession events with lengths greater than 10 days were extracted when estimating the recession exponent an absence of recession exponent estimates within fig 2 for a particular extraction algorithm and temporal resolution suggests no suitable recession events were extracted which fulfilled recession event length criteria the derivative extraction method failed to identify recession events that satisfied event length requirements 10 d for fine temporal resolution hydrographs fig 2a where recession events were extracted to provide an estimate of the recession exponent the results were found to be less than theoretical values of b 3 2 the estimate median value being below the early time recession value of b 3 and late time recession value of b 3 2 is attributed to the performance of the algorithm whereby an early recession event which occurred in the initial portion of the 30 day recession event time series was inaccurately identified to end in the same 30 day recession time series a second recession event was identified and extracted resulting in a recession cloud that effectively accounted for 2 recession events as documented by jachens et al 2020 interpretation of individual recession dynamics is masked by analyzing a recession cloud derived from numerous recession events as fitting envelopes to the recession cloud captures the generality of the entire cloud often resulting in recession exponent estimates smaller than recession exponent estimates from individual recession events as the temporal resolution of discharge observations increases it becomes increasingly likely that random irregularities introduced into the stage times series results in erratic discharge estimates thus influencing the extraction of long recession events given that recession events are terminated due to a change in concavity recession exponent estimates are depicted in fig 2b applying 1 error in flow to extract recession events the algorithm effectively extracted recession events from which recession exponent estimates could be made and the estimates were generally accurate with respect to the theoretical value of b 3 2 under restraints of a narrow channel width 0 5 m and 24 h temporal resolution fig 2b illustrates the systematic influence of channel width and the corresponding ranges in stage for an identical discharge time series on our ability to suitably identify recession events white noise error n 0 σ added to synthetic stage estimates further introduced irregularities in flow derived from eq 2 because of nonlinear relations between stage and discharge these random incremental stage irregularities inhibited the algorithm from extracting representative recession hydrographs for the estimation of the recession exponent the influence of a noisy time series was amplified for the case of fine temporal resolution i e 15 min and 1 h where no suitable recession events were extracted with increasing channel width the results suggest that applying a 1 constant error extraction algorithm fails to effectively identify the cessation of recession hydrographs from which robust recession exponents may be estimated particularly as the temporal resolution of the discharge records decreases applying an extraction algorithm which compared a constant discharge error of 2 similarly resulted in a large range in the recession exponent estimates for wide channels and short time steps fig 2c recession exponents were near theoretical values for late recession behavior under conditions of channel widths less than 1 meter the systematic influences of temporal resolution and channel width observed in the range of recession exponent estimates was most notable for fine temporal resolution i e 15 min data where the introduction of noise to the recession hydrograph resulted in an irregular time series which effectively limited efficient identification of recession cessations often timing the recession curve cessation during the early portion of the recession where the theoretical value of the recession exponent is 3 an extraction algorithm applying 2 error in discharge performs well in cases of narrow channel widths where the range in stage for any given discharge is larger as compared to wide channels the robust extraction of recession events whereby hydra effectively identified continuation of the recession event to capture late time recession behavior resulted in recession exponent estimates near the theoretical late recession value of b 3 2 fig 2d the algorithm performed well to identify continuation of recession events into late time recessions across all variables tested including channel width and discharge temporal resolution the median and quantile ranges depicted in fig 2d document robust estimation of the recession exponent despite factors including channel width discharge temporal resolution and noise introduced to the discharge time series the algorithm further effectively applied rating curve relations to negate the influence of various factors thus illustrating the algorithms flexibility for application to streamflow records lastly the method was found to be invariant to discharge temporal resolution as hydra only compares the current and previous time step flows 3 2 usgs recession results whereas we may quantitatively assess our ability to estimate the recession exponent based on the extraction of hydrograph recession events from theoretical recession discharges direct assessment using collected streamflow records are impractical as one never knows the true value of recession parameters to further test the performance of the extraction algorithms 39 usgs gage sites were identified these selected gage sites are recognized as having limited direct human interferences lins 2012 have a complete hydrologic record over the period wy2010 wy2020 and temporal resolution of at least 15 min and span various climate and land use landscapes table 2 recognizing that a priori recession parameter values are unknown the hypothesis applied here relates to our ability to effectively identify the beginning and end of a recession event a robust extraction algorithm is deemed to systematically identify recession events without regard to temporal resolution of the discharge data to test the hypothesis two experiments were performed comparing the overlapping i e concurrent recession events extracted from the hydrographs all experiments extracted recession events that continue at least 4 days in the first experiment extracted recession events from the various algorithms were compared with recession events extracted from hydra for identical temporal resolution in fig 3 each line depicts concurrent matches from a single hydrograph table 2 whereby extracted recession events are compared to extracted recession events from hydra further to test the influence of the temporal resolution on recession event extraction the analysis was completed for time steps of 15 min 1 h 6 h and 24 h results depicted in fig 3a thus represent comparison between the algorithms to hydra for 15 min intervals whereby the y axis represents the percent concurrent recession the results depicted in fig 3 document consistent underperformance from the derivative extraction algorithm with an increase in performance noted as the temporal resolution of the discharge data decreased at the daily time step fig 3d the derivative method performed well across most stations to capture concurrent recession events with a systematic relation with bfi noted whereby poor concurrent matches when applying hydra tended to correlate with low bfi the error based methods performed well under conditions of coarse temporal resolutions fig 3c 3d generally matching 60 or more of the recession events extracted by hydra a second comparison of concurrent recession events is illustrated in fig 4 whereby concurrent recession event matches are relative to 24 h hydra extracted recession events in fig 4 each line depicts concurrent recession event match from a single hydrograph whereby extracted recession events are compared to recession events obtained from 24 h hydrograph resolution data using hydra in fig 4a the derivative extraction methods again reflect poor performance at fine temporal resolution matching less than 60 for all gage stations with increasing performance noted as the temporal resolution in discharge data decreases the error based results fig 4b 4c depict similar trends whereby concurrent overlap between recession events under fine temporal resolution conditions are low with increasing concurrent overlap noted as the temporal resolution decreased a comparison of hydra extraction methods across time steps fig 4d further documents a range of performance at 15 min temporal resolution with matches generally 70 for 1 h resolution no clear systematic influence in relation to bfi was noted in the concurrent recession event matching experiment with the exception of results depicted in fig 4d where hydra recession extraction at various temporal resolutions was compared to 24 h temporal resolution recession events in fig 4d gages with poor concurrent recession event match tended to correlate with low bfi for example sites with 50 match at a temporal resolution of 15 min tended to exhibit low bfi bfi 50 with the exception of usgs site 13317000 with a bfi of 73 5 4 discussion consistent and robust methods to identify the cessation or continuation of recession events for recession analysis increases in importance as the number of stream gage sites with finer temporal resolution records increases fig 1 the characterization of watershed function is inherently linked to our ability to justify when a recession event starts and when a recession event ends where continuation of the recession event is deemed to add information from which more robust evaluation to interpret groundwater surface water interactions can be made whereas previous hydrograph recession curve extraction methods were based on daily data thomas et al 2013 vogel and kroll 1992 or relative flow uncertainty dralle et al 2017 jachens et al 2020 shaw and riha 2012 the algorithm presented here accounts for gage specific relations between stage and discharge in the simplest approach reported stage error of 0 01ft 3 048 mm was applied to extract recession events resulting in robust estimates of recession exponents from synthetic recession hydrographs relative flow error approaches were documented to perform well in specific cases for example under conditions where the ratio of the coefficient of variation in discharge to the coefficient of variation in stage was below 1 5 yet were inconsistent in extracting suitable recession events for analysis in comparison hydra suitably identified recession event continuation thus extracting representative recession events from the late time hydrographs from which precise and robust recession exponent estimates could be made hydra was invariant to the influence of stage ranges regulated by channel widths resulting in robust recession exponent estimates the range in recession exponent estimates was generally higher as the temporal resolution of the discharge data decreased and generally increased as a function of discharge sensitivity given as the coefficient ration of discharge to stage such a result suggests that concerns regarding short term flow variability are warranted and may influence identification of the end of recession events in the stream hydrograph when applied to observed discharge records hydra extracted concurrent recession events efficiently without regard to the temporal resolution of the data figs 3 and 4 as documented in fig 4 hydra and the error based extraction algorithms efficiently extracted concurrent recession events as compared to the 24 h hydra extractions for the sites whereas the derivative method failed to achieve high percentage concurrent comparisons for sub daily discharge records hydra approached identification of the cessation or continuation of the recent event in simple terms where time step comparisons in flow used a stage error of 3 048 mm numerous sources of river discharge uncertainty mcmillan et al 2012 were not accounted for in the development of hydra to bypass these issues synthetic discharges were fed through various channel widths to account for uncertainties that may arise through indirect calculation of discharge data from stage measurements future application of the algorithm could account for relations between stage uncertainty and discharge sensitivity or to account for the correlation in stage error mcmillan and westerberg 2015 as the number of gage sites with fine temporal resolution data continues to increase it is vital for consistent reproducible methods be applied to further our understanding of watershed processes hydra applied a constant value of stage error which could be enhanced to account for the relation of stage uncertainty as a function of flow and the correlation in stage uncertainty although the performance of hydra was deemed superior to the tested methods the method cannot be universally applied given the need for site specific stage discharge data without site specific data to evaluate stage discharge relations error based methods may provide a suitable alternative to identify recession events it is important to note however that as temporal resolution of the data increases it is increasingly likely that error based methods may extract hydrographs which are not truly reflective of recession events thus requiring great care to identify recession events when applying such methods although hydra outperformed the extraction algorithms tested on 15 min temporal resolution discharge data results summarized in figs 3 and 4 suggest significant limitations in extracting recession events from very fine temporal resolution data in comparison the recession events extracted from 1h discharge records were found to be more consistent documenting that whenever possible extraction algorithms should be performed at 1h or greater temporal resolution when applying hydra despite the simple methods applied in hydra the estimates were robust and may thus be applied to increase our ability to comparative recession analysis funding this research did not receive any specific grant from funding agencies in the public commercial or not for profit sectors author statement all work was completed by the author declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments all streamflow data analyzed in this study are freely available from the usgs https waterdata usgs gov nwis hydra may be downloaded from github https github com bfthomas hydro hydra upon requesting a password the author expresses his appreciation to one anonymous reviewers reviewers arik tashie and clément roques and editor graham sanders appendix a parlange et al 2001 computed dimensionless discharge q as a function of dimensionless time t considering a horizontal aquifer with breadth b and aquifer depth d q α 1 e 1 t t 1 5 λ 1 π 2 α λ 2 μ π e r f c 1 t ν 1 e 1 t t 3 2 where ν 7 λ 1 5 4 λ 2 1 4 and α λ 1 λ 2 ν π 0 3320606 q and t may be translated to dimensional variables by applying known aquifer characteristics including hydraulic conductivity k and the specific yield f and watershed characteristics including watershed area a by q k a d 2 b 2 q g i v e n a 2 b l and t f b 2 d k t for this analysis l 100 m k 0 0001 m s 1 b 100 m d 10 m and f 0 10 
313,fine temporal resolution streamflow records offer valuable information to further our understanding of watershed function among the many tools to decipher watershed processes recession analysis can be used to gain insight into storage discharge properties and watershed storage by analyzing portions of stream hydrographs whose behavior is attributed to the relationship between aquifer structure and groundwater outflow to the steam channel although numerous methods have been employed to advance recession analysis methodology no comprehensive approach to identify the cessation or continuation of recession events from fine temporal resolution data has been established a new extraction algorithm the hydrograph recession extraction algorithm hydra is proposed to improve identification of recession events from fine temporal resolution hydrographs hydra exploits site specific stage discharge relations to qualify the beginning or end of a hydrograph recession by accounting for stage measurement error which translates to uncertainty in the stream hydrograph experiments compared hydra to previous published methods revealing that hydra led to significant improvements in identifying the continuation of recession events resulting in superior estimation of theoretical recession parameter values additional case studies assert that hydra robustly identifies recession events across a spectrum of temporal resolution discharge records affirming that the extraction algorithm provides a functional tool to identify recession events for further recession based theoretical analysis keywords recession analysis recession parameters watershed function 1 introduction and background extracting information from a stream hydrograph to decipher the interplay of how a watershed stores transmits and discharges water applies a variety of statistical methods including hydrograph recession analysis barnes 1939 brutsaert and nieber 1977 hydrograph recession analysis has played an important role in defining watershed function by combining the nature of storage and discharge in watershed processes black 1997 the central hypothesis of hydrograph recession analysis is that the dynamic balance between watershed storage and discharge is identifiable in the streamflow hydrograph and that consistent and reproducible methods allow for the characterization between surface water and groundwater systems stoelzle et al 2013 a key factor in applying hydrograph recession theory is the extraction of recession hydrographs that represent discharge derived exclusively from long term watershed storage hall 1968 referred to in this analysis as a recession event as stated by brutsaert and nieber 1977 it is practically impossible to determine in any consistent way the beginning of each recession from a continuous flow record with intermitted dry and wet periods reflecting the difficulty in extracting recession events from streamflow records numerous investigations have applied streamflow recession theories to detangle complex watershed processes biswal and marani 2010 brutsaert and lopez 1998 kirchner 2009 szilagyi et al 2007 tashie et al 2020 zecharias and brutsaert 1988 in these applications the power law model suggested by brutsaert and nieber 1977 was applied given as 1 d q d t a q b where a and b are recession parameters that collectively define the shape of the recession hydrograph curve originally applied to daily streamflow in glacially influenced watersheds the methods to evaluate watershed scale processes applied simple difference estimators to extract the rate of streamflow change dq dt attributed to the relation between watershed storage s and streamflow q although numerous studies have shown that the estimation of recession parameters are sensitive to the methods applied chen and krajewski 2016 roques et al 2017 stoelzle et al 2013 thomas et al 2015 the approach of brutsaert and nieber has been successfully employed to further our understanding of watershed processes smakhtin 2001 tallaksen 1995 advances in methods to estimate the time derivative of streamflow dq dt from hydrograph recessions requires streamflow hydrographs with suitable temporal resolution roques et al 2017 rupp and selker 2006 to provide flexibility in scaled time increments δt the u s geological survey usgs was historically tasked to quantify irrigation supplies in the arid southwestern us follansbee 1994 a task fulfilled by analyzing daily streamflow estimates the need for accurate watershed discharge data has resulted in daily streamflow record archives dating back to the 1880s for many large watersheds in the us advances in statistical hydrology data needs to support a plethora of environmental concerns and advances in data logging equipment resulted in the increased number of gage sites with recorded sub daily streamflow records fig 1 the rapid increase in streamflow records available at sub daily temporal resolution when combined with improved methods to estimate the time derivative of streamflow are supposed to elucidate watershed processes that were previously undetectable when applying daily records here it is argued that robust identification of recession events becomes an impediment to compelling recession analysis as the temporal resolution of discharge records improve the nuance in identifying the start and end of recession hydrographs increases as temporal resolution of streamflow observations increases algorithms were originally introduced applying moving average inflections to identify the start and end of a candidate recession vogel and kroll 1992 a myriad of approaches later followed evolving to include derivative analyses dralle et al 2017 and finite difference thresholds chen and krajewski 2016 jachens et al 2020 shaw and riha 2012 auxiliary datasets were incorporated to identify suitable hydrograph recessions based on the assumption that the rising limb of the hydrograph is driven by precipitation events in the watershed brutsaert and nieber 1977 kirchner 2009 thomas et al 2013 thomas et al 2015 identification of recession events employing methods applied to daily discharge records are presumed to be ineffective as the temporal resolution of the discharge records increases i e 5 min discharge data fig 1 identifying useful information from hydrograph records to apply recession analysis requires an explicit and reproducible algorithm to extract recession events numerous factors may influence streamflow uncertainty hamilton and moore 2012 kiang et al 2018 uncertainty in flow estimation derived from rating curves can be significant mcmillan et al 2012 representing statistically consistent error into discharge estimates that can be applied to identify recession events the goal of this study is to develop and test a recession event extraction algorithm that may be applied to stream hydrographs without regard to temporal resolution of the discharge data by accounting for errors attributed to rating curve estimation the central assumption of this analysis is that robust and reproducible extraction of recession events that capture the influence of slow release of water from watershed storage to a stream will result in optimal characterization of groundwater surface water interaction 2 material and methods 2 1 recession analysis methods 2 1 1 extraction of hydrograph events hydra whereas previous algorithms to identify and extract recession events were originally applied to daily streamflow hydrographs there remains no comprehensive scientific approach to extract recession events from sub daily streamflow records the proposed hydrograph recession extraction algorithm hydra seeks to employ a source of discharge uncertainty arising from the formulation of rating curves and streamflow estimation to evaluate the cessation or continuation of the recession pelletier 1988 summarized numerous factors that influence the magnitude of uncertainty in the estimation of stream discharge pelletier s summary largely focused on uncertainty in applying the velocity area method to retrieve an estimate of discharge a valuable tool applied by the usgs to derive rating curves from field based measurements numerous factors attribute to discharge uncertainty di baldassarre and montanari 2009 horner et al 2018 kiang et al 2018 mcmillan and westerberg 2015 of interest here the indirect estimation of continuous flow from stage measures generate uncertainties related to measurement error and approximating the stage discharge relation by some mathematical function kiang et al 2018 applied several methods to evaluate uncertainty in streamflow records derived from stage measurements and rating curve formulations usgs applies numerous streamflow measurements standards to mitigate uncertainties to produce robust discharge records sauer 2002 sauer and meyer 1992 whilst acknowledging stage height measurement errors of 0 01ft 3 048 mm propagation of uncertainties due to these numerous factors is amplified within nonlinear rating curve formulations spurring numerous approaches in which to relate stage and discharge guerrero et al 2012 herschy 1985 manfreda 2018 sikorska et al 2013 tomkins 2014 westerberg et al 2011 whilst the streamflow uncertainty applied in hydra do not account for the countless sources of error and uncertainty in streamflow use of rating curves and stage error provides an easily applied and reproducible methodology to identify recession events at question in determining the continuation or cessation of a recession event is our ability to decide if a streamflow hydrograph segment is in fact a continuation of the recession event that may provide information to express the theoretical relationship between aquifer structure and groundwater outflow to the stream channel in the simplest approach the uncertainty in discharge propagated from stage measurement uncertainty is used to estimate an upper and lower bound of the previous qt 1 and current qt discharge put directly is the previous time step flow plus uncertainty larger than the current time step flow minus uncertainty an answer of yes implies that the hydrograph remains in decline and thus collection of hydrograph flows representing the draining of the watershed should continue as the method relies only on the comparison between the current and previous discharge observation the method is invariant to temporal resolution of the flow records to estimate discharge uncertainty bounds the stage measurement error of 0 01 ft 3 048 mm is applied with a 2nd order polynomial equation to relate stage and discharge application of polynomial equations for rating curves are advantageous in hydra since polynomials have been shown to accurately account for the nonlinear relation between stage and discharge herschy 1985 sivapragasam and muttil 2005 yu 2000 gage specific rating curve data were retrieved from the usgs and fit to a 2nd order polynomial given by 2 q a β 1 x β 2 x 2 where x represents stage height l and q represents discharge l3 t in this algorithm 20 neighboring paired stage discharge values matched to qt and qt 1 were fit with eq 2 to extract upper and lower flow bounds respectively hydra applies 20 neighboring paired stage discharge values in the algorithm as the bias in retrieving stage discharge values from synthetic recession discharges section 2 2 1 decreased while increasing the number of neighboring stage discharge points up to 20 after which no marked decrease in bias was noted an exact stage measure corresponding to qt and qt 1 was calculated using eq 2 to which a constant error of 0 01ft 3 048 mm was added subtracted to estimate an upper lower limit δ for qt and qt 1 respectively hydra proceeds by comparing the resulting factors i e if qt 1 δ t 1 qt δ t to continue or end the recession event and is thus invariant to the temporal resolution of the discharge data applied alternative extraction methods numerous authors have tested the influence of recession hydrograph extraction in the interpretation of recession parameters these approaches have often been applied for daily discharge records vogel and kroll 1996 1992 with few identified extraction approaches applicable to sub daily records recent studies by dralle et al 2017 applied combinations of 4 extraction factors including flow peaks to identify the start of a recession event and first second derivatives of the hydrograph to identify the end of the recession event jachens et al 2020 applied a stage uncertainty criterion for synthetic hydrographs chen and krajewski 2016 applied a fixed uncertainty of discharge following estimates by shaw and riha 2012 where an uncertainty of 0 1 mm d for basins of 100 km2 were estimated these previous extraction methods are applied here as a comparison to hydra following dralle et al 2017 a recession was deemed to begin at a peak flow and continue until the first derivative dq dt changes from negative to positive and the concavity d 2 q dt 2 changes from positive to negative the usgs cites errors of 2 for any given discharge considered a maximum uncertainty in flow sauer 2002 relating to the approach of shaw and riha 2012 an error uncertainty was applied whereby a 2 error in flow is used to identify an upper and lower bound further a 1 error was tested as small watersheds may not exhibit the maximum uncertainty recognized by the usgs 2 1 2 estimation of the time derivative of streamflow dq dt the exponential time step ets method roques et al 2017 exploits the exponential like decay often observed in hydrograph recessions barnes 1939 singh and stall 1971 the ets method additionally applies the variable time step approach of rupp and selker 2006 to reduce artifacts in the recession plot by incrementing the time step δt exponentially through the recession the ets method applies an integer m representing the number of streamflow values within an interval of time δti t i m t i given by 3 m t 1 n e 1 γ t where γ is related to the characteristic timescale of a basin determined by fitting an exponential function q t qoe γt for individual hydrograph recession curves in eq 3 n is a user defined variable to set a maximum interval of the hydrograph recession curve to compute dq dt we may thus estimate dq dt where 4 d q d t q i q i m t i m t i given that q represents discharge from an exponential function fit roques et al 2017 identified the method sensitivity to n or the fraction of the hydrograph recession used to estimate dq dt whereby n dt 15 days was found to extract consistent results from a single synthetic recession hydrograph with hourly discharge over a period of 118 days in many instances hydrograph recessions may not continue for a similar length of time thus requiring inspection of n values to estimate dq dt here n was set to 0 25 for all evaluations for a full description of the ets method development the reader is referred to roques et al 2017 2 1 3 fitting envelopes quantile regression derivatives of noisy streamflow time series can unduly influence estimation of recession parameters in eq 1 due to outlier data when applying ordinary linear regression quantile regression methods can mitigate influence and leverage of outlier data within the recession plot thomas et al 2015 when fitting envelopes to the recession cloud in this study median characteristics are hypothesized to reflect attributes extracted from the recession events thus median envelopes were fit to the single recession data cloud such that a fixed percentage of 50 of data falls above and below the envelope the approach applied here deviates from previous applications including brutsaert and nieber 1977 who suggested an envelope fit such that 95 of the data cloud was above the envelope to allow for measurement errors associated with flow estimation during low flow conditions and uncertainty associated with the determination of baseflow conditions 2 2 data 2 2 1 synthetic hydrograph recessions analytical approximations for recession discharges parlange et al 2001 were used to produce synthetic hydrographs which take the value of b 3 during early portions of the recession hydrograph transitioning to a value of b 3 2 for late recessions the synthetic recessions were produced using values as applied by roques et al 2017 at 15 min intervals for a period of 30 days appendix a as we are interested in applying hydra stream stage was retrieved by routing the generated recession discharges qsyn through a rectangular stream channel with various widths 0 5 m 0 75 m 1 0 m 1 5 m 2 0 m applying the manning equation a roughness coefficient n 0 066 was selected to emulate a natural rocky riverbed for all simulations having both streamflow and corresponding stream stage ssyn a synthetic rating curve was generated using eq 2 routing discharge through various width channels results stage ranges for a given discharge time series effectively creating sensitivity in the rating curve to retrieve measures of discharge from stage measurements to account for this sensitivity a rating curve metric is applied given as the ratio of coefficient of variation of discharge to the coefficient of variation of stage the range of rating curve metric values for the synthetic hydrographs is provided in table 1 noise e t was introduced into the stage time series following chen and krajewski 2016 where it was assumed that streamflow errors are correlated uncorrelated errors ε t were generated from a normal distribution n 0 σ while applying a first order autoregressive model 5 e t ρ e t 1 ε t where ρ 0 5 based on an average correlation evaluated by chen and krajewski 2016 translation of error to standard deviation assumed that the error reported by usgs 0 01ft 3 048 mm represented 2 σ thus accounting for correlation equates to a standard deviation of 1 ρ 2 σ 1 31 mm the resulting stage with error s syn t e t was fed through eq 2 to produce a hydrograph recession curve that exhibited flow variability attributed to stage uncertainty 2 2 2 usgs streamflow records real time usgs streamflow records were filtered to identify sites with limited human interaction lins 2012 additional site selection filtering was applied to identify small 10 100 km2 watersheds with 10 year wy2010 wy2020 records and at least 15 min temporal resolution an inherent assumption in the characterization of groundwater surface water interactions is that a hydraulic connection between the stream channel and the aquifer contributing baseflow to the stream exists and is perceptible within the stream hydrograph to relate possible groundwater surface water interaction within the watershed the baseflow index bfi is applied where site bfi ranges from 0 23 to 0 74 table 2 further to characterize relations between the variability in stage and discharge records within the rating curve data a ratio of the coefficient of variation of discharge to the coefficient of variation of stage measures was estimated watershed general characteristics are summarized in table 2 2 3 experiments performed the central hypothesis of the analysis is that robust extraction of recession events that represent the slow release of water from watershed storage enhance our ability to evaluate watershed responses influenced by groundwater surface water interactions experiments were performed to test this hypothesis using synthetic recession curves derived from groundwater theory with known late recession exponent values in these experiments channel width translates to a range in stage for an identical discharge thus reflecting conditions whereby incremental changes in stage correspond to increases in discharge a robust recession algorithm is further hypothesized to identify concurrent recession events invariant to temporal resolution of the discharge data additional tests were performed using time steps of 15 min 1 h 6 h and 24 h using usgs streamflow records at 40 sites to assess algorithm extraction performance in applying hydra stage uncertainty was fixed at 3 048 mm in the monte carlo evaluation of synthetic hydrograph recessions a total of 1000 iterations were performed whereby suitable hydrograph recessions were extracted using the various algorithms identical recession extraction algorithms were applied to usgs streamflow whereby the entire hydrograph records were fed through the algorithms to identify recession events 3 results 3 1 synthetic hydrograph results results obtained from the synthetic hydrograph monte carlo experiments are depicted in fig 2 for each iteration noise was introduced to the stage time series to produce random irregularities to the recession discharge eq 5 each algorithm extraction method was applied to the same recession event to identify a suitable discharge time series to which the ets method was applied to estimate the time derivative of streamflow dq dt and quantile regression to estimate the recession exponent from the data cloud within the recession plot the panels in fig 2 isolate results based on the recession event extraction algorithm and within each panel estimates of the recession exponent are further parsed on the temporal resolution of the discharge data the hypothesis tested here assumed that robust extraction algorithms identify continuation of the recession event thus the focus of the test is on late time recession behavior where b 3 2 to capture late time response in the discharge data recession events with lengths greater than 10 days were extracted when estimating the recession exponent an absence of recession exponent estimates within fig 2 for a particular extraction algorithm and temporal resolution suggests no suitable recession events were extracted which fulfilled recession event length criteria the derivative extraction method failed to identify recession events that satisfied event length requirements 10 d for fine temporal resolution hydrographs fig 2a where recession events were extracted to provide an estimate of the recession exponent the results were found to be less than theoretical values of b 3 2 the estimate median value being below the early time recession value of b 3 and late time recession value of b 3 2 is attributed to the performance of the algorithm whereby an early recession event which occurred in the initial portion of the 30 day recession event time series was inaccurately identified to end in the same 30 day recession time series a second recession event was identified and extracted resulting in a recession cloud that effectively accounted for 2 recession events as documented by jachens et al 2020 interpretation of individual recession dynamics is masked by analyzing a recession cloud derived from numerous recession events as fitting envelopes to the recession cloud captures the generality of the entire cloud often resulting in recession exponent estimates smaller than recession exponent estimates from individual recession events as the temporal resolution of discharge observations increases it becomes increasingly likely that random irregularities introduced into the stage times series results in erratic discharge estimates thus influencing the extraction of long recession events given that recession events are terminated due to a change in concavity recession exponent estimates are depicted in fig 2b applying 1 error in flow to extract recession events the algorithm effectively extracted recession events from which recession exponent estimates could be made and the estimates were generally accurate with respect to the theoretical value of b 3 2 under restraints of a narrow channel width 0 5 m and 24 h temporal resolution fig 2b illustrates the systematic influence of channel width and the corresponding ranges in stage for an identical discharge time series on our ability to suitably identify recession events white noise error n 0 σ added to synthetic stage estimates further introduced irregularities in flow derived from eq 2 because of nonlinear relations between stage and discharge these random incremental stage irregularities inhibited the algorithm from extracting representative recession hydrographs for the estimation of the recession exponent the influence of a noisy time series was amplified for the case of fine temporal resolution i e 15 min and 1 h where no suitable recession events were extracted with increasing channel width the results suggest that applying a 1 constant error extraction algorithm fails to effectively identify the cessation of recession hydrographs from which robust recession exponents may be estimated particularly as the temporal resolution of the discharge records decreases applying an extraction algorithm which compared a constant discharge error of 2 similarly resulted in a large range in the recession exponent estimates for wide channels and short time steps fig 2c recession exponents were near theoretical values for late recession behavior under conditions of channel widths less than 1 meter the systematic influences of temporal resolution and channel width observed in the range of recession exponent estimates was most notable for fine temporal resolution i e 15 min data where the introduction of noise to the recession hydrograph resulted in an irregular time series which effectively limited efficient identification of recession cessations often timing the recession curve cessation during the early portion of the recession where the theoretical value of the recession exponent is 3 an extraction algorithm applying 2 error in discharge performs well in cases of narrow channel widths where the range in stage for any given discharge is larger as compared to wide channels the robust extraction of recession events whereby hydra effectively identified continuation of the recession event to capture late time recession behavior resulted in recession exponent estimates near the theoretical late recession value of b 3 2 fig 2d the algorithm performed well to identify continuation of recession events into late time recessions across all variables tested including channel width and discharge temporal resolution the median and quantile ranges depicted in fig 2d document robust estimation of the recession exponent despite factors including channel width discharge temporal resolution and noise introduced to the discharge time series the algorithm further effectively applied rating curve relations to negate the influence of various factors thus illustrating the algorithms flexibility for application to streamflow records lastly the method was found to be invariant to discharge temporal resolution as hydra only compares the current and previous time step flows 3 2 usgs recession results whereas we may quantitatively assess our ability to estimate the recession exponent based on the extraction of hydrograph recession events from theoretical recession discharges direct assessment using collected streamflow records are impractical as one never knows the true value of recession parameters to further test the performance of the extraction algorithms 39 usgs gage sites were identified these selected gage sites are recognized as having limited direct human interferences lins 2012 have a complete hydrologic record over the period wy2010 wy2020 and temporal resolution of at least 15 min and span various climate and land use landscapes table 2 recognizing that a priori recession parameter values are unknown the hypothesis applied here relates to our ability to effectively identify the beginning and end of a recession event a robust extraction algorithm is deemed to systematically identify recession events without regard to temporal resolution of the discharge data to test the hypothesis two experiments were performed comparing the overlapping i e concurrent recession events extracted from the hydrographs all experiments extracted recession events that continue at least 4 days in the first experiment extracted recession events from the various algorithms were compared with recession events extracted from hydra for identical temporal resolution in fig 3 each line depicts concurrent matches from a single hydrograph table 2 whereby extracted recession events are compared to extracted recession events from hydra further to test the influence of the temporal resolution on recession event extraction the analysis was completed for time steps of 15 min 1 h 6 h and 24 h results depicted in fig 3a thus represent comparison between the algorithms to hydra for 15 min intervals whereby the y axis represents the percent concurrent recession the results depicted in fig 3 document consistent underperformance from the derivative extraction algorithm with an increase in performance noted as the temporal resolution of the discharge data decreased at the daily time step fig 3d the derivative method performed well across most stations to capture concurrent recession events with a systematic relation with bfi noted whereby poor concurrent matches when applying hydra tended to correlate with low bfi the error based methods performed well under conditions of coarse temporal resolutions fig 3c 3d generally matching 60 or more of the recession events extracted by hydra a second comparison of concurrent recession events is illustrated in fig 4 whereby concurrent recession event matches are relative to 24 h hydra extracted recession events in fig 4 each line depicts concurrent recession event match from a single hydrograph whereby extracted recession events are compared to recession events obtained from 24 h hydrograph resolution data using hydra in fig 4a the derivative extraction methods again reflect poor performance at fine temporal resolution matching less than 60 for all gage stations with increasing performance noted as the temporal resolution in discharge data decreases the error based results fig 4b 4c depict similar trends whereby concurrent overlap between recession events under fine temporal resolution conditions are low with increasing concurrent overlap noted as the temporal resolution decreased a comparison of hydra extraction methods across time steps fig 4d further documents a range of performance at 15 min temporal resolution with matches generally 70 for 1 h resolution no clear systematic influence in relation to bfi was noted in the concurrent recession event matching experiment with the exception of results depicted in fig 4d where hydra recession extraction at various temporal resolutions was compared to 24 h temporal resolution recession events in fig 4d gages with poor concurrent recession event match tended to correlate with low bfi for example sites with 50 match at a temporal resolution of 15 min tended to exhibit low bfi bfi 50 with the exception of usgs site 13317000 with a bfi of 73 5 4 discussion consistent and robust methods to identify the cessation or continuation of recession events for recession analysis increases in importance as the number of stream gage sites with finer temporal resolution records increases fig 1 the characterization of watershed function is inherently linked to our ability to justify when a recession event starts and when a recession event ends where continuation of the recession event is deemed to add information from which more robust evaluation to interpret groundwater surface water interactions can be made whereas previous hydrograph recession curve extraction methods were based on daily data thomas et al 2013 vogel and kroll 1992 or relative flow uncertainty dralle et al 2017 jachens et al 2020 shaw and riha 2012 the algorithm presented here accounts for gage specific relations between stage and discharge in the simplest approach reported stage error of 0 01ft 3 048 mm was applied to extract recession events resulting in robust estimates of recession exponents from synthetic recession hydrographs relative flow error approaches were documented to perform well in specific cases for example under conditions where the ratio of the coefficient of variation in discharge to the coefficient of variation in stage was below 1 5 yet were inconsistent in extracting suitable recession events for analysis in comparison hydra suitably identified recession event continuation thus extracting representative recession events from the late time hydrographs from which precise and robust recession exponent estimates could be made hydra was invariant to the influence of stage ranges regulated by channel widths resulting in robust recession exponent estimates the range in recession exponent estimates was generally higher as the temporal resolution of the discharge data decreased and generally increased as a function of discharge sensitivity given as the coefficient ration of discharge to stage such a result suggests that concerns regarding short term flow variability are warranted and may influence identification of the end of recession events in the stream hydrograph when applied to observed discharge records hydra extracted concurrent recession events efficiently without regard to the temporal resolution of the data figs 3 and 4 as documented in fig 4 hydra and the error based extraction algorithms efficiently extracted concurrent recession events as compared to the 24 h hydra extractions for the sites whereas the derivative method failed to achieve high percentage concurrent comparisons for sub daily discharge records hydra approached identification of the cessation or continuation of the recent event in simple terms where time step comparisons in flow used a stage error of 3 048 mm numerous sources of river discharge uncertainty mcmillan et al 2012 were not accounted for in the development of hydra to bypass these issues synthetic discharges were fed through various channel widths to account for uncertainties that may arise through indirect calculation of discharge data from stage measurements future application of the algorithm could account for relations between stage uncertainty and discharge sensitivity or to account for the correlation in stage error mcmillan and westerberg 2015 as the number of gage sites with fine temporal resolution data continues to increase it is vital for consistent reproducible methods be applied to further our understanding of watershed processes hydra applied a constant value of stage error which could be enhanced to account for the relation of stage uncertainty as a function of flow and the correlation in stage uncertainty although the performance of hydra was deemed superior to the tested methods the method cannot be universally applied given the need for site specific stage discharge data without site specific data to evaluate stage discharge relations error based methods may provide a suitable alternative to identify recession events it is important to note however that as temporal resolution of the data increases it is increasingly likely that error based methods may extract hydrographs which are not truly reflective of recession events thus requiring great care to identify recession events when applying such methods although hydra outperformed the extraction algorithms tested on 15 min temporal resolution discharge data results summarized in figs 3 and 4 suggest significant limitations in extracting recession events from very fine temporal resolution data in comparison the recession events extracted from 1h discharge records were found to be more consistent documenting that whenever possible extraction algorithms should be performed at 1h or greater temporal resolution when applying hydra despite the simple methods applied in hydra the estimates were robust and may thus be applied to increase our ability to comparative recession analysis funding this research did not receive any specific grant from funding agencies in the public commercial or not for profit sectors author statement all work was completed by the author declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments all streamflow data analyzed in this study are freely available from the usgs https waterdata usgs gov nwis hydra may be downloaded from github https github com bfthomas hydro hydra upon requesting a password the author expresses his appreciation to one anonymous reviewers reviewers arik tashie and clément roques and editor graham sanders appendix a parlange et al 2001 computed dimensionless discharge q as a function of dimensionless time t considering a horizontal aquifer with breadth b and aquifer depth d q α 1 e 1 t t 1 5 λ 1 π 2 α λ 2 μ π e r f c 1 t ν 1 e 1 t t 3 2 where ν 7 λ 1 5 4 λ 2 1 4 and α λ 1 λ 2 ν π 0 3320606 q and t may be translated to dimensional variables by applying known aquifer characteristics including hydraulic conductivity k and the specific yield f and watershed characteristics including watershed area a by q k a d 2 b 2 q g i v e n a 2 b l and t f b 2 d k t for this analysis l 100 m k 0 0001 m s 1 b 100 m d 10 m and f 0 10 
314,satellite altimetry is increasingly considered as a valuable source of information in many hydrological and hydraulic applications however the accuracy of different sensors adopted for monitoring the water level from satellite and the limited temporal resolution that characterizes each sensor i e revisit time most of time varying from 10 to 35 days 369 days in case of cryosat mission still hamper their common use recently introduced multi mission mm densified time series might represent a possible alternative to ensure higher spatial and temporal coverage though a comparison of the potential of different altimetry products including mm series for hydrodynamic model calibration is still missing this study attempts to fill this gap investigating how available altimetry series perform over a stretch of the po river nearly 140 km across northern italy in calibrating a quasi 2d model built with detailed topographic information specifically objectives are manifold i to provide a comparison of satellite altimetry products available to the research community and commonly used in hydraulic modelling envisat envisat extended mission ers 2 topex poseidon saral altika jason 2 jason 3 sentinel 3a sentinel 3b and cryosat ii to evaluate the performance of mm satellite series in calibrating a hydraulic model relative to single mission series and iii to investigate the importance of the number of observations series length for each mission results of the model calibration depict a general improvement of satellite performance over time moving from the oldest to more recent missions with the exception of envisat extended series in general jason 2 sentinel 3a and sentinel 3b outperform other series both in terms of calibration error and number of measurements required to achieve a reliable calibration mm series provide errors larger than those obtained from original single mission time series considered with their overall length but they provide more reliable calibrations than altimetric time series with low sampling rate i e envisat envisat extended and saral altika or those that cover very short periods e g altimetry series limited to 20 40 months in length the analysis offers additional insights into the possible use of altimetry series in hydrodynamic applications providing a comparison of different original products and showing the potential as well as limitations offered by mm series keywords remote sensing satellite altimetry hydraulic model calibration uncertainty analysis po river 1 introduction over the last thirty years hydraulic modelling has developed to such an extent that it can now provide high quality flood risk maps merz et al 2010 damage assessment luino et al 2009 water resource management loucks et al 2005 real time flood forecasting arduino et al 2005 and dynamic perspective in case of future scenarios bronstert 2003 hydraulic modelling describes the flood routing and hence tracks the propagation of a flood wave given as an input at an upstream location of a river channel to any downstream locations the routing model requires an accurate geometric description of the river channel and floodplains reliable input of river discharge and the calibration of the roughness parameter considered as the most important factor that has an impact on predicting flow characteristics aronica et al 1998 bates et al 1996 pappenberger et al 2005 the model calibration generally consists in tuning the roughness parameter to minimize the misfit between simulated and observed output represented by flow or water level hydrographs typically the calibration is done by using water level or discharge observations gathered at the gauged stations available along the river recently scientific literature is enriched by studies on the integration of remote sensing and ground observations for hydraulic model calibration numerous examples use the flood extent derived by the backscatter value of synthetic aperture radar sar images to calibrate the roughness parameter andreadis and schumann 2014 matgen et al 2011 tarpanelli et al 2013a in some cases considering also the uncertainty in the flood extraction di baldassarre et al 2009 giustarini et al 2015 directly related to the water surface elevation satellite altimetry has demonstrated its large potential in the calibration of 1d or 2d hydraulic models domeneghetti et al 2014 o loughlin et al 2013 yan et al 2014 neal et al 2012 calibrated the hydraulic model lisflood fp for an 800 km reach of the niger river in mali using the laser altimetry data from ice cloud and land elevation satellite icesat differently from the radar altimetry data that are collected with a given repeat period at the same locations icesat does not produce repeat track measurements and although considered the most accurate source of altimetry information the hydrological community is still sceptical about monitoring rivers in a different way from the traditional adoption of fixed gauging stations o loughlin et al 2016 similarly cryosat 2 satellite suffers from a limited use due to the almost annual repeat cycle i e 369 days which is considered inadequate to represent river dynamics however its dense spatial sampling about 7 5 km at the equator can be extremely useful in deriving water level profiles that normally cannot be achieved schneider et al 2018 used cryosat 2 water level data to calibrate the manning roughness coefficient each 10 km over the po river main channel by using the dhi mike 11 software dhi 2015 compared with values calibrated through in situ measurements cryosat 2 showed a strong potential to calibrate the roughness coefficient at a more detailed level with the consequent reduction of the over and under estimation of the high flows jiang et al 2019 concerning traditional radar altimetry i e short repeat and fixed orbit missions such as ers 2 envisat and jason 2 several examples have demonstrated its valid contribution in supporting the ground network for describing the hydrometric regime garambois et al 2017 emery et al 2016 and the potential benefits expected in case of its integration with in situ data domeneghetti et al 2014 huang et al 2018 and reference therein similar studies have mostly focused on rivers larger in width than about 300 m a limitation imposed by the along track spatial resolution of delay doppler altimetry the fully focused sar ff sar processing however improves the along track resolution of sar altimetry up to the theoretical threshold of half of the antenna length egido and smith 2016 vignudelli et al 2019 kleinherenbrink et al 2020 have implemented the ff sar algorithm over lakes canals and ditches in netherlands using cryosat 2 full bit rate data for cases where the altimetry track crosses the water bodies in a near perpendicular angle they have successfully derived the water level of a ditch as small as 5 m in width and located only 10 m away from a canal though more studies are required to indicate the potentials and limitations of ff sar it is expected that the method would open an unprecedented opportunity to monitor smaller water bodies moreover when the future swot mission is fully operational for rivers wider than 100 m possibly as narrow as 50 m desai 2018 frasson et al 2019 a 2d river mapping at 10 70 m resolution is anticipated biancamaria et al 2016 concerning the use of traditional radar altimetry for the calibration of the hydraulic model two limitations are the most relevant and worth to be analysed the length duration of the time series and the revisit time of the satellite the importance of the duration i e years of observation or number of overpasses of the satellite mission has been analysed by domeneghetti et al 2015 who showed its impact on the estimation of the roughness coefficient in particular they found that sample sizes of 2 5 years can be considered sufficient to the calibration process in case of using ers 2 and envisat time series however an extension of similar investigations to other satellites is desirable to assess the potential of current and past altimetry missions for hydraulic simulations also the revisit time typically 10 to 35 days for altimetry missions represents a limitation for hydrodynamic applications a possible solution is the development of approaches that consider the use of multiple missions mm to derive densified time series in specific locations tourian et al 2016 transferred the water level information coming from four satellite missions jason 2 envisat saral and cryosat 2 and hence several virtual stations to specific locations of the river coincident with the ground monitoring stations along the po mississippi congo and danube rivers the combination of the altimetry data has been carried out with the hydraulic concepts of wave travel time and celerity of the flow calculated with the geometric characteristics of the river such as length of the reach slope and width a successive study of tourian et al 2017 analysed a similar approach over the niger river and obtained river discharge by assimilating altimetric and in situ river discharge with a kalman filter approach boergens et al 2017 integrated water level measurements of envisat saral and jason 2 by using ordinary kriging in the main channel of the mekong river all these attempts to increase the frequency of sampling of the river water surface are valuable contributions especially for hydrological applications and for deriving more frequent discharge time series however the value of mm time series has never been tested in hydraulic modelling moving from previous considerations the present work proposes to investigate three main aspects that are still only partially analysed in the literature 1 to compare the available altimetry data in terms of their performance for the calibration of hydraulic models specifically the analysis provides a comprehensive comparison of different satellite altimetry products available to the research community and covering nearly 27 years such as envisat e envisat extended mission ex topex poseidon tp saral altika sa jason 2 j2 and jason 3 j3 sentinel 3a s3a and sentinel 3b s3b despite not directly analysed the potential of ers 2 and cryosat is also presented taking advantage of previous studies carried out on the same study area domeneghetti et al 2015 schneider et al 2018 2 to assess the effect of the record length i e number of available satellite measurements in relation to different data products on the calibration reliability the study investigates the possible accuracy of the model calibration in relation to the record length of the altimetry product adopted for its execution this info could be beneficial not only at the early stages of a mission but also when historical time series are limited in length perhaps due to missing values or mission interruption findings of such evaluation might serve a modeller when called to evaluate the extent of the calibration period 3 to test the use of mm satellite time series in the process of hydraulic model calibration these synthetic altimetry time series result from the combination of different single mission time series and overcome the spatial and temporal sampling limits that characterize a given single mission see e g tourian et al 2016 the construction of mm time series represents a recent frontier towards a larger exploitation of altimetry data provided from the overall set of past and on going satellite missions see also coss et al 2020 thus the evaluation of its potential for the implementation of an accurate and reliable hydraulic model constitutes an element of interest for the hydrologic community although not claiming to provide a general statement and ranking of the altimetry products which would require considering a large set of rivers having a variety of hydrological and morphological characteristics this study aims at delivering a comprehensive and cross missions view of the potential of current and past altimetry data the analysis is implemented along the po river in the stretch between the gauged stations of borgoforte basin area equal to 62 450 km² and pontelagoscuro basin area equal to 70 091 km2 for a direct comparison with other studies the hydraulic simulation is carried out with the hec ras software package hydrologic engineering centre 2001 in a quasi 2d configuration see section 3 1 2 study area and altimetry time series 2 1 study area fig 1 presents the area of interest about 140 km reach of the lower portion of the po river the largest and longest italian river that flows in eastern direction across northern italy considering the social and economic importance of this area the po river is consistently monitored and controlled by the po river basin authority adb po which records and provides hydrological and geometrical ground observations used in this study montanari et al 2017 the analysis focuses on the river reach that is limited upstream by the gauging station of borgoforte and downstream by the beginning of the river delta along this portion the main channel width ranges from 200 to 500 m while lateral floodplains may span up to 2 5 km fig 1 shows virtual stations vss locations where satellite tracks cross with the river considered in this study as well as the position of gauged stations i e borgoforte and pontelagoscuro where river discharge and water surface elevation are recorded daily from 1923 to 1922 respectively although po river dynamic and its off seasonal behaviour may result challenging for the use of altimetry data it represents a profitable case study where both traditionally observed and remotely sensed hydrological data are available domeneghetti et al 2014 2015 2 2 satellite altimetry products table 1 summarizes the different altimetry missions considered in the study envisat e envisat extended mission ex topex poseidon tp saral altika sa jason 2 j2 jason 3 j3 sentinel 3a s3a and sentinel 3b s3b these missions are characterized by different sensors instrumentation scopes and orbits therefore the respective altimetry time series are characterized by distinctive temporal and spatial resolution as well as different accuracy and reliability most of the considered missions have a low temporal resolution i e 35 days for e and sa 30 days for ex and 27 days for s3a and s3b while tp j2 and j3 provide water surface elevation measurements every 10 days e mission period 05 2002 10 2010 and sa 03 2013 01 2016 are the successors of the former mission ers 2 04 1995 09 2007 using the same orbit configuration with inter track distance of 80 km at equator and a repeat cycle of 35 days e ex and sa data are processed adopting ice 1 retracker shown to provide robust and accurate results over rivers frappart et al 2006 silva et al 2010 j2 launched in june 2008 is the successor of the former missions tp 09 1992 08 2002 and j3 was launched in 2016 as the successor of j2 and placed in the same orbit with the inter track distance of about 315 km at equator and a repeat cycle of 10 days for both j2 and j3 the water levels are derived using the ice retracker as it has proven to outperform other retrackers over continental waters cretaux et al 2018 the currently active s3a and s3b guarantee the continuity of e type measurements in a fully operational manner sentinel 3 provides sar altimetry data with a revisit time of 27 days the two missions have orbits almost similar to that of e and ers with the ground track separation of 104 km at equator s3a and s3b data are processed using the ocog retracker which is a heritage of ice 1 and hence reliable for inland applications all water level time series are processed using the high rate altimetry datasets the usual rate for all missions is 20 hz which leads to the along track distance of 294 m between successive measurements sa dataset however is provided with the sampling rate of 40 hz and hence the spatial spacing of 173 m along track for clarity fig 2 presents the temporal coverage of the altimetry products considered in the study while fig 3 reports a synoptic view of the water levels derived from the different missions referring to the same study area tarpanelli et al 2013b and domeneghetti et al 2014 2015 investigated the potential of ers 2 time series for similar purposes the comparison of ers 2 with water level values recorded at the nearest gauging station or estimated at vss shows significant correlations with the mean absolute error in the order of 0 7 m in particular domeneghetti et al 2015 investigated the effect of ers 2 uncertainty on model calibration while schneider et al 2018 did the same considering cryosat time series for the sake of brevity and to avoid the repetition of already performed investigations calibrations with ers 2 and cryosat data are not carried out in this work actually the drifting orbit of cryosat implies a long repeat ground track pattern that would impose the adoption of different calibration strategies i e it is not straightforward to construct time series since its long repeat cycle 369 day nevertheless this does affect the completeness of this investigation results previously obtained with both ers 2 and cryosat are summarized and compared with those of other altimetry time series to provide a complete overview of altimetry performance 2 3 multi mission mm altimetry time series at high spatial and temporal coverage water level time series from individual altimetry missions over the river are merged using an approach developed by tourian et al 2016 to overcome spatial and temporal limitation of single altimetry missions adopting this solution all vss of several satellite altimeters along the po river are connected to each other hydraulically and statistically to this end first the bias between different missions is removed see tourian et al 2016 for more details then for any given location along the river the time lag due to stream flow between the altimetric virtual stations and the selected location is estimated since the mm approach has been developed for being applicable also on poorly surveyed areas average river width using imagery together with the slope derived from satellite altimetry are used as inputs to a simple empirical hydraulic equation that estimates average flow velocity and thus the time lag between vss bjerklie et al 2005 tourian et al 2015 fig 4 shows the estimated time lag between vs along the po river highlighted with those selected for this study from the most upstream selected vs in this study tp120 j2 120 and j3 120 see fig 1 till most downstream vs tp85 j2 85 and j3 85 the time lag is about 0 85 day using the estimated time lag the water level hydrographs of all measurements are shifted and stacked at the selected location the stacked time series at the selected location is then normalized according to its statistical distribution and especially the water level value at 3rd and 85th percentiles as lower and upper bounds as an example fig 5 shows normalized water level obtained at vs j2 85 for which first the time lag between all vss and the j2 85 is corrected and then individual time series are normalized according to their 3rd and 85th percentiles afterwards outliers are identified and removed from the normalized time series by defining a confidence limit of 99 of a student s t test for a one month sliding time window the confidence limit is delineated in fig 5 by an upper and a lower bound confidence level all measurements outside the confidence limit are identified as outlier and removed from measurements the outlier free normalized time series is then rescaled back according to the water level distribution of the selected location fig 6 using this methodology we obtain a time series with 3 days effective temporal resolution from altimetry missions originally with temporal resolution ranging from 10 to 35 days the mm water level time series are validated at the gauging stations of borgoforte and pontelagoscuro for which individual water level time series are densified obtaining correlation coefficient equal to 0 75 and 0 78 rmse root mean square error of the value of 0 94 m and 0 75 m and bias of 0 05 and 0 37 m respectively the accuracy of mm series inevitably conveys the simplifications and assumptions of the approach used for their construction thought for applications in data scarce areas those simplifications mainly regards the description of the river geometry and dynamics i e river width and time lag investigating the impacts of such limitations on the use of mm series for the calibration was out of the scope of this work nevertheless these analyses are suggested for future work 3 numerical analysis and methodological approach 3 1 model set up calibration and validation the numerical simulations of the river stretch of interest is carried out by means of a quasi two dimensional quasi 2d model implemented with the hec ras code that uses an implicit four point finite difference algorithm to solve the de saint venant equations the river geometry is properly reproduced by taking advantage of a 2 m dem digital elevation model available along the overall po river which combines a lidar survey of the emerged river portion with traditional ground cross sections and multi beam sonar surveys camorani et al 2006 the quasi 2d scheme ensures a proper representation of the flow dynamics by enabling mutual interactions between the main channel and a series of lateral floodplains i e storage areas delimited by a system of minor dikes which are schematized within the code as lateral structures although the numerical scheme refers to 1d hydraulic equations the adoption of this schematization enables a proper simulation of the hydraulic interaction amongst the main channel and lateral floodplains the appropriateness of this configuration has been proven by a number of previous studies that referred to the same river portion castellarin et al 2011a 2011b domeneghetti et al 2015 the numerical simulations for the overall period of interest 1992 2019 are carried out by imposing the mean daily discharge values recorded at the upstream gauged station borgoforte as upstream boundary conditions and the normal flow condition at the downstream cross section located at the beginning of the river delta see fig 1 according to previous experiences on the study area domeneghetti et al 2014 2015a lateral inflows of some minor tributaries are not taken into account during the simulation since their contributions are neglectable relative to the po river discharge the calibration procedure focuses on the identification of the manning coefficient n s m 1 3 of the main channel that maximizes the nash sutcliffe efficiency ns nash and sutcliffe 1970 coefficient obtained in reproducing the observed water levels by varying it within the range 0 01 0 06 s m 1 3 because the quasi 2d model has limited sensitivity to the roughness coefficient adopted for the floodplains its value is considered constant and equal to 0 1 s m 1 3 for all the numerical simulations see also castellarin et al 2011a domeneghetti et al 2015a referring to the simulation time frame considered in this study 1995 2019 calibration and validation schemes vary in relation to investigation setting as indicated hereafter a analysis considering one vs at time referring separately to the dataset retrieved from specific altimetry mission table 1 fig 1 and the mm time series in each calibration the roughness coefficient is unique and assumed to be static through time for each single mission the calibration is performed referring to the overall period of altimetry data availability see fig 3 once calibrated the model validation is carried out comparing simulated water surface levels with in situ data available within the considered time frame 1995 2019 and not used for the calibration for a single mm series that covers the overall period of interest the latter is split in two parts 1995 2017 for calibration 2017 2019 for validation b analysis considering all mm time series together the calibration adopts spatially distributed parameterization by splitting the river into a number of stretches corresponding to vss locations and considering multiple roughness coefficients when referring to mm time series the calibration covers the period that consider the presence of all altimetry missions its considerable extent 22 years from 1995 to 2017 ensures a data series length sufficient to ensure a consolidated calibration guaranteeing at the same time a sufficient validation period 2 years 2018 2019 3 2 accuracy of altimetry products typically as spotted in fig 1 vss do not coincide with gauging stations and thus a direct comparison between traditional observation and remotely sensed data is not straightforward to overcome this problem we compare the satellite derived water surface elevation values hsat x t sensed at a given location x at the day of the satellite overpass t with the in situ water surface elevation hsitu x t linearly interpolated at the track location referring to concurrent water levels measured at the gauging stations located upstream and downstream the satellite track this appears reasonable in the absence of diversion structures or dams along the river portion of interest following this approach the error ε x t can be calculated with the eq 1 1 ε x t h s a t x t h s i t u x t which has been applied distinguishing all the altimetry products the same approach is used considering the mm time series where t covers all days of observation sensed by at least one of the considered altimetry missions considering that different altimetry missions use different reference ellipsoids topex ellipsoid for tp j2 j3 and sa and the wgs84 for e ex s3a and s3b we calculate the geoid height with respect to the one adopted for mm creation egm2008 the same for in situ data which refer to italgeo 2005 geoid barzaghi et al 2007 3 3 impact of vs time series length on calibration the length of an altimetry dataset m i e the number of satellite overpasses available at a given vs from a specific altimeter which differs from the official mission duration influences the reliability of the calibration domeneghetti et al 2015a to investigate its impact for different satellite products we repeat the calibration exercise by considering several altimetry subsets randomly sampled from each original altimetry time series i e e tp j2 etc with a length m that varies from 3 to ltot in this case ltot indicates the total amount of altimetric observations available for a given mission at a specific vs indicating with x the location of a given vs along the study area the subset sampled from the original altimetry time series and used for the calibration can be expressed as 2 h s a t m x h s a t x t 1 h s a t x t m m 3 l t o t for m lower than 3 the time series is considered too short and not suitable for calibration purposes to overcome the uncertainty related to the selection of the m observations amongst those available for a given mission and at a given vs the sampling procedure is embedded in a monte carlo framework that generates 1000 random h sat m samples for each m value once sampled the calibration is carried out considering each h sat m sample at time finally with the aim to infer the error introduced by the altimetry data we repeat the same procedure by calibrating the numerical model with reference to different subsets randomly extracted from the water level values observed in situ at the vs hsitu eq 3 indicates the in situ time series randomly extracted from the overall set 3 h s i t u m x h s i t u x t 1 h s i t u x t m m 3 l t o t calibration results obtained with these h situ m x samples are used as a reference for evaluating the potential of altimetry for model calibration for what regards the adoption of mm time series in order to make the calibration performances of mm and traditional time series comparable we refer to specific observation periods instead of considering a given number of observations m the observation period is expressed in terms of a number of months from the date of the first altimetry observation and varies in relation to the revisit time of each mission 12 months for tp j2 and j3 i e high frequency missions 14 months for s3a and 20 months for other missions based on this temporal discretization once identified a given observation period e g 1 2 n observation periods the number of altimetry observations adopted for the calibration for both mm and traditional time series is defined as the sum of all available water levels values observed since the beginning of the time series 4 results 4 1 accuracy of altimetry products table 2 summarizes the results of the comparison between altimetry time series and in situ water surface elevations estimated at vs locations in particular the table reports the number of observations that constitutes each time series the correlation coefficient r between altimetry and in situ data the ns value the mean absolute error mae as well as the mean µ and standard deviation σ of the errors expressed following eq 1 altimetry products are listed in a chronological order following fig 2 in case of vss observed from multiple sensors e g vs 85 and vs 120 each time series is considered separately table 3 reports the same error statistics referring to mm time series which is unique for each vs 4 2 performance of different altimetry time series on model calibration table 4 summarizes the results of the model calibrations and validations carried out using each altimetry time series at a time it reports ns rmse and mae obtained at each satellite track considering the overall available datasets which means m ltot these performance statistics are compared with the ones obtained by repeating the calibration considering in situ water level elevation interpolated at the same location and time of the satellite overpasses values in brackets δ rmse and δ mae quantify the additional calibration errors due to the use of altimetry data instead of in situ ones while the last three columns report the results of the validation performed using satellite time series fig 7 reports the results of the calibration exercise performed considering altimetry time series of different length and randomly sampled from the original datasets see eq 2 considering each altimetry product and vs at time panels of fig 7 show the calibrated roughness coefficient in relation to the number of observations m used for the calibration the solid line indicates the manning coefficient that ensures the optimal ns value amongst the 1000 calibrations performed with a given m value while the grey area represents the range of variability of the roughness coefficients calibrated within the monte carlo framework the wider this area the more the results of a calibration process depend on the altimetry record used for the calibration with the risk of being significantly influenced by the range of water levels sensed during a specific period e g mainly high flows or low flows fig 8 provides an overview of the maximum error that we can expect when we use altimetry data for the calibration of a hydrodynamic model the black line indicates the maximum mae as function of m thus the maximum error obtained considering all possible calibrated configurations obtained in the monte carlo framework with a given data length i e grey areas in fig 7 the comparison with the same maximum mae obtained calibrating the model with in situ data red line provides a quantitative estimation of the additional error induced by satellite altimetry uncertainty fig 9 summarizes the findings of fig 8 showing the temporal evolution of the performance of satellite altimetry for model calibration the length of each box represents the temporal coverage of the mission while the box height identifies the range of variability of the mae obtained during the calibration considering the overall amount of available observations see also table 4 in order to give a complete overview fig 9 also includes the results from the previous investigation using ers 2 see domeneghetti et al 2015a a similar calibration exercise over the po river was done by schneider et al 2018 using cryosat 2 series observed during the period 2010 2016 their findings report an average rmse me mean error of nearly 0 4 m 0 18 m for the sar mode with values ranging from 0 06 m 0 05 m up to 0 63 m 0 23 m not shown in fig 9 due to the use of different error metrics 4 3 performances of mm series on model calibration table 5 summarizes the results of the calibration 1995 2017 performed using mm series as well as those obtained using in situ water levels observed in the same period at the same day of the satellite overpasses mm series are specified for each vs sensed along the study area thus table 5 has only 11 rows according to the number of intersections between the po river and the considered satellite orbits vss as previously shown for the original satellite altimetry data see section 3 2 fig 10 reports the results of the calibration carried out adopting mm altimetry series of different length and randomly sampled from the datasets used for calibration considering each vs at a time panels in fig 10 show the manning coefficient calibrated in relation to the series length m the solid black line indicates the roughness coefficient that ensures the optimal ns value amongst those tested for a given m value while the grey area represents the range of variability of the calibrated coefficients even in this case the width of the grey area is indicative of the sensibility of the calibration result to the length of the altimetry record used for the calibration it is worth noting here that the temporal interval considered for calibration 1995 2017 is long enough to guarantee the achievement of a consolidated and stable calibration fig 11 reports the maximum error obtained by calibrating the model with mm series the black line indicates the maximum mae as function of m which is compared with the error obtained when calibrating the same model with an in situ data record of the same length red line 4 4 comparison of single and mm altimetry series table 6 presents the calibration results obtained using the mm time series results are compared with those achieved by calibrating the model with the original satellite altimetry available at the different vss values reported in table 6 refer to the case of considering the overall altimetry series length m ltot last four columns report the calibration validation performances when considering the overall set of mm series along the po river figs 12 17 show the comparison between original satellite series and mm ones each figure represents one satellite mission e22 j2 85 sa629 tp120 j3 85 and s3a 272 from fig 12 to 17 respectively s3b 272 is not shown since the limited amount of data for each figure panel a represents the number of measurements using mm series grey columns and unique sensor black columns considering different observation periods temporal step equal to 20 months for e22 and sa44 2 months for j2 85 j3 85 and tp120 14 months for s3a 272 panels b c and d depict mae ns variability and manning s coefficient as a function of the number of available data respectively 5 discussion 5 1 accuracy of altimetry products table 2 summarizes the comparison between satellite and original altimetry data excluding ex775 which has a very limited number of observations all the altimetry series show quite high r values which are always larger than 0 6 and generally improves moving from historical missions to the most recent ones similarly ns values are in general positive with the few exceptions of ex775 and tp85 in general j2 series outperform all other missions providing a mean error µ of about 20 cm and the lowest values of standard deviation µ 0 38 cm in the worst case despite the limited amount of observations s3b is the only time series having a lower mean error µ 0 while s3a series show performance in line with those of j2 and s3b unless irregular amongst the available vss j3 provides µ values comparable to those of j2 but higher standard deviations σ a possible justification can be due to the characteristics of j3 series which appear shorter than those of j2 nearly 1 3 in length see table 2 and characterized by a higher frequency of low flow conditions this latter aspect is evident in fig 3 where j3 covers a period of time 2016 on during which water levels are on average lower meaning low flow period than what observed by j2 yellow lines this aspect may play a significant role when considering possible hooking effect or off nadir effect schwatke et al 2015 which is expected to be more relevant in case of smaller water extent in addition to this after a closer look at j3 data and correspondent observed level the performance of j3 at vs 120 appears strongly influenced by few significant errors observed during a short period beginning of 2018 during which the altimeter sensed water level considerably higher than the observed ones those errors since the limited extent of j3 series heavily affect the statistics which would have been in line with those of j2 otherwise sa series ensure high correlation values while mae values are worse than those from the older mission e this might be due to the limited length of the series 8 and 15 observations in total at the two available vss in contrast despite the number of available observations tp provides the worst results with low ns and high mae values the mean error values µ indicate a general overestimation of the satellite series µ 0 with the only exception of tp120 that shows a negative bias finally referring to ers 2 data domeneghetti et al 2015a identify mae values in the order of 0 7 m with µ and σ up to 0 64 cm and 0 84 cm respectively at two vs along the po river table 3 shows the results of the same comparison performed with mm series results highlight a uniform performance in terms of r 0 80 ns values are in general positive even if always lower than 0 66 in general performance indexes appear more homogeneous along the study area which is somehow expected considering the way the mm series are defined along the river looking at the spatial distribution of the error the analysis performed does not enable the identification of a specific relationship amongst error magnitude and river morphology such as river width or river orientation however it is worth noting that in general the performances obtained considering the mm series at a given location are always lower than those obtained considering the original altimetry series with the only exception of few vss where the performances of the altimetry products were not convincing perhaps due to their limited length e g vs 775 in such a case mm series is more capable to reproduce the observed water level dynamics 5 2 values of satellite altimetry and effects of time series length on model calibration the results of the calibration performed using satellite altimetry shed some light on the potential of different products for modelling applications in particular the influence of the number of observations on the variability of the results varies in relation to the satellite product assuming that a calibration result should be considered reliable when the variability of the roughness coefficient is very limited i e 0 005 s m 1 3 in terms of manning s coefficient this condition is reached in case of considering a number of observations that varies from one mission to another looking at fig 7 this target is reached for e in case of using more than nearly 35 observations which means nearly 3 5 years of observation considering its revisit time 35 days similar results have been obtained considering ers 2 series domeneghetti et al 2015a the lengths of required series become smaller in case of tp revisit time equal to 10 days which ensures reliable performance with 50 observations recorded on average in 1 5 years better performances are obtained in case of j2 series for which the same performance is obtained calibrating the model with nearly 30 observations less than 1 year of record considering its temporal resolution the same number of observations is required by s3a although its lower repeat period extends the time series up to more than 2 years similarly 30 observations are needed for j3 85 while nearly 60 slightly more than 1 5 year are required for the j3 120 again this latter difference can be justified by the errors noticed for j3 120 series and previously described regarding the satellite series ex the limited number of available observations prevents us from drawing general conclusions the same holds for sa44 8 measurements in total despite the limited amount of data the calibration results with s3b272 and sa629 are good the calibration appears reliable already with a limited number of data nearly 10 which means a period of observation of approximately 1 year and less than 1 year for sa and s3b respectively considering their repeat periods in addition this seems to confirm the value of sa mission which is the only one operating at ka band amongst those considered as a matter of fact although considering wider inland water bodies and rivers e g nearly 5 km schwatke et al 2015 proved the higher potential of a ka band instrument compared to the typical ku band sensors thus offering promising expectation from future satellite missions that envisage the adoption of ka band altimeter e g swot mission the evolution of the calibration performance in relation to m number of observations is clearly depicted by fig 8 where the maximum mae obtained during the calibrations typically decreases with extensive series looking at the errors obtained using in situ data red lines the maximum mae reaches the minimum value after a limited amount of data assuming errors that are almost uniform along the study area the optimal error varies in the range 10 30 cm see also table 3 the evolution of the black lines altimetry data confirms previous findings on satellite potential s3a s3b j3 j2 and tp products ensure the fastest achievement of the minimum error however regarding the distance between red and black lines which can be considered as a measure of the error introduced in the model calibration when using altimetry data instead of in situ e series provide performances comparable to that of j2 see table 4 on the contrary tp series despite being more frequent introduce larger errors nearly double that of e or j2 finally it is worth highlighting the performance of s3b272 which ensures the lowest error amongst all considered satellite series these results are clearly summarized in fig 9 which shows the temporal distribution of the satellite series together with their calibration performances what is evident is that with the only exception of ex and caution on considering j3 the error and its variability are generally decreasing in time showing a constant improvement in satellite capacity to remotely observe water elevation this potential of altimetry time series is also confirmed by the validation results table 4 for which the lowest ns is equal to 0 54 in general if not even better ns values are comparable to the ones obtained during the calibration phase only in few cases the validation provided accuracy significantly worse than the one achieved during the calibration e g s3b272 s3a272 findings concerning saral altika might be misleading since the poor performance at sa44 which is responsible for the significant size of the error box as a matter of fact the additional error introduced at sa629 is equal to 0 09 m which is the lowest of all the series future analysis with longer sa series will reveal the real potential of this satellite product for model calibration concerning the use of mm series on model calibration in the light of the higher number of observations combined by mm series the calibration easily converges to the final configuration figs 10 and 11 however errors introduced using such series are higher than those associated with traditional series δ rmse and δ mae are on average equal to 0 53 m and 0 38 m respectively table 5 as expected mm performances in terms of model calibration do not vary from one location to another being the result of a spatial and temporal combination of all available satellite dataset however it is also worth noting that using high frequency water level series reduces the calibration accuracy ns also in case of referring to extended series of in situ data see comparison of ns values for in situ data in tables 4 and 5 since the calibration considers a constant manning s coefficient we argue that this loss of efficiency might be due to the consideration of a higher variability of river flow conditions which include both low and peak flow regime as a matter of fact a model calibrated referring to medium to large flow conditions that are those most frequent in the river might have poor performance when used to reproduce low flow scenarios see e g moramarco e singh 2010 domeneghetti et al 2012 validation results confirm the potential of mm time series for model calibration reporting performances in line with those achieved calibrating the model using in situ data for the same time period values in brackets in table 5 leaving aside specific performances of different single mission products the calibrated roughness coefficients obtained considering one time series at time first two columns of table 6 appear in line with values obtained from previous studies performed over the study area which shown a general decreasing trend moving downstream reference values are 0 004 0 042 0 025 sm 1 3 for the upper middle e lower river portion respectively see domeneghetti et al 2014 similar behaviour is also observed adopting mm series with variation on roughness values not particularly significant 5 3 potential and limits of mm altimetry series for model calibration using mm series always entails an additional error δ rmse and δ mae are always positive with values up to 0 56 m and 0 38 m respectively the only exception is represented by mm ex775 which is due to the poor performance of ex series at that location thus in case of considering the overall altimetry series length m ltot which varies in relation to the series the use of a single mm series for model calibration does not provide benefits and is not recommended however results presented in figs 12 17 provide more insights ns variability panel c associated to mm grey lines is always lower than the one obtained with the original series black lines thus providing more stable calibration even for very short calibration periods this is particularly significant in case of altimetry series with limited observation frequency i e 35 days such as e and sa for which the calibration immediately converges to the real manning coefficient black and grey lines overlap in panels d even using data observed within 1 observation period i e 20 months see e g figs 12 and 14 on the contrary differences are much larger and not negligible in case of satellite products characterized by higher temporal observation frequency i e j2 j3 and tp this might be explained by considering that in case of high frequency series i e those with revisit time of 10 days the mm generation process further enhances the temporal coverage of the remote series but it introduces errors larger than those associated with the original satellite series which are still in any case frequent enough to provide a reliable calibration when using all mm series together some differences emerged in terms of calibrated manning s coefficients which are not always in agreement with those obtained considering one vs at time table 6 this is due to the mutual interaction of the calibrating river cross sections vss that requires local modification of the friction values to deal with opposing biases however apart for few exceptions mm120 and mma272 the use of all mm series together provides performances along the entire river in line with those ensured by adopting one mm series at time which is promising in assuring a proper simulation of flowing dynamics over long river stretch although the improvement of the methodology used for the construction of mm series is out of the scope of the current investigation a possible strategy towards an improvement of mm reliability and accuracy at the expense of some temporal frequency reduction could be the adoption of only best performing single missions e g e j2 j3 and sa preliminary trials on this matter did not provide satisfying results but future work will further investigate in this direction in this context future analysis could also consider the opportunity to include other recent altimetry products that although characterized by long repeat cycles have high accuracy on water level measurement this is the case for example of icesat 2 atlas altimetry available from december 2018 that can ensure high accuracy on water elevation sensing but has a repeat period of 91 days see e g yuan et al 2020 shifting in space such information could further sustain satellite products exploitation for inland river monitoring in addition any progresses in the characterization of river geometry e g river width and of its dynamic e g flow time lag are expected to lead to further improvements in mm accuracy 6 conclusions this study provides additional insights regarding the potential of satellite altimetry sensors for hydraulic applications although not aspiring at providing an evaluation and comparison of altimetry missions in absolute terms a wider spectrum of rivers and flowing conditions would have been necessary this work offers a comprehensive and cross missions view of the potential of such products together with mm series which have been tested for hydraulic model calibration to this end we referred to a reach of nearly 140 km of the po river for which we implemented a quasi 2d hydraulic model based on detailed topography data in general altimetry time series properly reproduce observed water level time series showing correlation coefficients r always larger than 0 6 in case of single missions despite limited to one vs s3b sentinel 3b ensures the lowest error ŋ 0 j2 jason 2 shows high accuracy mean error equal to 20 cm followed by s3a sentinel 3a j3 jason 3 and envisat e even though the limited extent of the derived time series sa saral altika shows promising performances with high r values higher than 0 9 on the contrary and despite the high number of observations tp topex poseidon series do not ensure reliable estimation of water levels mm series ensures a uniform behaviour along the study area r is nearly constant and equal to 0 80 however their performances at a given location are always lower than those obtained considering the original altimetry series see tables 2 and 3 results of the model calibration depict a general temporal improvement of satellite performances moving from the oldest to more recent missions with the only exception of ex series see fig 9 the lower additional error induced by the use of remote sensing data on model calibration δ mae is limited to nearly 20 cm in case of using j2 and e series while it is larger up to 30 40 cm in case of other series up to 60 cm in case of ers 2 series domeneghetti et al 2015a j2 series ensure trustworthiness and reliability on the calibration process with the lower temporal observation extent lower than 1 year of data 30 observations followed by j3 and s3a that reach the same reliability after 1 5 1 6 and 2 2 years respectively i e 50 60 and 30 observations respectively for a similar performance e requires nearly 3 5 years of data i e 35 observations using ers 2 data would require a series extent up to 4 5 years nearly 50 observations considering a satellite revisit time of 35 days unless limited in time results show sa and s3b time series potential in achieving reliable calibration using only few observations e g nearly 10 the use of mm series for model calibration has provided errors higher than those obtained using original satellite series in case of considering their overall length additional errors are equal to 0 56 m and 0 38 m in terms of δ rmse and δ mae respectively however the comparison of mm and original series performances in relation to the number of available observations depicts the potential of mm series which are able to ensure calibrations more reliable than those obtained in case of altimetry series provided by low frequency satellites i e e sa that cover very short period e g 1 2 observation period 20 40 months in these conditions mm series offer calibration performances i e reliable estimation of the friction coefficient and lower uncertainty higher than those ensured with the original series however if satellite sensors with higher temporal observation frequency are available i e j2 and j3 the use of original series even though limited in terms of observations appears to be the best option that said mm series ensure a higher spatial coverage of the river which could be significant when referring to long river stretch and single altimetry missions characterized by long inter track distances credit authorship contribution statement alessio domeneghetti conceptualization methodology software investigation writing original draft writing review editing giada molari methodology software investigation visualization writing review editing mohammad j tourian data curation writing original draft writing review editing angelica tarpanelli data curation writing original draft writing review editing sajedeh behnia data curation writing original draft writing review editing tommaso moramarco supervision writing original draft nico sneeuw supervision armando brath supervision declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgements the authors are particularly grateful to the interregional agency for the po river agenzia interregionale per il fiume po aipo italy and po river basin authority autorità di bacino del fiume po italy that allow the access to the high resolution dtm of river po in situ hydrological data are available through hydrological annual books and on line web service dext3r https simc arpae it dext3r the authors are grateful to the european space agency for providing the envisat data the satellite data of topex poseidon are provided by physical oceanographic distributed active archive centre podaac ftp podaacftp jpl nasa gov alldata thanks are also due to aviso http www aviso altimetry fr for providing saral altika data and jason 2 hydrology product and jason 3 data sentinel 3a and sentinel 3b series are extracted from the copernicus data repository https scihub copernicus eu 
314,satellite altimetry is increasingly considered as a valuable source of information in many hydrological and hydraulic applications however the accuracy of different sensors adopted for monitoring the water level from satellite and the limited temporal resolution that characterizes each sensor i e revisit time most of time varying from 10 to 35 days 369 days in case of cryosat mission still hamper their common use recently introduced multi mission mm densified time series might represent a possible alternative to ensure higher spatial and temporal coverage though a comparison of the potential of different altimetry products including mm series for hydrodynamic model calibration is still missing this study attempts to fill this gap investigating how available altimetry series perform over a stretch of the po river nearly 140 km across northern italy in calibrating a quasi 2d model built with detailed topographic information specifically objectives are manifold i to provide a comparison of satellite altimetry products available to the research community and commonly used in hydraulic modelling envisat envisat extended mission ers 2 topex poseidon saral altika jason 2 jason 3 sentinel 3a sentinel 3b and cryosat ii to evaluate the performance of mm satellite series in calibrating a hydraulic model relative to single mission series and iii to investigate the importance of the number of observations series length for each mission results of the model calibration depict a general improvement of satellite performance over time moving from the oldest to more recent missions with the exception of envisat extended series in general jason 2 sentinel 3a and sentinel 3b outperform other series both in terms of calibration error and number of measurements required to achieve a reliable calibration mm series provide errors larger than those obtained from original single mission time series considered with their overall length but they provide more reliable calibrations than altimetric time series with low sampling rate i e envisat envisat extended and saral altika or those that cover very short periods e g altimetry series limited to 20 40 months in length the analysis offers additional insights into the possible use of altimetry series in hydrodynamic applications providing a comparison of different original products and showing the potential as well as limitations offered by mm series keywords remote sensing satellite altimetry hydraulic model calibration uncertainty analysis po river 1 introduction over the last thirty years hydraulic modelling has developed to such an extent that it can now provide high quality flood risk maps merz et al 2010 damage assessment luino et al 2009 water resource management loucks et al 2005 real time flood forecasting arduino et al 2005 and dynamic perspective in case of future scenarios bronstert 2003 hydraulic modelling describes the flood routing and hence tracks the propagation of a flood wave given as an input at an upstream location of a river channel to any downstream locations the routing model requires an accurate geometric description of the river channel and floodplains reliable input of river discharge and the calibration of the roughness parameter considered as the most important factor that has an impact on predicting flow characteristics aronica et al 1998 bates et al 1996 pappenberger et al 2005 the model calibration generally consists in tuning the roughness parameter to minimize the misfit between simulated and observed output represented by flow or water level hydrographs typically the calibration is done by using water level or discharge observations gathered at the gauged stations available along the river recently scientific literature is enriched by studies on the integration of remote sensing and ground observations for hydraulic model calibration numerous examples use the flood extent derived by the backscatter value of synthetic aperture radar sar images to calibrate the roughness parameter andreadis and schumann 2014 matgen et al 2011 tarpanelli et al 2013a in some cases considering also the uncertainty in the flood extraction di baldassarre et al 2009 giustarini et al 2015 directly related to the water surface elevation satellite altimetry has demonstrated its large potential in the calibration of 1d or 2d hydraulic models domeneghetti et al 2014 o loughlin et al 2013 yan et al 2014 neal et al 2012 calibrated the hydraulic model lisflood fp for an 800 km reach of the niger river in mali using the laser altimetry data from ice cloud and land elevation satellite icesat differently from the radar altimetry data that are collected with a given repeat period at the same locations icesat does not produce repeat track measurements and although considered the most accurate source of altimetry information the hydrological community is still sceptical about monitoring rivers in a different way from the traditional adoption of fixed gauging stations o loughlin et al 2016 similarly cryosat 2 satellite suffers from a limited use due to the almost annual repeat cycle i e 369 days which is considered inadequate to represent river dynamics however its dense spatial sampling about 7 5 km at the equator can be extremely useful in deriving water level profiles that normally cannot be achieved schneider et al 2018 used cryosat 2 water level data to calibrate the manning roughness coefficient each 10 km over the po river main channel by using the dhi mike 11 software dhi 2015 compared with values calibrated through in situ measurements cryosat 2 showed a strong potential to calibrate the roughness coefficient at a more detailed level with the consequent reduction of the over and under estimation of the high flows jiang et al 2019 concerning traditional radar altimetry i e short repeat and fixed orbit missions such as ers 2 envisat and jason 2 several examples have demonstrated its valid contribution in supporting the ground network for describing the hydrometric regime garambois et al 2017 emery et al 2016 and the potential benefits expected in case of its integration with in situ data domeneghetti et al 2014 huang et al 2018 and reference therein similar studies have mostly focused on rivers larger in width than about 300 m a limitation imposed by the along track spatial resolution of delay doppler altimetry the fully focused sar ff sar processing however improves the along track resolution of sar altimetry up to the theoretical threshold of half of the antenna length egido and smith 2016 vignudelli et al 2019 kleinherenbrink et al 2020 have implemented the ff sar algorithm over lakes canals and ditches in netherlands using cryosat 2 full bit rate data for cases where the altimetry track crosses the water bodies in a near perpendicular angle they have successfully derived the water level of a ditch as small as 5 m in width and located only 10 m away from a canal though more studies are required to indicate the potentials and limitations of ff sar it is expected that the method would open an unprecedented opportunity to monitor smaller water bodies moreover when the future swot mission is fully operational for rivers wider than 100 m possibly as narrow as 50 m desai 2018 frasson et al 2019 a 2d river mapping at 10 70 m resolution is anticipated biancamaria et al 2016 concerning the use of traditional radar altimetry for the calibration of the hydraulic model two limitations are the most relevant and worth to be analysed the length duration of the time series and the revisit time of the satellite the importance of the duration i e years of observation or number of overpasses of the satellite mission has been analysed by domeneghetti et al 2015 who showed its impact on the estimation of the roughness coefficient in particular they found that sample sizes of 2 5 years can be considered sufficient to the calibration process in case of using ers 2 and envisat time series however an extension of similar investigations to other satellites is desirable to assess the potential of current and past altimetry missions for hydraulic simulations also the revisit time typically 10 to 35 days for altimetry missions represents a limitation for hydrodynamic applications a possible solution is the development of approaches that consider the use of multiple missions mm to derive densified time series in specific locations tourian et al 2016 transferred the water level information coming from four satellite missions jason 2 envisat saral and cryosat 2 and hence several virtual stations to specific locations of the river coincident with the ground monitoring stations along the po mississippi congo and danube rivers the combination of the altimetry data has been carried out with the hydraulic concepts of wave travel time and celerity of the flow calculated with the geometric characteristics of the river such as length of the reach slope and width a successive study of tourian et al 2017 analysed a similar approach over the niger river and obtained river discharge by assimilating altimetric and in situ river discharge with a kalman filter approach boergens et al 2017 integrated water level measurements of envisat saral and jason 2 by using ordinary kriging in the main channel of the mekong river all these attempts to increase the frequency of sampling of the river water surface are valuable contributions especially for hydrological applications and for deriving more frequent discharge time series however the value of mm time series has never been tested in hydraulic modelling moving from previous considerations the present work proposes to investigate three main aspects that are still only partially analysed in the literature 1 to compare the available altimetry data in terms of their performance for the calibration of hydraulic models specifically the analysis provides a comprehensive comparison of different satellite altimetry products available to the research community and covering nearly 27 years such as envisat e envisat extended mission ex topex poseidon tp saral altika sa jason 2 j2 and jason 3 j3 sentinel 3a s3a and sentinel 3b s3b despite not directly analysed the potential of ers 2 and cryosat is also presented taking advantage of previous studies carried out on the same study area domeneghetti et al 2015 schneider et al 2018 2 to assess the effect of the record length i e number of available satellite measurements in relation to different data products on the calibration reliability the study investigates the possible accuracy of the model calibration in relation to the record length of the altimetry product adopted for its execution this info could be beneficial not only at the early stages of a mission but also when historical time series are limited in length perhaps due to missing values or mission interruption findings of such evaluation might serve a modeller when called to evaluate the extent of the calibration period 3 to test the use of mm satellite time series in the process of hydraulic model calibration these synthetic altimetry time series result from the combination of different single mission time series and overcome the spatial and temporal sampling limits that characterize a given single mission see e g tourian et al 2016 the construction of mm time series represents a recent frontier towards a larger exploitation of altimetry data provided from the overall set of past and on going satellite missions see also coss et al 2020 thus the evaluation of its potential for the implementation of an accurate and reliable hydraulic model constitutes an element of interest for the hydrologic community although not claiming to provide a general statement and ranking of the altimetry products which would require considering a large set of rivers having a variety of hydrological and morphological characteristics this study aims at delivering a comprehensive and cross missions view of the potential of current and past altimetry data the analysis is implemented along the po river in the stretch between the gauged stations of borgoforte basin area equal to 62 450 km² and pontelagoscuro basin area equal to 70 091 km2 for a direct comparison with other studies the hydraulic simulation is carried out with the hec ras software package hydrologic engineering centre 2001 in a quasi 2d configuration see section 3 1 2 study area and altimetry time series 2 1 study area fig 1 presents the area of interest about 140 km reach of the lower portion of the po river the largest and longest italian river that flows in eastern direction across northern italy considering the social and economic importance of this area the po river is consistently monitored and controlled by the po river basin authority adb po which records and provides hydrological and geometrical ground observations used in this study montanari et al 2017 the analysis focuses on the river reach that is limited upstream by the gauging station of borgoforte and downstream by the beginning of the river delta along this portion the main channel width ranges from 200 to 500 m while lateral floodplains may span up to 2 5 km fig 1 shows virtual stations vss locations where satellite tracks cross with the river considered in this study as well as the position of gauged stations i e borgoforte and pontelagoscuro where river discharge and water surface elevation are recorded daily from 1923 to 1922 respectively although po river dynamic and its off seasonal behaviour may result challenging for the use of altimetry data it represents a profitable case study where both traditionally observed and remotely sensed hydrological data are available domeneghetti et al 2014 2015 2 2 satellite altimetry products table 1 summarizes the different altimetry missions considered in the study envisat e envisat extended mission ex topex poseidon tp saral altika sa jason 2 j2 jason 3 j3 sentinel 3a s3a and sentinel 3b s3b these missions are characterized by different sensors instrumentation scopes and orbits therefore the respective altimetry time series are characterized by distinctive temporal and spatial resolution as well as different accuracy and reliability most of the considered missions have a low temporal resolution i e 35 days for e and sa 30 days for ex and 27 days for s3a and s3b while tp j2 and j3 provide water surface elevation measurements every 10 days e mission period 05 2002 10 2010 and sa 03 2013 01 2016 are the successors of the former mission ers 2 04 1995 09 2007 using the same orbit configuration with inter track distance of 80 km at equator and a repeat cycle of 35 days e ex and sa data are processed adopting ice 1 retracker shown to provide robust and accurate results over rivers frappart et al 2006 silva et al 2010 j2 launched in june 2008 is the successor of the former missions tp 09 1992 08 2002 and j3 was launched in 2016 as the successor of j2 and placed in the same orbit with the inter track distance of about 315 km at equator and a repeat cycle of 10 days for both j2 and j3 the water levels are derived using the ice retracker as it has proven to outperform other retrackers over continental waters cretaux et al 2018 the currently active s3a and s3b guarantee the continuity of e type measurements in a fully operational manner sentinel 3 provides sar altimetry data with a revisit time of 27 days the two missions have orbits almost similar to that of e and ers with the ground track separation of 104 km at equator s3a and s3b data are processed using the ocog retracker which is a heritage of ice 1 and hence reliable for inland applications all water level time series are processed using the high rate altimetry datasets the usual rate for all missions is 20 hz which leads to the along track distance of 294 m between successive measurements sa dataset however is provided with the sampling rate of 40 hz and hence the spatial spacing of 173 m along track for clarity fig 2 presents the temporal coverage of the altimetry products considered in the study while fig 3 reports a synoptic view of the water levels derived from the different missions referring to the same study area tarpanelli et al 2013b and domeneghetti et al 2014 2015 investigated the potential of ers 2 time series for similar purposes the comparison of ers 2 with water level values recorded at the nearest gauging station or estimated at vss shows significant correlations with the mean absolute error in the order of 0 7 m in particular domeneghetti et al 2015 investigated the effect of ers 2 uncertainty on model calibration while schneider et al 2018 did the same considering cryosat time series for the sake of brevity and to avoid the repetition of already performed investigations calibrations with ers 2 and cryosat data are not carried out in this work actually the drifting orbit of cryosat implies a long repeat ground track pattern that would impose the adoption of different calibration strategies i e it is not straightforward to construct time series since its long repeat cycle 369 day nevertheless this does affect the completeness of this investigation results previously obtained with both ers 2 and cryosat are summarized and compared with those of other altimetry time series to provide a complete overview of altimetry performance 2 3 multi mission mm altimetry time series at high spatial and temporal coverage water level time series from individual altimetry missions over the river are merged using an approach developed by tourian et al 2016 to overcome spatial and temporal limitation of single altimetry missions adopting this solution all vss of several satellite altimeters along the po river are connected to each other hydraulically and statistically to this end first the bias between different missions is removed see tourian et al 2016 for more details then for any given location along the river the time lag due to stream flow between the altimetric virtual stations and the selected location is estimated since the mm approach has been developed for being applicable also on poorly surveyed areas average river width using imagery together with the slope derived from satellite altimetry are used as inputs to a simple empirical hydraulic equation that estimates average flow velocity and thus the time lag between vss bjerklie et al 2005 tourian et al 2015 fig 4 shows the estimated time lag between vs along the po river highlighted with those selected for this study from the most upstream selected vs in this study tp120 j2 120 and j3 120 see fig 1 till most downstream vs tp85 j2 85 and j3 85 the time lag is about 0 85 day using the estimated time lag the water level hydrographs of all measurements are shifted and stacked at the selected location the stacked time series at the selected location is then normalized according to its statistical distribution and especially the water level value at 3rd and 85th percentiles as lower and upper bounds as an example fig 5 shows normalized water level obtained at vs j2 85 for which first the time lag between all vss and the j2 85 is corrected and then individual time series are normalized according to their 3rd and 85th percentiles afterwards outliers are identified and removed from the normalized time series by defining a confidence limit of 99 of a student s t test for a one month sliding time window the confidence limit is delineated in fig 5 by an upper and a lower bound confidence level all measurements outside the confidence limit are identified as outlier and removed from measurements the outlier free normalized time series is then rescaled back according to the water level distribution of the selected location fig 6 using this methodology we obtain a time series with 3 days effective temporal resolution from altimetry missions originally with temporal resolution ranging from 10 to 35 days the mm water level time series are validated at the gauging stations of borgoforte and pontelagoscuro for which individual water level time series are densified obtaining correlation coefficient equal to 0 75 and 0 78 rmse root mean square error of the value of 0 94 m and 0 75 m and bias of 0 05 and 0 37 m respectively the accuracy of mm series inevitably conveys the simplifications and assumptions of the approach used for their construction thought for applications in data scarce areas those simplifications mainly regards the description of the river geometry and dynamics i e river width and time lag investigating the impacts of such limitations on the use of mm series for the calibration was out of the scope of this work nevertheless these analyses are suggested for future work 3 numerical analysis and methodological approach 3 1 model set up calibration and validation the numerical simulations of the river stretch of interest is carried out by means of a quasi two dimensional quasi 2d model implemented with the hec ras code that uses an implicit four point finite difference algorithm to solve the de saint venant equations the river geometry is properly reproduced by taking advantage of a 2 m dem digital elevation model available along the overall po river which combines a lidar survey of the emerged river portion with traditional ground cross sections and multi beam sonar surveys camorani et al 2006 the quasi 2d scheme ensures a proper representation of the flow dynamics by enabling mutual interactions between the main channel and a series of lateral floodplains i e storage areas delimited by a system of minor dikes which are schematized within the code as lateral structures although the numerical scheme refers to 1d hydraulic equations the adoption of this schematization enables a proper simulation of the hydraulic interaction amongst the main channel and lateral floodplains the appropriateness of this configuration has been proven by a number of previous studies that referred to the same river portion castellarin et al 2011a 2011b domeneghetti et al 2015 the numerical simulations for the overall period of interest 1992 2019 are carried out by imposing the mean daily discharge values recorded at the upstream gauged station borgoforte as upstream boundary conditions and the normal flow condition at the downstream cross section located at the beginning of the river delta see fig 1 according to previous experiences on the study area domeneghetti et al 2014 2015a lateral inflows of some minor tributaries are not taken into account during the simulation since their contributions are neglectable relative to the po river discharge the calibration procedure focuses on the identification of the manning coefficient n s m 1 3 of the main channel that maximizes the nash sutcliffe efficiency ns nash and sutcliffe 1970 coefficient obtained in reproducing the observed water levels by varying it within the range 0 01 0 06 s m 1 3 because the quasi 2d model has limited sensitivity to the roughness coefficient adopted for the floodplains its value is considered constant and equal to 0 1 s m 1 3 for all the numerical simulations see also castellarin et al 2011a domeneghetti et al 2015a referring to the simulation time frame considered in this study 1995 2019 calibration and validation schemes vary in relation to investigation setting as indicated hereafter a analysis considering one vs at time referring separately to the dataset retrieved from specific altimetry mission table 1 fig 1 and the mm time series in each calibration the roughness coefficient is unique and assumed to be static through time for each single mission the calibration is performed referring to the overall period of altimetry data availability see fig 3 once calibrated the model validation is carried out comparing simulated water surface levels with in situ data available within the considered time frame 1995 2019 and not used for the calibration for a single mm series that covers the overall period of interest the latter is split in two parts 1995 2017 for calibration 2017 2019 for validation b analysis considering all mm time series together the calibration adopts spatially distributed parameterization by splitting the river into a number of stretches corresponding to vss locations and considering multiple roughness coefficients when referring to mm time series the calibration covers the period that consider the presence of all altimetry missions its considerable extent 22 years from 1995 to 2017 ensures a data series length sufficient to ensure a consolidated calibration guaranteeing at the same time a sufficient validation period 2 years 2018 2019 3 2 accuracy of altimetry products typically as spotted in fig 1 vss do not coincide with gauging stations and thus a direct comparison between traditional observation and remotely sensed data is not straightforward to overcome this problem we compare the satellite derived water surface elevation values hsat x t sensed at a given location x at the day of the satellite overpass t with the in situ water surface elevation hsitu x t linearly interpolated at the track location referring to concurrent water levels measured at the gauging stations located upstream and downstream the satellite track this appears reasonable in the absence of diversion structures or dams along the river portion of interest following this approach the error ε x t can be calculated with the eq 1 1 ε x t h s a t x t h s i t u x t which has been applied distinguishing all the altimetry products the same approach is used considering the mm time series where t covers all days of observation sensed by at least one of the considered altimetry missions considering that different altimetry missions use different reference ellipsoids topex ellipsoid for tp j2 j3 and sa and the wgs84 for e ex s3a and s3b we calculate the geoid height with respect to the one adopted for mm creation egm2008 the same for in situ data which refer to italgeo 2005 geoid barzaghi et al 2007 3 3 impact of vs time series length on calibration the length of an altimetry dataset m i e the number of satellite overpasses available at a given vs from a specific altimeter which differs from the official mission duration influences the reliability of the calibration domeneghetti et al 2015a to investigate its impact for different satellite products we repeat the calibration exercise by considering several altimetry subsets randomly sampled from each original altimetry time series i e e tp j2 etc with a length m that varies from 3 to ltot in this case ltot indicates the total amount of altimetric observations available for a given mission at a specific vs indicating with x the location of a given vs along the study area the subset sampled from the original altimetry time series and used for the calibration can be expressed as 2 h s a t m x h s a t x t 1 h s a t x t m m 3 l t o t for m lower than 3 the time series is considered too short and not suitable for calibration purposes to overcome the uncertainty related to the selection of the m observations amongst those available for a given mission and at a given vs the sampling procedure is embedded in a monte carlo framework that generates 1000 random h sat m samples for each m value once sampled the calibration is carried out considering each h sat m sample at time finally with the aim to infer the error introduced by the altimetry data we repeat the same procedure by calibrating the numerical model with reference to different subsets randomly extracted from the water level values observed in situ at the vs hsitu eq 3 indicates the in situ time series randomly extracted from the overall set 3 h s i t u m x h s i t u x t 1 h s i t u x t m m 3 l t o t calibration results obtained with these h situ m x samples are used as a reference for evaluating the potential of altimetry for model calibration for what regards the adoption of mm time series in order to make the calibration performances of mm and traditional time series comparable we refer to specific observation periods instead of considering a given number of observations m the observation period is expressed in terms of a number of months from the date of the first altimetry observation and varies in relation to the revisit time of each mission 12 months for tp j2 and j3 i e high frequency missions 14 months for s3a and 20 months for other missions based on this temporal discretization once identified a given observation period e g 1 2 n observation periods the number of altimetry observations adopted for the calibration for both mm and traditional time series is defined as the sum of all available water levels values observed since the beginning of the time series 4 results 4 1 accuracy of altimetry products table 2 summarizes the results of the comparison between altimetry time series and in situ water surface elevations estimated at vs locations in particular the table reports the number of observations that constitutes each time series the correlation coefficient r between altimetry and in situ data the ns value the mean absolute error mae as well as the mean µ and standard deviation σ of the errors expressed following eq 1 altimetry products are listed in a chronological order following fig 2 in case of vss observed from multiple sensors e g vs 85 and vs 120 each time series is considered separately table 3 reports the same error statistics referring to mm time series which is unique for each vs 4 2 performance of different altimetry time series on model calibration table 4 summarizes the results of the model calibrations and validations carried out using each altimetry time series at a time it reports ns rmse and mae obtained at each satellite track considering the overall available datasets which means m ltot these performance statistics are compared with the ones obtained by repeating the calibration considering in situ water level elevation interpolated at the same location and time of the satellite overpasses values in brackets δ rmse and δ mae quantify the additional calibration errors due to the use of altimetry data instead of in situ ones while the last three columns report the results of the validation performed using satellite time series fig 7 reports the results of the calibration exercise performed considering altimetry time series of different length and randomly sampled from the original datasets see eq 2 considering each altimetry product and vs at time panels of fig 7 show the calibrated roughness coefficient in relation to the number of observations m used for the calibration the solid line indicates the manning coefficient that ensures the optimal ns value amongst the 1000 calibrations performed with a given m value while the grey area represents the range of variability of the roughness coefficients calibrated within the monte carlo framework the wider this area the more the results of a calibration process depend on the altimetry record used for the calibration with the risk of being significantly influenced by the range of water levels sensed during a specific period e g mainly high flows or low flows fig 8 provides an overview of the maximum error that we can expect when we use altimetry data for the calibration of a hydrodynamic model the black line indicates the maximum mae as function of m thus the maximum error obtained considering all possible calibrated configurations obtained in the monte carlo framework with a given data length i e grey areas in fig 7 the comparison with the same maximum mae obtained calibrating the model with in situ data red line provides a quantitative estimation of the additional error induced by satellite altimetry uncertainty fig 9 summarizes the findings of fig 8 showing the temporal evolution of the performance of satellite altimetry for model calibration the length of each box represents the temporal coverage of the mission while the box height identifies the range of variability of the mae obtained during the calibration considering the overall amount of available observations see also table 4 in order to give a complete overview fig 9 also includes the results from the previous investigation using ers 2 see domeneghetti et al 2015a a similar calibration exercise over the po river was done by schneider et al 2018 using cryosat 2 series observed during the period 2010 2016 their findings report an average rmse me mean error of nearly 0 4 m 0 18 m for the sar mode with values ranging from 0 06 m 0 05 m up to 0 63 m 0 23 m not shown in fig 9 due to the use of different error metrics 4 3 performances of mm series on model calibration table 5 summarizes the results of the calibration 1995 2017 performed using mm series as well as those obtained using in situ water levels observed in the same period at the same day of the satellite overpasses mm series are specified for each vs sensed along the study area thus table 5 has only 11 rows according to the number of intersections between the po river and the considered satellite orbits vss as previously shown for the original satellite altimetry data see section 3 2 fig 10 reports the results of the calibration carried out adopting mm altimetry series of different length and randomly sampled from the datasets used for calibration considering each vs at a time panels in fig 10 show the manning coefficient calibrated in relation to the series length m the solid black line indicates the roughness coefficient that ensures the optimal ns value amongst those tested for a given m value while the grey area represents the range of variability of the calibrated coefficients even in this case the width of the grey area is indicative of the sensibility of the calibration result to the length of the altimetry record used for the calibration it is worth noting here that the temporal interval considered for calibration 1995 2017 is long enough to guarantee the achievement of a consolidated and stable calibration fig 11 reports the maximum error obtained by calibrating the model with mm series the black line indicates the maximum mae as function of m which is compared with the error obtained when calibrating the same model with an in situ data record of the same length red line 4 4 comparison of single and mm altimetry series table 6 presents the calibration results obtained using the mm time series results are compared with those achieved by calibrating the model with the original satellite altimetry available at the different vss values reported in table 6 refer to the case of considering the overall altimetry series length m ltot last four columns report the calibration validation performances when considering the overall set of mm series along the po river figs 12 17 show the comparison between original satellite series and mm ones each figure represents one satellite mission e22 j2 85 sa629 tp120 j3 85 and s3a 272 from fig 12 to 17 respectively s3b 272 is not shown since the limited amount of data for each figure panel a represents the number of measurements using mm series grey columns and unique sensor black columns considering different observation periods temporal step equal to 20 months for e22 and sa44 2 months for j2 85 j3 85 and tp120 14 months for s3a 272 panels b c and d depict mae ns variability and manning s coefficient as a function of the number of available data respectively 5 discussion 5 1 accuracy of altimetry products table 2 summarizes the comparison between satellite and original altimetry data excluding ex775 which has a very limited number of observations all the altimetry series show quite high r values which are always larger than 0 6 and generally improves moving from historical missions to the most recent ones similarly ns values are in general positive with the few exceptions of ex775 and tp85 in general j2 series outperform all other missions providing a mean error µ of about 20 cm and the lowest values of standard deviation µ 0 38 cm in the worst case despite the limited amount of observations s3b is the only time series having a lower mean error µ 0 while s3a series show performance in line with those of j2 and s3b unless irregular amongst the available vss j3 provides µ values comparable to those of j2 but higher standard deviations σ a possible justification can be due to the characteristics of j3 series which appear shorter than those of j2 nearly 1 3 in length see table 2 and characterized by a higher frequency of low flow conditions this latter aspect is evident in fig 3 where j3 covers a period of time 2016 on during which water levels are on average lower meaning low flow period than what observed by j2 yellow lines this aspect may play a significant role when considering possible hooking effect or off nadir effect schwatke et al 2015 which is expected to be more relevant in case of smaller water extent in addition to this after a closer look at j3 data and correspondent observed level the performance of j3 at vs 120 appears strongly influenced by few significant errors observed during a short period beginning of 2018 during which the altimeter sensed water level considerably higher than the observed ones those errors since the limited extent of j3 series heavily affect the statistics which would have been in line with those of j2 otherwise sa series ensure high correlation values while mae values are worse than those from the older mission e this might be due to the limited length of the series 8 and 15 observations in total at the two available vss in contrast despite the number of available observations tp provides the worst results with low ns and high mae values the mean error values µ indicate a general overestimation of the satellite series µ 0 with the only exception of tp120 that shows a negative bias finally referring to ers 2 data domeneghetti et al 2015a identify mae values in the order of 0 7 m with µ and σ up to 0 64 cm and 0 84 cm respectively at two vs along the po river table 3 shows the results of the same comparison performed with mm series results highlight a uniform performance in terms of r 0 80 ns values are in general positive even if always lower than 0 66 in general performance indexes appear more homogeneous along the study area which is somehow expected considering the way the mm series are defined along the river looking at the spatial distribution of the error the analysis performed does not enable the identification of a specific relationship amongst error magnitude and river morphology such as river width or river orientation however it is worth noting that in general the performances obtained considering the mm series at a given location are always lower than those obtained considering the original altimetry series with the only exception of few vss where the performances of the altimetry products were not convincing perhaps due to their limited length e g vs 775 in such a case mm series is more capable to reproduce the observed water level dynamics 5 2 values of satellite altimetry and effects of time series length on model calibration the results of the calibration performed using satellite altimetry shed some light on the potential of different products for modelling applications in particular the influence of the number of observations on the variability of the results varies in relation to the satellite product assuming that a calibration result should be considered reliable when the variability of the roughness coefficient is very limited i e 0 005 s m 1 3 in terms of manning s coefficient this condition is reached in case of considering a number of observations that varies from one mission to another looking at fig 7 this target is reached for e in case of using more than nearly 35 observations which means nearly 3 5 years of observation considering its revisit time 35 days similar results have been obtained considering ers 2 series domeneghetti et al 2015a the lengths of required series become smaller in case of tp revisit time equal to 10 days which ensures reliable performance with 50 observations recorded on average in 1 5 years better performances are obtained in case of j2 series for which the same performance is obtained calibrating the model with nearly 30 observations less than 1 year of record considering its temporal resolution the same number of observations is required by s3a although its lower repeat period extends the time series up to more than 2 years similarly 30 observations are needed for j3 85 while nearly 60 slightly more than 1 5 year are required for the j3 120 again this latter difference can be justified by the errors noticed for j3 120 series and previously described regarding the satellite series ex the limited number of available observations prevents us from drawing general conclusions the same holds for sa44 8 measurements in total despite the limited amount of data the calibration results with s3b272 and sa629 are good the calibration appears reliable already with a limited number of data nearly 10 which means a period of observation of approximately 1 year and less than 1 year for sa and s3b respectively considering their repeat periods in addition this seems to confirm the value of sa mission which is the only one operating at ka band amongst those considered as a matter of fact although considering wider inland water bodies and rivers e g nearly 5 km schwatke et al 2015 proved the higher potential of a ka band instrument compared to the typical ku band sensors thus offering promising expectation from future satellite missions that envisage the adoption of ka band altimeter e g swot mission the evolution of the calibration performance in relation to m number of observations is clearly depicted by fig 8 where the maximum mae obtained during the calibrations typically decreases with extensive series looking at the errors obtained using in situ data red lines the maximum mae reaches the minimum value after a limited amount of data assuming errors that are almost uniform along the study area the optimal error varies in the range 10 30 cm see also table 3 the evolution of the black lines altimetry data confirms previous findings on satellite potential s3a s3b j3 j2 and tp products ensure the fastest achievement of the minimum error however regarding the distance between red and black lines which can be considered as a measure of the error introduced in the model calibration when using altimetry data instead of in situ e series provide performances comparable to that of j2 see table 4 on the contrary tp series despite being more frequent introduce larger errors nearly double that of e or j2 finally it is worth highlighting the performance of s3b272 which ensures the lowest error amongst all considered satellite series these results are clearly summarized in fig 9 which shows the temporal distribution of the satellite series together with their calibration performances what is evident is that with the only exception of ex and caution on considering j3 the error and its variability are generally decreasing in time showing a constant improvement in satellite capacity to remotely observe water elevation this potential of altimetry time series is also confirmed by the validation results table 4 for which the lowest ns is equal to 0 54 in general if not even better ns values are comparable to the ones obtained during the calibration phase only in few cases the validation provided accuracy significantly worse than the one achieved during the calibration e g s3b272 s3a272 findings concerning saral altika might be misleading since the poor performance at sa44 which is responsible for the significant size of the error box as a matter of fact the additional error introduced at sa629 is equal to 0 09 m which is the lowest of all the series future analysis with longer sa series will reveal the real potential of this satellite product for model calibration concerning the use of mm series on model calibration in the light of the higher number of observations combined by mm series the calibration easily converges to the final configuration figs 10 and 11 however errors introduced using such series are higher than those associated with traditional series δ rmse and δ mae are on average equal to 0 53 m and 0 38 m respectively table 5 as expected mm performances in terms of model calibration do not vary from one location to another being the result of a spatial and temporal combination of all available satellite dataset however it is also worth noting that using high frequency water level series reduces the calibration accuracy ns also in case of referring to extended series of in situ data see comparison of ns values for in situ data in tables 4 and 5 since the calibration considers a constant manning s coefficient we argue that this loss of efficiency might be due to the consideration of a higher variability of river flow conditions which include both low and peak flow regime as a matter of fact a model calibrated referring to medium to large flow conditions that are those most frequent in the river might have poor performance when used to reproduce low flow scenarios see e g moramarco e singh 2010 domeneghetti et al 2012 validation results confirm the potential of mm time series for model calibration reporting performances in line with those achieved calibrating the model using in situ data for the same time period values in brackets in table 5 leaving aside specific performances of different single mission products the calibrated roughness coefficients obtained considering one time series at time first two columns of table 6 appear in line with values obtained from previous studies performed over the study area which shown a general decreasing trend moving downstream reference values are 0 004 0 042 0 025 sm 1 3 for the upper middle e lower river portion respectively see domeneghetti et al 2014 similar behaviour is also observed adopting mm series with variation on roughness values not particularly significant 5 3 potential and limits of mm altimetry series for model calibration using mm series always entails an additional error δ rmse and δ mae are always positive with values up to 0 56 m and 0 38 m respectively the only exception is represented by mm ex775 which is due to the poor performance of ex series at that location thus in case of considering the overall altimetry series length m ltot which varies in relation to the series the use of a single mm series for model calibration does not provide benefits and is not recommended however results presented in figs 12 17 provide more insights ns variability panel c associated to mm grey lines is always lower than the one obtained with the original series black lines thus providing more stable calibration even for very short calibration periods this is particularly significant in case of altimetry series with limited observation frequency i e 35 days such as e and sa for which the calibration immediately converges to the real manning coefficient black and grey lines overlap in panels d even using data observed within 1 observation period i e 20 months see e g figs 12 and 14 on the contrary differences are much larger and not negligible in case of satellite products characterized by higher temporal observation frequency i e j2 j3 and tp this might be explained by considering that in case of high frequency series i e those with revisit time of 10 days the mm generation process further enhances the temporal coverage of the remote series but it introduces errors larger than those associated with the original satellite series which are still in any case frequent enough to provide a reliable calibration when using all mm series together some differences emerged in terms of calibrated manning s coefficients which are not always in agreement with those obtained considering one vs at time table 6 this is due to the mutual interaction of the calibrating river cross sections vss that requires local modification of the friction values to deal with opposing biases however apart for few exceptions mm120 and mma272 the use of all mm series together provides performances along the entire river in line with those ensured by adopting one mm series at time which is promising in assuring a proper simulation of flowing dynamics over long river stretch although the improvement of the methodology used for the construction of mm series is out of the scope of the current investigation a possible strategy towards an improvement of mm reliability and accuracy at the expense of some temporal frequency reduction could be the adoption of only best performing single missions e g e j2 j3 and sa preliminary trials on this matter did not provide satisfying results but future work will further investigate in this direction in this context future analysis could also consider the opportunity to include other recent altimetry products that although characterized by long repeat cycles have high accuracy on water level measurement this is the case for example of icesat 2 atlas altimetry available from december 2018 that can ensure high accuracy on water elevation sensing but has a repeat period of 91 days see e g yuan et al 2020 shifting in space such information could further sustain satellite products exploitation for inland river monitoring in addition any progresses in the characterization of river geometry e g river width and of its dynamic e g flow time lag are expected to lead to further improvements in mm accuracy 6 conclusions this study provides additional insights regarding the potential of satellite altimetry sensors for hydraulic applications although not aspiring at providing an evaluation and comparison of altimetry missions in absolute terms a wider spectrum of rivers and flowing conditions would have been necessary this work offers a comprehensive and cross missions view of the potential of such products together with mm series which have been tested for hydraulic model calibration to this end we referred to a reach of nearly 140 km of the po river for which we implemented a quasi 2d hydraulic model based on detailed topography data in general altimetry time series properly reproduce observed water level time series showing correlation coefficients r always larger than 0 6 in case of single missions despite limited to one vs s3b sentinel 3b ensures the lowest error ŋ 0 j2 jason 2 shows high accuracy mean error equal to 20 cm followed by s3a sentinel 3a j3 jason 3 and envisat e even though the limited extent of the derived time series sa saral altika shows promising performances with high r values higher than 0 9 on the contrary and despite the high number of observations tp topex poseidon series do not ensure reliable estimation of water levels mm series ensures a uniform behaviour along the study area r is nearly constant and equal to 0 80 however their performances at a given location are always lower than those obtained considering the original altimetry series see tables 2 and 3 results of the model calibration depict a general temporal improvement of satellite performances moving from the oldest to more recent missions with the only exception of ex series see fig 9 the lower additional error induced by the use of remote sensing data on model calibration δ mae is limited to nearly 20 cm in case of using j2 and e series while it is larger up to 30 40 cm in case of other series up to 60 cm in case of ers 2 series domeneghetti et al 2015a j2 series ensure trustworthiness and reliability on the calibration process with the lower temporal observation extent lower than 1 year of data 30 observations followed by j3 and s3a that reach the same reliability after 1 5 1 6 and 2 2 years respectively i e 50 60 and 30 observations respectively for a similar performance e requires nearly 3 5 years of data i e 35 observations using ers 2 data would require a series extent up to 4 5 years nearly 50 observations considering a satellite revisit time of 35 days unless limited in time results show sa and s3b time series potential in achieving reliable calibration using only few observations e g nearly 10 the use of mm series for model calibration has provided errors higher than those obtained using original satellite series in case of considering their overall length additional errors are equal to 0 56 m and 0 38 m in terms of δ rmse and δ mae respectively however the comparison of mm and original series performances in relation to the number of available observations depicts the potential of mm series which are able to ensure calibrations more reliable than those obtained in case of altimetry series provided by low frequency satellites i e e sa that cover very short period e g 1 2 observation period 20 40 months in these conditions mm series offer calibration performances i e reliable estimation of the friction coefficient and lower uncertainty higher than those ensured with the original series however if satellite sensors with higher temporal observation frequency are available i e j2 and j3 the use of original series even though limited in terms of observations appears to be the best option that said mm series ensure a higher spatial coverage of the river which could be significant when referring to long river stretch and single altimetry missions characterized by long inter track distances credit authorship contribution statement alessio domeneghetti conceptualization methodology software investigation writing original draft writing review editing giada molari methodology software investigation visualization writing review editing mohammad j tourian data curation writing original draft writing review editing angelica tarpanelli data curation writing original draft writing review editing sajedeh behnia data curation writing original draft writing review editing tommaso moramarco supervision writing original draft nico sneeuw supervision armando brath supervision declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgements the authors are particularly grateful to the interregional agency for the po river agenzia interregionale per il fiume po aipo italy and po river basin authority autorità di bacino del fiume po italy that allow the access to the high resolution dtm of river po in situ hydrological data are available through hydrological annual books and on line web service dext3r https simc arpae it dext3r the authors are grateful to the european space agency for providing the envisat data the satellite data of topex poseidon are provided by physical oceanographic distributed active archive centre podaac ftp podaacftp jpl nasa gov alldata thanks are also due to aviso http www aviso altimetry fr for providing saral altika data and jason 2 hydrology product and jason 3 data sentinel 3a and sentinel 3b series are extracted from the copernicus data repository https scihub copernicus eu 
