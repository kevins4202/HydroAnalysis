index,text
80,we propose a sequential algorithm to investigate the influence of surfactant injection on foam induced mobility reduction in two phase liquid gas flows in highly heterogeneous porous media a foam model in local equilibrium is adopted in this context assuming non newtonian foam behavior a fractional flow formulation based on global pressure that includes the surfactant in the liquid phase is adopted resulting in a system that couples elliptic and hyperbolic equations these equations are split into two sub systems that group equations of the same kind and are solved employing a sequential numerical algorithm that combines a locally conservative hybrid finite element method to approximate the hydrodynamics of the system with a central upwind finite volume method for the transport equations the resulting spatial discretized system is approximated in time by applying a multi step implicit finite difference method the hydrodynamics and hyperbolic problems are solved using a staggered algorithm in different time scales through comparison with experimental data and classical numerical methods we validated the proposed methodology and demonstrated its ability to produce stable approximations with reduced numerical dissipation and computational cost then we apply the sequential algorithm to compare the co injection of the water gas surfactant with the surfactant alternating gas sag technique in two dimensional flows in highly heterogeneous media the numerical results suggest a better sweep efficiency using the sag injection technique when compared with the co injection approach for the equivalent amount of injected surfactant keywords sag surfactant foam hybrid mixed methods finite volume methods heterogeneous porous media data availability no data was used for the research described in the article 1 introduction enhanced oil recovery eor techniques designed to improve oil production are characterized by the injection of materials not usually present in the reservoir lake 1989 eor methods can be especially useful when gas is injected into the reservoir as the gas sweep efficiency can be limited by the gravity override phenomenon and by viscous fingering worsening in highly heterogeneous porous media since gas channeling phenomena occur through the higher permeable paths kloet et al 2009 hematpur et al 2018 shojaei et al 2019 de paula et al 2020 the improved gas mobility control provided by foam displacement results in significant reduction in viscous fingering and gravity override stone 1982 blaker et al 1999 shan and rossen 2004 rossen and shen 2007 kloet et al 2009 hematpur et al 2018 shojaei et al 2018 de paula et al 2020 the technique consists of injecting surfactant in an aqueous solution to reduce the surface tension or interfacial tension inducing foam formation in the gas phase and consequently a reduction in gas mobility kovscek and radke 1994 this approach is also used in environmental remediation problems aimed at decontamination and blocking of pollutants in groundwater and aquifers hirasaki et al 1997b a portois et al 2018 as well as applications in soil remediation wang and mulligan 2004 and agriculture industry related to the use of foam as a carrier for liquid fertilizers shojaei et al 2022 in addition the reduced mobility caused by the foam significantly improves the co 2 storage potential sæle et al 2022 the improvement in sweep efficiency can be affected by the surfactant injection technique adopted blaker et al 1999 shan and rossen 2004 kloet et al 2009 rossen and boeije 2013 several injection techniques have been studied such as the co injection of pre foamed gas or surfactant with gas and water at fixed foam quality i e the foamed gas fractional flow or the alternate injection of foam or surfactant with gas known as sag shan and rossen 2004 in sag foam is formed when the injected gas meets the previously injected surfactant solution slug and when the surfactant solution meets the previously injected gas slug rossen and boeije 2013 the sag process demonstrated efficiency in reducing gravity override shan and rossen 2004 and viscous fingering in heterogeneous media with different permeability layers kloet et al 2009 more realistic models of foamed gas mobility reduction are commonly based on modifying the apparent viscosity of the gas with foam behaving as a non newtonian fluid specifically foam behavior is usually reported as shear thinning hirasaki and lawson 1985 kovscek et al 1994 zitha and du 2010 kam 2008 ma et al 2015 i e the apparent viscosity decreases with increasing shear stress an expression to compute shear thinning effects was derived and validated experimentally by hirasaki and lawson 1985 which define the apparent viscosity of the gas as dependent on the gas velocity and foam texture population balance models were proposed by falls et al 1988 kovscek and radke 1994 zitha and du 2010 and kam 2008 among others to simulate foam creation destruction and transport through porous media ma et al 2015 hematpur et al 2018 in this approach foam texture is defined as a quantity that represents the number of bubbles or lamellae per unit of volume falls et al 1988 kovscek and radke 1994 gauglitz et al 2002 aiming at better representing foam behavior we focus on the more complex dynamics of bubble generation and coalescence approaches associated with the limiting capillary pressure introduced by kovscek et al 1995 the limiting capillary pressure is a critical value above which the foam becomes unstable and immediately coalesces khatib et al 1988 farajzadeh et al 2015 the surfactant stabilizes the gas liquid interface preventing newly formed bubbles immediate destruction aronson et al propose by aronson et al 1994 after experimenting with different surfactants a limiting capillary pressure depending on the surfactant concentration highly concentrated foaming solutions and robust surfactants lead to large limiting capillary pressure generating a greater mobility reduction of the gas phase kovscek et al 1995 aronson et al 1994 although foam creation and coalescence mechanisms represent more realistic foam flow physics and play an important role in these models kovscek et al 1995 1997 kam 2008 ma et al 2015 the time scale of these mechanisms is significantly shorter than the time scale of foam propagation ma et al 2018 therefore it is possible to simplify the population balance equation assuming a local equilibrium state where foam creation and coalescence rates are equal reducing the computational cost and complexity of solving the problem chen et al 2010 ding and guerillot 2020 in this context the mathematical model adopted in this work consists of coupling darcy s law with the mass conservation equation for the fluid phases combined with the transport of surfactant as a component in the aqueous solution the foam texture is a dependent function the foam model adopted is based on kovscek et al 1995 and chen et al 2010 that proposes the gas mobility reduction through a non newtonian model combining the foam texture in local equilibrium with the effects of the surfactant concentration through the limiting capillary pressure furthermore following the physical concept that relates the limiting capillary pressure with the foam texture we propose modifying the original model allowing simulations in porous media that are initially not saturated with surfactant numerical simulations of the influence of foam and surfactant concentration on two phase liquid gas flow in highly heterogeneous porous media are still scarce in the literature the simulation of these scenarios allows for analyzing certain physical behaviors that greatly interest in exploring reservoirs aquifers and groundwater remediation in particular we investigate the effects of surfactant on different foam qualities the influence of surfactant water gas co injection and sag injection on sweep efficiency and the effects of co injection and alternate surfactant injection on production rate in heterogeneous porous media the numerical approach for solving this mathematical model that emerges from the two phase flow in porous media including foam and surfactant effects should be capable of handling several complexities due to discontinuity non linearity stiffness natural instabilities among others daripa and dutta 2017 the numerical methods should also preserve important properties such as local conservation of mass shock capture non oscillatory solutions accurate approximations and reduced numerical diffusion effects usually this model is solved by applying explicit in time finite difference schemes and employed for the validation of one dimensional mathematical models using experimental data obtained in cores composed of homogeneous porous material rossen and van duijn 2004 zitha et al 2006 kam 2008 afsharpoor et al 2010 however even in these simpler cases these finite difference approaches can fail to represent the effects of surfactant and foam as presented by rossen 2013 therefore it is crucial that the numerical methodology to be used is carefully planned an effective numerical scheme to solve this problem and to address its inherent complexities is based on rewriting the problem in terms of global pressure as presented by chavent and jaffré 1986 chen and ewing 1997 and daripa and dutta 2017 in this approach one has two distinct weakly coupled problems a hydrodynamic problem and a transport problem the next step is to decouple the system of partial differential equations pde into two subsystems of equations each one of a different nature thus each subsystem can be solved by specific numerical methods according to the mathematical properties of each problem and the balance between precision and computational cost required in the solution of each subsystem the hydrodynamics governed by the darcy system can be approximated by a hybrid mixed finite element formulation which allows for the use of locally conservative approaches that naturally treat heterogeneous porous media and complex domains this approach requires the fulfillment of the compatibility condition between spaces and the imposition of the continuity of the normal velocity component across interelement edges the hybrid mixed formulation proposed by raviart and thomas 1977 and arnold and brezzi 1985 in addition to fulfilling the requirements of space compatibility and continuity also reduces the computational cost due to the possibility of employing the static condensation technique through the use of lagrange multipliers defined on the edges of the interelements which leads to a positive definite system guyan 1965 arnold and brezzi 1985 de paula et al 2020 on the other hand the central finite volume methods kurganov and tadmor 2000 kurganov et al 2001 can be employed to approximate the water saturation and surfactant concentration equations the high order non oscillatory and central upwind finite volume method proposed by kurganov noelle and petrova knp by kurganov et al 2001 is an extension of the method developed by kurganov and tadmor kt kurganov and tadmor 2000 that generalizes the numerical flux approximating the flux inflow and outflow at the faces of elements in a mesh using more precise information about the local propagation velocities the knp scheme has an upwind nature since it respects wave propagation directions by measuring the one sided local velocities furthermore the knp scheme allows for using small steps in time without requiring an excessive refinement of the spatial mesh since the numerical diffusion does not depend on the time step based on these numerical approaches we propose a novel combination of numerical methods that results in an implicit stable accurate and conservative sequential algorithm to simulate the gas liquid flow in a heterogeneous porous medium including foam and surfactant effects hydrodynamics is solved by a locally conservative hybrid mixed finite element method to approximate the velocity and pressure fields the knp scheme is applied to the hyperbolic equations to find approximations for the water and gas saturations and surfactant concentration the foam texture is obtained by solving an algebraic problem derived from the population balance equation in a local equilibrium state and used to calculate the non newtonian apparent viscosity of the gas finally after discretization in space the resulting system is integrated in time using an implicit multi step bdf backward differentiation formula adaptive scheme order and time step are used to guarantee convergence of approximated solution in each time step hindmarsh et al 2005 furthermore the hydrodynamics and transport problems are solved using a staggered algorithm in different time scales where first the hydrodynamics is solved and the velocity field is used to find the fluid saturations and surfactant concentration simultaneously it is important to emphasize that the proposed sequential algorithm employs well known numerical approaches for the darcy and transport problems separately however this work s numerical contribution lies in combining these numerical methodologies with a sequential resolution strategy that proved to be less computationally expensive using an implicit temporal discretization with adaptive time steps and adaptive order bdf schemes the proposed sequential algorithm is validated by reproducing one dimensional results of laboratory experiments reported by chen et al 2010 and ding and guerillot 2020 and when compared with upwind and kt for the hyperbolic problem and explicit approach for the time discretization shows better stability accuracy reduction of numerical dissipation effects and lower computational cost in addition the proposed methodology is applied to simulate two dimensional cases in highly heterogeneous porous media comparing co injection with alternating surfactant injection in this comparison the numerical results show a better sweep efficiency when using sag injection in agreement with field applications developed by the fawag project and described by blaker et al 1999 furthermore the numerical results indicate an inverse correlation between the foam quality and the sweep efficiency and the point above which it is no longer advantageous to increase the concentration of injected surfactant as there is no significant improvement in production these numerical results can guide the best way to handle the injection in order to obtain better sweep efficiency in real applications the remainder of the paper is organized as follows section 2 presents the mathematical model for the foam flow in porous media in section 3 we present the numerical methodology proposed to solve the mathematical model based on a sequential algorithm that combines a hybrid mixed finite element method for the darcy system with a high order finite volume method to solve the transport equations validation of the sequential algorithm and simulations comparing the co injection with the sag in heterogeneous porous media are shown in section 4 sections 5 and 6 present discussions and conclusions 2 two phase flow model including foam and surfactant the mathematical model adopted in this work assumes a rigid fully saturated porous medium incompressible phases and negligible thermal gravitational and surfactant adsorption effects for simplicity densities of water and surfactant component are assumed equal we define the domain ω r d d 2 or 3 with lipschitz boundary γ ω and the time interval 0 t and introduce the system of equations that describes the immiscible two phase flow including surfactant transport kovscek and radke 1994 kovscek et al 1995 1994 chen et al 2010 ding and guerillot 2020 1 ϕ t s w c s u w c s 0 in ω 0 t 2 ϕ s β t u β 0 in ω 0 t 3 u β κ λ β p β in ω 0 t with proper initial and boundary conditions in this system 1 is the surfactant mass conservation in this paper we also refer to it as a transport equation of the surfactant species in the aqueous phase 2 is the water gas mass conservation in this paper we also refer to it as a phases transport equation 3 is two phase darcy equation the eqs 2 3 in this work are also referred to as the hydrodynamics problem in the system above the independent variables unknowns are the surfactant concentration in water c s phase saturation s β phase superficial velocity u β phase pressure p β with β g for the gas phase and β w for the aqueous phase we also define the constant porosity of the medium ϕ and κ κ x is the intrinsic isotropic scalar permeability in the position given by the vector x from the fractional flow theory buckley and leverett 1942 4 λ w k rw μ w λ g k rg μ g f and λ λ w λ g denote respectively the mobility of water gas and total mobility moreover μ w is the viscosity of water μ g f is the viscosity of gas in the presence of foam k rw and k rg are relative permeabilities of water and gas respectively defined by kovscek et al 1995 chen et al 2010 5 k rw k rw 0 s w s wc 1 s wc s gr n w and k rg k rg 0 x f 1 s w s gr 1 s wc s gr n g where we define the following constants s wc is the connate water saturation s gr is the residual gas saturation k rw 0 and k rg 0 are the endpoint relative permeabilities of water and gas respectively n w and n g are empirical model parameters the term x f is the total fraction of gas that is effectively flowing throughout the porous medium defined as x f 1 x t where x t is the fraction of trapped gas following chen et al 2010 x f is taken as a constant in this work the gas mobility reduction is proportional to the foam texture n f defined as the number of bubbles per unit volume here we use the normalized foam texture n d n f n max where n max refers to the constant maximum reference foam texture the non newtonian foam effects are included into system 1 3 through the definition of the effective gas viscosity hirasaki and lawson 1985 6 μ g f μ g α n max v g 1 3 n d where 7 v g u g ϕ s g x f is the gas interstitial velocity μ g is the gas viscosity in the absence of foam and α is an empirical constant based on kovscek and radke 1994 and kovscek et al 1994 a simplified foam model in local equilibrium relating the normalized foam texture n d with s w c s and the total velocity u was proposed by 12 8 n d ω k 1 v g 2 3 n max k 1 0 v w n d 1 0 where ω 3 as also proposed in chen et al 2010 and 9 k 1 n d k 1 0 1 n d ω with constant k 1 0 model s parameter kovscek et al 1994 and 10 v w u w ϕ s w is the water interstitial velocity neglecting that v g is dependent on n d as proposed by chen et al 2010 a cubic equation with a single real root is obtained thus given the liquid velocity gas velocity and capillary pressure it is possible to obtain n d analytically also 11 k 1 s w c s k 1 0 p c p c p c 2 with p c p c max tanh c s c s ref k 1 0 is a constant chen et al 2010 p c max is the maximum value for the limiting capillary pressure p c c s ref is a reference surfactant concentration for strong net foam generation and p c is the capillary pressure assumed to be a function of s w only and defined later in eq 41 12 p c p c s w p g p w eq 8 balances the rate of foam generation and foam destruction implicating the local equilibrium assumption in addition the term k 1 n d in eq 9 is related to the foam generation and the term k 1 s w c s in eq 11 is related to the foam destruction remark notice that the system 1 3 is strongly coupled as the term u β depends both on s w and c s through eqs 4 5 6 and 8 2 1 reformulating the model for the numerical implementation to allow for simulating scenarios where the capillary pressure in the pore p c is greater than the limiting capillary pressure p c in which case the bubbles become unstable and instantly coalesce khatib et al 1988 we propose the following adaptation of 8 13 n d ω k 1 v g 2 3 n max k 1 0 v w n d 1 0 p c p c n d 0 p c p c following chavent and jaffré 1986 and chen and ewing 1997 the global pressure when s w s is defined as 14 p p g 1 s gr s f w d p c d s w d s w with f w λ w λ λ w λ w λ g the total velocity is given by u u w u g with 15 u w f w u κ λ g f w p c and u g f g u κ λ g f w p c this alternative formulation is more suitable to be solved using advanced numerical methods being far less computationally expensive than the original two pressure approach chavent and jaffré 1986 chen and ewing 1997 chen et al 2006 daripa and dutta 2017 under the previous hypotheses 1 3 can be rewritten as follows find in ω 0 t the total fluid velocity u the global pressure p the water saturation s w the surfactant concentration c s and the foam texture n d satisfying 16 u κ λ p 17 u 0 18 ϕ s t i 1 d f i x i ℂ s 0 19 n d ζ 3 18 3 2 3 3 a ζ 3 p c p c 0 p c p c where d is the spatial dimension of the problem i denotes a spatial direction ζ 12 a 3 81 9 a k 1 v g 2 3 n max k 1 0 v w with n d being the single real root of 13 assuming ω 3 and 20 s s w s w c s f i f w u i c s f w u i ℂ κ λ g f w d p c d s w b b 1 0 c s 0 and boundary and initial conditions u n u on γ n 0 t 21 p p on γ d 0 t f g f g and c s c s on γ 0 t 22 κ λ g f w d p c d s w s w n 0 on γ 0 t 23 s x 0 s 0 in ω where the union of γ n and γ d constitute the boundary of the darcy problem γ γ n γ d and γ and γ the boundary of the transport problem γ γ γ in both cases there is no intersection of the boundaries γ n and γ d γ n γ d 0 and γ and γ γ γ 0 furthermore γ d defines the boundary region with dirichlet condition specified pressure p boundary condition γ n denotes the boundary region with neumann condition specified injection velocity u on the border γ denotes the boundary region with no diffusion i e there is no inflow or outflow due to capillary effect diffusion on the border and γ x γ n u n 0 is the inflow boundary for the transport equations where f g and c s are the boundary values for the foam quality and surfactant concentration injection respectively also n is the unit outer normal vector to γ and s 0 is the initial condition for the vector of variables s for simplicity we assume γ d 0 γ 0 and γ 0 3 numerical methodology the equations of the foam flow model exhibit different mathematical natures the transport system are formed of hyperbolic type equations and the hydrodynamics problem has elliptic nature in this context we adopt specific numerical methods for each mathematical nature therefore we follow the sequential algorithm proposed by de paula et al 2020 where the hydrodynamics eqs 16 17 are approximated using a naturally stable hybrid mixed finite element method introduced by raviart and thomas 1977 and the transport system 18 is solved using a conservative high order central upwind finite volume scheme with reduced numerical diffusion effects proposed by kurganov noelle and petrova knp by kurganov et al 2001 3 1 sequential algorithm we use a staggered algorithm to decouple the system of eqs 16 19 into two sub systems an hydrodynamics one with time step δ t u and a transport one with time step δ t s with δ t u δ t s because the time scale of the hydrodynamics is usually much slower than of the transport chen et al 2006 algorithm 1 describes the sequential method to solve each problem separately for the transport problem adaptive time steps δ t s are used as needed to bound the error in the approximations under a certain combination of relative and absolute tolerances considering a time instant n when the solution is known and the next instant in time n 1 when the solution is yet to be computed in each iteration approximations for velocity u n 1 and pressure p n 1 at t t n 1 are computed from system 16 17 as follows 24 u n 1 κ λ n p n 1 and u n 1 0 supplemented by the boundary conditions 21 then an iterative algorithm that repeats the computations in order to generate a sequence of solutions in time is used to find approximations for water saturation s w n 1 and surfactant concentration c s n 1 by solving the following system of pdes in ω t n t n 1 25 ϕ s n 1 t i 1 d x i f i n 1 ℂ n 1 s n 1 0 with boundary 22 and initial conditions 23 when n 0 the foam texture is obtained from 19 by solving n d n 1 n d s w n 1 c s n 1 u n 1 3 2 hybrid mixed finite element method for hydrodynamics assuming ω is a polygon we define a partition t h of ω composed of quadrilaterals and use k to denote an arbitrary element of the partition the set of edges e of k is denoted by k the set of edges e in t h is denoted by e h and e h denotes the set of all boundary edges i e those with all points in γ finally the set of interior edges is denoted by e h 0 e h e h the raviart thomas rt spaces raviart and thomas 1977 are constructed by mapping polynomials defined on the reference element k ˆ 1 1 2 to each element k of the mesh t h we denote by f k k ˆ k the invertible bilinear map of the two domains in r 2 a scalar valued function φ ˆ on k ˆ transforms to a function φ p k 0 φ ˆ on k by the composition 26 φ x p k 0 φ ˆ x φ ˆ x ˆ where x f k x ˆ a vector valued function φ ˆ on k ˆ transforms to a function φ p k 1 φ ˆ on k via the piola transform boffi et al 2013 27 φ x p k 1 φ ˆ x 1 j k x ˆ d f k x ˆ φ ˆ x ˆ where d f k x ˆ is the jacobian matrix of the mapping f k and j k x ˆ is its determinant the discontinuous rt space of order of polynomial interpolation k 28 u h k v h l 2 ω 2 v h k p k 1 q k 1 k k ˆ q k k 1 k ˆ k t h 29 p h k q h l 2 ω q h k p k 0 q k k k ˆ k t h where q i j denotes the set of polynomial functions of degree up to i in x and up to j in y and l 2 is the space of square integrable functions we also define the following sets of functions on the mesh skeleton 30 m h k q ˆ h l 2 e h q ˆ h e p k e e e h 0 q ˆ h e p e e h γ d 31 m h k q ˆ h l 2 e h q ˆ h e p k e e e h 0 q ˆ h e 0 e e h γ d where p k e denotes the set of polynomial functions of degree up to k on e in the simulations we adopt the standard lowest order index rt space k 0 a low computational cost choice compared to k 0 that is extensively employed in fluid mechanics computations boffi et al 2013 from these definitions we can introduce the hybrid mixed method for the darcy problem 24 as follows arnold and brezzi 1985 given s w n and c s n find the pair u h p h u h k p h k and the lagrange multiplier p ˆ h m h k such that for all v h q h q ˆ h u h k p h k m h k 32 k t h k a u h v h d x k p h v h d x k p ˆ h v h n k d s k q h u h d x 0 33 k t h k q ˆ h u h n k d s γ n q ˆ h u d s where a a s w n c s n κ λ s w n c s n 1 p ˆ h denotes the lagrange multiplier associated with the pressure trace on the edges and eq 33 naturally imposes the continuity condition on the edges of k and the neumann boundary condition on γ n the hybrid formulation 32 33 is solved employing the static condensation technique guyan 1965 de paula et al 2020 that consists in eliminate all degrees of freedom corresponding to the variables u h and p h leading to a global system with the degrees of freedom associated with the multipliers p ˆ h only also unlike the conforming mixed finite element methods the global system of equations is positive definite allowing for simpler and more robust solvers de paula et al 2020 arnold and brezzi 1985 the global system resolution provides the solution of the lagrange multipliers p ˆ h on the edges of the elements which are used as boundary conditions to retrieve the primitive variables u h and p h in each element of the mesh thus the degrees of freedom associated with velocity and pressure can be computed in local independent problems for more details see arnold and brezzi 1985 and boffi et al 2013 3 3 central upwind scheme for the transport problems the finite volume method proposed by kurganov et al 2001 here called knp is employed to approximate the water saturation and surfactant concentration eqs 25 the upwind nature of knp is because it respects the directions of wave propagation by measuring the one sided local speeds given by 34 a l 1 2 i max min max min λ s l 1 2 i max min λ s l 1 2 i max min 0 on direction i and a cell of index l where l 1 2 is the right resp top face and j 1 2 is the left resp bottom face of a cell s l 1 2 i is the local reconstruction of s at the left resp bottom side of a face and s l 1 2 i is the local reconstruction of s at the right resp top side of a face λ x max and λ x min are the maximum and minimum eigenvalues respectively of the jacobian f i s at s x the terms of the jacobian matrix are discretized using forward finite difference and then evaluated in the required points for each i direction the result of spatial discretization using knp is the system of odes in conservative form kurganov et al 2001 35 ϕ d s l d t i 1 d h l 1 2 i h l 1 2 i h i p l i where h i is the cell size in the i th direction with the central upwind scheme for the convective numerical fluxes given by 36 h l 1 2 i a l 1 2 i max f i s l 1 2 i a l 1 2 i min f i s l 1 2 i a l 1 2 i max a l 1 2 i min a l 1 2 i max a l 1 2 i min a l 1 2 i max a l 1 2 i min s l 1 2 i s l 1 2 i where by choosing a l 1 2 i max a l 1 2 i min a l 1 2 i max λ s l 1 2 i max min λ s l 1 2 i max min we eliminate the upwind nature of convective numerical fluxes 36 and recover the kt method proposed by kurganov and tadmor 2000 in addition the diffusive numerical fluxes are given by 37 p l i ℂ l 1 2 i s l 1 i ℂ l 1 2 i ℂ l 1 2 i s l ℂ l 1 2 i s l 1 i h i 2 where ℂ l 1 2 i is defined as the harmonic mean of ℂ l and ℂ l 1 i the scheme 35 37 combined with minmod reconstruction of the type 38 s l x s l n i 1 d d l i n x i x l i 39 d l i n minmod θ s l i n s l 1 i n h i s l 1 i n s l 1 i n 2 h i θ s l 1 i n s l i n h i is a tvd scheme if 1 θ 2 kurganov et al 2001 where s l is a piecewise linear approximation to the solution at time t n i e s l x s l n x then we can use the fact that x l 1 2 i x l i h i 2 to find s l 1 2 i the minmod operator is a flux limiter used to avoid spurious oscillations in high resolution schemes kurganov and tadmor 2000 kurganov et al 2001 defined as follows 40 minmod q 1 q 2 q n min q j if q j 0 j max q j if q j 0 j 0 otherwise to solve the system of odes 35 a variable order adaptive step backward differentiation formula bdf was adopted this stable implicit scheme allows for taking larger time steps than an explicit method would require which reduces the computational cost 3 4 foam displacement simulator fossil the numerical methodology was implemented in an in house simulator denominated fossil the numerical code for the hybrid finite element method to solve the hydrodynamics problem was developed using the deal ii library arndt et al 2020 the global linear system was solved using the umfpack davis 2004 a set of routines using multifrontal lu factorization for time integration in the transport equations it was adopted the implementation of the bdf scheme from the cvode package available in the sundials library hindmarsh et al 2005 the methods used in cvode are variable order and variable step multistep methods hence δ t s varies in the integration process bounded to relative and absolute tolerances the non linear problem resulted from 25 after space discretization was solved using a quasi newton method along with the scaled preconditioned generalized minimum residual spgmr linear solver brown and hindmarsh 1989 the evaluations of the right hand side of the ordinary differential eqs 35 were implemented in parallel using openmp api the simulations were performed in a computer equipped with an intel xeon w 2133 3 6 ghz of 6 cores and 64 gb of ram using ubuntu 20 04 as the operating system 4 numerical simulations in this section we present numerical results that aim to study the influence of foam and surfactant concentration on two phase liquid gas flow in heterogeneous porous media applying the numerical methodology described in section 3 from numerical and experimental results presented by chen et al 2010 and ding and guerillot 2020 we validate and investigate the stability numerical dissipation and computational cost of the proposed sequential algorithm when compared to classical numerical approaches in the literature next we study the influence of surfactant injection on the foam induced mobility reduction in a two dimensional heterogeneous porous medium in the horizontal plane the boundary conditions adopted in these studies prescribe for the darcy system the right boundary as a dirichlet type γ d with p 0 while left top and bottom boundaries are set to a neumann condition γ n with u 0 for the left boundary and u 0 for the top and bottom boundaries for the transport equations on the left boundary it is imposed f g 1 f w for the aqueous phase and c s 1 f g for the surfactant transport equation whereas right top and bottom boundaries are defined with a homogeneous neumann condition in the fig 1 is shown a graphical representation of the boundary regions the capillary pressure function can depend on several flow experiment characteristics such as rock type and fluids we adopt the following relation provided by kovscek et al 1995 41 p c σ ϕ κ x 0 022 s w 0 15 0 2 with σ denoting the gas liquid interface tension that is assumed to be constant coefficients and numerical parameters used in the simulations are shown in tables 1 and 2 as stated previously δ t s varies in the integration process bounded to relative and absolute tolerances the values for δ t s can be influenced by several factors the mathematical model used the numerical method adopted grid refinement permeability field and many others in the following simulation cases the time steps δ t s can range from 0 045 to 16 6 leading from 1 up to 222 time steps for the transport equation per δ t u step remark notice that in eq 41 capillary suction pressure only diverges at s w 0 15 but water residual saturation in table 1 is higher s wc 0 38 this behavior alone can lead to flow by capillary suction however in the adopted model the diffusive term multiplies the capillary pressure gradient by f w term ℂ in eq 20 which is canceled out when s w s wc preventing water flow by capillary suction 4 1 validation following the numerical experiments of chen et al 2010 and ding and guerillot 2020 we validate the proposed numerical methodology applied to solve the two phase flow model including foam and surfactant injection the simulations are ran for a one dimensional domain for pore volume for a initial surfactant concentration of the remaining parameters can be found in tables 1 and 2 fig 2 presents a comparison between numerical results and experimental data taken from chen et al 2010 for water saturation profiles at different injected pore volume pv the simulation was carried out with 200 cells and the entry boundary condition for water saturation was prescribed as s w 0 55 the injected pv is computed as the product between elapsed time and injection velocity divided by the product between core length and porosity the experimental data are marked as filled circles and connected by lines to facilitate the reading and the non marked lines represent the numerical solutions in the horizontal axis the results are plotted using the dimensionless distance the distance position divided by the domain length the validation results are consistent with the literature chen et al 2010 ding and guerillot 2020 and show a good match between experimental data and numerical solution as the simulation results could predict the wavefronts positions in addition the foam propagation in porous media behaves in a front like manner leading to a very efficient displacement of the aqueous phase results for foam texture when the simulation s grid size is varied are presented in fig 3 it is interesting to notice that the foam texture solutions present a peak reaching n d 1 and hence n f reaching n max right behind the shock wave it is also evident in fig 3 the difference in the solutions for each grid size showing the dependence of the foam texture resolution with the grid size as the peak region of the foam texture becomes more slender the previous grid size dependence behavior can be credited to the intermediary values of s w between the injection state j and the initial state i see fig 4 the numerical diffusion and the diffusion from the capillary pressure term yield intermediate water saturation values between states i and j that correspond to high n d values see fig 4 resulting in the foam texture peaks observed in fig 3 notice that the presence of the peaks in the foam texture is not entirely a numerical artifact rossen 2013 for similar models it was proven to be part of mathematical solutions lozano et al 2022 fig 4 shows the foam texture n d as a function of the water saturation s w for fixed values of surfactant concentration c s to simulate the curves in fig 4 we use eq 19 with parameters values from table 1 fixing a total injection velocity m s 1 we find the phase velocities v g and v w which are inter dependent with μ g f using a technique similar to one proposed by kam 2008 this process initially assumes an approximation for v g and v w with u w u and u g 0 since the medium is initially saturated with water from these approximations the function f w is computed using eq 14 new values for f g f g 1 f w and v w are computed from the last evaluated f w and eqs 10 and 14 these steps are iterated until convergence elevated gradient see fig 4 causes a small variation in the injection water saturation point j leads to a relatively high variation in the injection foam texture notice that the injection state of the previously presented solutions point j falls in that steep region of fig 4 for 0 5 s w 0 6 4 2 stability numerical dissipation and computational cost results comparing the proposed methodology with other numerical approaches to approximate convective fluxes are shown in fig 5 figs 5 a and 5 b present an approximation for the water saturation and foam texture at 0 3 pv comparing the knp method with the kt a central scheme presented by 35 and the classical upwind methods using 100 cells in order to use the kt and upwind method in the simulations the convective fluxes 36 are adapted to these methodologies the results for the foam texture fig 5 b show a lower accuracy and greater numerical dissipation of the upwind method compared to the knp method since the more accurate the solution the thinner the peak region see fig 3 moreover the kt method presents spurious oscillations and fails to approach this model with this mesh refinement as can be seen in figs 5 a and 5 b in the simulated case where the p c does not exceed p c and the foam texture tends to zero due to the excessive lower value that s w reaches in the spurious oscillations according to fig 4 the spurious oscillations in the kt method due to the scheme instability appears specifically in the region for s w 0 45 see fig 5 a and where foam texture approaches zero n d 0 the foam generation model is a power law expression proportional to the magnitude of the phase velocities more details in kovscek and radke 1994 kovscek et al 1995 therefore as water saturation reduces its value the water velocity v w tends to zero yielding low foam generation in this case to obtain a stable solution using the kt method as shown in figs 5 c and 5 d excessive mesh refinement is required which highlights the stability of upwind approaches especially the knp method for this type of problem in addition a computational cost study comparing the implicit time integration strategy adopted with the explicit approach commonly applied to these central finite volume methods kurganov and tadmor 2000 kurganov et al 2001 is presented in fig 6 the physical and numerical data used in these simulations are provided in tables 1 and 2 varying only the number of processor cores used in the computation the stability of the adaptive process of approximation in time is guaranteed by the sundials library hindmarsh et al 2005 which meets the solution convergence criteria at each time step thus both the solutions using the implicit and the explicit scheme converge to a unique solution since the solutions are obtained using the same convergence criterion the figure relates the resolution time in seconds to the grid size and is presented on the log scale the results show a lower computational cost of the implicit strategy bdf adopted compared to the runge kutta rk method this cost can be reduced by increasing the number of processing cores this is because the sundials library algorithm requires smaller time steps for the explicit method demonstrating a greater cfl condition restriction 4 3 comparison between co injection and sag in this section we investigate the surfactant s ability to generate and stabilize foam through two injection techniques in order to reduce the viscous fingering phenomena and the high permeability channeling in order to achieve these goals we use the heterogeneous isotropic permeability field of layer 36 of the 10th spe project anon 2000 this layer clearly presents a high permeability channel as shown in fig 7 in this context we compared the water surfactant gas co injection technique with the injection of the water surfactant solution alternating with gas co injection is a characteristic approach of laboratory experiments and sag is associated with remediation and eor strategies in field applications the simulations were carried out for seconds in a two dimensional domain of m with a mesh of 220 60 cells this porous medium is pre saturated with pure water and the effects of the trapped gas fraction are neglected x t 0 and the remaining parameters can be found in tables 1 and 2 for the co injection we conducted four experiments by simulating the injection of an aqueous solution with surfactant using different foam qualities shown in table 3 on the other hand for the surfactant alternating gas technique setting f w 1 0 we inject t c s 0 0438 pv t c s 0 0875 pv t c s 0 1313 pv t c s 0 1751 pv of water with surfactant which introduces the same amount of surfactant into the porous medium as in the co injection cases studied see fig 8 b then a gas slug was injected f g 1 0 until the end of the simulation the surfactant pore volume e g fig 8 is computed by multiplying the surfactant concentration by the water pore volume since the densities of surfactant and water components are considered equal as assumed in section 2 fig 9 shows the results for surfactant concentration comparing the water gas co injection with of surfactant concentration for different foam qualities f g 60 70 80 90 with sag injection for different slug sizes of surfactant solution t c s 0 1751 0 1313 0 0875 0 0438 pv although there is the same amount of surfactant in both injection strategies for each case studied the sag technique presents a better propagation of the surfactant in the porous medium mainly percolating through the preferential channel this behavior of the sag injection induces a greater foam formation in the preferential channels unlike the co injection that maintains the maximum value of the foam texture in the domain s entrance region as seen in fig 10 notice that the foam collapses upstream reflecting in the lower foam texture near the entrance region mainly due to the reduction of the water saturation during the gas injection in sag due to the dependence of the apparent viscosity on the foam texture and gas velocity 6 it is possible to notice in fig 11 that the behavior of the apparent viscosity for the co injection is similar to the foam texture with higher values at the entrance of the domain however the sag strategy presents higher values in the region of the preferential channel especially when there is a greater amount of surfactant injected the apparent viscosity in the rest of the domain is lower than in the co injection case because gas velocity is higher in sag during gas injection than in co injection due to the imposition of f g 1 0 despite this apparent viscosity s effects on the sag s gas mobility reduction present better sweeping efficiency than co injection reducing water saturation both at the entrance to the domain and in the preferential channel as shown in fig 12 a better comparison of the sweep efficiency between sag and co injection is shown in fig 13 where the cumulative water production to each foam quality and surfactant slug size simulated is presented in addition to the case without surfactant no foam in the co injection results it is possible to observe that as f g decreases there is an increase in cumulative water production especially when there is a surfactant in the medium to induce foam generation fig 13 a the greater amount of surfactant injected due to the reduction of f g fig 8 a increases the cumulative water production difference in relation to the case without surfactant in addition the reduction of f g decreases the gas injection velocity therefore the aqueous phase containing the surfactant species presents a greater propagation consequently more foam is generated which leads to greater sweep efficiency on the other hand fig 13 b presents the sag results for different surfactant slug sizes adopting the same surfactant amounts as in the co injection cases it is also presented the wag water alternating gas injection strategy for different water slug sizes t s w 0 0438 0 0875 0 1313 0 1751 pv for the case when the foam is not present in the flow the results show that sag injection generates a higher water production than wag strategy zeng et al 2020 in comparison sag can also achieve better production when compared to the co injection strategy in addition it is evident in fig 13 b that the more surfactant injected the more delayed the gas phase breakthrough we proceed with the same scenario as the previous simulation with different percentages of surfactant in the injected aqueous solution in fig 14 we present a comparison relating the total cumulative water production defined as cumulative production at the simulation time 20 000 s with the amount of surfactant injected into the medium including the case with no foam applying the co injection method it is possible to observe the surfactant injection over does not significantly alter the cumulative water production see fig 14 a on the other hand in fig 14 b the sag injection achieved higher water production than the co injection for all surfactant concentrations this production increment is due to a greater amount of injected surfactant generating a greater concentration in the preferential channels reducing foam destruction and increasing gas mobility reduction notice that the maximum value for sag cumulative production does not present an expressive elevation when this behavior indicates that the surfactant concentration reaching the limit point corresponds to the maximum p c defined in 11 and adding more surfactant will not improve foam mobility reduction this behavior agrees with the literature describing when the surfactant concentration exceeds the critical micelle concentration cmc liu et al 2005 lee and heller 1990 wang et al 2019 li et al 2019 based on the results presented in fig 14 the cumulative water production at as a function of the amount of injected surfactant for the co injection and sag techniques is presented in fig 15 the curves in fig 15 were obtained using the least square method with the logarithmic function 42 y a b ln x where y represents the total cumulative production x is the total surfactant injection and a and b are the fitting parameters the data used in the fit process is all points of the surfactant concentration curve green line in figs 14 a and 14 b and the highest cumulative production values for each remaining surfactant concentration curves diamond markers in figs 14 a and 14 b the least square fit allows us to extrapolate the obtained simulation results for a higher amount of surfactant showing a threshold for the production improvement by the surfactant concentration although in both cases a plateau of maximum production was formed after a certain cumulative surfactant injection the sag injection resulted in a higher production when compared with the co injection technique furthermore regardless of the amount of surfactant injected the total cumulative water production by co injection is limited to around 0 32 pv while sag reaches approximately 0 40 pv 5 discussions for the sag simulations in heterogeneous porous media the surfactant concentration value where the mobility reduction reaches its maximum is around as can be seen in fig 14 b for the co injection case the limiting surfactant concentration is see fig 14 a in that way it is possible to optimize the amount of surfactant injected so the maximum production is reached with the lowest surfactant quantity possible and the operation costs can be minimized and the profits maximized it is interesting to mention that the heterogeneous porous media with a high permeability channel is mainly responsible for the differences in production curves in fig 14 if the porous media is chosen to have a homogeneous permeability distribution it turns out that the production curves for different surfactant concentration injections are virtually the same that happens because there are no preferential paths or high permeability regions and the surfactant is evenly distributed throughout the flow wavefront hence the different surfactant concentration injection behavior tends to be very close to each other both in the co injection and sag strategies although sag still presents better results the usage of the mathematical foam flow model presented in section 2 increases the computational cost when compared with the no foam flow model due to mainly two reasons i the inclusion of an additional eq 1 describing surfactant transport that doubles the size of the algebraic system of equations that arises from the numerical discretizations ii the resulting matrices from the numerical methods become ill conditioned especially in the transport problem affecting the linear solver negatively that ill conditioning happens due to the relatively bigger difference between the water and gas mobility since gas mobility can be greatly reduced 6 conclusions the foam model proposed by kovscek kovscek and radke 1994 was modified to reflect the behavior that foam completely collapses when surfactant concentration is zero or close to zero enabling simulations where the porous medium is initially not saturated with surfactant the sequential algorithm proposed to solve two phase flows including the surfactant effects that induce foam generation producing a greatly reduced mobility and also a non newtonian behavior of the gas phase proved to be robust stable accurate and with reduced numerical dissipation and computational cost the numerical results showed that the kt method fails to simulate this type of problem while the knp method due to its upwind nature proved to be stable with less numerical dissipation and more accurate than the classical upwind due to the stability properties of the implicit time integration methods the bdf method showed a significant reduction in computational cost compared to the runge kutta method usually adopted in this type of approach the co injection results indicated that the lower the foam quality the higher the sweep efficiency since the reduction of f g in the injection favors the inflow and propagation of more surfactant in the porous medium that leads to higher foam generation and lower gas mobility by fixing the amount of surfactant injected the numerical results show that sag injection has a better sweep efficiency compared to co injection due to greater surfactant percolation in preferential channels that lead to greater foam formation and consequently a reduction in gas mobility in the preferential paths the results show that at a certain point it is not advantageous to increase the surfactant concentration for co injection nor sag strategies as there is no significant productivity improvement that happens because surfactant achieves a critical concentration and the limiting capillary pressure 11 reaches its maximum therefore the excess surfactant does not improve mobility reduction there is an optimal surfactant concentration value to obtain the total water production possible using a relatively lower amount of surfactant possible for the simulations carried out in this work this optimal concentration is around for the sag and for the co injection credit authorship contribution statement filipe f de paula software formal analysis investigation writing original draft writing review editing iury igreja methodology software formal analysis investigation writing original draft writing review editing supervision thiago quinelato software methodology formal analysis investigation writing original draft writing review editing supervision grigori chapiro conceptualization methodology formal analysis investigation writing review editing supervision project administration funding acquisition declaration of competing interest grigori chapiro reports financial support was provided by shell brazil iury igreja reports financial support was provided by shell brazil thiago quinelato reports financial support was provided by shell brazil filipe f de paula reports financial support was provided by shell brazil grigori chapiro reports financial support was provided by minas gerais state foundation of support to the research grigori chapiro reports financial support was provided by national council for scientific and technological development iury igreja reports financial support was provided by minas gerais state foundation of support to the research acknowledgments the current work was conducted in association with the r d project anp n 20715 9 modelagem matemática e computacional de injeção de espuma usada em recuperação avançada de petróleo ufjf shell brazil anp shell brazil funds it in accordance with anp s r d regulations under the research development and innovation investment commitment this project is carried out in partnership with petrobras g chapiro was supported in part by cnpq brazil grants 303245 2019 0 and 405366 2021 3 and fapemig brazil grant apq 00405 21 i igreja was supported in part by fapemig brazil grant apq 00517 21 
80,we propose a sequential algorithm to investigate the influence of surfactant injection on foam induced mobility reduction in two phase liquid gas flows in highly heterogeneous porous media a foam model in local equilibrium is adopted in this context assuming non newtonian foam behavior a fractional flow formulation based on global pressure that includes the surfactant in the liquid phase is adopted resulting in a system that couples elliptic and hyperbolic equations these equations are split into two sub systems that group equations of the same kind and are solved employing a sequential numerical algorithm that combines a locally conservative hybrid finite element method to approximate the hydrodynamics of the system with a central upwind finite volume method for the transport equations the resulting spatial discretized system is approximated in time by applying a multi step implicit finite difference method the hydrodynamics and hyperbolic problems are solved using a staggered algorithm in different time scales through comparison with experimental data and classical numerical methods we validated the proposed methodology and demonstrated its ability to produce stable approximations with reduced numerical dissipation and computational cost then we apply the sequential algorithm to compare the co injection of the water gas surfactant with the surfactant alternating gas sag technique in two dimensional flows in highly heterogeneous media the numerical results suggest a better sweep efficiency using the sag injection technique when compared with the co injection approach for the equivalent amount of injected surfactant keywords sag surfactant foam hybrid mixed methods finite volume methods heterogeneous porous media data availability no data was used for the research described in the article 1 introduction enhanced oil recovery eor techniques designed to improve oil production are characterized by the injection of materials not usually present in the reservoir lake 1989 eor methods can be especially useful when gas is injected into the reservoir as the gas sweep efficiency can be limited by the gravity override phenomenon and by viscous fingering worsening in highly heterogeneous porous media since gas channeling phenomena occur through the higher permeable paths kloet et al 2009 hematpur et al 2018 shojaei et al 2019 de paula et al 2020 the improved gas mobility control provided by foam displacement results in significant reduction in viscous fingering and gravity override stone 1982 blaker et al 1999 shan and rossen 2004 rossen and shen 2007 kloet et al 2009 hematpur et al 2018 shojaei et al 2018 de paula et al 2020 the technique consists of injecting surfactant in an aqueous solution to reduce the surface tension or interfacial tension inducing foam formation in the gas phase and consequently a reduction in gas mobility kovscek and radke 1994 this approach is also used in environmental remediation problems aimed at decontamination and blocking of pollutants in groundwater and aquifers hirasaki et al 1997b a portois et al 2018 as well as applications in soil remediation wang and mulligan 2004 and agriculture industry related to the use of foam as a carrier for liquid fertilizers shojaei et al 2022 in addition the reduced mobility caused by the foam significantly improves the co 2 storage potential sæle et al 2022 the improvement in sweep efficiency can be affected by the surfactant injection technique adopted blaker et al 1999 shan and rossen 2004 kloet et al 2009 rossen and boeije 2013 several injection techniques have been studied such as the co injection of pre foamed gas or surfactant with gas and water at fixed foam quality i e the foamed gas fractional flow or the alternate injection of foam or surfactant with gas known as sag shan and rossen 2004 in sag foam is formed when the injected gas meets the previously injected surfactant solution slug and when the surfactant solution meets the previously injected gas slug rossen and boeije 2013 the sag process demonstrated efficiency in reducing gravity override shan and rossen 2004 and viscous fingering in heterogeneous media with different permeability layers kloet et al 2009 more realistic models of foamed gas mobility reduction are commonly based on modifying the apparent viscosity of the gas with foam behaving as a non newtonian fluid specifically foam behavior is usually reported as shear thinning hirasaki and lawson 1985 kovscek et al 1994 zitha and du 2010 kam 2008 ma et al 2015 i e the apparent viscosity decreases with increasing shear stress an expression to compute shear thinning effects was derived and validated experimentally by hirasaki and lawson 1985 which define the apparent viscosity of the gas as dependent on the gas velocity and foam texture population balance models were proposed by falls et al 1988 kovscek and radke 1994 zitha and du 2010 and kam 2008 among others to simulate foam creation destruction and transport through porous media ma et al 2015 hematpur et al 2018 in this approach foam texture is defined as a quantity that represents the number of bubbles or lamellae per unit of volume falls et al 1988 kovscek and radke 1994 gauglitz et al 2002 aiming at better representing foam behavior we focus on the more complex dynamics of bubble generation and coalescence approaches associated with the limiting capillary pressure introduced by kovscek et al 1995 the limiting capillary pressure is a critical value above which the foam becomes unstable and immediately coalesces khatib et al 1988 farajzadeh et al 2015 the surfactant stabilizes the gas liquid interface preventing newly formed bubbles immediate destruction aronson et al propose by aronson et al 1994 after experimenting with different surfactants a limiting capillary pressure depending on the surfactant concentration highly concentrated foaming solutions and robust surfactants lead to large limiting capillary pressure generating a greater mobility reduction of the gas phase kovscek et al 1995 aronson et al 1994 although foam creation and coalescence mechanisms represent more realistic foam flow physics and play an important role in these models kovscek et al 1995 1997 kam 2008 ma et al 2015 the time scale of these mechanisms is significantly shorter than the time scale of foam propagation ma et al 2018 therefore it is possible to simplify the population balance equation assuming a local equilibrium state where foam creation and coalescence rates are equal reducing the computational cost and complexity of solving the problem chen et al 2010 ding and guerillot 2020 in this context the mathematical model adopted in this work consists of coupling darcy s law with the mass conservation equation for the fluid phases combined with the transport of surfactant as a component in the aqueous solution the foam texture is a dependent function the foam model adopted is based on kovscek et al 1995 and chen et al 2010 that proposes the gas mobility reduction through a non newtonian model combining the foam texture in local equilibrium with the effects of the surfactant concentration through the limiting capillary pressure furthermore following the physical concept that relates the limiting capillary pressure with the foam texture we propose modifying the original model allowing simulations in porous media that are initially not saturated with surfactant numerical simulations of the influence of foam and surfactant concentration on two phase liquid gas flow in highly heterogeneous porous media are still scarce in the literature the simulation of these scenarios allows for analyzing certain physical behaviors that greatly interest in exploring reservoirs aquifers and groundwater remediation in particular we investigate the effects of surfactant on different foam qualities the influence of surfactant water gas co injection and sag injection on sweep efficiency and the effects of co injection and alternate surfactant injection on production rate in heterogeneous porous media the numerical approach for solving this mathematical model that emerges from the two phase flow in porous media including foam and surfactant effects should be capable of handling several complexities due to discontinuity non linearity stiffness natural instabilities among others daripa and dutta 2017 the numerical methods should also preserve important properties such as local conservation of mass shock capture non oscillatory solutions accurate approximations and reduced numerical diffusion effects usually this model is solved by applying explicit in time finite difference schemes and employed for the validation of one dimensional mathematical models using experimental data obtained in cores composed of homogeneous porous material rossen and van duijn 2004 zitha et al 2006 kam 2008 afsharpoor et al 2010 however even in these simpler cases these finite difference approaches can fail to represent the effects of surfactant and foam as presented by rossen 2013 therefore it is crucial that the numerical methodology to be used is carefully planned an effective numerical scheme to solve this problem and to address its inherent complexities is based on rewriting the problem in terms of global pressure as presented by chavent and jaffré 1986 chen and ewing 1997 and daripa and dutta 2017 in this approach one has two distinct weakly coupled problems a hydrodynamic problem and a transport problem the next step is to decouple the system of partial differential equations pde into two subsystems of equations each one of a different nature thus each subsystem can be solved by specific numerical methods according to the mathematical properties of each problem and the balance between precision and computational cost required in the solution of each subsystem the hydrodynamics governed by the darcy system can be approximated by a hybrid mixed finite element formulation which allows for the use of locally conservative approaches that naturally treat heterogeneous porous media and complex domains this approach requires the fulfillment of the compatibility condition between spaces and the imposition of the continuity of the normal velocity component across interelement edges the hybrid mixed formulation proposed by raviart and thomas 1977 and arnold and brezzi 1985 in addition to fulfilling the requirements of space compatibility and continuity also reduces the computational cost due to the possibility of employing the static condensation technique through the use of lagrange multipliers defined on the edges of the interelements which leads to a positive definite system guyan 1965 arnold and brezzi 1985 de paula et al 2020 on the other hand the central finite volume methods kurganov and tadmor 2000 kurganov et al 2001 can be employed to approximate the water saturation and surfactant concentration equations the high order non oscillatory and central upwind finite volume method proposed by kurganov noelle and petrova knp by kurganov et al 2001 is an extension of the method developed by kurganov and tadmor kt kurganov and tadmor 2000 that generalizes the numerical flux approximating the flux inflow and outflow at the faces of elements in a mesh using more precise information about the local propagation velocities the knp scheme has an upwind nature since it respects wave propagation directions by measuring the one sided local velocities furthermore the knp scheme allows for using small steps in time without requiring an excessive refinement of the spatial mesh since the numerical diffusion does not depend on the time step based on these numerical approaches we propose a novel combination of numerical methods that results in an implicit stable accurate and conservative sequential algorithm to simulate the gas liquid flow in a heterogeneous porous medium including foam and surfactant effects hydrodynamics is solved by a locally conservative hybrid mixed finite element method to approximate the velocity and pressure fields the knp scheme is applied to the hyperbolic equations to find approximations for the water and gas saturations and surfactant concentration the foam texture is obtained by solving an algebraic problem derived from the population balance equation in a local equilibrium state and used to calculate the non newtonian apparent viscosity of the gas finally after discretization in space the resulting system is integrated in time using an implicit multi step bdf backward differentiation formula adaptive scheme order and time step are used to guarantee convergence of approximated solution in each time step hindmarsh et al 2005 furthermore the hydrodynamics and transport problems are solved using a staggered algorithm in different time scales where first the hydrodynamics is solved and the velocity field is used to find the fluid saturations and surfactant concentration simultaneously it is important to emphasize that the proposed sequential algorithm employs well known numerical approaches for the darcy and transport problems separately however this work s numerical contribution lies in combining these numerical methodologies with a sequential resolution strategy that proved to be less computationally expensive using an implicit temporal discretization with adaptive time steps and adaptive order bdf schemes the proposed sequential algorithm is validated by reproducing one dimensional results of laboratory experiments reported by chen et al 2010 and ding and guerillot 2020 and when compared with upwind and kt for the hyperbolic problem and explicit approach for the time discretization shows better stability accuracy reduction of numerical dissipation effects and lower computational cost in addition the proposed methodology is applied to simulate two dimensional cases in highly heterogeneous porous media comparing co injection with alternating surfactant injection in this comparison the numerical results show a better sweep efficiency when using sag injection in agreement with field applications developed by the fawag project and described by blaker et al 1999 furthermore the numerical results indicate an inverse correlation between the foam quality and the sweep efficiency and the point above which it is no longer advantageous to increase the concentration of injected surfactant as there is no significant improvement in production these numerical results can guide the best way to handle the injection in order to obtain better sweep efficiency in real applications the remainder of the paper is organized as follows section 2 presents the mathematical model for the foam flow in porous media in section 3 we present the numerical methodology proposed to solve the mathematical model based on a sequential algorithm that combines a hybrid mixed finite element method for the darcy system with a high order finite volume method to solve the transport equations validation of the sequential algorithm and simulations comparing the co injection with the sag in heterogeneous porous media are shown in section 4 sections 5 and 6 present discussions and conclusions 2 two phase flow model including foam and surfactant the mathematical model adopted in this work assumes a rigid fully saturated porous medium incompressible phases and negligible thermal gravitational and surfactant adsorption effects for simplicity densities of water and surfactant component are assumed equal we define the domain ω r d d 2 or 3 with lipschitz boundary γ ω and the time interval 0 t and introduce the system of equations that describes the immiscible two phase flow including surfactant transport kovscek and radke 1994 kovscek et al 1995 1994 chen et al 2010 ding and guerillot 2020 1 ϕ t s w c s u w c s 0 in ω 0 t 2 ϕ s β t u β 0 in ω 0 t 3 u β κ λ β p β in ω 0 t with proper initial and boundary conditions in this system 1 is the surfactant mass conservation in this paper we also refer to it as a transport equation of the surfactant species in the aqueous phase 2 is the water gas mass conservation in this paper we also refer to it as a phases transport equation 3 is two phase darcy equation the eqs 2 3 in this work are also referred to as the hydrodynamics problem in the system above the independent variables unknowns are the surfactant concentration in water c s phase saturation s β phase superficial velocity u β phase pressure p β with β g for the gas phase and β w for the aqueous phase we also define the constant porosity of the medium ϕ and κ κ x is the intrinsic isotropic scalar permeability in the position given by the vector x from the fractional flow theory buckley and leverett 1942 4 λ w k rw μ w λ g k rg μ g f and λ λ w λ g denote respectively the mobility of water gas and total mobility moreover μ w is the viscosity of water μ g f is the viscosity of gas in the presence of foam k rw and k rg are relative permeabilities of water and gas respectively defined by kovscek et al 1995 chen et al 2010 5 k rw k rw 0 s w s wc 1 s wc s gr n w and k rg k rg 0 x f 1 s w s gr 1 s wc s gr n g where we define the following constants s wc is the connate water saturation s gr is the residual gas saturation k rw 0 and k rg 0 are the endpoint relative permeabilities of water and gas respectively n w and n g are empirical model parameters the term x f is the total fraction of gas that is effectively flowing throughout the porous medium defined as x f 1 x t where x t is the fraction of trapped gas following chen et al 2010 x f is taken as a constant in this work the gas mobility reduction is proportional to the foam texture n f defined as the number of bubbles per unit volume here we use the normalized foam texture n d n f n max where n max refers to the constant maximum reference foam texture the non newtonian foam effects are included into system 1 3 through the definition of the effective gas viscosity hirasaki and lawson 1985 6 μ g f μ g α n max v g 1 3 n d where 7 v g u g ϕ s g x f is the gas interstitial velocity μ g is the gas viscosity in the absence of foam and α is an empirical constant based on kovscek and radke 1994 and kovscek et al 1994 a simplified foam model in local equilibrium relating the normalized foam texture n d with s w c s and the total velocity u was proposed by 12 8 n d ω k 1 v g 2 3 n max k 1 0 v w n d 1 0 where ω 3 as also proposed in chen et al 2010 and 9 k 1 n d k 1 0 1 n d ω with constant k 1 0 model s parameter kovscek et al 1994 and 10 v w u w ϕ s w is the water interstitial velocity neglecting that v g is dependent on n d as proposed by chen et al 2010 a cubic equation with a single real root is obtained thus given the liquid velocity gas velocity and capillary pressure it is possible to obtain n d analytically also 11 k 1 s w c s k 1 0 p c p c p c 2 with p c p c max tanh c s c s ref k 1 0 is a constant chen et al 2010 p c max is the maximum value for the limiting capillary pressure p c c s ref is a reference surfactant concentration for strong net foam generation and p c is the capillary pressure assumed to be a function of s w only and defined later in eq 41 12 p c p c s w p g p w eq 8 balances the rate of foam generation and foam destruction implicating the local equilibrium assumption in addition the term k 1 n d in eq 9 is related to the foam generation and the term k 1 s w c s in eq 11 is related to the foam destruction remark notice that the system 1 3 is strongly coupled as the term u β depends both on s w and c s through eqs 4 5 6 and 8 2 1 reformulating the model for the numerical implementation to allow for simulating scenarios where the capillary pressure in the pore p c is greater than the limiting capillary pressure p c in which case the bubbles become unstable and instantly coalesce khatib et al 1988 we propose the following adaptation of 8 13 n d ω k 1 v g 2 3 n max k 1 0 v w n d 1 0 p c p c n d 0 p c p c following chavent and jaffré 1986 and chen and ewing 1997 the global pressure when s w s is defined as 14 p p g 1 s gr s f w d p c d s w d s w with f w λ w λ λ w λ w λ g the total velocity is given by u u w u g with 15 u w f w u κ λ g f w p c and u g f g u κ λ g f w p c this alternative formulation is more suitable to be solved using advanced numerical methods being far less computationally expensive than the original two pressure approach chavent and jaffré 1986 chen and ewing 1997 chen et al 2006 daripa and dutta 2017 under the previous hypotheses 1 3 can be rewritten as follows find in ω 0 t the total fluid velocity u the global pressure p the water saturation s w the surfactant concentration c s and the foam texture n d satisfying 16 u κ λ p 17 u 0 18 ϕ s t i 1 d f i x i ℂ s 0 19 n d ζ 3 18 3 2 3 3 a ζ 3 p c p c 0 p c p c where d is the spatial dimension of the problem i denotes a spatial direction ζ 12 a 3 81 9 a k 1 v g 2 3 n max k 1 0 v w with n d being the single real root of 13 assuming ω 3 and 20 s s w s w c s f i f w u i c s f w u i ℂ κ λ g f w d p c d s w b b 1 0 c s 0 and boundary and initial conditions u n u on γ n 0 t 21 p p on γ d 0 t f g f g and c s c s on γ 0 t 22 κ λ g f w d p c d s w s w n 0 on γ 0 t 23 s x 0 s 0 in ω where the union of γ n and γ d constitute the boundary of the darcy problem γ γ n γ d and γ and γ the boundary of the transport problem γ γ γ in both cases there is no intersection of the boundaries γ n and γ d γ n γ d 0 and γ and γ γ γ 0 furthermore γ d defines the boundary region with dirichlet condition specified pressure p boundary condition γ n denotes the boundary region with neumann condition specified injection velocity u on the border γ denotes the boundary region with no diffusion i e there is no inflow or outflow due to capillary effect diffusion on the border and γ x γ n u n 0 is the inflow boundary for the transport equations where f g and c s are the boundary values for the foam quality and surfactant concentration injection respectively also n is the unit outer normal vector to γ and s 0 is the initial condition for the vector of variables s for simplicity we assume γ d 0 γ 0 and γ 0 3 numerical methodology the equations of the foam flow model exhibit different mathematical natures the transport system are formed of hyperbolic type equations and the hydrodynamics problem has elliptic nature in this context we adopt specific numerical methods for each mathematical nature therefore we follow the sequential algorithm proposed by de paula et al 2020 where the hydrodynamics eqs 16 17 are approximated using a naturally stable hybrid mixed finite element method introduced by raviart and thomas 1977 and the transport system 18 is solved using a conservative high order central upwind finite volume scheme with reduced numerical diffusion effects proposed by kurganov noelle and petrova knp by kurganov et al 2001 3 1 sequential algorithm we use a staggered algorithm to decouple the system of eqs 16 19 into two sub systems an hydrodynamics one with time step δ t u and a transport one with time step δ t s with δ t u δ t s because the time scale of the hydrodynamics is usually much slower than of the transport chen et al 2006 algorithm 1 describes the sequential method to solve each problem separately for the transport problem adaptive time steps δ t s are used as needed to bound the error in the approximations under a certain combination of relative and absolute tolerances considering a time instant n when the solution is known and the next instant in time n 1 when the solution is yet to be computed in each iteration approximations for velocity u n 1 and pressure p n 1 at t t n 1 are computed from system 16 17 as follows 24 u n 1 κ λ n p n 1 and u n 1 0 supplemented by the boundary conditions 21 then an iterative algorithm that repeats the computations in order to generate a sequence of solutions in time is used to find approximations for water saturation s w n 1 and surfactant concentration c s n 1 by solving the following system of pdes in ω t n t n 1 25 ϕ s n 1 t i 1 d x i f i n 1 ℂ n 1 s n 1 0 with boundary 22 and initial conditions 23 when n 0 the foam texture is obtained from 19 by solving n d n 1 n d s w n 1 c s n 1 u n 1 3 2 hybrid mixed finite element method for hydrodynamics assuming ω is a polygon we define a partition t h of ω composed of quadrilaterals and use k to denote an arbitrary element of the partition the set of edges e of k is denoted by k the set of edges e in t h is denoted by e h and e h denotes the set of all boundary edges i e those with all points in γ finally the set of interior edges is denoted by e h 0 e h e h the raviart thomas rt spaces raviart and thomas 1977 are constructed by mapping polynomials defined on the reference element k ˆ 1 1 2 to each element k of the mesh t h we denote by f k k ˆ k the invertible bilinear map of the two domains in r 2 a scalar valued function φ ˆ on k ˆ transforms to a function φ p k 0 φ ˆ on k by the composition 26 φ x p k 0 φ ˆ x φ ˆ x ˆ where x f k x ˆ a vector valued function φ ˆ on k ˆ transforms to a function φ p k 1 φ ˆ on k via the piola transform boffi et al 2013 27 φ x p k 1 φ ˆ x 1 j k x ˆ d f k x ˆ φ ˆ x ˆ where d f k x ˆ is the jacobian matrix of the mapping f k and j k x ˆ is its determinant the discontinuous rt space of order of polynomial interpolation k 28 u h k v h l 2 ω 2 v h k p k 1 q k 1 k k ˆ q k k 1 k ˆ k t h 29 p h k q h l 2 ω q h k p k 0 q k k k ˆ k t h where q i j denotes the set of polynomial functions of degree up to i in x and up to j in y and l 2 is the space of square integrable functions we also define the following sets of functions on the mesh skeleton 30 m h k q ˆ h l 2 e h q ˆ h e p k e e e h 0 q ˆ h e p e e h γ d 31 m h k q ˆ h l 2 e h q ˆ h e p k e e e h 0 q ˆ h e 0 e e h γ d where p k e denotes the set of polynomial functions of degree up to k on e in the simulations we adopt the standard lowest order index rt space k 0 a low computational cost choice compared to k 0 that is extensively employed in fluid mechanics computations boffi et al 2013 from these definitions we can introduce the hybrid mixed method for the darcy problem 24 as follows arnold and brezzi 1985 given s w n and c s n find the pair u h p h u h k p h k and the lagrange multiplier p ˆ h m h k such that for all v h q h q ˆ h u h k p h k m h k 32 k t h k a u h v h d x k p h v h d x k p ˆ h v h n k d s k q h u h d x 0 33 k t h k q ˆ h u h n k d s γ n q ˆ h u d s where a a s w n c s n κ λ s w n c s n 1 p ˆ h denotes the lagrange multiplier associated with the pressure trace on the edges and eq 33 naturally imposes the continuity condition on the edges of k and the neumann boundary condition on γ n the hybrid formulation 32 33 is solved employing the static condensation technique guyan 1965 de paula et al 2020 that consists in eliminate all degrees of freedom corresponding to the variables u h and p h leading to a global system with the degrees of freedom associated with the multipliers p ˆ h only also unlike the conforming mixed finite element methods the global system of equations is positive definite allowing for simpler and more robust solvers de paula et al 2020 arnold and brezzi 1985 the global system resolution provides the solution of the lagrange multipliers p ˆ h on the edges of the elements which are used as boundary conditions to retrieve the primitive variables u h and p h in each element of the mesh thus the degrees of freedom associated with velocity and pressure can be computed in local independent problems for more details see arnold and brezzi 1985 and boffi et al 2013 3 3 central upwind scheme for the transport problems the finite volume method proposed by kurganov et al 2001 here called knp is employed to approximate the water saturation and surfactant concentration eqs 25 the upwind nature of knp is because it respects the directions of wave propagation by measuring the one sided local speeds given by 34 a l 1 2 i max min max min λ s l 1 2 i max min λ s l 1 2 i max min 0 on direction i and a cell of index l where l 1 2 is the right resp top face and j 1 2 is the left resp bottom face of a cell s l 1 2 i is the local reconstruction of s at the left resp bottom side of a face and s l 1 2 i is the local reconstruction of s at the right resp top side of a face λ x max and λ x min are the maximum and minimum eigenvalues respectively of the jacobian f i s at s x the terms of the jacobian matrix are discretized using forward finite difference and then evaluated in the required points for each i direction the result of spatial discretization using knp is the system of odes in conservative form kurganov et al 2001 35 ϕ d s l d t i 1 d h l 1 2 i h l 1 2 i h i p l i where h i is the cell size in the i th direction with the central upwind scheme for the convective numerical fluxes given by 36 h l 1 2 i a l 1 2 i max f i s l 1 2 i a l 1 2 i min f i s l 1 2 i a l 1 2 i max a l 1 2 i min a l 1 2 i max a l 1 2 i min a l 1 2 i max a l 1 2 i min s l 1 2 i s l 1 2 i where by choosing a l 1 2 i max a l 1 2 i min a l 1 2 i max λ s l 1 2 i max min λ s l 1 2 i max min we eliminate the upwind nature of convective numerical fluxes 36 and recover the kt method proposed by kurganov and tadmor 2000 in addition the diffusive numerical fluxes are given by 37 p l i ℂ l 1 2 i s l 1 i ℂ l 1 2 i ℂ l 1 2 i s l ℂ l 1 2 i s l 1 i h i 2 where ℂ l 1 2 i is defined as the harmonic mean of ℂ l and ℂ l 1 i the scheme 35 37 combined with minmod reconstruction of the type 38 s l x s l n i 1 d d l i n x i x l i 39 d l i n minmod θ s l i n s l 1 i n h i s l 1 i n s l 1 i n 2 h i θ s l 1 i n s l i n h i is a tvd scheme if 1 θ 2 kurganov et al 2001 where s l is a piecewise linear approximation to the solution at time t n i e s l x s l n x then we can use the fact that x l 1 2 i x l i h i 2 to find s l 1 2 i the minmod operator is a flux limiter used to avoid spurious oscillations in high resolution schemes kurganov and tadmor 2000 kurganov et al 2001 defined as follows 40 minmod q 1 q 2 q n min q j if q j 0 j max q j if q j 0 j 0 otherwise to solve the system of odes 35 a variable order adaptive step backward differentiation formula bdf was adopted this stable implicit scheme allows for taking larger time steps than an explicit method would require which reduces the computational cost 3 4 foam displacement simulator fossil the numerical methodology was implemented in an in house simulator denominated fossil the numerical code for the hybrid finite element method to solve the hydrodynamics problem was developed using the deal ii library arndt et al 2020 the global linear system was solved using the umfpack davis 2004 a set of routines using multifrontal lu factorization for time integration in the transport equations it was adopted the implementation of the bdf scheme from the cvode package available in the sundials library hindmarsh et al 2005 the methods used in cvode are variable order and variable step multistep methods hence δ t s varies in the integration process bounded to relative and absolute tolerances the non linear problem resulted from 25 after space discretization was solved using a quasi newton method along with the scaled preconditioned generalized minimum residual spgmr linear solver brown and hindmarsh 1989 the evaluations of the right hand side of the ordinary differential eqs 35 were implemented in parallel using openmp api the simulations were performed in a computer equipped with an intel xeon w 2133 3 6 ghz of 6 cores and 64 gb of ram using ubuntu 20 04 as the operating system 4 numerical simulations in this section we present numerical results that aim to study the influence of foam and surfactant concentration on two phase liquid gas flow in heterogeneous porous media applying the numerical methodology described in section 3 from numerical and experimental results presented by chen et al 2010 and ding and guerillot 2020 we validate and investigate the stability numerical dissipation and computational cost of the proposed sequential algorithm when compared to classical numerical approaches in the literature next we study the influence of surfactant injection on the foam induced mobility reduction in a two dimensional heterogeneous porous medium in the horizontal plane the boundary conditions adopted in these studies prescribe for the darcy system the right boundary as a dirichlet type γ d with p 0 while left top and bottom boundaries are set to a neumann condition γ n with u 0 for the left boundary and u 0 for the top and bottom boundaries for the transport equations on the left boundary it is imposed f g 1 f w for the aqueous phase and c s 1 f g for the surfactant transport equation whereas right top and bottom boundaries are defined with a homogeneous neumann condition in the fig 1 is shown a graphical representation of the boundary regions the capillary pressure function can depend on several flow experiment characteristics such as rock type and fluids we adopt the following relation provided by kovscek et al 1995 41 p c σ ϕ κ x 0 022 s w 0 15 0 2 with σ denoting the gas liquid interface tension that is assumed to be constant coefficients and numerical parameters used in the simulations are shown in tables 1 and 2 as stated previously δ t s varies in the integration process bounded to relative and absolute tolerances the values for δ t s can be influenced by several factors the mathematical model used the numerical method adopted grid refinement permeability field and many others in the following simulation cases the time steps δ t s can range from 0 045 to 16 6 leading from 1 up to 222 time steps for the transport equation per δ t u step remark notice that in eq 41 capillary suction pressure only diverges at s w 0 15 but water residual saturation in table 1 is higher s wc 0 38 this behavior alone can lead to flow by capillary suction however in the adopted model the diffusive term multiplies the capillary pressure gradient by f w term ℂ in eq 20 which is canceled out when s w s wc preventing water flow by capillary suction 4 1 validation following the numerical experiments of chen et al 2010 and ding and guerillot 2020 we validate the proposed numerical methodology applied to solve the two phase flow model including foam and surfactant injection the simulations are ran for a one dimensional domain for pore volume for a initial surfactant concentration of the remaining parameters can be found in tables 1 and 2 fig 2 presents a comparison between numerical results and experimental data taken from chen et al 2010 for water saturation profiles at different injected pore volume pv the simulation was carried out with 200 cells and the entry boundary condition for water saturation was prescribed as s w 0 55 the injected pv is computed as the product between elapsed time and injection velocity divided by the product between core length and porosity the experimental data are marked as filled circles and connected by lines to facilitate the reading and the non marked lines represent the numerical solutions in the horizontal axis the results are plotted using the dimensionless distance the distance position divided by the domain length the validation results are consistent with the literature chen et al 2010 ding and guerillot 2020 and show a good match between experimental data and numerical solution as the simulation results could predict the wavefronts positions in addition the foam propagation in porous media behaves in a front like manner leading to a very efficient displacement of the aqueous phase results for foam texture when the simulation s grid size is varied are presented in fig 3 it is interesting to notice that the foam texture solutions present a peak reaching n d 1 and hence n f reaching n max right behind the shock wave it is also evident in fig 3 the difference in the solutions for each grid size showing the dependence of the foam texture resolution with the grid size as the peak region of the foam texture becomes more slender the previous grid size dependence behavior can be credited to the intermediary values of s w between the injection state j and the initial state i see fig 4 the numerical diffusion and the diffusion from the capillary pressure term yield intermediate water saturation values between states i and j that correspond to high n d values see fig 4 resulting in the foam texture peaks observed in fig 3 notice that the presence of the peaks in the foam texture is not entirely a numerical artifact rossen 2013 for similar models it was proven to be part of mathematical solutions lozano et al 2022 fig 4 shows the foam texture n d as a function of the water saturation s w for fixed values of surfactant concentration c s to simulate the curves in fig 4 we use eq 19 with parameters values from table 1 fixing a total injection velocity m s 1 we find the phase velocities v g and v w which are inter dependent with μ g f using a technique similar to one proposed by kam 2008 this process initially assumes an approximation for v g and v w with u w u and u g 0 since the medium is initially saturated with water from these approximations the function f w is computed using eq 14 new values for f g f g 1 f w and v w are computed from the last evaluated f w and eqs 10 and 14 these steps are iterated until convergence elevated gradient see fig 4 causes a small variation in the injection water saturation point j leads to a relatively high variation in the injection foam texture notice that the injection state of the previously presented solutions point j falls in that steep region of fig 4 for 0 5 s w 0 6 4 2 stability numerical dissipation and computational cost results comparing the proposed methodology with other numerical approaches to approximate convective fluxes are shown in fig 5 figs 5 a and 5 b present an approximation for the water saturation and foam texture at 0 3 pv comparing the knp method with the kt a central scheme presented by 35 and the classical upwind methods using 100 cells in order to use the kt and upwind method in the simulations the convective fluxes 36 are adapted to these methodologies the results for the foam texture fig 5 b show a lower accuracy and greater numerical dissipation of the upwind method compared to the knp method since the more accurate the solution the thinner the peak region see fig 3 moreover the kt method presents spurious oscillations and fails to approach this model with this mesh refinement as can be seen in figs 5 a and 5 b in the simulated case where the p c does not exceed p c and the foam texture tends to zero due to the excessive lower value that s w reaches in the spurious oscillations according to fig 4 the spurious oscillations in the kt method due to the scheme instability appears specifically in the region for s w 0 45 see fig 5 a and where foam texture approaches zero n d 0 the foam generation model is a power law expression proportional to the magnitude of the phase velocities more details in kovscek and radke 1994 kovscek et al 1995 therefore as water saturation reduces its value the water velocity v w tends to zero yielding low foam generation in this case to obtain a stable solution using the kt method as shown in figs 5 c and 5 d excessive mesh refinement is required which highlights the stability of upwind approaches especially the knp method for this type of problem in addition a computational cost study comparing the implicit time integration strategy adopted with the explicit approach commonly applied to these central finite volume methods kurganov and tadmor 2000 kurganov et al 2001 is presented in fig 6 the physical and numerical data used in these simulations are provided in tables 1 and 2 varying only the number of processor cores used in the computation the stability of the adaptive process of approximation in time is guaranteed by the sundials library hindmarsh et al 2005 which meets the solution convergence criteria at each time step thus both the solutions using the implicit and the explicit scheme converge to a unique solution since the solutions are obtained using the same convergence criterion the figure relates the resolution time in seconds to the grid size and is presented on the log scale the results show a lower computational cost of the implicit strategy bdf adopted compared to the runge kutta rk method this cost can be reduced by increasing the number of processing cores this is because the sundials library algorithm requires smaller time steps for the explicit method demonstrating a greater cfl condition restriction 4 3 comparison between co injection and sag in this section we investigate the surfactant s ability to generate and stabilize foam through two injection techniques in order to reduce the viscous fingering phenomena and the high permeability channeling in order to achieve these goals we use the heterogeneous isotropic permeability field of layer 36 of the 10th spe project anon 2000 this layer clearly presents a high permeability channel as shown in fig 7 in this context we compared the water surfactant gas co injection technique with the injection of the water surfactant solution alternating with gas co injection is a characteristic approach of laboratory experiments and sag is associated with remediation and eor strategies in field applications the simulations were carried out for seconds in a two dimensional domain of m with a mesh of 220 60 cells this porous medium is pre saturated with pure water and the effects of the trapped gas fraction are neglected x t 0 and the remaining parameters can be found in tables 1 and 2 for the co injection we conducted four experiments by simulating the injection of an aqueous solution with surfactant using different foam qualities shown in table 3 on the other hand for the surfactant alternating gas technique setting f w 1 0 we inject t c s 0 0438 pv t c s 0 0875 pv t c s 0 1313 pv t c s 0 1751 pv of water with surfactant which introduces the same amount of surfactant into the porous medium as in the co injection cases studied see fig 8 b then a gas slug was injected f g 1 0 until the end of the simulation the surfactant pore volume e g fig 8 is computed by multiplying the surfactant concentration by the water pore volume since the densities of surfactant and water components are considered equal as assumed in section 2 fig 9 shows the results for surfactant concentration comparing the water gas co injection with of surfactant concentration for different foam qualities f g 60 70 80 90 with sag injection for different slug sizes of surfactant solution t c s 0 1751 0 1313 0 0875 0 0438 pv although there is the same amount of surfactant in both injection strategies for each case studied the sag technique presents a better propagation of the surfactant in the porous medium mainly percolating through the preferential channel this behavior of the sag injection induces a greater foam formation in the preferential channels unlike the co injection that maintains the maximum value of the foam texture in the domain s entrance region as seen in fig 10 notice that the foam collapses upstream reflecting in the lower foam texture near the entrance region mainly due to the reduction of the water saturation during the gas injection in sag due to the dependence of the apparent viscosity on the foam texture and gas velocity 6 it is possible to notice in fig 11 that the behavior of the apparent viscosity for the co injection is similar to the foam texture with higher values at the entrance of the domain however the sag strategy presents higher values in the region of the preferential channel especially when there is a greater amount of surfactant injected the apparent viscosity in the rest of the domain is lower than in the co injection case because gas velocity is higher in sag during gas injection than in co injection due to the imposition of f g 1 0 despite this apparent viscosity s effects on the sag s gas mobility reduction present better sweeping efficiency than co injection reducing water saturation both at the entrance to the domain and in the preferential channel as shown in fig 12 a better comparison of the sweep efficiency between sag and co injection is shown in fig 13 where the cumulative water production to each foam quality and surfactant slug size simulated is presented in addition to the case without surfactant no foam in the co injection results it is possible to observe that as f g decreases there is an increase in cumulative water production especially when there is a surfactant in the medium to induce foam generation fig 13 a the greater amount of surfactant injected due to the reduction of f g fig 8 a increases the cumulative water production difference in relation to the case without surfactant in addition the reduction of f g decreases the gas injection velocity therefore the aqueous phase containing the surfactant species presents a greater propagation consequently more foam is generated which leads to greater sweep efficiency on the other hand fig 13 b presents the sag results for different surfactant slug sizes adopting the same surfactant amounts as in the co injection cases it is also presented the wag water alternating gas injection strategy for different water slug sizes t s w 0 0438 0 0875 0 1313 0 1751 pv for the case when the foam is not present in the flow the results show that sag injection generates a higher water production than wag strategy zeng et al 2020 in comparison sag can also achieve better production when compared to the co injection strategy in addition it is evident in fig 13 b that the more surfactant injected the more delayed the gas phase breakthrough we proceed with the same scenario as the previous simulation with different percentages of surfactant in the injected aqueous solution in fig 14 we present a comparison relating the total cumulative water production defined as cumulative production at the simulation time 20 000 s with the amount of surfactant injected into the medium including the case with no foam applying the co injection method it is possible to observe the surfactant injection over does not significantly alter the cumulative water production see fig 14 a on the other hand in fig 14 b the sag injection achieved higher water production than the co injection for all surfactant concentrations this production increment is due to a greater amount of injected surfactant generating a greater concentration in the preferential channels reducing foam destruction and increasing gas mobility reduction notice that the maximum value for sag cumulative production does not present an expressive elevation when this behavior indicates that the surfactant concentration reaching the limit point corresponds to the maximum p c defined in 11 and adding more surfactant will not improve foam mobility reduction this behavior agrees with the literature describing when the surfactant concentration exceeds the critical micelle concentration cmc liu et al 2005 lee and heller 1990 wang et al 2019 li et al 2019 based on the results presented in fig 14 the cumulative water production at as a function of the amount of injected surfactant for the co injection and sag techniques is presented in fig 15 the curves in fig 15 were obtained using the least square method with the logarithmic function 42 y a b ln x where y represents the total cumulative production x is the total surfactant injection and a and b are the fitting parameters the data used in the fit process is all points of the surfactant concentration curve green line in figs 14 a and 14 b and the highest cumulative production values for each remaining surfactant concentration curves diamond markers in figs 14 a and 14 b the least square fit allows us to extrapolate the obtained simulation results for a higher amount of surfactant showing a threshold for the production improvement by the surfactant concentration although in both cases a plateau of maximum production was formed after a certain cumulative surfactant injection the sag injection resulted in a higher production when compared with the co injection technique furthermore regardless of the amount of surfactant injected the total cumulative water production by co injection is limited to around 0 32 pv while sag reaches approximately 0 40 pv 5 discussions for the sag simulations in heterogeneous porous media the surfactant concentration value where the mobility reduction reaches its maximum is around as can be seen in fig 14 b for the co injection case the limiting surfactant concentration is see fig 14 a in that way it is possible to optimize the amount of surfactant injected so the maximum production is reached with the lowest surfactant quantity possible and the operation costs can be minimized and the profits maximized it is interesting to mention that the heterogeneous porous media with a high permeability channel is mainly responsible for the differences in production curves in fig 14 if the porous media is chosen to have a homogeneous permeability distribution it turns out that the production curves for different surfactant concentration injections are virtually the same that happens because there are no preferential paths or high permeability regions and the surfactant is evenly distributed throughout the flow wavefront hence the different surfactant concentration injection behavior tends to be very close to each other both in the co injection and sag strategies although sag still presents better results the usage of the mathematical foam flow model presented in section 2 increases the computational cost when compared with the no foam flow model due to mainly two reasons i the inclusion of an additional eq 1 describing surfactant transport that doubles the size of the algebraic system of equations that arises from the numerical discretizations ii the resulting matrices from the numerical methods become ill conditioned especially in the transport problem affecting the linear solver negatively that ill conditioning happens due to the relatively bigger difference between the water and gas mobility since gas mobility can be greatly reduced 6 conclusions the foam model proposed by kovscek kovscek and radke 1994 was modified to reflect the behavior that foam completely collapses when surfactant concentration is zero or close to zero enabling simulations where the porous medium is initially not saturated with surfactant the sequential algorithm proposed to solve two phase flows including the surfactant effects that induce foam generation producing a greatly reduced mobility and also a non newtonian behavior of the gas phase proved to be robust stable accurate and with reduced numerical dissipation and computational cost the numerical results showed that the kt method fails to simulate this type of problem while the knp method due to its upwind nature proved to be stable with less numerical dissipation and more accurate than the classical upwind due to the stability properties of the implicit time integration methods the bdf method showed a significant reduction in computational cost compared to the runge kutta method usually adopted in this type of approach the co injection results indicated that the lower the foam quality the higher the sweep efficiency since the reduction of f g in the injection favors the inflow and propagation of more surfactant in the porous medium that leads to higher foam generation and lower gas mobility by fixing the amount of surfactant injected the numerical results show that sag injection has a better sweep efficiency compared to co injection due to greater surfactant percolation in preferential channels that lead to greater foam formation and consequently a reduction in gas mobility in the preferential paths the results show that at a certain point it is not advantageous to increase the surfactant concentration for co injection nor sag strategies as there is no significant productivity improvement that happens because surfactant achieves a critical concentration and the limiting capillary pressure 11 reaches its maximum therefore the excess surfactant does not improve mobility reduction there is an optimal surfactant concentration value to obtain the total water production possible using a relatively lower amount of surfactant possible for the simulations carried out in this work this optimal concentration is around for the sag and for the co injection credit authorship contribution statement filipe f de paula software formal analysis investigation writing original draft writing review editing iury igreja methodology software formal analysis investigation writing original draft writing review editing supervision thiago quinelato software methodology formal analysis investigation writing original draft writing review editing supervision grigori chapiro conceptualization methodology formal analysis investigation writing review editing supervision project administration funding acquisition declaration of competing interest grigori chapiro reports financial support was provided by shell brazil iury igreja reports financial support was provided by shell brazil thiago quinelato reports financial support was provided by shell brazil filipe f de paula reports financial support was provided by shell brazil grigori chapiro reports financial support was provided by minas gerais state foundation of support to the research grigori chapiro reports financial support was provided by national council for scientific and technological development iury igreja reports financial support was provided by minas gerais state foundation of support to the research acknowledgments the current work was conducted in association with the r d project anp n 20715 9 modelagem matemática e computacional de injeção de espuma usada em recuperação avançada de petróleo ufjf shell brazil anp shell brazil funds it in accordance with anp s r d regulations under the research development and innovation investment commitment this project is carried out in partnership with petrobras g chapiro was supported in part by cnpq brazil grants 303245 2019 0 and 405366 2021 3 and fapemig brazil grant apq 00405 21 i igreja was supported in part by fapemig brazil grant apq 00517 21 
81,many post tsunami field investigations affirm that the large floating debris transported by the flow contributes significantly to the destruction of on land buildings however few simulation tools have been developed to predict the debris behaviour under violent flow conditions involving complex debris fluid debris debris debris bed surface and debris wall solid structure interactions this paper introduces a fully coupled model of three dimensional 3 d debris motion in shallow water flow the model uses smoothed particle hydrodynamics sph to solve the shallow water equations swes and represents debris motion using the modified morison equation the discrete element method dem model is used for the collision mechanism the flow model is formulated based on the euler lagrange equations that provide the vertical component of velocity and can therefore be coupled with the 3 d debris motion a new solid boundary condition for shallow flows is introduced the open boundary condition is used for wave generation by imposing inflow and outflow in predetermined zones the sph solves the wet dry interface automatically the model is implemented in an open source software dualsphysics swe sph flow model is initially validated against experimental data followed by the debris model compared with an analytical solution and physical experiments which gives close agreement this model is expected to be a robust tool for predicting the hazards caused by extreme floodings such as tsunamis keywords debris tsunami simulation smoothed particle hydrodynamics shallow water equations dualsphysics data availability data will be made available on request 1 introduction the devastating effects of tsunamis are well known especially when involving the cumulative destruction effect by the tsunami driven debris a structure destroyed by debris becomes a new source of debris transported by the flow therefore predicting the debris movement from its initial source is important for risk mitigation the debris example that can be found at the initial source includes containers and vessels from ports and boulders near the coast a recent post tsunami field investigation by syamsidik et al 2020 in banten indonesia recorded that a boulder with nearly 3 m diameter was found to have been transported by the tsunami as far as 87 m from its original position due to the mount anak krakatau volcanogenic tsunami on 22 december 2018 mathematically predicting the debris movement which has chaotic nature in the violent water flow is difficult or near impossible therefore a numerical approach is preferable for solving this problem however it is still challenging to develop a computer program to model the debris movement of which the length scale is much smaller than the shallow flow domain such as tsunamis park and cox 2019 proposed a framework to quantify the amount and location of construction debris generated and advected from a multi hazard earthquake and tsunami event kameshwar et al 2021 developed a connectivity analysis methodology of the hazard damage debris transport and infrastructure connectivity to provide immediate post event information up to 72 h after the event however predicting the movement of the debris with a simulation model that includes the key physical process remains a challenge nistor et al 2017 behrens et al 2021 some simplifications are needed in the process the simulation of tsunami generation at the ocean bed to inundation of coastal regions has been in development for many years full 3 d simulations remains very expensive computationally for example qin et al 2018 proposed to use computational subdomains of the community region being simulated to capture the local flow characteristics in order to reduce computational domain once a tsunami is generated this is basically a long wave phenomenon with a wavelength much larger than depth this suggests that swes with hydrostatic pressure are appropriate and efficient particularly in depth averaged effectively two dimensional form mesh based methods have been widely used to solve the depth averaged equations such as tohoku university s numerical analysis model for investigation of near field tsunamis tunami goto et al 1997 cornell multigrid coupled tsunami model comcot wang 2009 method of splitting tsunami model most titov and gonzález 1997 etc all of which simulate tsunami generation in the ocean bed to inundation of coastal regions while they have been broadly successful special treatment is required for wetting and drying interfaces with either adaptive meshing or a large domain to cover a potential inundation area herein we apply the lagrangian particle based smoothed particle hydrodynamics sph method to the depth averaged model which automatically solves the wet dry front without any special numerical treatment the computational cost of the depth averaged solver is much less compared to the full 3 d models it also has the advantage of an approximation for vertical velocity not available with mesh based methods this is useful for debris transport modelling which is the aim of this paper sph which was initially developed for astrophysics simulations gingold and monaghan 1977 lucy 1977 has been widely used in solving water related engineering problems since the first attempt by monaghan 1994 for simulating free surface flows with the recent advancements in sph theory and parallelisation techniques utilising the graphics processing unit gpu technology the sph method has become more convincing and reliable violeau and rogers 2016 the sph method was first used to solve the swes by ata and soulaïmani 2005 and rodriguez paz and bonet 2005 for a large horizontal scale simulations further advancements were then developed such as shock capturing vacondio et al 2012a variable resolution with dynamic particle splitting and coalescing vacondio et al 2013 boundary condition for solid wall vacondio et al 2011 open boundary conditions vacondio et al 2012c and hardware acceleration wu et al 2020 xia and liang 2016 there are free and open source shallow water equations sph swe sph solvers available now wu et al 2020 vacondio et al 2012c however we utilise the efficient dualsphysics domínguez et al 2021 code for implementing a parallelised version of the shallow flow model the main contribution however lies in the incorporation of debris transport which is assumed to be small enough to be represented by a simple force formulation known as the morison equation morison et al 1950 including empirical drag and added mass coefficients this assumes that the body is small enough for the local flow to be assumed uniform that is the spatial flow variation is very small in relation to body dimension the alternative option of completely resolving the flow around the body would be computationally prohibitive the debris may be floating or fully and partially immersed with or without sliding on the bed when sliding there is an additional friction coefficient defining the retardation force and a coefficient of restitution defining normal velocity reversal when impacting the bed the number of debris elements may be large and may collide with each other involving further coefficients while the fluid exerts a force on the debris the debris exerts an equal and opposite force on the fluid according to newton s law consistent with a two way coupling formulation the validity of this approach is demonstrated by several test cases first without debris a dam break through a small opening by aureli et al 2011 and the okushiri 1993 tsunami case by matsuyama and tanaka 2001 then with debris represented as solid spheres sphere impacted by a dam break and in a flow through a channel with a smooth contraction and expansion the paper is structured into three parts 1 the variational formulation of the depth averaged flow model in sph form 2 coupling of the debris motion with the depth averaged flow model and 3 validation of the flow and debris models 2 sph shallow water flow model this section presents the governing equations of the depth integrated flow model in continuous form followed by the numerical formulation using the sph method in this study the variational formulation for swe by rodriguez paz and bonet 2005 is implemented together with the stabilisation technique by ata and soulaïmani 2005 and monotone upstream centred schemes for conservation laws muscl reconstruction van leer 1979 of the fluid velocity 2 1 shallow water equations swe in lagrangian form the depth integrated equations of mass and momentum conservation are written as 1 d d d t d v 2 d v d t g d g b s f γ d where d is the water depth as illustrated in fig 1 v is the depth averaged velocity vector in horizontal coordinate g 9 81 m s 2 is the gravitational acceleration b is the bed elevation and s f is the bed friction source term γ is the viscosity term and d is the force contribution from the floating debris if we redefine the density ρ as the amount of fluid mass per unit area of the water column in a two dimensional 2 d horizontal domain 1 and 2 above will be similar to the euler equations apart from the additional source terms this makes the software development of the existing standard sph solvers easier as density ρ is a commonly used variable in the formulation by assuming that the fluid is incompressible the density ρ and water depth d are linearly related as 3 ρ ρ w d where ρ w is the constant 3 d density ρ w 1000 kg m3 for water substituting 3 into 1 and 2 the swes can be written as 4 d ρ d t ρ v 5 d v d t g ρ w ρ g b s f γ d 2 2 momentum equation fig 1 shows the representation of fluid in the computation domain initially in a 2 d cartesian coordinate we have the bathymetry data b x y in 2 d horizontal coordinates which is fixed in time a 2 d cartesian coordinate system is used for the hydrodynamics model on top of the bed surface the fluid body is discretised as a set of lagrangian particles representing a column of water each fluid particle has a mass m which is constant in time bed elevation b depth d position x x y and depth averaged velocity vector v v x v y based on the variational formulation by rodriguez paz and bonet 2005 the acceleration of the i th fluid particle d v i d t with the inclusion of dissipative terms is computed using below equation 6 d v i d t t i g v i k i v i t i b i 1 b i b i b i s f i γ i d i where g 9 81 m s 2 is the gravitational acceleration t i t i m i 7 t i j 1 n m i m j g 2 ρ w 1 α j w j x i h j 1 α i w i x j h i and 8 α i 1 ρ i d m j m j r i j d w i j d r i j where the subscript j denotes the value of neighbour particles n is the number of neighbours ρ w 1000 kg m 3 is the 3 d density of the fluid α i is the correction factor due to the variable smoothing length r i j is the distance between particle i and j d m is the dimension 1 for one dimensional 1 d domain and 2 for 2 d ρ i is the density w i j is the kernel weighting function w i x j h i is the kernel gradient and h i is the smoothing length of the i th particle for the kernel function the fifth order wendland kernel wendland 1995 is used in this study 2 2 1 bed gradient and bed friction source term to treat the irregular bathymetry or bed profile a new set of fixed particles are introduced at the beginning of the simulation distributed in a uniform grid following the work of vacondio et al 2011 those bed particles carry the data of bed surface elevation and manning coefficient which are then used to approximate the bed gradient b i using the sph approximation with a correction method by bonet and lok 1999 and to interpolate the bed curvature tensor k i b i using the integral approximation by cleary and monaghan 1999 monaghan 2005 in a similar manner the bed particles are also used to interpolate the manning coefficient n i using the scatter sph summation with a shepard filter randles and libersky 1996 which is then needed when computing the bed friction source term s f i below 9 s f i g n i 2 v i v i d i 4 3 2 2 2 turbulent diffusion term the turbulent diffusion term γ i has two components a term representing dispersion due to vertical shear originally due to elder 1959 and a diffusion term due to turbulent processes dalrymple and rogers 2006 10 γ i ν t 2 v i 1 ρ τ i the velocity laplacian in a discrete form is morris et al 1997 lo and shao 2002 11 ν t 2 v i j m j 4 ν t x i j w i j ρ i ρ j r i j 2 η 2 v i j where x i j x i x j v i j v i v j r i j x i x j η 0 1 h i h j 2 and 12 w i j 0 5 w i x j h i w j x i h j ν t is the depth averaged eddy viscosity coefficient described as 13 ν t d u d i where d is the mixing coefficient usually between 0 1 and 3 and u is the shear velocity 14 u τ b ρ w n i 2 g d i 1 3 v i v i we use a mixing coefficient d 0 3 for all test cases presented in section 5 considering a moderate mixing intensity the horizontal shear in the flow is represented as sub particle scale sps turbulent model which uses the large eddy simulation les approach described by dalrymple and rogers 2006 as written below 15 1 ρ τ i j m j τ i τ j ρ i ρ j i w i j the sps stress tensor horizontal shear stress τ i is given by 16 τ ρ 2 c s δ 2 s τ 1 3 τ δ 2 3 c l δ 2 δ s 2 where c s 0 12 is the smagorinsky constant c l 0 0066 δ is the initial particle spacing s is the local strain rate tensor and s 2 s s 0 5 and δ is the kronecker delta the last term in the momentum eq 5 i e the floating debris force d i will be described later in section 3 6 2 3 continuity equation since the mass of each fluid particle remains constant to account for the change of a particle s water depth the volume and hence smoothing length of particle must change in the sph form with variable smoothing length the density of the i th particle is approximated as follows 17 ρ i j m j w i x j h i the density ρ or depth d may vary significantly during the simulation especially when the fluid is expanding or compressing to get an accurate value an approximately constant number of neighbouring particles must be maintained by adjusting the smoothing length following benz 1990 18 h i h i 0 ρ i 0 ρ i 1 d m where ρ i 0 and h i 0 are the density and smoothing length of the i th particle at the beginning of simulation eqs 17 and 18 are implicit therefore they are solved iteratively using newton raphson iteration method as described in rodriguez paz and bonet 2005 once the converged values of ρ i and h i are found the water depth is updated as d i ρ i ρ w additionally due to the incompressible fluid assumption the area of particle v i equivalent to volume in 3 d sph is also changed following v i m i ρ i to keep the volume of fluid column constant 2 4 boundary conditions for the wall boundary a set of wall boundary particles wbps are introduced at the beginning of the simulation distributed in a uniform grid filling the wall geometry shape the wbps carry the same information as the fluid particles such as mass m density ρ and depth d when calculating the fluid momentum eq 6 and continuity eq 17 the wbps are considered as neighbours and contribute to the calculation the density of the i th wbp ρ i is extrapolated only from the surrounding fluid particles using sph interpolation 19 ρ i j fluid ρ j w i x j h j v j where w i x j h j w i x j h j j fluid w i x j h j is the corrected kernel using the shepard filter randles and libersky 1996 and v j is the particle s horizontal area once the density of all wbps has been obtained we can then compute their depth d i ρ i ρ w and mass m i ρ i v i please note that in 19 we use the smoothing length of the neighbouring particles h j which is usually referred to as the scatter sph formulation the scatter formulation is used here to make sure that every wbp located in the fluid s kernel radius has the required values for computation additionally the boundary particles can be in a fixed position or moved according to a predefined motion this boundary condition works similar to the dummy particles method in adami et al 2012 keeping its advantages such as being easy to set up efficient and robust for complex wall geometries 2 4 1 no slip boundary condition the no slip boundary condition can be enforced by firstly extrapolating the fluid velocity field to the wbp 20 v i j fluid v j w i x j h j v j the velocity value of the wbp are then 21 v i 2 v i v i where v i is the predefined wall velocity 2 4 2 slip boundary condition for slip boundary condition the wbp tangential velocity is set to be equal to the extrapolated velocity from the fluid region v i while the normal velocity is mirrored following the same eq 21 to prevent fluid particle penetration into the wall to determine the normal and tangential velocity special treatment is needed by initially calculating the normal and tangential unit vector of each wbp using the particle concentration gradient the normal unit vector of the i th wbp is n ˆ w i n w x n w y i is 22 n ˆ w i x c i c i y c i c i where c i is the concentration gradient of wbp calculated using renormalised sph gradient estimation proposed by bonet and lok 1999 23 c i j wall l x i w i x j h i v j where l x i is the kernel gradient correction matrix 24 l x i j x j x i w i j x v j j x j x i w i j y v j j y j y i w i j x v j j y j y i w i j y v j 1 note that the simplification w i j w i x j h i and j wall in this particular equation by using the kernel gradient correction renormalisation more accurate normal unit vectors can be obtained especially around the wall with sharp edge the tangential unit vector t w i t w x t w y i is then 25 t ˆ w i n w y n w x i for the sake of efficient computation we can compute n ˆ w and t ˆ w only once at the beginning of simulation as long as there is no change of wall shape e g when some part of the wall are moving while the rest are steady the normal and tangential velocities of the wbp can be computed respectively as 26 v n i 2 v i n ˆ w i v i n ˆ w i 27 v t i v i t ˆ w i finally the velocity value of wbp is obtained by projecting the normal and tangential velocity back to the original coordinate system 28 v x v y i n w x t w x n w y t w y i v n v t i 2 4 3 open boundary particle obp for the open boundary condition inflow and outflow the formulation based on characteristics method proposed by vacondio et al 2012c is implemented by defining a buffer zone filled with open boundary particles obps the depth and or velocity of the obp are imposed or following the characteristic riemann invariants calculated from extrapolated values of nearby fluid particles these obp are later included in the sph summation for calculating the fluid acceleration and density hence depth 3 debris model 3 1 general assumptions of the debris model fig 2 illustrates the representation of a floating debris in shallow water flow several assumptions are made in the derivation of formulations and are listed below 1 each debris is represented as a single computation point with position x x x x y x z velocity x x x x y x z and acceleration x x x x y x z therefore the debris rotational effect is ignored in the formulation this assumption is valid when the velocity field across the debris body is nearly uniform i e when the length scale of the velocity variation in space is much larger than the debris size thus is suitable for application to tsunami flooding however it may not be as accurate when it is located at the hydraulic jump or at the location of tsunami breaking wave for cases where the rotational effect is strong such as a wood log transported by a river flow the debris object can be discretised into multiple points as proposed by ruiz villanueva et al 2014 and persi et al 2018 2 the debris shape is simplified as a solid sphere with radius r d hence the volume v d 4 3 π r d 3 and mass m d ρ d v d where ρ d is the mass density of the solid debris the complex hydrodynamic force around the debris is simplified as an approximation based on the depth averaged flow field at the centre of mass of the debris and the empirical coefficients are determined from the experiments this empirical coefficient is a function of relative reynolds number r e and depends on the shape of the debris 3 the debris is subjected to hydrostatic pressure distribution hence the buoyancy force is applied based on archimedes principle 4 the debris particle experiences 3 d motion 5 the debris can interact with other debris with the bed surface and with the solid wall boundary the collision response is predicted using the simplified mass spring damping effect represented by a restitution coefficient 6 the debris motion is coupled with the shallow water flow model using the two way coupling method 3 2 debris equation of motion the debris motion is computed by solving newton s second law of motion 29 x f n e t m d where f n e t f x f y f z is the net force working on the debris the net force consists of three components 30 f n e t f m f w f b where f m is hydrodynamic force f w is the debris weight and f b is the buoyancy force the hydrodynamic force f m is computed using the morison equation morison et al 1950 31 f m 0 5 ρ w a s c d v x v x ρ w v s a ρ w v s c a a x where a s and v s are respectively the submerged area facing the fluid flow and the submerged volume of the debris v v x v y v z and a a x a y a z are the interpolated fluid velocity and acceleration at the debris position c d is the drag coefficient and c a is the added mass coefficient note that in the numerical scheme we use the value of a and x from the previous time step because their current values are unknown this is possible due to a very small time step applied if the debris is not submerged in the fluid a s and v s will be zero hence the total hydrodynamic forces will be automatically zero the scatter sph interpolation procedure to approximate v and a in 31 is the same as in 20 in order to avoid overestimation when there are limited fluid particles in the kernel radius the shepard filter is applied only if the correction denominator value j fluid w i x j h j 0 5 it was observed that in the case of a piece of debris resting on a dry surface being approached by a wave surge the debris tended to start moving before the fluid particles reached the debris which is unphysical this happens once the debris detects a fluid particle when the debris is in the smoothing radius of the fluid the shepard filter will overestimate the fluid velocity and acceleration at the debris position therefore a threshold is set here to activate the shepard correction the interpolated fluid vertical velocity v z and acceleration a z for computing the vertical hydrodynamic force in 31 are computed using below equations 32 v z b x v x b y v y 33 a z b x a x b y a y in the sph formulation of the shallow water equations the water columns between the bed surface and the free surface are represented as fluid particles variations of bed elevation result in non zero vertical velocities and accelerations of a fluid particle the formulation in 31 can be used for general shape of floating debris different debris shapes will have different values of c d and c a in this study the debris is assumed to be a solid sphere due to its simplicity and availability of the c d and c a values from published literatures however for the real application this approach can be expanded to other different shapes of debris to mimic the real incident where the debris shape may vary for a solid sphere the c a value is 0 5 whilst the drag coefficient c d is a function of reynolds number r e schiller and naumann 1935 34 c d 24 r e 1 0 15 r e 0 687 r e 1000 0 44 r e 1000 and r e is computed using below formula 35 r e ρ w 2 r d v x μ where μ 1 002 1 0 3 n s m 2 is the dynamic viscosity of the fluid at temperature 2 0 c the debris weight f w and the buoyancy force f b are calculated as follows 36 f w 0 0 m d g 37 f b 0 0 ρ w v s g 3 3 debris interaction with bed surface when the debris is touching the bed surface as illustrated in fig 3 the debris is assumed to be purely rolling which creates an additional resistance force from interaction with fluid and bed surface note that this assumption is made to define the drag and friction coefficient representing the rolling effect however the model only considers the translation motion of the debris to accommodate this resistance force the following drag coefficient c d formulation proposed by jan and shen 1995 below is applied instead of 34 38 c d 281 r e r e 12 1 31 336 r e 811 r e 2 r e 12 the comparison of c d values based on 34 and 38 are plotted in fig 4 fig 3 show the diagram of debris interacting with the bed surface the debris is determined as touching the bed surface if x z b r d 1 b x 2 b y 2 when the debris touches the bed surface the debris motion eq 29 is changed to 39 x f n e t m d where the f n e t is the total force working on the debris with inclusion of the bed friction force f f the friction force f f is calculated using the following equation 40 f f μ f n f ˆ where μ f is the friction coefficient n is the magnitude of the reaction force from the bed surface in the normal direction and f ˆ is the unit vector of rolling direction the minus sign in this equation ensures that the friction force is facing the opposite side of the rolling direction the normal force magnitude n is calculated as follows 41 n f n e t n ˆ b where n ˆ b is the normal unit vector of the bed surface at the debris touching point the bed gradient at the debris touching point is used to compute the n ˆ b value as 42 n ˆ b n b n b where n b b x b y 1 if n 0 the friction force f f is ignored in the equation of motion hence the equations hereinafter are not necessary the friction coefficient μ f for a purely rolling no slip solid sphere can be calculated as follows 43 μ f 2 7 f n e t f ˆ n where 44 f ˆ x x x x y x x z x and x z x x b x x y b y substituting 43 and 41 into 40 we get the final formulation for the friction force 45 f f 2 7 f n e t f ˆ f ˆ in addition we have to reflect the debris velocity normal to the bed surface to account for the bouncing phenomenon the new debris velocity becomes 46 x n e w x 1 ϵ b x n ˆ b n ˆ b where ϵ b is the elasticity or restitution coefficient whose value is between 0 and 1 the restitution coefficient is an empirical constant representing the ratio of relative velocity between two objects after and before a collision which in this case is between debris and bed surface the value can be defined through an experimental testing the collision is perfectly inelastic when ϵ 0 lastly the debris position is slightly shifted vertically to prevent penetration by updating its vertical position x z b r d 3 4 debris debris collision when we have more than one debris in the simulation domain they may collide with each other fig 5 shows the illustration of collision between two debris debris i and debris j we use the same size for all debris in this study therefore the collision can be detected when the distance between 2 debris centres is less than the sum of their radius 47 x j x i 2 r d when the collision is detected the collision response is applied according to the conservation laws initially the normal direction between debris n ˆ d is calculated using the equation below 48 n ˆ d x j x i x j x i after that we compute the relative velocity magnitude in that normal direction x n 49 x n x j x i n ˆ d the post collision velocities of both debris are then reflected following equations below 50 x i n e w x i 0 5 1 ϵ d x n n ˆ d 51 x j n e w x j 0 5 1 ϵ d x n n ˆ d where ϵ d is the restitution coefficient for debris debris interaction representing the combined effect of the mass spring damper connection between each sphere for the soft sphere collision approach in the dem method canelas et al 2016 2017 to prevent the penetration between debris their positions are shifted away from each other according to the penetration depth p d between two sphere debris 52 x i n e w x i 0 5 p d n ˆ d 53 x j n e w x j 0 5 p d n ˆ d where p d 2 r d x j x i 3 5 debris wall collision fig 6 shows the illustration of debris interaction with the wbp using the same wall particles for both fluid and debris is more convenient in the programming process without having to introduce a new type of boundary condition for the debris in addition the general and complex wall geometries implementation is straightforward the debris wall collision is detected by computing the boundary particles concentration at the i th debris position c i by means of an sph scatter summation 54 c i j wall w i x j h j v j theoretically if the debris is fully surrounded by the boundary particles in the kernel radius the value of c i 1 therefore it is reasonable to set c i between 0 4 and 0 5 as a collision detection in this work c i 0 5 is used this approach does not use the debris radius for the collision detection because the exact wall surface location is not explicitly defined in the boundary condition method implemented in this model however considering the simulation domain is relatively large and small possibilities for the debris to hit the wall this approach is considered acceptable the post collision velocity of the debris is updated in a similar way to the debris debris collision as follows 55 x i n e w x i 1 ϵ w x i n ˆ w n ˆ w where n ˆ w is the normal unit vector pointing out of the wall surface and ϵ w is the restitution coefficient of debris wall collision we can compute n ˆ w by using the concentration gradient of the wall particles at the i th debris position c i 56 n ˆ w x c i c i y c i c i 0 where 57 c i j wall l x i w i x j h j v j 3 6 debris fluid two way coupling the two way coupling between debris and fluid is formulated based on the action reaction principle as explained in section 3 2 the hydrodynamic force acting on the debris f n e t m d x is calculated from the surrounding fluid particles by interpolating the fluid velocity and acceleration at the debris position using the sph approximation as a reaction the force f n e t is distributed back to the relevant fluid particles in the opposite direction to ensure the conservation of momentum the force from the sphere debris acting on the fluid column causes the fluid column to move the force distribution is calculated according to the weighting kernel function between debris and neighbouring fluid therefore the fluid particle nearer to the debris will receive a larger contribution of the total force and the fluid particles outside the compact support will have zero effect the debris force contribution to the i th fluid particle d i in 6 is then given by 58 d i 1 m i j debris m d x j w x j x i max h i 2 r d v i the coupling is only applied in the horizontal direction because it is impossible to explicitly apply a vertical force on the fluid column nevertheless if the bed is not horizontal there is still a horizontal force acting on the fluid particle as the fluid particle slides on the bed surface following its contour additionally the reaction force acting on the fluid column does not deform the fluid column instead the force is transformed into rigid motion of the fluid column the extent of debris force redistribution is denoted by the defined smoothing length when the fluid resolution is too high relative to the debris size instability or explosion may occur due to the large debris force being distributed to small number of fluid particles therefore in 58 the smoothing length is modified to max h i 2 r d to avoid instability 4 time integration we use the velocity verlet time integration scheme in this model verlet 1967 which is low in computational cost and is second order accurate without having to calculate multiple steps within a time interval the variables of i th fluid and debris particle are updated using below equations 59 v i n 1 v i n 1 2 δ t d v i n d t 60 x i n 1 x i n δ t v i n 0 5 δ t 2 d v i n d t where n denotes the time steps to prevent the divergence of the integrated values the intermediate step is applied every n s steps n s 20 is suggested as follows 61 v i n 1 v i n δ t d v i n d t 62 x i n 1 x i n δ t v i n 0 5 δ t 2 d v i n d t where δ t is the time step interval for debris particles the acceleration d v d t is equivalent to x the variable time step δ t is used in this model due to the explicit nature of the scheme the time step must satisfy the courant friedrichs lewy cfl condition toro 2001 63 δ t c c f l min δ t f v δ t f a δ t d v δ t d a where δ t f v min i 1 n f h i c i v i δ t f a min i 1 n f h i d v i d t δ t d v min i 1 n d 2 r d i x i and δ t d a min i 1 n d 2 r d i x i where c c f l is the courant number which value usually range between 0 1 0 2 in this study δ t f v δ t f a δ t d v and δ t d a are the time step limit based on fluid velocity fluid acceleration debris velocity and debris acceleration respectively when simulating real world flooding problems the debris size may be significantly smaller than the fluid particle size in this case the last two conditions in 63 which are based on debris diameter 2 r d must be used for limiting the time step otherwise the debris may move too far in one time step and fail to detect the collisions that may occur during the corresponding time interval 5 results and validations 5 1 flow model validations 5 1 1 parma dam break with obstacle fig 7 show the experimental setup plan view of dam break test case at parma university conducted by aureli et al 2011 a rectangular tank of 1 2 m wide and 2 6 m long is divided into two parts by a 0 025 m thick of a wall at position 0 8 m away from one end the reservoir is located from x 0 m to x 0 8 m whilst the initially dry area is located from x 0 8 m to x 2 6 m the initial water depth at the reservoir for this test case is 0 063 m the wall height is 0 35 m whilst the flooding area is initially dry a 0 3 m wide upward sliding gate is located in the middle of the dividing wall and is moved using a pneumatic piston to release the water in the reservoir the door opens at a speed of 0 3 m 0 08 s additionally a non submersible rectangular obstacle of 0 15 m long and 0 3 m wide is placed in front of the gate such that its bottom left coordinate is 1 35 0 34 m in the experiment the time series of the water depth during the dam break at several locations are recorded using piezoelectric ultrasonic distance meters banner s18u placed on the support beams at the top of the flume the data acquisition was triggered by the gate opening the gauges position is shown in fig 7 p1 to p5 and their coordinates are provided in table 1 the experimental results are then compared against the numerical result for validation the simulation is run with three initial particle spacings i e d p 0 025 0 0125 and 0 00625 m the manning coefficient applied is n 0 007 s m 1 3 which is obtained by calibrating the experimental results in fig 8 the plan view of numerical d p 0 00625 m and experimental water depth are plotted at different instants t 1 55 2 35 and 4 0 s the sph particles are rendered as squares representing their base area where the size changes in time therefore it is shown that the particle size increases as it propagates towards the shallower region the numerical plot also shows general agreement compared to the photo of the experiment where the flow consists of interacting surface wave fronts in fig 9 the time series of the water depth at the location of the gauges is plotted to compare the numerical results using three different initial particle spacings d p 0 025 0 0125 and 0 00625 m against the experimental data in general the results are in good agreement and converges with the particles resolution to quantitatively measure the overall accuracy of the model two statistical parameters are analysed i e amplitude a s t a t and phase p s t a t which are respectively formulated as gomez gesteira et al 2010 64 a s t a t t 1 n t d t 2 t 1 n t d t e x p 2 and 65 p s t a t t 1 n t d t d t e x p 2 t 1 n t d t e x p 2 where t is the time step n t is the total number of time steps d t is the numerical water depth at time step t and d t e x p is the experiment measured depth at time t a perfect agreement will give a s t a t 1 and p s t a t 0 the statistical parameters a s t a t and p s t a t are calculated for all points of measurement and the results of analysis are plotted in fig 10 the a s t a t values are shown to be close to unity and the p s t a t values are approaching zero with the exception of p2 which shows clear convergence fig 10 shows approximately constant and converged agreement as d p varies 5 1 2 1993 okushiri tsunami this is a benchmark test for tsunami run up models which is a 1 400 scale laboratory experiment of the tsunami event at the village of monai in okushiri island carried out at central research institute for electric power industry criepi in abiko japan by matsuyama and tanaka 2001 the experimental datasets are available at the third international workshop on long wave run up models website 1 1 http isec nacse org workshop 2004 cornell bmark2 html the experiment was not intended to simulate the real tsunami that happened in 1993 however the measurement results can be used as a validation case for any numerical model the challenges in simulating this case include the complex bathymetry with relatively large surface gradient the moving wet dry interface reflective wall and generating the tsunami using open boundary conditions the bathymetry data of the model is plotted in fig 11 the domain is bounded by the reflective vertical wall except on the left hand side along x 0 m of the domain where the incident wave from offshore is recorded in the experiment the wave was generated by a piston type wave paddle located at around x 200 m the recorded water surface elevation at x 0 m which is shown in fig 12 is later used as input data for open boundary conditions in the numerical model in this work we impose water depth time series data at the inlet instead of water surface elevation therefore the water surface elevation data is converted into water depth that is shown in the secondary axis of the graph in fig 12 three gauges were located at different locations near the coastal line denoted as p1 p2 and p3 in fig 11 and their coordinates are given in table 2 the water surface elevation recorded by those gauges is later compared with the numerical results for validation in the pre processing of the numerical model the manning coefficient was set equal to 0 025 s m 1 3 the simulation was run three times with different initial particle spacing d p 0 05 0 025 and 0 0125 m which respectively contain 7 579 30 128 and 120 174 fluid particles at the beginning of simulations figs 13 and 14 show the instants of the simulation result with d p 0 0125 m at times t 0 12 60 14 45 16 80 18 and 19 50 s in 3 d view on the left hand side and plan view near the shoreline on the right hand side the first row of figures shows the initial state of the simulation prior to the arrival of a tsunami wave the water surface at the open boundary initially decreases which causes the water to recede at t 12 60 s the wave has started to propagate towards the coast whilst the water near the shoreline is still receding indicated by the dry ridge behind the island that was initially submerged the wave has passed the muen island at t 14 45 s and the diffraction by the island can be observed the maximum run up in a small valley is obtained at t 16 80 s and it reaches up to 0 066 m or equivalent to 26 4 m in the actual scale from the field observation after the real tsunami event it was found that the maximum run up was around 32 m the numerical result underestimation may be caused by the small scale topography that the numerical model cannot capture in the next snapshots in fig 14 the wave has been reflected towards the sea by the steep land and vertical wall and at t 14 45 s the reflected wave almost completely submerges the muen island the time history of the water surface elevation at the wave gauge points p1 p2 and p3 are plotted in fig 15 comparing the experimental measurements against the swe sph results with three different particle spacings in general the model is able to replicate the wave dynamics in the experiment with a good agreement even when using the coarsest particle resolution the finer particle resolution helps capture the shock or steep waves the results are comparable to the same swe sph model presented by vacondio et al 2012c in fact the simulation in this paper produces less instability during the stable condition until the water starts receding t 0 12 s due to the advanced refilling mode for the buffer zone of the open boundary this refilling mode keeps the buffer zone filled with particles which is beneficial for reverse flow such as in this tsunami case the model is capable of simulating the tsunami generation and propagation on an irregular bathymetry very accurately there is no special treatment needed when predicting temporal and spatial changes of the shoreline location due to the nature of the lagrangian sph method the water depth at the measurement points and the extreme run up in the small valley are also well predicted 5 2 debris model validations 5 2 1 debris in still water the debris in still water simulation is a simple test case to test the stability of the model especially over a long duration simulation a steady state condition is more challenging to maintain with a two way coupling method between the debris and fluid motion implemented in the model therefore this case will be used to test this aspect of the model i e the force balance the setup of the simulation is shown in fig 16 a 1 1 m2 tank is filled with water up to 0 2 m elevation a neutrally buoyant solid sphere with density equal to the fluid 1000 kg m3 and radius r d 0 01 m is located in the middle of the water the bed surface increases in height linearly from x 0 2 to x 0 8 m by 0 05 m the sloping bed surface is included in the simulation to challenge the model in maintaining stability and accuracy the particle spacing used is d p 0 05 m giving 360 fluid particles and the duration of simulation is 250 s the result of the simulation is shown in fig 17 where the time series of velocity in x direction of the debris and nearby fluid is plotted at the beginning of the simulation the water tends to move slightly to the left towards the negative x direction due to the numerical error and imbalance of the bed gradient source term and the internal force of the fluid particles this imbalance problem especially at discontinuous bed surface has been resolved previously by vacondio et al 2012b by introducing a mass correction in the continuity equation and interpolating the bed gradient source term using the fluid instead of the bed particles this error generates a small magnitude wave propagating to the left which is then reflected by the wall multiple reflections cause the left right oscillatory movement of the fluid particles hence the debris movement the velocity of the debris is almost identical to the fluid however the oscillation converges after around 20 s note that this oscillation is tiny and negligible at around 0 14 of the wave speed if we hold the debris movement at the first 50 s until the fluid is stable the debris velocity becomes closer to zero 5 2 2 debris hit by a dam break the experimental configuration and measurement result conducted by triatmadja et al 2014 is used here as a comparison source for validating the debris model in this study only the motion of the debris is discussed disregarding the debris impact force on the structure the configuration of the physical model is illustrated in fig 18 where a flume of 20 80 m long 0 6 m wide and 0 45 m high is divided by a quick release sluice gate at x 9 m the upstream part x 0 to 9 m is filled with water of three depth values 0 1 0 2 and 0 3 m in the downstream part which is initially dry a solid sphere with radius r d 2 2 cm and density equal to 2100 or 2910 kg m3 is located at position x 9 96 m following the experiment setup the water surge will flow downstream and hit the sphere debris when the gate is lifted the debris movement was then recorded using a video recorder from a lateral view of the flume at several locations as the flume wall was made of transparent glass the challenges in simulating this test case include initiating the debris movement from a dry bed surface by the rapidly varying water flow during this process the debris interacts with the bed surface while being dragged by the dam break water flow the debris is not always fully submerged during simulation especially for the initial dam break depth of 0 1 m which affects the force acting on the debris the simulation uses a particle spacing of 0 02 m giving 9 600 fluid particles in the simulation domain in the experiment the bottom of the flume was overlaid by oil painted plywood therefore the manning coefficient n 0 0125 s m 1 3 is used here the two way coupling of debris and water flow is used for all simulations the result of numerical simulation is plotted and compared with the experiment data of three different reservoir depths in fig 19 both graphs in fig 19 a for debris density ρ d 2910 kg m3 and fig 19 b for ρ d 2100 kg m3 show a close match between the numerical and experimental results however the numerical velocity is a little over predicted at the early movement of the debris to quantify the error the amplitude a s t a t and phase p s t a t parameters are calculated using 64 however the formulation is modified to sum the parameters over the debris travel distance instead of the simulation time the analysis is shown in fig 20 a for a s t a t and b for p s t a t the a s t a t values for all test variations is close to one and p s t a t values approach zero the most accurate result is for the case of reservoir depth equal to 0 3 m where the debris is mostly fully submerged during the simulation 5 2 3 debris in flow through channel with a smooth side obstacle another test case used for validation is the experiment by persi et al 2020 where a piece of wooden sphere debris was released in an open channel flow with a smooth obstacle attached to one side of the wall the layout of the experiment is shown in fig 21 a horizontal flume 3 25 m long and 0 24 m wide was fed with a constant water discharge of 15 3 m3 h a wooden sphere with diameter 0 042 m and density 694 kg m 3 was released manually at position x 1 3 m at half flume width from 0 02 m above the water surface the debris motion was recorded using a camera above the flume and image analysis software was used to track the debris trajectory the experiment was performed several times as the flow was not perfectly steady the debris trajectory may vary for each trial the initial particle resolution of the sph simulation is 0 0065 m giving initially 25 fluid particles across the flume width at the narrowing location and a total of 17744 particles in the domain the manning coefficient is set to 0 01 s m 1 3 representing the bed friction the no slip boundary condition is applied to the boundary particles we assume that the restitution coefficient for all interactions is 0 5 considering the wooded material of the sphere a constant discharge at the inlet is done by imposing velocity and depth the critical flow condition at the outlet is imposed by letting the fluid particles flow out of the domain at the edge of bathymetry data consistent with the experimental setup persi et al 2020 the fluid particles will be deleted once they leave the domain to determine the warm up duration until the flow is in a steady state condition a simulation without debris is performed in this case up to 120 s the average and maximum fluid velocity magnitude of all particles during simulation are plotted in fig 22 where the steady state condition is visually determined as being established after 25 s in this simulation the water surface at the debris release location is measured to define the debris elevation for the next simulation with debris it is placed 0 02 m above the water surface now the debris model is ready to be simulated the debris is initially located at the defined location and its motion is frozen during the warm up period before being released several simulations are done with slightly different release times to see how a slightly different flow field affects the overall debris trajectory the graph in fig 23 shows the simulation results where the numerical debris trajectories are compared with the experiment in general the numerical results are close to the experiment average trajectory black thick line and are in the range of upper and lower limit of the experiment trajectories denoted by dashed lines the deviation of experimental trajectories is significantly wider than the numerical the manual release method may caused this variation persi et al 2020 reported that the water level in the experiment was noticeably variable and the shallowest was downstream of the side obstacle where the debris was not able to float hence the sphere touched the bed surface and started rotating around its horizontal axis this behaviour is well captured by the sph model as shown in fig 24 from the side view however the sphere rotation is not directly modelled due to the one point representation for each piece of debris instead the rotation effect is represented as a friction coefficient additionally the maximum water velocity in the experiment was between 0 8 and 0 9 m s measured downstream of the side obstacle with which the sph model complies well 6 application for tsunami case this section demonstrates the behaviour of multiple pieces of debris in tsunami wave however there is no validation in this simulation the domain setup is the same as the 1993 okushiri tsunami simulation discussed in section 5 1 2 with additional 42 pieces of debris placed at several locations at elevation 0 m as shown in fig 25 the initial particle distance was 0 025 m the simulation was run twice with different debris densities i e ρ d 720 and 1600 kg m3 which represent wooden and coral stone debris respectively the experiments were conducted at 1 400 scale so the debris radius was set to 0 005 m or equivalent to 2 m on the actual scale the restitution coefficient ϵ 0 5 is assigned to the debris for all interactions the simulation results are provided in fig 26 showing the debris trajectories of the first run for ρ d 720 kg m3 a and b and the second run for ρ d 1600 kg m3 c and d the trajectories of the nearshore and offshore rows are plotted into two figures for clarity purpose the trajectory dots or lines when the debris motion is very slow are coloured based on the time of the simulation from black t 0 s to white t 30 s with a smooth gradation the simulations were able to capture the different behaviour of the neutrally buoyant debris and the debris heavier than water the debris tended to follow the water flow in the first simulation while oscillating at the water surface horizontally the debris initially stayed in place when the water was still the water then started to recede slightly before the generated tsunami wave propagated towards the land and so did the debris due to the relatively steep topography the wave was reflected instantly and dragged the debris back offshore in the second simulation the debris was heavier than water therefore the debris started sinking at the beginning of the simulation until it hit the bed surface after several bounces the debris then rolled down following the gradient of the bed surface the nearshore debris split into two groups due to the underwater ridge the tsunami wave drags the debris up towards the higher ground and then the rundown wave drags the debris further offshore 7 conclusions this paper presents a fully coupled 2 d swe sph flow model with 3 d spherical debris model for simulating floating and submerged debris transported by highly transient shallow flows such as tsunamis and flash floods the formulations are implemented in an open source highly efficient and parallelised sph software called dualsphysics initially developed for 3 d fluid simulation the dualsphysics software was initially converted into a swe sph model with additional new boundary conditions for solid walls and imposing inflow outflow to generate waves the debris module was then added with an equation of motion based on the modified version of the morison equation incorporating the collision algorithm the flow model is first tested against a dam break physical experiment conducted at parma university which involves irregular wall geometry close agreement of the time history of water depth at several locations is obtained between the experimental measurements and the numerical results next the physical experiment of the 1993 okushiri tsunami is used to examine the model s capability to generate waves using open boundary conditions the model accurately predicts the flow behaviour despite the complexity of the problem domain the stability of the debris model over a long duration simulation is tested using a still water test where neutrally buoyant debris is placed in the fluid body an insignificant disturbance is found at the beginning of the simulation due to the numerical error of the flow solver and the wall boundary condition which affects the debris movement however the debris motion decays rapidly the second debris test case assesses the debris movement initially static on a dry surface when a dam break flow surge hits it an excellent general agreement is achieved in this test another debris test uses a steady flow in a channel with a smooth side contraction even though the flow rate is constant unsteady flow is observed due to wake effects which affects the debris trajectories this is confirmed by the experimental observations a simulation of multiple floating debris is finally demonstrated using the 1992 okushiri tsunami domain configuration showing the complex debris motion and collision due to the tsunami wave the model shows potential to be an engineering tool for simulating real complex problems credit authorship contribution statement muhammad hafiz aslami conceptualization methodology software validation formal analysis visualization writing original draft writing review editing funding acquisition benedict d rogers supervision conceptualization methodology resources writing review editing project administration peter k stansby supervision conceptualization methodology resources writing review editing project administration andrea bottacin busolin supervision conceptualization methodology resources writing review editing project administration declaration of competing interest the authors declare the following financial interests personal relationships which may be considered as potential competing interests muhammad hafiz aslami reports financial support was provided by indonesia endowment fund for education lpdp acknowledgement the authors would like to thank indonesia endowment fund for education lpdp ministry of finance of the republic of indonesia for the phd scholarship agreement number prj 374 lpdp 3 2017 awarded to muhammad hafiz aslami 
81,many post tsunami field investigations affirm that the large floating debris transported by the flow contributes significantly to the destruction of on land buildings however few simulation tools have been developed to predict the debris behaviour under violent flow conditions involving complex debris fluid debris debris debris bed surface and debris wall solid structure interactions this paper introduces a fully coupled model of three dimensional 3 d debris motion in shallow water flow the model uses smoothed particle hydrodynamics sph to solve the shallow water equations swes and represents debris motion using the modified morison equation the discrete element method dem model is used for the collision mechanism the flow model is formulated based on the euler lagrange equations that provide the vertical component of velocity and can therefore be coupled with the 3 d debris motion a new solid boundary condition for shallow flows is introduced the open boundary condition is used for wave generation by imposing inflow and outflow in predetermined zones the sph solves the wet dry interface automatically the model is implemented in an open source software dualsphysics swe sph flow model is initially validated against experimental data followed by the debris model compared with an analytical solution and physical experiments which gives close agreement this model is expected to be a robust tool for predicting the hazards caused by extreme floodings such as tsunamis keywords debris tsunami simulation smoothed particle hydrodynamics shallow water equations dualsphysics data availability data will be made available on request 1 introduction the devastating effects of tsunamis are well known especially when involving the cumulative destruction effect by the tsunami driven debris a structure destroyed by debris becomes a new source of debris transported by the flow therefore predicting the debris movement from its initial source is important for risk mitigation the debris example that can be found at the initial source includes containers and vessels from ports and boulders near the coast a recent post tsunami field investigation by syamsidik et al 2020 in banten indonesia recorded that a boulder with nearly 3 m diameter was found to have been transported by the tsunami as far as 87 m from its original position due to the mount anak krakatau volcanogenic tsunami on 22 december 2018 mathematically predicting the debris movement which has chaotic nature in the violent water flow is difficult or near impossible therefore a numerical approach is preferable for solving this problem however it is still challenging to develop a computer program to model the debris movement of which the length scale is much smaller than the shallow flow domain such as tsunamis park and cox 2019 proposed a framework to quantify the amount and location of construction debris generated and advected from a multi hazard earthquake and tsunami event kameshwar et al 2021 developed a connectivity analysis methodology of the hazard damage debris transport and infrastructure connectivity to provide immediate post event information up to 72 h after the event however predicting the movement of the debris with a simulation model that includes the key physical process remains a challenge nistor et al 2017 behrens et al 2021 some simplifications are needed in the process the simulation of tsunami generation at the ocean bed to inundation of coastal regions has been in development for many years full 3 d simulations remains very expensive computationally for example qin et al 2018 proposed to use computational subdomains of the community region being simulated to capture the local flow characteristics in order to reduce computational domain once a tsunami is generated this is basically a long wave phenomenon with a wavelength much larger than depth this suggests that swes with hydrostatic pressure are appropriate and efficient particularly in depth averaged effectively two dimensional form mesh based methods have been widely used to solve the depth averaged equations such as tohoku university s numerical analysis model for investigation of near field tsunamis tunami goto et al 1997 cornell multigrid coupled tsunami model comcot wang 2009 method of splitting tsunami model most titov and gonzález 1997 etc all of which simulate tsunami generation in the ocean bed to inundation of coastal regions while they have been broadly successful special treatment is required for wetting and drying interfaces with either adaptive meshing or a large domain to cover a potential inundation area herein we apply the lagrangian particle based smoothed particle hydrodynamics sph method to the depth averaged model which automatically solves the wet dry front without any special numerical treatment the computational cost of the depth averaged solver is much less compared to the full 3 d models it also has the advantage of an approximation for vertical velocity not available with mesh based methods this is useful for debris transport modelling which is the aim of this paper sph which was initially developed for astrophysics simulations gingold and monaghan 1977 lucy 1977 has been widely used in solving water related engineering problems since the first attempt by monaghan 1994 for simulating free surface flows with the recent advancements in sph theory and parallelisation techniques utilising the graphics processing unit gpu technology the sph method has become more convincing and reliable violeau and rogers 2016 the sph method was first used to solve the swes by ata and soulaïmani 2005 and rodriguez paz and bonet 2005 for a large horizontal scale simulations further advancements were then developed such as shock capturing vacondio et al 2012a variable resolution with dynamic particle splitting and coalescing vacondio et al 2013 boundary condition for solid wall vacondio et al 2011 open boundary conditions vacondio et al 2012c and hardware acceleration wu et al 2020 xia and liang 2016 there are free and open source shallow water equations sph swe sph solvers available now wu et al 2020 vacondio et al 2012c however we utilise the efficient dualsphysics domínguez et al 2021 code for implementing a parallelised version of the shallow flow model the main contribution however lies in the incorporation of debris transport which is assumed to be small enough to be represented by a simple force formulation known as the morison equation morison et al 1950 including empirical drag and added mass coefficients this assumes that the body is small enough for the local flow to be assumed uniform that is the spatial flow variation is very small in relation to body dimension the alternative option of completely resolving the flow around the body would be computationally prohibitive the debris may be floating or fully and partially immersed with or without sliding on the bed when sliding there is an additional friction coefficient defining the retardation force and a coefficient of restitution defining normal velocity reversal when impacting the bed the number of debris elements may be large and may collide with each other involving further coefficients while the fluid exerts a force on the debris the debris exerts an equal and opposite force on the fluid according to newton s law consistent with a two way coupling formulation the validity of this approach is demonstrated by several test cases first without debris a dam break through a small opening by aureli et al 2011 and the okushiri 1993 tsunami case by matsuyama and tanaka 2001 then with debris represented as solid spheres sphere impacted by a dam break and in a flow through a channel with a smooth contraction and expansion the paper is structured into three parts 1 the variational formulation of the depth averaged flow model in sph form 2 coupling of the debris motion with the depth averaged flow model and 3 validation of the flow and debris models 2 sph shallow water flow model this section presents the governing equations of the depth integrated flow model in continuous form followed by the numerical formulation using the sph method in this study the variational formulation for swe by rodriguez paz and bonet 2005 is implemented together with the stabilisation technique by ata and soulaïmani 2005 and monotone upstream centred schemes for conservation laws muscl reconstruction van leer 1979 of the fluid velocity 2 1 shallow water equations swe in lagrangian form the depth integrated equations of mass and momentum conservation are written as 1 d d d t d v 2 d v d t g d g b s f γ d where d is the water depth as illustrated in fig 1 v is the depth averaged velocity vector in horizontal coordinate g 9 81 m s 2 is the gravitational acceleration b is the bed elevation and s f is the bed friction source term γ is the viscosity term and d is the force contribution from the floating debris if we redefine the density ρ as the amount of fluid mass per unit area of the water column in a two dimensional 2 d horizontal domain 1 and 2 above will be similar to the euler equations apart from the additional source terms this makes the software development of the existing standard sph solvers easier as density ρ is a commonly used variable in the formulation by assuming that the fluid is incompressible the density ρ and water depth d are linearly related as 3 ρ ρ w d where ρ w is the constant 3 d density ρ w 1000 kg m3 for water substituting 3 into 1 and 2 the swes can be written as 4 d ρ d t ρ v 5 d v d t g ρ w ρ g b s f γ d 2 2 momentum equation fig 1 shows the representation of fluid in the computation domain initially in a 2 d cartesian coordinate we have the bathymetry data b x y in 2 d horizontal coordinates which is fixed in time a 2 d cartesian coordinate system is used for the hydrodynamics model on top of the bed surface the fluid body is discretised as a set of lagrangian particles representing a column of water each fluid particle has a mass m which is constant in time bed elevation b depth d position x x y and depth averaged velocity vector v v x v y based on the variational formulation by rodriguez paz and bonet 2005 the acceleration of the i th fluid particle d v i d t with the inclusion of dissipative terms is computed using below equation 6 d v i d t t i g v i k i v i t i b i 1 b i b i b i s f i γ i d i where g 9 81 m s 2 is the gravitational acceleration t i t i m i 7 t i j 1 n m i m j g 2 ρ w 1 α j w j x i h j 1 α i w i x j h i and 8 α i 1 ρ i d m j m j r i j d w i j d r i j where the subscript j denotes the value of neighbour particles n is the number of neighbours ρ w 1000 kg m 3 is the 3 d density of the fluid α i is the correction factor due to the variable smoothing length r i j is the distance between particle i and j d m is the dimension 1 for one dimensional 1 d domain and 2 for 2 d ρ i is the density w i j is the kernel weighting function w i x j h i is the kernel gradient and h i is the smoothing length of the i th particle for the kernel function the fifth order wendland kernel wendland 1995 is used in this study 2 2 1 bed gradient and bed friction source term to treat the irregular bathymetry or bed profile a new set of fixed particles are introduced at the beginning of the simulation distributed in a uniform grid following the work of vacondio et al 2011 those bed particles carry the data of bed surface elevation and manning coefficient which are then used to approximate the bed gradient b i using the sph approximation with a correction method by bonet and lok 1999 and to interpolate the bed curvature tensor k i b i using the integral approximation by cleary and monaghan 1999 monaghan 2005 in a similar manner the bed particles are also used to interpolate the manning coefficient n i using the scatter sph summation with a shepard filter randles and libersky 1996 which is then needed when computing the bed friction source term s f i below 9 s f i g n i 2 v i v i d i 4 3 2 2 2 turbulent diffusion term the turbulent diffusion term γ i has two components a term representing dispersion due to vertical shear originally due to elder 1959 and a diffusion term due to turbulent processes dalrymple and rogers 2006 10 γ i ν t 2 v i 1 ρ τ i the velocity laplacian in a discrete form is morris et al 1997 lo and shao 2002 11 ν t 2 v i j m j 4 ν t x i j w i j ρ i ρ j r i j 2 η 2 v i j where x i j x i x j v i j v i v j r i j x i x j η 0 1 h i h j 2 and 12 w i j 0 5 w i x j h i w j x i h j ν t is the depth averaged eddy viscosity coefficient described as 13 ν t d u d i where d is the mixing coefficient usually between 0 1 and 3 and u is the shear velocity 14 u τ b ρ w n i 2 g d i 1 3 v i v i we use a mixing coefficient d 0 3 for all test cases presented in section 5 considering a moderate mixing intensity the horizontal shear in the flow is represented as sub particle scale sps turbulent model which uses the large eddy simulation les approach described by dalrymple and rogers 2006 as written below 15 1 ρ τ i j m j τ i τ j ρ i ρ j i w i j the sps stress tensor horizontal shear stress τ i is given by 16 τ ρ 2 c s δ 2 s τ 1 3 τ δ 2 3 c l δ 2 δ s 2 where c s 0 12 is the smagorinsky constant c l 0 0066 δ is the initial particle spacing s is the local strain rate tensor and s 2 s s 0 5 and δ is the kronecker delta the last term in the momentum eq 5 i e the floating debris force d i will be described later in section 3 6 2 3 continuity equation since the mass of each fluid particle remains constant to account for the change of a particle s water depth the volume and hence smoothing length of particle must change in the sph form with variable smoothing length the density of the i th particle is approximated as follows 17 ρ i j m j w i x j h i the density ρ or depth d may vary significantly during the simulation especially when the fluid is expanding or compressing to get an accurate value an approximately constant number of neighbouring particles must be maintained by adjusting the smoothing length following benz 1990 18 h i h i 0 ρ i 0 ρ i 1 d m where ρ i 0 and h i 0 are the density and smoothing length of the i th particle at the beginning of simulation eqs 17 and 18 are implicit therefore they are solved iteratively using newton raphson iteration method as described in rodriguez paz and bonet 2005 once the converged values of ρ i and h i are found the water depth is updated as d i ρ i ρ w additionally due to the incompressible fluid assumption the area of particle v i equivalent to volume in 3 d sph is also changed following v i m i ρ i to keep the volume of fluid column constant 2 4 boundary conditions for the wall boundary a set of wall boundary particles wbps are introduced at the beginning of the simulation distributed in a uniform grid filling the wall geometry shape the wbps carry the same information as the fluid particles such as mass m density ρ and depth d when calculating the fluid momentum eq 6 and continuity eq 17 the wbps are considered as neighbours and contribute to the calculation the density of the i th wbp ρ i is extrapolated only from the surrounding fluid particles using sph interpolation 19 ρ i j fluid ρ j w i x j h j v j where w i x j h j w i x j h j j fluid w i x j h j is the corrected kernel using the shepard filter randles and libersky 1996 and v j is the particle s horizontal area once the density of all wbps has been obtained we can then compute their depth d i ρ i ρ w and mass m i ρ i v i please note that in 19 we use the smoothing length of the neighbouring particles h j which is usually referred to as the scatter sph formulation the scatter formulation is used here to make sure that every wbp located in the fluid s kernel radius has the required values for computation additionally the boundary particles can be in a fixed position or moved according to a predefined motion this boundary condition works similar to the dummy particles method in adami et al 2012 keeping its advantages such as being easy to set up efficient and robust for complex wall geometries 2 4 1 no slip boundary condition the no slip boundary condition can be enforced by firstly extrapolating the fluid velocity field to the wbp 20 v i j fluid v j w i x j h j v j the velocity value of the wbp are then 21 v i 2 v i v i where v i is the predefined wall velocity 2 4 2 slip boundary condition for slip boundary condition the wbp tangential velocity is set to be equal to the extrapolated velocity from the fluid region v i while the normal velocity is mirrored following the same eq 21 to prevent fluid particle penetration into the wall to determine the normal and tangential velocity special treatment is needed by initially calculating the normal and tangential unit vector of each wbp using the particle concentration gradient the normal unit vector of the i th wbp is n ˆ w i n w x n w y i is 22 n ˆ w i x c i c i y c i c i where c i is the concentration gradient of wbp calculated using renormalised sph gradient estimation proposed by bonet and lok 1999 23 c i j wall l x i w i x j h i v j where l x i is the kernel gradient correction matrix 24 l x i j x j x i w i j x v j j x j x i w i j y v j j y j y i w i j x v j j y j y i w i j y v j 1 note that the simplification w i j w i x j h i and j wall in this particular equation by using the kernel gradient correction renormalisation more accurate normal unit vectors can be obtained especially around the wall with sharp edge the tangential unit vector t w i t w x t w y i is then 25 t ˆ w i n w y n w x i for the sake of efficient computation we can compute n ˆ w and t ˆ w only once at the beginning of simulation as long as there is no change of wall shape e g when some part of the wall are moving while the rest are steady the normal and tangential velocities of the wbp can be computed respectively as 26 v n i 2 v i n ˆ w i v i n ˆ w i 27 v t i v i t ˆ w i finally the velocity value of wbp is obtained by projecting the normal and tangential velocity back to the original coordinate system 28 v x v y i n w x t w x n w y t w y i v n v t i 2 4 3 open boundary particle obp for the open boundary condition inflow and outflow the formulation based on characteristics method proposed by vacondio et al 2012c is implemented by defining a buffer zone filled with open boundary particles obps the depth and or velocity of the obp are imposed or following the characteristic riemann invariants calculated from extrapolated values of nearby fluid particles these obp are later included in the sph summation for calculating the fluid acceleration and density hence depth 3 debris model 3 1 general assumptions of the debris model fig 2 illustrates the representation of a floating debris in shallow water flow several assumptions are made in the derivation of formulations and are listed below 1 each debris is represented as a single computation point with position x x x x y x z velocity x x x x y x z and acceleration x x x x y x z therefore the debris rotational effect is ignored in the formulation this assumption is valid when the velocity field across the debris body is nearly uniform i e when the length scale of the velocity variation in space is much larger than the debris size thus is suitable for application to tsunami flooding however it may not be as accurate when it is located at the hydraulic jump or at the location of tsunami breaking wave for cases where the rotational effect is strong such as a wood log transported by a river flow the debris object can be discretised into multiple points as proposed by ruiz villanueva et al 2014 and persi et al 2018 2 the debris shape is simplified as a solid sphere with radius r d hence the volume v d 4 3 π r d 3 and mass m d ρ d v d where ρ d is the mass density of the solid debris the complex hydrodynamic force around the debris is simplified as an approximation based on the depth averaged flow field at the centre of mass of the debris and the empirical coefficients are determined from the experiments this empirical coefficient is a function of relative reynolds number r e and depends on the shape of the debris 3 the debris is subjected to hydrostatic pressure distribution hence the buoyancy force is applied based on archimedes principle 4 the debris particle experiences 3 d motion 5 the debris can interact with other debris with the bed surface and with the solid wall boundary the collision response is predicted using the simplified mass spring damping effect represented by a restitution coefficient 6 the debris motion is coupled with the shallow water flow model using the two way coupling method 3 2 debris equation of motion the debris motion is computed by solving newton s second law of motion 29 x f n e t m d where f n e t f x f y f z is the net force working on the debris the net force consists of three components 30 f n e t f m f w f b where f m is hydrodynamic force f w is the debris weight and f b is the buoyancy force the hydrodynamic force f m is computed using the morison equation morison et al 1950 31 f m 0 5 ρ w a s c d v x v x ρ w v s a ρ w v s c a a x where a s and v s are respectively the submerged area facing the fluid flow and the submerged volume of the debris v v x v y v z and a a x a y a z are the interpolated fluid velocity and acceleration at the debris position c d is the drag coefficient and c a is the added mass coefficient note that in the numerical scheme we use the value of a and x from the previous time step because their current values are unknown this is possible due to a very small time step applied if the debris is not submerged in the fluid a s and v s will be zero hence the total hydrodynamic forces will be automatically zero the scatter sph interpolation procedure to approximate v and a in 31 is the same as in 20 in order to avoid overestimation when there are limited fluid particles in the kernel radius the shepard filter is applied only if the correction denominator value j fluid w i x j h j 0 5 it was observed that in the case of a piece of debris resting on a dry surface being approached by a wave surge the debris tended to start moving before the fluid particles reached the debris which is unphysical this happens once the debris detects a fluid particle when the debris is in the smoothing radius of the fluid the shepard filter will overestimate the fluid velocity and acceleration at the debris position therefore a threshold is set here to activate the shepard correction the interpolated fluid vertical velocity v z and acceleration a z for computing the vertical hydrodynamic force in 31 are computed using below equations 32 v z b x v x b y v y 33 a z b x a x b y a y in the sph formulation of the shallow water equations the water columns between the bed surface and the free surface are represented as fluid particles variations of bed elevation result in non zero vertical velocities and accelerations of a fluid particle the formulation in 31 can be used for general shape of floating debris different debris shapes will have different values of c d and c a in this study the debris is assumed to be a solid sphere due to its simplicity and availability of the c d and c a values from published literatures however for the real application this approach can be expanded to other different shapes of debris to mimic the real incident where the debris shape may vary for a solid sphere the c a value is 0 5 whilst the drag coefficient c d is a function of reynolds number r e schiller and naumann 1935 34 c d 24 r e 1 0 15 r e 0 687 r e 1000 0 44 r e 1000 and r e is computed using below formula 35 r e ρ w 2 r d v x μ where μ 1 002 1 0 3 n s m 2 is the dynamic viscosity of the fluid at temperature 2 0 c the debris weight f w and the buoyancy force f b are calculated as follows 36 f w 0 0 m d g 37 f b 0 0 ρ w v s g 3 3 debris interaction with bed surface when the debris is touching the bed surface as illustrated in fig 3 the debris is assumed to be purely rolling which creates an additional resistance force from interaction with fluid and bed surface note that this assumption is made to define the drag and friction coefficient representing the rolling effect however the model only considers the translation motion of the debris to accommodate this resistance force the following drag coefficient c d formulation proposed by jan and shen 1995 below is applied instead of 34 38 c d 281 r e r e 12 1 31 336 r e 811 r e 2 r e 12 the comparison of c d values based on 34 and 38 are plotted in fig 4 fig 3 show the diagram of debris interacting with the bed surface the debris is determined as touching the bed surface if x z b r d 1 b x 2 b y 2 when the debris touches the bed surface the debris motion eq 29 is changed to 39 x f n e t m d where the f n e t is the total force working on the debris with inclusion of the bed friction force f f the friction force f f is calculated using the following equation 40 f f μ f n f ˆ where μ f is the friction coefficient n is the magnitude of the reaction force from the bed surface in the normal direction and f ˆ is the unit vector of rolling direction the minus sign in this equation ensures that the friction force is facing the opposite side of the rolling direction the normal force magnitude n is calculated as follows 41 n f n e t n ˆ b where n ˆ b is the normal unit vector of the bed surface at the debris touching point the bed gradient at the debris touching point is used to compute the n ˆ b value as 42 n ˆ b n b n b where n b b x b y 1 if n 0 the friction force f f is ignored in the equation of motion hence the equations hereinafter are not necessary the friction coefficient μ f for a purely rolling no slip solid sphere can be calculated as follows 43 μ f 2 7 f n e t f ˆ n where 44 f ˆ x x x x y x x z x and x z x x b x x y b y substituting 43 and 41 into 40 we get the final formulation for the friction force 45 f f 2 7 f n e t f ˆ f ˆ in addition we have to reflect the debris velocity normal to the bed surface to account for the bouncing phenomenon the new debris velocity becomes 46 x n e w x 1 ϵ b x n ˆ b n ˆ b where ϵ b is the elasticity or restitution coefficient whose value is between 0 and 1 the restitution coefficient is an empirical constant representing the ratio of relative velocity between two objects after and before a collision which in this case is between debris and bed surface the value can be defined through an experimental testing the collision is perfectly inelastic when ϵ 0 lastly the debris position is slightly shifted vertically to prevent penetration by updating its vertical position x z b r d 3 4 debris debris collision when we have more than one debris in the simulation domain they may collide with each other fig 5 shows the illustration of collision between two debris debris i and debris j we use the same size for all debris in this study therefore the collision can be detected when the distance between 2 debris centres is less than the sum of their radius 47 x j x i 2 r d when the collision is detected the collision response is applied according to the conservation laws initially the normal direction between debris n ˆ d is calculated using the equation below 48 n ˆ d x j x i x j x i after that we compute the relative velocity magnitude in that normal direction x n 49 x n x j x i n ˆ d the post collision velocities of both debris are then reflected following equations below 50 x i n e w x i 0 5 1 ϵ d x n n ˆ d 51 x j n e w x j 0 5 1 ϵ d x n n ˆ d where ϵ d is the restitution coefficient for debris debris interaction representing the combined effect of the mass spring damper connection between each sphere for the soft sphere collision approach in the dem method canelas et al 2016 2017 to prevent the penetration between debris their positions are shifted away from each other according to the penetration depth p d between two sphere debris 52 x i n e w x i 0 5 p d n ˆ d 53 x j n e w x j 0 5 p d n ˆ d where p d 2 r d x j x i 3 5 debris wall collision fig 6 shows the illustration of debris interaction with the wbp using the same wall particles for both fluid and debris is more convenient in the programming process without having to introduce a new type of boundary condition for the debris in addition the general and complex wall geometries implementation is straightforward the debris wall collision is detected by computing the boundary particles concentration at the i th debris position c i by means of an sph scatter summation 54 c i j wall w i x j h j v j theoretically if the debris is fully surrounded by the boundary particles in the kernel radius the value of c i 1 therefore it is reasonable to set c i between 0 4 and 0 5 as a collision detection in this work c i 0 5 is used this approach does not use the debris radius for the collision detection because the exact wall surface location is not explicitly defined in the boundary condition method implemented in this model however considering the simulation domain is relatively large and small possibilities for the debris to hit the wall this approach is considered acceptable the post collision velocity of the debris is updated in a similar way to the debris debris collision as follows 55 x i n e w x i 1 ϵ w x i n ˆ w n ˆ w where n ˆ w is the normal unit vector pointing out of the wall surface and ϵ w is the restitution coefficient of debris wall collision we can compute n ˆ w by using the concentration gradient of the wall particles at the i th debris position c i 56 n ˆ w x c i c i y c i c i 0 where 57 c i j wall l x i w i x j h j v j 3 6 debris fluid two way coupling the two way coupling between debris and fluid is formulated based on the action reaction principle as explained in section 3 2 the hydrodynamic force acting on the debris f n e t m d x is calculated from the surrounding fluid particles by interpolating the fluid velocity and acceleration at the debris position using the sph approximation as a reaction the force f n e t is distributed back to the relevant fluid particles in the opposite direction to ensure the conservation of momentum the force from the sphere debris acting on the fluid column causes the fluid column to move the force distribution is calculated according to the weighting kernel function between debris and neighbouring fluid therefore the fluid particle nearer to the debris will receive a larger contribution of the total force and the fluid particles outside the compact support will have zero effect the debris force contribution to the i th fluid particle d i in 6 is then given by 58 d i 1 m i j debris m d x j w x j x i max h i 2 r d v i the coupling is only applied in the horizontal direction because it is impossible to explicitly apply a vertical force on the fluid column nevertheless if the bed is not horizontal there is still a horizontal force acting on the fluid particle as the fluid particle slides on the bed surface following its contour additionally the reaction force acting on the fluid column does not deform the fluid column instead the force is transformed into rigid motion of the fluid column the extent of debris force redistribution is denoted by the defined smoothing length when the fluid resolution is too high relative to the debris size instability or explosion may occur due to the large debris force being distributed to small number of fluid particles therefore in 58 the smoothing length is modified to max h i 2 r d to avoid instability 4 time integration we use the velocity verlet time integration scheme in this model verlet 1967 which is low in computational cost and is second order accurate without having to calculate multiple steps within a time interval the variables of i th fluid and debris particle are updated using below equations 59 v i n 1 v i n 1 2 δ t d v i n d t 60 x i n 1 x i n δ t v i n 0 5 δ t 2 d v i n d t where n denotes the time steps to prevent the divergence of the integrated values the intermediate step is applied every n s steps n s 20 is suggested as follows 61 v i n 1 v i n δ t d v i n d t 62 x i n 1 x i n δ t v i n 0 5 δ t 2 d v i n d t where δ t is the time step interval for debris particles the acceleration d v d t is equivalent to x the variable time step δ t is used in this model due to the explicit nature of the scheme the time step must satisfy the courant friedrichs lewy cfl condition toro 2001 63 δ t c c f l min δ t f v δ t f a δ t d v δ t d a where δ t f v min i 1 n f h i c i v i δ t f a min i 1 n f h i d v i d t δ t d v min i 1 n d 2 r d i x i and δ t d a min i 1 n d 2 r d i x i where c c f l is the courant number which value usually range between 0 1 0 2 in this study δ t f v δ t f a δ t d v and δ t d a are the time step limit based on fluid velocity fluid acceleration debris velocity and debris acceleration respectively when simulating real world flooding problems the debris size may be significantly smaller than the fluid particle size in this case the last two conditions in 63 which are based on debris diameter 2 r d must be used for limiting the time step otherwise the debris may move too far in one time step and fail to detect the collisions that may occur during the corresponding time interval 5 results and validations 5 1 flow model validations 5 1 1 parma dam break with obstacle fig 7 show the experimental setup plan view of dam break test case at parma university conducted by aureli et al 2011 a rectangular tank of 1 2 m wide and 2 6 m long is divided into two parts by a 0 025 m thick of a wall at position 0 8 m away from one end the reservoir is located from x 0 m to x 0 8 m whilst the initially dry area is located from x 0 8 m to x 2 6 m the initial water depth at the reservoir for this test case is 0 063 m the wall height is 0 35 m whilst the flooding area is initially dry a 0 3 m wide upward sliding gate is located in the middle of the dividing wall and is moved using a pneumatic piston to release the water in the reservoir the door opens at a speed of 0 3 m 0 08 s additionally a non submersible rectangular obstacle of 0 15 m long and 0 3 m wide is placed in front of the gate such that its bottom left coordinate is 1 35 0 34 m in the experiment the time series of the water depth during the dam break at several locations are recorded using piezoelectric ultrasonic distance meters banner s18u placed on the support beams at the top of the flume the data acquisition was triggered by the gate opening the gauges position is shown in fig 7 p1 to p5 and their coordinates are provided in table 1 the experimental results are then compared against the numerical result for validation the simulation is run with three initial particle spacings i e d p 0 025 0 0125 and 0 00625 m the manning coefficient applied is n 0 007 s m 1 3 which is obtained by calibrating the experimental results in fig 8 the plan view of numerical d p 0 00625 m and experimental water depth are plotted at different instants t 1 55 2 35 and 4 0 s the sph particles are rendered as squares representing their base area where the size changes in time therefore it is shown that the particle size increases as it propagates towards the shallower region the numerical plot also shows general agreement compared to the photo of the experiment where the flow consists of interacting surface wave fronts in fig 9 the time series of the water depth at the location of the gauges is plotted to compare the numerical results using three different initial particle spacings d p 0 025 0 0125 and 0 00625 m against the experimental data in general the results are in good agreement and converges with the particles resolution to quantitatively measure the overall accuracy of the model two statistical parameters are analysed i e amplitude a s t a t and phase p s t a t which are respectively formulated as gomez gesteira et al 2010 64 a s t a t t 1 n t d t 2 t 1 n t d t e x p 2 and 65 p s t a t t 1 n t d t d t e x p 2 t 1 n t d t e x p 2 where t is the time step n t is the total number of time steps d t is the numerical water depth at time step t and d t e x p is the experiment measured depth at time t a perfect agreement will give a s t a t 1 and p s t a t 0 the statistical parameters a s t a t and p s t a t are calculated for all points of measurement and the results of analysis are plotted in fig 10 the a s t a t values are shown to be close to unity and the p s t a t values are approaching zero with the exception of p2 which shows clear convergence fig 10 shows approximately constant and converged agreement as d p varies 5 1 2 1993 okushiri tsunami this is a benchmark test for tsunami run up models which is a 1 400 scale laboratory experiment of the tsunami event at the village of monai in okushiri island carried out at central research institute for electric power industry criepi in abiko japan by matsuyama and tanaka 2001 the experimental datasets are available at the third international workshop on long wave run up models website 1 1 http isec nacse org workshop 2004 cornell bmark2 html the experiment was not intended to simulate the real tsunami that happened in 1993 however the measurement results can be used as a validation case for any numerical model the challenges in simulating this case include the complex bathymetry with relatively large surface gradient the moving wet dry interface reflective wall and generating the tsunami using open boundary conditions the bathymetry data of the model is plotted in fig 11 the domain is bounded by the reflective vertical wall except on the left hand side along x 0 m of the domain where the incident wave from offshore is recorded in the experiment the wave was generated by a piston type wave paddle located at around x 200 m the recorded water surface elevation at x 0 m which is shown in fig 12 is later used as input data for open boundary conditions in the numerical model in this work we impose water depth time series data at the inlet instead of water surface elevation therefore the water surface elevation data is converted into water depth that is shown in the secondary axis of the graph in fig 12 three gauges were located at different locations near the coastal line denoted as p1 p2 and p3 in fig 11 and their coordinates are given in table 2 the water surface elevation recorded by those gauges is later compared with the numerical results for validation in the pre processing of the numerical model the manning coefficient was set equal to 0 025 s m 1 3 the simulation was run three times with different initial particle spacing d p 0 05 0 025 and 0 0125 m which respectively contain 7 579 30 128 and 120 174 fluid particles at the beginning of simulations figs 13 and 14 show the instants of the simulation result with d p 0 0125 m at times t 0 12 60 14 45 16 80 18 and 19 50 s in 3 d view on the left hand side and plan view near the shoreline on the right hand side the first row of figures shows the initial state of the simulation prior to the arrival of a tsunami wave the water surface at the open boundary initially decreases which causes the water to recede at t 12 60 s the wave has started to propagate towards the coast whilst the water near the shoreline is still receding indicated by the dry ridge behind the island that was initially submerged the wave has passed the muen island at t 14 45 s and the diffraction by the island can be observed the maximum run up in a small valley is obtained at t 16 80 s and it reaches up to 0 066 m or equivalent to 26 4 m in the actual scale from the field observation after the real tsunami event it was found that the maximum run up was around 32 m the numerical result underestimation may be caused by the small scale topography that the numerical model cannot capture in the next snapshots in fig 14 the wave has been reflected towards the sea by the steep land and vertical wall and at t 14 45 s the reflected wave almost completely submerges the muen island the time history of the water surface elevation at the wave gauge points p1 p2 and p3 are plotted in fig 15 comparing the experimental measurements against the swe sph results with three different particle spacings in general the model is able to replicate the wave dynamics in the experiment with a good agreement even when using the coarsest particle resolution the finer particle resolution helps capture the shock or steep waves the results are comparable to the same swe sph model presented by vacondio et al 2012c in fact the simulation in this paper produces less instability during the stable condition until the water starts receding t 0 12 s due to the advanced refilling mode for the buffer zone of the open boundary this refilling mode keeps the buffer zone filled with particles which is beneficial for reverse flow such as in this tsunami case the model is capable of simulating the tsunami generation and propagation on an irregular bathymetry very accurately there is no special treatment needed when predicting temporal and spatial changes of the shoreline location due to the nature of the lagrangian sph method the water depth at the measurement points and the extreme run up in the small valley are also well predicted 5 2 debris model validations 5 2 1 debris in still water the debris in still water simulation is a simple test case to test the stability of the model especially over a long duration simulation a steady state condition is more challenging to maintain with a two way coupling method between the debris and fluid motion implemented in the model therefore this case will be used to test this aspect of the model i e the force balance the setup of the simulation is shown in fig 16 a 1 1 m2 tank is filled with water up to 0 2 m elevation a neutrally buoyant solid sphere with density equal to the fluid 1000 kg m3 and radius r d 0 01 m is located in the middle of the water the bed surface increases in height linearly from x 0 2 to x 0 8 m by 0 05 m the sloping bed surface is included in the simulation to challenge the model in maintaining stability and accuracy the particle spacing used is d p 0 05 m giving 360 fluid particles and the duration of simulation is 250 s the result of the simulation is shown in fig 17 where the time series of velocity in x direction of the debris and nearby fluid is plotted at the beginning of the simulation the water tends to move slightly to the left towards the negative x direction due to the numerical error and imbalance of the bed gradient source term and the internal force of the fluid particles this imbalance problem especially at discontinuous bed surface has been resolved previously by vacondio et al 2012b by introducing a mass correction in the continuity equation and interpolating the bed gradient source term using the fluid instead of the bed particles this error generates a small magnitude wave propagating to the left which is then reflected by the wall multiple reflections cause the left right oscillatory movement of the fluid particles hence the debris movement the velocity of the debris is almost identical to the fluid however the oscillation converges after around 20 s note that this oscillation is tiny and negligible at around 0 14 of the wave speed if we hold the debris movement at the first 50 s until the fluid is stable the debris velocity becomes closer to zero 5 2 2 debris hit by a dam break the experimental configuration and measurement result conducted by triatmadja et al 2014 is used here as a comparison source for validating the debris model in this study only the motion of the debris is discussed disregarding the debris impact force on the structure the configuration of the physical model is illustrated in fig 18 where a flume of 20 80 m long 0 6 m wide and 0 45 m high is divided by a quick release sluice gate at x 9 m the upstream part x 0 to 9 m is filled with water of three depth values 0 1 0 2 and 0 3 m in the downstream part which is initially dry a solid sphere with radius r d 2 2 cm and density equal to 2100 or 2910 kg m3 is located at position x 9 96 m following the experiment setup the water surge will flow downstream and hit the sphere debris when the gate is lifted the debris movement was then recorded using a video recorder from a lateral view of the flume at several locations as the flume wall was made of transparent glass the challenges in simulating this test case include initiating the debris movement from a dry bed surface by the rapidly varying water flow during this process the debris interacts with the bed surface while being dragged by the dam break water flow the debris is not always fully submerged during simulation especially for the initial dam break depth of 0 1 m which affects the force acting on the debris the simulation uses a particle spacing of 0 02 m giving 9 600 fluid particles in the simulation domain in the experiment the bottom of the flume was overlaid by oil painted plywood therefore the manning coefficient n 0 0125 s m 1 3 is used here the two way coupling of debris and water flow is used for all simulations the result of numerical simulation is plotted and compared with the experiment data of three different reservoir depths in fig 19 both graphs in fig 19 a for debris density ρ d 2910 kg m3 and fig 19 b for ρ d 2100 kg m3 show a close match between the numerical and experimental results however the numerical velocity is a little over predicted at the early movement of the debris to quantify the error the amplitude a s t a t and phase p s t a t parameters are calculated using 64 however the formulation is modified to sum the parameters over the debris travel distance instead of the simulation time the analysis is shown in fig 20 a for a s t a t and b for p s t a t the a s t a t values for all test variations is close to one and p s t a t values approach zero the most accurate result is for the case of reservoir depth equal to 0 3 m where the debris is mostly fully submerged during the simulation 5 2 3 debris in flow through channel with a smooth side obstacle another test case used for validation is the experiment by persi et al 2020 where a piece of wooden sphere debris was released in an open channel flow with a smooth obstacle attached to one side of the wall the layout of the experiment is shown in fig 21 a horizontal flume 3 25 m long and 0 24 m wide was fed with a constant water discharge of 15 3 m3 h a wooden sphere with diameter 0 042 m and density 694 kg m 3 was released manually at position x 1 3 m at half flume width from 0 02 m above the water surface the debris motion was recorded using a camera above the flume and image analysis software was used to track the debris trajectory the experiment was performed several times as the flow was not perfectly steady the debris trajectory may vary for each trial the initial particle resolution of the sph simulation is 0 0065 m giving initially 25 fluid particles across the flume width at the narrowing location and a total of 17744 particles in the domain the manning coefficient is set to 0 01 s m 1 3 representing the bed friction the no slip boundary condition is applied to the boundary particles we assume that the restitution coefficient for all interactions is 0 5 considering the wooded material of the sphere a constant discharge at the inlet is done by imposing velocity and depth the critical flow condition at the outlet is imposed by letting the fluid particles flow out of the domain at the edge of bathymetry data consistent with the experimental setup persi et al 2020 the fluid particles will be deleted once they leave the domain to determine the warm up duration until the flow is in a steady state condition a simulation without debris is performed in this case up to 120 s the average and maximum fluid velocity magnitude of all particles during simulation are plotted in fig 22 where the steady state condition is visually determined as being established after 25 s in this simulation the water surface at the debris release location is measured to define the debris elevation for the next simulation with debris it is placed 0 02 m above the water surface now the debris model is ready to be simulated the debris is initially located at the defined location and its motion is frozen during the warm up period before being released several simulations are done with slightly different release times to see how a slightly different flow field affects the overall debris trajectory the graph in fig 23 shows the simulation results where the numerical debris trajectories are compared with the experiment in general the numerical results are close to the experiment average trajectory black thick line and are in the range of upper and lower limit of the experiment trajectories denoted by dashed lines the deviation of experimental trajectories is significantly wider than the numerical the manual release method may caused this variation persi et al 2020 reported that the water level in the experiment was noticeably variable and the shallowest was downstream of the side obstacle where the debris was not able to float hence the sphere touched the bed surface and started rotating around its horizontal axis this behaviour is well captured by the sph model as shown in fig 24 from the side view however the sphere rotation is not directly modelled due to the one point representation for each piece of debris instead the rotation effect is represented as a friction coefficient additionally the maximum water velocity in the experiment was between 0 8 and 0 9 m s measured downstream of the side obstacle with which the sph model complies well 6 application for tsunami case this section demonstrates the behaviour of multiple pieces of debris in tsunami wave however there is no validation in this simulation the domain setup is the same as the 1993 okushiri tsunami simulation discussed in section 5 1 2 with additional 42 pieces of debris placed at several locations at elevation 0 m as shown in fig 25 the initial particle distance was 0 025 m the simulation was run twice with different debris densities i e ρ d 720 and 1600 kg m3 which represent wooden and coral stone debris respectively the experiments were conducted at 1 400 scale so the debris radius was set to 0 005 m or equivalent to 2 m on the actual scale the restitution coefficient ϵ 0 5 is assigned to the debris for all interactions the simulation results are provided in fig 26 showing the debris trajectories of the first run for ρ d 720 kg m3 a and b and the second run for ρ d 1600 kg m3 c and d the trajectories of the nearshore and offshore rows are plotted into two figures for clarity purpose the trajectory dots or lines when the debris motion is very slow are coloured based on the time of the simulation from black t 0 s to white t 30 s with a smooth gradation the simulations were able to capture the different behaviour of the neutrally buoyant debris and the debris heavier than water the debris tended to follow the water flow in the first simulation while oscillating at the water surface horizontally the debris initially stayed in place when the water was still the water then started to recede slightly before the generated tsunami wave propagated towards the land and so did the debris due to the relatively steep topography the wave was reflected instantly and dragged the debris back offshore in the second simulation the debris was heavier than water therefore the debris started sinking at the beginning of the simulation until it hit the bed surface after several bounces the debris then rolled down following the gradient of the bed surface the nearshore debris split into two groups due to the underwater ridge the tsunami wave drags the debris up towards the higher ground and then the rundown wave drags the debris further offshore 7 conclusions this paper presents a fully coupled 2 d swe sph flow model with 3 d spherical debris model for simulating floating and submerged debris transported by highly transient shallow flows such as tsunamis and flash floods the formulations are implemented in an open source highly efficient and parallelised sph software called dualsphysics initially developed for 3 d fluid simulation the dualsphysics software was initially converted into a swe sph model with additional new boundary conditions for solid walls and imposing inflow outflow to generate waves the debris module was then added with an equation of motion based on the modified version of the morison equation incorporating the collision algorithm the flow model is first tested against a dam break physical experiment conducted at parma university which involves irregular wall geometry close agreement of the time history of water depth at several locations is obtained between the experimental measurements and the numerical results next the physical experiment of the 1993 okushiri tsunami is used to examine the model s capability to generate waves using open boundary conditions the model accurately predicts the flow behaviour despite the complexity of the problem domain the stability of the debris model over a long duration simulation is tested using a still water test where neutrally buoyant debris is placed in the fluid body an insignificant disturbance is found at the beginning of the simulation due to the numerical error of the flow solver and the wall boundary condition which affects the debris movement however the debris motion decays rapidly the second debris test case assesses the debris movement initially static on a dry surface when a dam break flow surge hits it an excellent general agreement is achieved in this test another debris test uses a steady flow in a channel with a smooth side contraction even though the flow rate is constant unsteady flow is observed due to wake effects which affects the debris trajectories this is confirmed by the experimental observations a simulation of multiple floating debris is finally demonstrated using the 1992 okushiri tsunami domain configuration showing the complex debris motion and collision due to the tsunami wave the model shows potential to be an engineering tool for simulating real complex problems credit authorship contribution statement muhammad hafiz aslami conceptualization methodology software validation formal analysis visualization writing original draft writing review editing funding acquisition benedict d rogers supervision conceptualization methodology resources writing review editing project administration peter k stansby supervision conceptualization methodology resources writing review editing project administration andrea bottacin busolin supervision conceptualization methodology resources writing review editing project administration declaration of competing interest the authors declare the following financial interests personal relationships which may be considered as potential competing interests muhammad hafiz aslami reports financial support was provided by indonesia endowment fund for education lpdp acknowledgement the authors would like to thank indonesia endowment fund for education lpdp ministry of finance of the republic of indonesia for the phd scholarship agreement number prj 374 lpdp 3 2017 awarded to muhammad hafiz aslami 
82,a homogenization approach for the simulation of multi phase flows in heterogeneous porous media is presented it is based on the lattice boltzmann method and combines the grayscale with the multi component shan chen method thus it mimics fluid fluid and solid fluid interactions also within pores that are smaller than the numerical discretization the model is successfully tested for a broad variety of single and two phase flow problems additionally its application to multi scale and multi phase flow problems in porous media is demonstrated using the electrolyte filling process of realistic 3d lithium ion battery electrode microstructures as an example the approach presented here shows advantages over comparable methods from literature the interfacial tension and wetting conditions are independent and not affected by the homogenization moreover all physical properties studied here are continuous even across interfaces of porous media the method is consistent with the original multi component shan chen method mcsc it is as stable as the mcsc easy to implement and can be applied to many research fields especially where multi phase fluid flow occurs in heterogeneous and multi scale porous media keywords two phase flow transport in porous media darcy brinkman buckley leverett washburn shan chen data availability data will be made available on request 1 introduction fluid flow in porous media plays an important role in many technical and natural processes such as hydrogeology reservoir and process engineering electrochemical energy storage or medical applications most of these examples involve complex flow phenomena such as transport of solutes reactions or the interaction of multiple phases or immiscible fluid components kang et al 2007 dentz et al 2011 steefel et al 2005 baveye et al 2017 laubach et al 2019 yuan et al 2019 structures that are heterogeneous regarding their chemical composition and wetting properties dentz et al 2011 blunt et al 2013 laubach et al 2019 zhang et al 2020 and pore sizes that range from nanometers to the macroscale sok et al 2010 bai et al 2013 blunt et al 2013 zhang et al 2016 kang et al 2019 soulaine et al 2019 zhang et al 2020 mehmani et al 2020 thus and because most of the interesting physical phenomena happen on the pore scale they are hard to study experimentally sok et al 2010 kang et al 2002b dentz et al 2011 mehmani et al 2020 therefore in the literature often direct numerical simulations and more specifically the lattice boltzmann method lbm are used to conduct pore scale simulations lbm is a reliable tool for studying multi scale and multi physics transport processes within complex porous geometries krueger et al 2016 liu et al 2016 it has also been successfully applied to solve multi phase flows in high resolution real world image data of porous media samples that were recorded using x ray micro computed tomography μ ct or focused ion beam scanning electron microscopy fib sem sok et al 2010 blunt et al 2013 chen et al 2014 liu et al 2016 zhang et al 2016 baveye et al 2017 kang et al 2019 zhang et al 2020 mehmani et al 2020 unfortunately lbm is computationally expensive especially when simultaneously simulating flow in structurally resolved pores at different length scales therefore homogenization methods have been developed where the detailed structure of pores at the smallest length scale is ignored and instead the flow is described by a darcy brinkman type approach a volume average of the structurally resolved geometry is taken and its effects on fluid flow are mimicked as permeability related parameter these homogenization methods can be basically subdivided into two groups those are the brinkman force adjusted models bf spaid and phelan 1997 freed 1998 guo and zhao 2002 kang et al 2002b ginzburg 2008 gao et al 2014 ginzburg et al 2015 kang et al 2019 where a drag force is applied locally and the grayscale models gs dardis and mccloskey 1998 thorne and sukop 2004 chen and zhu 2008 walsh et al 2009 zhu and ma 2013 yoshida and hayashi 2014 yehya et al 2015 ginzburg et al 2015 ginzburg 2016 zhu and ma 2018 where flow populations are partially bounced back to mimic flow resistance although the aforementioned homogenization methods have been heavily discussed and further developed for single phase fluids chen and zhu 2008 walsh et al 2009 zhu and ma 2013 ginzburg et al 2015 ginzburg 2016 zhu and ma 2018 this is not the case for multi phase or multi component fluids only a few methods combining gs and multi phase physics mcdonald and turner 2016 zalzale et al 2016 lei and shi 2019 as well as methods combining other homogenization approaches with multi component physics ning et al 2019 an et al 2020 have been reported recently however despite the fact that the multi component shan chen method mcsc is most widely used for studying all kinds of immiscible fluids chen et al 2014 krueger et al 2016 only one homogenized method has been developed combining gs with mcsc pereira 2016 this method is however not fully consistent with the original mcsc regarding model parametrization and shows deficiencies with respect to discontinuities of properties in heterogeneous porous media therefore in the current paper a new approach is presented that follows the approach of pereira 2016 and combines gs by walsh et al gs wbs walsh et al 2009 with mcsc shan and chen 1993 it is therefore called the homogenized multi component shan chen method hmcsc in the following gs wbs is chosen as it is known to recover darcy brinkman flow conserves mass and allows an efficient computational parallelization as only local bounce back operations are performed mcsc uses a physically based approach to model fluid fluid and solid fluid interactions without the need for interface tracking it also achieves a good compromise between computational efficiency and physical reality and thus is widely adopted for modeling immiscible fluids chen et al 2014 krueger et al 2016 the hmcsc inherits all positive features from the aforementioned models but overcomes their deficiencies which are mainly related to the discontinuity of properties in heterogeneous porous media for example using hmcsc the interfacial tension and the wetting properties are constant and not affected by the homogenization thus especially the mcsc related model parameters can be chosen consistently to the original mcsc and no further parametrization is required besides similar to all other lbm homogenization approaches the hmcsc switches freely between free flow and darcy regime and can also be applied to study single phase flows as part of this paper the hmcsc was rigorously tested for a broad variety of single phase and two phase flow benchmark cases that are relevant in the context of porous media those were stokes brinkman darcy flow under couette and poiseuille conditions fluid flow in stratified heterogeneous porous media and partially porous channels as well as steady bubble tests and washburn type capillary flow it was also tested regarding its numerical stability and shown to be comparable to the original mcsc in addition it predicts buckley leverett waterflooding to some extent cf section si 3 in the supporting information the results were compared with analytical and semi analytical solutions where available finally the hmcsc was applied to a two phase flow issue of current research interest in the field of electrochemical energy storage the electrolyte filling of lithium ion battery microstructures with partially permeable nanoporous components however other research fields where multi phase fluid flow occurs in multi scale porous media can benefit from the new method too in the context of hydrology geoscience and petroleum engineering potential applications are the prediction of microbiologically affected groundwater flow ghezzehei 2012 hassannayebi et al 2021 geologic carbon storage or sequestration krevor et al 2012 mehmani and tchelepi 2018 and the recovery of oil dry natural gas or shale gas from tight gas sandstones mehmani et al 2015 2020 carbonates mehmani et al 2015 2020 and shale formations soulaine et al 2019 respectively this paper is organized as follows in section 2 the hmcsc is described in section 3 it is tested for a broad variety of benchmark cases and the corresponding results features of the approach and its numerical stability are discussed in section 4 the results of the electrolyte filling simulations in realistic and partially homogenized battery microstructures are presented finally conclusions are drawn in section 5 2 model the lbm fundamentals including the determination of macroscopic variables as well as the underlying methods are given in appendix a for further information especially regarding gs wbs and mcsc the reader is directed to the corresponding refs walsh et al 2009 shan and chen 1993 in the following only relevant parts that are necessary to understand the hmcsc are described the full declaration of notations is also given in appendix a the main equation of the hmcsc that combines the gs wbs homogenization approach walsh et al 2009 with the original mcsc and the shan chen forcing scheme shan and chen 1993 is 1 f i σ x c i δ t t δ t 1 n s σ x f i σ x t 1 n s σ x δ t τ σ f i σ x t f i σ eq x t n s σ x f i σ x t here f σ is the distribution function of the component σ f σ eq is the maxwell boltzmann equilibrium distribution function cf eq a 3 in the appendix and τ σ is the relaxation time the last term in eq 1 corresponds to the bounce back scheme the parameter n s σ comes from the homogenization approach originally it was called the solid fraction which is due to the intuitive interpretation of relating flow properties to the solid volume fraction in the following the same parameter is called the bounce back fraction to highlight its technical origin and to prevent a misinterpretation note that the bounce back fraction has to be chosen to retrieve the permeability and should be seen as a space dependent internal model parameter which is not necessarily directly proportional to the amount of solid material in a lattice cell its general relation to the permeability for a single phase fluid walsh et al 2009 is 2 k 1 n s 2 n s ν δ t similar to the mcsc shan and chen 1993 eq 1 is solved for each component σ involved in the multi phase flow thus all lattice cells are occupied by every component simultaneously a cell belonging to component σ is composed of the main component density ρ σ and the dissolved densities with ρ dis ρ σ the fluid fluid and solid fluid interactions are incorporated as interaction forces via f σ eq cf eq 6 they are physically motivated by a pseudopotential that similar to molecular dynamic simulations models molecular interactions to recover cohesion and adhesion e g in wetting or transport processes lautenschlaeger and hasse 2019b a diewald et al 2020 lautenschlaeger and hasse 2020 the separation of component σ by another component σ is driven by a fluid fluid interaction force f inter 3 f inter σ x ρ σ x g inter σ σ i w i ρ σ x c i δ t c i δ t where the interaction parameter g inter σ σ determines the strength of the cohesion the wettability or adhesion of the component σ at a solid wall is modeled with the solid fluid interaction force f ads σ 4 f ads σ x ρ σ x g ads σ i w i s x c i δ t c i δ t where the adhesion parameter g ads σ determines the wetting behavior and s is an indicator function which is s n s σ here it was shown by huang et al 2007 how g inter σ σ and g ads σ relate to the interfacial tension γ and the contact angle θ respectively it will be shown in section 3 that the same parametrization can be used for the hmcsc too which underlines its physical consistency with the original mcsc additional external forces f ext which act on all components such as gravity are distributed to each component σ by their density ratios 5 f ext σ ρ σ ρ f ext where ρ σ ρ σ is the total density of all components in a lattice cell all aforementioned force contributions are summarized to the total force f tot σ f inter σ f ads σ f ext σ using the shan chen forcing approach f tot σ is finally incorporated into f σ eq ρ σ u σ eq cf eq a 3 in the appendix as a force induced equilibrium velocity shift of each component 6 u σ eq σ ρ σ u σ τ σ σ ρ σ τ σ τ σ f tot σ ρ σ note that the equilibrium velocity u eq must not be confused with the macroscopic streaming velocity of the mixture for the hmcsc the latter is given by 7 u macro 1 ρ σ 1 n s σ i f i σ c i f tot σ δ t 2 where the factor 1 n s σ comes from the homogenization approach walsh et al 2009 yehya et al 2015 pereira 2016 3 model validation the hmcsc has been implemented in the open source lbm tool palabos version 2 3 latt et al 2021 this extended version of palabos was used to test the hmcsc for typical porous media benchmark scenarios for single and two phase flow the benchmark scenarios were chosen to cover a wide range of levels of complexity and are discussed in the following all results are given in lattice units or dimensionless units and compared with analytical or semi analytical solutions where available only 2d simulations were conducted for the validation a 3d application of the hmcsc is described in section 4 all relevant model parameters are given in table 1 this default parameter setting represents a simple clearly defined frequently used and relevant case and is therefore most suitable to benchmark the hmcsc approach unless specified otherwise it is used for all simulations of the present work for studying single phase flows using the hmcsc the mcsc related model parameters were set to zero i e g inter σ σ g ads σ 0 0 under these conditions the model reduces to the gs wbs with shan chen forcing scheme and no slip boundary conditions at solids 3 1 permeability the key parameter of the homogenization is the bounce back fraction n s for gs wbs it was shown to be related to the permeability k following eq 2 walsh et al 2009 it is shown in the following that eq 2 is also true when using the hmcsc for single phase flows the simulation domain represents a fully homogenized porous medium where n s was identical in all lattice cells the system was fully periodic and its dimensions along the x and y direction were h 50 lu each the fluid flow was driven by the body force f ext 1 0 5 mulu ts2 in x direction the permeability k was calculated using darcy s law for a single component fluid 8 k ν ρ u f ext where ρ u is the average momentum in x direction in addition the relative permeabilities k r σ were determined for a two phase flow in the absence of adhesion g ads σ 0 0 9 k r σ k s σ k s σ 1 0 here the index σ denotes fluid 1 or fluid 2 respectively s σ is the saturation of the simulation domain with fluid σ and the right hand side is the ratio between the permeability at a certain saturation s σ with the corresponding single phase permeability i e s σ 1 0 both determined using eq 8 for the single phase flow n s was varied in the range n s 0 0001 0 9999 for the two phase flow exemplary values n s 0 1 0 5 0 9 were chosen where for each value of n s s σ was varied in the range s 1 1 s 2 0 1 fig 1 a shows the simulation results and the analytical solution cf eq 2 of k for the single phase flow they are in excellent agreement which confirms the consistency with the gs wbs and the applicability of eq 2 for the hmcsc fig 1 b shows the simulation results of k r 1 and k r 2 for different n s and as a function of s 1 hardly any dependence on n s was observed the results follow an almost linear trend which is typical for fluids with low interfacial tension mu et al 2019 moreover as both fluids have identical properties cf table 1 it holds k r 1 s 1 k r 2 1 s 1 however note that also other realistic scenarios with more general shapes of permeability curves can be considered using the hmcsc e g for different simulation setups or if the properties of the two fluids are not identical 3 2 darcy brinkman flow a critical requirement for all homogenization approaches is that they recover darcy brinkman type flow behavior in porous media chen and zhu 2008 zhu and ma 2013 li et al 2014 yehya et al 2015 ginzburg 2016 pereira 2016 zhu and ma 2018 ning et al 2019 which is described by the darcy brinkman equation 10 ν b ϕ 2 u x 2 f ext ν k u 0 here ν b is the effective brinkman viscosity ν is the viscosity of the fluid f ext is the driving force and ϕ and k are the porosity and permeability of the porous medium respectively the analytical solution of eq 10 depends on the choice of boundary conditions three darcy brinkman flow types were studied and compared to their analytical solutions the different variants were 1 poiseuille flow 2 couette flow and 3 open boundary flow the overall simulation scenario is schematically shown in fig 2 it consisted of two stratified layers of porous media for which the permeabilities were independently adjusted by n s left and n s right the simulation domain had the dimensions h and l along the x and y directions respectively the flow was driven along the y direction either by applying constant velocities to the boundary cells or a body force f ext to all lattice cells at steady state the velocity profile u x was determined 1 poiseuille flow the poiseuille flow was studied for a single phase fluid in an homogeneous medium n s n s left n s right for which n s was varied in the range n s 0 001 0 01 0 1 0 5 0 9 no slip boundary conditions were applied as bounce back at the boundary cells the dimensions and the body force were h 50 lu l 50 lu and f ext 1 0 5 mulu ts2 respectively the analytical solution of eq 10 for this case is 11 u f ext k ν 1 cosh r x h 2 cosh r h 2 where r ν ϕ k ν b 2 n s ν for ϕ 1 n s and ν b ν and k was determined using eq 2 fig 3 shows the simulation results and analytical solutions cf eq 11 of the velocity profiles they are in excellent agreement over a wide range of n s i e within darcy σ da 0 5 k h 2 0 5 100 and brinkman 100 σ 1 regime 2 couette flow the couette flow was also studied for a single phase fluid in an homogeneous medium n s n s left n s right for which n s was varied in the range of n s 0 001 0 01 0 1 0 5 0 9 again velocity boundary conditions were applied to the boundary cells i e u 0 0 lu ts and u h u 0 0 01 lu ts the dimensions and the body force were h 50 lu l 50 lu and f ext 0 mulu ts2 respectively the analytical solution of eq 10 for this case is given as 12 u u 0 sinh r x sinh r h where again r 2 n s ν fig 4 shows the simulation results and the analytical solutions cf eq 12 of the velocity profiles they are in excellent agreement within the brinkman regime i e for n s 0 1 for larger values of n s i e in the darcy regime deviations are observed close to the boundary cells x h 0 95 this was also reported for other gs models and explained with an n s dependence of the no slip conditions chen and zhu 2008 zhu and ma 2013 3 open boundary flow the open boundary flow was studied for both a single phase fluid and a two phase fluid in an heterogeneous medium n s left n s right the influence of adhesion was neglected g ads σ 0 0 in the left half of the domain a constant value n s left 0 9 was chosen while n s right was varied in the range of n s right 0 001 0 01 0 1 0 5 0 8 instead of the boundary cells periodic boundary conditions along the x direction were applied the dimensions and the body force were h 100 lu l 50 lu and f ext 1 0 6 mulu ts2 respectively in case of the two phase flow the system was initialized with fluid 1 in the left half x 0 h 2 and fluid 2 in the right half of the domain x h 2 h the piece wise analytical solution of eq 10 for the open boundary flow is given as 13a u l u 0 l 1 1 p l cosh r l x h 4 sinh r l h 4 q l coth r r h 4 coth r l h 4 x 0 1 2 h 13b u r u 0 r 1 p r 1 cosh r r 3 h 4 x sinh r r h 4 q r coth r l h 4 coth r r h 4 x 1 2 h h the corresponding parameters u 0 p q and r are given in table 2 the labels l and r denote the left x 0 h 2 and the right x h 2 h half of the simulation domain respectively fig 5 shows the simulation results for a the single phase flow and b the two phase flow as well as the corresponding analytical solutions cf eq 12 for half the channel width only close to the interface x 1 4 3 4 h the results of the single phase flow are in excellent agreement over a wide range of n s right i e within darcy and brinkman regime the results of the two phase flow are also in good agreement with the analytical solutions however they are slightly overestimated for n s right 0 1 due to slip at the interface moreover the results indicate that the hmcsc inherently overcomes an issue of the gs wbs which was reported by zhu and ma 2013 and ginzburg 2016 they found that the gs wbs in the formulation of zhu and ma 2013 revealed a non physical velocity discontinuity at the interface for cases where n s left n s right 1 0 this was not observed here cf simulation with n s left 0 9 and n s right 0 8 and is assumed to be due to using the shan chen forcing scheme in the present study cf appendix b 3 3 bubble test the interfacial tension γ is an inherent thermodynamic property that depends on the molecular interaction of a set of immiscible fluids as well as on the thermodynamic state of the system therefore unlike in other gs models mcdonald and turner 2016 pereira 2016 it should not depend on the homogenization of a nanoporous medium this is especially important when the medium is heterogeneous i e n s is space dependent thus for each homogenized multi phase lb model to be physically consistent it has to be ensured that setting the model parameter g inter 12 to a constant value for the whole simulation domain does not lead to spatial variations of the interfacial tension this was verified using bubble tests the simulation setup is shown in fig 6 a the simulation domain consisted of an homogenized porous medium where all lattice cells had the identical bounce back fraction n s the system was fully periodic the dimensions of the simulation domain along the x and y direction were h the system was initially filled with a bubble consisting of fluid 1 which was submersed in fluid 2 both components had equal masses the pressure difference between the center of the bubble and its surroundings i e δ p p 1 p 2 as well as the bubble radius r were determined from the simulations therefrom γ follows laplace s law γ δ p r the influence of the parameters h g ads 1 n s and g inter 12 on γ was studied for the reference simulation case the parameters were h 100 lu g ads 1 0 0 n s 0 5 and g inter 12 1 75 unless specified otherwise the subsequent simulations used those default parameters fig 6 b shows the results of γ for different values of h g ads 1 n s and g inter 12 it was observed that γ does not depend on g ads 1 and n s this was also confirmed for bubble spreading in structurally resolved porous media and is shown in figure si 1 in the supporting information thus the interfacial tension was only affected by h and g inter 12 for increasing h γ decreased slightly and converged towards the asymptotic value γ 0 077 mu ts 2 this was related to the imprecise determination of the bubble radius r for small systems but worked well for h 100 lu in contrast the influence of the fluid fluid interaction g inter 12 on γ was large which was to be expected γ increased with increasing g inter 12 the results were in perfect agreement with the corresponding values reported by huang et al 2007 these were γ 0 051 0 078 0 104 mu ts 2 for g inter 12 1 50 1 75 2 00 respectively they were determined using the original mcsc which corresponds to using the hmcsc for n s 0 3 4 washburn simulations the washburn equation washburn 1921 14 x inter γ cos θ 2 η r eff t a b t describes imbibition into homogeneous and isotropic porous media as 1d flow through a bundle of cylindrical tubes with effective radius r eff the position of the moving interface is denoted by x inter the equation is only valid if gravity is negligible das and mitra 2013 li et al 2015 the flow is driven by the interplay of capillary forces and viscous forces where the former depend on the interfacial tension γ and the contact angle θ and the latter are determined by the dynamic viscosity of the fluid η ρ ν the parameters a and b in eq 14 are fit parameters that are used in the following to fit the simulation data to the washburn equation the simulation scenario consisted of a homogenized porous medium in which all lattice cells had the identical bounce back fractions n s the system dimensions along the x and y direction were h 500 lu and l 5 lu respectively the system was initially filled with fluid 2 the densities of fluid 1 and fluid 2 were prescribed at the inlet ρ 1 x 0 and outlet ρ 2 x h respectively periodic boundary conditions were applied along the y direction fluid 1 penetrated into the simulation domain in y direction and displaced fluid 2 the influence of the solid fluid interaction and bounce back fraction was studied correspondingly the contact angle θ was varied by changing g ads in the range of g ads g ads 1 0 05 0 40 and the permeability or effective radius r eff was varied by changing n s in the range of n s 0 1 0 5 0 9 fig 7 shows the simulation results for different values of g ads and n s results are given for t 5 1 0 4 ts this corresponds to the washburn regime x inter t where viscous effects dominate the flow das et al 2012 das and mitra 2013 li et al 2015 the data was used for fitting the washburn equation eq 14 for the simulations shown in fig 7 a n s 0 5 and only g ads was varied while for the simulations in fig 7 b g ads 0 2 and only n s was varied correspondingly for all fits in fig 7 a parameter b was the same and only a was freely adapted vice versa for all fits in fig 7 b a was fixed and only b was fitted to the simulations overall the fits and the data are in good accordance this is also confirmed by the large coefficients of determination i e r a 2 r b 2 0 97 the values for a and b as well as θ and r eff are given in table 3 in addition θ determined from the washburn simulations was compared with the correlation for the contact angle of huang et al 2007 15 cos θ h 4 g ads 2 g inter 12 ρ 1 ρ dis 2 which was derived from sessile droplet simulations using the original mcsc interestingly a good accordance of θ and θ h was observed especially for θ 0 60 for larger values of θ the correlation slightly overestimated the simulation results this was to some extent also observed in the paper of huang et al 2007 and is amplified by the increasing uncertainty of the fitting for θ 60 cf r a 2 in table 3 3 5 porous obstacle flow the last test concerned the simultaneous occurrence of free flow and darcy brinkman flow it followed an example of spaid and phelan 1998 which is also typically used as advanced benchmark in the literature yoshida and hayashi 2014 silva and ginzburg 2015 pereira 2016 the simulation scenario is shown in fig 8 a it consisted of a channel with five circular porous obstacles with diameter 2 r 33 lu from which the center to center distance was d 60 lu the dimensions of the system along the x and y direction were l 300 lu and h 50 lu respectively periodic boundary conditions were applied along the y direction the system was initially filled with fluid 2 the densities of fluid 1 and fluid 2 were prescribed at the inlet ρ 1 x 0 and outlet ρ 2 x l respectively a body force f ext 5 1 0 5 mulu ts2 in x direction was applied to both fluids leading to fluid 1 penetrating into the simulation domain to ensure consistency with the simulations of spaid and phelan 1998 viscous effects of fluid 2 within the obstacles were neglected by setting n s 2 0 in all lattice cells of the domain in contrast n s 1 was set to n s 1 0 1 0 5 0 9 within the obstacles to account for the darcy brinkman type behavior of fluid 1 and to n s 1 0 for all other lattice cells thus large viscosity ratios between the two fluids in the porous obstacles could be mimicked without running into numerical instabilities this scenario can be mathematically described by darcy s law 16 d x inter d t k unsat ϕ η f ext where x inter is the interface position k unsat is the permeability of the unsaturated system ϕ is the effective porosity of the obstacles η is the dynamic viscosity of fluid 1 and f ext is the body force the analytical solution of eq 16 is 17 x inter k unsat ϕ η f ext t which was used to determine k unsat from the simulations representative snapshots of the simulations at t 50 000 ts are shown in fig 8 b d for different values of n s 1 they reveal that increasing n s 1 retards the filling of the channel for n s 1 0 9 even a distinct bubble or droplet formation within the porous obstacles was observed these results agree qualitatively with results from the literature spaid and phelan 1998 pereira 2016 complementary fig 9 shows quantitative simulation results and the corresponding fits to eq 17 for different values of n s 1 the position of the interface was determined as x inter l 2 s 1 y 0 s 1 y h 2 where the proportions of cells in the boundary and the center column of the simulation domain which were filled with fluid 1 were denoted s 1 y 0 and s 1 y h 2 respectively the oscillations around the linear fits correspond to alternating deceleration and acceleration of the fluid front which depends on the varying width of the free flow channel the unsaturated permeabilities k unsat were determined fitting eq 17 to the simulation data the corresponding permeability of a saturated medium k sat was determined following the lubrication theory of phelan and wise 1996 both k unsat and k sat are given in table 4 the data shows that k unsat k sat and its ratio k unsat k sat decreases for increasing n s 1 these results are in qualitative agreement with simulative spaid and phelan 1998 yoshida and hayashi 2014 and experimental parnas et al 1995 observations 3 6 numerical stability multi component models in general are numerically stable for a limited range of density and viscosity ratios only krueger et al 2016 chen et al 2014 moreover due to an imbalance of discretized forces especially at curved interfaces they typically show spurious currents which can exacerbate the occurrence of numerical instabilities connington and lee 2012 also the original mcsc on which the hmcsc is based is known to suffer from spurious currents connington and lee 2012 chen et al 2014 it is stable for a maximum density ratio of 2 as well as a maximum viscosity ratio of 5 10 kang et al 2002a 2004 chen et al 2014 krueger et al 2016 remedies for those issues have been discussed in the literature shan 2006 sbragaglia et al 2007 connington and lee 2012 chen et al 2014 they were however not in the focus of this study to ensure that the coupling of mcsc and gs i e the hmcsc maintains the numerical stability characteristics of the original mcsc the aforementioned two phase flow benchmark scenarios from this section were conducted for different viscosity ratios m ν 2 ν 1 and density ratios g ρ 1 ρ 2 thus bubble tests washburn simulations and porous obstacle flows were simulated using the same simulation setups and model parameters as described in the corresponding subsections unless they are specified otherwise washburn simulations were conducted for m 5 g inter 12 2 75 g 1 m 10 g inter 12 2 25 g 1 and g 2 g inter 12 1 75 m 1 for each of the cases n s was varied in the range of n s 0 1 0 5 0 9 and g ads 1 was varied in the range of g ads 1 0 2 0 0 0 2 porous obstacle simulations were conducted for the same parameter set while fixing g ads 1 0 0 for the bubble test the system was initialized close to mechanical equilibrium i e g 1 and the viscosity ratio m 5 10 with g inter 12 2 75 2 25 respectively and n s 0 0 0 1 0 5 0 9 were varied all simulations i e m 10 and g 2 were numerically stable this is a strong indicator that the coupling of mcsc and gs via hmcsc has no negative effect on the numerical stability in the following exemplary results are shown for the bubble test scenario only all other results are given in the supporting information fig 10 shows results of γ for m 5 and m 10 for different values of g ads 1 and n s each it can be observed that γ does hardly depend on g ads 1 and n s thus the interfacial tension is only affected by g inter 12 and the viscosities or τ respectively this is in agreement with the results shown in fig 6 b for m 1 and g 1 also the spurious currents were analyzed for the bubble test scenario results are shown in fig 11 for m 1 and m 5 there the results for n s 0 0 correspond to the original mcsc it can be observed that larger viscosity ratios induce larger spurious currents and thus are numerically more unstable this effect is however reduced when increasing n s i e decreasing the permeability of the porous medium cf fig 1 a when e g increasing n s from 0 0 to 0 9 the maximum velocity of spurious currents v max is reduced by two orders of magnitude 3 7 discussion in this section the hmcsc was successfully validated using different single and two phase flow benchmark scenarios altogether they demonstrate the broad applicability of the coupling approach presented here moreover and just as important it was shown that the hmcsc inherits all positive attributes and numerical stability characteristics from the original mcsc the gs wbs and its multi phase extension by pereira 2016 at the same time the hmcsc overcomes some deficiencies of these methods i e non physical discontinuities of interfacial tension and velocity at interfaces between different porous media the features of the hmcsc are briefly summarized as follows 1 as was shown by the bubble tests the interfacial tension γ is independent of n s and g ads thus the interfacial tension is a property of the fluids only and is not affected by the homogenization this was also shown to be valid for viscosity ratios and density ratios above 1 2 as was shown by the washburn simulations also the contact angle θ is independent of n s it is a property of the solid fluid material combination only and is also not affected by the homogenization 3 as was shown by the open boundary darcy brinkman flow simulations the hmcsc inherently ensures velocity continuity at interfaces of porous media with different n s no additional smoothing procedure as suggested by yehya et al 2015 is required 4 the hmcsc is fully consistent with the original mcsc thus the values for g ads and g inter can be chosen identical to the values that are used for the original mcsc the same parametrization approach following the paper of huang et al 2007 as well as eq 15 can be applied to study the identical physical situations no further parametrization is required 5 the hmcsc is especially suitable for studying multi phase flow in heterogeneous porous media where both the wetting properties and the permeability vary in space and time while the physical properties of the fluid mixture are unaffected 6 the hmcsc is accurate intuitive and easy to implement regarding its numerical stability the hmcsc shows similar characteristics as the original mcsc i e it is stable for density ratios up to 2 and viscosity ratios up to 5 10 moreover spurious currents can even be reduced when increasing n s in contrast to most other gs models thorne and sukop 2004 chen and zhu 2008 zhu and ma 2013 2018 including the model proposed by pereira 2016 where forces were included using the guo forcing scheme guo et al 2002 the hmcsc uses the common shan chen forcing scheme although this leads to a τ dependence of the viscosity yu and fan 2010 silva and ginzburg 2015 it involves substantial advantages over the aforementioned models the corresponding differences and their potential effects are briefly discussed in appendix b 4 application and results practical applications of the hmcsc are most scenarios in which multi phase fluid flow occurs in multi scale porous media in the context of hydrology geoscience and petroleum engineering the hmcsc can be especially interesting to study transport in pores vugs and microfractures simultaneously while also considering local changes of the permeability due to geochemical or biological processes thus the hmcsc might be helpful to predict and gain insight into groundwater hydrology geologic carbon storage and sequestration and the recovery of oil and gas from different multi scale porous rocks such as sandstones carbonates and shale krevor et al 2012 ghezzehei 2012 mehmani et al 2015 soulaine et al 2019 mehmani et al 2020 hassannayebi et al 2021 however as the research focus of our group is on energy storage materials here the electrolyte filling of lithium ion batteries was studied exemplarily the pore sizes in such microstructures typically range from nano to micrometers and its filling is not yet fully understood thus it is of recent research interest with the objective to optimize the corresponding manufacturing process as well as the battery performance and lifetime wood et al 2015 weydanz et al 2018 a realistic 3d reconstruction of a lithium ion battery cathode westhoff et al 2018 with a porosity of ϕ a 40 and neutral wetting conditions was used as a geometrical basis for all simulations the filling of three variants of this structure was studied 1 the pure electrode structure 2 the electrode structure infiltrated with v b 21 volume fraction of a nanoporous binder and 3 the electrode structure attached to a nanoporous and fully homogenized separator for which the generation is described in appendix c the contact angles of the active material binder and separator were θ a 90 θ b 60 and θ s 90 respectively they were converted to the model parameter g ads 2 g ads 1 using eq 15 the bounce back fractions in the homogenized porous media were n s n s 1 n s 2 0 5 for the binder while in the separator n s was space dependent and identical to the normalized grayscale value of each voxel of the separator image data fig 12 shows the schematic simulation setup where also the three different variants of microstructures are indicated it is similar to the setup that was used in a recent study of our group lautenschlaeger et al 2022 in which the electrolyte filling process was studied in very detail initially the pore space was filled with gas only periodic boundary conditions were applied along the x and z direction along the y direction an electrolyte reservoir and a gas reservoir were added at the inlet and outlet respectively the reservoirs had a thickness of four layers each in which the density of both fluids was prescribed the initial electrolyte density at the inlet was ρ 1 and was incrementally increased during the simulation run the gas density at the outlet was constant i e ρ 2 thereby a pressure difference between the two fluids was applied to drive the electrolyte imbibition cf eq 18 between the reservoirs and the microstructures semi permeable membranes were placed to prevent an unwanted fluid breakthrough the inlet membrane was permeable for the electrolyte only the outlet membrane was permeable for the gas only this approach is in accordance with imbibition experiments and simulations that are typically used to analyze porous media in the context of geoscience or energy storage materials gostick et al 2008 karpyn et al 2009 pini et al 2012 krevor et al 2012 zhao et al 2015 danner et al 2016 tavangarrad et al 2019 zhu et al 2021 lautenschlaeger et al 2022 the model parameters for the simulations are given in table 1 where fluid 1 and fluid 2 correspond to electrolyte and gas respectively from each simulation pressure saturation curves were determined they are a characteristic property of porous media and relate the pressure difference δ p needed for the imbibition to the amount of electrolyte in the pore space i e the saturation s 1 the pressure difference δ p was determined as 18 δ p p inlet p outlet where p was evaluated using eq a 6 and p denotes the average pressure in the inlet and outlet reservoirs the electrolyte saturation s 1 was determined as 19 s 1 n pore ρ 1 0 5 1 n s n hom ρ 1 0 5 n pore 1 n s n hom where the denominator and numerator correspond to the total pore space and the pore space in which ρ 1 0 5 mu lu 3 respectively the number of pore lattice cells in the electrode structures and the homogenized nanoporous components are denoted by n pore and n hom respectively the latter were multiplied by the effective fluid fraction 1 n s note that for the calculation of the saturation only the lattice cells between the two membranes were considered a simulation run consisted of approximately 1 000 000 time steps the pressure difference and the saturation were determined every 10 000 time steps during the production run the simulations stopped when a further saturation was not possible and led to a steep increase of δ p fig 13 a shows the pressure saturation curves for the three different microstructures they follow a sigmoidal behavior which is typically observed in the literature and can be explained based on the young laplace equation for all cases the final saturation s 1 final deviated from the theoretical optimum of 100 which indicates residual gas being entrapped in the pore space weydanz et al 2018 sauter et al 2020 a remarkable influence of the homogenized microstructures was observed compared to the pure electrode the pressure saturation curve for the electrode with binder shows a similar qualitative behavior but appears to be shifted by δ p 0 and s 1 0 thus by infiltrating a binder the characteristics of the pore space were largely maintained only the enhanced wetting of the binder facilitated the electrolyte imbibition led to a reduction of δ p and increased s 1 final close to 100 the pressure saturation curve for the electrode attached to the separator shows a stronger influence as also the proportion of homogenized medium was larger compared to the structurally resolved electrode for s 1 15 it behaves similar to the pure electrode but is shifted by s 1 0 this similarity is because the electrolyte had not yet reached the separator but was influenced by the pure electrode only at larger saturations a pressure plateau is reached which was also observed in the literature tavangarrad et al 2019 sauter et al 2020 here it corresponds to the smooth filling of the fully homogenized separator along this plateau the pressure increased by 0 4 kpa only while at the end of the filling a large pressure increase was observed due to the electrolyte imbibition into the small pores of the electrode however a notable gas entrapment remains note that in general the shift along s 1 0 for the homogenized microstructures was also influenced by the definition of the saturation cf eq 19 where adding lattice cells with a bounce back fraction n s 0 led to a reduction of the total pore space fig 13 b d show snapshots of simulation cross sections x y plane at t 400 000 ts for the three different microstructures the corresponding state points on the pressure saturation curves are indicated by the hashes in fig 13 a compared to the pure electrode cf fig 13 b in fig 13 c slightly more electrolyte is imbibed into pores with binder fig 13 d shows the electrolyte distribution in the resolved electrode and the homogenized separator while the electrode part is not yet completely filled a breakthrough of the electrolyte into the separator is observed this state corresponds to the pressure plateau shown in fig 13 a moreover fig 13 d indicates some interesting model related phenomena on the one hand the heterogeneity of n s values in the separator can be used to mimic structural effects that influence gas entrapment the flow orientation and deformation of the electrolyte gas interface on the other hand and even more importantly the interface thickness in the homogenized separator is constant and not affected by the distribution of n s it is also identical to the interface thickness in the structurally resolved pores for which n s 0 similar simulations were conducted by a different research group in an earlier study pereira 2019 for a two phase flow g 1 m 1 in a tight sandstone sample composed of different partially permeable minerals using the approach of pereira 2016 the results there confirm that pereira s method has deficiencies with respect to discontinuities of properties in heterogeneous porous media more specifically figures 7 and 8 in pereira 2019 show strong density variations within the invading fluid phase this is most likely a model artifact and related to a non physical diverging interface thickness in the partially permeable regions in contrast the simulation results of the current study determined using the hmcsc do not show such density variations this gives further evidence of the potential and strength of the hmcsc moreover it demonstrates possible applications of multi phase flows in heterogeneous porous media going beyond electrochemical energy storage showcased in this work 5 conclusion a simple but effective lattice boltzmann approach was presented which is especially useful for the simulation of multi phase flows in heterogeneous porous media but can also be used to study single phase flows it follows the approach of pereira 2016 and combines the grayscale method of walsh et al gs wbs walsh et al 2009 i e a homogenization approach with the multi component shan chen model mcsc shan and chen 1993 therefore it was called the homogenized multi component shan chen method hmcsc the hmcsc was tested using a broad variety of benchmark scenarios that are typically used to validate single and two phase flow phenomena in porous media the results were compared to analytical and semi analytical solutions where available and shown to agree well in addition the hmcsc was applied to study the electrolyte filling of different variants of a realistic 3d reconstruction of a lithium ion battery microstructure hereby the hmcsc was shown to reproduce the relevant physical phenomena also within the homogenized nanoporous binder and separator for example including the wetting binder led to a reduction of the capillary pressure and an improvement of the final degree of saturation which is beneficial for the battery performance moreover when adding the fully homogenized separator with space dependent n s values structural effects which influence gas entrapment characteristic flow paths and the deformation of the electrolyte gas interface were mimicked appropriately the hmcsc brings together the physical as well as numerical characteristics of gs wbs and mcsc i e it is applicable to immiscible fluids with viscosity ratios of up to 5 10 in addition it overcomes some deficiencies of gs wbs as well as the model reported by pereira 2016 which are related to discontinuities of properties in heterogeneous porous media in contrast to the aforementioned methods the hmcsc is consistent with the original mcsc this means the mcsc related model parameters g ads and g inter can be chosen identically to the parameters in the original mcsc cf huang et al 2007 the corresponding physical properties i e contact angle and interfacial tension are not affected by the homogenization they are constant and properties of the fluid only even in heterogeneous porous media where n s is space dependent thus no further parametrization is required moreover in contrast to the gs wbs no artificial force and velocity discontinuity was observed at interfaces between different porous media we assume that this is due to the shan chen forcing scheme that was used for the hmcsc altogether the hmcsc is physically motivated accurate and efficient nonetheless it is simple intuitive easy to implement and allows a straightforward parametrization that is consistent with the original mcsc moreover the hmcsc shows similar numerical stability characteristics the results are promising and give cause to believe that techniques which alleviate limitations of the original mcsc are equally applicable to the hmcsc by the right choice of model parameters the hmcsc can be applied to all situations for which either the original mcsc or the gs wbs can be used however the hmcsc is not restricted to these particular applications all other research fields where multi phase fluid flow occurs in heterogeneous and multi scale porous media can benefit from this method too potential applications are subsoil or groundwater flow pereira 2016 ning et al 2019 oil recovery via water injection spaid and phelan 1998 welge 1952 biofilm growth in porous structures jung and meile 2021 the characterization of gas diffusion electrodes danner et al 2016 water transport in gas diffusion layers zhu et al 2021 or electrolyte filling of batteries shodiev et al 2021 lautenschlaeger et al 2022 credit authorship contribution statement martin p lautenschlaeger conceptualization investigation methodology software validation visualization writing original draft julius weinmiller validation writing review editing benjamin kellers formal analysis writing review editing timo danner conceptualization writing review editing arnulf latz funding acquisition writing review editing declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments the authors gratefully acknowledge financial support from the european union s horizon 2020 research and innovation programme within the project defacto under the grant number 875247 the simulations were carried out on the hawk at the high performance computing center stuttgart hlrs under the grant laboresys and on justus 2 at the university ulm under the grant inst 40 467 1 fugg appendix a lattice boltzmann method lbm solves the discretized boltzmann equation a 1 f i x c i δ t t δ t f i x t δ t τ f i x t f i eq x t using discrete distribution functions f i also referred to as populations this approach uses the bgk collision bhatnagar et al 1954 which describes the relaxation of f towards the maxwell boltzmann equilibrium distribution function f eq cf eq a 3 with a characteristic relaxation time τ the relaxation time determines the kinematic viscosity via ν c s 2 τ 1 2 δ t where c s 2 is the velocity set dependent lattice speed of sound the discretization of eq a 1 is done in velocity space on a regular square or cubic lattice for 2d and 3d respectively each lattice cell is linked to its adjacent neighbors denoted with i the resulting velocity sets c are called d2q9 and d3q27 which is often reduced to d3q19 for efficiency and are given in eqs a 7 a 8 for completeness t and x denote time and lattice location with δ t and δ x being the temporal and spatial step for the non dimensional computationally efficient form δ x and δ t are unity as such they are usually omitted but are included in this work for clarity and dimensional consistency the homogenization approach by walsh et al 2009 is a 2 f i x c i δ t t δ t 1 n s x f i x t 1 n s x δ t τ f i x t f i eq x t n s x f i x t here n s 0 1 acts as an interpolation factor that scales the fluid and solid behavior of f from all populations f in a lattice cell the fraction 1 n s is allowed to flow freely and therefore behaves fluid like cf first and the second line of eq a 2 while the fraction n s is bounced back and therefore behaves solid like cf third line of eq a 2 the latter term uses the pre collision populations which is highlighted by t the symbol i denotes the direction opposite to i with the exception i 0 i note that for n s 0 eq a 2 is equivalent to the default lb bgk equation that describes pure fluid flow eq a 1 while for n s 1 it corresponds to pure bounce back that describes a no slip wall the mcsc approach has been fully covered in section 2 it is iterated that for each component σ used a unique discrete population function f σ is needed therefore in the following σ is explicitly mentioned in all equations a 1 maxwell boltzmann distribution the maxwell boltzmann equilibrium distribution function is given by a 3 f i σ eq w i ρ σ 1 c i u σ eq c s 2 c i u σ eq 2 2 c s 4 u σ eq u σ eq 2 c s 2 here w i are the lattice specific weights ρ σ is the fluid density of component σ cf eq a 4 and u eq is the equilibrium velocity cf eq 6 a 2 multi phase physical quantities the macroscopic physical quantities can be recovered from the discrete distribution function in the following they are expressed in terms of multiple phases but apply for single phase fluids as well the fluid density of component σ is the zeroth moment of f σ and determined as a 4 ρ σ i f i σ the velocity of component σ is the first moment of f σ and determined as a 5 u σ 1 ρ σ i f i σ c i the total pressure p of the mixture follows the ideal gas law it is extended by a contribution from the fluid fluid interaction which is especially relevant at the interface p is determined as a 6 p x c s 2 ρ x g inter σ σ ρ σ x ρ σ x δ t 2 a 3 velocity sets the hmcsc has been implemented for both 2d and 3d simulations the corresponding velocity sets used for the simulations of the present work i e d2q9 and d3q19 are given in the following d2q9 a 7 c 0 c 1 c 2 c 3 c 4 c 5 c 6 c 7 c 8 δ x δ t 0 1 1 1 0 1 1 1 0 0 1 0 1 1 1 0 1 1 the d2q9 weights are w i 4 9 for c i 0 w i 1 9 for c i 1 and w i 1 36 for c i 2 with the speed of sound c s 1 3 δ x δ t d3q19 see box i the d3q19 weights are w i 1 3 for c i 0 w i 1 18 for c i 1 and w i 1 36 for c i 2 with the speed of sound c s 1 3 δ x δ t appendix b guo vs shan chen forcing it has been reported in literature zhu and ma 2013 yehya et al 2015 ginzburg 2016 and also mentioned in the main text of this paper that using the gs wbs can result in velocity discontinuities at interfaces between different porous media this was not observed when using the hmcsc cf fig 5 the reason might be due to the fact that the hmcsc uses the shan chen forcing scheme shan and chen 1993 while the guo forcing scheme guo et al 2002 was used for the simulations reported in zhu and ma 2013 ginzburg 2016 the differences between both forcing schemes are briefly outlined in the following for brevity regarding the notation the position x is omitted and the time step is indicated in the exponent the meaning of which is t is the current time step and t denotes the state just before streaming to emphasize and avoid confusion t is used in addition to denote the pre collision state b 9 gs wbs f i t 1 n s f i t 1 n s δ t τ f i t f i eq t u macro n s f i t 1 n s f i f tot u macro b 10 hmcsc f i t 1 n s f i t 1 n s δ t τ f i t f i eq t u eq n s f i t eqs b 9 b 10 show the gs type lb bgk equation in the guo and shan chen forcing scheme respectively the most obvious difference between both is the force term f i in eq b 9 it is directly dependent on the total force f tot the whole term is scaled by the factor 1 n s this means that also the fluid fluid and solid fluid force contributions are scaled by 1 n s leading to an n s dependent interfacial tension and wetting behavior which was shown to be circumvented when using the hmcsc moreover at the interface between two porous media from which the n s values differ the force term is also scaled differently which might be one reason for the force and velocity discontinuity observed in the literature zhu and ma 2013 yehya et al 2015 ginzburg 2016 another might be that f tot enters also indirectly into eq b 9 via u macro which in the guo forcing scheme is needed for the calculation of f eq however as u macro itself is already scaled by 1 n s cf eq 7 the factor 1 n s might be unintentionally considered several times for the force calculation now considering the shan chen forcing scheme the situation is much clearer f tot is only indirectly incorporated into u eq cf eq 6 which in the shan chen forcing scheme is needed for the calculation of f eq thus a repeated scaling by 1 n s is impossible nevertheless the actual reason why gs wbs in guo forcing leads to velocity discontinuities while it does not when using the hmcsc in the shan chen forcing scheme remains still unclear a detailed analysis would be necessary which however goes far beyond the scope of this study appendix c data c 1 maximum velocity in open boundary flow the maximum velocities in lattice units for the open boundary flow validation test are presented in table c 1 c 2 structure generation of homogenized separator the homogenized separator structure has been created by downsampling the original binarized image by a factor of 20 in each direction the original structure consisted of 600 820 560 voxels with a voxel length of 2 19 1 0 8 m this structure has been subdivided into 20 20 20 cubes with the volume fraction of each cube being the mean volume fraction of its containing voxels the resulting structure is of shape 30 41 28 the voxel length i e 4 38 1 0 7 m is identical to that of voxels of the electrode structure but since the electrode structure is much larger the separator has been stacked multiple times in both directions perpendicular to the filling direction to fit the dimensions of the electrode this procedure seems trivial and one could get the impression that it would be possible to run simulations using the gray values from ct images directly however as discussed in ref baveye et al 2017 this is not the case the model parameter called the bounce back fraction n s does not correspond to the physical bounce back fraction that is determined through images with no information about the actual penetrability of the material the relation between the physical parameter and the model parameter can only be guessed to overcome this limitation investigating a method for converting both will be one topic of our future research appendix d supplementary data supplementary material related to this article can be found online at https doi org 10 1016 j advwatres 2022 104320 appendix d supplementary data the following is the supplementary material related to this article mmc s1 supporting information homogenized multi phase lattice boltzmann model 
82,a homogenization approach for the simulation of multi phase flows in heterogeneous porous media is presented it is based on the lattice boltzmann method and combines the grayscale with the multi component shan chen method thus it mimics fluid fluid and solid fluid interactions also within pores that are smaller than the numerical discretization the model is successfully tested for a broad variety of single and two phase flow problems additionally its application to multi scale and multi phase flow problems in porous media is demonstrated using the electrolyte filling process of realistic 3d lithium ion battery electrode microstructures as an example the approach presented here shows advantages over comparable methods from literature the interfacial tension and wetting conditions are independent and not affected by the homogenization moreover all physical properties studied here are continuous even across interfaces of porous media the method is consistent with the original multi component shan chen method mcsc it is as stable as the mcsc easy to implement and can be applied to many research fields especially where multi phase fluid flow occurs in heterogeneous and multi scale porous media keywords two phase flow transport in porous media darcy brinkman buckley leverett washburn shan chen data availability data will be made available on request 1 introduction fluid flow in porous media plays an important role in many technical and natural processes such as hydrogeology reservoir and process engineering electrochemical energy storage or medical applications most of these examples involve complex flow phenomena such as transport of solutes reactions or the interaction of multiple phases or immiscible fluid components kang et al 2007 dentz et al 2011 steefel et al 2005 baveye et al 2017 laubach et al 2019 yuan et al 2019 structures that are heterogeneous regarding their chemical composition and wetting properties dentz et al 2011 blunt et al 2013 laubach et al 2019 zhang et al 2020 and pore sizes that range from nanometers to the macroscale sok et al 2010 bai et al 2013 blunt et al 2013 zhang et al 2016 kang et al 2019 soulaine et al 2019 zhang et al 2020 mehmani et al 2020 thus and because most of the interesting physical phenomena happen on the pore scale they are hard to study experimentally sok et al 2010 kang et al 2002b dentz et al 2011 mehmani et al 2020 therefore in the literature often direct numerical simulations and more specifically the lattice boltzmann method lbm are used to conduct pore scale simulations lbm is a reliable tool for studying multi scale and multi physics transport processes within complex porous geometries krueger et al 2016 liu et al 2016 it has also been successfully applied to solve multi phase flows in high resolution real world image data of porous media samples that were recorded using x ray micro computed tomography μ ct or focused ion beam scanning electron microscopy fib sem sok et al 2010 blunt et al 2013 chen et al 2014 liu et al 2016 zhang et al 2016 baveye et al 2017 kang et al 2019 zhang et al 2020 mehmani et al 2020 unfortunately lbm is computationally expensive especially when simultaneously simulating flow in structurally resolved pores at different length scales therefore homogenization methods have been developed where the detailed structure of pores at the smallest length scale is ignored and instead the flow is described by a darcy brinkman type approach a volume average of the structurally resolved geometry is taken and its effects on fluid flow are mimicked as permeability related parameter these homogenization methods can be basically subdivided into two groups those are the brinkman force adjusted models bf spaid and phelan 1997 freed 1998 guo and zhao 2002 kang et al 2002b ginzburg 2008 gao et al 2014 ginzburg et al 2015 kang et al 2019 where a drag force is applied locally and the grayscale models gs dardis and mccloskey 1998 thorne and sukop 2004 chen and zhu 2008 walsh et al 2009 zhu and ma 2013 yoshida and hayashi 2014 yehya et al 2015 ginzburg et al 2015 ginzburg 2016 zhu and ma 2018 where flow populations are partially bounced back to mimic flow resistance although the aforementioned homogenization methods have been heavily discussed and further developed for single phase fluids chen and zhu 2008 walsh et al 2009 zhu and ma 2013 ginzburg et al 2015 ginzburg 2016 zhu and ma 2018 this is not the case for multi phase or multi component fluids only a few methods combining gs and multi phase physics mcdonald and turner 2016 zalzale et al 2016 lei and shi 2019 as well as methods combining other homogenization approaches with multi component physics ning et al 2019 an et al 2020 have been reported recently however despite the fact that the multi component shan chen method mcsc is most widely used for studying all kinds of immiscible fluids chen et al 2014 krueger et al 2016 only one homogenized method has been developed combining gs with mcsc pereira 2016 this method is however not fully consistent with the original mcsc regarding model parametrization and shows deficiencies with respect to discontinuities of properties in heterogeneous porous media therefore in the current paper a new approach is presented that follows the approach of pereira 2016 and combines gs by walsh et al gs wbs walsh et al 2009 with mcsc shan and chen 1993 it is therefore called the homogenized multi component shan chen method hmcsc in the following gs wbs is chosen as it is known to recover darcy brinkman flow conserves mass and allows an efficient computational parallelization as only local bounce back operations are performed mcsc uses a physically based approach to model fluid fluid and solid fluid interactions without the need for interface tracking it also achieves a good compromise between computational efficiency and physical reality and thus is widely adopted for modeling immiscible fluids chen et al 2014 krueger et al 2016 the hmcsc inherits all positive features from the aforementioned models but overcomes their deficiencies which are mainly related to the discontinuity of properties in heterogeneous porous media for example using hmcsc the interfacial tension and the wetting properties are constant and not affected by the homogenization thus especially the mcsc related model parameters can be chosen consistently to the original mcsc and no further parametrization is required besides similar to all other lbm homogenization approaches the hmcsc switches freely between free flow and darcy regime and can also be applied to study single phase flows as part of this paper the hmcsc was rigorously tested for a broad variety of single phase and two phase flow benchmark cases that are relevant in the context of porous media those were stokes brinkman darcy flow under couette and poiseuille conditions fluid flow in stratified heterogeneous porous media and partially porous channels as well as steady bubble tests and washburn type capillary flow it was also tested regarding its numerical stability and shown to be comparable to the original mcsc in addition it predicts buckley leverett waterflooding to some extent cf section si 3 in the supporting information the results were compared with analytical and semi analytical solutions where available finally the hmcsc was applied to a two phase flow issue of current research interest in the field of electrochemical energy storage the electrolyte filling of lithium ion battery microstructures with partially permeable nanoporous components however other research fields where multi phase fluid flow occurs in multi scale porous media can benefit from the new method too in the context of hydrology geoscience and petroleum engineering potential applications are the prediction of microbiologically affected groundwater flow ghezzehei 2012 hassannayebi et al 2021 geologic carbon storage or sequestration krevor et al 2012 mehmani and tchelepi 2018 and the recovery of oil dry natural gas or shale gas from tight gas sandstones mehmani et al 2015 2020 carbonates mehmani et al 2015 2020 and shale formations soulaine et al 2019 respectively this paper is organized as follows in section 2 the hmcsc is described in section 3 it is tested for a broad variety of benchmark cases and the corresponding results features of the approach and its numerical stability are discussed in section 4 the results of the electrolyte filling simulations in realistic and partially homogenized battery microstructures are presented finally conclusions are drawn in section 5 2 model the lbm fundamentals including the determination of macroscopic variables as well as the underlying methods are given in appendix a for further information especially regarding gs wbs and mcsc the reader is directed to the corresponding refs walsh et al 2009 shan and chen 1993 in the following only relevant parts that are necessary to understand the hmcsc are described the full declaration of notations is also given in appendix a the main equation of the hmcsc that combines the gs wbs homogenization approach walsh et al 2009 with the original mcsc and the shan chen forcing scheme shan and chen 1993 is 1 f i σ x c i δ t t δ t 1 n s σ x f i σ x t 1 n s σ x δ t τ σ f i σ x t f i σ eq x t n s σ x f i σ x t here f σ is the distribution function of the component σ f σ eq is the maxwell boltzmann equilibrium distribution function cf eq a 3 in the appendix and τ σ is the relaxation time the last term in eq 1 corresponds to the bounce back scheme the parameter n s σ comes from the homogenization approach originally it was called the solid fraction which is due to the intuitive interpretation of relating flow properties to the solid volume fraction in the following the same parameter is called the bounce back fraction to highlight its technical origin and to prevent a misinterpretation note that the bounce back fraction has to be chosen to retrieve the permeability and should be seen as a space dependent internal model parameter which is not necessarily directly proportional to the amount of solid material in a lattice cell its general relation to the permeability for a single phase fluid walsh et al 2009 is 2 k 1 n s 2 n s ν δ t similar to the mcsc shan and chen 1993 eq 1 is solved for each component σ involved in the multi phase flow thus all lattice cells are occupied by every component simultaneously a cell belonging to component σ is composed of the main component density ρ σ and the dissolved densities with ρ dis ρ σ the fluid fluid and solid fluid interactions are incorporated as interaction forces via f σ eq cf eq 6 they are physically motivated by a pseudopotential that similar to molecular dynamic simulations models molecular interactions to recover cohesion and adhesion e g in wetting or transport processes lautenschlaeger and hasse 2019b a diewald et al 2020 lautenschlaeger and hasse 2020 the separation of component σ by another component σ is driven by a fluid fluid interaction force f inter 3 f inter σ x ρ σ x g inter σ σ i w i ρ σ x c i δ t c i δ t where the interaction parameter g inter σ σ determines the strength of the cohesion the wettability or adhesion of the component σ at a solid wall is modeled with the solid fluid interaction force f ads σ 4 f ads σ x ρ σ x g ads σ i w i s x c i δ t c i δ t where the adhesion parameter g ads σ determines the wetting behavior and s is an indicator function which is s n s σ here it was shown by huang et al 2007 how g inter σ σ and g ads σ relate to the interfacial tension γ and the contact angle θ respectively it will be shown in section 3 that the same parametrization can be used for the hmcsc too which underlines its physical consistency with the original mcsc additional external forces f ext which act on all components such as gravity are distributed to each component σ by their density ratios 5 f ext σ ρ σ ρ f ext where ρ σ ρ σ is the total density of all components in a lattice cell all aforementioned force contributions are summarized to the total force f tot σ f inter σ f ads σ f ext σ using the shan chen forcing approach f tot σ is finally incorporated into f σ eq ρ σ u σ eq cf eq a 3 in the appendix as a force induced equilibrium velocity shift of each component 6 u σ eq σ ρ σ u σ τ σ σ ρ σ τ σ τ σ f tot σ ρ σ note that the equilibrium velocity u eq must not be confused with the macroscopic streaming velocity of the mixture for the hmcsc the latter is given by 7 u macro 1 ρ σ 1 n s σ i f i σ c i f tot σ δ t 2 where the factor 1 n s σ comes from the homogenization approach walsh et al 2009 yehya et al 2015 pereira 2016 3 model validation the hmcsc has been implemented in the open source lbm tool palabos version 2 3 latt et al 2021 this extended version of palabos was used to test the hmcsc for typical porous media benchmark scenarios for single and two phase flow the benchmark scenarios were chosen to cover a wide range of levels of complexity and are discussed in the following all results are given in lattice units or dimensionless units and compared with analytical or semi analytical solutions where available only 2d simulations were conducted for the validation a 3d application of the hmcsc is described in section 4 all relevant model parameters are given in table 1 this default parameter setting represents a simple clearly defined frequently used and relevant case and is therefore most suitable to benchmark the hmcsc approach unless specified otherwise it is used for all simulations of the present work for studying single phase flows using the hmcsc the mcsc related model parameters were set to zero i e g inter σ σ g ads σ 0 0 under these conditions the model reduces to the gs wbs with shan chen forcing scheme and no slip boundary conditions at solids 3 1 permeability the key parameter of the homogenization is the bounce back fraction n s for gs wbs it was shown to be related to the permeability k following eq 2 walsh et al 2009 it is shown in the following that eq 2 is also true when using the hmcsc for single phase flows the simulation domain represents a fully homogenized porous medium where n s was identical in all lattice cells the system was fully periodic and its dimensions along the x and y direction were h 50 lu each the fluid flow was driven by the body force f ext 1 0 5 mulu ts2 in x direction the permeability k was calculated using darcy s law for a single component fluid 8 k ν ρ u f ext where ρ u is the average momentum in x direction in addition the relative permeabilities k r σ were determined for a two phase flow in the absence of adhesion g ads σ 0 0 9 k r σ k s σ k s σ 1 0 here the index σ denotes fluid 1 or fluid 2 respectively s σ is the saturation of the simulation domain with fluid σ and the right hand side is the ratio between the permeability at a certain saturation s σ with the corresponding single phase permeability i e s σ 1 0 both determined using eq 8 for the single phase flow n s was varied in the range n s 0 0001 0 9999 for the two phase flow exemplary values n s 0 1 0 5 0 9 were chosen where for each value of n s s σ was varied in the range s 1 1 s 2 0 1 fig 1 a shows the simulation results and the analytical solution cf eq 2 of k for the single phase flow they are in excellent agreement which confirms the consistency with the gs wbs and the applicability of eq 2 for the hmcsc fig 1 b shows the simulation results of k r 1 and k r 2 for different n s and as a function of s 1 hardly any dependence on n s was observed the results follow an almost linear trend which is typical for fluids with low interfacial tension mu et al 2019 moreover as both fluids have identical properties cf table 1 it holds k r 1 s 1 k r 2 1 s 1 however note that also other realistic scenarios with more general shapes of permeability curves can be considered using the hmcsc e g for different simulation setups or if the properties of the two fluids are not identical 3 2 darcy brinkman flow a critical requirement for all homogenization approaches is that they recover darcy brinkman type flow behavior in porous media chen and zhu 2008 zhu and ma 2013 li et al 2014 yehya et al 2015 ginzburg 2016 pereira 2016 zhu and ma 2018 ning et al 2019 which is described by the darcy brinkman equation 10 ν b ϕ 2 u x 2 f ext ν k u 0 here ν b is the effective brinkman viscosity ν is the viscosity of the fluid f ext is the driving force and ϕ and k are the porosity and permeability of the porous medium respectively the analytical solution of eq 10 depends on the choice of boundary conditions three darcy brinkman flow types were studied and compared to their analytical solutions the different variants were 1 poiseuille flow 2 couette flow and 3 open boundary flow the overall simulation scenario is schematically shown in fig 2 it consisted of two stratified layers of porous media for which the permeabilities were independently adjusted by n s left and n s right the simulation domain had the dimensions h and l along the x and y directions respectively the flow was driven along the y direction either by applying constant velocities to the boundary cells or a body force f ext to all lattice cells at steady state the velocity profile u x was determined 1 poiseuille flow the poiseuille flow was studied for a single phase fluid in an homogeneous medium n s n s left n s right for which n s was varied in the range n s 0 001 0 01 0 1 0 5 0 9 no slip boundary conditions were applied as bounce back at the boundary cells the dimensions and the body force were h 50 lu l 50 lu and f ext 1 0 5 mulu ts2 respectively the analytical solution of eq 10 for this case is 11 u f ext k ν 1 cosh r x h 2 cosh r h 2 where r ν ϕ k ν b 2 n s ν for ϕ 1 n s and ν b ν and k was determined using eq 2 fig 3 shows the simulation results and analytical solutions cf eq 11 of the velocity profiles they are in excellent agreement over a wide range of n s i e within darcy σ da 0 5 k h 2 0 5 100 and brinkman 100 σ 1 regime 2 couette flow the couette flow was also studied for a single phase fluid in an homogeneous medium n s n s left n s right for which n s was varied in the range of n s 0 001 0 01 0 1 0 5 0 9 again velocity boundary conditions were applied to the boundary cells i e u 0 0 lu ts and u h u 0 0 01 lu ts the dimensions and the body force were h 50 lu l 50 lu and f ext 0 mulu ts2 respectively the analytical solution of eq 10 for this case is given as 12 u u 0 sinh r x sinh r h where again r 2 n s ν fig 4 shows the simulation results and the analytical solutions cf eq 12 of the velocity profiles they are in excellent agreement within the brinkman regime i e for n s 0 1 for larger values of n s i e in the darcy regime deviations are observed close to the boundary cells x h 0 95 this was also reported for other gs models and explained with an n s dependence of the no slip conditions chen and zhu 2008 zhu and ma 2013 3 open boundary flow the open boundary flow was studied for both a single phase fluid and a two phase fluid in an heterogeneous medium n s left n s right the influence of adhesion was neglected g ads σ 0 0 in the left half of the domain a constant value n s left 0 9 was chosen while n s right was varied in the range of n s right 0 001 0 01 0 1 0 5 0 8 instead of the boundary cells periodic boundary conditions along the x direction were applied the dimensions and the body force were h 100 lu l 50 lu and f ext 1 0 6 mulu ts2 respectively in case of the two phase flow the system was initialized with fluid 1 in the left half x 0 h 2 and fluid 2 in the right half of the domain x h 2 h the piece wise analytical solution of eq 10 for the open boundary flow is given as 13a u l u 0 l 1 1 p l cosh r l x h 4 sinh r l h 4 q l coth r r h 4 coth r l h 4 x 0 1 2 h 13b u r u 0 r 1 p r 1 cosh r r 3 h 4 x sinh r r h 4 q r coth r l h 4 coth r r h 4 x 1 2 h h the corresponding parameters u 0 p q and r are given in table 2 the labels l and r denote the left x 0 h 2 and the right x h 2 h half of the simulation domain respectively fig 5 shows the simulation results for a the single phase flow and b the two phase flow as well as the corresponding analytical solutions cf eq 12 for half the channel width only close to the interface x 1 4 3 4 h the results of the single phase flow are in excellent agreement over a wide range of n s right i e within darcy and brinkman regime the results of the two phase flow are also in good agreement with the analytical solutions however they are slightly overestimated for n s right 0 1 due to slip at the interface moreover the results indicate that the hmcsc inherently overcomes an issue of the gs wbs which was reported by zhu and ma 2013 and ginzburg 2016 they found that the gs wbs in the formulation of zhu and ma 2013 revealed a non physical velocity discontinuity at the interface for cases where n s left n s right 1 0 this was not observed here cf simulation with n s left 0 9 and n s right 0 8 and is assumed to be due to using the shan chen forcing scheme in the present study cf appendix b 3 3 bubble test the interfacial tension γ is an inherent thermodynamic property that depends on the molecular interaction of a set of immiscible fluids as well as on the thermodynamic state of the system therefore unlike in other gs models mcdonald and turner 2016 pereira 2016 it should not depend on the homogenization of a nanoporous medium this is especially important when the medium is heterogeneous i e n s is space dependent thus for each homogenized multi phase lb model to be physically consistent it has to be ensured that setting the model parameter g inter 12 to a constant value for the whole simulation domain does not lead to spatial variations of the interfacial tension this was verified using bubble tests the simulation setup is shown in fig 6 a the simulation domain consisted of an homogenized porous medium where all lattice cells had the identical bounce back fraction n s the system was fully periodic the dimensions of the simulation domain along the x and y direction were h the system was initially filled with a bubble consisting of fluid 1 which was submersed in fluid 2 both components had equal masses the pressure difference between the center of the bubble and its surroundings i e δ p p 1 p 2 as well as the bubble radius r were determined from the simulations therefrom γ follows laplace s law γ δ p r the influence of the parameters h g ads 1 n s and g inter 12 on γ was studied for the reference simulation case the parameters were h 100 lu g ads 1 0 0 n s 0 5 and g inter 12 1 75 unless specified otherwise the subsequent simulations used those default parameters fig 6 b shows the results of γ for different values of h g ads 1 n s and g inter 12 it was observed that γ does not depend on g ads 1 and n s this was also confirmed for bubble spreading in structurally resolved porous media and is shown in figure si 1 in the supporting information thus the interfacial tension was only affected by h and g inter 12 for increasing h γ decreased slightly and converged towards the asymptotic value γ 0 077 mu ts 2 this was related to the imprecise determination of the bubble radius r for small systems but worked well for h 100 lu in contrast the influence of the fluid fluid interaction g inter 12 on γ was large which was to be expected γ increased with increasing g inter 12 the results were in perfect agreement with the corresponding values reported by huang et al 2007 these were γ 0 051 0 078 0 104 mu ts 2 for g inter 12 1 50 1 75 2 00 respectively they were determined using the original mcsc which corresponds to using the hmcsc for n s 0 3 4 washburn simulations the washburn equation washburn 1921 14 x inter γ cos θ 2 η r eff t a b t describes imbibition into homogeneous and isotropic porous media as 1d flow through a bundle of cylindrical tubes with effective radius r eff the position of the moving interface is denoted by x inter the equation is only valid if gravity is negligible das and mitra 2013 li et al 2015 the flow is driven by the interplay of capillary forces and viscous forces where the former depend on the interfacial tension γ and the contact angle θ and the latter are determined by the dynamic viscosity of the fluid η ρ ν the parameters a and b in eq 14 are fit parameters that are used in the following to fit the simulation data to the washburn equation the simulation scenario consisted of a homogenized porous medium in which all lattice cells had the identical bounce back fractions n s the system dimensions along the x and y direction were h 500 lu and l 5 lu respectively the system was initially filled with fluid 2 the densities of fluid 1 and fluid 2 were prescribed at the inlet ρ 1 x 0 and outlet ρ 2 x h respectively periodic boundary conditions were applied along the y direction fluid 1 penetrated into the simulation domain in y direction and displaced fluid 2 the influence of the solid fluid interaction and bounce back fraction was studied correspondingly the contact angle θ was varied by changing g ads in the range of g ads g ads 1 0 05 0 40 and the permeability or effective radius r eff was varied by changing n s in the range of n s 0 1 0 5 0 9 fig 7 shows the simulation results for different values of g ads and n s results are given for t 5 1 0 4 ts this corresponds to the washburn regime x inter t where viscous effects dominate the flow das et al 2012 das and mitra 2013 li et al 2015 the data was used for fitting the washburn equation eq 14 for the simulations shown in fig 7 a n s 0 5 and only g ads was varied while for the simulations in fig 7 b g ads 0 2 and only n s was varied correspondingly for all fits in fig 7 a parameter b was the same and only a was freely adapted vice versa for all fits in fig 7 b a was fixed and only b was fitted to the simulations overall the fits and the data are in good accordance this is also confirmed by the large coefficients of determination i e r a 2 r b 2 0 97 the values for a and b as well as θ and r eff are given in table 3 in addition θ determined from the washburn simulations was compared with the correlation for the contact angle of huang et al 2007 15 cos θ h 4 g ads 2 g inter 12 ρ 1 ρ dis 2 which was derived from sessile droplet simulations using the original mcsc interestingly a good accordance of θ and θ h was observed especially for θ 0 60 for larger values of θ the correlation slightly overestimated the simulation results this was to some extent also observed in the paper of huang et al 2007 and is amplified by the increasing uncertainty of the fitting for θ 60 cf r a 2 in table 3 3 5 porous obstacle flow the last test concerned the simultaneous occurrence of free flow and darcy brinkman flow it followed an example of spaid and phelan 1998 which is also typically used as advanced benchmark in the literature yoshida and hayashi 2014 silva and ginzburg 2015 pereira 2016 the simulation scenario is shown in fig 8 a it consisted of a channel with five circular porous obstacles with diameter 2 r 33 lu from which the center to center distance was d 60 lu the dimensions of the system along the x and y direction were l 300 lu and h 50 lu respectively periodic boundary conditions were applied along the y direction the system was initially filled with fluid 2 the densities of fluid 1 and fluid 2 were prescribed at the inlet ρ 1 x 0 and outlet ρ 2 x l respectively a body force f ext 5 1 0 5 mulu ts2 in x direction was applied to both fluids leading to fluid 1 penetrating into the simulation domain to ensure consistency with the simulations of spaid and phelan 1998 viscous effects of fluid 2 within the obstacles were neglected by setting n s 2 0 in all lattice cells of the domain in contrast n s 1 was set to n s 1 0 1 0 5 0 9 within the obstacles to account for the darcy brinkman type behavior of fluid 1 and to n s 1 0 for all other lattice cells thus large viscosity ratios between the two fluids in the porous obstacles could be mimicked without running into numerical instabilities this scenario can be mathematically described by darcy s law 16 d x inter d t k unsat ϕ η f ext where x inter is the interface position k unsat is the permeability of the unsaturated system ϕ is the effective porosity of the obstacles η is the dynamic viscosity of fluid 1 and f ext is the body force the analytical solution of eq 16 is 17 x inter k unsat ϕ η f ext t which was used to determine k unsat from the simulations representative snapshots of the simulations at t 50 000 ts are shown in fig 8 b d for different values of n s 1 they reveal that increasing n s 1 retards the filling of the channel for n s 1 0 9 even a distinct bubble or droplet formation within the porous obstacles was observed these results agree qualitatively with results from the literature spaid and phelan 1998 pereira 2016 complementary fig 9 shows quantitative simulation results and the corresponding fits to eq 17 for different values of n s 1 the position of the interface was determined as x inter l 2 s 1 y 0 s 1 y h 2 where the proportions of cells in the boundary and the center column of the simulation domain which were filled with fluid 1 were denoted s 1 y 0 and s 1 y h 2 respectively the oscillations around the linear fits correspond to alternating deceleration and acceleration of the fluid front which depends on the varying width of the free flow channel the unsaturated permeabilities k unsat were determined fitting eq 17 to the simulation data the corresponding permeability of a saturated medium k sat was determined following the lubrication theory of phelan and wise 1996 both k unsat and k sat are given in table 4 the data shows that k unsat k sat and its ratio k unsat k sat decreases for increasing n s 1 these results are in qualitative agreement with simulative spaid and phelan 1998 yoshida and hayashi 2014 and experimental parnas et al 1995 observations 3 6 numerical stability multi component models in general are numerically stable for a limited range of density and viscosity ratios only krueger et al 2016 chen et al 2014 moreover due to an imbalance of discretized forces especially at curved interfaces they typically show spurious currents which can exacerbate the occurrence of numerical instabilities connington and lee 2012 also the original mcsc on which the hmcsc is based is known to suffer from spurious currents connington and lee 2012 chen et al 2014 it is stable for a maximum density ratio of 2 as well as a maximum viscosity ratio of 5 10 kang et al 2002a 2004 chen et al 2014 krueger et al 2016 remedies for those issues have been discussed in the literature shan 2006 sbragaglia et al 2007 connington and lee 2012 chen et al 2014 they were however not in the focus of this study to ensure that the coupling of mcsc and gs i e the hmcsc maintains the numerical stability characteristics of the original mcsc the aforementioned two phase flow benchmark scenarios from this section were conducted for different viscosity ratios m ν 2 ν 1 and density ratios g ρ 1 ρ 2 thus bubble tests washburn simulations and porous obstacle flows were simulated using the same simulation setups and model parameters as described in the corresponding subsections unless they are specified otherwise washburn simulations were conducted for m 5 g inter 12 2 75 g 1 m 10 g inter 12 2 25 g 1 and g 2 g inter 12 1 75 m 1 for each of the cases n s was varied in the range of n s 0 1 0 5 0 9 and g ads 1 was varied in the range of g ads 1 0 2 0 0 0 2 porous obstacle simulations were conducted for the same parameter set while fixing g ads 1 0 0 for the bubble test the system was initialized close to mechanical equilibrium i e g 1 and the viscosity ratio m 5 10 with g inter 12 2 75 2 25 respectively and n s 0 0 0 1 0 5 0 9 were varied all simulations i e m 10 and g 2 were numerically stable this is a strong indicator that the coupling of mcsc and gs via hmcsc has no negative effect on the numerical stability in the following exemplary results are shown for the bubble test scenario only all other results are given in the supporting information fig 10 shows results of γ for m 5 and m 10 for different values of g ads 1 and n s each it can be observed that γ does hardly depend on g ads 1 and n s thus the interfacial tension is only affected by g inter 12 and the viscosities or τ respectively this is in agreement with the results shown in fig 6 b for m 1 and g 1 also the spurious currents were analyzed for the bubble test scenario results are shown in fig 11 for m 1 and m 5 there the results for n s 0 0 correspond to the original mcsc it can be observed that larger viscosity ratios induce larger spurious currents and thus are numerically more unstable this effect is however reduced when increasing n s i e decreasing the permeability of the porous medium cf fig 1 a when e g increasing n s from 0 0 to 0 9 the maximum velocity of spurious currents v max is reduced by two orders of magnitude 3 7 discussion in this section the hmcsc was successfully validated using different single and two phase flow benchmark scenarios altogether they demonstrate the broad applicability of the coupling approach presented here moreover and just as important it was shown that the hmcsc inherits all positive attributes and numerical stability characteristics from the original mcsc the gs wbs and its multi phase extension by pereira 2016 at the same time the hmcsc overcomes some deficiencies of these methods i e non physical discontinuities of interfacial tension and velocity at interfaces between different porous media the features of the hmcsc are briefly summarized as follows 1 as was shown by the bubble tests the interfacial tension γ is independent of n s and g ads thus the interfacial tension is a property of the fluids only and is not affected by the homogenization this was also shown to be valid for viscosity ratios and density ratios above 1 2 as was shown by the washburn simulations also the contact angle θ is independent of n s it is a property of the solid fluid material combination only and is also not affected by the homogenization 3 as was shown by the open boundary darcy brinkman flow simulations the hmcsc inherently ensures velocity continuity at interfaces of porous media with different n s no additional smoothing procedure as suggested by yehya et al 2015 is required 4 the hmcsc is fully consistent with the original mcsc thus the values for g ads and g inter can be chosen identical to the values that are used for the original mcsc the same parametrization approach following the paper of huang et al 2007 as well as eq 15 can be applied to study the identical physical situations no further parametrization is required 5 the hmcsc is especially suitable for studying multi phase flow in heterogeneous porous media where both the wetting properties and the permeability vary in space and time while the physical properties of the fluid mixture are unaffected 6 the hmcsc is accurate intuitive and easy to implement regarding its numerical stability the hmcsc shows similar characteristics as the original mcsc i e it is stable for density ratios up to 2 and viscosity ratios up to 5 10 moreover spurious currents can even be reduced when increasing n s in contrast to most other gs models thorne and sukop 2004 chen and zhu 2008 zhu and ma 2013 2018 including the model proposed by pereira 2016 where forces were included using the guo forcing scheme guo et al 2002 the hmcsc uses the common shan chen forcing scheme although this leads to a τ dependence of the viscosity yu and fan 2010 silva and ginzburg 2015 it involves substantial advantages over the aforementioned models the corresponding differences and their potential effects are briefly discussed in appendix b 4 application and results practical applications of the hmcsc are most scenarios in which multi phase fluid flow occurs in multi scale porous media in the context of hydrology geoscience and petroleum engineering the hmcsc can be especially interesting to study transport in pores vugs and microfractures simultaneously while also considering local changes of the permeability due to geochemical or biological processes thus the hmcsc might be helpful to predict and gain insight into groundwater hydrology geologic carbon storage and sequestration and the recovery of oil and gas from different multi scale porous rocks such as sandstones carbonates and shale krevor et al 2012 ghezzehei 2012 mehmani et al 2015 soulaine et al 2019 mehmani et al 2020 hassannayebi et al 2021 however as the research focus of our group is on energy storage materials here the electrolyte filling of lithium ion batteries was studied exemplarily the pore sizes in such microstructures typically range from nano to micrometers and its filling is not yet fully understood thus it is of recent research interest with the objective to optimize the corresponding manufacturing process as well as the battery performance and lifetime wood et al 2015 weydanz et al 2018 a realistic 3d reconstruction of a lithium ion battery cathode westhoff et al 2018 with a porosity of ϕ a 40 and neutral wetting conditions was used as a geometrical basis for all simulations the filling of three variants of this structure was studied 1 the pure electrode structure 2 the electrode structure infiltrated with v b 21 volume fraction of a nanoporous binder and 3 the electrode structure attached to a nanoporous and fully homogenized separator for which the generation is described in appendix c the contact angles of the active material binder and separator were θ a 90 θ b 60 and θ s 90 respectively they were converted to the model parameter g ads 2 g ads 1 using eq 15 the bounce back fractions in the homogenized porous media were n s n s 1 n s 2 0 5 for the binder while in the separator n s was space dependent and identical to the normalized grayscale value of each voxel of the separator image data fig 12 shows the schematic simulation setup where also the three different variants of microstructures are indicated it is similar to the setup that was used in a recent study of our group lautenschlaeger et al 2022 in which the electrolyte filling process was studied in very detail initially the pore space was filled with gas only periodic boundary conditions were applied along the x and z direction along the y direction an electrolyte reservoir and a gas reservoir were added at the inlet and outlet respectively the reservoirs had a thickness of four layers each in which the density of both fluids was prescribed the initial electrolyte density at the inlet was ρ 1 and was incrementally increased during the simulation run the gas density at the outlet was constant i e ρ 2 thereby a pressure difference between the two fluids was applied to drive the electrolyte imbibition cf eq 18 between the reservoirs and the microstructures semi permeable membranes were placed to prevent an unwanted fluid breakthrough the inlet membrane was permeable for the electrolyte only the outlet membrane was permeable for the gas only this approach is in accordance with imbibition experiments and simulations that are typically used to analyze porous media in the context of geoscience or energy storage materials gostick et al 2008 karpyn et al 2009 pini et al 2012 krevor et al 2012 zhao et al 2015 danner et al 2016 tavangarrad et al 2019 zhu et al 2021 lautenschlaeger et al 2022 the model parameters for the simulations are given in table 1 where fluid 1 and fluid 2 correspond to electrolyte and gas respectively from each simulation pressure saturation curves were determined they are a characteristic property of porous media and relate the pressure difference δ p needed for the imbibition to the amount of electrolyte in the pore space i e the saturation s 1 the pressure difference δ p was determined as 18 δ p p inlet p outlet where p was evaluated using eq a 6 and p denotes the average pressure in the inlet and outlet reservoirs the electrolyte saturation s 1 was determined as 19 s 1 n pore ρ 1 0 5 1 n s n hom ρ 1 0 5 n pore 1 n s n hom where the denominator and numerator correspond to the total pore space and the pore space in which ρ 1 0 5 mu lu 3 respectively the number of pore lattice cells in the electrode structures and the homogenized nanoporous components are denoted by n pore and n hom respectively the latter were multiplied by the effective fluid fraction 1 n s note that for the calculation of the saturation only the lattice cells between the two membranes were considered a simulation run consisted of approximately 1 000 000 time steps the pressure difference and the saturation were determined every 10 000 time steps during the production run the simulations stopped when a further saturation was not possible and led to a steep increase of δ p fig 13 a shows the pressure saturation curves for the three different microstructures they follow a sigmoidal behavior which is typically observed in the literature and can be explained based on the young laplace equation for all cases the final saturation s 1 final deviated from the theoretical optimum of 100 which indicates residual gas being entrapped in the pore space weydanz et al 2018 sauter et al 2020 a remarkable influence of the homogenized microstructures was observed compared to the pure electrode the pressure saturation curve for the electrode with binder shows a similar qualitative behavior but appears to be shifted by δ p 0 and s 1 0 thus by infiltrating a binder the characteristics of the pore space were largely maintained only the enhanced wetting of the binder facilitated the electrolyte imbibition led to a reduction of δ p and increased s 1 final close to 100 the pressure saturation curve for the electrode attached to the separator shows a stronger influence as also the proportion of homogenized medium was larger compared to the structurally resolved electrode for s 1 15 it behaves similar to the pure electrode but is shifted by s 1 0 this similarity is because the electrolyte had not yet reached the separator but was influenced by the pure electrode only at larger saturations a pressure plateau is reached which was also observed in the literature tavangarrad et al 2019 sauter et al 2020 here it corresponds to the smooth filling of the fully homogenized separator along this plateau the pressure increased by 0 4 kpa only while at the end of the filling a large pressure increase was observed due to the electrolyte imbibition into the small pores of the electrode however a notable gas entrapment remains note that in general the shift along s 1 0 for the homogenized microstructures was also influenced by the definition of the saturation cf eq 19 where adding lattice cells with a bounce back fraction n s 0 led to a reduction of the total pore space fig 13 b d show snapshots of simulation cross sections x y plane at t 400 000 ts for the three different microstructures the corresponding state points on the pressure saturation curves are indicated by the hashes in fig 13 a compared to the pure electrode cf fig 13 b in fig 13 c slightly more electrolyte is imbibed into pores with binder fig 13 d shows the electrolyte distribution in the resolved electrode and the homogenized separator while the electrode part is not yet completely filled a breakthrough of the electrolyte into the separator is observed this state corresponds to the pressure plateau shown in fig 13 a moreover fig 13 d indicates some interesting model related phenomena on the one hand the heterogeneity of n s values in the separator can be used to mimic structural effects that influence gas entrapment the flow orientation and deformation of the electrolyte gas interface on the other hand and even more importantly the interface thickness in the homogenized separator is constant and not affected by the distribution of n s it is also identical to the interface thickness in the structurally resolved pores for which n s 0 similar simulations were conducted by a different research group in an earlier study pereira 2019 for a two phase flow g 1 m 1 in a tight sandstone sample composed of different partially permeable minerals using the approach of pereira 2016 the results there confirm that pereira s method has deficiencies with respect to discontinuities of properties in heterogeneous porous media more specifically figures 7 and 8 in pereira 2019 show strong density variations within the invading fluid phase this is most likely a model artifact and related to a non physical diverging interface thickness in the partially permeable regions in contrast the simulation results of the current study determined using the hmcsc do not show such density variations this gives further evidence of the potential and strength of the hmcsc moreover it demonstrates possible applications of multi phase flows in heterogeneous porous media going beyond electrochemical energy storage showcased in this work 5 conclusion a simple but effective lattice boltzmann approach was presented which is especially useful for the simulation of multi phase flows in heterogeneous porous media but can also be used to study single phase flows it follows the approach of pereira 2016 and combines the grayscale method of walsh et al gs wbs walsh et al 2009 i e a homogenization approach with the multi component shan chen model mcsc shan and chen 1993 therefore it was called the homogenized multi component shan chen method hmcsc the hmcsc was tested using a broad variety of benchmark scenarios that are typically used to validate single and two phase flow phenomena in porous media the results were compared to analytical and semi analytical solutions where available and shown to agree well in addition the hmcsc was applied to study the electrolyte filling of different variants of a realistic 3d reconstruction of a lithium ion battery microstructure hereby the hmcsc was shown to reproduce the relevant physical phenomena also within the homogenized nanoporous binder and separator for example including the wetting binder led to a reduction of the capillary pressure and an improvement of the final degree of saturation which is beneficial for the battery performance moreover when adding the fully homogenized separator with space dependent n s values structural effects which influence gas entrapment characteristic flow paths and the deformation of the electrolyte gas interface were mimicked appropriately the hmcsc brings together the physical as well as numerical characteristics of gs wbs and mcsc i e it is applicable to immiscible fluids with viscosity ratios of up to 5 10 in addition it overcomes some deficiencies of gs wbs as well as the model reported by pereira 2016 which are related to discontinuities of properties in heterogeneous porous media in contrast to the aforementioned methods the hmcsc is consistent with the original mcsc this means the mcsc related model parameters g ads and g inter can be chosen identically to the parameters in the original mcsc cf huang et al 2007 the corresponding physical properties i e contact angle and interfacial tension are not affected by the homogenization they are constant and properties of the fluid only even in heterogeneous porous media where n s is space dependent thus no further parametrization is required moreover in contrast to the gs wbs no artificial force and velocity discontinuity was observed at interfaces between different porous media we assume that this is due to the shan chen forcing scheme that was used for the hmcsc altogether the hmcsc is physically motivated accurate and efficient nonetheless it is simple intuitive easy to implement and allows a straightforward parametrization that is consistent with the original mcsc moreover the hmcsc shows similar numerical stability characteristics the results are promising and give cause to believe that techniques which alleviate limitations of the original mcsc are equally applicable to the hmcsc by the right choice of model parameters the hmcsc can be applied to all situations for which either the original mcsc or the gs wbs can be used however the hmcsc is not restricted to these particular applications all other research fields where multi phase fluid flow occurs in heterogeneous and multi scale porous media can benefit from this method too potential applications are subsoil or groundwater flow pereira 2016 ning et al 2019 oil recovery via water injection spaid and phelan 1998 welge 1952 biofilm growth in porous structures jung and meile 2021 the characterization of gas diffusion electrodes danner et al 2016 water transport in gas diffusion layers zhu et al 2021 or electrolyte filling of batteries shodiev et al 2021 lautenschlaeger et al 2022 credit authorship contribution statement martin p lautenschlaeger conceptualization investigation methodology software validation visualization writing original draft julius weinmiller validation writing review editing benjamin kellers formal analysis writing review editing timo danner conceptualization writing review editing arnulf latz funding acquisition writing review editing declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments the authors gratefully acknowledge financial support from the european union s horizon 2020 research and innovation programme within the project defacto under the grant number 875247 the simulations were carried out on the hawk at the high performance computing center stuttgart hlrs under the grant laboresys and on justus 2 at the university ulm under the grant inst 40 467 1 fugg appendix a lattice boltzmann method lbm solves the discretized boltzmann equation a 1 f i x c i δ t t δ t f i x t δ t τ f i x t f i eq x t using discrete distribution functions f i also referred to as populations this approach uses the bgk collision bhatnagar et al 1954 which describes the relaxation of f towards the maxwell boltzmann equilibrium distribution function f eq cf eq a 3 with a characteristic relaxation time τ the relaxation time determines the kinematic viscosity via ν c s 2 τ 1 2 δ t where c s 2 is the velocity set dependent lattice speed of sound the discretization of eq a 1 is done in velocity space on a regular square or cubic lattice for 2d and 3d respectively each lattice cell is linked to its adjacent neighbors denoted with i the resulting velocity sets c are called d2q9 and d3q27 which is often reduced to d3q19 for efficiency and are given in eqs a 7 a 8 for completeness t and x denote time and lattice location with δ t and δ x being the temporal and spatial step for the non dimensional computationally efficient form δ x and δ t are unity as such they are usually omitted but are included in this work for clarity and dimensional consistency the homogenization approach by walsh et al 2009 is a 2 f i x c i δ t t δ t 1 n s x f i x t 1 n s x δ t τ f i x t f i eq x t n s x f i x t here n s 0 1 acts as an interpolation factor that scales the fluid and solid behavior of f from all populations f in a lattice cell the fraction 1 n s is allowed to flow freely and therefore behaves fluid like cf first and the second line of eq a 2 while the fraction n s is bounced back and therefore behaves solid like cf third line of eq a 2 the latter term uses the pre collision populations which is highlighted by t the symbol i denotes the direction opposite to i with the exception i 0 i note that for n s 0 eq a 2 is equivalent to the default lb bgk equation that describes pure fluid flow eq a 1 while for n s 1 it corresponds to pure bounce back that describes a no slip wall the mcsc approach has been fully covered in section 2 it is iterated that for each component σ used a unique discrete population function f σ is needed therefore in the following σ is explicitly mentioned in all equations a 1 maxwell boltzmann distribution the maxwell boltzmann equilibrium distribution function is given by a 3 f i σ eq w i ρ σ 1 c i u σ eq c s 2 c i u σ eq 2 2 c s 4 u σ eq u σ eq 2 c s 2 here w i are the lattice specific weights ρ σ is the fluid density of component σ cf eq a 4 and u eq is the equilibrium velocity cf eq 6 a 2 multi phase physical quantities the macroscopic physical quantities can be recovered from the discrete distribution function in the following they are expressed in terms of multiple phases but apply for single phase fluids as well the fluid density of component σ is the zeroth moment of f σ and determined as a 4 ρ σ i f i σ the velocity of component σ is the first moment of f σ and determined as a 5 u σ 1 ρ σ i f i σ c i the total pressure p of the mixture follows the ideal gas law it is extended by a contribution from the fluid fluid interaction which is especially relevant at the interface p is determined as a 6 p x c s 2 ρ x g inter σ σ ρ σ x ρ σ x δ t 2 a 3 velocity sets the hmcsc has been implemented for both 2d and 3d simulations the corresponding velocity sets used for the simulations of the present work i e d2q9 and d3q19 are given in the following d2q9 a 7 c 0 c 1 c 2 c 3 c 4 c 5 c 6 c 7 c 8 δ x δ t 0 1 1 1 0 1 1 1 0 0 1 0 1 1 1 0 1 1 the d2q9 weights are w i 4 9 for c i 0 w i 1 9 for c i 1 and w i 1 36 for c i 2 with the speed of sound c s 1 3 δ x δ t d3q19 see box i the d3q19 weights are w i 1 3 for c i 0 w i 1 18 for c i 1 and w i 1 36 for c i 2 with the speed of sound c s 1 3 δ x δ t appendix b guo vs shan chen forcing it has been reported in literature zhu and ma 2013 yehya et al 2015 ginzburg 2016 and also mentioned in the main text of this paper that using the gs wbs can result in velocity discontinuities at interfaces between different porous media this was not observed when using the hmcsc cf fig 5 the reason might be due to the fact that the hmcsc uses the shan chen forcing scheme shan and chen 1993 while the guo forcing scheme guo et al 2002 was used for the simulations reported in zhu and ma 2013 ginzburg 2016 the differences between both forcing schemes are briefly outlined in the following for brevity regarding the notation the position x is omitted and the time step is indicated in the exponent the meaning of which is t is the current time step and t denotes the state just before streaming to emphasize and avoid confusion t is used in addition to denote the pre collision state b 9 gs wbs f i t 1 n s f i t 1 n s δ t τ f i t f i eq t u macro n s f i t 1 n s f i f tot u macro b 10 hmcsc f i t 1 n s f i t 1 n s δ t τ f i t f i eq t u eq n s f i t eqs b 9 b 10 show the gs type lb bgk equation in the guo and shan chen forcing scheme respectively the most obvious difference between both is the force term f i in eq b 9 it is directly dependent on the total force f tot the whole term is scaled by the factor 1 n s this means that also the fluid fluid and solid fluid force contributions are scaled by 1 n s leading to an n s dependent interfacial tension and wetting behavior which was shown to be circumvented when using the hmcsc moreover at the interface between two porous media from which the n s values differ the force term is also scaled differently which might be one reason for the force and velocity discontinuity observed in the literature zhu and ma 2013 yehya et al 2015 ginzburg 2016 another might be that f tot enters also indirectly into eq b 9 via u macro which in the guo forcing scheme is needed for the calculation of f eq however as u macro itself is already scaled by 1 n s cf eq 7 the factor 1 n s might be unintentionally considered several times for the force calculation now considering the shan chen forcing scheme the situation is much clearer f tot is only indirectly incorporated into u eq cf eq 6 which in the shan chen forcing scheme is needed for the calculation of f eq thus a repeated scaling by 1 n s is impossible nevertheless the actual reason why gs wbs in guo forcing leads to velocity discontinuities while it does not when using the hmcsc in the shan chen forcing scheme remains still unclear a detailed analysis would be necessary which however goes far beyond the scope of this study appendix c data c 1 maximum velocity in open boundary flow the maximum velocities in lattice units for the open boundary flow validation test are presented in table c 1 c 2 structure generation of homogenized separator the homogenized separator structure has been created by downsampling the original binarized image by a factor of 20 in each direction the original structure consisted of 600 820 560 voxels with a voxel length of 2 19 1 0 8 m this structure has been subdivided into 20 20 20 cubes with the volume fraction of each cube being the mean volume fraction of its containing voxels the resulting structure is of shape 30 41 28 the voxel length i e 4 38 1 0 7 m is identical to that of voxels of the electrode structure but since the electrode structure is much larger the separator has been stacked multiple times in both directions perpendicular to the filling direction to fit the dimensions of the electrode this procedure seems trivial and one could get the impression that it would be possible to run simulations using the gray values from ct images directly however as discussed in ref baveye et al 2017 this is not the case the model parameter called the bounce back fraction n s does not correspond to the physical bounce back fraction that is determined through images with no information about the actual penetrability of the material the relation between the physical parameter and the model parameter can only be guessed to overcome this limitation investigating a method for converting both will be one topic of our future research appendix d supplementary data supplementary material related to this article can be found online at https doi org 10 1016 j advwatres 2022 104320 appendix d supplementary data the following is the supplementary material related to this article mmc s1 supporting information homogenized multi phase lattice boltzmann model 
83,the shear flow generated by natural convection in porous media considerably influences the dispersion of contaminants in various geological formations previous studies have revealed that the dispersion coefficient depends on the péclet number pe shear rate and complex pore structures in this study the dispersion behavior of a nai tracer cloud was investigated under different shear rates ranging from 0 001 to 0 04 s 1 and pe ranging from 10 to 200 using an innovative experimental apparatus via an x ray technique in contrast to uniform flow a considerably enhanced dispersion was observed in shear flow along the longitudinal direction and spreading in the longitudinal and transverse directions grew with time as t 3 and t respectively in the power law regime the dispersion behaviors in the transverse and longitudinal directions were strengthened by shear action with a larger dependence of the power law on the shear rates and pe compared with that in the uniform flow the strengthened dispersion promoted the formation of a hyper mixing state which was evaluated using the temporal evolution of the maximum concentration of the tracer plume dilution index and scalar dissipation rate the results indicate that the dispersion behavior in a two dimensional shear flow is quantitatively equivalent to that in a four dimensional uniform flow field the findings of this study can provide a deeper understanding of the influence of shear flow on the hydrodynamic dispersion in porous media keywords solute transport porous media x ray images shear flow hydrodynamic dispersion data availability data will be made available on request 1 introduction dispersion in porous media is a typical solute transport phenomenon that occurs in diverse scientific and engineering fields such as contaminated groundwater remediation michael and khan 2016 radioactive waste disposal wang and zhan 2013 enhanced oil recovery eor suekane et al 2019 and carbon dioxide capture and storage ccs andrew et al 2013 the effective transport of solutes or dissolved constituents can be significantly affected by the convective flow of miscible fluids in the porous media for a shear flow the fluid velocity is driven by forces that vary linearly with a distance perpendicular to the direction of the main flow the local shear action of the flow fields can generate local velocity fluctuations that can impact the efficiency of various industrial processes for example the shear action at the water oil two phase interface may contribute to the fast spreading and mixing of surfactant polymer molecules in the oil reservoir which plays a key role in the chemical enhanced oil recovery technique nagatsu et al 2007 berg and van wunnik 2017 foroozesh and kumar 2020 2022 in addition the shear flow associated with the density driven natural convection of co2 and brine water can significantly enhance the mass transfer rate thereby reducing the time required for the transition of co2 from the buoyancy state into the dissolved phase which in turn improves the efficiency and security of co2 storage nakanishi et al 2016 suekane et al 2017 wang et al 2018 sin et al 2019 shear dispersion describes the enhanced spreading and mixing of solutes due to the velocity gradients of flow fields young and jones 1991 and it is important for the spreading mixing and mass transfer of solute plumes aquino and bolster 2017 souzy et al 2018 this transport property can be characterized by a time dependent dispersion coefficient d which depends on the properties of the porous media e g geometry local heterogeneity and permeability péclet number pe and shear rate bijeljic et al 2013 jimenez urias and haine 2021 souzy et al 2020 studies have numerically verified that dispersion is related to the shear rate for viscous fingering suekane et al 2017 lindner et al 2002 as velocity gradients are generated owing to the viscosity difference resulting from a locally high pe 10 sin et al 2019 dispersion at the tips of the fingers is promoted nakanishi et al 2016 wang et al 2018 muharrik et al 2018 particularly in the transverse direction wang et al 2016 thus the shear stresses of the two phases at their interface result in enhanced mixing as well as heat and mass transfer during solute transport in multiple fields chequer et al 2020 omirbekov et al 2020 tran and jha 2021 yizhaq et al 2021 parvan et al 2021 therefore further studies on the impact of shear enhanced dispersion on the mixing and mass transfer rates are required for shear flow in porous media dispersion behaviors are characterized by a range of pe values in the transition zone where the effects of molecular diffusion and mechanical dispersion are of the same order of magnitude thiele 1997 this transition zone is considered as the power law regime when the range of pe is 5 300 sahimi 1993 the migration of a tracer in the interface region of two fluids with viscosity differences has been comprehensively studied at the microscale level within porous media hinton and woods 2020a 2020b for a simple shear flow at a constant shear rate the evolution of the solute plume follows different time dependent laws corresponding to different timescales dentz et al 2018 a model was built in a ciliated channel to analyze shear rate dependent flow abbas and wang 2021 in addition the impact of pure forced convection on the particle motion behavior and dissolution time in shear flow was simulated using the spm lbm method safa et al 2021 shear driven vortex flow was studied using a turbulence model saqr et al 2010 furthermore a strong mixing state was predicted in which a two dimensional linear shear flow field quantitatively corresponded to an equivalent four dimensional homogeneous system bolster et al 2011a a shear enhanced mixing model was developed to study the dynamics of non fickian dispersion evolution of concentration gradients and mixing state at the pore scale jiménez martínez et al 2017 although shear enhanced dispersion has been adequately characterized via numerical and simulation research zhang et al 2021 experimental evidence is inadequate owing to the difficulties in generating an ideal linear velocity gradient therefore an innovative quarter annulus shaped device was designed in this study to investigate the dispersion phenomenon in multiple shear flows by modifying its inner radius while maintaining a constant outer radius in this study a new elbow shaped device is designed to generate velocity gradients that can be approximated locally as linear shear flow tracer dispersion experiments are conducted using the device to examine the transport process of a sodium iodide nai plume in a packed bed of glass beads saturated with a sodium chloride nacl solution under different velocity fields the experiments are conducted for shear rates ranging from 0 02 to 1 75 s 1 and pe ranging from 5 to 300 power law regime of which the solute transport process is simultaneously visualized using a micro x ray computed tomography ct scanner dispersion experiments in uniform flow fields under the same values of pe are conducted as control trials the dispersion coefficients obtained from the shear flow field are comprehensively compared with those obtained from a uniform flow field finally the mixing state is evaluated based on the maximum concentration of the tracer plume dilution index and scalar dissipation rate 2 experimental protocol 2 1 experimental device fig 1 shows a schematic of the experimental system with a micro x ray ct scanxmate cf110tss300 comscantecno co ltd kanagawa japan to non destructively analyze the solute transport process of the nai tracer plume the container consisted of two acrylic plates two plates were spaced apart with a layer of silicone rubber sheets as the seal and bonded using screws and nuts to avoid leakage the packed bed was designed in a quarter annulus shape inner radius r1 20 25 and 30 mm outer radius r2 50 mm depth 5 mm and one of the plates was hollowed out to create an approximately linear velocity gradient in the fluid a micro syringe pump was connected at the inlet point kds100 kd scientific inc holliston usa whereas the outlet point was connected to a tube that led the ejected fluid to a waste tank sintered glass filters were installed at the inlet and outlet of the device to ensure a steady flow field and prevent the leakage of experimental particles the pressures at the inlet and outlet boundaries were considered to be constant p in out const p θ const a hole with a diameter of 5 mm on the top plate was designed to inject the nai tracer the hole was sealed with a silicone rubber septum shimadzu glc ltd tokyo japan and pierced with an injection micro syringe to avoid the inlet effect the tracer injection point was located 18 mm from the inlet according to darcy s law the average interstitial velocity uav can be expressed as 1 u a v k μ p where k is the permeability of the porous medium μ is the fluid dynamic viscosity and p is the pressure gradient along the flow direction because the pressures at the inlet pin and outlet pout of the device were constant the interstitial velocity u is inversely proportional to the length of any arc l and the radius r of the annulus as expressed in eq 2 2 u k μ p o u t p i n l 2 k μ p i n p o u t π r the elbow shaped device was designed for multiple velocity fields fluid shear by modifying the parameter of its inner radius while maintaining a constant outer radius in addition a straight channel with dimensions of 50 mm 30 mm 5 mm was used as the control trial table 1 presents the properties of the three elbow shaped devices and straight channel 2 2 experimental materials an unconsolidated packed bed was selected as the porous medium in this study glass beads with a diameter of 400 50 μm as one co ltd osaka japan were densely packed inside the container a thin layer of fine glass beads 100 μm was attached to the internal wall to eliminate the boundary effect considering its low permeability the porosity of the packed bed was estimated to be 38 by measuring the weight change before and after water saturation the porous medium was considered homogeneous because of the uniform size of the glass beads in this experiment the nacl solution was selected as the default solution for visualization purposes nai solution was used as the tracer the resulting densities of the nacl and nai solution fluids were 1 05 and 1 06 g cm3 respectively 2 3 experimental procedures the experimental container was initially packed with glass beads and fully saturated with a nacl solution to eliminate undesirable gases in the vacuum chamber the nacl solution was continuously injected at a given volume flow rate table 2 to create a stabilized flow field an x ray image was obtained under the initial conditions subsequently 0 1 ml nai tracer solution was instantly injected into the porous medium via a micro syringe pump with a needle pierced on the silicone rubber septum forming a tracer cloud with an area of 8 10 8 m2 thus the tracer plume had a diameter of 8 18 mm e g calculated by q ϕ h π 4 d 2 d 8 18 mm thereafter 0 6 pore volume pv of the nacl solution was continuously injected upward from the bottom of the packed bed the experimental parameters are listed in table 2 pe is defined as the ratio of the advection and diffusion rates to the characteristic number of the flow rate which is calculated as 3 p e u a v l d m q a d p ϕ d m where q ml h is the injection flow rate of the nacl solution a m2 is the cross sectional area of the packed bed which is presented in table 1 dp μm is the experimental particle diameter of the glass beads dp 400 μm which was selected as the characteristic length l in this case φ is the porosity uav m s is the average fluid interstitial velocity and dm m2 s is the molecular diffusion coefficient of iodide ions in water here dm corresponds to the self diffusion coefficient for the infinite dilution of nai in water which is a constant of 2 10 9 m2 s wang and kennedy 1950 tartakovsky and dentz 2019 perkins and johnston 1963 furthermore two characteristic timescales related to blob diffusion and shear rate were defined the timescale associated with the diffusion behavior is expressed as t d σ 0 2 2 d m dentz et al 2018 whereas that associated with the shear action of the velocity field is denoted by the inverse of the shear rate t γ 1 γ berg and van wunnik 2017 souzy et al 2018 the characteristic number of shear rates representing the importance of the shear enhanced dispersion with respect to the molecular diffusion is defined as the ratio of the two timescales expressed as 4 p e γ t d t γ γ σ 0 2 2 d m where σ 0 2 is the plume area of the tracer blob which is a constant value of σ 0 2 8 10 2 m m 2 based on the initial injected volume of the nai tracer 0 1 ml dm is the self diffusion coefficient for the infinite dilution of nai in water dm 2 10 9 m2 s wang and kennedy 1950 tartakovsky and dentz 2019 perkins and johnston 1963 and γ is the shear rate which can be estimated as the gradient of the velocity expressed as γ d u d r 3 results and discussion 3 1 visualization of the solute plume for different values of pe and shear rate fig 2 presents the temporal evolution of the distribution of the local concentration of the nai tracer projected onto a polar coordinate system θ r plane in a device with r1 25 mm and r2 50 mm at five flow rates the left column shows the initial state of the tracer plume for each case the next four columns show the state of the tracer plume after every injection of 0 15 pv of nacl until a breakthrough occurred with a total injection of 0 6 pv nacl when the tracer plume reached the outlet in the initial state the effect of the shear action was considerably weak and the spherical shape of the initial tracer plume was slightly deformed owing to advection and dispersion with increasing injected volume of nacl the shear action began to affect the tracer plume and deform the tracer blob into an ellipse along the main flow direction indicating the beginning of the shear enhanced dispersion when pe was small fig 2 a the deformation of the tracer plume in the longitudinal direction was not strong whereas its extension in the transverse direction was evident indicating that the diffusion was completely in an advanced stage owing to the long experimental span for large values of pe and shear rate fig 2 b e both advection and shear action caused severe stretching and dispersion behaviors in the longitudinal direction as evidenced by the leptokurtic shape of the tracer ellipses the temporal evolution of the tracer plumes was compared among the three devices which created different shear rates at very close values of pe fig 3 the deformation of the tracer plume in both the longitudinal and transverse directions was enhanced owing to the strong shear action at p e γ 0 181 fig 3 a conversely the expansion of the tracer plume was relatively weak at a low p e γ of 0 132 fig 3 c suggesting that the shear rate had a significant influence on the dispersion phenomenon 3 2 effect of shear actions on the spatial variance of the solute plume a spatial variance matrix κ t was adopted to describe the tracer plume using aris method of the second central moment dentz et al 2018 bolster et al 2011a expressed as 5 κ i i t σ t 2 i c i x i x i 2 c κ i j t σ l t 2 i c i x i x i x j x j c κ j i t σ l t 2 i c i x i x i x j x j c κ j j t σ l 2 j c j x j x j 2 c where κ ii t and κ jj t quantify the dispersion in the longitudinal and transverse directions respectively κ ij t and κ ji t represent the antisymmetric components of the covariance matrix κ t table 3 lists the main components of the covariance matrix κ t for dispersion in a two dimensional 2d linear shear flow at different timescales t dentz et al 2018 bolster et al 2011a the spatial variances for the longitudinal longitudinal transverse and transverse directions were calculated using both cartesian and logarithmic coordinate systems as shown in fig 4 a f the slope values of the dashed lines represent the power law of spatial variance with time for the timescales of t td 3 the tracer plume spreading in the longitudinal direction was hyper dispersive with κ jj t t 3 fig 4 d at this time cmax t decayed with time as c max t t 2 the term hyper is used here because the mixing in a shear flow is much stronger than that in 2d and three dimensional 3d uniform flows where c max t t 1 and t 3 2 compared with other flow rates a noticeably larger slope was observed at the largest flow rate p e γ 0 607 this is because a dramatic increase in p e γ note p e γ 0 304 when the flow rate 100 ml h can drive the enhancement of dispersion in the longitudinal direction the same trend is observed in fig 4 e where the antisymmetric component κ ij t increased with the square of t at subsequent times owing to the shear effect however the covariance κ ii t increased linearly with time in all cases as shown in fig 4 f indicating that the dispersion behavior primarily depended on molecular diffusion and still followed fick s law in the transverse direction despite the shear induced deformation of the plume this result also agreed quantitatively with the numerical results presented in dentz et al 2018 the hydrodynamic dispersion coefficient can be estimated through the temporal derivation of the spatial variance σ2 eq 5 in the longitudinal and transverse directions as follows 6 d l t 1 2 d σ l t 2 d t because the derivation of the spatial variance σ2 changes with time d l t was estimated as the averaged value at the late time t td 3 for q 200 ml h the experimental duration was shorter than t td 3 d l t was estimated at the breakthrough time the dispersion phenomenon in this study falls into the power law regime 5 pe 300 where convection dominates dispersion whereas the effect of diffusion cannot be neglected thus sahimi 1993 described the dispersion coefficient as follows 7 d l t d m p e δ l t where δ l and δ t are the fitted coefficients of the power law dependence on pe in the longitudinal and transverse directions respectively the average values of δ l and δ t for dispersion in a uniform porous media flow field are equivalent to 1 2 and 0 9 respectively as reported in sahimi 1993 perkins and johnston 1963 delgado 2007 fried 1971 bijeljic et al 2004 and bijeljic and blunt 2007 fig 5 a b quantitatively compares the dependence of the normalized dispersion coefficients d l t d m on pe between the results from previous simulations of uniform flow zhang et al 2021 and our experiments in the logarithmic system the normalized dispersion coefficients under shear flow in the longitudinal direction were approximately four times those under uniform flow fig 5 a indicating considerable enhancement in dispersion caused by the shear induced velocity differences along the mean flow direction in the transverse direction as presented in fig 5 b the normalized dispersion coefficients under the shear flow condition were slightly larger than those of the uniform flow suggesting that the enhancement of the dispersion behavior is also induced by the shear effect along the transverse directions this transverse effect can be attributed to the existence of a local velocity gradient orthogonal to the mean flow in this study the power law δ l t was estimated from the slopes of each curve in fig 4 d f the power law dependence of d l t d m on pe under similar conditions for a uniform flow fell into the super diffusive region with δ l 1 06 in the longitudinal direction and the sub diffusive region with δ t 0 92 in the transverse direction which agreed well with previous research results sahimi 1993 zhang et al 2021 regarding the shear flow larger average values of δ l and δ t were obtained as 1 17 and 0 95 respectively the larger power law value obtained in the longitudinal direction proved that the dispersion behaviors were enhanced by shear actions similarly a slight increase in the value of the power law in the transverse direction was observed indicating a rather weak link between the transverse dispersion and shear rate which cannot explain the apparent extension of the tracer plume in the transverse direction in the shear enhanced flow field as described in section 3 1 because the d l t d m pe curve failed to provide an accurate description of the enhancement of dispersion in the transverse direction p e γ is proposed here as a characteristic parameter to consider the effect of shear rate on the transverse dispersion as a result a similar power law correlation of the form 8 d l t d m p e γ n l t was observed as illustrated in fig 5 c d n l and n t are the fitted coefficients of the power law dependence on p e γ in the longitudinal and transverse directions respectively the detailed values of the fitted coefficients δ l δ t n l and n t are listed in table 4 in the longitudinal direction the power law values n l of the three devices in fig 5 c were estimated to be 1 15 1 17 and 1 19 table 4 with an increase in r1 increasing the shear rate the elbow devices with larger inner radius r1 generated larger shear rates under the same flow rate as indicated in appendix a 2 the larger value of the power law may suggest that super diffusive behavior in the longitudinal direction is caused not only by advection but also by shear action a similar increasing trend of the power law dependence on p e γ was observed in the transverse direction where n t was estimated as 0 86 0 97 1 05 for cases with increasing shear rates fig 5 d most importantly an overlap of the curves is observed in fig 5 c d indicating that p e γ is an appropriate parameter that quantifies shear enhanced mixing another important finding from fig 5 c d is that shear actions in porous media may have had a more severe enhancing effect on the transverse dispersion as illustrated in table 3 the power law dependency of d l on p e γ should be approximately 2 and there should not be a power law dependency of d t on p e γ for an ideal linear shear flow however our experimental results showed a power laws n l 1 15 1 19 and n t 0 86 1 05 we attribute this deviation to the fact that shear flow in a porous medium considerably enhances mixing in the transverse direction which differs quantitatively from the dispersion result of a tracer in an ideal linear shear flow without a porous medium where no enhanced mixing is observed in the transverse direction 3 3 effect of shear actions on the mixing state 3 3 1 maximum concentration in this section we analyze the reduction in the maximum concentration of the tracer plume under several experimental conditions to evaluate its mixing state the maximum concentration in the shear flow field was obtained by measuring the concentration at the centroid of the tracer plume in the shear flow experiments the maximum concentration was 10 wt at the initial injection which decreased to 4 5 wt after injecting 0 15 pv of the 10 wt nacl solution the maximum concentration of the tracer plume decayed with time in the form cmax c0 t n cmax where n cmax is the estimated power law as shown in table 5 n cmax was estimated as 0 43 for the uniform flow field which analytically follows fick s law of cmax c0 t 0 5 dentz et al 2018 fig 6 depicts the concentration distribution for different flow rates and p e γ values at the moment of breakthrough fig 6 i iii and the temporal evolution of the maximum concentration during the experimental period fig 6 iv the characteristic timescale t d σ 0 2 2 d m associated with pure molecular diffusion was calculated as t d 20 s as shown in table 3 the reduction process can be divided into three timescales in this study we observed only the last two timescales as the initial state t t d 2 and the delayed timescale t t d 3 whereas the first timescale was not discovered owing to its short time interval i e t 1 s t t d 0 05 at the initial state t t d 2 the estimated slopes representing the power law of the maximum concentration with respect to time were significantly lower than 0 5 indicating that the shear effect was weak and the maximum concentration decayed extremely slowly with an increase in time t t d 3 accelerated reductions in the maximum concentration were observed owing to the hyper dispersive behavior with increasing shear rate the estimated power law ranged from 0 71 to 1 71 which approached the expected reduction rate of cmax c0 t 3 2 in dentz et al 2018 note that the experimental duration was shorter than t t d 3 for q 200 ml h the reduction of the maximum concentration was limited at the initial state t t d 2 and the trend of cmax c0 t 3 2 was not observed however the maximum concentration decreased to a certain level cmax c0 0 4 at t t d 3 in other cases showing a significant enhancement in the mixing the larger power laws also demonstrated the enhancing effect of shear actions when compared with the power law of uniform flow in conclusion a higher ratio of the inner radius to the outer radius r1 r2 of the device created a larger shear rate and contributed to a faster reduction in the maximum concentration under the same flow rate represented by a larger power law furthermore two patterns of reduction were observed in this study a crossover in the late timescale t 3 t d was observed corresponding to flow rates of q 10 25 and 50 ml h in fig 6 a c respectively which indicated a shift in the dispersion mechanism from molecular diffusion domination to mechanical dispersion domination before the crossover molecular diffusion dominated the mixing state and the shear effect was weak however sharper slopes were observed with an increase in the shear rates fig 6 d e indicating that shear actions are the primary contributors to the enhancement of the mixing state in this state fig 7 a b show the correlation of the fitted power law n cmax with pe and the shear rate as shown in fig 7 a the reduction rates of the maximum concentration in the shear enhanced flow were all higher than those in the uniform flow thus the effect of the shear actions could not be ignored even at a very low pe of 10 the slopes of the shear flow increased with pe suggesting that the shear effect accelerated the reduction in the maximum concentration of the tracer plume which decreased logarithmically with pe as n cmax pe 0 35 r 2 0 82 and n cmax p e γ 0 34 r 2 0 89 note that the three data in a which significantly deviated from the logarithmic fitted line were considered outliers and are not shown in b because for q 200 ml h the experimental duration was shorter than t 3 t d therefore as mentioned earlier the reduction trend of cmax c0 t 3 2 in the late timescale was not observed we can infer from the decreasing pattern of the power law that the reduction in the maximum concentration accelerated logarithmically with increasing pe and shear rates and it approached a maximum rate of cmax c0 t 2 corresponding with previous numerical research dentz et al 2018 furthermore a larger r 2 value was observed for the correlation with p e γ indicating that the reduction pattern had a stronger dependence on shear actions p e γ than advection pe 3 3 2 dilution index to quantify the mixing state of the passive tracer a dilution index has been adopted in multiple experiments as a measure of the volume occupied by a tracer kitanidis 1994 this index is defined as 11 e t exp h t h t d x c x t ln c x t where h t is the entropy of the system that quantifies the degree of disorder for point like tracer injection e t can be expressed as 12 e t 2 π e det κ t for a homogeneous system the dilution index exhibits a power law correlation with time expressed as e t t d 2 where d is the space dimensional term for instance the dilution index is supposed to evolve linearly with time for dispersion in a 2d uniform flow field herein the power law was estimated to range between 0 84 and 1 13 quantitatively agreeing with the analytical law of e t t for the 2d uniform flow experiments bolster et al 2011b for an ideal 2d system with a linear shear flow field the actual long term scaling of e t t 2 is analytically equivalent to the uniform flow field in the spatial dimension of d 4 as reported by bolster et al 2011a fig 8 shows a log log plot of the temporal evolution of the normalized dilution index e t e 0 for different flow rates in the three devices the estimated slopes represent the power law or d 2 of the dilution index with respect to time in the initial state t t d 2 the shear action was weak and the dilution index increased extremely slowly when t t d 3 an accelerated growth of e t with time was observed owing to the shear effect where the dimensional term d was estimated as 2 22 3 60 in shear enhanced flow according to this pattern the mixing state gradually approached the numerical predictions of the power law correlation of the dilution index with time as e t t 2 which corresponded to the result of an ideal mixing state for a uniform flow field with a space dimension term d 4 compared with the uniform flow experiment a much larger d indicated that the strength of the dilution caused by the shear action was high fig 9 presents the correlations between the increment in the dilution index and the injected volume of the default solution under different flow rates the x axis was replaced by the injected volume instead of time to enable direct comparisons among the cases with different flow rates as a result the increase in the dilution index indicated a stable increasing trend with decreasing pe which indicated that molecular diffusion makes a larger contribution to the dilution of the solute plume at smaller pe the correlations of n di with pe and p e γ are presented in fig 10 both of which exhibited power law relationships as n di p e 0 165 and n di p e γ 0 166 respectively the influence of shear action on the mixing state became stronger with increasing shear rate which was consistent with the discussion by kitanidis 1994 3 3 3 transverse mixing the scalar dissipation rate is a measure of the degradation in concentration variability within a passive tracer plume the scalar dissipation rate sdr is used to quantify the effect of linear shear flow on the mixing dynamics which is the basic mechanism that drives dispersion in macroscopic homogeneous porous media the sdr is defined as follows bolster et al 2011a borgne et al 2010 13 χ t ω d x c x t d c x t where c x t is the local concentration and d is the dispersion coefficient tensor the sdr curve should evolve analytically with time as χ t t d 2 1 for a uniform flow field where d is the spatial dimension number in this study the observation of the sdr from our 2d uniform flow experiment exhibited a reduction trend of the sdr scales from χ t t 1 67 to χ t t 1 96 which satisfied the theoretical solution of χ t t 2 fig 11 shows the temporal evolution of the sdr for different flow rates over a similar range of p e γ pe using three devices that generated different shear rates in the initial state higher initial χ t values were observed for cases with lower p e γ p e γ 0 13 indicating that molecular diffusion dominated the mixing state and the shear effect was weak this trend lasted until t t d 2 after which the shear effect began affecting the tracer plume enhancing the mixing state and resulting in an accelerated reduction in the sdr at late times t t d 3 the power law of the sdr curve with respect to time was estimated to range from 2 37 to 1 86 suggesting a weak enhancement by shear action for p e γ 0 13 higher initial χ t values were observed with a larger shear rate revealing that the shear effect and molecular diffusion both strengthened the mixing state at later times t t d 3 the χ t values exhibited a much stronger reduction as the power law scaled up to 3 07 compared with cases of low p e γ indicating that a more efficient mixing was generated through shear actions this result agreed with the correlation of χ t t 3 predicted by bolster et al 2011a at asymptotically large times for a 2d linear shear flow corresponding to a uniform flow field with a space dimensional term d 4 furthermore this analysis was consistent with the calculation results of the dilution index to directly compare the cases of different pe values using the same elbow device fig 12 shows the correlation between the sdr and injected volume accelerated reductions in the sdr were observed at large pe values indicating that more efficient mixing was generated by both advection and shear actions when compared with the mixing state in a uniform flow field or a large shear rate srd curves declined more rapidly with time and the power law followed a logarithmic law with the shear rate suggesting that a hyper mixing behavior was caused by the shear enhanced flow the correlations between the power law n sdr and pe and shear rates are shown in fig 13 when pe was low the sdr under the shear enhanced flow exhibited a slightly larger reduction rate compared with the cases of uniform flow with an increase in pe an accelerated decay of the sdr was observed in the shear flow experiments suggesting an enhancement in the mixing state in addition n sdr demonstrated power law relationships with pe and shear rates as n sdr pe 0 32 and n sdr p e γ 0 38 respectively this section describes the investigation of the maximum concentration dilution index and sdr to characterize the mixing state of the tracer plume in a shear enhanced flow field the results are quantitatively compared with the analytical and experimental solutions of dispersion in a 2d homogeneous flow field this demonstrates that significantly enhanced mixing hyper mixing occurred in the 2d shear flow and its experimental outcome was equivalent to the dispersion in a 4d uniform flow system 4 conclusion in this study an innovative experimental apparatus for generating multiple shear flows in porous media was designed to investigate the dispersion behavior of a nonreactive nai tracer plume using micro x ray ct certain numerical models were experimentally validated and key insights were provided into the dispersion and mixing mechanisms in a shear enhanced flow field compared with a uniform flow these results can be used to characterize the dispersive behavior of a tracer in the presence of a shear field the following conclusions were drawn based on the tracer test experiments an approximately linear shear flow can be generated using the designed apparatus and micro x ray ct enables temporal visualization of the flow field and tracer plume concentration profile the tracer plume was deformed into an elliptical shape owing to the stretching effect of shear action a more leptokurtic shape was generated by stronger shear action in devices with larger ratios of the inner radius to the outer radius suggesting that the shear enhanced dispersion phenomenon was successfully observed in the experiment hyper dispersive behavior was observed in the longitudinal direction of the tracer plume the spreading scaled in the form κ jj t t3 when t t d 3 which qualitatively agreed with the numerical prediction in dentz et al 2018 in the power law regime of the dispersion sub diffusive and super diffusive behaviors were identified with a power law dependence of the dispersion coefficient on pe with δ t 1 17 and δ l 0 95 which fit in the characteristic range as stated in sahimi 1993 a new power law relationship of normalized dispersion coefficients on a characteristic parameter p e γ was realized which enabled the collapse of different curves and thus provided a better understanding of the influence of shear actions on transverse dispersion the analysis of the maximum concentration dilution index and sdr indicates that the mixing state of a two dimensional shear flow field is equivalent to a uniform flow field with a space dimensional term d 4 credit authorship contribution statement zijing li writing original draft visualization data curation chunwei zhang conceptualization methodology writing review editing kazuki kaito investigation formal analysis software yingxue hu investigation formal analysis validation tetsuya suekane supervision project administration writing review editing declaration of competing interest none acknowledgments the authors acknowledge the support from jsps kakenhi grant no 17h00790 the infosyenergy program and cross the border tokyo tech pioneering doctoral research program this work was also supported by the national natural science foundation of china grant no 52206085 appendix a 1 image processing a series of images visualizing the dispersion of nai tracer plume at different flow rates in three devices was obtained using micro x ray ct the resolution of all the x ray images included in this study was set to 14 μm pixel continuous x ray scans were performed for each experimental condition with time intervals of 1 s the produced images were viewed in grayscale characterized by a certain brightness value all x ray images were adjusted to ensure that the background x ray image brightness values were the same fig 14 presents the image processing procedure using the software image j to convert the raw x ray images into a clear tracer plume experimental channels were first selected and cropped from the slices of raw images fig 14 a subsequently the noise was canceled using the remove outlier function to remove an undesirable local spot brightness the subtraction function of image calculator was applied between images at each time step and the initial images to subtract the background particles brightness therefore the differentiation in the x ray gray value between images at each step and the initial images was i i i 0 a calibration curve was derived to convert the subtracted brightness value of the x ray image i to a nai concentration cnai fig 15 thereafter a threshold fig 14 c was adjusted manually to select the largest label tracer plume of the image all background outside the largest label was set to a brightness of 0 to eliminate the influence of abnormal bright spots the mass conservation was checked among all the images fig 16 the normalized nai concentration m m0 ratio of tracer concentration at each time step to the initial tracer concentration cnai 10 wt was approximately 1 0 over the experimental period indicating the accuracy of the experiments finally the brightness of the x ray images was converted into the nai concentration profile through a calibration curve developed in advance a 2 velocity field measurement the velocity fields of each apparatus were measured under different experimental conditions to confirm the generation of the shear flow in the apparatus fig 15 shows the evolution of the interface between the nai tracer and nacl solutions at a flow rate of 100 ml h in device 2 the theoretical shear rate of the tracer plume was calculated using the following equations the velocity of the tracer plume at any inner radius r can be calculated as a1 u r k μ p out p in l 2 k μ p in p out π r as the pressure gradient information is unknown we can relate the pressure gradient to the volume flow rate q using the following equation a2 q ϕ h r 1 r 2 u r dr ϕ h 2 k μ p in p out π ln r 2 ln r 1 thus the average velocity and velocity occupied by the tracer can be computed as follows a3 u av q ϕ h r 2 r 1 a4 u tc 1 2 k μ p in p out π r tc 1 q ϕ h ln r 2 ln r 1 r tc 1 a5 u tc 2 2 k μ p in p out π r tc 2 q ϕ h ln r 2 ln r 1 r tc 2 where r tc 1 and r tc 2 are the inner and outer radii of the tracer plume respectively and u tc 1 and u tc 2 are the interstitial velocities at these two radii the theatrical averaged shear rate γ tc for the tracer plume can be obtained as a6 γ tc u tc 1 u tc 2 r tc 1 r tc 2 in our experiments the theoretical shear rates γ tc table 8 were used to calculate p e γ the velocity field was measured as shown in fig 17 and the shear rate was evaluated as 0 0163 0 00144 s 1 by estimating the slope of the velocity field at the central region of the device which quantitatively agreed with the theoretical shear rate of 0 0152 s 1 under the same experimental conditions the evolution of the interface between nai tracer and nacl solution is shown in fig 18 a 3 uniform flow experiment evolution of the concentration profile of the tracer plume at a breakthrough time projected with different flow rates in shear flow is shown in fig 19 
83,the shear flow generated by natural convection in porous media considerably influences the dispersion of contaminants in various geological formations previous studies have revealed that the dispersion coefficient depends on the péclet number pe shear rate and complex pore structures in this study the dispersion behavior of a nai tracer cloud was investigated under different shear rates ranging from 0 001 to 0 04 s 1 and pe ranging from 10 to 200 using an innovative experimental apparatus via an x ray technique in contrast to uniform flow a considerably enhanced dispersion was observed in shear flow along the longitudinal direction and spreading in the longitudinal and transverse directions grew with time as t 3 and t respectively in the power law regime the dispersion behaviors in the transverse and longitudinal directions were strengthened by shear action with a larger dependence of the power law on the shear rates and pe compared with that in the uniform flow the strengthened dispersion promoted the formation of a hyper mixing state which was evaluated using the temporal evolution of the maximum concentration of the tracer plume dilution index and scalar dissipation rate the results indicate that the dispersion behavior in a two dimensional shear flow is quantitatively equivalent to that in a four dimensional uniform flow field the findings of this study can provide a deeper understanding of the influence of shear flow on the hydrodynamic dispersion in porous media keywords solute transport porous media x ray images shear flow hydrodynamic dispersion data availability data will be made available on request 1 introduction dispersion in porous media is a typical solute transport phenomenon that occurs in diverse scientific and engineering fields such as contaminated groundwater remediation michael and khan 2016 radioactive waste disposal wang and zhan 2013 enhanced oil recovery eor suekane et al 2019 and carbon dioxide capture and storage ccs andrew et al 2013 the effective transport of solutes or dissolved constituents can be significantly affected by the convective flow of miscible fluids in the porous media for a shear flow the fluid velocity is driven by forces that vary linearly with a distance perpendicular to the direction of the main flow the local shear action of the flow fields can generate local velocity fluctuations that can impact the efficiency of various industrial processes for example the shear action at the water oil two phase interface may contribute to the fast spreading and mixing of surfactant polymer molecules in the oil reservoir which plays a key role in the chemical enhanced oil recovery technique nagatsu et al 2007 berg and van wunnik 2017 foroozesh and kumar 2020 2022 in addition the shear flow associated with the density driven natural convection of co2 and brine water can significantly enhance the mass transfer rate thereby reducing the time required for the transition of co2 from the buoyancy state into the dissolved phase which in turn improves the efficiency and security of co2 storage nakanishi et al 2016 suekane et al 2017 wang et al 2018 sin et al 2019 shear dispersion describes the enhanced spreading and mixing of solutes due to the velocity gradients of flow fields young and jones 1991 and it is important for the spreading mixing and mass transfer of solute plumes aquino and bolster 2017 souzy et al 2018 this transport property can be characterized by a time dependent dispersion coefficient d which depends on the properties of the porous media e g geometry local heterogeneity and permeability péclet number pe and shear rate bijeljic et al 2013 jimenez urias and haine 2021 souzy et al 2020 studies have numerically verified that dispersion is related to the shear rate for viscous fingering suekane et al 2017 lindner et al 2002 as velocity gradients are generated owing to the viscosity difference resulting from a locally high pe 10 sin et al 2019 dispersion at the tips of the fingers is promoted nakanishi et al 2016 wang et al 2018 muharrik et al 2018 particularly in the transverse direction wang et al 2016 thus the shear stresses of the two phases at their interface result in enhanced mixing as well as heat and mass transfer during solute transport in multiple fields chequer et al 2020 omirbekov et al 2020 tran and jha 2021 yizhaq et al 2021 parvan et al 2021 therefore further studies on the impact of shear enhanced dispersion on the mixing and mass transfer rates are required for shear flow in porous media dispersion behaviors are characterized by a range of pe values in the transition zone where the effects of molecular diffusion and mechanical dispersion are of the same order of magnitude thiele 1997 this transition zone is considered as the power law regime when the range of pe is 5 300 sahimi 1993 the migration of a tracer in the interface region of two fluids with viscosity differences has been comprehensively studied at the microscale level within porous media hinton and woods 2020a 2020b for a simple shear flow at a constant shear rate the evolution of the solute plume follows different time dependent laws corresponding to different timescales dentz et al 2018 a model was built in a ciliated channel to analyze shear rate dependent flow abbas and wang 2021 in addition the impact of pure forced convection on the particle motion behavior and dissolution time in shear flow was simulated using the spm lbm method safa et al 2021 shear driven vortex flow was studied using a turbulence model saqr et al 2010 furthermore a strong mixing state was predicted in which a two dimensional linear shear flow field quantitatively corresponded to an equivalent four dimensional homogeneous system bolster et al 2011a a shear enhanced mixing model was developed to study the dynamics of non fickian dispersion evolution of concentration gradients and mixing state at the pore scale jiménez martínez et al 2017 although shear enhanced dispersion has been adequately characterized via numerical and simulation research zhang et al 2021 experimental evidence is inadequate owing to the difficulties in generating an ideal linear velocity gradient therefore an innovative quarter annulus shaped device was designed in this study to investigate the dispersion phenomenon in multiple shear flows by modifying its inner radius while maintaining a constant outer radius in this study a new elbow shaped device is designed to generate velocity gradients that can be approximated locally as linear shear flow tracer dispersion experiments are conducted using the device to examine the transport process of a sodium iodide nai plume in a packed bed of glass beads saturated with a sodium chloride nacl solution under different velocity fields the experiments are conducted for shear rates ranging from 0 02 to 1 75 s 1 and pe ranging from 5 to 300 power law regime of which the solute transport process is simultaneously visualized using a micro x ray computed tomography ct scanner dispersion experiments in uniform flow fields under the same values of pe are conducted as control trials the dispersion coefficients obtained from the shear flow field are comprehensively compared with those obtained from a uniform flow field finally the mixing state is evaluated based on the maximum concentration of the tracer plume dilution index and scalar dissipation rate 2 experimental protocol 2 1 experimental device fig 1 shows a schematic of the experimental system with a micro x ray ct scanxmate cf110tss300 comscantecno co ltd kanagawa japan to non destructively analyze the solute transport process of the nai tracer plume the container consisted of two acrylic plates two plates were spaced apart with a layer of silicone rubber sheets as the seal and bonded using screws and nuts to avoid leakage the packed bed was designed in a quarter annulus shape inner radius r1 20 25 and 30 mm outer radius r2 50 mm depth 5 mm and one of the plates was hollowed out to create an approximately linear velocity gradient in the fluid a micro syringe pump was connected at the inlet point kds100 kd scientific inc holliston usa whereas the outlet point was connected to a tube that led the ejected fluid to a waste tank sintered glass filters were installed at the inlet and outlet of the device to ensure a steady flow field and prevent the leakage of experimental particles the pressures at the inlet and outlet boundaries were considered to be constant p in out const p θ const a hole with a diameter of 5 mm on the top plate was designed to inject the nai tracer the hole was sealed with a silicone rubber septum shimadzu glc ltd tokyo japan and pierced with an injection micro syringe to avoid the inlet effect the tracer injection point was located 18 mm from the inlet according to darcy s law the average interstitial velocity uav can be expressed as 1 u a v k μ p where k is the permeability of the porous medium μ is the fluid dynamic viscosity and p is the pressure gradient along the flow direction because the pressures at the inlet pin and outlet pout of the device were constant the interstitial velocity u is inversely proportional to the length of any arc l and the radius r of the annulus as expressed in eq 2 2 u k μ p o u t p i n l 2 k μ p i n p o u t π r the elbow shaped device was designed for multiple velocity fields fluid shear by modifying the parameter of its inner radius while maintaining a constant outer radius in addition a straight channel with dimensions of 50 mm 30 mm 5 mm was used as the control trial table 1 presents the properties of the three elbow shaped devices and straight channel 2 2 experimental materials an unconsolidated packed bed was selected as the porous medium in this study glass beads with a diameter of 400 50 μm as one co ltd osaka japan were densely packed inside the container a thin layer of fine glass beads 100 μm was attached to the internal wall to eliminate the boundary effect considering its low permeability the porosity of the packed bed was estimated to be 38 by measuring the weight change before and after water saturation the porous medium was considered homogeneous because of the uniform size of the glass beads in this experiment the nacl solution was selected as the default solution for visualization purposes nai solution was used as the tracer the resulting densities of the nacl and nai solution fluids were 1 05 and 1 06 g cm3 respectively 2 3 experimental procedures the experimental container was initially packed with glass beads and fully saturated with a nacl solution to eliminate undesirable gases in the vacuum chamber the nacl solution was continuously injected at a given volume flow rate table 2 to create a stabilized flow field an x ray image was obtained under the initial conditions subsequently 0 1 ml nai tracer solution was instantly injected into the porous medium via a micro syringe pump with a needle pierced on the silicone rubber septum forming a tracer cloud with an area of 8 10 8 m2 thus the tracer plume had a diameter of 8 18 mm e g calculated by q ϕ h π 4 d 2 d 8 18 mm thereafter 0 6 pore volume pv of the nacl solution was continuously injected upward from the bottom of the packed bed the experimental parameters are listed in table 2 pe is defined as the ratio of the advection and diffusion rates to the characteristic number of the flow rate which is calculated as 3 p e u a v l d m q a d p ϕ d m where q ml h is the injection flow rate of the nacl solution a m2 is the cross sectional area of the packed bed which is presented in table 1 dp μm is the experimental particle diameter of the glass beads dp 400 μm which was selected as the characteristic length l in this case φ is the porosity uav m s is the average fluid interstitial velocity and dm m2 s is the molecular diffusion coefficient of iodide ions in water here dm corresponds to the self diffusion coefficient for the infinite dilution of nai in water which is a constant of 2 10 9 m2 s wang and kennedy 1950 tartakovsky and dentz 2019 perkins and johnston 1963 furthermore two characteristic timescales related to blob diffusion and shear rate were defined the timescale associated with the diffusion behavior is expressed as t d σ 0 2 2 d m dentz et al 2018 whereas that associated with the shear action of the velocity field is denoted by the inverse of the shear rate t γ 1 γ berg and van wunnik 2017 souzy et al 2018 the characteristic number of shear rates representing the importance of the shear enhanced dispersion with respect to the molecular diffusion is defined as the ratio of the two timescales expressed as 4 p e γ t d t γ γ σ 0 2 2 d m where σ 0 2 is the plume area of the tracer blob which is a constant value of σ 0 2 8 10 2 m m 2 based on the initial injected volume of the nai tracer 0 1 ml dm is the self diffusion coefficient for the infinite dilution of nai in water dm 2 10 9 m2 s wang and kennedy 1950 tartakovsky and dentz 2019 perkins and johnston 1963 and γ is the shear rate which can be estimated as the gradient of the velocity expressed as γ d u d r 3 results and discussion 3 1 visualization of the solute plume for different values of pe and shear rate fig 2 presents the temporal evolution of the distribution of the local concentration of the nai tracer projected onto a polar coordinate system θ r plane in a device with r1 25 mm and r2 50 mm at five flow rates the left column shows the initial state of the tracer plume for each case the next four columns show the state of the tracer plume after every injection of 0 15 pv of nacl until a breakthrough occurred with a total injection of 0 6 pv nacl when the tracer plume reached the outlet in the initial state the effect of the shear action was considerably weak and the spherical shape of the initial tracer plume was slightly deformed owing to advection and dispersion with increasing injected volume of nacl the shear action began to affect the tracer plume and deform the tracer blob into an ellipse along the main flow direction indicating the beginning of the shear enhanced dispersion when pe was small fig 2 a the deformation of the tracer plume in the longitudinal direction was not strong whereas its extension in the transverse direction was evident indicating that the diffusion was completely in an advanced stage owing to the long experimental span for large values of pe and shear rate fig 2 b e both advection and shear action caused severe stretching and dispersion behaviors in the longitudinal direction as evidenced by the leptokurtic shape of the tracer ellipses the temporal evolution of the tracer plumes was compared among the three devices which created different shear rates at very close values of pe fig 3 the deformation of the tracer plume in both the longitudinal and transverse directions was enhanced owing to the strong shear action at p e γ 0 181 fig 3 a conversely the expansion of the tracer plume was relatively weak at a low p e γ of 0 132 fig 3 c suggesting that the shear rate had a significant influence on the dispersion phenomenon 3 2 effect of shear actions on the spatial variance of the solute plume a spatial variance matrix κ t was adopted to describe the tracer plume using aris method of the second central moment dentz et al 2018 bolster et al 2011a expressed as 5 κ i i t σ t 2 i c i x i x i 2 c κ i j t σ l t 2 i c i x i x i x j x j c κ j i t σ l t 2 i c i x i x i x j x j c κ j j t σ l 2 j c j x j x j 2 c where κ ii t and κ jj t quantify the dispersion in the longitudinal and transverse directions respectively κ ij t and κ ji t represent the antisymmetric components of the covariance matrix κ t table 3 lists the main components of the covariance matrix κ t for dispersion in a two dimensional 2d linear shear flow at different timescales t dentz et al 2018 bolster et al 2011a the spatial variances for the longitudinal longitudinal transverse and transverse directions were calculated using both cartesian and logarithmic coordinate systems as shown in fig 4 a f the slope values of the dashed lines represent the power law of spatial variance with time for the timescales of t td 3 the tracer plume spreading in the longitudinal direction was hyper dispersive with κ jj t t 3 fig 4 d at this time cmax t decayed with time as c max t t 2 the term hyper is used here because the mixing in a shear flow is much stronger than that in 2d and three dimensional 3d uniform flows where c max t t 1 and t 3 2 compared with other flow rates a noticeably larger slope was observed at the largest flow rate p e γ 0 607 this is because a dramatic increase in p e γ note p e γ 0 304 when the flow rate 100 ml h can drive the enhancement of dispersion in the longitudinal direction the same trend is observed in fig 4 e where the antisymmetric component κ ij t increased with the square of t at subsequent times owing to the shear effect however the covariance κ ii t increased linearly with time in all cases as shown in fig 4 f indicating that the dispersion behavior primarily depended on molecular diffusion and still followed fick s law in the transverse direction despite the shear induced deformation of the plume this result also agreed quantitatively with the numerical results presented in dentz et al 2018 the hydrodynamic dispersion coefficient can be estimated through the temporal derivation of the spatial variance σ2 eq 5 in the longitudinal and transverse directions as follows 6 d l t 1 2 d σ l t 2 d t because the derivation of the spatial variance σ2 changes with time d l t was estimated as the averaged value at the late time t td 3 for q 200 ml h the experimental duration was shorter than t td 3 d l t was estimated at the breakthrough time the dispersion phenomenon in this study falls into the power law regime 5 pe 300 where convection dominates dispersion whereas the effect of diffusion cannot be neglected thus sahimi 1993 described the dispersion coefficient as follows 7 d l t d m p e δ l t where δ l and δ t are the fitted coefficients of the power law dependence on pe in the longitudinal and transverse directions respectively the average values of δ l and δ t for dispersion in a uniform porous media flow field are equivalent to 1 2 and 0 9 respectively as reported in sahimi 1993 perkins and johnston 1963 delgado 2007 fried 1971 bijeljic et al 2004 and bijeljic and blunt 2007 fig 5 a b quantitatively compares the dependence of the normalized dispersion coefficients d l t d m on pe between the results from previous simulations of uniform flow zhang et al 2021 and our experiments in the logarithmic system the normalized dispersion coefficients under shear flow in the longitudinal direction were approximately four times those under uniform flow fig 5 a indicating considerable enhancement in dispersion caused by the shear induced velocity differences along the mean flow direction in the transverse direction as presented in fig 5 b the normalized dispersion coefficients under the shear flow condition were slightly larger than those of the uniform flow suggesting that the enhancement of the dispersion behavior is also induced by the shear effect along the transverse directions this transverse effect can be attributed to the existence of a local velocity gradient orthogonal to the mean flow in this study the power law δ l t was estimated from the slopes of each curve in fig 4 d f the power law dependence of d l t d m on pe under similar conditions for a uniform flow fell into the super diffusive region with δ l 1 06 in the longitudinal direction and the sub diffusive region with δ t 0 92 in the transverse direction which agreed well with previous research results sahimi 1993 zhang et al 2021 regarding the shear flow larger average values of δ l and δ t were obtained as 1 17 and 0 95 respectively the larger power law value obtained in the longitudinal direction proved that the dispersion behaviors were enhanced by shear actions similarly a slight increase in the value of the power law in the transverse direction was observed indicating a rather weak link between the transverse dispersion and shear rate which cannot explain the apparent extension of the tracer plume in the transverse direction in the shear enhanced flow field as described in section 3 1 because the d l t d m pe curve failed to provide an accurate description of the enhancement of dispersion in the transverse direction p e γ is proposed here as a characteristic parameter to consider the effect of shear rate on the transverse dispersion as a result a similar power law correlation of the form 8 d l t d m p e γ n l t was observed as illustrated in fig 5 c d n l and n t are the fitted coefficients of the power law dependence on p e γ in the longitudinal and transverse directions respectively the detailed values of the fitted coefficients δ l δ t n l and n t are listed in table 4 in the longitudinal direction the power law values n l of the three devices in fig 5 c were estimated to be 1 15 1 17 and 1 19 table 4 with an increase in r1 increasing the shear rate the elbow devices with larger inner radius r1 generated larger shear rates under the same flow rate as indicated in appendix a 2 the larger value of the power law may suggest that super diffusive behavior in the longitudinal direction is caused not only by advection but also by shear action a similar increasing trend of the power law dependence on p e γ was observed in the transverse direction where n t was estimated as 0 86 0 97 1 05 for cases with increasing shear rates fig 5 d most importantly an overlap of the curves is observed in fig 5 c d indicating that p e γ is an appropriate parameter that quantifies shear enhanced mixing another important finding from fig 5 c d is that shear actions in porous media may have had a more severe enhancing effect on the transverse dispersion as illustrated in table 3 the power law dependency of d l on p e γ should be approximately 2 and there should not be a power law dependency of d t on p e γ for an ideal linear shear flow however our experimental results showed a power laws n l 1 15 1 19 and n t 0 86 1 05 we attribute this deviation to the fact that shear flow in a porous medium considerably enhances mixing in the transverse direction which differs quantitatively from the dispersion result of a tracer in an ideal linear shear flow without a porous medium where no enhanced mixing is observed in the transverse direction 3 3 effect of shear actions on the mixing state 3 3 1 maximum concentration in this section we analyze the reduction in the maximum concentration of the tracer plume under several experimental conditions to evaluate its mixing state the maximum concentration in the shear flow field was obtained by measuring the concentration at the centroid of the tracer plume in the shear flow experiments the maximum concentration was 10 wt at the initial injection which decreased to 4 5 wt after injecting 0 15 pv of the 10 wt nacl solution the maximum concentration of the tracer plume decayed with time in the form cmax c0 t n cmax where n cmax is the estimated power law as shown in table 5 n cmax was estimated as 0 43 for the uniform flow field which analytically follows fick s law of cmax c0 t 0 5 dentz et al 2018 fig 6 depicts the concentration distribution for different flow rates and p e γ values at the moment of breakthrough fig 6 i iii and the temporal evolution of the maximum concentration during the experimental period fig 6 iv the characteristic timescale t d σ 0 2 2 d m associated with pure molecular diffusion was calculated as t d 20 s as shown in table 3 the reduction process can be divided into three timescales in this study we observed only the last two timescales as the initial state t t d 2 and the delayed timescale t t d 3 whereas the first timescale was not discovered owing to its short time interval i e t 1 s t t d 0 05 at the initial state t t d 2 the estimated slopes representing the power law of the maximum concentration with respect to time were significantly lower than 0 5 indicating that the shear effect was weak and the maximum concentration decayed extremely slowly with an increase in time t t d 3 accelerated reductions in the maximum concentration were observed owing to the hyper dispersive behavior with increasing shear rate the estimated power law ranged from 0 71 to 1 71 which approached the expected reduction rate of cmax c0 t 3 2 in dentz et al 2018 note that the experimental duration was shorter than t t d 3 for q 200 ml h the reduction of the maximum concentration was limited at the initial state t t d 2 and the trend of cmax c0 t 3 2 was not observed however the maximum concentration decreased to a certain level cmax c0 0 4 at t t d 3 in other cases showing a significant enhancement in the mixing the larger power laws also demonstrated the enhancing effect of shear actions when compared with the power law of uniform flow in conclusion a higher ratio of the inner radius to the outer radius r1 r2 of the device created a larger shear rate and contributed to a faster reduction in the maximum concentration under the same flow rate represented by a larger power law furthermore two patterns of reduction were observed in this study a crossover in the late timescale t 3 t d was observed corresponding to flow rates of q 10 25 and 50 ml h in fig 6 a c respectively which indicated a shift in the dispersion mechanism from molecular diffusion domination to mechanical dispersion domination before the crossover molecular diffusion dominated the mixing state and the shear effect was weak however sharper slopes were observed with an increase in the shear rates fig 6 d e indicating that shear actions are the primary contributors to the enhancement of the mixing state in this state fig 7 a b show the correlation of the fitted power law n cmax with pe and the shear rate as shown in fig 7 a the reduction rates of the maximum concentration in the shear enhanced flow were all higher than those in the uniform flow thus the effect of the shear actions could not be ignored even at a very low pe of 10 the slopes of the shear flow increased with pe suggesting that the shear effect accelerated the reduction in the maximum concentration of the tracer plume which decreased logarithmically with pe as n cmax pe 0 35 r 2 0 82 and n cmax p e γ 0 34 r 2 0 89 note that the three data in a which significantly deviated from the logarithmic fitted line were considered outliers and are not shown in b because for q 200 ml h the experimental duration was shorter than t 3 t d therefore as mentioned earlier the reduction trend of cmax c0 t 3 2 in the late timescale was not observed we can infer from the decreasing pattern of the power law that the reduction in the maximum concentration accelerated logarithmically with increasing pe and shear rates and it approached a maximum rate of cmax c0 t 2 corresponding with previous numerical research dentz et al 2018 furthermore a larger r 2 value was observed for the correlation with p e γ indicating that the reduction pattern had a stronger dependence on shear actions p e γ than advection pe 3 3 2 dilution index to quantify the mixing state of the passive tracer a dilution index has been adopted in multiple experiments as a measure of the volume occupied by a tracer kitanidis 1994 this index is defined as 11 e t exp h t h t d x c x t ln c x t where h t is the entropy of the system that quantifies the degree of disorder for point like tracer injection e t can be expressed as 12 e t 2 π e det κ t for a homogeneous system the dilution index exhibits a power law correlation with time expressed as e t t d 2 where d is the space dimensional term for instance the dilution index is supposed to evolve linearly with time for dispersion in a 2d uniform flow field herein the power law was estimated to range between 0 84 and 1 13 quantitatively agreeing with the analytical law of e t t for the 2d uniform flow experiments bolster et al 2011b for an ideal 2d system with a linear shear flow field the actual long term scaling of e t t 2 is analytically equivalent to the uniform flow field in the spatial dimension of d 4 as reported by bolster et al 2011a fig 8 shows a log log plot of the temporal evolution of the normalized dilution index e t e 0 for different flow rates in the three devices the estimated slopes represent the power law or d 2 of the dilution index with respect to time in the initial state t t d 2 the shear action was weak and the dilution index increased extremely slowly when t t d 3 an accelerated growth of e t with time was observed owing to the shear effect where the dimensional term d was estimated as 2 22 3 60 in shear enhanced flow according to this pattern the mixing state gradually approached the numerical predictions of the power law correlation of the dilution index with time as e t t 2 which corresponded to the result of an ideal mixing state for a uniform flow field with a space dimension term d 4 compared with the uniform flow experiment a much larger d indicated that the strength of the dilution caused by the shear action was high fig 9 presents the correlations between the increment in the dilution index and the injected volume of the default solution under different flow rates the x axis was replaced by the injected volume instead of time to enable direct comparisons among the cases with different flow rates as a result the increase in the dilution index indicated a stable increasing trend with decreasing pe which indicated that molecular diffusion makes a larger contribution to the dilution of the solute plume at smaller pe the correlations of n di with pe and p e γ are presented in fig 10 both of which exhibited power law relationships as n di p e 0 165 and n di p e γ 0 166 respectively the influence of shear action on the mixing state became stronger with increasing shear rate which was consistent with the discussion by kitanidis 1994 3 3 3 transverse mixing the scalar dissipation rate is a measure of the degradation in concentration variability within a passive tracer plume the scalar dissipation rate sdr is used to quantify the effect of linear shear flow on the mixing dynamics which is the basic mechanism that drives dispersion in macroscopic homogeneous porous media the sdr is defined as follows bolster et al 2011a borgne et al 2010 13 χ t ω d x c x t d c x t where c x t is the local concentration and d is the dispersion coefficient tensor the sdr curve should evolve analytically with time as χ t t d 2 1 for a uniform flow field where d is the spatial dimension number in this study the observation of the sdr from our 2d uniform flow experiment exhibited a reduction trend of the sdr scales from χ t t 1 67 to χ t t 1 96 which satisfied the theoretical solution of χ t t 2 fig 11 shows the temporal evolution of the sdr for different flow rates over a similar range of p e γ pe using three devices that generated different shear rates in the initial state higher initial χ t values were observed for cases with lower p e γ p e γ 0 13 indicating that molecular diffusion dominated the mixing state and the shear effect was weak this trend lasted until t t d 2 after which the shear effect began affecting the tracer plume enhancing the mixing state and resulting in an accelerated reduction in the sdr at late times t t d 3 the power law of the sdr curve with respect to time was estimated to range from 2 37 to 1 86 suggesting a weak enhancement by shear action for p e γ 0 13 higher initial χ t values were observed with a larger shear rate revealing that the shear effect and molecular diffusion both strengthened the mixing state at later times t t d 3 the χ t values exhibited a much stronger reduction as the power law scaled up to 3 07 compared with cases of low p e γ indicating that a more efficient mixing was generated through shear actions this result agreed with the correlation of χ t t 3 predicted by bolster et al 2011a at asymptotically large times for a 2d linear shear flow corresponding to a uniform flow field with a space dimensional term d 4 furthermore this analysis was consistent with the calculation results of the dilution index to directly compare the cases of different pe values using the same elbow device fig 12 shows the correlation between the sdr and injected volume accelerated reductions in the sdr were observed at large pe values indicating that more efficient mixing was generated by both advection and shear actions when compared with the mixing state in a uniform flow field or a large shear rate srd curves declined more rapidly with time and the power law followed a logarithmic law with the shear rate suggesting that a hyper mixing behavior was caused by the shear enhanced flow the correlations between the power law n sdr and pe and shear rates are shown in fig 13 when pe was low the sdr under the shear enhanced flow exhibited a slightly larger reduction rate compared with the cases of uniform flow with an increase in pe an accelerated decay of the sdr was observed in the shear flow experiments suggesting an enhancement in the mixing state in addition n sdr demonstrated power law relationships with pe and shear rates as n sdr pe 0 32 and n sdr p e γ 0 38 respectively this section describes the investigation of the maximum concentration dilution index and sdr to characterize the mixing state of the tracer plume in a shear enhanced flow field the results are quantitatively compared with the analytical and experimental solutions of dispersion in a 2d homogeneous flow field this demonstrates that significantly enhanced mixing hyper mixing occurred in the 2d shear flow and its experimental outcome was equivalent to the dispersion in a 4d uniform flow system 4 conclusion in this study an innovative experimental apparatus for generating multiple shear flows in porous media was designed to investigate the dispersion behavior of a nonreactive nai tracer plume using micro x ray ct certain numerical models were experimentally validated and key insights were provided into the dispersion and mixing mechanisms in a shear enhanced flow field compared with a uniform flow these results can be used to characterize the dispersive behavior of a tracer in the presence of a shear field the following conclusions were drawn based on the tracer test experiments an approximately linear shear flow can be generated using the designed apparatus and micro x ray ct enables temporal visualization of the flow field and tracer plume concentration profile the tracer plume was deformed into an elliptical shape owing to the stretching effect of shear action a more leptokurtic shape was generated by stronger shear action in devices with larger ratios of the inner radius to the outer radius suggesting that the shear enhanced dispersion phenomenon was successfully observed in the experiment hyper dispersive behavior was observed in the longitudinal direction of the tracer plume the spreading scaled in the form κ jj t t3 when t t d 3 which qualitatively agreed with the numerical prediction in dentz et al 2018 in the power law regime of the dispersion sub diffusive and super diffusive behaviors were identified with a power law dependence of the dispersion coefficient on pe with δ t 1 17 and δ l 0 95 which fit in the characteristic range as stated in sahimi 1993 a new power law relationship of normalized dispersion coefficients on a characteristic parameter p e γ was realized which enabled the collapse of different curves and thus provided a better understanding of the influence of shear actions on transverse dispersion the analysis of the maximum concentration dilution index and sdr indicates that the mixing state of a two dimensional shear flow field is equivalent to a uniform flow field with a space dimensional term d 4 credit authorship contribution statement zijing li writing original draft visualization data curation chunwei zhang conceptualization methodology writing review editing kazuki kaito investigation formal analysis software yingxue hu investigation formal analysis validation tetsuya suekane supervision project administration writing review editing declaration of competing interest none acknowledgments the authors acknowledge the support from jsps kakenhi grant no 17h00790 the infosyenergy program and cross the border tokyo tech pioneering doctoral research program this work was also supported by the national natural science foundation of china grant no 52206085 appendix a 1 image processing a series of images visualizing the dispersion of nai tracer plume at different flow rates in three devices was obtained using micro x ray ct the resolution of all the x ray images included in this study was set to 14 μm pixel continuous x ray scans were performed for each experimental condition with time intervals of 1 s the produced images were viewed in grayscale characterized by a certain brightness value all x ray images were adjusted to ensure that the background x ray image brightness values were the same fig 14 presents the image processing procedure using the software image j to convert the raw x ray images into a clear tracer plume experimental channels were first selected and cropped from the slices of raw images fig 14 a subsequently the noise was canceled using the remove outlier function to remove an undesirable local spot brightness the subtraction function of image calculator was applied between images at each time step and the initial images to subtract the background particles brightness therefore the differentiation in the x ray gray value between images at each step and the initial images was i i i 0 a calibration curve was derived to convert the subtracted brightness value of the x ray image i to a nai concentration cnai fig 15 thereafter a threshold fig 14 c was adjusted manually to select the largest label tracer plume of the image all background outside the largest label was set to a brightness of 0 to eliminate the influence of abnormal bright spots the mass conservation was checked among all the images fig 16 the normalized nai concentration m m0 ratio of tracer concentration at each time step to the initial tracer concentration cnai 10 wt was approximately 1 0 over the experimental period indicating the accuracy of the experiments finally the brightness of the x ray images was converted into the nai concentration profile through a calibration curve developed in advance a 2 velocity field measurement the velocity fields of each apparatus were measured under different experimental conditions to confirm the generation of the shear flow in the apparatus fig 15 shows the evolution of the interface between the nai tracer and nacl solutions at a flow rate of 100 ml h in device 2 the theoretical shear rate of the tracer plume was calculated using the following equations the velocity of the tracer plume at any inner radius r can be calculated as a1 u r k μ p out p in l 2 k μ p in p out π r as the pressure gradient information is unknown we can relate the pressure gradient to the volume flow rate q using the following equation a2 q ϕ h r 1 r 2 u r dr ϕ h 2 k μ p in p out π ln r 2 ln r 1 thus the average velocity and velocity occupied by the tracer can be computed as follows a3 u av q ϕ h r 2 r 1 a4 u tc 1 2 k μ p in p out π r tc 1 q ϕ h ln r 2 ln r 1 r tc 1 a5 u tc 2 2 k μ p in p out π r tc 2 q ϕ h ln r 2 ln r 1 r tc 2 where r tc 1 and r tc 2 are the inner and outer radii of the tracer plume respectively and u tc 1 and u tc 2 are the interstitial velocities at these two radii the theatrical averaged shear rate γ tc for the tracer plume can be obtained as a6 γ tc u tc 1 u tc 2 r tc 1 r tc 2 in our experiments the theoretical shear rates γ tc table 8 were used to calculate p e γ the velocity field was measured as shown in fig 17 and the shear rate was evaluated as 0 0163 0 00144 s 1 by estimating the slope of the velocity field at the central region of the device which quantitatively agreed with the theoretical shear rate of 0 0152 s 1 under the same experimental conditions the evolution of the interface between nai tracer and nacl solution is shown in fig 18 a 3 uniform flow experiment evolution of the concentration profile of the tracer plume at a breakthrough time projected with different flow rates in shear flow is shown in fig 19 
84,alpine permafrost environments are highly vulnerable and sensitive to changes in regional and global climate trends thawing and degradation of permafrost has numerous adverse environmental economic and societal impacts mathematical modeling and numerical simulations provide powerful tools for predicting the degree of degradation and evolution of subsurface permafrost as a result of global warming a particularly significant characteristic of alpine environments is the high variability in their surface geometry which drives large lateral thermal and fluid fluxes along topographic gradients the combination of these topography driven fluxes and unsaturated ground makes alpine systems markedly different from arctic permafrost environments and general geotechnical ground freezing applications and therefore alpine permafrost demands its own specialized modeling approaches in this work we present a multi physics permafrost model tailored to subsurface processes of alpine regions in particular we resolve the ice water phase transitions unsaturated conditions and capillary actions and account for the impact of the evolving pore space through freezing and thawing processes moreover the approach is multi dimensional and therefore inherently resolves the topography driven horizontal fluxes through numerical case studies based on the elevation profiles of the zugspitze de and the matterhorn ch we show the strong influence of lateral fluxes in 2d on active layer dynamics and the distribution of permafrost keywords mountain permafrost ice water phase transition unsaturated flow mathematical modeling data availability data will be made available on request 1 introduction the cryosphere of the european mountains is expected to experience drastic changes within the next decades such as the disappearance of glaciers the rise of snow lines the expansion of vegetation and the degradation of permafrost at lower altitudes beniston et al 2018 while the former three can be observed visually the current state of permafrost has to be monitored in form of borehole measurements etzelmüller 2013 or under application of electrical resistivity tomography e g you et al 2013 permafrost is defined as ground where temperatures have remained continuously below 0 c for a period of at least two consecutive years e g riseborough et al 2008 the eu funded permafrost and climate in europe project pace has been monitoring the mountain permafrost in europe over the last twenty years the results show clear warming trends at all investigated sites across europe down to a depths of 50 meters and an increase of up to 200 in the thickness of the active layer etzelmüller et al 2020 i e the zone that seasonally thaws and refreezes the degradation of permafrost has a major influence on slope stability e g krautblatter et al 2013 mccoll 2012 construction and engineering e g bommer et al 2010 arenson et al 2009 hydrological systems and water management e g liu et al 2007 quinton et al 2011 and greenhouse gas emissions e g schuur et al 2015 anthony et al 2012 modeling and simulation of mountain permafrost are essential to assess the impacts of global climate change and to predict manage and mitigate the associated risks alpine regions are characterized by their high spatial variability of elevation subsurface composition geomorphology and micro climatology gruber and haeberli 2009 with differences of up to 6 c in mean annual ground surface temperature magst within 300 m gubler et al 2011 additionally the topographic variations lead to lateral thermal and fluid fluxes which require multi dimensional modeling etzelmüller 2013 and cannot be represented by one dimensional subsurface heat transport gruber et al 2004b finally dry climate as well as the topography of alpine regions can lead to unsaturated subsurface conditions gruber et al 2017 thus alpine permafrost models also need to account for the presence of air and freezing of unsaturated soils and therefore demand more specialized and detailed multi physics concepts than general permafrost and geotechnical soil freezing models in recent years numerous approaches to describe the evolution of permafrost have been developed modern empirical statistical models combine permafrost evidence and climate data to estimate the occurrence of permafrost statistical approaches such as by boeckli et al 2012 use inventories of active and relict rock glacier sites in combination with mean annual rock surface temperature marst measurements to assess the state of permafrost the model by sattler et al 2016 additionally considers solar radiation in snow free months to obtain the probability for the presence of permafrost recently deluigi et al 2017 applied machine learning algorithms to thermal and geoelectrical field data in combination with rock glacier inventories to estimate the occurrence of permafrost achieving an accuracy of up to 88 in contrast physics based models formulate thermal and hydraulic processes in the form of mathematical expressions of conservation laws and conduct simulations by application of numerical methods since even two dimensional simulations of a single mountain can lead to run times of several weeks e g magnin and josnin 2021 usually concessions are made by either limiting the number of considered processes or in form of simplifying assumptions such as neglecting horizontal thermal and fluid fluxes the latter justifies the usage of one dimensional numerical schemes and thus significantly reduces the complexity and computational cost multiple regional and global scale models that use one dimensional approaches have been applied to study areas in norway hipp et al 2012 alaska jafarov et al 2012 and north east siberia westermann et al 2016 as well as to study permafrost in the context of snow cover luetschg et al 2008 rock glaciers pruessner et al 2021 and high altitude environments ekici et al 2014 the so called 2 5d models alpine3d lehning et al 2006 and geotop2 0 endrizzi et al 2014 fiddes et al 2015 combine three dimensional hydrological approaches close to the surface with one dimensional modeling of deeper subsurface processes their possible applications range from permafrost development to avalanche warnings and flood forecasting a surface energy balance coupled with three dimensional subsurface heat transfer has been applied to highly idealized mountain settings by noetzli et al 2007 and to a realistic mountain profile by noetzli and gruber 2009 showing the existence of permafrost even without indication of the ground surface temperature despite multiple studies e g etzelmüller 2013 kurylyk et al 2016 suggesting the importance of lateral influences applications of multi dimensional thermo hydraulic concepts to mountain permafrost are rare also most established soil freezing models are not intended for the use in alpine regions in the case of sutra ice mckenzie et al 2007 problems occur when modeling the freezing of unsaturated soil and its simulation of active layer dynamics is not accurate bui et al 2020 marsflo painter 2011 considers a simplified ice water phase transition while pflotran ice karra et al 2014 assumes full saturation of the modeled soil and thus considers water as the only fluid phase also modern ground freezing models which are primarily focused on geotechnical applications such as frost heave and the formation of ice lenses assume fully saturated soil e g sweidan et al 2021 nishimura and wang 2019 or consider unsaturated conditions but resolve freezing processes without consideration of the air huang and rudolph 2021 thus they ignore the strong capillary effects in the fringe zones which in the presence of complex morphologies can lead to inaccurate convective fluxes and thus to incorrect active layer dynamics for a detailed overview of the concepts of permafrost modeling we refer to the work of riseborough et al 2008 and to the articles by bui et al 2020 and gao et al 2021 for reviews of hydrological models that have been applied to the permafrost dominated arctic regions and the qinghai tibet plateau in order to address the summarized gaps in the modeling of alpine permafrost we have developed a detailed thermo hydraulic model tailored to the special geophysical and geomorphological conditions of alpine regions in particular we use a continuum based permafrost model that includes unsaturated flow and the associated capillary actions and generalizes the process of soil freezing such that it is compatible with three phase conditions in the fringe layers moreover the way in which we resolve the pore water to pore ice phase transition allows high flexibility in the choice of the soil freezing curve most importantly our model is multi dimensional and therefore naturally considers thermal and fluid fluxes along topographic gradients the rest of the paper is structured as follows the mathematical model and numerical scheme are presented in detail in sections 2 and 3 the thermo hydraulic behavior of the model is benchmarked comprehensively in section 4 using the test cases proposed by the interfrost project rühaak et al 2015 in section 5 a series of numerical case studies are performed based on the elevation profiles of the two distinctly different and prominent peaks of the zugspitze de and the matterhorn ch we compare the results of one dimensional and two dimensional permafrost modeling and study the influence of different degrees of saturation and the impact of a warming scenario on permafrost finally we provide a conclusion and an outlook in section 6 2 mathematical model the main phenomenological process of interest for our permafrost model is the influence of long range e g global warming and short range e g seasonal or daily temperature changes on freezing and thawing of soil with the objective of analyzing the sensitivity of alpine permafrost to cyclic or continuous temperature changes at a process level the model focuses on resolving the complex pore water to pore ice phase transition and the associated transport of heat and pore fluids thereby we also account for the presence of air and consider its effects on pore water and heat transport our model is based on the macroscopic continuum theory of multi phase flow in porous media it considers two mobile and immiscible fluid phases namely air subscript a and water subscript w and two immobile and undeformable solid phases namely ice subscript i and granular sediment or rock subscript s the solid phases constitute the skeleton of the porous medium while the fluid phases occupy the void spaces the mathematical description of the fundamental conservation laws is based on the following homogenized variables defined locally over an arbitrary representative elementary volume rev see fig 1 contained within a domain of interest ω r d with d 2 3 porosity ϕ x t fluid phase saturations s a x t and s w x t and solid phase concentrations c i x t and c s x t with position x ω and time t r the following summation conditions hold 1 s a s w 1 c i c s 1 2 1 governing equations under the assumptions of local thermal equilibrium within an rev local thermodynamic equilibrium at the ice water phase interface and low reynolds numbers for the flow of pore fluids the transport process within the porous medium can be expressed in form of the following conservation laws we consider phase wise mass conservation 2 t ϕ ρ a s a ρ a v a 0 3 t ϕ ρ w s w ρ w v w q f 4 t 1 ϕ ρ i c i q f 5 t 1 ϕ ρ s c s 0 where ρ α x t denotes the phase densities v α x t the phase velocities for α a w i s and q f x t is the rate of mass exchange from pore water to pore ice during freezing the parameter values of the different problem settings are listed in appendix b the momentum of the solid phases is always conserved due to their immobility i e v i v s 0 in the case of the air and the water phase the velocities are given by darcy s law helmig et al 1997 6 v a k k r a μ a p a ρ a g 7 v w k k r w μ w p w ρ w g where k x t denotes the absolute hydraulic permeability of the medium μ α x t the phase viscosities k r α x t the relative phase permeabilities p α x t the phase pressure for α a w and g the gravity vector under the assumption of a local thermal equilibrium the energy balance can be stated for the bulk medium 8 α a w t ϕ ρ α s α c α v t ρ α c α p t v α σ i s t 1 ϕ ρ σ c σ c σ v t k t t l f q f where c α v x t denotes the phase wise isochoric specific heat capacities c α p x t the isobaric specific heat capacities of the fluid phases and k t x t the effective thermal conductivity of the rev it is determined by k t ϕ s a k a t s w k w t 1 ϕ c i k i t c s k s t where k α t x t denotes the phase wise thermal conductivity for α a w i s additionally l f is the latent heat of fusion which we assume to be constant in eq 8 the second term on the left hand side represents the thermal advection i e the transport of heat through the movement of fluids and the last term is the combined thermal conduction through all four phases the term on the right hand side of eq 8 is the energy released or consumed through freezing and thawing processes 2 2 constitutive relations the constitutive relations of our model describe the interactions between the phases such as the pressure difference between air and water the ice water phase transition and the impact of evolving pore volumes on fluid flow 2 2 1 hydraulic properties the capillary pressure p c x t p a p w describes the pressure difference across the interface between air and water typically the capillary pressure is described as a function of the water saturation we use the brooks corey parameterization brooks and corey 1966 9 p c p e s w e 1 λ where p e x t denotes the air entry pressure λ the pore size distribution index and s w e s w s w r 1 s w r s a r is the effective water saturation here s a r x t and s w r x t are the residual or irreducible phase saturations the relative phase permeabilities are also given according to the brooks corey model helmig et al 1997 10 k r a s a s a e 2 1 s w e 2 λ 1 k r w s w s w e 2 λ 3 where the parameter λ is the same as in eq 9 the absolute permeability is an intrinsic property of the porous medium which depends on the granular material as well as the pore network the freezing and thawing processes alter the local pore structure which in turn influences the absolute permeability we parameterize these changes according to civan s power law civan 2001 11 k ϕ ϕ 0 ϕ 1 ϕ 0 ϕ 0 1 ϕ 2 β k 0 where ϕ 0 denotes the reference porosity k 0 the reference permeability and β is an empirically derived parameter in this work we differentiate between the reference porosity ϕ 0 which is a material parameter and the unknown ϕ which describes the changing ratio of fluids and solids 2 2 2 ice water phase transition the freezing behaviors of bulk water and pore water are fundamentally different tian et al 2014 in a highly idealized setting the ice water phase transition in a porous medium can be derived based on the assumption of a thermo hydraulic equilibrium loch 1978 while in practice empirically derived soil freezing curves are used to determine the amount of unfrozen pore water based on the temperature and soil properties an overview on recent advances in the parameterization of liquid water in frozen soils can be found in hu et al 2020 in our model we utilize the following soil freezing curve 12 s f c t 1 if t t f η 1 η exp t t f w otherwise where w controls the steepness of the curve and t f denotes the freezing point of water the relative amount of water that stays unfrozen is set to η 0 05 e g mckenzie et al 2007 under the assumption that the amount of unfrozen water is greater or equal than the soil freezing curve whereby equality holds in presence of ice i e c i 0 we obtain a set of karush kuhn tucker complementary conditions kuhn and tucker 2014 to describe the ice water phase transition 13 c i 0 ψ s w ϕ 1 s a ϕ 1 ϕ c s s f c t 0 c i ψ 0 as outlined in lauser et al 2011 we can rewrite this nonlinear complementarity problem ncp in the form of a piece wise differentiable function 14 c i max 0 c i ψ 0 here we use the most trivial ncp function more sophisticated problem specific choices having better convergence properties can be found in hager and wohlmuth 2009 and in the review wohlmuth 2011 this generalized formulation of the ice water phase transition also accounts for the presence of air and thus is applicable to the freezing of unsaturated soil 3 numerical solution to condense the mathematical model we replace q f in eq 8 with the left side of eq 3 and by summation of eqs 3 and 4 we obtain a combined mass balance equation for ice and water 15 t ϕ ρ w s w ρ w v w t 1 ϕ ρ i c i 0 eliminating the unknown q f additionally we substitute the velocities of air and water in eqs 2 15 and 8 with the expressions given by darcy s law in eqs 6 and 7 exploiting eqs 1 and 9 we obtain the condensed mathematical model which consists of five governing equations partial differential eqs 2 8 and 15 the ordinary differential eq 5 and the ncp 14 we choose p p a s w c i ϕ t t as primary variables and determine the secondary variables s p w s a c s q f t based on their values due to the brooks corey model in eqs 9 and 10 civan s power law 11 and the soil freezing curve 12 the resulting system is highly nonlinear the governing equations are discretized in space using a fully upwinded cell centered finite volume method and in time using a fully implicit finite difference method the fluxes across the cell interfaces are approximated using a linear two point finite difference approximation defined on an orthogonal mesh with rectangular p0 elements we linearize the discretized system by implementation of a semi smooth newton solver wohlmuth 2011 this approach can handle the semi smooth formulation of the ice water phase transition and thus the appearance and disappearance of phases the time step size is adapted based on the performance of the newton solver it is increased by 10 if less than 4 newton iterations were taken for the last time integration step and decreased by 10 if more than eight iterations were necessary to reach the minimal reduction threshold similar approaches have already been applied successfully in the context of resolving phase transitions in submarine methane hydrates gupta et al 2020 fractured porous media berge et al 2020 and contact mechanics hager and wohlmuth 2009 the resulting linear system is solved by a algebraic multi grid amg parallel solver with a stabilized bi conjugate gradient method as preconditioner the numerical scheme is implemented within the c based dune pdelab framework version 2 8 bastian et al 2010 using the built in solver library the code is available upon request inherently the model is three dimensional for the 2d simulations we consider meshes that extend only in the horizontal and vertical direction along the 3rd axis we consider all fluxes to be zero to compare 1d and 2d simulations in section 5 we also set the horizontal fluxes to zero and consider only vertical fluxes to create one dimensional modeling results 4 benchmark studies in order to validate the thermo hydraulic coupling in our mathematical model we ran two benchmark test cases melting of a frozen inclusion th2 and talik opening closure th3 both of which were developed as part of the interfrost project rühaak et al 2015 and provide useful settings for benchmarking ice water phase changes and advective mass and heat fluxes using the proposed performance measures grenier et al 2018 we make detailed comparisons of our simulation results with those of the other well established numerical codes which were the original participants of the benchmark study these include ats coon et al 2019 cast3m 1 1 www cast3m cea fr comsol 2 2 www comsol com comsol multiphysics darcytools svensson et al 2014 feflow diersch 2013 flexpde 3 3 www pdesolutions com geoan holmén et al 2011 ginette rivière et al 2014 melt frederick and buffett 2014 permafoam 4 4 www openfoam com pflotran ice karra et al 2014 smoker molson et al 1992 and sutra mckenzie et al 2007 after its publication the benchmark study has been recreated by arzanfudi and al khoury arzanfudi and al khoury 2018 note that the results of the above codes which are used in this manuscript are freely available on the website of the interfrost project 5 5 https wiki lsce ipsl fr interfrost we intend to show that under standard settings our results are consistent with those of the well established models 4 1 melting of a frozen inclusion due to the seasonal thawing of the upper soil layers and the resulting runoff of melt water the bi directional coupling between thermal and hydraulic processes is important for the correct description of active layer dynamics the first benchmark targets the thermo hydraulic coupling through simulation of the thawing of a frozen inclusion under the influence of different hydraulic gradients the 3m by 1m computational domain has an initial temperature of 5 c except for the frozen inclusion of size 33 cm x 33 cm which is at 5 c the initial temperature field is visualized in fig 2 a the ratio of liquid to frozen water is determined by the prescribed temperature field and the applied soil freezing curve the soil is assumed to be saturated and thus no air is present in the domain there are no mass and heat fluxes across the bottom and the top boundaries of the domain at the left and right boundaries hydraulic heads of h 0 δ h and h 0 are imposed where δ h is chosen to create hydraulic gradients of 0 3 9 and 15 resulting in four scenarios with flows of different strengths while there is no conductive flux through the other boundaries we impose a constant temperature of 5 c at the left side we discretize the domain into 30 000 square elements and as suggested in the benchmark study the simulated time span is 9 6h the initial the minimal and the maximal time steps are set to 0 1seconds 0 1seconds and 60 seconds in all four scenarios the temperature inside the frozen inclusion rises quickly up to 1 c and remains at that level as the melting progresses from the outside of the frozen inclusion towards the inside the hydraulic gradient determines the downstream transport of water which in turn controls the convective thermal fluxes and the rate of ice water phase change these effects are clearly demonstrated in figs 2 b 2 d for the 0 hydraulic gradient the heat transport is purely conduction driven while as the hydraulic gradient increases the effects of advective heat transfer on the rate of thaw become increasingly dominant fig 3 shows the comparison of our results with the other participating codes based on the following performance measures the minimal temperature in the domain the total heat flux exiting the system and the total liquid water volume for the hydraulic gradients of 3 and 15 the outcomes of all scenarios are shown in appendix a in all scenarios the minimal temperature starts at 5 c rises within the first hour up to 1 c and increases slowly thereafter due to latent heat effects after 9 h the minimal temperature of the 15 case rose steeply up to 3 c at this point the frozen inclusion has melted entirely the total heat flux exiting the system stays close to 0j until the downstream moving melt water of the frozen inclusion reaches the right boundary of the domain and declines afterwards as more and more cold water leaves the system for the hydraulic gradients of 3 and 15 this takes 8 and 3h respectively after 5h the total heat flux of the 15 scenario starts to increase by then the melting of the frozen inclusion has progressed so far that the amount of melt water reaching the right boundary of the domain is already declining for the total liquid water volume the simulations start with a value of 1 069 m3 with the thawing of the frozen inclusion the amount of liquid water increases until it reaches its maximal value of 1 11 m3 at this point the entire frozen inclusion has melted 4 2 talik opening closure the term talik describes permanently unfrozen ground in permafrost areas which for example occurs in between the bottoms of lakes and the underlying permafrost layer rowland et al 2011 the correct distinction between permafrost and unfrozen ground as well as the prediction of the opening and closure of these gaps in otherwise permanently frozen soil is an essential feature of alpine permafrost models in this benchmark case we examine whether an idealized talik widens or narrows and subsequently closes depending on the magnitude of the flow passing through the opening as specified by the interfrost project we consider a square domain measuring 1m by 1m with an initial temperature of 5 c there are two symmetric 5 c cold hemispheres at the top and the bottom this setting is visualized in fig 4 a again the initial values of the porosity the ice concentration and the water saturation are determined from the soil freezing curve while there is no mass transfer through the top or the bottom of the domain we impose hydraulic heads at the sides to create a flow from left to right the values of the hydraulic gradients are 3 6 9 and 15 there is no conductive flux through the right side and we impose temperatures of 5 c at the left and 5 c at the top and the bottom boundaries initially we use a time step of 0 1seconds and we bound it by 0 1seconds from below and by 600 seconds from above for the discretization the domain was split into 10 000 square elements and the simulated time span is 200h at the end of the simulation all scenarios have reached a steady state shown for the hydraulic gradients of 6 and 9 in figs 4 b and 4 c for the two weakest fluxes our model predicts a closure of the talik while the remaining two scenarios result in an opening in the case of a closure the water in the middle of the domain cools down until it reaches freezing temperature the two hemispheres connect and the talik closes from that point on the entire right side of the domain freezes at the left side some water remains liquid due to the positive temperature applied at the left boundary for the higher hydraulic gradients the cold water is flushed away and replaced with warm water from the left before it reaches freezing temperature over the course of the simulation the hemispheres deform and the talik widens until a balance between the warm stream in the middle and the cold temperatures at the top and the bottom of the domain is reached for the comparison with the other participants of the benchmark study we use the following performance measures the total heat and the temperature at the center of the domain and at a point 18 cm above the center both points are visualized in fig 4 a fig 5 displays the evolution of the performance measures over the course of the simulation for the hydraulic gradients of 6 and 9 again the results of all scenarios can be found in appendix a in the 6 case the total heat increases from its initial value of 667 mj up to 677 mj within the first 15 h before it drops down to 625 mj and remains at that level with the simulation approaching steady state the temperature at the center of the domain starts at 5 c and quickly drops to 1 c when the talik closes it approaches a value of 2 2 c the temperature measured 18 cm above the center is initially at 5 c rises quickly up to 1 c and stagnates at this value before it eventually decreases and settles at a temperature of 2 66 c towards the end of the simulation for the hydraulic gradient of 9 again the measured temperatures at the center and above the center quickly approach 1 c and 1 c before both increase and level out at 4 79 c and 3 72 c in this scenario the total heat rises from its initial value continuously for the first 100h before approaching 749 mj 4 3 discussion the recreation of the benchmark study validates the thermo hydraulic behavior of our model for saturated conditions to our knowledge there is no equivalent comparison for freezing processes in unsaturated conditions within the benchmark study most of participants agree on the results of the simulations with individual codes obtaining deviating outcomes we evaluate our results against those of the coinciding codes in all four scenarios of the melting of a frozen inclusion test case the results of our model match those of the majority of participants regarding the minimal temperature and the total water volume for the second performance measure i e the total heat flux exiting the system small differences occur they are caused by the approximation of temperature and pressure gradients at the boundaries using a finite difference method based on the values at the cell centers the deviation appears most significant for the 0 hydraulic gradient since the size of the error is consistent for all four scenarios while the magnitude of the performance measure increases with the hydraulic gradient for three out of four 3 9 15 scenarios of the talik opening closure test case our results lie within the range of the benchmark study the 6 case is interesting as four of the participating codes predict an opening of the talik while the other nine forecast a closure according to grenier et al 2018 the threshold value for the hydraulic gradient whether the talik opens or closes lies between 6 3 and 6 4 confirming our outcome our results for the 6 scenario match those of the nine codes which also predict a closure of the talik the discharge of melt water as well as the opening or closure of taliks within otherwise frozen ground are essential processes for the modeling of permafrost the benchmark studies prove our model s ability to depict them correctly 5 mountain permafrost simulations after benchmarking the thermo hydraulic behavior of our approach against well established permafrost models we run a series of numerical case studies to simulate subsurface processes in the context of mountain permafrost thereby we consider complex topographies seasonal thawing and freezing and saturated and unsaturated conditions the elevation profile of the first case study is obtained from the zugspitze de it reaches from 1788m up to 2962m and contains two peaks and an uneven plateau in between in the european alps permafrost occurs starting at heights between 2400m and 2600m e g haeberli et al 1975 gruber et al 2004a thus we expect permafrost free as well as permanently frozen ground and the elevation profile provides a complex topography to study active layer dynamics to investigate the influence of lateral fluxes on the distribution of permafrost and the active layer we simulate these scenarios in 1d and 2d fully 3d simulations at the scale of mountain ranges are outside of the scope of this article the second case study considers the elevation profile of the matterhorn ch it shows a steep pyramid like shape with the summit at a height of 4478m due to the cold temperatures at high altitudes the upper part of the mountain is expected to be permanently frozen and thus presents ideal conditions to investigate permafrost degradation under the influence of a warming scenario 5 1 numerical case study influence of lateral fluxes the setting of the first numerical case studies is inspired by the zugspitze the highest mountain of germany it has an elevation of 2962m and belongs to the wetterstein mountains the elevation profile is reconstructed based on data of the shuttle radar topography mission 6 6 https earthexplorer usgs gov one data point is posted for every arc second roughly 30m and we use linear interpolation to approximate the areas in between the domain is discretized into 5m wide and 2m high cells and it is at least 50 cells deep throughout the domain thus the resulting mesh consists out of 51 000 cells and has a minimal depth of 100m the upper layer of the wetterstein mountains is comprised of wetterstein limestone lauber and goldscheider 2014 thus we use best guess values of ϕ 0 5 krautblatter et al 2010 and set the reference permeability to k 0 1 0 12 m 2 the composition of the simulated domain is assumed to be homogeneous thereby we neglect the presence of cracks fractures in the solid bedrock the initial temperature inside the domain is set to 2 c close to the surface and it is extended to the entire domain by application of a regional geothermal gradient of 0 024 c m 1 peters et al 2012 spooner et al 2020 regarding the amount of water we consider a fully saturated scenario and an unsaturated scenario in which 80 of the pore space is filled with water frozen or liquid and the remaining pore volume is filled with air the initial values of the ice concentration the water saturation and the fluid to solid ratio are determined by the degree of saturation the prescribed temperature and the soil freezing curve at the topographic surface we impose daily average temperatures in form of dirichlet boundary conditions which are based on the measurements of the weather station on top of the zugspitze which are available since august 1900 7 7 https www ncdc noaa gov cdo web datasets ghcnd stations ghcnd gm000004155 detail we model the surface temperatures in form of a yearly repeating sine curve reaching its extreme values of 11 c and 3 c in the middle of february and august respectively to take changes in elevation into account we extrapolate the temperatures for the entire domain by application of a lapse rate with elevation differences calculated relative to the elevation of the weather station 2960m in fact the lapse rate itself is subject to changes due to season and elevation but for this study we rely on the traditional value of 6 5 ckm 1 minder et al 2010 at the top boundary we assume a fixed atmospheric pressure 101325pa and set the water saturation to 100 for the fully saturated scenario and to 80 for the unsaturated scenario on the sides we assume natural boundaries in equilibrium with hydrostatic pressure and regional thermal gradients the former also holds for the bottom boundary there we simulate heat generated from within the earth in form of a geothermal gradient of 0 024 cm 1 peters et al 2012 spooner et al 2020 the study is designed to show the influence of topography driven subsurface fluxes on the active layer dynamics and the distribution of permafrost thus we ignore weather dependent water fluxes solar radiation surface covers and other factors the duration of the simulation is set to 250years since the imposed boundary conditions are based on temperature measurements ranging back to august 1900 we essentially extrapolate the average climate conditions of the last 120years until the year 2150 the minimal initial and maximal time steps are set to 1 hour 1day and 10days respectively 5 2 numerical case study warming scenario the second numerical case study is inspired by the matterhorn 4478m in switzerland and we use the measurements of the pian rosa mountain top airport 3488m in italy 8 8 https www ncdc noaa gov cdo web datasets ghcnd stations ghcnd itm00016052 detail which is located 6km south south east from the peak of the matterhorn as a reference for the surface temperature the mesh is created analogously to the first set of case studies we set the minimal depth of the domain to 300m and each cell measures 5m by 1m resulting in a mesh with 270 000 cells the matterhorn s pyramid shaped summit mainly consists of gneiss of the dent blanche nappe pleuger et al 2007 according to rempel et al 2016 the permeability of this material ranges from 10 18 to 10 12 m 2 and the authors use a nominal value of 10 14 m 2 for their study which is what we also use as reference permeability in our study for the reference porosity we use a value of 1 draebing and krautblatter 2012 the initial conditions coincide with those of the first case study the same applies for the boundary conditions except of the imposed surface temperatures for the first 100years we use periodic temperature boundary conditions in form of a sine curve with extreme values of 13 8 c and 3 2 c which are reached in the mid of february and august respectively again we extrapolate these values for the entire surface of the domain by application of a lapse rate of 6 5 c km 1 relative to an elevation of 3488m during this initialization period permafrost and active layer can form under repeated seasonal freezing and thawing afterwards we increase the temperature at a rate of 0 045 c dec 1 which corresponds to the average warming of the near surface air temperature for the european land since 1981 etzelmüller et al 2020 for the next 150years since the surface temperature of the initialization period is taken as an average based on measurements taken between 1965 and 2021 the warming period can be interpreted as ranging from approximately 1993 until 2143 the initial the minimal and the maximal time steps are the same as for first case study 5 3 results 5 3 1 numerical case study influence of lateral fluxes saturated scenario the distributions of permafrost and of the active layer of the one dimensional simulation after 50years and after 250years are visualized in figs 6 a and 6 c from the beginning to the end of the simulation the active layer stays nearly unchanged while the amount of permanently frozen ground decreases with time after 250years the distributions of permafrost and the active layer are quite uniform and follow the elevation profile of the mountain with higher elevation leading to increased permafrost thickness here and in the following we measure the thickness of a layer as its extent along the vertical z axis the relation between the elevation and the thickness of the permafrost layer is further explored in fig 7 a in the setting of this simulation the surface temperature is solely dependent on the elevation below 2440m no permafrost occurs at higher elevations the thickness of the permafrost layer increases until it is bounded by the depth of the domain the active layer first occurs at an elevation of around 2000m and increases with the elevation until it reaches its maximum thickness of 18m at an elevation of 2402m from this point it slowly decreases to a thickness of 2m at an elevation of 2962m in the case of the 2d simulation there is no obvious relation between the layer thicknesses and the elevation as visualized in fig 7 b with higher elevation and thus colder temperatures the thickness of the permafrost layer increases and the thickness of the active layer decreases multiple significant exceptions occur around exposed positions which are located at elevations of 2000m 2400m and 2900m we show the distribution of the active layer and the permafrost layer in graphics 6 b and 6 d after 50years the active layer varies across the full length of the mountain profile with increased dynamics around local peaks and other exposed positions otherwise most of the simulated domain is covered by permafrost whereby local incisions can be found underneath local valleys or sinks after 250years the permafrost layer has further grown most of the formerly present gaps have closed and above an elevation of 2200m the permafrost layer reaches the bottom of the domain nearly throughout the entire domain underneath the largest sink in the middle of the plateau the permafrost layer is interrupted by a portion of unfrozen ground the active layer remained nearly unchanged its thickness reaches values of up to 38m and in the case of the small peak at the right of domain of even 76m the distribution of both layers is visualized in fig 6 d we compare the permafrost distributions and the active layers of the 1d and 2d simulation in figs 8 a and 8 b the thickness of the active layer in the 2d simulation is more variable takes more extreme values and its peaks and lows are not reflected in the 1d results furthermore 2d modeling leads to significantly more permafrost than the 1d approach while the latter shows no permafrost below an elevation of 2440m the permafrost layer of the multi dimensional simulation regionally still expands over the entire depth of the simulated domain 5 3 2 numerical case study influence of lateral fluxes unsaturated scenario in the dynamic 1d simulation of the unsaturated scenario due to gravity the present air gets flushed out of the system and it is replaced with water thus after 250years the results of the unsaturated scenario match those of the fully saturated one for the 2d case the general behavior of the unsaturated scenario matches the one of the saturated simulation the permafrost layer covers most of the simulated depth throughout the domain and shows irregularity at the uneven plateau between the two peaks where a talik opens also the active layer thickness varies across the full length of the elevation profile with increased seasonal thawing and freezing around local peaks and hills close to the peaks the influence of the increased water content becomes apparent fig 9 a displays the difference of the permafrost layers of the unsaturated and the fully saturated scenario at smaller peak in the saturated case more ground stays permanently frozen and the permafrost layer is more interconnected while additional patches of unfrozen ground can be found for the unsaturated case locally at one of these gaps the permafrost thickness of the two simulations differs by up to 92m the difference in the degrees of saturation of the two scenarios is shown in fig 9 b the top of the peak is unsaturated throughout the year with increased saturation levels during the summer in the summer the fully saturated bedrock locally rises up to an elevation of up to 2472m and it drops below 2454m in the winter similar phenomena occur at all peaks and exposed positions of the simulated domain 5 3 3 numerical case study warming scenario in fig 10 we show the distribution and the thickness of the permafrost layer at the start of the warming period as well as after 50 100 and 150years of the warming period at the end of the initialization period the domain above an elevation of 3200m is entirely frozen below this threshold the permafrost thickness reaches at least 102m on the left and 53m on the right side of the summit from this point in time the surface temperature increases with a warming rate of 0 045 c dec 1 after 50years of warming at an elevation of 3000m first signs of degradation become visible in form of a gap between the surface and the underlying permafrost layer at higher elevation the thickness of the permafrost layer is still increasing 100years into the warming period the degradation has progressed significantly in the left picture of fig 10 the thawing is not only occurring at the top of the permafrost layer but also at its bottom comparison with the state after 50years of warming displays that the permanently frozen ground is notably reduced and permafrost no longer occurs below 3034m at the end of the simulation after 150years of warming it can only be found above 3120m and its extent has further declined throughout the entire warming period the regions above 3600m remained mostly unchanged despite the increase in temperature 5 4 discussion the focal point of the numerical case studies is the sensitivity of permafrost to lateral subsurface thermal and fluid fluxes along topographic gradients one dimensional models are widely used for deriving regional and basin scale estimates of permafrost depths in 1d simulations the vertical columns are only influenced by the boundary conditions at their top and bottom thus the temperature fields and therefore the thickness and distribution of the permafrost layer and the active layer is solely controlled by the thermal and hydrological parameters of the bedrock the applied geothermal gradient and the ground surface temperature the influence of the surroundings and thus the surface geometry of the mountain is not taken into account the multi dimensional simulations clearly show the influence of lateral fluid and thermal fluxes on permafrost depths and distribution and their small scale manifestations e g around local peaks and valleys cannot be ignored contrary to the 1d modeling approaches convection driven heat transfer plays an indispensable role the lateral fluxes lead to an increased exposure of hills and peaks to the applied weather conditions as well as the runoff and accumulation of liquid water in local sinks and valleys and therefore to the formation of taliks patchy and discontinuous permafrost layers and enhanced active layer dynamics around topographically exposed positions and along permafrost boundaries during the formation of permafrost the presence of frozen ground nearby has a compounding effect leading to further growth of the permafrost layer in the 2d simulation and thus to a thicker and more extended permafrost layer in case of the two dimensional simulations this is ignored by one dimensional modeling our findings coincide with the claims by etzelmüller 2013 and gruber et al 2004b regarding the importance of lateral influences on alpine permafrost modeling following the same line of reasoning lateral fluxes should lead to significant differences between 2d and 3d simulations and consequently between 2d simulations and reality naturally the amount of water inside the porous medium influences the ice water phase transition and thus the degree of saturation has to be considered the relative ratio of the pore filling fluids influences the density the thermal conductivity and the heat capacities of the mixture therefore parameters which are relevant for freezing and thawing processes change throughout the domain and over time in the one dimensional mountain permafrost simulations the unsaturated conditions are not portrayed correctly since the air gets flushed out of the system thus the formation of mixing zones and dry regions which locally lead to significant differences in the thickness and distribution of the permafrost layer and to the opening of taliks in otherwise frozen ground is not taken into account the sensitivity of permafrost to warming trends has been established in previous research e g etzelmüller et al 2020 connon et al 2018 describe the process of permafrost degradation as follows warmer temperatures lead to the widening of the active layer and subsequently to the opening of taliks between the active layer at the surface and the permafrost underneath in the following the unfrozen gaps expand and the permafrost layer shrinks and consequently vanishes this description coincides with our observations of the warming scenario where we find the formation and expansion of a gap between the surface and the permafrost layer during its degradation 5 5 limitations of the study the numerical case studies are intended to show the influence of topography driven lateral subsurface thermal and fluid fluxes on the distribution of permafrost thereby we use idealized mountain settings and purposefully restrict the number of modeled surface processes to rule out alternative causes in order to highlight the impact of the elevation profile we apply simplified surface boundary conditions thus the air pressure and the water saturation are imposed as homogeneous constant values and the ground surface temperature is modeled in form of a yearly repeating sine curve we intentionally do not consider daily fluctuations since this would limit our simulations to time steps of a few hours however neglecting warmer temperatures during the day and colder temperatures at night influences the simulated active layer dynamics weather variables e g noetzli et al 2007 luetschg et al 2008 kokelj et al 2015 such as wind precipitation and solar radiation as well as slope and aspect are ignored in order to isolate and study the impact of lateral fluxes on subsurface processes for the same reason we use idealized reconstructions of the morphological as well as geophysical settings of the zugspitze and the matterhorn the bedrock is assumed to be homogeneous and the presence of different kinds of soil and rocks and thus the resulting porosity permeability and thermal conductivity variations are ignored cracks and clefts which form essential water flow paths and significantly affect the distribution of permafrost hasler et al 2011 are not considered furthermore surface covers were ignored in this study glaciers influence both the temperature and the water saturation close to the surface according to haeberli 1983 the temperatures at the base of glaciers are higher than at rocks which are in direct contact to the atmosphere since our model resolves only subsurface processes it does not consider snow and therefore ignores its insulating effect its influence on the ground surface temperature the runoff of melt water and the evolution of snow covers in the context of global warming e g bavay et al 2013 to that extent our model will benefit from coupling with surface snow and glacier models we note that for reliable simulation results suitable for valid predictions more effects have to be taken into account and full 3d simulations have to be considered however already our simplified 2d results show the impact of lateral fluxes on subsurface fluid and heat dynamics and the need for multi dimensional modeling 6 conclusion and outlook we present an extended multi physics model for subsurface permafrost in alpine regions the benchmark studies demonstrate the ability of our model to portray phase change in combination with flow processes correctly and to predict the opening and closure of gaps of unfrozen ground within permafrost regions the thermal hydraulic behavior of the model coincides with that of well established soil freezing models from the results of the numerical case studies we draw the following conclusions the complex topographies of mountainous regions lead to lateral fluxes which influence the distribution and thickness of permafrost as well as active layer dynamics at local peaks and other exposed positions the lateral movement of pore fluid and the resulting heat transport leads to a thicker active layer while the accumulation of liquid water in local sinks and valleys leads to a highly irregular permafrost distribution and even to the formation of taliks in otherwise frozen ground our results should not be considered as realistic forecasts for the chosen mountain regions but rather as an argument for the importance of multi dimensional modeling of mountain permafrost the comparison of 1d and 2d simulations shows clearly that the one dimensional modeling approach fails to account for the influence of topographic gradients lateral subsurface thermal and fluid fluxes and different degrees of saturation finally changes in the degree of saturation alter the properties of the pore fluid mixture and thus influence thermal and fluid fluxes as well as freezing and thawing processes while an increased pore water content leads to a thicker and more connected permafrost layer drier conditions result in a less regular and more patchy distribution of permafrost even small changes in the degree of saturation can cause large local differences in the thickness of the permafrost layer the results of this study and the presented model are not only limited to alpine permafrost environments recently one dimensional thermo hydraulic models for unsaturated flow were used to study the formation and expansion of taliks in the northwest territories canada devoie et al 2019 besides soil freezing in unsaturated conditions the model is generally well suited to describe freezing and thawing processes in combination with mobile gas phases therefore sub permafrost methane concentrations such as in svalbard norway hodson et al 2020 and northwest alaska sullivan et al 2021 provide possible future areas of application credit authorship contribution statement jonas beddrich conceptualization methodology software validation writing original draft writing review editing visualization shubhangi gupta conceptualization methodology software writing review editing barbara wohlmuth conceptualization writing review editing supervision gabriele chiogna conceptualization writing review editing supervision declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments we would like to thank dr christophe grenier for his input on the recreation of the benchmark studies we gratefully acknowledge the support of the german science foundation dfg for funding part of this work through grant wo 671 11 1 gc acknowledges funding from the dfg research group germany for2793 2 sensitivity of high alpine geosystems to climate change since 1850 sehag through grant ch 981 3 2 appendixa benchmark results here we show all performance measures of all scenarios of the benchmark test cases our results red are plotted in front of those of the other study participants gray additionally we show the temperature fields at significant points in time a 1 melting of a frozen inclusion in the following each row displays the development of the minimum temperature within the domain left the net heat flux entering the domain middle and the total volume of liquid water within the domain right the four scenarios of the benchmark study consider hydraulic gradients of 0 3 9 and 15 furthermore we show the temperature field after 8h for all hydraulic gradients see figs a 11 a 15 a 2 talik opening closure in the following each row displays the development of the total heat in the domain left the temperature in the center of the domain middle and the temperature 18 cm above the center of the domain right the four scenarios of the benchmark study consider hydraulic gradients of 3 6 9 and 15 furthermore we show the temperature field after 200h for all hydraulic gradients see figs a 16 a 20 appendixb parameter tables b 1 see table b 1 b 2 see table b 2 b 3 see table b 3 b 4 see table b 4 
84,alpine permafrost environments are highly vulnerable and sensitive to changes in regional and global climate trends thawing and degradation of permafrost has numerous adverse environmental economic and societal impacts mathematical modeling and numerical simulations provide powerful tools for predicting the degree of degradation and evolution of subsurface permafrost as a result of global warming a particularly significant characteristic of alpine environments is the high variability in their surface geometry which drives large lateral thermal and fluid fluxes along topographic gradients the combination of these topography driven fluxes and unsaturated ground makes alpine systems markedly different from arctic permafrost environments and general geotechnical ground freezing applications and therefore alpine permafrost demands its own specialized modeling approaches in this work we present a multi physics permafrost model tailored to subsurface processes of alpine regions in particular we resolve the ice water phase transitions unsaturated conditions and capillary actions and account for the impact of the evolving pore space through freezing and thawing processes moreover the approach is multi dimensional and therefore inherently resolves the topography driven horizontal fluxes through numerical case studies based on the elevation profiles of the zugspitze de and the matterhorn ch we show the strong influence of lateral fluxes in 2d on active layer dynamics and the distribution of permafrost keywords mountain permafrost ice water phase transition unsaturated flow mathematical modeling data availability data will be made available on request 1 introduction the cryosphere of the european mountains is expected to experience drastic changes within the next decades such as the disappearance of glaciers the rise of snow lines the expansion of vegetation and the degradation of permafrost at lower altitudes beniston et al 2018 while the former three can be observed visually the current state of permafrost has to be monitored in form of borehole measurements etzelmüller 2013 or under application of electrical resistivity tomography e g you et al 2013 permafrost is defined as ground where temperatures have remained continuously below 0 c for a period of at least two consecutive years e g riseborough et al 2008 the eu funded permafrost and climate in europe project pace has been monitoring the mountain permafrost in europe over the last twenty years the results show clear warming trends at all investigated sites across europe down to a depths of 50 meters and an increase of up to 200 in the thickness of the active layer etzelmüller et al 2020 i e the zone that seasonally thaws and refreezes the degradation of permafrost has a major influence on slope stability e g krautblatter et al 2013 mccoll 2012 construction and engineering e g bommer et al 2010 arenson et al 2009 hydrological systems and water management e g liu et al 2007 quinton et al 2011 and greenhouse gas emissions e g schuur et al 2015 anthony et al 2012 modeling and simulation of mountain permafrost are essential to assess the impacts of global climate change and to predict manage and mitigate the associated risks alpine regions are characterized by their high spatial variability of elevation subsurface composition geomorphology and micro climatology gruber and haeberli 2009 with differences of up to 6 c in mean annual ground surface temperature magst within 300 m gubler et al 2011 additionally the topographic variations lead to lateral thermal and fluid fluxes which require multi dimensional modeling etzelmüller 2013 and cannot be represented by one dimensional subsurface heat transport gruber et al 2004b finally dry climate as well as the topography of alpine regions can lead to unsaturated subsurface conditions gruber et al 2017 thus alpine permafrost models also need to account for the presence of air and freezing of unsaturated soils and therefore demand more specialized and detailed multi physics concepts than general permafrost and geotechnical soil freezing models in recent years numerous approaches to describe the evolution of permafrost have been developed modern empirical statistical models combine permafrost evidence and climate data to estimate the occurrence of permafrost statistical approaches such as by boeckli et al 2012 use inventories of active and relict rock glacier sites in combination with mean annual rock surface temperature marst measurements to assess the state of permafrost the model by sattler et al 2016 additionally considers solar radiation in snow free months to obtain the probability for the presence of permafrost recently deluigi et al 2017 applied machine learning algorithms to thermal and geoelectrical field data in combination with rock glacier inventories to estimate the occurrence of permafrost achieving an accuracy of up to 88 in contrast physics based models formulate thermal and hydraulic processes in the form of mathematical expressions of conservation laws and conduct simulations by application of numerical methods since even two dimensional simulations of a single mountain can lead to run times of several weeks e g magnin and josnin 2021 usually concessions are made by either limiting the number of considered processes or in form of simplifying assumptions such as neglecting horizontal thermal and fluid fluxes the latter justifies the usage of one dimensional numerical schemes and thus significantly reduces the complexity and computational cost multiple regional and global scale models that use one dimensional approaches have been applied to study areas in norway hipp et al 2012 alaska jafarov et al 2012 and north east siberia westermann et al 2016 as well as to study permafrost in the context of snow cover luetschg et al 2008 rock glaciers pruessner et al 2021 and high altitude environments ekici et al 2014 the so called 2 5d models alpine3d lehning et al 2006 and geotop2 0 endrizzi et al 2014 fiddes et al 2015 combine three dimensional hydrological approaches close to the surface with one dimensional modeling of deeper subsurface processes their possible applications range from permafrost development to avalanche warnings and flood forecasting a surface energy balance coupled with three dimensional subsurface heat transfer has been applied to highly idealized mountain settings by noetzli et al 2007 and to a realistic mountain profile by noetzli and gruber 2009 showing the existence of permafrost even without indication of the ground surface temperature despite multiple studies e g etzelmüller 2013 kurylyk et al 2016 suggesting the importance of lateral influences applications of multi dimensional thermo hydraulic concepts to mountain permafrost are rare also most established soil freezing models are not intended for the use in alpine regions in the case of sutra ice mckenzie et al 2007 problems occur when modeling the freezing of unsaturated soil and its simulation of active layer dynamics is not accurate bui et al 2020 marsflo painter 2011 considers a simplified ice water phase transition while pflotran ice karra et al 2014 assumes full saturation of the modeled soil and thus considers water as the only fluid phase also modern ground freezing models which are primarily focused on geotechnical applications such as frost heave and the formation of ice lenses assume fully saturated soil e g sweidan et al 2021 nishimura and wang 2019 or consider unsaturated conditions but resolve freezing processes without consideration of the air huang and rudolph 2021 thus they ignore the strong capillary effects in the fringe zones which in the presence of complex morphologies can lead to inaccurate convective fluxes and thus to incorrect active layer dynamics for a detailed overview of the concepts of permafrost modeling we refer to the work of riseborough et al 2008 and to the articles by bui et al 2020 and gao et al 2021 for reviews of hydrological models that have been applied to the permafrost dominated arctic regions and the qinghai tibet plateau in order to address the summarized gaps in the modeling of alpine permafrost we have developed a detailed thermo hydraulic model tailored to the special geophysical and geomorphological conditions of alpine regions in particular we use a continuum based permafrost model that includes unsaturated flow and the associated capillary actions and generalizes the process of soil freezing such that it is compatible with three phase conditions in the fringe layers moreover the way in which we resolve the pore water to pore ice phase transition allows high flexibility in the choice of the soil freezing curve most importantly our model is multi dimensional and therefore naturally considers thermal and fluid fluxes along topographic gradients the rest of the paper is structured as follows the mathematical model and numerical scheme are presented in detail in sections 2 and 3 the thermo hydraulic behavior of the model is benchmarked comprehensively in section 4 using the test cases proposed by the interfrost project rühaak et al 2015 in section 5 a series of numerical case studies are performed based on the elevation profiles of the two distinctly different and prominent peaks of the zugspitze de and the matterhorn ch we compare the results of one dimensional and two dimensional permafrost modeling and study the influence of different degrees of saturation and the impact of a warming scenario on permafrost finally we provide a conclusion and an outlook in section 6 2 mathematical model the main phenomenological process of interest for our permafrost model is the influence of long range e g global warming and short range e g seasonal or daily temperature changes on freezing and thawing of soil with the objective of analyzing the sensitivity of alpine permafrost to cyclic or continuous temperature changes at a process level the model focuses on resolving the complex pore water to pore ice phase transition and the associated transport of heat and pore fluids thereby we also account for the presence of air and consider its effects on pore water and heat transport our model is based on the macroscopic continuum theory of multi phase flow in porous media it considers two mobile and immiscible fluid phases namely air subscript a and water subscript w and two immobile and undeformable solid phases namely ice subscript i and granular sediment or rock subscript s the solid phases constitute the skeleton of the porous medium while the fluid phases occupy the void spaces the mathematical description of the fundamental conservation laws is based on the following homogenized variables defined locally over an arbitrary representative elementary volume rev see fig 1 contained within a domain of interest ω r d with d 2 3 porosity ϕ x t fluid phase saturations s a x t and s w x t and solid phase concentrations c i x t and c s x t with position x ω and time t r the following summation conditions hold 1 s a s w 1 c i c s 1 2 1 governing equations under the assumptions of local thermal equilibrium within an rev local thermodynamic equilibrium at the ice water phase interface and low reynolds numbers for the flow of pore fluids the transport process within the porous medium can be expressed in form of the following conservation laws we consider phase wise mass conservation 2 t ϕ ρ a s a ρ a v a 0 3 t ϕ ρ w s w ρ w v w q f 4 t 1 ϕ ρ i c i q f 5 t 1 ϕ ρ s c s 0 where ρ α x t denotes the phase densities v α x t the phase velocities for α a w i s and q f x t is the rate of mass exchange from pore water to pore ice during freezing the parameter values of the different problem settings are listed in appendix b the momentum of the solid phases is always conserved due to their immobility i e v i v s 0 in the case of the air and the water phase the velocities are given by darcy s law helmig et al 1997 6 v a k k r a μ a p a ρ a g 7 v w k k r w μ w p w ρ w g where k x t denotes the absolute hydraulic permeability of the medium μ α x t the phase viscosities k r α x t the relative phase permeabilities p α x t the phase pressure for α a w and g the gravity vector under the assumption of a local thermal equilibrium the energy balance can be stated for the bulk medium 8 α a w t ϕ ρ α s α c α v t ρ α c α p t v α σ i s t 1 ϕ ρ σ c σ c σ v t k t t l f q f where c α v x t denotes the phase wise isochoric specific heat capacities c α p x t the isobaric specific heat capacities of the fluid phases and k t x t the effective thermal conductivity of the rev it is determined by k t ϕ s a k a t s w k w t 1 ϕ c i k i t c s k s t where k α t x t denotes the phase wise thermal conductivity for α a w i s additionally l f is the latent heat of fusion which we assume to be constant in eq 8 the second term on the left hand side represents the thermal advection i e the transport of heat through the movement of fluids and the last term is the combined thermal conduction through all four phases the term on the right hand side of eq 8 is the energy released or consumed through freezing and thawing processes 2 2 constitutive relations the constitutive relations of our model describe the interactions between the phases such as the pressure difference between air and water the ice water phase transition and the impact of evolving pore volumes on fluid flow 2 2 1 hydraulic properties the capillary pressure p c x t p a p w describes the pressure difference across the interface between air and water typically the capillary pressure is described as a function of the water saturation we use the brooks corey parameterization brooks and corey 1966 9 p c p e s w e 1 λ where p e x t denotes the air entry pressure λ the pore size distribution index and s w e s w s w r 1 s w r s a r is the effective water saturation here s a r x t and s w r x t are the residual or irreducible phase saturations the relative phase permeabilities are also given according to the brooks corey model helmig et al 1997 10 k r a s a s a e 2 1 s w e 2 λ 1 k r w s w s w e 2 λ 3 where the parameter λ is the same as in eq 9 the absolute permeability is an intrinsic property of the porous medium which depends on the granular material as well as the pore network the freezing and thawing processes alter the local pore structure which in turn influences the absolute permeability we parameterize these changes according to civan s power law civan 2001 11 k ϕ ϕ 0 ϕ 1 ϕ 0 ϕ 0 1 ϕ 2 β k 0 where ϕ 0 denotes the reference porosity k 0 the reference permeability and β is an empirically derived parameter in this work we differentiate between the reference porosity ϕ 0 which is a material parameter and the unknown ϕ which describes the changing ratio of fluids and solids 2 2 2 ice water phase transition the freezing behaviors of bulk water and pore water are fundamentally different tian et al 2014 in a highly idealized setting the ice water phase transition in a porous medium can be derived based on the assumption of a thermo hydraulic equilibrium loch 1978 while in practice empirically derived soil freezing curves are used to determine the amount of unfrozen pore water based on the temperature and soil properties an overview on recent advances in the parameterization of liquid water in frozen soils can be found in hu et al 2020 in our model we utilize the following soil freezing curve 12 s f c t 1 if t t f η 1 η exp t t f w otherwise where w controls the steepness of the curve and t f denotes the freezing point of water the relative amount of water that stays unfrozen is set to η 0 05 e g mckenzie et al 2007 under the assumption that the amount of unfrozen water is greater or equal than the soil freezing curve whereby equality holds in presence of ice i e c i 0 we obtain a set of karush kuhn tucker complementary conditions kuhn and tucker 2014 to describe the ice water phase transition 13 c i 0 ψ s w ϕ 1 s a ϕ 1 ϕ c s s f c t 0 c i ψ 0 as outlined in lauser et al 2011 we can rewrite this nonlinear complementarity problem ncp in the form of a piece wise differentiable function 14 c i max 0 c i ψ 0 here we use the most trivial ncp function more sophisticated problem specific choices having better convergence properties can be found in hager and wohlmuth 2009 and in the review wohlmuth 2011 this generalized formulation of the ice water phase transition also accounts for the presence of air and thus is applicable to the freezing of unsaturated soil 3 numerical solution to condense the mathematical model we replace q f in eq 8 with the left side of eq 3 and by summation of eqs 3 and 4 we obtain a combined mass balance equation for ice and water 15 t ϕ ρ w s w ρ w v w t 1 ϕ ρ i c i 0 eliminating the unknown q f additionally we substitute the velocities of air and water in eqs 2 15 and 8 with the expressions given by darcy s law in eqs 6 and 7 exploiting eqs 1 and 9 we obtain the condensed mathematical model which consists of five governing equations partial differential eqs 2 8 and 15 the ordinary differential eq 5 and the ncp 14 we choose p p a s w c i ϕ t t as primary variables and determine the secondary variables s p w s a c s q f t based on their values due to the brooks corey model in eqs 9 and 10 civan s power law 11 and the soil freezing curve 12 the resulting system is highly nonlinear the governing equations are discretized in space using a fully upwinded cell centered finite volume method and in time using a fully implicit finite difference method the fluxes across the cell interfaces are approximated using a linear two point finite difference approximation defined on an orthogonal mesh with rectangular p0 elements we linearize the discretized system by implementation of a semi smooth newton solver wohlmuth 2011 this approach can handle the semi smooth formulation of the ice water phase transition and thus the appearance and disappearance of phases the time step size is adapted based on the performance of the newton solver it is increased by 10 if less than 4 newton iterations were taken for the last time integration step and decreased by 10 if more than eight iterations were necessary to reach the minimal reduction threshold similar approaches have already been applied successfully in the context of resolving phase transitions in submarine methane hydrates gupta et al 2020 fractured porous media berge et al 2020 and contact mechanics hager and wohlmuth 2009 the resulting linear system is solved by a algebraic multi grid amg parallel solver with a stabilized bi conjugate gradient method as preconditioner the numerical scheme is implemented within the c based dune pdelab framework version 2 8 bastian et al 2010 using the built in solver library the code is available upon request inherently the model is three dimensional for the 2d simulations we consider meshes that extend only in the horizontal and vertical direction along the 3rd axis we consider all fluxes to be zero to compare 1d and 2d simulations in section 5 we also set the horizontal fluxes to zero and consider only vertical fluxes to create one dimensional modeling results 4 benchmark studies in order to validate the thermo hydraulic coupling in our mathematical model we ran two benchmark test cases melting of a frozen inclusion th2 and talik opening closure th3 both of which were developed as part of the interfrost project rühaak et al 2015 and provide useful settings for benchmarking ice water phase changes and advective mass and heat fluxes using the proposed performance measures grenier et al 2018 we make detailed comparisons of our simulation results with those of the other well established numerical codes which were the original participants of the benchmark study these include ats coon et al 2019 cast3m 1 1 www cast3m cea fr comsol 2 2 www comsol com comsol multiphysics darcytools svensson et al 2014 feflow diersch 2013 flexpde 3 3 www pdesolutions com geoan holmén et al 2011 ginette rivière et al 2014 melt frederick and buffett 2014 permafoam 4 4 www openfoam com pflotran ice karra et al 2014 smoker molson et al 1992 and sutra mckenzie et al 2007 after its publication the benchmark study has been recreated by arzanfudi and al khoury arzanfudi and al khoury 2018 note that the results of the above codes which are used in this manuscript are freely available on the website of the interfrost project 5 5 https wiki lsce ipsl fr interfrost we intend to show that under standard settings our results are consistent with those of the well established models 4 1 melting of a frozen inclusion due to the seasonal thawing of the upper soil layers and the resulting runoff of melt water the bi directional coupling between thermal and hydraulic processes is important for the correct description of active layer dynamics the first benchmark targets the thermo hydraulic coupling through simulation of the thawing of a frozen inclusion under the influence of different hydraulic gradients the 3m by 1m computational domain has an initial temperature of 5 c except for the frozen inclusion of size 33 cm x 33 cm which is at 5 c the initial temperature field is visualized in fig 2 a the ratio of liquid to frozen water is determined by the prescribed temperature field and the applied soil freezing curve the soil is assumed to be saturated and thus no air is present in the domain there are no mass and heat fluxes across the bottom and the top boundaries of the domain at the left and right boundaries hydraulic heads of h 0 δ h and h 0 are imposed where δ h is chosen to create hydraulic gradients of 0 3 9 and 15 resulting in four scenarios with flows of different strengths while there is no conductive flux through the other boundaries we impose a constant temperature of 5 c at the left side we discretize the domain into 30 000 square elements and as suggested in the benchmark study the simulated time span is 9 6h the initial the minimal and the maximal time steps are set to 0 1seconds 0 1seconds and 60 seconds in all four scenarios the temperature inside the frozen inclusion rises quickly up to 1 c and remains at that level as the melting progresses from the outside of the frozen inclusion towards the inside the hydraulic gradient determines the downstream transport of water which in turn controls the convective thermal fluxes and the rate of ice water phase change these effects are clearly demonstrated in figs 2 b 2 d for the 0 hydraulic gradient the heat transport is purely conduction driven while as the hydraulic gradient increases the effects of advective heat transfer on the rate of thaw become increasingly dominant fig 3 shows the comparison of our results with the other participating codes based on the following performance measures the minimal temperature in the domain the total heat flux exiting the system and the total liquid water volume for the hydraulic gradients of 3 and 15 the outcomes of all scenarios are shown in appendix a in all scenarios the minimal temperature starts at 5 c rises within the first hour up to 1 c and increases slowly thereafter due to latent heat effects after 9 h the minimal temperature of the 15 case rose steeply up to 3 c at this point the frozen inclusion has melted entirely the total heat flux exiting the system stays close to 0j until the downstream moving melt water of the frozen inclusion reaches the right boundary of the domain and declines afterwards as more and more cold water leaves the system for the hydraulic gradients of 3 and 15 this takes 8 and 3h respectively after 5h the total heat flux of the 15 scenario starts to increase by then the melting of the frozen inclusion has progressed so far that the amount of melt water reaching the right boundary of the domain is already declining for the total liquid water volume the simulations start with a value of 1 069 m3 with the thawing of the frozen inclusion the amount of liquid water increases until it reaches its maximal value of 1 11 m3 at this point the entire frozen inclusion has melted 4 2 talik opening closure the term talik describes permanently unfrozen ground in permafrost areas which for example occurs in between the bottoms of lakes and the underlying permafrost layer rowland et al 2011 the correct distinction between permafrost and unfrozen ground as well as the prediction of the opening and closure of these gaps in otherwise permanently frozen soil is an essential feature of alpine permafrost models in this benchmark case we examine whether an idealized talik widens or narrows and subsequently closes depending on the magnitude of the flow passing through the opening as specified by the interfrost project we consider a square domain measuring 1m by 1m with an initial temperature of 5 c there are two symmetric 5 c cold hemispheres at the top and the bottom this setting is visualized in fig 4 a again the initial values of the porosity the ice concentration and the water saturation are determined from the soil freezing curve while there is no mass transfer through the top or the bottom of the domain we impose hydraulic heads at the sides to create a flow from left to right the values of the hydraulic gradients are 3 6 9 and 15 there is no conductive flux through the right side and we impose temperatures of 5 c at the left and 5 c at the top and the bottom boundaries initially we use a time step of 0 1seconds and we bound it by 0 1seconds from below and by 600 seconds from above for the discretization the domain was split into 10 000 square elements and the simulated time span is 200h at the end of the simulation all scenarios have reached a steady state shown for the hydraulic gradients of 6 and 9 in figs 4 b and 4 c for the two weakest fluxes our model predicts a closure of the talik while the remaining two scenarios result in an opening in the case of a closure the water in the middle of the domain cools down until it reaches freezing temperature the two hemispheres connect and the talik closes from that point on the entire right side of the domain freezes at the left side some water remains liquid due to the positive temperature applied at the left boundary for the higher hydraulic gradients the cold water is flushed away and replaced with warm water from the left before it reaches freezing temperature over the course of the simulation the hemispheres deform and the talik widens until a balance between the warm stream in the middle and the cold temperatures at the top and the bottom of the domain is reached for the comparison with the other participants of the benchmark study we use the following performance measures the total heat and the temperature at the center of the domain and at a point 18 cm above the center both points are visualized in fig 4 a fig 5 displays the evolution of the performance measures over the course of the simulation for the hydraulic gradients of 6 and 9 again the results of all scenarios can be found in appendix a in the 6 case the total heat increases from its initial value of 667 mj up to 677 mj within the first 15 h before it drops down to 625 mj and remains at that level with the simulation approaching steady state the temperature at the center of the domain starts at 5 c and quickly drops to 1 c when the talik closes it approaches a value of 2 2 c the temperature measured 18 cm above the center is initially at 5 c rises quickly up to 1 c and stagnates at this value before it eventually decreases and settles at a temperature of 2 66 c towards the end of the simulation for the hydraulic gradient of 9 again the measured temperatures at the center and above the center quickly approach 1 c and 1 c before both increase and level out at 4 79 c and 3 72 c in this scenario the total heat rises from its initial value continuously for the first 100h before approaching 749 mj 4 3 discussion the recreation of the benchmark study validates the thermo hydraulic behavior of our model for saturated conditions to our knowledge there is no equivalent comparison for freezing processes in unsaturated conditions within the benchmark study most of participants agree on the results of the simulations with individual codes obtaining deviating outcomes we evaluate our results against those of the coinciding codes in all four scenarios of the melting of a frozen inclusion test case the results of our model match those of the majority of participants regarding the minimal temperature and the total water volume for the second performance measure i e the total heat flux exiting the system small differences occur they are caused by the approximation of temperature and pressure gradients at the boundaries using a finite difference method based on the values at the cell centers the deviation appears most significant for the 0 hydraulic gradient since the size of the error is consistent for all four scenarios while the magnitude of the performance measure increases with the hydraulic gradient for three out of four 3 9 15 scenarios of the talik opening closure test case our results lie within the range of the benchmark study the 6 case is interesting as four of the participating codes predict an opening of the talik while the other nine forecast a closure according to grenier et al 2018 the threshold value for the hydraulic gradient whether the talik opens or closes lies between 6 3 and 6 4 confirming our outcome our results for the 6 scenario match those of the nine codes which also predict a closure of the talik the discharge of melt water as well as the opening or closure of taliks within otherwise frozen ground are essential processes for the modeling of permafrost the benchmark studies prove our model s ability to depict them correctly 5 mountain permafrost simulations after benchmarking the thermo hydraulic behavior of our approach against well established permafrost models we run a series of numerical case studies to simulate subsurface processes in the context of mountain permafrost thereby we consider complex topographies seasonal thawing and freezing and saturated and unsaturated conditions the elevation profile of the first case study is obtained from the zugspitze de it reaches from 1788m up to 2962m and contains two peaks and an uneven plateau in between in the european alps permafrost occurs starting at heights between 2400m and 2600m e g haeberli et al 1975 gruber et al 2004a thus we expect permafrost free as well as permanently frozen ground and the elevation profile provides a complex topography to study active layer dynamics to investigate the influence of lateral fluxes on the distribution of permafrost and the active layer we simulate these scenarios in 1d and 2d fully 3d simulations at the scale of mountain ranges are outside of the scope of this article the second case study considers the elevation profile of the matterhorn ch it shows a steep pyramid like shape with the summit at a height of 4478m due to the cold temperatures at high altitudes the upper part of the mountain is expected to be permanently frozen and thus presents ideal conditions to investigate permafrost degradation under the influence of a warming scenario 5 1 numerical case study influence of lateral fluxes the setting of the first numerical case studies is inspired by the zugspitze the highest mountain of germany it has an elevation of 2962m and belongs to the wetterstein mountains the elevation profile is reconstructed based on data of the shuttle radar topography mission 6 6 https earthexplorer usgs gov one data point is posted for every arc second roughly 30m and we use linear interpolation to approximate the areas in between the domain is discretized into 5m wide and 2m high cells and it is at least 50 cells deep throughout the domain thus the resulting mesh consists out of 51 000 cells and has a minimal depth of 100m the upper layer of the wetterstein mountains is comprised of wetterstein limestone lauber and goldscheider 2014 thus we use best guess values of ϕ 0 5 krautblatter et al 2010 and set the reference permeability to k 0 1 0 12 m 2 the composition of the simulated domain is assumed to be homogeneous thereby we neglect the presence of cracks fractures in the solid bedrock the initial temperature inside the domain is set to 2 c close to the surface and it is extended to the entire domain by application of a regional geothermal gradient of 0 024 c m 1 peters et al 2012 spooner et al 2020 regarding the amount of water we consider a fully saturated scenario and an unsaturated scenario in which 80 of the pore space is filled with water frozen or liquid and the remaining pore volume is filled with air the initial values of the ice concentration the water saturation and the fluid to solid ratio are determined by the degree of saturation the prescribed temperature and the soil freezing curve at the topographic surface we impose daily average temperatures in form of dirichlet boundary conditions which are based on the measurements of the weather station on top of the zugspitze which are available since august 1900 7 7 https www ncdc noaa gov cdo web datasets ghcnd stations ghcnd gm000004155 detail we model the surface temperatures in form of a yearly repeating sine curve reaching its extreme values of 11 c and 3 c in the middle of february and august respectively to take changes in elevation into account we extrapolate the temperatures for the entire domain by application of a lapse rate with elevation differences calculated relative to the elevation of the weather station 2960m in fact the lapse rate itself is subject to changes due to season and elevation but for this study we rely on the traditional value of 6 5 ckm 1 minder et al 2010 at the top boundary we assume a fixed atmospheric pressure 101325pa and set the water saturation to 100 for the fully saturated scenario and to 80 for the unsaturated scenario on the sides we assume natural boundaries in equilibrium with hydrostatic pressure and regional thermal gradients the former also holds for the bottom boundary there we simulate heat generated from within the earth in form of a geothermal gradient of 0 024 cm 1 peters et al 2012 spooner et al 2020 the study is designed to show the influence of topography driven subsurface fluxes on the active layer dynamics and the distribution of permafrost thus we ignore weather dependent water fluxes solar radiation surface covers and other factors the duration of the simulation is set to 250years since the imposed boundary conditions are based on temperature measurements ranging back to august 1900 we essentially extrapolate the average climate conditions of the last 120years until the year 2150 the minimal initial and maximal time steps are set to 1 hour 1day and 10days respectively 5 2 numerical case study warming scenario the second numerical case study is inspired by the matterhorn 4478m in switzerland and we use the measurements of the pian rosa mountain top airport 3488m in italy 8 8 https www ncdc noaa gov cdo web datasets ghcnd stations ghcnd itm00016052 detail which is located 6km south south east from the peak of the matterhorn as a reference for the surface temperature the mesh is created analogously to the first set of case studies we set the minimal depth of the domain to 300m and each cell measures 5m by 1m resulting in a mesh with 270 000 cells the matterhorn s pyramid shaped summit mainly consists of gneiss of the dent blanche nappe pleuger et al 2007 according to rempel et al 2016 the permeability of this material ranges from 10 18 to 10 12 m 2 and the authors use a nominal value of 10 14 m 2 for their study which is what we also use as reference permeability in our study for the reference porosity we use a value of 1 draebing and krautblatter 2012 the initial conditions coincide with those of the first case study the same applies for the boundary conditions except of the imposed surface temperatures for the first 100years we use periodic temperature boundary conditions in form of a sine curve with extreme values of 13 8 c and 3 2 c which are reached in the mid of february and august respectively again we extrapolate these values for the entire surface of the domain by application of a lapse rate of 6 5 c km 1 relative to an elevation of 3488m during this initialization period permafrost and active layer can form under repeated seasonal freezing and thawing afterwards we increase the temperature at a rate of 0 045 c dec 1 which corresponds to the average warming of the near surface air temperature for the european land since 1981 etzelmüller et al 2020 for the next 150years since the surface temperature of the initialization period is taken as an average based on measurements taken between 1965 and 2021 the warming period can be interpreted as ranging from approximately 1993 until 2143 the initial the minimal and the maximal time steps are the same as for first case study 5 3 results 5 3 1 numerical case study influence of lateral fluxes saturated scenario the distributions of permafrost and of the active layer of the one dimensional simulation after 50years and after 250years are visualized in figs 6 a and 6 c from the beginning to the end of the simulation the active layer stays nearly unchanged while the amount of permanently frozen ground decreases with time after 250years the distributions of permafrost and the active layer are quite uniform and follow the elevation profile of the mountain with higher elevation leading to increased permafrost thickness here and in the following we measure the thickness of a layer as its extent along the vertical z axis the relation between the elevation and the thickness of the permafrost layer is further explored in fig 7 a in the setting of this simulation the surface temperature is solely dependent on the elevation below 2440m no permafrost occurs at higher elevations the thickness of the permafrost layer increases until it is bounded by the depth of the domain the active layer first occurs at an elevation of around 2000m and increases with the elevation until it reaches its maximum thickness of 18m at an elevation of 2402m from this point it slowly decreases to a thickness of 2m at an elevation of 2962m in the case of the 2d simulation there is no obvious relation between the layer thicknesses and the elevation as visualized in fig 7 b with higher elevation and thus colder temperatures the thickness of the permafrost layer increases and the thickness of the active layer decreases multiple significant exceptions occur around exposed positions which are located at elevations of 2000m 2400m and 2900m we show the distribution of the active layer and the permafrost layer in graphics 6 b and 6 d after 50years the active layer varies across the full length of the mountain profile with increased dynamics around local peaks and other exposed positions otherwise most of the simulated domain is covered by permafrost whereby local incisions can be found underneath local valleys or sinks after 250years the permafrost layer has further grown most of the formerly present gaps have closed and above an elevation of 2200m the permafrost layer reaches the bottom of the domain nearly throughout the entire domain underneath the largest sink in the middle of the plateau the permafrost layer is interrupted by a portion of unfrozen ground the active layer remained nearly unchanged its thickness reaches values of up to 38m and in the case of the small peak at the right of domain of even 76m the distribution of both layers is visualized in fig 6 d we compare the permafrost distributions and the active layers of the 1d and 2d simulation in figs 8 a and 8 b the thickness of the active layer in the 2d simulation is more variable takes more extreme values and its peaks and lows are not reflected in the 1d results furthermore 2d modeling leads to significantly more permafrost than the 1d approach while the latter shows no permafrost below an elevation of 2440m the permafrost layer of the multi dimensional simulation regionally still expands over the entire depth of the simulated domain 5 3 2 numerical case study influence of lateral fluxes unsaturated scenario in the dynamic 1d simulation of the unsaturated scenario due to gravity the present air gets flushed out of the system and it is replaced with water thus after 250years the results of the unsaturated scenario match those of the fully saturated one for the 2d case the general behavior of the unsaturated scenario matches the one of the saturated simulation the permafrost layer covers most of the simulated depth throughout the domain and shows irregularity at the uneven plateau between the two peaks where a talik opens also the active layer thickness varies across the full length of the elevation profile with increased seasonal thawing and freezing around local peaks and hills close to the peaks the influence of the increased water content becomes apparent fig 9 a displays the difference of the permafrost layers of the unsaturated and the fully saturated scenario at smaller peak in the saturated case more ground stays permanently frozen and the permafrost layer is more interconnected while additional patches of unfrozen ground can be found for the unsaturated case locally at one of these gaps the permafrost thickness of the two simulations differs by up to 92m the difference in the degrees of saturation of the two scenarios is shown in fig 9 b the top of the peak is unsaturated throughout the year with increased saturation levels during the summer in the summer the fully saturated bedrock locally rises up to an elevation of up to 2472m and it drops below 2454m in the winter similar phenomena occur at all peaks and exposed positions of the simulated domain 5 3 3 numerical case study warming scenario in fig 10 we show the distribution and the thickness of the permafrost layer at the start of the warming period as well as after 50 100 and 150years of the warming period at the end of the initialization period the domain above an elevation of 3200m is entirely frozen below this threshold the permafrost thickness reaches at least 102m on the left and 53m on the right side of the summit from this point in time the surface temperature increases with a warming rate of 0 045 c dec 1 after 50years of warming at an elevation of 3000m first signs of degradation become visible in form of a gap between the surface and the underlying permafrost layer at higher elevation the thickness of the permafrost layer is still increasing 100years into the warming period the degradation has progressed significantly in the left picture of fig 10 the thawing is not only occurring at the top of the permafrost layer but also at its bottom comparison with the state after 50years of warming displays that the permanently frozen ground is notably reduced and permafrost no longer occurs below 3034m at the end of the simulation after 150years of warming it can only be found above 3120m and its extent has further declined throughout the entire warming period the regions above 3600m remained mostly unchanged despite the increase in temperature 5 4 discussion the focal point of the numerical case studies is the sensitivity of permafrost to lateral subsurface thermal and fluid fluxes along topographic gradients one dimensional models are widely used for deriving regional and basin scale estimates of permafrost depths in 1d simulations the vertical columns are only influenced by the boundary conditions at their top and bottom thus the temperature fields and therefore the thickness and distribution of the permafrost layer and the active layer is solely controlled by the thermal and hydrological parameters of the bedrock the applied geothermal gradient and the ground surface temperature the influence of the surroundings and thus the surface geometry of the mountain is not taken into account the multi dimensional simulations clearly show the influence of lateral fluid and thermal fluxes on permafrost depths and distribution and their small scale manifestations e g around local peaks and valleys cannot be ignored contrary to the 1d modeling approaches convection driven heat transfer plays an indispensable role the lateral fluxes lead to an increased exposure of hills and peaks to the applied weather conditions as well as the runoff and accumulation of liquid water in local sinks and valleys and therefore to the formation of taliks patchy and discontinuous permafrost layers and enhanced active layer dynamics around topographically exposed positions and along permafrost boundaries during the formation of permafrost the presence of frozen ground nearby has a compounding effect leading to further growth of the permafrost layer in the 2d simulation and thus to a thicker and more extended permafrost layer in case of the two dimensional simulations this is ignored by one dimensional modeling our findings coincide with the claims by etzelmüller 2013 and gruber et al 2004b regarding the importance of lateral influences on alpine permafrost modeling following the same line of reasoning lateral fluxes should lead to significant differences between 2d and 3d simulations and consequently between 2d simulations and reality naturally the amount of water inside the porous medium influences the ice water phase transition and thus the degree of saturation has to be considered the relative ratio of the pore filling fluids influences the density the thermal conductivity and the heat capacities of the mixture therefore parameters which are relevant for freezing and thawing processes change throughout the domain and over time in the one dimensional mountain permafrost simulations the unsaturated conditions are not portrayed correctly since the air gets flushed out of the system thus the formation of mixing zones and dry regions which locally lead to significant differences in the thickness and distribution of the permafrost layer and to the opening of taliks in otherwise frozen ground is not taken into account the sensitivity of permafrost to warming trends has been established in previous research e g etzelmüller et al 2020 connon et al 2018 describe the process of permafrost degradation as follows warmer temperatures lead to the widening of the active layer and subsequently to the opening of taliks between the active layer at the surface and the permafrost underneath in the following the unfrozen gaps expand and the permafrost layer shrinks and consequently vanishes this description coincides with our observations of the warming scenario where we find the formation and expansion of a gap between the surface and the permafrost layer during its degradation 5 5 limitations of the study the numerical case studies are intended to show the influence of topography driven lateral subsurface thermal and fluid fluxes on the distribution of permafrost thereby we use idealized mountain settings and purposefully restrict the number of modeled surface processes to rule out alternative causes in order to highlight the impact of the elevation profile we apply simplified surface boundary conditions thus the air pressure and the water saturation are imposed as homogeneous constant values and the ground surface temperature is modeled in form of a yearly repeating sine curve we intentionally do not consider daily fluctuations since this would limit our simulations to time steps of a few hours however neglecting warmer temperatures during the day and colder temperatures at night influences the simulated active layer dynamics weather variables e g noetzli et al 2007 luetschg et al 2008 kokelj et al 2015 such as wind precipitation and solar radiation as well as slope and aspect are ignored in order to isolate and study the impact of lateral fluxes on subsurface processes for the same reason we use idealized reconstructions of the morphological as well as geophysical settings of the zugspitze and the matterhorn the bedrock is assumed to be homogeneous and the presence of different kinds of soil and rocks and thus the resulting porosity permeability and thermal conductivity variations are ignored cracks and clefts which form essential water flow paths and significantly affect the distribution of permafrost hasler et al 2011 are not considered furthermore surface covers were ignored in this study glaciers influence both the temperature and the water saturation close to the surface according to haeberli 1983 the temperatures at the base of glaciers are higher than at rocks which are in direct contact to the atmosphere since our model resolves only subsurface processes it does not consider snow and therefore ignores its insulating effect its influence on the ground surface temperature the runoff of melt water and the evolution of snow covers in the context of global warming e g bavay et al 2013 to that extent our model will benefit from coupling with surface snow and glacier models we note that for reliable simulation results suitable for valid predictions more effects have to be taken into account and full 3d simulations have to be considered however already our simplified 2d results show the impact of lateral fluxes on subsurface fluid and heat dynamics and the need for multi dimensional modeling 6 conclusion and outlook we present an extended multi physics model for subsurface permafrost in alpine regions the benchmark studies demonstrate the ability of our model to portray phase change in combination with flow processes correctly and to predict the opening and closure of gaps of unfrozen ground within permafrost regions the thermal hydraulic behavior of the model coincides with that of well established soil freezing models from the results of the numerical case studies we draw the following conclusions the complex topographies of mountainous regions lead to lateral fluxes which influence the distribution and thickness of permafrost as well as active layer dynamics at local peaks and other exposed positions the lateral movement of pore fluid and the resulting heat transport leads to a thicker active layer while the accumulation of liquid water in local sinks and valleys leads to a highly irregular permafrost distribution and even to the formation of taliks in otherwise frozen ground our results should not be considered as realistic forecasts for the chosen mountain regions but rather as an argument for the importance of multi dimensional modeling of mountain permafrost the comparison of 1d and 2d simulations shows clearly that the one dimensional modeling approach fails to account for the influence of topographic gradients lateral subsurface thermal and fluid fluxes and different degrees of saturation finally changes in the degree of saturation alter the properties of the pore fluid mixture and thus influence thermal and fluid fluxes as well as freezing and thawing processes while an increased pore water content leads to a thicker and more connected permafrost layer drier conditions result in a less regular and more patchy distribution of permafrost even small changes in the degree of saturation can cause large local differences in the thickness of the permafrost layer the results of this study and the presented model are not only limited to alpine permafrost environments recently one dimensional thermo hydraulic models for unsaturated flow were used to study the formation and expansion of taliks in the northwest territories canada devoie et al 2019 besides soil freezing in unsaturated conditions the model is generally well suited to describe freezing and thawing processes in combination with mobile gas phases therefore sub permafrost methane concentrations such as in svalbard norway hodson et al 2020 and northwest alaska sullivan et al 2021 provide possible future areas of application credit authorship contribution statement jonas beddrich conceptualization methodology software validation writing original draft writing review editing visualization shubhangi gupta conceptualization methodology software writing review editing barbara wohlmuth conceptualization writing review editing supervision gabriele chiogna conceptualization writing review editing supervision declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments we would like to thank dr christophe grenier for his input on the recreation of the benchmark studies we gratefully acknowledge the support of the german science foundation dfg for funding part of this work through grant wo 671 11 1 gc acknowledges funding from the dfg research group germany for2793 2 sensitivity of high alpine geosystems to climate change since 1850 sehag through grant ch 981 3 2 appendixa benchmark results here we show all performance measures of all scenarios of the benchmark test cases our results red are plotted in front of those of the other study participants gray additionally we show the temperature fields at significant points in time a 1 melting of a frozen inclusion in the following each row displays the development of the minimum temperature within the domain left the net heat flux entering the domain middle and the total volume of liquid water within the domain right the four scenarios of the benchmark study consider hydraulic gradients of 0 3 9 and 15 furthermore we show the temperature field after 8h for all hydraulic gradients see figs a 11 a 15 a 2 talik opening closure in the following each row displays the development of the total heat in the domain left the temperature in the center of the domain middle and the temperature 18 cm above the center of the domain right the four scenarios of the benchmark study consider hydraulic gradients of 3 6 9 and 15 furthermore we show the temperature field after 200h for all hydraulic gradients see figs a 16 a 20 appendixb parameter tables b 1 see table b 1 b 2 see table b 2 b 3 see table b 3 b 4 see table b 4 
