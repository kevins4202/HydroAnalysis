index,text
25075,plant diversity supports the high aptitude of grassland covers to provide fodder production for animal feeding and contribute to the storage of carbon while also granting pollination and aesthetics of landscapes this ability depends on the management intensity of the grassland system physical constraints and climatic characteristics most of current grassland models simulating the impact of weather conditions soil fertility and the intensity of use of grassland systems by grazing and or mowing on fodder production and carbon nitrogen fluxes inherit eco physiological and biophysical details from crop models without considering explicitly temporal changes in taxonomic and functional composition the dynamic grassland model cosmo community simulation model includes a set of rules to simulate explicitly seasonal changes in species composition of managed grasslands under various soil climate and management drivers and it is consistent with the degree of complexity of the most generic crop simulators the incorporation of cosmo functionalities into the standalone crop simulators cropsyst and wofost is proposed as a way to i reduce the uncertainty in estimations of harvested aboveground biomass agb and ii simulate dynamically the relative abundance of species for respectively the whole community and individual species considering three mixtures of grassland species with increasing complexity from mix 1 to mix 3 in a mown hay meadow in central italy massa marittima 43 03 n 10 53 e 380 m a s l we show that cosmo overall improved the model ability to reproduce observed agb in mix 1 and 2 e g with cropsyst in mix 2 relative root mean square error rrmse lowered from 35 01 to 25 27 while the model performance for mix 3 appeared as not unambiguously linked to considering plant diversity an assessment of the relative abundance estimates for the whole community indicates 30 rrmse 40 with both cosmo coupled cropsyst and wofost in mix 1 and mix 2 while it increases up to 60 in mix 3 the consequences of explicitly accounting for plant diversity for simulated grassland outputs depend on the conditions evaluated which require further studies however our results suggest that grassland modelling omitting plant diversity dynamics are likely over or underestimating harvested biomass of the plant community thus biasing projections of future fodder production and estimates of animal feed supplies this work proves for the first time that cosmo can support the simulation of grassland systems beyond its theoretical framework keywords cosmo forage production grass legume mixtures grassland modelling plant diversity relative abundance 1 introduction species rich grasslands are mixtures of plant species stages of maturity and plant tissues e g bruinenberg et al 2002 their states change continuously which is challenging for the modelling of interaction processes and feedback mechanisms occurring within the soil vegetation atmosphere continuum e g kipling et al 2016 brilli et al 2017 in modelling terms the dynamics characterizing this kind of systems suggest the adoption of individual centred models rather than mimicking average morphological and physiological features of a phytocenosis as a whole ignoring the relative abundance of different plant types in mixed communities individual centred models simulate the trade offs among plant functional traits and their plasticity in response to environmental changes e g maire et al 2013 these computations which focus on plant plant interactions are inherently resource intensive and present scalability issues as modelling applications target the ecosystem scale where biophysical and biogeochemical processes also governed by management become important and in many cases overwhelm small scale processes e g rumpel et al 2015 modelling solutions linking the processes and dynamics of individual plant types to the processes and dynamics of communities do exist integrated to specific models each one being an instance and for a limited number of species in a community e g agpasture module into apsim li et al 2011 intercrop in stics corre hellou et al 2009 and derived approaches jégo et al 2015 thivierge et al 2016 dynagram was recently developed moulin et al 2018 to address some theoretical questions about the response of a grassland species model to climatic edaphic and management forcing agents as a function of the state of the plant community the community simulation model cosmo simulates dynamically the relative abundance of different plant types in a community via its coupling with crop models reproducing at plot scale the biophysical processes of soil and vegetation in interaction with management practices confalonieri 2014 with a set of parameter values for each single plant type in a community individual genotypes or groups of genotypes such as plant functional groups cosmo updates the relative abundance of different plant types at each time step the characterization of different plant types is done by using different sets of values for the same parameters common set of parameters for all the plant types as biological parameters of plant models are generally sensitive to environmental changes the originality of cosmo is that it addresses the issue of translating these changes into a numerical framework thanks to suitability functions after confalonieri et al 2013 moreover its genericity enables it for coupling with virtually any crop vegetation model the rationale of cosmo is that plant competition and changes in the relative abundance of plant types are simulated as a response to hierarchically arranged environmental drivers biophysical and management factors either triggered or continuous which represent the suitability of different plant types to the conditions explored at each time step on this basis cosmo derives daily the value of vegetation parameters for a community of plants from both the relative presence of the different plant types and the parameter values initially set to characterize the same plant types the latter as if it were grown in monoculture these dynamically derived vegetation parameters are then used at each time step within a single instance of the crop growth simulator in so doing cosmo goes beyond the commonly accepted conventional assumption that the values assigned to model parameters determined by either calibration or measurement or extracted from literature are temporally invariant and remain constant throughout the entire simulation period this simplification is in some cases too limiting to address the challenges that agricultural systems are facing which imply that aspects related to plant diversity cannot be ignored in modelling studies they include the nutritional value of multi species grasslands delaby et al 2010 the differing herbage intake of grazing animals between mixtures and pure stands lüscher et al 2014 and between annual and perennial species pulina et al 2018 the dependence of milk protein content on the botanical composition of swards stergiatis et al 2015 and the supporting and regulating services e g pollination pest control drought resistance carbon nitrogen stocks and emissions provided by multi species swards rutledge et al 2017 in particular the high potential of multi species swards for sustaining high animal performance requires studying well balanced mixtures with regard to soil and climatic conditions peyraud et al 2014 roca fernández et al 2016 in addition there is a need in climate change studies of simulation models designed for studying the interaction between plant diversity and productivity considering that the impacts on the productivity of grasslands and its stability depend on the diversity of their composition van oijen et al 2018 accounting explicitly for changes in the botanical composition of mixed stands cosmo can simulate the performance of multi species grassland systems by expanding the potential of generic crop models towards complex vegetation covers to explore its properties and assess the sensitivity of simulated community dynamics to initial conditions and changing climate cosmo was initially coupled confalonieri 2014 with the generic crop simulator cropsyst stöckle et al 2003 however the reliability of outputs was never assessed against field data from mixed vegetation covers the aim of this study is to assess cosmo driven outputs harvested dry matter biomass and relative abundance of plant species as generated from two generic crop models cropsyst stöckle et al 2003 and wofost van keulen and wolf 1986 coupled with cosmo the choice of the two crop models was motivated by the specific interest in wofost to support yield forecasts in europe boogaard et al 2013 pagani et al 2017 and considering the extensive use of cropsyst in applied contexts worldwide e g palosuo et al 2011 asseng et al 2013 bassu et al 2014 mangani et al 2018 the assessment of four modelling systems two crop models in standalone and coupled versions was thus performed for aboveground biomass and relative abundance of plant species using multi year field data from mown grassland mixtures grown in central italy 2 materials and methods 2 1 the cosmo model cosmo simulates communities of plant species through an average parameterisation based on the relative abundance of each species the latter depends on the hierarchical aggregation of several drivers in the range 0 1 which are estimated to characterize the suitability and competitiveness of each species in a given context the community parameterisation of the generic simulator y r is updated on a daily time step for each parameter of the simulator y based on the relative abundance of each species i as follows 1 y r y i 1 n y i s c p i where yi is a given parameter of species i n is the number of simulated species in the mixture and s c p i is the relative presence of the i t h species the latter is derived at each time step t as follows 2 s c p i t s c p i t 1 s f s i c s f n i z where s c p i t 1 is the relative presence at time t 1 s f s i eq 3 is the suitability factor of the species i i is the inertial replacement coefficient z is the number of drivers and c s f is the community suitability factor eq 4 3 s f s i q 1 q z h s f i q 4 c s f i 1 i n s f s i compared to the original equation by confalonieri 2014 csf has been adapted to act as a suitability proxy of the relative growth rate i e the growth rate increases with csf in eq 3 q is the position in the hierarchic order of a given driver and h s f i q is the hierarchic suitability function of drivers estimated as 5 q h s f i q s f i q k 1 s f i q 1 s f i q k 2 h s f i q 1 s f i q 1 s f i q e l s e w h e r e where s f i q is the value of the driver of the i species in q th hierarchical position the drivers used were in this order air temperature global solar radiation and water availability the method to estimate these drivers are described in confalonieri 2014 and it is not reported here in the current version of the model senescence of individual species is not explicitly considered during the winter season plant dormancy is represented according to confalonieri and bechini 2004 the whole grass community is considered dormant after seven consecutive days with an average temperature below a given threshold 8 c calibrated during this study in a period starting in autumn as night length is longer than 13 h in spring as night length is lower than 13 h plants start to wake up the complete restart of plant growth occurs as the average temperature is higher than a given threshold 8 c calibrated during this study for more than seven consecutive days the phenology component was reset for each growing season each 1th of january 2 2 experimental data we refer to measured data of annual yield and abundance of plant species in a mixture as in staglianò et al 2008 this work focusses on the use of complex herbaceous mixtures to face the environmental conditions of the mediterranean climate piano and talamucci 1996 the experimentation was carried out from 2003 to 2007 in massa marittima tuscany italy located at 380 m a s l 43 03 north 10 53 east three grass legume mixtures hereafter mix 1 mix 2 mix 3 different in complexity were sown on october 16th 2003 and data collection was performed until may 18th 2007 table 1 the meadows were harvested once a year for hay production and the aboveground biomass dry matter agb mg ha 1 was measured only in this occurrence with a cut on 1 m2 sample areas during late spring table 1 an additional cut was applied on may 5th 2004 to remove weeds but without measuring the agb the relative abundance of the sown species was measured 11 times during the experiment in each mixture table 2 according to the point quadrat method daget and poissonet 1969 usually performed in forage resources analysis argenti et al 2011 the relative abundance of weed species was also measured but this information was not relevant for this study as each weed species was relatively little present in the three mixtures 2 3 model description and simulation design the model testing was designed to identify whether i cosmo simulated the relative abundance of plant species and ii differences in simulated agb were caused by the explicit simulation of plant diversity comparing stand alone versions and cosmo based versions of cropsyst and wofost the coupling was executed between cosmo and the two crop simulators versions implemented in the dynamic link library unimi cropml confalonieri et al 2012 the four model solutions were configured using daily weather soil properties and management data as measured or simulated at the experimental site cropsyst estimates plant growth based on the minimum between transpiration and radiation based biomass dry matter values modulated by a temperature reduction factor the model estimates the net photosynthesis without an explicit simulation of biomass partitioning and accumulation across different organs wofost models crop growth based on the difference between gross carbon assimilation and respiration it also simulates the partitioning of biomass into growing organs a high number of parameters organized in afgen arbitrary function generator tables e g van keulen and wolf 1986 describe the dependence of certain variables on average air temperature or development stage the model assessment was split in two suites of simulations i comparison of model outputs with observed data suite 1 ii assessment of models outputs under projected scenarios of climate change suite 2 simulations were performed with three sets of plant specific parameters for each forage species in the mixtures one for wofost appendices a and b one for cropsyst appendix c and one for cosmo appendix d it results 21 parameter listings combinations of seven plant species three models two additional parameter sets were derived from the parametrization of the stand alone versions of wofost appendix e and cropsyst appendix f all the sets of parameter values used to generate the simulated data were obtained during the suite 1 of simulations reported below 2 3 1 suite 1 of simulations model parameterization and evaluation with observed data the datasets described in section 2 2 were used for the calibration of models parameters some cropsyst parameters were extracted from published literature for m sativa confalonieri and bechini 2004 t repens bellocchi et al 2002b and l multiflorum abraha and savage 2007 otherwise a calibration work was performed through a trial and error process comparing the model estimates with observational data cosmo parameters were calibrated independently of the linked model to initialize the relative abundance of plant species in cosmo the sowing rate of each species was first used to run the model then to better reflect the relative abundance of species in the community at emergence the first measured abundance of each mixture was assimilated into the model as forcing input to simulate post emergent grasslands the agreement between simulated and observed values of agb and relative abundance of plant species the latter only for the cosmo coupled crop models was evaluated according to five commonly used metrics of model evaluation table 3 the relative root mean square error rrmse and the mean absolute error mae quantify the differences between predicted and observed values and indicate how far the estimates are from actual data the first explains this concept in relative terms percentage on the average the second in absolute terms the coefficient of determination r2 is the squared measure of the correlation coefficient between estimates and observations it evaluates the goodness of fit of the model that is the proportion of the observed variance explained by the estimates the modelling efficiency ef indicates whether a model better describes the data ef 0 than simply the average of the observations its extent is not consistently related to the accuracy of the estimates the coefficient of residual mass crm is a measure of the tendency of the model to overestimate crm 0 or underestimate crm 0 the observations 2 3 2 suite 2 simulations under projected scenarios of climate change simulated grassland outputs were obtained by models running for the two 20 year long time slices 1986 2005 baseline and 2020 2039 near future the baseline was generated from daily downscaled weather data the 0 25 spatial resolution cell that includes the study site uncertainties in future climate projections were investigated through two emission scenarios rcps representative concentration pathways and two general circulation models gcms according to the ipcc fifth assessment report ipcc 2013 rcp4 5 reflects emissions stabilization by 2100 while rcp8 5 indicates that emissions will continue to rise two gcms hadgem2 hadley centre uk collins et al 2011 and giss es nasa schmidt et al 2006 were used as in paleari et al 2017 stochastic weather generation was used for the statistical downscaling of projected climate changes from coarse spatio temporal resolution weather series simulated from gcms e g duveiller et al 2017 in particular for each combination time slice rcp gcm 20 year daily weather series were generated by applying gcm derived changes in precipitation and temperature to the site specific parameter files of the stochastic weather generator lars wg racsko et al 1991 which is widely used for climate changes studies to generate daily site specific climate scenarios e g höglind et al 2013 hassan et al 2014 climate change driven simulations were performed by setting an automatic option in crop models invoking a once a year mowing the 1st of june of each year five additional years were generated for each weather series for use during the initialization process of cosmo but the outputs obtained were left out and not used in the analysis simulated agb obtained with both standalone and coupled models under baseline and alternative future climate scenarios were compared using non exceedance probability distributions approximated as m n 1 100 where m is the rank order of each estimate with m 1 as the largest and m n as the lowest estimate n being the number of simulated data 3 results 3 1 suite 1 of simulations model evaluation results are presented via a set of performance metrics calculated for the whole simulation period tables 4 and 5 calculated separately by output for agb we compared standalone cropsyst and wofost and their cosmo coupled versions table 4 estimates of the relative abundance of species obtained with the two cosmo coupled crop models were assessed for both the whole community table 4 and individual species table 5 3 1 1 evaluation of cosmo for the relative abundance of plant species in the community overall the accuracy of cosmo in simulating the relative abundance of species was satisfactory table 4 in mix 1 wofost and cropsyst had the best r2 0 92 and 0 93 respectively in fact the two models adequately followed the dynamics of f and m with limited fluctuations around 80 f and 20 m but with some inaccuracies mae 15 17 other performance indices rrmse 40 ef 0 6 were also satisfactory in mix 2 both ef 0 7 and mae 7 were better than in mix 1 with both cropsyst and wofost the rrmse of mix 2 was similar to mix 1 35 while r2 was lower 0 78 0 79 but still satisfactory overall cosmo was able to follow the dynamics of plant species with both wofost and cropsyst mix 3 was the most difficult to simulate with a general departure of performance indices from their optimum values with the exception of mae 7 in general cropsyst followed better than wofost the trends of inter specific dynamics though wofost estimations were more accurate considering separately all species in mixtures table 5 the performance of cosmo was quite poor in all model species combination although the mae 4 18 and crm 0 01 0 89 were satisfactory overall the f species was better simulated than other species the residuals differences between simulated and observed data of the relative presence of species in a community fig 1 a ranged about 30 around a median value near 0 mix 3 for which a larger amount of data is available was better predicted by cropsyst than wofost fig 1d as reflected in the narrower boxplot spread of cropsyst in mix 2 fig 1c the residuals had a normal distribution p 0 05 according to shapiro and wilks 1965 mix 2 is also the best simulated mixture judging by the narrow boxplots of fig 1c and the limited range about 20 of residual values mix 1 had a wide boxplot and the distribution of the errors was not normal p 0 05 3 1 2 evaluation of cosmo and standalone models for grassland production overall coupled and standalone models had a satisfactory performance with mae 1 mg ha 1 rrmse 40 and crm 0 20 though the ef was poor in most cases crm values were positive indicating a general underestimation of the observed agb with the exception of standalone version simulations in mix 2 cosmo coupled models worked better than standalone ones in mix 1 and mix 2 while the response was not univocal in mix 3 e g mae was lower with wofost and cropsyst standalone versions with cropsyst also performing better in terms of rrmse and ef with limited differences between coupled and standalone versions in mix 1 and mix 2 wofost performed better than cropsyst not for ef while cropsyst worked better on mix 3 not for ef the best performance was obtained with wofost cosmo in mix 2 with r2 0 99 and rrmse 15 59 in mix 1 and mix 2 the better performance of wofost than cropsyst was mostly obtained in the first year simulation fig 2 a b when cropsyst underestimated observations this indicates some difficulty in estimating crop emergence and initial rooting by cropsyst in the following years under and over estimations occurred with complex patterns of interaction between models and mixtures in general we observed that models were not entirely realistic in estimating plant regrowth after cutting in the water limiting conditions of the study site mix 2 was the best simulated mixture fig 2b 3 2 suite 2 of simulations model results under climate change scenarios with the two gcms and the two rcps used we forecasted for the time slice centred on 2030 temperature increases between 0 8 and 1 8 c and a general reduction of rainfall down to 67 mm yr 1 with the exception of hadgem2 gcm rcp8 5 scenario which simulated an increase of 35 mm yr 1 hadgem2 gcm projections indicate a more pronounced increase of temperatures in summer and autumn while giss es gcm changes reflect increasing temperatures in all seasons higher precipitation volumes in spring and lower in summer were projected with hadgem2 gcm whereas giss es gcm results indicate a general precipitation reduction especially in the growing season overall cropsyst simulated less agb with also less inter annual variability than wofost under future climate forcing scenarios fig 3 the difference between the two models fig 3a b was high in mix 1 for which cropsyst estimated less than 4 mg ha 1 yr 1 agb without a clear effect of climate change minimum and maximum agb estimates 2 and 4 mg ha 1 yr 1 respectively were similar with both standalone models fig 3g h both cropsyst and wofost estimated a reduction of agb under climate change with distribution curves of the combinations gcm x rcp frequently shifted to the left of the baseline with the exception of mix 1 and mix 2 with cropsyst cosmo coupled versions simulated higher agb values than standalone models the effects of climate change on these simulations were different compared to the standalone versions however the pattern of climate change effects on cosmo simulated agb is complex cropsyst simulated higher agb values in mix 1 under hadgem2 gcm scenario than baseline and giss es scenarios in this mixture wofost simulated reduced agb using hadgem2 gcm compared to baseline and giss es gcm scenarios in mix 2 no difference between scenarios was found with wofost while cropsyst simulated increased agb with hadgem2 gcm both coupled models estimated increased agb with future scenarios estimates provided by wofost indicate limited climate change effects in mix 3 slight increase with hadgem2 gcm and slight decrease with giss em gcm in cropsyst there was a general increase of agb and the highest biomass production was obtained with giss em gcm in all cases no relevant differences were found between rcps 4 discussion 4 1 comparison of model accuracy with other modelling approaches the accuracy of cosmo in simulating the relative presence of plant species in a community rrmse in the range 34 64 was similar to that found by soussana et al 2012 with the individual centred model gemini rrmse 51 which is much more complex than cosmo cosmo includes 28 parameters of which 13 are common to all species and 15 are species specific of the latter nine of these parameters usually are present in several generic simulators suitable for coupling with cosmo thus only six parameters have to be added to those of a generic simulator in our study these parameters added to 23 crop parameters in cropsyst and 100 in wofost gemini needs 100 parameters to characterise each species soussana et al 2012 and rapidly becomes increasingly complex as the number of species in the community increases the large number of species specific parameters limits the exploration of the parameter space thus obscuring their interpretability and ultimately limiting the applicability of the model in practice e g acutis and confalonieri 2006 paleari et al 2017 in our case study the accuracy of cosmo did not change with increasing the number or plant species in the community for instance mae fluctuated little around 8 in mix 2 and mix 3 and it ranged from 15 wofost and 17 cropsyst in mix 1 table 4 there was a higher rate of weeds in mix 1 41 during the experiment the competition exerted by weeds may have altered the quantity of resources available for the two species simulated within the mixture this likely explains such higher mae values for this mixture concerning the relative abundance of each species mae was satisfactory but other metrics were mostly poor because even a small mae in the estimation of relative abundance can easily turn to unsatisfactory values of other metrics if observed data are steady or fluctuate very little for instance observed agb data closely matching benchmark values i e the average value of observed data may explain the poor ef values criss and winston 2008 in general crop agb was better simulated with cosmo than with stand alone models a pertinent point here is that with cosmo it becomes possible for crop simulators to improve agb estimates while representing dynamically the relative abundance of species in a mixed cover which is a useful output to get valuable insights about the various ecosystem services provided by grasslands e g weisser et al 2017 the simulation of plant diversity is also central within scenario analyses in ecological studies to assess the capability of plant species to persist or not in a place owing to low high rates of disappearance and high low rates of successful invasion of other taxa e g mooney and hobbs 2000 the explicit representation of plant diversity can also help in managing grasslands e g to optimize the proportion of legume species in the plant community which indirectly determine the protein content of forage and the quality of diets e g capstaff and miller 2018 or to formulate forage mixtures taking into account the different phenology of plant species sanderson et al 2016 the simulation of the relative abundance of plant species can also be used for monitoring and controlling the spread of weeds which has detrimental effects on herbage yield forage quality and animal production connolly et al 2017 considering model performances for each species fig 4 is just taken as an example of the species dynamics as estimated by cosmo the simulated dynamics of the species comply with observations although the performance metric were not entirely satisfactory f and v increased their relative presence at the end of the experimental period while d was mostly lost and m appeared to be quite constant between 0 and 20 of relative abundance the models followed this trend with a low absolute error although a seasonal trend is not apparent in observed data the daily frequency of simulated data clearly showed a seasonal trend this behavior corresponds to 1 spring and autumn increase of the relative abundance of f and d species which are more competing than m and v species at low temperatures 2 less abundance of f and d species at higher temperatures which are favouring m and v species 4 2 simulation of plant diversity effects under climate change with the exception of wofost giss es gcm in mix 3 cosmo based simulations that is accounting explicitly for species dynamics in a mixture indicate the plant diversity buffers the potentially adverse effects of climate change or supports a greater biomass production due to climate change this is the behaviour of diverse plant communities as described for instance by sanderson et al 2004 who refer to the insurance effect of having some species that are tolerant to different stresses and thereby stabilize productivity however the impact of climate change on biomass production was complex buffer effects or the increase of biomass production observed in mixtures cannot be explained only by the result of the species simulated in monoculture as in cosmo an example of this is the wofost results obtained with mix 1 in which f and m monocultures are expected to produce less biomass under future scenarios but the biomass of the same species in the mixture is expected to increase this provides clue that a community of plant species can be more productive and able to adapt to climate change than single species in monoculture cosmo is thus expected to simulate accurately the effects of species dynamics and plasticity on mixture biomass productivity when running under future climate scenarios in turn since plant species richness may promote soil carbon c and nitrogen n stocks cosmo is also expected to improve estimates of c and n storage in the long term the increase of c and n stocks in soils is obtained with legume species which constitute an important n input through n2 fixation but also in the absence of legumes via increased plant productivity e g cong et al 2014 the fig 5 shows explicitly this response in all gcm rcp scenarios especially during spring and less markedly in autumn the mixture agb rate is higher than that of the most productive species grown in monoculture this is visible also in the calibration phase fig 6 an explanation of this could reside in complex mechanisms such as phenotypic plasticity and adaptation e g dewitt and scheiner 2003 expressed as a change in species composition during growing season beyond gene expression as an example fig 7 cosmo wofost simulations mix 2 shows a distinct adaptive effect in the variation of the optimum growth temperature as a function of the average air temperature as in sándor et al 2018 in particular the optimal growth temperature started to increase decrease with air temperature above below 18 20 c the way in which cosmo coupled versions of crop models appears to estimate these effects is promising 5 conclusions the work described above is specifically relevant to cropsyst and wofost but holds potential for extension to other similarly structured vegetation models because cosmo provides a framework for estimating the response of grassland systems with biophysical crop models that is more robust and complete than the modelling paradigm based on the average parameterization for complex plant covers the agreement between simulations and experimental data demonstrates that cosmo is a suitable approach for estimation of the dynamic behaviour of plant species in a community cosmo includes less parameters than other modelling approaches representing plant abundance is easier to calibrate and supports batch running because it uses a single instance of a generic crop model this study also confirms that cosmo based solutions for grassland modelling can be easily implemented though some basic knowledge is required to parameterize each single species in a grassland community to the extent that the biophysical structure of cosmo reflects the important determinants of the functioning of grassland systems we recommend its use to predict the behaviour of any relevant output with two caveats we recommend that more testing be performed under a variety of mowing regimes because of the need to assess the cosmo approach under intensive mowing management that is including two or more mowing events per year we also recommend further testing with animal grazing acknowledgements this work was undertaken under the auspices of the project modipras modelling relationships between species diversity the functioning of grassland systems and their ability to deliver ecosystem services of the inra metaprogramme ecoserv ecosystem services it was also supported by the research identification of fodder species for long duration artificial forage mixtures funded by mountain municipalities union colline metallifere and received financial support from emilia romagna region psr focus area 3a operazione 16 2 01 progetto n 5050341 and ager agroalimentare e ricerca ipcc moupa appendix a wofost parameters for poaceae d dactylis glomerata l f festuca arundinacea schreb l lolium multiflorum l parameters values units descriptions d f l development gdde 45 0 50 40 c d thermal time to emergence gddf 650 1150 600 c d thermal time to flowering gddm 3000 0 4000 3000 c d thermal time to maturity tbasem 5 5 2 c base temperature for emergence dtsmtb 0 0 0 0 0 0 c d daily increase in temperature sum as function of average daily temperature 10 7 10 5 10 10 12 9 12 7 12 20 15 12 15 10 15 24 20 17 20 15 20 21 25 22 25 20 25 13 30 27 30 25 30 3 40 20 40 35 40 0 growth cvl 0 58 0 75 0 6 efficiency of conversion into leaves cvr 0 6 0 65 0 685 efficiency of conversion into roots cvs 0 65 0 78 0 75 efficiency of conversion into stems cvo 0 5 0 55 0 709 efficiency of conversion into storage organs kdiftb 0 0 4 0 0 55 0 0 4 extinction coefficient for diffuse 0 6 0 5 0 6 0 65 0 6 0 4 visible light as function of dvs 1 0 55 1 0 65 1 0 65 2 0 6 2 0 65 2 0 65 fltb 0 0 65 0 0 8 0 0 9 fraction of aboveground dry matter to leaves as function of development stage 0 3 0 62 0 3 0 79 0 3 0 9 0 5 0 6 0 5 0 75 0 5 0 8 0 8 0 58 0 8 0 63 0 8 0 7 1 0 55 1 0 6 1 0 6 1 1 0 5 1 1 0 55 1 1 0 6 1 5 0 4 1 5 0 5 1 5 0 6 2 0 3 2 0 5 2 0 6 fstb 0 0 35 0 0 2 0 0 1 fraction of aboveground dry matter to stems as function of development stage 0 3 0 38 0 3 0 21 0 3 0 1 0 5 0 4 0 5 0 25 0 5 0 2 0 8 0 32 0 8 0 22 0 8 0 2 1 0 05 1 0 05 1 0 35 1 1 0 05 1 1 0 05 1 1 0 35 1 5 0 05 1 5 0 05 1 5 0 35 2 0 05 2 0 05 2 0 35 fotb 0 0 0 0 0 0 fraction of aboveground dry matter to storage organs as function of development stage 0 3 0 0 3 0 0 3 0 0 5 0 0 5 0 0 5 0 0 8 0 4 0 8 0 05 0 8 0 1 1 0 45 1 0 35 1 0 05 1 1 0 45 1 1 0 4 1 1 0 05 1 5 0 55 1 5 0 45 1 5 0 05 2 0 65 2 0 45 2 0 05 frtb 0 0 3 0 0 3 0 0 3 fraction of total dry matter to roots as function of development stage 0 3 0 3 0 3 0 3 0 3 0 3 0 5 0 3 0 5 0 3 0 5 0 3 0 8 0 3 0 8 0 3 0 8 0 3 1 0 3 1 0 3 1 0 3 1 1 0 1 1 0 3 1 1 0 3 1 5 0 1 5 0 3 1 5 0 3 2 0 2 0 3 2 0 3 tdwi 50 50 210 kg ha 1 initial total crop dry weight laiem 0 05 0 03 0 05 m2 m 2 leaf area index at emergence span 25 00 28 00 29 50 day life span of leaves growing at 35 c efftb 0 0 8 0 0 8 0 0 9 c kg ha 1 hr 1 j 1 light use efficiency single leaf function of average temperature 40 0 8 40 0 8 40 0 8 m2 s tbleaf 0 5 0 c lower threshold temperature for aging of leaves rri 1 2 3 0 1 2 cm day 1 maximum daily increase in rooting depth amaxtb 0 32 0 27 0 33 kg ha 1 hr 1 maximum leaf co2 assimilation rate as function of dvs 0 25 32 0 25 25 0 25 33 0 5 31 0 5 20 0 5 30 0 75 31 0 75 10 0 75 28 1 20 1 5 1 22 2 10 2 2 2 15 rgrlai 0 0200 0 0300 0 0300 m2 m 2 day 1 maximum relative increase in leaf area index effmx 30 30 30 c maximum temperature for emergence rfsetb 0 1 0 0 0 1 reduction factor for senescence function of dvs 2 1 2 0 2 1 tmpftb 5 0 5 0 2 0 c reduction factor of amax as function of average temperature 17 1 17 1 16 1 33 0 37 0 34 0 tmnftb 0 0 0 0 20 0 c reduction factor of gross assimilation rate as function of low minimum temperature 5 1 13 1 5 1 rdrrtb 0 0 0 0 0 0 relative death rate of roots as a function of development stage 1 5 0 1 5 0 1 5 0 1 501 0 01 1 501 0 02 1 501 0 01 2 0 01 2 0 02 2 0 01 0 0 0 0 0 0 1 5 0 1 5 0 1 5 0 1 501 0 01 1 501 0 01 1 501 0 01 2 0 01 2 0 01 2 0 01 q10 1 3 1 3 1 5 relative increase respiration rate per 10 degree temperature increase rml 0 04 0 03 0 05 kg ch2o kg 1 d 1 relative maintenance respiration of leaves rmr 0 04 0 05 0 05 kg ch2o kg 1 d 1 relative maintenance respiration of roots rms 0 04 0 02 0 05 kg ch2o kg 1 d 1 relative maintenance respiration of stems rmo 0 04 0 03 0 05 kg ch2o kg 1 d 1 relative maintenance respiration of storage organs slatb 0 0 0023 0 0 0018 0 0 0026 ha kg 1 specific leaf area as a function of 0 5 0 0023 0 5 0 0018 0 5 0 0026 dvs 0 78 0 0023 0 78 0 0018 0 78 0 0026 2 0 0023 2 0 0018 2 0 0026 spa 0 0001 0 0001 0 0001 ha kg 1 specific pod area ssatb 0 0 0001 0 0 0009 0 0 0009 ha kg 1 specific stem area as a function of 2 0 0001 2 0 0009 2 0 0009 dvs cgn 3 1 2 crop group number rdws 0 2 0 5 0 01 kg kg 1 d 1 maximum relative death rate of leaves due to water stress maxrd 140 145 100 cm this parameter represents the maximum rooting depth maxh 1 5 1 25 1 cm maximum canopy height for the species laimax 7 5 6 6 5 m2 m 2 maximum leaf area index for the species appendix b wofost parameters for fabaceae g lotus corniculatus l m medicago sativa l v onobrychis viciifolia scop and t trifolium repens l parameters values units descriptions g m v t development gdde 50 50 50 50 c d thermal time to emergence gddf 750 800 700 400 c d thermal time to flowering gddm 3000 2800 5000 3200 c d thermal time to maturity tbasem 7 5 5 3 c base temperature for emergence dtsmtb 0 0 0 0 0 0 0 0 c d daily increase in temperature sum as function of average daily temperature 10 3 10 5 10 4 10 7 12 5 12 7 12 6 12 9 15 8 15 8 15 9 15 12 20 13 20 15 20 14 20 17 25 18 25 20 25 19 25 20 30 23 30 25 30 24 30 20 40 33 40 28 40 30 40 10 growth cvl 0 6 0 68 0 68 0 66 efficiency of conversion into leaves cvr 0 5 0 7 0 68 0 8 efficiency of conversion into roots cvs 0 75 0 68 0 56 0 55 efficiency of conversion into stems cvo 0 5 0 8 0 6 0 709 efficiency of conversion into storage organs kdiftb 0 0 5 0 0 4 0 0 4 0 0 4 extinction coefficient for diffuse visible light as function of dvs 0 6 0 5 0 6 0 4 0 6 0 45 0 6 0 4 1 0 65 1 0 65 1 0 4 1 0 65 2 0 65 2 0 65 2 0 4 2 0 65 fltb 0 0 45 0 0 75 0 0 65 0 0 9 fraction of aboveground dry matter to leaves as function of development stage 0 3 0 35 0 3 0 75 0 3 0 65 0 3 0 9 0 5 0 25 0 5 0 75 0 5 0 65 0 5 0 9 0 8 0 15 0 8 0 68 0 8 0 55 0 8 0 8 1 0 1 1 0 65 1 0 5 1 0 8 1 1 0 1 1 1 0 5 1 1 0 45 1 1 0 8 1 5 0 1 1 5 0 4 1 5 0 4 1 5 0 8 2 0 1 2 0 4 2 0 4 2 0 8 fstb 0 0 55 0 0 25 0 0 35 0 0 1 fraction of aboveground dry matter to stems as function of development stage 0 3 0 65 0 3 0 25 0 3 0 35 0 3 0 1 0 5 0 75 0 5 0 25 0 5 0 35 0 5 0 1 0 8 0 75 0 8 0 02 0 8 0 35 0 8 0 15 1 0 8 1 0 05 1 0 05 1 0 15 1 1 0 8 1 1 0 05 1 1 0 05 1 1 0 15 1 5 0 8 1 5 0 05 1 5 0 05 1 5 0 15 2 0 8 2 0 05 2 0 05 2 0 15 fotb 0 0 0 0 0 0 0 0 fraction of aboveground dry matter to storage organs as function of development stage 0 3 0 0 3 0 0 3 0 0 3 0 0 5 0 0 5 0 0 5 0 0 5 0 0 8 0 1 0 8 0 3 0 8 0 1 0 8 0 15 1 0 1 1 0 35 1 0 45 1 0 15 1 1 0 1 1 1 0 45 1 1 0 5 1 1 0 15 1 5 0 1 1 5 0 55 1 5 0 55 1 5 0 15 2 0 1 2 0 55 2 0 55 2 0 15 frtb 0 0 3 0 0 3 0 0 3 0 0 3 fraction of total dry matter to roots as function of development stage 0 3 0 3 0 3 0 3 0 3 0 3 0 3 0 3 0 5 0 3 0 5 0 3 0 5 0 3 0 5 0 3 0 8 0 3 0 8 0 3 0 8 0 3 0 8 0 3 1 0 3 1 0 3 1 0 3 1 0 3 1 1 0 3 1 1 0 3 1 1 0 3 1 1 0 3 1 5 0 3 1 5 0 3 1 5 0 3 1 5 0 3 2 0 3 2 0 3 2 0 2 0 3 tdwi 210 50 210 210 kg ha 1 initial total crop dry weight laiem 0 05 0 05 0 05 0 05 m2 m 2 leaf area index at emergence span 29 50 29 50 29 00 29 50 day life span of leaves growing at 35 c efftb 0 0 6 0 0 6 0 0 7 0 0 6 c kg ha 1 hr 1 light use efficiency single leaf function of average temperature 40 0 36 40 0 36 40 0 6 40 0 36 j 1 m2 s tbleaf 0 0 0 0 c lower threshold temperature for aging of leaves rri 1 2 1 2 1 2 1 2 cm day 1 maximum daily increase in rooting depth amaxtb 0 20 0 35 0 27 0 15 kg ha 1 hr 1 maximum leaf co2 assimilation rate as function of dvs 0 25 18 0 25 30 0 25 26 0 25 15 0 5 15 0 5 25 0 5 25 0 5 14 0 75 10 0 75 22 0 75 24 0 75 14 1 8 1 10 1 18 1 12 2 1 2 7 2 10 2 8 rgrlai 0 0817 0 0080 0 0080 0 0800 m2 m 2 day 1 maximum relative increase in leaf area index effmx 30 30 30 30 c maximum temperature for emergence rfsetb 0 1 0 1 0 0 0 1 reduction factor for senescence function of dvs 2 1 2 1 2 0 2 1 tmpftb 5 0 5 0 5 0 2 0 c reduction factor of amax as function of average temperature 23 1 24 1 22 1 14 1 38 0 38 0 37 0 38 0 tmnftb 20 0 0 0 0 0 20 0 c reduction factor of gross assimilation rate as function of low minimum temperature 5 1 5 1 5 1 5 1 rdrrtb 0 0 0 0 0 0 0 0 relative death rate of roots as a function of development stage 1 5 0 1 5 0 1 5 0 1 5 0 1 501 0 01 1 501 0 01 1 501 0 01 1 501 0 01 2 0 01 2 0 01 2 0 01 2 0 01 0 0 0 0 0 0 0 0 1 5 0 1 5 0 1 5 0 1 5 0 1 501 0 01 1 501 0 01 1 501 0 01 1 501 0 01 2 0 01 2 0 01 2 0 01 2 0 01 q10 1 5 1 5 1 5 1 5 relative increase respiration rate per 10 degree temperature increase rml 0 05 0 05 0 05 0 05 kg ch2o kg 1 d 1 relative maintenance respiration of leaves rmr 0 05 0 05 0 05 0 05 kg ch2o kg 1 d 1 relative maintenance respiration of roots rms 0 05 0 05 0 07 0 05 kg ch2o kg 1 d 1 relative maintenance respiration of stems rmo 0 05 0 05 0 05 0 05 kg ch2o kg 1 d 1 relative maintenance respiration of storage organs slatb 0 0 0031 0 0 003 0 0 0015 0 0 003 ha kg 1 specific leaf area as a function of dvs 0 5 0 0031 0 5 0 003 0 5 0 0015 0 5 0 003 0 78 0 0031 0 78 0 003 0 78 0 0015 0 78 0 003 2 0 0031 2 0 003 2 0 0015 2 0 003 spa 0 0001 0 0005 0 0001 0 0001 ha kg 1 specific pod area ssatb 0 0 0009 0 0 0009 0 0 0009 0 0 0009 ha kg 1 specific stem area as a function of dvs 2 0 0009 2 0 0009 2 0 0009 2 0 0009 cgn 1 1 2 2 crop group number rdws 0 01 0 4 0 01 0 5 kg kg 1 d 1 maximum relative death rate of leaves due to water stress maxrd 200 180 180 100 cm maximum rooting depth maxh 0 4 1 3 1 4 0 8 cm maximum canopy height for the species laimax 4 5 6 7 m2 m 2 maximum leaf area index for the species appendix c cropsyst parameters d dactylis glomerata l f festuca arundinacea schreb l lolium multiflorum l g lotus corniculatus l m medicago sativa l v onobrychis viciifolia scop and t trifolium repens l parameters values units descriptions d f l g m v t development bt 5 5 2 5 5 5 2 c base temperature for development cot 33 37 34 38 38 37 38 c cutoff temperature for development gdde 50 40 50 50 50 50 40 c d thermal time to emergence gddgf 650 1150 600 700 900 800 400 c d thermal time to begin yield formation gddf 650 1150 600 750 800 700 400 c d thermal time to flowering gddeglai 3800 2900 1500 3000 2900 3100 3200 c d thermal time to end green leaf area index gddm 4000 3000 3000 2800 5000 3200 3000 c d thermal time to maturity growth tbc 4 3 2 8 4 3 2 8 kg m 2 kpa m 1 transpiration biomass coefficient k 0 45 0 47 0 4 0 6 0 5 0 5 0 4 extinction coefficient for solar radiation cf 0 95 0 9 0 8 0 8 1 0 9 0 8 et crop coefficient at full canopy mwu 8 7 8 10 7 7 10 kg m 2 d 1 full canopy water uptake maximum laiini 0 09 0 09 0 09 0 09 0 09 0 09 0 09 m2 m 2 initial leaf area index lshape 1 5 2 1 1 1 5 1 5 1 5 leaf area index initial value shape leaflife 500 580 500 800 400 450 450 c d leaf life glaimin 0 045 0 04 0 05 0 03 0 03 0 05 0 03 m2 m 2 minimum initial green leaf area index ntc 2 5 1 10 9 3 1 c night temperature critical ntm 18 17 18 20 22 19 19 c night temperature maximum parf 0 5 0 5 0 5 0 46 0 5 0 5 0 6 factor to convert global solar radiation to par reue 2 7 2 5 3 3 2 3 3 1 7 1 2 g mj 1 maximum radiation use efficiency sla 23 18 26 31 30 15 30 m2 kg 1 specific leaf area at emergence stp 4 5 2 0 1 2 3 3 2 0 4 6 1 0 stem leaf partition coefficient wsi 1 1 1 1 1 1 1 development susceptibility to water stress 0 not susceptible laimax 7 5 6 6 5 4 5 6 7 m2 m 2 maximum leaf area index for the species maxh 1 5 1 25 1 0 4 1 3 1 4 0 8 cm maximum canopy height for the species maxrd 140 145 100 200 180 180 100 cm maximum rooting depth optt 17 17 16 23 24 22 14 c optimal temperature to growth appendix d cosmo parameters d dactylis glomerata l f festuca arundinacea schreb l lolium multiflorum l g lotus corniculatus l m medicago sativa l v onobrychis viciifolia scop and t trifolium repens l parameters values units descriptions d f l g m v t laimax 7 5 6 6 5 4 5 6 7 m2 m 2 maximum leaf area index for the species maxh 1 5 1 25 1 0 4 1 3 1 4 0 8 cm maximum canopy height for the species wcc 0 76 0 8 0 6 1 0 88 0 82 0 65 drought tolerance of the different species the highest the value the highest the tolerance maxrd 140 145 100 200 180 180 100 cm maximum rooting depth lct 5 5 2 5 5 5 2 c critical temperature below which the plant is not able to compete or to growth optt 17 17 16 23 24 22 14 c optimal temperature at which the plant ability to compete is maximum uct 33 37 34 38 38 37 38 c critical temperature above which the plant is not able to compete or to growth common parameters i 20 inertia coefficient of species replacement wfmin 0 15 m3 m 3 minimum water available for fibrous roots growth wfmax 0 5 m3 m 3 maximum water available for fibrous roots growth wtmin 0 1 m3 m 3 minimum water available for tap roots growth wtmax 0 4 m3 m 3 maximum water available for tap roots growth appendix e wofost stand alone version parameters parameters values units descriptions development gdde 45 0 c d thermal time to emergence gddf 1150 0 c d thermal time to flowering gddm 3000 0 c d thermal time to maturity tbasem 5 0 c base temperature for emergence dtsmtb 0 0 c d daily increase in temperature sum as function of 10 5 average daily temperature 12 7 15 10 20 15 25 20 30 25 40 35 growth cvl 0 8 efficiency of conversion into leaves cvr 0 7 efficiency of conversion into roots cvs 0 8 efficiency of conversion into stems cvo 0 6 efficiency of conversion into storage organs kdiftb 0 0 55 extinction coefficient for diffuse visible light as function of dvs 0 6 0 65 1 0 65 2 0 65 fltb 0 0 8 fraction of aboveground dry matter to leaves as function of development stage 0 3 0 79 0 5 0 75 0 8 0 63 1 0 6 1 1 0 55 1 5 0 5 2 0 5 fstb 0 0 2 fraction of aboveground dry matter to stems as function of development stage 0 3 0 21 0 5 0 25 0 8 0 22 1 0 05 1 1 0 05 1 5 0 05 2 0 05 fotb 0 0 fraction of aboveground dry matter to storage organs as function of development stage 0 3 0 0 5 0 0 8 0 05 1 0 35 1 1 0 4 1 5 0 45 2 0 45 frtb 0 0 3 fraction of total dry matter to roots as function of development stage 0 3 0 3 0 5 0 3 0 8 0 3 1 0 3 1 1 0 3 1 5 0 3 2 0 3 tdwi 50 0 kg ha 1 initial total crop dry weight laiem 0 0 m2 m 2 leaf area index at emergence span 28 0 day life span of leaves growing at 35 c efftb 0 0 8 c kg ha 1 hr 1 j 1 light use efficiency single leaf function of average temperature 40 0 8 m2 s tbleaf 5 0 c lower threshold temperature for aging of leaves rri 3 0 cm day 1 maximum daily increase in rooting depth amaxtb 0 27 kg ha 1 h 1 maximum leaf co2 assimilation rate as function of dvs 0 25 25 0 5 20 0 75 10 1 5 2 2 rgrlai 0 0 m2 m 2 day 1 maximum relative increase in leaf area index effmx 30 0 c maximum temperature for emergence 10 0 14 0 rfsetb 0 0 reduction factor for senescence function of dvs 2 0 tmpftb 5 0 c reduction factor of amax as function of average temperature 17 1 37 0 tmnftb 0 0 c reduction factor of gross assimilation rate as function of low minimum temperature 13 1 rdrrtb 0 0 relative death rate of roots as a function of development stage 1 5 0 1 501 0 02 2 0 02 0 0 1 5 0 1 501 0 01 2 0 01 q10 1 3 relative increase respiration rate per 10 degree temperature increase rml 0 0 kg ch2o kg 1 d 1 relative maintenance respiration of leaves rmr 0 1 kg ch2o kg 1 d 1 relative maintenance respiration of roots rms 0 0 kg ch2o kg 1 d 1 relative maintenance respiration of stems rmo 0 0 kg ch2o kg 1 d 1 relative maintenance respiration of storage organs slatb 0 0 0018 ha kg 1 specific leaf area as a function of dvs 0 5 0 0018 0 78 0 0018 2 0 0018 spa 0 0 ha kg 1 specific pod area ssatb 0 0 0009 ha kg 1 specific stem area as a function of dvs 2 0 0009 cgn 1 0 crop group number rdws 0 5 kg kg 1 d 1 maximum relative death rate of leaves due to water stress maxrd 140 0 cm maximum rooting depth maxh 1 5 cm maximum canopy height for the species laimax 7 5 m2 m 2 maximum leaf area index for the species appendix f cropsyst stand alone version parameters parameters values units descriptions development bt 5 c base temperature for development cot 33 c cutoff temperature for development gdde 50 c d thermal time to emergence gddgf 650 c d thermal time to begin yield formation gddf 650 c d thermal time to flowering gddeglai 3800 c d thermal time to end green leaf area index gddm 4000 c d thermal time to maturity growth tbc 4 kg m 2 kpa m 1 transpiration biomass coefficient k 0 45 extinction coefficient for solar radiation cf 0 95 et crop coefficient at full canopy mwu 8 kg m 2 d 1 full canopy water uptake maximum hi 0 9 harvest index laiini 0 09 m2 m 2 initial leaf area index lshape 1 5 leaf area index initial value shape leaflife 500 c d leaf life glaimin 0 045 m2 m 2 minimum initial green leaf area index ntc 2 c night temperature critical ntm 18 c night temperature maximum parf 0 5 factor to convert global solar radiation to par reue 2 7 g mj 1 maximum radiation use efficiency sla 23 m2 kg 1 specific leaf area at emergence stp 4 stem leaf partition coefficient wsi 1 development susceptibility to water stress laimax 7 5 m2 m 2 maximum leaf area index for the species maxh 1 5 cm maximum canopy height for the species maxrd 140 cm maximum rooting depth optt 17 c optimal temperature to growth appendix g wofost climate change effects on yield g giss es gcm h hadgem2 gcm 4 rcp4 5 8 rcp8 5 crop file variable baseline 4g 4h 8g 8h m1 average kg ha 1 6038 16 6114 90 6029 95 6148 91 6070 53 variation coefficient 17 33 13 68 12 02 14 70 14 00 yield gap kg ha 1 76 73 8 21 110 75 32 37 m2 average kg ha 1 3970 09 4280 85 4400 77 4470 03 4483 15 variation coefficient 13 76 16 41 16 67 15 36 13 59 yield gap kg ha 1 310 77 430 69 499 94 513 06 m3 average kg ha 1 4718 32 4562 46 4727 40 4443 23 4824 92 variation coefficient 10 97 17 31 11 95 17 88 11 42 yield gap kg ha 1 155 86 9 08 275 10 106 60 f average kg ha 1 3512 25 3365 89 3242 35 3434 30 3306 13 variation coefficient 24 17 21 67 30 01 24 35 27 43 yield gap kg ha 1 146 36 269 90 77 94 206 12 m average kg ha 1 5358 98 4970 15 4753 99 4901 37 4771 45 variation coefficient 19 65 9 35 6 56 8 62 5 85 yield gap kg ha 1 388 83 604 99 457 61 587 53 d average kg ha 1 2206 02 2081 62 2307 37 2084 39 2424 36 variation coefficient 29 02 27 17 28 07 28 60 27 71 yield gap kg ha 1 124 40 101 35 121 62 218 34 v average kg ha 1 2979 47 3288 21 3416 84 3356 19 3451 91 variation coefficient 14 15 11 26 10 94 11 96 9 66 yield gap kg ha 1 308 74 437 37 376 72 472 44 l average kg ha 1 10983 45 10039 75 9663 05 9548 76 9644 41 variation coefficient 9 19 10 99 5 28 11 34 5 25 yield gap kg ha 1 943 70 1320 40 1434 69 1339 04 t average kg ha 1 4257 77 4155 74 4292 33 4092 72 4313 36 variation coefficient 9 87 10 94 7 65 11 56 7 35 yield gap kg ha 1 102 03 34 56 165 05 55 59 g average kg ha 1 2060 06 2527 88 2599 91 2538 74 2609 52 variation coefficient 31 46 21 63 12 31 19 65 11 18 yield gap kg ha 1 467 83 539 85 478 69 549 47 standalone average kg ha 1 3463 41 3338 18 3224 45 3408 29 3290 18 variation coefficient 23 46 21 27 30 28 24 19 27 71 yield gap kg ha 1 125 23 238 96 55 12 173 22 appendix h cropsyst climate change effects on yield g giss es gcm h hadgem2 gcm 4 rcp4 5 8 rcp8 5 crop file variable baseline 4g 4h 8g 8h m1 average kg ha 1 1965 16 1905 36 2059 60 1956 47 2111 41 variation coefficient 19 42 18 95 30 10 25 72 29 81 yield gap kg ha 1 59 80 94 45 8 69 146 25 m2 average kg ha 1 1173 74 1171 83 1809 94 1302 81 1931 51 variation coefficient 15 91 25 34 29 28 32 43 30 20 yield gap kg ha 1 1 91 636 21 129 07 757 77 m3 average kg ha 1 2780 57 3033 78 2855 47 3198 55 2835 77 variation coefficient 16 81 15 38 28 04 18 93 28 34 yield gap kg ha 1 253 21 74 90 417 98 55 20 f average kg ha 1 1956 93 1933 80 2093 73 1986 83 2141 91 variation coefficient 18 68 18 27 27 57 23 64 27 49 yield gap kg ha 1 23 14 136 79 29 90 184 98 m average kg ha 1 5915 14 5327 47 5448 69 5257 01 5581 34 variation coefficient 20 15 17 41 15 68 16 08 15 35 yield gap kg ha 1 587 67 466 46 658 14 333 80 d average kg ha 1 2605 62 2238 09 2265 18 2228 76 2308 69 variation coefficient 25 88 16 63 23 50 19 07 23 48 yield gap kg ha 1 367 54 340 44 376 86 296 93 v average kg ha 1 392 81 354 03 352 36 356 39 355 71 variation coefficient 21 94 12 91 15 77 13 37 16 04 yield gap kg ha 1 38 78 40 46 36 42 37 10 l average kg ha 1 1894 56 1915 51 2088 58 1896 66 2109 18 variation coefficient 25 48 28 20 32 36 30 54 32 87 yield gap kg ha 1 20 95 194 02 2 10 214 62 t average kg ha 1 1328 61 1315 19 1407 77 1323 05 1421 28 variation coefficient 21 57 22 11 29 01 27 10 28 98 yield gap kg ha 1 13 42 79 16 5 56 92 67 g average kg ha 1 4805 98 5041 26 5536 18 5235 16 5660 77 variation coefficient 10 19 12 58 13 49 14 73 13 77 yield gap kg ha 1 235 29 730 20 429 19 854 79 standalone average kg ha 1 2610 44 2244 47 2268 70 2234 54 2310 42 variation coefficient 25 89 16 64 23 48 18 96 23 48 yield gap kg ha 1 365 97 341 74 375 90 300 02 
25075,plant diversity supports the high aptitude of grassland covers to provide fodder production for animal feeding and contribute to the storage of carbon while also granting pollination and aesthetics of landscapes this ability depends on the management intensity of the grassland system physical constraints and climatic characteristics most of current grassland models simulating the impact of weather conditions soil fertility and the intensity of use of grassland systems by grazing and or mowing on fodder production and carbon nitrogen fluxes inherit eco physiological and biophysical details from crop models without considering explicitly temporal changes in taxonomic and functional composition the dynamic grassland model cosmo community simulation model includes a set of rules to simulate explicitly seasonal changes in species composition of managed grasslands under various soil climate and management drivers and it is consistent with the degree of complexity of the most generic crop simulators the incorporation of cosmo functionalities into the standalone crop simulators cropsyst and wofost is proposed as a way to i reduce the uncertainty in estimations of harvested aboveground biomass agb and ii simulate dynamically the relative abundance of species for respectively the whole community and individual species considering three mixtures of grassland species with increasing complexity from mix 1 to mix 3 in a mown hay meadow in central italy massa marittima 43 03 n 10 53 e 380 m a s l we show that cosmo overall improved the model ability to reproduce observed agb in mix 1 and 2 e g with cropsyst in mix 2 relative root mean square error rrmse lowered from 35 01 to 25 27 while the model performance for mix 3 appeared as not unambiguously linked to considering plant diversity an assessment of the relative abundance estimates for the whole community indicates 30 rrmse 40 with both cosmo coupled cropsyst and wofost in mix 1 and mix 2 while it increases up to 60 in mix 3 the consequences of explicitly accounting for plant diversity for simulated grassland outputs depend on the conditions evaluated which require further studies however our results suggest that grassland modelling omitting plant diversity dynamics are likely over or underestimating harvested biomass of the plant community thus biasing projections of future fodder production and estimates of animal feed supplies this work proves for the first time that cosmo can support the simulation of grassland systems beyond its theoretical framework keywords cosmo forage production grass legume mixtures grassland modelling plant diversity relative abundance 1 introduction species rich grasslands are mixtures of plant species stages of maturity and plant tissues e g bruinenberg et al 2002 their states change continuously which is challenging for the modelling of interaction processes and feedback mechanisms occurring within the soil vegetation atmosphere continuum e g kipling et al 2016 brilli et al 2017 in modelling terms the dynamics characterizing this kind of systems suggest the adoption of individual centred models rather than mimicking average morphological and physiological features of a phytocenosis as a whole ignoring the relative abundance of different plant types in mixed communities individual centred models simulate the trade offs among plant functional traits and their plasticity in response to environmental changes e g maire et al 2013 these computations which focus on plant plant interactions are inherently resource intensive and present scalability issues as modelling applications target the ecosystem scale where biophysical and biogeochemical processes also governed by management become important and in many cases overwhelm small scale processes e g rumpel et al 2015 modelling solutions linking the processes and dynamics of individual plant types to the processes and dynamics of communities do exist integrated to specific models each one being an instance and for a limited number of species in a community e g agpasture module into apsim li et al 2011 intercrop in stics corre hellou et al 2009 and derived approaches jégo et al 2015 thivierge et al 2016 dynagram was recently developed moulin et al 2018 to address some theoretical questions about the response of a grassland species model to climatic edaphic and management forcing agents as a function of the state of the plant community the community simulation model cosmo simulates dynamically the relative abundance of different plant types in a community via its coupling with crop models reproducing at plot scale the biophysical processes of soil and vegetation in interaction with management practices confalonieri 2014 with a set of parameter values for each single plant type in a community individual genotypes or groups of genotypes such as plant functional groups cosmo updates the relative abundance of different plant types at each time step the characterization of different plant types is done by using different sets of values for the same parameters common set of parameters for all the plant types as biological parameters of plant models are generally sensitive to environmental changes the originality of cosmo is that it addresses the issue of translating these changes into a numerical framework thanks to suitability functions after confalonieri et al 2013 moreover its genericity enables it for coupling with virtually any crop vegetation model the rationale of cosmo is that plant competition and changes in the relative abundance of plant types are simulated as a response to hierarchically arranged environmental drivers biophysical and management factors either triggered or continuous which represent the suitability of different plant types to the conditions explored at each time step on this basis cosmo derives daily the value of vegetation parameters for a community of plants from both the relative presence of the different plant types and the parameter values initially set to characterize the same plant types the latter as if it were grown in monoculture these dynamically derived vegetation parameters are then used at each time step within a single instance of the crop growth simulator in so doing cosmo goes beyond the commonly accepted conventional assumption that the values assigned to model parameters determined by either calibration or measurement or extracted from literature are temporally invariant and remain constant throughout the entire simulation period this simplification is in some cases too limiting to address the challenges that agricultural systems are facing which imply that aspects related to plant diversity cannot be ignored in modelling studies they include the nutritional value of multi species grasslands delaby et al 2010 the differing herbage intake of grazing animals between mixtures and pure stands lüscher et al 2014 and between annual and perennial species pulina et al 2018 the dependence of milk protein content on the botanical composition of swards stergiatis et al 2015 and the supporting and regulating services e g pollination pest control drought resistance carbon nitrogen stocks and emissions provided by multi species swards rutledge et al 2017 in particular the high potential of multi species swards for sustaining high animal performance requires studying well balanced mixtures with regard to soil and climatic conditions peyraud et al 2014 roca fernández et al 2016 in addition there is a need in climate change studies of simulation models designed for studying the interaction between plant diversity and productivity considering that the impacts on the productivity of grasslands and its stability depend on the diversity of their composition van oijen et al 2018 accounting explicitly for changes in the botanical composition of mixed stands cosmo can simulate the performance of multi species grassland systems by expanding the potential of generic crop models towards complex vegetation covers to explore its properties and assess the sensitivity of simulated community dynamics to initial conditions and changing climate cosmo was initially coupled confalonieri 2014 with the generic crop simulator cropsyst stöckle et al 2003 however the reliability of outputs was never assessed against field data from mixed vegetation covers the aim of this study is to assess cosmo driven outputs harvested dry matter biomass and relative abundance of plant species as generated from two generic crop models cropsyst stöckle et al 2003 and wofost van keulen and wolf 1986 coupled with cosmo the choice of the two crop models was motivated by the specific interest in wofost to support yield forecasts in europe boogaard et al 2013 pagani et al 2017 and considering the extensive use of cropsyst in applied contexts worldwide e g palosuo et al 2011 asseng et al 2013 bassu et al 2014 mangani et al 2018 the assessment of four modelling systems two crop models in standalone and coupled versions was thus performed for aboveground biomass and relative abundance of plant species using multi year field data from mown grassland mixtures grown in central italy 2 materials and methods 2 1 the cosmo model cosmo simulates communities of plant species through an average parameterisation based on the relative abundance of each species the latter depends on the hierarchical aggregation of several drivers in the range 0 1 which are estimated to characterize the suitability and competitiveness of each species in a given context the community parameterisation of the generic simulator y r is updated on a daily time step for each parameter of the simulator y based on the relative abundance of each species i as follows 1 y r y i 1 n y i s c p i where yi is a given parameter of species i n is the number of simulated species in the mixture and s c p i is the relative presence of the i t h species the latter is derived at each time step t as follows 2 s c p i t s c p i t 1 s f s i c s f n i z where s c p i t 1 is the relative presence at time t 1 s f s i eq 3 is the suitability factor of the species i i is the inertial replacement coefficient z is the number of drivers and c s f is the community suitability factor eq 4 3 s f s i q 1 q z h s f i q 4 c s f i 1 i n s f s i compared to the original equation by confalonieri 2014 csf has been adapted to act as a suitability proxy of the relative growth rate i e the growth rate increases with csf in eq 3 q is the position in the hierarchic order of a given driver and h s f i q is the hierarchic suitability function of drivers estimated as 5 q h s f i q s f i q k 1 s f i q 1 s f i q k 2 h s f i q 1 s f i q 1 s f i q e l s e w h e r e where s f i q is the value of the driver of the i species in q th hierarchical position the drivers used were in this order air temperature global solar radiation and water availability the method to estimate these drivers are described in confalonieri 2014 and it is not reported here in the current version of the model senescence of individual species is not explicitly considered during the winter season plant dormancy is represented according to confalonieri and bechini 2004 the whole grass community is considered dormant after seven consecutive days with an average temperature below a given threshold 8 c calibrated during this study in a period starting in autumn as night length is longer than 13 h in spring as night length is lower than 13 h plants start to wake up the complete restart of plant growth occurs as the average temperature is higher than a given threshold 8 c calibrated during this study for more than seven consecutive days the phenology component was reset for each growing season each 1th of january 2 2 experimental data we refer to measured data of annual yield and abundance of plant species in a mixture as in staglianò et al 2008 this work focusses on the use of complex herbaceous mixtures to face the environmental conditions of the mediterranean climate piano and talamucci 1996 the experimentation was carried out from 2003 to 2007 in massa marittima tuscany italy located at 380 m a s l 43 03 north 10 53 east three grass legume mixtures hereafter mix 1 mix 2 mix 3 different in complexity were sown on october 16th 2003 and data collection was performed until may 18th 2007 table 1 the meadows were harvested once a year for hay production and the aboveground biomass dry matter agb mg ha 1 was measured only in this occurrence with a cut on 1 m2 sample areas during late spring table 1 an additional cut was applied on may 5th 2004 to remove weeds but without measuring the agb the relative abundance of the sown species was measured 11 times during the experiment in each mixture table 2 according to the point quadrat method daget and poissonet 1969 usually performed in forage resources analysis argenti et al 2011 the relative abundance of weed species was also measured but this information was not relevant for this study as each weed species was relatively little present in the three mixtures 2 3 model description and simulation design the model testing was designed to identify whether i cosmo simulated the relative abundance of plant species and ii differences in simulated agb were caused by the explicit simulation of plant diversity comparing stand alone versions and cosmo based versions of cropsyst and wofost the coupling was executed between cosmo and the two crop simulators versions implemented in the dynamic link library unimi cropml confalonieri et al 2012 the four model solutions were configured using daily weather soil properties and management data as measured or simulated at the experimental site cropsyst estimates plant growth based on the minimum between transpiration and radiation based biomass dry matter values modulated by a temperature reduction factor the model estimates the net photosynthesis without an explicit simulation of biomass partitioning and accumulation across different organs wofost models crop growth based on the difference between gross carbon assimilation and respiration it also simulates the partitioning of biomass into growing organs a high number of parameters organized in afgen arbitrary function generator tables e g van keulen and wolf 1986 describe the dependence of certain variables on average air temperature or development stage the model assessment was split in two suites of simulations i comparison of model outputs with observed data suite 1 ii assessment of models outputs under projected scenarios of climate change suite 2 simulations were performed with three sets of plant specific parameters for each forage species in the mixtures one for wofost appendices a and b one for cropsyst appendix c and one for cosmo appendix d it results 21 parameter listings combinations of seven plant species three models two additional parameter sets were derived from the parametrization of the stand alone versions of wofost appendix e and cropsyst appendix f all the sets of parameter values used to generate the simulated data were obtained during the suite 1 of simulations reported below 2 3 1 suite 1 of simulations model parameterization and evaluation with observed data the datasets described in section 2 2 were used for the calibration of models parameters some cropsyst parameters were extracted from published literature for m sativa confalonieri and bechini 2004 t repens bellocchi et al 2002b and l multiflorum abraha and savage 2007 otherwise a calibration work was performed through a trial and error process comparing the model estimates with observational data cosmo parameters were calibrated independently of the linked model to initialize the relative abundance of plant species in cosmo the sowing rate of each species was first used to run the model then to better reflect the relative abundance of species in the community at emergence the first measured abundance of each mixture was assimilated into the model as forcing input to simulate post emergent grasslands the agreement between simulated and observed values of agb and relative abundance of plant species the latter only for the cosmo coupled crop models was evaluated according to five commonly used metrics of model evaluation table 3 the relative root mean square error rrmse and the mean absolute error mae quantify the differences between predicted and observed values and indicate how far the estimates are from actual data the first explains this concept in relative terms percentage on the average the second in absolute terms the coefficient of determination r2 is the squared measure of the correlation coefficient between estimates and observations it evaluates the goodness of fit of the model that is the proportion of the observed variance explained by the estimates the modelling efficiency ef indicates whether a model better describes the data ef 0 than simply the average of the observations its extent is not consistently related to the accuracy of the estimates the coefficient of residual mass crm is a measure of the tendency of the model to overestimate crm 0 or underestimate crm 0 the observations 2 3 2 suite 2 simulations under projected scenarios of climate change simulated grassland outputs were obtained by models running for the two 20 year long time slices 1986 2005 baseline and 2020 2039 near future the baseline was generated from daily downscaled weather data the 0 25 spatial resolution cell that includes the study site uncertainties in future climate projections were investigated through two emission scenarios rcps representative concentration pathways and two general circulation models gcms according to the ipcc fifth assessment report ipcc 2013 rcp4 5 reflects emissions stabilization by 2100 while rcp8 5 indicates that emissions will continue to rise two gcms hadgem2 hadley centre uk collins et al 2011 and giss es nasa schmidt et al 2006 were used as in paleari et al 2017 stochastic weather generation was used for the statistical downscaling of projected climate changes from coarse spatio temporal resolution weather series simulated from gcms e g duveiller et al 2017 in particular for each combination time slice rcp gcm 20 year daily weather series were generated by applying gcm derived changes in precipitation and temperature to the site specific parameter files of the stochastic weather generator lars wg racsko et al 1991 which is widely used for climate changes studies to generate daily site specific climate scenarios e g höglind et al 2013 hassan et al 2014 climate change driven simulations were performed by setting an automatic option in crop models invoking a once a year mowing the 1st of june of each year five additional years were generated for each weather series for use during the initialization process of cosmo but the outputs obtained were left out and not used in the analysis simulated agb obtained with both standalone and coupled models under baseline and alternative future climate scenarios were compared using non exceedance probability distributions approximated as m n 1 100 where m is the rank order of each estimate with m 1 as the largest and m n as the lowest estimate n being the number of simulated data 3 results 3 1 suite 1 of simulations model evaluation results are presented via a set of performance metrics calculated for the whole simulation period tables 4 and 5 calculated separately by output for agb we compared standalone cropsyst and wofost and their cosmo coupled versions table 4 estimates of the relative abundance of species obtained with the two cosmo coupled crop models were assessed for both the whole community table 4 and individual species table 5 3 1 1 evaluation of cosmo for the relative abundance of plant species in the community overall the accuracy of cosmo in simulating the relative abundance of species was satisfactory table 4 in mix 1 wofost and cropsyst had the best r2 0 92 and 0 93 respectively in fact the two models adequately followed the dynamics of f and m with limited fluctuations around 80 f and 20 m but with some inaccuracies mae 15 17 other performance indices rrmse 40 ef 0 6 were also satisfactory in mix 2 both ef 0 7 and mae 7 were better than in mix 1 with both cropsyst and wofost the rrmse of mix 2 was similar to mix 1 35 while r2 was lower 0 78 0 79 but still satisfactory overall cosmo was able to follow the dynamics of plant species with both wofost and cropsyst mix 3 was the most difficult to simulate with a general departure of performance indices from their optimum values with the exception of mae 7 in general cropsyst followed better than wofost the trends of inter specific dynamics though wofost estimations were more accurate considering separately all species in mixtures table 5 the performance of cosmo was quite poor in all model species combination although the mae 4 18 and crm 0 01 0 89 were satisfactory overall the f species was better simulated than other species the residuals differences between simulated and observed data of the relative presence of species in a community fig 1 a ranged about 30 around a median value near 0 mix 3 for which a larger amount of data is available was better predicted by cropsyst than wofost fig 1d as reflected in the narrower boxplot spread of cropsyst in mix 2 fig 1c the residuals had a normal distribution p 0 05 according to shapiro and wilks 1965 mix 2 is also the best simulated mixture judging by the narrow boxplots of fig 1c and the limited range about 20 of residual values mix 1 had a wide boxplot and the distribution of the errors was not normal p 0 05 3 1 2 evaluation of cosmo and standalone models for grassland production overall coupled and standalone models had a satisfactory performance with mae 1 mg ha 1 rrmse 40 and crm 0 20 though the ef was poor in most cases crm values were positive indicating a general underestimation of the observed agb with the exception of standalone version simulations in mix 2 cosmo coupled models worked better than standalone ones in mix 1 and mix 2 while the response was not univocal in mix 3 e g mae was lower with wofost and cropsyst standalone versions with cropsyst also performing better in terms of rrmse and ef with limited differences between coupled and standalone versions in mix 1 and mix 2 wofost performed better than cropsyst not for ef while cropsyst worked better on mix 3 not for ef the best performance was obtained with wofost cosmo in mix 2 with r2 0 99 and rrmse 15 59 in mix 1 and mix 2 the better performance of wofost than cropsyst was mostly obtained in the first year simulation fig 2 a b when cropsyst underestimated observations this indicates some difficulty in estimating crop emergence and initial rooting by cropsyst in the following years under and over estimations occurred with complex patterns of interaction between models and mixtures in general we observed that models were not entirely realistic in estimating plant regrowth after cutting in the water limiting conditions of the study site mix 2 was the best simulated mixture fig 2b 3 2 suite 2 of simulations model results under climate change scenarios with the two gcms and the two rcps used we forecasted for the time slice centred on 2030 temperature increases between 0 8 and 1 8 c and a general reduction of rainfall down to 67 mm yr 1 with the exception of hadgem2 gcm rcp8 5 scenario which simulated an increase of 35 mm yr 1 hadgem2 gcm projections indicate a more pronounced increase of temperatures in summer and autumn while giss es gcm changes reflect increasing temperatures in all seasons higher precipitation volumes in spring and lower in summer were projected with hadgem2 gcm whereas giss es gcm results indicate a general precipitation reduction especially in the growing season overall cropsyst simulated less agb with also less inter annual variability than wofost under future climate forcing scenarios fig 3 the difference between the two models fig 3a b was high in mix 1 for which cropsyst estimated less than 4 mg ha 1 yr 1 agb without a clear effect of climate change minimum and maximum agb estimates 2 and 4 mg ha 1 yr 1 respectively were similar with both standalone models fig 3g h both cropsyst and wofost estimated a reduction of agb under climate change with distribution curves of the combinations gcm x rcp frequently shifted to the left of the baseline with the exception of mix 1 and mix 2 with cropsyst cosmo coupled versions simulated higher agb values than standalone models the effects of climate change on these simulations were different compared to the standalone versions however the pattern of climate change effects on cosmo simulated agb is complex cropsyst simulated higher agb values in mix 1 under hadgem2 gcm scenario than baseline and giss es scenarios in this mixture wofost simulated reduced agb using hadgem2 gcm compared to baseline and giss es gcm scenarios in mix 2 no difference between scenarios was found with wofost while cropsyst simulated increased agb with hadgem2 gcm both coupled models estimated increased agb with future scenarios estimates provided by wofost indicate limited climate change effects in mix 3 slight increase with hadgem2 gcm and slight decrease with giss em gcm in cropsyst there was a general increase of agb and the highest biomass production was obtained with giss em gcm in all cases no relevant differences were found between rcps 4 discussion 4 1 comparison of model accuracy with other modelling approaches the accuracy of cosmo in simulating the relative presence of plant species in a community rrmse in the range 34 64 was similar to that found by soussana et al 2012 with the individual centred model gemini rrmse 51 which is much more complex than cosmo cosmo includes 28 parameters of which 13 are common to all species and 15 are species specific of the latter nine of these parameters usually are present in several generic simulators suitable for coupling with cosmo thus only six parameters have to be added to those of a generic simulator in our study these parameters added to 23 crop parameters in cropsyst and 100 in wofost gemini needs 100 parameters to characterise each species soussana et al 2012 and rapidly becomes increasingly complex as the number of species in the community increases the large number of species specific parameters limits the exploration of the parameter space thus obscuring their interpretability and ultimately limiting the applicability of the model in practice e g acutis and confalonieri 2006 paleari et al 2017 in our case study the accuracy of cosmo did not change with increasing the number or plant species in the community for instance mae fluctuated little around 8 in mix 2 and mix 3 and it ranged from 15 wofost and 17 cropsyst in mix 1 table 4 there was a higher rate of weeds in mix 1 41 during the experiment the competition exerted by weeds may have altered the quantity of resources available for the two species simulated within the mixture this likely explains such higher mae values for this mixture concerning the relative abundance of each species mae was satisfactory but other metrics were mostly poor because even a small mae in the estimation of relative abundance can easily turn to unsatisfactory values of other metrics if observed data are steady or fluctuate very little for instance observed agb data closely matching benchmark values i e the average value of observed data may explain the poor ef values criss and winston 2008 in general crop agb was better simulated with cosmo than with stand alone models a pertinent point here is that with cosmo it becomes possible for crop simulators to improve agb estimates while representing dynamically the relative abundance of species in a mixed cover which is a useful output to get valuable insights about the various ecosystem services provided by grasslands e g weisser et al 2017 the simulation of plant diversity is also central within scenario analyses in ecological studies to assess the capability of plant species to persist or not in a place owing to low high rates of disappearance and high low rates of successful invasion of other taxa e g mooney and hobbs 2000 the explicit representation of plant diversity can also help in managing grasslands e g to optimize the proportion of legume species in the plant community which indirectly determine the protein content of forage and the quality of diets e g capstaff and miller 2018 or to formulate forage mixtures taking into account the different phenology of plant species sanderson et al 2016 the simulation of the relative abundance of plant species can also be used for monitoring and controlling the spread of weeds which has detrimental effects on herbage yield forage quality and animal production connolly et al 2017 considering model performances for each species fig 4 is just taken as an example of the species dynamics as estimated by cosmo the simulated dynamics of the species comply with observations although the performance metric were not entirely satisfactory f and v increased their relative presence at the end of the experimental period while d was mostly lost and m appeared to be quite constant between 0 and 20 of relative abundance the models followed this trend with a low absolute error although a seasonal trend is not apparent in observed data the daily frequency of simulated data clearly showed a seasonal trend this behavior corresponds to 1 spring and autumn increase of the relative abundance of f and d species which are more competing than m and v species at low temperatures 2 less abundance of f and d species at higher temperatures which are favouring m and v species 4 2 simulation of plant diversity effects under climate change with the exception of wofost giss es gcm in mix 3 cosmo based simulations that is accounting explicitly for species dynamics in a mixture indicate the plant diversity buffers the potentially adverse effects of climate change or supports a greater biomass production due to climate change this is the behaviour of diverse plant communities as described for instance by sanderson et al 2004 who refer to the insurance effect of having some species that are tolerant to different stresses and thereby stabilize productivity however the impact of climate change on biomass production was complex buffer effects or the increase of biomass production observed in mixtures cannot be explained only by the result of the species simulated in monoculture as in cosmo an example of this is the wofost results obtained with mix 1 in which f and m monocultures are expected to produce less biomass under future scenarios but the biomass of the same species in the mixture is expected to increase this provides clue that a community of plant species can be more productive and able to adapt to climate change than single species in monoculture cosmo is thus expected to simulate accurately the effects of species dynamics and plasticity on mixture biomass productivity when running under future climate scenarios in turn since plant species richness may promote soil carbon c and nitrogen n stocks cosmo is also expected to improve estimates of c and n storage in the long term the increase of c and n stocks in soils is obtained with legume species which constitute an important n input through n2 fixation but also in the absence of legumes via increased plant productivity e g cong et al 2014 the fig 5 shows explicitly this response in all gcm rcp scenarios especially during spring and less markedly in autumn the mixture agb rate is higher than that of the most productive species grown in monoculture this is visible also in the calibration phase fig 6 an explanation of this could reside in complex mechanisms such as phenotypic plasticity and adaptation e g dewitt and scheiner 2003 expressed as a change in species composition during growing season beyond gene expression as an example fig 7 cosmo wofost simulations mix 2 shows a distinct adaptive effect in the variation of the optimum growth temperature as a function of the average air temperature as in sándor et al 2018 in particular the optimal growth temperature started to increase decrease with air temperature above below 18 20 c the way in which cosmo coupled versions of crop models appears to estimate these effects is promising 5 conclusions the work described above is specifically relevant to cropsyst and wofost but holds potential for extension to other similarly structured vegetation models because cosmo provides a framework for estimating the response of grassland systems with biophysical crop models that is more robust and complete than the modelling paradigm based on the average parameterization for complex plant covers the agreement between simulations and experimental data demonstrates that cosmo is a suitable approach for estimation of the dynamic behaviour of plant species in a community cosmo includes less parameters than other modelling approaches representing plant abundance is easier to calibrate and supports batch running because it uses a single instance of a generic crop model this study also confirms that cosmo based solutions for grassland modelling can be easily implemented though some basic knowledge is required to parameterize each single species in a grassland community to the extent that the biophysical structure of cosmo reflects the important determinants of the functioning of grassland systems we recommend its use to predict the behaviour of any relevant output with two caveats we recommend that more testing be performed under a variety of mowing regimes because of the need to assess the cosmo approach under intensive mowing management that is including two or more mowing events per year we also recommend further testing with animal grazing acknowledgements this work was undertaken under the auspices of the project modipras modelling relationships between species diversity the functioning of grassland systems and their ability to deliver ecosystem services of the inra metaprogramme ecoserv ecosystem services it was also supported by the research identification of fodder species for long duration artificial forage mixtures funded by mountain municipalities union colline metallifere and received financial support from emilia romagna region psr focus area 3a operazione 16 2 01 progetto n 5050341 and ager agroalimentare e ricerca ipcc moupa appendix a wofost parameters for poaceae d dactylis glomerata l f festuca arundinacea schreb l lolium multiflorum l parameters values units descriptions d f l development gdde 45 0 50 40 c d thermal time to emergence gddf 650 1150 600 c d thermal time to flowering gddm 3000 0 4000 3000 c d thermal time to maturity tbasem 5 5 2 c base temperature for emergence dtsmtb 0 0 0 0 0 0 c d daily increase in temperature sum as function of average daily temperature 10 7 10 5 10 10 12 9 12 7 12 20 15 12 15 10 15 24 20 17 20 15 20 21 25 22 25 20 25 13 30 27 30 25 30 3 40 20 40 35 40 0 growth cvl 0 58 0 75 0 6 efficiency of conversion into leaves cvr 0 6 0 65 0 685 efficiency of conversion into roots cvs 0 65 0 78 0 75 efficiency of conversion into stems cvo 0 5 0 55 0 709 efficiency of conversion into storage organs kdiftb 0 0 4 0 0 55 0 0 4 extinction coefficient for diffuse 0 6 0 5 0 6 0 65 0 6 0 4 visible light as function of dvs 1 0 55 1 0 65 1 0 65 2 0 6 2 0 65 2 0 65 fltb 0 0 65 0 0 8 0 0 9 fraction of aboveground dry matter to leaves as function of development stage 0 3 0 62 0 3 0 79 0 3 0 9 0 5 0 6 0 5 0 75 0 5 0 8 0 8 0 58 0 8 0 63 0 8 0 7 1 0 55 1 0 6 1 0 6 1 1 0 5 1 1 0 55 1 1 0 6 1 5 0 4 1 5 0 5 1 5 0 6 2 0 3 2 0 5 2 0 6 fstb 0 0 35 0 0 2 0 0 1 fraction of aboveground dry matter to stems as function of development stage 0 3 0 38 0 3 0 21 0 3 0 1 0 5 0 4 0 5 0 25 0 5 0 2 0 8 0 32 0 8 0 22 0 8 0 2 1 0 05 1 0 05 1 0 35 1 1 0 05 1 1 0 05 1 1 0 35 1 5 0 05 1 5 0 05 1 5 0 35 2 0 05 2 0 05 2 0 35 fotb 0 0 0 0 0 0 fraction of aboveground dry matter to storage organs as function of development stage 0 3 0 0 3 0 0 3 0 0 5 0 0 5 0 0 5 0 0 8 0 4 0 8 0 05 0 8 0 1 1 0 45 1 0 35 1 0 05 1 1 0 45 1 1 0 4 1 1 0 05 1 5 0 55 1 5 0 45 1 5 0 05 2 0 65 2 0 45 2 0 05 frtb 0 0 3 0 0 3 0 0 3 fraction of total dry matter to roots as function of development stage 0 3 0 3 0 3 0 3 0 3 0 3 0 5 0 3 0 5 0 3 0 5 0 3 0 8 0 3 0 8 0 3 0 8 0 3 1 0 3 1 0 3 1 0 3 1 1 0 1 1 0 3 1 1 0 3 1 5 0 1 5 0 3 1 5 0 3 2 0 2 0 3 2 0 3 tdwi 50 50 210 kg ha 1 initial total crop dry weight laiem 0 05 0 03 0 05 m2 m 2 leaf area index at emergence span 25 00 28 00 29 50 day life span of leaves growing at 35 c efftb 0 0 8 0 0 8 0 0 9 c kg ha 1 hr 1 j 1 light use efficiency single leaf function of average temperature 40 0 8 40 0 8 40 0 8 m2 s tbleaf 0 5 0 c lower threshold temperature for aging of leaves rri 1 2 3 0 1 2 cm day 1 maximum daily increase in rooting depth amaxtb 0 32 0 27 0 33 kg ha 1 hr 1 maximum leaf co2 assimilation rate as function of dvs 0 25 32 0 25 25 0 25 33 0 5 31 0 5 20 0 5 30 0 75 31 0 75 10 0 75 28 1 20 1 5 1 22 2 10 2 2 2 15 rgrlai 0 0200 0 0300 0 0300 m2 m 2 day 1 maximum relative increase in leaf area index effmx 30 30 30 c maximum temperature for emergence rfsetb 0 1 0 0 0 1 reduction factor for senescence function of dvs 2 1 2 0 2 1 tmpftb 5 0 5 0 2 0 c reduction factor of amax as function of average temperature 17 1 17 1 16 1 33 0 37 0 34 0 tmnftb 0 0 0 0 20 0 c reduction factor of gross assimilation rate as function of low minimum temperature 5 1 13 1 5 1 rdrrtb 0 0 0 0 0 0 relative death rate of roots as a function of development stage 1 5 0 1 5 0 1 5 0 1 501 0 01 1 501 0 02 1 501 0 01 2 0 01 2 0 02 2 0 01 0 0 0 0 0 0 1 5 0 1 5 0 1 5 0 1 501 0 01 1 501 0 01 1 501 0 01 2 0 01 2 0 01 2 0 01 q10 1 3 1 3 1 5 relative increase respiration rate per 10 degree temperature increase rml 0 04 0 03 0 05 kg ch2o kg 1 d 1 relative maintenance respiration of leaves rmr 0 04 0 05 0 05 kg ch2o kg 1 d 1 relative maintenance respiration of roots rms 0 04 0 02 0 05 kg ch2o kg 1 d 1 relative maintenance respiration of stems rmo 0 04 0 03 0 05 kg ch2o kg 1 d 1 relative maintenance respiration of storage organs slatb 0 0 0023 0 0 0018 0 0 0026 ha kg 1 specific leaf area as a function of 0 5 0 0023 0 5 0 0018 0 5 0 0026 dvs 0 78 0 0023 0 78 0 0018 0 78 0 0026 2 0 0023 2 0 0018 2 0 0026 spa 0 0001 0 0001 0 0001 ha kg 1 specific pod area ssatb 0 0 0001 0 0 0009 0 0 0009 ha kg 1 specific stem area as a function of 2 0 0001 2 0 0009 2 0 0009 dvs cgn 3 1 2 crop group number rdws 0 2 0 5 0 01 kg kg 1 d 1 maximum relative death rate of leaves due to water stress maxrd 140 145 100 cm this parameter represents the maximum rooting depth maxh 1 5 1 25 1 cm maximum canopy height for the species laimax 7 5 6 6 5 m2 m 2 maximum leaf area index for the species appendix b wofost parameters for fabaceae g lotus corniculatus l m medicago sativa l v onobrychis viciifolia scop and t trifolium repens l parameters values units descriptions g m v t development gdde 50 50 50 50 c d thermal time to emergence gddf 750 800 700 400 c d thermal time to flowering gddm 3000 2800 5000 3200 c d thermal time to maturity tbasem 7 5 5 3 c base temperature for emergence dtsmtb 0 0 0 0 0 0 0 0 c d daily increase in temperature sum as function of average daily temperature 10 3 10 5 10 4 10 7 12 5 12 7 12 6 12 9 15 8 15 8 15 9 15 12 20 13 20 15 20 14 20 17 25 18 25 20 25 19 25 20 30 23 30 25 30 24 30 20 40 33 40 28 40 30 40 10 growth cvl 0 6 0 68 0 68 0 66 efficiency of conversion into leaves cvr 0 5 0 7 0 68 0 8 efficiency of conversion into roots cvs 0 75 0 68 0 56 0 55 efficiency of conversion into stems cvo 0 5 0 8 0 6 0 709 efficiency of conversion into storage organs kdiftb 0 0 5 0 0 4 0 0 4 0 0 4 extinction coefficient for diffuse visible light as function of dvs 0 6 0 5 0 6 0 4 0 6 0 45 0 6 0 4 1 0 65 1 0 65 1 0 4 1 0 65 2 0 65 2 0 65 2 0 4 2 0 65 fltb 0 0 45 0 0 75 0 0 65 0 0 9 fraction of aboveground dry matter to leaves as function of development stage 0 3 0 35 0 3 0 75 0 3 0 65 0 3 0 9 0 5 0 25 0 5 0 75 0 5 0 65 0 5 0 9 0 8 0 15 0 8 0 68 0 8 0 55 0 8 0 8 1 0 1 1 0 65 1 0 5 1 0 8 1 1 0 1 1 1 0 5 1 1 0 45 1 1 0 8 1 5 0 1 1 5 0 4 1 5 0 4 1 5 0 8 2 0 1 2 0 4 2 0 4 2 0 8 fstb 0 0 55 0 0 25 0 0 35 0 0 1 fraction of aboveground dry matter to stems as function of development stage 0 3 0 65 0 3 0 25 0 3 0 35 0 3 0 1 0 5 0 75 0 5 0 25 0 5 0 35 0 5 0 1 0 8 0 75 0 8 0 02 0 8 0 35 0 8 0 15 1 0 8 1 0 05 1 0 05 1 0 15 1 1 0 8 1 1 0 05 1 1 0 05 1 1 0 15 1 5 0 8 1 5 0 05 1 5 0 05 1 5 0 15 2 0 8 2 0 05 2 0 05 2 0 15 fotb 0 0 0 0 0 0 0 0 fraction of aboveground dry matter to storage organs as function of development stage 0 3 0 0 3 0 0 3 0 0 3 0 0 5 0 0 5 0 0 5 0 0 5 0 0 8 0 1 0 8 0 3 0 8 0 1 0 8 0 15 1 0 1 1 0 35 1 0 45 1 0 15 1 1 0 1 1 1 0 45 1 1 0 5 1 1 0 15 1 5 0 1 1 5 0 55 1 5 0 55 1 5 0 15 2 0 1 2 0 55 2 0 55 2 0 15 frtb 0 0 3 0 0 3 0 0 3 0 0 3 fraction of total dry matter to roots as function of development stage 0 3 0 3 0 3 0 3 0 3 0 3 0 3 0 3 0 5 0 3 0 5 0 3 0 5 0 3 0 5 0 3 0 8 0 3 0 8 0 3 0 8 0 3 0 8 0 3 1 0 3 1 0 3 1 0 3 1 0 3 1 1 0 3 1 1 0 3 1 1 0 3 1 1 0 3 1 5 0 3 1 5 0 3 1 5 0 3 1 5 0 3 2 0 3 2 0 3 2 0 2 0 3 tdwi 210 50 210 210 kg ha 1 initial total crop dry weight laiem 0 05 0 05 0 05 0 05 m2 m 2 leaf area index at emergence span 29 50 29 50 29 00 29 50 day life span of leaves growing at 35 c efftb 0 0 6 0 0 6 0 0 7 0 0 6 c kg ha 1 hr 1 light use efficiency single leaf function of average temperature 40 0 36 40 0 36 40 0 6 40 0 36 j 1 m2 s tbleaf 0 0 0 0 c lower threshold temperature for aging of leaves rri 1 2 1 2 1 2 1 2 cm day 1 maximum daily increase in rooting depth amaxtb 0 20 0 35 0 27 0 15 kg ha 1 hr 1 maximum leaf co2 assimilation rate as function of dvs 0 25 18 0 25 30 0 25 26 0 25 15 0 5 15 0 5 25 0 5 25 0 5 14 0 75 10 0 75 22 0 75 24 0 75 14 1 8 1 10 1 18 1 12 2 1 2 7 2 10 2 8 rgrlai 0 0817 0 0080 0 0080 0 0800 m2 m 2 day 1 maximum relative increase in leaf area index effmx 30 30 30 30 c maximum temperature for emergence rfsetb 0 1 0 1 0 0 0 1 reduction factor for senescence function of dvs 2 1 2 1 2 0 2 1 tmpftb 5 0 5 0 5 0 2 0 c reduction factor of amax as function of average temperature 23 1 24 1 22 1 14 1 38 0 38 0 37 0 38 0 tmnftb 20 0 0 0 0 0 20 0 c reduction factor of gross assimilation rate as function of low minimum temperature 5 1 5 1 5 1 5 1 rdrrtb 0 0 0 0 0 0 0 0 relative death rate of roots as a function of development stage 1 5 0 1 5 0 1 5 0 1 5 0 1 501 0 01 1 501 0 01 1 501 0 01 1 501 0 01 2 0 01 2 0 01 2 0 01 2 0 01 0 0 0 0 0 0 0 0 1 5 0 1 5 0 1 5 0 1 5 0 1 501 0 01 1 501 0 01 1 501 0 01 1 501 0 01 2 0 01 2 0 01 2 0 01 2 0 01 q10 1 5 1 5 1 5 1 5 relative increase respiration rate per 10 degree temperature increase rml 0 05 0 05 0 05 0 05 kg ch2o kg 1 d 1 relative maintenance respiration of leaves rmr 0 05 0 05 0 05 0 05 kg ch2o kg 1 d 1 relative maintenance respiration of roots rms 0 05 0 05 0 07 0 05 kg ch2o kg 1 d 1 relative maintenance respiration of stems rmo 0 05 0 05 0 05 0 05 kg ch2o kg 1 d 1 relative maintenance respiration of storage organs slatb 0 0 0031 0 0 003 0 0 0015 0 0 003 ha kg 1 specific leaf area as a function of dvs 0 5 0 0031 0 5 0 003 0 5 0 0015 0 5 0 003 0 78 0 0031 0 78 0 003 0 78 0 0015 0 78 0 003 2 0 0031 2 0 003 2 0 0015 2 0 003 spa 0 0001 0 0005 0 0001 0 0001 ha kg 1 specific pod area ssatb 0 0 0009 0 0 0009 0 0 0009 0 0 0009 ha kg 1 specific stem area as a function of dvs 2 0 0009 2 0 0009 2 0 0009 2 0 0009 cgn 1 1 2 2 crop group number rdws 0 01 0 4 0 01 0 5 kg kg 1 d 1 maximum relative death rate of leaves due to water stress maxrd 200 180 180 100 cm maximum rooting depth maxh 0 4 1 3 1 4 0 8 cm maximum canopy height for the species laimax 4 5 6 7 m2 m 2 maximum leaf area index for the species appendix c cropsyst parameters d dactylis glomerata l f festuca arundinacea schreb l lolium multiflorum l g lotus corniculatus l m medicago sativa l v onobrychis viciifolia scop and t trifolium repens l parameters values units descriptions d f l g m v t development bt 5 5 2 5 5 5 2 c base temperature for development cot 33 37 34 38 38 37 38 c cutoff temperature for development gdde 50 40 50 50 50 50 40 c d thermal time to emergence gddgf 650 1150 600 700 900 800 400 c d thermal time to begin yield formation gddf 650 1150 600 750 800 700 400 c d thermal time to flowering gddeglai 3800 2900 1500 3000 2900 3100 3200 c d thermal time to end green leaf area index gddm 4000 3000 3000 2800 5000 3200 3000 c d thermal time to maturity growth tbc 4 3 2 8 4 3 2 8 kg m 2 kpa m 1 transpiration biomass coefficient k 0 45 0 47 0 4 0 6 0 5 0 5 0 4 extinction coefficient for solar radiation cf 0 95 0 9 0 8 0 8 1 0 9 0 8 et crop coefficient at full canopy mwu 8 7 8 10 7 7 10 kg m 2 d 1 full canopy water uptake maximum laiini 0 09 0 09 0 09 0 09 0 09 0 09 0 09 m2 m 2 initial leaf area index lshape 1 5 2 1 1 1 5 1 5 1 5 leaf area index initial value shape leaflife 500 580 500 800 400 450 450 c d leaf life glaimin 0 045 0 04 0 05 0 03 0 03 0 05 0 03 m2 m 2 minimum initial green leaf area index ntc 2 5 1 10 9 3 1 c night temperature critical ntm 18 17 18 20 22 19 19 c night temperature maximum parf 0 5 0 5 0 5 0 46 0 5 0 5 0 6 factor to convert global solar radiation to par reue 2 7 2 5 3 3 2 3 3 1 7 1 2 g mj 1 maximum radiation use efficiency sla 23 18 26 31 30 15 30 m2 kg 1 specific leaf area at emergence stp 4 5 2 0 1 2 3 3 2 0 4 6 1 0 stem leaf partition coefficient wsi 1 1 1 1 1 1 1 development susceptibility to water stress 0 not susceptible laimax 7 5 6 6 5 4 5 6 7 m2 m 2 maximum leaf area index for the species maxh 1 5 1 25 1 0 4 1 3 1 4 0 8 cm maximum canopy height for the species maxrd 140 145 100 200 180 180 100 cm maximum rooting depth optt 17 17 16 23 24 22 14 c optimal temperature to growth appendix d cosmo parameters d dactylis glomerata l f festuca arundinacea schreb l lolium multiflorum l g lotus corniculatus l m medicago sativa l v onobrychis viciifolia scop and t trifolium repens l parameters values units descriptions d f l g m v t laimax 7 5 6 6 5 4 5 6 7 m2 m 2 maximum leaf area index for the species maxh 1 5 1 25 1 0 4 1 3 1 4 0 8 cm maximum canopy height for the species wcc 0 76 0 8 0 6 1 0 88 0 82 0 65 drought tolerance of the different species the highest the value the highest the tolerance maxrd 140 145 100 200 180 180 100 cm maximum rooting depth lct 5 5 2 5 5 5 2 c critical temperature below which the plant is not able to compete or to growth optt 17 17 16 23 24 22 14 c optimal temperature at which the plant ability to compete is maximum uct 33 37 34 38 38 37 38 c critical temperature above which the plant is not able to compete or to growth common parameters i 20 inertia coefficient of species replacement wfmin 0 15 m3 m 3 minimum water available for fibrous roots growth wfmax 0 5 m3 m 3 maximum water available for fibrous roots growth wtmin 0 1 m3 m 3 minimum water available for tap roots growth wtmax 0 4 m3 m 3 maximum water available for tap roots growth appendix e wofost stand alone version parameters parameters values units descriptions development gdde 45 0 c d thermal time to emergence gddf 1150 0 c d thermal time to flowering gddm 3000 0 c d thermal time to maturity tbasem 5 0 c base temperature for emergence dtsmtb 0 0 c d daily increase in temperature sum as function of 10 5 average daily temperature 12 7 15 10 20 15 25 20 30 25 40 35 growth cvl 0 8 efficiency of conversion into leaves cvr 0 7 efficiency of conversion into roots cvs 0 8 efficiency of conversion into stems cvo 0 6 efficiency of conversion into storage organs kdiftb 0 0 55 extinction coefficient for diffuse visible light as function of dvs 0 6 0 65 1 0 65 2 0 65 fltb 0 0 8 fraction of aboveground dry matter to leaves as function of development stage 0 3 0 79 0 5 0 75 0 8 0 63 1 0 6 1 1 0 55 1 5 0 5 2 0 5 fstb 0 0 2 fraction of aboveground dry matter to stems as function of development stage 0 3 0 21 0 5 0 25 0 8 0 22 1 0 05 1 1 0 05 1 5 0 05 2 0 05 fotb 0 0 fraction of aboveground dry matter to storage organs as function of development stage 0 3 0 0 5 0 0 8 0 05 1 0 35 1 1 0 4 1 5 0 45 2 0 45 frtb 0 0 3 fraction of total dry matter to roots as function of development stage 0 3 0 3 0 5 0 3 0 8 0 3 1 0 3 1 1 0 3 1 5 0 3 2 0 3 tdwi 50 0 kg ha 1 initial total crop dry weight laiem 0 0 m2 m 2 leaf area index at emergence span 28 0 day life span of leaves growing at 35 c efftb 0 0 8 c kg ha 1 hr 1 j 1 light use efficiency single leaf function of average temperature 40 0 8 m2 s tbleaf 5 0 c lower threshold temperature for aging of leaves rri 3 0 cm day 1 maximum daily increase in rooting depth amaxtb 0 27 kg ha 1 h 1 maximum leaf co2 assimilation rate as function of dvs 0 25 25 0 5 20 0 75 10 1 5 2 2 rgrlai 0 0 m2 m 2 day 1 maximum relative increase in leaf area index effmx 30 0 c maximum temperature for emergence 10 0 14 0 rfsetb 0 0 reduction factor for senescence function of dvs 2 0 tmpftb 5 0 c reduction factor of amax as function of average temperature 17 1 37 0 tmnftb 0 0 c reduction factor of gross assimilation rate as function of low minimum temperature 13 1 rdrrtb 0 0 relative death rate of roots as a function of development stage 1 5 0 1 501 0 02 2 0 02 0 0 1 5 0 1 501 0 01 2 0 01 q10 1 3 relative increase respiration rate per 10 degree temperature increase rml 0 0 kg ch2o kg 1 d 1 relative maintenance respiration of leaves rmr 0 1 kg ch2o kg 1 d 1 relative maintenance respiration of roots rms 0 0 kg ch2o kg 1 d 1 relative maintenance respiration of stems rmo 0 0 kg ch2o kg 1 d 1 relative maintenance respiration of storage organs slatb 0 0 0018 ha kg 1 specific leaf area as a function of dvs 0 5 0 0018 0 78 0 0018 2 0 0018 spa 0 0 ha kg 1 specific pod area ssatb 0 0 0009 ha kg 1 specific stem area as a function of dvs 2 0 0009 cgn 1 0 crop group number rdws 0 5 kg kg 1 d 1 maximum relative death rate of leaves due to water stress maxrd 140 0 cm maximum rooting depth maxh 1 5 cm maximum canopy height for the species laimax 7 5 m2 m 2 maximum leaf area index for the species appendix f cropsyst stand alone version parameters parameters values units descriptions development bt 5 c base temperature for development cot 33 c cutoff temperature for development gdde 50 c d thermal time to emergence gddgf 650 c d thermal time to begin yield formation gddf 650 c d thermal time to flowering gddeglai 3800 c d thermal time to end green leaf area index gddm 4000 c d thermal time to maturity growth tbc 4 kg m 2 kpa m 1 transpiration biomass coefficient k 0 45 extinction coefficient for solar radiation cf 0 95 et crop coefficient at full canopy mwu 8 kg m 2 d 1 full canopy water uptake maximum hi 0 9 harvest index laiini 0 09 m2 m 2 initial leaf area index lshape 1 5 leaf area index initial value shape leaflife 500 c d leaf life glaimin 0 045 m2 m 2 minimum initial green leaf area index ntc 2 c night temperature critical ntm 18 c night temperature maximum parf 0 5 factor to convert global solar radiation to par reue 2 7 g mj 1 maximum radiation use efficiency sla 23 m2 kg 1 specific leaf area at emergence stp 4 stem leaf partition coefficient wsi 1 development susceptibility to water stress laimax 7 5 m2 m 2 maximum leaf area index for the species maxh 1 5 cm maximum canopy height for the species maxrd 140 cm maximum rooting depth optt 17 c optimal temperature to growth appendix g wofost climate change effects on yield g giss es gcm h hadgem2 gcm 4 rcp4 5 8 rcp8 5 crop file variable baseline 4g 4h 8g 8h m1 average kg ha 1 6038 16 6114 90 6029 95 6148 91 6070 53 variation coefficient 17 33 13 68 12 02 14 70 14 00 yield gap kg ha 1 76 73 8 21 110 75 32 37 m2 average kg ha 1 3970 09 4280 85 4400 77 4470 03 4483 15 variation coefficient 13 76 16 41 16 67 15 36 13 59 yield gap kg ha 1 310 77 430 69 499 94 513 06 m3 average kg ha 1 4718 32 4562 46 4727 40 4443 23 4824 92 variation coefficient 10 97 17 31 11 95 17 88 11 42 yield gap kg ha 1 155 86 9 08 275 10 106 60 f average kg ha 1 3512 25 3365 89 3242 35 3434 30 3306 13 variation coefficient 24 17 21 67 30 01 24 35 27 43 yield gap kg ha 1 146 36 269 90 77 94 206 12 m average kg ha 1 5358 98 4970 15 4753 99 4901 37 4771 45 variation coefficient 19 65 9 35 6 56 8 62 5 85 yield gap kg ha 1 388 83 604 99 457 61 587 53 d average kg ha 1 2206 02 2081 62 2307 37 2084 39 2424 36 variation coefficient 29 02 27 17 28 07 28 60 27 71 yield gap kg ha 1 124 40 101 35 121 62 218 34 v average kg ha 1 2979 47 3288 21 3416 84 3356 19 3451 91 variation coefficient 14 15 11 26 10 94 11 96 9 66 yield gap kg ha 1 308 74 437 37 376 72 472 44 l average kg ha 1 10983 45 10039 75 9663 05 9548 76 9644 41 variation coefficient 9 19 10 99 5 28 11 34 5 25 yield gap kg ha 1 943 70 1320 40 1434 69 1339 04 t average kg ha 1 4257 77 4155 74 4292 33 4092 72 4313 36 variation coefficient 9 87 10 94 7 65 11 56 7 35 yield gap kg ha 1 102 03 34 56 165 05 55 59 g average kg ha 1 2060 06 2527 88 2599 91 2538 74 2609 52 variation coefficient 31 46 21 63 12 31 19 65 11 18 yield gap kg ha 1 467 83 539 85 478 69 549 47 standalone average kg ha 1 3463 41 3338 18 3224 45 3408 29 3290 18 variation coefficient 23 46 21 27 30 28 24 19 27 71 yield gap kg ha 1 125 23 238 96 55 12 173 22 appendix h cropsyst climate change effects on yield g giss es gcm h hadgem2 gcm 4 rcp4 5 8 rcp8 5 crop file variable baseline 4g 4h 8g 8h m1 average kg ha 1 1965 16 1905 36 2059 60 1956 47 2111 41 variation coefficient 19 42 18 95 30 10 25 72 29 81 yield gap kg ha 1 59 80 94 45 8 69 146 25 m2 average kg ha 1 1173 74 1171 83 1809 94 1302 81 1931 51 variation coefficient 15 91 25 34 29 28 32 43 30 20 yield gap kg ha 1 1 91 636 21 129 07 757 77 m3 average kg ha 1 2780 57 3033 78 2855 47 3198 55 2835 77 variation coefficient 16 81 15 38 28 04 18 93 28 34 yield gap kg ha 1 253 21 74 90 417 98 55 20 f average kg ha 1 1956 93 1933 80 2093 73 1986 83 2141 91 variation coefficient 18 68 18 27 27 57 23 64 27 49 yield gap kg ha 1 23 14 136 79 29 90 184 98 m average kg ha 1 5915 14 5327 47 5448 69 5257 01 5581 34 variation coefficient 20 15 17 41 15 68 16 08 15 35 yield gap kg ha 1 587 67 466 46 658 14 333 80 d average kg ha 1 2605 62 2238 09 2265 18 2228 76 2308 69 variation coefficient 25 88 16 63 23 50 19 07 23 48 yield gap kg ha 1 367 54 340 44 376 86 296 93 v average kg ha 1 392 81 354 03 352 36 356 39 355 71 variation coefficient 21 94 12 91 15 77 13 37 16 04 yield gap kg ha 1 38 78 40 46 36 42 37 10 l average kg ha 1 1894 56 1915 51 2088 58 1896 66 2109 18 variation coefficient 25 48 28 20 32 36 30 54 32 87 yield gap kg ha 1 20 95 194 02 2 10 214 62 t average kg ha 1 1328 61 1315 19 1407 77 1323 05 1421 28 variation coefficient 21 57 22 11 29 01 27 10 28 98 yield gap kg ha 1 13 42 79 16 5 56 92 67 g average kg ha 1 4805 98 5041 26 5536 18 5235 16 5660 77 variation coefficient 10 19 12 58 13 49 14 73 13 77 yield gap kg ha 1 235 29 730 20 429 19 854 79 standalone average kg ha 1 2610 44 2244 47 2268 70 2234 54 2310 42 variation coefficient 25 89 16 64 23 48 18 96 23 48 yield gap kg ha 1 365 97 341 74 375 90 300 02 
25076,nonequilibrium thermodynamic theory has much to offer in explaining ecological and evolutionary processes formalizing biological processes in terms of thermodynamic parameters reveals that the generation of natural organization and complexity is an emergent property of entropy in systems maintained far from equilibrium understanding the interplay between thermodynamics ecology and evolution provides key insights into how underlying stochastic dynamics such as mutation and drift yield highly structured populations and communities here a stochastic mathematical model of ecological evolution the tangled nature model is utilized to explore the ecological dynamics and the emergence of structure that are so crucial to biology the results of the model s simulations demonstrate that the punctuated equilibria successively generated by the model s dynamics have increasing entropies and that this leads to emergent order organization and complexity over time keywords entropy order ecological succession evolution oganization complexity 1 introduction the structuring of biological systems is the product of natural selection and ecological succession acting on populations and communities over successive generations these processes yield highly structured organisms populations and ecosystems this has led to the question how can structured or orderly systems have arisen despite the ever increasing entropy of the universe this question has been partially addressed in the physics chemistry and cosmology literature e g davies landsberg frautchi layzer but has yet to be thoroughly examined in biological systems in the most general sense structuring occurs anytime the entropy of a system is below the maximal entropy of the system i e the entropy of the system without constraints at the chemical level it has been shown that when boundary conditions impose a flow of energy through the system a higher free energy can be maintained at steady state than at equilibrium morowitz and smith 2007 this results in a system with stored free energy and lower internal entropy relative to its surroundings which is maintained in a stable state some distance from thermodynamic equilibrium this distance from equilibrium is a measure of the organization of the system morowitz 1968 specifically the distance can be measured by the difference in the entropy of the system and the entropy the same mass would have without the organization this formalism has been utilized at the cosmological scale to demonstrate that as the universe expands relaxation processes cannot keep pace with the expansion and there is a lag of the actual entropy s behind the maximal possible equilibrium entropy s max yielding thermodynamic disequilibrium frautschi 1982 layzer 1991 landsberg 1984 here s max is the largest possible configurational entropy that can be obtained by arranging the agents of a system in all possible ways with no constraints and the actual entropy is the realized configuration of those agents in the system it is the difference between the two s max s which measures the departure from total homogeneity and randomness at equilibrium that denotes organization frautishi 1982 layzer 1988 fig 1 many attempts have been made to formalize physical parameters such as entropy and energy in evolving ecological systems e g fath et al 2004 jørgensen and svirezhev 2004 harte 2011 roach et al 2018 ulanowicz 2018a b notably brooks and wiley 1988 followed the work of morowitz frautschi layzer and landsberg and developed a theory of biological evolution based on an informational extension of configurational entropy in their formalism brooks and wiley 1988 they hypothesize that organisms species and ecosystems also generate organization complexity and order by maintaining their configurational entropy at a level lower than maximal fig 1 brooks and wiley 1984 thus living systems should increase order organization and complexity as a result of an increase in entropy brooks and wiley 1988 these formalisms of structuring provide a firm theoretical basis for quantifying the relationship among entropy organization and order however measuring such quantities in natural biological systems on evolutionary time scales is difficult therefore a stochastic agent based model of evolutionary ecology the tangled nature model tnm is used to explore the decoupling of disorder and entropy in evolving ecological systems 2 the tnm the tangled nature model christensen et al 2002 tnm of ecological evolution features individual agents which reproduce asexually with the possibility for mutation agents are represented by binary strings for convenience called genomes and groups of agents with identical genomes are called species each new species gets interactions with other species drawn from a distribution which is symmetric around zero the tangle of interactions connecting an agent to others determines its reproductive success with positive or mutualistic interactions leading to a higher relative reproduction rate i e higher fitness consequently interactions with positive sign become gradually more common as the system evolves the model provides a simple description of an ecosystem where agents vie for a constant flow of external resources as detailed below the ecosystem as such becomes gradually better at exploiting the incoming resources and the population of the ecosystem slowly increases extant species in the tnm can be grouped into a few highly populated core species connected by mutualistic interactions and numerous sparsely populated cloud species by definition core species have a population exceeding 5 of the most populous species and all species not belonging to the core belong to the cloud core species owe their reproductive success to the mutualistic interactions connecting them cloud species are sparsely and intermittently populated mainly by an influx of mutants from the core their interactions are distributed in the same way as those between new species in the tnm each dynamical trajectory is characterized by periods of metastability of growing length referred to as quasi evolutionary stable states qesss which mimic the punctuated equilibria of biological macroevolution eldredge and gould 1972 during a qess the composition of the core stays put and macroscopic quantities such as the total population fluctuate slightly around fixed plateau values the transitions between consecutive qesss are increasingly rare rapid and turbulent events called quakes which entail considerable rearrangements of the network structure becker and sibani 2014 i e in most cases a complete renewal of the core at a coarse grained level a tnm trajectory consists of a series of qesss each with a different core as the system ages cores on average gradually have stronger i e more positive mutualistic interactions and both the number of core species and the total population grow in the process becker and sibani 2014 positive interactions are responsible not only for the stability of a core but also for its eventual demise occasionally a mutant in the cloud is linked to the core by strong positive interactions and as a consequence its offspring grow rapidly this destabilizes the core and induces a quake old cores are those able to coexist with large clouds which do not threaten their survival to summarize the evolution of the tnm is a decelerating process where an increasing structural organization can be identified furthermore tnm evolution can be seen as a spontaneous process associated to an increase of configurational entropy becker and sibani 2014 andersen and sibani 2016 this makes the model well suited to investigate how entropy and structural organization are connected 3 tnm implementation as mentioned the tnm s elementary variables are binary strings of length k i e points of the k dimensional hypercube each point represents a genome and is populated by a varying number of individuals the abundance of that genome simulation time is given in generations prior to starting the simulations values for the couplings j ab between any two genomes a and b are created to this end three fixed arrays of length 2 k i f 1 and f 2 are utilized the first contains ones with probability p interaction 1 4 and zeros otherwise the other two contain random numbers drawn from a gaussian distribution with zero mean and unit variance the genomes of a and b are first xored to produce a new binary string c the binary strings can now be read as integer labels whenever needed and the coupling j ab is zero if and only if i c 0 otherwise j ab gf 1 c f 2 b where g is a constant reproduction probabilities in the tnm are calculated as follows let e denote the set of all extant species or ecosystem let n b t denote the population size of species b at time t and n t e n b t the total population size an individual of type a is chosen as candidate for reproduction with probability n a n a n and successfully reproduces with probability p off a 1 1 e h a where 1 h a t μ n t b j ab t and where 2 j ab n b n j ab j ab n b is a density weighted coupling in eq 1 μ is a positive constant which limits the size of the ecosystem at each successful reproduction step a point mutation in the offspring occurs with probability of mutation per bit by p mut parent and offspring then differ by k bits with probability bin k k p mut the binomial distribution natural death occurs with probability p kill 4 structure order and organization landsberg 1984 formally decouples disorder and entropy by comparing s the realized entropy of a system subject to structural or other constraints and s max the entropy of the system with the constraints removed he defines the disorder of the system to be the ratio s s max and the complementary notion of 3 order 1 s s max building on layzer s 1977 work concerning information in physical and biological systems brooks and wiley 1986 explore by way of several phenomenological examples this decoupling of entropy and disorder to demonstrate the sense in which various constraints on a system can keep the realized entropy of the system below the maximum possible entropy they focus on the difference rather than the ratio to define 4 organization s max s and they identify the complexity of the system with the realized entropy s fig 1 5 configurational entropy calculation of entropy s in statistical mechanics configurational entropy is the portion of a system s entropy that is related to the position of its constituents rather than to their velocity or momentum in a biological sense this can be interpreted as the spatial heterogeneity of constituents in genomic space functional space physical space etc the boltzmann entropy of roach et al 2017 is used to calculate the entropy of the tnm during qesss over the model s evolutionary course this configurational entropy is derived from a count of the number of ways the progeny of the core can be produced within the gene space of potential species in a way consistent with the reproduction and mutation characteristics of a qess in the tnm in short the following equation was used 5 s ln k 0 k nf k nc k 1 nf k to calculate the realized entropy s of a qess where k is the genome length n is total number of individuals n is the number of core species k is the number of distinct mutated positions in the genome f k is the fraction of progeny with k mutations and c k is the total number of k mutated sites around a core species 6 calculation of s max to calculate s max consider a hypothetical system consisting of n individuals as before but these individuals are not organized into core and cloud the corresponding configurational entropy s max is then derived from a count much larger than above namely one which describes the number of ways of distributing n indistinguishable individuals into the 2 k distinguishable sites in the hypercube in that case 6 s max ln 2 k n 1 n n 1 ln 2 k n n 2 k where the expression on the right is based on the stirling approximation and the assumption 2 k n for the case n 500 s max 4320 7 in silico simulations and results an ensemble of 800 independent tnm simulations were run with parameters initial population contains 500 identical agents environmental harshness μ 0 1 interaction coupling strength g 100 genome length l 20 probability of being connected by interactions p interaction 0 25 probability of death p death 0 2 probability of mutation p mut 0 01 snapshots were collected at 100 time points between t 100 and t 100 000 the resulting realized entropies s and maximum entropies s max are plotted in fig 2 where it is seen that the maximum entropy of the system grows at a faster rate than the realized entropy this creates an increasing macroscopic organizational structuring through the evolution of the ecosystem which has been plotted in fig 3 top panel the emergent order of the system has also been plotted over time and it is notable that the order remains relatively constant although it does have a slope which is significantly greater than zero b 0 000581 p 0 0128 8 discussion and conclusion using the tnm allows one to investigate how underlying stochastic dynamics can lead to emergent macroscopic structuring in nonequilibrium systems the observations from the model were used to calculate empirical entropies during qesss over evolutionary courses of the model these calculations reveal that the growth of entropy leads to a concomitant increase in organization and order another indicator of structuring in the system may be the per capita entropy s n as previously shown by roach et al 2017 the clear decrease in this quantity is perhaps the best source of understanding why structuring occurs s increases but s n decreases entropy grows due to the growth of population however the per capita s decreases as a result of the emergent structuring of the system this entropically driven generation of order organization and complexity has been purported to be characteristic of evolving biological systems toussaint and schneider 1998 schneider and kay 1995 at many scales however the quantitative treatment of this claim has been limited by the difficulty in calculating an absolute entropy and maximum entropy in real evolutionary ecosystems the data shown here from the tnm simulations demonstrate that these proposed features of real biological systems are recapitulated as properties that emerge from underlying stochastic processes it is also interesting that there is a decelerating rate of entropic change between qesss as time progresses this decelerating rate of entropy change has also been proposed to be a common characteristic of general evolution i e both biotic and abiotic evolution prigogine and stengers 1984 but has lacked extensive empirical testing at the species and ecosystem level the tnm provides a useful model to begin testing this hypothesis of diminishing entropic change over evolutionary time as complexity science and systems biology continue to highlight the integrated nature of biology and physics interdisciplinary approaches which combine the mathematical rigor of thermodynamics with the descriptive power of ecological and evolutionary theory are needed to fully understand the mechanisms involved in the generation of biological organization and order although more accurate and descriptive models will continue to advance theory concerning the role of thermal physics in biology ultimately these theoretical predictions must be tested using real biological data thus future work should not only concentrate on developing better models but should also focus on analyzing real biological systems that are amenable to calculating both realized and maximal entropies in order to elucidate the exact role of entropy in biological processes acknowledgements this work was supported by the national science foundation funding provided to t n f r nsf division of graduate education g00009988 the authors would like to thank mark little nate robinett ana cobian guemez sandi calhoun and douglas naliboff for their reading of the manuscript and thoughtful insight during the writing process 
25076,nonequilibrium thermodynamic theory has much to offer in explaining ecological and evolutionary processes formalizing biological processes in terms of thermodynamic parameters reveals that the generation of natural organization and complexity is an emergent property of entropy in systems maintained far from equilibrium understanding the interplay between thermodynamics ecology and evolution provides key insights into how underlying stochastic dynamics such as mutation and drift yield highly structured populations and communities here a stochastic mathematical model of ecological evolution the tangled nature model is utilized to explore the ecological dynamics and the emergence of structure that are so crucial to biology the results of the model s simulations demonstrate that the punctuated equilibria successively generated by the model s dynamics have increasing entropies and that this leads to emergent order organization and complexity over time keywords entropy order ecological succession evolution oganization complexity 1 introduction the structuring of biological systems is the product of natural selection and ecological succession acting on populations and communities over successive generations these processes yield highly structured organisms populations and ecosystems this has led to the question how can structured or orderly systems have arisen despite the ever increasing entropy of the universe this question has been partially addressed in the physics chemistry and cosmology literature e g davies landsberg frautchi layzer but has yet to be thoroughly examined in biological systems in the most general sense structuring occurs anytime the entropy of a system is below the maximal entropy of the system i e the entropy of the system without constraints at the chemical level it has been shown that when boundary conditions impose a flow of energy through the system a higher free energy can be maintained at steady state than at equilibrium morowitz and smith 2007 this results in a system with stored free energy and lower internal entropy relative to its surroundings which is maintained in a stable state some distance from thermodynamic equilibrium this distance from equilibrium is a measure of the organization of the system morowitz 1968 specifically the distance can be measured by the difference in the entropy of the system and the entropy the same mass would have without the organization this formalism has been utilized at the cosmological scale to demonstrate that as the universe expands relaxation processes cannot keep pace with the expansion and there is a lag of the actual entropy s behind the maximal possible equilibrium entropy s max yielding thermodynamic disequilibrium frautschi 1982 layzer 1991 landsberg 1984 here s max is the largest possible configurational entropy that can be obtained by arranging the agents of a system in all possible ways with no constraints and the actual entropy is the realized configuration of those agents in the system it is the difference between the two s max s which measures the departure from total homogeneity and randomness at equilibrium that denotes organization frautishi 1982 layzer 1988 fig 1 many attempts have been made to formalize physical parameters such as entropy and energy in evolving ecological systems e g fath et al 2004 jørgensen and svirezhev 2004 harte 2011 roach et al 2018 ulanowicz 2018a b notably brooks and wiley 1988 followed the work of morowitz frautschi layzer and landsberg and developed a theory of biological evolution based on an informational extension of configurational entropy in their formalism brooks and wiley 1988 they hypothesize that organisms species and ecosystems also generate organization complexity and order by maintaining their configurational entropy at a level lower than maximal fig 1 brooks and wiley 1984 thus living systems should increase order organization and complexity as a result of an increase in entropy brooks and wiley 1988 these formalisms of structuring provide a firm theoretical basis for quantifying the relationship among entropy organization and order however measuring such quantities in natural biological systems on evolutionary time scales is difficult therefore a stochastic agent based model of evolutionary ecology the tangled nature model tnm is used to explore the decoupling of disorder and entropy in evolving ecological systems 2 the tnm the tangled nature model christensen et al 2002 tnm of ecological evolution features individual agents which reproduce asexually with the possibility for mutation agents are represented by binary strings for convenience called genomes and groups of agents with identical genomes are called species each new species gets interactions with other species drawn from a distribution which is symmetric around zero the tangle of interactions connecting an agent to others determines its reproductive success with positive or mutualistic interactions leading to a higher relative reproduction rate i e higher fitness consequently interactions with positive sign become gradually more common as the system evolves the model provides a simple description of an ecosystem where agents vie for a constant flow of external resources as detailed below the ecosystem as such becomes gradually better at exploiting the incoming resources and the population of the ecosystem slowly increases extant species in the tnm can be grouped into a few highly populated core species connected by mutualistic interactions and numerous sparsely populated cloud species by definition core species have a population exceeding 5 of the most populous species and all species not belonging to the core belong to the cloud core species owe their reproductive success to the mutualistic interactions connecting them cloud species are sparsely and intermittently populated mainly by an influx of mutants from the core their interactions are distributed in the same way as those between new species in the tnm each dynamical trajectory is characterized by periods of metastability of growing length referred to as quasi evolutionary stable states qesss which mimic the punctuated equilibria of biological macroevolution eldredge and gould 1972 during a qess the composition of the core stays put and macroscopic quantities such as the total population fluctuate slightly around fixed plateau values the transitions between consecutive qesss are increasingly rare rapid and turbulent events called quakes which entail considerable rearrangements of the network structure becker and sibani 2014 i e in most cases a complete renewal of the core at a coarse grained level a tnm trajectory consists of a series of qesss each with a different core as the system ages cores on average gradually have stronger i e more positive mutualistic interactions and both the number of core species and the total population grow in the process becker and sibani 2014 positive interactions are responsible not only for the stability of a core but also for its eventual demise occasionally a mutant in the cloud is linked to the core by strong positive interactions and as a consequence its offspring grow rapidly this destabilizes the core and induces a quake old cores are those able to coexist with large clouds which do not threaten their survival to summarize the evolution of the tnm is a decelerating process where an increasing structural organization can be identified furthermore tnm evolution can be seen as a spontaneous process associated to an increase of configurational entropy becker and sibani 2014 andersen and sibani 2016 this makes the model well suited to investigate how entropy and structural organization are connected 3 tnm implementation as mentioned the tnm s elementary variables are binary strings of length k i e points of the k dimensional hypercube each point represents a genome and is populated by a varying number of individuals the abundance of that genome simulation time is given in generations prior to starting the simulations values for the couplings j ab between any two genomes a and b are created to this end three fixed arrays of length 2 k i f 1 and f 2 are utilized the first contains ones with probability p interaction 1 4 and zeros otherwise the other two contain random numbers drawn from a gaussian distribution with zero mean and unit variance the genomes of a and b are first xored to produce a new binary string c the binary strings can now be read as integer labels whenever needed and the coupling j ab is zero if and only if i c 0 otherwise j ab gf 1 c f 2 b where g is a constant reproduction probabilities in the tnm are calculated as follows let e denote the set of all extant species or ecosystem let n b t denote the population size of species b at time t and n t e n b t the total population size an individual of type a is chosen as candidate for reproduction with probability n a n a n and successfully reproduces with probability p off a 1 1 e h a where 1 h a t μ n t b j ab t and where 2 j ab n b n j ab j ab n b is a density weighted coupling in eq 1 μ is a positive constant which limits the size of the ecosystem at each successful reproduction step a point mutation in the offspring occurs with probability of mutation per bit by p mut parent and offspring then differ by k bits with probability bin k k p mut the binomial distribution natural death occurs with probability p kill 4 structure order and organization landsberg 1984 formally decouples disorder and entropy by comparing s the realized entropy of a system subject to structural or other constraints and s max the entropy of the system with the constraints removed he defines the disorder of the system to be the ratio s s max and the complementary notion of 3 order 1 s s max building on layzer s 1977 work concerning information in physical and biological systems brooks and wiley 1986 explore by way of several phenomenological examples this decoupling of entropy and disorder to demonstrate the sense in which various constraints on a system can keep the realized entropy of the system below the maximum possible entropy they focus on the difference rather than the ratio to define 4 organization s max s and they identify the complexity of the system with the realized entropy s fig 1 5 configurational entropy calculation of entropy s in statistical mechanics configurational entropy is the portion of a system s entropy that is related to the position of its constituents rather than to their velocity or momentum in a biological sense this can be interpreted as the spatial heterogeneity of constituents in genomic space functional space physical space etc the boltzmann entropy of roach et al 2017 is used to calculate the entropy of the tnm during qesss over the model s evolutionary course this configurational entropy is derived from a count of the number of ways the progeny of the core can be produced within the gene space of potential species in a way consistent with the reproduction and mutation characteristics of a qess in the tnm in short the following equation was used 5 s ln k 0 k nf k nc k 1 nf k to calculate the realized entropy s of a qess where k is the genome length n is total number of individuals n is the number of core species k is the number of distinct mutated positions in the genome f k is the fraction of progeny with k mutations and c k is the total number of k mutated sites around a core species 6 calculation of s max to calculate s max consider a hypothetical system consisting of n individuals as before but these individuals are not organized into core and cloud the corresponding configurational entropy s max is then derived from a count much larger than above namely one which describes the number of ways of distributing n indistinguishable individuals into the 2 k distinguishable sites in the hypercube in that case 6 s max ln 2 k n 1 n n 1 ln 2 k n n 2 k where the expression on the right is based on the stirling approximation and the assumption 2 k n for the case n 500 s max 4320 7 in silico simulations and results an ensemble of 800 independent tnm simulations were run with parameters initial population contains 500 identical agents environmental harshness μ 0 1 interaction coupling strength g 100 genome length l 20 probability of being connected by interactions p interaction 0 25 probability of death p death 0 2 probability of mutation p mut 0 01 snapshots were collected at 100 time points between t 100 and t 100 000 the resulting realized entropies s and maximum entropies s max are plotted in fig 2 where it is seen that the maximum entropy of the system grows at a faster rate than the realized entropy this creates an increasing macroscopic organizational structuring through the evolution of the ecosystem which has been plotted in fig 3 top panel the emergent order of the system has also been plotted over time and it is notable that the order remains relatively constant although it does have a slope which is significantly greater than zero b 0 000581 p 0 0128 8 discussion and conclusion using the tnm allows one to investigate how underlying stochastic dynamics can lead to emergent macroscopic structuring in nonequilibrium systems the observations from the model were used to calculate empirical entropies during qesss over evolutionary courses of the model these calculations reveal that the growth of entropy leads to a concomitant increase in organization and order another indicator of structuring in the system may be the per capita entropy s n as previously shown by roach et al 2017 the clear decrease in this quantity is perhaps the best source of understanding why structuring occurs s increases but s n decreases entropy grows due to the growth of population however the per capita s decreases as a result of the emergent structuring of the system this entropically driven generation of order organization and complexity has been purported to be characteristic of evolving biological systems toussaint and schneider 1998 schneider and kay 1995 at many scales however the quantitative treatment of this claim has been limited by the difficulty in calculating an absolute entropy and maximum entropy in real evolutionary ecosystems the data shown here from the tnm simulations demonstrate that these proposed features of real biological systems are recapitulated as properties that emerge from underlying stochastic processes it is also interesting that there is a decelerating rate of entropic change between qesss as time progresses this decelerating rate of entropy change has also been proposed to be a common characteristic of general evolution i e both biotic and abiotic evolution prigogine and stengers 1984 but has lacked extensive empirical testing at the species and ecosystem level the tnm provides a useful model to begin testing this hypothesis of diminishing entropic change over evolutionary time as complexity science and systems biology continue to highlight the integrated nature of biology and physics interdisciplinary approaches which combine the mathematical rigor of thermodynamics with the descriptive power of ecological and evolutionary theory are needed to fully understand the mechanisms involved in the generation of biological organization and order although more accurate and descriptive models will continue to advance theory concerning the role of thermal physics in biology ultimately these theoretical predictions must be tested using real biological data thus future work should not only concentrate on developing better models but should also focus on analyzing real biological systems that are amenable to calculating both realized and maximal entropies in order to elucidate the exact role of entropy in biological processes acknowledgements this work was supported by the national science foundation funding provided to t n f r nsf division of graduate education g00009988 the authors would like to thank mark little nate robinett ana cobian guemez sandi calhoun and douglas naliboff for their reading of the manuscript and thoughtful insight during the writing process 
25077,although the famous competition exclusion principle was thoroughly elaborated in the framework of multispecies population models its illustrations with field data were facing certain obstacles the data we deal with were collected by 6 consecutive examinations of bilberry vaccinium myrtillus and cowberry v vitis idaea presence absence in 20 20 cm quadrats located along permanent transects in a scots pine boreal forest these data feature a great sample size 2000 quadrats 6 examinations and a 5 year interval for each pair of examination re examination and the data have enabled us to construct a markov chain model for the fine scale dynamics of these dominant species at the later stages of post fire succession the discrete time nonautonomous model consists of the five time dependent one step transition matrices that describe changes occurring in the quadrat status for the 5 years in the following 4 terms species free quadrat bilberry alone cowberry alone both species calibrated on the data each one step transition matrix transforms the current distribution of quadrats among their statuses exactly to the next one observed and yields a steady state distribution as its time specific positive eigenvector step by step variations in the elements of transition matrices do affect the components of the corresponding eigenvectors but do not change the dominance relationships among them calculated as the 5 th power matrix root from the product of those five transition matrices in the chronological order within their product the geometric average treated again as a transition matrix provides for the spatial and temporal characteristics of the observed dynamics summarizing the whole observation period we reveal the expected terminal stable outcome of species dynamics to be a distribution where 37 of quadrats are occupied by the bilberry alone 11 by cowberry alone 38 by the both species and 14 be species free it is shown for the first time that the share of cowberry alone quadrats decreases notably in the course of succession whereas the share of species coexistence quadrats increase the averaged characteristics of cyclicity and status duration in the fine scale dynamics enable us to estimate the total time of the secondary post fire succession as 46 50 years till reaching a distribution close to the terminal one of the four statuses considered the cowberry alone quadrats have the least mean duration time 9 years while the bilberry and cowberry quadrats have the longest time 18 years which are explainable by different life spans of the shoots in proper species keywords post fire succession vaccinium myrtillus vaccinium vitis idea markov chains stochastic matrix nonautonomous model matrix average fundamental matrix cyclicity indices 1 introduction since lotka 1925 and volterra 1926 1931 times the phenomena of competitive exclusion and coexistence have been studied in theoretical ecology for almost a century mostly in the framework of multispecies models for population dynamics rescigno and richardson 1965 levin 1970 may 1974 scudo and ziegler 1978 yodzis 1978 armstrong and mcgehee 1980 hofbauer et al 1987 logofet 1993 cushing and levarge 2004 elsewhere in the population equations certain mechanisms contributing to the dynamics such as birth death processes self regulation and species interactions are represented by the corresponding linear nonlinear terms of various parameterizations while the conditions of species coexistence exclusion are analytically obtained as certain constraints on model parameters in particular on the competition coefficients on the way from models to nature however the verification of those conditions in the field faces certain obstacles both in theory abrams 1979 hallett and pimm 1979 and practice emlen 1981 moore et al 1996 and refs therein under these circumstances the opposite methodic way from field observations to a phenomenological model looks like an attractive alternative and this is the way we go in this study via constructing a model of the markov chain type which has long been known for its immanent phenomenological nature jeffers 1978 ch 5 it would hardly be possible to comprehend cause effect mechanisms of plant community dynamics and stability with ignoring any process description at the fine scale where the size of observation plots is comparable with the size of individuals not exceeding a few square decimetres how long the microsites are retained by different species and how fast the species move within the community with the different plants replacing one another determine the global community characteristics such as the species diversity patch diversity and succession status maslov 2001 the dynamics of interspecific relations between the dominant species of similar life forms and ecologies are especially important in this regard as the fine scale turnover represents one of the mechanisms of ecological niche partition van der maarel and sykes 1993 rydin and barber 2001 barot and gignoux 2004 mudrák et al 2016 the bilberry vaccinium myrtillus and cowberry v vitis idaea ericaceae are common and often co dominant dwarf shrubs in boreal forests where ground fires represent a common factor of periodic disturbances goldammer and furyaev 1996 these species are characterized by very similar ecological requirements makipaa 1999 which raises the question as to the mechanisms of their ecological niche partition both species have wide ecological distributions and can grow in many communities from moistforest raised bogs to dry pine forests on rock outcrops grime et al 1988 rysin 2009 bilberry and cowberry grow together at different levels of spatial organisation from the microsites to the global scale maslov 1990 p 95 where both species are diagnostic for vaccinio piceetea class of boreal forests in the floristic classification system review in spribille and chytrý 2002 according to grime et al 1988 p 592 the similarity of habitats is 83 for these two species there exist a few published samples where markov models are used in the study and modelling of successions in forests at the community level knyazkov et al 1992 rego et al 1993 vinogradov and shitov 1994 logofet and lesnaya 2000 see reviews in balzter 2000 and logofet 2010 less rare are those where markov models are applied at the tree by tree replacement level horn 1975 acevedo 1981 a review in acevedo et al 1995 or at the fine scale hobbs 1984 samoylov and tarkhova 1985 wootton 2001 hill et al 2004 baasch et al 2010 as a preliminary attempt to model the fine scale dynamics of bilberry and cowberry we constructed a time homogeneous autonomous markov chain and derived the major results including the steady state distribution of states and temporal characteristics of the process based on the data from two consecutive observations maslov and logofet 2016 however the same kind of data are also available from 6 observations during 25 years which makes it possible to do the same for five pairs of examination re examination bearing in mind that the results may differ in formal terms it means that the transition matrix p t of the markov chain depends on the year t of examination or the chain is inhomogeneous or time dependent as it was in other projects with markov models of succession usher 1981 knyazkov et al 1992 logofet et al 1997 benabdellah et al 2003 logofet 2010 logofet et al 2016 or landscape dynamics baker 1989 vinogradov et al 1989 li 1996 wang and zhang 2001 yemshanov and perera 2002 chuang et al 2011 inevitable differences in the time dependent transition matrices occur because of fluctuations in species abundances caused either by weather factors or by disturbances of various kinds including phytophagan impacts another reason for the difference in transition matrices may be a trend in the changes of key environmental factors such as the temperature and moistening ones for primary succession in the forest steppe zone logofet et al 1997 logofet and denisenko 1999 varying with the climate change studying the small scale dynamics of dominants in the scots pine boreal forest we accept the hypothesis of random variability for the matrices p t so that the following issues arise a the task to compare the steady state limiting probability distributions of site states for different pairs of consecutive examination re examination and b the question of how to obtain quantitative characteristics of the process which summarize all 25 years of observations searching for the answer to question b leads to the concept of averaged matrix the issues of averaging nonnegative matrices have not received much attention in ecological literature the existence of an average matrix is just postulated in theoretical constructions see e g tuljapurkar 1990 caswell 2001 while in practical applications authors find the averaged matrix as the arithmetic mean by default logofet 2013 not caring about the sense of averaging meanwhile the meaningful sense of averaging ensues from the idea that the average matrix should give exactly the same distribution of states in the final observation of the entire period as the time inhomogeneous or non autonomous in a more general context model this implies the geometric kind of averaging ibidem logofet et al 2017 2018a b given a number of nonnegative matrices in particular stochastic ones the mathematical problem to geometrically average them faces a methodical difficulty it does not in general have any exact solution logofet et al 2017 2018a b and then an approximate solution comes to the rescue ibidem however the particular case of a complete graph of transitions maslov and logofet 2016 fig 2 allows us to hope for an exact solution of the averaging problem the present study aims at revealing trends in the fine scale dynamics of the two dominant species bilberry v myrtillus and cowberry v vitis idaea with similar ecologies by means of a time inhomogeneous markov chain model our tasks include to analyse differences in the limiting distributions of state probabilities obtained from five different transition matrices to develop an algorithm for calculating the average matrix and to calculate the limiting probability distribution of states and other characteristics in the averaged model 2 study area and sampling design the study area was located in a scientific forest reserve in the northern part of the moscow region scots pine pinus sylvestris dominates all over the area with a mixture of norway spruce picea abies and silver birch betula pendula the soils are poor fluvioglacial sands permanent sample plot of 50 m 40 m was established in a badly drained polytrichum myrtillus type scots pine forest the stand originated after a massive windfall in 1923 and still has clear signs of old windfall pits and mounds in 1954 the stand was affected by a ground fire of moderate intensity the field layer largely consists of vaccinium myrtillus and v vitis idaea while the other plant species are represented by single individuals the ground layer is dominated by polytrichum commune pleurozium schreberi and sphagnum fallax maslov 1990 abundances of dominant tree species were not changing much during the observation period the basal area of scots pine was 36 9 m2 ha in 1980 and 36 3 in 2005 while the birch basal area had the same value of 2 1 m2 ha in both years rooted presence of aerial shoots rooted frequency was recorded for all plant species on adjacent quadrats of 20 cm 20 cm fig 1 situated in 8 parallel transects each of 50 m long maslov 1989 the total number of quadrats was 2000 fallen logs tree trunks and large branches on the soil surface were also recorded in terms of presence absence the observations continued over 25 years from 1980 to 2005 with the 5 yr interval between re examinations the total sample size was originally equal to 2000 6 12 000 quadrats however the eventual sample does no longer contain quadrats with trunks and those with fallen logs in any year of observation which enables us to eliminate the effects of spatial exclusion and disturbance we also exclude the quadrats that remained free over the whole period of observation amounting to 4 of the total sample size almost all such quadrats have turned out to be located in deep windfall pits the pits are sporadically filled with ground water thus becoming inappropriate for the growth of any species under study as a result of this two step selection by excluding the dip pits and quadrats with fallen logs and trunks the eventual number of quadrats has decreased from 2000 to 1376 thus remaining constant in each of examinations 3 markov chain as a model of fine scale dynamics if we denote the presence of bilberry in the quadrat by letter v of cowberry by w then in the two species system we have only four possible states in which any quadrat may be at any time 1 both species are absent species free state 2 bilberry v 3 cowberry w 4 both species are present vw defined so the states of the quadrat are naturally identified with those of a markov chain and the model state variables are represented by finite probability distributions x t of chain states at the moment of observation t 1980 1985 2005 the markovity postulate means that the probability distribution of transitions from every state s s v w vw to any other states including the s itself is determined entirely by the current state s and does not depend on the way the chain has come to this state it follows from the a priori biological knowledge confirmed by the data table 1 that all kinds of transitions are possible in nature between each pair of the four listed states if we accept the markovity postulate and simplifying enumeration of states as 1 2 3 4 then the transition scheme represents a complete directed graph shown in fig 2 where the arcs are leading from every node j 1 4 of the graph to every other one and the same node corresponding to the given digraph a discrete markov chain describes the changes in the stochastic column vector x t x x v x w x vw t obeying the following equation 1 x t δt p t x t t 1980 1985 2000 the element pij t of the transition matrix p t pij t i j 1 4 is the probability of transition from state j to i for one time step δt 5 years each pij t is calculated as the frequency of the corresponding transition recorded in the data of two consecutive years of observation t and t 5 table 2 altogether they reflect a relative speed of the species substitution process in quadrats and are logically changing from examination to re examination as so are the very data random processes where transition probabilities depend on time are called inhomogeneous hazewinkel 1990 vinogradov et al 1989 vinogradov shitov 1994 logofet et al 1997 the diagonal elements p11 p44 of the transition matrix p p 11 p 12 p 21 p 22 p 13 p 14 p 23 p 24 p 31 p 32 p 41 p 42 p 33 p 34 p 43 p 44 are the probabilities that the chain remains in the same state for a given step so that the sum of all the probabilities pij over the column j is the probability of retaining state j or transiting to another state i e of the total event thus equalling 1 such matrices are called stochastic gantmacher 1967 p 381 in the spectrum of any stochastic matrix i e in the set of its eigenvalues there is always a positive dominant i e the largest in absolute value eigenvalue λ1 1 and there exists a corresponding positive eigenvector ibid x x1 x2 x3 x4 t hence there always exists a solution to the equation 2 p x x x 0 when normalized by the condition x 1 x 2 x 3 x 4 1 or 100 the solution x is an equilibrium according to eq 2 probability distribution of chain states governed by the transition matrix p it is also what successive distributions x t converge to as the number of steps increases while matrix p remains constant in time 3 p t x 0 x as t logofet and belova 2008 logofet 2010 and it does so for any feasible initial vector x 0 ibidem these features of the equilibrium distribution x justifies calling it the limiting or steady state distribution once matrix p t has been calculated from the data of successive examinations at the years t and t δt it bears together with the corresponding vector x an implicit characteristic of those biotic and abiotic conditions that have occurred in the interval from t to t δt and effected the picture of transitions in the process under observation therefore it is of interest how much the current distribution x t differs from the steady state x and it is measured by the keyfitz index of dissimilarity keyfitz 1968 p 47 4 δ x x t 1 2 j 1 n x j x j t where n is the vector dimension the index values vary from 0 when the vectors are equal to 1 or 100 the maximal dissimilarity being achieved by singular distributions concentrated in different vector components thus the measure of actual difference is expressed as a share or percentage of the greatest possible dissimilarity 3 1 calibration method the nature of the available data namely repeated observations on permanent transects in combination with a large sample size provides the ability quite rare in ecology to calculate all the model parameters in a unique and reliable mode the parameters are 16 transition probabilities pij from eq 1 more accurately 12 transition probabilities plus the 4 of retaining the current state pjj for one step we judge of the probabilities by the actual picture of transitions table 1 and calculate the probability as the frequency of the transition or retention event table 2 then five calibrating eqs 1 hold automatically true it means that the calibration is accurate to the extent to which the frequencies do approximate the probabilities in our case so that the method does not lead to any loss of information 3 2 averaging the transition matrices since the final sample was formed in such a way that the total number of quadrats remained unchanged in each observation eq 1 implies that 5 x 2005 p 2000 p 1995 p 1990 p 1985 p 1980 x 1980 where all the vectors x t and matrices p t are calculated from table 1 while each of the matrices p t characterizes indirectly its own 5 year interval to characterize the total observation period we need an average of the 5 matrices and eq 5 does prompt the way how to find the average indeed the essential meaning of averaging follows from the idea that the average matrix g must give exactly the same result on the entire observation period that the inhomogeneous model or nonautonomous model in a general context does in our case the model outcome from the whole period should be the distribution of states in 2005 the year of the last sixth examination i e the result of transforming successively the initial distribution vector x 1980 into the vector x 2005 in accordance with eq 5 see also eq 7 in logofet et al 2017 it means that matrix g when raised to the 5th power ought to yield the product of the matrices in the right hand side of eq 5 6 g 5 p 2000 p 1995 p 1990 p 1985 p 1980 ibidem eq 8 wherefrom the true sense of g ensues to be geometric also the pattern of the mean matrix must be the same as that of the matrices p t to be averaged i e without zero elements hence corresponding to the complete transition digraph so the number of unknown entries to matrix g equals 4 4 16 and it coincides with the number of element wise equations inside of the matrix eq 6 which therefore becomes exactly solvable this lucky situation contrasts to those with population projection matrices logofet et al 2017 2018a b logofet 2018 where the life cycle graph cannot be complete due to biology constraints hence the averaging equation cannot have any exact solution the product of any number of stochastic matrices preserves the stochastic property which the matrix g must possess too if it exists as the solution of eq 6 and is positive like all the cofactors on the right hand side of 6 with the exception of p 1995 in this case it also serves as the transition matrix of the corresponding markov chain and this chain is by construction homogeneous in time its characteristics reflect the properties of the process under study throughout the whole observation period these include the steady state distribution x of the chain state probabilities mentioned above the mean time mj to the change of state j and the mean state i first passage time starting from state j the all being calculable by the standard formulae of markov chain theory kemeny and snell 1976 together with the mean duration mj of each j th state the mean first passage times are the time characteristics of the random process expressed in the number of steps given the known magnitude of the time step these characteristics are also expressed in chronological units years mathematical details of the computations are presented in appendix a 4 results 4 1 transition matrices calculated for each pair of successive observations in accordance with table 1 the transition matrices are presented in table 2 their elements transition probabilities found as the frequencies of the corresponding events are shown in the form of rational numbers for the sake of clarity without reduction to the proper fractions of the 80 entries to all the five transition matrices only one element p 14 in the transition matrix p 1995 has turned out zero which confirms the assumption that all theoretically possible transitions between states do occur in each of the 5 year intervals between the observations also this indicates a correct choice of the time step length and the number of sample quadrats all the transitions have been realized in the community for every 5 years which confirms the completeness of the transition digraph maslov logofet 2016 fig 2 4 2 steady state distributions of state probabilities each of the matrices in table 2 features its own steady state or limiting vector x of the state probability distribution found as the solution to eq 2 thus illustrating the idea of inhomogeneity so the steady state proportion of quadrats occupied by bilberry alone varies from 19 5 to 44 8 for different transition matrices and that by two species varies from 18 5 to 56 1 however comparing thoroughly the obtained steady state vectors shows them being qualitatively quite similar for instance the largest shares of quadrats in all five vectors are those with bilberry alone or with bilberry and cowberry growing together the share of quadrats with cowberry alone varies insignificantly as far as 4 out of 5 values are in the range of 12 13 thus fluctuations in the number of shoots from examination to re examination have a significant effect on certain elements of transition matrices and components of steady state vectors but do principally not change the conclusions about the states that dominate in the limiting distributions to see a degree of inhomogeneity in the markov process we compare the steady state distributions corresponding to different one step transition matrices by means of keyfitz index of dissimilarity table 3 if the chain were homogeneous all the indexes would be zero in table 3 the closer are values to 100 the more different are the matrices and the more inhomogeneous is the process the average of 10 nonzero values index turns out to amount roughly 24 which indicates a moderate level of inhomogeneity however the maximal index of dissimilarity reaches the value of 39 7 which reveals essential changes in transition probabilities between the years of 1995 and 2000 fig 3 demonstrates how much the outcome of modelling may differ when derived from a sole transition matrix when only two field observations are available modelling versions a and b correspond to the two transition matrices 1985 1990 and 1995 2000 that are the most distinct according to table 3 in fig 3a we notice a decrease in the number of quadrats with two species and a noticeable increase in the share of species free quadrats in the second case fig 3b the number of species free quadrats decreases while the number of those with two species notably increases looking ahead we note that these figures are quite close to the results of the averaged model 4 3 the average of transition matrices in theory solution to the mathematical averaging problem does exist due to the transition digraph being complete fig 2 in practice however there occur computational difficulties which can be overcome due to the options proposed by modern software such as matlab appendix b table 4 shows the outcome of averaging the 5 transition matrices and the corresponding steady state distribution x g of quadrats among the four possible states the steady result of succession after averaging the fluctuations is thus expected to distribute the quadrats among the states in such a way that 37 of quadrats are occupied by bilberry alone 11 by cowberry alone both species are expected on 38 of quadrats and 14 to be species free in the steady state the quadrats dominate in almost equal shares where bilberry grows alone and where bilberry coexists with cowberry table 5 shows how much the distribution x g differs from those observed in the successive years of observations by means of keyfitz index of dissimilarity and fig 4 gives an idea of how fast the initial distribution x 1980 converges to x g by five year steps we see that the components of the initial distribution approach rapidly the steady state values the distribution in 2000 differing from the steady state one by only 5 3 and it practically coinciding with the steady state dissimilarity 0 7 in 2005 the final year of observation this gives evidence that the process is globally unidirectional in spite of it being locally omnidirectional transition to every state is probable by the associated digraph fig 2 from the quadrat at any time 4 4 how long states keep unchanged and the process cyclicity the matrix t of first passage times for every state from every other contains the corresponding times expressed in the numbers of time steps table 4 and with due regard to the step length δt 5 years they are expressed approximately as shown in table 6 for example it takes 82 years on the average to achieve state w from v and 29 years in the opposite direction these figures reflect altogether the cyclicity of the random rather than deterministic process where the common period of deterministic oscillations makes no longer sense so different states recur in different average years from 13 to 45 see diagonal cells in table 6 while the species free quadrats reach state w for average 62 years and state vw for 36 years approximated from the proper column of table 4 the mean durations of states are given in the last line of table 6 we notice that the state of species coexistence persists for the longest time in contrast to what followed earlier maslov and logofet 2016 table 2 from a particular one step transition matrix 1985 1990 alone but the averaged model shows like the former single step one does ibidem significant differences in the mean duration between the bilberry state 15 years and the cowberry state 9 years thus the time of the secondary post fire succession reaching a distribution different from the steady state one by less than 5 is in the interval of 46 50 years 26 years from the year of the ground fire to the first examination in 1980 plus 4 5 five year model steps this result is close to that obtained form a one step transition matrix 45 years maslov and logofet 2016 as follows from fig 4 the share of v quadrats and that of vw quadrats are increasing in the course of succession on the contrary the share of species free quadrats and that of w quadrats are decreasing however if we consider the dynamics of each species individually which are traditionally analysed in population studies then the quadrats with bilberries are absolutely predominant in the steady state since they account for 37 38 75 of the quadrats fig 5 in spite of the notable decrease in the share of cowberry alone quadrats the total share of cowberry does non decrease in the course of succession but rather increases from 45 16 29 in 1980 table 5 to 49 11 38 in the steady state table 4 5 discussion a large number of the mechanisms by which species can avoid competition have been reported in the literature for a list of 120 such mechanisms see palmer 1994 and most of them involve spatial temporal or resource partition amarasekare 2003 in contrast to deductive theoretical models where the mechanisms are postulated the inductive ones such as the markov chain models of succession or fine scale vegetation dynamics avoid postulating any mechanisms except for a technical one such as the markovity assumption to provide for a formal and objective description of the reality under study the description leads to a calibrated model which yields the quantitative characteristics of the process that could hardly be obtained without the model in our present case these are the limiting distribution of species specific state among quadrats and cyclicity indices for the fine scale two species dynamics obtained from the time averaged model thus summarizing the 25 year period of observations as noted in the introduction the issues of matrix averaging have not been properly addressed in ecological literature exploited in the given study the idea to geometrically average several given stochastic matrices has been prompted by the concept of pattern geometric average developed recently for matrix population models logofet 2018 and refs therein when no constraints are imposed on the pattern of the average matrix g i e on the solution of eq 6 then the problem to average geometrically the five given stochastic matrices is mathematically equivalent to the standard extraction of the 5 th power root from their product whereby the problem may have several solutions gantmacher 1967 higham and lin 2009 mcdonald et al 2014 however the practical sense behind the averaging problem does impose certain mathematical constraints and those are in our case the conditions of matrix g being column stochastic as far as it has to be the transition matrix of a markov chain in other cases such as nonautonomous matrix population models the average matrix has to be of a fixed nontrivial pattern matching the life cycle graph and to locate within given quantitative bounds logofet et al 2017 2018a b logofet 2018 then the corresponding analogue of eq 6 is deprived of any exact solution and the solution we search for is an approximate one yet with a high approximation accuracy ibidem in fact the geometric average of stochastic matrices is a particular case of the pattern geometric average in which the matrix pattern is complete fig 2 hence all the matrices being positive 1 1 single exlusion of p 14 0 in the transition matrix p 1995 has not spoiled the solving technique as the lower bound for g 14 was zero too see b5 in appendix b while g 14 0 in the solution therefore the solution we have found in our case turns out to be rigorous table 4 hence the results obtained from matrix g tables 4 6 are reliable although the practical extraction of the matrix root faces certain computational problems appendix b stochastic nature of the markov model enables us to reconcile the seemingly contradictory categories such as the directionality and cyclicity in the fine scale dynamics the directionality is revealed after averaging the one step transition matrices as the convergence decreasing keyfitz index of dissimilarity of the initial distribution x 1980 of quadrat state probabilities to the steady state or limiting vector x g table 5 the cyclicity is demonstrated by the mean state duration times before the state changes and the mean recurrence times for the same state table 6 mean recurrence times characterize the species cycle in the quadrat and they differ markedly between bilberry 13 years and cowberry 45 years significant differences in the periods of the fine scale turnover were revealed earlier maslov 2001 figs 2 and 3 in a myrtillus type pine forest where the bilberry was classified as a species with low mobility rate and the cowberry as that with moderate high mobility however species populations were studied independently of each other in that study so that nothing was known about how the share of quadrats with co growing species was changing the conclusion that bilberries grow longer on the same quadrats maslov 2001 correlates well with the results of table 6 concerning the mean state duration which is greater in bilberry 15 years than that in cowberries 9 years these differences can be partly related to the average age of ramets which according to the literature is 3 5 years in cowberry and 5 8 years in bilberry reviews in balandina and vakhrameeva 1978 1980 however the v and w states can end in the transitions to the wv state species coexistence and the longer time for bilberry returning to state v bilberry alone is explained by the process trend of transitioning to the state where both species coexist 6 conclusion inhomogeneous markov model of the fine scale dynamics in bilberry vaccinium myrtillus and cowberry v vitis idaea two species dominating the field layer at the later stages of post fire succession describes the data of 25 year observation with the absolute accuracy together with the averaged homogeneous version the both models provide for the objective spatial and temporal characteristics of the observed process thereby revealing its directionality and cyclicity although fluctuations in species abundances from examination to re examination effect drastically certain entries to the transition matrix and the corresponding steady state vector they do principally not change the conclusions on the dominating vector components i e on the dominating states among the quadrats as the terminal steady state result of the fine scale dynamics the distribution of quadrats is expected such that 37 of quadrats are occupied by bilberry alone 11 by cowberry alone 38 by both species and 14 of quadrats being species free the temporal characteristics ensuing from the averaged model of fine scale dynamics enable estimating the total duration of the secondary post fire succession as 46 50 years needed to reach a distribution that differs from the steady state one by less 5 both the inhomogeneous markov chain of five transition matrices p t and its averaged version with the homogeneous matrix g do provide just a phenomenological view of the fine scale dynamics and do not suggest any deep insight into their cause effect mechanisms however such a model can help to pinpoint areas where such insight would be valuable jeffers 1978 p 92 we have demonstrated for the fist time that the share of cowberry alone quadrats was notably decreasing in the course of succession whereas the share of coexistence quadrats was increasing this conclusion a priori not apparent but an important one acts both as a guide and stimulus to further research ibidem of what the real cause effect mechanism of interspecies relations occurs between bilberry and cowberry at the fine scale on a small quadrat of the 20 20 cm size acknowledgement we are grateful to the anonymous reviewer whose competent critique improved the ms of original submission appendix a expected time to change the state and the mean first passage times there is a fundamental relationship known between the mathematical expectation mj of the random number of steps after which state j changes and the corresponding diagonal element pjj of the transition matrix i e the probability that the chain remains in state j for one step a1 pjj 1 1 mj j 1 4 kemeny and snell 1976 thereby the mean duration of state j before it changes equals a2 mj 1 1 pjj j 1 4 the mean first passage times tij are also expressed in step numbers and collected into the matrix a3 t d i z z dg e where d diag djj is the diagonal matrix with the elements djj 1 xj j 1 4 in the diagonal i diag 1 1 1 1 e is the matrix whose all elements are equal to 1 z i p x 1 is the fundamental matrix of the chain and z dg is the diagonal matrix formed by the principal diagonal of matrix z ibidem similar to matrix p and vector x the matrices x z and d hence the t after them are also amenable to precise calculation in rational numbers by means of computer symbolic algebra but numeric approximations of these matrices are quite sufficient to estimate the time characteristics of the markov chain appendix b solution to the averaging problem to search for the geometric mean of the five given matrices p t according to eq 6 is mathematically equivalent to extracting the 5th power root from their matrix product general approach to defining a function of the matrix argument gantmacher 1967 v 1 2 suggests the matrix root of degree p a 1 p of matrix a to be defined on the spectrum of a hence it reduces to extracting the root from the matrix eigenvalues ibidem viii 6 in the general case this problem is far from trivial even for nonnegative matrices and it may have many solutions or may not have at all higham and lin 2009 mcdonald et al 2014 a hope for the exact solution to exist in our case is due to the matrix p being positive all pij 0 the complete digraph of transitions while a sufficient condition is given by the following theorem theorem politi and popolizio 2014 theorem 1 let a be a real or complex matrix of order n with no eigenvalues on r the closed negative real semiaxis and let p be a positive integer then there exists a unique matrix x such that 1 x p a 2 the eigenvalues of x lie in the sector z π p arg z π p we refer to x as the principal pth root of a and write x a 1 p if matrix a is stochastic then its pth root preserves this property as any natural power p does ibidem the product of 5 stochastic matrices p t in the right hand side of eq 6 is inevitably positive and stochastic too with a positive spectrum b1 λ g 5 λ 0 1708 0 1443 0 1430 0 1150 0 3719 0 3904 0 3522 0 3589 0 1289 0 1053 0 1264 0 1049 0 3284 0 3599 0 3784 0 4212 1 0 0751 0 0016 0 0320 it means that matrix g 5 meets the theorem conditions its jordan normal form jnf is trivially diagonal so that we obtain the spectrum of matrix g by element wise extracting the 5th root from the right hand side of b1 b2 λ g 1 0 5958 0 2785 0 5025 exactly the same matrix v that provides the representation of g 5 via its jnf b3 g 5 v diag λ g 5 v 1 leads to the desired result via the spectrum b2 b4 g v d i a g λ g v 1 0 5251 0 1172 0 1470 0 0133 0 2531 0 6683 0 1293 0 1952 0 1734 0 0234 0 4631 0 0710 0 0483 0 1911 0 2606 0 7205 testing matrix b4 for eq 6 reveals the total error over all 16 matrix elements to equal 6 5848 10 16 though distinct from zero because of computer round off errors but too small to affect any conclusion note that calculating carelessly the matrix root by the matlab operation of raising matrix g 5 to the 1 5 th power which should theoretically yield the required matrix g returns quite a different wrong result eval prodp 1 5 ans 0 7023 0 6790 0 6777 0 6489 0 8205 0 8285 0 8116 0 8147 0 6638 0 6375 0 6612 0 6371 0 8003 0 8152 0 8234 0 8412 which is even not a stochastic matrix this malfunction is not specific for matrix b1 but has certain fundamental reasons politi and popolizio 2015 let mip and map be matrices composed of the respectively minimal and maximal elements of one step transition matrices p 1980 p 2000 in the corresponding places then following table 2 we have b5 mip 169 368 30 433 7 132 0 44 281 282 475 11 219 40 401 40 369 5 433 81 228 12 379 14 369 52 377 40 228 286 524 map 246 369 82 377 81 228 44 524 132 368 305 433 26 228 89 379 72 281 14 377 78 132 76 524 24 368 107 475 76 196 335 401 and we find out whether the average matrix g is located within these natural boundaries by the following logical commands mip g g map ans 1 1 1 1 1 1 1 1 1 1 1 1 1 1 0 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 it means that only one element g 23 out of all those in g exceeds its natural boundary 
25077,although the famous competition exclusion principle was thoroughly elaborated in the framework of multispecies population models its illustrations with field data were facing certain obstacles the data we deal with were collected by 6 consecutive examinations of bilberry vaccinium myrtillus and cowberry v vitis idaea presence absence in 20 20 cm quadrats located along permanent transects in a scots pine boreal forest these data feature a great sample size 2000 quadrats 6 examinations and a 5 year interval for each pair of examination re examination and the data have enabled us to construct a markov chain model for the fine scale dynamics of these dominant species at the later stages of post fire succession the discrete time nonautonomous model consists of the five time dependent one step transition matrices that describe changes occurring in the quadrat status for the 5 years in the following 4 terms species free quadrat bilberry alone cowberry alone both species calibrated on the data each one step transition matrix transforms the current distribution of quadrats among their statuses exactly to the next one observed and yields a steady state distribution as its time specific positive eigenvector step by step variations in the elements of transition matrices do affect the components of the corresponding eigenvectors but do not change the dominance relationships among them calculated as the 5 th power matrix root from the product of those five transition matrices in the chronological order within their product the geometric average treated again as a transition matrix provides for the spatial and temporal characteristics of the observed dynamics summarizing the whole observation period we reveal the expected terminal stable outcome of species dynamics to be a distribution where 37 of quadrats are occupied by the bilberry alone 11 by cowberry alone 38 by the both species and 14 be species free it is shown for the first time that the share of cowberry alone quadrats decreases notably in the course of succession whereas the share of species coexistence quadrats increase the averaged characteristics of cyclicity and status duration in the fine scale dynamics enable us to estimate the total time of the secondary post fire succession as 46 50 years till reaching a distribution close to the terminal one of the four statuses considered the cowberry alone quadrats have the least mean duration time 9 years while the bilberry and cowberry quadrats have the longest time 18 years which are explainable by different life spans of the shoots in proper species keywords post fire succession vaccinium myrtillus vaccinium vitis idea markov chains stochastic matrix nonautonomous model matrix average fundamental matrix cyclicity indices 1 introduction since lotka 1925 and volterra 1926 1931 times the phenomena of competitive exclusion and coexistence have been studied in theoretical ecology for almost a century mostly in the framework of multispecies models for population dynamics rescigno and richardson 1965 levin 1970 may 1974 scudo and ziegler 1978 yodzis 1978 armstrong and mcgehee 1980 hofbauer et al 1987 logofet 1993 cushing and levarge 2004 elsewhere in the population equations certain mechanisms contributing to the dynamics such as birth death processes self regulation and species interactions are represented by the corresponding linear nonlinear terms of various parameterizations while the conditions of species coexistence exclusion are analytically obtained as certain constraints on model parameters in particular on the competition coefficients on the way from models to nature however the verification of those conditions in the field faces certain obstacles both in theory abrams 1979 hallett and pimm 1979 and practice emlen 1981 moore et al 1996 and refs therein under these circumstances the opposite methodic way from field observations to a phenomenological model looks like an attractive alternative and this is the way we go in this study via constructing a model of the markov chain type which has long been known for its immanent phenomenological nature jeffers 1978 ch 5 it would hardly be possible to comprehend cause effect mechanisms of plant community dynamics and stability with ignoring any process description at the fine scale where the size of observation plots is comparable with the size of individuals not exceeding a few square decimetres how long the microsites are retained by different species and how fast the species move within the community with the different plants replacing one another determine the global community characteristics such as the species diversity patch diversity and succession status maslov 2001 the dynamics of interspecific relations between the dominant species of similar life forms and ecologies are especially important in this regard as the fine scale turnover represents one of the mechanisms of ecological niche partition van der maarel and sykes 1993 rydin and barber 2001 barot and gignoux 2004 mudrák et al 2016 the bilberry vaccinium myrtillus and cowberry v vitis idaea ericaceae are common and often co dominant dwarf shrubs in boreal forests where ground fires represent a common factor of periodic disturbances goldammer and furyaev 1996 these species are characterized by very similar ecological requirements makipaa 1999 which raises the question as to the mechanisms of their ecological niche partition both species have wide ecological distributions and can grow in many communities from moistforest raised bogs to dry pine forests on rock outcrops grime et al 1988 rysin 2009 bilberry and cowberry grow together at different levels of spatial organisation from the microsites to the global scale maslov 1990 p 95 where both species are diagnostic for vaccinio piceetea class of boreal forests in the floristic classification system review in spribille and chytrý 2002 according to grime et al 1988 p 592 the similarity of habitats is 83 for these two species there exist a few published samples where markov models are used in the study and modelling of successions in forests at the community level knyazkov et al 1992 rego et al 1993 vinogradov and shitov 1994 logofet and lesnaya 2000 see reviews in balzter 2000 and logofet 2010 less rare are those where markov models are applied at the tree by tree replacement level horn 1975 acevedo 1981 a review in acevedo et al 1995 or at the fine scale hobbs 1984 samoylov and tarkhova 1985 wootton 2001 hill et al 2004 baasch et al 2010 as a preliminary attempt to model the fine scale dynamics of bilberry and cowberry we constructed a time homogeneous autonomous markov chain and derived the major results including the steady state distribution of states and temporal characteristics of the process based on the data from two consecutive observations maslov and logofet 2016 however the same kind of data are also available from 6 observations during 25 years which makes it possible to do the same for five pairs of examination re examination bearing in mind that the results may differ in formal terms it means that the transition matrix p t of the markov chain depends on the year t of examination or the chain is inhomogeneous or time dependent as it was in other projects with markov models of succession usher 1981 knyazkov et al 1992 logofet et al 1997 benabdellah et al 2003 logofet 2010 logofet et al 2016 or landscape dynamics baker 1989 vinogradov et al 1989 li 1996 wang and zhang 2001 yemshanov and perera 2002 chuang et al 2011 inevitable differences in the time dependent transition matrices occur because of fluctuations in species abundances caused either by weather factors or by disturbances of various kinds including phytophagan impacts another reason for the difference in transition matrices may be a trend in the changes of key environmental factors such as the temperature and moistening ones for primary succession in the forest steppe zone logofet et al 1997 logofet and denisenko 1999 varying with the climate change studying the small scale dynamics of dominants in the scots pine boreal forest we accept the hypothesis of random variability for the matrices p t so that the following issues arise a the task to compare the steady state limiting probability distributions of site states for different pairs of consecutive examination re examination and b the question of how to obtain quantitative characteristics of the process which summarize all 25 years of observations searching for the answer to question b leads to the concept of averaged matrix the issues of averaging nonnegative matrices have not received much attention in ecological literature the existence of an average matrix is just postulated in theoretical constructions see e g tuljapurkar 1990 caswell 2001 while in practical applications authors find the averaged matrix as the arithmetic mean by default logofet 2013 not caring about the sense of averaging meanwhile the meaningful sense of averaging ensues from the idea that the average matrix should give exactly the same distribution of states in the final observation of the entire period as the time inhomogeneous or non autonomous in a more general context model this implies the geometric kind of averaging ibidem logofet et al 2017 2018a b given a number of nonnegative matrices in particular stochastic ones the mathematical problem to geometrically average them faces a methodical difficulty it does not in general have any exact solution logofet et al 2017 2018a b and then an approximate solution comes to the rescue ibidem however the particular case of a complete graph of transitions maslov and logofet 2016 fig 2 allows us to hope for an exact solution of the averaging problem the present study aims at revealing trends in the fine scale dynamics of the two dominant species bilberry v myrtillus and cowberry v vitis idaea with similar ecologies by means of a time inhomogeneous markov chain model our tasks include to analyse differences in the limiting distributions of state probabilities obtained from five different transition matrices to develop an algorithm for calculating the average matrix and to calculate the limiting probability distribution of states and other characteristics in the averaged model 2 study area and sampling design the study area was located in a scientific forest reserve in the northern part of the moscow region scots pine pinus sylvestris dominates all over the area with a mixture of norway spruce picea abies and silver birch betula pendula the soils are poor fluvioglacial sands permanent sample plot of 50 m 40 m was established in a badly drained polytrichum myrtillus type scots pine forest the stand originated after a massive windfall in 1923 and still has clear signs of old windfall pits and mounds in 1954 the stand was affected by a ground fire of moderate intensity the field layer largely consists of vaccinium myrtillus and v vitis idaea while the other plant species are represented by single individuals the ground layer is dominated by polytrichum commune pleurozium schreberi and sphagnum fallax maslov 1990 abundances of dominant tree species were not changing much during the observation period the basal area of scots pine was 36 9 m2 ha in 1980 and 36 3 in 2005 while the birch basal area had the same value of 2 1 m2 ha in both years rooted presence of aerial shoots rooted frequency was recorded for all plant species on adjacent quadrats of 20 cm 20 cm fig 1 situated in 8 parallel transects each of 50 m long maslov 1989 the total number of quadrats was 2000 fallen logs tree trunks and large branches on the soil surface were also recorded in terms of presence absence the observations continued over 25 years from 1980 to 2005 with the 5 yr interval between re examinations the total sample size was originally equal to 2000 6 12 000 quadrats however the eventual sample does no longer contain quadrats with trunks and those with fallen logs in any year of observation which enables us to eliminate the effects of spatial exclusion and disturbance we also exclude the quadrats that remained free over the whole period of observation amounting to 4 of the total sample size almost all such quadrats have turned out to be located in deep windfall pits the pits are sporadically filled with ground water thus becoming inappropriate for the growth of any species under study as a result of this two step selection by excluding the dip pits and quadrats with fallen logs and trunks the eventual number of quadrats has decreased from 2000 to 1376 thus remaining constant in each of examinations 3 markov chain as a model of fine scale dynamics if we denote the presence of bilberry in the quadrat by letter v of cowberry by w then in the two species system we have only four possible states in which any quadrat may be at any time 1 both species are absent species free state 2 bilberry v 3 cowberry w 4 both species are present vw defined so the states of the quadrat are naturally identified with those of a markov chain and the model state variables are represented by finite probability distributions x t of chain states at the moment of observation t 1980 1985 2005 the markovity postulate means that the probability distribution of transitions from every state s s v w vw to any other states including the s itself is determined entirely by the current state s and does not depend on the way the chain has come to this state it follows from the a priori biological knowledge confirmed by the data table 1 that all kinds of transitions are possible in nature between each pair of the four listed states if we accept the markovity postulate and simplifying enumeration of states as 1 2 3 4 then the transition scheme represents a complete directed graph shown in fig 2 where the arcs are leading from every node j 1 4 of the graph to every other one and the same node corresponding to the given digraph a discrete markov chain describes the changes in the stochastic column vector x t x x v x w x vw t obeying the following equation 1 x t δt p t x t t 1980 1985 2000 the element pij t of the transition matrix p t pij t i j 1 4 is the probability of transition from state j to i for one time step δt 5 years each pij t is calculated as the frequency of the corresponding transition recorded in the data of two consecutive years of observation t and t 5 table 2 altogether they reflect a relative speed of the species substitution process in quadrats and are logically changing from examination to re examination as so are the very data random processes where transition probabilities depend on time are called inhomogeneous hazewinkel 1990 vinogradov et al 1989 vinogradov shitov 1994 logofet et al 1997 the diagonal elements p11 p44 of the transition matrix p p 11 p 12 p 21 p 22 p 13 p 14 p 23 p 24 p 31 p 32 p 41 p 42 p 33 p 34 p 43 p 44 are the probabilities that the chain remains in the same state for a given step so that the sum of all the probabilities pij over the column j is the probability of retaining state j or transiting to another state i e of the total event thus equalling 1 such matrices are called stochastic gantmacher 1967 p 381 in the spectrum of any stochastic matrix i e in the set of its eigenvalues there is always a positive dominant i e the largest in absolute value eigenvalue λ1 1 and there exists a corresponding positive eigenvector ibid x x1 x2 x3 x4 t hence there always exists a solution to the equation 2 p x x x 0 when normalized by the condition x 1 x 2 x 3 x 4 1 or 100 the solution x is an equilibrium according to eq 2 probability distribution of chain states governed by the transition matrix p it is also what successive distributions x t converge to as the number of steps increases while matrix p remains constant in time 3 p t x 0 x as t logofet and belova 2008 logofet 2010 and it does so for any feasible initial vector x 0 ibidem these features of the equilibrium distribution x justifies calling it the limiting or steady state distribution once matrix p t has been calculated from the data of successive examinations at the years t and t δt it bears together with the corresponding vector x an implicit characteristic of those biotic and abiotic conditions that have occurred in the interval from t to t δt and effected the picture of transitions in the process under observation therefore it is of interest how much the current distribution x t differs from the steady state x and it is measured by the keyfitz index of dissimilarity keyfitz 1968 p 47 4 δ x x t 1 2 j 1 n x j x j t where n is the vector dimension the index values vary from 0 when the vectors are equal to 1 or 100 the maximal dissimilarity being achieved by singular distributions concentrated in different vector components thus the measure of actual difference is expressed as a share or percentage of the greatest possible dissimilarity 3 1 calibration method the nature of the available data namely repeated observations on permanent transects in combination with a large sample size provides the ability quite rare in ecology to calculate all the model parameters in a unique and reliable mode the parameters are 16 transition probabilities pij from eq 1 more accurately 12 transition probabilities plus the 4 of retaining the current state pjj for one step we judge of the probabilities by the actual picture of transitions table 1 and calculate the probability as the frequency of the transition or retention event table 2 then five calibrating eqs 1 hold automatically true it means that the calibration is accurate to the extent to which the frequencies do approximate the probabilities in our case so that the method does not lead to any loss of information 3 2 averaging the transition matrices since the final sample was formed in such a way that the total number of quadrats remained unchanged in each observation eq 1 implies that 5 x 2005 p 2000 p 1995 p 1990 p 1985 p 1980 x 1980 where all the vectors x t and matrices p t are calculated from table 1 while each of the matrices p t characterizes indirectly its own 5 year interval to characterize the total observation period we need an average of the 5 matrices and eq 5 does prompt the way how to find the average indeed the essential meaning of averaging follows from the idea that the average matrix g must give exactly the same result on the entire observation period that the inhomogeneous model or nonautonomous model in a general context does in our case the model outcome from the whole period should be the distribution of states in 2005 the year of the last sixth examination i e the result of transforming successively the initial distribution vector x 1980 into the vector x 2005 in accordance with eq 5 see also eq 7 in logofet et al 2017 it means that matrix g when raised to the 5th power ought to yield the product of the matrices in the right hand side of eq 5 6 g 5 p 2000 p 1995 p 1990 p 1985 p 1980 ibidem eq 8 wherefrom the true sense of g ensues to be geometric also the pattern of the mean matrix must be the same as that of the matrices p t to be averaged i e without zero elements hence corresponding to the complete transition digraph so the number of unknown entries to matrix g equals 4 4 16 and it coincides with the number of element wise equations inside of the matrix eq 6 which therefore becomes exactly solvable this lucky situation contrasts to those with population projection matrices logofet et al 2017 2018a b logofet 2018 where the life cycle graph cannot be complete due to biology constraints hence the averaging equation cannot have any exact solution the product of any number of stochastic matrices preserves the stochastic property which the matrix g must possess too if it exists as the solution of eq 6 and is positive like all the cofactors on the right hand side of 6 with the exception of p 1995 in this case it also serves as the transition matrix of the corresponding markov chain and this chain is by construction homogeneous in time its characteristics reflect the properties of the process under study throughout the whole observation period these include the steady state distribution x of the chain state probabilities mentioned above the mean time mj to the change of state j and the mean state i first passage time starting from state j the all being calculable by the standard formulae of markov chain theory kemeny and snell 1976 together with the mean duration mj of each j th state the mean first passage times are the time characteristics of the random process expressed in the number of steps given the known magnitude of the time step these characteristics are also expressed in chronological units years mathematical details of the computations are presented in appendix a 4 results 4 1 transition matrices calculated for each pair of successive observations in accordance with table 1 the transition matrices are presented in table 2 their elements transition probabilities found as the frequencies of the corresponding events are shown in the form of rational numbers for the sake of clarity without reduction to the proper fractions of the 80 entries to all the five transition matrices only one element p 14 in the transition matrix p 1995 has turned out zero which confirms the assumption that all theoretically possible transitions between states do occur in each of the 5 year intervals between the observations also this indicates a correct choice of the time step length and the number of sample quadrats all the transitions have been realized in the community for every 5 years which confirms the completeness of the transition digraph maslov logofet 2016 fig 2 4 2 steady state distributions of state probabilities each of the matrices in table 2 features its own steady state or limiting vector x of the state probability distribution found as the solution to eq 2 thus illustrating the idea of inhomogeneity so the steady state proportion of quadrats occupied by bilberry alone varies from 19 5 to 44 8 for different transition matrices and that by two species varies from 18 5 to 56 1 however comparing thoroughly the obtained steady state vectors shows them being qualitatively quite similar for instance the largest shares of quadrats in all five vectors are those with bilberry alone or with bilberry and cowberry growing together the share of quadrats with cowberry alone varies insignificantly as far as 4 out of 5 values are in the range of 12 13 thus fluctuations in the number of shoots from examination to re examination have a significant effect on certain elements of transition matrices and components of steady state vectors but do principally not change the conclusions about the states that dominate in the limiting distributions to see a degree of inhomogeneity in the markov process we compare the steady state distributions corresponding to different one step transition matrices by means of keyfitz index of dissimilarity table 3 if the chain were homogeneous all the indexes would be zero in table 3 the closer are values to 100 the more different are the matrices and the more inhomogeneous is the process the average of 10 nonzero values index turns out to amount roughly 24 which indicates a moderate level of inhomogeneity however the maximal index of dissimilarity reaches the value of 39 7 which reveals essential changes in transition probabilities between the years of 1995 and 2000 fig 3 demonstrates how much the outcome of modelling may differ when derived from a sole transition matrix when only two field observations are available modelling versions a and b correspond to the two transition matrices 1985 1990 and 1995 2000 that are the most distinct according to table 3 in fig 3a we notice a decrease in the number of quadrats with two species and a noticeable increase in the share of species free quadrats in the second case fig 3b the number of species free quadrats decreases while the number of those with two species notably increases looking ahead we note that these figures are quite close to the results of the averaged model 4 3 the average of transition matrices in theory solution to the mathematical averaging problem does exist due to the transition digraph being complete fig 2 in practice however there occur computational difficulties which can be overcome due to the options proposed by modern software such as matlab appendix b table 4 shows the outcome of averaging the 5 transition matrices and the corresponding steady state distribution x g of quadrats among the four possible states the steady result of succession after averaging the fluctuations is thus expected to distribute the quadrats among the states in such a way that 37 of quadrats are occupied by bilberry alone 11 by cowberry alone both species are expected on 38 of quadrats and 14 to be species free in the steady state the quadrats dominate in almost equal shares where bilberry grows alone and where bilberry coexists with cowberry table 5 shows how much the distribution x g differs from those observed in the successive years of observations by means of keyfitz index of dissimilarity and fig 4 gives an idea of how fast the initial distribution x 1980 converges to x g by five year steps we see that the components of the initial distribution approach rapidly the steady state values the distribution in 2000 differing from the steady state one by only 5 3 and it practically coinciding with the steady state dissimilarity 0 7 in 2005 the final year of observation this gives evidence that the process is globally unidirectional in spite of it being locally omnidirectional transition to every state is probable by the associated digraph fig 2 from the quadrat at any time 4 4 how long states keep unchanged and the process cyclicity the matrix t of first passage times for every state from every other contains the corresponding times expressed in the numbers of time steps table 4 and with due regard to the step length δt 5 years they are expressed approximately as shown in table 6 for example it takes 82 years on the average to achieve state w from v and 29 years in the opposite direction these figures reflect altogether the cyclicity of the random rather than deterministic process where the common period of deterministic oscillations makes no longer sense so different states recur in different average years from 13 to 45 see diagonal cells in table 6 while the species free quadrats reach state w for average 62 years and state vw for 36 years approximated from the proper column of table 4 the mean durations of states are given in the last line of table 6 we notice that the state of species coexistence persists for the longest time in contrast to what followed earlier maslov and logofet 2016 table 2 from a particular one step transition matrix 1985 1990 alone but the averaged model shows like the former single step one does ibidem significant differences in the mean duration between the bilberry state 15 years and the cowberry state 9 years thus the time of the secondary post fire succession reaching a distribution different from the steady state one by less than 5 is in the interval of 46 50 years 26 years from the year of the ground fire to the first examination in 1980 plus 4 5 five year model steps this result is close to that obtained form a one step transition matrix 45 years maslov and logofet 2016 as follows from fig 4 the share of v quadrats and that of vw quadrats are increasing in the course of succession on the contrary the share of species free quadrats and that of w quadrats are decreasing however if we consider the dynamics of each species individually which are traditionally analysed in population studies then the quadrats with bilberries are absolutely predominant in the steady state since they account for 37 38 75 of the quadrats fig 5 in spite of the notable decrease in the share of cowberry alone quadrats the total share of cowberry does non decrease in the course of succession but rather increases from 45 16 29 in 1980 table 5 to 49 11 38 in the steady state table 4 5 discussion a large number of the mechanisms by which species can avoid competition have been reported in the literature for a list of 120 such mechanisms see palmer 1994 and most of them involve spatial temporal or resource partition amarasekare 2003 in contrast to deductive theoretical models where the mechanisms are postulated the inductive ones such as the markov chain models of succession or fine scale vegetation dynamics avoid postulating any mechanisms except for a technical one such as the markovity assumption to provide for a formal and objective description of the reality under study the description leads to a calibrated model which yields the quantitative characteristics of the process that could hardly be obtained without the model in our present case these are the limiting distribution of species specific state among quadrats and cyclicity indices for the fine scale two species dynamics obtained from the time averaged model thus summarizing the 25 year period of observations as noted in the introduction the issues of matrix averaging have not been properly addressed in ecological literature exploited in the given study the idea to geometrically average several given stochastic matrices has been prompted by the concept of pattern geometric average developed recently for matrix population models logofet 2018 and refs therein when no constraints are imposed on the pattern of the average matrix g i e on the solution of eq 6 then the problem to average geometrically the five given stochastic matrices is mathematically equivalent to the standard extraction of the 5 th power root from their product whereby the problem may have several solutions gantmacher 1967 higham and lin 2009 mcdonald et al 2014 however the practical sense behind the averaging problem does impose certain mathematical constraints and those are in our case the conditions of matrix g being column stochastic as far as it has to be the transition matrix of a markov chain in other cases such as nonautonomous matrix population models the average matrix has to be of a fixed nontrivial pattern matching the life cycle graph and to locate within given quantitative bounds logofet et al 2017 2018a b logofet 2018 then the corresponding analogue of eq 6 is deprived of any exact solution and the solution we search for is an approximate one yet with a high approximation accuracy ibidem in fact the geometric average of stochastic matrices is a particular case of the pattern geometric average in which the matrix pattern is complete fig 2 hence all the matrices being positive 1 1 single exlusion of p 14 0 in the transition matrix p 1995 has not spoiled the solving technique as the lower bound for g 14 was zero too see b5 in appendix b while g 14 0 in the solution therefore the solution we have found in our case turns out to be rigorous table 4 hence the results obtained from matrix g tables 4 6 are reliable although the practical extraction of the matrix root faces certain computational problems appendix b stochastic nature of the markov model enables us to reconcile the seemingly contradictory categories such as the directionality and cyclicity in the fine scale dynamics the directionality is revealed after averaging the one step transition matrices as the convergence decreasing keyfitz index of dissimilarity of the initial distribution x 1980 of quadrat state probabilities to the steady state or limiting vector x g table 5 the cyclicity is demonstrated by the mean state duration times before the state changes and the mean recurrence times for the same state table 6 mean recurrence times characterize the species cycle in the quadrat and they differ markedly between bilberry 13 years and cowberry 45 years significant differences in the periods of the fine scale turnover were revealed earlier maslov 2001 figs 2 and 3 in a myrtillus type pine forest where the bilberry was classified as a species with low mobility rate and the cowberry as that with moderate high mobility however species populations were studied independently of each other in that study so that nothing was known about how the share of quadrats with co growing species was changing the conclusion that bilberries grow longer on the same quadrats maslov 2001 correlates well with the results of table 6 concerning the mean state duration which is greater in bilberry 15 years than that in cowberries 9 years these differences can be partly related to the average age of ramets which according to the literature is 3 5 years in cowberry and 5 8 years in bilberry reviews in balandina and vakhrameeva 1978 1980 however the v and w states can end in the transitions to the wv state species coexistence and the longer time for bilberry returning to state v bilberry alone is explained by the process trend of transitioning to the state where both species coexist 6 conclusion inhomogeneous markov model of the fine scale dynamics in bilberry vaccinium myrtillus and cowberry v vitis idaea two species dominating the field layer at the later stages of post fire succession describes the data of 25 year observation with the absolute accuracy together with the averaged homogeneous version the both models provide for the objective spatial and temporal characteristics of the observed process thereby revealing its directionality and cyclicity although fluctuations in species abundances from examination to re examination effect drastically certain entries to the transition matrix and the corresponding steady state vector they do principally not change the conclusions on the dominating vector components i e on the dominating states among the quadrats as the terminal steady state result of the fine scale dynamics the distribution of quadrats is expected such that 37 of quadrats are occupied by bilberry alone 11 by cowberry alone 38 by both species and 14 of quadrats being species free the temporal characteristics ensuing from the averaged model of fine scale dynamics enable estimating the total duration of the secondary post fire succession as 46 50 years needed to reach a distribution that differs from the steady state one by less 5 both the inhomogeneous markov chain of five transition matrices p t and its averaged version with the homogeneous matrix g do provide just a phenomenological view of the fine scale dynamics and do not suggest any deep insight into their cause effect mechanisms however such a model can help to pinpoint areas where such insight would be valuable jeffers 1978 p 92 we have demonstrated for the fist time that the share of cowberry alone quadrats was notably decreasing in the course of succession whereas the share of coexistence quadrats was increasing this conclusion a priori not apparent but an important one acts both as a guide and stimulus to further research ibidem of what the real cause effect mechanism of interspecies relations occurs between bilberry and cowberry at the fine scale on a small quadrat of the 20 20 cm size acknowledgement we are grateful to the anonymous reviewer whose competent critique improved the ms of original submission appendix a expected time to change the state and the mean first passage times there is a fundamental relationship known between the mathematical expectation mj of the random number of steps after which state j changes and the corresponding diagonal element pjj of the transition matrix i e the probability that the chain remains in state j for one step a1 pjj 1 1 mj j 1 4 kemeny and snell 1976 thereby the mean duration of state j before it changes equals a2 mj 1 1 pjj j 1 4 the mean first passage times tij are also expressed in step numbers and collected into the matrix a3 t d i z z dg e where d diag djj is the diagonal matrix with the elements djj 1 xj j 1 4 in the diagonal i diag 1 1 1 1 e is the matrix whose all elements are equal to 1 z i p x 1 is the fundamental matrix of the chain and z dg is the diagonal matrix formed by the principal diagonal of matrix z ibidem similar to matrix p and vector x the matrices x z and d hence the t after them are also amenable to precise calculation in rational numbers by means of computer symbolic algebra but numeric approximations of these matrices are quite sufficient to estimate the time characteristics of the markov chain appendix b solution to the averaging problem to search for the geometric mean of the five given matrices p t according to eq 6 is mathematically equivalent to extracting the 5th power root from their matrix product general approach to defining a function of the matrix argument gantmacher 1967 v 1 2 suggests the matrix root of degree p a 1 p of matrix a to be defined on the spectrum of a hence it reduces to extracting the root from the matrix eigenvalues ibidem viii 6 in the general case this problem is far from trivial even for nonnegative matrices and it may have many solutions or may not have at all higham and lin 2009 mcdonald et al 2014 a hope for the exact solution to exist in our case is due to the matrix p being positive all pij 0 the complete digraph of transitions while a sufficient condition is given by the following theorem theorem politi and popolizio 2014 theorem 1 let a be a real or complex matrix of order n with no eigenvalues on r the closed negative real semiaxis and let p be a positive integer then there exists a unique matrix x such that 1 x p a 2 the eigenvalues of x lie in the sector z π p arg z π p we refer to x as the principal pth root of a and write x a 1 p if matrix a is stochastic then its pth root preserves this property as any natural power p does ibidem the product of 5 stochastic matrices p t in the right hand side of eq 6 is inevitably positive and stochastic too with a positive spectrum b1 λ g 5 λ 0 1708 0 1443 0 1430 0 1150 0 3719 0 3904 0 3522 0 3589 0 1289 0 1053 0 1264 0 1049 0 3284 0 3599 0 3784 0 4212 1 0 0751 0 0016 0 0320 it means that matrix g 5 meets the theorem conditions its jordan normal form jnf is trivially diagonal so that we obtain the spectrum of matrix g by element wise extracting the 5th root from the right hand side of b1 b2 λ g 1 0 5958 0 2785 0 5025 exactly the same matrix v that provides the representation of g 5 via its jnf b3 g 5 v diag λ g 5 v 1 leads to the desired result via the spectrum b2 b4 g v d i a g λ g v 1 0 5251 0 1172 0 1470 0 0133 0 2531 0 6683 0 1293 0 1952 0 1734 0 0234 0 4631 0 0710 0 0483 0 1911 0 2606 0 7205 testing matrix b4 for eq 6 reveals the total error over all 16 matrix elements to equal 6 5848 10 16 though distinct from zero because of computer round off errors but too small to affect any conclusion note that calculating carelessly the matrix root by the matlab operation of raising matrix g 5 to the 1 5 th power which should theoretically yield the required matrix g returns quite a different wrong result eval prodp 1 5 ans 0 7023 0 6790 0 6777 0 6489 0 8205 0 8285 0 8116 0 8147 0 6638 0 6375 0 6612 0 6371 0 8003 0 8152 0 8234 0 8412 which is even not a stochastic matrix this malfunction is not specific for matrix b1 but has certain fundamental reasons politi and popolizio 2015 let mip and map be matrices composed of the respectively minimal and maximal elements of one step transition matrices p 1980 p 2000 in the corresponding places then following table 2 we have b5 mip 169 368 30 433 7 132 0 44 281 282 475 11 219 40 401 40 369 5 433 81 228 12 379 14 369 52 377 40 228 286 524 map 246 369 82 377 81 228 44 524 132 368 305 433 26 228 89 379 72 281 14 377 78 132 76 524 24 368 107 475 76 196 335 401 and we find out whether the average matrix g is located within these natural boundaries by the following logical commands mip g g map ans 1 1 1 1 1 1 1 1 1 1 1 1 1 1 0 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 it means that only one element g 23 out of all those in g exceeds its natural boundary 
25078,in order to facilitate watershed management we developed an expansive river health assessment method based on ecological flow hydrology method in this study that estimates the ecological flow of a river by using a probability density curve combined with six levels of river flow in different states of a river ecosystem we apply the above method to a river health assessment in the middle reaches of the yangtze river the results show that the ecological flow calculated by this method is more accurate than that of the traditional hydrology method and the fish spawning water demand method and can better describe the actual demand of river ecosystems to flow thus this method is reasonable for evaluating river health moreover the river health assessment method described in this study covers the different health states of river ecosystems including all intervals of river flow and takes into account the influences of extreme flow events and the uneven distribution of flow during the year it is a reasonable river health assessment method that can evaluate river health status systematically comprehensively and accurately moreover we demonstrate the feasibility of this method in watershed management the results show that this method can provide a scientific decision making basis for river health management in actual watershed management keywords ecological flow river health assessment watershed management 1 introduction river health refers to the state of a river in terms of ecological function and biodiversity that is not compromised and can meet the expectations of human social needs and sustainable development meyer 1997 along with the urbanization process and the acceleration of industrial development the phenomenon of river overexploitation is increasing gradually and many rivers have different degrees of health problems which are determined by variations in river hydrology and the deteriorations of flow state water quality and ecology malmqvist and rundle 2002 ziegler et al 2003 to better understand the state of river health and take the corresponding measures to control and protect it many countries assess the degree of exploitation and the acceptable degradation of the ecosystem of natural rivers there are many widely used methods for river health assessment with large scale river health assessment systems developed at a national level such as the united states federal environmental protection agency s method for the habitat assessment of small rivers with fish and benthic invertebrates as the object of evaluation water 1999 the habitat quality assessment index beyene et al 2009 the simulation system for predicting and classifying river invertebrates developed by the british freshwater ecology institute clarke et al 2003 and a methodology developed by the federal water unit of germany to classify and assess habitats for various types of rivers kamp et al 2007 based on ecology hydrology remote sensing and other professional points of view many scholars have proposed a relatively high accuracy evaluation system such as karr s biological integrity index method for assessing aquatic ecosystems by using highly sensitive biological communities such as fish karr 1981 brierley s ecological hydrology assessment system which is based on the close relationship between river geomorphology ecological hydrology and the change of river systems brierley et al 2010 and the remote sensing index method proposed by tiner for assessing the overall situation of natural habitats in watersheds tiner 2004 which has been successfully applied to the nanticoke river in the united states these methods are all able to accurately assess the state of river health based on their own models and according to the corresponding indicators a healthy river not only meets the water demand of its own ecosystem but also has the function of water discharge shipping sand transport and water supply therefore based on the hydrological perspective we suggest that river flow can be used to assess the state of river health therefore we introduce the concept of ecological flow the current methods used to calculate the ecological flow of rivers are mainly in the following four categories the traditional hydrological method boner and furland 1982 the hydraulics method mosely 1982 the habitat method nehring and anderson 1993 and the holistic method hughes and hannart 2003 however the hydraulics habitat and holistic methods require a large amount of data as support and they cannot be used in most areas the traditional hydrological method usually calculates ecological flow by the average flow rate which is too subjective and limited guangmin tan established a new method for calculating ecological flow based on the original hydrological method tan et al 2018 but the calculation result is too active which does not represent the flow of river ecosystems moreover we suggest that there is a certain change trend in river flow in wet and dry years that will not negatively affect river ecosystems based on the above problems we need a new ecological flow calculation method and to establish a more scientific and rational assessment of river health therefore this study uses the measured data of several hydrological stations in the middle reaches of the yangtze river conducts a probability density analysis and puts forward a new calculation method of ecological discharge based on the analysis results on this basis we propose a scientific and reasonable river health assessment method and evaluate the river health status in the middle reaches of the yangtze river we verify the rationality of the method from various angles and discuss the application of the method in watershed management to provide a scientific and efficient management method for river health management in watershed management 2 methods and materials 2 1 study area the study area is the jianghan plain section of the middle reaches of the yangtze river fig 1 the elevation ranges from 11 to 1622 m dem data source http www gscloud cn and a tributary and a lake connect to the yangtze river river system source the data set is provided by the data center for resources and environmental sciences chinese academy of sciences http www resdc cn there are many hills in the west and southeast of the research area the geologic ages are mainly middle permian triassic carboniferous and devonian and there are also some granite invasions in a few areas the remaining area is almost flat and the geological ages are generally quaternary http www cgs gov cn the main rocks in the research area are sedimentary and quaternary loose sediments there are no large karst landforms and the influence of the water seepage volume of the yangtze river on its own flow is negligible the research area has a subtropical monsoon climate the average annual rainfall is 1200 mm http www dsac cn and the burial depth of groundwater is between 10 and 30 m http www groundwater cn there is no large scale water recharge in the yangtze river therefore we selected the apparent flow data the flow data that ignore the recharge process of the yangtze river and the surrounding rivers lakes and groundwater of the yi chang luo shan and hankou hydrological stations along the yangtze river to conduct this study 2 2 constructing the river health assessment method in this study the construction of our method was divided into two parts data processing and algorithm building in the data processing section we first used the hydrological test method to process the raw data the data source of this study is the raw daily flow data of the three hydrological stations yichang luoshan and hankou from 1955 to 2014 a total of 60 years the basic information of each hydrological station is in table 1 after eliminating the outliers we calculated the most suitable ecological flow with a reasonable method while during algorithm building the threshold of ecological flow was determined by the most suitable ecological flow then we constructed the river health algorithm and obtained the results of the river health as shown in the flowchart in fig 2 2 3 most suitable ecological flow calculation methods because changes in river flow are affected by climate change and human activities to distinguish the impact of human activities and climate change on river flow especially to quantify the impact of human activities it is necessary to test the hydrologic variability of river flow and to eliminate the relevant variation points in the subsequent calculation to increase the accuracy of the river flow analysis there are many kinds of methods for testing hydrologic variation such as the mann kendall method mann 1945 which soleimani used to analyze the trends in rainfall temperature and stream flow in the smoky hill watershed in kansas united states soleimani and rahmani 2017 the pettitt method pettitt 1979 which was used by kukul in an analysis of the change trend in precipitation and runoff in the gaddis river basin turkey kukul kurttaş et al 2007 the brown forsythe method brown and forsythe 1974 which yue zou used for the identification and analysis of the change points of the hydrological process in the heihe river basin zou and zhang 2012 and the moving t test which canqiang zhang used to analyze the influence of climate change and human activity on streamflow in the xitiaoxi river basin in china zhang et al 2014 however the use of a single detection method to detect hydrological variability has specific watershed application limitations jianyu et al 2015 therefore we used a variety of detection methods in this study such as the von neumann ratio method neumann 1941 the cumulative deviation method buishand 1982 the moving t test method the mann kendall method and the difference product method to diagnose and analyze the flow sequences of the hydrological stations combined with the influence of climate change and human activities and then analyze the cause of the variation and confirm the variation point however at present ecological flow lacks a unified definition and a standard calculation method xi qin et al 2002 and the grading standard for ecological flow such as the widely used tennant method tennant 1976 and the flow duration curve method xingmin et al 2008 mainly uses the specific guarantee rate which has great limitations and is susceptible to extreme events and annual distribution inequality according to the bioadaptability wilson and franklin 2002 and plasticity lai et al 2010 theory of ecosystems therefore in this study we chose the river discharge corresponding to the extreme value of the monthly probability density curve as the most suitable ecological discharge for that month and on the basis of this we calculated the relevant ecological flow 2 4 river health assessment method river health is different under different flow thresholds so we based river health on the most suitable ecological flow to define the river s ecological flow threshold under different health conditions then based on the theory of bioadaptability and plasticity see 2 3 a river health assessment method was established and the health state of the river was expressed by its river health level we suggest that excessive flow has a better ecological influence than low flow for instance compared with low flow large floods can increase the number of water species in river ecological systems fornaroli et al 2016 therefore in this assessment method the health level of excessive river flow is set higher than that of low flow the definition of the ecological flow threshold the river health assessment algorithm and the river health grade system of the river health assessment method which was improved based on the guangmin tan s result tan et al 2018 is shown in the following section 2 4 1 ecological flow threshold definition most suitable ecological flow q0 in the selected flow sequence the flow rate corresponding to the maximum of the monthly average flow probability density function is the most suitable ecological flow for the month and the most suitable ecological flow for the whole year is composed of the most suitable ecological flow in each month optimal lower threshold for ecological flow q1 in the selected flow sequence the mean value of the minimum and best ecological flows is treated as the lower threshold of the optimal ecological flow the optimal lower threshold for ecological flow per month is used to establish the optimal lower threshold annual ecological flow process optimal upper threshold for ecological flow q2 in the selected flow sequence the mean value of the maximum and best ecological flows is treated as the upper threshold of the optimal ecological flow the optimal upper threshold for ecological flow per month is used to establish the optimal upper threshold annual ecological flow process minimum ecological flow q3 in the selected flow sequence we choose the minimum value of the monthly average flow of many years as the minimum ecological flow of that month and the minimum ecological flow per month is used to establish the minimum annual ecological flow process maximum ecological flow q4 in the selected flow sequence we choose the maximum value of the monthly average flow of many years as the maximum ecological flow of that month and the maximum ecological flow per month is used to establish the maximum annual ecological flow process extremely large ecological flow q5 in the selected flow sequence we choose the maximum daily flow per month for many years as the extremely large ecological flow of that month and the extremely large ecological flow per month is used to establish the extremely large annual ecological flow process extremely small ecological flow q6 in the selected flow sequence we choose the minimum daily flow per month for many years as the extremely small ecological flow of that month and the extremely small ecological flow per month is used to establish the extremely small annual ecological flow process 2 4 2 river health assessment algorithm the river health assessment algorithm is shown in eq 1 rhl river health level 1 rhl q 2 q q 2 q 0 1 9 10 q q 0 q 2 q q 1 q 0 q 1 1 8 10 q q 1 q 0 q 4 q q 4 q 2 2 6 10 q q 2 q 4 q q 3 q 1 q 3 2 4 10 q q 3 q 1 q 5 q q 5 q 4 1 5 2 5 10 q q 4 q 5 q q 6 q 3 q 6 1 5 1 10 q q 6 q 3 1 5 q 5 q q 5 1 0 5 10 q q 5 1 5 q 5 5 q 1 5 q 5 q q 6 0 5 10 q 0 q 6 where q0 denotes the most suitable ecological flows q1 and q2 denote the optimal lower and upper thresholds for ecological flow q3 and q4 denote the minimum and maximum ecological flows and q5 and q6 denote the extremely large and small ecological flows in this algorithm to couple the extremely small and extremely large ecological flows in the river health assessment method we set the extremely large ecological flow value as 1 5 times the maximum ecological flow which is more practical than the result from guangmin tan s tan et al 2018 and stipulates that floods that exceed this flow are also calculated as 1 5 times the maximum ecological flow 2 4 3 river health grade system this river health level system set a total of 4 first grades 8 second grades and 100 river health levels to evaluate river health the corresponding river health grade can be found in table 2 according to the calculated river health level this river health assessment method has the applicability of different time scales if it is necessary to calculate the health degree of rivers at different time scales only the time scale needs to be changed and the remaining steps are the same as in the previous analysis 3 results 3 1 calculation of ecological flow we used the von neumann ratio method and the cumulative deviation method to test the consistency of the flow data of yi chang luo shan and han kou hydrological stations the results with the selection of the critical values to meet the 95 confidence level are shown in table 3 we also used the 5 and 10 year annual average flow moving t test method the mann kendall method and the difference product curve method for the variation test of the flow data of each hydrological station the results are shown in fig 3 the results of the moving t test showed that the average annual flow of each hydrological station fluctuated gradually and decreased compared with the mean line of duration flow the wave point is expressed with a vertical dotted line the changes are especially noticeable after 2000 the mann kendall method results showed that the flow of yi chang station varied in 1970 2000 and 2010 the flow of luo shan station varied regularly in the second half of the 20th century while the flow of han kou station varied mainly between 1974 and 1995 the result of the different product curves showed that there were 1 2 variations in the yi chang station every 10 years of which the variation in the 1960s and 2000s was striking the flow of the luo shan station varied 5 6 times every 10 years and the changes from 1995 to 2010 are particularly noticeable the flow variation times of the hankou station showed a descending trend initially and then a rise reaching the minimum value in the 1970s which was similar to luo shan station which was more striking in the first 10 years of the 21st century we used a probability density curve to fit the daily flow series of the hydrological stations in this study as shown in the results in fig 4 then we choose the flow that corresponded to the maximum value of each month s probability density curve as the monthly most suitable ecological flow of that hydrological station according to the threshold definition in section 2 3 and we calculated the ecological flow and its annual distribution with the different river health states of each hydrological station see fig 5 3 2 calculation of river health the river health level of each hydrological station was calculated by using the river health assessment method established in section 2 4 as shown in fig 6 the river health level in summer of the yi chang station was generally higher than 90 except from 1970 to 1973 before 1980 but it was lower 50 75 in spring 3 5 after 1980 the river health level in spring was generally high and it decreased gradually in the other 3 seasons this phenomenon may be related to the construction of the large yangtze river hydrojunctions feng rui ping et al 2010 and the change in the luo shan and han kou hydrological stations is similar to that of the yi chang hydrological station however the average river health level of luo shan station is higher than that of the others reaching 83 4 yi chang was 82 6 and han kou was 82 3 4 discussion 4 1 analyzing the accuracy of the calculated ecological flow 4 1 1 analyzing the hydrological test results the results of the consistency test of the flow sequence table 3 showed that the flow sequences of each hydrological station all satisfied the consistency of the flow sequence so human activities do not disrupt the consistency of flow sequences liru et al 2015 thus the flow sequence does not need to be correct however the flow variability of each hydrological station was very frequent fig 3 after consulting the literature we found that climate change and human activities were the two main reasons for the flow variation as a result of human activities in the middle reaches of the yangtze river the reduction in forest cover converted to paddy fields or dry fields or degenerated into bushes changed the corresponding regional evapotranspiration so that the forest water balance and water cycle of the basin were destroyed resulting in the tendency of the variation of the flow of the yangtze river to gradually increase lijuan et al 2010 and the flooding in the yangtze river was related to the decrease in the forest habitat in the middle and lower reaches of the yangtze river in 1998 in addition in terms of climate change cong yin li s analysis of the north pacific oscillation and chao zuo s analysis of chinese air temperature and precipitation in the past 50 years combined with the reconstructed global sea surface temperature distance leveling smith 1920 li and li 1999 chao et al 2004 showed that climate change also had a significant impact on rainfall in the yangtze river basin which in turn reduced the flow of the yangtze river which is consistent with wen dai s research wen et al 2016 the above analysis proves the accuracy of the flow data used in this study moreover considering the response time of the river ecosystem to environmental changes and the influence of flow variation points on the calculation we excluded all flow variation points and the flow data of the following year a total of 2 years in the process of calculating the ecological flow of each hydrological station 4 1 2 comparison of the minimum ecological flow to ensure the accuracy of the calculated ecological flow we compared it with other ecological flow calculation methods when the river flow reached the minimum ecological flow its internal pollutant concentration was high and its eutrophication level was very unfavorable to the operation of the river ecosystem therefore we chose the ecological flow threshold to compare with the ngprp method dunbar et al 2018 the minimum average month flow mamf method de shun et al 2016 and the 7q10 method yong qiang and qi ting 2017 however the result of the above method is a fixed value which does not reflect the changes in flow in the year therefore we also used the annual distribution ecological flow method adef fan and ya dong 2017 and the q90 method fu xuan et al 2008 to calculate the minimum ecological flow and compared it with the minimum ecological flow calculated in this study the results are shown in fig 7 the results showed that the minimum ecological flow of each hydrological station was located between the 7q10 method and the mamf method which proves the rationality of the method used in this study moreover considering that the adef method multiplies the monthly average flow directly by a fixed coefficient the change trend of the minimum ecological flow was the same as that of the average of the year which is susceptible to the influence of extremely low flows that deviate from the general trend zha rong et al 2013 the minimum ecological flow of each month in the q90 method was generally larger than that in the adef method and the annual distribution of the minimum ecological flow of each hydrological station in this study was located between the adef method and the q90 method this shows that the method used in this study can make the calculation result of the minimum ecological flow more accurate and reduce the adverse effect of extreme flow events on the calculation of ecological flow which can more scientifically and reasonably reflect the minimum ecological flow and its annual distribution at each hydrological station and is more accurate than the guangmin tan s result tan et al 2018 especially the comparison of the annual distribution 4 1 3 comparison of the most suitable ecological flow when river flow is the appropriate value of the most suitable ecological flow the suitability of river ecosystems and biodiversity can reach an optimal state which has great practical significance therefore we chose the most suitable ecological flow to compare the optimal lower and upper thresholds for ecological flow and the most suitable flow calculated by the monthly frequency calculation method according to jie li s research jie et al 2007 we chose a 50 guarantee rate q50 in the monthly frequency calculation method the results are shown in fig 8 the results show that the ecological flow calculated by the monthly frequency calculation method and the most suitable ecological flow cross each other and are all located between the upper and lower thresholds of the most suitable ecological flow which indicates that the method of calculating ecological flow used in this study is scientific and reasonable 4 1 4 comparison of ecological flow and the most suitable fish spawning flow the ecological flow calculated in this study used ecosystem as the research object considering the rare chinese sturgeon acipenser sinensis and the four major economic fish blue carp grass carp silver carp and bighead carp in the yangtze river we compared the most suitable ecological flow calculated in this study with the suitable flow for fish breeding and spawning according to zhao yue s research the suitable flow for acipenser sinensis spawning is 13000 19000 m3 s yue et al 2013 and jian li s most suitable fish spawning flow calculated by the phabsim model is 12000 15500 m3 s jian and zi qiang 2011 yu wang s research suggested that when the discharge flow is 10000 15000 m3 s the four major fish spawning habitats had a higher suitability yu et al 2016 these flows are between 8634 24972 m3 s the suitable ecological flow from april june at all the hydrological stations calculated in this study therefore the results of the ecological flow calculated in this study are also reasonable considering the spawning conditions of fish 4 2 rationality demonstration of the river health assessment method in this study we proposed a river health assessment method based on ecological flow using a dimensionless mathematical formula six levels of ecological flow were coupled into a system to evaluate the health level of river ecosystems the method covers six states of river ecosystems q0 denotes the most suitable state of a river ecosystem q1 and q2 denote the upper and lower thresholds of the suitable state of a river ecosystem q3 and q4 denote the upper and lower thresholds of a river ecosystem that is not destroyed and q5 and q6 denote an extreme river ecological environment where the river ecosystem is almost destroyed this method is different from the previous river health assessment methods which use some ecological indicators in river ecosystems to assess river health for example qiting zuo assessed river health using aquatic biological factors qiting et al 2015 and yong he revealed the threats to river health by taking water sediment processes as ecological factors yong et al 2006 because river flow is a prerequisite for normal river functions the priority should be on flow rather than on other river ecological indicators however current river health studies are mostly limited to measuring nitrogen and phosphorus and other water quality indicators in a river to measure the health status such as wang fang s study on particulate phosphorus and its environmental chemical effects in the yangtze river fang and weijin 2004 and li lei s study on the change in dissolved silicon and its environmental response after the impoundment of three gorges project lei et al 2014 although these methods can assess the effects of water quality factors on river health they neglect the impact of flow on river ecosystem working conditions in practice the abovementioned non human pollution in the water environment can be improved by combining our river health assessment method and then regulating the river flow within a reasonable range moreover the core part of the river health assessment method in this study is ecological flow which is determined on the basis of considering the relevant theory of biological adaptability converting the demand for river habitats in certain specific states of river ecosystems such as the most suitable state and the critical state into river discharge such as q1 q6 can be used to protect some of the special functions of rivers for example timber transportation requires high river flow ruiz villanueva et al 2016 and the protection of riverbank vegetation requires river flow rivaes et al 2015 second the calculation method of river ecological flow proposed in this paper provides a threshold of flow regulation q q1 q q1 for river water allocation that is under the permissible condition of the ecological environment of a river the utilization rate of water resources can be improved as much as possible to achieve higher social and economic benefits considering the timeliness of ecological flow and the adaptability of space to the complex multiscale and multiobjective components of the ecological environment of watersheds the river health assessment method can also directly reflect the real time health status of rivers through the instantaneous flow data thus our river health assessment method also has the ability to predict and analyze river health finally our river health assessment method is simple and scientific it only needs the flow data of past years after eliminating the abnormal values through hydrological tests the probability density and ecological flow can be obtained and the corresponding river health assessment method suitable for a river can be obtained in summary the river health assessment method proposed in this study is a rational method 4 3 application of the river health assessment method in watershed management the main application of our river health assessment method is for watershed management regarding the allocation of water resources in watersheds with the progress of society people regard economic growth as the main motive for developing and utilizing rivers the demand for rivers is increasing gradually excessive water extraction from rivers and sewage discharge will degrade rivers and destroy their ecosystems such as the large scale long term cut off phenomenon occurring in the yellow river china since 1972 ji wei and xing min 2000 the main reason is that the irrigation water quota of the major irrigation areas in the upper reaches of the yellow river is too large resulting in water shortages and runoff being cut off in the lower reaches of the yellow river a similar phenomena also occurred in the nile abdelsalam et al 2014 but at the end of the 20th century the haihe river cutoff event in china was caused by excessive river recharge because of groundwater overexploitation thus the balance of water resource allocation is the most important problem in watershed management our method can show the health levels of all the rivers in a watershed at the same time with a certain amount of accumulated data it is necessary to calculate the river health assessment method with past data the more data the more accurate the assessment method our method is convenient for decision making departments to regulate water resources in watersheds without damaging river health regarding the change in watershed water resources by incorporating our assessment methods into hydrological models such as zaher s river intelligent model yaseen et al 2018 our method can predict the changes to river health in the coming years and contribute to the forward looking management of watersheds and by incorporating our methods into the vasilis bellos s flood model bellos and tsakiris 2016 the method can calculate the river health level during flood periods and provide a reference for flood control in the whole watershed in terms of the ecological environmental management of rivers this method can also be used as an important reference because the ecological flow of rivers limits the biological capacity and pollutant capacity of rivers the methods used to address the same ecological problems are significantly different under different ecological flow conditions for example after encountering large scale point source pollution streams with less flow can be cut off and diverted while the pollution is treated while rivers with more flow can only be treated in situ by various methods the flow thresholds in our method can be used as boundary conditions for many river environment models such as gebler s neural network water quality model gebler et al 2018 keupers s fast water quality model keupers and willems 2017 and r manivanan s water quality model manivanan 2008 which can effectively increase the accuracy of the assessment of the river ecological environment in watersheds 5 results 1 when the ecological flow assessment method proposed in this study is compared with the traditional hydrological method and the fish spawning flow method the results show that this method can weaken or avoid the adverse effects of the traditional hydrological method and its superiority is outstanding this method is based on the maximum value of the probability density curve to obtain the most suitable ecological flow which is more accurate than other methods 2 based on the premise that river flow is the normal function of rivers and taking ecological flow as the evaluation factor this study proposes a river health assessment method that has a simple algorithm and couples all the states of real rivers it is simpler than the traditional river ecological factor assessment method and it can be applied to the middle reaches of the yangtze river to assess the health status of the river effectively it is a reasonable and scientific method for river health assessment 3 this study also enumerates the application of the river health assessment method in actual river management using examples it can simplify the process and solve some difficult river management problems effectively and can also provide a scientific and efficient management method for practical river health management in watershed management funding 1 the national water pollution control and management s t specific projects of china 2014zx07104005 guolu yang and jing lu 2 independent research project of wuhan university 2042015kf1010 jing lu 3 water resource scientific research project of hubei province hbslky201709 yangzhen fan acknowledgements the authors thank postdoctoral researchers doc wenguang luo and dr yangzhen fan for their help with the paper and associate prof jing lu and prof guolu yang for their advice we also thank the anonymous reviewers for their relevant comments to improve this paper 
25078,in order to facilitate watershed management we developed an expansive river health assessment method based on ecological flow hydrology method in this study that estimates the ecological flow of a river by using a probability density curve combined with six levels of river flow in different states of a river ecosystem we apply the above method to a river health assessment in the middle reaches of the yangtze river the results show that the ecological flow calculated by this method is more accurate than that of the traditional hydrology method and the fish spawning water demand method and can better describe the actual demand of river ecosystems to flow thus this method is reasonable for evaluating river health moreover the river health assessment method described in this study covers the different health states of river ecosystems including all intervals of river flow and takes into account the influences of extreme flow events and the uneven distribution of flow during the year it is a reasonable river health assessment method that can evaluate river health status systematically comprehensively and accurately moreover we demonstrate the feasibility of this method in watershed management the results show that this method can provide a scientific decision making basis for river health management in actual watershed management keywords ecological flow river health assessment watershed management 1 introduction river health refers to the state of a river in terms of ecological function and biodiversity that is not compromised and can meet the expectations of human social needs and sustainable development meyer 1997 along with the urbanization process and the acceleration of industrial development the phenomenon of river overexploitation is increasing gradually and many rivers have different degrees of health problems which are determined by variations in river hydrology and the deteriorations of flow state water quality and ecology malmqvist and rundle 2002 ziegler et al 2003 to better understand the state of river health and take the corresponding measures to control and protect it many countries assess the degree of exploitation and the acceptable degradation of the ecosystem of natural rivers there are many widely used methods for river health assessment with large scale river health assessment systems developed at a national level such as the united states federal environmental protection agency s method for the habitat assessment of small rivers with fish and benthic invertebrates as the object of evaluation water 1999 the habitat quality assessment index beyene et al 2009 the simulation system for predicting and classifying river invertebrates developed by the british freshwater ecology institute clarke et al 2003 and a methodology developed by the federal water unit of germany to classify and assess habitats for various types of rivers kamp et al 2007 based on ecology hydrology remote sensing and other professional points of view many scholars have proposed a relatively high accuracy evaluation system such as karr s biological integrity index method for assessing aquatic ecosystems by using highly sensitive biological communities such as fish karr 1981 brierley s ecological hydrology assessment system which is based on the close relationship between river geomorphology ecological hydrology and the change of river systems brierley et al 2010 and the remote sensing index method proposed by tiner for assessing the overall situation of natural habitats in watersheds tiner 2004 which has been successfully applied to the nanticoke river in the united states these methods are all able to accurately assess the state of river health based on their own models and according to the corresponding indicators a healthy river not only meets the water demand of its own ecosystem but also has the function of water discharge shipping sand transport and water supply therefore based on the hydrological perspective we suggest that river flow can be used to assess the state of river health therefore we introduce the concept of ecological flow the current methods used to calculate the ecological flow of rivers are mainly in the following four categories the traditional hydrological method boner and furland 1982 the hydraulics method mosely 1982 the habitat method nehring and anderson 1993 and the holistic method hughes and hannart 2003 however the hydraulics habitat and holistic methods require a large amount of data as support and they cannot be used in most areas the traditional hydrological method usually calculates ecological flow by the average flow rate which is too subjective and limited guangmin tan established a new method for calculating ecological flow based on the original hydrological method tan et al 2018 but the calculation result is too active which does not represent the flow of river ecosystems moreover we suggest that there is a certain change trend in river flow in wet and dry years that will not negatively affect river ecosystems based on the above problems we need a new ecological flow calculation method and to establish a more scientific and rational assessment of river health therefore this study uses the measured data of several hydrological stations in the middle reaches of the yangtze river conducts a probability density analysis and puts forward a new calculation method of ecological discharge based on the analysis results on this basis we propose a scientific and reasonable river health assessment method and evaluate the river health status in the middle reaches of the yangtze river we verify the rationality of the method from various angles and discuss the application of the method in watershed management to provide a scientific and efficient management method for river health management in watershed management 2 methods and materials 2 1 study area the study area is the jianghan plain section of the middle reaches of the yangtze river fig 1 the elevation ranges from 11 to 1622 m dem data source http www gscloud cn and a tributary and a lake connect to the yangtze river river system source the data set is provided by the data center for resources and environmental sciences chinese academy of sciences http www resdc cn there are many hills in the west and southeast of the research area the geologic ages are mainly middle permian triassic carboniferous and devonian and there are also some granite invasions in a few areas the remaining area is almost flat and the geological ages are generally quaternary http www cgs gov cn the main rocks in the research area are sedimentary and quaternary loose sediments there are no large karst landforms and the influence of the water seepage volume of the yangtze river on its own flow is negligible the research area has a subtropical monsoon climate the average annual rainfall is 1200 mm http www dsac cn and the burial depth of groundwater is between 10 and 30 m http www groundwater cn there is no large scale water recharge in the yangtze river therefore we selected the apparent flow data the flow data that ignore the recharge process of the yangtze river and the surrounding rivers lakes and groundwater of the yi chang luo shan and hankou hydrological stations along the yangtze river to conduct this study 2 2 constructing the river health assessment method in this study the construction of our method was divided into two parts data processing and algorithm building in the data processing section we first used the hydrological test method to process the raw data the data source of this study is the raw daily flow data of the three hydrological stations yichang luoshan and hankou from 1955 to 2014 a total of 60 years the basic information of each hydrological station is in table 1 after eliminating the outliers we calculated the most suitable ecological flow with a reasonable method while during algorithm building the threshold of ecological flow was determined by the most suitable ecological flow then we constructed the river health algorithm and obtained the results of the river health as shown in the flowchart in fig 2 2 3 most suitable ecological flow calculation methods because changes in river flow are affected by climate change and human activities to distinguish the impact of human activities and climate change on river flow especially to quantify the impact of human activities it is necessary to test the hydrologic variability of river flow and to eliminate the relevant variation points in the subsequent calculation to increase the accuracy of the river flow analysis there are many kinds of methods for testing hydrologic variation such as the mann kendall method mann 1945 which soleimani used to analyze the trends in rainfall temperature and stream flow in the smoky hill watershed in kansas united states soleimani and rahmani 2017 the pettitt method pettitt 1979 which was used by kukul in an analysis of the change trend in precipitation and runoff in the gaddis river basin turkey kukul kurttaş et al 2007 the brown forsythe method brown and forsythe 1974 which yue zou used for the identification and analysis of the change points of the hydrological process in the heihe river basin zou and zhang 2012 and the moving t test which canqiang zhang used to analyze the influence of climate change and human activity on streamflow in the xitiaoxi river basin in china zhang et al 2014 however the use of a single detection method to detect hydrological variability has specific watershed application limitations jianyu et al 2015 therefore we used a variety of detection methods in this study such as the von neumann ratio method neumann 1941 the cumulative deviation method buishand 1982 the moving t test method the mann kendall method and the difference product method to diagnose and analyze the flow sequences of the hydrological stations combined with the influence of climate change and human activities and then analyze the cause of the variation and confirm the variation point however at present ecological flow lacks a unified definition and a standard calculation method xi qin et al 2002 and the grading standard for ecological flow such as the widely used tennant method tennant 1976 and the flow duration curve method xingmin et al 2008 mainly uses the specific guarantee rate which has great limitations and is susceptible to extreme events and annual distribution inequality according to the bioadaptability wilson and franklin 2002 and plasticity lai et al 2010 theory of ecosystems therefore in this study we chose the river discharge corresponding to the extreme value of the monthly probability density curve as the most suitable ecological discharge for that month and on the basis of this we calculated the relevant ecological flow 2 4 river health assessment method river health is different under different flow thresholds so we based river health on the most suitable ecological flow to define the river s ecological flow threshold under different health conditions then based on the theory of bioadaptability and plasticity see 2 3 a river health assessment method was established and the health state of the river was expressed by its river health level we suggest that excessive flow has a better ecological influence than low flow for instance compared with low flow large floods can increase the number of water species in river ecological systems fornaroli et al 2016 therefore in this assessment method the health level of excessive river flow is set higher than that of low flow the definition of the ecological flow threshold the river health assessment algorithm and the river health grade system of the river health assessment method which was improved based on the guangmin tan s result tan et al 2018 is shown in the following section 2 4 1 ecological flow threshold definition most suitable ecological flow q0 in the selected flow sequence the flow rate corresponding to the maximum of the monthly average flow probability density function is the most suitable ecological flow for the month and the most suitable ecological flow for the whole year is composed of the most suitable ecological flow in each month optimal lower threshold for ecological flow q1 in the selected flow sequence the mean value of the minimum and best ecological flows is treated as the lower threshold of the optimal ecological flow the optimal lower threshold for ecological flow per month is used to establish the optimal lower threshold annual ecological flow process optimal upper threshold for ecological flow q2 in the selected flow sequence the mean value of the maximum and best ecological flows is treated as the upper threshold of the optimal ecological flow the optimal upper threshold for ecological flow per month is used to establish the optimal upper threshold annual ecological flow process minimum ecological flow q3 in the selected flow sequence we choose the minimum value of the monthly average flow of many years as the minimum ecological flow of that month and the minimum ecological flow per month is used to establish the minimum annual ecological flow process maximum ecological flow q4 in the selected flow sequence we choose the maximum value of the monthly average flow of many years as the maximum ecological flow of that month and the maximum ecological flow per month is used to establish the maximum annual ecological flow process extremely large ecological flow q5 in the selected flow sequence we choose the maximum daily flow per month for many years as the extremely large ecological flow of that month and the extremely large ecological flow per month is used to establish the extremely large annual ecological flow process extremely small ecological flow q6 in the selected flow sequence we choose the minimum daily flow per month for many years as the extremely small ecological flow of that month and the extremely small ecological flow per month is used to establish the extremely small annual ecological flow process 2 4 2 river health assessment algorithm the river health assessment algorithm is shown in eq 1 rhl river health level 1 rhl q 2 q q 2 q 0 1 9 10 q q 0 q 2 q q 1 q 0 q 1 1 8 10 q q 1 q 0 q 4 q q 4 q 2 2 6 10 q q 2 q 4 q q 3 q 1 q 3 2 4 10 q q 3 q 1 q 5 q q 5 q 4 1 5 2 5 10 q q 4 q 5 q q 6 q 3 q 6 1 5 1 10 q q 6 q 3 1 5 q 5 q q 5 1 0 5 10 q q 5 1 5 q 5 5 q 1 5 q 5 q q 6 0 5 10 q 0 q 6 where q0 denotes the most suitable ecological flows q1 and q2 denote the optimal lower and upper thresholds for ecological flow q3 and q4 denote the minimum and maximum ecological flows and q5 and q6 denote the extremely large and small ecological flows in this algorithm to couple the extremely small and extremely large ecological flows in the river health assessment method we set the extremely large ecological flow value as 1 5 times the maximum ecological flow which is more practical than the result from guangmin tan s tan et al 2018 and stipulates that floods that exceed this flow are also calculated as 1 5 times the maximum ecological flow 2 4 3 river health grade system this river health level system set a total of 4 first grades 8 second grades and 100 river health levels to evaluate river health the corresponding river health grade can be found in table 2 according to the calculated river health level this river health assessment method has the applicability of different time scales if it is necessary to calculate the health degree of rivers at different time scales only the time scale needs to be changed and the remaining steps are the same as in the previous analysis 3 results 3 1 calculation of ecological flow we used the von neumann ratio method and the cumulative deviation method to test the consistency of the flow data of yi chang luo shan and han kou hydrological stations the results with the selection of the critical values to meet the 95 confidence level are shown in table 3 we also used the 5 and 10 year annual average flow moving t test method the mann kendall method and the difference product curve method for the variation test of the flow data of each hydrological station the results are shown in fig 3 the results of the moving t test showed that the average annual flow of each hydrological station fluctuated gradually and decreased compared with the mean line of duration flow the wave point is expressed with a vertical dotted line the changes are especially noticeable after 2000 the mann kendall method results showed that the flow of yi chang station varied in 1970 2000 and 2010 the flow of luo shan station varied regularly in the second half of the 20th century while the flow of han kou station varied mainly between 1974 and 1995 the result of the different product curves showed that there were 1 2 variations in the yi chang station every 10 years of which the variation in the 1960s and 2000s was striking the flow of the luo shan station varied 5 6 times every 10 years and the changes from 1995 to 2010 are particularly noticeable the flow variation times of the hankou station showed a descending trend initially and then a rise reaching the minimum value in the 1970s which was similar to luo shan station which was more striking in the first 10 years of the 21st century we used a probability density curve to fit the daily flow series of the hydrological stations in this study as shown in the results in fig 4 then we choose the flow that corresponded to the maximum value of each month s probability density curve as the monthly most suitable ecological flow of that hydrological station according to the threshold definition in section 2 3 and we calculated the ecological flow and its annual distribution with the different river health states of each hydrological station see fig 5 3 2 calculation of river health the river health level of each hydrological station was calculated by using the river health assessment method established in section 2 4 as shown in fig 6 the river health level in summer of the yi chang station was generally higher than 90 except from 1970 to 1973 before 1980 but it was lower 50 75 in spring 3 5 after 1980 the river health level in spring was generally high and it decreased gradually in the other 3 seasons this phenomenon may be related to the construction of the large yangtze river hydrojunctions feng rui ping et al 2010 and the change in the luo shan and han kou hydrological stations is similar to that of the yi chang hydrological station however the average river health level of luo shan station is higher than that of the others reaching 83 4 yi chang was 82 6 and han kou was 82 3 4 discussion 4 1 analyzing the accuracy of the calculated ecological flow 4 1 1 analyzing the hydrological test results the results of the consistency test of the flow sequence table 3 showed that the flow sequences of each hydrological station all satisfied the consistency of the flow sequence so human activities do not disrupt the consistency of flow sequences liru et al 2015 thus the flow sequence does not need to be correct however the flow variability of each hydrological station was very frequent fig 3 after consulting the literature we found that climate change and human activities were the two main reasons for the flow variation as a result of human activities in the middle reaches of the yangtze river the reduction in forest cover converted to paddy fields or dry fields or degenerated into bushes changed the corresponding regional evapotranspiration so that the forest water balance and water cycle of the basin were destroyed resulting in the tendency of the variation of the flow of the yangtze river to gradually increase lijuan et al 2010 and the flooding in the yangtze river was related to the decrease in the forest habitat in the middle and lower reaches of the yangtze river in 1998 in addition in terms of climate change cong yin li s analysis of the north pacific oscillation and chao zuo s analysis of chinese air temperature and precipitation in the past 50 years combined with the reconstructed global sea surface temperature distance leveling smith 1920 li and li 1999 chao et al 2004 showed that climate change also had a significant impact on rainfall in the yangtze river basin which in turn reduced the flow of the yangtze river which is consistent with wen dai s research wen et al 2016 the above analysis proves the accuracy of the flow data used in this study moreover considering the response time of the river ecosystem to environmental changes and the influence of flow variation points on the calculation we excluded all flow variation points and the flow data of the following year a total of 2 years in the process of calculating the ecological flow of each hydrological station 4 1 2 comparison of the minimum ecological flow to ensure the accuracy of the calculated ecological flow we compared it with other ecological flow calculation methods when the river flow reached the minimum ecological flow its internal pollutant concentration was high and its eutrophication level was very unfavorable to the operation of the river ecosystem therefore we chose the ecological flow threshold to compare with the ngprp method dunbar et al 2018 the minimum average month flow mamf method de shun et al 2016 and the 7q10 method yong qiang and qi ting 2017 however the result of the above method is a fixed value which does not reflect the changes in flow in the year therefore we also used the annual distribution ecological flow method adef fan and ya dong 2017 and the q90 method fu xuan et al 2008 to calculate the minimum ecological flow and compared it with the minimum ecological flow calculated in this study the results are shown in fig 7 the results showed that the minimum ecological flow of each hydrological station was located between the 7q10 method and the mamf method which proves the rationality of the method used in this study moreover considering that the adef method multiplies the monthly average flow directly by a fixed coefficient the change trend of the minimum ecological flow was the same as that of the average of the year which is susceptible to the influence of extremely low flows that deviate from the general trend zha rong et al 2013 the minimum ecological flow of each month in the q90 method was generally larger than that in the adef method and the annual distribution of the minimum ecological flow of each hydrological station in this study was located between the adef method and the q90 method this shows that the method used in this study can make the calculation result of the minimum ecological flow more accurate and reduce the adverse effect of extreme flow events on the calculation of ecological flow which can more scientifically and reasonably reflect the minimum ecological flow and its annual distribution at each hydrological station and is more accurate than the guangmin tan s result tan et al 2018 especially the comparison of the annual distribution 4 1 3 comparison of the most suitable ecological flow when river flow is the appropriate value of the most suitable ecological flow the suitability of river ecosystems and biodiversity can reach an optimal state which has great practical significance therefore we chose the most suitable ecological flow to compare the optimal lower and upper thresholds for ecological flow and the most suitable flow calculated by the monthly frequency calculation method according to jie li s research jie et al 2007 we chose a 50 guarantee rate q50 in the monthly frequency calculation method the results are shown in fig 8 the results show that the ecological flow calculated by the monthly frequency calculation method and the most suitable ecological flow cross each other and are all located between the upper and lower thresholds of the most suitable ecological flow which indicates that the method of calculating ecological flow used in this study is scientific and reasonable 4 1 4 comparison of ecological flow and the most suitable fish spawning flow the ecological flow calculated in this study used ecosystem as the research object considering the rare chinese sturgeon acipenser sinensis and the four major economic fish blue carp grass carp silver carp and bighead carp in the yangtze river we compared the most suitable ecological flow calculated in this study with the suitable flow for fish breeding and spawning according to zhao yue s research the suitable flow for acipenser sinensis spawning is 13000 19000 m3 s yue et al 2013 and jian li s most suitable fish spawning flow calculated by the phabsim model is 12000 15500 m3 s jian and zi qiang 2011 yu wang s research suggested that when the discharge flow is 10000 15000 m3 s the four major fish spawning habitats had a higher suitability yu et al 2016 these flows are between 8634 24972 m3 s the suitable ecological flow from april june at all the hydrological stations calculated in this study therefore the results of the ecological flow calculated in this study are also reasonable considering the spawning conditions of fish 4 2 rationality demonstration of the river health assessment method in this study we proposed a river health assessment method based on ecological flow using a dimensionless mathematical formula six levels of ecological flow were coupled into a system to evaluate the health level of river ecosystems the method covers six states of river ecosystems q0 denotes the most suitable state of a river ecosystem q1 and q2 denote the upper and lower thresholds of the suitable state of a river ecosystem q3 and q4 denote the upper and lower thresholds of a river ecosystem that is not destroyed and q5 and q6 denote an extreme river ecological environment where the river ecosystem is almost destroyed this method is different from the previous river health assessment methods which use some ecological indicators in river ecosystems to assess river health for example qiting zuo assessed river health using aquatic biological factors qiting et al 2015 and yong he revealed the threats to river health by taking water sediment processes as ecological factors yong et al 2006 because river flow is a prerequisite for normal river functions the priority should be on flow rather than on other river ecological indicators however current river health studies are mostly limited to measuring nitrogen and phosphorus and other water quality indicators in a river to measure the health status such as wang fang s study on particulate phosphorus and its environmental chemical effects in the yangtze river fang and weijin 2004 and li lei s study on the change in dissolved silicon and its environmental response after the impoundment of three gorges project lei et al 2014 although these methods can assess the effects of water quality factors on river health they neglect the impact of flow on river ecosystem working conditions in practice the abovementioned non human pollution in the water environment can be improved by combining our river health assessment method and then regulating the river flow within a reasonable range moreover the core part of the river health assessment method in this study is ecological flow which is determined on the basis of considering the relevant theory of biological adaptability converting the demand for river habitats in certain specific states of river ecosystems such as the most suitable state and the critical state into river discharge such as q1 q6 can be used to protect some of the special functions of rivers for example timber transportation requires high river flow ruiz villanueva et al 2016 and the protection of riverbank vegetation requires river flow rivaes et al 2015 second the calculation method of river ecological flow proposed in this paper provides a threshold of flow regulation q q1 q q1 for river water allocation that is under the permissible condition of the ecological environment of a river the utilization rate of water resources can be improved as much as possible to achieve higher social and economic benefits considering the timeliness of ecological flow and the adaptability of space to the complex multiscale and multiobjective components of the ecological environment of watersheds the river health assessment method can also directly reflect the real time health status of rivers through the instantaneous flow data thus our river health assessment method also has the ability to predict and analyze river health finally our river health assessment method is simple and scientific it only needs the flow data of past years after eliminating the abnormal values through hydrological tests the probability density and ecological flow can be obtained and the corresponding river health assessment method suitable for a river can be obtained in summary the river health assessment method proposed in this study is a rational method 4 3 application of the river health assessment method in watershed management the main application of our river health assessment method is for watershed management regarding the allocation of water resources in watersheds with the progress of society people regard economic growth as the main motive for developing and utilizing rivers the demand for rivers is increasing gradually excessive water extraction from rivers and sewage discharge will degrade rivers and destroy their ecosystems such as the large scale long term cut off phenomenon occurring in the yellow river china since 1972 ji wei and xing min 2000 the main reason is that the irrigation water quota of the major irrigation areas in the upper reaches of the yellow river is too large resulting in water shortages and runoff being cut off in the lower reaches of the yellow river a similar phenomena also occurred in the nile abdelsalam et al 2014 but at the end of the 20th century the haihe river cutoff event in china was caused by excessive river recharge because of groundwater overexploitation thus the balance of water resource allocation is the most important problem in watershed management our method can show the health levels of all the rivers in a watershed at the same time with a certain amount of accumulated data it is necessary to calculate the river health assessment method with past data the more data the more accurate the assessment method our method is convenient for decision making departments to regulate water resources in watersheds without damaging river health regarding the change in watershed water resources by incorporating our assessment methods into hydrological models such as zaher s river intelligent model yaseen et al 2018 our method can predict the changes to river health in the coming years and contribute to the forward looking management of watersheds and by incorporating our methods into the vasilis bellos s flood model bellos and tsakiris 2016 the method can calculate the river health level during flood periods and provide a reference for flood control in the whole watershed in terms of the ecological environmental management of rivers this method can also be used as an important reference because the ecological flow of rivers limits the biological capacity and pollutant capacity of rivers the methods used to address the same ecological problems are significantly different under different ecological flow conditions for example after encountering large scale point source pollution streams with less flow can be cut off and diverted while the pollution is treated while rivers with more flow can only be treated in situ by various methods the flow thresholds in our method can be used as boundary conditions for many river environment models such as gebler s neural network water quality model gebler et al 2018 keupers s fast water quality model keupers and willems 2017 and r manivanan s water quality model manivanan 2008 which can effectively increase the accuracy of the assessment of the river ecological environment in watersheds 5 results 1 when the ecological flow assessment method proposed in this study is compared with the traditional hydrological method and the fish spawning flow method the results show that this method can weaken or avoid the adverse effects of the traditional hydrological method and its superiority is outstanding this method is based on the maximum value of the probability density curve to obtain the most suitable ecological flow which is more accurate than other methods 2 based on the premise that river flow is the normal function of rivers and taking ecological flow as the evaluation factor this study proposes a river health assessment method that has a simple algorithm and couples all the states of real rivers it is simpler than the traditional river ecological factor assessment method and it can be applied to the middle reaches of the yangtze river to assess the health status of the river effectively it is a reasonable and scientific method for river health assessment 3 this study also enumerates the application of the river health assessment method in actual river management using examples it can simplify the process and solve some difficult river management problems effectively and can also provide a scientific and efficient management method for practical river health management in watershed management funding 1 the national water pollution control and management s t specific projects of china 2014zx07104005 guolu yang and jing lu 2 independent research project of wuhan university 2042015kf1010 jing lu 3 water resource scientific research project of hubei province hbslky201709 yangzhen fan acknowledgements the authors thank postdoctoral researchers doc wenguang luo and dr yangzhen fan for their help with the paper and associate prof jing lu and prof guolu yang for their advice we also thank the anonymous reviewers for their relevant comments to improve this paper 
25079,we demonstrate the use of a surrogate based optimization framework for large scale and high resolution landscape management optimization using irrigated corn production systems in eastern colorado usa as a case study an artificial neural network was employed to create a surrogate of the daycent biogeochemical simulation model our optimization considered trade offs among seven different objectives at different scales including farm profits irrigation water use corn grain corn stover soil organic carbon soc greenhouse gas ghg emissions and nitrogen leaching the results show that the surrogate captured greater than 99 of the variations in the daycent s simulated outputs and was 6 2 million times faster than the daycent model for our analysis farm level optimization increased farm profits by 83 150 soc by 16 53 grain yield by 10 1 11 3 and reduced ghg emissions by 19 55 compared to the business as usual scenario keywords surrogate based optimization metamodeling artificial neural networks ecosystem services multi objective optimization daycent model 1 introduction modern agricultural ecosystems need to be managed for many competing objectives such as food and fiber production carbon storage climate change mitigation water quality improvement and biodiversity conservation due to the resource constraints e g land water nutrients technology capital and labor in agricultural production simultaneously achieving all of these management goals is not possible however multi objective optimization techniques can be used to inform decision makers about potential trade offs among multiple management objectives and a suite of management decisions to achieve a specific trade off level a multi objective optimization typically generates a set of pareto optimal solutions also called non dominated solutions where any improvement in one objective always impairs some others such optimizations are often carried out via simulation based optimization approaches which couple a single or a bundle of simulation models to quantify ecosystem responses with mathematical optimization algorithms to identify the trade off surface wu et al 2016 however despite a significant improvement of computing power over recent decades computational limitations remain a major barrier to the effective and systematic implementation of this approach especially when process based simulation models are employed for large scale analyses in a high resolution and spatially explicit manner lardy et al 2014 the use of process based ecosystem models provides an efficient and non intrusive means to quantify ecosystem processes and their continuous interactions with decision making nguyen et al 2018 simulation based optimizations are often carried out via scenario analysis for which a set of scenarios first needs to be formulated and fed to an ecosystem model for exploratory simulations the results can then be optimized to choose the one that best fits the management goals this approach helps improve the decision making process but does not guarantee actual optima since solutions are forced to some discrete options besides the formulation of management scenarios and comparison of the simulated results can be time consuming laborious and highly expertise driven seppelt and voinov 2002 another disadvantage of simulation based optimizations is that using ecosystem models for large scale simulations often requires a high computational power with clusters of superpower machines this computational burden is magnified when finer spatial resolutions e g field and sub field scales and more detailed changes in management practices e g scheduling of fertilization irrigation and tillage are considered in addition the consideration of many decision variables for robust and operational optimization in agricultural resource management can result in very large solution search spaces which require substantial time and resources to find solutions these challenges make simulation based optimization approaches extremely costly and time consuming consequently the use of process based simulation models for detailed large scale landscape optimization is impractical in most institutional contexts that require timely analysis to support rational decision making ma 2005 one potential solution to overcome the inefficiency of process based ecosystem models in optimization frameworks while maintaining acceptable prediction accuracies is to employ surrogate based optimization approaches ratto et al 2012 these approaches use meta modeling techniques to substitute the high fidelity models within an optimization framework with a simplified surrogate model to reduce simulation time expertise requirement and data storage wu et al 2016 a surrogate is a simplified model of a detailed model that highlights specific properties of the original detailed model meta modeling is a data driven approach which involves fitting a response surface to approximate the relationship between multiple input variables and a target output the replacement of complex models with their surrogates brings many practical benefits simpson et al 2001 first the operation of surrogate models is highly cost effective due to the reduction in the simulation time and data storage requirement second they can easily be applied across different spatial and or temporal scales with high accuracy providing the data corresponding to the new system parameterization are available third with a higher level of flexibility and adaptability surrogate models can be integrated into other processes and simulation platforms to achieve a variety of simulation goals such as prediction optimization validation and sensitivity analysis although surrogate based optimization has been widely used in mechanical engineering for a considerable time osio and amon 1996 its application in ecosystem research is more recent castelletti et al 2012 surrogate models have been employed in various studies such as those studying land use and nitrogen fertilizer use distribution audsley et al 2008 pesticide leaching stenemo et al 2007 air quality carnevale et al 2012 n2o and nitrogen leaching villa vialaneix et al 2012 and groundwater roy et al 2016 however incorporating these models into optimization frameworks to support decision making is less common with most applications to date dealing with water resource management such as conjunctive surface and ground water use wu et al 2016 and coastal aquifer management kourakos and mantoglou 2013 song et al 2018 despite the on going development of surrogate based optimization approaches to the best of our knowledge there have been no studies that have applied these approaches for large scale agricultural landscape optimization considering multiple stakeholders and ecosystem services at high spatial and temporal resolutions our study aims to demonstrate the use of a surrogate based optimization framework for spatially explicit trade off analyses in agricultural landscapes to support resource management decision making we present our framework with a case study on optimization of the landscape design of management practices for irrigated corn production systems in colorado usa the optimization considered the trade offs among farm profits irrigation water use and several ecosystem services at a high spatial resolution field scale with detailed consideration of historical land use dating back to the 1880s 2 case study and method 2 1 study site our study focused on the irrigated corn growing area in eastern colorado usa fig 1 the whole area is 298 897 ha with a majority of fine loamy soils like many other agricultural states agriculture in colorado is subject to trade offs among food and biomass production greenhouse gas emissions and water pollution from excessive fertilizer run off strange et al 1999 the allocation of limited water resources to meet the needs of agricultural production and municipal and industrial development is also a challenge to the state water conservation board 2010 in addition the potential use of crop residues for ligno cellulosic biofuels production in the region presents another trade off between harvestable residues and long term soil health wilhelm et al 2007 the complexity and the multidimensional nature of these trade offs necessitate multi objective optimizations of land management decisions at different levels farm and landscape to improve the efficiency of resource allocation and minimize negative impacts on the environment while meeting future demands 2 2 method overview and optimization problem statement the main goals of this case study were to identify optimal management practices and their spatial configuration for the trade offs among seven management objectives for irrigated corn production systems in eastern colorado these objectives consisted of farm profits irrigation water use and five ecosystem services including food and biomass production soil carbon storage water quality and climate regulation the optimization assumed farmers objectives of maximizing farm profits and a regional planner s multi objectives for maximization of ecosystem services to quantify the ecosystem services we used 1 corn grain and stover to represent food and biomass production 2 soil organic carbon soc to represent ecosystem carbon storage 3 greenhouse gas ghg emissions to represent climate regulation and 4 nitrogen leaching to represent water quality for solvability purpose we structured our analysis as a two level optimization problem including farm and landscape levels the farm level optimizations were carried out in advance to provide the inputs for the landscape level optimization for clarity hereafter we refer to the farm level metrics with a prefix f e g f soc and f profits while the landscape sum of farm level values i e sum of all farms in the landscape will be referred to with a prefix l e g l soc and l profits at the farm level we optimized management practices to maximize profits subject to multiple soc constraints this constraint defines the percentage increase in f soc due to changes in management practices relative to a business as usual bau scenario that the optimization needs to archive and was used as a proxy for long term soil health arshad and martin 2002 we varied the f soc constraint value between 0 and 50 incrementing by 10 in other words each farm in the landscape was optimized six times corresponding to six levels of the f soc constraint the management practice decision variables considered in our analysis were nitrogen fertilization kg n ha 1 irrigation cm year 1 and residue removal rates no till was assumed for all corn fields in this analysis artificial neural networks ann were employed to create a surrogate model of the process based daycent agroecosystem simulation model del grosso et al 2002 the ann surrogate was used to rapidly predict farm level soc corn grain and stover yields as functions of farm management practices and other site specific variables the predicted yields and soc were then used to compute the objective f profits and constraint percentage change in f soc functions respectively the farm level optimization was formulated as a single objective continuous bounded and non linear programming problem and was iteratively solved for different levels of f soc constraint using fmincon solver with interior point algorithm byrd et al 1999 in the optimization toolbox of matlab software matlab and optimization toolbox 2017 at the landscape level we carried out a combinatorial multi objective optimization based on the outcomes from farm level optimizations using the ε constraint methods haimes et al 1971 for this the optimized farm level management practices were simulated with the agricultural ecosystem service optimization system ag ecosopt nguyen et al 2018 to derive the dataset for the landscape level optimization we then identified the f soc constraint that should be applied for each farm in the landscape to maximize l stover while minimizing of l ghg emissions and l nitrogen leaching landscape level optimization was required to maintain the current production levels of grain and soc while reducing the current irrigation water use these current levels were obtained from empirical or simulated data the most recent census of u s agriculture by the national agricultural statistics service nass in 2012 reported about 3 34 106 mg d m year 1 of grain and 1 50 109 m3 year 1 of irrigation water use for our defined landscape nass 2012 for l soc since reported data were not available at the state level we used the simulated landscape sum of f soc under the farm scale bau scenario with tillage adjusted from conventional to no till switching the tillage under the bau scenario was consistent with the tillage assumption of the optimization while placing a more conservative constraint on l soc for sustainability these reported simulated values of l grain l irrigation water use and l soc were set as the base constraint values for the landscape multi objective optimization we also varied the landscape constraint values to examine how improvements in grain production soc accumulation and irrigation water saving affected the pareto trade offs among the landscape objectives i e l stover production l ghg emissions and l nitrogen leaching reductions the ranges between the base constraint values and either the maximum values of grain and soc or the minimum value of irrigation water use were defined as the constraint improvement region cir see details in supplementary material s1 this was because setting the constraint values along these ranges resulted in either increases in grain and soc or decreases in irrigation water use i e an improvement to examine the effects of improvements in the constraint metrics on the landscape multi objective optimization we separately varied each constraint value along its cir and observed the changes in the resulting pareto frontiers an overview of our surrogate optimization framework is presented in fig 2 the details on the metamodeling method are presented in the following sections while those on optimization and metric calculation are available in supplementary material s1 s2 2 3 metamodeling for farm level optimization 2 3 1 agricultural ecosystem service optimization tool the ag ecosopt tool was used to simulate corn grain and stover yields and farm level soc to generate the input dataset for metamodeling the tool is comprised of the daycent biogeochemical model del grosso et al 2002 a database of historical land use for u s cropland ogle et al 2010 a geospatial component for spatially explicit processing of inputs and outputs and an optimization component several optimization algorithms such as min max hwang et al 1980 weighted sum fishburn 1967 and ε constraint haimes et al 1971 were included in ag ecosopt to optimize daycent s simulation outputs for land use and land management decision making the daycent model is a daily time step process based model that simulates biogeochemical flows of carbon nitrogen and water among the atmosphere vegetation and soil in many different ecosystems daycent simulates plant growth as a function of solar radiation temperature soil water nutrient availability and plant phenology metherell et al 1993 grain yield and harvested residue biomass are calculated from the aboveground carbon based on a crop specific harvest index and a user defined residue removal rate respectively the model captures the effects of extreme events such as frosts droughts and heat stresses on crop growth and yield extreme weather conditions might kill crops early or late in a growing season or affect their growth rate and yield surface litter pools and the soil organic matter som of the top soil layer 0 20 cm are represented dynamically as functions of substrate availability substrate quality lignin content c n ratio soil texture temperature water availability and tillage intensity daycent has been previously used to predict crop yields soil carbon dynamics and ghg emissions in various us agricultural systems e g del grosso et al 2008a b kim et al 2009 david et al 2008 ogle et al 2010 us epa 2015 zhang 2016 field et al 2018 nguyen et al 2018 2019 2 3 2 artificial neural networks there are many widely used metamodeling methods such as kriging polynomial functions artificial neural networks anns radial basis functions k nearest neighbor and support vector machines of these methods anns have been shown to be more suitable for cpu intensive applications like optimization because of their high accuracy and low prediction time i e the time needed to obtain new predictions villa vialaneix et al 2012 roy et al 2016 therefore in this analysis we employed anns to metamodel daycent using the input dataset generated by the ag ecosopt anns hopfield 1982 kohonen 1982 is a machine learning technique that mimics biological nervous systems such as the brain to identify patterns classification or to fit functions regression an elementary artificial neuron consists of five basic elements including inputs input weights an adder an activation a k a transfer function and an output the input values are multiplied by their weights and the weighted sum computed by the adder is fed to the activation function to generate the output which is propagated to other units in the ann the activation function limits the range of the output to some finite values and typically falls into one of three categories including linear threshold and sigmoid anns learn by adapting their input weights to identify the underlying input output relationships from a collection of training examples within a specific task domain haykin 1998 the multilayer feedforward neural networks a k a multilayer perceptrons mlp are the most widely studied and used neural networks in practice especially for supervised learning problems a typical mlp consists of at least three layers of neurons including an input layer one or more hidden layers of sigmoid neurons and an output layer of linear neurons fig 3 kaastra and boyd 1995 mlp training i e the network s weight optimization is commonly carried out using a gradient descent based algorithm known as backpropagation rumelhart et al 1986 or genetic algorithms such as individual based neural network genetic algorithm huse et al 1999 many studies have shown that mlp of one hidden layer with an adequate number of neurons can be trained to approximate any measurable function to any desired degree of accuracy hornik et al 1989 funahashi 1989 as a result our analysis used one hidden layer mlp and varied the number of neurons in the hidden layer via a sensitivity analysis to identify the best network 2 3 3 scope of metamodeling the high computation time of the ag ecosopt s landscape simulations could mainly be attributed to the daycent model initialization and forward simulations prior to any forward simulation daycent needs to be initialized for all farms in the landscape the model initialization consists of three simulation stages including spin up base and business as usual bau the spin up simulation 5 000 10 000 years defines the natural steady state for soil organic matter levels prior to any disturbance from human activities the base simulation up to hundreds of years extended from this native equilibrium state reflects the land condition following conversion to agricultural production this historical simulation is followed by a bau simulation 100 years which represents the land condition under the current management regime and is used to compare with forward simulations into the future the forward simulations extended from the bau condition model different predefined scenarios of changes in land use and or land management to support decision making this sequential model simulation is important for capturing the long term and cumulative effect of management practices soil properties and weather data on carbon and nitrogen dynamics although the model initialization is imperative it is repetitive for an area under different analyses therefore we carried out initialization simulations for the study region and stored the initialized results in our database as the initial conditions for the forward simulations metamodeling technique was employed to further reduce the computational burden of the forward simulations and thus increased the efficacy of large scale and complex landscape optimizations the scope of our metamodeling was to train an mlp to quickly and accurately predict the daycent s modeled soc corn grain and stover yields at farm level under the forward simulations 2 3 4 defining inputs and outputs structure since the soc level under the bau scenario had already approached a steady state due to a long history of cultivation it is important that soc under the alternative management scenarios be in a similar condition for fair comparison for that we used a time frame of 30 years for the forward simulations the time frame was selected to account for long term variations in weather data mesinger et al 2006 it also provided sufficient time for soil organic carbon to approach a new equilibrium after switching management practices from the bau scenario allowing for a fair comparison of soc and a thorough accounting of mean annual co2 emissions however this 30 year simulation duration using observed weather was not intended to represent the effects of projected climate change and increases in atmospheric co2 concentration which were outside the scope of our study the soc stock at the end of the forward simulation period and the 30 year average corn grain and stover yields were used as the output variables for metamodeling these variables are efficient to capture both the cumulative effects of changing management practices on soc dynamics and the seasonal variations of yields farm level soc was reported in mg of carbon per hectare while farm level corn grain and stover yields were reported in mg of dry matter d m per hectare per year assuming 43 5 carbon content and moisture content of 15 5 for corn grain and 20 for harvested stover gesch et al 2010 the daycent model s inputs were used as the input variables for metamodeling the primary inputs of daycent are daily maximum and minimum air temperature and precipitation soil properties for each horizon in the soil profile soil rooting depth land cover use data e g vegetation types land use history and management practices e g irrigation tillage fertilization to reduce the number of input variables for faster training of mlp soil property related input variables such as bulk density and textures were averaged across all soil layers daily min and max temperatures and daily precipitation were also aggregated into growing season values and then averaged over the forward simulation time frame 30 years before being used as inputs for mlp training the farm level soil organic carbon and soil nitrogen at the end of the bau simulations were used as the input variables that described the historical land management the list of the input variables used for our mlp metamodel building is given in the supplementary material s3 2 3 5 design of experiment the metamodel input variables were divided into two groups for sampling purposes including site specific and management specific input variables the site specific input variables described the intrinsic properties of corn fields such as average temperature and precipitation soil texture soil depth and historical conditions these variables related to a specific field did not change during the daycent forward simulations and thus were sampled based on their spatial locations management specific input variables refer to the nitrogen fertilizer irrigation and stover removal rates which were modulated during daycent forward simulations to measure the responses in farm level soc corn grain and stover yields they were sampled based on the design of an experiment in each corn field as presented below the site specific input data were acquired from several spatial databases including natural resource conservation service soil survey geographic database ssurgo nrcs usda 2014 the narr climate database mesinger et al 2006 u s irrigated land database pervez and brown 2010 and the national agricultural statistics service crop data layer nass cdl 2016 the shapefiles of these databases were then intersected to create input polygons of various sizes 1 ha representing 35 365 virtual irrigated corn fields in the study site fig 1 including 2707 unique combinations of soil and weather data daycent input strata these input strata were simulated with daycent to create the dataset for metamodeling using the procedure presented in our previous studies nguyen et al 2018 2019 we used the state average bau management practices reported by the usda agricultural resource management survey for colorado s irrigated corn crop which were 170 kg of nitrogen per hectare 34 cm of irrigated water per growing season 75 residue removal and conventional tillage ers arms 2010 to ensure balanced sampling of management specific input variables nitrogen fertilizer irrigation and residue removal rates were first stratified into lower and upper ranges based on the bau management practice levels and their corresponding lower and upper bounds these bounds were chosen to reflect the possible ranges for irrigated continuous corn in the region halvorson et al 2006 including 0 300 kg n ha 1 for nitrogen fertilization 0 70 cm year 1 for irrigation and 0 90 for stover removal we then sampled from these ranges assuming uniform distributions of the management specific input variables a 3 2 factorial design i e 3 management practices each at 2 levels was then employed for each daycent input strata in the landscape the sampling yielded 21 656 samples pairs of inputs output for the metamodeling all daycent simulations were conducted in parallel on an 18 node 216 processor cluster computing system at the natural resource ecology laboratory at colorado state university united states 2 3 6 developing the metamodel there are four main steps in developing an ann metamodel including data preprocessing network configuration training and testing maier et al 2010 first we normalized the input and output variables between 1 1 the normalization of input data increases the network training efficacy and prevents the saturation effect of large input values on activation functions li et al 2000 the ranges for data normalization depend on the activation functions used to configure neural networks for this analysis we used hyperbolic tangent sigmoid and linear activation functions for the hidden and output layers respectively the preprocessed data were then randomly partitioned without replacement into three subsets including training validation and test sets the training set was used to optimize network s weights and biases the validation set was used to prevent overfitting during network training early stopping prechelt 2012 and the test set was used to evaluate the performance of the trained network to reduce the training and prediction time of the metamodel we developed a nested mlp to predict three output variables simultaneously there is no apparent rule for mlp configuration for a specific problem and thus trial and error approach is often employed in practice maier and dandy 2000 for our study this approach was conducted via a sensitivity analysis of the number of input variables training ratio and number of neurons in the hidden layer to identify the best configuration of the mlp first we ran the relative importance analysis johnson and lebreton 2004 on the input variables using a simple configuration of mlp with ten hidden neurons the input variables were then added to the mlp training sequence in the descending order of their relative importance the relative importance refers to the proportional contribution of each input variable to explaining the variation in the output variables considering both its direct effects i e its correlation with the outputs and its effects when combined with the other input variables johnson and lebreton 2004 for each input variable the importance was calculated as the difference between the accuracy of the full model i e including all input variables and the mean accuracy of all submodels that excluded the input variable of interest the values were normalized against each other so that they sum up to 100 in our study the relative importance analysis was carried out based on the method explained in detail in ibm corp 2015 the training ratio defines the percentage of the input dataset that is used to train the mlp to reduce the training time of the mlps we only varied the training ratio from 10 to 70 incremented by a step of 20 the test set was kept at 20 of the total sample size in all cases the number of neurons was varied between 5 and 60 with an incremental step of 5 the configured mlps were initialized with random weights sampled from a gaussian distribution and were trained using levenberg marquardt backpropagation marquardt 1963 for 500 epochs training iterations using neural network toolbox in matlab software matlab and neural network toolbox 2017 other parameters of the training algorithm were kept at their default values our goal for mlp training was to minimize the mean squared errors mse of the training set msetrain 0 the training stopped if one of the following conditions was met 1 the number of training iteration exceeds 500 2 the mse of training set equates zero 3 the magnitude of the error gradient is less than 10 7 and 4 mse of the validation set has increased more than 6 training iterations since the last time it decreased early stopping prechelt 2012 the performance of the trained mlp was evaluated using the test set based on the coefficient of determination r2 and mse one of the drawbacks of the backpropagation training algorithm is that the network might be trapped in some local minima especially for non smooth error surfaces maier et al 2010 therefore mlp training with different random weights initialization can result in variation in the model accuracy to rectify this problem each mlp configuration was trained 10 times using different random weight initialization and the performance means were compared the final surrogate model was selected based on a balance among metamodel accuracy training and prediction time 2 3 7 testing the spatial distribution of prediction errors it is important that surrogate models are tested based on their domains of use marie and simioni 2014 since our objective was to use the selected surrogate model to construct the objective and constraint functions for the farm level optimization of management practices for irrigated corn in colorado we calculated the root mean squared errors rmse between the surrogate model predictions and the daycent s outputs for each corn farm the rmse was computed based on 216 random samples of management practices per farm the farm level rmse were then visualized for the whole landscape via maps to identify the spatial pattern of metamodeling uncertainty as well as locations of extreme errors 3 results 3 1 model accuracy our results indicated a high accuracy of the surrogate models with appropriate configuration and training fig 4 the minimum root mean squared error rmse of the test sets for different mlp configurations varied from 0 4 to 4 1 mg c ha 1 for f soc 0 3 3 3 mg d m ha 1 year 1 for f grain 0 2 2 4 mg d m ha 1 year 1 for f stover fig 4a these corresponded to the test set r2 of 73 6 99 5 1 7 99 4 and 0 8 99 3 respectively fig 4b the performance of the surrogate models was more sensitive to the variations in the numbers of input variables and hidden neurons compared to those of training ratio improvements in the surrogate accuracy when configuring the mlps with more than four input variables or 25 hidden neurons came with significant increases in training and prediction time these metrics depicted the number of seconds taken to train an mlp and to conduct one million predictions using the trained surrogate model respectively under the stop rules for mlp training defined in section 2 3 6 an mlp took from 2 s to over 15 min to train and required less than 1 3 s for one million predictions the final surrogate model that balances between metamodeling accuracy i e test set r2 for all targets were greater than 99 and prediction time i e fastest is presented in table 1 other details including regression plots and mlp s weight and bias configuration are available in the supplementary material s4 the final surrogate model exhibited high accuracy with the rmse less than 0 46 mg c ha 1 0 25 mg d m ha 1 year 1 and 0 33 mg d m ha 1 year 1 for f soc f stover and f grain respectively the gain in simulation time was substantial compared to the original daycent model while the daycent took about 59 6 0 33 days extrapolated from 5 15 0 33 s per simulation n 10 for one million simulations on a quad core i7 cpu 2 20 ghz and 12gb ram its surrogate model only required 0 83 0 08 s on the same setup this indicated that the surrogate model was about 6 2 million times faster for our analysis 3 2 input variable importance and dependence the bau s soc and management practices appeared to be the most important variables in the surrogate model table 2 the importance was defined as the reduction in prediction accuracy i e increase in mse when comparing the mse of the complete model with all input variables to the average of mse of all submodels that excluded the input variable of interest this result confirmed the diminishing effect of increasing input variables on accuracy improvement fig 4 the dependence plot of the first four most important input variables indicated that the output variables responded to variation in input variables in expected trends but with different magnitudes fig 5 the effects of varying bau s soc and residue removal rate on the output variables were quite linear while those of nitrogen fertilizer and irrigation followed convex curves indicating diminishing management effects at higher investments of management practices f soc seemed to be more influenced by changes in its initial value whereas f stover and f grain responded with higher magnitudes under variation in residue removal and nitrogen fertilization and irrigation respectively 3 3 spatial variation of the predictive errors the spatial distributions of the rmse between daycent simulated outputs and surrogate model predictions indicated a high accuracy of the surrogate model throughout the landscape fig 6 the 95th percentiles of the rmse for the prediction of f soc f stover and f grain were 0 77 mg c ha 1 0 37 mg d m ha 1 year 1 and 0 53 mg d m ha 1 year 1 respectively the maps of rmse spatial distributions revealed higher concentration of sites with lower accuracy levels i e rmse above 95th percentiles around areas west of the city of greeley and east of the town of sterling although our exploratory analysis did not reveal any specific correlation between the input variables and the errors supplementary material s6 it might suggest that the aggregation of input variables for more efficient metamodeling was not efficient in explaining potential seasonal variations of output variables for certain regions in the landscape 3 4 farm level optimization of profits optimization of management practices at the farm level improved average farm profits by 83 150 average soc by 16 53 average grain by 10 1 11 3 and reduced average ghg emissions by 19 55 compared to the bau scenario table 3 the improvements of average farm profits were due to the lowered average farm production fixed costs of no till 9 1 and the higher biomass production 10 26 attained by the optimally chosen fertilization and irrigation as we imposed higher farm level soc constraints our model reduced irrigation and residue removal rates to satisfy the soc constraints while increasing nitrogen fertilization rate to improve biomass production for farm profits maximization residue removal rate was decreased to below the bau s level at the f soc constraint greater than 20 while both soc accumulation and ghg emissions reduction were significantly improved under all soc constrained scenarios compared to the bau scenario nitrogen leaching was slightly increased by 3 14 due to higher fertilization and irrigation rates when switching from conventional tillage to no till under the bau scenario bau nt we observed 54 and 24 increases in farm profits and soc and 31 and 32 decreases in ghg emissions and nitrogen leaching respectively 3 5 feasible value ranges and improvement regions of landscape constraints at landscape scale the feasible value ranges of soc irrigation water and grain ranged from 7 42 to 10 15 106 mg c year 1 1 29 1 44 109 m3 year 1 and 2 48 3 45 106 mg d m year 1 respectively table 4 the base landscape constraints of soc and grain fell between their feasible ranges while the base constraint of irrigation water use laid above its feasible range this indicated that the empirical irrigation constraint had been satisfied through profit optimizations at farm level therefore for the landscape multi objective optimization we re set irrigation constraint to the mean of its feasible value range 1 36 109 m3 year 1 while maintaining soc and grain constraints at their empirical values of 8 19 106 mg c year 1 and 3 34 106 mg d m year 1 respectively 3 6 pareto trade offs of landscape level optimization the pareto surface of trade offs among landscape sums of stover ghg emissions and nitrogen leaching for irrigated corn production in eastern colorado had a bowed shape revealing three different trade off patterns between different pairs of landscape objectives fig 7 while stover and ghg emissions displayed a straight forward linear relation fig 7d nitrogen leaching related trade offs showed more complicated relationships with a concave stover vs nitrogen leaching pareto frontier fig 7b and a convex ghg vs nitrogen leaching pareto frontier fig 7c under the base landscape constraints the maximum amount of stover that could be produced was 2 35 106 mg d m year 1 bearing the highest impacts on the ecosystem at 14 37 103 mg n year 1 for nitrogen leaching and 57 104 mg co2e year 1 for ghg emissions improving the environmental performance of the ecosystem was achieved at the trade off on stover the minimum ghg emissions and nitrogen leaching was 33 50 104 mg co2e year 1 and 11 95 103 mg n year 1 corresponding to the stover production of 0 83 minimum and 0 96 106 mg d m year 1 respectively the landscape sum of profits was linearly correlated with stover production reaching the maximum of 106 89 106 year 1 at the maximum stover production level and the minimum of 80 63 106 year 1 at 0 87 106 mg d m year 1 of stover 33 90 104 mg co2e year 1 of ghg emissions and 12 02 103 mg n year 1 of nitrogen leaching our results indicated that more favorable trade offs occurred below the stover production level of 2 2 106 mg d m year 1 this corresponded to an average farm level stover production of 7 4 mg d m ha 1 year 1 or an average farm level residue removal rate of 72 raising the landscape constraints i e higher soc and grain and lower irrigation water use worsened the stover nitrogen leaching and ghg emissions objectives fig 7 maximum soc and grain production and irrigation water saving were obtained at the stover production levels below 1 1 106 mg d m year 1 below an average farm level residue removal rate of 38 and fell far in the sub optimal regions of the stover nitrogen leaching and ghg emissions trade off frontiers the mean cir are scenarios where one of the constraints were set to the mean of its improvement region while keeping other constraints at their base values we found that the mean cir of soc and irrigation water saving were achieved mainly by decreasing farm level stover removal rate by about 17 18 table 5 thus resulting in decreased stover production the landscape trade off showed that we could improve soc and reduce irrigation water use to a certain extent without affecting either food production or environmental performance of the ecosystem by targeting lower stover production goals in contrast although improving food production mean cirgrain did not greatly reduce stover or increase ghg emissions it significantly increased nitrogen leaching by 6 10 as shown by the shifting of the green dotted lines to the right of the base constraint pareto frontiers fig 7b the increase in nitrogen leaching under this scenario compared to the base scenario was due to a higher application of both nitrogen fertilizer by 1 7 and irrigation by 2 3 table 5 the summary of landscape trade offs among production constraints and optimization objectives was given in the supplementary material s7 3 7 optimal stover harvest fig 8 shows an example of optimized landscape configurations of farm level residue removal rate at different landscape pareto trade off levels among stover production ghg emissions and nitrogen leaching under the base landscape constraints to increase stover production farm level residue removal rate was first increased in the areas around the towns of yuma sterling and greeley and then the areas around burlington and lamar this revealed that more stover could be produced with less environmental impacts i e lower environmental footprints in the upper part compared to the lower part of the study region 4 discussion the results of our analysis could be used to support decision making at multiple levels at local levels farmers the direct decision makers of agricultural ecosystems could be informed with the optimum levels of resource investment to maximize farm profits and improve soil carbon storage farmers could also adjust their management decisions based on the quantitative trade offs among different ecosystem services e g carbon storage and food and biomass production and disservices e g ghg emissions and nitrogen leaching this increases farm level efficiency and sustainability furthermore as farm level environmental performance was made available farmers could be encouraged to incorporate these metrics in their farm planning and budgeting allowing more thorough state wide agricultural statistic reports at regional levels our results could be used to support several applications such as life cycle assessment and supply chain optimization of first and or second generation biofuel production biorefinery sitting and feedstock landscape optimization they could also be aggregated into county level or state level assessments to support policy making and regional planning for example different stover removal rates could be recommended for different counties to approximate an optimal trade off level among food and biomass production carbon storage and environmental impacts an example is given in supplementary material s8 as argued by levin 1992 the problem of pattern and scale in ecology and ecosystem science is to understand the simultaneous changes that are taking place on many scales with significant reductions in computation time as exampled by our study metamodeling allows a model to be used at larger scales to explore the spatial and temporal dynamics of interactions among ecosystem processes while retaining the fine scale granularity of the ecosystem properties this advantage also makes it feasible to conduct simulation expensive applications like sensitivity analysis and optimization which were conventionally impractical for the original complex models in many cases while our study demonstrated the metamodeling of the daycent model for an agricultural landscape optimization our framework would be equally applicable for other ecosystem models as well as optimization problems at different scales realizing that the complexity of such a modeling framework might hinder its practical use we automated the workflow and incorporated it into our ag ecosopt system to facilitate future analyses in addition efforts are being made to integrate other metamodeling techniques and optimization algorithms for more dynamic applications of our modeling platform despite the potential advantages of the framework we do realize some drawbacks in the methodology first the computational burden of the metamodeling process was substantial generating the dataset for metamodeling required the use of a cluster computing system while we could argue that the surrogate model could be trained once for different analyses this computational burden might still challenge the adoption of our metamodeling framework especially when the computing infrastructure is not available for a large number of original model simulations however our results showed that the training ratio did not significantly affect surrogate model performance fig 4 a b this indicated that we could have decreased the sample size to reduce the computational burden of dataset generation as well as the mlp training time for this space filling sampling techniques like latin hypercube design alam et al 2004 could be used in place of the full factorial design employed by our study although the training time of each mlp configuration ranged from a couple of seconds to 15 min optimization of mlp configuration via sensitivity analysis required thousands of iterative mlp trainings which was time consuming since our results suggested that a slight increase in accuracy could come with a considerable increase in training and prediction time fig 4 we could set the msetrain training goal at a certain level above zero instead of zero to stop mlp training earlier in addition the maximum number of neurons in the hidden layer could be reduced in future studies by training a surrogate model for a single crop in a small region we had reduced the crop specific input variables and many other site and management specific input variables such as planting dates and fertilization timing this improved the efficiency of the surrogate model fig 4a also suggests that training mlp with more than four input variables did not significantly improve the surrogate model accuracy this implied that other input reduction techniques such as principal component analysis could be used to decrease the number of input variables thus lowering the training time the mlp prediction time could also be improved if farm profits i e the farm level objective function were directly metamodeled in our study simulated corn grain and stover yields were first metamodeled and then used to calculate farm profits while this approach allowed a more flexible use of the surrogate model to address changes in economic factors such as commodity prices it slightly increased the prediction time by 8 the optimizations required more than 24 h on a quad core i7 cpu for both farm and landscape levels for applications where time saving is more crucial reducing intermediate steps is recommended to improve optimization efficiency to further reduce optimization time we equipped the ag ecosopt with the ability to use the parallel computing toolbox in matlab for simultaneous simulation of multiple farm level optimization instances when resources are available our analysis was subject to several sources of uncertainty by nature surrogate models inherit the uncertainties of the original models which are those from model input parameters and structure in addition surrogate models suffer from their own structural uncertainty which was measured as the errors between predicted outputs and the modeled outputs the latter was quantified in our study for surrogate model selection there were also other uncertainties associated with the optimization process such as those of economic data these uncertainties would propagate through the system and should be reflected in the output to inform decision makers while the quantification of uncertainty is valuable to decision making such analysis is difficult to include in regional assessments such as this due to a limited amounts of empirical data against which to validate model function and b the highly computational intensive nature of such operations these challenges are significant enough to fall outside the scope of our study and merit separate thorough studies however we note that meaningful sensitivity and uncertainty analysis is only possible after a system has been initially characterized and the important potential feedbacks and dependencies identified it is also important to note that the surrogate model should not be used outside of the domain for which it was designed in our analysis the mlp was trained for irrigated corn in eastern colorado with certain bounds of management specific input variables the use of the surrogate model for other corn growing regions or beyond the management practice bounds is not recommended in these cases one should follow the framework described in this study to construct and thoroughly test surrogate models before employing them for their specific study constructing a robust surrogate model to be used over larger areas and to predict several outputs for many crop species would improve the generalization of the metamodeling this could also encourage studies of broader scopes on larger scales to support strategic decision making processes however such an effort requires laborious data acquisition and processing as well as comprehensive experimental designs that encompass all possible input distributions furthermore a generic surrogate is likely to be bulky and slow and thus is inefficient for simulation intensive applications like optimization alternatively simplified surrogate models developed for specific problems like ours are more efficient for local and operational decision making our future efforts will focus on building more generic surrogate models for different crops in the u s as well as extending the ag ecosopt s database to facilitate the adoption of our framework for similar resource optimization problems although multi level and multi objective optimization at high spatial resolutions is supposed to support decision making processes we found that communicating the results of such optimization to stakeholders and decision makers is a big challenge complicated optimization problems like ours could result in thousands of graphs tables and maps which would be difficult to present through traditional communication means such as reports and scientific papers the use of web mapping applications allows integrated and customized presentations of information at different scales serving the needs of multiple stakeholders such applications will also permit the involvement and feedback from stakeholders for more practical and operational analyses the future development of ag ecosopt platform will focus on building a web mapping application to facilitate the visualization of analyses that employed our platform 5 conclusion in this study we demonstrated the use of metamodeling techniques in a surrogate based optimization framework for decision support in agricultural resource management for this we conducted a case study to optimize the management practices of irrigated corn production systems in colorado the optimization explored the trade offs among seven objectives at farm and landscape scales including farm profits irrigation water use corn grain corn stover soc ghg emissions and nitrogen leaching the mlp a feedforward artificial neural network was employed to create a surrogate of the daycent biogeochemical model the surrogate model was used to create the objective and constraint functions for farm level optimization outputs from farm level optimization were then used to generate scenarios for landscape level optimization the optimizations were subject to certain constraints in soil carbon storage food production and irrigation water use our results showed that the surrogate model was able to capture above 99 variations in the simulated farm level soc corn grain and stover yields in addition it was 6 2 million times faster than the daycent model and was suitable for use in computationally intensive applications like sensitivity analysis and optimization optimizing management practices at the farm level improved average farm profits by 83 150 soc by 16 53 grain yield by 10 1 11 3 and reduced ghg emissions by 19 55 while slightly increasing nitrogen leaching by 3 14 landscape level optimization indicated that average farm level stover removal rate for optimal trade offs among corn stover production ghg emissions and nitrogen leaching should be below 72 the optimal stover removal rates were also visualized for each corn farm to illustrate the landscape configuration of management practices to obtain certain level of trade offs we discussed the advantages and disadvantages of our surrogate based optimization framework as well as the potential to couple our framework with web mapping applications to facilitate better communication of high spatial resolution optimization results to decision makers we believe that this combination would encourage the participation and feedback from stakeholders for more practical and operational optimization analyses to support decision making in sustainable resource management acknowledgements the work was supported by a usda nifa project grant 2011 67009 30083 decision support tool for integrated biofuel greenhouse gas emission footprints the fulbright vietnam scholarship the multidisciplinary approaches to sustainable bioenergy phd program funded by the united states national science foundation hue university of agriculture and forestry vietnam huaf and shell technology center houston the authors thank dr christian davies at shell technology center houston and colleagues at the natural resource ecology laboratory nrel for advice model training and data sources appendix a supplementary data supplementary material related to this article can be found in the online version at doi https doi org 10 1016 j ecolmodel 2019 02 018 appendix a supplementary data the following is supplementary data to this article 
25079,we demonstrate the use of a surrogate based optimization framework for large scale and high resolution landscape management optimization using irrigated corn production systems in eastern colorado usa as a case study an artificial neural network was employed to create a surrogate of the daycent biogeochemical simulation model our optimization considered trade offs among seven different objectives at different scales including farm profits irrigation water use corn grain corn stover soil organic carbon soc greenhouse gas ghg emissions and nitrogen leaching the results show that the surrogate captured greater than 99 of the variations in the daycent s simulated outputs and was 6 2 million times faster than the daycent model for our analysis farm level optimization increased farm profits by 83 150 soc by 16 53 grain yield by 10 1 11 3 and reduced ghg emissions by 19 55 compared to the business as usual scenario keywords surrogate based optimization metamodeling artificial neural networks ecosystem services multi objective optimization daycent model 1 introduction modern agricultural ecosystems need to be managed for many competing objectives such as food and fiber production carbon storage climate change mitigation water quality improvement and biodiversity conservation due to the resource constraints e g land water nutrients technology capital and labor in agricultural production simultaneously achieving all of these management goals is not possible however multi objective optimization techniques can be used to inform decision makers about potential trade offs among multiple management objectives and a suite of management decisions to achieve a specific trade off level a multi objective optimization typically generates a set of pareto optimal solutions also called non dominated solutions where any improvement in one objective always impairs some others such optimizations are often carried out via simulation based optimization approaches which couple a single or a bundle of simulation models to quantify ecosystem responses with mathematical optimization algorithms to identify the trade off surface wu et al 2016 however despite a significant improvement of computing power over recent decades computational limitations remain a major barrier to the effective and systematic implementation of this approach especially when process based simulation models are employed for large scale analyses in a high resolution and spatially explicit manner lardy et al 2014 the use of process based ecosystem models provides an efficient and non intrusive means to quantify ecosystem processes and their continuous interactions with decision making nguyen et al 2018 simulation based optimizations are often carried out via scenario analysis for which a set of scenarios first needs to be formulated and fed to an ecosystem model for exploratory simulations the results can then be optimized to choose the one that best fits the management goals this approach helps improve the decision making process but does not guarantee actual optima since solutions are forced to some discrete options besides the formulation of management scenarios and comparison of the simulated results can be time consuming laborious and highly expertise driven seppelt and voinov 2002 another disadvantage of simulation based optimizations is that using ecosystem models for large scale simulations often requires a high computational power with clusters of superpower machines this computational burden is magnified when finer spatial resolutions e g field and sub field scales and more detailed changes in management practices e g scheduling of fertilization irrigation and tillage are considered in addition the consideration of many decision variables for robust and operational optimization in agricultural resource management can result in very large solution search spaces which require substantial time and resources to find solutions these challenges make simulation based optimization approaches extremely costly and time consuming consequently the use of process based simulation models for detailed large scale landscape optimization is impractical in most institutional contexts that require timely analysis to support rational decision making ma 2005 one potential solution to overcome the inefficiency of process based ecosystem models in optimization frameworks while maintaining acceptable prediction accuracies is to employ surrogate based optimization approaches ratto et al 2012 these approaches use meta modeling techniques to substitute the high fidelity models within an optimization framework with a simplified surrogate model to reduce simulation time expertise requirement and data storage wu et al 2016 a surrogate is a simplified model of a detailed model that highlights specific properties of the original detailed model meta modeling is a data driven approach which involves fitting a response surface to approximate the relationship between multiple input variables and a target output the replacement of complex models with their surrogates brings many practical benefits simpson et al 2001 first the operation of surrogate models is highly cost effective due to the reduction in the simulation time and data storage requirement second they can easily be applied across different spatial and or temporal scales with high accuracy providing the data corresponding to the new system parameterization are available third with a higher level of flexibility and adaptability surrogate models can be integrated into other processes and simulation platforms to achieve a variety of simulation goals such as prediction optimization validation and sensitivity analysis although surrogate based optimization has been widely used in mechanical engineering for a considerable time osio and amon 1996 its application in ecosystem research is more recent castelletti et al 2012 surrogate models have been employed in various studies such as those studying land use and nitrogen fertilizer use distribution audsley et al 2008 pesticide leaching stenemo et al 2007 air quality carnevale et al 2012 n2o and nitrogen leaching villa vialaneix et al 2012 and groundwater roy et al 2016 however incorporating these models into optimization frameworks to support decision making is less common with most applications to date dealing with water resource management such as conjunctive surface and ground water use wu et al 2016 and coastal aquifer management kourakos and mantoglou 2013 song et al 2018 despite the on going development of surrogate based optimization approaches to the best of our knowledge there have been no studies that have applied these approaches for large scale agricultural landscape optimization considering multiple stakeholders and ecosystem services at high spatial and temporal resolutions our study aims to demonstrate the use of a surrogate based optimization framework for spatially explicit trade off analyses in agricultural landscapes to support resource management decision making we present our framework with a case study on optimization of the landscape design of management practices for irrigated corn production systems in colorado usa the optimization considered the trade offs among farm profits irrigation water use and several ecosystem services at a high spatial resolution field scale with detailed consideration of historical land use dating back to the 1880s 2 case study and method 2 1 study site our study focused on the irrigated corn growing area in eastern colorado usa fig 1 the whole area is 298 897 ha with a majority of fine loamy soils like many other agricultural states agriculture in colorado is subject to trade offs among food and biomass production greenhouse gas emissions and water pollution from excessive fertilizer run off strange et al 1999 the allocation of limited water resources to meet the needs of agricultural production and municipal and industrial development is also a challenge to the state water conservation board 2010 in addition the potential use of crop residues for ligno cellulosic biofuels production in the region presents another trade off between harvestable residues and long term soil health wilhelm et al 2007 the complexity and the multidimensional nature of these trade offs necessitate multi objective optimizations of land management decisions at different levels farm and landscape to improve the efficiency of resource allocation and minimize negative impacts on the environment while meeting future demands 2 2 method overview and optimization problem statement the main goals of this case study were to identify optimal management practices and their spatial configuration for the trade offs among seven management objectives for irrigated corn production systems in eastern colorado these objectives consisted of farm profits irrigation water use and five ecosystem services including food and biomass production soil carbon storage water quality and climate regulation the optimization assumed farmers objectives of maximizing farm profits and a regional planner s multi objectives for maximization of ecosystem services to quantify the ecosystem services we used 1 corn grain and stover to represent food and biomass production 2 soil organic carbon soc to represent ecosystem carbon storage 3 greenhouse gas ghg emissions to represent climate regulation and 4 nitrogen leaching to represent water quality for solvability purpose we structured our analysis as a two level optimization problem including farm and landscape levels the farm level optimizations were carried out in advance to provide the inputs for the landscape level optimization for clarity hereafter we refer to the farm level metrics with a prefix f e g f soc and f profits while the landscape sum of farm level values i e sum of all farms in the landscape will be referred to with a prefix l e g l soc and l profits at the farm level we optimized management practices to maximize profits subject to multiple soc constraints this constraint defines the percentage increase in f soc due to changes in management practices relative to a business as usual bau scenario that the optimization needs to archive and was used as a proxy for long term soil health arshad and martin 2002 we varied the f soc constraint value between 0 and 50 incrementing by 10 in other words each farm in the landscape was optimized six times corresponding to six levels of the f soc constraint the management practice decision variables considered in our analysis were nitrogen fertilization kg n ha 1 irrigation cm year 1 and residue removal rates no till was assumed for all corn fields in this analysis artificial neural networks ann were employed to create a surrogate model of the process based daycent agroecosystem simulation model del grosso et al 2002 the ann surrogate was used to rapidly predict farm level soc corn grain and stover yields as functions of farm management practices and other site specific variables the predicted yields and soc were then used to compute the objective f profits and constraint percentage change in f soc functions respectively the farm level optimization was formulated as a single objective continuous bounded and non linear programming problem and was iteratively solved for different levels of f soc constraint using fmincon solver with interior point algorithm byrd et al 1999 in the optimization toolbox of matlab software matlab and optimization toolbox 2017 at the landscape level we carried out a combinatorial multi objective optimization based on the outcomes from farm level optimizations using the ε constraint methods haimes et al 1971 for this the optimized farm level management practices were simulated with the agricultural ecosystem service optimization system ag ecosopt nguyen et al 2018 to derive the dataset for the landscape level optimization we then identified the f soc constraint that should be applied for each farm in the landscape to maximize l stover while minimizing of l ghg emissions and l nitrogen leaching landscape level optimization was required to maintain the current production levels of grain and soc while reducing the current irrigation water use these current levels were obtained from empirical or simulated data the most recent census of u s agriculture by the national agricultural statistics service nass in 2012 reported about 3 34 106 mg d m year 1 of grain and 1 50 109 m3 year 1 of irrigation water use for our defined landscape nass 2012 for l soc since reported data were not available at the state level we used the simulated landscape sum of f soc under the farm scale bau scenario with tillage adjusted from conventional to no till switching the tillage under the bau scenario was consistent with the tillage assumption of the optimization while placing a more conservative constraint on l soc for sustainability these reported simulated values of l grain l irrigation water use and l soc were set as the base constraint values for the landscape multi objective optimization we also varied the landscape constraint values to examine how improvements in grain production soc accumulation and irrigation water saving affected the pareto trade offs among the landscape objectives i e l stover production l ghg emissions and l nitrogen leaching reductions the ranges between the base constraint values and either the maximum values of grain and soc or the minimum value of irrigation water use were defined as the constraint improvement region cir see details in supplementary material s1 this was because setting the constraint values along these ranges resulted in either increases in grain and soc or decreases in irrigation water use i e an improvement to examine the effects of improvements in the constraint metrics on the landscape multi objective optimization we separately varied each constraint value along its cir and observed the changes in the resulting pareto frontiers an overview of our surrogate optimization framework is presented in fig 2 the details on the metamodeling method are presented in the following sections while those on optimization and metric calculation are available in supplementary material s1 s2 2 3 metamodeling for farm level optimization 2 3 1 agricultural ecosystem service optimization tool the ag ecosopt tool was used to simulate corn grain and stover yields and farm level soc to generate the input dataset for metamodeling the tool is comprised of the daycent biogeochemical model del grosso et al 2002 a database of historical land use for u s cropland ogle et al 2010 a geospatial component for spatially explicit processing of inputs and outputs and an optimization component several optimization algorithms such as min max hwang et al 1980 weighted sum fishburn 1967 and ε constraint haimes et al 1971 were included in ag ecosopt to optimize daycent s simulation outputs for land use and land management decision making the daycent model is a daily time step process based model that simulates biogeochemical flows of carbon nitrogen and water among the atmosphere vegetation and soil in many different ecosystems daycent simulates plant growth as a function of solar radiation temperature soil water nutrient availability and plant phenology metherell et al 1993 grain yield and harvested residue biomass are calculated from the aboveground carbon based on a crop specific harvest index and a user defined residue removal rate respectively the model captures the effects of extreme events such as frosts droughts and heat stresses on crop growth and yield extreme weather conditions might kill crops early or late in a growing season or affect their growth rate and yield surface litter pools and the soil organic matter som of the top soil layer 0 20 cm are represented dynamically as functions of substrate availability substrate quality lignin content c n ratio soil texture temperature water availability and tillage intensity daycent has been previously used to predict crop yields soil carbon dynamics and ghg emissions in various us agricultural systems e g del grosso et al 2008a b kim et al 2009 david et al 2008 ogle et al 2010 us epa 2015 zhang 2016 field et al 2018 nguyen et al 2018 2019 2 3 2 artificial neural networks there are many widely used metamodeling methods such as kriging polynomial functions artificial neural networks anns radial basis functions k nearest neighbor and support vector machines of these methods anns have been shown to be more suitable for cpu intensive applications like optimization because of their high accuracy and low prediction time i e the time needed to obtain new predictions villa vialaneix et al 2012 roy et al 2016 therefore in this analysis we employed anns to metamodel daycent using the input dataset generated by the ag ecosopt anns hopfield 1982 kohonen 1982 is a machine learning technique that mimics biological nervous systems such as the brain to identify patterns classification or to fit functions regression an elementary artificial neuron consists of five basic elements including inputs input weights an adder an activation a k a transfer function and an output the input values are multiplied by their weights and the weighted sum computed by the adder is fed to the activation function to generate the output which is propagated to other units in the ann the activation function limits the range of the output to some finite values and typically falls into one of three categories including linear threshold and sigmoid anns learn by adapting their input weights to identify the underlying input output relationships from a collection of training examples within a specific task domain haykin 1998 the multilayer feedforward neural networks a k a multilayer perceptrons mlp are the most widely studied and used neural networks in practice especially for supervised learning problems a typical mlp consists of at least three layers of neurons including an input layer one or more hidden layers of sigmoid neurons and an output layer of linear neurons fig 3 kaastra and boyd 1995 mlp training i e the network s weight optimization is commonly carried out using a gradient descent based algorithm known as backpropagation rumelhart et al 1986 or genetic algorithms such as individual based neural network genetic algorithm huse et al 1999 many studies have shown that mlp of one hidden layer with an adequate number of neurons can be trained to approximate any measurable function to any desired degree of accuracy hornik et al 1989 funahashi 1989 as a result our analysis used one hidden layer mlp and varied the number of neurons in the hidden layer via a sensitivity analysis to identify the best network 2 3 3 scope of metamodeling the high computation time of the ag ecosopt s landscape simulations could mainly be attributed to the daycent model initialization and forward simulations prior to any forward simulation daycent needs to be initialized for all farms in the landscape the model initialization consists of three simulation stages including spin up base and business as usual bau the spin up simulation 5 000 10 000 years defines the natural steady state for soil organic matter levels prior to any disturbance from human activities the base simulation up to hundreds of years extended from this native equilibrium state reflects the land condition following conversion to agricultural production this historical simulation is followed by a bau simulation 100 years which represents the land condition under the current management regime and is used to compare with forward simulations into the future the forward simulations extended from the bau condition model different predefined scenarios of changes in land use and or land management to support decision making this sequential model simulation is important for capturing the long term and cumulative effect of management practices soil properties and weather data on carbon and nitrogen dynamics although the model initialization is imperative it is repetitive for an area under different analyses therefore we carried out initialization simulations for the study region and stored the initialized results in our database as the initial conditions for the forward simulations metamodeling technique was employed to further reduce the computational burden of the forward simulations and thus increased the efficacy of large scale and complex landscape optimizations the scope of our metamodeling was to train an mlp to quickly and accurately predict the daycent s modeled soc corn grain and stover yields at farm level under the forward simulations 2 3 4 defining inputs and outputs structure since the soc level under the bau scenario had already approached a steady state due to a long history of cultivation it is important that soc under the alternative management scenarios be in a similar condition for fair comparison for that we used a time frame of 30 years for the forward simulations the time frame was selected to account for long term variations in weather data mesinger et al 2006 it also provided sufficient time for soil organic carbon to approach a new equilibrium after switching management practices from the bau scenario allowing for a fair comparison of soc and a thorough accounting of mean annual co2 emissions however this 30 year simulation duration using observed weather was not intended to represent the effects of projected climate change and increases in atmospheric co2 concentration which were outside the scope of our study the soc stock at the end of the forward simulation period and the 30 year average corn grain and stover yields were used as the output variables for metamodeling these variables are efficient to capture both the cumulative effects of changing management practices on soc dynamics and the seasonal variations of yields farm level soc was reported in mg of carbon per hectare while farm level corn grain and stover yields were reported in mg of dry matter d m per hectare per year assuming 43 5 carbon content and moisture content of 15 5 for corn grain and 20 for harvested stover gesch et al 2010 the daycent model s inputs were used as the input variables for metamodeling the primary inputs of daycent are daily maximum and minimum air temperature and precipitation soil properties for each horizon in the soil profile soil rooting depth land cover use data e g vegetation types land use history and management practices e g irrigation tillage fertilization to reduce the number of input variables for faster training of mlp soil property related input variables such as bulk density and textures were averaged across all soil layers daily min and max temperatures and daily precipitation were also aggregated into growing season values and then averaged over the forward simulation time frame 30 years before being used as inputs for mlp training the farm level soil organic carbon and soil nitrogen at the end of the bau simulations were used as the input variables that described the historical land management the list of the input variables used for our mlp metamodel building is given in the supplementary material s3 2 3 5 design of experiment the metamodel input variables were divided into two groups for sampling purposes including site specific and management specific input variables the site specific input variables described the intrinsic properties of corn fields such as average temperature and precipitation soil texture soil depth and historical conditions these variables related to a specific field did not change during the daycent forward simulations and thus were sampled based on their spatial locations management specific input variables refer to the nitrogen fertilizer irrigation and stover removal rates which were modulated during daycent forward simulations to measure the responses in farm level soc corn grain and stover yields they were sampled based on the design of an experiment in each corn field as presented below the site specific input data were acquired from several spatial databases including natural resource conservation service soil survey geographic database ssurgo nrcs usda 2014 the narr climate database mesinger et al 2006 u s irrigated land database pervez and brown 2010 and the national agricultural statistics service crop data layer nass cdl 2016 the shapefiles of these databases were then intersected to create input polygons of various sizes 1 ha representing 35 365 virtual irrigated corn fields in the study site fig 1 including 2707 unique combinations of soil and weather data daycent input strata these input strata were simulated with daycent to create the dataset for metamodeling using the procedure presented in our previous studies nguyen et al 2018 2019 we used the state average bau management practices reported by the usda agricultural resource management survey for colorado s irrigated corn crop which were 170 kg of nitrogen per hectare 34 cm of irrigated water per growing season 75 residue removal and conventional tillage ers arms 2010 to ensure balanced sampling of management specific input variables nitrogen fertilizer irrigation and residue removal rates were first stratified into lower and upper ranges based on the bau management practice levels and their corresponding lower and upper bounds these bounds were chosen to reflect the possible ranges for irrigated continuous corn in the region halvorson et al 2006 including 0 300 kg n ha 1 for nitrogen fertilization 0 70 cm year 1 for irrigation and 0 90 for stover removal we then sampled from these ranges assuming uniform distributions of the management specific input variables a 3 2 factorial design i e 3 management practices each at 2 levels was then employed for each daycent input strata in the landscape the sampling yielded 21 656 samples pairs of inputs output for the metamodeling all daycent simulations were conducted in parallel on an 18 node 216 processor cluster computing system at the natural resource ecology laboratory at colorado state university united states 2 3 6 developing the metamodel there are four main steps in developing an ann metamodel including data preprocessing network configuration training and testing maier et al 2010 first we normalized the input and output variables between 1 1 the normalization of input data increases the network training efficacy and prevents the saturation effect of large input values on activation functions li et al 2000 the ranges for data normalization depend on the activation functions used to configure neural networks for this analysis we used hyperbolic tangent sigmoid and linear activation functions for the hidden and output layers respectively the preprocessed data were then randomly partitioned without replacement into three subsets including training validation and test sets the training set was used to optimize network s weights and biases the validation set was used to prevent overfitting during network training early stopping prechelt 2012 and the test set was used to evaluate the performance of the trained network to reduce the training and prediction time of the metamodel we developed a nested mlp to predict three output variables simultaneously there is no apparent rule for mlp configuration for a specific problem and thus trial and error approach is often employed in practice maier and dandy 2000 for our study this approach was conducted via a sensitivity analysis of the number of input variables training ratio and number of neurons in the hidden layer to identify the best configuration of the mlp first we ran the relative importance analysis johnson and lebreton 2004 on the input variables using a simple configuration of mlp with ten hidden neurons the input variables were then added to the mlp training sequence in the descending order of their relative importance the relative importance refers to the proportional contribution of each input variable to explaining the variation in the output variables considering both its direct effects i e its correlation with the outputs and its effects when combined with the other input variables johnson and lebreton 2004 for each input variable the importance was calculated as the difference between the accuracy of the full model i e including all input variables and the mean accuracy of all submodels that excluded the input variable of interest the values were normalized against each other so that they sum up to 100 in our study the relative importance analysis was carried out based on the method explained in detail in ibm corp 2015 the training ratio defines the percentage of the input dataset that is used to train the mlp to reduce the training time of the mlps we only varied the training ratio from 10 to 70 incremented by a step of 20 the test set was kept at 20 of the total sample size in all cases the number of neurons was varied between 5 and 60 with an incremental step of 5 the configured mlps were initialized with random weights sampled from a gaussian distribution and were trained using levenberg marquardt backpropagation marquardt 1963 for 500 epochs training iterations using neural network toolbox in matlab software matlab and neural network toolbox 2017 other parameters of the training algorithm were kept at their default values our goal for mlp training was to minimize the mean squared errors mse of the training set msetrain 0 the training stopped if one of the following conditions was met 1 the number of training iteration exceeds 500 2 the mse of training set equates zero 3 the magnitude of the error gradient is less than 10 7 and 4 mse of the validation set has increased more than 6 training iterations since the last time it decreased early stopping prechelt 2012 the performance of the trained mlp was evaluated using the test set based on the coefficient of determination r2 and mse one of the drawbacks of the backpropagation training algorithm is that the network might be trapped in some local minima especially for non smooth error surfaces maier et al 2010 therefore mlp training with different random weights initialization can result in variation in the model accuracy to rectify this problem each mlp configuration was trained 10 times using different random weight initialization and the performance means were compared the final surrogate model was selected based on a balance among metamodel accuracy training and prediction time 2 3 7 testing the spatial distribution of prediction errors it is important that surrogate models are tested based on their domains of use marie and simioni 2014 since our objective was to use the selected surrogate model to construct the objective and constraint functions for the farm level optimization of management practices for irrigated corn in colorado we calculated the root mean squared errors rmse between the surrogate model predictions and the daycent s outputs for each corn farm the rmse was computed based on 216 random samples of management practices per farm the farm level rmse were then visualized for the whole landscape via maps to identify the spatial pattern of metamodeling uncertainty as well as locations of extreme errors 3 results 3 1 model accuracy our results indicated a high accuracy of the surrogate models with appropriate configuration and training fig 4 the minimum root mean squared error rmse of the test sets for different mlp configurations varied from 0 4 to 4 1 mg c ha 1 for f soc 0 3 3 3 mg d m ha 1 year 1 for f grain 0 2 2 4 mg d m ha 1 year 1 for f stover fig 4a these corresponded to the test set r2 of 73 6 99 5 1 7 99 4 and 0 8 99 3 respectively fig 4b the performance of the surrogate models was more sensitive to the variations in the numbers of input variables and hidden neurons compared to those of training ratio improvements in the surrogate accuracy when configuring the mlps with more than four input variables or 25 hidden neurons came with significant increases in training and prediction time these metrics depicted the number of seconds taken to train an mlp and to conduct one million predictions using the trained surrogate model respectively under the stop rules for mlp training defined in section 2 3 6 an mlp took from 2 s to over 15 min to train and required less than 1 3 s for one million predictions the final surrogate model that balances between metamodeling accuracy i e test set r2 for all targets were greater than 99 and prediction time i e fastest is presented in table 1 other details including regression plots and mlp s weight and bias configuration are available in the supplementary material s4 the final surrogate model exhibited high accuracy with the rmse less than 0 46 mg c ha 1 0 25 mg d m ha 1 year 1 and 0 33 mg d m ha 1 year 1 for f soc f stover and f grain respectively the gain in simulation time was substantial compared to the original daycent model while the daycent took about 59 6 0 33 days extrapolated from 5 15 0 33 s per simulation n 10 for one million simulations on a quad core i7 cpu 2 20 ghz and 12gb ram its surrogate model only required 0 83 0 08 s on the same setup this indicated that the surrogate model was about 6 2 million times faster for our analysis 3 2 input variable importance and dependence the bau s soc and management practices appeared to be the most important variables in the surrogate model table 2 the importance was defined as the reduction in prediction accuracy i e increase in mse when comparing the mse of the complete model with all input variables to the average of mse of all submodels that excluded the input variable of interest this result confirmed the diminishing effect of increasing input variables on accuracy improvement fig 4 the dependence plot of the first four most important input variables indicated that the output variables responded to variation in input variables in expected trends but with different magnitudes fig 5 the effects of varying bau s soc and residue removal rate on the output variables were quite linear while those of nitrogen fertilizer and irrigation followed convex curves indicating diminishing management effects at higher investments of management practices f soc seemed to be more influenced by changes in its initial value whereas f stover and f grain responded with higher magnitudes under variation in residue removal and nitrogen fertilization and irrigation respectively 3 3 spatial variation of the predictive errors the spatial distributions of the rmse between daycent simulated outputs and surrogate model predictions indicated a high accuracy of the surrogate model throughout the landscape fig 6 the 95th percentiles of the rmse for the prediction of f soc f stover and f grain were 0 77 mg c ha 1 0 37 mg d m ha 1 year 1 and 0 53 mg d m ha 1 year 1 respectively the maps of rmse spatial distributions revealed higher concentration of sites with lower accuracy levels i e rmse above 95th percentiles around areas west of the city of greeley and east of the town of sterling although our exploratory analysis did not reveal any specific correlation between the input variables and the errors supplementary material s6 it might suggest that the aggregation of input variables for more efficient metamodeling was not efficient in explaining potential seasonal variations of output variables for certain regions in the landscape 3 4 farm level optimization of profits optimization of management practices at the farm level improved average farm profits by 83 150 average soc by 16 53 average grain by 10 1 11 3 and reduced average ghg emissions by 19 55 compared to the bau scenario table 3 the improvements of average farm profits were due to the lowered average farm production fixed costs of no till 9 1 and the higher biomass production 10 26 attained by the optimally chosen fertilization and irrigation as we imposed higher farm level soc constraints our model reduced irrigation and residue removal rates to satisfy the soc constraints while increasing nitrogen fertilization rate to improve biomass production for farm profits maximization residue removal rate was decreased to below the bau s level at the f soc constraint greater than 20 while both soc accumulation and ghg emissions reduction were significantly improved under all soc constrained scenarios compared to the bau scenario nitrogen leaching was slightly increased by 3 14 due to higher fertilization and irrigation rates when switching from conventional tillage to no till under the bau scenario bau nt we observed 54 and 24 increases in farm profits and soc and 31 and 32 decreases in ghg emissions and nitrogen leaching respectively 3 5 feasible value ranges and improvement regions of landscape constraints at landscape scale the feasible value ranges of soc irrigation water and grain ranged from 7 42 to 10 15 106 mg c year 1 1 29 1 44 109 m3 year 1 and 2 48 3 45 106 mg d m year 1 respectively table 4 the base landscape constraints of soc and grain fell between their feasible ranges while the base constraint of irrigation water use laid above its feasible range this indicated that the empirical irrigation constraint had been satisfied through profit optimizations at farm level therefore for the landscape multi objective optimization we re set irrigation constraint to the mean of its feasible value range 1 36 109 m3 year 1 while maintaining soc and grain constraints at their empirical values of 8 19 106 mg c year 1 and 3 34 106 mg d m year 1 respectively 3 6 pareto trade offs of landscape level optimization the pareto surface of trade offs among landscape sums of stover ghg emissions and nitrogen leaching for irrigated corn production in eastern colorado had a bowed shape revealing three different trade off patterns between different pairs of landscape objectives fig 7 while stover and ghg emissions displayed a straight forward linear relation fig 7d nitrogen leaching related trade offs showed more complicated relationships with a concave stover vs nitrogen leaching pareto frontier fig 7b and a convex ghg vs nitrogen leaching pareto frontier fig 7c under the base landscape constraints the maximum amount of stover that could be produced was 2 35 106 mg d m year 1 bearing the highest impacts on the ecosystem at 14 37 103 mg n year 1 for nitrogen leaching and 57 104 mg co2e year 1 for ghg emissions improving the environmental performance of the ecosystem was achieved at the trade off on stover the minimum ghg emissions and nitrogen leaching was 33 50 104 mg co2e year 1 and 11 95 103 mg n year 1 corresponding to the stover production of 0 83 minimum and 0 96 106 mg d m year 1 respectively the landscape sum of profits was linearly correlated with stover production reaching the maximum of 106 89 106 year 1 at the maximum stover production level and the minimum of 80 63 106 year 1 at 0 87 106 mg d m year 1 of stover 33 90 104 mg co2e year 1 of ghg emissions and 12 02 103 mg n year 1 of nitrogen leaching our results indicated that more favorable trade offs occurred below the stover production level of 2 2 106 mg d m year 1 this corresponded to an average farm level stover production of 7 4 mg d m ha 1 year 1 or an average farm level residue removal rate of 72 raising the landscape constraints i e higher soc and grain and lower irrigation water use worsened the stover nitrogen leaching and ghg emissions objectives fig 7 maximum soc and grain production and irrigation water saving were obtained at the stover production levels below 1 1 106 mg d m year 1 below an average farm level residue removal rate of 38 and fell far in the sub optimal regions of the stover nitrogen leaching and ghg emissions trade off frontiers the mean cir are scenarios where one of the constraints were set to the mean of its improvement region while keeping other constraints at their base values we found that the mean cir of soc and irrigation water saving were achieved mainly by decreasing farm level stover removal rate by about 17 18 table 5 thus resulting in decreased stover production the landscape trade off showed that we could improve soc and reduce irrigation water use to a certain extent without affecting either food production or environmental performance of the ecosystem by targeting lower stover production goals in contrast although improving food production mean cirgrain did not greatly reduce stover or increase ghg emissions it significantly increased nitrogen leaching by 6 10 as shown by the shifting of the green dotted lines to the right of the base constraint pareto frontiers fig 7b the increase in nitrogen leaching under this scenario compared to the base scenario was due to a higher application of both nitrogen fertilizer by 1 7 and irrigation by 2 3 table 5 the summary of landscape trade offs among production constraints and optimization objectives was given in the supplementary material s7 3 7 optimal stover harvest fig 8 shows an example of optimized landscape configurations of farm level residue removal rate at different landscape pareto trade off levels among stover production ghg emissions and nitrogen leaching under the base landscape constraints to increase stover production farm level residue removal rate was first increased in the areas around the towns of yuma sterling and greeley and then the areas around burlington and lamar this revealed that more stover could be produced with less environmental impacts i e lower environmental footprints in the upper part compared to the lower part of the study region 4 discussion the results of our analysis could be used to support decision making at multiple levels at local levels farmers the direct decision makers of agricultural ecosystems could be informed with the optimum levels of resource investment to maximize farm profits and improve soil carbon storage farmers could also adjust their management decisions based on the quantitative trade offs among different ecosystem services e g carbon storage and food and biomass production and disservices e g ghg emissions and nitrogen leaching this increases farm level efficiency and sustainability furthermore as farm level environmental performance was made available farmers could be encouraged to incorporate these metrics in their farm planning and budgeting allowing more thorough state wide agricultural statistic reports at regional levels our results could be used to support several applications such as life cycle assessment and supply chain optimization of first and or second generation biofuel production biorefinery sitting and feedstock landscape optimization they could also be aggregated into county level or state level assessments to support policy making and regional planning for example different stover removal rates could be recommended for different counties to approximate an optimal trade off level among food and biomass production carbon storage and environmental impacts an example is given in supplementary material s8 as argued by levin 1992 the problem of pattern and scale in ecology and ecosystem science is to understand the simultaneous changes that are taking place on many scales with significant reductions in computation time as exampled by our study metamodeling allows a model to be used at larger scales to explore the spatial and temporal dynamics of interactions among ecosystem processes while retaining the fine scale granularity of the ecosystem properties this advantage also makes it feasible to conduct simulation expensive applications like sensitivity analysis and optimization which were conventionally impractical for the original complex models in many cases while our study demonstrated the metamodeling of the daycent model for an agricultural landscape optimization our framework would be equally applicable for other ecosystem models as well as optimization problems at different scales realizing that the complexity of such a modeling framework might hinder its practical use we automated the workflow and incorporated it into our ag ecosopt system to facilitate future analyses in addition efforts are being made to integrate other metamodeling techniques and optimization algorithms for more dynamic applications of our modeling platform despite the potential advantages of the framework we do realize some drawbacks in the methodology first the computational burden of the metamodeling process was substantial generating the dataset for metamodeling required the use of a cluster computing system while we could argue that the surrogate model could be trained once for different analyses this computational burden might still challenge the adoption of our metamodeling framework especially when the computing infrastructure is not available for a large number of original model simulations however our results showed that the training ratio did not significantly affect surrogate model performance fig 4 a b this indicated that we could have decreased the sample size to reduce the computational burden of dataset generation as well as the mlp training time for this space filling sampling techniques like latin hypercube design alam et al 2004 could be used in place of the full factorial design employed by our study although the training time of each mlp configuration ranged from a couple of seconds to 15 min optimization of mlp configuration via sensitivity analysis required thousands of iterative mlp trainings which was time consuming since our results suggested that a slight increase in accuracy could come with a considerable increase in training and prediction time fig 4 we could set the msetrain training goal at a certain level above zero instead of zero to stop mlp training earlier in addition the maximum number of neurons in the hidden layer could be reduced in future studies by training a surrogate model for a single crop in a small region we had reduced the crop specific input variables and many other site and management specific input variables such as planting dates and fertilization timing this improved the efficiency of the surrogate model fig 4a also suggests that training mlp with more than four input variables did not significantly improve the surrogate model accuracy this implied that other input reduction techniques such as principal component analysis could be used to decrease the number of input variables thus lowering the training time the mlp prediction time could also be improved if farm profits i e the farm level objective function were directly metamodeled in our study simulated corn grain and stover yields were first metamodeled and then used to calculate farm profits while this approach allowed a more flexible use of the surrogate model to address changes in economic factors such as commodity prices it slightly increased the prediction time by 8 the optimizations required more than 24 h on a quad core i7 cpu for both farm and landscape levels for applications where time saving is more crucial reducing intermediate steps is recommended to improve optimization efficiency to further reduce optimization time we equipped the ag ecosopt with the ability to use the parallel computing toolbox in matlab for simultaneous simulation of multiple farm level optimization instances when resources are available our analysis was subject to several sources of uncertainty by nature surrogate models inherit the uncertainties of the original models which are those from model input parameters and structure in addition surrogate models suffer from their own structural uncertainty which was measured as the errors between predicted outputs and the modeled outputs the latter was quantified in our study for surrogate model selection there were also other uncertainties associated with the optimization process such as those of economic data these uncertainties would propagate through the system and should be reflected in the output to inform decision makers while the quantification of uncertainty is valuable to decision making such analysis is difficult to include in regional assessments such as this due to a limited amounts of empirical data against which to validate model function and b the highly computational intensive nature of such operations these challenges are significant enough to fall outside the scope of our study and merit separate thorough studies however we note that meaningful sensitivity and uncertainty analysis is only possible after a system has been initially characterized and the important potential feedbacks and dependencies identified it is also important to note that the surrogate model should not be used outside of the domain for which it was designed in our analysis the mlp was trained for irrigated corn in eastern colorado with certain bounds of management specific input variables the use of the surrogate model for other corn growing regions or beyond the management practice bounds is not recommended in these cases one should follow the framework described in this study to construct and thoroughly test surrogate models before employing them for their specific study constructing a robust surrogate model to be used over larger areas and to predict several outputs for many crop species would improve the generalization of the metamodeling this could also encourage studies of broader scopes on larger scales to support strategic decision making processes however such an effort requires laborious data acquisition and processing as well as comprehensive experimental designs that encompass all possible input distributions furthermore a generic surrogate is likely to be bulky and slow and thus is inefficient for simulation intensive applications like optimization alternatively simplified surrogate models developed for specific problems like ours are more efficient for local and operational decision making our future efforts will focus on building more generic surrogate models for different crops in the u s as well as extending the ag ecosopt s database to facilitate the adoption of our framework for similar resource optimization problems although multi level and multi objective optimization at high spatial resolutions is supposed to support decision making processes we found that communicating the results of such optimization to stakeholders and decision makers is a big challenge complicated optimization problems like ours could result in thousands of graphs tables and maps which would be difficult to present through traditional communication means such as reports and scientific papers the use of web mapping applications allows integrated and customized presentations of information at different scales serving the needs of multiple stakeholders such applications will also permit the involvement and feedback from stakeholders for more practical and operational analyses the future development of ag ecosopt platform will focus on building a web mapping application to facilitate the visualization of analyses that employed our platform 5 conclusion in this study we demonstrated the use of metamodeling techniques in a surrogate based optimization framework for decision support in agricultural resource management for this we conducted a case study to optimize the management practices of irrigated corn production systems in colorado the optimization explored the trade offs among seven objectives at farm and landscape scales including farm profits irrigation water use corn grain corn stover soc ghg emissions and nitrogen leaching the mlp a feedforward artificial neural network was employed to create a surrogate of the daycent biogeochemical model the surrogate model was used to create the objective and constraint functions for farm level optimization outputs from farm level optimization were then used to generate scenarios for landscape level optimization the optimizations were subject to certain constraints in soil carbon storage food production and irrigation water use our results showed that the surrogate model was able to capture above 99 variations in the simulated farm level soc corn grain and stover yields in addition it was 6 2 million times faster than the daycent model and was suitable for use in computationally intensive applications like sensitivity analysis and optimization optimizing management practices at the farm level improved average farm profits by 83 150 soc by 16 53 grain yield by 10 1 11 3 and reduced ghg emissions by 19 55 while slightly increasing nitrogen leaching by 3 14 landscape level optimization indicated that average farm level stover removal rate for optimal trade offs among corn stover production ghg emissions and nitrogen leaching should be below 72 the optimal stover removal rates were also visualized for each corn farm to illustrate the landscape configuration of management practices to obtain certain level of trade offs we discussed the advantages and disadvantages of our surrogate based optimization framework as well as the potential to couple our framework with web mapping applications to facilitate better communication of high spatial resolution optimization results to decision makers we believe that this combination would encourage the participation and feedback from stakeholders for more practical and operational optimization analyses to support decision making in sustainable resource management acknowledgements the work was supported by a usda nifa project grant 2011 67009 30083 decision support tool for integrated biofuel greenhouse gas emission footprints the fulbright vietnam scholarship the multidisciplinary approaches to sustainable bioenergy phd program funded by the united states national science foundation hue university of agriculture and forestry vietnam huaf and shell technology center houston the authors thank dr christian davies at shell technology center houston and colleagues at the natural resource ecology laboratory nrel for advice model training and data sources appendix a supplementary data supplementary material related to this article can be found in the online version at doi https doi org 10 1016 j ecolmodel 2019 02 018 appendix a supplementary data the following is supplementary data to this article 
