index,text
3700,water erosion is a complex process driven by many factors such as rainfall soil topography vegetation and land use management practices much research has been done to assess the separate effect of every single factor while studies devoted to the interaction effects among these factors are rarely reported the complex interactions among factors are generally poured into the pool of soil erodibility k factor in the usle based models which induces uncertainty of the k factor and thus causes prediction errors the interaction between rainfall r and soil k factors is the first and foremost step to dissect the entire interaction complex but also the objective this study intended to investigate quality controlled data from long term field observations on four bare steep slopes in different geographic regions of china were selected and standardized to exclude the effect of unconcerned factors the interaction effects of rainfall and soil factors were visualized by the nonlinearities of accumulative rainfall runoff erosion relationships and then further quantified by the evaluation of prediction errors for the cases that ignore the nonlinearities and by the approach of partial least squares structural equation modelling pls sem the results indicated that the interaction between rainfall and soil factors exists in water erosion processes and obscures the hydrological and erosion prediction 1 the potentialities of both runoff and erosion varied with the level of rainfall erosivity in different patterns among soils indicating diverse nonlinearities of rainfall runoff erosion relationships and the complex interaction effects behind it 2 the addition of the interaction effects in the sem model constructions increased 9 2 and 6 0 of variance explanations for the predictions of annual runoff and erosion respectively whereas the exclusion of interaction effects tended to cause overestimations on steep slopes that were hard to be calibrated by existing formulas 3 the well known tendency to underestimate small and overestimate large events does not suit every soil especially for the soil with coarse texture and shallow soil with fractured bedrock and prediction bias was found predictable and rooted in the interaction between rainfall and soil this study yields a deeper understanding of interaction effects and is helpful for the improvement of runoff and erosion predictions keywords factor interaction prediction uncertainty soil erodibility runoff ability mesoplot scale structural equation modeling 1 introduction soil erosion is a global environmental issue that triggers the loss of fertile topsoil and threatens food safety in many parts of the world pimentel 2006 how to assess or predict soil loss reliably and precisely has always been very a gordian knot ever since the beginning of soil erosion research trimble and crosson 2000 parsons 2019 even the most successful water erosion model the universal soil loss equation usle wischmeier and smith 1978 has been widely reported that there were considerable errors when it was applied to estimate soil loss in different regions countries and continents zhang et al 2016 benavidez et al 2018 alewell et al 2019 the complex interactions among erosion factors have been considered as a significant source of the prediction uncertainty wischmeier 1976 beven and brazier 2011 benavidez et al 2018 soil erosion by rainfall and runoff is a complex process affected by many factors the usle estimates water erosion by multiplying the values of the six factors 1 a r k l s c p where a is the average annual soil loss t hm 2 yr 1 r is the rainfall and runoff factor also termed as rainfall erosivity index mj mm hm 2 h 1 k is the soil erodibility factor t h mj 1 mm 1 l is the slope length factor unitless s is the slope gradient factor unitless c is the cover management factor unitless p is the conservation practice unitless in which the r is the base value that denotes the potential erosive energy of rainfall and runoff induced by rainfall k is the base value that represents the intrinsic susceptibility of a specific soil to erosion by raindrop splash and runoff wash during rainfall the other four factors l s c p are multipliers that outline the environment namely the media that accommodates erosion processes previous studies have primarily been focused on the separate effect of every single factor however very few research has been devoted to the effects of multi factor interactions on water erosion hua et al 2019 this contrast reflects the fact that most erosion models have a major intrinsic limitation that they basically neglect the complex interactions among factors in order to distinguish more easily the individual effect of each factor roose 1996 however in the context of bottlenecked prediction accuracy there is a growing consensus that soil erosion is a complex process determined by the mutual interaction of many factors cebecauer and hofierka 2008 also there is a growing need now to disentangle the complex interactions among factors estrada carmona et al 2017 and factor the interaction effects into the model construction hua et al 2019 raza et al 2021 thus it s necessary to assess the prediction uncertainty that results from the interactions among the six factors in the application of usle based models the first and basic step into the dissection of the interaction complex is to explore the interaction between the rainfall factor r and soil factor k on the standard plot the usle defines soil erodibility k as the rate of soil loss per unit of rainfall erosion index for a specific soil as measured on a unit plot which is a plot that is a 22 13 m length l 1 of uniform 9 slope s 1 in continuous fallow condition c 1 with up and down clean tillage p 1 and no new input of organic matter for at least three years roose 1996 thus the k value for a specific soil is measured as the following equation 2 k a r l s c p 1 in which a is the average annual soil loss measured from plot sediment data r is the average annual rainfall erosivity index calculated from the rainfall records while k is the only value that is unknown and uncertain this definition implies that the soil erodibility k is a black box coefficient that integrates the complex interactions among the six factors and takes over all the corresponding uncertainties this model design that pours all the interaction effects into the pool of soil erodibility k factor induces uncertainty of the k factor and thus causes inherent prediction errors for usle based models this is why some researchers attributed the prediction errors to the uncertainties in soil erodibility borselli et al 2012 according to the definition of soil erodibility the value of k is embodied in the long term interactions that rainfall acts on the soil and reversely soil reacts to rainfall thus the interaction between rainfall r and soil k is the fundamental structure of the complex interactions that exist among erosion factors however few studies have been conducted to focus on the interaction between rainfall and soil and even rare in terms of a quantitative assessment of the interaction effect most attention has been paid to assess rainfall factor and soil factor separately fox and bryan 1992 nishigaki et al 2017 several studies that concern the interaction typically only emphasize that soil crust is a result of the interactions and it affects hydrological and erosion processes through altering surface conditions chamizo et al 2012 issa et al 2011 le bissonnais et al 1995 thus a deeper insight into the mechanism of the interaction between rainfall and soil and quantitative assessment of the interaction effect is very urgent the complex interactions between the soil and rainfall determine the processes and yields of runoff and erosion borselli et al 2012 this study hypothesizes that the interaction effects of rainfall and soil factors exist in the hydrological and erosion processes and thus lead to substantial uncertainty in the predictions of runoff and erosion thus the main objectives of this research were to identify the existence of interaction between rainfall and soil and to quantify the prediction uncertainties induced by the interaction effects to achieve the goal the specific objectives are as follows 1 to examine how the interaction between rainfall and soil affects the hydrological and erosion processes 2 to assess how many prediction biases were induced by the interaction effect 3 to identify whether the interaction effect reached a statistically significant level or not this work may be helpful for a better understanding of the mechanism of the rainfall soil interaction and the pathway the interaction causes prediction uncertainties 2 materials and methods 2 1 plot sites selection four typical stations were selected in the four regions with different geographical conditions namely the northwestern loess plateau region southwestern purple soil region southwestern karst region and southern red soil region fig 1 these four regions represent the main water erosion area under the hilly context in china and meanwhile differ in climate terrain lithology soil and vegetation wang et al 2015 to increase the possibility of detection of the interaction effects a steep slope that has a higher magnitude of yield and variation in soil loss el kateb et al 2013 is a better choice than a gentle one thus bare field plots with similar steep slopes were selected for each station detailed information of basic climate index soil properties and observation specifications for the four bare steep plots is listed in table 1 2 2 data collection we obtained 3 5 years of observations on the rainfall runoff and sediment during 1985 2014 for each plot rainfall data were automatically and continuously recorded by a rain gauge near the runoff plot runoff and sediment samples were artificially collected from the runoff plot after each rainfall event all the four plots were arranged with the demands for the management of unit plot records from the first two years after the plot construction and the rainfall events with no runoff or sediment were excluded to avoid distortions all the records were checked and corrected if there were any omissions or mistakes finally a total of 17 plot years of 227 event records from natural rainstorms were collected table 1 and the soil depth and lithology data were measured on the plot during the construction period the input data for the partial least squares structural equation modeling pls sem are composed of unvarying values of soil indexes and annual values of rainfall runoff and sediment data the soil data at each site was compiled from the existing plot information scientific journal articles jiang et al 2020 ruan et al 1995 sheng et al 2016 zhao et al 2013 academic dissertations gu 2004 he 2007 and harmonized world soil database hwsd v1 2 fao et al 2012 the rainfall runoff and sediment data were prepared with annual values based on the collected 17 plot years records from the four stations plus another 8 plot years records at yuexi a station similar to anxi from the early work ke and zhang 2021 in total 5 samples for soil data and 25 samples for annual rainfall runoff and sediment data were obtained more details of pls sem will be explained in section 2 4 2 as for the map data fig 1 30 years 1986 2015 of daily precipitation records were used to delineate the spatial distribution of annual rainfall erosivity in china besides the soil and water conservation regionalization map of china was obtained from the raw data in a published paper wang et al 2018 2 3 data standardization to compare the interaction patterns in different geographic regions the effects from differences in topography and rainfall regimes should be eliminated by data standardization 2 3 1 standardization of the topographic factor in the cases that the runoff plot data need to be calibrated to the unit plot with 22 13 m length and 9 slope gradient the equations refer to chinese soil loss equation csle algorithms liu et al 1994 liu et al 2000 liu et al 2002 for the cross geographic region comparisons in runoff and erosion the topographic factors were normalized to 20 m length and 15 26 2 slope gradient by referring to the standard of unit plot in china zhang et al 2000 with the transformed equations in our previous work ke and zhang 2021 2 3 2 standardization of the rainfall factor to remove the influences of diversities in the frequency distribution of raindrop size rainfall intensity and rainfall amount the standardization of the rainfall factor is also necessary rainfall erosivity r namely ei30 is the most frequently used index for the potentiality of a rainstorm to cause erosion due to its excellency in explaining the variation in soil loss wischmeier 1959 however the optimum indicator for the potentiality of a rainfall event to induce runoff still reaches no consensus to determine an appropriate indicator correlation and regression analyses of plot data in 227 rainstorms were performed the results suggested that rainfall erosivity ei30 is the most closely correlated rainfall index for both runoff and erosion with spearman correlation coefficients of 0 82 and 0 79 respectively p 0 01 moreover rainfall erosivity ei30 could explain 78 0 and 72 0 of the variabilities in runoff and erosion respectively p 0 01 thus index ei30 can not only embody the effect of rainfall on erosion but also runoff therefore the rainfall erosivity ei30 was selected as the rainfall factor to represent the effect of rainfall on surface runoff and soil loss the calculation of ei30 refers to the algorithm of brown and foster 1987 in the rusle model 2 4 methods for interaction detection 2 4 1 factorial design factorial designs allow the analysis of the main effect also called a simple effect of each factor as well as the effect of interactions between factors on the target rainfall erosivity and soil type were set as the rainfall factor and soil factor in the factorial design the main effects of rainfall and soil were directly testified by the linearity of rainfall runoff erosion relationships furthermore the interaction effects of rainfall and soil were visualized by the non linearities breaks in double mass curves of rainfall runoff erosion with cumulative data in the order of rainfall size a continuous least square piecewise linear regression approach was used to identify the critical point break in the slope and then divide the double mass curve into two or three linear segments the ratio bn bn 1 was used to reflect the degree of the change between the slope of the segment before the break bn 1 and the slope of the segment after the break bn this study used a 20 difference in the slope as the criterion of significant change thus bn bn 1 smaller than 0 80 or larger than1 20 indicated a significant change the interaction effects on runoff and erosion predictions were further quantified by error evaluation for the prediction cases that ignore the non linearities given that the indication of rainfall erosivity index ei30 to runoff generation is the same excellent as to soil loss see section 2 3 2 a new concept runoff ability ra was proposed as an index for runoff generation potentiality as a counterpart of soil erodibility k factor that denotes soil loss potentiality the ra was defined as the runoff depth induced by unit rainfall erosivity on a unit plot runoff ability ra and soil erodibility k for each soil listed in table 2 and table 3 respectively were estimated with average annual data by calculating the ratios of runoff depth and soil loss to rainfall erosivity after topographic calibrations l 22 13 m s 5 the predictions of both runoff and erosion were approached by the equations r r ra and a r k after topographic calibrations l 20 m s 15 for ra and k respectively nash sutcliffe efficiency nse and normalized root mean square error nrmse were used to assess the general prediction accuracy 3 nse 1 i 1 n y i y i 2 i 1 n y i y 2 4 nemse rmse mean i 1 n y i y i 2 n y nse denotes the prediction efficiency optimal 1 good 0 7 1 satisfactory 0 4 0 7 unsatisfactory 0 0 4 unacceptable 0 wu et al 2017a nrmse measures the estimation error perfect 0 good 0 0 15 satisfactory 0 15 0 25 unsatisfactory 0 25 0 50 poor 0 50 daggupati et al 2016 the prediction errors were further piecewise evaluated through the percentages of over under predicted events as well as their overall percentage errors ope and mean absolute error mae tables 2 and 3 5 ope i 1 n y i i 1 n y i i 1 n y i 100 6 mae i 1 n y i y i n where y i is the i th measurement y i is the i th predicted value y is the mean of the entire measurements n is the number of observations 2 4 2 partial least squares structural equation modeling pls sem in this study we chose the partial least squares structural equation modeling pls sem approach to test the existence of interaction effect and its significant level in a statistical way pls sem model is an elegant way to examine the structural hypotheses and reveal the complex causal relationships between variables of interest fan et al 2016 including to test the moderating effect namely interaction effects with the dataset of small sample size non normal distribution and multidimensional constructs hsu et al 2006 2 4 2 1 pls sem model construction the pls sem consists of two sub models the structural model and measurement model fig 2 the inner model namely the structural model interprets the relationships between constructs and endogenous latent variables we constructed a two factor interaction model with three constructs rainfall effects soil conditions and their cross product interaction effects and two endogenous latent variables annual runoff and annual soil loss here we hypothesized that the interaction effects i e rainfall effects soil conditions exert significant impacts on the annual runoff and annual soil loss the outer model namely measurement model describes the relationships between the latent and observed variables we selected nine reflective indicators as the observed variables for the latent variables rainfall effects and soil conditions respectively the soil conditions were measured by soil texture clay silt sand dg sg soil water retention and aggregation stability som wsac 0 25mm soil mass soil depth and rock fragment gravel content the rainfall effects were reflected by precipitation amount p pmax pmin erosive rainfall amount p erosive p30 rainfall energy e rainfall intensity i i30 rainfall erosivity r r p erosive we implemented the pls sem analyses with the moderating effect module in smartpls 3 0 https www smartpls com to test the above hypothesized relationships 2 4 2 2 pls sem model evaluation 1 measurement model evaluation the measurement model evaluation is to examine the quality of indicators here we focus on the reliability of the indicators for the rainfall and soil factors the indicator loading denotes correlations between each latent variable and the observed variable the individual indicator reliability that is calculated by squaring the indicator loading denotes an indicator s variance that can be explained by the underlying latent variable for which a value over 0 4 is regarded as satisfactory in a reflective model hulland 1999 2 structural model evaluation path coefficient β coefficient of determination r 2 and stone geisser s q 2 values can assess the explanatory power of the structural model the β represents the influence of constructs on endogenous latent variables equivalent to standardized regression coefficients which can examine the direction and strength of causal linkages grace 2006 the r 2 represents the goodness of fit for the model which ranges from 0 to 1 and the values of 0 10 0 25 0 50 0 75 can be regarded as insignificant weak moderate and substantial respectively hair jr et al 2016 q 2 value from the blindfolding procedure is a criterion of the model s predictive capability the higher the q 2 value and the higher the model s predictive capability chin 2010 3 effect size evaluation the effect size f 2 is a useful way to detect whether a construct has a substantive impact on the endogenous variable in the testing for interaction effects using pls sem we followed a hierarchical process that compares the r 2 results of two models namely the main effect model the model without interaction and the interaction model limayem et al 2001 the effect size of the interaction effects was suggested to be assessed by the cohen effect size formula cohen 1998 7 f 2 r with interaction 2 r without interaction 2 1 r with interaction 2 where f 2 is the effect size of interaction r 2 with interaction is the r 2 of the interaction model r 2 without interaction is the r 2 of the model without the interaction term interaction effects with f 2 of 0 02 0 15 and 0 35 have been suggested as small medium and large effects respectively cohen 1998 besides the interaction effects the effect size f 2 of the simple main effects of rainfall effects and soil conditions were also used to assess whether they have substantive influences on the annual yield of runoff and erosion the calculation refers to the algorithm of boßow thies and albers 2010 4 significance test the significance of model parameters for both the measurement and structural models can be tested by the t statistics from bootstrapping procedure with 5000 iterations given the uncertainty in field measurement and the small sample size i e 25 in the modeling the lowest significance level for a hypothesis test was set at 0 10 level 3 results 3 1 simple linear relationships for rainfall runoff erosion to demonstrate that there may be an interaction the first step is to determine the simple main effects the simple main effects of rainfall and soil on runoff and erosion can be directly recognized by the simple linear regression analyses based on event data in fig 3 a and b respectively on one hand there appeared a simple main effect of rainfall high rainfall erosivity generally resulted in higher yields of runoff and sediment than low rainfall erosivity the regression coefficients were all positive and significantly different from zero p 0 05 the coefficients of determination r 2 were all above 0 75 p 0 05 in which the r 2 ranged from 0 80 to 0 97 in rainfall runoff regressions fig 3a and from 0 78 to 0 98 in rainfall erosion regressions fig 3b thus rainfall erosivity had strong explanatory power for the variances in runoff generation average 88 5 and soil loss average 87 8 on the other hand there also appeared a simple main effect of soil different soil conditions lead to different rates of variation in runoff and erosion with rainfall erosivity the regression coefficients for rainfall runoff and rainfall erosion relationships namely the potentialities of runoff and erosion are different among soils the slopes of the fitting lines for rainfall runoff relationships were ranked as purple soil 0 070 red soil 0 048 loess soil 0 027 karst soil 0 023 fig 3a the slopes of the fitting lines for rainfall erosion relationships were ranked as loess soil 0 051 red soil 0 028 purple soil 0 017 karst soil 0 013 fig 3b taken together the unmatched slope rankings between rainfall runoff and rainfall erosion regressions on the four soils implied different levels of sediment concentration in different soil conditions as seen in fig 3c the sediment concentrations were ranked as loess soil 1 804 red soil 0 561 karst soil 0 514 purple soil 0 238 3 2 double mass curve relationships for rainfall runoff erosion to confirm whether the rainfall runoff and rainfall erosion relationships remain the same for all storms double mass curve analyses were performed to check the non linearity evident breaks namely critical points in the slopes of rainfall runoff fig 4 and rainfall erosion curves fig 5 were observed on all soil types the slope of the rainfall runoff curve measures the level of runoff induced by unit rainfall effect that reflects the runoff generation potentiality namely runoff ability ra the slope of rainfall erosion denotes the rate of soil loss caused by unit rainfall effect that represents the soil loss potentiality i e soil erodibility k the ratio bn bn 1 for each break was either below 0 80 or above 1 20 indicating the significant change thus over 20 variations in potentialities of runoff and erosion after the breaks were identified for all the four soils indicating that the potentialities of runoff and erosion were significantly affected by the level of rainfall erosivity moreover the changing patterns of double mass curves are different among the four soils with regard to rainfall runoff curves moderate decrease 21 and compelling increase 93 in the slopes after the break were found on the loess soil and purple soil respectively and striking decreases above 50 in the slopes after the breaks were shown on the karst soil and red soil fig 4 as for rainfall erosion curves moderate increase 42 and compelling increase 102 in the slopes after the break were observed on the loess soil and purple soil respectively and a strong decrease 58 in the slope after the break appeared on the red soil whereas a complex three stages with two breaks in rainfall erosion curves were shown on the karst soil with dramatic increase 540 and then moderate decrease 42 in the slopes after the first and then the second break fig 5 these different changing patterns revealed that the effects of rainfall factor on the potentialities of runoff and erosion were substantially controlled by the soil condition different change direction and break position between rainfall runoff and rainfall erosion curves caused the varying level of sediment concentration with increasing rainfall erosivity especially on the loess soil and karst soil fig 6 the sediment concentrations for the loess soil and karst soil increased to 1 96 and 1 62 times the common level when runoff depth exceeded 29 54 mm and 23 04 mm respectively whereas sediment concentrations for the purple soil and red soil were relatively steady with the upgrade of rainfall erosivity thus the sediment concentration that reflects the relationship between runoff and erosion had different responses when it comes to different rainfall magnitudes or soil types and the uncertain relationships between runoff and erosion may be evidence of the complexity of interaction effects of soil and rainfall factors on the hydrological and erosion processes 3 3 errors in runoff and erosion predictions for surface runoff the predicted and measured values along the change of rainfall erosivity were plotted in fig 7 the nses for runoff estimation ranged from 0 71 to 0 95 indicating good prediction efficiency in which annual prediction outperformed the event prediction the nrmses namely prediction errors for runoff estimation ranged from 0 50 to 1 13 with an average of 0 82 for event prediction indicating unacceptable results fairly higher than the nrmses for the annual prediction that ranged from 0 10 to 0 29 with an average of 0 20 in respect of soil type purple soil and karst soil had lower nses and higher nrmses thus lower prediction accuracy than the cases for loess soil and red soil regarding the results of maes loess soil had the lowest magnitude of errors red soil had the highest value due to rich rainfall and karst soil and purple soil belonged to the medium level overall the predictions of surface runoff have better performances on loess soil and red soil than that on purple soil and karst soil based on the critical points in rainfall runoff double mass curve fig 4 more in depth segmental error analyses of runoff prediction based on rainfall erosivity ranges for different soils are listed in table 2 runoff yields on loess soil karst soil and red soil were commonly under predicted for small rainfall events but over predicted for big storms on the contrary runoff yield on purple soil was majorly over predicted with an mae of 5 3 mm for small rainfall events but under predicted by 36 2 with an mae of 26 8 mm for big storms over 506 5 ei these features of error distribution for individual runoff estimation generally agree with the cases for the annual estimation for instance runoff yields in the high rainfall year were under predicted on purple soil but over predicted on loess soil karst soil and red soil fig 7 for soil loss the comparisons of predicted and measured values along with increasing rainfall erosivity were shown in fig 8 the nrmses for event erosion prediction ranged from 0 57 to 0 98 with an average of 0 85 indicating unacceptable erosion prediction errors in contrast to the low nrmses for the annual prediction that ranged from 0 22 to 0 29 with an average of 0 24 compared to the loess soil and karst soil the purple soil and red soil had lower nses but higher nrmses thus lower prediction accuracy especially for annual soil loss prediction on the red soil the nse was a negative value 0 48 indicating an unacceptable performance that the predictor was less agreeable than the mean observed value as for the results of maes red soil had the highest average magnitude of errors loess soil belonged to the medium level and karst soil and purple soil had the lowest value taken as a whole both individual and annual estimations of soil loss using usle had better performance on loess soil and karst soil than that on purple soil and red soil according to the critical positions in rainfall erosion double mass curves fig 5 dissection error analyses of erosion prediction based on rainfall erosivity ranges are presented in table 3 largely soil loss yields on loess soil and purple soil tended to be over predicted in small rainfall events but under predicted in big storms over 640 8 ei whereas soil loss yield on red soil was mostly under predicted with an mae of 4 5 t hm 2 for small rainfall events but over predicted with an mae of 25 3 t hm 2 for big storms over 660 5 ei similarly soil loss yields on karst soil was over predicted by 15 3 with an mae of 5 0 t hm 2 for extreme storms over 1090 8 ei but majorly under predicted with an mae of 4 1 t hm 2 for medium storms and mostly over predicted with an mae of 0 3 t hm 2 for light rainfalls 180 8 ei combined with the comparison between predicted and measured values of annual erosion the above segmental features of prediction bias of events erosion estimation generally agree with that of the annual erosion estimation for instance soil loss amounts in the high rainfall year were under predicted on loess soil and purple soil but over predicted on karst soil and red soil fig 8 3 4 identification of interaction effects using pls path modeling pls sem results of two runoff models fig 9 and two erosion models fig 10 were compared stone geisser s q 2 values for the two pairs of models were all above 0 5 suggesting that the two factor model was predictive whether the interaction factor was incorporated or not the coefficient of determination r 2 for the two pairs of models were all above 0 75 indicating substantial predictive accuracy with or without the interaction factor however the contribution of interaction effects beyond the simple main effects was substantial in the accuracy improvements for the predictions of runoff and erosion the r 2 for the runoff model with interaction term reached 0 952 fig 9a apparently higher than the 0 872 for the model without interaction fig 9b a similar trend was observed for erosion models the r 2 for the model with interaction reached 0 923 fig 10a higher than the 0 890 for the model without interaction fig 10b thus models with interaction consideration could explain more variance in annual runoff and annual soil loss concerning the detection of the interaction effects both the effect size and regression coefficients were tested tables 4 the effect sizes of the interaction effects were large for both annual runoff f 2 1 67 and annual soil loss f 2 0 93 indicating that the improvement of r 2 reached a significant level henseler and fassott 2010 i e a practical significance plus the statistical significance that the path coefficients of the interaction effects on annual runoff β 0 274 and annual soil loss β 0 169 were both negative and significantly different from zero p 0 10 taken together these results indicated that the interaction effects imposed practically and statistically significant negative impacts on the predictions of both runoff and erosion regarding the results of the simple main effects practically and statistically significant main effects of rainfall and soil factors were also verified tables 4 effect sizes for the rainfall effects and soil conditions were also rated as large f 2 0 35 for both runoff and erosion models proving practically significant simple main effects from rainfall and soil factors moreover rainfall effects had a statistically significant and positive path coefficient for annual runoff β 0 382 p 0 01 as well as annual soil loss β 0 303 p 0 05 contrariwise soil conditions had a statistically significant and negative path coefficient for annual runoff β 0 291 p 0 10 as well as annual soil loss β 0 572 p 0 01 by comparing the two path coefficients we could draw an interesting tendency that the annual runoff was more sensitive to rainfall effects while the annual soil loss was more sensitive to soil conditions since significant negative effects of soil factor i e soil conditions were tested in both runoff model and erosion model the specific indication of the soil conditions in the two models should be identified in the runoff model the soil conditions should indicate soil permeability given the significant positive correlation between soil conditions and gravel content as well as silt loadings are 0 460 and 0 563 respectively p 0 10 in the erosion model the soil conditions should denote soil anti erodibility considering the significant positive correlation between soil conditions and wsac 0 25mm as well as gravel content loadings are 0 802 and 0 959 respectively p 0 01 thus we defined the soil factor in runoff model as soil permeability while in erosion model as soil anti erodibility these results demonstrated that either higher rainfall or lower soil permeability or soil anti erodibility alone could lead to higher annual yields of runoff and erosion moreover individual indicator s correlation and reliability to their factor in the models with interaction terms were evaluated tables 4 the t statistics for significance testing of indicator loadings give clues to the correlations between the factor and its indicators rainfall indicators that highly denote annual rainfall power including p pmax pmin p erosive p30 e r and r p erosive were significantly p 0 05 correlated with the rainfall effects on both runoff and erosion soil indicators that associate with soil permeability including sg borselli et al 2009 silt and gravel content were significantly p 0 10 correlated with annual runoff and that relate to soil erodibility such as gravel content wsac 0 25mm soil depth dg shirazi and boersma 1984 and som were significantly p 0 05 correlated with annual soil loss regarding the indicator reliability the reliability of individual indicators for rainfall effects was majorly acceptable either in the runoff model or erosion model the indicator reliability values of p pmax pmin p erosive p30 e and r showed to be above 0 4 and thus acceptable whereas values of i i30 and r p erosive were less than 0 4 as for soil conditions only the indicator reliability values of sg in the runoff model and of wsac 0 25mm and gravel content in the erosion model were in an acceptable range in general the results prove that the constructed interaction models are effective and valid 4 discussions 4 1 simple main effects of rainfall and soil behind linear relationships the linear regression for rainfall runoff erosion relationships on the four soils indicated that both rainfall and soil had strong simple main effects on storm based runoff generation and soil loss previous studies have demonstrated that rainfall is the initial and fundamental driving force to cause the break detachment and displacement of soil particles wu et al 2018 zambon et al 2021 thus the main effect of rainfall that determines the magnitude and range of runoff and erosion yields is easy to understand while the main effect of soil is a complex that integrates the effects of various soil indexes it determined the potentialities of runoff and erosion that represents the long term integrated response of soil to a variety of hydrological and erosion processes our results showed that the potentialities of both runoff and erosion were different among soils which may be due to the different combinations of soil intrinsic properties and its external conditions runoff potentiality i e runoff ability ra decreased in the order of purple red loess karst soil fig 3a which could be attributed to the decreasing soil water holding capacity determined by soil thickness soil texture and bedrock permeability for purple soil the thin bedded silt loam above impermeable sand shale of the jurassic suining formation could easily reach the saturation point and thus instantly developed productive saturation excess overland flow zhong et al 2019 for the karst soil the thin bedded clay above fractured limestone bedrock has multiple permeable pathways such as fissures in the carbonate bedrock siemers and dreybrodt 1998 cracks in clay soil zhu et al 2018 and rock soil interfaces sohrt et al 2014 these karstic fracture networks allowed the rapid infiltration of gravity driven flow or preferential flow yang et al 2016 which resulted in the low potentiality of surface runoff in the shallow karst vadose zone the loess soil and red soil had medium runoff potentialities because the thick soil profile and rich fine particles facilitated the occurrence of the mild infiltration excess overland flow whereas the relatively more clay facilitated the higher runoff potential of red soil comparing to the loess soil erosion potentiality i e soil erodibility k decreased in the order of loess red purple karst soil fig 3b this rank is consistent with the rank of soil organic matter som and water stable aggregate content wsac and it agrees well with an existing study of sediment yields for different soil types under the same rainfall conditions wang et al 2011 our statistical analyses showed that the k value had a significant negative correlation with wsac r 0 989 p 0 05 insignificant negative correlations with som r 0 788 p 0 05 clay r 0 659 p 0 05 and rock fragment r 0 880 p 0 05 and an insignificant positive correlation with soil thickness r 0 916 p 0 05 these results agree with the findings reported by liu et al 2020 on soil aggregates fu et al 2011 on soil thickness and niu et al 2019 on rock fragments most notably the soil aggregate stability was expected to be the critical factor that determined soil erodibility 4 2 interaction effects of rainfall and soil behind non linear relationships once the effect of an independent variable is not linear to the dependent variable but depends on the condition of the other independent variable then the two factors interact cox 1984 dodge and commenges 2006 the usle based models assume that soil erodibility k factor is a constant value for a specific soil that is independent of the rainfall erosivity r factor early study has clearly pointed out that soil erodibility varies non uniformly with rainfall erosivity morgan 1983 our results further suggested that erodibility k is not a definite constant for all storms but could vary with the level of erosivity r in different patterns among soils the same for the runoff ability ra on one hand the potentialities of runoff and erosion i e runoff ability ra and erodibility k that determined by soil conditions changed with the level of rainfall erosivity with over 20 or even 100 variations suggesting that the soil effect depended on the rainfall condition on another hand the change patterns were different among soils revealing that the rainfall effect also depended on the soil condition in the following discussion of the reasons behind these interaction behaviours we would assess the two aspects for runoff and erosion separately the variation of runoff potentiality with the increasing level of rainfall erosivity on the four soils fig 4 could be divided into two groups considering the soil thickness for thick soils where infiltration excess overland flow prevails i e the loess soil depth 200 cm and red soil depth 100 cm the potentiality of runoff was relatively steady but tended to decrease after a critical point of rainfall erosivity the decrease was slight on loess soil 21 but considerable on red soil 53 which may be due to the difference in soil texture table 1 given the depletion of fine particles during a long rainstorm the surface of granite derived red soil with high content of sand 49 tended to be coarsened with more macro pores and thus the potentiality of runoff decreased mamedov et al 2001 while this phenomenon could hardly happen on the loess soil with very low content of sand 14 5 as for the soils with very limited soil depth the variations of runoff potentiality were more evident and the change direction was determined by the permeability of bedrock for thin soils above impermeable bedrock such as the purple soil depth 40 cm the potentiality of runoff increased by 93 after the rainfall erosivity exceeded 506 5 ei which may be due to that the productive saturation excess overland flow was initiated by the saturation of the shallow soil layer ferreira et al 2016 however this trend was reversed for the same shallow karst soil depth 21 cm and its runoff ability ra decreased by 64 once the rainfall exceeded 180 8 ei this paradox was likely due to the rich fissures in the fractured karstified limestone underlying the thin soil macpherson 1996 once the saturation point was reached within the thin soil excess water would quickly flow through the paths in fractured bedrocks to groundwater ford and williams 2013 thus the subsequent runoff generation did not change to saturation excess but an even more weak infiltration excess flow the variation of erosion potentiality with the increasing level of rainfall erosivity on the four soils fig 5 could be divided into two groups one is for the purple soil and red soil that the variation of erodibility k coincided with that of runoff ability ra for the purple soil the saturation of the shallow soil layer depth 40 cm above the impermeable bedrock sand shale could initiate the shift of hydrological process from infiltration excess to saturation excess runoff generation but also induce the shift of erosion process from rainfall driven to runoff driven transport and thus the increase in sediment transportation for the sandy clay loam red soil sand 49 0 clay 26 2 silt 24 8 the coarsening of soil surface could facilitate the infiltration but also reduce the capacity of flow to cause erosion and increase the resistance of soil surface descroix et al 2001 another group is for the loess soil and karst soil that the variation of erodibility k did not coincide with that of runoff ability ra for the fine textured loess soil silt 70 6 clay 14 9 that lacks of aggregation wsac 23 4 sealing and crusting were prone to form by raindrop impact however once the power of rainfall exceeded the resistance of the crusts rills were likely to develop on the exposed soil slattery and bryan 1992 and the subsequent erosion processes tended to transform from inter rill to rill erosion moore and singer 1990 this transformation induced by the failure of soil crusts has been expected to cause a decrease in the runoff potentiality moss and watson 1991 an increase in the erosion potentiality he et al 2017 and higher sediment concentration sun et al 2019 which agrees well with our results figs 4 6 for the karst soil the runoff ability ra decreased but the erodibility k increased when the light rainfall upgraded to moderate rainfall over 180 8 ei the increase in k may relate to the characteristic of clay soil that is hardly erodible in gentle rainfall but intensively eroded in intensive rainfall wu et al 2017b while the decrease of runoff potentiality was expected to have a prolonged effect on the erosion potentiality considering the decrease of k when the rainfall exceeded 1090 8 ei figs 4 5 from the above analyses it seemed that different combinations of intrinsic properties e g soil texture and aggregation and external conditions e g soil depth and bedrock permeability of soil could trigger different shifts of hydrological and erosion processes during rainfall in which the intrinsic properties sandy fine textured and poor aggregation associated with the change of soil surface coarsening crusting or decrusting the external conditions thin soil above impermeable or fractured bedrock determined the change of soil infiltration decelerate or accelerate when the soil was saturated 4 3 interaction effects of rainfall and soil in pls path modeling a previous study suggested that the erosion model incorporating the interaction of factors may have more convincing outputs than the model arranging factors in isolation beven and brazier 2011 our study further proves that factoring in the interaction effects is expected to substantially improve the model performance in the predictions of runoff and erosion the pls path modeling results showed that the model could still have high predictive capability even if excluded the interaction factor however the model with interaction consideration could substantially improve the prediction accuracy the addition of the interaction factor contributed 9 2 and 6 0 increase in the coefficient of determination r 2 for the prediction of annual runoff and erosion respectively the improvements reached significant levels because the effect sizes f 2 of the interaction terms were large for both runoff and erosion besides significant path coefficient β of the interaction factor further support the hypothesis on the existence of significant interaction effects notably the negative effects β 0 of the interaction of rainfall and soil factors that exerted on annual runoff and erosion need to be clarified the simple interpretation is that the more interaction effects the less runoff generation and soil loss the models in fig 9a and fig 10a could be specified as 8 surface r u n o f f 0 382 r a i n f a l l e f f e c t s 0 291 s o i l p e r m e a b i l i t y 0 274 i n t e r a c t i o n e f f e c t s e 9 soil l o s s 0 303 r a i n f a l l e f f e c t s 0 572 s o i l a n t i e r o d i b i l i t y 0 169 i n t e r a c t i o n e f f e c t s e where e is the measurement error interaction effects for eq 8 refers to rainfall effects soil permeability and for eq 9 represents rainfall effects soil anti erodibility it is easy to understand that either higher rainfall or lower soil permeability or soil anti erodibility alone could lead to higher annual yields of runoff and erosion however how to explain the higher rainfall and soil permeability namely the higher rainfall effects soil permeability the lesser runoff and the higher rainfall and soil anti erodibility namely the higher rainfall effects soil anti erodibility the lesser erosion concerning the reason for the negative interaction phenomenon there might be some clues in the variations of runoff and erosion potentialities on the four soils we have mentioned above for example the results on the karst soil fit the case that the higher rainfall and soil permeability the lesser runoff potentiality as shown in fig 4 the runoff potentiality of the karst soil decreased by 64 once the rainfall exceeded 180 8 ei our regression analysis of data on the karst soil showed that the erosivity from one millimeter of rainfall is 4 91 ei in a rainfall of 180 8 ei thus the corresponding rainfall amount was about 36 8 mm our previous study showed that the volumetric soil water content of the karst soil was 22 for the antecedent dry condition and 40 for the saturated soil condition yang et al 2021 thus the rainfall amount that caused saturation should be about 18 of the 21 cm thickness i e 37 8 mm very close to the 36 8 mm rainfall of 180 8 ei obviously the decrease in the runoff potentiality once the rainfall exceeded 180 8 ei were highly likely to associate with the saturation of the karst soil once the thin karst soil was saturated the quick paths in the underlying fractured bedrocks accelerated the infiltration in accord with the feature of higher rainfall and higher soil permeability a similar feature could be found on red soil and loess soil since the surface coarsening and decrusting could facilitate the infiltration liao et al 2019 nciizah and wakindiki 2015 regarding the negative path coefficient of interaction effects the result of the red soil fits the case that the higher rainfall and soil anti erodibility the lesser erosion as seen in fig 5 the erosion potentiality on the red soil decreased by 53 once the rainfall exceeded 660 5 ei the coarsening of soil surface on the sandy clay loam could increase the resistance of surface to erosion in line with the feature of the higher rainfall and higher soil anti erodibility a similar feature could be found on the karst soil because the decrease of runoff had the same effect as the increasing soil anti erodibility beyond the above examples the feature that the higher rainfall and lower soil permeability the more runoff could be found on the thin purple soil above impermeable bedrock the feature that the higher rainfall and lower soil anti erodibility the more erosion could be found on the crust prone loess soil all these coincidences implied that once the rainfall exceeded a critical point that the soil conditions were substantially changed the subsequent potentialities of runoff and erosion would be greatly changed and thus determined the long term outcome from the above it seemed that the negative interaction was embodied in the variations of runoff and erosion potentialities for a specific soil during large rainfall and its effect could be projected to a long term result this may explain the negative interaction in the pls path modeling that the higher rainfall and permeability the lesser annual runoff and the higher rainfall and anti erodibility the lesser annual erosion 4 4 prediction uncertainties induced by the interaction effects there exists a general tendency for over prediction of small events and under prediction of large events in respect of runoff and erosion predictions this well known prediction bias has been found in the applications of many hydrological and erosion models such as the usle risse et al 1993 rusle rapp 1994 water erosion prediction project wepp ghidey et al 1995 zhang et al 1996 soil and water assessment tool swat wolkerstorfer and strauss 2004 and annualized agricultural non point source pollution model annagnps polyakov et al 2007 some researchers attributed this tendency to the result of the inherent characteristic of the erosion model that can hardly capture the unpredictable natural variation nearing 1998 tiwari et al 2000 while kinnell 2003 explained the overestimation of small events through the soil properties he noted that the overestimation of small events tends to occur on the soil that has a high capacity to infiltrate rainfall and the degree of overestimation increases with the capacity of the soil to infiltrate rainfall that is the higher soil permeability the more overestimations of runoff and erosion in small events this conclusion agrees well with our results and we would further provide deeper insight into the reason behind the prediction bias tendency in the following discussion we could speculate from the study of kinnell 2003 that the overestimation of small events would be a big problem for soils with high inherent permeability and the underestimation of small events may be a considerable issue for soils with low inherent permeability our error evaluation for the prediction cases that ignore the nonlinearities from the interaction effects could support this speculation the results for runoff table 2 showed that about 75 of small events were over predicted for purple soil that has high inherent permeability while 70 of small events were also under predicted for karst soil that has low inherent permeability due to the high content of clay the corresponding results for erosion table 3 showed that about 77 of small erosion events were over predicted for purple soil with high inherent permeability in accord with its result for runoff however we found that about 95 of small erosion events were over predicted for karst soil with low inherent permeability which may be due to the high anti erodibility of clay this contradiction indicated that soil anti erodibility rather than soil permeability should be the main index that implies the prediction bias of small erosion events thus the runoff overestimation of small events tended to occur on soil with high permeability e g coarse textured purple soil while the erosion overestimation of small events tended to occur on soil with high anti erodibility e g purple soil and karst soil with high aggregation and gravel by the vice versa principle the underestimations of runoff and erosion in small events are expected to occur on soil with low permeability e g red soil and karst soil with high clay and low anti erodibility e g red soil with low aggregation respectively the above examples in the parentheses are all the evidence from our results to support the corresponding reasoning results however there is an extraordinary case that the loess soil with high permeability and low anti erodibility tended to underestimate runoff and overestimate erosion of small events this can be attributed to the crust prone feature of the loess soil because the soil crusts can reduce infiltration and produce an equivalent effect of low permeability but also protect soil and result in a high anti erodibility thus when we need to forecast the prediction bias for small events or for the period with more frequent small events the intrinsic permeability and anti erodibility of soil are the foremost diagnostic indicators and the typical change of soil surface in small events such as sealing and crusting should also be taken into consideration following the clue of the above analysis for the small events we may further into the explanation for prediction bias of large events similar to the small events the capacity of the soil to produce runoff or resist erosion is expected to indicate the prediction bias of runoff or erosion in large events respectively but unlike the small events that mainly focus on the intrinsic properties of soil the consideration for large events should also take into account the external conditions associated with soil such as the soil crust soil depth bedrock permeability gravel or rock involvement among others our preceding analyses indicated that these features could trigger the changes of hydrological and erosion processes when the soil layer was saturated or the soil surface changed evidently during a large rainfall that is the soil conditions that imply the prediction bias of large events were not unvarying but would change after a critical point of rainfall thus the change of infiltration rate of the whole vadose zone the layer of soil and rock could imply the runoff prediction bias of large events the variation of anti erodibility of the land surface including crust and soil may indicate the erosion prediction bias of large events in which the increase higher and decrease lower are expected to denote the overestimation and underestimate our segmental error analyses on the four soils can exactly support the above assumption regarding the runoff prediction table 2 the overestimation of large events that occurred on the loess soil karst soil and red soil agrees with the increased infiltration due to the destruction of crusts the involvement of fractured bedrock underlying thin soil and the surface coarsening process respectively the runoff underestimation of large events that occurred on the purple soil echoes with the decreased infiltration due to the saturation of thin soil above impermeable bedrock as for the erosion prediction table 3 the overestimation of large events that occurred on the red soil and karst soil agrees with the increased anti erodibility due to the coarsen surface and the increased infiltration due to the saturation of thin soil above fractured bedrock respectively the erosion underestimation of large events occurred on the loess soil and purple soil accords with the decreased anti erodibility due to decrusting and the decreased infiltration due to the saturation of thin soil above fractured bedrock respectively from the above we found that the prediction bias of small events or large events was not an inherent mathematical phenomenon that can hardly explain but a result of interaction between rainfall and soil that can predict the prediction bias of small events could be estimated with soil intrinsic permeability and anti erodibility and the prediction bias of large events associated with the changes in the infiltration of the whole vadose zone and anti erodibility of the land surface apart from the segmental prediction bias for small and large events the reason behind the overall prediction bias should also be explained previous studies have suggested that usle risse et al 1993 meinen and robinson 2021 and wepp ghidey et al 1995 zhang et al 1996 have general over prediction performances in the estimations of annual runoff and erosion the negative path coefficients of interaction effects of rainfall and soil factors in our pls path models may explain the general over prediction performance of these models without interaction terms compared to the model excluding interaction term the model with interaction is expected to predict the runoff and erosion with values that closer to the reality in eqs 8 and 9 the interaction effects were expressed with rainfall effects soil permeability and rainfall effects soil anti erodibility for annual runoff and erosion modeling respectively thus if the rainfall effects have no change or difference the higher soil permeability the larger interaction effects for runoff modeling and the higher soil anti erodibility the larger interaction effects for erosion modeling as shown in eqs 8 and 9 the larger interaction effects that have negative regression coefficients β 0 the larger overestimations if excluding the interaction effects in the model with interaction term that s to say excluding the interaction effects from the models with interaction is expected to cause overestimations of runoff and erosion this may explain the overall overestimation phenomena in the existing models without interaction terms according to the above analyses soil permeability means the intrinsic soil permeability for small events while the infiltration of the whole vadose zone for large events and soil anti erodibility denotes the intrinsic soil anti erodibility for small events while the anti erodibility of land surface for large events thus when the interaction effects is factored out more overestimations of runoff and erosion tend to occur on the soil with high permeability and anti erodibility respectively or the soil with evident increased infiltration and anti erodibility during large rainfall respectively these analyses agree well with the above speculations about prediction bias and thus prove its validity 5 conclusions this study provides robust evidence to support the hypothesis that the interaction effects of rainfall and soil factors exist in the hydrological and erosion processes and thus induce considerable uncertainties in the prediction the interaction effects were reflected in the non linearities of rainfall runoff erosion relationships namely the variations of runoff and erosion potentialities for a specific soil during large rainfall the potentialities of runoff and erosion were determined by the combination of soil intrinsic properties and its external conditions namely the soil factor however the potentialities of both runoff and erosion were not constants for a specific soil but varied with the level of rainfall erosivity in different patterns among soils indicating the mutual interactions between rainfall and soil factors the interaction between rainfall and soil is essentially a result of comprehensive effects of rainfall and the whole vadose zone or geological substrate especially for the region with thin soil our pls path modeling for annual runoff and erosion indicated that the interaction effects of rainfall and soil factors were significant negative β 0 p 0 10 the negative interaction factors have multi fold implications first runoff and erosion tend to be over predicted if excluding the interaction factors from the model frame which agrees with the general overestimation performance of existing models second the higher the soil permeability and anti erodibility the more the overestimations on runoff and erosion respectively third the soil loss from steep slopes still tends to be over predicted even though the s factor has been calibrated indicating the existing topographic calibration can hardly eliminate the prediction uncertainty from the interaction effects moreover the prediction bias for small events or large events was found predictable and rooted in the interaction between rainfall and soil this work evidences the importance of factoring in the interaction effects and the results provide references for the mechanisms behind the non linearity and the prediction bias in runoff and erosion estimations declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgements this study was supported by the national natural science foundation of china 41730748 and the national key research and development project of china 2016yfc0503705 no conflicts of interest exist in the submission of this manuscript the authors would like to thank prof yun xie for providing spatial data of rainfall erosivity in fig 1 from the project national soil erosion dynamic monitoring of china 2018 2022 
3700,water erosion is a complex process driven by many factors such as rainfall soil topography vegetation and land use management practices much research has been done to assess the separate effect of every single factor while studies devoted to the interaction effects among these factors are rarely reported the complex interactions among factors are generally poured into the pool of soil erodibility k factor in the usle based models which induces uncertainty of the k factor and thus causes prediction errors the interaction between rainfall r and soil k factors is the first and foremost step to dissect the entire interaction complex but also the objective this study intended to investigate quality controlled data from long term field observations on four bare steep slopes in different geographic regions of china were selected and standardized to exclude the effect of unconcerned factors the interaction effects of rainfall and soil factors were visualized by the nonlinearities of accumulative rainfall runoff erosion relationships and then further quantified by the evaluation of prediction errors for the cases that ignore the nonlinearities and by the approach of partial least squares structural equation modelling pls sem the results indicated that the interaction between rainfall and soil factors exists in water erosion processes and obscures the hydrological and erosion prediction 1 the potentialities of both runoff and erosion varied with the level of rainfall erosivity in different patterns among soils indicating diverse nonlinearities of rainfall runoff erosion relationships and the complex interaction effects behind it 2 the addition of the interaction effects in the sem model constructions increased 9 2 and 6 0 of variance explanations for the predictions of annual runoff and erosion respectively whereas the exclusion of interaction effects tended to cause overestimations on steep slopes that were hard to be calibrated by existing formulas 3 the well known tendency to underestimate small and overestimate large events does not suit every soil especially for the soil with coarse texture and shallow soil with fractured bedrock and prediction bias was found predictable and rooted in the interaction between rainfall and soil this study yields a deeper understanding of interaction effects and is helpful for the improvement of runoff and erosion predictions keywords factor interaction prediction uncertainty soil erodibility runoff ability mesoplot scale structural equation modeling 1 introduction soil erosion is a global environmental issue that triggers the loss of fertile topsoil and threatens food safety in many parts of the world pimentel 2006 how to assess or predict soil loss reliably and precisely has always been very a gordian knot ever since the beginning of soil erosion research trimble and crosson 2000 parsons 2019 even the most successful water erosion model the universal soil loss equation usle wischmeier and smith 1978 has been widely reported that there were considerable errors when it was applied to estimate soil loss in different regions countries and continents zhang et al 2016 benavidez et al 2018 alewell et al 2019 the complex interactions among erosion factors have been considered as a significant source of the prediction uncertainty wischmeier 1976 beven and brazier 2011 benavidez et al 2018 soil erosion by rainfall and runoff is a complex process affected by many factors the usle estimates water erosion by multiplying the values of the six factors 1 a r k l s c p where a is the average annual soil loss t hm 2 yr 1 r is the rainfall and runoff factor also termed as rainfall erosivity index mj mm hm 2 h 1 k is the soil erodibility factor t h mj 1 mm 1 l is the slope length factor unitless s is the slope gradient factor unitless c is the cover management factor unitless p is the conservation practice unitless in which the r is the base value that denotes the potential erosive energy of rainfall and runoff induced by rainfall k is the base value that represents the intrinsic susceptibility of a specific soil to erosion by raindrop splash and runoff wash during rainfall the other four factors l s c p are multipliers that outline the environment namely the media that accommodates erosion processes previous studies have primarily been focused on the separate effect of every single factor however very few research has been devoted to the effects of multi factor interactions on water erosion hua et al 2019 this contrast reflects the fact that most erosion models have a major intrinsic limitation that they basically neglect the complex interactions among factors in order to distinguish more easily the individual effect of each factor roose 1996 however in the context of bottlenecked prediction accuracy there is a growing consensus that soil erosion is a complex process determined by the mutual interaction of many factors cebecauer and hofierka 2008 also there is a growing need now to disentangle the complex interactions among factors estrada carmona et al 2017 and factor the interaction effects into the model construction hua et al 2019 raza et al 2021 thus it s necessary to assess the prediction uncertainty that results from the interactions among the six factors in the application of usle based models the first and basic step into the dissection of the interaction complex is to explore the interaction between the rainfall factor r and soil factor k on the standard plot the usle defines soil erodibility k as the rate of soil loss per unit of rainfall erosion index for a specific soil as measured on a unit plot which is a plot that is a 22 13 m length l 1 of uniform 9 slope s 1 in continuous fallow condition c 1 with up and down clean tillage p 1 and no new input of organic matter for at least three years roose 1996 thus the k value for a specific soil is measured as the following equation 2 k a r l s c p 1 in which a is the average annual soil loss measured from plot sediment data r is the average annual rainfall erosivity index calculated from the rainfall records while k is the only value that is unknown and uncertain this definition implies that the soil erodibility k is a black box coefficient that integrates the complex interactions among the six factors and takes over all the corresponding uncertainties this model design that pours all the interaction effects into the pool of soil erodibility k factor induces uncertainty of the k factor and thus causes inherent prediction errors for usle based models this is why some researchers attributed the prediction errors to the uncertainties in soil erodibility borselli et al 2012 according to the definition of soil erodibility the value of k is embodied in the long term interactions that rainfall acts on the soil and reversely soil reacts to rainfall thus the interaction between rainfall r and soil k is the fundamental structure of the complex interactions that exist among erosion factors however few studies have been conducted to focus on the interaction between rainfall and soil and even rare in terms of a quantitative assessment of the interaction effect most attention has been paid to assess rainfall factor and soil factor separately fox and bryan 1992 nishigaki et al 2017 several studies that concern the interaction typically only emphasize that soil crust is a result of the interactions and it affects hydrological and erosion processes through altering surface conditions chamizo et al 2012 issa et al 2011 le bissonnais et al 1995 thus a deeper insight into the mechanism of the interaction between rainfall and soil and quantitative assessment of the interaction effect is very urgent the complex interactions between the soil and rainfall determine the processes and yields of runoff and erosion borselli et al 2012 this study hypothesizes that the interaction effects of rainfall and soil factors exist in the hydrological and erosion processes and thus lead to substantial uncertainty in the predictions of runoff and erosion thus the main objectives of this research were to identify the existence of interaction between rainfall and soil and to quantify the prediction uncertainties induced by the interaction effects to achieve the goal the specific objectives are as follows 1 to examine how the interaction between rainfall and soil affects the hydrological and erosion processes 2 to assess how many prediction biases were induced by the interaction effect 3 to identify whether the interaction effect reached a statistically significant level or not this work may be helpful for a better understanding of the mechanism of the rainfall soil interaction and the pathway the interaction causes prediction uncertainties 2 materials and methods 2 1 plot sites selection four typical stations were selected in the four regions with different geographical conditions namely the northwestern loess plateau region southwestern purple soil region southwestern karst region and southern red soil region fig 1 these four regions represent the main water erosion area under the hilly context in china and meanwhile differ in climate terrain lithology soil and vegetation wang et al 2015 to increase the possibility of detection of the interaction effects a steep slope that has a higher magnitude of yield and variation in soil loss el kateb et al 2013 is a better choice than a gentle one thus bare field plots with similar steep slopes were selected for each station detailed information of basic climate index soil properties and observation specifications for the four bare steep plots is listed in table 1 2 2 data collection we obtained 3 5 years of observations on the rainfall runoff and sediment during 1985 2014 for each plot rainfall data were automatically and continuously recorded by a rain gauge near the runoff plot runoff and sediment samples were artificially collected from the runoff plot after each rainfall event all the four plots were arranged with the demands for the management of unit plot records from the first two years after the plot construction and the rainfall events with no runoff or sediment were excluded to avoid distortions all the records were checked and corrected if there were any omissions or mistakes finally a total of 17 plot years of 227 event records from natural rainstorms were collected table 1 and the soil depth and lithology data were measured on the plot during the construction period the input data for the partial least squares structural equation modeling pls sem are composed of unvarying values of soil indexes and annual values of rainfall runoff and sediment data the soil data at each site was compiled from the existing plot information scientific journal articles jiang et al 2020 ruan et al 1995 sheng et al 2016 zhao et al 2013 academic dissertations gu 2004 he 2007 and harmonized world soil database hwsd v1 2 fao et al 2012 the rainfall runoff and sediment data were prepared with annual values based on the collected 17 plot years records from the four stations plus another 8 plot years records at yuexi a station similar to anxi from the early work ke and zhang 2021 in total 5 samples for soil data and 25 samples for annual rainfall runoff and sediment data were obtained more details of pls sem will be explained in section 2 4 2 as for the map data fig 1 30 years 1986 2015 of daily precipitation records were used to delineate the spatial distribution of annual rainfall erosivity in china besides the soil and water conservation regionalization map of china was obtained from the raw data in a published paper wang et al 2018 2 3 data standardization to compare the interaction patterns in different geographic regions the effects from differences in topography and rainfall regimes should be eliminated by data standardization 2 3 1 standardization of the topographic factor in the cases that the runoff plot data need to be calibrated to the unit plot with 22 13 m length and 9 slope gradient the equations refer to chinese soil loss equation csle algorithms liu et al 1994 liu et al 2000 liu et al 2002 for the cross geographic region comparisons in runoff and erosion the topographic factors were normalized to 20 m length and 15 26 2 slope gradient by referring to the standard of unit plot in china zhang et al 2000 with the transformed equations in our previous work ke and zhang 2021 2 3 2 standardization of the rainfall factor to remove the influences of diversities in the frequency distribution of raindrop size rainfall intensity and rainfall amount the standardization of the rainfall factor is also necessary rainfall erosivity r namely ei30 is the most frequently used index for the potentiality of a rainstorm to cause erosion due to its excellency in explaining the variation in soil loss wischmeier 1959 however the optimum indicator for the potentiality of a rainfall event to induce runoff still reaches no consensus to determine an appropriate indicator correlation and regression analyses of plot data in 227 rainstorms were performed the results suggested that rainfall erosivity ei30 is the most closely correlated rainfall index for both runoff and erosion with spearman correlation coefficients of 0 82 and 0 79 respectively p 0 01 moreover rainfall erosivity ei30 could explain 78 0 and 72 0 of the variabilities in runoff and erosion respectively p 0 01 thus index ei30 can not only embody the effect of rainfall on erosion but also runoff therefore the rainfall erosivity ei30 was selected as the rainfall factor to represent the effect of rainfall on surface runoff and soil loss the calculation of ei30 refers to the algorithm of brown and foster 1987 in the rusle model 2 4 methods for interaction detection 2 4 1 factorial design factorial designs allow the analysis of the main effect also called a simple effect of each factor as well as the effect of interactions between factors on the target rainfall erosivity and soil type were set as the rainfall factor and soil factor in the factorial design the main effects of rainfall and soil were directly testified by the linearity of rainfall runoff erosion relationships furthermore the interaction effects of rainfall and soil were visualized by the non linearities breaks in double mass curves of rainfall runoff erosion with cumulative data in the order of rainfall size a continuous least square piecewise linear regression approach was used to identify the critical point break in the slope and then divide the double mass curve into two or three linear segments the ratio bn bn 1 was used to reflect the degree of the change between the slope of the segment before the break bn 1 and the slope of the segment after the break bn this study used a 20 difference in the slope as the criterion of significant change thus bn bn 1 smaller than 0 80 or larger than1 20 indicated a significant change the interaction effects on runoff and erosion predictions were further quantified by error evaluation for the prediction cases that ignore the non linearities given that the indication of rainfall erosivity index ei30 to runoff generation is the same excellent as to soil loss see section 2 3 2 a new concept runoff ability ra was proposed as an index for runoff generation potentiality as a counterpart of soil erodibility k factor that denotes soil loss potentiality the ra was defined as the runoff depth induced by unit rainfall erosivity on a unit plot runoff ability ra and soil erodibility k for each soil listed in table 2 and table 3 respectively were estimated with average annual data by calculating the ratios of runoff depth and soil loss to rainfall erosivity after topographic calibrations l 22 13 m s 5 the predictions of both runoff and erosion were approached by the equations r r ra and a r k after topographic calibrations l 20 m s 15 for ra and k respectively nash sutcliffe efficiency nse and normalized root mean square error nrmse were used to assess the general prediction accuracy 3 nse 1 i 1 n y i y i 2 i 1 n y i y 2 4 nemse rmse mean i 1 n y i y i 2 n y nse denotes the prediction efficiency optimal 1 good 0 7 1 satisfactory 0 4 0 7 unsatisfactory 0 0 4 unacceptable 0 wu et al 2017a nrmse measures the estimation error perfect 0 good 0 0 15 satisfactory 0 15 0 25 unsatisfactory 0 25 0 50 poor 0 50 daggupati et al 2016 the prediction errors were further piecewise evaluated through the percentages of over under predicted events as well as their overall percentage errors ope and mean absolute error mae tables 2 and 3 5 ope i 1 n y i i 1 n y i i 1 n y i 100 6 mae i 1 n y i y i n where y i is the i th measurement y i is the i th predicted value y is the mean of the entire measurements n is the number of observations 2 4 2 partial least squares structural equation modeling pls sem in this study we chose the partial least squares structural equation modeling pls sem approach to test the existence of interaction effect and its significant level in a statistical way pls sem model is an elegant way to examine the structural hypotheses and reveal the complex causal relationships between variables of interest fan et al 2016 including to test the moderating effect namely interaction effects with the dataset of small sample size non normal distribution and multidimensional constructs hsu et al 2006 2 4 2 1 pls sem model construction the pls sem consists of two sub models the structural model and measurement model fig 2 the inner model namely the structural model interprets the relationships between constructs and endogenous latent variables we constructed a two factor interaction model with three constructs rainfall effects soil conditions and their cross product interaction effects and two endogenous latent variables annual runoff and annual soil loss here we hypothesized that the interaction effects i e rainfall effects soil conditions exert significant impacts on the annual runoff and annual soil loss the outer model namely measurement model describes the relationships between the latent and observed variables we selected nine reflective indicators as the observed variables for the latent variables rainfall effects and soil conditions respectively the soil conditions were measured by soil texture clay silt sand dg sg soil water retention and aggregation stability som wsac 0 25mm soil mass soil depth and rock fragment gravel content the rainfall effects were reflected by precipitation amount p pmax pmin erosive rainfall amount p erosive p30 rainfall energy e rainfall intensity i i30 rainfall erosivity r r p erosive we implemented the pls sem analyses with the moderating effect module in smartpls 3 0 https www smartpls com to test the above hypothesized relationships 2 4 2 2 pls sem model evaluation 1 measurement model evaluation the measurement model evaluation is to examine the quality of indicators here we focus on the reliability of the indicators for the rainfall and soil factors the indicator loading denotes correlations between each latent variable and the observed variable the individual indicator reliability that is calculated by squaring the indicator loading denotes an indicator s variance that can be explained by the underlying latent variable for which a value over 0 4 is regarded as satisfactory in a reflective model hulland 1999 2 structural model evaluation path coefficient β coefficient of determination r 2 and stone geisser s q 2 values can assess the explanatory power of the structural model the β represents the influence of constructs on endogenous latent variables equivalent to standardized regression coefficients which can examine the direction and strength of causal linkages grace 2006 the r 2 represents the goodness of fit for the model which ranges from 0 to 1 and the values of 0 10 0 25 0 50 0 75 can be regarded as insignificant weak moderate and substantial respectively hair jr et al 2016 q 2 value from the blindfolding procedure is a criterion of the model s predictive capability the higher the q 2 value and the higher the model s predictive capability chin 2010 3 effect size evaluation the effect size f 2 is a useful way to detect whether a construct has a substantive impact on the endogenous variable in the testing for interaction effects using pls sem we followed a hierarchical process that compares the r 2 results of two models namely the main effect model the model without interaction and the interaction model limayem et al 2001 the effect size of the interaction effects was suggested to be assessed by the cohen effect size formula cohen 1998 7 f 2 r with interaction 2 r without interaction 2 1 r with interaction 2 where f 2 is the effect size of interaction r 2 with interaction is the r 2 of the interaction model r 2 without interaction is the r 2 of the model without the interaction term interaction effects with f 2 of 0 02 0 15 and 0 35 have been suggested as small medium and large effects respectively cohen 1998 besides the interaction effects the effect size f 2 of the simple main effects of rainfall effects and soil conditions were also used to assess whether they have substantive influences on the annual yield of runoff and erosion the calculation refers to the algorithm of boßow thies and albers 2010 4 significance test the significance of model parameters for both the measurement and structural models can be tested by the t statistics from bootstrapping procedure with 5000 iterations given the uncertainty in field measurement and the small sample size i e 25 in the modeling the lowest significance level for a hypothesis test was set at 0 10 level 3 results 3 1 simple linear relationships for rainfall runoff erosion to demonstrate that there may be an interaction the first step is to determine the simple main effects the simple main effects of rainfall and soil on runoff and erosion can be directly recognized by the simple linear regression analyses based on event data in fig 3 a and b respectively on one hand there appeared a simple main effect of rainfall high rainfall erosivity generally resulted in higher yields of runoff and sediment than low rainfall erosivity the regression coefficients were all positive and significantly different from zero p 0 05 the coefficients of determination r 2 were all above 0 75 p 0 05 in which the r 2 ranged from 0 80 to 0 97 in rainfall runoff regressions fig 3a and from 0 78 to 0 98 in rainfall erosion regressions fig 3b thus rainfall erosivity had strong explanatory power for the variances in runoff generation average 88 5 and soil loss average 87 8 on the other hand there also appeared a simple main effect of soil different soil conditions lead to different rates of variation in runoff and erosion with rainfall erosivity the regression coefficients for rainfall runoff and rainfall erosion relationships namely the potentialities of runoff and erosion are different among soils the slopes of the fitting lines for rainfall runoff relationships were ranked as purple soil 0 070 red soil 0 048 loess soil 0 027 karst soil 0 023 fig 3a the slopes of the fitting lines for rainfall erosion relationships were ranked as loess soil 0 051 red soil 0 028 purple soil 0 017 karst soil 0 013 fig 3b taken together the unmatched slope rankings between rainfall runoff and rainfall erosion regressions on the four soils implied different levels of sediment concentration in different soil conditions as seen in fig 3c the sediment concentrations were ranked as loess soil 1 804 red soil 0 561 karst soil 0 514 purple soil 0 238 3 2 double mass curve relationships for rainfall runoff erosion to confirm whether the rainfall runoff and rainfall erosion relationships remain the same for all storms double mass curve analyses were performed to check the non linearity evident breaks namely critical points in the slopes of rainfall runoff fig 4 and rainfall erosion curves fig 5 were observed on all soil types the slope of the rainfall runoff curve measures the level of runoff induced by unit rainfall effect that reflects the runoff generation potentiality namely runoff ability ra the slope of rainfall erosion denotes the rate of soil loss caused by unit rainfall effect that represents the soil loss potentiality i e soil erodibility k the ratio bn bn 1 for each break was either below 0 80 or above 1 20 indicating the significant change thus over 20 variations in potentialities of runoff and erosion after the breaks were identified for all the four soils indicating that the potentialities of runoff and erosion were significantly affected by the level of rainfall erosivity moreover the changing patterns of double mass curves are different among the four soils with regard to rainfall runoff curves moderate decrease 21 and compelling increase 93 in the slopes after the break were found on the loess soil and purple soil respectively and striking decreases above 50 in the slopes after the breaks were shown on the karst soil and red soil fig 4 as for rainfall erosion curves moderate increase 42 and compelling increase 102 in the slopes after the break were observed on the loess soil and purple soil respectively and a strong decrease 58 in the slope after the break appeared on the red soil whereas a complex three stages with two breaks in rainfall erosion curves were shown on the karst soil with dramatic increase 540 and then moderate decrease 42 in the slopes after the first and then the second break fig 5 these different changing patterns revealed that the effects of rainfall factor on the potentialities of runoff and erosion were substantially controlled by the soil condition different change direction and break position between rainfall runoff and rainfall erosion curves caused the varying level of sediment concentration with increasing rainfall erosivity especially on the loess soil and karst soil fig 6 the sediment concentrations for the loess soil and karst soil increased to 1 96 and 1 62 times the common level when runoff depth exceeded 29 54 mm and 23 04 mm respectively whereas sediment concentrations for the purple soil and red soil were relatively steady with the upgrade of rainfall erosivity thus the sediment concentration that reflects the relationship between runoff and erosion had different responses when it comes to different rainfall magnitudes or soil types and the uncertain relationships between runoff and erosion may be evidence of the complexity of interaction effects of soil and rainfall factors on the hydrological and erosion processes 3 3 errors in runoff and erosion predictions for surface runoff the predicted and measured values along the change of rainfall erosivity were plotted in fig 7 the nses for runoff estimation ranged from 0 71 to 0 95 indicating good prediction efficiency in which annual prediction outperformed the event prediction the nrmses namely prediction errors for runoff estimation ranged from 0 50 to 1 13 with an average of 0 82 for event prediction indicating unacceptable results fairly higher than the nrmses for the annual prediction that ranged from 0 10 to 0 29 with an average of 0 20 in respect of soil type purple soil and karst soil had lower nses and higher nrmses thus lower prediction accuracy than the cases for loess soil and red soil regarding the results of maes loess soil had the lowest magnitude of errors red soil had the highest value due to rich rainfall and karst soil and purple soil belonged to the medium level overall the predictions of surface runoff have better performances on loess soil and red soil than that on purple soil and karst soil based on the critical points in rainfall runoff double mass curve fig 4 more in depth segmental error analyses of runoff prediction based on rainfall erosivity ranges for different soils are listed in table 2 runoff yields on loess soil karst soil and red soil were commonly under predicted for small rainfall events but over predicted for big storms on the contrary runoff yield on purple soil was majorly over predicted with an mae of 5 3 mm for small rainfall events but under predicted by 36 2 with an mae of 26 8 mm for big storms over 506 5 ei these features of error distribution for individual runoff estimation generally agree with the cases for the annual estimation for instance runoff yields in the high rainfall year were under predicted on purple soil but over predicted on loess soil karst soil and red soil fig 7 for soil loss the comparisons of predicted and measured values along with increasing rainfall erosivity were shown in fig 8 the nrmses for event erosion prediction ranged from 0 57 to 0 98 with an average of 0 85 indicating unacceptable erosion prediction errors in contrast to the low nrmses for the annual prediction that ranged from 0 22 to 0 29 with an average of 0 24 compared to the loess soil and karst soil the purple soil and red soil had lower nses but higher nrmses thus lower prediction accuracy especially for annual soil loss prediction on the red soil the nse was a negative value 0 48 indicating an unacceptable performance that the predictor was less agreeable than the mean observed value as for the results of maes red soil had the highest average magnitude of errors loess soil belonged to the medium level and karst soil and purple soil had the lowest value taken as a whole both individual and annual estimations of soil loss using usle had better performance on loess soil and karst soil than that on purple soil and red soil according to the critical positions in rainfall erosion double mass curves fig 5 dissection error analyses of erosion prediction based on rainfall erosivity ranges are presented in table 3 largely soil loss yields on loess soil and purple soil tended to be over predicted in small rainfall events but under predicted in big storms over 640 8 ei whereas soil loss yield on red soil was mostly under predicted with an mae of 4 5 t hm 2 for small rainfall events but over predicted with an mae of 25 3 t hm 2 for big storms over 660 5 ei similarly soil loss yields on karst soil was over predicted by 15 3 with an mae of 5 0 t hm 2 for extreme storms over 1090 8 ei but majorly under predicted with an mae of 4 1 t hm 2 for medium storms and mostly over predicted with an mae of 0 3 t hm 2 for light rainfalls 180 8 ei combined with the comparison between predicted and measured values of annual erosion the above segmental features of prediction bias of events erosion estimation generally agree with that of the annual erosion estimation for instance soil loss amounts in the high rainfall year were under predicted on loess soil and purple soil but over predicted on karst soil and red soil fig 8 3 4 identification of interaction effects using pls path modeling pls sem results of two runoff models fig 9 and two erosion models fig 10 were compared stone geisser s q 2 values for the two pairs of models were all above 0 5 suggesting that the two factor model was predictive whether the interaction factor was incorporated or not the coefficient of determination r 2 for the two pairs of models were all above 0 75 indicating substantial predictive accuracy with or without the interaction factor however the contribution of interaction effects beyond the simple main effects was substantial in the accuracy improvements for the predictions of runoff and erosion the r 2 for the runoff model with interaction term reached 0 952 fig 9a apparently higher than the 0 872 for the model without interaction fig 9b a similar trend was observed for erosion models the r 2 for the model with interaction reached 0 923 fig 10a higher than the 0 890 for the model without interaction fig 10b thus models with interaction consideration could explain more variance in annual runoff and annual soil loss concerning the detection of the interaction effects both the effect size and regression coefficients were tested tables 4 the effect sizes of the interaction effects were large for both annual runoff f 2 1 67 and annual soil loss f 2 0 93 indicating that the improvement of r 2 reached a significant level henseler and fassott 2010 i e a practical significance plus the statistical significance that the path coefficients of the interaction effects on annual runoff β 0 274 and annual soil loss β 0 169 were both negative and significantly different from zero p 0 10 taken together these results indicated that the interaction effects imposed practically and statistically significant negative impacts on the predictions of both runoff and erosion regarding the results of the simple main effects practically and statistically significant main effects of rainfall and soil factors were also verified tables 4 effect sizes for the rainfall effects and soil conditions were also rated as large f 2 0 35 for both runoff and erosion models proving practically significant simple main effects from rainfall and soil factors moreover rainfall effects had a statistically significant and positive path coefficient for annual runoff β 0 382 p 0 01 as well as annual soil loss β 0 303 p 0 05 contrariwise soil conditions had a statistically significant and negative path coefficient for annual runoff β 0 291 p 0 10 as well as annual soil loss β 0 572 p 0 01 by comparing the two path coefficients we could draw an interesting tendency that the annual runoff was more sensitive to rainfall effects while the annual soil loss was more sensitive to soil conditions since significant negative effects of soil factor i e soil conditions were tested in both runoff model and erosion model the specific indication of the soil conditions in the two models should be identified in the runoff model the soil conditions should indicate soil permeability given the significant positive correlation between soil conditions and gravel content as well as silt loadings are 0 460 and 0 563 respectively p 0 10 in the erosion model the soil conditions should denote soil anti erodibility considering the significant positive correlation between soil conditions and wsac 0 25mm as well as gravel content loadings are 0 802 and 0 959 respectively p 0 01 thus we defined the soil factor in runoff model as soil permeability while in erosion model as soil anti erodibility these results demonstrated that either higher rainfall or lower soil permeability or soil anti erodibility alone could lead to higher annual yields of runoff and erosion moreover individual indicator s correlation and reliability to their factor in the models with interaction terms were evaluated tables 4 the t statistics for significance testing of indicator loadings give clues to the correlations between the factor and its indicators rainfall indicators that highly denote annual rainfall power including p pmax pmin p erosive p30 e r and r p erosive were significantly p 0 05 correlated with the rainfall effects on both runoff and erosion soil indicators that associate with soil permeability including sg borselli et al 2009 silt and gravel content were significantly p 0 10 correlated with annual runoff and that relate to soil erodibility such as gravel content wsac 0 25mm soil depth dg shirazi and boersma 1984 and som were significantly p 0 05 correlated with annual soil loss regarding the indicator reliability the reliability of individual indicators for rainfall effects was majorly acceptable either in the runoff model or erosion model the indicator reliability values of p pmax pmin p erosive p30 e and r showed to be above 0 4 and thus acceptable whereas values of i i30 and r p erosive were less than 0 4 as for soil conditions only the indicator reliability values of sg in the runoff model and of wsac 0 25mm and gravel content in the erosion model were in an acceptable range in general the results prove that the constructed interaction models are effective and valid 4 discussions 4 1 simple main effects of rainfall and soil behind linear relationships the linear regression for rainfall runoff erosion relationships on the four soils indicated that both rainfall and soil had strong simple main effects on storm based runoff generation and soil loss previous studies have demonstrated that rainfall is the initial and fundamental driving force to cause the break detachment and displacement of soil particles wu et al 2018 zambon et al 2021 thus the main effect of rainfall that determines the magnitude and range of runoff and erosion yields is easy to understand while the main effect of soil is a complex that integrates the effects of various soil indexes it determined the potentialities of runoff and erosion that represents the long term integrated response of soil to a variety of hydrological and erosion processes our results showed that the potentialities of both runoff and erosion were different among soils which may be due to the different combinations of soil intrinsic properties and its external conditions runoff potentiality i e runoff ability ra decreased in the order of purple red loess karst soil fig 3a which could be attributed to the decreasing soil water holding capacity determined by soil thickness soil texture and bedrock permeability for purple soil the thin bedded silt loam above impermeable sand shale of the jurassic suining formation could easily reach the saturation point and thus instantly developed productive saturation excess overland flow zhong et al 2019 for the karst soil the thin bedded clay above fractured limestone bedrock has multiple permeable pathways such as fissures in the carbonate bedrock siemers and dreybrodt 1998 cracks in clay soil zhu et al 2018 and rock soil interfaces sohrt et al 2014 these karstic fracture networks allowed the rapid infiltration of gravity driven flow or preferential flow yang et al 2016 which resulted in the low potentiality of surface runoff in the shallow karst vadose zone the loess soil and red soil had medium runoff potentialities because the thick soil profile and rich fine particles facilitated the occurrence of the mild infiltration excess overland flow whereas the relatively more clay facilitated the higher runoff potential of red soil comparing to the loess soil erosion potentiality i e soil erodibility k decreased in the order of loess red purple karst soil fig 3b this rank is consistent with the rank of soil organic matter som and water stable aggregate content wsac and it agrees well with an existing study of sediment yields for different soil types under the same rainfall conditions wang et al 2011 our statistical analyses showed that the k value had a significant negative correlation with wsac r 0 989 p 0 05 insignificant negative correlations with som r 0 788 p 0 05 clay r 0 659 p 0 05 and rock fragment r 0 880 p 0 05 and an insignificant positive correlation with soil thickness r 0 916 p 0 05 these results agree with the findings reported by liu et al 2020 on soil aggregates fu et al 2011 on soil thickness and niu et al 2019 on rock fragments most notably the soil aggregate stability was expected to be the critical factor that determined soil erodibility 4 2 interaction effects of rainfall and soil behind non linear relationships once the effect of an independent variable is not linear to the dependent variable but depends on the condition of the other independent variable then the two factors interact cox 1984 dodge and commenges 2006 the usle based models assume that soil erodibility k factor is a constant value for a specific soil that is independent of the rainfall erosivity r factor early study has clearly pointed out that soil erodibility varies non uniformly with rainfall erosivity morgan 1983 our results further suggested that erodibility k is not a definite constant for all storms but could vary with the level of erosivity r in different patterns among soils the same for the runoff ability ra on one hand the potentialities of runoff and erosion i e runoff ability ra and erodibility k that determined by soil conditions changed with the level of rainfall erosivity with over 20 or even 100 variations suggesting that the soil effect depended on the rainfall condition on another hand the change patterns were different among soils revealing that the rainfall effect also depended on the soil condition in the following discussion of the reasons behind these interaction behaviours we would assess the two aspects for runoff and erosion separately the variation of runoff potentiality with the increasing level of rainfall erosivity on the four soils fig 4 could be divided into two groups considering the soil thickness for thick soils where infiltration excess overland flow prevails i e the loess soil depth 200 cm and red soil depth 100 cm the potentiality of runoff was relatively steady but tended to decrease after a critical point of rainfall erosivity the decrease was slight on loess soil 21 but considerable on red soil 53 which may be due to the difference in soil texture table 1 given the depletion of fine particles during a long rainstorm the surface of granite derived red soil with high content of sand 49 tended to be coarsened with more macro pores and thus the potentiality of runoff decreased mamedov et al 2001 while this phenomenon could hardly happen on the loess soil with very low content of sand 14 5 as for the soils with very limited soil depth the variations of runoff potentiality were more evident and the change direction was determined by the permeability of bedrock for thin soils above impermeable bedrock such as the purple soil depth 40 cm the potentiality of runoff increased by 93 after the rainfall erosivity exceeded 506 5 ei which may be due to that the productive saturation excess overland flow was initiated by the saturation of the shallow soil layer ferreira et al 2016 however this trend was reversed for the same shallow karst soil depth 21 cm and its runoff ability ra decreased by 64 once the rainfall exceeded 180 8 ei this paradox was likely due to the rich fissures in the fractured karstified limestone underlying the thin soil macpherson 1996 once the saturation point was reached within the thin soil excess water would quickly flow through the paths in fractured bedrocks to groundwater ford and williams 2013 thus the subsequent runoff generation did not change to saturation excess but an even more weak infiltration excess flow the variation of erosion potentiality with the increasing level of rainfall erosivity on the four soils fig 5 could be divided into two groups one is for the purple soil and red soil that the variation of erodibility k coincided with that of runoff ability ra for the purple soil the saturation of the shallow soil layer depth 40 cm above the impermeable bedrock sand shale could initiate the shift of hydrological process from infiltration excess to saturation excess runoff generation but also induce the shift of erosion process from rainfall driven to runoff driven transport and thus the increase in sediment transportation for the sandy clay loam red soil sand 49 0 clay 26 2 silt 24 8 the coarsening of soil surface could facilitate the infiltration but also reduce the capacity of flow to cause erosion and increase the resistance of soil surface descroix et al 2001 another group is for the loess soil and karst soil that the variation of erodibility k did not coincide with that of runoff ability ra for the fine textured loess soil silt 70 6 clay 14 9 that lacks of aggregation wsac 23 4 sealing and crusting were prone to form by raindrop impact however once the power of rainfall exceeded the resistance of the crusts rills were likely to develop on the exposed soil slattery and bryan 1992 and the subsequent erosion processes tended to transform from inter rill to rill erosion moore and singer 1990 this transformation induced by the failure of soil crusts has been expected to cause a decrease in the runoff potentiality moss and watson 1991 an increase in the erosion potentiality he et al 2017 and higher sediment concentration sun et al 2019 which agrees well with our results figs 4 6 for the karst soil the runoff ability ra decreased but the erodibility k increased when the light rainfall upgraded to moderate rainfall over 180 8 ei the increase in k may relate to the characteristic of clay soil that is hardly erodible in gentle rainfall but intensively eroded in intensive rainfall wu et al 2017b while the decrease of runoff potentiality was expected to have a prolonged effect on the erosion potentiality considering the decrease of k when the rainfall exceeded 1090 8 ei figs 4 5 from the above analyses it seemed that different combinations of intrinsic properties e g soil texture and aggregation and external conditions e g soil depth and bedrock permeability of soil could trigger different shifts of hydrological and erosion processes during rainfall in which the intrinsic properties sandy fine textured and poor aggregation associated with the change of soil surface coarsening crusting or decrusting the external conditions thin soil above impermeable or fractured bedrock determined the change of soil infiltration decelerate or accelerate when the soil was saturated 4 3 interaction effects of rainfall and soil in pls path modeling a previous study suggested that the erosion model incorporating the interaction of factors may have more convincing outputs than the model arranging factors in isolation beven and brazier 2011 our study further proves that factoring in the interaction effects is expected to substantially improve the model performance in the predictions of runoff and erosion the pls path modeling results showed that the model could still have high predictive capability even if excluded the interaction factor however the model with interaction consideration could substantially improve the prediction accuracy the addition of the interaction factor contributed 9 2 and 6 0 increase in the coefficient of determination r 2 for the prediction of annual runoff and erosion respectively the improvements reached significant levels because the effect sizes f 2 of the interaction terms were large for both runoff and erosion besides significant path coefficient β of the interaction factor further support the hypothesis on the existence of significant interaction effects notably the negative effects β 0 of the interaction of rainfall and soil factors that exerted on annual runoff and erosion need to be clarified the simple interpretation is that the more interaction effects the less runoff generation and soil loss the models in fig 9a and fig 10a could be specified as 8 surface r u n o f f 0 382 r a i n f a l l e f f e c t s 0 291 s o i l p e r m e a b i l i t y 0 274 i n t e r a c t i o n e f f e c t s e 9 soil l o s s 0 303 r a i n f a l l e f f e c t s 0 572 s o i l a n t i e r o d i b i l i t y 0 169 i n t e r a c t i o n e f f e c t s e where e is the measurement error interaction effects for eq 8 refers to rainfall effects soil permeability and for eq 9 represents rainfall effects soil anti erodibility it is easy to understand that either higher rainfall or lower soil permeability or soil anti erodibility alone could lead to higher annual yields of runoff and erosion however how to explain the higher rainfall and soil permeability namely the higher rainfall effects soil permeability the lesser runoff and the higher rainfall and soil anti erodibility namely the higher rainfall effects soil anti erodibility the lesser erosion concerning the reason for the negative interaction phenomenon there might be some clues in the variations of runoff and erosion potentialities on the four soils we have mentioned above for example the results on the karst soil fit the case that the higher rainfall and soil permeability the lesser runoff potentiality as shown in fig 4 the runoff potentiality of the karst soil decreased by 64 once the rainfall exceeded 180 8 ei our regression analysis of data on the karst soil showed that the erosivity from one millimeter of rainfall is 4 91 ei in a rainfall of 180 8 ei thus the corresponding rainfall amount was about 36 8 mm our previous study showed that the volumetric soil water content of the karst soil was 22 for the antecedent dry condition and 40 for the saturated soil condition yang et al 2021 thus the rainfall amount that caused saturation should be about 18 of the 21 cm thickness i e 37 8 mm very close to the 36 8 mm rainfall of 180 8 ei obviously the decrease in the runoff potentiality once the rainfall exceeded 180 8 ei were highly likely to associate with the saturation of the karst soil once the thin karst soil was saturated the quick paths in the underlying fractured bedrocks accelerated the infiltration in accord with the feature of higher rainfall and higher soil permeability a similar feature could be found on red soil and loess soil since the surface coarsening and decrusting could facilitate the infiltration liao et al 2019 nciizah and wakindiki 2015 regarding the negative path coefficient of interaction effects the result of the red soil fits the case that the higher rainfall and soil anti erodibility the lesser erosion as seen in fig 5 the erosion potentiality on the red soil decreased by 53 once the rainfall exceeded 660 5 ei the coarsening of soil surface on the sandy clay loam could increase the resistance of surface to erosion in line with the feature of the higher rainfall and higher soil anti erodibility a similar feature could be found on the karst soil because the decrease of runoff had the same effect as the increasing soil anti erodibility beyond the above examples the feature that the higher rainfall and lower soil permeability the more runoff could be found on the thin purple soil above impermeable bedrock the feature that the higher rainfall and lower soil anti erodibility the more erosion could be found on the crust prone loess soil all these coincidences implied that once the rainfall exceeded a critical point that the soil conditions were substantially changed the subsequent potentialities of runoff and erosion would be greatly changed and thus determined the long term outcome from the above it seemed that the negative interaction was embodied in the variations of runoff and erosion potentialities for a specific soil during large rainfall and its effect could be projected to a long term result this may explain the negative interaction in the pls path modeling that the higher rainfall and permeability the lesser annual runoff and the higher rainfall and anti erodibility the lesser annual erosion 4 4 prediction uncertainties induced by the interaction effects there exists a general tendency for over prediction of small events and under prediction of large events in respect of runoff and erosion predictions this well known prediction bias has been found in the applications of many hydrological and erosion models such as the usle risse et al 1993 rusle rapp 1994 water erosion prediction project wepp ghidey et al 1995 zhang et al 1996 soil and water assessment tool swat wolkerstorfer and strauss 2004 and annualized agricultural non point source pollution model annagnps polyakov et al 2007 some researchers attributed this tendency to the result of the inherent characteristic of the erosion model that can hardly capture the unpredictable natural variation nearing 1998 tiwari et al 2000 while kinnell 2003 explained the overestimation of small events through the soil properties he noted that the overestimation of small events tends to occur on the soil that has a high capacity to infiltrate rainfall and the degree of overestimation increases with the capacity of the soil to infiltrate rainfall that is the higher soil permeability the more overestimations of runoff and erosion in small events this conclusion agrees well with our results and we would further provide deeper insight into the reason behind the prediction bias tendency in the following discussion we could speculate from the study of kinnell 2003 that the overestimation of small events would be a big problem for soils with high inherent permeability and the underestimation of small events may be a considerable issue for soils with low inherent permeability our error evaluation for the prediction cases that ignore the nonlinearities from the interaction effects could support this speculation the results for runoff table 2 showed that about 75 of small events were over predicted for purple soil that has high inherent permeability while 70 of small events were also under predicted for karst soil that has low inherent permeability due to the high content of clay the corresponding results for erosion table 3 showed that about 77 of small erosion events were over predicted for purple soil with high inherent permeability in accord with its result for runoff however we found that about 95 of small erosion events were over predicted for karst soil with low inherent permeability which may be due to the high anti erodibility of clay this contradiction indicated that soil anti erodibility rather than soil permeability should be the main index that implies the prediction bias of small erosion events thus the runoff overestimation of small events tended to occur on soil with high permeability e g coarse textured purple soil while the erosion overestimation of small events tended to occur on soil with high anti erodibility e g purple soil and karst soil with high aggregation and gravel by the vice versa principle the underestimations of runoff and erosion in small events are expected to occur on soil with low permeability e g red soil and karst soil with high clay and low anti erodibility e g red soil with low aggregation respectively the above examples in the parentheses are all the evidence from our results to support the corresponding reasoning results however there is an extraordinary case that the loess soil with high permeability and low anti erodibility tended to underestimate runoff and overestimate erosion of small events this can be attributed to the crust prone feature of the loess soil because the soil crusts can reduce infiltration and produce an equivalent effect of low permeability but also protect soil and result in a high anti erodibility thus when we need to forecast the prediction bias for small events or for the period with more frequent small events the intrinsic permeability and anti erodibility of soil are the foremost diagnostic indicators and the typical change of soil surface in small events such as sealing and crusting should also be taken into consideration following the clue of the above analysis for the small events we may further into the explanation for prediction bias of large events similar to the small events the capacity of the soil to produce runoff or resist erosion is expected to indicate the prediction bias of runoff or erosion in large events respectively but unlike the small events that mainly focus on the intrinsic properties of soil the consideration for large events should also take into account the external conditions associated with soil such as the soil crust soil depth bedrock permeability gravel or rock involvement among others our preceding analyses indicated that these features could trigger the changes of hydrological and erosion processes when the soil layer was saturated or the soil surface changed evidently during a large rainfall that is the soil conditions that imply the prediction bias of large events were not unvarying but would change after a critical point of rainfall thus the change of infiltration rate of the whole vadose zone the layer of soil and rock could imply the runoff prediction bias of large events the variation of anti erodibility of the land surface including crust and soil may indicate the erosion prediction bias of large events in which the increase higher and decrease lower are expected to denote the overestimation and underestimate our segmental error analyses on the four soils can exactly support the above assumption regarding the runoff prediction table 2 the overestimation of large events that occurred on the loess soil karst soil and red soil agrees with the increased infiltration due to the destruction of crusts the involvement of fractured bedrock underlying thin soil and the surface coarsening process respectively the runoff underestimation of large events that occurred on the purple soil echoes with the decreased infiltration due to the saturation of thin soil above impermeable bedrock as for the erosion prediction table 3 the overestimation of large events that occurred on the red soil and karst soil agrees with the increased anti erodibility due to the coarsen surface and the increased infiltration due to the saturation of thin soil above fractured bedrock respectively the erosion underestimation of large events occurred on the loess soil and purple soil accords with the decreased anti erodibility due to decrusting and the decreased infiltration due to the saturation of thin soil above fractured bedrock respectively from the above we found that the prediction bias of small events or large events was not an inherent mathematical phenomenon that can hardly explain but a result of interaction between rainfall and soil that can predict the prediction bias of small events could be estimated with soil intrinsic permeability and anti erodibility and the prediction bias of large events associated with the changes in the infiltration of the whole vadose zone and anti erodibility of the land surface apart from the segmental prediction bias for small and large events the reason behind the overall prediction bias should also be explained previous studies have suggested that usle risse et al 1993 meinen and robinson 2021 and wepp ghidey et al 1995 zhang et al 1996 have general over prediction performances in the estimations of annual runoff and erosion the negative path coefficients of interaction effects of rainfall and soil factors in our pls path models may explain the general over prediction performance of these models without interaction terms compared to the model excluding interaction term the model with interaction is expected to predict the runoff and erosion with values that closer to the reality in eqs 8 and 9 the interaction effects were expressed with rainfall effects soil permeability and rainfall effects soil anti erodibility for annual runoff and erosion modeling respectively thus if the rainfall effects have no change or difference the higher soil permeability the larger interaction effects for runoff modeling and the higher soil anti erodibility the larger interaction effects for erosion modeling as shown in eqs 8 and 9 the larger interaction effects that have negative regression coefficients β 0 the larger overestimations if excluding the interaction effects in the model with interaction term that s to say excluding the interaction effects from the models with interaction is expected to cause overestimations of runoff and erosion this may explain the overall overestimation phenomena in the existing models without interaction terms according to the above analyses soil permeability means the intrinsic soil permeability for small events while the infiltration of the whole vadose zone for large events and soil anti erodibility denotes the intrinsic soil anti erodibility for small events while the anti erodibility of land surface for large events thus when the interaction effects is factored out more overestimations of runoff and erosion tend to occur on the soil with high permeability and anti erodibility respectively or the soil with evident increased infiltration and anti erodibility during large rainfall respectively these analyses agree well with the above speculations about prediction bias and thus prove its validity 5 conclusions this study provides robust evidence to support the hypothesis that the interaction effects of rainfall and soil factors exist in the hydrological and erosion processes and thus induce considerable uncertainties in the prediction the interaction effects were reflected in the non linearities of rainfall runoff erosion relationships namely the variations of runoff and erosion potentialities for a specific soil during large rainfall the potentialities of runoff and erosion were determined by the combination of soil intrinsic properties and its external conditions namely the soil factor however the potentialities of both runoff and erosion were not constants for a specific soil but varied with the level of rainfall erosivity in different patterns among soils indicating the mutual interactions between rainfall and soil factors the interaction between rainfall and soil is essentially a result of comprehensive effects of rainfall and the whole vadose zone or geological substrate especially for the region with thin soil our pls path modeling for annual runoff and erosion indicated that the interaction effects of rainfall and soil factors were significant negative β 0 p 0 10 the negative interaction factors have multi fold implications first runoff and erosion tend to be over predicted if excluding the interaction factors from the model frame which agrees with the general overestimation performance of existing models second the higher the soil permeability and anti erodibility the more the overestimations on runoff and erosion respectively third the soil loss from steep slopes still tends to be over predicted even though the s factor has been calibrated indicating the existing topographic calibration can hardly eliminate the prediction uncertainty from the interaction effects moreover the prediction bias for small events or large events was found predictable and rooted in the interaction between rainfall and soil this work evidences the importance of factoring in the interaction effects and the results provide references for the mechanisms behind the non linearity and the prediction bias in runoff and erosion estimations declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgements this study was supported by the national natural science foundation of china 41730748 and the national key research and development project of china 2016yfc0503705 no conflicts of interest exist in the submission of this manuscript the authors would like to thank prof yun xie for providing spatial data of rainfall erosivity in fig 1 from the project national soil erosion dynamic monitoring of china 2018 2022 
3701,raw forecasts from numerical weather prediction models suffer from systematic bias and cannot be directly used in applications such as hydrological forecasting statistical post processing methods can be used to remove the bias and achieve reliable ensemble forecasts however traditional post processing methods generally use local raw forecasts as the only predictor which limits their ability to extract spatial information from raw forecasts in this paper we develop a convolutional neural network cnn based post processing method for precipitation forecasts to make use of spatial information and atmospheric circulation variables as auxiliary predictors the results show that the proposed cnn based post processing model outperforms traditional methods in forecast accuracy and reliability especially for heavy rain the improvements of the cnn based model relative to a state of the art joint probability model can reach 5 and 8 in terms of brier skill score for heavy rain and rainstorms at the lead time of 1 day the improvements can be attributed to the use of auxiliary predictors such as total column water forecasts in the proposed model moreover the cnn based model transcends a fully connected network fcn based post processing model which illustrates the benefits of using cnns to extract spatial information the results illustrate the proposed cnn based post processing model is able to utilize spatial information and various auxiliary predictors to improve forecast skill and quantify forecast uncertainty which is important for further applications such as hydrological forecasting keywords statistical post processing precipitation forecast convolutional neural network hydrological ensemble forecasting 1 introduction precipitation forecast is of great importance for applications such as inundation warning and flood forecasting ensemble precipitation forecasts have been provided by meteorological ensemble prediction systems in weather centers around the world ensemble precipitation forecasts can provide the uncertainty information of forecasts which is important for application such as risk decision making and ensemble hydrological forecasting duan et al 2019 schaake et al 2007 however due to deficiencies in numerical weather prediction nwp models and inaccurate initial conditions raw forecasts from nwp models suffer from systematic bias and under overdispersion issues and cannot be directly used in applications such as hydrological forecasting statistical post processing can be used to remove systematic bias in raw forecasts and quantify uncertainty cuo et al 2011 gneiting and katzfuss 2014 schaake et al 2007 traditional statistical post processing methods are based on statistical models including non parametric methods and parametric models non parametric methods such as analog hamill et al 2006 or quantile regression bremnes 2004 do not need assumptions for the distribution of the predictands parametric methods for the post processing of ensemble forecasts can be further classified into three types 1 regression methods such as ensemble model output statistics emos messner et al 2014 scheuerer and hamill 2015 wilks 2009 2 joint probability models such as meta gaussian models wu et al 2011 and bayesian joint probability bjp robertson et al 2013 shrestha et al 2015 wang et al 2009 3 kernel density methods such as ensemble dressing boucher et al 2015 and bayesian model averaging bma raftery et al 2005 sloughter et al 2007 there are also methods to construct spatio temporal or inter variable dependency of forecasts such as schaake shuffle clark et al 2004 and ensemble copula coupling ecc schefzik et al 2013 machine learning methods have been applied in the post processing of forecasts in recent years the advantages of machine learning methods include the use of more predictors such as atmosphere circulation predictors and topography descriptors haupt et al 2021 machine learning based methods also help to model the complex relationship between predictors and predictands to improve forecast skills for the post processing of deterministic forecasts various machine learning based methods have emerged including random forests and artificial neural networks herman and schumacher 2018 li et al 2019a for the post processing of ensemble forecasts the difficulty is how to predict the distribution of the predictand one class of methods predicts the quantiles of predictand by machine learning techniques like random forests taillardat et al 2019 another class of methods follows the emos or distributional regression scheme which uses machine learning methods to predict the parameters of the distribution of the predictand ghazvinian et al 2021 peng et al 2020 rasp and lerch 2018 other neural network based methods provide probabilistic predictions in the form of a mixture of density or the probability exceeding certain thresholds scheuerer et al 2020 veldkamp et al 2021 for more details of existing post processing models readers are referred to related books and reviews duan et al 2019 li et al 2017 vannitsem et al 2020 vannitsem et al 2018 although various post processing methods have been developed existing methods usually use predictors at the location to be predicted thus they cannot fully make use of spatial information to improve the forecast skill this issue can be solved by convolutional neural networks lecun et al 2015 which have been successfully used in applications such as downscaling to extract spatial information e g baño medina et al 2020 miao et al 2019 pan et al 2019 zhou et al 2019 however existing applications of cnn based methods are limited to deterministic forecasts e g han et al 2021 sha et al 2020 or variables such as temperature grönquist et al 2021 as far as we know the use of cnn models in statistical post processing of short term ensemble precipitation forecasts has not emerged due to the difficulties in modeling the intermittent feature and skewed distribution of precipitation amounts therefore we aim to develop a new post processing model for ensemble precipitation forecasts to make use of spatial information in this paper we apply a lenet type cnn model to predict the parameters of the probabilistic distribution of precipitation forecasts the proposed model combines the strength of cnns and the emos scheme to make good use of multi scale spatial information and quantify precipitation forecast uncertainty there are three main questions that we aim to answer in this research 1 how can we develop a post processing model to make use of multiple predictors and spatial information for precipitation forecasts 2 will the incorporation of more meteorological predictors in post processing models increase the skill of precipitation forecast 3 will the use of cnn based methods to extract spatial information improve forecast performance the remainder of the paper is structured as follows section 2 describes the research region and dataset section 3 describes post processing and verification methods section 4 exhibits the results section 5 exhibits the discussion and section 6 is the conclusion 2 research region and dataset as shown in fig 1 the research region is chosen as the huaihe river basin 30 55 36 36 n 111 55 121 25 e with a drainage area of 270 000 km2 which covers nearly five provinces with a dense population of 191 million people the huaihe river basin is one of china s important grain producing areas that contributes to about 1 6 of china s total grain output the region is under the influence of the east asian summer monsoon with annual precipitation of 700 1600 mm the precipitation mainly occurs during summer which leads to high flood risk for the region in the flooding season eight flood events including three catastrophic flood events in 2003 2007 and 2020 happened in the first 21 years of the 21st century which brings serious damages to people and properties in this region yu et al 2020 therefore it is important to develop advanced precipitation and hydrological forecasting techniques in this region the observations are the 0 25 0 25 gridded precipitation analysis during the rainy season over mainland china which is produced by optimal interpolation from the china meteorological administration cma shen and xiong 2016 we only use forecasts and corresponding observations during the summer may to august in this research the forecasts are the ens4ml 20 year hindcast dataset from european centre for medium range weather forecasts ecmwf 2020 as the source from ecmwf is no longer available we obtained the dataset through the online source of a related paper grönquist et al 2021 the original spatial resolution of the dataset is 0 5 0 5 which are bilinearly interpolated to 0 25 0 25 to be same as the observations the dataset includes forecasts at lead times of 24 h and 48 h the hindcasts were issued twice a week during 1998 2017 so there are 35 validation dates during summer may august in each year as there are many missing data in the cma observed dataset in 2017 we only use forecasts and observations during 1998 2016 predictors used in the models are shown in table 1 including single level predictors such as total precipitation and predictors at 850 500 200 hpa pressure levels to represent lower middle upper atmosphere conditions besides meteorological predictors we also use elevation data from 0 25 0 25 digital elevation model as predictors in neural network based models 3 method in this section we describe the post processing methods used in the research firstly we proposed a cnn based post processing method in subsection 3 1 to investigate the two research questions in the introduction we compare the proposed method with two benchmarks as shown in table 2 the first benchmark is a joint probability based post processing model that only uses raw precipitation forecasts at the location to be predicted i e without spatial information the other benchmark is a fully connected network fcn based model which also uses various meteorological variables as predictors but doesn t include spatial information the fcn based model is described at the end of subsection 3 1 the joint probability based model is described in subsection 3 2 the cross validation method is introduced in subsection 3 3 finally a permutation importance method is described in subsection 3 4 3 1 cnn and fcn based post processing methods we combine a lenet type cnn model with the emos scheme namely to predict the parameters of the distribution of precipitation by cnn as the distribution of precipitation amount is non negative and skewed we assume the predictand to follow censored shifted gamma csg distribution which has been successfully used in state of the art post processing methods baran and nemoda 2016 ghazvinian et al 2021 scheuerer and hamill 2015 the csg distribution of the predictand y is defined as follows 1 f y f k y δ θ y 0 0 y 0 where f k is gamma distribution with shape parameter k 0 θ is the scale parameter and δ 0 is the shift parameter the csg distribution is left censored at zero to ensure non negative precipitation amounts the probability of zero precipitation is set as the value of the cumulative distribution function of csg distribution at zero i e f k δ θ the parameters θ and k can be parameterized by mean μ and standard deviation σ of gamma distribution as follows 2 k μ 2 σ 2 θ σ 2 μ to make use of spatial information we use a lenet type cnn to model the relationship between the predictors and the three parameters δ μ a n d σ of the csg distribution of the predictand as shown in fig 2 the model mainly includes an input layer three convolutional layers embedding layers of latitude longitude a fully connection layer and an output layer which are described as follows the selection process of the hyperparameters of the neural network structure is shown in appendix b 1 inputs to the network are predictors of a square patch of 7 7 grids centered at the grid to be predicted as described in section 2 we use 30 meteorological variables and the elevation from the digital elevation model dem to construct input arrays with dimensions of 7 7 31 as in scheuerer and hamill 2015 we only use ensemble mean forecasts as predictors because ensemble mean generally contains most of the information in ensemble forecasts all the variables are normalized to 0 1 by min max normalization 2 there are three convolutional layers with 64 32 and 16 feature maps respectively the convolution operation is conducted by moving convolutional kernels here we use arrays with a size of 3 3 as the kernels to sweep across the input spatial fields and computing the dot product between the kernels and the inputs to extract spatial information the lth feature map of the nth layer x n l is computed from the previous layer x n 1 with k feature maps by convolution operation as follows 3 x n l e l u b n l k 1 k w n k l x n 1 k where matrices w n k l are the convolutional kernels to be multiplied with the kth feature map of the previous layer b n l is the bias for the lth feature map symbol indicates 2d convolution following ghazvinian et al 2021 we use exponential linear units elu are used as the nonlinear activation function as follows 4 f x x x 0 a e x 1 x 0 where a is the parameter to be estimated x is input to elu function each convolutional layer is followed by a batch normalization layer to normalize the data and accelerate optimization as the input layer size is small we use convolutional kernels with a kernel size of 3 3 grids we don t use padding because we aim to predict precipitation for the single grid in the center 3 to model the spatial heterogeneity we apply embedding layers to map the discrete latitude longitude index to real numbers guo and berkhahn 2016 rasp and lerch 2018 the outputs of the embedding layers and the flattened results of the convolutional layer are combined to a dense layer i e a fully connected layer of 18 neurons which is then connected to another dense layer of 6 neurons 4 the output layer of the network includes three neurons o 1 o 2 and o 3 which are linked to three parameters shift mean and standard deviation of the predicted csg distribution similar to the link functions used in scheuerer and hamill 2015 and ghazvinian et al 2021 we use link functions as follows 5 δ o 1 2 μ e x p o 2 σ e x p o 3 the structure of the fcn based post processing model is as follows different from cnn based models where the predictors at the neighborhood 7 7 grids are used the inputs to fcn are only the predictors from the grid point of interest firstly the latitude and longitude index of the location to be predicted are embedded into two nodes the embedding features and other 31 predictors are then combined and linked to a hidden layer of 16 nodes with elu as activation functions finally the hidden layer is connected to 3 output nodes which are then linked to three parameters of the csg distribution by eq 5 the selection process of the fcn structure is shown in appendix b the code of the proposed neural network based post processing model is available through https github com wentao bnu lenet csg precip the cnn or fcn based models are fitted by minimization of an analytical expression of the mean continuous ranked probability score crps computed from the predicted csg distribution and the true observations the analytical expression of crps is described in appendix a the cnn model is fitted by the adam optimization algorithm kingma and ba 2015 to avoid overfitting an early stopping technique is used to stop the fitting process if no significant improvements exist on the validation dataset finally ensembles forecasts can be generated by obtaining a certain number of quantiles of the predicted csg distribution here we set 100 as the ensemble size the generated ensembles are reordered by schaake shuffle to model the spatio temporal dependence for hydrological forecasting purposes clark et al 2004 details of schaake shuffle are omitted due to the limitation of space 3 2 joint probability post processing model a simplified version of bayesian joint probability bjp is used as a benchmark method which is referred to as the joint probability model jpm hereafter jpm uses maximum likelihood estimation mle instead of bayesian inference in bjp for parameter fitting because there is enough data to fit the parameters in short term forecasting jpm is a state of the art method for the post processing of short term precipitation forecasts it has been used successfully in the bureau of meteorology in australia to provide reliable ensemble precipitation forecasts products shrestha et al 2015 here we briefly introduce the jpm method firstly raw forecasts and observations are transformed to deal with the non gaussian distribution of precipitation amounts the power transform used in this research is shown as follows 6 x z p where z is the original variables x is the transformed variable that follows gaussian distribution parameter p and the parameters of the distribution of transformed variable are fitted by mle to model the feature of precipitation amount the precipitation less than a threshold set as 0 1 mm day here is treated as censored data during the estimation shrestha et al 2015 wang and robertson 2011 wang et al 2009 the transformation parameters for forecasts and observations are fitted separately then we assume the transformed forecasts x and transformed observations y follows a bivariate normal distribution namely 7 x y n μ x μ y σ x 2 ρ σ x σ y ρ σ x σ y σ y 2 where ρ is the correlation coefficients of transformed forecasts and observations which is estimated by mle μ x μ y σ x a n d σ y are the parameters of the distribution of transformed variables which are estimated during the previous step finally the conditional distribution of the predictand given future forecasts can be derived as follows 8 p y x n μ y ρ σ y σ x x μ x 1 ρ 2 σ y 2 random samples can be drawn from the conditional distribution and the samples can be transformed back to the original space to construct ensemble forecasts the sample size is also set as 100 the same as other post processing models used in the paper for more details of the joint probability model please refer to related references li et al 2019b li et al 2019c robertson et al 2013 shrestha et al 2015 wang et al 2009 3 3 cross validation method and verification metrics the 19 years of forecasts and corresponding observations during summer are randomly grouped into five groups four groups include 4 years the other group includes 3 years during 5 fold cross validation one group is used as the test dataset and the other four groups are used as the training dataset we further randomly select about 20 of the training dataset as the validation dataset to implement the early stopping technique for neural network models the joint probability model is fitted for each grid in the research region however for neural network based models we use data of all the 427 grids in the region to fit a single neural network model to ensure a sufficient sample size for example we have a training dataset of 35 d a y 15 y e a r 427 g r i d 224 175 days of hindcasts if the other 4 years are used as the test dataset where 427 is the number of grids in the research region and 35 is the number of issue days for the ecmwf hindcast during the summer the verification metrics used in the research include root mean square error rmse correlation coefficients continuous ranked probability skill score crpss α index a score for overall reliability brier skill score bss and reliability diagram the higher values of crpss or bss indicate better forecast skill the α index of ideally reliable forecasts is 1 those metrics except α index are computed using the python package meteva liu et al 2021 the descriptions of the metrics are listed in appendix c 3 4 permutation importance method to investigate the relative importance of each predictor we apply the permutation importance method breiman 2001 rasp and lerch 2018 first we evaluate the fitted model by the original test dataset to get a baseline metric noted as s c o r e b a s e here we use the correlation coefficients between ensemble mean forecasts and observations as the evaluation metric the results of other metrics are similar and are omitted then we shuffle the test data of the kth predictor i e an n 7 7 1 slice of the n 7 7 31 inputs along the predictor dimension across n test days while keeping the test data of the other predictors unchanged we make predictions using the modified test dataset and evaluate the results to get a metric noted as s c o r e k finally we define a metric i m p o r t a n c e k to measure the importance of kth predictor as follows 9 i m p o r t a n c e k s c o r e b a s e s c o r e k s c o r e b a s e the metric i m p o r t a n c e k measures the decrease of performance for the prediction without using kth predictor relative to the prediction using all predictors the larger value of the metric indicates the kth predictor is more important the process is looped for all the meteorological predictors and the elevation predictor to evaluate the importance of each predictor it should be noted that although the permutation importance method is convenient to implement it cannot deal with collinearities between features rasp and lerch 2018 4 results in this section we firstly present the verification results of different post processing methods in subsection 4 1 then the results of the importance of different predictors in the model are shown in subsection 4 2 4 1 evaluation of post processing methods 4 1 1 overall performance of deterministic forecasts figure 3 shows the bar plots for the verification results of the ensemble mean of raw forecasts and post processed results by jpm fcn and proposed cnn based post processing methods the height of each bar represents the mean of the verification results of all the grids in the research region and the error bars exhibit the 95 confidence intervals of the estimated mean of the metric by bootstrapping the verification results of rmse in fig 3a show that all three post processing methods decrease the rmse relative to raw forecasts which shows the effectiveness of all the three post processing methods the rmse results of cnn based methods are the smallest among the three post processing methods figure 3b shows the correlation coefficients between the ensemble mean forecasts and observations the correlation coefficients of the post processed results by jpm are generally the same as those of raw forecasts however the correlation coefficients of the results by fcn cnn based methods are higher than those of raw forecasts which shows the benefits of using fcn cnn based post processing models 4 1 2 probabilistic evaluation of ensemble forecasts figure 4 shows the overall probabilistic verification of post processed ensemble forecasts by three models the crpss of the cnn based method is the highest at both lead times which outperforms that of jpm by nearly 5 at the lead time of 1 day the results of the fcn based model outperform those of jpm by about 1 at both lead times which indicates the benefits of incorporation of more predictors moreover the cnn based model transcends the fcn based model at both lead times which exhibits the effectiveness of using spatial information as shown in fig 4b the α index of all three post processing methods are near to one which means all post processing methods can generate overall reliable forecasts figure 5 shows the brier skill score of the results of three post processing models at four thresholds namely 0 1 mm day 10 mm day 25 mm day and 50 mm day corresponding to light rain moderate rain heavy rain and rainstorms respectively similar to previous results the proposed cnn based post processing methods generally outperforms jpm especially for moderate and heavy rain events the improvements of the cnn based method over jpm reach 5 and 8 for heavy rain and rainstorms at the lead time of 1 day the results of the fcn based method are slightly worse than jpm for light rain but there are improvements over the results of jpm for other precipitation levels for example the improvements of the fcn based method over jpm can be as large as 4 for rainstorms at the lead time of 1 day which indicates the benefits of using more meteorological forecasts as predictors in post processing methods the improvements of cnn relative to the fcn based model at both lead times illustrate the benefits of using spatial information figure 6 shows the reliability diagram of three post processing methods at two lead times as shown in fig 6a the reliability curve of fcn cnn are slightly higher than the diagonal line which shows these results suffer from slight underestimation for light rain the reliability curves of the three methods are generally overlapped for moderate and heavy rain fig 6b and c however as shown in fig 6d the curve of cnn based methods is closer to diagonal lines than those of traditional methods for rainstorms which shows the advantage of using cnn based methods to achieve more reliable forecasts than traditional methods for rainstorm events moreover the frequency histograms of fcn cnn for bins of forecast probability larger than 0 7 are higher than those of jpm in fig 6c and d which indicates fcn cnn based methods can generate forecasts that are more confident than jpm 4 2 feature importance figure 7 shows the importance metrics of the 15 most important predictors for two lead times as shown in fig 7 total precipitation itself is the most important predictor with an importance score much higher than those of other predictors other relatively important predictors include specific humidity at 200 500 850 hpa q200 q500 q850 convective precipitation cp total column water tcw geopotential at 500 hpa z500 and mean sea level pressure msl 5 discussion traditional post processing methods mainly use local precipitation forecasts as the only predictor which cannot fully utilize spatial information in raw forecasts to overcome the limitations of traditional methods we propose a convolutional neural network based post processing scheme for precipitation forecasts in this research the results indicate that the proposed model is capable of using multiple atmospheric circulation predictors and spatial information to improve forecast skill we compared the proposed cnn based method with two benchmarks a joint probability model and an fcn based post processing model the findings of this research are as follows firstly the cnn based post processing model remarkably outperforms the joint probability model which only uses raw precipitation forecasts the permutation importance results also indicate that auxiliary predictors such as total column water and specific humidity contribute to the improvements of forecast skill the results indicate that the incorporation of more meteorological predictors to represent atmosphere circulation and moisture conditions can help to improve precipitation forecast skill for long lead times when the forecast skill of raw precipitation forecast is not sufficient moreover we compared the cnn based model with fcn based models that only use information from the grid of interest the results indicate that cnn based models perform better than the fcn based model which indicates the benefits of cnn based methods to extract spatial information the reason for the improvements is that raw precipitation forecasts from nwp models may suffer from location errors therefore adding nearby spatial predictors can improve forecast skills as mentioned in the introduction there are post processing methods that incorporate machine learning methods to provide probabilistic meteorological forecasts for predictand such as temperature e g peng et al 2020 rasp and lerch 2018 and precipitation ghazvinian et al 2021 our work extends the existing fcn based models to cnn based models for precipitation forecasts which enables the model to make use of multi scale spatial information and multiple auxiliary predictors the results in this research illustrate the benefits of cnns to extract spatial information which is consistent with other studies such as scheuerer et al 2020 moreover the proposed model applies the csg distribution to model the distribution of precipitation forecasts which successfully quantifies the uncertainty of precipitation forecast and achieves reliable forecasts the limitation of this research is that we only use nwp forecasts with a relatively coarse spatial resolution of 0 5 0 5 nwp forecasts with finer spatial resolution may further help to make use of exploiting multi scale spatial information and improve forecast skills besides we only use lenet type cnns in this research other types of cnn such as u net ronneberger et al 2015 might be able to better incorporate the information of larger spatial scales which is left to be investigated in the future 6 conclusions in this research we proposed a cnn based post processing method for short term precipitation forecasts the proposed model applied a lenet type cnn to predict the parameters of the distribution of precipitation which is modeled by csg distribution the proposed method is able to improve forecast skills by making use of spatial information and multiple auxiliary predictors including atmosphere circulation and elevation the main conclusions are as follows 1 the proposed cnn based post processing model outperforms traditional models that only use local precipitation forecasts the results show that the incorporation of spatial information in the post processing model considerably improves precipitation forecast skills 2 the use of auxiliary predictors that represent atmosphere circulation and moisture conditions such as forecasts of total column water specific humidity and wind contribute to the improvements in forecast skill the success of the proposed cnn based method indicates the benefits of deep learning methods in the post processing of weather forecasts the proposed method is meaningful to applications such as hydrological forecasting and water resource management more research on developing deep learning based post processing methods is recommended to further improve precipitation forecasts credit authorship contribution statement wentao li conceptualization methodology software validation visualization writing original draft baoxiang pan conceptualization methodology supervision writing review editing jiangjiang xia writing review editing qingyun duan conceptualization funding acquisition resources supervision writing review editing declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments we are grateful for the valuable comments from the editor and anonymous reviewers this work is funded by the national natural science foundation of china grant numbers 51979004 42105142 41830752 the fundamental research funds for the central universities grant number b210202014 2019b04614 and the china postdoctoral science foundation 2021m701045 appendix a the analytical expression of crps for csg distribution the analytical expression of crps for csg distribution is as follows ghazvinian et al 2021 scheuerer and hamill 2015 the subscript i of parameters k θ δ and corresponding observation y for the ith sample is omitted for simplicity c r p s f k θ δ y y δ 2 f k θ y δ 1 θ k π b 1 2 k 1 2 1 f 2 k θ 2 δ δ f k θ δ 2 a 1 θ k 1 2 f k θ δ f k 1 θ δ f k θ δ 2 2 f k 1 θ y δ where f k θ δ is censored shifted gamma distribution with shape parameter k scale parameter θ and shift parameter δ f k θ is gamma distribution with shape parameter k and scale parameter θ y is corresponding observation b is the beta function appendix b the results during the selection of cnn fcn structures we compare fcns with different numbers of hidden layers and nodes as shown in table b1 the first column indicates the number of nodes in each hidden layer for fcns for example the first row in table b1 indicates an fcn with one hidden layer with 8 nodes the third row indicates an fcn with two hidden layers which includes 32 and 16 nodes respectively other settings are the same as the fcn described in subsection 3 1 the crpss of the predictions by those fcns is shown in the second and third columns in table b1 the results show that the fcn with one hidden layer of 16 nodes performs the best as shown in table b2 we tune the size of the input layer and the number of feature maps in each convolutional layer for cnns for example the first row in table b2 indicates a cnn with an input layer size of 5 5 and two convolutional layers with 32 and 16 feature maps other settings are the same as the cnn described in subsection 3 1 the crpss of the predictions by those cnns is shown in the third and fourth columns in table b2 the results indicate that the cnn with an input layer size of 7 7 and three convolutional layers with 64 32 and 16 feature maps is most suitable for both lead times moreover we compared the crpss of cnns with without the embedding of latitude longitude as shown in table b3 the other settings of cnns are the same as the cnn described in subsection 3 1 the results indicate the embedding of latitude longitude can improve the prediction performance appendix c the verification metrics c 1 root mean square error root mean square error rmse of ensemble mean forecast f i and corresponding observation o i is defined as follows c 1 r m s e 1 n i 1 n f i o i 2 where n is the total number of forecast observation pairs c 2 correlation coefficients pearson correlation coefficients r is defined as follows c 2 r i 1 n f i f i o i o i i 1 n f i f i 2 i 1 n o i o i 2 c 3 brier score and brier skill score the brier score measures the mean square error of the forecast probabilities of the meteorological variables exceeding a threshold c 3 b s 1 n i 1 n f f i q f o i q 2 where f f i q is the probabilities of forecast exceeding the threshold q and f o i q is the corresponding binary observation depending on whether the observation o i exceeds the threshold as follows namely c 4 f o i q 1 o i q 0 o t h e r w i s e the brier skill score bss measures the relative improvement of the brier score of the main forecast system over that of a reference system e g the climatology as follows c 5 b s s 1 b s b s r e f the bss is positively oriented the bss for the perfect forecast is one while the bss is less than zero for forecasts with no skill relative to the reference c 4 continuous ranked probability score the continuous ranked probability score crps measures the integral square difference between the cumulative distribution functions cdf of a forecast and the corresponding cdf of observation as follows c 6 c r p s f f q f o q 2 d q then the mean crps of all samples can be computed from the average of the crps of all forecast and observation pairs the continuous rank probability skill score crpss can be computed as follows c 7 c r p s s 1 c r p s c r p s r e f where c r p s is the mean crps of the forecasts c r p s r e f is the mean crps for the reference the climatology is chosen as the reference in this study c 5 probability integral transform and α index the probability integral transform pit is the predictive cumulative distribution function cdf f t at the corresponding observation y t as follows c 8 p i t t f t y t the pit for reliable forecasts follows a uniform distribution when the observations are equal to or below the threshold of zero precipitation 0 1 mm day in this study a pseudo pit value is generated from a uniform distribution with the range of 0 f t y threshold where y threshold is the threshold of zero precipitation for observation robertson et al 2013 pit can be drawn in a pit diagram the results in pit diagrams can be further summarized by the α index as follows renard et al 2010 c 9 α 1 2 n t 1 n p i t t t n 1 where p i t t is the sorted p i t t values in increasing order n is the total number of forecast observation pairs the α index ranges from 0 worst reliability to 1 perfect reliability c 6 reliability diagram the reliability diagram reveals the reliability of probabilistic forecasts of the occurrence of binary events e g precipitation exceeding a particular threshold by plotting the observed relative frequencies against the forecast probability the reliability curves of forecasts with perfect reliability should be along the diagonal line more details of reliability diagrams can be found in related books wilks 2011 appendix d supplementary data supplementary data to this article can be found online at https doi org 10 1016 j jhydrol 2021 127301 appendix d supplementary data the following are the supplementary data to this article supplementary data 1 
3701,raw forecasts from numerical weather prediction models suffer from systematic bias and cannot be directly used in applications such as hydrological forecasting statistical post processing methods can be used to remove the bias and achieve reliable ensemble forecasts however traditional post processing methods generally use local raw forecasts as the only predictor which limits their ability to extract spatial information from raw forecasts in this paper we develop a convolutional neural network cnn based post processing method for precipitation forecasts to make use of spatial information and atmospheric circulation variables as auxiliary predictors the results show that the proposed cnn based post processing model outperforms traditional methods in forecast accuracy and reliability especially for heavy rain the improvements of the cnn based model relative to a state of the art joint probability model can reach 5 and 8 in terms of brier skill score for heavy rain and rainstorms at the lead time of 1 day the improvements can be attributed to the use of auxiliary predictors such as total column water forecasts in the proposed model moreover the cnn based model transcends a fully connected network fcn based post processing model which illustrates the benefits of using cnns to extract spatial information the results illustrate the proposed cnn based post processing model is able to utilize spatial information and various auxiliary predictors to improve forecast skill and quantify forecast uncertainty which is important for further applications such as hydrological forecasting keywords statistical post processing precipitation forecast convolutional neural network hydrological ensemble forecasting 1 introduction precipitation forecast is of great importance for applications such as inundation warning and flood forecasting ensemble precipitation forecasts have been provided by meteorological ensemble prediction systems in weather centers around the world ensemble precipitation forecasts can provide the uncertainty information of forecasts which is important for application such as risk decision making and ensemble hydrological forecasting duan et al 2019 schaake et al 2007 however due to deficiencies in numerical weather prediction nwp models and inaccurate initial conditions raw forecasts from nwp models suffer from systematic bias and under overdispersion issues and cannot be directly used in applications such as hydrological forecasting statistical post processing can be used to remove systematic bias in raw forecasts and quantify uncertainty cuo et al 2011 gneiting and katzfuss 2014 schaake et al 2007 traditional statistical post processing methods are based on statistical models including non parametric methods and parametric models non parametric methods such as analog hamill et al 2006 or quantile regression bremnes 2004 do not need assumptions for the distribution of the predictands parametric methods for the post processing of ensemble forecasts can be further classified into three types 1 regression methods such as ensemble model output statistics emos messner et al 2014 scheuerer and hamill 2015 wilks 2009 2 joint probability models such as meta gaussian models wu et al 2011 and bayesian joint probability bjp robertson et al 2013 shrestha et al 2015 wang et al 2009 3 kernel density methods such as ensemble dressing boucher et al 2015 and bayesian model averaging bma raftery et al 2005 sloughter et al 2007 there are also methods to construct spatio temporal or inter variable dependency of forecasts such as schaake shuffle clark et al 2004 and ensemble copula coupling ecc schefzik et al 2013 machine learning methods have been applied in the post processing of forecasts in recent years the advantages of machine learning methods include the use of more predictors such as atmosphere circulation predictors and topography descriptors haupt et al 2021 machine learning based methods also help to model the complex relationship between predictors and predictands to improve forecast skills for the post processing of deterministic forecasts various machine learning based methods have emerged including random forests and artificial neural networks herman and schumacher 2018 li et al 2019a for the post processing of ensemble forecasts the difficulty is how to predict the distribution of the predictand one class of methods predicts the quantiles of predictand by machine learning techniques like random forests taillardat et al 2019 another class of methods follows the emos or distributional regression scheme which uses machine learning methods to predict the parameters of the distribution of the predictand ghazvinian et al 2021 peng et al 2020 rasp and lerch 2018 other neural network based methods provide probabilistic predictions in the form of a mixture of density or the probability exceeding certain thresholds scheuerer et al 2020 veldkamp et al 2021 for more details of existing post processing models readers are referred to related books and reviews duan et al 2019 li et al 2017 vannitsem et al 2020 vannitsem et al 2018 although various post processing methods have been developed existing methods usually use predictors at the location to be predicted thus they cannot fully make use of spatial information to improve the forecast skill this issue can be solved by convolutional neural networks lecun et al 2015 which have been successfully used in applications such as downscaling to extract spatial information e g baño medina et al 2020 miao et al 2019 pan et al 2019 zhou et al 2019 however existing applications of cnn based methods are limited to deterministic forecasts e g han et al 2021 sha et al 2020 or variables such as temperature grönquist et al 2021 as far as we know the use of cnn models in statistical post processing of short term ensemble precipitation forecasts has not emerged due to the difficulties in modeling the intermittent feature and skewed distribution of precipitation amounts therefore we aim to develop a new post processing model for ensemble precipitation forecasts to make use of spatial information in this paper we apply a lenet type cnn model to predict the parameters of the probabilistic distribution of precipitation forecasts the proposed model combines the strength of cnns and the emos scheme to make good use of multi scale spatial information and quantify precipitation forecast uncertainty there are three main questions that we aim to answer in this research 1 how can we develop a post processing model to make use of multiple predictors and spatial information for precipitation forecasts 2 will the incorporation of more meteorological predictors in post processing models increase the skill of precipitation forecast 3 will the use of cnn based methods to extract spatial information improve forecast performance the remainder of the paper is structured as follows section 2 describes the research region and dataset section 3 describes post processing and verification methods section 4 exhibits the results section 5 exhibits the discussion and section 6 is the conclusion 2 research region and dataset as shown in fig 1 the research region is chosen as the huaihe river basin 30 55 36 36 n 111 55 121 25 e with a drainage area of 270 000 km2 which covers nearly five provinces with a dense population of 191 million people the huaihe river basin is one of china s important grain producing areas that contributes to about 1 6 of china s total grain output the region is under the influence of the east asian summer monsoon with annual precipitation of 700 1600 mm the precipitation mainly occurs during summer which leads to high flood risk for the region in the flooding season eight flood events including three catastrophic flood events in 2003 2007 and 2020 happened in the first 21 years of the 21st century which brings serious damages to people and properties in this region yu et al 2020 therefore it is important to develop advanced precipitation and hydrological forecasting techniques in this region the observations are the 0 25 0 25 gridded precipitation analysis during the rainy season over mainland china which is produced by optimal interpolation from the china meteorological administration cma shen and xiong 2016 we only use forecasts and corresponding observations during the summer may to august in this research the forecasts are the ens4ml 20 year hindcast dataset from european centre for medium range weather forecasts ecmwf 2020 as the source from ecmwf is no longer available we obtained the dataset through the online source of a related paper grönquist et al 2021 the original spatial resolution of the dataset is 0 5 0 5 which are bilinearly interpolated to 0 25 0 25 to be same as the observations the dataset includes forecasts at lead times of 24 h and 48 h the hindcasts were issued twice a week during 1998 2017 so there are 35 validation dates during summer may august in each year as there are many missing data in the cma observed dataset in 2017 we only use forecasts and observations during 1998 2016 predictors used in the models are shown in table 1 including single level predictors such as total precipitation and predictors at 850 500 200 hpa pressure levels to represent lower middle upper atmosphere conditions besides meteorological predictors we also use elevation data from 0 25 0 25 digital elevation model as predictors in neural network based models 3 method in this section we describe the post processing methods used in the research firstly we proposed a cnn based post processing method in subsection 3 1 to investigate the two research questions in the introduction we compare the proposed method with two benchmarks as shown in table 2 the first benchmark is a joint probability based post processing model that only uses raw precipitation forecasts at the location to be predicted i e without spatial information the other benchmark is a fully connected network fcn based model which also uses various meteorological variables as predictors but doesn t include spatial information the fcn based model is described at the end of subsection 3 1 the joint probability based model is described in subsection 3 2 the cross validation method is introduced in subsection 3 3 finally a permutation importance method is described in subsection 3 4 3 1 cnn and fcn based post processing methods we combine a lenet type cnn model with the emos scheme namely to predict the parameters of the distribution of precipitation by cnn as the distribution of precipitation amount is non negative and skewed we assume the predictand to follow censored shifted gamma csg distribution which has been successfully used in state of the art post processing methods baran and nemoda 2016 ghazvinian et al 2021 scheuerer and hamill 2015 the csg distribution of the predictand y is defined as follows 1 f y f k y δ θ y 0 0 y 0 where f k is gamma distribution with shape parameter k 0 θ is the scale parameter and δ 0 is the shift parameter the csg distribution is left censored at zero to ensure non negative precipitation amounts the probability of zero precipitation is set as the value of the cumulative distribution function of csg distribution at zero i e f k δ θ the parameters θ and k can be parameterized by mean μ and standard deviation σ of gamma distribution as follows 2 k μ 2 σ 2 θ σ 2 μ to make use of spatial information we use a lenet type cnn to model the relationship between the predictors and the three parameters δ μ a n d σ of the csg distribution of the predictand as shown in fig 2 the model mainly includes an input layer three convolutional layers embedding layers of latitude longitude a fully connection layer and an output layer which are described as follows the selection process of the hyperparameters of the neural network structure is shown in appendix b 1 inputs to the network are predictors of a square patch of 7 7 grids centered at the grid to be predicted as described in section 2 we use 30 meteorological variables and the elevation from the digital elevation model dem to construct input arrays with dimensions of 7 7 31 as in scheuerer and hamill 2015 we only use ensemble mean forecasts as predictors because ensemble mean generally contains most of the information in ensemble forecasts all the variables are normalized to 0 1 by min max normalization 2 there are three convolutional layers with 64 32 and 16 feature maps respectively the convolution operation is conducted by moving convolutional kernels here we use arrays with a size of 3 3 as the kernels to sweep across the input spatial fields and computing the dot product between the kernels and the inputs to extract spatial information the lth feature map of the nth layer x n l is computed from the previous layer x n 1 with k feature maps by convolution operation as follows 3 x n l e l u b n l k 1 k w n k l x n 1 k where matrices w n k l are the convolutional kernels to be multiplied with the kth feature map of the previous layer b n l is the bias for the lth feature map symbol indicates 2d convolution following ghazvinian et al 2021 we use exponential linear units elu are used as the nonlinear activation function as follows 4 f x x x 0 a e x 1 x 0 where a is the parameter to be estimated x is input to elu function each convolutional layer is followed by a batch normalization layer to normalize the data and accelerate optimization as the input layer size is small we use convolutional kernels with a kernel size of 3 3 grids we don t use padding because we aim to predict precipitation for the single grid in the center 3 to model the spatial heterogeneity we apply embedding layers to map the discrete latitude longitude index to real numbers guo and berkhahn 2016 rasp and lerch 2018 the outputs of the embedding layers and the flattened results of the convolutional layer are combined to a dense layer i e a fully connected layer of 18 neurons which is then connected to another dense layer of 6 neurons 4 the output layer of the network includes three neurons o 1 o 2 and o 3 which are linked to three parameters shift mean and standard deviation of the predicted csg distribution similar to the link functions used in scheuerer and hamill 2015 and ghazvinian et al 2021 we use link functions as follows 5 δ o 1 2 μ e x p o 2 σ e x p o 3 the structure of the fcn based post processing model is as follows different from cnn based models where the predictors at the neighborhood 7 7 grids are used the inputs to fcn are only the predictors from the grid point of interest firstly the latitude and longitude index of the location to be predicted are embedded into two nodes the embedding features and other 31 predictors are then combined and linked to a hidden layer of 16 nodes with elu as activation functions finally the hidden layer is connected to 3 output nodes which are then linked to three parameters of the csg distribution by eq 5 the selection process of the fcn structure is shown in appendix b the code of the proposed neural network based post processing model is available through https github com wentao bnu lenet csg precip the cnn or fcn based models are fitted by minimization of an analytical expression of the mean continuous ranked probability score crps computed from the predicted csg distribution and the true observations the analytical expression of crps is described in appendix a the cnn model is fitted by the adam optimization algorithm kingma and ba 2015 to avoid overfitting an early stopping technique is used to stop the fitting process if no significant improvements exist on the validation dataset finally ensembles forecasts can be generated by obtaining a certain number of quantiles of the predicted csg distribution here we set 100 as the ensemble size the generated ensembles are reordered by schaake shuffle to model the spatio temporal dependence for hydrological forecasting purposes clark et al 2004 details of schaake shuffle are omitted due to the limitation of space 3 2 joint probability post processing model a simplified version of bayesian joint probability bjp is used as a benchmark method which is referred to as the joint probability model jpm hereafter jpm uses maximum likelihood estimation mle instead of bayesian inference in bjp for parameter fitting because there is enough data to fit the parameters in short term forecasting jpm is a state of the art method for the post processing of short term precipitation forecasts it has been used successfully in the bureau of meteorology in australia to provide reliable ensemble precipitation forecasts products shrestha et al 2015 here we briefly introduce the jpm method firstly raw forecasts and observations are transformed to deal with the non gaussian distribution of precipitation amounts the power transform used in this research is shown as follows 6 x z p where z is the original variables x is the transformed variable that follows gaussian distribution parameter p and the parameters of the distribution of transformed variable are fitted by mle to model the feature of precipitation amount the precipitation less than a threshold set as 0 1 mm day here is treated as censored data during the estimation shrestha et al 2015 wang and robertson 2011 wang et al 2009 the transformation parameters for forecasts and observations are fitted separately then we assume the transformed forecasts x and transformed observations y follows a bivariate normal distribution namely 7 x y n μ x μ y σ x 2 ρ σ x σ y ρ σ x σ y σ y 2 where ρ is the correlation coefficients of transformed forecasts and observations which is estimated by mle μ x μ y σ x a n d σ y are the parameters of the distribution of transformed variables which are estimated during the previous step finally the conditional distribution of the predictand given future forecasts can be derived as follows 8 p y x n μ y ρ σ y σ x x μ x 1 ρ 2 σ y 2 random samples can be drawn from the conditional distribution and the samples can be transformed back to the original space to construct ensemble forecasts the sample size is also set as 100 the same as other post processing models used in the paper for more details of the joint probability model please refer to related references li et al 2019b li et al 2019c robertson et al 2013 shrestha et al 2015 wang et al 2009 3 3 cross validation method and verification metrics the 19 years of forecasts and corresponding observations during summer are randomly grouped into five groups four groups include 4 years the other group includes 3 years during 5 fold cross validation one group is used as the test dataset and the other four groups are used as the training dataset we further randomly select about 20 of the training dataset as the validation dataset to implement the early stopping technique for neural network models the joint probability model is fitted for each grid in the research region however for neural network based models we use data of all the 427 grids in the region to fit a single neural network model to ensure a sufficient sample size for example we have a training dataset of 35 d a y 15 y e a r 427 g r i d 224 175 days of hindcasts if the other 4 years are used as the test dataset where 427 is the number of grids in the research region and 35 is the number of issue days for the ecmwf hindcast during the summer the verification metrics used in the research include root mean square error rmse correlation coefficients continuous ranked probability skill score crpss α index a score for overall reliability brier skill score bss and reliability diagram the higher values of crpss or bss indicate better forecast skill the α index of ideally reliable forecasts is 1 those metrics except α index are computed using the python package meteva liu et al 2021 the descriptions of the metrics are listed in appendix c 3 4 permutation importance method to investigate the relative importance of each predictor we apply the permutation importance method breiman 2001 rasp and lerch 2018 first we evaluate the fitted model by the original test dataset to get a baseline metric noted as s c o r e b a s e here we use the correlation coefficients between ensemble mean forecasts and observations as the evaluation metric the results of other metrics are similar and are omitted then we shuffle the test data of the kth predictor i e an n 7 7 1 slice of the n 7 7 31 inputs along the predictor dimension across n test days while keeping the test data of the other predictors unchanged we make predictions using the modified test dataset and evaluate the results to get a metric noted as s c o r e k finally we define a metric i m p o r t a n c e k to measure the importance of kth predictor as follows 9 i m p o r t a n c e k s c o r e b a s e s c o r e k s c o r e b a s e the metric i m p o r t a n c e k measures the decrease of performance for the prediction without using kth predictor relative to the prediction using all predictors the larger value of the metric indicates the kth predictor is more important the process is looped for all the meteorological predictors and the elevation predictor to evaluate the importance of each predictor it should be noted that although the permutation importance method is convenient to implement it cannot deal with collinearities between features rasp and lerch 2018 4 results in this section we firstly present the verification results of different post processing methods in subsection 4 1 then the results of the importance of different predictors in the model are shown in subsection 4 2 4 1 evaluation of post processing methods 4 1 1 overall performance of deterministic forecasts figure 3 shows the bar plots for the verification results of the ensemble mean of raw forecasts and post processed results by jpm fcn and proposed cnn based post processing methods the height of each bar represents the mean of the verification results of all the grids in the research region and the error bars exhibit the 95 confidence intervals of the estimated mean of the metric by bootstrapping the verification results of rmse in fig 3a show that all three post processing methods decrease the rmse relative to raw forecasts which shows the effectiveness of all the three post processing methods the rmse results of cnn based methods are the smallest among the three post processing methods figure 3b shows the correlation coefficients between the ensemble mean forecasts and observations the correlation coefficients of the post processed results by jpm are generally the same as those of raw forecasts however the correlation coefficients of the results by fcn cnn based methods are higher than those of raw forecasts which shows the benefits of using fcn cnn based post processing models 4 1 2 probabilistic evaluation of ensemble forecasts figure 4 shows the overall probabilistic verification of post processed ensemble forecasts by three models the crpss of the cnn based method is the highest at both lead times which outperforms that of jpm by nearly 5 at the lead time of 1 day the results of the fcn based model outperform those of jpm by about 1 at both lead times which indicates the benefits of incorporation of more predictors moreover the cnn based model transcends the fcn based model at both lead times which exhibits the effectiveness of using spatial information as shown in fig 4b the α index of all three post processing methods are near to one which means all post processing methods can generate overall reliable forecasts figure 5 shows the brier skill score of the results of three post processing models at four thresholds namely 0 1 mm day 10 mm day 25 mm day and 50 mm day corresponding to light rain moderate rain heavy rain and rainstorms respectively similar to previous results the proposed cnn based post processing methods generally outperforms jpm especially for moderate and heavy rain events the improvements of the cnn based method over jpm reach 5 and 8 for heavy rain and rainstorms at the lead time of 1 day the results of the fcn based method are slightly worse than jpm for light rain but there are improvements over the results of jpm for other precipitation levels for example the improvements of the fcn based method over jpm can be as large as 4 for rainstorms at the lead time of 1 day which indicates the benefits of using more meteorological forecasts as predictors in post processing methods the improvements of cnn relative to the fcn based model at both lead times illustrate the benefits of using spatial information figure 6 shows the reliability diagram of three post processing methods at two lead times as shown in fig 6a the reliability curve of fcn cnn are slightly higher than the diagonal line which shows these results suffer from slight underestimation for light rain the reliability curves of the three methods are generally overlapped for moderate and heavy rain fig 6b and c however as shown in fig 6d the curve of cnn based methods is closer to diagonal lines than those of traditional methods for rainstorms which shows the advantage of using cnn based methods to achieve more reliable forecasts than traditional methods for rainstorm events moreover the frequency histograms of fcn cnn for bins of forecast probability larger than 0 7 are higher than those of jpm in fig 6c and d which indicates fcn cnn based methods can generate forecasts that are more confident than jpm 4 2 feature importance figure 7 shows the importance metrics of the 15 most important predictors for two lead times as shown in fig 7 total precipitation itself is the most important predictor with an importance score much higher than those of other predictors other relatively important predictors include specific humidity at 200 500 850 hpa q200 q500 q850 convective precipitation cp total column water tcw geopotential at 500 hpa z500 and mean sea level pressure msl 5 discussion traditional post processing methods mainly use local precipitation forecasts as the only predictor which cannot fully utilize spatial information in raw forecasts to overcome the limitations of traditional methods we propose a convolutional neural network based post processing scheme for precipitation forecasts in this research the results indicate that the proposed model is capable of using multiple atmospheric circulation predictors and spatial information to improve forecast skill we compared the proposed cnn based method with two benchmarks a joint probability model and an fcn based post processing model the findings of this research are as follows firstly the cnn based post processing model remarkably outperforms the joint probability model which only uses raw precipitation forecasts the permutation importance results also indicate that auxiliary predictors such as total column water and specific humidity contribute to the improvements of forecast skill the results indicate that the incorporation of more meteorological predictors to represent atmosphere circulation and moisture conditions can help to improve precipitation forecast skill for long lead times when the forecast skill of raw precipitation forecast is not sufficient moreover we compared the cnn based model with fcn based models that only use information from the grid of interest the results indicate that cnn based models perform better than the fcn based model which indicates the benefits of cnn based methods to extract spatial information the reason for the improvements is that raw precipitation forecasts from nwp models may suffer from location errors therefore adding nearby spatial predictors can improve forecast skills as mentioned in the introduction there are post processing methods that incorporate machine learning methods to provide probabilistic meteorological forecasts for predictand such as temperature e g peng et al 2020 rasp and lerch 2018 and precipitation ghazvinian et al 2021 our work extends the existing fcn based models to cnn based models for precipitation forecasts which enables the model to make use of multi scale spatial information and multiple auxiliary predictors the results in this research illustrate the benefits of cnns to extract spatial information which is consistent with other studies such as scheuerer et al 2020 moreover the proposed model applies the csg distribution to model the distribution of precipitation forecasts which successfully quantifies the uncertainty of precipitation forecast and achieves reliable forecasts the limitation of this research is that we only use nwp forecasts with a relatively coarse spatial resolution of 0 5 0 5 nwp forecasts with finer spatial resolution may further help to make use of exploiting multi scale spatial information and improve forecast skills besides we only use lenet type cnns in this research other types of cnn such as u net ronneberger et al 2015 might be able to better incorporate the information of larger spatial scales which is left to be investigated in the future 6 conclusions in this research we proposed a cnn based post processing method for short term precipitation forecasts the proposed model applied a lenet type cnn to predict the parameters of the distribution of precipitation which is modeled by csg distribution the proposed method is able to improve forecast skills by making use of spatial information and multiple auxiliary predictors including atmosphere circulation and elevation the main conclusions are as follows 1 the proposed cnn based post processing model outperforms traditional models that only use local precipitation forecasts the results show that the incorporation of spatial information in the post processing model considerably improves precipitation forecast skills 2 the use of auxiliary predictors that represent atmosphere circulation and moisture conditions such as forecasts of total column water specific humidity and wind contribute to the improvements in forecast skill the success of the proposed cnn based method indicates the benefits of deep learning methods in the post processing of weather forecasts the proposed method is meaningful to applications such as hydrological forecasting and water resource management more research on developing deep learning based post processing methods is recommended to further improve precipitation forecasts credit authorship contribution statement wentao li conceptualization methodology software validation visualization writing original draft baoxiang pan conceptualization methodology supervision writing review editing jiangjiang xia writing review editing qingyun duan conceptualization funding acquisition resources supervision writing review editing declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments we are grateful for the valuable comments from the editor and anonymous reviewers this work is funded by the national natural science foundation of china grant numbers 51979004 42105142 41830752 the fundamental research funds for the central universities grant number b210202014 2019b04614 and the china postdoctoral science foundation 2021m701045 appendix a the analytical expression of crps for csg distribution the analytical expression of crps for csg distribution is as follows ghazvinian et al 2021 scheuerer and hamill 2015 the subscript i of parameters k θ δ and corresponding observation y for the ith sample is omitted for simplicity c r p s f k θ δ y y δ 2 f k θ y δ 1 θ k π b 1 2 k 1 2 1 f 2 k θ 2 δ δ f k θ δ 2 a 1 θ k 1 2 f k θ δ f k 1 θ δ f k θ δ 2 2 f k 1 θ y δ where f k θ δ is censored shifted gamma distribution with shape parameter k scale parameter θ and shift parameter δ f k θ is gamma distribution with shape parameter k and scale parameter θ y is corresponding observation b is the beta function appendix b the results during the selection of cnn fcn structures we compare fcns with different numbers of hidden layers and nodes as shown in table b1 the first column indicates the number of nodes in each hidden layer for fcns for example the first row in table b1 indicates an fcn with one hidden layer with 8 nodes the third row indicates an fcn with two hidden layers which includes 32 and 16 nodes respectively other settings are the same as the fcn described in subsection 3 1 the crpss of the predictions by those fcns is shown in the second and third columns in table b1 the results show that the fcn with one hidden layer of 16 nodes performs the best as shown in table b2 we tune the size of the input layer and the number of feature maps in each convolutional layer for cnns for example the first row in table b2 indicates a cnn with an input layer size of 5 5 and two convolutional layers with 32 and 16 feature maps other settings are the same as the cnn described in subsection 3 1 the crpss of the predictions by those cnns is shown in the third and fourth columns in table b2 the results indicate that the cnn with an input layer size of 7 7 and three convolutional layers with 64 32 and 16 feature maps is most suitable for both lead times moreover we compared the crpss of cnns with without the embedding of latitude longitude as shown in table b3 the other settings of cnns are the same as the cnn described in subsection 3 1 the results indicate the embedding of latitude longitude can improve the prediction performance appendix c the verification metrics c 1 root mean square error root mean square error rmse of ensemble mean forecast f i and corresponding observation o i is defined as follows c 1 r m s e 1 n i 1 n f i o i 2 where n is the total number of forecast observation pairs c 2 correlation coefficients pearson correlation coefficients r is defined as follows c 2 r i 1 n f i f i o i o i i 1 n f i f i 2 i 1 n o i o i 2 c 3 brier score and brier skill score the brier score measures the mean square error of the forecast probabilities of the meteorological variables exceeding a threshold c 3 b s 1 n i 1 n f f i q f o i q 2 where f f i q is the probabilities of forecast exceeding the threshold q and f o i q is the corresponding binary observation depending on whether the observation o i exceeds the threshold as follows namely c 4 f o i q 1 o i q 0 o t h e r w i s e the brier skill score bss measures the relative improvement of the brier score of the main forecast system over that of a reference system e g the climatology as follows c 5 b s s 1 b s b s r e f the bss is positively oriented the bss for the perfect forecast is one while the bss is less than zero for forecasts with no skill relative to the reference c 4 continuous ranked probability score the continuous ranked probability score crps measures the integral square difference between the cumulative distribution functions cdf of a forecast and the corresponding cdf of observation as follows c 6 c r p s f f q f o q 2 d q then the mean crps of all samples can be computed from the average of the crps of all forecast and observation pairs the continuous rank probability skill score crpss can be computed as follows c 7 c r p s s 1 c r p s c r p s r e f where c r p s is the mean crps of the forecasts c r p s r e f is the mean crps for the reference the climatology is chosen as the reference in this study c 5 probability integral transform and α index the probability integral transform pit is the predictive cumulative distribution function cdf f t at the corresponding observation y t as follows c 8 p i t t f t y t the pit for reliable forecasts follows a uniform distribution when the observations are equal to or below the threshold of zero precipitation 0 1 mm day in this study a pseudo pit value is generated from a uniform distribution with the range of 0 f t y threshold where y threshold is the threshold of zero precipitation for observation robertson et al 2013 pit can be drawn in a pit diagram the results in pit diagrams can be further summarized by the α index as follows renard et al 2010 c 9 α 1 2 n t 1 n p i t t t n 1 where p i t t is the sorted p i t t values in increasing order n is the total number of forecast observation pairs the α index ranges from 0 worst reliability to 1 perfect reliability c 6 reliability diagram the reliability diagram reveals the reliability of probabilistic forecasts of the occurrence of binary events e g precipitation exceeding a particular threshold by plotting the observed relative frequencies against the forecast probability the reliability curves of forecasts with perfect reliability should be along the diagonal line more details of reliability diagrams can be found in related books wilks 2011 appendix d supplementary data supplementary data to this article can be found online at https doi org 10 1016 j jhydrol 2021 127301 appendix d supplementary data the following are the supplementary data to this article supplementary data 1 
3702,the real time calibration of swmm runoff parameters is of great significance for the accurate simulation and prediction of urban flooding many studies correct swmm based on the characteristic indicators of the flood the model parameters do not change during the flooding process making the model effective in simulating historical flooding but poor performance in the prediction process by analyzing the distribution characteristics of urban waterlogging points a real time model calibration method is proposed to adjust the model parameters from time to time during the flooding process to minimize the error between the water depth of the waterlogging point and the measured water depth a practical application in the central area of zhengzhou china the results show that the method can accurately fit the water depth process within 4 iterations and final nash efficiency coefficients nse are all above 0 8 the process oriented real time calibration of swmm runoff parameters can endow the model with dynamic correction capability and improve the simulation accuracy of the flooding process which has important fundamental significance for flood loss assessment and risk assessment keywords urban flooding storm water management model swmm real time correction process oriented dynamic simulation 1 introduction flooding affects more people than any other environmental hazard and a fraction of the global population is at risk as floods are growing jongman 2021 tellman et al 2021 urbanization has changed the natural path of water flow and exacerbated the impact of rainfall and flooding wang et al 2019 zhang et al 2018 due to a large number of people and industries in urban areas flooding is bound to cause serious hazards and losses o donnell and thorne 2020 accurate simulation of flooding processes based on hydrological models facilitates drainage planning flood forecasting and damage assessment and is an important measure for flood management hu et al 2020 mehta and yadav 2020 the swmm storm water management model developed by the us epa environmental protection agency is widely used in the simulation of urban rainfall runoff processes because of its simplicity of operation open access to source code and computational efficiency babaei et al 2018 hsu et al 2000 zhang et al 2021a as a distributed hydrological model swmm divides the underlying surface into several sub catchments and combines them through nodes and pipe networks each sub catchment is generalized into two parts pervious zone and impervious zone and flow routing is based on the equations of conservation of mass energy and momentum peng et al 2021 rabori and ghazavi 2018 uncertainty of the swmm model is the main reason for the simulation error aronica et al 2012 guo et al 2020 which mainly includes three aspects the first is the uncertainty of model generalization the high spatial heterogeneity of the city makes the model require high resolution underlying surface data which is difficult to get so the model needs to be generalized cantone and schmidt 2011 cao et al 2020 singh 1997 zahmatkesh et al 2015 the second is the uncertainty of the model structure artificial buildings impervious surfaces roads and pipe networks have changed the natural flow path the hydraulic exchange conditions have become very complicated and the uncertainty of the intermediate process of model calculation has increased palla et al 2018 peng et al 2019 zhang et al 2019 zhao et al 2021 finally there is the uncertainty of the simulation results the simulation of the overflow process of discretely distributed sub catchment nodes makes it more difficult to measure the reliability of the results sarkar et al 2021 su et al 2016 zhang et al 2021c the calibration of parameters can reduce model uncertainty and improve simulation accuracy which is an important means of model correction qi et al 2019 shin and choi 2018 ullah et al 2016 initially the manual trial and error method was the primary method to calibrate the hydrological model parameters which were highly subjective and time consuming zaghloul 1983 zakermoshfegh et al 2008 with the development of computer technology a series of automatic optimization algorithms such as genetic algorithm ga particle swarm optimization pso shuffled complex evolution university of arizona sce ua have been widely used in the calibration of swmm parameters barco et al 2008 kang and lee 2014 xue et al 2020 the automatic optimization algorithm improves the objectivity of parameter rate determination kumar et al 2019 due to the high spatial and temporal complexity of the urban hydrological process huge computational effort makes the algorithm converge slowly and easily fall into local optimum which limits the time efficiency of model calibration emadi et al 2021 perin et al 2020 xue et al 2020 at present researchers mostly correct swmm based on the characteristic indicators of flood results such as flood peak flood volume peak time and calibrated parameters do not change during the flooding process kumar et al 2019 xue et al 2020 we define such methods and ideas as result oriented parameter calibration because people have a higher demand for the temporal and spatial dynamics of flood simulation and forecasting for urban flooding it is required to obtain information about flooding areas that are discretely distributed in space and change dynamically over time brendel et al 2020 henonin et al 2013 rené et al 2018 the result oriented model calibration gradually cannot meet this demand in terms of time efficiency and simulation accuracy a process oriented method for real time calibration of urban flood model parameters is proposed which emphasizes the dynamic calibration of model parameters during the flooding process each time period of the simulation results can well fit the actual flood and the simulation has higher accuracy in real time the method was validated in the central area of zhengzhou china the results show that the method can improve the simulation accuracy of swmm and the time efficiency of parameters calibration it provides a new idea for urban flood dynamics simulation which is of great significance to the city s loss assessment and risk assessment in flood disasters 2 material and methods 2 1 process oriented parameters calibration method the process oriented swmm parameters calibration refers to adjusting the model parameters time by time during the rainfall and flooding process to have the best predictive performance at the current moment and in the following forecast period fig 1 shows the roadmap for the j th time of the i th node the method includes three parts parameters analysis error judgment and parameters adjustment each part will be introduced one by one in the following 2 1 1 error judgment compared with watersheds urban runoff has two unique characteristics 1 the guidance and blocking of runoff by roads and rivers divides the city into functional units and the hydrological correlation within the units is significantly higher than the correlation between the units 2 a drainage method that combines decentralized drainage and centralized drainage in areas close to the river channel rainwater runoff is directly discharged from the main pipe into the river channel in areas far away from the river network rainwater is first discharged into branch pipes then flows into the branch pipes and finally discharged into the river channel fig 2 shows two drainage methods according to the characteristics of urban runoff the sub catchments of the swmm are divided as follows first the study area is divided into independent functional units with the roads and rivers as the boundary and each unit has its runoff parameters then according to the drainage characteristics the functional units with the same drainage node are classified into the same sub catchment the parameters calibration of the process oriented urban flood model follows the principle of gradual calibration from upstream to downstream and primary sources of node water volume include upstream inflow and interval inflow the simulated water depth of the node does not match the actual value if the upstream simulation error is less than the error limit it can be determined that the upstream inflow calculation result is correct and the error comes from the runoff calculation of the current node sub catchment determine the relationship between node depth simulation error eij and error limit ε if eij ε indicating that the simulation result does not match the actual value the parameters of the node sub catchment area need to be calibrated otherwise directly enter the j 1 time error judgment and save the simulation result at the j th time by adjusting the runoff parameters of the node sub catchment water depth at the node can be adjusted then turned to the parameter calibration of the downstream node and calibrated step by step until the entire model reaches the optimum 2 1 2 parameters analysis as shown in table 1 aryal et al 2016 knighton et al 2014 wu et al 2021 zhu et al 2016 swmm has 14 runoff parameters among them 6 parameters on the left are deterministic parameters that can be obtained through field measurements or experiments and do not need to be calibrated the 8 uncertainty parameters on the right are generated from the generalization of the hydrological process and are parameters that need to be calibrated analyzing the principle of swmm model runoff calculation can qualitatively distinguish the influence of runoff parameters on the node water depth according to horton s principle in terms of runoff generation it is believed that when the rainfall intensity is greater than surface infiltration rate then runoff generation begins as shown in eq 1 1 r s i f c f 0 f c e k t where r s is the surface runoff rate m s i is the rainfall intensity m s f 0 is the initial soil infiltration rate m s corresponding to the parameter maxrate f c is the saturated soil infiltration rate m s corresponding to the parameter minrate k is the permeability attenuation coefficient corresponding to the parameter decay t is the time s slope confluence is approximated as multiple sets of one dimensional water currents generated on the slope calculated by the motion wave equation as shown in eq 2 2 q 1 49 w n r s q f d t h p 5 3 s 1 2 where f is the area of the sub catchment m2 q is the flow rate of the slope runoff m3 s h p is the depth of the depression in the sub catchment mm corresponding to the parameters destore imperv and destore perv w is the characteristic width of the sub catchment m s is the slope of the sub catchment corresponding to the parameter slope n is the manning coefficient corresponding to the parameters n perv and n imperv the runoff generated on the slope flows into the pipeline or river channel and the finite difference format of the dynamic wave formula is used to calculate the pipeline river channel confluence as shown in eq 3 3 q t δ t q t 2 a δ a v 2 a 2 a 1 l δ t g a h 2 h 1 l δ t 1 g n 2 δ t r 4 3 v where the subscripts 1 and 2 represent the upstream and downstream nodes and the upper horizontal line represents the average value of the δ t period l is the length of pipeline or river channel m q t and q t δ t are the section flow at the time t and t δ t m3 s n is the manning coefficient of the pipeline or river channel corresponding to the parameter conduit roughness a is the cross sectional area of the water m2 δ a is the change of a h is the water depth m g is the acceleration of gravity 9 8 m s2 r is the hydraulic radius m v is the flow velocity m s it can be seen from the above principle of swmm production convergence that the increase of some uncertain parameters will lead to an increase in the depth of the node and such parameters are defined as forwarding parameters conversely the increase of some parameters will cause the water depth to decrease and such parameters are called reverse parameters in this study the parameter calibration is discretized in time and space in terms of time floods are regarded as discrete processes in time periods and a process oriented parameter calibration method is applied separately at each moment in terms of space important nodes that are prone to flood parameters are calibrated node by the node from upstream to downstream and the simulation error of each node only comes from the parameters in its sub catchment through such processing the calculation dimension is reduced time efficiency is improved and real time correction of the model is realized after discretization the water depth of each node is only related to the rainfall and the parameters of its sub catchment under certain rainfall conditions by increasing or decreasing model parameters to measure the changes in the output the sensitivity of the parameters can be analyzed the larger the output changes the stronger the sensitivity of the parameters all runoff parameters in sub catchment form a set x each parameter such as n perv destore imperv etc are an element of x denoted as x 1 x 2 xn i th parameter xi is adjusted and other parameters are not changed all the corresponding rainfall water depth scatter points form a set yi in which xi takes the lower limit a a rainfall water depth scatter points set is recorded as yia when xi takes the upper limit b and the rainfall water depth scatter points set is recorded as yib according to the above swmm principle there are 2 situations in which runoff parameters affect water depth 1 the water depth increases with the increase of the parameter value such parameters are defined as forwarding parameters and yib is greater than yia 2 the water depth decreases with the increase of the parameter value such parameters are defined as reverse parameters and yib is smaller than yia the degree of difference between yib and yia can be used to characterize the sensitivity of parameters the greater the difference between the two higher sensitivities of xi fig 3 takes the forward parameters as an example and shows 3 methods for calculating parameter sensitivity a is the angle method fitting yia and yib with straight lines la and lb the angle θ between two straight lines indicates degree of difference in yia and yib the greater θ the greater the difference between two lines and tangent of θ is the parameter sensitivity sθ see eq 4 b is the area method using curves ca and cb to fit yia and yib the area a enclosed by the two curves represents the degree of difference between yia and yib the larger a greater difference between the two lines and the ratio of a to the abscissa is the parameter sensitivity sa see eq 5 c is the distance method the average distance of the corresponding scatter points of yib and yia in figure is the parameter sensitivity sd the larger the average distance the greater the difference between the two lines see eq 6 4 s θ tan θ k 1 k 2 1 k 1 k 2 5 s a a p e p s p s p e d a d u p e p s 6 s d m 1 m d m 2 d m 1 m where k 1 and k 2 are the slopes of la and lb p s and p e are the rainfall at the beginning and end of the flooding d m 1 and d m 2 are the corresponding elements of yia and yib 2 1 3 parameters adjustment the runoff parameters are adjusted according to eij and different parameters will cause different effects including three options option 1 all sensitive parameters are adjusted option 2 only the most sensitive forward and reverse parameters are adjusted option 3 multi parameter calibration is to adjust multiple forward and reverse parameters with higher sensitivity the number of parameters that need to be adjusted is between option 1 and option 2 according to the principle of gradient descent ruder 2016 zhang et al 2021b the adjustment rules of the parameter p of the i th node at time j are shown in eq 7 and 8 the ratio of eij to h ij is the gradient direction in which the parameter changes fastest and is used as weight the goal of parameter optimization is to minimize eij if the simulation value h ij is less than the actual value h ij increasing forward parameter s p and reducing reverse parameter s i are beneficial in reducing the error on the contrary if h ij is greater than h ij then s p should be reduced and s i should be increased the change of each parameter cannot exceed its value range 7 s p s p s p u h ij h ij s p h ij h ij h ij s p s p u s p h ij h ij h ij s p h ij h ij s p h ij h ij h ij s p s p u s p s p l h ij h ij s p h ij h ij h ij s p s p l s p h ij h ij h ij s p h ij h ij s p h ij h ij h ij s p s p l 8 s i s i s i u h ij h ij s i h ij h ij h ij s i s i u s i h ij h ij h ij s i h ij h ij s i h ij h ij h ij s i s i u s i s i l h ij h ij s i h ij h ij h ij s i s i l s i h ij h ij h ij s i h ij h ij s i h ij h ij h ij s i s i l where s p and s p are the forward parameters before and after the adjustment s i and s i are the reverse parameters before and after adjustment s p u is the upper limit of the forward parameter value s p l is the lower limit of the parameter value s i u and s i l are upper limit and lower limit of the reverse parameter value h ij is the measured depth of the node h ij is the simulated depth of the node s p is the increased value of s p s p is the decreased value of s p s i and s i are the increased and decreased values of s i input calibrated parameters at the j th time of the model for subsequent simulation and traverse entire flooding process until the simulation error of the whole process is within the error range ε which means that calibration of the i th node is completed the downstream i 1 node repeats the above operation until the simulation results of all nodes are reasonable 2 2 case study 2 2 1 study area the study area is the central area of zhengzhou china the white box in fig 4 it covers an area of 150 km2 15 km from east to west and 10 km from north to south with a total population of about 1 1 million and density is significantly higher than the surrounding area the area is in the north china plain with flat terrain and a continental monsoon climate in the northern temperate zone winter is low temperature and less rain summer is hot and rainy the average annual rainfall is 542 15 mm which is 322 1 mm from june to august about 60 the terrain is high in the southwest and low in the northeast with an average elevation of 92 5 m rainwater flows into the river from west to east and south to north in the pipelines the central area was built early and rainwater pipes have low standards and were seriously old under the influence of the above various factors the area encounters over 10 floods every year which seriously affects millions of people the real time simulation of the urban flood process in this area is of great significance to its flood prevention and emergency response it has reference and promotion value for other cities with dense populations and frequent floods the availability of data is another important reason for choosing the central area of zhengzhou as the research area there are 14 rainfall stations in the urban area of zhengzhou the red triangles in fig 1 which provide rainfall data at an interval of 10 min from 2014 to 2018 the researchers measured water depth data of five nodes with the most waterlogging occurrences under 3 different types of rainfall the basic model data such as dem roads rivers and pipelines data were obtained from the zhengzhou municipal management agency researchers thank the above mentioned government agencies for their data support for this study 2 2 2 method assessment nash sutcliffe efficiency coefficient nse is widely used to determine the degree of fit hydrological sequences and calculation of nse is given by eq 9 if the nse is close to 1 it means that the result has a high degree of fit and the method is feasible if it is close to 0 it means that the simulation value is close to the average level of the actual value but simulation process error is large if it is much less than 0 hence method is not feasible 9 nse 1 t 1 t d 0 t d m t 2 t 1 t d 0 t d 0 2 where d 0 t refers to the actual value of the water depth at time t d m t refers to the simulated value at time t and d 0 represents the average value of the actual value the closer the nse is to 1 better the fitting effect 3 results and discussion 3 1 sub catchments division as shown in fig 5 the study area contains 668 drainage nodes that are difficult to display therefore only the 5 nodes black dots that are most prone to water logging are marked here 455 461 473 540 and 637 the rainwater in the white area is discharged into rivers and lakes through main pipe and rainwater in the yellow area which is collected from branch pipes into the main pipes then discharged into the rivers in order to improve the regional drainage capacity many new pipelines red lines and pumping stations red dots were built in the study area after 2016 the pipelines and pumping stations before 2016 were old drainage pipes blue lines and old drainage pumping stations blue dots the study area is dominated by gravity drainage because of high flood control standards of the river external floods rarely occur in the study area and a more widespread impact on citizens is urban flooding caused by poor drainage of the pipe network 3 2 parameters sensitivity analysis in swmm precipitation is the input of the model parameters determine the calculation of results and both of them affect the output of the model assuming that rainfall is constant changing the runoff parameters within a certain range will produce different node water depths similarly assuming that the parameters are constant and inputting different rainfall then water depth will also change based on the above phenomena 50 measured precipitation processes with different rainfalls are used as input and take the lower limit middle value and upper limit for each parameter according to the swmm user manual gironas et al 2010 the water depth of 5 nodes is output and used to analyze the influence of parameter changes on the results the average precipitation water depth parameter relationships of the 5 nodes are shown in fig 6 the orange scatter points and its regression line shows that the parameter is at the lower limit correspondingly the gray regression line shows that the parameter is at the upper limit and the blue regression line shows that the parameter is in the middle the lines of the 3 colors are separated from each other showing that water depth is sensitive to parameter changes if the orange line is above the gray line an increase in parameter causes the water depth to decrease which is a reverse parameter the orange line is at the bottom so the parameter is positive if the three lines coincide the parameter is insensitive conduit roughness and decay are forward parameters n imperv n perv destore imperv and maxrate are reverse parameters minrate and destore perv are insensitive parameters that are not recommended to be adjusted so these are called non adjusting parameters all the scattered points in fig 6 can be fitted with straight lines r2 0 9 according to the angle method the parameter sensitivity results are shown in table 2 the greater the angle between two lines of orange and blue more water depth changes are caused by parameter changes which show that parameters are more sensitive 3 3 method verification conduit roughness and n perv are the most sensitive parameters among forwarding and reverse parameters decay and destore imperv are sub sensitive parameters since there are only 2 forward parameters that are sensitive to the depth of the node in swmm and a final number of parameters in option 3 is 4 therefore options 1 3 are shown in table 3 option 1 adjusts all forward and reverse parameters option 2 adjusts most sensitive parameters and option 3 adjusts most sensitive and sun sensitive parameters floods data are collected through web crawlers and field flood trace surveys the data is available in areas with high flood vulnerability under extreme rainfall conditions there are 3 rainfall flood processes 20140729 20150722 and 20180801 of the 5 nodes 455 461 473 540 and 637 that are complete which are used for method verification in rainfall events that caused urban floods these 3 rainfalls have typical characteristics rapid rise and fall rapid rise and slow fall slow rise and fall these are also 3 common types of rainfall that cause flooding in the study area ma et al 2020 table 4 and fig 7 show the characteristics of these 3 types of rainfall 20 140 729 is a rapid rise and fall rainfall causing flooding in a short time and duration is short 20 150 722 is a rapid rise and slow drop rainfall lasts for a long time and flooding occurs later but has a longer duration 20 180 801 is a slow rise and fall rainfall with a long duration with uniform distribution in time and flooding occurs latest but the duration is longest for the above 3 rainfall flood processes option1 3 are applied respectively the water depth simulation results of the 5 nodes 455 461 473 540 and 637 are prone to flooding are shown in figs 8 10 each column corresponds to an option a is option 1 b is option 2 and c is option 3 the error limit ε is set to the actual value h 5 cm to meet the requirements of urban flooding simulation for accuracy of the results and value can be selected according to accuracy requirements all three options can complete the calibration process of runoff parameters within 4 adjustments so that model simulation results are in line with the actual results as shown in fig 8 the rapid rise and fall rainfall caused deep waterlogging in a short time but water receded rapidly and water depth over 70 cm could also recede within 2 h for all 5 nodes the simulation error can be controlled within the error limit by adjusting the parameters only once in option 1 and 3 while parameters in option 2 are often adjusted multiple times it shows that the convergence of option 2 is slow and parameter calibration in most sensitive parameters is not representative the flooding caused by the rapid rise and slow fall rainfall is the same as the rapid rise and fall type during the flood rising stage that causes deep water within 30 min the difference is that the rapid rise and slow fall flooding retreats for a longer time as shown in fig 9 the number of parameter adjustments in option 1and 3 is significantly lower than in option 2 from the final fitting results option 3 is closer to the true value than option 1 in addition using the process oriented swmm calibration method the simulated value is larger or smaller than the actual value and a good fit can be achieved in a few iterations according to fig 10 it can be seen that the 20 180 801 slow rises and fall rainfall flooding takes close to 1 h from the occurrence to the peak value it is significantly longer than the other two types and the duration of the flooding is also the longest an exception is node 455 option 1 adjusts the parameters one more time than option 3 that adjusting all parameters may lead to over adjustment the simulation result at node 473 is consistent with the actual value and runoff parameters of its sub catchment do not need to be adjusted the nash sutcliffe efficiency coefficients nse of the simulation results of the 3 types of rainfall under different scenarios are shown in fig 11 the final nse of the 3 options is above 0 8 overall option 3 has the least number of parameter adjustments and the highest degree of fit with actual values the dynamic correction model does not need to calibrate all runoff parameters during the rainfall flooding process however only calibrating the most sensitive parameters often requires multiple adjustments of parameters and the fitting effect is poor the time efficiency of the process oriented parameter calibration method depends on the relationship between the time step ts of model simulation and time cost tc of parameter calibration when tc ts parameter calibration of the current period will be completed before the simulation result of the next period appears and that method is real time the calculation of tc is shown in eq 10 10 t c p 1 f t a t b q p where f is the number of nodes that need to be calibrated qp is the number of parameter adjustments of the p th node at a certain moment ta is the calculation time of the model tb is algorithm convergence time the statistical results of the time efficiency of the 3 options in the 3 flood processes are shown in table 5 the values in parentheses show the moments when the parameter is calibrated with tc on the left at 20 min after the beginning of rainfall the parameter calibration time of flood 20 140 729 in option 2 is the longest 88 s the model simulation time step ts is 10 min and tc ts therefore the proposed method has real time characteristics the simulation results are updated every time and parameters are adjusted therefore this method realizes the real time correction of swmm and dynamic simulation of urban floods 4 conclusions a process oriented real time correction of the swmm model is proposed to solve the problem of urban flood dynamic simulation which emphasizes dynamic calibration of swmm parameters during the flooding process each time period of simulation results can well fit the actual flooding process relevant researches mostly correct models based on the characteristic indicators of flood results such as flood peak flood volume and peak time but we defined such methods and ideas as result oriented parameter calibration compared with result oriented parameter the calibration process oriented has 3 advantages first it has a higher fitting to actual floods and can achieve an accurate simulation of each time period of the flooding process second the computational complexity of parameter calibration is lower during the flooding process the parameter calibration is performed discretely many times and dimensionality of the parameter optimization space is reduced which can avoid the problem of algorithm divergence third it is more in line with the actual hydrological process as indicators of hydrological calculations model parameters should be dynamically changing real time adjustment of parameters in a process oriented manner can better reflect this feature according to the process oriented error correction idea it is judged whether the simulation result is accurate at regular intervals during the flooding process when the simulation error exceeds a certain range the model correction will be initiated the goal is that simulation error is less than the error limit therefore the reasonable definition of time step and error limit is very important because different regions and departments have different requirements for model accuracy study does not provide an objective method to determine these two indicators practitioners can define them according to their own needs we will conduct explorations of how these two indicators affect the efficiency of model correction in the future the application in the central area of zhengzhou china shows that the process oriented swmm parameter correction method is workable three different flood simulations answer two questions about the calibration of model parameters the first is whether it is necessary to calibrate all runoff parameters and the second is whether it is reasonable to adjust only the most sensitive parameters the results show that calibrating only the most sensitive parameters to the results requires more iterations and the algorithm for adjusting all parameters is computationally expensive may lead to over fitting there is a compromise solution is that calibrating the most sensitive and sub sensitive parameters which can save calculation time and improve fitting accuracy this method is not limited by the principle and structure differences between different models also it can theoretically apply to any urban hydrological model that can be calibrated through parameter calibration the application of this method to other hydrological models will be studied in the future declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper credit authorship contribution statement bingyan ma methodology software validation formal analysis writing original draft writing review editing zening wu conceptualization validation supervision funding acquisition caihong hu data curation conceptualization supervision huiliang wang software data curation hongshi xu investigation validation denghua yan conceptualization methodology shan e hyder soomro writing review editing declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgements the authors would like to thank the anonymous reviewers for their valuable comments this work was funded by key program of national natural science foundation of china grant number 51739009 national natural science foundation of china grant number 51979250 science and technology innovation talents project of henan education department of china grant number 21hastit011 young backbone teachers training fund of henan education department of china grant number 2020ggjs005 excellent youth fund of henan province of china grant number 212300410088 
3702,the real time calibration of swmm runoff parameters is of great significance for the accurate simulation and prediction of urban flooding many studies correct swmm based on the characteristic indicators of the flood the model parameters do not change during the flooding process making the model effective in simulating historical flooding but poor performance in the prediction process by analyzing the distribution characteristics of urban waterlogging points a real time model calibration method is proposed to adjust the model parameters from time to time during the flooding process to minimize the error between the water depth of the waterlogging point and the measured water depth a practical application in the central area of zhengzhou china the results show that the method can accurately fit the water depth process within 4 iterations and final nash efficiency coefficients nse are all above 0 8 the process oriented real time calibration of swmm runoff parameters can endow the model with dynamic correction capability and improve the simulation accuracy of the flooding process which has important fundamental significance for flood loss assessment and risk assessment keywords urban flooding storm water management model swmm real time correction process oriented dynamic simulation 1 introduction flooding affects more people than any other environmental hazard and a fraction of the global population is at risk as floods are growing jongman 2021 tellman et al 2021 urbanization has changed the natural path of water flow and exacerbated the impact of rainfall and flooding wang et al 2019 zhang et al 2018 due to a large number of people and industries in urban areas flooding is bound to cause serious hazards and losses o donnell and thorne 2020 accurate simulation of flooding processes based on hydrological models facilitates drainage planning flood forecasting and damage assessment and is an important measure for flood management hu et al 2020 mehta and yadav 2020 the swmm storm water management model developed by the us epa environmental protection agency is widely used in the simulation of urban rainfall runoff processes because of its simplicity of operation open access to source code and computational efficiency babaei et al 2018 hsu et al 2000 zhang et al 2021a as a distributed hydrological model swmm divides the underlying surface into several sub catchments and combines them through nodes and pipe networks each sub catchment is generalized into two parts pervious zone and impervious zone and flow routing is based on the equations of conservation of mass energy and momentum peng et al 2021 rabori and ghazavi 2018 uncertainty of the swmm model is the main reason for the simulation error aronica et al 2012 guo et al 2020 which mainly includes three aspects the first is the uncertainty of model generalization the high spatial heterogeneity of the city makes the model require high resolution underlying surface data which is difficult to get so the model needs to be generalized cantone and schmidt 2011 cao et al 2020 singh 1997 zahmatkesh et al 2015 the second is the uncertainty of the model structure artificial buildings impervious surfaces roads and pipe networks have changed the natural flow path the hydraulic exchange conditions have become very complicated and the uncertainty of the intermediate process of model calculation has increased palla et al 2018 peng et al 2019 zhang et al 2019 zhao et al 2021 finally there is the uncertainty of the simulation results the simulation of the overflow process of discretely distributed sub catchment nodes makes it more difficult to measure the reliability of the results sarkar et al 2021 su et al 2016 zhang et al 2021c the calibration of parameters can reduce model uncertainty and improve simulation accuracy which is an important means of model correction qi et al 2019 shin and choi 2018 ullah et al 2016 initially the manual trial and error method was the primary method to calibrate the hydrological model parameters which were highly subjective and time consuming zaghloul 1983 zakermoshfegh et al 2008 with the development of computer technology a series of automatic optimization algorithms such as genetic algorithm ga particle swarm optimization pso shuffled complex evolution university of arizona sce ua have been widely used in the calibration of swmm parameters barco et al 2008 kang and lee 2014 xue et al 2020 the automatic optimization algorithm improves the objectivity of parameter rate determination kumar et al 2019 due to the high spatial and temporal complexity of the urban hydrological process huge computational effort makes the algorithm converge slowly and easily fall into local optimum which limits the time efficiency of model calibration emadi et al 2021 perin et al 2020 xue et al 2020 at present researchers mostly correct swmm based on the characteristic indicators of flood results such as flood peak flood volume peak time and calibrated parameters do not change during the flooding process kumar et al 2019 xue et al 2020 we define such methods and ideas as result oriented parameter calibration because people have a higher demand for the temporal and spatial dynamics of flood simulation and forecasting for urban flooding it is required to obtain information about flooding areas that are discretely distributed in space and change dynamically over time brendel et al 2020 henonin et al 2013 rené et al 2018 the result oriented model calibration gradually cannot meet this demand in terms of time efficiency and simulation accuracy a process oriented method for real time calibration of urban flood model parameters is proposed which emphasizes the dynamic calibration of model parameters during the flooding process each time period of the simulation results can well fit the actual flood and the simulation has higher accuracy in real time the method was validated in the central area of zhengzhou china the results show that the method can improve the simulation accuracy of swmm and the time efficiency of parameters calibration it provides a new idea for urban flood dynamics simulation which is of great significance to the city s loss assessment and risk assessment in flood disasters 2 material and methods 2 1 process oriented parameters calibration method the process oriented swmm parameters calibration refers to adjusting the model parameters time by time during the rainfall and flooding process to have the best predictive performance at the current moment and in the following forecast period fig 1 shows the roadmap for the j th time of the i th node the method includes three parts parameters analysis error judgment and parameters adjustment each part will be introduced one by one in the following 2 1 1 error judgment compared with watersheds urban runoff has two unique characteristics 1 the guidance and blocking of runoff by roads and rivers divides the city into functional units and the hydrological correlation within the units is significantly higher than the correlation between the units 2 a drainage method that combines decentralized drainage and centralized drainage in areas close to the river channel rainwater runoff is directly discharged from the main pipe into the river channel in areas far away from the river network rainwater is first discharged into branch pipes then flows into the branch pipes and finally discharged into the river channel fig 2 shows two drainage methods according to the characteristics of urban runoff the sub catchments of the swmm are divided as follows first the study area is divided into independent functional units with the roads and rivers as the boundary and each unit has its runoff parameters then according to the drainage characteristics the functional units with the same drainage node are classified into the same sub catchment the parameters calibration of the process oriented urban flood model follows the principle of gradual calibration from upstream to downstream and primary sources of node water volume include upstream inflow and interval inflow the simulated water depth of the node does not match the actual value if the upstream simulation error is less than the error limit it can be determined that the upstream inflow calculation result is correct and the error comes from the runoff calculation of the current node sub catchment determine the relationship between node depth simulation error eij and error limit ε if eij ε indicating that the simulation result does not match the actual value the parameters of the node sub catchment area need to be calibrated otherwise directly enter the j 1 time error judgment and save the simulation result at the j th time by adjusting the runoff parameters of the node sub catchment water depth at the node can be adjusted then turned to the parameter calibration of the downstream node and calibrated step by step until the entire model reaches the optimum 2 1 2 parameters analysis as shown in table 1 aryal et al 2016 knighton et al 2014 wu et al 2021 zhu et al 2016 swmm has 14 runoff parameters among them 6 parameters on the left are deterministic parameters that can be obtained through field measurements or experiments and do not need to be calibrated the 8 uncertainty parameters on the right are generated from the generalization of the hydrological process and are parameters that need to be calibrated analyzing the principle of swmm model runoff calculation can qualitatively distinguish the influence of runoff parameters on the node water depth according to horton s principle in terms of runoff generation it is believed that when the rainfall intensity is greater than surface infiltration rate then runoff generation begins as shown in eq 1 1 r s i f c f 0 f c e k t where r s is the surface runoff rate m s i is the rainfall intensity m s f 0 is the initial soil infiltration rate m s corresponding to the parameter maxrate f c is the saturated soil infiltration rate m s corresponding to the parameter minrate k is the permeability attenuation coefficient corresponding to the parameter decay t is the time s slope confluence is approximated as multiple sets of one dimensional water currents generated on the slope calculated by the motion wave equation as shown in eq 2 2 q 1 49 w n r s q f d t h p 5 3 s 1 2 where f is the area of the sub catchment m2 q is the flow rate of the slope runoff m3 s h p is the depth of the depression in the sub catchment mm corresponding to the parameters destore imperv and destore perv w is the characteristic width of the sub catchment m s is the slope of the sub catchment corresponding to the parameter slope n is the manning coefficient corresponding to the parameters n perv and n imperv the runoff generated on the slope flows into the pipeline or river channel and the finite difference format of the dynamic wave formula is used to calculate the pipeline river channel confluence as shown in eq 3 3 q t δ t q t 2 a δ a v 2 a 2 a 1 l δ t g a h 2 h 1 l δ t 1 g n 2 δ t r 4 3 v where the subscripts 1 and 2 represent the upstream and downstream nodes and the upper horizontal line represents the average value of the δ t period l is the length of pipeline or river channel m q t and q t δ t are the section flow at the time t and t δ t m3 s n is the manning coefficient of the pipeline or river channel corresponding to the parameter conduit roughness a is the cross sectional area of the water m2 δ a is the change of a h is the water depth m g is the acceleration of gravity 9 8 m s2 r is the hydraulic radius m v is the flow velocity m s it can be seen from the above principle of swmm production convergence that the increase of some uncertain parameters will lead to an increase in the depth of the node and such parameters are defined as forwarding parameters conversely the increase of some parameters will cause the water depth to decrease and such parameters are called reverse parameters in this study the parameter calibration is discretized in time and space in terms of time floods are regarded as discrete processes in time periods and a process oriented parameter calibration method is applied separately at each moment in terms of space important nodes that are prone to flood parameters are calibrated node by the node from upstream to downstream and the simulation error of each node only comes from the parameters in its sub catchment through such processing the calculation dimension is reduced time efficiency is improved and real time correction of the model is realized after discretization the water depth of each node is only related to the rainfall and the parameters of its sub catchment under certain rainfall conditions by increasing or decreasing model parameters to measure the changes in the output the sensitivity of the parameters can be analyzed the larger the output changes the stronger the sensitivity of the parameters all runoff parameters in sub catchment form a set x each parameter such as n perv destore imperv etc are an element of x denoted as x 1 x 2 xn i th parameter xi is adjusted and other parameters are not changed all the corresponding rainfall water depth scatter points form a set yi in which xi takes the lower limit a a rainfall water depth scatter points set is recorded as yia when xi takes the upper limit b and the rainfall water depth scatter points set is recorded as yib according to the above swmm principle there are 2 situations in which runoff parameters affect water depth 1 the water depth increases with the increase of the parameter value such parameters are defined as forwarding parameters and yib is greater than yia 2 the water depth decreases with the increase of the parameter value such parameters are defined as reverse parameters and yib is smaller than yia the degree of difference between yib and yia can be used to characterize the sensitivity of parameters the greater the difference between the two higher sensitivities of xi fig 3 takes the forward parameters as an example and shows 3 methods for calculating parameter sensitivity a is the angle method fitting yia and yib with straight lines la and lb the angle θ between two straight lines indicates degree of difference in yia and yib the greater θ the greater the difference between two lines and tangent of θ is the parameter sensitivity sθ see eq 4 b is the area method using curves ca and cb to fit yia and yib the area a enclosed by the two curves represents the degree of difference between yia and yib the larger a greater difference between the two lines and the ratio of a to the abscissa is the parameter sensitivity sa see eq 5 c is the distance method the average distance of the corresponding scatter points of yib and yia in figure is the parameter sensitivity sd the larger the average distance the greater the difference between the two lines see eq 6 4 s θ tan θ k 1 k 2 1 k 1 k 2 5 s a a p e p s p s p e d a d u p e p s 6 s d m 1 m d m 2 d m 1 m where k 1 and k 2 are the slopes of la and lb p s and p e are the rainfall at the beginning and end of the flooding d m 1 and d m 2 are the corresponding elements of yia and yib 2 1 3 parameters adjustment the runoff parameters are adjusted according to eij and different parameters will cause different effects including three options option 1 all sensitive parameters are adjusted option 2 only the most sensitive forward and reverse parameters are adjusted option 3 multi parameter calibration is to adjust multiple forward and reverse parameters with higher sensitivity the number of parameters that need to be adjusted is between option 1 and option 2 according to the principle of gradient descent ruder 2016 zhang et al 2021b the adjustment rules of the parameter p of the i th node at time j are shown in eq 7 and 8 the ratio of eij to h ij is the gradient direction in which the parameter changes fastest and is used as weight the goal of parameter optimization is to minimize eij if the simulation value h ij is less than the actual value h ij increasing forward parameter s p and reducing reverse parameter s i are beneficial in reducing the error on the contrary if h ij is greater than h ij then s p should be reduced and s i should be increased the change of each parameter cannot exceed its value range 7 s p s p s p u h ij h ij s p h ij h ij h ij s p s p u s p h ij h ij h ij s p h ij h ij s p h ij h ij h ij s p s p u s p s p l h ij h ij s p h ij h ij h ij s p s p l s p h ij h ij h ij s p h ij h ij s p h ij h ij h ij s p s p l 8 s i s i s i u h ij h ij s i h ij h ij h ij s i s i u s i h ij h ij h ij s i h ij h ij s i h ij h ij h ij s i s i u s i s i l h ij h ij s i h ij h ij h ij s i s i l s i h ij h ij h ij s i h ij h ij s i h ij h ij h ij s i s i l where s p and s p are the forward parameters before and after the adjustment s i and s i are the reverse parameters before and after adjustment s p u is the upper limit of the forward parameter value s p l is the lower limit of the parameter value s i u and s i l are upper limit and lower limit of the reverse parameter value h ij is the measured depth of the node h ij is the simulated depth of the node s p is the increased value of s p s p is the decreased value of s p s i and s i are the increased and decreased values of s i input calibrated parameters at the j th time of the model for subsequent simulation and traverse entire flooding process until the simulation error of the whole process is within the error range ε which means that calibration of the i th node is completed the downstream i 1 node repeats the above operation until the simulation results of all nodes are reasonable 2 2 case study 2 2 1 study area the study area is the central area of zhengzhou china the white box in fig 4 it covers an area of 150 km2 15 km from east to west and 10 km from north to south with a total population of about 1 1 million and density is significantly higher than the surrounding area the area is in the north china plain with flat terrain and a continental monsoon climate in the northern temperate zone winter is low temperature and less rain summer is hot and rainy the average annual rainfall is 542 15 mm which is 322 1 mm from june to august about 60 the terrain is high in the southwest and low in the northeast with an average elevation of 92 5 m rainwater flows into the river from west to east and south to north in the pipelines the central area was built early and rainwater pipes have low standards and were seriously old under the influence of the above various factors the area encounters over 10 floods every year which seriously affects millions of people the real time simulation of the urban flood process in this area is of great significance to its flood prevention and emergency response it has reference and promotion value for other cities with dense populations and frequent floods the availability of data is another important reason for choosing the central area of zhengzhou as the research area there are 14 rainfall stations in the urban area of zhengzhou the red triangles in fig 1 which provide rainfall data at an interval of 10 min from 2014 to 2018 the researchers measured water depth data of five nodes with the most waterlogging occurrences under 3 different types of rainfall the basic model data such as dem roads rivers and pipelines data were obtained from the zhengzhou municipal management agency researchers thank the above mentioned government agencies for their data support for this study 2 2 2 method assessment nash sutcliffe efficiency coefficient nse is widely used to determine the degree of fit hydrological sequences and calculation of nse is given by eq 9 if the nse is close to 1 it means that the result has a high degree of fit and the method is feasible if it is close to 0 it means that the simulation value is close to the average level of the actual value but simulation process error is large if it is much less than 0 hence method is not feasible 9 nse 1 t 1 t d 0 t d m t 2 t 1 t d 0 t d 0 2 where d 0 t refers to the actual value of the water depth at time t d m t refers to the simulated value at time t and d 0 represents the average value of the actual value the closer the nse is to 1 better the fitting effect 3 results and discussion 3 1 sub catchments division as shown in fig 5 the study area contains 668 drainage nodes that are difficult to display therefore only the 5 nodes black dots that are most prone to water logging are marked here 455 461 473 540 and 637 the rainwater in the white area is discharged into rivers and lakes through main pipe and rainwater in the yellow area which is collected from branch pipes into the main pipes then discharged into the rivers in order to improve the regional drainage capacity many new pipelines red lines and pumping stations red dots were built in the study area after 2016 the pipelines and pumping stations before 2016 were old drainage pipes blue lines and old drainage pumping stations blue dots the study area is dominated by gravity drainage because of high flood control standards of the river external floods rarely occur in the study area and a more widespread impact on citizens is urban flooding caused by poor drainage of the pipe network 3 2 parameters sensitivity analysis in swmm precipitation is the input of the model parameters determine the calculation of results and both of them affect the output of the model assuming that rainfall is constant changing the runoff parameters within a certain range will produce different node water depths similarly assuming that the parameters are constant and inputting different rainfall then water depth will also change based on the above phenomena 50 measured precipitation processes with different rainfalls are used as input and take the lower limit middle value and upper limit for each parameter according to the swmm user manual gironas et al 2010 the water depth of 5 nodes is output and used to analyze the influence of parameter changes on the results the average precipitation water depth parameter relationships of the 5 nodes are shown in fig 6 the orange scatter points and its regression line shows that the parameter is at the lower limit correspondingly the gray regression line shows that the parameter is at the upper limit and the blue regression line shows that the parameter is in the middle the lines of the 3 colors are separated from each other showing that water depth is sensitive to parameter changes if the orange line is above the gray line an increase in parameter causes the water depth to decrease which is a reverse parameter the orange line is at the bottom so the parameter is positive if the three lines coincide the parameter is insensitive conduit roughness and decay are forward parameters n imperv n perv destore imperv and maxrate are reverse parameters minrate and destore perv are insensitive parameters that are not recommended to be adjusted so these are called non adjusting parameters all the scattered points in fig 6 can be fitted with straight lines r2 0 9 according to the angle method the parameter sensitivity results are shown in table 2 the greater the angle between two lines of orange and blue more water depth changes are caused by parameter changes which show that parameters are more sensitive 3 3 method verification conduit roughness and n perv are the most sensitive parameters among forwarding and reverse parameters decay and destore imperv are sub sensitive parameters since there are only 2 forward parameters that are sensitive to the depth of the node in swmm and a final number of parameters in option 3 is 4 therefore options 1 3 are shown in table 3 option 1 adjusts all forward and reverse parameters option 2 adjusts most sensitive parameters and option 3 adjusts most sensitive and sun sensitive parameters floods data are collected through web crawlers and field flood trace surveys the data is available in areas with high flood vulnerability under extreme rainfall conditions there are 3 rainfall flood processes 20140729 20150722 and 20180801 of the 5 nodes 455 461 473 540 and 637 that are complete which are used for method verification in rainfall events that caused urban floods these 3 rainfalls have typical characteristics rapid rise and fall rapid rise and slow fall slow rise and fall these are also 3 common types of rainfall that cause flooding in the study area ma et al 2020 table 4 and fig 7 show the characteristics of these 3 types of rainfall 20 140 729 is a rapid rise and fall rainfall causing flooding in a short time and duration is short 20 150 722 is a rapid rise and slow drop rainfall lasts for a long time and flooding occurs later but has a longer duration 20 180 801 is a slow rise and fall rainfall with a long duration with uniform distribution in time and flooding occurs latest but the duration is longest for the above 3 rainfall flood processes option1 3 are applied respectively the water depth simulation results of the 5 nodes 455 461 473 540 and 637 are prone to flooding are shown in figs 8 10 each column corresponds to an option a is option 1 b is option 2 and c is option 3 the error limit ε is set to the actual value h 5 cm to meet the requirements of urban flooding simulation for accuracy of the results and value can be selected according to accuracy requirements all three options can complete the calibration process of runoff parameters within 4 adjustments so that model simulation results are in line with the actual results as shown in fig 8 the rapid rise and fall rainfall caused deep waterlogging in a short time but water receded rapidly and water depth over 70 cm could also recede within 2 h for all 5 nodes the simulation error can be controlled within the error limit by adjusting the parameters only once in option 1 and 3 while parameters in option 2 are often adjusted multiple times it shows that the convergence of option 2 is slow and parameter calibration in most sensitive parameters is not representative the flooding caused by the rapid rise and slow fall rainfall is the same as the rapid rise and fall type during the flood rising stage that causes deep water within 30 min the difference is that the rapid rise and slow fall flooding retreats for a longer time as shown in fig 9 the number of parameter adjustments in option 1and 3 is significantly lower than in option 2 from the final fitting results option 3 is closer to the true value than option 1 in addition using the process oriented swmm calibration method the simulated value is larger or smaller than the actual value and a good fit can be achieved in a few iterations according to fig 10 it can be seen that the 20 180 801 slow rises and fall rainfall flooding takes close to 1 h from the occurrence to the peak value it is significantly longer than the other two types and the duration of the flooding is also the longest an exception is node 455 option 1 adjusts the parameters one more time than option 3 that adjusting all parameters may lead to over adjustment the simulation result at node 473 is consistent with the actual value and runoff parameters of its sub catchment do not need to be adjusted the nash sutcliffe efficiency coefficients nse of the simulation results of the 3 types of rainfall under different scenarios are shown in fig 11 the final nse of the 3 options is above 0 8 overall option 3 has the least number of parameter adjustments and the highest degree of fit with actual values the dynamic correction model does not need to calibrate all runoff parameters during the rainfall flooding process however only calibrating the most sensitive parameters often requires multiple adjustments of parameters and the fitting effect is poor the time efficiency of the process oriented parameter calibration method depends on the relationship between the time step ts of model simulation and time cost tc of parameter calibration when tc ts parameter calibration of the current period will be completed before the simulation result of the next period appears and that method is real time the calculation of tc is shown in eq 10 10 t c p 1 f t a t b q p where f is the number of nodes that need to be calibrated qp is the number of parameter adjustments of the p th node at a certain moment ta is the calculation time of the model tb is algorithm convergence time the statistical results of the time efficiency of the 3 options in the 3 flood processes are shown in table 5 the values in parentheses show the moments when the parameter is calibrated with tc on the left at 20 min after the beginning of rainfall the parameter calibration time of flood 20 140 729 in option 2 is the longest 88 s the model simulation time step ts is 10 min and tc ts therefore the proposed method has real time characteristics the simulation results are updated every time and parameters are adjusted therefore this method realizes the real time correction of swmm and dynamic simulation of urban floods 4 conclusions a process oriented real time correction of the swmm model is proposed to solve the problem of urban flood dynamic simulation which emphasizes dynamic calibration of swmm parameters during the flooding process each time period of simulation results can well fit the actual flooding process relevant researches mostly correct models based on the characteristic indicators of flood results such as flood peak flood volume and peak time but we defined such methods and ideas as result oriented parameter calibration compared with result oriented parameter the calibration process oriented has 3 advantages first it has a higher fitting to actual floods and can achieve an accurate simulation of each time period of the flooding process second the computational complexity of parameter calibration is lower during the flooding process the parameter calibration is performed discretely many times and dimensionality of the parameter optimization space is reduced which can avoid the problem of algorithm divergence third it is more in line with the actual hydrological process as indicators of hydrological calculations model parameters should be dynamically changing real time adjustment of parameters in a process oriented manner can better reflect this feature according to the process oriented error correction idea it is judged whether the simulation result is accurate at regular intervals during the flooding process when the simulation error exceeds a certain range the model correction will be initiated the goal is that simulation error is less than the error limit therefore the reasonable definition of time step and error limit is very important because different regions and departments have different requirements for model accuracy study does not provide an objective method to determine these two indicators practitioners can define them according to their own needs we will conduct explorations of how these two indicators affect the efficiency of model correction in the future the application in the central area of zhengzhou china shows that the process oriented swmm parameter correction method is workable three different flood simulations answer two questions about the calibration of model parameters the first is whether it is necessary to calibrate all runoff parameters and the second is whether it is reasonable to adjust only the most sensitive parameters the results show that calibrating only the most sensitive parameters to the results requires more iterations and the algorithm for adjusting all parameters is computationally expensive may lead to over fitting there is a compromise solution is that calibrating the most sensitive and sub sensitive parameters which can save calculation time and improve fitting accuracy this method is not limited by the principle and structure differences between different models also it can theoretically apply to any urban hydrological model that can be calibrated through parameter calibration the application of this method to other hydrological models will be studied in the future declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper credit authorship contribution statement bingyan ma methodology software validation formal analysis writing original draft writing review editing zening wu conceptualization validation supervision funding acquisition caihong hu data curation conceptualization supervision huiliang wang software data curation hongshi xu investigation validation denghua yan conceptualization methodology shan e hyder soomro writing review editing declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgements the authors would like to thank the anonymous reviewers for their valuable comments this work was funded by key program of national natural science foundation of china grant number 51739009 national natural science foundation of china grant number 51979250 science and technology innovation talents project of henan education department of china grant number 21hastit011 young backbone teachers training fund of henan education department of china grant number 2020ggjs005 excellent youth fund of henan province of china grant number 212300410088 
3703,evapotranspiration et plays a significant role in fields of agriculture hydrology and meteorology including the irrigation water allocation water resources management drought monitoring and climate change studies however because of contamination of cloud cover the retrieval of daily et from thermal infrared remote sensing data under cloudy sky bristles with difficulties in this paper we proposed a physical and practical method for daily et reconstruction under cloudy sky that was constrained by soil water budget balance with investigation of the soil water stress relationship between available water fraction and potential et ratio this method was tested on both totally field data from 2001 to 2015 at 10 ameriflux sites and modis remote sensing data from 2009 to 2010 at the yucheng site in china results showed that the reconstructed daily et under cloudy sky agreed well with the in situ eddy covariance measurements with the mean average error mae ranging from 12 20 w m2 to 16 77 w m2 the root mean square error rmse varying from 9 47 w m2 to 28 97 w m2 at the 10 ameriflux sites the mae of 2 62 w m2 and the rmse of 35 21 w m2 at the yucheng site overall the proposed method is promising in reconstructing daily et under cloudy sky and can be a good alternative to the conventional interpolating extrapolating methods future work may focus on the further investigation of the proposed method over a wider range of atmospheric soil and vegetation conditions keywords evapotranspiration cloudy sky reconstruction soil water budget balance 1 introduction evapotranspiration et plays an important role in fields of agriculture hydrology and meteorology including the irrigation water allocation water resources management drought monitoring and climate change studies tang et al 2013 pascolini campbell et al 2021 thermal infrared tir remote sensing provides an efficient and effective tool for regional and global et estimates zhang et al 2016 in which an instantaneous et is usually computed based on the energy balance equation with data acquired at the time of satellite overpass and a daily value is obtained through temporal upscaling techniques sugita brutsaert 1991 allen et al 2007 chávez et al 2008 colaizzi et al 2006 crago 1996 lhomme and elguero 1999 liu et al 2011 ryu et al 2012 tang et al 2013 2017 to meet the practical requirements in various fields however because of the contamination of cloud cover that is a prominent phenomenon in many parts of the world and can even exceed 60 on average in the humid tropics bussieres goita 1996 the tir remote sensing is only applicable for et retrieval under clear sky though microwave remote sensing minimally affected by clouds due to the strong penetrating power of the sensor can be used for et estimation under cloudy sky the relatively coarse spatial resolution 25 km of the data greatly limits their applicability at local and regional scales wigneron et al 2003 shi et al 2008 wang et al 2019 for retrieval of temporally and spatially continuous et a direct retrieval of daily et or a reconstruction of daily et under cloudy sky is indispensable and makes a lot of sense jackson et al 1983 sugita brutsaert 1991 zhang lemeur 1995 crago 1996 the direct retrieval of daily et under cloudy sky is usually preformed together with other algorithms applied under clear sky for continuous et estimation for example leng et al 2017 separately estimated et of clear and cloudy pixels in which the et over clear sky was estimated from a two stage land surface temperature fractional vegetation cover feature space and the et when remotely sensed lst was not available under cloudy sky was calculated with the penman monteith equation later cui et al 2021 proposed a scheme by coupling a two source energy balance model and a deep neural network over the heihe river basin and by integrating the shuttleworth wallace and surface temperature vegetation index schemes using the particle swarm optimization algorithm cui et al 2020 as for the reconstruction of daily et under cloudy sky the interpolating extrapolating method is perhaps the most extensively applied technique nichols cuenca 1993 delogu et al 2021 this method is commonly performed by two steps namely firstly interpolating a scaling factor the ratio between et and a reference quantity between available remote sensing estimates over two or more adjacent clear skies in a mathematical way to get the instantaneous scaling factor under cloudy sky and then extrapolating the scaling factor assumed to be constant in a diurnal day under cloudy sky to obtain daily et ryu et al 2012 van niel et al 2012 delogu et al 2012 guillevic et al 2019 the scaling factor in the interpolating extrapolating method could be either the evaporation fraction ef brutsaert sugita 1992 the reference the evaporation fraction efr trezza 2002 allen et al 2007 the global radiation ratio rg jackson et al 1983 the extraterrestrial solar radiation ratio rexs ryu et al 2012 van niel et al 2012 or the decoupling factor ω tang and li 2017 and it has been found to vary nonlinearly and irregularly in time with the change of environment controls atmosphere forcing soil water vegetation etc tang et al 2013 alfieri et al 2017 delogu et al 2021 and especially influenced by the cloud cover occurrence times coverage amounts and durations that affects the cycling of energy and water through earth s atmosphere and causes reductions in solar radiance and available energy jackson et al 1983 sugita brutsaert 1991 zhang lemeur 1995 crago 1996 studies have reported that the scaling factor performed differently between clear sky and cloudy sky for example crago 1996 reviewed a list of scaling factors used in the literature and underlined that some factors were more sensitive to the cloud effects when the available energy on the surface reduced i e in the morning evening and winter delogu et al 2021 found that some scaling factors under cloudy sky were lower compared to values predicted with the interpolation besides the interpolation process of interpolating extrapolating method establishes a link between the clear sky and cloudy sky in the purely mathematical way and the interpolated scaling factor associated was only decided by the images of related clear skies and the interpolation technique applied irrelevant with cloud condition and could not reflect actual values under cloudy sky different interpolation techniques e g linear interpolation the splining interpolation the hermite spline method etc would bring a certain degree of uncertainties for the obtaining of scaling factors then daily et for instance alfieri et al 2017 evaluated three interpolation techniques for the reconstruction of daily et and revealed that the maximum error of daily et could reach 66 w m2 guillevic et al 2019 showed that the uncertainty of daily et over cloudy sky with interpolated scaling factors could be up to 40 for the extrapolating of scaling factors at instantaneous scale to the daily value the basic assumption that the interpolated scaling factors keep self preservative may be not generally met under cloudy sky guillevic et al 2019 essentially the extrapolating is critically affected by the cloud condition as stated above bound to bring unreasonable inconsistences and error in practical applications van niel et al 2012 cammalleri et al 2014 peng et al 2009 tang et al 2013 found that the appearance of clouds in some cases would significantly reduce the accuracy of daily et extrapolated from most scaling factors e g the widely applied ef and the rg and the accuracies of daily et under cloudy sky were just 50 of those under clear sky to sum up the interpolating extrapolating method is a purely mathematical solution without explicit physical mechanisms and greatly subject to cloud cover effect these weaknesses have resulted in a large uncertainty in the reconstruction of daily et to accommodate the inconsistence and error resulted from the absence in considering the cloudy cover of scaling factors through interpolation and the deviation in the extrapolation process caused by cloud effect there may be two solutions one is to develop a generalized scaling factor that could implicitly depict the variation of cloud condition and could keep constant during a cloudy day for this relating the scaling factor to various meteorology variables which were closely associated with the cloud condition may be an effective option but the requirements of large amount of input may prevent its development the other solution is to investigate a physical link between clear and cloudy sky to reconstruct daily et under cloudy sky the objectives of this paper are twofold 1 to develop a practical reconstruction method of daily et under cloudy sky by establishing a physical link between clear and cloudy sky and 2 to validate the new reconstruction method through applications at 10 ameriflux sites and one chinaflux site section 2 introduces the methodology for reconstructing daily et under cloudy sky section 3 describes the test sites and materials as well as the necessary field and remote sensing data section 4 presents the results about the reconstructed daily et and its validation against ground based measurements a last part in this section encapsulates discussions of the results highlighting the efficiency of the reconstruction method and giving an overview of the benefits and shortage of it finally a summary and conclusion of this work are made in section 5 2 methodology 2 1 theory of daily et reconstruction under cloudy sky in this study the reconstruction of daily et under cloudy sky without precipitation is based on the principle of soil water budget balance to establish a physical and rational link between cloudy day and adjacently previous clear day with the consideration of that 1 soil moisture related variables are relatively less sensitive to cloud cover than the aforementioned scaling factors stewart verma 1992 anderson et al 2007 and 2 et itself is a critical variable for constraining the budget of soil water campbell norman 1998 in the reconstruction process the remaining soil water content difference between soil water content and et on clear sky is regarded as the amount of soil available water for the next day cloudy sky daily et under cloudy sky is estimated from the soil available water expressed by soil available water fraction faw which is related to the potential evapotranspiration ratio rpet the ratio between actual et to potential et with the soil moisture stress relationship and this relationship is assumed to be stable in clear sky and cloudy sky the soil water budget balance referred in the reconstruction of daily et under cloudy sky in this study is expressed as 1 a w cloudy a w clear e t clear where awcloudy is the soil available water under cloudy sky resulted from the difference between soil available water aw and et under the previous clear sky when the necessary remote sensing images are available the aw under both clear sky and cloudy sky can be reflected by the soil available water fraction faw as 2 aw f aw a w c where awc is maximum of soil available water content which is related to the soil hydraulic parameters the volumetric soil water contents at the wilting point and field capacity anderson et al 2007 a soil moisture stress function hereinafter referred as f relating the faw to the rpet is introduced to describe the decrement of actual et from the potential rate expected under unstressed conditions pet 3 f aw f r pet 4 r pet et pet with 5 pet α δ δ γ r n where α is the priestley taylor coefficient δ is the slope of saturated vapor pressure versus air temperature kpa c γ is the psychrometric constant kpa c rn is the net radiation w m2 in the practical application once the daily et from remote sensing models and daily pet from eq 5 under clear sky are obtained the rpet is estimated from eq 4 the corresponding faw can be firstly calculated from eq 3 and the aw computed from eq 2 with the aw and daily et under clear sky the aw under cloudy sky can then be estimated with the soil water balance equation from eq 1 further with the aw under cloudy sky the faw under cloudy sky is predicted according to eq 2 successively daily rpet under cloudy sky is estimated with the soil moisture stress function between it and the faw according to eq 3 finally daily et under cloudy sky is reconstructed with daily rpet and pet under cloudy sky according to eq 4 the detailed steps referred to this are shown in fig 1 in the daily et reconstruction one of the keys is to establish the soil moisture stress relationship between the faw and the rpet which together with the soil water balance equation physically connects daily et between the clear sky and cloudy sky section 2 2 2 presents in detail how the soil moisture stress relationship is determined meanwhile it is prerequisite to estimate daily et under clear sky in eqs 1 and 4 which is detailed in the following section 2 2 1 2 2 determination of key variables and relationship 2 2 1 daily et estimation under clear sky in this study daily et under clear days is estimated with the method presented in our previous study jiang et al 2018 which was developed based on the decoupling model 6 e t clear ω e t eq 1 ω e t im with 7 ω 1 c w s i 1 t s t a t s t a min t s t a max t s t a min 8 e eq δ δ γ r n g λ 9 e im ρ c p v p d λ γ r c where ω is the decoupling coefficient et eq is the equilibrium evapotranspiration w m2 etim is the evapotranspiration by the surrounding air w m2 cwsi is the crop water stress index boegh et al 2002 ts is the remotely sensed surface temperature and ta is the air temperature k ts ta min is the theoretical minimum value for ts ta and ts ta max is the theoretical maximum value for ts ta r n is the net radiation w m2 g is the soil heat flux w m2 λ is the latent heat of vaporization kj kg r c is the canopy surface resistance s m ρ is the density of air kg m3 cp is the volumetric heat capacity of air mj kg 1 c 1 vpd is the vapor pressure deficit of the air kpa in this daily et estimation method daily ω is replaced by the instantaneous ω from eq 7 assuming the self preservation of it in a diurnal day and daily et is calculated directly through the decoupling model more information of the method was detailed in our previous study jiang et al 2018 the rn in this work is computed from the downward and upward shortwave and longwave radiations at the ground 10 r n 1 α r g ε s ε a σ t a 4 ε s σ t s 4 where a is the surface albedo rg is the global solar radiation w m2 ε s is the surface emissivity ε a is the atmospheric emissivity σ is the stefan boltzmann constant 2 2 2 exploration of soil moisture stress relationship between the rpet and the faw the soil moisture stress relationship between the rpet and the faw was explored using an atmosphere land exchange alex model and determined based on field data from 10 ameriflux sites with available hydraulic parameters of soil namely the volumetric soil water contents at the wilting point and field capacity the alex is a model of heat water and carbon exchange between the soil vegetation and atmosphere in this model the et at the measurement reference height is a composite of evaporation from the soil surface and transpiration from the leaf stomata and the sensible heat is also transferred from the canopy and the soil surface this model is computationally efficient and requires few species specific parameters houborg et al 2009 which generates et and other fluxes in good agreement with the estimates from iterative mechanistic photosynthetic models and with the flux measurements in various kinds of vegetation details of the model were presented in anderson s study anderson et al 2000 the soil water content data simulated by the alex model combined with the soil thermodynamic parameters is utilized to obtain the faw according to the inverse eq 2 the net radiation obtained by the model and the corresponding meteorological data are used to compute the pet based on which the rpet is calculated by combining the et simulated by the alex model according to eq 4 given the wide range of faw and rpet over different fractional vegetation cover fvc conditions the soil moisture stress relationship could be determined 3 study area and material 3 1 ameriflux sites and data this study selected 10 flux sites in the united states from the ameriflux website http ameriflux lbl gov to determine the soil moisture stress relationship between the rpet and the faw under clear sky and to implement the reconstruction of daily et with total field data at first since the error in the remote sensing based et estimates could be propagated into the subsequent reconstruction of daily et and the degradation of the retrieval quality was expected the latitudes and longitudes of these sites range from 31 59 n to 45 82 n and from 88 22 w to 121 95 w respectively the vegetation types covering these sites are crop grass and forest the climate types of these sites include 1 semiarid steppe 2 mediterranean 3 humid continental and 4 humid subtropical the distribution of these 10 ameriflux sites are shown in fig 2 and the detailed information is listed in table 1 field data from these sites include meteorological variables of relative humidity air temperature and atmospheric pressure and net radiation flux used for the calculation of daily pet of all skies downward shortwave radiation used for the judge of whether the day is clear sky or not soil moisture data and the hydraulic parameters of the soil used for the retrieval of the faw and eddy covariance ec measured latent heat flux used as the et data on clear days and as validations of reconstructed et on cloudy days the data have been standardized and quality control qa qc checked di et al 2015 the ameriflux tower datasets were available every half hour for a given day when the number of reliable half hourly measurements was no less than 48 the day was labelled as a valid day otherwise the meteorological parameters for that day were removed on valid days the daily values were computed as the average of all half hourly measurements in a diurnal day at local time except for daily vpd which was computed as daily saturated vapor pressure calculated from daily air temperature minus daily air vapor pressure the study period of these sites varies from 2001 to 2015 and the soil hydraulic parameters are shown in table 1 3 2 chinaflux site and data the yucheng site 36 8291 n 116 5703 e an integrated agricultural experimental station of chinaflux networks and located in the southwest of shandong province in china fig 3 was selected as another test site the data at this site were utilized to drive the alex model and estimate daily ets on clear days for validation of the universality of the soil moisture stress relationship between the rpet and the faw explored with 10 ameriflux sites and the feasibility of the reconstruction method under cloudy sky based on remote sensing data the contrasting atmospheric forcing data soil properties and vegetation characteristics of two days in 2009 day of year doy 2009187 and 2009289 were chosen as inputs of the alex model to initially explore the relationship pattern between the rpet and the faw which were presented in table 2 field data from this site include meteorological variables of relative humidity air temperature and atmospheric pressure used for the calculation of daily pet of cloudy sky and eddy covariance ec measured latent heat flux used as validations of reconstructed et on cloudy days and et estimations on clear days with the study period from late april 2009 to late october 2010 note that both the instantaneous and daily meteorological inputs variables were required and the daily values were computed as the average of all half hourly measurements as well corresponding modis data at this site were used to estimate daily et under clear sky including the modis level 1b calibrated radiances 1 km product mod021km utilized to derive net radiance the modis terra land surface temperature emissivity 5 minute l2 swath 1 km product mod11 l2 utilized to provide ts the modis terra surface reflectance daily global 1 km and 500 m sin grid product mod09ga utilized to estimate albedo following the work of tasumi et al 2008 and the modis cloud mask product mod35 utilized to identify clear or cloudy sky in this section the clear sky was judged at first according to the method introduced in our previous study jiang et al 2019 and 45 completely clear sky days were selected 4 results and discussion 4 1 soil moisture stress relationship between the rpet and the faw 4 1 1 simulated relationship pattern from the alex with the field data of two days doy 2009187 and doy 2009289 at the yucheng site as input data the soil moisture stress relationship pattern between the potential evaporation ratio rpet and the soil available water ratio faw was simulated with the alex model at first fig 4 presents a scatter plot between the rpet and the faw when the fraction vegetation cover fvc changes from 0 to 1 increased with the black arrow going in the selected two days based on the model simulation data in the figure similar exponential relationship pattern between the rpet and the faw were observed in the two selected days specifically when the faw was lower than a certain threshold about 0 7 when doy was 2009187 about 0 5 when doy was 2009289 the rpet raised gradually with the increase of the faw when the faw was greater than this threshold the rpet basically remained stable and did not increase any more meanwhile the relationship was affected by the fvc in detail when the faw was lower than the certain threshold the larger the fvc was the larger the rpet value was for the same faw by contrast when the faw was greater than this threshold the larger the fvc was the lower the rpet value was for the same faw 4 1 2 determined relationship based on field data of ameriflux sites for quantification of the exponential soil moisture stress relationship between the rpet and the faw field data of 10 ameriflux sites were further used to calculate the rpet and the faw and the scatter plots and fitted exponential equations y a exp b x in which y indicates the rpet and x indicates the faw respectively were shown in fig 5 the regression coefficients a and b of each site were displayed in fig 6 it can be seen from fig 5 that these scatter plots between the rpet and the faw based on the data from these 10 ameriflux sites demonstrated obvious exponential pattern as well as for the fitted relationship equations rpet a exp b faw the coefficients a and b at different sites had certain differences but they were basically close to each other specifically among the 10 ameriflux sites the coefficient a varied from 0 06 to 0 22 with an average value of 0 137 and a standard deviation of 0 04 the coefficient b varied from 3 31 to 6 14 with an average value of 4 289 and a standard deviation of 0 897 it is worth noting that the fitting results of the soil moisture stress relationship between the rpet and the faw seemed better at the us aud site which was likely caused by the fact that at this site lower values of faw were less distributed while the relatively poor performance of the fitted relationships was mainly found under conditions of lower faw at other sites besides the relationship at the us aud site showed remarkable differences with those from other sites if the coefficients at this site were removed the average value of 0 13 for the coefficient a could be obtained with remaining sites with the average value of 4 08 for the coefficient b accordingly the exponential relationship rpet 0 13 exp 4 08 faw where the coefficients related to the us aud site were excluded was obtained and applied as the universal exponential soil moisture stress relationship between the rpet and the faw in the following sections for daily et reconstructions 4 2 validation of daily et reconstructions under cloudy sky based on the explored exponential relationship rpet 0 13 exp 4 08 faw between the rpet and the faw the proposed method in section 2 was utilized to reconstruct daily et based on totally field data from 10 ameriflux sites and the modis data and necessary field data from the yucheng site respectively 4 2 1 daily et reconstructions with total field data daily et were reconstructed with total field data from 10 ameriflux sites at first to avoid any deviation from remote sensing retrievals this section included two parts without judging whether the given day was clear or not in order to guarantee the number of days involved in the test and with judging the clear days to test the feasibility of the method under cloudy sky respectively in the first part the previous days with complete input data were regarded as clear sky and the corresponding next day following them were used as the cloudy sky and the daily et of these cloudy sky were reconstructed with proposed method in this process the explored universal soil moisture stress relationship between the rpet and the faw were applied at each site and the difference between soil water content and et on each given day was used as the available soil water for the next day regarded as cloudy sky fig 7 compares the reconstructed daily et and corresponding measurements table 3 displays the number of selected days n in the test and corresponding statistics of mean average error mae and root mean square error rmse related to the daily et reconstructions results from the comparison scatter plots indicated that the reconstructed daily ets of cloudy sky were basically consistent with the in situ measurements from ec flux tower combining the table 3 and fig 7 it could be found that the mae in the validation of reconstructed daily et under cloudy sky with in situ et measurements varied from 15 08 w m2 to 12 42 w m2 with mostly negative values indicating that daily et at most sites were underestimated the rmse in the validation varied between 12 72 w m2 and 39 09 w m2 revealing the high accuracy of the reconstruction method besides the number of selected days n was from 519 at the us fr2 site to 2448 at the us var site making sure that the quantity of cloudy sky was enough to convince the validation of our proposed method what calls for special attention was that daily et at the us aud site which was excluded in the determination of coefficients also had good consistencies with in situ daily et revealing the universality of these two coefficients in the explored soil moisture stress relationship to a certain degree in the second part of this section the real clear sky was selected based on the measured downward shortwave radiation data from 10 ameriflux sites in which the judgment method of clear sky was detailed in our previous study jiang et al 2019 the daily ets of the cloudy days following these clear days were reconstructed based on the explored exponential relationship between the rpet and the faw rpet 0 13 exp 4 08 faw the comparison between the reconstructed daily et and the in situ values is shown in fig 8 these scatter plots in fig 8 demonstrated that the number of test days had been significantly reduced after the selections of clear sky and the reconstructed daily ets under the cloudy sky based on the proposed method were still basically consistent with the in situ measurements the statistical mae and rmse related to the reconstruction results and the number of test days n are listed in table 4 combining the results in table 4 and fig 8 it could be seen that the mae in the validation of reconstructed daily ets against in situ measurements ranged from 12 20 w m2 to 16 77 w m2 the mae was a little larger than those without clear sky selections and the positive value at some sites meant that the daily et was overestimated further indicating that the underestimation when the clear sky days were not selected in the first part of this section was mainly from clear sky the rmse in the validation of reconstructed daily et under cloudy sky varied between 9 47 w m2 and 28 97 w m2 in which most of them 7 sites were less than 20 w m2 and comparative to those in the situation when clear sky was not selected comparing the results in fig 7 and fig 8 in which the same exponential relationship between the rpet and the faw was applied to each site to reconstruct daily et of the next days it was easy to find that whether clear sky days were selected or not the differences of the estimation error related to two situations were not obvious in other words this daily et reconstruction method was not only applicable to cloudy sky but also feasible to estimate daily et of every missing date if the necessary data in the previous day was available comparing the results in table 3 and table 4 one could find that the differences in the rmses of the validation at most sites were not obvious except for the us fr2 and us ib1 sites the exception may be caused by the fact that the number of remaining days at these two sites when the clear sky days were singled out was vastly less than those when the clear sky days were not singled out it should be noted that the day following the clear sky when the clear sky was selected was not all the cloudy sky in other words some of them may be clear day as well fortunately this setting would not affect the results 4 2 2 daily et reconstructions with remote sensing data in order to verify the universal applicability of the explored soil moisture stress relationship between the rpet and the faw from the 10 ameriflux sites the robustness of the proposed method for reconstructing daily et under cloudy sky and the feasibility of the reconstruction method based on remote sensing data modis data together with the necessary meteorological data at the yucheng site was selected to estimate the et on clear days and further to reconstruct daily et under cloudy sky the daily et estimated under clear sky agreed well with the in situ measurements with the mae and rmse of 5 03 w m2 and 18 60 w m2 respectively see fig 3 in our previous study jiang et al 2018 the soil moisture content of this site under clear sky days were calculated according to the eqs 2 and 3 in which the faw was obtained based on inverse function of the exponential relationship rpet 0 13 exp 4 08 faw together with the hydraulic parameters of the soil at this site using the exponential relationship rpet 0 13 exp 4 08 faw between the rpet and the faw explored from the 10 ameriflux sites the proposed reconstruction method was applied to estimate daily et under cloudy sky the next day adjacent to the clear day if there were two clear days adjacent to each other it would be a clear day and the estimated results were compared with in situ measurement which was corrected with bowen ratio method br method l e cor r n g le le h to correct the energy imbalance in fig 9 from the figure it was clear that the estimated daily et under cloudy conditions agreed well with the in situ measurements the estimation mae was 2 62 w m2 and the rmse was 35 21 w m2 the estimated deviation was similar to that in fig 7 in which the maximum rmse was 39 09 w m2 therefore the exponential relationship between the rpet and the faw explored using the field data from 10 ameriflux sites had a certain universality and the proposed method was feasible to reconstruct daily et under cloudy conditions with remote sensing data used for daily et retrieval under clear sky 4 3 discussions 4 3 1 main considerations of the reconstruction method for retrieval of temporally and spatially continuous et jackson et al 1983 sugita brutsaert 1991 zhang lemeur 1995 crago 1996 it is urgent and essential to reconstruct daily et under cloudy sky in this paper we proposed a practical and physical daily et reconstruction method constrained by the soil water budget balance in which the difference between soil water storage and et under clear sky was taken as the amount of soil water storage for the next day cloudy sky assuming that the loss of soil water in clear days was mainly due to the et process and other water loss was ignored the soil water storage was reflected by the soil available water fraction faw which was related to the potential et ratio rpet the ratio between actual et to potential et with the soil moisture stress relationship and this soil moisture stress relationship was assumed to be stable namely this relationship under clear sky was still applicable under cloudy sky the key of the proposed reconstruction method was to explore the soil moisture stress relationship between the rpet and the faw in fact a wide range of forms of this relationship have been reported in the literature abramopoulos et al 1988 including linear functions mahfouf noilhan 1991 piecewise linear or threshold models mahrt pan 1984 and non linear forms campbell norman 1998 with varying degrees of complexity and dependence on soil textural properties and vegetation type nevertheless no unifying form existed for this reason this relationship was explored in this study based on simulated data from the alex model and the coefficients were determined with the data from 10 ameriflux sites the soil water budget balance and involved soil moisture stress relationship between the rpet and the faw establishing a physical link between the clear sky and cloudy sky made daily et reconstruction under cloudy sky rational operable and relatively less sensitive to cloud cover the proposed method vastly differed from the interpolating extrapolating methods in most already presented works which established a link between the clear sky and cloudy sky in a purely mathematical way through interpolation and extrapolation of scaling factors to obtain daily et in fact the interpolation of scaling factor was only associated to the values of clear sky which did not reflect the condition of cloudy sky while the extrapolation process was seriously affected by cloudy cover referred to the accuracy of daily et estimation the results associated to interpolating extrapolating methods were considered too low up to 40 uncertainty of et guillevic et al 2019 with the maximum error reported reaching 66 w m2 in the study of alfieri et al 2017 who evaluated different interpolation techniques using in situ measurements collected over a variety of land cover types in this study the results from totally field data showed that the reconstructed daily et had a good agreement with in situ measurements with most of the rmse less than 30 w m2 based on modis and filed data the reconstructed daily ets were consistent with in situ values as well with an rmse of 35 21 w m2 in short our proposed method could behave as well as or even better than these interpolating extrapolating methods 4 3 2 advantages of the reconstruction method one advantage of this proposed reconstruction method was its capability of reconstructing daily et for multiple consecutive cloudy days with availability of relevant data from only a clear day in addition the reconstruction method was applicable not only in the cloudy sky but also on any days with missing data without precipitation if there were necessary data in the previous day before the date of interest which was proven by the good agreement between daily et estimations and in situ measurements without and with clear day selections these advantages were attributed to the act that the difference between the soil water storage and et in the previous day was taken as the soil water storage of the next day no matter how the weather was moreover the reconstruction method was simple and practical with less necessary inputs including the variables used for daily et retrieval under clear sky the variables for daily potential et calculation under cloudy sky and the hydraulic parameters of the soil the method was demonstrated to be feasible based on both the totally field data and remote sensing data over a wide range of soil vegetation and climate conditions at 10 ameriflux sites and one chinaflux site another major insight in this study was to deconvolute the respective impacts of remote sensing estimation by using in a first part totally field data from 10 ameriflux sites considering no error related to parameter retrieval and by using in a second part remote sensing estimates of et at the yucheng site in china which were subject to some estimation errors in remote sensing parameters since the errors in the remote sensing based et estimates propagate into the subsequent reconstruction of continuous series of daily et there may be a degradation of the retrieval quality 4 3 3 limitations of the reconstruction method of course there were some limitations of our reconstructed method and there still need some improvements it demands our attention that this method was not applicable for the instantaneous scale because the difference of instantaneous water content and et under completely clear day does not reflect instantaneous soil moisture storage at the second day and there will still be water loss in the subsequent moments in the clear day meanwhile the recharge of soil available water content in this method will not be considered until the day with precipitation in this method the precipitation would only be considered in the soil available water content in the first tested clear sky and would not be considered in soil moisture stress relationship which was assumed to be same in clear sky and cloudy sky besides although the explored relationship between the rpet and the faw was proven to be universal at both the 10 ameriflux sites and the yucheng site it was still empirical to some extent appropriate functions may also depend on the size of model pixel and sub pixel heterogeneity in soil conditions in future work it is urgent to further explore this relationship with more data or through other investigation because the accurate expression of this relationship was the prerequisite for the application of this reconstruction method to accurately estimate daily et under cloudy sky 5 conclusions in this paper we proposed a physical and practical method for reconstructing daily et under cloudy sky based on a running water budget balance using the soil moisture stress relationship between the potential evapotranspiration ratio rpet and the available water fraction faw the field data from 10 ameriflux sites were firstly chosen to explore this relationship and applied for reconstruction of daily et for avoiding the effect of error in remote sensing retrieval successively modis data and meteorological data from the yucheng site in china were used to estimate daily ets on clear days and reconstruct daily ets on cloudy days using the proposed method our proposed reconstruction method could be utilized to estimate daily et under cloud sky with good accuracy the verification results based on these 10 ameriflux sites showed that the reconstructed daily ets under cloudy sky agreed well with the in situ measurements with most of the rmse less than 30 w m2 the reconstructed daily et based on modis data at the yucheng site was also in good agreement with ec measurements with the rmse under cloudy sky of 35 21 w m2 the proposed method is promising in reconstructing daily et under cloudy sky and can be a good alternative to the interpolating extrapolating methods future work may focus on the further investigation of proposed method over a wider range of atmospheric soil and vegetation conditions credit authorship contribution statement yazhen jiang methodology software data curation ronglin tang conceptualization validation writing original draft zhao liang li visualization investigation supervision writing review editing declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgement we thank the ameriflux data resources https ameriflux lbl gov yucheng meteorological and flux data resources http chinaflux org and modis data https modis gsfc nasa gov data the work is supported by the national natural science foundation of china 42001306 41922009 42071332 the national key r d program of china 2018yfa0605401 
3703,evapotranspiration et plays a significant role in fields of agriculture hydrology and meteorology including the irrigation water allocation water resources management drought monitoring and climate change studies however because of contamination of cloud cover the retrieval of daily et from thermal infrared remote sensing data under cloudy sky bristles with difficulties in this paper we proposed a physical and practical method for daily et reconstruction under cloudy sky that was constrained by soil water budget balance with investigation of the soil water stress relationship between available water fraction and potential et ratio this method was tested on both totally field data from 2001 to 2015 at 10 ameriflux sites and modis remote sensing data from 2009 to 2010 at the yucheng site in china results showed that the reconstructed daily et under cloudy sky agreed well with the in situ eddy covariance measurements with the mean average error mae ranging from 12 20 w m2 to 16 77 w m2 the root mean square error rmse varying from 9 47 w m2 to 28 97 w m2 at the 10 ameriflux sites the mae of 2 62 w m2 and the rmse of 35 21 w m2 at the yucheng site overall the proposed method is promising in reconstructing daily et under cloudy sky and can be a good alternative to the conventional interpolating extrapolating methods future work may focus on the further investigation of the proposed method over a wider range of atmospheric soil and vegetation conditions keywords evapotranspiration cloudy sky reconstruction soil water budget balance 1 introduction evapotranspiration et plays an important role in fields of agriculture hydrology and meteorology including the irrigation water allocation water resources management drought monitoring and climate change studies tang et al 2013 pascolini campbell et al 2021 thermal infrared tir remote sensing provides an efficient and effective tool for regional and global et estimates zhang et al 2016 in which an instantaneous et is usually computed based on the energy balance equation with data acquired at the time of satellite overpass and a daily value is obtained through temporal upscaling techniques sugita brutsaert 1991 allen et al 2007 chávez et al 2008 colaizzi et al 2006 crago 1996 lhomme and elguero 1999 liu et al 2011 ryu et al 2012 tang et al 2013 2017 to meet the practical requirements in various fields however because of the contamination of cloud cover that is a prominent phenomenon in many parts of the world and can even exceed 60 on average in the humid tropics bussieres goita 1996 the tir remote sensing is only applicable for et retrieval under clear sky though microwave remote sensing minimally affected by clouds due to the strong penetrating power of the sensor can be used for et estimation under cloudy sky the relatively coarse spatial resolution 25 km of the data greatly limits their applicability at local and regional scales wigneron et al 2003 shi et al 2008 wang et al 2019 for retrieval of temporally and spatially continuous et a direct retrieval of daily et or a reconstruction of daily et under cloudy sky is indispensable and makes a lot of sense jackson et al 1983 sugita brutsaert 1991 zhang lemeur 1995 crago 1996 the direct retrieval of daily et under cloudy sky is usually preformed together with other algorithms applied under clear sky for continuous et estimation for example leng et al 2017 separately estimated et of clear and cloudy pixels in which the et over clear sky was estimated from a two stage land surface temperature fractional vegetation cover feature space and the et when remotely sensed lst was not available under cloudy sky was calculated with the penman monteith equation later cui et al 2021 proposed a scheme by coupling a two source energy balance model and a deep neural network over the heihe river basin and by integrating the shuttleworth wallace and surface temperature vegetation index schemes using the particle swarm optimization algorithm cui et al 2020 as for the reconstruction of daily et under cloudy sky the interpolating extrapolating method is perhaps the most extensively applied technique nichols cuenca 1993 delogu et al 2021 this method is commonly performed by two steps namely firstly interpolating a scaling factor the ratio between et and a reference quantity between available remote sensing estimates over two or more adjacent clear skies in a mathematical way to get the instantaneous scaling factor under cloudy sky and then extrapolating the scaling factor assumed to be constant in a diurnal day under cloudy sky to obtain daily et ryu et al 2012 van niel et al 2012 delogu et al 2012 guillevic et al 2019 the scaling factor in the interpolating extrapolating method could be either the evaporation fraction ef brutsaert sugita 1992 the reference the evaporation fraction efr trezza 2002 allen et al 2007 the global radiation ratio rg jackson et al 1983 the extraterrestrial solar radiation ratio rexs ryu et al 2012 van niel et al 2012 or the decoupling factor ω tang and li 2017 and it has been found to vary nonlinearly and irregularly in time with the change of environment controls atmosphere forcing soil water vegetation etc tang et al 2013 alfieri et al 2017 delogu et al 2021 and especially influenced by the cloud cover occurrence times coverage amounts and durations that affects the cycling of energy and water through earth s atmosphere and causes reductions in solar radiance and available energy jackson et al 1983 sugita brutsaert 1991 zhang lemeur 1995 crago 1996 studies have reported that the scaling factor performed differently between clear sky and cloudy sky for example crago 1996 reviewed a list of scaling factors used in the literature and underlined that some factors were more sensitive to the cloud effects when the available energy on the surface reduced i e in the morning evening and winter delogu et al 2021 found that some scaling factors under cloudy sky were lower compared to values predicted with the interpolation besides the interpolation process of interpolating extrapolating method establishes a link between the clear sky and cloudy sky in the purely mathematical way and the interpolated scaling factor associated was only decided by the images of related clear skies and the interpolation technique applied irrelevant with cloud condition and could not reflect actual values under cloudy sky different interpolation techniques e g linear interpolation the splining interpolation the hermite spline method etc would bring a certain degree of uncertainties for the obtaining of scaling factors then daily et for instance alfieri et al 2017 evaluated three interpolation techniques for the reconstruction of daily et and revealed that the maximum error of daily et could reach 66 w m2 guillevic et al 2019 showed that the uncertainty of daily et over cloudy sky with interpolated scaling factors could be up to 40 for the extrapolating of scaling factors at instantaneous scale to the daily value the basic assumption that the interpolated scaling factors keep self preservative may be not generally met under cloudy sky guillevic et al 2019 essentially the extrapolating is critically affected by the cloud condition as stated above bound to bring unreasonable inconsistences and error in practical applications van niel et al 2012 cammalleri et al 2014 peng et al 2009 tang et al 2013 found that the appearance of clouds in some cases would significantly reduce the accuracy of daily et extrapolated from most scaling factors e g the widely applied ef and the rg and the accuracies of daily et under cloudy sky were just 50 of those under clear sky to sum up the interpolating extrapolating method is a purely mathematical solution without explicit physical mechanisms and greatly subject to cloud cover effect these weaknesses have resulted in a large uncertainty in the reconstruction of daily et to accommodate the inconsistence and error resulted from the absence in considering the cloudy cover of scaling factors through interpolation and the deviation in the extrapolation process caused by cloud effect there may be two solutions one is to develop a generalized scaling factor that could implicitly depict the variation of cloud condition and could keep constant during a cloudy day for this relating the scaling factor to various meteorology variables which were closely associated with the cloud condition may be an effective option but the requirements of large amount of input may prevent its development the other solution is to investigate a physical link between clear and cloudy sky to reconstruct daily et under cloudy sky the objectives of this paper are twofold 1 to develop a practical reconstruction method of daily et under cloudy sky by establishing a physical link between clear and cloudy sky and 2 to validate the new reconstruction method through applications at 10 ameriflux sites and one chinaflux site section 2 introduces the methodology for reconstructing daily et under cloudy sky section 3 describes the test sites and materials as well as the necessary field and remote sensing data section 4 presents the results about the reconstructed daily et and its validation against ground based measurements a last part in this section encapsulates discussions of the results highlighting the efficiency of the reconstruction method and giving an overview of the benefits and shortage of it finally a summary and conclusion of this work are made in section 5 2 methodology 2 1 theory of daily et reconstruction under cloudy sky in this study the reconstruction of daily et under cloudy sky without precipitation is based on the principle of soil water budget balance to establish a physical and rational link between cloudy day and adjacently previous clear day with the consideration of that 1 soil moisture related variables are relatively less sensitive to cloud cover than the aforementioned scaling factors stewart verma 1992 anderson et al 2007 and 2 et itself is a critical variable for constraining the budget of soil water campbell norman 1998 in the reconstruction process the remaining soil water content difference between soil water content and et on clear sky is regarded as the amount of soil available water for the next day cloudy sky daily et under cloudy sky is estimated from the soil available water expressed by soil available water fraction faw which is related to the potential evapotranspiration ratio rpet the ratio between actual et to potential et with the soil moisture stress relationship and this relationship is assumed to be stable in clear sky and cloudy sky the soil water budget balance referred in the reconstruction of daily et under cloudy sky in this study is expressed as 1 a w cloudy a w clear e t clear where awcloudy is the soil available water under cloudy sky resulted from the difference between soil available water aw and et under the previous clear sky when the necessary remote sensing images are available the aw under both clear sky and cloudy sky can be reflected by the soil available water fraction faw as 2 aw f aw a w c where awc is maximum of soil available water content which is related to the soil hydraulic parameters the volumetric soil water contents at the wilting point and field capacity anderson et al 2007 a soil moisture stress function hereinafter referred as f relating the faw to the rpet is introduced to describe the decrement of actual et from the potential rate expected under unstressed conditions pet 3 f aw f r pet 4 r pet et pet with 5 pet α δ δ γ r n where α is the priestley taylor coefficient δ is the slope of saturated vapor pressure versus air temperature kpa c γ is the psychrometric constant kpa c rn is the net radiation w m2 in the practical application once the daily et from remote sensing models and daily pet from eq 5 under clear sky are obtained the rpet is estimated from eq 4 the corresponding faw can be firstly calculated from eq 3 and the aw computed from eq 2 with the aw and daily et under clear sky the aw under cloudy sky can then be estimated with the soil water balance equation from eq 1 further with the aw under cloudy sky the faw under cloudy sky is predicted according to eq 2 successively daily rpet under cloudy sky is estimated with the soil moisture stress function between it and the faw according to eq 3 finally daily et under cloudy sky is reconstructed with daily rpet and pet under cloudy sky according to eq 4 the detailed steps referred to this are shown in fig 1 in the daily et reconstruction one of the keys is to establish the soil moisture stress relationship between the faw and the rpet which together with the soil water balance equation physically connects daily et between the clear sky and cloudy sky section 2 2 2 presents in detail how the soil moisture stress relationship is determined meanwhile it is prerequisite to estimate daily et under clear sky in eqs 1 and 4 which is detailed in the following section 2 2 1 2 2 determination of key variables and relationship 2 2 1 daily et estimation under clear sky in this study daily et under clear days is estimated with the method presented in our previous study jiang et al 2018 which was developed based on the decoupling model 6 e t clear ω e t eq 1 ω e t im with 7 ω 1 c w s i 1 t s t a t s t a min t s t a max t s t a min 8 e eq δ δ γ r n g λ 9 e im ρ c p v p d λ γ r c where ω is the decoupling coefficient et eq is the equilibrium evapotranspiration w m2 etim is the evapotranspiration by the surrounding air w m2 cwsi is the crop water stress index boegh et al 2002 ts is the remotely sensed surface temperature and ta is the air temperature k ts ta min is the theoretical minimum value for ts ta and ts ta max is the theoretical maximum value for ts ta r n is the net radiation w m2 g is the soil heat flux w m2 λ is the latent heat of vaporization kj kg r c is the canopy surface resistance s m ρ is the density of air kg m3 cp is the volumetric heat capacity of air mj kg 1 c 1 vpd is the vapor pressure deficit of the air kpa in this daily et estimation method daily ω is replaced by the instantaneous ω from eq 7 assuming the self preservation of it in a diurnal day and daily et is calculated directly through the decoupling model more information of the method was detailed in our previous study jiang et al 2018 the rn in this work is computed from the downward and upward shortwave and longwave radiations at the ground 10 r n 1 α r g ε s ε a σ t a 4 ε s σ t s 4 where a is the surface albedo rg is the global solar radiation w m2 ε s is the surface emissivity ε a is the atmospheric emissivity σ is the stefan boltzmann constant 2 2 2 exploration of soil moisture stress relationship between the rpet and the faw the soil moisture stress relationship between the rpet and the faw was explored using an atmosphere land exchange alex model and determined based on field data from 10 ameriflux sites with available hydraulic parameters of soil namely the volumetric soil water contents at the wilting point and field capacity the alex is a model of heat water and carbon exchange between the soil vegetation and atmosphere in this model the et at the measurement reference height is a composite of evaporation from the soil surface and transpiration from the leaf stomata and the sensible heat is also transferred from the canopy and the soil surface this model is computationally efficient and requires few species specific parameters houborg et al 2009 which generates et and other fluxes in good agreement with the estimates from iterative mechanistic photosynthetic models and with the flux measurements in various kinds of vegetation details of the model were presented in anderson s study anderson et al 2000 the soil water content data simulated by the alex model combined with the soil thermodynamic parameters is utilized to obtain the faw according to the inverse eq 2 the net radiation obtained by the model and the corresponding meteorological data are used to compute the pet based on which the rpet is calculated by combining the et simulated by the alex model according to eq 4 given the wide range of faw and rpet over different fractional vegetation cover fvc conditions the soil moisture stress relationship could be determined 3 study area and material 3 1 ameriflux sites and data this study selected 10 flux sites in the united states from the ameriflux website http ameriflux lbl gov to determine the soil moisture stress relationship between the rpet and the faw under clear sky and to implement the reconstruction of daily et with total field data at first since the error in the remote sensing based et estimates could be propagated into the subsequent reconstruction of daily et and the degradation of the retrieval quality was expected the latitudes and longitudes of these sites range from 31 59 n to 45 82 n and from 88 22 w to 121 95 w respectively the vegetation types covering these sites are crop grass and forest the climate types of these sites include 1 semiarid steppe 2 mediterranean 3 humid continental and 4 humid subtropical the distribution of these 10 ameriflux sites are shown in fig 2 and the detailed information is listed in table 1 field data from these sites include meteorological variables of relative humidity air temperature and atmospheric pressure and net radiation flux used for the calculation of daily pet of all skies downward shortwave radiation used for the judge of whether the day is clear sky or not soil moisture data and the hydraulic parameters of the soil used for the retrieval of the faw and eddy covariance ec measured latent heat flux used as the et data on clear days and as validations of reconstructed et on cloudy days the data have been standardized and quality control qa qc checked di et al 2015 the ameriflux tower datasets were available every half hour for a given day when the number of reliable half hourly measurements was no less than 48 the day was labelled as a valid day otherwise the meteorological parameters for that day were removed on valid days the daily values were computed as the average of all half hourly measurements in a diurnal day at local time except for daily vpd which was computed as daily saturated vapor pressure calculated from daily air temperature minus daily air vapor pressure the study period of these sites varies from 2001 to 2015 and the soil hydraulic parameters are shown in table 1 3 2 chinaflux site and data the yucheng site 36 8291 n 116 5703 e an integrated agricultural experimental station of chinaflux networks and located in the southwest of shandong province in china fig 3 was selected as another test site the data at this site were utilized to drive the alex model and estimate daily ets on clear days for validation of the universality of the soil moisture stress relationship between the rpet and the faw explored with 10 ameriflux sites and the feasibility of the reconstruction method under cloudy sky based on remote sensing data the contrasting atmospheric forcing data soil properties and vegetation characteristics of two days in 2009 day of year doy 2009187 and 2009289 were chosen as inputs of the alex model to initially explore the relationship pattern between the rpet and the faw which were presented in table 2 field data from this site include meteorological variables of relative humidity air temperature and atmospheric pressure used for the calculation of daily pet of cloudy sky and eddy covariance ec measured latent heat flux used as validations of reconstructed et on cloudy days and et estimations on clear days with the study period from late april 2009 to late october 2010 note that both the instantaneous and daily meteorological inputs variables were required and the daily values were computed as the average of all half hourly measurements as well corresponding modis data at this site were used to estimate daily et under clear sky including the modis level 1b calibrated radiances 1 km product mod021km utilized to derive net radiance the modis terra land surface temperature emissivity 5 minute l2 swath 1 km product mod11 l2 utilized to provide ts the modis terra surface reflectance daily global 1 km and 500 m sin grid product mod09ga utilized to estimate albedo following the work of tasumi et al 2008 and the modis cloud mask product mod35 utilized to identify clear or cloudy sky in this section the clear sky was judged at first according to the method introduced in our previous study jiang et al 2019 and 45 completely clear sky days were selected 4 results and discussion 4 1 soil moisture stress relationship between the rpet and the faw 4 1 1 simulated relationship pattern from the alex with the field data of two days doy 2009187 and doy 2009289 at the yucheng site as input data the soil moisture stress relationship pattern between the potential evaporation ratio rpet and the soil available water ratio faw was simulated with the alex model at first fig 4 presents a scatter plot between the rpet and the faw when the fraction vegetation cover fvc changes from 0 to 1 increased with the black arrow going in the selected two days based on the model simulation data in the figure similar exponential relationship pattern between the rpet and the faw were observed in the two selected days specifically when the faw was lower than a certain threshold about 0 7 when doy was 2009187 about 0 5 when doy was 2009289 the rpet raised gradually with the increase of the faw when the faw was greater than this threshold the rpet basically remained stable and did not increase any more meanwhile the relationship was affected by the fvc in detail when the faw was lower than the certain threshold the larger the fvc was the larger the rpet value was for the same faw by contrast when the faw was greater than this threshold the larger the fvc was the lower the rpet value was for the same faw 4 1 2 determined relationship based on field data of ameriflux sites for quantification of the exponential soil moisture stress relationship between the rpet and the faw field data of 10 ameriflux sites were further used to calculate the rpet and the faw and the scatter plots and fitted exponential equations y a exp b x in which y indicates the rpet and x indicates the faw respectively were shown in fig 5 the regression coefficients a and b of each site were displayed in fig 6 it can be seen from fig 5 that these scatter plots between the rpet and the faw based on the data from these 10 ameriflux sites demonstrated obvious exponential pattern as well as for the fitted relationship equations rpet a exp b faw the coefficients a and b at different sites had certain differences but they were basically close to each other specifically among the 10 ameriflux sites the coefficient a varied from 0 06 to 0 22 with an average value of 0 137 and a standard deviation of 0 04 the coefficient b varied from 3 31 to 6 14 with an average value of 4 289 and a standard deviation of 0 897 it is worth noting that the fitting results of the soil moisture stress relationship between the rpet and the faw seemed better at the us aud site which was likely caused by the fact that at this site lower values of faw were less distributed while the relatively poor performance of the fitted relationships was mainly found under conditions of lower faw at other sites besides the relationship at the us aud site showed remarkable differences with those from other sites if the coefficients at this site were removed the average value of 0 13 for the coefficient a could be obtained with remaining sites with the average value of 4 08 for the coefficient b accordingly the exponential relationship rpet 0 13 exp 4 08 faw where the coefficients related to the us aud site were excluded was obtained and applied as the universal exponential soil moisture stress relationship between the rpet and the faw in the following sections for daily et reconstructions 4 2 validation of daily et reconstructions under cloudy sky based on the explored exponential relationship rpet 0 13 exp 4 08 faw between the rpet and the faw the proposed method in section 2 was utilized to reconstruct daily et based on totally field data from 10 ameriflux sites and the modis data and necessary field data from the yucheng site respectively 4 2 1 daily et reconstructions with total field data daily et were reconstructed with total field data from 10 ameriflux sites at first to avoid any deviation from remote sensing retrievals this section included two parts without judging whether the given day was clear or not in order to guarantee the number of days involved in the test and with judging the clear days to test the feasibility of the method under cloudy sky respectively in the first part the previous days with complete input data were regarded as clear sky and the corresponding next day following them were used as the cloudy sky and the daily et of these cloudy sky were reconstructed with proposed method in this process the explored universal soil moisture stress relationship between the rpet and the faw were applied at each site and the difference between soil water content and et on each given day was used as the available soil water for the next day regarded as cloudy sky fig 7 compares the reconstructed daily et and corresponding measurements table 3 displays the number of selected days n in the test and corresponding statistics of mean average error mae and root mean square error rmse related to the daily et reconstructions results from the comparison scatter plots indicated that the reconstructed daily ets of cloudy sky were basically consistent with the in situ measurements from ec flux tower combining the table 3 and fig 7 it could be found that the mae in the validation of reconstructed daily et under cloudy sky with in situ et measurements varied from 15 08 w m2 to 12 42 w m2 with mostly negative values indicating that daily et at most sites were underestimated the rmse in the validation varied between 12 72 w m2 and 39 09 w m2 revealing the high accuracy of the reconstruction method besides the number of selected days n was from 519 at the us fr2 site to 2448 at the us var site making sure that the quantity of cloudy sky was enough to convince the validation of our proposed method what calls for special attention was that daily et at the us aud site which was excluded in the determination of coefficients also had good consistencies with in situ daily et revealing the universality of these two coefficients in the explored soil moisture stress relationship to a certain degree in the second part of this section the real clear sky was selected based on the measured downward shortwave radiation data from 10 ameriflux sites in which the judgment method of clear sky was detailed in our previous study jiang et al 2019 the daily ets of the cloudy days following these clear days were reconstructed based on the explored exponential relationship between the rpet and the faw rpet 0 13 exp 4 08 faw the comparison between the reconstructed daily et and the in situ values is shown in fig 8 these scatter plots in fig 8 demonstrated that the number of test days had been significantly reduced after the selections of clear sky and the reconstructed daily ets under the cloudy sky based on the proposed method were still basically consistent with the in situ measurements the statistical mae and rmse related to the reconstruction results and the number of test days n are listed in table 4 combining the results in table 4 and fig 8 it could be seen that the mae in the validation of reconstructed daily ets against in situ measurements ranged from 12 20 w m2 to 16 77 w m2 the mae was a little larger than those without clear sky selections and the positive value at some sites meant that the daily et was overestimated further indicating that the underestimation when the clear sky days were not selected in the first part of this section was mainly from clear sky the rmse in the validation of reconstructed daily et under cloudy sky varied between 9 47 w m2 and 28 97 w m2 in which most of them 7 sites were less than 20 w m2 and comparative to those in the situation when clear sky was not selected comparing the results in fig 7 and fig 8 in which the same exponential relationship between the rpet and the faw was applied to each site to reconstruct daily et of the next days it was easy to find that whether clear sky days were selected or not the differences of the estimation error related to two situations were not obvious in other words this daily et reconstruction method was not only applicable to cloudy sky but also feasible to estimate daily et of every missing date if the necessary data in the previous day was available comparing the results in table 3 and table 4 one could find that the differences in the rmses of the validation at most sites were not obvious except for the us fr2 and us ib1 sites the exception may be caused by the fact that the number of remaining days at these two sites when the clear sky days were singled out was vastly less than those when the clear sky days were not singled out it should be noted that the day following the clear sky when the clear sky was selected was not all the cloudy sky in other words some of them may be clear day as well fortunately this setting would not affect the results 4 2 2 daily et reconstructions with remote sensing data in order to verify the universal applicability of the explored soil moisture stress relationship between the rpet and the faw from the 10 ameriflux sites the robustness of the proposed method for reconstructing daily et under cloudy sky and the feasibility of the reconstruction method based on remote sensing data modis data together with the necessary meteorological data at the yucheng site was selected to estimate the et on clear days and further to reconstruct daily et under cloudy sky the daily et estimated under clear sky agreed well with the in situ measurements with the mae and rmse of 5 03 w m2 and 18 60 w m2 respectively see fig 3 in our previous study jiang et al 2018 the soil moisture content of this site under clear sky days were calculated according to the eqs 2 and 3 in which the faw was obtained based on inverse function of the exponential relationship rpet 0 13 exp 4 08 faw together with the hydraulic parameters of the soil at this site using the exponential relationship rpet 0 13 exp 4 08 faw between the rpet and the faw explored from the 10 ameriflux sites the proposed reconstruction method was applied to estimate daily et under cloudy sky the next day adjacent to the clear day if there were two clear days adjacent to each other it would be a clear day and the estimated results were compared with in situ measurement which was corrected with bowen ratio method br method l e cor r n g le le h to correct the energy imbalance in fig 9 from the figure it was clear that the estimated daily et under cloudy conditions agreed well with the in situ measurements the estimation mae was 2 62 w m2 and the rmse was 35 21 w m2 the estimated deviation was similar to that in fig 7 in which the maximum rmse was 39 09 w m2 therefore the exponential relationship between the rpet and the faw explored using the field data from 10 ameriflux sites had a certain universality and the proposed method was feasible to reconstruct daily et under cloudy conditions with remote sensing data used for daily et retrieval under clear sky 4 3 discussions 4 3 1 main considerations of the reconstruction method for retrieval of temporally and spatially continuous et jackson et al 1983 sugita brutsaert 1991 zhang lemeur 1995 crago 1996 it is urgent and essential to reconstruct daily et under cloudy sky in this paper we proposed a practical and physical daily et reconstruction method constrained by the soil water budget balance in which the difference between soil water storage and et under clear sky was taken as the amount of soil water storage for the next day cloudy sky assuming that the loss of soil water in clear days was mainly due to the et process and other water loss was ignored the soil water storage was reflected by the soil available water fraction faw which was related to the potential et ratio rpet the ratio between actual et to potential et with the soil moisture stress relationship and this soil moisture stress relationship was assumed to be stable namely this relationship under clear sky was still applicable under cloudy sky the key of the proposed reconstruction method was to explore the soil moisture stress relationship between the rpet and the faw in fact a wide range of forms of this relationship have been reported in the literature abramopoulos et al 1988 including linear functions mahfouf noilhan 1991 piecewise linear or threshold models mahrt pan 1984 and non linear forms campbell norman 1998 with varying degrees of complexity and dependence on soil textural properties and vegetation type nevertheless no unifying form existed for this reason this relationship was explored in this study based on simulated data from the alex model and the coefficients were determined with the data from 10 ameriflux sites the soil water budget balance and involved soil moisture stress relationship between the rpet and the faw establishing a physical link between the clear sky and cloudy sky made daily et reconstruction under cloudy sky rational operable and relatively less sensitive to cloud cover the proposed method vastly differed from the interpolating extrapolating methods in most already presented works which established a link between the clear sky and cloudy sky in a purely mathematical way through interpolation and extrapolation of scaling factors to obtain daily et in fact the interpolation of scaling factor was only associated to the values of clear sky which did not reflect the condition of cloudy sky while the extrapolation process was seriously affected by cloudy cover referred to the accuracy of daily et estimation the results associated to interpolating extrapolating methods were considered too low up to 40 uncertainty of et guillevic et al 2019 with the maximum error reported reaching 66 w m2 in the study of alfieri et al 2017 who evaluated different interpolation techniques using in situ measurements collected over a variety of land cover types in this study the results from totally field data showed that the reconstructed daily et had a good agreement with in situ measurements with most of the rmse less than 30 w m2 based on modis and filed data the reconstructed daily ets were consistent with in situ values as well with an rmse of 35 21 w m2 in short our proposed method could behave as well as or even better than these interpolating extrapolating methods 4 3 2 advantages of the reconstruction method one advantage of this proposed reconstruction method was its capability of reconstructing daily et for multiple consecutive cloudy days with availability of relevant data from only a clear day in addition the reconstruction method was applicable not only in the cloudy sky but also on any days with missing data without precipitation if there were necessary data in the previous day before the date of interest which was proven by the good agreement between daily et estimations and in situ measurements without and with clear day selections these advantages were attributed to the act that the difference between the soil water storage and et in the previous day was taken as the soil water storage of the next day no matter how the weather was moreover the reconstruction method was simple and practical with less necessary inputs including the variables used for daily et retrieval under clear sky the variables for daily potential et calculation under cloudy sky and the hydraulic parameters of the soil the method was demonstrated to be feasible based on both the totally field data and remote sensing data over a wide range of soil vegetation and climate conditions at 10 ameriflux sites and one chinaflux site another major insight in this study was to deconvolute the respective impacts of remote sensing estimation by using in a first part totally field data from 10 ameriflux sites considering no error related to parameter retrieval and by using in a second part remote sensing estimates of et at the yucheng site in china which were subject to some estimation errors in remote sensing parameters since the errors in the remote sensing based et estimates propagate into the subsequent reconstruction of continuous series of daily et there may be a degradation of the retrieval quality 4 3 3 limitations of the reconstruction method of course there were some limitations of our reconstructed method and there still need some improvements it demands our attention that this method was not applicable for the instantaneous scale because the difference of instantaneous water content and et under completely clear day does not reflect instantaneous soil moisture storage at the second day and there will still be water loss in the subsequent moments in the clear day meanwhile the recharge of soil available water content in this method will not be considered until the day with precipitation in this method the precipitation would only be considered in the soil available water content in the first tested clear sky and would not be considered in soil moisture stress relationship which was assumed to be same in clear sky and cloudy sky besides although the explored relationship between the rpet and the faw was proven to be universal at both the 10 ameriflux sites and the yucheng site it was still empirical to some extent appropriate functions may also depend on the size of model pixel and sub pixel heterogeneity in soil conditions in future work it is urgent to further explore this relationship with more data or through other investigation because the accurate expression of this relationship was the prerequisite for the application of this reconstruction method to accurately estimate daily et under cloudy sky 5 conclusions in this paper we proposed a physical and practical method for reconstructing daily et under cloudy sky based on a running water budget balance using the soil moisture stress relationship between the potential evapotranspiration ratio rpet and the available water fraction faw the field data from 10 ameriflux sites were firstly chosen to explore this relationship and applied for reconstruction of daily et for avoiding the effect of error in remote sensing retrieval successively modis data and meteorological data from the yucheng site in china were used to estimate daily ets on clear days and reconstruct daily ets on cloudy days using the proposed method our proposed reconstruction method could be utilized to estimate daily et under cloud sky with good accuracy the verification results based on these 10 ameriflux sites showed that the reconstructed daily ets under cloudy sky agreed well with the in situ measurements with most of the rmse less than 30 w m2 the reconstructed daily et based on modis data at the yucheng site was also in good agreement with ec measurements with the rmse under cloudy sky of 35 21 w m2 the proposed method is promising in reconstructing daily et under cloudy sky and can be a good alternative to the interpolating extrapolating methods future work may focus on the further investigation of proposed method over a wider range of atmospheric soil and vegetation conditions credit authorship contribution statement yazhen jiang methodology software data curation ronglin tang conceptualization validation writing original draft zhao liang li visualization investigation supervision writing review editing declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgement we thank the ameriflux data resources https ameriflux lbl gov yucheng meteorological and flux data resources http chinaflux org and modis data https modis gsfc nasa gov data the work is supported by the national natural science foundation of china 42001306 41922009 42071332 the national key r d program of china 2018yfa0605401 
3704,statistical post processing has been widely employed to correct bias and dispersion errors in raw ensemble precipitation forecasts from numerical weather prediction models one prominent post processing scheme is to establish a joint probability model by fitting a bivariate distribution of raw forecasts and corresponding observations however current joint probability models only incorporate ensemble mean as the predictor and ensemble spread is not considered this is a major disadvantage of joint probability models as ensemble spread can be informative for forecast uncertainty in this paper we propose a two step calibration approach to combine the strengths of joint probability models and the useful information included in the ensemble spread in the first step we take the seasonally coherent calibration scc model as an example of joint probability models to calibrate the ensemble mean as scc for precipitation forecasts involves transformations for data normalization and special treatments of zero values we explore three different ways to estimate ensemble mean values when establishing the scc model in the second step we re calibrate the ensemble forecasts produced in the first step to incorporate ensemble spread information from the raw forecasts the performance of this two step calibration is evaluated using ensemble precipitation forecasts from the australian bureau of meteorology we find that forecasts calibrated using the two step calibration have better skills than scc calibrated forecasts especially for heavy precipitation events strengths of joint probability models and raw ensemble spread information are well utilized in the proposed two step calibration approach keywords numerical weather prediction ensemble precipitation forecasts statistical post processing joint probability model ensemble spread 1 introduction short term precipitation forecasting is routinely performed using numerical weather prediction nwp models in meteorological centers around the world harper et al 2007 these models are designed to simulate dynamic physics of the atmosphere forward in time to predict future weather conditions traditional deterministic nwp models produce single value forecasts hence cannot capture the chaotic nature of the atmosphere lorenz 1963 epstein 1969 to account for the uncertainty of weather forecasts ensemble prediction systems have been developed to generate multiple ensemble members from varying initial conditions or parametrizations of nwp models ehrendorfer 1997 buizza et al 1999 palmer et al 2007 the superiority of ensemble forecasts compared to deterministic forecasts has been widely demonstrated in the literature atger 2001 richardson 2000 rodwell 2006 vokoun and hanel 2018 zhao et al 2020 raw ensemble forecasts however often have bias gneiting et al 2007 li et al 2017 and dispersion errors buizza et al 2005 buizza 2018 it has therefore been a common practice to apply statistical post processing methods to improve raw forecasts verkade et al 2013 yang et al 2020 saminathan et al 2021 in this paper we focus on the post processing of univariate forecasts i e point by point post processing without considering the spatial temporal correlation in the forecasts a variety of post processing methods have been developed particularly the methods that are able to produce calibrated forecasts in the form of full predictive probability distributions are popular for forecast users brocker and smith 2008 such post processing methods allow the sampling of ensemble members of any desired size from well calibrated predictive distributions as well as the derivation of some frequently used prediction statistics such as forecast quantiles and probabilities of threshold exceedance two post processing schemes are commonly used to produce calibrated probability distributions the first scheme is based on distributional regressions such as ensemble model output statistics emos gneiting et al 2005 scheuerer 2014 baran and lerch 2015 ensemble dressing fortin et al 2006 bayesian model averaging bma raftery et al 2005 sloughter et al 2007 schmeits and kok 2010 and machine learning ml based regression methods dogulu et al 2015 this scheme typically makes use of statistics of raw ensemble forecasts usually ensemble mean and ensemble spread to establish probability distributions the second scheme is based on joint probability models such as the bayesian joint probability bjp model robertson et al 2013 shrestha et al 2015 cattoën et al 2020 li et al 2020b li et al 2020c and the meta gaussian distribution mgd model schaake et al 2007 krzysztofowicz and evans 2008 wu et al 2011 li et al 2019 joint probability models are often established by fitting a bivariate distribution of raw forecasts and corresponding observations conditional distributions of observations can be derived for calibration of new forecasts although joint probability models were originally designed to post process single value i e deterministic forecasts they can also be applied to post processing ensemble mean of ensemble forecasts a couple of advantages can be stated about joint probability models first they have been shown to be superior to distributional regression models when only ensemble mean is used as a predictor li et al 2019 one possible reason is that regression relationship in distributional regressions becomes weak when raw precipitation forecasts approach zero gebetsberger et al 2017 second because joint probability models take only the ensemble mean as the model predictor they allow more flexibility in mathematical treatment to incorporate other complexities for example the seasonally coherent calibration scc model wang et al 2019b yang et al 2021a zhao et al 2020 based on the joint probability scheme has been developed to produce calibrated forecasts that are coherent in climatology including seasonality consistent with long term observations even when archived nwp forecasts are limited nevertheless there is a major disadvantage of joint probability models none of the current joint probability models have incorporated the ensemble spread which is commonly assumed to be correlated with forecast uncertainty information toth et al 2001 scherrer et al 2004 grimit and mass 2007 hopson 2014 by contrast many distributional regression models have gained additional forecast skills due to the incorporation of ensemble spread veenhuis 2013 messner et al 2014b scheuerer and hamill 2015 in this context it will be highly valuable to explore a way to enable joint probability models to incorporate the ensemble spread in this paper we develop a two step calibration approach to integrate the additional forecast information included in the ensemble spread into joint probability models for demonstration purposes we employ the scc model as an example of joint probability models and select precipitation as our target weather variable in the first step we apply scc to calibrate ensemble mean of precipitation forecasts as scc for precipitation forecasts involves transformations for data normalization and special treatments of zero values we explore a number of ways to estimate ensemble mean values when establishing the scc model in the second step we re calibrate the scc calibrated forecasts from the first step to make use of raw ensemble spread information with such an approach the use of ensemble mean and ensemble spread is separated into two steps allowing the scc model to be deployed in its original form i e taking ensemble mean as the only predictor the rest of this paper is organized as follows section 2 describes the nwp ensemble precipitation forecasts observed data and geographic area used for this study section 3 presents how we develop the two step calibration approach with scc and introduces evaluation metrics section 4 illustrates forecast verification results section 5 discusses advantages and possible limitations of the two step calibration approach finally main conclusions are presented in section 6 2 data observed daily precipitation data are obtained from the australian water availability project s climate datasets awap jones et al 2009 with a high spatial resolution 0 05 x 0 05 gridded awap data are obtained by interpolating rain gauge observations which are collected from 0900 h of the previous day to 0900 h of the current day according to australian local time including daylight saving observations for a period of 30 years from 1 august 1989 to 31 july 2019 are used as reference data for scc model establishments and for forecast evaluations we select ensemble precipitation forecasts from the australian community climate and earth system simulator global ensemble 2 access ge2 nwp model for forecast calibration access ge2 is based on the met office global and regional ensemble prediction system mogreps naughton 2016 and has a horizontal grid spacing of approximately 60 km each access ge2 ensemble consists of 24 exchangeable members that result from multiple stochastic disturbances to both model physics and initial conditions of the access ge2 model ensemble forecasts are issued at 1200 utc on a daily basis for lead times up to 10 days and are available at a 3 hourly temporal resolution access ge2 forecasts of a 3 year period from 1 august 2016 to 31 july 2019 are selected for this study to match the forecasts with observed data we modify the spatial and temporal resolutions of access ge2 data according to the awap data we apply bilinear interpolation to re grid the access ge2 forecasts to the spatial resolution of awap and we aggregate the 3 hourly precipitation forecasts to daily values according to the awap records because awap data are produced based on australian local time which has utc offsets we adjust the matching hours of access ge2 and awap and finally obtain daily ensemble precipitation forecasts for 9 days ahead for a comprehensive forecast evaluation we select 20 sites across a variety of climates in australia as shown in fig 1 the average annual precipitation is calculated based on the 30 years of awap data 3 methods in this section we first introduce the formulation of the scc modelling method we then demonstrate how we develop the two step calibration approach with scc for the first step three scc variants are derived based on different ways to estimate ensemble mean values scc1 and scc2 are established by calculating ensemble mean before and after data transformations respectively and scc3 is established with a proposed data augmentation approach for handling near zero values of ensemble precipitation data for the second step a re calibration rc method is developed to further calibrate the scc calibrated forecasts using raw ensemble spread information details of the two step calibration approach are illustrated in fig 2 finally we introduce verification methods used for forecast evaluation 3 1 scc model formulation 3 1 1 log sinh transformations and a joint probability model the seasonally coherent calibration scc model was developed based on the joint probability distribution to produce calibrated forecasts that are coherent in climatology including seasonality consistent with long term observations even when archived nwp forecasts are limited wang et al 2019b when used to post process precipitation forecasts raw forecasts and observations need to be normalized before a bivariate normal distribution is applied as precipitation data are highly skewed in this study we employ log sinh transformations wang et al 2012 bennett et al 2014 for normalizing raw precipitation forecasts x t t 1 2 t where t is the total number of days in the 3 year period and corresponding observations y t to f t and o t respectively the transformed variables f t and o t are then assumed to follow a bivariate normal distribution 1 f t o t bn u f m t u o m t σ f m t 2 ρ m t σ f m t σ o m t ρ m t σ f m t σ o m t σ o m t 2 where m t denotes the month for day t namely m t 1 2 12 u f m t and σ f m t are the mean and standard deviation of the marginal distribution of f t and u o m t and σ o m t for o t and ρ m t is the correlation between f t and o t because the bivariate normal distribution applies to continuous variables a censoring technique is used to treat near zero precipitation as censored data the term censored means these data are treated as below certain thresholds but are not precisely specified wang and robertson 2011 messner et al 2014a scheuerer and hamill 2015 zhao et al 2015 stauffer et al 2017 two thresholds x c and y c are applied here for x t and y t with corresponding thresholds f c and o c for better fitting f t and o t in their corresponding marginal distributions wang and robertson 2011 here x c and y c are set to 0 01 and 0 2 mm day reflecting the precision of available forecasts and observed data respectively according to robertson et al 2013 3 1 2 reparameterization of the joint probability model post processing models generally require long term statistical characteristics of both forecasts and corresponding observations in order to produce forecasts that are coherent with the climatology of observations zhao et al 2017 however although a long record of observations is often accessible the archived record of forecasts is commonly short as nwp models are frequently updated in this context the scc model was developed to work with limited nwp data to produce coherent calibrated forecasts this significant advantage of the scc model is achieved through the following two procedures first a climatology that is representative of long term statistical characteristics of observations is brought into the scc model in this study we use 30 years of observed data to estimate the marginal distribution parameters of observations namely the mean u o m t and standard deviation σ o m t for each month second a reparameterization of the joint probability model is conducted to estimate u f m t σ f m t and ρ m t for each month 2 u f m t a b u o m t 3 σ f m t c d σ o m t 4 ρ m t r where b c d 0 and 0 r 1 and these 4 parameters are constrained to avoid nonsensical relationships it should be noted that a can be either positive or negative as u f m t can be positive or negative in the log sinh transformed space equations 2 and 3 assume that nwp models if run long enough can produce the seasonality pattern that is linearly related with the observed climatology equation 4 assumes that the underlying forecast skill of nwp models is constant for all 12 months these assumptions are supported by a case study from wang et al 2019b and may help reduce sampling effects of forecast evaluation results the reparameterization of the joint probability model replaces 36 parameters u f m t σ f m t and ρ m t m t 1 2 12 with five parameters a b c d and r therefore making it feasible to estimate model parameters from a short period of archived nwp forecasts all of the parameters from the above two procedures can be derived using the method of maximum likelihood and the nelder mead searching approach nelder and mead 1965 related likelihood functions are given in wang et al 2019b 3 1 3 calibration of new forecasts after obtaining all the parameters of the scc model we can apply scc to calibrate new forecasts given a new forecast x t a conditional distribution of o t can be derived based on f t 5 o t f t n o t u o t σ o 2 t where 6 u o t u o m t ρ m t σ o m t σ f m t f t u f m t 7 σ o 2 t 1 ρ 2 m t σ o 2 m t we sample an ensemble of values from the conditional distribution to represent the forecast probability distribution when f t f c an ensemble o t n n 1 2 n of any size n 100 for this study can be sampled from the conditional distribution when f t f c a random value f t from the marginal distribution n f t u f m t σ f 2 m t is first sampled in the range of f c then a sample can be drawn from the conditional distribution o t f t to give an ensemble member these two steps are repeated n times to form the ensemble o t n finally the sampled ensemble members o t n can be transformed back by an inverse of the log sinh transformation to give a calibrated ensemble forecast y t n in original scale when there are negative ensemble members in y t n we set them to zero 3 2 the proposed two step calibration approach 3 2 1 step one calibration of ensemble mean using scc the scc model described above was originally developed to calibrate deterministic forecasts when it comes to ensemble forecasts ensemble mean can be calculated to provide the deterministic value as scc for precipitation forecasts involves data transformations and the censoring setup for near zero precipitation values there are different ways to obtain the ensemble mean here we establish three scc models each corresponding to a particular way of estimating the ensemble mean values the three models are named scc1 scc2 and scc3 for our study the scc1 model is established by calculating ensemble mean before data transformations denoting raw ensemble forecasts as x t k k 1 2 k where k is the ensemble size 24 for access ge2 ensembles we calculate the ensemble mean prior to the data transformations as in previous studies scheuerer and hamill 2015 li et al 2019 8 x m t 1 k k 1 k x t k then x m t can replace the aforementioned x t as the raw precipitation forecast series to establish the scc1 model the rest of the setup of the scc1 model follows the same process as the original scc model the scc2 model is established by calculating ensemble mean after data transformations we transform x t k with the log sinh transformation to get f t k k 1 2 k the transformation involves all of the ensemble members without any censoring we can calculate the ensemble mean as below 9 f m t 1 k k 1 k f t k then f m t can replace the aforementioned f t equations 1 5 and 6 as the transformed forecast series to establish the scc2 model likewise the rest of the scc2 model setup remains the same the scc3 model is established with a proposed data augmentation approach for censored ensemble forecasts the ensemble mean calculation becomes problematic when an ensemble contains censored ensemble members because these members are only known to be below or equal to the censoring threshold x c or f c it would be sensible to assign exact values to these censored data for calculating the ensemble mean here we propose a hierarchical model to simulate distributions of transformed ensemble forecasts for any ensemble f t k k 1 2 k ensemble members are assumed to follow a normal distribution 10 f t k n f u t σ 2 where f u t t 1 2 t and σ are the mean and standard deviation of the normal distribution respectively for each ensemble f u t is a latent variable and needs to be inferred from another normal distribution 11 f u t n u u σ u 2 where u u and σ u are the mean and standard deviation of the normal distribution respectively to infer the parameters σ u u and σ u the latent variable f u t and censored ensemble members we apply gibbs sampling gelfand 2000 to iteratively sample these variables from their corresponding conditional distributions until the hierarchical model reaches a statistically steady condition conditional distributions of these parameters and variables can be derived from the following likelihood function l 12 l t 1 t k 1 k n f t k f u t σ 2 n f u t u u σ u 2 for example in any sampling iteration given f u t and σ if there are censored members in an ensemble we can draw random samples from the conditional distribution n f t k f u t σ 2 in the range of f c to give the augmented values after the augmentation of censored ensemble members we obtain a new series of ensemble forecasts f t k k 1 2 k then the ensemble mean can be calculated as below 13 f m t 1 k k 1 k f t k similarly f m t can be used to replace the aforementioned f t equations 1 5 and 6 to establish the scc3 model 3 2 2 step two re calibration of scc calibrated forecasts using ensemble spread to maximise forecast skills from post processing raw ensemble forecasts ensemble spread should also be incorporated into post processing models we select scc3 out of the three scc models established in the first step to demonstrate the re calibration rc method given that scc3 is the most sophisticated in a sensible way and might perform best in the post processing we refer this integrated model as scc3 rc in this study generally ensemble spread is represented using the standard deviation among ensemble members raw ensemble standard deviation σ raw t and scc3 calibrated ensemble standard deviation σ cali t in transformed space can be calculated as 14 σ raw t 1 k 1 k 1 k f t k f m t 2 15 σ cali t 1 n 1 n 1 n o t n o m t 2 where 16 o m t 1 n n 1 n o t n is the ensemble mean of scc3 calibrated ensemble o t n n 1 2 n rc is formulated to adjust each ensemble member of o t n individually 17 o rc t n λ 1 o m t o t n o m t λ 2 λ 3 σ raw t σ cali t where o rc t n is the re calibrated ensemble member λ 1 λ 2 and λ 3 are the rc parameters specifically λ 1 represents the modification of the calibrated ensemble mean o m t λ 2 and λ 3 represent the contribution weights of σ cali t and σ raw t respectively a larger λ 3 would indicate that more ensemble spread information from the raw forecasts is utilized rc is only applied to calibrated ensemble forecasts whose corresponding raw ensemble mean f m t is larger than f c this is because their raw ensemble spread is relatively more trustworthy than those calculated mostly based on augmented ensemble members we use a continuous ranked probability score crps minimization method gneiting et al 2005 van schaeybroeck and vannitsem 2015 to optimize λ 1 λ 2 and λ 3 details of the crps are shown in section 3 3 after obtaining the rc parameters we can re calibrate scc3 calibrated ensemble members and then transform the re calibrated ensemble members back to the original scale using the inverse of the log sinh transformation the rc step is essentially an ensemble adjustment of forecast members it has some similarity to the method of member by member post processing mbmp johnson and bowler 2009 schefzik 2017 this point will be further discussed later in the discussion section 3 3 forecast evaluation in this study the performances of the scc1 scc2 scc3 and scc3 rc models are evaluated using a leave one month out cross validation evaluation diagnositics include bias crps hersbach 2000 threshold weighted crps twcrps gneiting and ranjan 2011 and reliability diagram wilks 2011 to assess different aspects of forecast quality bias is the difference between the mean of precipitation forecasts and the mean of corresponding observations 18 bias 1 t t 1 t x t 1 t t 1 t y t where x t and y t are forecasts and observed values at time t respectively and t is the length of forecast data records it is important to have minimal bias in precipitation forecasts as bias can be amplified in streamflow forecasting and in other water resource management crps quantifies the difference between ensemble forecast cumulative distribution and corresponding observations hersbach 2000 the average crps for days t 1 2 t is formulated as 19 crps 1 t t 1 t f t x h x y t 2 d x where f t x is the forecast cumulative density function cdf and y t is the observation at time t h is the heaviside step function that equals 1 if x y t 0 and equals 0 otherwise and t is the length of data records we also calculate the crps of reference climatology forecasts crps ref using the leave one month out cross validated climatology ensemble forecasts that are generated from the scc models a crps skill score can then be calculated as 20 crps skill score crps ref c r p s crps ref 100 the crps skill score is positively oriented and represents the relative improvement of the calibrated forecasts compared to the referenced climatology forecasts a maximum skill score of 100 indicates that forecasts perfectly match the corresponding observations and a skill score of 0 indicates that forecasts have comparable errors to the reference forecasts forecasts poorer than reference forecasts have negative skill scores note that the reference climatology forecasts are common to all the scc models and therefore crps skill scores achieved by the different models can be directly compared with each other we further use twcrps gneiting and ranjan 2011 to evaluate the model performance on predicting heavy precipitation events i e precipitation amount above a certain threshold the average twcrps for days t 1 2 t is formulated as 21 twcrps 1 t t 1 t f t x h x y t 2 ω x d x where ω x is a weight function that equals 1 if x q and equals 0 otherwise and q is a given threshold with precipitation above q marked as heavy precipitation events in this study q is set to the 95 quantile of observed values similarly we use twcrps skill score to demonstrate the improvement of calibrated forecasts relative to reference forecasts in addition we apply the reliability diagram as a graphical tool to evaluate the reliability of ensemble forecast uncertainty ensemble spread not too narrow or too wide reliability refers to the statistical consistency between ensemble forecasts and corresponding observations a reliability diagram illustrates forecast reliability by plotting observed frequencies against predicted probabilities based on a threshold exceedance for ensemble forecasts in this study we use 0 2 mm day and 95 quantile of observed values as two thresholds for constructing the diagrams precipitation values exceeding 0 2 mm day and the 95 quantile of observations represent the occurrence of light precipitation and the occurrence of heavy precipitation respectively resulting plots in reliability diagrams close to the 1 1 line indicate good reliability while deviation from the line indicates poor reliability perfectly reliable forecasts will show a plot overlapping with the 1 1 line 4 results 4 1 overall forecast evaluation of bias and crps skill score results of bias and crps skill score for raw ensemble forecasts and calibrated forecasts from the scc1 scc2 scc3 and scc3 rc models are shown in fig 3 it can be seen from the figure that raw ensemble forecasts overall perform worst in terms of bias and crps skill score among these forecasts the scc models greatly improve the raw ensemble forecasts with most of the bias being closer to zero and much greater crps skill scores being achieved especially at short lead times while there are many negative crps skill scores in raw ensemble forecasts only a few negative skill scores are shown in the calibrated forecasts bias has no clear trend over the lead time while crps skill score tends to decrease gradually as the lead time increases indicating lower skills of forecasts at longer lead times besides scc2 scc3 and scc3 rc have overall better performance than scc1 on bias however it is quite hard to distinguish these four models according to their crps skill scores at the scale shown in fig 3 to further learn about the contributions of the ensemble mean calculations after data transformations the data augmentation and the re calibration for incorporating raw ensemble spread information we look more closely at the crps skill score of each of the models for each site and each lead time in the following two subsections 4 2 crps skill scores of calibrated forecasts from the three scc variants results of crps skill score for calibrated forecasts from the scc1 model is shown in fig 4 a similar to the results discussed in section 4 1 crps skill score of the scc1 calibrated forecasts is negative just at a few sites and only at some lead times indicating the evident benefits of the scc post processing results on crps skill score improvements of scc2 and scc3 over scc1 are shown in fig 4 b and 4 c and further summarised in table 1 as quantitative forecasts of precipitation for a particular location and lead time is highly challenging even a 1 skill score improvement is often considered a meaningful gain for newly implemented nwp models or post processing methods messner et al 2014b scheuerer and hamill 2015 for either the scc2 or scc3 model the crps skill score difference from the scc1 model varies with sites and lead times the overall difference tends to be positive indicating improvements over scc1 calculating ensemble mean after transformations i e the scc2 model improves the crps skill score compared to calculating ensemble mean before transformations i e the scc1 model especially for sites 2 13 17 and 20 although there are sites with reduced skill scores such as sites 3 4 and 12 in addition the data augmentation for censored ensemble members in the scc3 model further improves the crps skill score of scc2 calibrated forecasts the most greatly improved site is site 14 as shown in table 1 on the basis of the skill score improvement of scc2 compared to scc1 the scc3 model further increases the number of improved cases and the total accumulated average improved skill score of scc3 compared to scc1 reaches 1 13 4 3 crps skill scores of calibrated forecasts from the two step calibration results of crps skill score for scc3 rc calibrated forecasts are shown in fig 5 and table 1 scc3 rc calibrated forecasts have positive crps skill scores at all sites and lead times fig 5 a this assures that the calibrated forecasts are more skillful than the referenced climatology forecasts in all cases compared to scc1 the accumulated average crps skill score improvement of scc3 rc reaches 1 68 which is quite prominent considering all the sites and lead times we also compare the forecast performance of scc3 rc and scc3 to learn how the incorporated raw ensemble spread information in the re calibration influences the model performance as shown in table 1 the re calibration method improves the skill score of 129 cases with improved skill scores mainly at short lead times and mostly within 4 fig 5 c the average skill score improvement due to raw ensemble spread utilization is 0 55 which is comparable to previous studies on distributional regression based post processing models messner et al 2014b scheuerer and hamill 2015 this indicates that the re calibration method can make scc calibrated ensemble forecasts more skillful by using raw ensemble spread information however it should be noted that there are also reductions in the skill score at some sites such as sites 2 17 and 19 fig 5 c 4 4 twcrps skill scores of calibrated forecasts from the three scc variants we further evaluate the ability of the calibration models in predicting heavy precipitation events which are crucial for some common hydrological applications such as irrigation and flood forecasting the twcrps skill score for calibrated forecasts from the scc1 model is shown in fig 6 a clearly scc1 calibrated forecasts have more negative values of the twcrps skill score compared to the crps skill score fig 4 a this highlights again the challenge of forecast post processing for predicting heavy precipitation events as previously identified in the literature taillardat et al 2019 li et al 2020a results on the improvements in the twcrps skill score of scc2 and scc3 over scc1 are shown in fig 6 b and 6 c and further summarised into table 2 both scc2 and scc3 have overall higher twcrps skill score than scc1 and the improvements are larger than those in the crps skill score table 1 this shows that scc2 and scc3 overall perform better than scc1 for predicting heavy precipitation events also it is worth noting that there are still reduced twcrps skill scores at several sites fig 6 b and 6 c 4 5 twcrps skill scores of calibrated forecasts from the two step calibration the twcrps skill scores of scc3 rc calibrated forecasts are shown in fig 7 and table 2 scc3 rc greatly improves scc1 in terms of the twcrps skill score with the average improvement exceeding 3 which is almost twice as much as the average crps skill score improvement table 1 besides scc3 rc also has higher twcrps skill score than scc3 with the average improvement close to 1 the two step calibration is shown to gain considerable twcrps skill score improvements although there are slightly degraded skill scores at some sites fig 7 b and 7 c together with results presented in sections 4 2 4 4 it can be concluded that on the average of the 20 sites and 9 lead times in the order of scc1 scc2 scc3 and scc3 rc both crps skill score and twcrps skill score tend to increase successively indicating gradual improvements besides the improvements on twcrps skill score have higher magnitudes than those on crps skill score tables 1 and 2 meaning that the latter three models especially scc3 rc are far more capable of predicting heavy precipitation events than the scc1 model on average to further demonstrate the significance level of the advantages of scc2 scc3 and scc3 rc over scc1 we carry out a strict statistical significance testing with bootstrapping on the crps twcrps skill score results of forecasts calibrated using these models according to the testing results shown in table a1 the crps skill score difference between any two models is not statistically significant however the twcrps skill score difference between scc3 rc and scc1 is found to be significant this further confirms the superiority of the scc3 rc model on producing more skillful calibrated forecasts for heavy precipitation events than scc1 besides it should also be noted that the differences in the crps twcrps skill score obtained from scc3 rc and scc3 are not statistically significant although the improvement of scc3 rc compared to scc3 is shown to be overall considerable details of the statistical testing and interpretation can be found in appendix a 4 6 reliability diagrams of calibrated forecasts from different models the reliability diagrams of calibrated forecasts from scc1 scc2 scc3 and scc3 rc as well as raw ensemble forecasts are shown in fig 8 as can be seen from the figure that all of the calibrated forecasts clearly show better reliability than raw ensemble forecasts for the two thresholds selected i e 0 2 mm day and the 95 quantile of observed values for the occurrence of light precipitation events scc2 and scc3 have poorer reliability performance than scc1 while scc3 rc has slightly better reliability than scc1 fig 8 a for the occurrence of heavy precipitation events scc2 scc3 and scc3 rc have similar reliability performance and all of them perform better than scc1 fig 8 b 5 discussion the calculation of ensemble mean and ensemble spread with censored ensemble members is problematic as there are no exact values for these members in transformed space one feasible solution is to augment exact values for censored data many mathematical methods have been developed for the augmentation of datasets with censored records cohen 1961 hornung and reed 1990 perkins et al 1990 these methods are generally developed based on the maximum likelihood estimation to augment values for one single dataset however when applied to multiple datasets which are a series of ensembles in our study augmenting values for each ensemble individually cannot take into consideration the relationship among different ensembles given that ensemble members from all ensembles are transformed using the same set of parameters in the data normalization process besides these methods might become problematic when most or even all of the ensemble members are censored by contrast the data augmentation algorithm we propose in this study can connect all ensembles by establishing a hierarchical model and ensembles even with a large proportion of censored members can still be augmented in a sensible way these advantages make our algorithm more appropriate for the data augmentation of censored ensemble weather forecasts the re calibration method employed in our study is similar to member by member post processing mbmp methods johnson and bowler 2009 van schaeybroeck and vannitsem 2015 schefzik 2017 which post processes raw ensemble forecasts by adjusting ensemble members individually these mbmp methods are often implemented by minimizing objective scoring functions e g crps of the adjusted ensemble forecasts they can make use of raw ensemble spread information but are generally not sophisticated enough to reflect statistical forecast uncertainty derived from historical weather events in this context the re calibration is developed based on mbmp methods to further post process the scc calibrated forecasts using raw ensemble spread information forecasts calibrated using the two step calibration can reflect both the dynamically flow dependent ensemble spread from raw ensemble forecasts and the scc calibrated ensemble spread that contains statistically generated uncertainty information accurate and reliable ensemble forecasts for heavy precipitation events are crucial for hydrological forecasting and have attracted much attention from the post processing perspective it is therefore valuable to evaluate the performance of post processing models over heavy precipitation events however the restriction of routine forecast evaluations to only observed heavy events often has bias effects and may degrade even the most skillful forecasts available diks et al 2011 gneiting and ranjan 2011 this is also referred to as the forecaster s dilemma in lerch et al 2017 in this study we apply the twcrps to evaluate calibrated ensemble forecasts with emphasis on heavy precipitation events as a proper weighted scoring rule the twcrps metric takes into consideration all precipitation events while evaluating the forecast distribution tails it avoids possible bias due to the stratified sampling conditioned on observations and therefore provides a remedy for the dilemma in this study the three scc variants differ in how we calculate the ensemble mean for the scc post processing indeed a number of studies take ensemble mean as a summarized statistic in operational ensemble forecasting as well as post processing as ensemble mean generally has smaller errors than any individual ensemble member when averaged over many cases scheuerer and hamill 2015 wang et al 2019a however it has also been recognized that in complex spatial fields ensemble mean can sometimes smear out some important features by decreasing high amplitudes and increasing the spatial coverage of low values especially for ensemble forecasts with extreme events ebert 2001 surcel et al 2014 some approaches such as the probability matching pm method ebert 2001 clark 2017 have been developed to solve this issue by modifying the ensemble mean in some statistical ways therefore a simple ensemble mean as implemented in scc1 may not be the most appropriate representation of ensemble forecasts for the scc post processing further experiments are needed in the future to investigate if the other two ensemble mean calculation approaches as implemented in scc2 and scc3 can help alleviate the smearing effect we acknowledge that our study is only conducted based on ensemble forecasts on a daily basis and with a grid spacing of about 60 km as temporally and spatially high resolution weather forecasts have attracted great attention recently whether the developed models in this study are applicable to for example hourly nwp forecasts with a finer grid spacing needs to be further investigated besides establishing calibration models for precipitation is widely known to be more challenging than other weather variables indeed as a highly sophisticated model compared to traditional joint probability models scc has also been shown to be applicable to other variables yang et al 2021b in view of the forecast improvements in our study we therefore anticipate our models to be robust for application to other joint probability models and to post processing other weather variables 6 summary and conclusions in this study we aim to integrate the ensemble spread into joint probability models a two step calibration approach is developed for ensemble precipitation forecasts with the seasonally coherent calibration scc model as an example of joint probability models in the first step we employ the scc model to calibrate ensemble mean in the second step we re calibrate the scc calibrated forecasts to incorporate the ensemble spread information as scc for precipitation forecasts involves transformations for data normalization and special treatments of zero values we investigate three different ways to estimate ensemble mean values when establishing the scc model in the first step we find that calculating ensemble mean after transformations overall performs better than that before transformations for scc we therefore recommend ensemble mean to be calculated in transformed space when post processing ensemble precipitation forecasts in addition we propose a data augmentation algorithm to estimate ensemble mean and ensemble spread for use in the second step to handle zero precipitation values the resulting ensemble mean values are shown to lead to even better forecast calibration for the second step i e the re calibration we develop an ensemble adjustment method to adjust the scc calibrated ensemble members individually using raw ensemble spread information the additional forecast information extracted by the re calibration leads to forecast skill increase comparable to that achieved in past studies of using raw ensemble spread information this means that the two step approach is able to utilize the ensemble spread information of raw ensemble precipitation forecasts while preserving the strengths of the scc model the two step calibration approach namely scc3 rc in our study has been found to fairly improve the performance of the original scc in terms of the bias forecast skill and forecast reliability the improvement is especially notable for heavy precipitation events it is expected that the two step calibration approach can be adapted for other joint probability models and for post processing other weather variables data availability statement data used in this study are produced by the australian bureau of meteorology and accessed via the national computational infrastructure system please contact the bureau of meteorology to request data access credit authorship contribution statement pengcheng zhao methodology validation formal analysis writing original draft quan j wang conceptualization methodology supervision writing review editing wenyan wu resources supervision writing review editing qichun yang data curation supervision writing review editing declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgements this work is supported by an australian research council linkage project grant no lp170100922 and a collaborative project grant no tp707466 between the university of melbourne and australian bureau of meteorology the co author wenyan wu acknowledges the support of the australian research council via the discovery early career researcher award de210100117 we would like to thank the australian bureau of meteorology for supplying the access ge2 and awap data we also thank the national computational infrastructure for providing assess to computation resources to support our work we gratefully acknowledge the two reviewers for their thorough reviews and constructive comments appendix a statistical significance testing of two samples with bootstrapping we employ the algorithm in efron and tibshirani 1994 to implement the statistical significance testing between two samples in our study assuming that the crps twcrps skill score values of forecasts calibrated by two different models are samples x x 1 x 2 x n and y y 1 y 2 y n the sample size n of both samples will be 180 20 sites and 9 lead times in total steps of the significance testing with bootstrapping are as follows 1 calculate the test statistic t for x and y a1 t x m y m σ x 2 n σ y 2 n where x m and σ x are the mean and standard deviation of sample x and y m and σ y for sample y 2 calculate the mean xy m of the combined sample of x and y a2 xy m x m y m 2 3 construct two new samples x x 1 x 2 x n and y y 1 y 2 y n a3 x i x i x m xy m i 1 2 n a4 y i y i y m xy m i 1 2 n 4 apply bootstrapping to draw two random samples x and y of size n from x and y respectively 5 calculate the test statistic t for x and y a5 t x m y m σ x 2 n σ y 2 n where x m and σ x are the mean and standard deviation of sample x and y m and σ y for sample y 6 repeat step 4 and step 5 k i e a large value times to obtain k t values 7 count the number of t values that are equal to or greater than t as n 8 estimate the p value a6 p n k the null hypothesis of the significance testing is that x and y are from a distribution with the same mean and the alternative hypothesis is that they are not the null hypothesis will be rejected at significance level α if a7 p α in this study we first choose the most often used α value 0 05 as the significance level and choose k 100000 to keep the sampling errors as small as possible for crps twcrps skill score results we implement 4 significance tests between scc2 and scc1 scc3 and scc1 scc3 rc and scc1 and scc3 rc and scc3 respectively however conducting multiple statistical tests simultaneously often comes with the problem of multiple comparisons miller 1981 to counteract this problem we employ the bonferroni correction haynes 2013 which is the most conservative multiple testing correction method to give the strictest significance level a8 α α m where m is the number of significance tests and is 4 in this study α is therefore calculated as 0 0125 results of the significance testing on crps twcrps skill scores are shown in table a1 the twcrps skill score comparison between scc3 rc and scc1 has a p value smaller than 0 0125 in this case we can reject the null hypothesis and conclude that the twcrps skill score difference between these two models is statistically significant even with the strictest significance level for the rest cases we cannot reject the null hypothesis so there is not enough evidence to suggest that the crps twcrps skill score difference is significant 
3704,statistical post processing has been widely employed to correct bias and dispersion errors in raw ensemble precipitation forecasts from numerical weather prediction models one prominent post processing scheme is to establish a joint probability model by fitting a bivariate distribution of raw forecasts and corresponding observations however current joint probability models only incorporate ensemble mean as the predictor and ensemble spread is not considered this is a major disadvantage of joint probability models as ensemble spread can be informative for forecast uncertainty in this paper we propose a two step calibration approach to combine the strengths of joint probability models and the useful information included in the ensemble spread in the first step we take the seasonally coherent calibration scc model as an example of joint probability models to calibrate the ensemble mean as scc for precipitation forecasts involves transformations for data normalization and special treatments of zero values we explore three different ways to estimate ensemble mean values when establishing the scc model in the second step we re calibrate the ensemble forecasts produced in the first step to incorporate ensemble spread information from the raw forecasts the performance of this two step calibration is evaluated using ensemble precipitation forecasts from the australian bureau of meteorology we find that forecasts calibrated using the two step calibration have better skills than scc calibrated forecasts especially for heavy precipitation events strengths of joint probability models and raw ensemble spread information are well utilized in the proposed two step calibration approach keywords numerical weather prediction ensemble precipitation forecasts statistical post processing joint probability model ensemble spread 1 introduction short term precipitation forecasting is routinely performed using numerical weather prediction nwp models in meteorological centers around the world harper et al 2007 these models are designed to simulate dynamic physics of the atmosphere forward in time to predict future weather conditions traditional deterministic nwp models produce single value forecasts hence cannot capture the chaotic nature of the atmosphere lorenz 1963 epstein 1969 to account for the uncertainty of weather forecasts ensemble prediction systems have been developed to generate multiple ensemble members from varying initial conditions or parametrizations of nwp models ehrendorfer 1997 buizza et al 1999 palmer et al 2007 the superiority of ensemble forecasts compared to deterministic forecasts has been widely demonstrated in the literature atger 2001 richardson 2000 rodwell 2006 vokoun and hanel 2018 zhao et al 2020 raw ensemble forecasts however often have bias gneiting et al 2007 li et al 2017 and dispersion errors buizza et al 2005 buizza 2018 it has therefore been a common practice to apply statistical post processing methods to improve raw forecasts verkade et al 2013 yang et al 2020 saminathan et al 2021 in this paper we focus on the post processing of univariate forecasts i e point by point post processing without considering the spatial temporal correlation in the forecasts a variety of post processing methods have been developed particularly the methods that are able to produce calibrated forecasts in the form of full predictive probability distributions are popular for forecast users brocker and smith 2008 such post processing methods allow the sampling of ensemble members of any desired size from well calibrated predictive distributions as well as the derivation of some frequently used prediction statistics such as forecast quantiles and probabilities of threshold exceedance two post processing schemes are commonly used to produce calibrated probability distributions the first scheme is based on distributional regressions such as ensemble model output statistics emos gneiting et al 2005 scheuerer 2014 baran and lerch 2015 ensemble dressing fortin et al 2006 bayesian model averaging bma raftery et al 2005 sloughter et al 2007 schmeits and kok 2010 and machine learning ml based regression methods dogulu et al 2015 this scheme typically makes use of statistics of raw ensemble forecasts usually ensemble mean and ensemble spread to establish probability distributions the second scheme is based on joint probability models such as the bayesian joint probability bjp model robertson et al 2013 shrestha et al 2015 cattoën et al 2020 li et al 2020b li et al 2020c and the meta gaussian distribution mgd model schaake et al 2007 krzysztofowicz and evans 2008 wu et al 2011 li et al 2019 joint probability models are often established by fitting a bivariate distribution of raw forecasts and corresponding observations conditional distributions of observations can be derived for calibration of new forecasts although joint probability models were originally designed to post process single value i e deterministic forecasts they can also be applied to post processing ensemble mean of ensemble forecasts a couple of advantages can be stated about joint probability models first they have been shown to be superior to distributional regression models when only ensemble mean is used as a predictor li et al 2019 one possible reason is that regression relationship in distributional regressions becomes weak when raw precipitation forecasts approach zero gebetsberger et al 2017 second because joint probability models take only the ensemble mean as the model predictor they allow more flexibility in mathematical treatment to incorporate other complexities for example the seasonally coherent calibration scc model wang et al 2019b yang et al 2021a zhao et al 2020 based on the joint probability scheme has been developed to produce calibrated forecasts that are coherent in climatology including seasonality consistent with long term observations even when archived nwp forecasts are limited nevertheless there is a major disadvantage of joint probability models none of the current joint probability models have incorporated the ensemble spread which is commonly assumed to be correlated with forecast uncertainty information toth et al 2001 scherrer et al 2004 grimit and mass 2007 hopson 2014 by contrast many distributional regression models have gained additional forecast skills due to the incorporation of ensemble spread veenhuis 2013 messner et al 2014b scheuerer and hamill 2015 in this context it will be highly valuable to explore a way to enable joint probability models to incorporate the ensemble spread in this paper we develop a two step calibration approach to integrate the additional forecast information included in the ensemble spread into joint probability models for demonstration purposes we employ the scc model as an example of joint probability models and select precipitation as our target weather variable in the first step we apply scc to calibrate ensemble mean of precipitation forecasts as scc for precipitation forecasts involves transformations for data normalization and special treatments of zero values we explore a number of ways to estimate ensemble mean values when establishing the scc model in the second step we re calibrate the scc calibrated forecasts from the first step to make use of raw ensemble spread information with such an approach the use of ensemble mean and ensemble spread is separated into two steps allowing the scc model to be deployed in its original form i e taking ensemble mean as the only predictor the rest of this paper is organized as follows section 2 describes the nwp ensemble precipitation forecasts observed data and geographic area used for this study section 3 presents how we develop the two step calibration approach with scc and introduces evaluation metrics section 4 illustrates forecast verification results section 5 discusses advantages and possible limitations of the two step calibration approach finally main conclusions are presented in section 6 2 data observed daily precipitation data are obtained from the australian water availability project s climate datasets awap jones et al 2009 with a high spatial resolution 0 05 x 0 05 gridded awap data are obtained by interpolating rain gauge observations which are collected from 0900 h of the previous day to 0900 h of the current day according to australian local time including daylight saving observations for a period of 30 years from 1 august 1989 to 31 july 2019 are used as reference data for scc model establishments and for forecast evaluations we select ensemble precipitation forecasts from the australian community climate and earth system simulator global ensemble 2 access ge2 nwp model for forecast calibration access ge2 is based on the met office global and regional ensemble prediction system mogreps naughton 2016 and has a horizontal grid spacing of approximately 60 km each access ge2 ensemble consists of 24 exchangeable members that result from multiple stochastic disturbances to both model physics and initial conditions of the access ge2 model ensemble forecasts are issued at 1200 utc on a daily basis for lead times up to 10 days and are available at a 3 hourly temporal resolution access ge2 forecasts of a 3 year period from 1 august 2016 to 31 july 2019 are selected for this study to match the forecasts with observed data we modify the spatial and temporal resolutions of access ge2 data according to the awap data we apply bilinear interpolation to re grid the access ge2 forecasts to the spatial resolution of awap and we aggregate the 3 hourly precipitation forecasts to daily values according to the awap records because awap data are produced based on australian local time which has utc offsets we adjust the matching hours of access ge2 and awap and finally obtain daily ensemble precipitation forecasts for 9 days ahead for a comprehensive forecast evaluation we select 20 sites across a variety of climates in australia as shown in fig 1 the average annual precipitation is calculated based on the 30 years of awap data 3 methods in this section we first introduce the formulation of the scc modelling method we then demonstrate how we develop the two step calibration approach with scc for the first step three scc variants are derived based on different ways to estimate ensemble mean values scc1 and scc2 are established by calculating ensemble mean before and after data transformations respectively and scc3 is established with a proposed data augmentation approach for handling near zero values of ensemble precipitation data for the second step a re calibration rc method is developed to further calibrate the scc calibrated forecasts using raw ensemble spread information details of the two step calibration approach are illustrated in fig 2 finally we introduce verification methods used for forecast evaluation 3 1 scc model formulation 3 1 1 log sinh transformations and a joint probability model the seasonally coherent calibration scc model was developed based on the joint probability distribution to produce calibrated forecasts that are coherent in climatology including seasonality consistent with long term observations even when archived nwp forecasts are limited wang et al 2019b when used to post process precipitation forecasts raw forecasts and observations need to be normalized before a bivariate normal distribution is applied as precipitation data are highly skewed in this study we employ log sinh transformations wang et al 2012 bennett et al 2014 for normalizing raw precipitation forecasts x t t 1 2 t where t is the total number of days in the 3 year period and corresponding observations y t to f t and o t respectively the transformed variables f t and o t are then assumed to follow a bivariate normal distribution 1 f t o t bn u f m t u o m t σ f m t 2 ρ m t σ f m t σ o m t ρ m t σ f m t σ o m t σ o m t 2 where m t denotes the month for day t namely m t 1 2 12 u f m t and σ f m t are the mean and standard deviation of the marginal distribution of f t and u o m t and σ o m t for o t and ρ m t is the correlation between f t and o t because the bivariate normal distribution applies to continuous variables a censoring technique is used to treat near zero precipitation as censored data the term censored means these data are treated as below certain thresholds but are not precisely specified wang and robertson 2011 messner et al 2014a scheuerer and hamill 2015 zhao et al 2015 stauffer et al 2017 two thresholds x c and y c are applied here for x t and y t with corresponding thresholds f c and o c for better fitting f t and o t in their corresponding marginal distributions wang and robertson 2011 here x c and y c are set to 0 01 and 0 2 mm day reflecting the precision of available forecasts and observed data respectively according to robertson et al 2013 3 1 2 reparameterization of the joint probability model post processing models generally require long term statistical characteristics of both forecasts and corresponding observations in order to produce forecasts that are coherent with the climatology of observations zhao et al 2017 however although a long record of observations is often accessible the archived record of forecasts is commonly short as nwp models are frequently updated in this context the scc model was developed to work with limited nwp data to produce coherent calibrated forecasts this significant advantage of the scc model is achieved through the following two procedures first a climatology that is representative of long term statistical characteristics of observations is brought into the scc model in this study we use 30 years of observed data to estimate the marginal distribution parameters of observations namely the mean u o m t and standard deviation σ o m t for each month second a reparameterization of the joint probability model is conducted to estimate u f m t σ f m t and ρ m t for each month 2 u f m t a b u o m t 3 σ f m t c d σ o m t 4 ρ m t r where b c d 0 and 0 r 1 and these 4 parameters are constrained to avoid nonsensical relationships it should be noted that a can be either positive or negative as u f m t can be positive or negative in the log sinh transformed space equations 2 and 3 assume that nwp models if run long enough can produce the seasonality pattern that is linearly related with the observed climatology equation 4 assumes that the underlying forecast skill of nwp models is constant for all 12 months these assumptions are supported by a case study from wang et al 2019b and may help reduce sampling effects of forecast evaluation results the reparameterization of the joint probability model replaces 36 parameters u f m t σ f m t and ρ m t m t 1 2 12 with five parameters a b c d and r therefore making it feasible to estimate model parameters from a short period of archived nwp forecasts all of the parameters from the above two procedures can be derived using the method of maximum likelihood and the nelder mead searching approach nelder and mead 1965 related likelihood functions are given in wang et al 2019b 3 1 3 calibration of new forecasts after obtaining all the parameters of the scc model we can apply scc to calibrate new forecasts given a new forecast x t a conditional distribution of o t can be derived based on f t 5 o t f t n o t u o t σ o 2 t where 6 u o t u o m t ρ m t σ o m t σ f m t f t u f m t 7 σ o 2 t 1 ρ 2 m t σ o 2 m t we sample an ensemble of values from the conditional distribution to represent the forecast probability distribution when f t f c an ensemble o t n n 1 2 n of any size n 100 for this study can be sampled from the conditional distribution when f t f c a random value f t from the marginal distribution n f t u f m t σ f 2 m t is first sampled in the range of f c then a sample can be drawn from the conditional distribution o t f t to give an ensemble member these two steps are repeated n times to form the ensemble o t n finally the sampled ensemble members o t n can be transformed back by an inverse of the log sinh transformation to give a calibrated ensemble forecast y t n in original scale when there are negative ensemble members in y t n we set them to zero 3 2 the proposed two step calibration approach 3 2 1 step one calibration of ensemble mean using scc the scc model described above was originally developed to calibrate deterministic forecasts when it comes to ensemble forecasts ensemble mean can be calculated to provide the deterministic value as scc for precipitation forecasts involves data transformations and the censoring setup for near zero precipitation values there are different ways to obtain the ensemble mean here we establish three scc models each corresponding to a particular way of estimating the ensemble mean values the three models are named scc1 scc2 and scc3 for our study the scc1 model is established by calculating ensemble mean before data transformations denoting raw ensemble forecasts as x t k k 1 2 k where k is the ensemble size 24 for access ge2 ensembles we calculate the ensemble mean prior to the data transformations as in previous studies scheuerer and hamill 2015 li et al 2019 8 x m t 1 k k 1 k x t k then x m t can replace the aforementioned x t as the raw precipitation forecast series to establish the scc1 model the rest of the setup of the scc1 model follows the same process as the original scc model the scc2 model is established by calculating ensemble mean after data transformations we transform x t k with the log sinh transformation to get f t k k 1 2 k the transformation involves all of the ensemble members without any censoring we can calculate the ensemble mean as below 9 f m t 1 k k 1 k f t k then f m t can replace the aforementioned f t equations 1 5 and 6 as the transformed forecast series to establish the scc2 model likewise the rest of the scc2 model setup remains the same the scc3 model is established with a proposed data augmentation approach for censored ensemble forecasts the ensemble mean calculation becomes problematic when an ensemble contains censored ensemble members because these members are only known to be below or equal to the censoring threshold x c or f c it would be sensible to assign exact values to these censored data for calculating the ensemble mean here we propose a hierarchical model to simulate distributions of transformed ensemble forecasts for any ensemble f t k k 1 2 k ensemble members are assumed to follow a normal distribution 10 f t k n f u t σ 2 where f u t t 1 2 t and σ are the mean and standard deviation of the normal distribution respectively for each ensemble f u t is a latent variable and needs to be inferred from another normal distribution 11 f u t n u u σ u 2 where u u and σ u are the mean and standard deviation of the normal distribution respectively to infer the parameters σ u u and σ u the latent variable f u t and censored ensemble members we apply gibbs sampling gelfand 2000 to iteratively sample these variables from their corresponding conditional distributions until the hierarchical model reaches a statistically steady condition conditional distributions of these parameters and variables can be derived from the following likelihood function l 12 l t 1 t k 1 k n f t k f u t σ 2 n f u t u u σ u 2 for example in any sampling iteration given f u t and σ if there are censored members in an ensemble we can draw random samples from the conditional distribution n f t k f u t σ 2 in the range of f c to give the augmented values after the augmentation of censored ensemble members we obtain a new series of ensemble forecasts f t k k 1 2 k then the ensemble mean can be calculated as below 13 f m t 1 k k 1 k f t k similarly f m t can be used to replace the aforementioned f t equations 1 5 and 6 to establish the scc3 model 3 2 2 step two re calibration of scc calibrated forecasts using ensemble spread to maximise forecast skills from post processing raw ensemble forecasts ensemble spread should also be incorporated into post processing models we select scc3 out of the three scc models established in the first step to demonstrate the re calibration rc method given that scc3 is the most sophisticated in a sensible way and might perform best in the post processing we refer this integrated model as scc3 rc in this study generally ensemble spread is represented using the standard deviation among ensemble members raw ensemble standard deviation σ raw t and scc3 calibrated ensemble standard deviation σ cali t in transformed space can be calculated as 14 σ raw t 1 k 1 k 1 k f t k f m t 2 15 σ cali t 1 n 1 n 1 n o t n o m t 2 where 16 o m t 1 n n 1 n o t n is the ensemble mean of scc3 calibrated ensemble o t n n 1 2 n rc is formulated to adjust each ensemble member of o t n individually 17 o rc t n λ 1 o m t o t n o m t λ 2 λ 3 σ raw t σ cali t where o rc t n is the re calibrated ensemble member λ 1 λ 2 and λ 3 are the rc parameters specifically λ 1 represents the modification of the calibrated ensemble mean o m t λ 2 and λ 3 represent the contribution weights of σ cali t and σ raw t respectively a larger λ 3 would indicate that more ensemble spread information from the raw forecasts is utilized rc is only applied to calibrated ensemble forecasts whose corresponding raw ensemble mean f m t is larger than f c this is because their raw ensemble spread is relatively more trustworthy than those calculated mostly based on augmented ensemble members we use a continuous ranked probability score crps minimization method gneiting et al 2005 van schaeybroeck and vannitsem 2015 to optimize λ 1 λ 2 and λ 3 details of the crps are shown in section 3 3 after obtaining the rc parameters we can re calibrate scc3 calibrated ensemble members and then transform the re calibrated ensemble members back to the original scale using the inverse of the log sinh transformation the rc step is essentially an ensemble adjustment of forecast members it has some similarity to the method of member by member post processing mbmp johnson and bowler 2009 schefzik 2017 this point will be further discussed later in the discussion section 3 3 forecast evaluation in this study the performances of the scc1 scc2 scc3 and scc3 rc models are evaluated using a leave one month out cross validation evaluation diagnositics include bias crps hersbach 2000 threshold weighted crps twcrps gneiting and ranjan 2011 and reliability diagram wilks 2011 to assess different aspects of forecast quality bias is the difference between the mean of precipitation forecasts and the mean of corresponding observations 18 bias 1 t t 1 t x t 1 t t 1 t y t where x t and y t are forecasts and observed values at time t respectively and t is the length of forecast data records it is important to have minimal bias in precipitation forecasts as bias can be amplified in streamflow forecasting and in other water resource management crps quantifies the difference between ensemble forecast cumulative distribution and corresponding observations hersbach 2000 the average crps for days t 1 2 t is formulated as 19 crps 1 t t 1 t f t x h x y t 2 d x where f t x is the forecast cumulative density function cdf and y t is the observation at time t h is the heaviside step function that equals 1 if x y t 0 and equals 0 otherwise and t is the length of data records we also calculate the crps of reference climatology forecasts crps ref using the leave one month out cross validated climatology ensemble forecasts that are generated from the scc models a crps skill score can then be calculated as 20 crps skill score crps ref c r p s crps ref 100 the crps skill score is positively oriented and represents the relative improvement of the calibrated forecasts compared to the referenced climatology forecasts a maximum skill score of 100 indicates that forecasts perfectly match the corresponding observations and a skill score of 0 indicates that forecasts have comparable errors to the reference forecasts forecasts poorer than reference forecasts have negative skill scores note that the reference climatology forecasts are common to all the scc models and therefore crps skill scores achieved by the different models can be directly compared with each other we further use twcrps gneiting and ranjan 2011 to evaluate the model performance on predicting heavy precipitation events i e precipitation amount above a certain threshold the average twcrps for days t 1 2 t is formulated as 21 twcrps 1 t t 1 t f t x h x y t 2 ω x d x where ω x is a weight function that equals 1 if x q and equals 0 otherwise and q is a given threshold with precipitation above q marked as heavy precipitation events in this study q is set to the 95 quantile of observed values similarly we use twcrps skill score to demonstrate the improvement of calibrated forecasts relative to reference forecasts in addition we apply the reliability diagram as a graphical tool to evaluate the reliability of ensemble forecast uncertainty ensemble spread not too narrow or too wide reliability refers to the statistical consistency between ensemble forecasts and corresponding observations a reliability diagram illustrates forecast reliability by plotting observed frequencies against predicted probabilities based on a threshold exceedance for ensemble forecasts in this study we use 0 2 mm day and 95 quantile of observed values as two thresholds for constructing the diagrams precipitation values exceeding 0 2 mm day and the 95 quantile of observations represent the occurrence of light precipitation and the occurrence of heavy precipitation respectively resulting plots in reliability diagrams close to the 1 1 line indicate good reliability while deviation from the line indicates poor reliability perfectly reliable forecasts will show a plot overlapping with the 1 1 line 4 results 4 1 overall forecast evaluation of bias and crps skill score results of bias and crps skill score for raw ensemble forecasts and calibrated forecasts from the scc1 scc2 scc3 and scc3 rc models are shown in fig 3 it can be seen from the figure that raw ensemble forecasts overall perform worst in terms of bias and crps skill score among these forecasts the scc models greatly improve the raw ensemble forecasts with most of the bias being closer to zero and much greater crps skill scores being achieved especially at short lead times while there are many negative crps skill scores in raw ensemble forecasts only a few negative skill scores are shown in the calibrated forecasts bias has no clear trend over the lead time while crps skill score tends to decrease gradually as the lead time increases indicating lower skills of forecasts at longer lead times besides scc2 scc3 and scc3 rc have overall better performance than scc1 on bias however it is quite hard to distinguish these four models according to their crps skill scores at the scale shown in fig 3 to further learn about the contributions of the ensemble mean calculations after data transformations the data augmentation and the re calibration for incorporating raw ensemble spread information we look more closely at the crps skill score of each of the models for each site and each lead time in the following two subsections 4 2 crps skill scores of calibrated forecasts from the three scc variants results of crps skill score for calibrated forecasts from the scc1 model is shown in fig 4 a similar to the results discussed in section 4 1 crps skill score of the scc1 calibrated forecasts is negative just at a few sites and only at some lead times indicating the evident benefits of the scc post processing results on crps skill score improvements of scc2 and scc3 over scc1 are shown in fig 4 b and 4 c and further summarised in table 1 as quantitative forecasts of precipitation for a particular location and lead time is highly challenging even a 1 skill score improvement is often considered a meaningful gain for newly implemented nwp models or post processing methods messner et al 2014b scheuerer and hamill 2015 for either the scc2 or scc3 model the crps skill score difference from the scc1 model varies with sites and lead times the overall difference tends to be positive indicating improvements over scc1 calculating ensemble mean after transformations i e the scc2 model improves the crps skill score compared to calculating ensemble mean before transformations i e the scc1 model especially for sites 2 13 17 and 20 although there are sites with reduced skill scores such as sites 3 4 and 12 in addition the data augmentation for censored ensemble members in the scc3 model further improves the crps skill score of scc2 calibrated forecasts the most greatly improved site is site 14 as shown in table 1 on the basis of the skill score improvement of scc2 compared to scc1 the scc3 model further increases the number of improved cases and the total accumulated average improved skill score of scc3 compared to scc1 reaches 1 13 4 3 crps skill scores of calibrated forecasts from the two step calibration results of crps skill score for scc3 rc calibrated forecasts are shown in fig 5 and table 1 scc3 rc calibrated forecasts have positive crps skill scores at all sites and lead times fig 5 a this assures that the calibrated forecasts are more skillful than the referenced climatology forecasts in all cases compared to scc1 the accumulated average crps skill score improvement of scc3 rc reaches 1 68 which is quite prominent considering all the sites and lead times we also compare the forecast performance of scc3 rc and scc3 to learn how the incorporated raw ensemble spread information in the re calibration influences the model performance as shown in table 1 the re calibration method improves the skill score of 129 cases with improved skill scores mainly at short lead times and mostly within 4 fig 5 c the average skill score improvement due to raw ensemble spread utilization is 0 55 which is comparable to previous studies on distributional regression based post processing models messner et al 2014b scheuerer and hamill 2015 this indicates that the re calibration method can make scc calibrated ensemble forecasts more skillful by using raw ensemble spread information however it should be noted that there are also reductions in the skill score at some sites such as sites 2 17 and 19 fig 5 c 4 4 twcrps skill scores of calibrated forecasts from the three scc variants we further evaluate the ability of the calibration models in predicting heavy precipitation events which are crucial for some common hydrological applications such as irrigation and flood forecasting the twcrps skill score for calibrated forecasts from the scc1 model is shown in fig 6 a clearly scc1 calibrated forecasts have more negative values of the twcrps skill score compared to the crps skill score fig 4 a this highlights again the challenge of forecast post processing for predicting heavy precipitation events as previously identified in the literature taillardat et al 2019 li et al 2020a results on the improvements in the twcrps skill score of scc2 and scc3 over scc1 are shown in fig 6 b and 6 c and further summarised into table 2 both scc2 and scc3 have overall higher twcrps skill score than scc1 and the improvements are larger than those in the crps skill score table 1 this shows that scc2 and scc3 overall perform better than scc1 for predicting heavy precipitation events also it is worth noting that there are still reduced twcrps skill scores at several sites fig 6 b and 6 c 4 5 twcrps skill scores of calibrated forecasts from the two step calibration the twcrps skill scores of scc3 rc calibrated forecasts are shown in fig 7 and table 2 scc3 rc greatly improves scc1 in terms of the twcrps skill score with the average improvement exceeding 3 which is almost twice as much as the average crps skill score improvement table 1 besides scc3 rc also has higher twcrps skill score than scc3 with the average improvement close to 1 the two step calibration is shown to gain considerable twcrps skill score improvements although there are slightly degraded skill scores at some sites fig 7 b and 7 c together with results presented in sections 4 2 4 4 it can be concluded that on the average of the 20 sites and 9 lead times in the order of scc1 scc2 scc3 and scc3 rc both crps skill score and twcrps skill score tend to increase successively indicating gradual improvements besides the improvements on twcrps skill score have higher magnitudes than those on crps skill score tables 1 and 2 meaning that the latter three models especially scc3 rc are far more capable of predicting heavy precipitation events than the scc1 model on average to further demonstrate the significance level of the advantages of scc2 scc3 and scc3 rc over scc1 we carry out a strict statistical significance testing with bootstrapping on the crps twcrps skill score results of forecasts calibrated using these models according to the testing results shown in table a1 the crps skill score difference between any two models is not statistically significant however the twcrps skill score difference between scc3 rc and scc1 is found to be significant this further confirms the superiority of the scc3 rc model on producing more skillful calibrated forecasts for heavy precipitation events than scc1 besides it should also be noted that the differences in the crps twcrps skill score obtained from scc3 rc and scc3 are not statistically significant although the improvement of scc3 rc compared to scc3 is shown to be overall considerable details of the statistical testing and interpretation can be found in appendix a 4 6 reliability diagrams of calibrated forecasts from different models the reliability diagrams of calibrated forecasts from scc1 scc2 scc3 and scc3 rc as well as raw ensemble forecasts are shown in fig 8 as can be seen from the figure that all of the calibrated forecasts clearly show better reliability than raw ensemble forecasts for the two thresholds selected i e 0 2 mm day and the 95 quantile of observed values for the occurrence of light precipitation events scc2 and scc3 have poorer reliability performance than scc1 while scc3 rc has slightly better reliability than scc1 fig 8 a for the occurrence of heavy precipitation events scc2 scc3 and scc3 rc have similar reliability performance and all of them perform better than scc1 fig 8 b 5 discussion the calculation of ensemble mean and ensemble spread with censored ensemble members is problematic as there are no exact values for these members in transformed space one feasible solution is to augment exact values for censored data many mathematical methods have been developed for the augmentation of datasets with censored records cohen 1961 hornung and reed 1990 perkins et al 1990 these methods are generally developed based on the maximum likelihood estimation to augment values for one single dataset however when applied to multiple datasets which are a series of ensembles in our study augmenting values for each ensemble individually cannot take into consideration the relationship among different ensembles given that ensemble members from all ensembles are transformed using the same set of parameters in the data normalization process besides these methods might become problematic when most or even all of the ensemble members are censored by contrast the data augmentation algorithm we propose in this study can connect all ensembles by establishing a hierarchical model and ensembles even with a large proportion of censored members can still be augmented in a sensible way these advantages make our algorithm more appropriate for the data augmentation of censored ensemble weather forecasts the re calibration method employed in our study is similar to member by member post processing mbmp methods johnson and bowler 2009 van schaeybroeck and vannitsem 2015 schefzik 2017 which post processes raw ensemble forecasts by adjusting ensemble members individually these mbmp methods are often implemented by minimizing objective scoring functions e g crps of the adjusted ensemble forecasts they can make use of raw ensemble spread information but are generally not sophisticated enough to reflect statistical forecast uncertainty derived from historical weather events in this context the re calibration is developed based on mbmp methods to further post process the scc calibrated forecasts using raw ensemble spread information forecasts calibrated using the two step calibration can reflect both the dynamically flow dependent ensemble spread from raw ensemble forecasts and the scc calibrated ensemble spread that contains statistically generated uncertainty information accurate and reliable ensemble forecasts for heavy precipitation events are crucial for hydrological forecasting and have attracted much attention from the post processing perspective it is therefore valuable to evaluate the performance of post processing models over heavy precipitation events however the restriction of routine forecast evaluations to only observed heavy events often has bias effects and may degrade even the most skillful forecasts available diks et al 2011 gneiting and ranjan 2011 this is also referred to as the forecaster s dilemma in lerch et al 2017 in this study we apply the twcrps to evaluate calibrated ensemble forecasts with emphasis on heavy precipitation events as a proper weighted scoring rule the twcrps metric takes into consideration all precipitation events while evaluating the forecast distribution tails it avoids possible bias due to the stratified sampling conditioned on observations and therefore provides a remedy for the dilemma in this study the three scc variants differ in how we calculate the ensemble mean for the scc post processing indeed a number of studies take ensemble mean as a summarized statistic in operational ensemble forecasting as well as post processing as ensemble mean generally has smaller errors than any individual ensemble member when averaged over many cases scheuerer and hamill 2015 wang et al 2019a however it has also been recognized that in complex spatial fields ensemble mean can sometimes smear out some important features by decreasing high amplitudes and increasing the spatial coverage of low values especially for ensemble forecasts with extreme events ebert 2001 surcel et al 2014 some approaches such as the probability matching pm method ebert 2001 clark 2017 have been developed to solve this issue by modifying the ensemble mean in some statistical ways therefore a simple ensemble mean as implemented in scc1 may not be the most appropriate representation of ensemble forecasts for the scc post processing further experiments are needed in the future to investigate if the other two ensemble mean calculation approaches as implemented in scc2 and scc3 can help alleviate the smearing effect we acknowledge that our study is only conducted based on ensemble forecasts on a daily basis and with a grid spacing of about 60 km as temporally and spatially high resolution weather forecasts have attracted great attention recently whether the developed models in this study are applicable to for example hourly nwp forecasts with a finer grid spacing needs to be further investigated besides establishing calibration models for precipitation is widely known to be more challenging than other weather variables indeed as a highly sophisticated model compared to traditional joint probability models scc has also been shown to be applicable to other variables yang et al 2021b in view of the forecast improvements in our study we therefore anticipate our models to be robust for application to other joint probability models and to post processing other weather variables 6 summary and conclusions in this study we aim to integrate the ensemble spread into joint probability models a two step calibration approach is developed for ensemble precipitation forecasts with the seasonally coherent calibration scc model as an example of joint probability models in the first step we employ the scc model to calibrate ensemble mean in the second step we re calibrate the scc calibrated forecasts to incorporate the ensemble spread information as scc for precipitation forecasts involves transformations for data normalization and special treatments of zero values we investigate three different ways to estimate ensemble mean values when establishing the scc model in the first step we find that calculating ensemble mean after transformations overall performs better than that before transformations for scc we therefore recommend ensemble mean to be calculated in transformed space when post processing ensemble precipitation forecasts in addition we propose a data augmentation algorithm to estimate ensemble mean and ensemble spread for use in the second step to handle zero precipitation values the resulting ensemble mean values are shown to lead to even better forecast calibration for the second step i e the re calibration we develop an ensemble adjustment method to adjust the scc calibrated ensemble members individually using raw ensemble spread information the additional forecast information extracted by the re calibration leads to forecast skill increase comparable to that achieved in past studies of using raw ensemble spread information this means that the two step approach is able to utilize the ensemble spread information of raw ensemble precipitation forecasts while preserving the strengths of the scc model the two step calibration approach namely scc3 rc in our study has been found to fairly improve the performance of the original scc in terms of the bias forecast skill and forecast reliability the improvement is especially notable for heavy precipitation events it is expected that the two step calibration approach can be adapted for other joint probability models and for post processing other weather variables data availability statement data used in this study are produced by the australian bureau of meteorology and accessed via the national computational infrastructure system please contact the bureau of meteorology to request data access credit authorship contribution statement pengcheng zhao methodology validation formal analysis writing original draft quan j wang conceptualization methodology supervision writing review editing wenyan wu resources supervision writing review editing qichun yang data curation supervision writing review editing declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgements this work is supported by an australian research council linkage project grant no lp170100922 and a collaborative project grant no tp707466 between the university of melbourne and australian bureau of meteorology the co author wenyan wu acknowledges the support of the australian research council via the discovery early career researcher award de210100117 we would like to thank the australian bureau of meteorology for supplying the access ge2 and awap data we also thank the national computational infrastructure for providing assess to computation resources to support our work we gratefully acknowledge the two reviewers for their thorough reviews and constructive comments appendix a statistical significance testing of two samples with bootstrapping we employ the algorithm in efron and tibshirani 1994 to implement the statistical significance testing between two samples in our study assuming that the crps twcrps skill score values of forecasts calibrated by two different models are samples x x 1 x 2 x n and y y 1 y 2 y n the sample size n of both samples will be 180 20 sites and 9 lead times in total steps of the significance testing with bootstrapping are as follows 1 calculate the test statistic t for x and y a1 t x m y m σ x 2 n σ y 2 n where x m and σ x are the mean and standard deviation of sample x and y m and σ y for sample y 2 calculate the mean xy m of the combined sample of x and y a2 xy m x m y m 2 3 construct two new samples x x 1 x 2 x n and y y 1 y 2 y n a3 x i x i x m xy m i 1 2 n a4 y i y i y m xy m i 1 2 n 4 apply bootstrapping to draw two random samples x and y of size n from x and y respectively 5 calculate the test statistic t for x and y a5 t x m y m σ x 2 n σ y 2 n where x m and σ x are the mean and standard deviation of sample x and y m and σ y for sample y 6 repeat step 4 and step 5 k i e a large value times to obtain k t values 7 count the number of t values that are equal to or greater than t as n 8 estimate the p value a6 p n k the null hypothesis of the significance testing is that x and y are from a distribution with the same mean and the alternative hypothesis is that they are not the null hypothesis will be rejected at significance level α if a7 p α in this study we first choose the most often used α value 0 05 as the significance level and choose k 100000 to keep the sampling errors as small as possible for crps twcrps skill score results we implement 4 significance tests between scc2 and scc1 scc3 and scc1 scc3 rc and scc1 and scc3 rc and scc3 respectively however conducting multiple statistical tests simultaneously often comes with the problem of multiple comparisons miller 1981 to counteract this problem we employ the bonferroni correction haynes 2013 which is the most conservative multiple testing correction method to give the strictest significance level a8 α α m where m is the number of significance tests and is 4 in this study α is therefore calculated as 0 0125 results of the significance testing on crps twcrps skill scores are shown in table a1 the twcrps skill score comparison between scc3 rc and scc1 has a p value smaller than 0 0125 in this case we can reject the null hypothesis and conclude that the twcrps skill score difference between these two models is statistically significant even with the strictest significance level for the rest cases we cannot reject the null hypothesis so there is not enough evidence to suggest that the crps twcrps skill score difference is significant 
