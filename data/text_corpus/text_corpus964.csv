index,text
4820,snowpack melting in the high atlas constitutes the major source of freshwater for the semi arid agricultural plains of central morocco snow runoff fills dams during spring and recharges groundwater thus providing the necessary water for irrigation and hydropower production despite its critical importance for the region basic questions about the high atlas snowpack remain largely unanswered in particular the spatial and temporal distribution of snow water equivalent as well as sublimation losses potentially significant in this region have yet to be thoroughly investigated the scarcity of ground data has been a major obstacle to investigating snow processes in the high atlas here we demonstrate the potential of remotely sensed meteorological variables and downscaled climate reanalysis data to gain important insights into snow water balance in a semi arid region we apply a distributed energy balance snow model based on snow17 constrained by topographic data meteorological data from satellites and high resolution dynamically downscaled era interim data to simulate snowpack dynamics within the oum er rbia watershed at the heart of morocco s high atlas the simulations are compared to modis snow cover maps and observed snow depth at one field station results show that the spatial extent and temporal dynamics of snow cover at various elevation ranges are accurately captured the snowpack is essentially concentrated above 2500 m extends over 500 6000 km2 and holds 0 05 0 4 km3 at its peak in early february additionally we find that losses by sublimation range from 0 06 to 0 14 km3 for an average of 0 09 km3 a year about 10 of all snowfall above 3000 m elevation sublimation removes on average 20 of the snowpack finally we discuss the sensitivity of our results to uncertainties in the forcing meteorological data this study reveals the essential components of the snow water balance in the high atlas and paves the way for better understanding of its sensitivity to climate change keywords empirical snow model snow17 swe morocco sublimation 1 introduction while average annual precipitation hardly reaches at best 500 mm over morocco s agricultural plains the atlas mountains which rise up to 4000 m high usually receive up to twice that amount most often in the form of snow between november and march boudhar et al 2009 consequently mountain precipitation is a major source of freshwater for the country especially its agriculture which accounts for 90 of all water use the melting of the winter snowpack during spring substantially contributes to river discharge up to 50 in some local catchments boudhar et al 2009 filling dams beyond the wet season and allowing for continued water use and irrigation until the end of the growing season in may infiltration of mountain runoff also accounts for much of the aquifer recharge on which agricultural activities in the fertile plains at the foot of the atlas critically depend chehbouni et al 2008 yet although the importance of the mountain snowpack for water resources is well established much remains unknown about its characteristics and spatio temporal dynamics accurate estimates of snow water equivalent swe fields in the high atlas are necessary to improve our understanding of the regional hydrology and thus water resources management in addition assessing the sensitivity of the snowpack to meteorological and climate variables is critical in order to project its response to climate change which is expected to bring warmer and much drier conditions over morocco in the near future tuel and eltahir 2020 tuel et al 2020 still the scarcity of ground measurements combined to the complex regional topography and the large spatio temporal variability in hydroclimate fayad et al 2017 tuel and eltahir 2018 create significant challenges to snowpack monitoring and estimation at the basin scale satellite based snow cover maps can provide a good first estimate of the extent and temporal evolution of the snowpack as was shown for the atlas mountains marchane et al 2015 where enough station data is available complex physically based snow models that resolve the energy balance at the surface and may even include several snow layers liston and elder 2006 herrero and polo 2016 boudhar et al 2016 are usually preferred recently baba et al 2019 applied snowmodel a physical snowpack evolution model based on the snow energy balance to simulate snowpack dynamics in the rheyara catchment of the high atlas outside our study zone down to a resolution of 8 m their approach was made possible by the small size 220 km2 of the catchment and its relatively high density of weather stations the large data requirements of such models however make them less applicable over large areas where even basic data like temperature is often missing therefore essential questions remain unanswered for the high atlas most importantly how much water is stored in the snowpack and how does this amount vary in space and time at the catchment scale conceptual distributed snow models typically based on simple parametrizations of melt as a function of temperature and forced with remotely sensed data spatially interpolated station data or analytical mesoscale model output can yield useful results marks et al 1999 clark et al 2011 raleigh and lundquist 2012 when ground data is particularly scarce or unavailable one possibility is to resort to remotely sensed snow cover maps and reconstruct swe backwards in time using the observed snow fraction time series at each grid point as constraints molotch 2009 raleigh and lundquist 2012 an advantage of this approach is that it only requires temperature as input if no new snowfall accumulates after peak swe on the downside it can only reconstruct swe during the melt phase is not useful to make swe projections and is also very sensitive to biases in snow cover data molotch and margulis 2008 often forward configurations in which precipitation is partitioned between rain and snow and accumulated snowfall stored as swe are preferred raleigh and lundquist 2012 in their simplest form empirical snow models only require temperature and precipitation and temperature although more complex formulations involving radiative fluxes are also available hock 1999 follum et al 2015 several previous studies that relied on station measurements have shown that they were able to satisfactorily estimate snow accumulation and melting in various climate zones including the high atlas follum et al 2015 boudhar et al 2016 bouamri et al 2018 such models have also been successfully applied to reconstruct swe fields in various mediterranean climate regions shamir and georgakakos 2007 guan et al 2013 fassnacht et al 2017 fayad et al 2017 however station data is often missing which has led to increased interest in the applicability of gridded climatological datasets like climatological reanalyses e g era interim dee et al 2011 station based interpolated datasets or satellite based products to be used as input to snow models muñoz et al 2014 shamir and georgakakos 2014 however questions still remain as to their accuracy to represent fine scale conditions in complex topography especially precipitation maxima near mountain peaks muñoz et al 2014 to circumvent that problem reanalysis data can be downscaled to finer resolution with regional climate models wrzesien et al 2017 an approach that has proved successful over several mountainous regions alonso gonzález et al 2018 and reference therein the forcing datasets can suffer from numerous biases however especially precipitation which in complex terrain typically exhibits strong spatio temporal variability that is hard to capture regional models can be unreliable since precipitation relies on parametrizations that require observations as input and gridded satellite based precipitation products like trmm huffman et al 2007 chirps funk et al 2015 or gpm huffman et al 2014 are often the only estimates available such products usually tend to underestimate snowfall and wet season precipitation in mountain regions derin et al 2016 hashemi et al 2017 which may bias the results particularly since parameter fitting of empirical snow models is typically highly sensitive to input uncertainty franz et al 2010 he et al 2011 few studies seem to rely on satellite based precipitation preferring model simulated precipitation wrzesien et al 2017 alonso gonzález et al 2018 or global station based products muñoz et al 2014 when direct interpolation from local stations is not possible in addition one downside of previous such studies is the absence of explicit sublimation fluxes yet because the high atlas has a particularly arid climate latent heat fluxes are significant locally 25 45 of accumulated snow has been found to be lost to sublimation schulz and de jong 2004 lópez moreno et al 2017 sublimation is known to vary significantly in space especially in complex mountain regions strasser et al 2008 any snow model applied at the basin scale in this area should therefore include latent heat fluxes which requires additional meteorological information notably atmospheric humidity the innovative aspect of this study is in how we estimate the spatial and temporal distributions of snowpack water content and sublimation in a large area of about 13 000 square kilometers in the high atlas using a distributed physically based snow model constrained by a combination of topographical data remotely sensed data and meteorological data dynamically downscaled down to 12 km to our knowledge no other study has attempted to assimilate data from such various sources to model snow in a data scarce region in addition we model sublimation explicitly to provide the first estimate of the spatial distribution of latent heat fluxes in the high atlas our focus is the oum er rbia watershed one of morocco s major agricultural regions and an important producer of hydropower which receives the most snowfall among all the country s main watersheds marchane et al 2015 and depends almost exclusively on mountain precipitation satellite based snow cover is used as a constraint in order to estimate snow model parameters while previous studies have suggested that the strong spatial variability of atlas snow cover warranted less than 500 m resolution baba et al 2019 we select a resolution of 1 km for our model based on data availability and computing power despite this limitation snow modeling at such a resolution and spatial scale has never been attempted for the moroccan atlas our aim is to capture the main features of variability in snow cover and provide a first order characterization of the snow water balance of the basin 2 data and methods 2 1 study area the oum er rbia with its 550 km length and 3 km3 annual discharge is one of morocco s major rivers its water supports 30 of the country s irrigated land 50 of its hydropower capacity and provides for the daily needs of seven million people including two major cities casablanca and marrakech it flows northwestward from the northern slopes of the high atlas morocco s largest mountain range our 13 104 km2 study area covers the drainage basins of four main dams corresponding to the major tributaries of the oum er rbia all located at the foothills of the high atlas fig 1 elevation in the area ranges from 621 m to 3890 m for a mean of 1882 m vegetation is sparse consisting mostly in bare soil and grass and rare shrubs in areas where snow is present baba et al 2019 with forest cover essentially limited to the valleys the area is under a rather continental climate characterized by a large amplitude of temperature annual cycles knippertz et al 2003 temperatures are minimal in january when they range from mild 12 c below 1000 m to cold 5 c above 3000 m even at that time the foothills seldom go below freezing by contrast peak summer temperatures occurring in july are very high 35 c at the lowest elevations and still quite warm above 3000 m 10 15 c ouatiki et al 2017 conditions are overall quite dry even at high elevations where annual precipitation reaches 800 1000 mm against lows of 250 mm in the plains to the west about 80 of annual precipitation occurs during the wet season from october to april when the region is under the influence of north atlantic westerlies which bring the occasional storm systems responsible for most of the precipitation knippertz et al 2003 tuel and eltahir 2018 above 1500 m snowfall is common during the winter months persistent snow cover is frequent above 2500 m typically extends from december to april and rapidly disappears by the end of may boudhar et al 2010 fig 2 though inter annual variability is substantial marchane et al 2015 our study area encompasses most of the zones in the oum er rbia watershed that receive at least modest snow amounts on average during the winter fig 2 high atlas snow cover is characterized by substantial variability in both space and time a key feature in arid environments boudhar et al 2010 at the annual time scale wet season precipitation exhibits a large inter annual variability knippertz et al 2003 with a coefficient of variation of about 0 3 tuel and eltahir 2018 a variability that is reflected in seasonal snow extent marchane et al 2016 within a season precipitation also tends to occur in short and irregular storm events warm temperatures over a few dry weeks can lead to complete disappearance of the snowpack even in mid winter at high elevations schulz and de jong 2004 because net radiation dominates the snow energy balance lópez moreno 2017 snow cover is also highly dependent on terrain slope and aspect with bare ground not uncommon even at high altitude marchane et al 2015 2 2 snow model in mediterranean mountains the snow energy balance is largely dominated by radiative fluxes lópez moreno et al 2017 boudhar et al 2016 therefore we select the radiation derived temperature index rti melt formulation follum et al 2015 2019 within the framework of the snow 17 model anderson 2006 snow 17 simulates snow accumulation and loss empirically using meteorological variables to account for the various energy balance equation terms the main difference in this paper with the follum et al 2015 study is that we add a sublimation module based on a bulk aerodynamic flux formulation we give here a brief summary of model structure see fig 3 and equations readers are referred to follum et al 2015 and anderson 2006 for more details rti uses a proxy temperature t rad calculated from the surface radiation balance instead of actual air temperature to estimate snow melt it therefore includes spatial variability in potential melt due to variability in incoming shortwave and longwave t rad is given by the following 1 t rad t l w 1 α s w l e s σ 1 4 where l w is the downward longwave radiation s w downward shortwave α snow albedo le the latent heat flux see below s the snow surface emissivity taken to be 1 and σ the stefan boltzmann constant although equation 1 neglects many terms of the energy balance e g ground heat flux sensible heat flux at first order t rad represents the snow surface temperature that balances net surface radiation and can be interpreted as a measure of the amount of energy available to heat melt the snowpack in particular t rad can be above 0 c short and longwave are calculated as in follum et al 2015 see section 2 3 6 with the exception that we assume no vegetation cover an approximation we make due to the high atlas sparse vegetation tree cover is present at lower elevations below 1500 m where snow cover is short lived due to relatively high temperatures snow albedo is parametrized according to the formula proposed by brock et al 2000 and calibrated for the high atlas by boudhar et al 2016 2 α 0 8 0 21 log 10 t d where t d is the number of days since last snowfall fresh snow albedo is set at 0 8 a low value but which best fits observations in the high atlas likely connected to the high concentration of mineral dust due to the proximity of the sahara desert xu 2018 air temperature t a is used to determine the phase of precipitation we assume it will fall as snow if t a is below 0 c snowpack is characterized by its snow water equivalent swe in mm and its heat deficit d t a measure of the energy needed to bring the snowpack to its melting temperature 0 c the heat deficit is expressed in mm of snow water equivalent anderson 2006 at each time step the heat deficit is updated as new snow falls as snow sublimates or as energy is transferred from the atmosphere to the snowpack the change in heat deficit due to differences between snowpack and air temperatures is expressed as 3 δ d t n m f a t i t snow where ati is the antecedent temperature index in c t snow is the snow surface temperature and 4 nmf n m f max sw 12 h t m a x s w 12 h t d t where nm f max is the maximum negative melt factor in mm c hr sw 12 h m a x is the incoming shortwave radiation at noon on a flat surface on the current day and m a x s w 12 h t its maximum value across the whole year dt is the time step in hr here chosen to be 6 snow surface temperature is parametrized as in boudhar et al 2016 t snow m i n 0 0 72 t a 2 47 in the case of a positive latent heat flux le the heat deficit is reduced proportionally to the amount of snow lost by sublimation during the time step 5 δ d t le l s 3600 d t sw e t d t 1 where l s is the latent heat of sublimation 2 834 mj kg melt can occur once the heat deficit reaches 0 if less than 1 5 mm of rain occurred during the previous 6 h melt is calculated by 6 m d t m f t rad 0 0125 p f r t r with m f the melt factor p precipitation mm f r equal to 1 if t a is larger than 0 c 0 otherwise and t r is the precipitation temperature maximum of 0 c and t a otherwise melt is given by 7 m d t σ t rad 273 15 4 273 15 4 0 0125 p f r t r 8 5 f u dt 6 r h e sat 6 11 0 00057 p a t a where f u 0 5 mm mbar 6hr r h is the relative humidity e sat the saturation vapor pressure mb and p a the air pressure in mb e sat taken over water for t a 0 and ice otherwise is calculated as in alduchov and eskridge 1996 p a is assumed to be constant with elevation h given by p a 1013 25 1 2 25577 10 5 h 5 25588 eqs 3 6 involve three parameters m f nm f max and tipm used to calculate ati see anderson 2006 which must be calibrated the rti originally also includes another parameter plwhc the relative fraction of liquid water holding capacity to the snowpack which we take to be fixed at 0 05 we parametrize sublimation based on the bulk aerodynamic method which assumes the latent heat flux le in w m2 to be proportional to wind speed and water vapor gradient between the surface and a given level z 8 le f s c f l s ρ κ u z q z q s log z z 0 2 where fsc is the grid cell fractional snow cover ρ is air density kg m3 κ is the von karman constant u z and q z are respectively the wind speed m s and specific humidity kg kg at height z q s is the surface specific humidity kg kg z 0 is the surface roughness length set to 0 001 following boudhar et al 2016 and f is a non dimensional stability factor defined based on the bulk richardson number ri 9 81 t a t snow z z 0 t a 273 15 u z 2 anderson 1976 brutsaert 1982 9 f 1 i f r i 0 1 5 r i 2 i f r i 0 u n s t a b l e 1 16 r i 0 75 i f r i 0 s t a b l e q s is calculated assuming surface saturation at t snow the model estimates swe at each grid cell we translate it to snow cover using the following formula 10 sc 0 85 tanh k s w e with k 100 m 1 boudhar et al 2011 and swe in meters we discuss 10 further in section 3 2 0 85 is selected as maximum allowable snow cover due the quasi absence of grid scale 500 m snow fractions larger than 85 in satellite observations this likely reflects the strong small scale variability of snow cover in the high atlas at high altitudes baba et al 2019 due to the large number of grid cells and associated computing time the three parameters m f nm f max and tipm are fitted by maximizing the nash sutcliffe coefficient nash and sutcliffe 1970 between the observed and simulated snow cover at 250 randomly selected grid points at altitudes representative of the distribution of altitudes across the whole basin to test the applicability of the rti snow17 model and compare our results with those of boudhar et al 2016 we also fit the parameters to the observed snow depth series at oukaimeden using the trmm precipitation estimate for the corresponding grid cell swe in the model is converted to snow depth s d to compare with oukaimeden measurements only with the formulation used in bouamri et al 2018 11 s d t s w e t ρ w ρ s t with ρ w 1000 k g m 3 density of liquid water and ρ s is snowpack density calculated as the average between the density of the previous snowpack 12 ρ s t ρ s t d t ρ m a x e τ f τ d t ρ m a x and that of fresh snow ρ n e w 67 9 51 3 e t a 2 6 hedstrom and pomeroy 1998 τ f τ 0 24 4800 s 1 is a characteristic time of density evolution 2 3 data 2 3 1 station data quality checked data is available at the oukaimeden automatic weather station located at 3200 m altitude near the oukaimeden ski resort about 75 km away from the border of our study region fig 1 b in a similar physio geographical setting daily snow depth is available for 6 seasons 2003 2006 and 2007 2010 and daily air temperature relative humidity and 2 meter wind speed are available from 2003 to 2016 with occasional gaps 5 14 of the data depending on the variable 30 minute air temperature was also measured from 2010 to 2018 daily precipitation data is not available at the station but only at the nearby caf club alpin français station located 600 m downslope for the 1989 2010 period 2 3 2 modis snow cover for snow cover data we use the modis terra snow cover daily l3 product mod10a1 at 500 m resolution hall and riggs 2016 the data is available from late february 2000 to present snow cover is detected based on the normalized difference snow index ndsi calculated from reflectances in the visible near infrared and middle infrared snow cover fraction is then estimated from the ndsi using an empirical relationship fitted to high resolution landsat images from various regions of the world because of frequent cloud 30 cover in the high atlas during the wet season many data are missing or potentially misclassified we apply the filtering algorithm introduced by marchane et al 2015 to filter missing data at the daily timescale and then average snow cover at a weekly timescale by comparing to station data and high resolution 8 m formosat 2 images marchane et al 2015 found that using this filtering process the mod10a1 product was able to accurately reproduce snow cover area in morocco s mountains including the timing of onset and melt fig 2 c shows the correspondence between observed snow depth and modis fractional snow cover for the oukaimeden station 2 3 3 topography elevation data is derived from the shuttle radar topography mission 90 meter resolution dataset version 4 1 strm90 jarvis et al 2008 and resampled by bilinear interpolation to the modis land surface temperature resolution of about 1 km 2 3 4 surface temperature spatially distributed air temperature is derived from the global modis land surface temperature lst product mod11a1 l3 version 6 at 1 km resolution wan et al 2015 mod11a1 available from february 2000 to present provides an estimate of land surface temperature based on clear sky thermal infrared brightness temperatures twice every 24 h daytime measure at 10 30 and nighttime measure at 22 30 local solar time the underlying algorithms rely on additional modis data for local corrections including snow and cloud cover emissivity or water vapor details of the algorithm can be found in wan 2008 the modis lst data was shown to be accurate within 1 c in clear sky conditions for snow covered areas above 15 c hall et al 2008 below which air temperature seldom goes in the high atlas the strong correlation between lst and air temperature t a has been documented in a number of studies notably over snow cover hachem et al 2012 wang et al 2013 with root mean square errors of up to 4 5 c in cold mountain environments williamson et al 2014 modis lst has been used for distributed snow modeling with snow 17 by shamir and georgakakos 2014 in the mountains of turkey who found that lst derived air temperature was highly correlated to station temperature r 0 93 and performed well in estimating snow mass and maximum swe there are three main challenges associated with the use of lst for snow modeling first thermal satellite lst data collection is impossible under cloud cover since cloud top temperatures are measured instead ackerman et al 1998 many lst data are therefore missing and need to be filled second although highly correlated lst and air temperature are not the same and a correction needs to be applied third lst is measured only twice a day and we need to infer its daily cycle in order to run a snow model at 6 hour time steps 2 3 4 1 filling of missing lst values we fill missing lst values for daytime and nighttime series separately by first calculating the daily deviation to an estimated annual lst cycle and then interpolating missing values in both space and time since fewer than 20 years of data are available for any single day of the year and even less for some grid cells due to cloud cover and since lst can vary wildly on any given day we estimate an annual cycle for lst at each grid point by averaging lst data for each week of the year then we interpolate anomalies relative to that annual cycle as follows for each 50 km square in our domain if less than 75 of data is missing interpolation is performed spatially using 2d kriging with an exponential semivariogram fitted over the full area for all days and years available in the week of interest if not then interpolation is performed temporally using an autoregressive model of order 1 fitted to the time series of lst anomalies at each grid point 2 3 4 2 derivation of air temperature from modis lst in general the difference between lst and t a is positive during the day as solar radiation warms up the land surface and negative at night because the land surface cools faster than the air fig 4 a the lst t a relationship has been extensively studied both theoretically and empirically the general conclusion is that it depends on local variables such as land cover terrain aspect the presence of snow or soil moisture e g mildrexer et al 2011 here we apply a simple linear correction t a α l s t β inferred from the 30 minute air temperature data measured at oukaimeden station we select the closest station measurement for each lst value in the oukaimeden grid cell and estimate regression coefficients α β for each three month period october december january march april june and july september and for day and nighttime measures separately the resulting rmse is found to be 3 c the same correction is assumed valid for the whole basin admittedly a very broad assumption justified here however by our lack of additional station temperature data 2 3 4 3 daily cycle to interpolate the daily temperature cycle to 6 hour time steps 0 6 12 and 18 h local time a common approach is to rely on harmonic functions e g shamir and georgakakos 2014 however daily cycles of lst and air temperature do not appear to match sine waves fig 4 b so we opt for a different formula at each grid point the hour of sunset and sunrise are calculated based on day slope and aspect duffie and beckman 2013 the nighttime lst derived t a is assumed representative for the whole night from two hours after sunset till sunrise between sunrise and the daytime lst measure lst derived t a is linearly interpolated between the daytime measure and two hours after sunset it is interpolated using a second degree polynomial with a maximum forced at two hours after solar noon at the oukaimeden station the resulting lst derived daily cycle of air temperature is on average within 0 5 c of the observations fig 4 b 2 3 5 precipitation in complex mountainous terrain with little to no station data as is the case of the high atlas precipitation data from high resolution satellite based products is often the only option available here we use 6 hourly precipitation from the trmm tmpa trmm multi satellite precipitation analysis 3b42 version 7 dataset which provides 3 hourly precipitation estimates by combining remotely sensed data and correcting with rain gauge data on a monthly basis huffman et al 2001 trmm was selected for its relatively high spatial and temporal resolution and its overall better performance over our region compared to chirps and gpm trmm data covers the period 1998 to present it suffers from numerous biases particularly at high elevations first accurately capturing snowfall remains challenging particularly over snow surfaces second in regions with few stations gauge correction is uncertain and made difficult by the topography e g rain shadows third trmm tends to underestimate wet season precipitation a particular concern in the present case milewski et al 2015 derin et al 2016 hashemi et al 2017 ouatiki et al 2017 the accuracy of the trmm 3b42 v7 dataset was evaluated over the oum er rbia watershed by ouatiki et al 2017 while trmm precipitation is unreliable at the daily timescale its quality improves when averaged in space and time at the annual time scale they found rmse values of 150 250 mm for stations at 1600 1800 m altitude a large part of the bias occurs during summer when local convective events are badly captured but underestimation of winter precipitation is also important in mountain stations their results are consistent with those of milewski et al 2015 who analyzed trmm v7 data over northern morocco including the oum er rbia at the location of the only currently available high altitude station caf station trmm indicates an average of 725 mm of precipitation from november to april against 350 mm measured at the station still topography varies substantially within the 25x25km trmm grid cell ranging from 1000 m in the valleys to 4167 m at the jbel toubkal morocco s highest peak despite its deficiencies trmm remains our best baseline to estimate precipitation in this rugged and ungauged terrain 2 3 6 cloud cover to calculate downward longwave and shortwave we adopt the formulations of follum et al 2015 used in the ghssa model downer et al 2006 13 s w s 0 k r k atm k c k s k t l w σ a t a 273 15 4 1 0 17 n 2 where s 0 1366 w m 2 is the solar constant a is air emissivity taken to be 0 757 when snow is present n is fractional cloud cover and the k factors are coefficients of reduction of incoming solar radiation due to earth sun distance k r atmospheric scattering k atm cloud absorption k c terrain slope and aspect k s and topographic shading k t the daily cycle of solar radiation is included in k s in particular k c 1 0 65 n 2 we estimate n from the terra modis mod06 l2 version 6 cloud cover dataset platnick et al 2015 available at 5 km resolution from late february 2000 to present the data is first linearly interpolated to extract 6 hourly time series over the whole available period 9 sequences of more than two consecutive days are missing during which modis lst data is also unavailable in these cases we randomly sample cloud cover values at each grid cell among non missing values in the same cell and during the same month finally the data is resampled at the mod10a1 1 km resolution selected to run the model 2 3 7 high resolution dynamical downscaling of era interim for humidity and wind data we rely on dynamically downscaled output from the mit regional climate model mrcm forced with era interim tuel et al 2020 mrcm is based on the abdus salam international centre for theoretical physics regional climate model version 3 regcm3 but with significant enhancements of model physics and notably a coupling with the integrated biosphere simulator land surface scheme ibis dynamical downscaling is performed for the 1982 2011 period at a resolution of 12 km details of the simulation including model setup and performance can be found in tuel et al 2020 we extract 6 hourly 2 meter wind speed u specific humidity q and air temperature t a over our domain air temperature is used only to compare to the modis lst derived estimates since the 12 km resolution is too coarse to account for all the sharp elevation gradients we downscale specific humidity and temperature using 1 km elevation and altitude lapse rates estimated at each time step wind speed is left unchanged within a 12 km mrcm cell with temperature t 12 humidity q 12 and elevation z 12 the downscaling to the 1 km grid cell with elevation z is given by 14 t a t 12 λ z z 12 log q log q 12 μ z z 12 where λ μ are elevation lapse rates estimated from the mrcm output at each time step 2 4 model configuration and experiments we run the snow model at a 6 hourly time step over the 2001 2011 period 10 hydrological years during which all the forcing data is available at the native modis lst mod11a1 resolution of about 1000 by 1000 m while that resolution may not be ideal to account for the small scale variability in snow cover characteristic of the high atlas baba et al 2019 we select it here as a compromise between resolution and computation time for comparison 1 km2 is the resolution at which snow17 is run over the coterminous united states within the snow data assimilation program carroll et al 2006 to check our results we also ran the model at a 500 m resolution over the whole basin and found no significant difference with the 1 km experiment to test the sensitivity of the results to uncertainties in the forcing data specifically temperature and precipitation we fit the snow model under several configurations first three experiments in which an offset of respectively 3 0 and 3 c is applied to the lst derived air temperature with precipitation kept constant we refer hereafter to these experiments as lst 3 lst 0 and lst 3 the lst 0 experiment is also considered to be the control experiment second in the fourth experiment trmm 33 trmm precipitation is amplified by 33 under unchanged lst derived air temperature finally we also assess the influence of the choice of swe snow cover relationship by fitting the snow model to a more conservative version of 10 sc 0 8 tanh k s w e with k 40 the two relationships can be compared on fig 7 b we refer to this experiment as sc40 optimized model parameters are determined for each experiment as described in section 2 2 3 results and discussion 3 1 comparison of mrcm output with modis temperature data and oukaimeden station data fig 5 shows the december march mean daily lst derived air temperature and the corresponding mrcm field overall there is relatively good agreement between the two with mrcm colder by 0 92 c on average while mrcm temperatures undoubtedly suffer from bias as well this suggests that the lst correction calculated at the oukaimeden station and applied to the whole area reasonably succeeds in capturing the overall magnitude of surface air temperature during the wet season for the most part the two datasets are within 3 c of each other but the difference is largely elevation dependent mrcm is colder in the valleys by 1 2 c and warmer at high elevations especially where snow cover is present by 3 4 c fig 5 this is likely due to the lack of snow cover in mrcm largely absent at 12 km resolution which leads to a warm bias due to snow albedo feedback and potentially to an uncorrected cold bias in the modis data due to the presence of snow at high elevation shamir and georgakakos 2014 above zero air temperatures are frequent at high elevations during winter t a 0 c 47 of the time between december and march at the oukaimeden station in such cases if snow is on the ground lst will be colder than the air temperature since the snow surface temperature will not exceed 0 c mrcm also fails to capture much of the contrast between north and south facing slopes these are small scale less than10 km effects unresolved at the chosen resolution our imposed 3 c range around the lst derived air temperature in the sensitivity data should therefore be enough to capture the true air temperature values at the oukaimeden station the annual cycles of both mrcm and modis lst derived air temperature are in good agreement with a slight warm bias for mrcm 0 5 c and insignificant bias for modis 0 12 c unsurprising here since observations are used to define the linear correction fig 6 a the spread of daily deviations to each series annual cycle is also well captured although here mrcm performs better rmse of 1 8 c against 3 c for modis fig 6 b mrcm also performs well for daily surface wind and humidity the correlation of daily 2 meter wind speed with station data is quite low r 0 18 but is higher at the monthly time scale r 0 59 the distribution of daily wind values also closely follows that of the observations fig 6 c in addition daily variability of specific humidity is reasonably captured correlation of 0 66 bias of 0 1 g kg and rmse of 0 8 g kg or 33 of the mean which highlights the performance of mrcm and the accuracy of the downscaling from equation 14 3 2 testing the snow model at the oukaimeden station the snow model forced with modis lst derived air temperature trmm precipitation empirical estimates of incoming radiation and mrcm surface wind and humidity is fitted to the observed snow depth value at the oukaimeden station with m f 0 05 nm f max 2 5 and tipm 0 15 there is a very good fit between the annual cycles of observed and modeled snow depth fig 7 a the rapid melt starting in early march is nevertheless faster in the simulation compared to observations while inter annual variability is not correctly captured likely due to trmm biases weekly fractional snow cover is not far off from the modis estimates fig 7 b unsurprisingly given the characteristic patchiness of snow cover within a grid cell baba et al 2019 modis snow cover is often smaller than the fractional coverage inferred from the modeled swe series which is itself not perfect peak swe occurs around march 1st and averages 240 mm in the simulation against an observed value of 300 mm bouamri et al 2018 a negative bias consistent with that of trmm precipitation at high elevations sublimation losses average 90 mm of water equivalent or 21 4 4 6 of snowfall in good agreement with the 25 estimate of lópez moreno et al 2017 obtained for the same station 3 3 comparison of the distributed snow model results to snow cover data the allowable range and calibrated values of the three model parameters for all basin wide experiments are given in table 1 like follum et al 2015 we find that m f is the most sensitive for the calibration but that nm f max is slightly more sensitive than tipm near the optimal m f two or three combinations of nm f max and tipm often yield nash sutcliffe coefficient values not far from the maximum thus while the calibration of m f is probably more reliable it is constrained by the observed disappearance of the snowpack once the heat deficit has reached 0 that of the other two parameters should be seen with some caution in addition while fitted parameter values for the station experiment may seem similar to those for the lst 3 experiment they are obtained by optimizing with respect to pointwise observed snow depth and not modis snow cover as in other experiments and precipitation at the exact station location is not available either snow depth at the station may also not be representative of conditions prevailing for the 1 km grid cell at the basin scale the fitted model reproduces much of the characteristics of the snow cover distribution as inferred from the modis data the magnitude and variability of snow cover are well approximated both at the daily and seasonal timescale fig 8 some short term peaks in snow cover are underestimated as in january 2007 fig 8 b or overestimated as in march 2009 fig 8 c this is not unexpected given the uncertainty in the forcing data one should also remember that modis snow cover is itself an imperfect measure of snowpack extent even when averaged at the weekly timescale non missing data is not free of errors and the filtering algorithm implemented here may fail in certain circumstances e g particularly persistent cloud cover baba et al 2019 looking at different elevation ranges we find that mean snow cover and its inter annual variability are also well reproduced fig 8 d and 9 particularly the timing and speed of snowpack build up and melt still the model tends to overestimate snow cover at high elevations 2500 m and underestimate it at low elevations the latter is not particularly critical since snow cover below 1500 m is mostly scarce and short lived and stores little to no water over the winter season the former however suggests an overestimation of the snow water content or an inadequacy of our swe fractional snow cover relationship for a given swe we may be underestimating the variability of snow cover below 1 km and therefore falsely inflating the corresponding fractional snow cover the fraction of snow to total precipitation is also useful to consider based on the modis lst derived air temperature the fraction of snowfall to annual precipitation ranges from 2 to 3 at the lowest elevations 800 m to more than 65 near the highest peaks fig 10 b areas above 2500 m which account for most of the snowpack receive about 52 respectively 75 of their annual respectively november april precipitation as snow the comparison with the caf station figures snowfall is 50 of annual and 68 of november april precipitation fig 10 d suggests that the modis lst derived air temperature may still be positively biased with respect to real world t a the higher snow fractions in the lst 3 run are indeed closer to observed values another possibility is that precipitation is preferentially underestimated when it is solid a common problem with satellite based estimates derin et al 2016 fayad et al 2017 thus automatically decreasing the fraction of snow to annual precipitation 3 4 snow model output latent heat fluxes the high atlas is characterized by rather dry conditions even at high altitudes during winter for instance the average relative humidity between december and march at the oukaimeden station 3200 m asl is only 46 together with persistent snow cover above 2500 m and occasional strong winds fig 6 c conditions are met for large latent heat fluxes in the control lst 0 simulation we find for the basin as a whole that snowpack losses by sublimation amount to 0 095 km3 on average which is small compared to total precipitation 1 9 of annual precipitation 2 8 of november april precipitation and to the total snowfall 9 relative losses increase rapidly with elevation from only 5 at 2000 m to about 30 above 3500 m fig 10 d near 3200 m altitude sublimation removes 20 of the snowpack not far from the 25 found by lópez moreno et al 2017 at oukaimeden still the difference remains significant part of it may be due to the fact that the latitude of our domain is slightly higher and relative humidity is consequently larger 46 at oukaimeden vs 54 at similar locations in our domain at 12 km the resolution of our downscaled regional climate simulations remains coarse for snowpack modeling and therefore wind speed at high elevations may also be underestimated a possibility that would require additional wind measurements to verify inter annual variability in sublimation losses is substantial they vary between 18 and 42 above 3500 m and even below 2000 m range from 1 to 5 these estimates are naturally very dependent on the wind humidity and temperature data used as forcing they are about a third lower in the lst 3 simulation compared to lst 0 and half again as much in lst 3 but display the same strong dependence to elevation fig 10 d for instance above 3000 m 21 of the snowpack is lost to sublimation on average in lst 0 14 in lst 3 and 32 in lst 3 3 5 snow model output basin wide swe volume although no basin wide swe observations are available it is useful to estimate the total snowpack water content inferred by the model constrained by the observed snow cover the average annual cycle of basin wide swe is shown on fig 11 a the build up of the snowpack is gradual starting in early november a peak is reached around february 1st followed by melting ending in mid may at its peak basin wide swe reaches 150 million cubic meters mcm or 0 15 km3 fig 11 a this is a small fraction of cumulative snowfall for the area which amounts to roughly 1 km3 due to the high inter annual variability of precipitation the swe peak can range anywhere from 50 to 450 mcm a much larger variability than that of precipitation most of the snowpack even at its peak is concentrated above 2500 m an area which covers about 15 of the whole basin fig 11 b despite frequent snowfall areas below 2000 m are insignificant in terms of water equivalent melt is rapid essentially occurring between february and may fig 11 d when temperatures quickly rise above freezing at all altitudes however even during winter positive temperatures are frequent and this is reflected in non negligible melt rates throughout the snowy season our model indicates an average cumulative melt of 260 mcm between october and june 3 6 sensitivity to input data and modeling assumptions finally we turn to the sensitivity analysis of basin wide swe and snow water balance to uncertainties in the forcing data and to the swe snow cover relationship optimal parameters are found for each experiment so that they all reproduce basin wide and elevation specific snow cover series though most except lst 3 and the sc40 experiments tend to overestimate snow cover between 2500 and 3000 m as in fig 9 the build up of the snowpack is also too slow in the sc40 run no doubt due to the larger swe required to reach maximum snow cover section 2 4 however constrained as they are by the observed snow cover series the various experiments all show somewhat similar basin wide swe values between 120 and 210 mcm at their peaks fig 11 c the maximum peak swe is unsurprisingly attained in the sc40 experiment since it requires a higher swe to attain the same fractional snow cover this still amount to a significant uncertainty which is difficult to resolve an empirical backward swe reconstruction constrained by the evolution of the snow cover fayad et al 2017 may be useful as a future step to test the validity of our swe results for instance using higher resolution sentinel data additional station data even at low elevations would be helpful to improve temperature estimates because our approach uses snow cover to fit the snow model the swe snow cover relationship is a major source of variability in the results as we see in the case of the sc40 experiment in the control formulation maximum cell snow cover is reached for 5 mm swe roughly 15 40 cm of snow depth increasing that threshold to 10 mm as in sc40 increases peak basin wide swe by 60mcm and therefore the extreme case of a 20 mm threshold could potentially bring the result up to 300mcm or double what we found in the control experiment the analysis of spring runoff volumes could help put an upper bound on that figure fig 10 precipitation biases however are more challenging to tackle with no high altitude data at hand statistical models to correct and distribute precipitation within a trmm grid cell based on fine scale topography may help resolve some of the biases due to the complexity of the terrain at small scales another possibility would be to calibrate additional parameters in snow17 which we took constant here in particular the temperature threshold to define snowfall and a precipitation under catch adjustment factor follum et al 2015 still the potential underestimation of precipitation does not seem to impact the swe estimates very much they are only about 10 higher in the trmm 33 experiment than in the control run in the absence of station data it is difficult to determine whether this correction is enough to compensate for underestimated or even missing snowfall episodes in the trmm data results by hashemi et al 2017 over the united states suggest that winter precipitation above 3000 m altitude may be underestimated by as much as 50 for a fixed swe snow cover relationship the impact of precipitation uncertainty on peak swe seems small fig 11 c though it would matter for melting rates too much precipitation at fixed snow cover may lead to overestimation of melt during the cold season as discussed previously sublimation rates are also uncertain mainly because of biases in air temperature and surface wind speed the low rates found in the lst 3 experiment seem unlikely based on what is known in such environments lópez moreno et al 2017 and our 20 estimate above 3000 m is probably at the low end of the range rates of 45 were measured on the southward much drier side of the atlas thus setting an upper bound to what can reasonably be expected in our region overall a 20 35 range is realistic 4 conclusion this study offers the first implementation of a distributed physically based empirical snow model at large scale in the high atlas of morocco this region is characterized by a very sparse station network and therefore we relied on satellite based and dynamically downscaled meteorological data as forcing for the snow 17 model and compared the model simulated snow cover to remotely sensed snow cover estimates from modis the model accurately captures the distribution of snow cover at various elevation bands as well as its temporal dynamics when applied at the oukaimeden station results were also consistent while our coarse resolution and the numerous uncertainties associated with the forcing data bring important limitations to our results we find reasonable confidence in a basin wide average swe of 0 15 0 175 km3 almost exclusively concentrated above the 2500 m altitude line we also find that sublimation losses are substantial ranging from 0 06 to 0 14 km3 for the whole basin and amounting on average to 20 of total snowfall above 3000 m in keeping with previous results lópez moreno et al 2017 our results offer a first order estimate of sublimation in the high atlas in absence of even a sparse network of direct sublimation observations in addition the model offers the potential for assessing the sensitivity of high atlas snowpack to climate change of critical importance for the region many improvements to our approach are possible whether regarding the selection and correction of data or the modeling itself and the advent of higher resolution snow cover estimates with sentinel 5 will certainly help in this direction baba et al 2019 however as long as station observations remain so scarce any estimate of snow dynamics in the high atlas will remain quite uncertain in particular more direct measurements of latent heat fluxes are necessary to validate sublimation parametrizations and modeled fluxes in this region credit authorship contribution statement alexandre tuel conceptualization methodology software visualization writing original draft abdelghani chehbouni resources writing review editing elfatih a b eltahir conceptualization methodology supervision writing review editing declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgements this work was made possible through funding from the office chérifien des phosphates ocp through université mohamed vi polytechnique morocco the authors would like to thank michael follum and jeffrey niemann for providing their rti snow17 code and abdelghani boudhar and chakir adnane from lmi trema for sharing the oukaimeden station data 
4820,snowpack melting in the high atlas constitutes the major source of freshwater for the semi arid agricultural plains of central morocco snow runoff fills dams during spring and recharges groundwater thus providing the necessary water for irrigation and hydropower production despite its critical importance for the region basic questions about the high atlas snowpack remain largely unanswered in particular the spatial and temporal distribution of snow water equivalent as well as sublimation losses potentially significant in this region have yet to be thoroughly investigated the scarcity of ground data has been a major obstacle to investigating snow processes in the high atlas here we demonstrate the potential of remotely sensed meteorological variables and downscaled climate reanalysis data to gain important insights into snow water balance in a semi arid region we apply a distributed energy balance snow model based on snow17 constrained by topographic data meteorological data from satellites and high resolution dynamically downscaled era interim data to simulate snowpack dynamics within the oum er rbia watershed at the heart of morocco s high atlas the simulations are compared to modis snow cover maps and observed snow depth at one field station results show that the spatial extent and temporal dynamics of snow cover at various elevation ranges are accurately captured the snowpack is essentially concentrated above 2500 m extends over 500 6000 km2 and holds 0 05 0 4 km3 at its peak in early february additionally we find that losses by sublimation range from 0 06 to 0 14 km3 for an average of 0 09 km3 a year about 10 of all snowfall above 3000 m elevation sublimation removes on average 20 of the snowpack finally we discuss the sensitivity of our results to uncertainties in the forcing meteorological data this study reveals the essential components of the snow water balance in the high atlas and paves the way for better understanding of its sensitivity to climate change keywords empirical snow model snow17 swe morocco sublimation 1 introduction while average annual precipitation hardly reaches at best 500 mm over morocco s agricultural plains the atlas mountains which rise up to 4000 m high usually receive up to twice that amount most often in the form of snow between november and march boudhar et al 2009 consequently mountain precipitation is a major source of freshwater for the country especially its agriculture which accounts for 90 of all water use the melting of the winter snowpack during spring substantially contributes to river discharge up to 50 in some local catchments boudhar et al 2009 filling dams beyond the wet season and allowing for continued water use and irrigation until the end of the growing season in may infiltration of mountain runoff also accounts for much of the aquifer recharge on which agricultural activities in the fertile plains at the foot of the atlas critically depend chehbouni et al 2008 yet although the importance of the mountain snowpack for water resources is well established much remains unknown about its characteristics and spatio temporal dynamics accurate estimates of snow water equivalent swe fields in the high atlas are necessary to improve our understanding of the regional hydrology and thus water resources management in addition assessing the sensitivity of the snowpack to meteorological and climate variables is critical in order to project its response to climate change which is expected to bring warmer and much drier conditions over morocco in the near future tuel and eltahir 2020 tuel et al 2020 still the scarcity of ground measurements combined to the complex regional topography and the large spatio temporal variability in hydroclimate fayad et al 2017 tuel and eltahir 2018 create significant challenges to snowpack monitoring and estimation at the basin scale satellite based snow cover maps can provide a good first estimate of the extent and temporal evolution of the snowpack as was shown for the atlas mountains marchane et al 2015 where enough station data is available complex physically based snow models that resolve the energy balance at the surface and may even include several snow layers liston and elder 2006 herrero and polo 2016 boudhar et al 2016 are usually preferred recently baba et al 2019 applied snowmodel a physical snowpack evolution model based on the snow energy balance to simulate snowpack dynamics in the rheyara catchment of the high atlas outside our study zone down to a resolution of 8 m their approach was made possible by the small size 220 km2 of the catchment and its relatively high density of weather stations the large data requirements of such models however make them less applicable over large areas where even basic data like temperature is often missing therefore essential questions remain unanswered for the high atlas most importantly how much water is stored in the snowpack and how does this amount vary in space and time at the catchment scale conceptual distributed snow models typically based on simple parametrizations of melt as a function of temperature and forced with remotely sensed data spatially interpolated station data or analytical mesoscale model output can yield useful results marks et al 1999 clark et al 2011 raleigh and lundquist 2012 when ground data is particularly scarce or unavailable one possibility is to resort to remotely sensed snow cover maps and reconstruct swe backwards in time using the observed snow fraction time series at each grid point as constraints molotch 2009 raleigh and lundquist 2012 an advantage of this approach is that it only requires temperature as input if no new snowfall accumulates after peak swe on the downside it can only reconstruct swe during the melt phase is not useful to make swe projections and is also very sensitive to biases in snow cover data molotch and margulis 2008 often forward configurations in which precipitation is partitioned between rain and snow and accumulated snowfall stored as swe are preferred raleigh and lundquist 2012 in their simplest form empirical snow models only require temperature and precipitation and temperature although more complex formulations involving radiative fluxes are also available hock 1999 follum et al 2015 several previous studies that relied on station measurements have shown that they were able to satisfactorily estimate snow accumulation and melting in various climate zones including the high atlas follum et al 2015 boudhar et al 2016 bouamri et al 2018 such models have also been successfully applied to reconstruct swe fields in various mediterranean climate regions shamir and georgakakos 2007 guan et al 2013 fassnacht et al 2017 fayad et al 2017 however station data is often missing which has led to increased interest in the applicability of gridded climatological datasets like climatological reanalyses e g era interim dee et al 2011 station based interpolated datasets or satellite based products to be used as input to snow models muñoz et al 2014 shamir and georgakakos 2014 however questions still remain as to their accuracy to represent fine scale conditions in complex topography especially precipitation maxima near mountain peaks muñoz et al 2014 to circumvent that problem reanalysis data can be downscaled to finer resolution with regional climate models wrzesien et al 2017 an approach that has proved successful over several mountainous regions alonso gonzález et al 2018 and reference therein the forcing datasets can suffer from numerous biases however especially precipitation which in complex terrain typically exhibits strong spatio temporal variability that is hard to capture regional models can be unreliable since precipitation relies on parametrizations that require observations as input and gridded satellite based precipitation products like trmm huffman et al 2007 chirps funk et al 2015 or gpm huffman et al 2014 are often the only estimates available such products usually tend to underestimate snowfall and wet season precipitation in mountain regions derin et al 2016 hashemi et al 2017 which may bias the results particularly since parameter fitting of empirical snow models is typically highly sensitive to input uncertainty franz et al 2010 he et al 2011 few studies seem to rely on satellite based precipitation preferring model simulated precipitation wrzesien et al 2017 alonso gonzález et al 2018 or global station based products muñoz et al 2014 when direct interpolation from local stations is not possible in addition one downside of previous such studies is the absence of explicit sublimation fluxes yet because the high atlas has a particularly arid climate latent heat fluxes are significant locally 25 45 of accumulated snow has been found to be lost to sublimation schulz and de jong 2004 lópez moreno et al 2017 sublimation is known to vary significantly in space especially in complex mountain regions strasser et al 2008 any snow model applied at the basin scale in this area should therefore include latent heat fluxes which requires additional meteorological information notably atmospheric humidity the innovative aspect of this study is in how we estimate the spatial and temporal distributions of snowpack water content and sublimation in a large area of about 13 000 square kilometers in the high atlas using a distributed physically based snow model constrained by a combination of topographical data remotely sensed data and meteorological data dynamically downscaled down to 12 km to our knowledge no other study has attempted to assimilate data from such various sources to model snow in a data scarce region in addition we model sublimation explicitly to provide the first estimate of the spatial distribution of latent heat fluxes in the high atlas our focus is the oum er rbia watershed one of morocco s major agricultural regions and an important producer of hydropower which receives the most snowfall among all the country s main watersheds marchane et al 2015 and depends almost exclusively on mountain precipitation satellite based snow cover is used as a constraint in order to estimate snow model parameters while previous studies have suggested that the strong spatial variability of atlas snow cover warranted less than 500 m resolution baba et al 2019 we select a resolution of 1 km for our model based on data availability and computing power despite this limitation snow modeling at such a resolution and spatial scale has never been attempted for the moroccan atlas our aim is to capture the main features of variability in snow cover and provide a first order characterization of the snow water balance of the basin 2 data and methods 2 1 study area the oum er rbia with its 550 km length and 3 km3 annual discharge is one of morocco s major rivers its water supports 30 of the country s irrigated land 50 of its hydropower capacity and provides for the daily needs of seven million people including two major cities casablanca and marrakech it flows northwestward from the northern slopes of the high atlas morocco s largest mountain range our 13 104 km2 study area covers the drainage basins of four main dams corresponding to the major tributaries of the oum er rbia all located at the foothills of the high atlas fig 1 elevation in the area ranges from 621 m to 3890 m for a mean of 1882 m vegetation is sparse consisting mostly in bare soil and grass and rare shrubs in areas where snow is present baba et al 2019 with forest cover essentially limited to the valleys the area is under a rather continental climate characterized by a large amplitude of temperature annual cycles knippertz et al 2003 temperatures are minimal in january when they range from mild 12 c below 1000 m to cold 5 c above 3000 m even at that time the foothills seldom go below freezing by contrast peak summer temperatures occurring in july are very high 35 c at the lowest elevations and still quite warm above 3000 m 10 15 c ouatiki et al 2017 conditions are overall quite dry even at high elevations where annual precipitation reaches 800 1000 mm against lows of 250 mm in the plains to the west about 80 of annual precipitation occurs during the wet season from october to april when the region is under the influence of north atlantic westerlies which bring the occasional storm systems responsible for most of the precipitation knippertz et al 2003 tuel and eltahir 2018 above 1500 m snowfall is common during the winter months persistent snow cover is frequent above 2500 m typically extends from december to april and rapidly disappears by the end of may boudhar et al 2010 fig 2 though inter annual variability is substantial marchane et al 2015 our study area encompasses most of the zones in the oum er rbia watershed that receive at least modest snow amounts on average during the winter fig 2 high atlas snow cover is characterized by substantial variability in both space and time a key feature in arid environments boudhar et al 2010 at the annual time scale wet season precipitation exhibits a large inter annual variability knippertz et al 2003 with a coefficient of variation of about 0 3 tuel and eltahir 2018 a variability that is reflected in seasonal snow extent marchane et al 2016 within a season precipitation also tends to occur in short and irregular storm events warm temperatures over a few dry weeks can lead to complete disappearance of the snowpack even in mid winter at high elevations schulz and de jong 2004 because net radiation dominates the snow energy balance lópez moreno 2017 snow cover is also highly dependent on terrain slope and aspect with bare ground not uncommon even at high altitude marchane et al 2015 2 2 snow model in mediterranean mountains the snow energy balance is largely dominated by radiative fluxes lópez moreno et al 2017 boudhar et al 2016 therefore we select the radiation derived temperature index rti melt formulation follum et al 2015 2019 within the framework of the snow 17 model anderson 2006 snow 17 simulates snow accumulation and loss empirically using meteorological variables to account for the various energy balance equation terms the main difference in this paper with the follum et al 2015 study is that we add a sublimation module based on a bulk aerodynamic flux formulation we give here a brief summary of model structure see fig 3 and equations readers are referred to follum et al 2015 and anderson 2006 for more details rti uses a proxy temperature t rad calculated from the surface radiation balance instead of actual air temperature to estimate snow melt it therefore includes spatial variability in potential melt due to variability in incoming shortwave and longwave t rad is given by the following 1 t rad t l w 1 α s w l e s σ 1 4 where l w is the downward longwave radiation s w downward shortwave α snow albedo le the latent heat flux see below s the snow surface emissivity taken to be 1 and σ the stefan boltzmann constant although equation 1 neglects many terms of the energy balance e g ground heat flux sensible heat flux at first order t rad represents the snow surface temperature that balances net surface radiation and can be interpreted as a measure of the amount of energy available to heat melt the snowpack in particular t rad can be above 0 c short and longwave are calculated as in follum et al 2015 see section 2 3 6 with the exception that we assume no vegetation cover an approximation we make due to the high atlas sparse vegetation tree cover is present at lower elevations below 1500 m where snow cover is short lived due to relatively high temperatures snow albedo is parametrized according to the formula proposed by brock et al 2000 and calibrated for the high atlas by boudhar et al 2016 2 α 0 8 0 21 log 10 t d where t d is the number of days since last snowfall fresh snow albedo is set at 0 8 a low value but which best fits observations in the high atlas likely connected to the high concentration of mineral dust due to the proximity of the sahara desert xu 2018 air temperature t a is used to determine the phase of precipitation we assume it will fall as snow if t a is below 0 c snowpack is characterized by its snow water equivalent swe in mm and its heat deficit d t a measure of the energy needed to bring the snowpack to its melting temperature 0 c the heat deficit is expressed in mm of snow water equivalent anderson 2006 at each time step the heat deficit is updated as new snow falls as snow sublimates or as energy is transferred from the atmosphere to the snowpack the change in heat deficit due to differences between snowpack and air temperatures is expressed as 3 δ d t n m f a t i t snow where ati is the antecedent temperature index in c t snow is the snow surface temperature and 4 nmf n m f max sw 12 h t m a x s w 12 h t d t where nm f max is the maximum negative melt factor in mm c hr sw 12 h m a x is the incoming shortwave radiation at noon on a flat surface on the current day and m a x s w 12 h t its maximum value across the whole year dt is the time step in hr here chosen to be 6 snow surface temperature is parametrized as in boudhar et al 2016 t snow m i n 0 0 72 t a 2 47 in the case of a positive latent heat flux le the heat deficit is reduced proportionally to the amount of snow lost by sublimation during the time step 5 δ d t le l s 3600 d t sw e t d t 1 where l s is the latent heat of sublimation 2 834 mj kg melt can occur once the heat deficit reaches 0 if less than 1 5 mm of rain occurred during the previous 6 h melt is calculated by 6 m d t m f t rad 0 0125 p f r t r with m f the melt factor p precipitation mm f r equal to 1 if t a is larger than 0 c 0 otherwise and t r is the precipitation temperature maximum of 0 c and t a otherwise melt is given by 7 m d t σ t rad 273 15 4 273 15 4 0 0125 p f r t r 8 5 f u dt 6 r h e sat 6 11 0 00057 p a t a where f u 0 5 mm mbar 6hr r h is the relative humidity e sat the saturation vapor pressure mb and p a the air pressure in mb e sat taken over water for t a 0 and ice otherwise is calculated as in alduchov and eskridge 1996 p a is assumed to be constant with elevation h given by p a 1013 25 1 2 25577 10 5 h 5 25588 eqs 3 6 involve three parameters m f nm f max and tipm used to calculate ati see anderson 2006 which must be calibrated the rti originally also includes another parameter plwhc the relative fraction of liquid water holding capacity to the snowpack which we take to be fixed at 0 05 we parametrize sublimation based on the bulk aerodynamic method which assumes the latent heat flux le in w m2 to be proportional to wind speed and water vapor gradient between the surface and a given level z 8 le f s c f l s ρ κ u z q z q s log z z 0 2 where fsc is the grid cell fractional snow cover ρ is air density kg m3 κ is the von karman constant u z and q z are respectively the wind speed m s and specific humidity kg kg at height z q s is the surface specific humidity kg kg z 0 is the surface roughness length set to 0 001 following boudhar et al 2016 and f is a non dimensional stability factor defined based on the bulk richardson number ri 9 81 t a t snow z z 0 t a 273 15 u z 2 anderson 1976 brutsaert 1982 9 f 1 i f r i 0 1 5 r i 2 i f r i 0 u n s t a b l e 1 16 r i 0 75 i f r i 0 s t a b l e q s is calculated assuming surface saturation at t snow the model estimates swe at each grid cell we translate it to snow cover using the following formula 10 sc 0 85 tanh k s w e with k 100 m 1 boudhar et al 2011 and swe in meters we discuss 10 further in section 3 2 0 85 is selected as maximum allowable snow cover due the quasi absence of grid scale 500 m snow fractions larger than 85 in satellite observations this likely reflects the strong small scale variability of snow cover in the high atlas at high altitudes baba et al 2019 due to the large number of grid cells and associated computing time the three parameters m f nm f max and tipm are fitted by maximizing the nash sutcliffe coefficient nash and sutcliffe 1970 between the observed and simulated snow cover at 250 randomly selected grid points at altitudes representative of the distribution of altitudes across the whole basin to test the applicability of the rti snow17 model and compare our results with those of boudhar et al 2016 we also fit the parameters to the observed snow depth series at oukaimeden using the trmm precipitation estimate for the corresponding grid cell swe in the model is converted to snow depth s d to compare with oukaimeden measurements only with the formulation used in bouamri et al 2018 11 s d t s w e t ρ w ρ s t with ρ w 1000 k g m 3 density of liquid water and ρ s is snowpack density calculated as the average between the density of the previous snowpack 12 ρ s t ρ s t d t ρ m a x e τ f τ d t ρ m a x and that of fresh snow ρ n e w 67 9 51 3 e t a 2 6 hedstrom and pomeroy 1998 τ f τ 0 24 4800 s 1 is a characteristic time of density evolution 2 3 data 2 3 1 station data quality checked data is available at the oukaimeden automatic weather station located at 3200 m altitude near the oukaimeden ski resort about 75 km away from the border of our study region fig 1 b in a similar physio geographical setting daily snow depth is available for 6 seasons 2003 2006 and 2007 2010 and daily air temperature relative humidity and 2 meter wind speed are available from 2003 to 2016 with occasional gaps 5 14 of the data depending on the variable 30 minute air temperature was also measured from 2010 to 2018 daily precipitation data is not available at the station but only at the nearby caf club alpin français station located 600 m downslope for the 1989 2010 period 2 3 2 modis snow cover for snow cover data we use the modis terra snow cover daily l3 product mod10a1 at 500 m resolution hall and riggs 2016 the data is available from late february 2000 to present snow cover is detected based on the normalized difference snow index ndsi calculated from reflectances in the visible near infrared and middle infrared snow cover fraction is then estimated from the ndsi using an empirical relationship fitted to high resolution landsat images from various regions of the world because of frequent cloud 30 cover in the high atlas during the wet season many data are missing or potentially misclassified we apply the filtering algorithm introduced by marchane et al 2015 to filter missing data at the daily timescale and then average snow cover at a weekly timescale by comparing to station data and high resolution 8 m formosat 2 images marchane et al 2015 found that using this filtering process the mod10a1 product was able to accurately reproduce snow cover area in morocco s mountains including the timing of onset and melt fig 2 c shows the correspondence between observed snow depth and modis fractional snow cover for the oukaimeden station 2 3 3 topography elevation data is derived from the shuttle radar topography mission 90 meter resolution dataset version 4 1 strm90 jarvis et al 2008 and resampled by bilinear interpolation to the modis land surface temperature resolution of about 1 km 2 3 4 surface temperature spatially distributed air temperature is derived from the global modis land surface temperature lst product mod11a1 l3 version 6 at 1 km resolution wan et al 2015 mod11a1 available from february 2000 to present provides an estimate of land surface temperature based on clear sky thermal infrared brightness temperatures twice every 24 h daytime measure at 10 30 and nighttime measure at 22 30 local solar time the underlying algorithms rely on additional modis data for local corrections including snow and cloud cover emissivity or water vapor details of the algorithm can be found in wan 2008 the modis lst data was shown to be accurate within 1 c in clear sky conditions for snow covered areas above 15 c hall et al 2008 below which air temperature seldom goes in the high atlas the strong correlation between lst and air temperature t a has been documented in a number of studies notably over snow cover hachem et al 2012 wang et al 2013 with root mean square errors of up to 4 5 c in cold mountain environments williamson et al 2014 modis lst has been used for distributed snow modeling with snow 17 by shamir and georgakakos 2014 in the mountains of turkey who found that lst derived air temperature was highly correlated to station temperature r 0 93 and performed well in estimating snow mass and maximum swe there are three main challenges associated with the use of lst for snow modeling first thermal satellite lst data collection is impossible under cloud cover since cloud top temperatures are measured instead ackerman et al 1998 many lst data are therefore missing and need to be filled second although highly correlated lst and air temperature are not the same and a correction needs to be applied third lst is measured only twice a day and we need to infer its daily cycle in order to run a snow model at 6 hour time steps 2 3 4 1 filling of missing lst values we fill missing lst values for daytime and nighttime series separately by first calculating the daily deviation to an estimated annual lst cycle and then interpolating missing values in both space and time since fewer than 20 years of data are available for any single day of the year and even less for some grid cells due to cloud cover and since lst can vary wildly on any given day we estimate an annual cycle for lst at each grid point by averaging lst data for each week of the year then we interpolate anomalies relative to that annual cycle as follows for each 50 km square in our domain if less than 75 of data is missing interpolation is performed spatially using 2d kriging with an exponential semivariogram fitted over the full area for all days and years available in the week of interest if not then interpolation is performed temporally using an autoregressive model of order 1 fitted to the time series of lst anomalies at each grid point 2 3 4 2 derivation of air temperature from modis lst in general the difference between lst and t a is positive during the day as solar radiation warms up the land surface and negative at night because the land surface cools faster than the air fig 4 a the lst t a relationship has been extensively studied both theoretically and empirically the general conclusion is that it depends on local variables such as land cover terrain aspect the presence of snow or soil moisture e g mildrexer et al 2011 here we apply a simple linear correction t a α l s t β inferred from the 30 minute air temperature data measured at oukaimeden station we select the closest station measurement for each lst value in the oukaimeden grid cell and estimate regression coefficients α β for each three month period october december january march april june and july september and for day and nighttime measures separately the resulting rmse is found to be 3 c the same correction is assumed valid for the whole basin admittedly a very broad assumption justified here however by our lack of additional station temperature data 2 3 4 3 daily cycle to interpolate the daily temperature cycle to 6 hour time steps 0 6 12 and 18 h local time a common approach is to rely on harmonic functions e g shamir and georgakakos 2014 however daily cycles of lst and air temperature do not appear to match sine waves fig 4 b so we opt for a different formula at each grid point the hour of sunset and sunrise are calculated based on day slope and aspect duffie and beckman 2013 the nighttime lst derived t a is assumed representative for the whole night from two hours after sunset till sunrise between sunrise and the daytime lst measure lst derived t a is linearly interpolated between the daytime measure and two hours after sunset it is interpolated using a second degree polynomial with a maximum forced at two hours after solar noon at the oukaimeden station the resulting lst derived daily cycle of air temperature is on average within 0 5 c of the observations fig 4 b 2 3 5 precipitation in complex mountainous terrain with little to no station data as is the case of the high atlas precipitation data from high resolution satellite based products is often the only option available here we use 6 hourly precipitation from the trmm tmpa trmm multi satellite precipitation analysis 3b42 version 7 dataset which provides 3 hourly precipitation estimates by combining remotely sensed data and correcting with rain gauge data on a monthly basis huffman et al 2001 trmm was selected for its relatively high spatial and temporal resolution and its overall better performance over our region compared to chirps and gpm trmm data covers the period 1998 to present it suffers from numerous biases particularly at high elevations first accurately capturing snowfall remains challenging particularly over snow surfaces second in regions with few stations gauge correction is uncertain and made difficult by the topography e g rain shadows third trmm tends to underestimate wet season precipitation a particular concern in the present case milewski et al 2015 derin et al 2016 hashemi et al 2017 ouatiki et al 2017 the accuracy of the trmm 3b42 v7 dataset was evaluated over the oum er rbia watershed by ouatiki et al 2017 while trmm precipitation is unreliable at the daily timescale its quality improves when averaged in space and time at the annual time scale they found rmse values of 150 250 mm for stations at 1600 1800 m altitude a large part of the bias occurs during summer when local convective events are badly captured but underestimation of winter precipitation is also important in mountain stations their results are consistent with those of milewski et al 2015 who analyzed trmm v7 data over northern morocco including the oum er rbia at the location of the only currently available high altitude station caf station trmm indicates an average of 725 mm of precipitation from november to april against 350 mm measured at the station still topography varies substantially within the 25x25km trmm grid cell ranging from 1000 m in the valleys to 4167 m at the jbel toubkal morocco s highest peak despite its deficiencies trmm remains our best baseline to estimate precipitation in this rugged and ungauged terrain 2 3 6 cloud cover to calculate downward longwave and shortwave we adopt the formulations of follum et al 2015 used in the ghssa model downer et al 2006 13 s w s 0 k r k atm k c k s k t l w σ a t a 273 15 4 1 0 17 n 2 where s 0 1366 w m 2 is the solar constant a is air emissivity taken to be 0 757 when snow is present n is fractional cloud cover and the k factors are coefficients of reduction of incoming solar radiation due to earth sun distance k r atmospheric scattering k atm cloud absorption k c terrain slope and aspect k s and topographic shading k t the daily cycle of solar radiation is included in k s in particular k c 1 0 65 n 2 we estimate n from the terra modis mod06 l2 version 6 cloud cover dataset platnick et al 2015 available at 5 km resolution from late february 2000 to present the data is first linearly interpolated to extract 6 hourly time series over the whole available period 9 sequences of more than two consecutive days are missing during which modis lst data is also unavailable in these cases we randomly sample cloud cover values at each grid cell among non missing values in the same cell and during the same month finally the data is resampled at the mod10a1 1 km resolution selected to run the model 2 3 7 high resolution dynamical downscaling of era interim for humidity and wind data we rely on dynamically downscaled output from the mit regional climate model mrcm forced with era interim tuel et al 2020 mrcm is based on the abdus salam international centre for theoretical physics regional climate model version 3 regcm3 but with significant enhancements of model physics and notably a coupling with the integrated biosphere simulator land surface scheme ibis dynamical downscaling is performed for the 1982 2011 period at a resolution of 12 km details of the simulation including model setup and performance can be found in tuel et al 2020 we extract 6 hourly 2 meter wind speed u specific humidity q and air temperature t a over our domain air temperature is used only to compare to the modis lst derived estimates since the 12 km resolution is too coarse to account for all the sharp elevation gradients we downscale specific humidity and temperature using 1 km elevation and altitude lapse rates estimated at each time step wind speed is left unchanged within a 12 km mrcm cell with temperature t 12 humidity q 12 and elevation z 12 the downscaling to the 1 km grid cell with elevation z is given by 14 t a t 12 λ z z 12 log q log q 12 μ z z 12 where λ μ are elevation lapse rates estimated from the mrcm output at each time step 2 4 model configuration and experiments we run the snow model at a 6 hourly time step over the 2001 2011 period 10 hydrological years during which all the forcing data is available at the native modis lst mod11a1 resolution of about 1000 by 1000 m while that resolution may not be ideal to account for the small scale variability in snow cover characteristic of the high atlas baba et al 2019 we select it here as a compromise between resolution and computation time for comparison 1 km2 is the resolution at which snow17 is run over the coterminous united states within the snow data assimilation program carroll et al 2006 to check our results we also ran the model at a 500 m resolution over the whole basin and found no significant difference with the 1 km experiment to test the sensitivity of the results to uncertainties in the forcing data specifically temperature and precipitation we fit the snow model under several configurations first three experiments in which an offset of respectively 3 0 and 3 c is applied to the lst derived air temperature with precipitation kept constant we refer hereafter to these experiments as lst 3 lst 0 and lst 3 the lst 0 experiment is also considered to be the control experiment second in the fourth experiment trmm 33 trmm precipitation is amplified by 33 under unchanged lst derived air temperature finally we also assess the influence of the choice of swe snow cover relationship by fitting the snow model to a more conservative version of 10 sc 0 8 tanh k s w e with k 40 the two relationships can be compared on fig 7 b we refer to this experiment as sc40 optimized model parameters are determined for each experiment as described in section 2 2 3 results and discussion 3 1 comparison of mrcm output with modis temperature data and oukaimeden station data fig 5 shows the december march mean daily lst derived air temperature and the corresponding mrcm field overall there is relatively good agreement between the two with mrcm colder by 0 92 c on average while mrcm temperatures undoubtedly suffer from bias as well this suggests that the lst correction calculated at the oukaimeden station and applied to the whole area reasonably succeeds in capturing the overall magnitude of surface air temperature during the wet season for the most part the two datasets are within 3 c of each other but the difference is largely elevation dependent mrcm is colder in the valleys by 1 2 c and warmer at high elevations especially where snow cover is present by 3 4 c fig 5 this is likely due to the lack of snow cover in mrcm largely absent at 12 km resolution which leads to a warm bias due to snow albedo feedback and potentially to an uncorrected cold bias in the modis data due to the presence of snow at high elevation shamir and georgakakos 2014 above zero air temperatures are frequent at high elevations during winter t a 0 c 47 of the time between december and march at the oukaimeden station in such cases if snow is on the ground lst will be colder than the air temperature since the snow surface temperature will not exceed 0 c mrcm also fails to capture much of the contrast between north and south facing slopes these are small scale less than10 km effects unresolved at the chosen resolution our imposed 3 c range around the lst derived air temperature in the sensitivity data should therefore be enough to capture the true air temperature values at the oukaimeden station the annual cycles of both mrcm and modis lst derived air temperature are in good agreement with a slight warm bias for mrcm 0 5 c and insignificant bias for modis 0 12 c unsurprising here since observations are used to define the linear correction fig 6 a the spread of daily deviations to each series annual cycle is also well captured although here mrcm performs better rmse of 1 8 c against 3 c for modis fig 6 b mrcm also performs well for daily surface wind and humidity the correlation of daily 2 meter wind speed with station data is quite low r 0 18 but is higher at the monthly time scale r 0 59 the distribution of daily wind values also closely follows that of the observations fig 6 c in addition daily variability of specific humidity is reasonably captured correlation of 0 66 bias of 0 1 g kg and rmse of 0 8 g kg or 33 of the mean which highlights the performance of mrcm and the accuracy of the downscaling from equation 14 3 2 testing the snow model at the oukaimeden station the snow model forced with modis lst derived air temperature trmm precipitation empirical estimates of incoming radiation and mrcm surface wind and humidity is fitted to the observed snow depth value at the oukaimeden station with m f 0 05 nm f max 2 5 and tipm 0 15 there is a very good fit between the annual cycles of observed and modeled snow depth fig 7 a the rapid melt starting in early march is nevertheless faster in the simulation compared to observations while inter annual variability is not correctly captured likely due to trmm biases weekly fractional snow cover is not far off from the modis estimates fig 7 b unsurprisingly given the characteristic patchiness of snow cover within a grid cell baba et al 2019 modis snow cover is often smaller than the fractional coverage inferred from the modeled swe series which is itself not perfect peak swe occurs around march 1st and averages 240 mm in the simulation against an observed value of 300 mm bouamri et al 2018 a negative bias consistent with that of trmm precipitation at high elevations sublimation losses average 90 mm of water equivalent or 21 4 4 6 of snowfall in good agreement with the 25 estimate of lópez moreno et al 2017 obtained for the same station 3 3 comparison of the distributed snow model results to snow cover data the allowable range and calibrated values of the three model parameters for all basin wide experiments are given in table 1 like follum et al 2015 we find that m f is the most sensitive for the calibration but that nm f max is slightly more sensitive than tipm near the optimal m f two or three combinations of nm f max and tipm often yield nash sutcliffe coefficient values not far from the maximum thus while the calibration of m f is probably more reliable it is constrained by the observed disappearance of the snowpack once the heat deficit has reached 0 that of the other two parameters should be seen with some caution in addition while fitted parameter values for the station experiment may seem similar to those for the lst 3 experiment they are obtained by optimizing with respect to pointwise observed snow depth and not modis snow cover as in other experiments and precipitation at the exact station location is not available either snow depth at the station may also not be representative of conditions prevailing for the 1 km grid cell at the basin scale the fitted model reproduces much of the characteristics of the snow cover distribution as inferred from the modis data the magnitude and variability of snow cover are well approximated both at the daily and seasonal timescale fig 8 some short term peaks in snow cover are underestimated as in january 2007 fig 8 b or overestimated as in march 2009 fig 8 c this is not unexpected given the uncertainty in the forcing data one should also remember that modis snow cover is itself an imperfect measure of snowpack extent even when averaged at the weekly timescale non missing data is not free of errors and the filtering algorithm implemented here may fail in certain circumstances e g particularly persistent cloud cover baba et al 2019 looking at different elevation ranges we find that mean snow cover and its inter annual variability are also well reproduced fig 8 d and 9 particularly the timing and speed of snowpack build up and melt still the model tends to overestimate snow cover at high elevations 2500 m and underestimate it at low elevations the latter is not particularly critical since snow cover below 1500 m is mostly scarce and short lived and stores little to no water over the winter season the former however suggests an overestimation of the snow water content or an inadequacy of our swe fractional snow cover relationship for a given swe we may be underestimating the variability of snow cover below 1 km and therefore falsely inflating the corresponding fractional snow cover the fraction of snow to total precipitation is also useful to consider based on the modis lst derived air temperature the fraction of snowfall to annual precipitation ranges from 2 to 3 at the lowest elevations 800 m to more than 65 near the highest peaks fig 10 b areas above 2500 m which account for most of the snowpack receive about 52 respectively 75 of their annual respectively november april precipitation as snow the comparison with the caf station figures snowfall is 50 of annual and 68 of november april precipitation fig 10 d suggests that the modis lst derived air temperature may still be positively biased with respect to real world t a the higher snow fractions in the lst 3 run are indeed closer to observed values another possibility is that precipitation is preferentially underestimated when it is solid a common problem with satellite based estimates derin et al 2016 fayad et al 2017 thus automatically decreasing the fraction of snow to annual precipitation 3 4 snow model output latent heat fluxes the high atlas is characterized by rather dry conditions even at high altitudes during winter for instance the average relative humidity between december and march at the oukaimeden station 3200 m asl is only 46 together with persistent snow cover above 2500 m and occasional strong winds fig 6 c conditions are met for large latent heat fluxes in the control lst 0 simulation we find for the basin as a whole that snowpack losses by sublimation amount to 0 095 km3 on average which is small compared to total precipitation 1 9 of annual precipitation 2 8 of november april precipitation and to the total snowfall 9 relative losses increase rapidly with elevation from only 5 at 2000 m to about 30 above 3500 m fig 10 d near 3200 m altitude sublimation removes 20 of the snowpack not far from the 25 found by lópez moreno et al 2017 at oukaimeden still the difference remains significant part of it may be due to the fact that the latitude of our domain is slightly higher and relative humidity is consequently larger 46 at oukaimeden vs 54 at similar locations in our domain at 12 km the resolution of our downscaled regional climate simulations remains coarse for snowpack modeling and therefore wind speed at high elevations may also be underestimated a possibility that would require additional wind measurements to verify inter annual variability in sublimation losses is substantial they vary between 18 and 42 above 3500 m and even below 2000 m range from 1 to 5 these estimates are naturally very dependent on the wind humidity and temperature data used as forcing they are about a third lower in the lst 3 simulation compared to lst 0 and half again as much in lst 3 but display the same strong dependence to elevation fig 10 d for instance above 3000 m 21 of the snowpack is lost to sublimation on average in lst 0 14 in lst 3 and 32 in lst 3 3 5 snow model output basin wide swe volume although no basin wide swe observations are available it is useful to estimate the total snowpack water content inferred by the model constrained by the observed snow cover the average annual cycle of basin wide swe is shown on fig 11 a the build up of the snowpack is gradual starting in early november a peak is reached around february 1st followed by melting ending in mid may at its peak basin wide swe reaches 150 million cubic meters mcm or 0 15 km3 fig 11 a this is a small fraction of cumulative snowfall for the area which amounts to roughly 1 km3 due to the high inter annual variability of precipitation the swe peak can range anywhere from 50 to 450 mcm a much larger variability than that of precipitation most of the snowpack even at its peak is concentrated above 2500 m an area which covers about 15 of the whole basin fig 11 b despite frequent snowfall areas below 2000 m are insignificant in terms of water equivalent melt is rapid essentially occurring between february and may fig 11 d when temperatures quickly rise above freezing at all altitudes however even during winter positive temperatures are frequent and this is reflected in non negligible melt rates throughout the snowy season our model indicates an average cumulative melt of 260 mcm between october and june 3 6 sensitivity to input data and modeling assumptions finally we turn to the sensitivity analysis of basin wide swe and snow water balance to uncertainties in the forcing data and to the swe snow cover relationship optimal parameters are found for each experiment so that they all reproduce basin wide and elevation specific snow cover series though most except lst 3 and the sc40 experiments tend to overestimate snow cover between 2500 and 3000 m as in fig 9 the build up of the snowpack is also too slow in the sc40 run no doubt due to the larger swe required to reach maximum snow cover section 2 4 however constrained as they are by the observed snow cover series the various experiments all show somewhat similar basin wide swe values between 120 and 210 mcm at their peaks fig 11 c the maximum peak swe is unsurprisingly attained in the sc40 experiment since it requires a higher swe to attain the same fractional snow cover this still amount to a significant uncertainty which is difficult to resolve an empirical backward swe reconstruction constrained by the evolution of the snow cover fayad et al 2017 may be useful as a future step to test the validity of our swe results for instance using higher resolution sentinel data additional station data even at low elevations would be helpful to improve temperature estimates because our approach uses snow cover to fit the snow model the swe snow cover relationship is a major source of variability in the results as we see in the case of the sc40 experiment in the control formulation maximum cell snow cover is reached for 5 mm swe roughly 15 40 cm of snow depth increasing that threshold to 10 mm as in sc40 increases peak basin wide swe by 60mcm and therefore the extreme case of a 20 mm threshold could potentially bring the result up to 300mcm or double what we found in the control experiment the analysis of spring runoff volumes could help put an upper bound on that figure fig 10 precipitation biases however are more challenging to tackle with no high altitude data at hand statistical models to correct and distribute precipitation within a trmm grid cell based on fine scale topography may help resolve some of the biases due to the complexity of the terrain at small scales another possibility would be to calibrate additional parameters in snow17 which we took constant here in particular the temperature threshold to define snowfall and a precipitation under catch adjustment factor follum et al 2015 still the potential underestimation of precipitation does not seem to impact the swe estimates very much they are only about 10 higher in the trmm 33 experiment than in the control run in the absence of station data it is difficult to determine whether this correction is enough to compensate for underestimated or even missing snowfall episodes in the trmm data results by hashemi et al 2017 over the united states suggest that winter precipitation above 3000 m altitude may be underestimated by as much as 50 for a fixed swe snow cover relationship the impact of precipitation uncertainty on peak swe seems small fig 11 c though it would matter for melting rates too much precipitation at fixed snow cover may lead to overestimation of melt during the cold season as discussed previously sublimation rates are also uncertain mainly because of biases in air temperature and surface wind speed the low rates found in the lst 3 experiment seem unlikely based on what is known in such environments lópez moreno et al 2017 and our 20 estimate above 3000 m is probably at the low end of the range rates of 45 were measured on the southward much drier side of the atlas thus setting an upper bound to what can reasonably be expected in our region overall a 20 35 range is realistic 4 conclusion this study offers the first implementation of a distributed physically based empirical snow model at large scale in the high atlas of morocco this region is characterized by a very sparse station network and therefore we relied on satellite based and dynamically downscaled meteorological data as forcing for the snow 17 model and compared the model simulated snow cover to remotely sensed snow cover estimates from modis the model accurately captures the distribution of snow cover at various elevation bands as well as its temporal dynamics when applied at the oukaimeden station results were also consistent while our coarse resolution and the numerous uncertainties associated with the forcing data bring important limitations to our results we find reasonable confidence in a basin wide average swe of 0 15 0 175 km3 almost exclusively concentrated above the 2500 m altitude line we also find that sublimation losses are substantial ranging from 0 06 to 0 14 km3 for the whole basin and amounting on average to 20 of total snowfall above 3000 m in keeping with previous results lópez moreno et al 2017 our results offer a first order estimate of sublimation in the high atlas in absence of even a sparse network of direct sublimation observations in addition the model offers the potential for assessing the sensitivity of high atlas snowpack to climate change of critical importance for the region many improvements to our approach are possible whether regarding the selection and correction of data or the modeling itself and the advent of higher resolution snow cover estimates with sentinel 5 will certainly help in this direction baba et al 2019 however as long as station observations remain so scarce any estimate of snow dynamics in the high atlas will remain quite uncertain in particular more direct measurements of latent heat fluxes are necessary to validate sublimation parametrizations and modeled fluxes in this region credit authorship contribution statement alexandre tuel conceptualization methodology software visualization writing original draft abdelghani chehbouni resources writing review editing elfatih a b eltahir conceptualization methodology supervision writing review editing declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgements this work was made possible through funding from the office chérifien des phosphates ocp through université mohamed vi polytechnique morocco the authors would like to thank michael follum and jeffrey niemann for providing their rti snow17 code and abdelghani boudhar and chakir adnane from lmi trema for sharing the oukaimeden station data 
4821,it is necessary to properly simulate groundwater levels in order to ensure an adequate management of scarce water resources however simulating groundwater levels accurately is one of the challenging issues in hydrology because of its complex system in the current study gene expression programming gep and m5 model tree m5 are combined with ensemble empirical mode decomposition eemd and complementary ensemble empirical mode decomposition ceemd methods for pre processing input data to produce hybrid models for groundwater simulation the performance of hybrid models is compared with the outputs of sole gep and m5 and their counterparts combined with wavelet transform wt the results indicate that pre processing can improve the performance of the simple models and wt as well as ceemd are better than eemd to produce hybrid models by employing pre processing techniques the improvement of r2 for gep and m5 regarding multiple linear regression mlr as a benchmark is 13 11 6 65 and 8 20 for eemd gep ceemd gep and ceemd m5 respectively while it is 3 28 for eemd m5 for the first data set for the second data set the improvement of eemd gep 103 23 ceemd gep 125 81 and ceemd m5 77 42 and for the third data set eemd gep 76 ceemd gep 80 and ceemd m5 54 in the second and third data set the performance of eemd m5 decreases again according to the results hybrid gep shows the best performance for groundwater water simulation while m5 combined with eemd is not recommended for the simulation due to its weak performance keywords groundwater modeling statistical modeling signal processing empirical mode decomposition hybrid model abbreviations ai artificial intelligence anfis neuro fuzzy inference system ann artificial neural network bias mean bias ceemd complementary ensemble empirical mode decomposition eemd ensemble empirical mode decomposition ceemdan complete eemd with adaptive noise emd empirical mode decomposition imf intrinsic mode function ga genetic algorithm gep gene expression programming gp genetic programming m5 m5 model tree mars multivariate adaptive regression splines rbias relative mean bias rmse root mean squared error rrmse relative root mean squared error svm support vector machine wt wavelet transform wgep wavelet gene expression programming wm5 wavelet m5 model tree mlr multiple linear regression 1 introduction groundwater represents one of the important resources to supply water for human activities such as farming or domestic water supply nourani and mousavi 2016 it is therefore necessary to simulate groundwater levels to investigate the sustainability of the resources for human activities due to the complexity of hydrological systems ouali et al 2017 artificial intelligence ai models with high ability to model complex phenomena can be used for groundwater level simulation sivapragasam et al 2015 for instance daliakopoulos et al 2005 and taormina et al 2012 utilized artificial neural networks ann for groundwater level simulation and prediction shiri et al 2013 employed ann adaptive neuro fuzzy inference system anfis gene expression programming gep and support vector machine svm for groundwater simulation meshgi et al 2014 introduced an empirical technique using genetic programming gp for estimation of baseflow time series they employed groundwater level fluctuation catchment area and daily baseflow values as inputs for gp they believed that by using gp minimal inputs were needed meanwhile physical information was preserved for the estimation the main reason for the simulation of hydrological time series is solving problems related to hydrology concepts chadalawada et al 2020 due to the presence of high fluctuations in hydrologic time series most of the models are not capable of properly simulating the highly non stationary hydrologic time series with the purpose of improving the existing models a number of studies have attempted to integrate sophisticated statistical methods when simulating highly non stationary time series lee and ouarda 2012 methods such as wavelet transform wt empirical mode decomposition emd ensemble empirical mode decomposition eemd and complementary ensemble empirical mode decomposition ceemd were used to pre process a time series then the pre processed time series were employed as inputs for ai based models the models employing a pre processing technique are known as hybrid models kisi and shiri 2011 nourani et al 2009 solgi et al 2017 wang et al 2015b wt has been considered by several studies and indicated its ability to improve the performance of ai based models to handle non stationary time series in a groundwater level simulating rezaie balf et al 2017 employed wt in a combination with the m5 model m5 and multivariate adaptive regression splines mars monthly groundwater level air temperature and rainfall time series were decomposed by wt to sub signals to be used as inputs for m5 and mars they showed that the usage of sub signals could improve the performance of the models nourani et al 2019a combined wt with m5 to find an efficient way for modeling suspended sediment load produced by a catchment they decomposed non stationary runoff and sediment time series by applying wt in order to improve the performance of m5 their results showed better performance of m5 combined with wt for modeling in another study nourani et al 2018 developed m5 by a combination with wt to model rainfall runoff then they compared the performance of their hybrid model with sole m5 and ann combined with wt the results indicated the hybrid m5 model improved by wt had the best performance nourani et al 2019b considered different data divisions to investigate the ability of m5 combined with wt in compare with sole m5 and ann for rainfall runoff modeling they proved that the hybrid m5 model was better than sole m5 and ann for modeling eemd is a direct intuitive and self adaptive method and is suitable for analyzing non stationary hydrologic time series wang et al 2015b research indicates that using eemd improves the ability of models for simulation hydro climatic processes lee and ouarda 2011 2012 masselot et al 2018 karthikeyan and nagesh kumar 2013 improved the accuracy of auto regressive models by wt and emd for pre processing of non stationary time series huang et al 2014 combined eemd with svm for monthly streamflow simulation and indicated that the hybrid model possesses a high accuracy in another study jiao et al 2016 illustrated the high performance of the hybrid svm eemd model for hydrological data simulation ceemd has the same structure of eemd but it uses a set of independent white noise as well as a collection of complementary pair white noise the ceemd has been employed by a number of studies to combine with ai based models ren et al 2015 supposed that the emd method and its developed versions could increase the accuracy of ai based models by converting a complex time series to simple ones they applied eemd ceemd and complete eemd with adaptive noise ceemdan to decompose the wind speed time series which is nonstationary nonlinear and not distributed normally emd and its developed versions were combined with svr and ann it was concluded that the generated hybrid models outperformed their simple counterparts and ceemdan svr was the most accurate model niu et al 2016 decomposed fine particulate matter time series by ceemd in order to simplify the time series for modeling with svr optimized by grey wolf optimizer based on their empirical study it was concluded that the model combined with ceemd had better accuracy xu et al 2017 adopted ceemd to decompose a time series to intrinsic mode functions imfs then multi kernel relevant vector machine was used for the prediction of components the authors found that the designed hybrid model had high performance due to the complex inherent wind speed time series yang and wang 2018 used ceemd for the decomposition of wind speed time series to imfs then neural networks were utilized for the prediction of each imf the authors proved that ceemd increased the accuracy of the prediction as groundwater level simulation accurately is one of the challenging issues in hydrology the main objective of the present paper is to reach accurate simulation using gep and the m5 model tree m5 combined with eemd and ceemd gep is employed because it is known as a strong ai based model for simulation gep produces so complex equations that are hard for interpretation m5 is also applied because it produces groups of linear equations that are easy to interpret considering a complex and simple ai based models helps to investigate whether it is possible to achieve an accurate simulation with less complexity or not gep and m5 and their hybrid counterparts wgep and wm5 has been previously considered by bahmani et al 2020 although bahmani et al 2020 showed that applying wt improves the performance of gep and m5 the results need to be improved for the purpose of ameliorating groundwater level simulation the present study investigates the ability of emd based pre processing technique which is developed recently no previous study has considered this combination of methods to improve the simulation of groundwater levels to do so eemd and ceemd are applied to decompose monthly groundwater levels precipitation and air temperature time series into sub series then the sub series are used as inputs to the gep and m5 models to produce hybrid models to simulate groundwater levels for one month ahead finally the improved models are evaluated using a number of evaluation criteria the present paper is organized as follows section 2 presents the methods section 3 includes information about the data and case study the results and discussion are presented in section 4 section 5 gives the conclusion of the present paper and recommendations for future works 2 methods in the current study the hybrid models of eemd and gep eemd gep eemd and m5 eemd m5 ceemd and gep ceemd gep plus ceemd and m5 ceemd m5 are employed for groundwater level simulation as there are several references that introduce the eemd ceemd gep and m5 models the present paper does not present the details of the various methods and models instead the concepts are briefly presented and references are provided 2 1 gene expression programming gep ferreira 2001 introduced gep based on evolutionary algorithms for modeling the evolution principle was primarily presented in biological concepts by linking historical chain events babovic 2005 the evolutionary algorithms mimic the mechanism of living organisms gep exploits the advantages of genetic algorithms ga and genetic programming gp to overcome their disadvantages in the gep model the genotype of chromosomes has a linear structure similar to ga while the phenotype of chromosomes has a tree structure with different shapes and sizes like gp ferreira 2001 the genotype is all or a part of the genetic compositions of a cell and the phenotype is an observable characteristic of an organism 2 2 m5 model tree m5 quinlan 1992 presented the m5 model according to the decision tree platform to form a relationship between dependent and independent variables m5 is the combination of linear regression and decision tree moreover it can be applied to analyze quantitative and qualitative variables quinlan 1992 m5 utilizes a top down approach to reach from a node at the top to a leaf at the bottom building m5 includes two steps the first step is dividing a node called parent node into nodes with smaller standard deviations using the splitting criterion kisi 2015 if the splitting criterion does not satisfy the node ends into a leaf the second step is pruning the grown tree to avoid overfitting by replacing leaves to linear regression function kisi 2015 for more details about m5 the reader is referred to quinlan 1986 and quinlan 1992 for more information about gep the reader is referred to ferreira 2001 ferreira 2002 and ferreira 2006 2 3 ensemble empirical mode decomposition eemd huang et al 1998 introduced emd as an empirical method to decompose a signal to its frequency components the decomposed components are known as intrinsic mode functions imfs if they meet the following conditions lee and ouarda 2012 a the number of local extrema should be equal to the number of zero crossings in case of any difference just one is allowed b the mean of the upper envelope calculated by local maxima and the lower envelope calculated by local minima should be zero the following steps demonstrate the decomposition of a time series x t through the sifting process by the emd algorithm huang et al 1998 1 determine the local maxima and minima of x t 2 fit an upper envelope on the local maxima by a cubic spline 3 fit a lower envelope on the local minima by a cubic spline 4 calculate the mean m t of the upper and lower envelopes which is the low frequency of the signal then subtract m t from the x t h 1 t x t m 1 t where h 1 t can be the first imf 5 determine a criterion to stop the process the criterion is called d k and commonly defined as d k t 0 t h 1 k 1 t h 1 k t 2 t 0 t h 1 k 1 t 2 where k refers to the additional repetition number for the sifting process so k indicates the current h 1 t and k 1 indicates the previous h 1 t a typical value for d k is between 0 2 and 0 3 huang et al 1998 6 6 if d k is bigger than the typical value the x t is replaced by the signal calculated from step 4 then the process is repeated from step 1 again 7 if d k is smaller than the typical value c 1 h 1 k is known as the first imf here the subscript 1 refers to the first imf and increases for each iteration of steps 1 to 5 the superscript k shows the number of sifting process 8 define the residual as r 1 x t c 1 k if the residual satisfies the condition a it is considered as x t and the steps 1 to 4 are retrieved to produce the next imf if the condition is not satisfied r is considered as the residual and the algorithm is stopped the described steps indicate that a signal is the sum of the produced imfs and the residual fig 1 illustrates the flowchart of the emd algorithm and the steps 1 to 8 and is adapted from premanode et al 2013 and qin et al 2015 the emd method may cause mode mixing the mode mixing is defined as different imfs with the same scale residing components or imfs with widely disparate scale components lee and ouarda 2010 wang et al 2015b to overcome the problem wu and huang 2009 improved emd by suggesting the ensemble emd eemd model the eemd method adds finite white noises into the targeted time series and into the imfs corresponding to each repetition of steps 1 to 3 wang et al 2015a wu and huang 2009 explained the necessity of prescribing the number of ensembles and the noise amplitude as the parameters of eemd they recommended controlling the added noise amplitude effect with the following equations wu and huang 2009 1a ε n ε n or 1b l n ε n ε 2 l n n 0 where ε is the added noise amplitude n is the number of ensemble members and ε n is the standard deviation of the error it is worthwhile of note that the added noise may not change the extrema since their amplitudes are too small wu and huang 2009 in the present paper the number of ensemble members is set to 100 the amplitude is set to 0 1 0 2 and 0 3 with the purpose of finding the best one for each time series also the emd method is investigated by considering the amplitude and ensemble number equal to zero and one respectively 2 4 complementary empirical mode decomposition ceemd in the eemd method the ε n may not be negligible if the number of the ensemble is not large enough ren et al 2015 to solve the disadvantage of eemd yeh et al 2010 recommended the application of ceemd to pre process a time series they explained that in ceemd the white noise is generated in pairs to cancel each other in the ceemd two mixtures of a time series and added noise can be derived by the following equation 2 1 1 1 1 s n m 1 m 2 where s is the time series n is the set of added white noise m 1 is the sum of the time series and positive noise and m 2 is the sum of the time series and negative noise from the eq 2 two ensemble imfs are obtained one with positive residues and another with negative residues of added noise thus the combination of both imfs is the final imf 2 5 evaluation criteria to evaluate the performance of the different models the following criteria are used in the present paper chebana et al 2014 a the determination coefficient or r 2 3 r 2 1 i 1 n x i obs x i sim 2 i 1 n x i obs x 2 b the root mean square error rmse 4 rmse i 1 n x i obs x i sim 2 n c the relative root mean square error 5 rrmse 100 i 1 n x i obs x i sim x i obs 2 n d the mean bias 6 bias i 1 n x i obs x i sim n e the relative mean bias 7 rbias 100 i 1 n x i obs x i sim x i obs n where x i obs and x i sim are the observed and simulated values x is the average of the observed values n is the number of observations and i is 1 2 n 3 data used monthly groundwater level values m of three observation wells as well as monthly precipitation mm and temperature c values of one meteorological station of the delfan plain located in iran are considered as the inputs of the hybrid models to simulate the groundwater level for one month ahead the plain is in the zagros mountain range between 47 21 and 48 21 e to 33 48 and 34 22 n and is 1700 to 2100 m above sea level fig 5 table 1 shows the geographical coordinates of the stations the monthly recorded data for the stations from 2002 to 2012 are considered and the observed values are divided into two parts the first part about 75 of the observations is employed for calibration the second part about 25 of the observations is employed for validation 4 results and discussion 4 1 results of hybrid eemd gep the applied evaluation criteria used to calibrate and validate the eemd gep model are presented in table 2 where ε 0 stands for the emd method and ε 0 1 0 2 and 0 3 refer to the amplitude of the added noises in the eemd method according to table 2 for well 1 the eemd gep model provides the best accuracy for ε 0 3 with r2 0 79 for the calibration and r2 0 69 for the validation rmse for ε 0 3 is smaller than other ε s in the calibration for validation rmses are close in all ε s rrmse bias and rbias for all situations is small for well 2 for ε 0 2 and 0 3 the performance of the hybrid eemd gep is almost the same since the value of ε 0 2 has a smaller rmse rrmse bias and rbias in comparison with ε 0 3 it is designated as the best ensemble for the hybrid model for well 3 the best performance is for ε 0 2 in which leads to good results for both validation and calibration for well 3 as well as well 1 the performance of the hybrid model with ε 0 is better than ε 0 1 and 0 3 for validation 4 2 results of hybrid eemd m5 the evaluation criteria for eemd m5 are presented in table 3 form table 3 it can be concluded that eemd m5 is not appropriate for simulation for well 1 although eemd m5 with ε 0 3 has the highest potential for calibration its validation r2 is equal to zero thus ε 0 3 does not provide sufficient results for simulation regarding validation it can be seen that the utilized parameter of ε 0 leads to a better performance of the hybrid model in comparison to ε 0 1 and 0 3 for well 2 eemd m5 shows high accuracy in calibration on the other hand in the case of validation the performance of the hybrid model is too weak and eemd m5 fails to properly simulate groundwater levels this may be due to overfitting the same conclusion holds for well 3 4 3 results of hybrid ceemd gep the evaluation criteria for ceemd gep presented in table 4 indicate that the performance of the hybrid model with different ε s is close however ε 0 2 can be selected as the best ensemble for all of the three wells regarding the evaluation criteria for all of observed wells the model shows high performance in terms of calibration but it decreases a little for the validation it is worthy of note that in the case of well 3 the hybrid model simulates the groundwater level with high accuracy 4 4 results of hybrid ceemd m5 table 5 presents the evaluation criteria for ceemd m5 based on table 5 it can be concluded that ε 0 3 is the suitable ensemble for the groundwater level simulation of well 1 and 3 while for well 2 ε 0 2 is better for all of the wells ceemd m5 indicates low performance because r2s decrease and biass increase in the validation thus the hybrid model is not suitable for groundwater level simulation 4 5 comparison of different models in the present section the performances of eemd gep eemd m5 ceemd gep and ceemd m5 are first compared with the observed values then the comparison of the present paper is done with the study of bahmani et al 2020 which the same variables were employed to simulate groundwater levels that study applied gep and m5 for the simulation and multiple linear regression mlr was used as a benchmark but instead of eemd and ceemd wt was used to produce hybrid models called wavelet gene expression programming wgep and wavelet m5 model tree wm5 to clarify the comparison of the simulated values by the eemd and ceemd hybrid models with the observed values figs 2 4 are presented respectively for the validation values to produce hybrid emd based models each of the groundwater levels air temperature and precipitation time series is decomposed to possible imfs and a residual then the generated imfs plus residuals we applied to gep and m5 as inputs for well 1 it can be seen that the graph of the hybrid eemd gep model is close to the graph corresponding to the observed values while there is a big difference between eemd m5 and the observed values in the case of wells 2 and 3 eemd gep shows close simulated and observed values but eemd m5 is not able to simulate groundwater levels properly this conclusion goes through simulated values produced by eemd m5 as well according to fig 3 applying ceemd improves the performance of models in comparison with using eemd for ceemd m5 the improvement is considerable but the model still is not suitable for the simulation for ceemd gep the simulated values are close to the observed values and for well 3 the model has high accuracy fig 4 presents scatter plots of simulated and observed groundwater levels the scatter plots also show that m5 combined with emd based pre processing is not suitable for groundwater simulation the comparison of the hybrid models produced by eemd and ceemd with the study of bahmani et al 2020 is done through r2s and rmses and presented in tables 6 and 7 table 6 indicates that the performance of gep and m5 increases in combination with wt and ceemd while the hybrid models generated by eemd do not show a good performance also the performance of gep increases in combination with all of the transformers but the hybrid m5 generated by eemd and ceemd presents low performance table 7 shows the performance evaluation of each model compared to mlr the percentages presented in table 7 indicate that applying pre processing considerably improves the performance of the models except hybrid m5 produced by eemd technique for example for well 1 the r2 improvement of wgep and wm5 is 16 39 in calibration and 14 75 and 26 23 in the validation for ceemd gep and ceemd m5 the improvement is 34 43 and 29 51 for calibration and 29 51 and 8 20 for validation respectively for other wells the hybrid models show an improvement except for eemd m5 again just the performance of eemd m5 reduces in the validation from the comparison of the present paper and the study by bahmani et al 2020 it can be understood that the hybrid models generated by wt and ceemd have better performance than the hybrid models produced by eemd method the comparison also confirms the conclusion from the study of karthikeyan and nagesh kumar 2013 which found the wavelet based method is better than the emd method in the field of hydrology in the present study the eemd based models in comparison with the wavelet based models indicate lower performance and its improved version called ceemd shows performance as good as the wavelet based models 5 conclusions the results of gep and m5 combined with eemd and ceemd to simulate groundwater levels are presented in the current paper the performance of the best models is compared with the study by bahmani et al 2020 to find the most accurate model for groundwater level simulation the results of the present paper demonstrate the hybrid models derived by gep is better than the other models eemd m5 is not suitable for the simulation because of the lowest performance possibly due to overfitting the m5 model uses the greedy search algorithm to divide observed values into perfectly split subsets blum and langley 1997 the greedy algorithm searches a global optimum by utilizing a heuristic analysis from locally optimal choices at each step without any reevaluation cormen et al 2009 if there is a big difference between the calibration and validation values m5 is not able to adequately simulate the values in validation gep randomly produces chromosomes to find the best solution hence by running the model several times it is possible to recognize well simulated values the results of eemd and ceemd based models illustrate the importance of ε for modeling and its impact on the accuracy of the hybrid models no specified rule for ε determination has been presented and selecting ε depends on the features of a time series such as mean and extreme values therefore it is recommended to find an optimal value for ε for a given specific hydrological time series finally to pre process a time series and simulate groundwater level wt and gep respectively are recommended hence utilizing wgep for groundwater simulation is suggested for future studies it is highly recommended to investigate the effect of gep s parameters on the simulation performance to improve emd methods new techniques such as partly ensemble mode decomposition has been developed and can be considered for the objectives of the present work it is suggested to investigate these approaches along with other new techniques to produce hybrid models for groundwater level simulation declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgements the presents work was partially supported by the natural sciences and engineering research council nserc of canada and the canada research chair program 
4821,it is necessary to properly simulate groundwater levels in order to ensure an adequate management of scarce water resources however simulating groundwater levels accurately is one of the challenging issues in hydrology because of its complex system in the current study gene expression programming gep and m5 model tree m5 are combined with ensemble empirical mode decomposition eemd and complementary ensemble empirical mode decomposition ceemd methods for pre processing input data to produce hybrid models for groundwater simulation the performance of hybrid models is compared with the outputs of sole gep and m5 and their counterparts combined with wavelet transform wt the results indicate that pre processing can improve the performance of the simple models and wt as well as ceemd are better than eemd to produce hybrid models by employing pre processing techniques the improvement of r2 for gep and m5 regarding multiple linear regression mlr as a benchmark is 13 11 6 65 and 8 20 for eemd gep ceemd gep and ceemd m5 respectively while it is 3 28 for eemd m5 for the first data set for the second data set the improvement of eemd gep 103 23 ceemd gep 125 81 and ceemd m5 77 42 and for the third data set eemd gep 76 ceemd gep 80 and ceemd m5 54 in the second and third data set the performance of eemd m5 decreases again according to the results hybrid gep shows the best performance for groundwater water simulation while m5 combined with eemd is not recommended for the simulation due to its weak performance keywords groundwater modeling statistical modeling signal processing empirical mode decomposition hybrid model abbreviations ai artificial intelligence anfis neuro fuzzy inference system ann artificial neural network bias mean bias ceemd complementary ensemble empirical mode decomposition eemd ensemble empirical mode decomposition ceemdan complete eemd with adaptive noise emd empirical mode decomposition imf intrinsic mode function ga genetic algorithm gep gene expression programming gp genetic programming m5 m5 model tree mars multivariate adaptive regression splines rbias relative mean bias rmse root mean squared error rrmse relative root mean squared error svm support vector machine wt wavelet transform wgep wavelet gene expression programming wm5 wavelet m5 model tree mlr multiple linear regression 1 introduction groundwater represents one of the important resources to supply water for human activities such as farming or domestic water supply nourani and mousavi 2016 it is therefore necessary to simulate groundwater levels to investigate the sustainability of the resources for human activities due to the complexity of hydrological systems ouali et al 2017 artificial intelligence ai models with high ability to model complex phenomena can be used for groundwater level simulation sivapragasam et al 2015 for instance daliakopoulos et al 2005 and taormina et al 2012 utilized artificial neural networks ann for groundwater level simulation and prediction shiri et al 2013 employed ann adaptive neuro fuzzy inference system anfis gene expression programming gep and support vector machine svm for groundwater simulation meshgi et al 2014 introduced an empirical technique using genetic programming gp for estimation of baseflow time series they employed groundwater level fluctuation catchment area and daily baseflow values as inputs for gp they believed that by using gp minimal inputs were needed meanwhile physical information was preserved for the estimation the main reason for the simulation of hydrological time series is solving problems related to hydrology concepts chadalawada et al 2020 due to the presence of high fluctuations in hydrologic time series most of the models are not capable of properly simulating the highly non stationary hydrologic time series with the purpose of improving the existing models a number of studies have attempted to integrate sophisticated statistical methods when simulating highly non stationary time series lee and ouarda 2012 methods such as wavelet transform wt empirical mode decomposition emd ensemble empirical mode decomposition eemd and complementary ensemble empirical mode decomposition ceemd were used to pre process a time series then the pre processed time series were employed as inputs for ai based models the models employing a pre processing technique are known as hybrid models kisi and shiri 2011 nourani et al 2009 solgi et al 2017 wang et al 2015b wt has been considered by several studies and indicated its ability to improve the performance of ai based models to handle non stationary time series in a groundwater level simulating rezaie balf et al 2017 employed wt in a combination with the m5 model m5 and multivariate adaptive regression splines mars monthly groundwater level air temperature and rainfall time series were decomposed by wt to sub signals to be used as inputs for m5 and mars they showed that the usage of sub signals could improve the performance of the models nourani et al 2019a combined wt with m5 to find an efficient way for modeling suspended sediment load produced by a catchment they decomposed non stationary runoff and sediment time series by applying wt in order to improve the performance of m5 their results showed better performance of m5 combined with wt for modeling in another study nourani et al 2018 developed m5 by a combination with wt to model rainfall runoff then they compared the performance of their hybrid model with sole m5 and ann combined with wt the results indicated the hybrid m5 model improved by wt had the best performance nourani et al 2019b considered different data divisions to investigate the ability of m5 combined with wt in compare with sole m5 and ann for rainfall runoff modeling they proved that the hybrid m5 model was better than sole m5 and ann for modeling eemd is a direct intuitive and self adaptive method and is suitable for analyzing non stationary hydrologic time series wang et al 2015b research indicates that using eemd improves the ability of models for simulation hydro climatic processes lee and ouarda 2011 2012 masselot et al 2018 karthikeyan and nagesh kumar 2013 improved the accuracy of auto regressive models by wt and emd for pre processing of non stationary time series huang et al 2014 combined eemd with svm for monthly streamflow simulation and indicated that the hybrid model possesses a high accuracy in another study jiao et al 2016 illustrated the high performance of the hybrid svm eemd model for hydrological data simulation ceemd has the same structure of eemd but it uses a set of independent white noise as well as a collection of complementary pair white noise the ceemd has been employed by a number of studies to combine with ai based models ren et al 2015 supposed that the emd method and its developed versions could increase the accuracy of ai based models by converting a complex time series to simple ones they applied eemd ceemd and complete eemd with adaptive noise ceemdan to decompose the wind speed time series which is nonstationary nonlinear and not distributed normally emd and its developed versions were combined with svr and ann it was concluded that the generated hybrid models outperformed their simple counterparts and ceemdan svr was the most accurate model niu et al 2016 decomposed fine particulate matter time series by ceemd in order to simplify the time series for modeling with svr optimized by grey wolf optimizer based on their empirical study it was concluded that the model combined with ceemd had better accuracy xu et al 2017 adopted ceemd to decompose a time series to intrinsic mode functions imfs then multi kernel relevant vector machine was used for the prediction of components the authors found that the designed hybrid model had high performance due to the complex inherent wind speed time series yang and wang 2018 used ceemd for the decomposition of wind speed time series to imfs then neural networks were utilized for the prediction of each imf the authors proved that ceemd increased the accuracy of the prediction as groundwater level simulation accurately is one of the challenging issues in hydrology the main objective of the present paper is to reach accurate simulation using gep and the m5 model tree m5 combined with eemd and ceemd gep is employed because it is known as a strong ai based model for simulation gep produces so complex equations that are hard for interpretation m5 is also applied because it produces groups of linear equations that are easy to interpret considering a complex and simple ai based models helps to investigate whether it is possible to achieve an accurate simulation with less complexity or not gep and m5 and their hybrid counterparts wgep and wm5 has been previously considered by bahmani et al 2020 although bahmani et al 2020 showed that applying wt improves the performance of gep and m5 the results need to be improved for the purpose of ameliorating groundwater level simulation the present study investigates the ability of emd based pre processing technique which is developed recently no previous study has considered this combination of methods to improve the simulation of groundwater levels to do so eemd and ceemd are applied to decompose monthly groundwater levels precipitation and air temperature time series into sub series then the sub series are used as inputs to the gep and m5 models to produce hybrid models to simulate groundwater levels for one month ahead finally the improved models are evaluated using a number of evaluation criteria the present paper is organized as follows section 2 presents the methods section 3 includes information about the data and case study the results and discussion are presented in section 4 section 5 gives the conclusion of the present paper and recommendations for future works 2 methods in the current study the hybrid models of eemd and gep eemd gep eemd and m5 eemd m5 ceemd and gep ceemd gep plus ceemd and m5 ceemd m5 are employed for groundwater level simulation as there are several references that introduce the eemd ceemd gep and m5 models the present paper does not present the details of the various methods and models instead the concepts are briefly presented and references are provided 2 1 gene expression programming gep ferreira 2001 introduced gep based on evolutionary algorithms for modeling the evolution principle was primarily presented in biological concepts by linking historical chain events babovic 2005 the evolutionary algorithms mimic the mechanism of living organisms gep exploits the advantages of genetic algorithms ga and genetic programming gp to overcome their disadvantages in the gep model the genotype of chromosomes has a linear structure similar to ga while the phenotype of chromosomes has a tree structure with different shapes and sizes like gp ferreira 2001 the genotype is all or a part of the genetic compositions of a cell and the phenotype is an observable characteristic of an organism 2 2 m5 model tree m5 quinlan 1992 presented the m5 model according to the decision tree platform to form a relationship between dependent and independent variables m5 is the combination of linear regression and decision tree moreover it can be applied to analyze quantitative and qualitative variables quinlan 1992 m5 utilizes a top down approach to reach from a node at the top to a leaf at the bottom building m5 includes two steps the first step is dividing a node called parent node into nodes with smaller standard deviations using the splitting criterion kisi 2015 if the splitting criterion does not satisfy the node ends into a leaf the second step is pruning the grown tree to avoid overfitting by replacing leaves to linear regression function kisi 2015 for more details about m5 the reader is referred to quinlan 1986 and quinlan 1992 for more information about gep the reader is referred to ferreira 2001 ferreira 2002 and ferreira 2006 2 3 ensemble empirical mode decomposition eemd huang et al 1998 introduced emd as an empirical method to decompose a signal to its frequency components the decomposed components are known as intrinsic mode functions imfs if they meet the following conditions lee and ouarda 2012 a the number of local extrema should be equal to the number of zero crossings in case of any difference just one is allowed b the mean of the upper envelope calculated by local maxima and the lower envelope calculated by local minima should be zero the following steps demonstrate the decomposition of a time series x t through the sifting process by the emd algorithm huang et al 1998 1 determine the local maxima and minima of x t 2 fit an upper envelope on the local maxima by a cubic spline 3 fit a lower envelope on the local minima by a cubic spline 4 calculate the mean m t of the upper and lower envelopes which is the low frequency of the signal then subtract m t from the x t h 1 t x t m 1 t where h 1 t can be the first imf 5 determine a criterion to stop the process the criterion is called d k and commonly defined as d k t 0 t h 1 k 1 t h 1 k t 2 t 0 t h 1 k 1 t 2 where k refers to the additional repetition number for the sifting process so k indicates the current h 1 t and k 1 indicates the previous h 1 t a typical value for d k is between 0 2 and 0 3 huang et al 1998 6 6 if d k is bigger than the typical value the x t is replaced by the signal calculated from step 4 then the process is repeated from step 1 again 7 if d k is smaller than the typical value c 1 h 1 k is known as the first imf here the subscript 1 refers to the first imf and increases for each iteration of steps 1 to 5 the superscript k shows the number of sifting process 8 define the residual as r 1 x t c 1 k if the residual satisfies the condition a it is considered as x t and the steps 1 to 4 are retrieved to produce the next imf if the condition is not satisfied r is considered as the residual and the algorithm is stopped the described steps indicate that a signal is the sum of the produced imfs and the residual fig 1 illustrates the flowchart of the emd algorithm and the steps 1 to 8 and is adapted from premanode et al 2013 and qin et al 2015 the emd method may cause mode mixing the mode mixing is defined as different imfs with the same scale residing components or imfs with widely disparate scale components lee and ouarda 2010 wang et al 2015b to overcome the problem wu and huang 2009 improved emd by suggesting the ensemble emd eemd model the eemd method adds finite white noises into the targeted time series and into the imfs corresponding to each repetition of steps 1 to 3 wang et al 2015a wu and huang 2009 explained the necessity of prescribing the number of ensembles and the noise amplitude as the parameters of eemd they recommended controlling the added noise amplitude effect with the following equations wu and huang 2009 1a ε n ε n or 1b l n ε n ε 2 l n n 0 where ε is the added noise amplitude n is the number of ensemble members and ε n is the standard deviation of the error it is worthwhile of note that the added noise may not change the extrema since their amplitudes are too small wu and huang 2009 in the present paper the number of ensemble members is set to 100 the amplitude is set to 0 1 0 2 and 0 3 with the purpose of finding the best one for each time series also the emd method is investigated by considering the amplitude and ensemble number equal to zero and one respectively 2 4 complementary empirical mode decomposition ceemd in the eemd method the ε n may not be negligible if the number of the ensemble is not large enough ren et al 2015 to solve the disadvantage of eemd yeh et al 2010 recommended the application of ceemd to pre process a time series they explained that in ceemd the white noise is generated in pairs to cancel each other in the ceemd two mixtures of a time series and added noise can be derived by the following equation 2 1 1 1 1 s n m 1 m 2 where s is the time series n is the set of added white noise m 1 is the sum of the time series and positive noise and m 2 is the sum of the time series and negative noise from the eq 2 two ensemble imfs are obtained one with positive residues and another with negative residues of added noise thus the combination of both imfs is the final imf 2 5 evaluation criteria to evaluate the performance of the different models the following criteria are used in the present paper chebana et al 2014 a the determination coefficient or r 2 3 r 2 1 i 1 n x i obs x i sim 2 i 1 n x i obs x 2 b the root mean square error rmse 4 rmse i 1 n x i obs x i sim 2 n c the relative root mean square error 5 rrmse 100 i 1 n x i obs x i sim x i obs 2 n d the mean bias 6 bias i 1 n x i obs x i sim n e the relative mean bias 7 rbias 100 i 1 n x i obs x i sim x i obs n where x i obs and x i sim are the observed and simulated values x is the average of the observed values n is the number of observations and i is 1 2 n 3 data used monthly groundwater level values m of three observation wells as well as monthly precipitation mm and temperature c values of one meteorological station of the delfan plain located in iran are considered as the inputs of the hybrid models to simulate the groundwater level for one month ahead the plain is in the zagros mountain range between 47 21 and 48 21 e to 33 48 and 34 22 n and is 1700 to 2100 m above sea level fig 5 table 1 shows the geographical coordinates of the stations the monthly recorded data for the stations from 2002 to 2012 are considered and the observed values are divided into two parts the first part about 75 of the observations is employed for calibration the second part about 25 of the observations is employed for validation 4 results and discussion 4 1 results of hybrid eemd gep the applied evaluation criteria used to calibrate and validate the eemd gep model are presented in table 2 where ε 0 stands for the emd method and ε 0 1 0 2 and 0 3 refer to the amplitude of the added noises in the eemd method according to table 2 for well 1 the eemd gep model provides the best accuracy for ε 0 3 with r2 0 79 for the calibration and r2 0 69 for the validation rmse for ε 0 3 is smaller than other ε s in the calibration for validation rmses are close in all ε s rrmse bias and rbias for all situations is small for well 2 for ε 0 2 and 0 3 the performance of the hybrid eemd gep is almost the same since the value of ε 0 2 has a smaller rmse rrmse bias and rbias in comparison with ε 0 3 it is designated as the best ensemble for the hybrid model for well 3 the best performance is for ε 0 2 in which leads to good results for both validation and calibration for well 3 as well as well 1 the performance of the hybrid model with ε 0 is better than ε 0 1 and 0 3 for validation 4 2 results of hybrid eemd m5 the evaluation criteria for eemd m5 are presented in table 3 form table 3 it can be concluded that eemd m5 is not appropriate for simulation for well 1 although eemd m5 with ε 0 3 has the highest potential for calibration its validation r2 is equal to zero thus ε 0 3 does not provide sufficient results for simulation regarding validation it can be seen that the utilized parameter of ε 0 leads to a better performance of the hybrid model in comparison to ε 0 1 and 0 3 for well 2 eemd m5 shows high accuracy in calibration on the other hand in the case of validation the performance of the hybrid model is too weak and eemd m5 fails to properly simulate groundwater levels this may be due to overfitting the same conclusion holds for well 3 4 3 results of hybrid ceemd gep the evaluation criteria for ceemd gep presented in table 4 indicate that the performance of the hybrid model with different ε s is close however ε 0 2 can be selected as the best ensemble for all of the three wells regarding the evaluation criteria for all of observed wells the model shows high performance in terms of calibration but it decreases a little for the validation it is worthy of note that in the case of well 3 the hybrid model simulates the groundwater level with high accuracy 4 4 results of hybrid ceemd m5 table 5 presents the evaluation criteria for ceemd m5 based on table 5 it can be concluded that ε 0 3 is the suitable ensemble for the groundwater level simulation of well 1 and 3 while for well 2 ε 0 2 is better for all of the wells ceemd m5 indicates low performance because r2s decrease and biass increase in the validation thus the hybrid model is not suitable for groundwater level simulation 4 5 comparison of different models in the present section the performances of eemd gep eemd m5 ceemd gep and ceemd m5 are first compared with the observed values then the comparison of the present paper is done with the study of bahmani et al 2020 which the same variables were employed to simulate groundwater levels that study applied gep and m5 for the simulation and multiple linear regression mlr was used as a benchmark but instead of eemd and ceemd wt was used to produce hybrid models called wavelet gene expression programming wgep and wavelet m5 model tree wm5 to clarify the comparison of the simulated values by the eemd and ceemd hybrid models with the observed values figs 2 4 are presented respectively for the validation values to produce hybrid emd based models each of the groundwater levels air temperature and precipitation time series is decomposed to possible imfs and a residual then the generated imfs plus residuals we applied to gep and m5 as inputs for well 1 it can be seen that the graph of the hybrid eemd gep model is close to the graph corresponding to the observed values while there is a big difference between eemd m5 and the observed values in the case of wells 2 and 3 eemd gep shows close simulated and observed values but eemd m5 is not able to simulate groundwater levels properly this conclusion goes through simulated values produced by eemd m5 as well according to fig 3 applying ceemd improves the performance of models in comparison with using eemd for ceemd m5 the improvement is considerable but the model still is not suitable for the simulation for ceemd gep the simulated values are close to the observed values and for well 3 the model has high accuracy fig 4 presents scatter plots of simulated and observed groundwater levels the scatter plots also show that m5 combined with emd based pre processing is not suitable for groundwater simulation the comparison of the hybrid models produced by eemd and ceemd with the study of bahmani et al 2020 is done through r2s and rmses and presented in tables 6 and 7 table 6 indicates that the performance of gep and m5 increases in combination with wt and ceemd while the hybrid models generated by eemd do not show a good performance also the performance of gep increases in combination with all of the transformers but the hybrid m5 generated by eemd and ceemd presents low performance table 7 shows the performance evaluation of each model compared to mlr the percentages presented in table 7 indicate that applying pre processing considerably improves the performance of the models except hybrid m5 produced by eemd technique for example for well 1 the r2 improvement of wgep and wm5 is 16 39 in calibration and 14 75 and 26 23 in the validation for ceemd gep and ceemd m5 the improvement is 34 43 and 29 51 for calibration and 29 51 and 8 20 for validation respectively for other wells the hybrid models show an improvement except for eemd m5 again just the performance of eemd m5 reduces in the validation from the comparison of the present paper and the study by bahmani et al 2020 it can be understood that the hybrid models generated by wt and ceemd have better performance than the hybrid models produced by eemd method the comparison also confirms the conclusion from the study of karthikeyan and nagesh kumar 2013 which found the wavelet based method is better than the emd method in the field of hydrology in the present study the eemd based models in comparison with the wavelet based models indicate lower performance and its improved version called ceemd shows performance as good as the wavelet based models 5 conclusions the results of gep and m5 combined with eemd and ceemd to simulate groundwater levels are presented in the current paper the performance of the best models is compared with the study by bahmani et al 2020 to find the most accurate model for groundwater level simulation the results of the present paper demonstrate the hybrid models derived by gep is better than the other models eemd m5 is not suitable for the simulation because of the lowest performance possibly due to overfitting the m5 model uses the greedy search algorithm to divide observed values into perfectly split subsets blum and langley 1997 the greedy algorithm searches a global optimum by utilizing a heuristic analysis from locally optimal choices at each step without any reevaluation cormen et al 2009 if there is a big difference between the calibration and validation values m5 is not able to adequately simulate the values in validation gep randomly produces chromosomes to find the best solution hence by running the model several times it is possible to recognize well simulated values the results of eemd and ceemd based models illustrate the importance of ε for modeling and its impact on the accuracy of the hybrid models no specified rule for ε determination has been presented and selecting ε depends on the features of a time series such as mean and extreme values therefore it is recommended to find an optimal value for ε for a given specific hydrological time series finally to pre process a time series and simulate groundwater level wt and gep respectively are recommended hence utilizing wgep for groundwater simulation is suggested for future studies it is highly recommended to investigate the effect of gep s parameters on the simulation performance to improve emd methods new techniques such as partly ensemble mode decomposition has been developed and can be considered for the objectives of the present work it is suggested to investigate these approaches along with other new techniques to produce hybrid models for groundwater level simulation declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgements the presents work was partially supported by the natural sciences and engineering research council nserc of canada and the canada research chair program 
4822,reanalysis precipitation products are important datasets for precipitation estimates over ungauged areas the objective of this study was to evaluate the accuracy of the newly released fifth generation reanalysis product of the european centre for medium range weather forecasts ecmwf i e era5 for precipitation estimates over chinese mainland during 2003 2015 in this study we evaluated the era5 reanalysis data using gridded gauge precipitation both categorical and continuous verification scores were calculated the results show that the detection capacity of era5 varies across the four sub regions of chinese mainland era5 tends to misdetect daily precipitation events in the south of the northwestern arid climate nac and north of plateau climate pc zones in addition it is more difficult for era5 to accurately detect moderate or higher daily precipitation events above 10 mm day error analysis show that era5 product has higher root mean square error rmse values in the tropical and subtropical climate zone tsc with a relatively wet climate compared to satellite based precipitation product era5 has larger relative biases in precipitation estimates over chinese mainland and it tends to over and underestimate light precipitation events and moderate and heavy precipitation events respectively based on the analysis of the accuracy of era5 during typhoon induced extreme precipitation era5 can identify the precipitation distribution and center but underestimates extreme precipitation overall the results of this study provide references for the use of era5 in hydrological applications over chinese mainland keywords era5 reanalysis precipitation dataset accuracy evaluation typhoon extreme precipitation chinese mainland 1 introduction accurate precipitation information is crucial for climate change models as well as hydrological simulations disaster risks mitigation and agricultural management he et al 2020 madsen et al 2014 o gorman and schneider 2009 piao et al 2010 sharma et al 2018 sheffield et al 2006 rain gauges have been used extensively to observe precipitation at point and regional scales however other data sources e g remote sensing images and reanalysis are required for ungauged areas to generate spatially continuous precipitation estimates he et al 2013 kidd and levizzani 2011 gridded precipitation products can be roughly classified into three categories based on differences in the data sources and retrieval models including interpolated precipitation datasets yatagai et al 2012 satellite based precipitation datasets ashouri et al 2015 zhu et al 2015 and reanalysis precipitation datasets bosilovich et al 2008 interpolated precipitation datasets are constructed by various spatial interpolation techniques and their quality strongly depends on the density of the ground network garcia et al 2008 shen and xiong 2016 satellite based precipitation products provide spatially continuous precipitation data which are retrieved from visible infrared microwave precipitation estimates at the quasi global scale hou et al 2014 huffman et al 2001 yong et al 2014 despite representing a potentially useful data source these products lack vertical atmospheric field information that is consistent with the precipitation variable which is essential for the understanding of the physical processes kidd and levizzani 2011 generally reanalysis products have advantages of providing vertical information they contain an array of atmospheric variables beyond precipitation such as temperature humidity and water content available at different vertical levels marques et al 2009 ruane et al 2015 vousdoukas et al 2016 the variables are derived from state of the art analysis forecast systems and data assimilation activities which link models and observations from various sources such as satellite and in situ data bengtsson et al 2004 stopa and cheung 2014 xie et al 2019 with advancements in the development of numerical weather models and data assimilation techniques the precipitation datasets of reanalysis products are valuable for weather prediction and hydrological applications dutra et al 2008 jung et al 2005 yatagai 2003 for instance chen et al 2014 used four reanalysis precipitation products to reveal the warm season diurnal variability over east asia and confirmed that reanalysis products can be used to describe the diurnal precipitation cycle over the past decades several weather centers including the european centre for medium range weather forecasts ecmwf marshall 2000 national centers for environment prediction national center for atmospheric research ncep ncar kalnay 1996 kistler et al 2001 and japanese meteorological agency jma kobayashi et al 2015 have released reanalysis products that can be used to determine variations in precipitation at global or regional scales huang et al 2016 kim et al 2019 lin et al 2014 in addition the continuous development of three and four dimensional variational 4d var techniques has promoted the updating of reanalysis products in 2017 the new fifth generation atmospheric reanalysis of ecmwf namely era5 was released by the copernicus climate change service c3s following the first global atmospheric research program global experiment fgge boer 1986 15 year reanalysis era 15 sprenger and wernli 2003 40 year reanalysis era 40 uppala et al 2005 and era interim dee et al 2011 compared to the previous four generations era5 has several advantages i an advanced assimilation system and parameterization schemes era5 is produced using 4d var data assimilation technologies carried out in model cycle 41r2 cy41r2 and the improved parameterization schemes e g radiation and convection schemes hersbach et al 2020 ii higher spatio temporal resolution users can obtain hourly estimates of atmospheric variables at a horizontal resolution of 0 25 which provides information spanning 137 vertical levels the top level is 0 01 hpa 80 km from the ground karl and michela 2019 and iii more parameters the dataset contains more than 240 parameters all parameters are archived on ecmwf climate data storage disks in a standard format the precipitation datasets of the latest era5 product which superseded era interim in august 2019 is freely available to everyone data from 1979 to the present recently several studies have validated the accuracy of era5 at different spatio temporal scales nogueira 2020 analyzed the global era5 rainfall fields at a monthly timescale and found that the bias and error of era5 were generally lower than those of era interim over wide portions of tropics using the global precipitation climatology project merged rainfall product however era5 overestimates precipitation over most of the tropical oceans and the himalaya beck et al 2019 evaluated the daily era5 precipitation over the u s at a spatial resolution of 0 1 and reported a large improvement based on the use of era5 compared with era interim however they suggested that the era5 has shortcomings in regions dominated by convective storms xu et al 2019 confirmed that era5 substantially overestimates the spring precipitation over the assiniboine river basin amjad et al 2020 evaluated the accuracy of era5 over turkey using daily ground observations and found that era5 overestimates the precipitation over relatively wetter and complex terrain regions overall these studies have shown that the era5 reanalysis precipitation estimates have uncertainties and its accuracy require evaluation to determine their strengths and limitations note that certain uncertainties exist in reanalysis products mainly originating from the errors of models and observations in the data assimilation system nie et al 2015 the deficiencies of the reanalysis products may lead to biased precipitation estimates for different regions and precipitation events bao and zhang 2013 beck et al 2017 betts et al 2019 margarida et al 2011 zhu et al 2016 moreover the biased precipitation may introduce challenges in initial parameters calibration for the model simulation yun et al 2020 thus understanding the capacity of the reanalysis products in estimating daily precipitation is critical to providing references for hydrological or weather model applications the aim of this study was to evaluate the accuracy of the newly released reanalysis precipitation dataset era5 over chinese mainland chinese mainland is a good case study region for the evaluation of the accuracy of the era5 reanalysis precipitation dataset because of its diverse climate and geomorphic units the results of present study could provide a reliable evaluation of the accuracy of era5 and a reference that could facilitate the application of era5 in hydrological applications over chinese mainland the paper is organized as follows the study region datasets rain gauge observations and era5 reanalysis precipitation datasets the evaluation methods are briefly introduced in materials and methods results of the accuracy evaluation activities and discussion are described in the results and discussion followed by the conclusions section 2 materials and methods 2 1 study region the study region is chinese mainland located between 73 40 135 02 e and 18 10 53 33 n see fig 1 fig 1a shows the topography of china which includes low lying hills and plains in the east or southeast and plateaus and mountainous terrain in the west or north we classified china into four sub regions based on the key climatic characteristics zhang et al 2019 1 tropical and subtropical climate zone tsc containing the southern part of the tsinling mountains and eastern part of the qinghai tibet plateau 2 temperate climate zone tc including the humid and semi humid region north of the tsinling mountains 3 plateau climate zone pc mainly including the qinghai tibet plateau and 4 northwestern arid climate zone nac which is located in the inland regions of chinese mainland generally the total annual precipitation of the tsc is 1000 mm and the majority of the annual precipitation is concentrated in summer wang et al 2016 the southern part of the tc is controlled by temperate monsoon climate while the north is governed by temperate continental climate the annual precipitation of the tc ranges from 400 to 1000 mm and is mostly concentrated in summer the nac located in northwest china is characterized by a dry climate and an annual precipitation below 400 mm wang et al 2013 due to the influence of the complex plateau topography the annual precipitation in the pc has strong spatial variability li 2018 2 2 datasets 2 2 1 rain gauge observations daily rain gauge observations from 2003 to 2015 were downloaded from the china meteorological administration cma website http data cma cn fig 1b shows the distribution of 2301 gauges in the study area these in situ rain gauge records have undergone strict quality control and were converted into spatial averages with 0 25 resolution using the inverse distance weighted interpolation idw algorithm the idw interpolation is used to estimate predicted values at an unknown point based on the inverse square of measured distance tang et al 2016 xu et al 2014 notably the interpolation approach may introduce some uncertainties in precipitation estimates considering the study region is relatively large in addition to the uneven distribution of rain gauges to minimize uncertainties associated with the interpolation approach only 0 25 pixels covering one or more rain gauges and its surrounding eight pixels were considered as the reference data to verify the accuracy of analyzed products in addition to investigate the reliability of the interpolation approach further the grid to point method was also used to evaluate the accuracy of era5 in section 4 2 grid to point evaluation of era5 based on rain gauge data 2 2 2 era5 reanalysis precipitation dataset era5 is a global atmospheric reanalysis product developed by ecmwf using the 4d var data assimilation techniques in cycle 41r2 karl and michela 2019 atmospheric data are available for different levels and precipitation data contain two two dimensional 2d surface level parameters rainfall and snow large scale precipitation of era5 is generated by the cloud scheme while convective precipitation is retrieved by the convection scheme for this study an era5 reanalysis precipitation dataset 0 25 0 25 hourly spanning january 2003 to december 2015 was downloaded from the c3s climate data store application programming interface https cds climate copernicus eu home and then the hourly precipitation was converted to a daily scale 2 3 evaluation methods and metrics six metrics were selected for the evaluation of the performance of era5 reanalysis precipitation which can be divided into two categories lu and yong 2020 maghsood et al 2020 shawky et al 2019 i categorical statistical metrics the probability of detection pod false alarm ratio far and equitable threat score ets were used to evaluate the detection capacity of era5 regarding daily precipitation events as defined in table 1 the pod far measures the probability of the correct false detection of era5 and ets represents a more comprehensive score to examine the era5 performance because it eliminates the contribution of random hits the optimal pod and ets value are 1 while that of far is 0 in general the daily precipitation event threshold is set to 0 1 mm day and ii continuous statistical indicators the root mean square error rmse relative bias rb and pearson correlation coefficient cc were calculated to quantitatively evaluate the accuracy of era5 data the rmse measures the average magnitude of error of era5 the rb represents the systematic bias of era5 where negative and positive values indicate underestimation and overestimation respectively the cc measures the linear correlations between era5 and spatially interpolated gauge observations the equations for these indicators are provided in table 1 3 results and discussion 3 1 spatial analysis of the annual precipitation fig 1c d illustrate the distribution of the mean annual precipitation over chinese mainland based on interpolated gauge observations and era5 during the period 2003 2015 spatially the mean annual precipitation of era5 decreases from the southeastern coastal areas to the northwestern inland of chinese mainland the main spatial patterns are consistent with the gauge observations areas with abundant precipitation are mainly located in the southern himalayas and southeastern china with an average annual precipitation above 2000 mm year in contrast less precipitation 200 mm year is observed in northern and northwestern inland areas in the nac the terrain barrier effect leads to more frequent precipitation over the northern tianshan and kunlun mountains than over the southern parts because the water vapor mainly originates from the atlantic and arctic oceans 3 2 general evaluation of era5 for daily precipitation estimates 3 2 1 analysis of the detection capacity in fig 2 a c the spatial distributions of three categorical statistical metrics pod far and ets are computed from era5 against interpolated gauge estimates in 2003 2015 the results confirm that the detection capacity of era5 varies spatially among the four sub regions of chinese mainland the pod map shows that higher values are mainly distributed in the southern or eastern part of the tsc or pc fig 2a however era5 tends to misdetect daily precipitation events in the south of the nac and north of pc the far is marginally higher over those areas and exceeds 0 7 fig 2b lastly the ets is high in the eastern chinese mainland but low in the pc and nac fig 2c especially in the himalayas and hengduan mountains these characteristics might be partly due to i era5 failing to provide high quality precipitation estimates in the complex mountains with complex precipitation processes fallah et al 2020 nogueira 2020 tarek et al 2020 and ii the insufficient interpolation accuracy caused by sparse gauge distribution which could jointly reinforce the uncertainties in the evaluation results daily precipitation events were divided into different months to analyze the temporal behavior of era5 over chinese mainland fig 3 illustrates the monthly far values of era5 during the period 2003 2015 in general the far reveals a consistent spatial distribution pattern from january to december i e the degree of misdetection in the western areas is always higher than that in the eastern areas monthly far maps clearly indicate large false alarms with respect to capturing daily precipitation events from october to march in the four sub regions specifically the mean far are smaller than 0 3 mostly from may to september in the tc and tsc but the mean far values in the pc increase from 0 14 in july to 0 73 in december however era5 yields a worse ets from january to august than from july to december and the ets is generally lower than 0 5 over chinese mainland fig 4 3 2 2 error statistics fig 2d f shows the spatial distribution of three continuous statistical indicators rmse rb and cc for era5 over chinese mainland the era5 product has higher rmse values in the tsc which has a relatively wet climate while they are generally low in the nac with the dry climate except for localized high values in tianshan and kunlun mountains the rb of era5 is notably overestimated in the pc and west of the tsc while it is underestimated in the nac in terms of cc era5 is largely consistent with the interpolated gauge observations over the eastern and southern parts of chinese mainland the cc ranges from 0 7 to 1 however it is slightly lower over western chinese mainland fig 5 illustrates the spatial distribution of monthly rmse of era5 from january to december during the period 2003 2015 generally monthly changes in the rmse are mainly related to the regional climate and movement of rain belts in the eastern chinese mainland because the nac has an arid climate with low precipitation throughout the year the monthly rmse of era5 in the region is significantly lower than those of other areas from march to may which is affected by the summer western pacific subtropical high the rain belt moves northward and the precipitation in the coastal areas of southern chinese mainland increases gradually while the rmse of era5 in the tsc increases fig 5c e from june to august the high value region of the rmse extends from the southern to northeastern chinese mainland fig 5f h due to the continuous northward movement of the rain belt note that the rmse values in the tsc are higher than those in other regions with peak values in june subsequently the high rmse decreases gradually with the weakening of the rain belt and southward retreat fig 5i j the monthly rb values of era5 are displayed in fig 6 era5 consistently overestimates daily precipitation events in western and northern china with a wider spatial range the sign of the bias for era5 is consistent with the results shown in fig 3 the high far of daily precipitation events in the western areas may cause significant bias the results are consistent with the findings of nogueira 2020 who observed that era5 had a positive bias of 0 4 5 mm day over large parts of china moreover the bias may be due to the poor solid precipitation or snowfall events detection capacities during winter months furthermore according to orsolini et al 2019 the lack of a snow removal process in era5 land simulations may cause the excessive snowfall or precipitation over tibetan plateau region notably the average number of rainfall events during 2003 2015 in non rainy seasons 698 days is substantially lower than that in rain seasons 1463 days and the average rainfall amount in rainy seasons 4 75 mm day is higher than that in non rainy seasons 2 35 mm day further results i e the bar plots of six evaluation indictors in the rainy april to september and non rainy october to march seasons are illustrated in fig 7 in non rainy seasons the upper and medium values of far are higher than those in the rainy seasons across all the sub regions in rainy seasons the degree of misdetection for daily precipitation events of era5 is low in the tc and tsc far ranges from 0 to 0 3 however the ets is relatively better in non rainy seasons overall the rmses of era5 in the rainy seasons are greater than those in the non rainy seasons the degree of overestimation in non rainy seasons is higher than that in rainy seasons all the sub regions the worst performance is observed in the pc in both rainy and non rainy seasons 3 3 evaluation of era5 under extreme precipitation events a large part of eastern chinese mainland is affected by typhoons or tropical cyclones during summer and a prolonged rainy seasons xu et al 2015 consequently extreme precipitation events and floods that frequently struck eastern chinese mainland have strong adverse impacts on natural disasters and water resource management during the period 2003 2015 96 typhoons landed in china bringing tremendous economic losses to coastal cities for example on august 22 2013 the typhoon trami hit the fujian province china with extremely heavy precipitation strong winds and storm surges and caused enormous economic losses huang et al 2014 compared with ground observations reanalysis products can provide continuous spatial estimations of numerous types of meteorological variables to understand the performance of era5 during typhoon events we aim to evaluate the accuracy of era5 in estimating typhoon related precipitation and associated extremes in this section six typhoon events see details in table 2 that landed in china were selected for the assessment fig 8 shows the tracks of six typhoons downloaded from http typhoon nmc cn web html the precipitation amounts recorded three days before and after each typhoon landed were aggregated to analyze the performance of the era5 reanalysis precipitation dataset in capturing extreme values during a typhoon fig 9 depicts the distribution maps of the 3 day precipitation obtained from the spatially interpolated gauge analysis versus era5 and the corresponding scatter plots in red box during the six typhoons the era5 agrees well with the spatially interpolated gauge analysis in terms of the spatial distribution of typhoon precipitation centers the cc of the era5 for the six typhoons is above 0 80 however era5 underestimated the precipitation when the 3 day precipitation amount was greater than 100 mm 4 discussion 4 1 comparison with satellite based precipitation products accurate precipitation information is essential for understanding spatio temporal variations in our study several statistical metrics were selected to validate the accuracy of era5 reanalysis precipitation dataset over chinese mainland in recent research different gridded precipitation products for example reanalysis precipitation datasets and satellite based precipitation products obtained from different data sources and retrieval methods were compared to better understand their accuracies and differences caroletti et al 2019 ghulami et al 2017 li et al 2018 for instance hu et al 2016 compared reanalysis and satellite based precipitation datasets in central asia and found that the reanalysis data have a lower accuracy than satellite based precipitation products in terms of describing warm season precipitation peña arancibia et al 2013 pointed out that reanalysis datasets outperform satellite based precipitation estimates in southern australia and northern australasia while satellites have a better capacity in detecting convective precipitation in south and east asia overall reanalysis data performs poorly at small scale for high intensity precipitation in the tropics however they are sensitive to snow events at high latitude regions which are often estimated poorly by satellite based precipitation products beck et al 2019 here we address whether the newest ecmwf reanalysis product era5 can perform well compared with mainstream satellite based precipitation products over chinese mainland five global satellite based precipitation products were considered in this section 3 hourly tropical rainfall measurement mission trmm multi satellite precipitation analysis tmpa 3b42 version 7 3b42v7 huffman et al 2010 daily precipitation estimation from remotely sensed information using artificial neural networks climate data record persiann cdr ashouri et al 2015 3 hourly climate prediction center morphing technique bias corrected product cmorph crt the daily cmorph satellite gauge merged product cmorph bld joyce et al 2004 and daily climate hazards group infrared precipitation with stations chirps funk et al 2015 the products have a 0 25 spatial resolution which is consistent with era5 to avoid the problem of scale mismatch and evaluation was also conducted at a daily scale against gridded gauge observations table 3 summarizes the evaluation results for era5 and the five tested satellite based precipitation products for the 2003 2015 period generally era5 yielded the optimal performance in detecting daily precipitation events pod 0 85 far 0 23 ets 0 45 respectively followed by cmoprh bld all other tested satellite based precipitation products have lower pod and ets scores when compared to era5 the results of continuous statistical indicators suggest that era5 has a lower rmse than satellite based precipitation products excluding cmorph bld although the rb had high overestimations in era5 up to 30 34 previous studies have also suggested that era5 exhibits more severe data deviations than satellite based precipitation products that have undergone bias correction islam and cartwright 2020 to evaluate the performance of era5 and the five satellite based precipitation products taylor diagrams of the products in the four sub regions are illustrated in fig 10 providing a visualization of the standard deviation rmse and cc for the precipitation products the figure shows that satellite based precipitation products were not consistent with gauge observations in the pc and nac cc 0 7 era5 performs marginally better than the other five satellite based precipitation products in the tc nac and pc in the tsc the performance of era5 is consistent with that of cmorph bld the daily precipitation events were further divided into six categories based on precipitation intensities including 1 2 5 10 20 and 50 mm day table 4 for each bin categorical statistical metrics were calculated based on the precipitation thresholds for example it is considered to be a hit when the precipitation intensity based on the gauge observations is in the range of 0 1 1 mm day and the precipitation product estimates reach the corresponding threshold it is considered to be a false alarm or miss when the estimates are above or below the threshold respectively the categorical scores based on different precipitation intensity bins are shown in fig 11 the detection capacity of the precipitation products is related to the daily precipitation intensity specifically era5 shows higher far values than the satellite based precipitation products in detecting light precipitation threshold ⅰ to ⅳ note that the rmse of era5 also increases with increasing daily precipitation intensity fig 11a regarding light precipitation threshold ⅰ to ⅳ era5 significantly overestimates precipitation while it underestimates heavy precipitation threshold vii fig 11d the results are consistent with the findings of hénin et al 2018 and sharifi et al 2019 more concretely the deficiencies in the sub grid convection parameterization schemes in reanalysis techniques resulted in the poor performance in high intensity precipitation estimates islam and cartwright 2020 our result emphasizes the bad performance of era5 with respect to estimating light precipitation events and that major bias correction on the observations is required to correct initial errors and the cloud and precipitation assimilation strategies must be advanced 4 2 grid to point evaluation of era5 based on rain gauge data similar to previous evaluation studies rain gauge observations at point scale were interpolated to a 0 25 spatial resolution to match the areal coverage of gridded precipitation products in the study the accuracy of era5 was analyzed comprehensively by comparing the interpolated gauge data over chinese mainland however it should be pointed that a sparse gauge network may not adequately represent the areal precipitation which may introduce errors and in turn affect evaluation results han et al 2011 tang et al 2018 therefore gridded precipitation products have been directly extracted using the rain gauge station coordinates to generate point data in numerous studies chen et al 2020 zhang et al 2020 to investigate potential uncertainties induced by the interpolation approach in this section the grid to point approach based on distance was used to perform the accuracy validation for era5 different from previous studies we suggest that when the rain gauge is located at the edge of the effective coverage of the grid the influence of other surrounding grids should be considered therefore the euclidean distance was considered as an important factor in the grid to point method the four grids closest to the rain gauge should be selected to extract the point precipitation data subsequently the performance of point era5 data was examined using rain gauge in 2003 2015 fig 12 shows the spatial distributions of six evaluation indicators computed from point era5 against rain gauge estimates from 2003 to 2015 because of the limited coverage of rain gauges in western china it is difficult for grid to point evaluation to reflect actual precipitation for no gauged area in such large study region however it demonstrates that the evaluation results are consistent with those presented in fig 2 5 conclusions in the study we examined the performance of the era5 reanalysis precipitation dataset by comparing it with gridded gauge based observations over chinese mainland using categorical statistical metrics and continuous statistical indicators in 2003 2015 the conclusions can be summarized as follows based on the maps of the three categorical statistical metrics the detection capacity with respect to daily precipitation varies across the four sub regions of chinese mainland according to the pod map higher values are mainly distributed in the southern or eastern part of the tsc however era5 tends to misdetect daily precipitation events in the south of the nac and north of pc moreover the detection capacity of era5 exhibits significant seasonality pattern and it is more challenging to detect moderate or higher daily precipitation events above 10 mm day error analysis results indicate notable era5 errors in the tsc under relatively wet climate conditions in addition the monthly rmse of era5 exhibited notable temporal variability over eastern chinese mainland the rmse values of era5 are generally lower in the nac which has the driest climate excluding localized high rainfall events in the tianshan and kunlun mountains the changes in rmse across different months are mainly related to regional climate characteristics and the movement of the rain belt in eastern chinese mainland era5 tends to overestimate light precipitation events and underestimate moderate and heavy precipitation events finally based on the analysis of the era5 reanalysis precipitation dataset during typhoon induced extreme precipitation events era5 agrees well with the gauge analysis regarding the spatial distribution of typhoon precipitation centers but it underestimates the precipitation when the 3 day precipitation amount is greater than 100 mm it is critical to point out that the era5 reanalysis precipitation dataset has larger relative biases compared to the mainstream satellite based precipitation products over chinese mainland calibration with ground observations is essential for the improvement of its accuracy li et al 2019 wang et al 2020 further research should focus on determining the advantages of different precipitation data to reduce the data bias of single precipitation products based on multi source data fusion ur rahman et al 2020 credit authorship contribution statement qin jiang methodology software formal analysis writing original draft weiyue li conceptualization writing review editing project administration funding acquisition zedong fan software xiaogang he writing review editing weiwei sun sheng chen conceptualization jiahong wen conceptualization jun gao conceptualization funding acquisition jun wang funding acquisition declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments this work was supported by the major program of national social science foundation of china 18zda105 the natural science foundation of shanghai grant no 19zr1437500 the national key research and development program of china 2018yfc1508803 the national natural science foundation of china grant nos 41971199 41730642 and 41671095 and sponsored by shanghai gaofeng gaoyuan project for university academic program development and the shanghai science and technology support program grant no 19dz1201505 
4822,reanalysis precipitation products are important datasets for precipitation estimates over ungauged areas the objective of this study was to evaluate the accuracy of the newly released fifth generation reanalysis product of the european centre for medium range weather forecasts ecmwf i e era5 for precipitation estimates over chinese mainland during 2003 2015 in this study we evaluated the era5 reanalysis data using gridded gauge precipitation both categorical and continuous verification scores were calculated the results show that the detection capacity of era5 varies across the four sub regions of chinese mainland era5 tends to misdetect daily precipitation events in the south of the northwestern arid climate nac and north of plateau climate pc zones in addition it is more difficult for era5 to accurately detect moderate or higher daily precipitation events above 10 mm day error analysis show that era5 product has higher root mean square error rmse values in the tropical and subtropical climate zone tsc with a relatively wet climate compared to satellite based precipitation product era5 has larger relative biases in precipitation estimates over chinese mainland and it tends to over and underestimate light precipitation events and moderate and heavy precipitation events respectively based on the analysis of the accuracy of era5 during typhoon induced extreme precipitation era5 can identify the precipitation distribution and center but underestimates extreme precipitation overall the results of this study provide references for the use of era5 in hydrological applications over chinese mainland keywords era5 reanalysis precipitation dataset accuracy evaluation typhoon extreme precipitation chinese mainland 1 introduction accurate precipitation information is crucial for climate change models as well as hydrological simulations disaster risks mitigation and agricultural management he et al 2020 madsen et al 2014 o gorman and schneider 2009 piao et al 2010 sharma et al 2018 sheffield et al 2006 rain gauges have been used extensively to observe precipitation at point and regional scales however other data sources e g remote sensing images and reanalysis are required for ungauged areas to generate spatially continuous precipitation estimates he et al 2013 kidd and levizzani 2011 gridded precipitation products can be roughly classified into three categories based on differences in the data sources and retrieval models including interpolated precipitation datasets yatagai et al 2012 satellite based precipitation datasets ashouri et al 2015 zhu et al 2015 and reanalysis precipitation datasets bosilovich et al 2008 interpolated precipitation datasets are constructed by various spatial interpolation techniques and their quality strongly depends on the density of the ground network garcia et al 2008 shen and xiong 2016 satellite based precipitation products provide spatially continuous precipitation data which are retrieved from visible infrared microwave precipitation estimates at the quasi global scale hou et al 2014 huffman et al 2001 yong et al 2014 despite representing a potentially useful data source these products lack vertical atmospheric field information that is consistent with the precipitation variable which is essential for the understanding of the physical processes kidd and levizzani 2011 generally reanalysis products have advantages of providing vertical information they contain an array of atmospheric variables beyond precipitation such as temperature humidity and water content available at different vertical levels marques et al 2009 ruane et al 2015 vousdoukas et al 2016 the variables are derived from state of the art analysis forecast systems and data assimilation activities which link models and observations from various sources such as satellite and in situ data bengtsson et al 2004 stopa and cheung 2014 xie et al 2019 with advancements in the development of numerical weather models and data assimilation techniques the precipitation datasets of reanalysis products are valuable for weather prediction and hydrological applications dutra et al 2008 jung et al 2005 yatagai 2003 for instance chen et al 2014 used four reanalysis precipitation products to reveal the warm season diurnal variability over east asia and confirmed that reanalysis products can be used to describe the diurnal precipitation cycle over the past decades several weather centers including the european centre for medium range weather forecasts ecmwf marshall 2000 national centers for environment prediction national center for atmospheric research ncep ncar kalnay 1996 kistler et al 2001 and japanese meteorological agency jma kobayashi et al 2015 have released reanalysis products that can be used to determine variations in precipitation at global or regional scales huang et al 2016 kim et al 2019 lin et al 2014 in addition the continuous development of three and four dimensional variational 4d var techniques has promoted the updating of reanalysis products in 2017 the new fifth generation atmospheric reanalysis of ecmwf namely era5 was released by the copernicus climate change service c3s following the first global atmospheric research program global experiment fgge boer 1986 15 year reanalysis era 15 sprenger and wernli 2003 40 year reanalysis era 40 uppala et al 2005 and era interim dee et al 2011 compared to the previous four generations era5 has several advantages i an advanced assimilation system and parameterization schemes era5 is produced using 4d var data assimilation technologies carried out in model cycle 41r2 cy41r2 and the improved parameterization schemes e g radiation and convection schemes hersbach et al 2020 ii higher spatio temporal resolution users can obtain hourly estimates of atmospheric variables at a horizontal resolution of 0 25 which provides information spanning 137 vertical levels the top level is 0 01 hpa 80 km from the ground karl and michela 2019 and iii more parameters the dataset contains more than 240 parameters all parameters are archived on ecmwf climate data storage disks in a standard format the precipitation datasets of the latest era5 product which superseded era interim in august 2019 is freely available to everyone data from 1979 to the present recently several studies have validated the accuracy of era5 at different spatio temporal scales nogueira 2020 analyzed the global era5 rainfall fields at a monthly timescale and found that the bias and error of era5 were generally lower than those of era interim over wide portions of tropics using the global precipitation climatology project merged rainfall product however era5 overestimates precipitation over most of the tropical oceans and the himalaya beck et al 2019 evaluated the daily era5 precipitation over the u s at a spatial resolution of 0 1 and reported a large improvement based on the use of era5 compared with era interim however they suggested that the era5 has shortcomings in regions dominated by convective storms xu et al 2019 confirmed that era5 substantially overestimates the spring precipitation over the assiniboine river basin amjad et al 2020 evaluated the accuracy of era5 over turkey using daily ground observations and found that era5 overestimates the precipitation over relatively wetter and complex terrain regions overall these studies have shown that the era5 reanalysis precipitation estimates have uncertainties and its accuracy require evaluation to determine their strengths and limitations note that certain uncertainties exist in reanalysis products mainly originating from the errors of models and observations in the data assimilation system nie et al 2015 the deficiencies of the reanalysis products may lead to biased precipitation estimates for different regions and precipitation events bao and zhang 2013 beck et al 2017 betts et al 2019 margarida et al 2011 zhu et al 2016 moreover the biased precipitation may introduce challenges in initial parameters calibration for the model simulation yun et al 2020 thus understanding the capacity of the reanalysis products in estimating daily precipitation is critical to providing references for hydrological or weather model applications the aim of this study was to evaluate the accuracy of the newly released reanalysis precipitation dataset era5 over chinese mainland chinese mainland is a good case study region for the evaluation of the accuracy of the era5 reanalysis precipitation dataset because of its diverse climate and geomorphic units the results of present study could provide a reliable evaluation of the accuracy of era5 and a reference that could facilitate the application of era5 in hydrological applications over chinese mainland the paper is organized as follows the study region datasets rain gauge observations and era5 reanalysis precipitation datasets the evaluation methods are briefly introduced in materials and methods results of the accuracy evaluation activities and discussion are described in the results and discussion followed by the conclusions section 2 materials and methods 2 1 study region the study region is chinese mainland located between 73 40 135 02 e and 18 10 53 33 n see fig 1 fig 1a shows the topography of china which includes low lying hills and plains in the east or southeast and plateaus and mountainous terrain in the west or north we classified china into four sub regions based on the key climatic characteristics zhang et al 2019 1 tropical and subtropical climate zone tsc containing the southern part of the tsinling mountains and eastern part of the qinghai tibet plateau 2 temperate climate zone tc including the humid and semi humid region north of the tsinling mountains 3 plateau climate zone pc mainly including the qinghai tibet plateau and 4 northwestern arid climate zone nac which is located in the inland regions of chinese mainland generally the total annual precipitation of the tsc is 1000 mm and the majority of the annual precipitation is concentrated in summer wang et al 2016 the southern part of the tc is controlled by temperate monsoon climate while the north is governed by temperate continental climate the annual precipitation of the tc ranges from 400 to 1000 mm and is mostly concentrated in summer the nac located in northwest china is characterized by a dry climate and an annual precipitation below 400 mm wang et al 2013 due to the influence of the complex plateau topography the annual precipitation in the pc has strong spatial variability li 2018 2 2 datasets 2 2 1 rain gauge observations daily rain gauge observations from 2003 to 2015 were downloaded from the china meteorological administration cma website http data cma cn fig 1b shows the distribution of 2301 gauges in the study area these in situ rain gauge records have undergone strict quality control and were converted into spatial averages with 0 25 resolution using the inverse distance weighted interpolation idw algorithm the idw interpolation is used to estimate predicted values at an unknown point based on the inverse square of measured distance tang et al 2016 xu et al 2014 notably the interpolation approach may introduce some uncertainties in precipitation estimates considering the study region is relatively large in addition to the uneven distribution of rain gauges to minimize uncertainties associated with the interpolation approach only 0 25 pixels covering one or more rain gauges and its surrounding eight pixels were considered as the reference data to verify the accuracy of analyzed products in addition to investigate the reliability of the interpolation approach further the grid to point method was also used to evaluate the accuracy of era5 in section 4 2 grid to point evaluation of era5 based on rain gauge data 2 2 2 era5 reanalysis precipitation dataset era5 is a global atmospheric reanalysis product developed by ecmwf using the 4d var data assimilation techniques in cycle 41r2 karl and michela 2019 atmospheric data are available for different levels and precipitation data contain two two dimensional 2d surface level parameters rainfall and snow large scale precipitation of era5 is generated by the cloud scheme while convective precipitation is retrieved by the convection scheme for this study an era5 reanalysis precipitation dataset 0 25 0 25 hourly spanning january 2003 to december 2015 was downloaded from the c3s climate data store application programming interface https cds climate copernicus eu home and then the hourly precipitation was converted to a daily scale 2 3 evaluation methods and metrics six metrics were selected for the evaluation of the performance of era5 reanalysis precipitation which can be divided into two categories lu and yong 2020 maghsood et al 2020 shawky et al 2019 i categorical statistical metrics the probability of detection pod false alarm ratio far and equitable threat score ets were used to evaluate the detection capacity of era5 regarding daily precipitation events as defined in table 1 the pod far measures the probability of the correct false detection of era5 and ets represents a more comprehensive score to examine the era5 performance because it eliminates the contribution of random hits the optimal pod and ets value are 1 while that of far is 0 in general the daily precipitation event threshold is set to 0 1 mm day and ii continuous statistical indicators the root mean square error rmse relative bias rb and pearson correlation coefficient cc were calculated to quantitatively evaluate the accuracy of era5 data the rmse measures the average magnitude of error of era5 the rb represents the systematic bias of era5 where negative and positive values indicate underestimation and overestimation respectively the cc measures the linear correlations between era5 and spatially interpolated gauge observations the equations for these indicators are provided in table 1 3 results and discussion 3 1 spatial analysis of the annual precipitation fig 1c d illustrate the distribution of the mean annual precipitation over chinese mainland based on interpolated gauge observations and era5 during the period 2003 2015 spatially the mean annual precipitation of era5 decreases from the southeastern coastal areas to the northwestern inland of chinese mainland the main spatial patterns are consistent with the gauge observations areas with abundant precipitation are mainly located in the southern himalayas and southeastern china with an average annual precipitation above 2000 mm year in contrast less precipitation 200 mm year is observed in northern and northwestern inland areas in the nac the terrain barrier effect leads to more frequent precipitation over the northern tianshan and kunlun mountains than over the southern parts because the water vapor mainly originates from the atlantic and arctic oceans 3 2 general evaluation of era5 for daily precipitation estimates 3 2 1 analysis of the detection capacity in fig 2 a c the spatial distributions of three categorical statistical metrics pod far and ets are computed from era5 against interpolated gauge estimates in 2003 2015 the results confirm that the detection capacity of era5 varies spatially among the four sub regions of chinese mainland the pod map shows that higher values are mainly distributed in the southern or eastern part of the tsc or pc fig 2a however era5 tends to misdetect daily precipitation events in the south of the nac and north of pc the far is marginally higher over those areas and exceeds 0 7 fig 2b lastly the ets is high in the eastern chinese mainland but low in the pc and nac fig 2c especially in the himalayas and hengduan mountains these characteristics might be partly due to i era5 failing to provide high quality precipitation estimates in the complex mountains with complex precipitation processes fallah et al 2020 nogueira 2020 tarek et al 2020 and ii the insufficient interpolation accuracy caused by sparse gauge distribution which could jointly reinforce the uncertainties in the evaluation results daily precipitation events were divided into different months to analyze the temporal behavior of era5 over chinese mainland fig 3 illustrates the monthly far values of era5 during the period 2003 2015 in general the far reveals a consistent spatial distribution pattern from january to december i e the degree of misdetection in the western areas is always higher than that in the eastern areas monthly far maps clearly indicate large false alarms with respect to capturing daily precipitation events from october to march in the four sub regions specifically the mean far are smaller than 0 3 mostly from may to september in the tc and tsc but the mean far values in the pc increase from 0 14 in july to 0 73 in december however era5 yields a worse ets from january to august than from july to december and the ets is generally lower than 0 5 over chinese mainland fig 4 3 2 2 error statistics fig 2d f shows the spatial distribution of three continuous statistical indicators rmse rb and cc for era5 over chinese mainland the era5 product has higher rmse values in the tsc which has a relatively wet climate while they are generally low in the nac with the dry climate except for localized high values in tianshan and kunlun mountains the rb of era5 is notably overestimated in the pc and west of the tsc while it is underestimated in the nac in terms of cc era5 is largely consistent with the interpolated gauge observations over the eastern and southern parts of chinese mainland the cc ranges from 0 7 to 1 however it is slightly lower over western chinese mainland fig 5 illustrates the spatial distribution of monthly rmse of era5 from january to december during the period 2003 2015 generally monthly changes in the rmse are mainly related to the regional climate and movement of rain belts in the eastern chinese mainland because the nac has an arid climate with low precipitation throughout the year the monthly rmse of era5 in the region is significantly lower than those of other areas from march to may which is affected by the summer western pacific subtropical high the rain belt moves northward and the precipitation in the coastal areas of southern chinese mainland increases gradually while the rmse of era5 in the tsc increases fig 5c e from june to august the high value region of the rmse extends from the southern to northeastern chinese mainland fig 5f h due to the continuous northward movement of the rain belt note that the rmse values in the tsc are higher than those in other regions with peak values in june subsequently the high rmse decreases gradually with the weakening of the rain belt and southward retreat fig 5i j the monthly rb values of era5 are displayed in fig 6 era5 consistently overestimates daily precipitation events in western and northern china with a wider spatial range the sign of the bias for era5 is consistent with the results shown in fig 3 the high far of daily precipitation events in the western areas may cause significant bias the results are consistent with the findings of nogueira 2020 who observed that era5 had a positive bias of 0 4 5 mm day over large parts of china moreover the bias may be due to the poor solid precipitation or snowfall events detection capacities during winter months furthermore according to orsolini et al 2019 the lack of a snow removal process in era5 land simulations may cause the excessive snowfall or precipitation over tibetan plateau region notably the average number of rainfall events during 2003 2015 in non rainy seasons 698 days is substantially lower than that in rain seasons 1463 days and the average rainfall amount in rainy seasons 4 75 mm day is higher than that in non rainy seasons 2 35 mm day further results i e the bar plots of six evaluation indictors in the rainy april to september and non rainy october to march seasons are illustrated in fig 7 in non rainy seasons the upper and medium values of far are higher than those in the rainy seasons across all the sub regions in rainy seasons the degree of misdetection for daily precipitation events of era5 is low in the tc and tsc far ranges from 0 to 0 3 however the ets is relatively better in non rainy seasons overall the rmses of era5 in the rainy seasons are greater than those in the non rainy seasons the degree of overestimation in non rainy seasons is higher than that in rainy seasons all the sub regions the worst performance is observed in the pc in both rainy and non rainy seasons 3 3 evaluation of era5 under extreme precipitation events a large part of eastern chinese mainland is affected by typhoons or tropical cyclones during summer and a prolonged rainy seasons xu et al 2015 consequently extreme precipitation events and floods that frequently struck eastern chinese mainland have strong adverse impacts on natural disasters and water resource management during the period 2003 2015 96 typhoons landed in china bringing tremendous economic losses to coastal cities for example on august 22 2013 the typhoon trami hit the fujian province china with extremely heavy precipitation strong winds and storm surges and caused enormous economic losses huang et al 2014 compared with ground observations reanalysis products can provide continuous spatial estimations of numerous types of meteorological variables to understand the performance of era5 during typhoon events we aim to evaluate the accuracy of era5 in estimating typhoon related precipitation and associated extremes in this section six typhoon events see details in table 2 that landed in china were selected for the assessment fig 8 shows the tracks of six typhoons downloaded from http typhoon nmc cn web html the precipitation amounts recorded three days before and after each typhoon landed were aggregated to analyze the performance of the era5 reanalysis precipitation dataset in capturing extreme values during a typhoon fig 9 depicts the distribution maps of the 3 day precipitation obtained from the spatially interpolated gauge analysis versus era5 and the corresponding scatter plots in red box during the six typhoons the era5 agrees well with the spatially interpolated gauge analysis in terms of the spatial distribution of typhoon precipitation centers the cc of the era5 for the six typhoons is above 0 80 however era5 underestimated the precipitation when the 3 day precipitation amount was greater than 100 mm 4 discussion 4 1 comparison with satellite based precipitation products accurate precipitation information is essential for understanding spatio temporal variations in our study several statistical metrics were selected to validate the accuracy of era5 reanalysis precipitation dataset over chinese mainland in recent research different gridded precipitation products for example reanalysis precipitation datasets and satellite based precipitation products obtained from different data sources and retrieval methods were compared to better understand their accuracies and differences caroletti et al 2019 ghulami et al 2017 li et al 2018 for instance hu et al 2016 compared reanalysis and satellite based precipitation datasets in central asia and found that the reanalysis data have a lower accuracy than satellite based precipitation products in terms of describing warm season precipitation peña arancibia et al 2013 pointed out that reanalysis datasets outperform satellite based precipitation estimates in southern australia and northern australasia while satellites have a better capacity in detecting convective precipitation in south and east asia overall reanalysis data performs poorly at small scale for high intensity precipitation in the tropics however they are sensitive to snow events at high latitude regions which are often estimated poorly by satellite based precipitation products beck et al 2019 here we address whether the newest ecmwf reanalysis product era5 can perform well compared with mainstream satellite based precipitation products over chinese mainland five global satellite based precipitation products were considered in this section 3 hourly tropical rainfall measurement mission trmm multi satellite precipitation analysis tmpa 3b42 version 7 3b42v7 huffman et al 2010 daily precipitation estimation from remotely sensed information using artificial neural networks climate data record persiann cdr ashouri et al 2015 3 hourly climate prediction center morphing technique bias corrected product cmorph crt the daily cmorph satellite gauge merged product cmorph bld joyce et al 2004 and daily climate hazards group infrared precipitation with stations chirps funk et al 2015 the products have a 0 25 spatial resolution which is consistent with era5 to avoid the problem of scale mismatch and evaluation was also conducted at a daily scale against gridded gauge observations table 3 summarizes the evaluation results for era5 and the five tested satellite based precipitation products for the 2003 2015 period generally era5 yielded the optimal performance in detecting daily precipitation events pod 0 85 far 0 23 ets 0 45 respectively followed by cmoprh bld all other tested satellite based precipitation products have lower pod and ets scores when compared to era5 the results of continuous statistical indicators suggest that era5 has a lower rmse than satellite based precipitation products excluding cmorph bld although the rb had high overestimations in era5 up to 30 34 previous studies have also suggested that era5 exhibits more severe data deviations than satellite based precipitation products that have undergone bias correction islam and cartwright 2020 to evaluate the performance of era5 and the five satellite based precipitation products taylor diagrams of the products in the four sub regions are illustrated in fig 10 providing a visualization of the standard deviation rmse and cc for the precipitation products the figure shows that satellite based precipitation products were not consistent with gauge observations in the pc and nac cc 0 7 era5 performs marginally better than the other five satellite based precipitation products in the tc nac and pc in the tsc the performance of era5 is consistent with that of cmorph bld the daily precipitation events were further divided into six categories based on precipitation intensities including 1 2 5 10 20 and 50 mm day table 4 for each bin categorical statistical metrics were calculated based on the precipitation thresholds for example it is considered to be a hit when the precipitation intensity based on the gauge observations is in the range of 0 1 1 mm day and the precipitation product estimates reach the corresponding threshold it is considered to be a false alarm or miss when the estimates are above or below the threshold respectively the categorical scores based on different precipitation intensity bins are shown in fig 11 the detection capacity of the precipitation products is related to the daily precipitation intensity specifically era5 shows higher far values than the satellite based precipitation products in detecting light precipitation threshold ⅰ to ⅳ note that the rmse of era5 also increases with increasing daily precipitation intensity fig 11a regarding light precipitation threshold ⅰ to ⅳ era5 significantly overestimates precipitation while it underestimates heavy precipitation threshold vii fig 11d the results are consistent with the findings of hénin et al 2018 and sharifi et al 2019 more concretely the deficiencies in the sub grid convection parameterization schemes in reanalysis techniques resulted in the poor performance in high intensity precipitation estimates islam and cartwright 2020 our result emphasizes the bad performance of era5 with respect to estimating light precipitation events and that major bias correction on the observations is required to correct initial errors and the cloud and precipitation assimilation strategies must be advanced 4 2 grid to point evaluation of era5 based on rain gauge data similar to previous evaluation studies rain gauge observations at point scale were interpolated to a 0 25 spatial resolution to match the areal coverage of gridded precipitation products in the study the accuracy of era5 was analyzed comprehensively by comparing the interpolated gauge data over chinese mainland however it should be pointed that a sparse gauge network may not adequately represent the areal precipitation which may introduce errors and in turn affect evaluation results han et al 2011 tang et al 2018 therefore gridded precipitation products have been directly extracted using the rain gauge station coordinates to generate point data in numerous studies chen et al 2020 zhang et al 2020 to investigate potential uncertainties induced by the interpolation approach in this section the grid to point approach based on distance was used to perform the accuracy validation for era5 different from previous studies we suggest that when the rain gauge is located at the edge of the effective coverage of the grid the influence of other surrounding grids should be considered therefore the euclidean distance was considered as an important factor in the grid to point method the four grids closest to the rain gauge should be selected to extract the point precipitation data subsequently the performance of point era5 data was examined using rain gauge in 2003 2015 fig 12 shows the spatial distributions of six evaluation indicators computed from point era5 against rain gauge estimates from 2003 to 2015 because of the limited coverage of rain gauges in western china it is difficult for grid to point evaluation to reflect actual precipitation for no gauged area in such large study region however it demonstrates that the evaluation results are consistent with those presented in fig 2 5 conclusions in the study we examined the performance of the era5 reanalysis precipitation dataset by comparing it with gridded gauge based observations over chinese mainland using categorical statistical metrics and continuous statistical indicators in 2003 2015 the conclusions can be summarized as follows based on the maps of the three categorical statistical metrics the detection capacity with respect to daily precipitation varies across the four sub regions of chinese mainland according to the pod map higher values are mainly distributed in the southern or eastern part of the tsc however era5 tends to misdetect daily precipitation events in the south of the nac and north of pc moreover the detection capacity of era5 exhibits significant seasonality pattern and it is more challenging to detect moderate or higher daily precipitation events above 10 mm day error analysis results indicate notable era5 errors in the tsc under relatively wet climate conditions in addition the monthly rmse of era5 exhibited notable temporal variability over eastern chinese mainland the rmse values of era5 are generally lower in the nac which has the driest climate excluding localized high rainfall events in the tianshan and kunlun mountains the changes in rmse across different months are mainly related to regional climate characteristics and the movement of the rain belt in eastern chinese mainland era5 tends to overestimate light precipitation events and underestimate moderate and heavy precipitation events finally based on the analysis of the era5 reanalysis precipitation dataset during typhoon induced extreme precipitation events era5 agrees well with the gauge analysis regarding the spatial distribution of typhoon precipitation centers but it underestimates the precipitation when the 3 day precipitation amount is greater than 100 mm it is critical to point out that the era5 reanalysis precipitation dataset has larger relative biases compared to the mainstream satellite based precipitation products over chinese mainland calibration with ground observations is essential for the improvement of its accuracy li et al 2019 wang et al 2020 further research should focus on determining the advantages of different precipitation data to reduce the data bias of single precipitation products based on multi source data fusion ur rahman et al 2020 credit authorship contribution statement qin jiang methodology software formal analysis writing original draft weiyue li conceptualization writing review editing project administration funding acquisition zedong fan software xiaogang he writing review editing weiwei sun sheng chen conceptualization jiahong wen conceptualization jun gao conceptualization funding acquisition jun wang funding acquisition declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments this work was supported by the major program of national social science foundation of china 18zda105 the natural science foundation of shanghai grant no 19zr1437500 the national key research and development program of china 2018yfc1508803 the national natural science foundation of china grant nos 41971199 41730642 and 41671095 and sponsored by shanghai gaofeng gaoyuan project for university academic program development and the shanghai science and technology support program grant no 19dz1201505 
4823,the purpose of this study is to investigate the effects of climate and land use changes on flood susceptibility areas in the tajan watershed iran to do this land use changes over the next 20 years 2019 2040 were predicted from land use changes of the past 29 years 1990 2019 using the land change modeler lcm method future climate change was projected for the next 20 years 2020 2040 based on climate data from 1990 to 2015 using lars wg software and two scenarios rcp2 6 and rcp8 5 twelve factors that influence flooding and 262 locations of past floods were used to model the spatial pattern of flood susceptibility in the watershed a random forest rf model and a bayesian generalized linear model glmbayes were used to predict areas susceptible to flooding the results showed that elevation 21 55 distance from river 15 28 land use 11 1 slope 10 58 and rainfall 6 8 are the most important factors affecting flooding in this basin the factors were modified according to land use changes and climate changes and the models were revised the land use and climate forecasting in this region indicate that land use change like decreased forest cover 77 19 km2 and reduced rangeland 218 83 km2 near rivers and downstream can be expected and rainfall is projected to increase under from both scenarios these changes would result in increased probabilities of flooding in the downstream portion of the watershed and near the sea the area under the curve evaluation of the models indicates that the rf model more accurately predicted flood probability 0 91 than did the glmbayes model 0 847 keywords climate change land use change random forest bayesian generalized linear model flood probability tajan watershed 1 introduction disasters are among the key threats to settlements in recent decades un general assembly 2015 the frequency of floods rose during the 20th century milly 2002 global scale modeling of climates indicates that much of the world will warm and floods will become more common hirabayashi et al 2013 moradi et al 2019 the hydrological cycle is not easily understood due to its complex nature xu et al 2004 it is further complicated by climate change because of the intricate impact of thermal fluctuations on evapotranspiration and precipitation oliver 2010 see tables 1 and 2 according to statistics provided by the united nations among natural disasters floods and storms have caused the most casualties and damage to human societies so that in just one decade between 2000 and 2010 the amount of damage caused by floods and storms it has totaled 21 billion arnell and gosling 2016 tingsanchali 2012 despite the efforts of scholars managers decision makers stakeholders and governments to reduce flood impacts economic losses property damages and casualties continue to increase worldwide barbat 2013 re 2017 regions with climates that change toward more extreme and more frequent rainfall events are more likely experience flood conditions changing weather patterns influence the rates and patterns of runoff snow accumulation snow melt evapotranspiration ehsan bhuiyan et al 2019 fischer et al 2016 and floods frequency and magnitudes blöschl et al 2017 according to the ipcc climate change has induced hydrological changes worldwide increasing the likelihood of extreme weather events like floods and droughts ipcc 2017 changing climates can affect many of earth s systems but one of the most directly impacted is regional hydrology ipcc 2013 lulc change may drive environmental change eea 2016 the effects of climate change must be viewed in the context of lulc change lulc change can change discharge characteristics runoff volumes and water quality and can disturb a hydrological balance mitsova 2014 understandings of both the spatial patterns of flood risk and the temporal patterns of the changes to flood regimes are needed to promote appropriate actions to take to reduce flood losses bubeck et al 2012 hettiarachchi et al 2018 flood susceptibility mapping is an essential step in flood prevention and management kourgialas and karatzas 2017 several methods of flood probability mapping such as statistical and probabilistic models have been used al abadi 2018 costache and tien 2019 more complex methods have been developed that use soft computing and data mining methods among the most important of these methods are support vector machine svm du et al 2017 samui et al 2011 tehrany et al 2014 random forest rf chen et al 2020 shah et al 2018 avand et al 2020 classification and regression tree khosravi et al 2018 artificial neural network ann chen et al 2020 pham et al 2020 frequency ratio fr rahmati et al 2019 samanta et al 2018 quantile regression forests qrf bhuiyan et al 2018 taillardat et al 2017a 2017b and the neural fuzzy approach bui et al 2016 many studies have been conducted on the separate effects of climate change and lulc change on floods and each of these studies has used different methods and models jodar abellan et al 2019 garner et al 2017 there is no exact model or method that examines the effect of lulc change and climate change on floods at the same time or they need a lot of data that does not exist in all areas therefore the approach used in this study is able to effect these changes on the flood risk in large areas with low data using new machine learning methods despite the frequent occurrence of floods in the tajan watershed and the imposition of financial and human losses in recent years so far few studies have been conducted in the field of flood risk zoning with the aim of being used in flood management planning and control in this area therefore identifying the areas that are most hazardous is vital to flood damage mitigation this study is novel in that it investigates the impacts of both climate change and lulc change on patterns of flood risk with using machine learning technique this has not been done before terrset and lars wg software were used to survey and project lulc and climate changes respectively a random forest rf and a baysian generalized linear model glmbayes were used to map flood probability 2 materials and methods 2 1 study area the tajan watershed covers 3810 km2 in mazandaran province iran it is located between the alborz mountains on the south and the caspian sea in the north fig 1 and is roughly circumscribed by a polygon at 36 09 and 36 29 n and at 53 05 and 53 18 e the region has a warm and humid climate its average annual temperature is approximately 15 c and average annual rainfall is 760 mm the elevation ranges from 3 m above sea level asl at the outlet of the watershed and 3670 m asl there are 77 villages in the watershed most are in the mountains dominant lulcs include forest rangeland agriculture gardens and residential development most of the watershed area is forested the most important waterways of the tajan watershed are the tajan chaharanga dudanga lagim and zarum rud rivers rajaei et al 2017 the tajan river has the largest discharge and experiences numerous floods throughout its course damaging both agricultural lands and residential properties every year fig 2 2 2 flood inventory map a flood distribution map was prepared from an inventory of 263 previous floods in the study area fig 1 compiled from field studies and maps acquired from the water resources management organization of mazandaran province one might assume that the pattern of future floods will be similar to the pattern of past floods current flood risk may be a useful predictor of future flood risk a corollary 250 non flood locations were also randomly selected in arcgis to provide a dichotomous dependent variable for modeling the two datasets were divided into training 70 and testing 30 sets by random selection 2 3 preparation of geospatial database flood influencing factors although there is no standard method for selecting the factors that might best predict future floods reflecting the sets of factors used in other studies costache 2019 termeh et al 2018 was our approach twelve flood influencing factors were selected and the spatial data that reflect the distribution of those factors were converted to raster format in arcgis with pixels of 12 5 m elevation previous research has indicated that elevation is among the most important factors affecting flooding it is inversely related to flooding the higher the elevation the lower the flood probability tehrany et al 2014 youssef et al 2016 elevations of pixels were measured from a dem of the watershed in arcgis slope slope is also important due to its effect on velocity and the volume of runoff at that location at any given point in time steeper slopes generate higher velocity and promote increasing volumes downslope chen et al 2020 slope values of pixels were also determined from the dem aspect sunlight intensity varies for the various slope aspects aspects receiving less intense sun have more soil moisture rainfall on moist slopes will more likely generate runoff contributing to flood risk downslope pradhan 2009 yariyan et al 2020b distance from river studies have demonstrated that proximity to a river influences the likelihood of flooding vojtek and vojteková 2019 floods are most likely to occur near a watercourse generally speaking as distance from a river increases flood risk diminishes bui et al 2019 the locations of past floods in this study tended to be proximate to a river rainfall precipitation amounts and rates affect flood potential the intensities and frequency of rainfall events are the most important precipitation characteristics bui et al 2019 costache et al 2020 average annual rainfall was calculated from long term 1990 2015 precipitation data gathered at 6 rain gauges in the region maps of rainfall were generated using kriging in arcgis software the station data in the area were obtained from the meteorological bureau and the water resources management organization of mazandaran province rainfall in the watershed ranged from 347 mm at higher elevations to 845 mm near the sea plan and profile curvature curvature maps reveal concavity positive curvature values and convexity negative curvature values of slopes positive and negative values in profile curvature indicate decreased flow velocity and increased flow velocity respectively fig 3 jenness 2013 the values of these two indices are calculated using the following equations 1 profile c u r v a t u r e z 2 z 8 2 z 5 2 ω 2 plan c u r v a t u r e z 4 z 6 2 z 5 2 ω where z is elevation of a grid cell and ω is cell size alkhasawneh et al 2013 these two layers were computed in arcgis and assigned to one of three classes convex flat concave topographic wetness index twi twi a unitless value indicates the influence of topography on the saturation levels of the landscape to induce runoff it is calculated by the following equation 3 twi as t a n σ a s a l where as is an area draining at a point t a n σ is slope in degrees a is areas of land upstream and l is effective slope measured to the point in the flow direction higher values indicate areas that are wetter and more productive of runoff contributing to a basin s output kirkby and beven 1979 land use and land cover lulc runoff volume and velocity are influenced by lulc yalcin et al 2011 many studies have shown the importance of lulc for flood generation choubin et al 2019 costache et al 2020a 2020b a lulc map was created from landsat 8 satellite data and an oli sensor 15 jun 2019 after image correction lulcs were classified as either rangeland forest agriculture garden or residential lithology infiltration capacity and sediment transport ratios are important characteristics of the lithology of a region lee et al 2012 a geological map of the study area was acquired from the geological survey mineral explorations agency of iran gsi https gsi ir fa drainage density the conditions of a drainage network influence its propensity to flood flow in a stream is faster than either overland flow or subsurface flows so the greater the drainage density the faster runoff accumulates and the hydrograph curve steepens talukdar et al 2020 topography position index tpi tpi is obtained from the ratio of the change in elevation of a cell relative to neighboring cells jenness 2000 tpi was calculated using sagagis software and the values were classified into 5 classes very low low neutral high very high in arcgis using natural break method 2 4 the algorithms employed 2 4 1 random forest rf random forest modeling is a relatively complex tree method in which several decision trees are trained to increase accuracy of the model it results in a group of decision trees in rf each decision tree is trained using a random sample selected from the training dataset breiman 2001 selection of predictor variables used to segment at nodes is also random in the random forest method the mtree and ntree properties are determined for the covariates used in each subset and the number of trees used in the forest respectively the number of variables can range from one to the full set of covariates the number of trees is selected by the user usually somewhere from 500 to 1000 are created pal 2005 it is possible to select the most important and most effective covariates estimation of a variable s importance is done by queuing the values of each variable in the out of bag oob samples which are usually 1 3 observations not used in the model and by reclassifying the oob samples using the row variable das et al 2017 in the rf each tree is created as follows 1 if n is the number of states in a training dataset n states will randomly sample by pasting in the original data this is a work set 2 if there are m variables and consider m smaller than m such that at each node m variables are randomly selected from m and the best separation in this m variable is used to create separation at the node the value of m is assumed to be constant during forest construction 3 each tree grows as large as possible there is no pruning 2 4 2 bayesian generalized linear models glmbayse bayesian reasoning is a probability based approach to inference the premise of this approach is that there is a probability distribution for each quantity which can be optimized by observing new data and rationalizing its probability distribution berry and berry 1996 bolstad and curran 2016 bayesian networks also known as belief networks belong to the probabilistic graphical model family these graphical structures are used to represent information in an uncertain field specifically each node in the graph represents a random variable and the branches represent probabilistic dependencies between the variables these conditional dependencies are often evaluated by specific statistical and probabilistic methods bayesian networks combine principles of graph theory probability theory computer science and statistics bayesian networks provide efficient representation and computation of the probability distribution shared over a series of random variables in addition bayesian networks model the intensity of the relationship between variables quantitatively allowing the conditional belief about them to be automatically updated by accessing new information bolstad and curran 2016 hoff 2009 bayesian learning is based on bayesian theory which allows the calculation of secondary probability based on the first probability 4 p h d p d h p h p d where p h d is posterior probability p d h is likelihood p h is prior probability and p d is evidence increasing p d decreases p h d because the higher the probability of d observation independent of h d is less likely to support h 2 5 predicting climate change to investigate the impact of climate change on flood probability we downscaled climate station data inside and outside of the study area the stations with the data needed to monitor climate change were chosen and their data were reconstructed modified and sorted the stations selected for climate change assessment were at gharakhil kordkhil solaman tengeh rig cheshmeh kiasar and sangdeh the station data covered 25 years 1990 2015 lars wg software and the hadcm3 model at a temporal resolution of daily were used to predict future climate conditions under the rcp2 6 and rcp8 5 scenarios the rainfall generation process through lars wg software involved the accomplishment of three stages the first step was represented by the model calibration which was done using the function site analysis from lars wg software in this stage the observed rainfall data was analyzed and their statistical parameters were stored into 2 dedicated files in the following stage the model validation was performed by comparing the statistical characteristics of the observed rainfall data and synthetic rainfall data finally after the validation stage the average annual rainfall data from each station were mapped the data were extrapolated to the study area using kriging in arcgis to reveal a future annual rainfall map for both scenarios in this study future rainfall estimates are for long term annual averages and no seasonal analysis has been performed these maps were incorporated as new layers to feed into the data mining models and to predict the spatial distribution of flood probabilities of the future 2 6 predicting lulc change landsat satellite imagery form tm and oli sensors having spatial resolutions of 30 m were used to create lulc maps for 1991 2010 and 2019 table 3 pre processing of the images including geometric and radiometric corrections of the images was undertaken to properly determine current lulc maximum likelihood classification was used to classify the training samples eskandari et al 2020 shooshtarian et al 2018 the maps were evaluated using kappa coefficient and overall accuracy tests see table 4 terrset software and land change modeler lcm were used to predict lulc changes lulc modeling using lcm involved four steps 1 investigation of change 2 assessment of transition potential 3 modeling lulc and 4 evaluation of modeling accuracy the 1991 and 2010 lulc maps were input into the lcm to analyze regional change and predict lulc changes to 2019 five sub models were used to model transition force using a multilayer perceptron neural network the sub models are agriculture to residential forest to agriculture forest to garden residential to garden and pasture to agriculture after selecting the sub models 6 influential factors elevation slope distance from road distance from river distance from residential area and distance from agricultural areas were selected using the cramer correlation coefficient for modeling fig 4 the transition potential of each use was modeled using multilayer perceptron neural network mlp the output of this step is input in the prediction stage after evaluating and validating the accuracy of the lulc predictions for 2019 lulc was predicted for 2040 using the 2010 and 2019 lulc maps and the results were evaluated 2 7 validating the models the relative operating characteristic roc curve a graphical representation of the balance between the negative and positive error rates for each possible value yariyan et al 2020a nguyen et al 2020 was used to evaluate the models the vertical and horizontal components of the roc curve are calculated from relations 5 and 6 respectively obtained from the comparison matrix the threshold limits are 0 and 1 pourtaghi and pourghasemi 2014 yousefi et al 2020 the area under the roc curve auc represents the accuracy of the predictions of flood and non flood events costache et al 2020a avand et al 2019 the values of the percentages of true negatives tn and true positives tp are used to calculate the values for the x and y axis of the graph of the curve 5 x 1 tn tn f p 6 y tp tp f n other criteria for evaluating the results of the models used in this study include sensitivity accuracy npv and ppv these are calculated thusly 7 sensitivity tp tp f n 8 accuracy tp t n tp t n f p f n 9 npv tn tn f n 10 ppv tp tp f p where in tn is true negative fp is false positive tp is true positive and fn is false negative 2 8 validating the lulc change model the kappa coefficient and overall accuracy were used to evaluate the classification accuracy and model projection of future lulc results table 3 accuracy is the ratio of the correctly classified pixels to the total number of classified pixels panigada et al 2019 and is calculated with this equation 11 oa 1 n p ii where oa is the accuracy n is the number of training pixels and p ii is the sum of the main diameter elements of the error matrix in many studies the kappa coefficient is used in tandem with oa deng et al 2008 taufik et al 2016 the kappa coefficient considers the number of incorrect pixels and is calculated using this equation 12 kappa p i p c 1 p c 100 where pi is observed correctly and pc is the expected agreement the ideal value for the kappa coefficient is one but if the product is zero the classification was random a negative value indicates that there was a classification error 3 results 3 1 projected lulc change the three maps of 1991 2010 and 2019 lulcs were used to predict lulc changes to 2040 the past and contemporary maps were classified into the 5 classes residential agricultural forest garden and rangeland fig 5 the results of the lulc transition sub model characteristics show that the best model in all five sub models is mlp model table 5 the forest to agriculture sub model was 96 45 accurate the most accurate among available sub models the past and present lulc maps were predicted using neural network classification this was enhanced by markov chain and lcm modeling to project to 2040 the results indicate that this model had an acceptable degree of accuracy kappa 0 85 in predicting future lulc changes in the study area if future lulc changes reflected the forces at play for the past 29 years forest land would be reduced to 77 19 km2 which is a 2 02 reduction from the currently forested area furthermore rangelands would decrease by 5 74 from present residential agricultural and gardened lands would grow by 0 45 6 82 and 9 17 respectively table 6 fig 6 3 2 projected climate change the 6 regional weather stations that provided meteorological measures from the last 20 and 25 years were used to determine the effect that climate change may have on future rainfall patterns in the study area lars wg software and the hadesm2 model were used to downscale under two climate scenarios an optimistic rcp2 6 and a pessimistic rcp8 5 future fig 7 the observed and simulated values match and do not vary much in terms of future rainfall values the results reveal that areas closer to the caspian will have much more rainfall under both scenarios the increase in precipitation is smaller in higher elevations the seasonality of precipitation seems to change in the future it is slightly lower from april to july but increases sharply from october to december 3 3 flood susceptibility map the present and future flood susceptibility maps of the study area reflect the influences of changing climates and changing lulcl they were produced by rf and glmbayes machine learning models there are several factors that affect runoff in a watershed each has a unique potential to change flows and the prospects for floods the influences of the factors affecting floods in tajan watershed were ranked fig 8 elevation 21 55 distance from river 15 28 lulc 11 1 slope 10 85 and rainfall 6 8 had the greatest effect on the patterns of flood susceptibility the maps created were classified using natural break tools in arcgis as very low low moderate high and very high figs 9 and 10 3 4 evaluating and comparing models the models predictions were validated with the roc curve and other criteria it should be noted that these performance indicators are fitted to evaluate the performance of the models in terms of spatial distribution because they measure the degree in which the observed flood points overlap the very high flood susceptibility the roc curve validation indicate that modeling with contemporary conditions in the study area present rainfall and lulc the rf model auctest 0 91 was a more accurate predictor of flood susceptibility patterns than the gmlbayes model auctest 0 847 fig 11 a b table 7 the models were run using the validation dataset based on 2040 lulc and future climate data based on the pessimistic and optimistic climate models fig 12 a b again the auc for the rf models 0 913 and 0 91 respectively exceeded those of the gmlbayes models 0 872 and 0 834 respectively run with the training dataset table 8 under the 2040 scenarios fig 13 a b the rf models 0 974 and 0 967 respectively was more accurate than the gmlbayes models 0 932 and 0 912 respectively rf was the better model under these conditions 4 discussion lulc and climate have direct and indirect effects on floods having the capacity to predict the effect that each has on the spatial patterns of flooding in the future could improve managers abilities to avoid flood losses 4 1 the effect of lulc changes on flooding to better manage the watershed over the next 20 years several processes were used to project the present conditions into the future the lcm method was used to model lulc change in the tajan river watershed the maps of lulc change produced for 2010 2019 and 2040 were based on training points and the maximum likelihood method their accuracies assessed with the kappa coefficients were 0 82 0 84 and 0 80 respectively the overall accuracies of these models were 89 45 93 81 and 91 85 respectively indicating that they produced good predictions of lulc changes in the past to the present and into the future the cramer correlation coefficient shows that elevation and distance from roads are the greatest factors dictating lulc changes in the study area the highest concentrations of villages and agricultural lands are in lower elevations roads enable more access to land in the watershed rafaai et al 2020 shooshtarian et al 2018 the probability of flooding in lower elevations is higher and because the lower downstream elevations where land is comparatively flat are where one finds more residential areas and agricultural lands the hazard probability of negative impacts to people property and infrastructure is higher these findings are consistent with the results of dammalage and jayasinghe 2019 and hu et al 2020 which state that the amount of runoff increased due to the change of use of agricultural and forests lands in the downstream areas and their conversion to impermeable surface furthermore communication paths like roads also contribute to land degradation and increase the potential for flood damage after confirming the models accuracies for predicting lulc for 2019 the markov chain method was used to predict an lulc map for 2040 the lulc forecast for 2040 indicated increases in lands used for gardens 34 98 9 17 for agriculture 260 21 6 82 and for residential space 17 29 0 45 lands and decreases of forested land 77 19 2 02 and rangelands 218 83 5 74 in the study area rangeland will decrease the most 5 74 from the present forested lands have been diminished more slowly in recent years which reveals the beneficial outcomes of the strict rules applied in this watershed due to decreased forest and rangeland and increased agricultural and residential lands one should expect that the speeds and volumes of runoff will increase heightening future flood risk this is consistent with previous studies hu et al 2020 hung et al 2020 4 2 the effect of climate changes on flooding climate change can lead to serious effects on the timing seasonality frequency volumes and duration of precipitation events rainfall data covering a 25 year period from 1990 to 2015 at 6 weather stations were used to evaluate the effects of two climate change scenarios rcp2 6 and rcp8 5 on future flood risk patterns the method of this research is consistent with the method of akter et al 2018 roy et al 2020 to investigate the effect of using different scenarios of climate change on flood risk the results of modeling showed that the changes in rainfall patterns at the stations are different primarily because of the circumstances of their geographical locations the three stations at higher elevations sangdeh kiasar and soleiman tangeh have smaller precipitation changes and their precipitation totals will be lower in the future compared to the three stations at lower elevations kordkhil rig cheshmeh and gharakhil lower elevations are projected to receive more rainfall in the future due to their proximity to the caspian sea flooding will likely increase in the downstream reaches of the watershed due to the increased rainfall in this part of the watershed this is consistent with other studies fang et al 2020 seingier et al 2020 the concentrations of residential development and agricultural land use is greater downstream therefore flood losses should be expected to increase if everything else remains constant seasonality of precipitation should also change the models show that all stations should see decreased precipitation amounts during spring and early summer april to july and increased precipitation in the autumn october to december 4 3 using rf and glmbayes for flood susceptibility mapping the spatial factors that most influence flood risk in the study area are elevation distance from the river lulc slope and rainfall as elevation distance from the river and slope are essentially static unless there is a major landscape changing event the main dynamics influencing flooding should be lulc and precipitation a function of climate human activities are influential on both of these spatial characteristics the lulc change scenario used in this study was based on an assumption that lulc change in the next 20 years 2019 2040 will mimic the processes that caused the lulc changes of the past 29 years 1990 2019 the results are that most lulc changes will occur in the lower elevations and near roads and rivers reducing specific lulcs like forests and increasing rainfall in the lower elevations will augment the frequency and severity of floods in these areas therefore these results are consistent with the findings of costache and pham 2020 roy et al 2020 regarding the increase of flood potential in areas where the forest lands area in inclined plan has decreased in recent years and has led to an increase in runoff velocity although the consequences of climate change coupling with the impact of projected lulc on floods remains controversial the impacts of climatic variability demand need in depth research while rainfall is regarded as the most important climate factor in certain regions for flooding kourgialas and karatzas 2011 and the runoff factor is the flood event segond et al 2007 most influential factors for flood events are slope elevation and distance from river etc the present flood susceptibility map generated by the rf model shows that the very low risk class 1503 01 km2 covers the largest portion of the watershed the high susceptibility class was assigned to the largest area 1335 54 km2 by the glmbayes model the maps of future flood probabilities produced by the rf model incorporating the lulc changes occurring by 2040 and both the rcp2 6 and the rcp8 5 climate scenarios also show predict that the largest percentage of the study area would have very low flood susceptibility the glmbayes model on the other hand classified the largest percentage of the study area as high risk evaluations show that the rf model auctest 0 91 is more accurate than the glmbayes model auctest 0 847 which is consistent with the findings of other researchers who have described the rf model as a more accurate model chen et al 2020 lee et al 2017 dou et al 2019 they similarly conclude that the rf model provides good accuracy when predicting flood susceptibility some previous work supports our findings on the potential impact of climate change and land use on flood risk areas akter et al 2018 dobler et al 2012 szwagrzyk et al 2018 5 conclusion this study was conducted to determine the spatial patterns of flood susceptibility in the present and future for the tajan watershed twelve geophysical and anthropogenic factors that affect flood risk were used to determine areas that are more likely to flood the most important effective factors in this basin are elevation lulc slope and rainfall due to the importance and temporal variability of lulc and rainfall and the effects that these two factors have on runoff the influences of their changes were investigated lulc changes were determine over the course of a 29 year 1991 2019 period future lulc changes were projected based on the past processes future lulc forecasts are that the areal extents of forest and rangeland will decrease and the areas of agricultural land uses gardening and residential properties will increase together these shifts will increase runoff and promote flooding in the downstream areas of the watershed daily weather data collected over a 25 year period 1991 2015 at 6 stations were used to assess the effects of climate change on future flood probabilities the lars wg model was used with optimistic rcp2 6 and pessimistic rcp8 5 climate scenarios to predict the patterns of future climate changes changing climates in the study area are expected to generate more rainfall at lower elevations and nearer the coast of the caspian sea and the greatest amounts of precipitation will occur between october and december to investigate the effects of lulc and climate changes on future flood probabilities new layers of future lulc and rainfall produced from the two scenarios rcp2 6 and rcp8 5 and ten flood affecting factors the results of this modeling depict an increase in the area of the zone with greatest flood risk due to climate scenario rcp8 5 and future lulc the rf model was consistently more accurate than the glmbayse when it came to predicting the results from the relations between lulc climate change and flooding in the tarjan watershed iran declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgment this research is the product of a ph d thesis research project with the code 98020262 entitled the effect of climate and land use changes on temporal and spatial variability of vulnerability and flood risk in the iran national science foundation insf therefore the authors of this article would like to appreciate the support of this fund finally the authors would like to show their appreciation to the unknown reviewer for their useful comments on this work 
4823,the purpose of this study is to investigate the effects of climate and land use changes on flood susceptibility areas in the tajan watershed iran to do this land use changes over the next 20 years 2019 2040 were predicted from land use changes of the past 29 years 1990 2019 using the land change modeler lcm method future climate change was projected for the next 20 years 2020 2040 based on climate data from 1990 to 2015 using lars wg software and two scenarios rcp2 6 and rcp8 5 twelve factors that influence flooding and 262 locations of past floods were used to model the spatial pattern of flood susceptibility in the watershed a random forest rf model and a bayesian generalized linear model glmbayes were used to predict areas susceptible to flooding the results showed that elevation 21 55 distance from river 15 28 land use 11 1 slope 10 58 and rainfall 6 8 are the most important factors affecting flooding in this basin the factors were modified according to land use changes and climate changes and the models were revised the land use and climate forecasting in this region indicate that land use change like decreased forest cover 77 19 km2 and reduced rangeland 218 83 km2 near rivers and downstream can be expected and rainfall is projected to increase under from both scenarios these changes would result in increased probabilities of flooding in the downstream portion of the watershed and near the sea the area under the curve evaluation of the models indicates that the rf model more accurately predicted flood probability 0 91 than did the glmbayes model 0 847 keywords climate change land use change random forest bayesian generalized linear model flood probability tajan watershed 1 introduction disasters are among the key threats to settlements in recent decades un general assembly 2015 the frequency of floods rose during the 20th century milly 2002 global scale modeling of climates indicates that much of the world will warm and floods will become more common hirabayashi et al 2013 moradi et al 2019 the hydrological cycle is not easily understood due to its complex nature xu et al 2004 it is further complicated by climate change because of the intricate impact of thermal fluctuations on evapotranspiration and precipitation oliver 2010 see tables 1 and 2 according to statistics provided by the united nations among natural disasters floods and storms have caused the most casualties and damage to human societies so that in just one decade between 2000 and 2010 the amount of damage caused by floods and storms it has totaled 21 billion arnell and gosling 2016 tingsanchali 2012 despite the efforts of scholars managers decision makers stakeholders and governments to reduce flood impacts economic losses property damages and casualties continue to increase worldwide barbat 2013 re 2017 regions with climates that change toward more extreme and more frequent rainfall events are more likely experience flood conditions changing weather patterns influence the rates and patterns of runoff snow accumulation snow melt evapotranspiration ehsan bhuiyan et al 2019 fischer et al 2016 and floods frequency and magnitudes blöschl et al 2017 according to the ipcc climate change has induced hydrological changes worldwide increasing the likelihood of extreme weather events like floods and droughts ipcc 2017 changing climates can affect many of earth s systems but one of the most directly impacted is regional hydrology ipcc 2013 lulc change may drive environmental change eea 2016 the effects of climate change must be viewed in the context of lulc change lulc change can change discharge characteristics runoff volumes and water quality and can disturb a hydrological balance mitsova 2014 understandings of both the spatial patterns of flood risk and the temporal patterns of the changes to flood regimes are needed to promote appropriate actions to take to reduce flood losses bubeck et al 2012 hettiarachchi et al 2018 flood susceptibility mapping is an essential step in flood prevention and management kourgialas and karatzas 2017 several methods of flood probability mapping such as statistical and probabilistic models have been used al abadi 2018 costache and tien 2019 more complex methods have been developed that use soft computing and data mining methods among the most important of these methods are support vector machine svm du et al 2017 samui et al 2011 tehrany et al 2014 random forest rf chen et al 2020 shah et al 2018 avand et al 2020 classification and regression tree khosravi et al 2018 artificial neural network ann chen et al 2020 pham et al 2020 frequency ratio fr rahmati et al 2019 samanta et al 2018 quantile regression forests qrf bhuiyan et al 2018 taillardat et al 2017a 2017b and the neural fuzzy approach bui et al 2016 many studies have been conducted on the separate effects of climate change and lulc change on floods and each of these studies has used different methods and models jodar abellan et al 2019 garner et al 2017 there is no exact model or method that examines the effect of lulc change and climate change on floods at the same time or they need a lot of data that does not exist in all areas therefore the approach used in this study is able to effect these changes on the flood risk in large areas with low data using new machine learning methods despite the frequent occurrence of floods in the tajan watershed and the imposition of financial and human losses in recent years so far few studies have been conducted in the field of flood risk zoning with the aim of being used in flood management planning and control in this area therefore identifying the areas that are most hazardous is vital to flood damage mitigation this study is novel in that it investigates the impacts of both climate change and lulc change on patterns of flood risk with using machine learning technique this has not been done before terrset and lars wg software were used to survey and project lulc and climate changes respectively a random forest rf and a baysian generalized linear model glmbayes were used to map flood probability 2 materials and methods 2 1 study area the tajan watershed covers 3810 km2 in mazandaran province iran it is located between the alborz mountains on the south and the caspian sea in the north fig 1 and is roughly circumscribed by a polygon at 36 09 and 36 29 n and at 53 05 and 53 18 e the region has a warm and humid climate its average annual temperature is approximately 15 c and average annual rainfall is 760 mm the elevation ranges from 3 m above sea level asl at the outlet of the watershed and 3670 m asl there are 77 villages in the watershed most are in the mountains dominant lulcs include forest rangeland agriculture gardens and residential development most of the watershed area is forested the most important waterways of the tajan watershed are the tajan chaharanga dudanga lagim and zarum rud rivers rajaei et al 2017 the tajan river has the largest discharge and experiences numerous floods throughout its course damaging both agricultural lands and residential properties every year fig 2 2 2 flood inventory map a flood distribution map was prepared from an inventory of 263 previous floods in the study area fig 1 compiled from field studies and maps acquired from the water resources management organization of mazandaran province one might assume that the pattern of future floods will be similar to the pattern of past floods current flood risk may be a useful predictor of future flood risk a corollary 250 non flood locations were also randomly selected in arcgis to provide a dichotomous dependent variable for modeling the two datasets were divided into training 70 and testing 30 sets by random selection 2 3 preparation of geospatial database flood influencing factors although there is no standard method for selecting the factors that might best predict future floods reflecting the sets of factors used in other studies costache 2019 termeh et al 2018 was our approach twelve flood influencing factors were selected and the spatial data that reflect the distribution of those factors were converted to raster format in arcgis with pixels of 12 5 m elevation previous research has indicated that elevation is among the most important factors affecting flooding it is inversely related to flooding the higher the elevation the lower the flood probability tehrany et al 2014 youssef et al 2016 elevations of pixels were measured from a dem of the watershed in arcgis slope slope is also important due to its effect on velocity and the volume of runoff at that location at any given point in time steeper slopes generate higher velocity and promote increasing volumes downslope chen et al 2020 slope values of pixels were also determined from the dem aspect sunlight intensity varies for the various slope aspects aspects receiving less intense sun have more soil moisture rainfall on moist slopes will more likely generate runoff contributing to flood risk downslope pradhan 2009 yariyan et al 2020b distance from river studies have demonstrated that proximity to a river influences the likelihood of flooding vojtek and vojteková 2019 floods are most likely to occur near a watercourse generally speaking as distance from a river increases flood risk diminishes bui et al 2019 the locations of past floods in this study tended to be proximate to a river rainfall precipitation amounts and rates affect flood potential the intensities and frequency of rainfall events are the most important precipitation characteristics bui et al 2019 costache et al 2020 average annual rainfall was calculated from long term 1990 2015 precipitation data gathered at 6 rain gauges in the region maps of rainfall were generated using kriging in arcgis software the station data in the area were obtained from the meteorological bureau and the water resources management organization of mazandaran province rainfall in the watershed ranged from 347 mm at higher elevations to 845 mm near the sea plan and profile curvature curvature maps reveal concavity positive curvature values and convexity negative curvature values of slopes positive and negative values in profile curvature indicate decreased flow velocity and increased flow velocity respectively fig 3 jenness 2013 the values of these two indices are calculated using the following equations 1 profile c u r v a t u r e z 2 z 8 2 z 5 2 ω 2 plan c u r v a t u r e z 4 z 6 2 z 5 2 ω where z is elevation of a grid cell and ω is cell size alkhasawneh et al 2013 these two layers were computed in arcgis and assigned to one of three classes convex flat concave topographic wetness index twi twi a unitless value indicates the influence of topography on the saturation levels of the landscape to induce runoff it is calculated by the following equation 3 twi as t a n σ a s a l where as is an area draining at a point t a n σ is slope in degrees a is areas of land upstream and l is effective slope measured to the point in the flow direction higher values indicate areas that are wetter and more productive of runoff contributing to a basin s output kirkby and beven 1979 land use and land cover lulc runoff volume and velocity are influenced by lulc yalcin et al 2011 many studies have shown the importance of lulc for flood generation choubin et al 2019 costache et al 2020a 2020b a lulc map was created from landsat 8 satellite data and an oli sensor 15 jun 2019 after image correction lulcs were classified as either rangeland forest agriculture garden or residential lithology infiltration capacity and sediment transport ratios are important characteristics of the lithology of a region lee et al 2012 a geological map of the study area was acquired from the geological survey mineral explorations agency of iran gsi https gsi ir fa drainage density the conditions of a drainage network influence its propensity to flood flow in a stream is faster than either overland flow or subsurface flows so the greater the drainage density the faster runoff accumulates and the hydrograph curve steepens talukdar et al 2020 topography position index tpi tpi is obtained from the ratio of the change in elevation of a cell relative to neighboring cells jenness 2000 tpi was calculated using sagagis software and the values were classified into 5 classes very low low neutral high very high in arcgis using natural break method 2 4 the algorithms employed 2 4 1 random forest rf random forest modeling is a relatively complex tree method in which several decision trees are trained to increase accuracy of the model it results in a group of decision trees in rf each decision tree is trained using a random sample selected from the training dataset breiman 2001 selection of predictor variables used to segment at nodes is also random in the random forest method the mtree and ntree properties are determined for the covariates used in each subset and the number of trees used in the forest respectively the number of variables can range from one to the full set of covariates the number of trees is selected by the user usually somewhere from 500 to 1000 are created pal 2005 it is possible to select the most important and most effective covariates estimation of a variable s importance is done by queuing the values of each variable in the out of bag oob samples which are usually 1 3 observations not used in the model and by reclassifying the oob samples using the row variable das et al 2017 in the rf each tree is created as follows 1 if n is the number of states in a training dataset n states will randomly sample by pasting in the original data this is a work set 2 if there are m variables and consider m smaller than m such that at each node m variables are randomly selected from m and the best separation in this m variable is used to create separation at the node the value of m is assumed to be constant during forest construction 3 each tree grows as large as possible there is no pruning 2 4 2 bayesian generalized linear models glmbayse bayesian reasoning is a probability based approach to inference the premise of this approach is that there is a probability distribution for each quantity which can be optimized by observing new data and rationalizing its probability distribution berry and berry 1996 bolstad and curran 2016 bayesian networks also known as belief networks belong to the probabilistic graphical model family these graphical structures are used to represent information in an uncertain field specifically each node in the graph represents a random variable and the branches represent probabilistic dependencies between the variables these conditional dependencies are often evaluated by specific statistical and probabilistic methods bayesian networks combine principles of graph theory probability theory computer science and statistics bayesian networks provide efficient representation and computation of the probability distribution shared over a series of random variables in addition bayesian networks model the intensity of the relationship between variables quantitatively allowing the conditional belief about them to be automatically updated by accessing new information bolstad and curran 2016 hoff 2009 bayesian learning is based on bayesian theory which allows the calculation of secondary probability based on the first probability 4 p h d p d h p h p d where p h d is posterior probability p d h is likelihood p h is prior probability and p d is evidence increasing p d decreases p h d because the higher the probability of d observation independent of h d is less likely to support h 2 5 predicting climate change to investigate the impact of climate change on flood probability we downscaled climate station data inside and outside of the study area the stations with the data needed to monitor climate change were chosen and their data were reconstructed modified and sorted the stations selected for climate change assessment were at gharakhil kordkhil solaman tengeh rig cheshmeh kiasar and sangdeh the station data covered 25 years 1990 2015 lars wg software and the hadcm3 model at a temporal resolution of daily were used to predict future climate conditions under the rcp2 6 and rcp8 5 scenarios the rainfall generation process through lars wg software involved the accomplishment of three stages the first step was represented by the model calibration which was done using the function site analysis from lars wg software in this stage the observed rainfall data was analyzed and their statistical parameters were stored into 2 dedicated files in the following stage the model validation was performed by comparing the statistical characteristics of the observed rainfall data and synthetic rainfall data finally after the validation stage the average annual rainfall data from each station were mapped the data were extrapolated to the study area using kriging in arcgis to reveal a future annual rainfall map for both scenarios in this study future rainfall estimates are for long term annual averages and no seasonal analysis has been performed these maps were incorporated as new layers to feed into the data mining models and to predict the spatial distribution of flood probabilities of the future 2 6 predicting lulc change landsat satellite imagery form tm and oli sensors having spatial resolutions of 30 m were used to create lulc maps for 1991 2010 and 2019 table 3 pre processing of the images including geometric and radiometric corrections of the images was undertaken to properly determine current lulc maximum likelihood classification was used to classify the training samples eskandari et al 2020 shooshtarian et al 2018 the maps were evaluated using kappa coefficient and overall accuracy tests see table 4 terrset software and land change modeler lcm were used to predict lulc changes lulc modeling using lcm involved four steps 1 investigation of change 2 assessment of transition potential 3 modeling lulc and 4 evaluation of modeling accuracy the 1991 and 2010 lulc maps were input into the lcm to analyze regional change and predict lulc changes to 2019 five sub models were used to model transition force using a multilayer perceptron neural network the sub models are agriculture to residential forest to agriculture forest to garden residential to garden and pasture to agriculture after selecting the sub models 6 influential factors elevation slope distance from road distance from river distance from residential area and distance from agricultural areas were selected using the cramer correlation coefficient for modeling fig 4 the transition potential of each use was modeled using multilayer perceptron neural network mlp the output of this step is input in the prediction stage after evaluating and validating the accuracy of the lulc predictions for 2019 lulc was predicted for 2040 using the 2010 and 2019 lulc maps and the results were evaluated 2 7 validating the models the relative operating characteristic roc curve a graphical representation of the balance between the negative and positive error rates for each possible value yariyan et al 2020a nguyen et al 2020 was used to evaluate the models the vertical and horizontal components of the roc curve are calculated from relations 5 and 6 respectively obtained from the comparison matrix the threshold limits are 0 and 1 pourtaghi and pourghasemi 2014 yousefi et al 2020 the area under the roc curve auc represents the accuracy of the predictions of flood and non flood events costache et al 2020a avand et al 2019 the values of the percentages of true negatives tn and true positives tp are used to calculate the values for the x and y axis of the graph of the curve 5 x 1 tn tn f p 6 y tp tp f n other criteria for evaluating the results of the models used in this study include sensitivity accuracy npv and ppv these are calculated thusly 7 sensitivity tp tp f n 8 accuracy tp t n tp t n f p f n 9 npv tn tn f n 10 ppv tp tp f p where in tn is true negative fp is false positive tp is true positive and fn is false negative 2 8 validating the lulc change model the kappa coefficient and overall accuracy were used to evaluate the classification accuracy and model projection of future lulc results table 3 accuracy is the ratio of the correctly classified pixels to the total number of classified pixels panigada et al 2019 and is calculated with this equation 11 oa 1 n p ii where oa is the accuracy n is the number of training pixels and p ii is the sum of the main diameter elements of the error matrix in many studies the kappa coefficient is used in tandem with oa deng et al 2008 taufik et al 2016 the kappa coefficient considers the number of incorrect pixels and is calculated using this equation 12 kappa p i p c 1 p c 100 where pi is observed correctly and pc is the expected agreement the ideal value for the kappa coefficient is one but if the product is zero the classification was random a negative value indicates that there was a classification error 3 results 3 1 projected lulc change the three maps of 1991 2010 and 2019 lulcs were used to predict lulc changes to 2040 the past and contemporary maps were classified into the 5 classes residential agricultural forest garden and rangeland fig 5 the results of the lulc transition sub model characteristics show that the best model in all five sub models is mlp model table 5 the forest to agriculture sub model was 96 45 accurate the most accurate among available sub models the past and present lulc maps were predicted using neural network classification this was enhanced by markov chain and lcm modeling to project to 2040 the results indicate that this model had an acceptable degree of accuracy kappa 0 85 in predicting future lulc changes in the study area if future lulc changes reflected the forces at play for the past 29 years forest land would be reduced to 77 19 km2 which is a 2 02 reduction from the currently forested area furthermore rangelands would decrease by 5 74 from present residential agricultural and gardened lands would grow by 0 45 6 82 and 9 17 respectively table 6 fig 6 3 2 projected climate change the 6 regional weather stations that provided meteorological measures from the last 20 and 25 years were used to determine the effect that climate change may have on future rainfall patterns in the study area lars wg software and the hadesm2 model were used to downscale under two climate scenarios an optimistic rcp2 6 and a pessimistic rcp8 5 future fig 7 the observed and simulated values match and do not vary much in terms of future rainfall values the results reveal that areas closer to the caspian will have much more rainfall under both scenarios the increase in precipitation is smaller in higher elevations the seasonality of precipitation seems to change in the future it is slightly lower from april to july but increases sharply from october to december 3 3 flood susceptibility map the present and future flood susceptibility maps of the study area reflect the influences of changing climates and changing lulcl they were produced by rf and glmbayes machine learning models there are several factors that affect runoff in a watershed each has a unique potential to change flows and the prospects for floods the influences of the factors affecting floods in tajan watershed were ranked fig 8 elevation 21 55 distance from river 15 28 lulc 11 1 slope 10 85 and rainfall 6 8 had the greatest effect on the patterns of flood susceptibility the maps created were classified using natural break tools in arcgis as very low low moderate high and very high figs 9 and 10 3 4 evaluating and comparing models the models predictions were validated with the roc curve and other criteria it should be noted that these performance indicators are fitted to evaluate the performance of the models in terms of spatial distribution because they measure the degree in which the observed flood points overlap the very high flood susceptibility the roc curve validation indicate that modeling with contemporary conditions in the study area present rainfall and lulc the rf model auctest 0 91 was a more accurate predictor of flood susceptibility patterns than the gmlbayes model auctest 0 847 fig 11 a b table 7 the models were run using the validation dataset based on 2040 lulc and future climate data based on the pessimistic and optimistic climate models fig 12 a b again the auc for the rf models 0 913 and 0 91 respectively exceeded those of the gmlbayes models 0 872 and 0 834 respectively run with the training dataset table 8 under the 2040 scenarios fig 13 a b the rf models 0 974 and 0 967 respectively was more accurate than the gmlbayes models 0 932 and 0 912 respectively rf was the better model under these conditions 4 discussion lulc and climate have direct and indirect effects on floods having the capacity to predict the effect that each has on the spatial patterns of flooding in the future could improve managers abilities to avoid flood losses 4 1 the effect of lulc changes on flooding to better manage the watershed over the next 20 years several processes were used to project the present conditions into the future the lcm method was used to model lulc change in the tajan river watershed the maps of lulc change produced for 2010 2019 and 2040 were based on training points and the maximum likelihood method their accuracies assessed with the kappa coefficients were 0 82 0 84 and 0 80 respectively the overall accuracies of these models were 89 45 93 81 and 91 85 respectively indicating that they produced good predictions of lulc changes in the past to the present and into the future the cramer correlation coefficient shows that elevation and distance from roads are the greatest factors dictating lulc changes in the study area the highest concentrations of villages and agricultural lands are in lower elevations roads enable more access to land in the watershed rafaai et al 2020 shooshtarian et al 2018 the probability of flooding in lower elevations is higher and because the lower downstream elevations where land is comparatively flat are where one finds more residential areas and agricultural lands the hazard probability of negative impacts to people property and infrastructure is higher these findings are consistent with the results of dammalage and jayasinghe 2019 and hu et al 2020 which state that the amount of runoff increased due to the change of use of agricultural and forests lands in the downstream areas and their conversion to impermeable surface furthermore communication paths like roads also contribute to land degradation and increase the potential for flood damage after confirming the models accuracies for predicting lulc for 2019 the markov chain method was used to predict an lulc map for 2040 the lulc forecast for 2040 indicated increases in lands used for gardens 34 98 9 17 for agriculture 260 21 6 82 and for residential space 17 29 0 45 lands and decreases of forested land 77 19 2 02 and rangelands 218 83 5 74 in the study area rangeland will decrease the most 5 74 from the present forested lands have been diminished more slowly in recent years which reveals the beneficial outcomes of the strict rules applied in this watershed due to decreased forest and rangeland and increased agricultural and residential lands one should expect that the speeds and volumes of runoff will increase heightening future flood risk this is consistent with previous studies hu et al 2020 hung et al 2020 4 2 the effect of climate changes on flooding climate change can lead to serious effects on the timing seasonality frequency volumes and duration of precipitation events rainfall data covering a 25 year period from 1990 to 2015 at 6 weather stations were used to evaluate the effects of two climate change scenarios rcp2 6 and rcp8 5 on future flood risk patterns the method of this research is consistent with the method of akter et al 2018 roy et al 2020 to investigate the effect of using different scenarios of climate change on flood risk the results of modeling showed that the changes in rainfall patterns at the stations are different primarily because of the circumstances of their geographical locations the three stations at higher elevations sangdeh kiasar and soleiman tangeh have smaller precipitation changes and their precipitation totals will be lower in the future compared to the three stations at lower elevations kordkhil rig cheshmeh and gharakhil lower elevations are projected to receive more rainfall in the future due to their proximity to the caspian sea flooding will likely increase in the downstream reaches of the watershed due to the increased rainfall in this part of the watershed this is consistent with other studies fang et al 2020 seingier et al 2020 the concentrations of residential development and agricultural land use is greater downstream therefore flood losses should be expected to increase if everything else remains constant seasonality of precipitation should also change the models show that all stations should see decreased precipitation amounts during spring and early summer april to july and increased precipitation in the autumn october to december 4 3 using rf and glmbayes for flood susceptibility mapping the spatial factors that most influence flood risk in the study area are elevation distance from the river lulc slope and rainfall as elevation distance from the river and slope are essentially static unless there is a major landscape changing event the main dynamics influencing flooding should be lulc and precipitation a function of climate human activities are influential on both of these spatial characteristics the lulc change scenario used in this study was based on an assumption that lulc change in the next 20 years 2019 2040 will mimic the processes that caused the lulc changes of the past 29 years 1990 2019 the results are that most lulc changes will occur in the lower elevations and near roads and rivers reducing specific lulcs like forests and increasing rainfall in the lower elevations will augment the frequency and severity of floods in these areas therefore these results are consistent with the findings of costache and pham 2020 roy et al 2020 regarding the increase of flood potential in areas where the forest lands area in inclined plan has decreased in recent years and has led to an increase in runoff velocity although the consequences of climate change coupling with the impact of projected lulc on floods remains controversial the impacts of climatic variability demand need in depth research while rainfall is regarded as the most important climate factor in certain regions for flooding kourgialas and karatzas 2011 and the runoff factor is the flood event segond et al 2007 most influential factors for flood events are slope elevation and distance from river etc the present flood susceptibility map generated by the rf model shows that the very low risk class 1503 01 km2 covers the largest portion of the watershed the high susceptibility class was assigned to the largest area 1335 54 km2 by the glmbayes model the maps of future flood probabilities produced by the rf model incorporating the lulc changes occurring by 2040 and both the rcp2 6 and the rcp8 5 climate scenarios also show predict that the largest percentage of the study area would have very low flood susceptibility the glmbayes model on the other hand classified the largest percentage of the study area as high risk evaluations show that the rf model auctest 0 91 is more accurate than the glmbayes model auctest 0 847 which is consistent with the findings of other researchers who have described the rf model as a more accurate model chen et al 2020 lee et al 2017 dou et al 2019 they similarly conclude that the rf model provides good accuracy when predicting flood susceptibility some previous work supports our findings on the potential impact of climate change and land use on flood risk areas akter et al 2018 dobler et al 2012 szwagrzyk et al 2018 5 conclusion this study was conducted to determine the spatial patterns of flood susceptibility in the present and future for the tajan watershed twelve geophysical and anthropogenic factors that affect flood risk were used to determine areas that are more likely to flood the most important effective factors in this basin are elevation lulc slope and rainfall due to the importance and temporal variability of lulc and rainfall and the effects that these two factors have on runoff the influences of their changes were investigated lulc changes were determine over the course of a 29 year 1991 2019 period future lulc changes were projected based on the past processes future lulc forecasts are that the areal extents of forest and rangeland will decrease and the areas of agricultural land uses gardening and residential properties will increase together these shifts will increase runoff and promote flooding in the downstream areas of the watershed daily weather data collected over a 25 year period 1991 2015 at 6 stations were used to assess the effects of climate change on future flood probabilities the lars wg model was used with optimistic rcp2 6 and pessimistic rcp8 5 climate scenarios to predict the patterns of future climate changes changing climates in the study area are expected to generate more rainfall at lower elevations and nearer the coast of the caspian sea and the greatest amounts of precipitation will occur between october and december to investigate the effects of lulc and climate changes on future flood probabilities new layers of future lulc and rainfall produced from the two scenarios rcp2 6 and rcp8 5 and ten flood affecting factors the results of this modeling depict an increase in the area of the zone with greatest flood risk due to climate scenario rcp8 5 and future lulc the rf model was consistently more accurate than the glmbayse when it came to predicting the results from the relations between lulc climate change and flooding in the tarjan watershed iran declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgment this research is the product of a ph d thesis research project with the code 98020262 entitled the effect of climate and land use changes on temporal and spatial variability of vulnerability and flood risk in the iran national science foundation insf therefore the authors of this article would like to appreciate the support of this fund finally the authors would like to show their appreciation to the unknown reviewer for their useful comments on this work 
4824,the design hydrograph estimation in small and ungauged basins represents one of the most common practices and yet a challenging open research topic for hydrologists when discharge observations are not available the practitioner is compelled to apply empirical approaches the rational formula is slowly disappearing while event based approaches are more and more widespread a step forward is represented by continuous models that have the potential to address the major drawbacks of event based approaches in this work we applied a continuous model specifically designed for ungauged basins cosmo4sub and tested its use in conditions where typically the rational formula and the event based approaches are applied results confirm that the continuous modelling is suitable for rapid and effective design simulations supporting flood hazard modelling and mapping studies keywords continuous hydrologic modelling design hydrograph design simulation small basins ungauged basins 1 introduction prediction in small and ungauged basins is an evergreen topic in hydrology the understanding simulation and mitigation of flooding scenarios in watersheds characterized by limited contributing areas represent an open challenge for researchers and floodplain managers raising impacts of flash floods are prompting hydrological sciences to find viable modelling approaches in order to tackle the lack of discharge observations and the impossibility of adopting early warning systems a critical gap especially for small scale basins barredo 2007 marchi et al 2010 several studies emphasized the importance of proper knowledge of flood wave generation and dynamics in upstream basins and tributaries allamano et al 2009 convertino et al 2019 mcglynn et al 2013 peña and nardi 2018 petroselli et al 2019 2020a 2020b since the inception of the prediction in ungauged basins pub decade by the international association of hydrological sciences 2003 2012 sivapalan et al 2003 blöschl et al 2013 hrachowitz et al 2013 to most recent iahs panta rhei effort fostering crucial stimuli to address most pressing social challenges linked to hydroextremes montanari et al 2013 the meaning of the term ungauged has changed recent advancements of remote sensing technologies providing a new generation of large scale topographic and hydrologic observations are suggesting to redefine the meaning of the original desperate ungauged definition digital elevation and terrain models are nowadays freely available for the entire globe supporting topographic land and human feature characterization at adequate resolution for hydrologic studies e g yamazaki et al 2017 melchiorri et al 2018 rainfall observations are increasingly available at different spatial and time scales with length of precipitation records reaching a multiple decade length sun et al 2018 considering the attention and financial support received since the 80s while recent budget reduction and decreased interest in ground base precipitation monitoring in favor of remote sensing berne et al 2004 paz et al 2020 are posing challenges for many regions of the worlds that are lagging behind for the lack of adequate financing and implementation of ground hydrologic observations jenkins et al 2020 we posit here that the concept of ungauged shall be mainly linked to runoff processes we define ungauged those basins completely or partially lacking of hydrometric observations and consequently unable to support calibration procedures for elaborate hydrological modelling in practical terms ungauged basins represent case studies where practitioners are forced to use empirical approaches for the lack of flow discharge and hydrograph series data and frequency analyses the rational formula represented the most popular approach for rainfall runoff modelling due to its simplicity and to the limited watershed input information needed for its application digital topography and computer power advancements fostered the development of ungauged basin rainfall runoff models paving the way for effective employment of event based approach in place of the rational formula viglione and blöschl 2009 castiglioni et al 2010 blöschl et al 2013 haberlandt and radtke 2014 sene 2012 such improvements allowed to mitigate some crucial drawbacks of rational formula providing more accurate results while reducing the chronic uncertainty of empirical procedures as emphasized in grimaldi and petroselli 2015 event based approaches reduce the subjectivity of empirical procedures relaxing the flood analyst assumptions and diminishing the major uncertainty components affecting hydrologic modelling parametrizations a further pivotal scientific advancement was represented by statistical climate and weather modelling whose spatial and temporal scale accuracy and effectiveness grow considerably in the last decade indeed statistical methods for rainfall simulation rapidly evolved making available a variety of approaches and models that are able to generate any kind of synthetic scenarios just to mention some examples koutsoyiannis et al 2003 kossieris et al 2018 müller and haberlandt 2018 papalexiou 2018 toulemonde et al 2020 this represents an additional crucial outcome potentially helpful for the hydrologic modelling in ungauged basins rainfall observations daily sub daily maximum annual values for different durations and time series generations are available for as fundamental input for continuous models data availability and science advancements stimulated a variety of investigations on continuous frameworks for hydrological applications ormsbee 1989 blazkova and beven 2002 chu and steinman 2009 camici et al 2011 pathiraja et al 2012 breinl 2016 lamb et al 2016 blazkova et al 2017 davtalab et al 2017 rowe and smithers 2018 winter et al 2019 it is our opinion that continuous model evolution is mature enough to support its development for ungauged basins boughton and droop 2003 apparently it could be a contradiction to adopt a more complex approach for case studies without sufficient observations for calibration continuous hydrologic modelling are not more parameter parsimonious or less complex than event based approaches however the added value of continuous approach is significant in term of mitigating artefacts linked to synthetic and subjective characterization of design hydrograph attributes grimaldi et al 2012b rogger et al 2012 falter et al 2015 okoli et al 2019 berthet et al 2009 fleischmann et al 2019 winter et al 2019 we posit that the leap forward observed in the replacement of the rational formula with event based approaches is analogously developing for the transition from event based towards continuous modelling in practice the benefit would be to have a more realistic estimation of hydrograph volume and duration to remove some modules of the event based approach i e design hyetograph intensity duration frequency idf curves and to have available a design simulation that consists in a long runoff time series useful for a variety of applications crucial also for small basins this work is based on the application of the continuous simulation model for small ungauged basins namely cosmo4sub grimaldi et al 2012a in this work a step forward for cosmo4sub model is proposed and tested to verify its practical use compared to the original cosmo4sub contribution here the procedure is tested applying the rainfall runoff transformation on observed long rainfall time series that allows a more realistic evaluation of the continuous framework moreover the excess rainfall estimation is performed implementing the cn4ga curve number for green ampt method grimaldi et al 2013a 2013b that substitutes the standard nrcs cn national resources conservation service curve number method included in the original version of cosmo4sub in this work the model accuracy obtained comparing observed and simulated discharges is not provided since already verified in a previous work grimaldi et al 2012a while sensitivity analyses on separation time extreme event selection hydrograph identification and computational time are implemented benefiting from the use of an observed rainfall time series 2 data and materials the rainfall time series at 10 min resolution tu pham et al 2018 is employed being one the longest and consistent series available to date at global scale the time series consists of 105 years of rainfall observations from 1 january 1898 to 31 december 2002 measured by a hellmann fuess pluviograph in the climatological park of the royal meteorological institute at uccle see fig 1 a near brussels belgium demarée 2003 the recorded rainfall data have a constant high quality over the observation period because data has been recorded since 1898 by the same measuring instrument at the same location and adopting the same data processing method ntegeka and willems 2008 this time series is particularly useful for investigating on model parameters related to inter event rainfall properties that could not be well reproduced by synthetic rainfall scenarios indeed it is useful to verify if the trivial rainfall spikes or natural intermittency could affect the separation time parameters or the output hydrograph selection definition and details will be available in section 3 a brief overview of the uccle rainfall time series is provided in table 1 a small watershed located in proximity to the uccle raingauge is selected as case study see fig 1a it pertains to the catchment of the molenbeek river tributary of deender river located in west part of brussels in a region delimited by the villages of erpe mere north east corner and zottegem south west corner the watershed is identified by the outlet cross section of mere with a total contributing area of 41 1 km2 the digital elevation model dem was gathered from the copernicus land monitoring service eu dem and resampled at 50 m resolution as shown in fig 1b the selected domain of study is characterized by a long and narrow shape it is located in a flat area with an elevation range 22 92 m a s l and an average slope 2 9 the simulated drainage network is estimated using 0 5 km2 as contributing area threshold at the watershed concentration time tc is estimated to be approximately 9 8 h nrcs 1997 the watershed pertains to a region with mainly loamy soils and a gentle rolling landscape the soils have different drainage conditions ranging from dry to medium wet and profile development ranging from poorly to strongly differentiated horizons the soil moisture storage capacity is limited so the river has large discharge fluctuations the baseflow discharges are small while the response to rainfall is significant it is noteworthy that in the selected cross section measurement of hourly discharge is available from 1986 the mean and maximum flows can be estimated as 0 45 m3 s and approximately 10 m3 s respectively the land cover was classified by means of the corine land cover database at level iii and related to the year 2018 the upstream watershed area is mainly rural while the downstream part is more urbanized agricultural activities in the catchment account for the 76 of the total area the nrcs curve number value equal to 64 4 was quantified through empirical evaluation using look up tables nrcs 2008 for a more detailed characterization of the catchment see el sadek 2007 and willems 2014 3 cosmo4sub modelling approach a detailed description of continuous simulation model for small and ungauged basin cosmo4sub is available in grimaldi et al 2012a while here a brief description is reported focusing on the modules that have been the subject of novel updates the cosmo4sub approach is characterized by four steps 1 the rainfall scenario simulation 2 the excess rainfall estimation 3 the excess rainfall runoff transformation 4 the design simulation strategy the first step of cosmo4sub model is the rainfall scenario simulation starting from raingauge data series a long sub hourly rainfall time series is generated 500 or 1000 years at 10 15 min of resolution represent ideal model input in the original cosmo4sub work a mixed copula based simulator and a continuous in scale universal multifractal approach were employed noting that the identification of the appropriate rainfall generator is a crucial step considering a wide variety of options are available in literature caldwell et al 2009 kossieris et al 2018 callau poduje and haberlandt 2017 kim et al 2017 pohle et al 2018 li et al 2018 verdin et al 2019 zhao et al 2019 zhou et al 2020 a specific study for investigating which rainfall generator model would be the optimal candidate for cosmo4sub will be investigated in a further ongoing work it is important to further emphasize that the proposed framework is tailored for estimating the design hydrograph or the design simulation so it aims to appropriately reproduce extreme events for small and ungauged basin in order to avoid any bias due to the inherent approximation of a generic rainfall simulator in the present work we use the uccle rainfall time series that is a perfect input for testing the entire framework demarée 2003 tu pham et al 2018 since it is not necessary to hypothesize a design hyetograph with all related parameters as in the common event based approaches the second step of a continuous framework is the excess rainfall estimation in the previous version of cosmo4sub the standard nrcs cn method was implemented however following the interesting debate present in literature eli and lamont 2010 we are aware that this method is not appropriate to be applied at sub daily scale and in continuous framework such abuse garen and moore 2005 motivated us to deeper investigate on this problem identifying a solution in merging the nrcs cn method with the green ampt ga equation green and ampt 1911 as a result the cn4ga model grimaldi et al 2013a 2013b is proposed and here applied in practice the proposed approach applies the nrcs cn method to quantify the excess rainfall depth as recommended and expected at event scale and uses the ga equation to distribute in time the contributions to this depth the ga parameters are estimated constraining the equation to give the total excess rainfall depth equal to that estimated by nrcs cn preserving the entire procedure as calibration free in appendix a 1 some details of the procedure are briefly recalled and illustrated in previous studies the practical effect of cn4ga approach was investigated at the event scale and the results obtained using observed rainfall runoff events suggest that the nrcs cn method tend to underestimate the peak discharge due to an inappropriate effect of initial abstraction on the hyetograph peaks the present work is going to further verify the effect of cn4ga when applied in a continuous framework using as input an observed long rainfall time series we are aware that the nrcs cn approach is not the best method available for a continuous model indeed it does not include intra event soil moisture condition module however since it allows to minimize the input information it is appropriate for cosmo4sub model being tailored to small and ungauged basin one of the various drawbacks is that it still makes necessary although in contradiction to the continuous set up a sort of rainfall event identification through an additional parameter that we named separation time ts this parameter represents the dry period or almost dry that should be waited so that the initial abstraction became again effective in previous work the sensitivity of this parameter was analyzed using long synthetic rainfall time series its effect on the design hydrograph was minimal and apparently 24 h as suggested by nrcs cn implementation fennessey 2001 is a reasonable value to be used in the present manuscript the sensitivity is further verified introducing also a different definition of ts that is the period not dry but in which a minimal amount of rainfall named drop parameter is observed fig 2 describes the meaning of these parameters ts and drop their influence on the hydrograph and the interaction with tc the ts effect is limited to the excess rainfall estimation when the time distance between two storms is less than the separation time the cn4ga method is applied on the sequence of the two storms considered as a unique event case a in fig 2 on the contrary case b they are analyzed as two independent rainfall events this characterization affects the total gross precipitation amount and the antecedent moisture condition amc 5 days values in both cases the resulting flood hydrographs are influenced by the convolution of the unit hydrograph and so by the concentration time the third step of the procedure is the excess rainfall runoff transformation the wfiuh model is applied for convoluting excess rainfall into runoff time series concerning this step no specific modifications are introduced comparing to the original cosmo4sub version in our opinion the wfiuh approach appropriately modified for ungauged conditions grimaldi et al 2012c is the most efficient method available since it allows to optimize the available digital topography information enforcing hydrogeomorphic processes that represent governing factors of floodplain generation dynamics annis et al 2019 nardi et al 2018 2019 for sake of brevity here wfiuh computational details are not reported and the reader can refer to grimaldi et al 2012c the breakthrough innovative iuh definition as travel time distribution of watershed dem cells rodriguez iturbe and rinaldo 1997 opened the way to provide a calibration free iuh flow path hillslope channel discrimination velocity estimation on hillslopes are easy step useful to quantify the flow time or travel time distribution since the expected final user of cosmo4sub is the practitioner that in similar context would have applied the rational formula we prefer to constrain the channel velocity to the concentration time or to the lag time this procedural step includes two parameters to be assigned by the user while the hillslope velocities are empirically quantified using distributed slope and land cover information the contributing area threshold useful to discriminate channel and hillslope cells and concentration time should be preliminarily quantified the first one has a minor impact on the final results while the second one much more impacting is typically estimated using empirical formulas petroselli and grimaldi 2018 once the entire runoff time series is estimated in the last step the design simulation strategy is implemented there are several options available that could be applied depending on the hydrological application the practitioner could directly apply the simulated runoff time series grimaldi et al 2013c sikorska et al 2018 select the design peak discharge applying a common flood frequency analysis on the extreme values de paola et al 2018 estimate the design hydrograph serinaldi and grimaldi 2011 brunner et al 2017 or apply a montecarlo approach using the entire sample of simulated hydrographs annis et al 2020 for the two latter options it is necessary to appropriately isolate flood events preventing overestimation and underestimation of hydrograph volume and durations in section 4 a specific analysis is provided to support the assessment of the different possible approaches 4 cosmo4sub testing this section presents a sensitivity analysis of cosmo4sub modules and parameters specifically the following five tests are described test 1 comparing effects of cn4ga as respect to the nrcs cn approaches test 2 the sensitivity of design parameters to varying ts and drop parameters test 3 comparing methods to extract flood hydrograph events from the simulated continuous flow time series test 4 the influence of the sample selection criteria for flood frequency analysis test 5 the computational time reduction the five tests are conducted varying methods and parameter values as respect to reference cosmo4sub model configuration the reference cosmo4sub model for the case study is defined assuming the parameter values listed in table 2 and selecting extreme events using the annual maximum method with the peak discharge q as driving variable 4 1 test 1 cn4ga vs nrcs cn as mentioned in section 3 and in appendix a 1 the cn4ga method was previously tested in event based hydrologic modelling analyses this test aims to verify if the nrcs cn modelling behavior i e flood peak underestimation in particular is confirmed in a continuous modelling approach using a long observed time series as input the cn4ga and nrcs cn excess rainfall estimation methods are both applied using the reference model parameter set up the resulting hydrograph characteristics peak volume duration are compared and discussed considering the impact of varying cn parameter the simulations are replicated using cn 74 4 and 84 4 4 1 1 test 2 ts and drop parameters in this test the influence of ts and drop parameters is assessed in terms of flood event selection within the continuous time series as previously mentioned and illustrated in fig 2 two events are considered to be disconnected if within a certain duration ts a certain negligible rainfall amount drop is detected the drop parameter is introduced for filtering out very minor rainfall depths that could impact the flood event filtering process starting from the reference model configuration ts and drop are varied respectively from 18 to 30 h with incremental steps of 2 h and from 0 to 0 5 mm with incremental steps of 0 05 mm the aim of the analysis is to verify the sensitivity of the hydrograph characteristics discharge volume and duration to varying ts and drop parameters 4 1 2 test 3 hydrograph selection continuous model output is a long runoff time series at high time resolution the user is thus requested to extract hydrographs from the simulated series this is common straightforward practice in case of runoff time series in absence of sub surface and base flows the two main approaches generally adopted are 1 selecting the hydrograph starting from the first q 0 value and ending when the q 0 2 introducing a threshold qs value for filtering the time series q qs and selecting hydrographs as in 1 it is noted that the two different approaches determine significant differences in the obtained hydrograph volume and duration the approach selection shall be thus performed in relation to the design application for instance in case of high time resolution like in the present case study of 10 min adopting approach 1 two runoff events could be separated just because there are 10 min of null discharge in order to verify the practical differences in the hydrograph selection approaches twelve configurations as listed in table 3 are tested applying the reference configuration model 4 1 3 test 4 extreme hydrograph selection a further issue often neglected relating to the synthetic design hydrograph characterization is the extreme event selection brunner et al 2017 while the design peak discharge estimation is quite straightforward the design extreme hydrograph is not a trivial step in fact in this case three important hydrograph attributes are considered the common approach is selecting the maximum annual values referring to the peak discharge as driving variable and once the event is identified the triplets peak q volume v duration d are estimated this is a well known problem in extreme analysis since this approach not necessary select extreme values for v and d and this should be taken into account in the statistical analysis analogously to test 3 the optimal methodology strictly depends on the design application for instance the driving variable could be another attribute and not necessarily q in order to assess the effect of this procedural step on the corresponding extreme event selection three scenarios are compared the common annual maximum value amv using q as driving variable the peak over threshold using q as driving variable with a threshold level giving nearly the same sample size of amv a bivariate extreme value selection choosing all the events with a joint non exceedance probability value of q v higher than a threshold fixed to give a sample size similar to those of the other scenarios the joint non exceedance probability is empirically estimated this third scenario includes only the q v values because d is not usually relevant in design estimation and because it is an unstable parameter i e d is too variable to be considered as driving variable in the event selection approach the comparison is provided applying the basic configuration with three cn values 64 4 74 4 84 4 4 1 4 test 5 computational time reduction in the present paper the 105 years long 10 minutes resolution rainfall time series determine a computational time of few minutes for running the cosmo4sub model on a common personal computer pc considering that the final model configuration will be provided as input a synthetic rainfall time series of 500 years or 1000 years at 10 min of resolution the computational burden could be an issue for the effective transitioning to continuous modelling in practical applications this could be amplified considering that the computational time should also include the calibration and simulation of the rainfall synthetic time series module and in practical application several framework running to identify appropriate model parameter values in order to reduce the computational time a possible solution is to reduce the number of processed rainfall events considering that the excess rainfall calculation is one of the major computationally intense steps assuming that while aiming to estimate the design hydrographs the interest is linked to events with higher magnitude filtering out very minor rainfall events should have negligible impact on the design variables in practical terms the solution for optimizing the computation process is to remove all events characterized by a total excess rainfall amount that is lower than a predefined threshold consequently the computational time reduction and the effect in the flood frequency analysis are verified starting from the reference model configuration for a specific cn value 9 excess rainfall thresholds are tested considering a range starting from 0 to 2 mm with incremental step 0 25 mm since results could be strongly dependent on the cn for higher cn values a corresponding higher number of rainfall events are available the test is implemented for 7 cn values from 55 to 85 with incremental step of 5 5 test results test 1 results are presented in the matrix plot of fig 3 the maximum annual triplets of q v and d values selected using q as driving variable are shown to compare the varying results corresponding to the application of the nrcs cn and cn4ga methods the three columns refer respectively to three different cn values 64 4 74 4 84 4 while the rows correspond to the hydrograph attributes q v d in each plot the two excess rainfall estimation methods are compared showing empirical return periods in general for the conducted tests the comparison return period values are low and limited to 20 years in fact the length of the rainfall time series 105 years does not allows to focus on more representative flood events results of simulated peak discharge values confirm the attitude of the nrcs cn method in underestimating q indeed the differences among the two curves are visible on the entire return period range reach up 22 8 for tr 20 years and cn 84 4 and increasing for higher cn value the volume variable overlapping is expected considering the adopted cn4ga approach methodology see appendix a 1 that distributes in time the nrcs cn excess rainfall cumulated depth for matching volumes the varying duration values suggest that applying the cn4ga we obtain hydrographs with shorter duration this is also expected in line with previous findings align with the aim of providing excess rainfall event more intermittent and coherent to the natural rainfall behavior the difference between the durations is homogenous for the entire range of return period and for the varying cn values reaching up a 36 2 maximum variation cn 74 4 and tr 10 years test 2 results are presented in fig 4 illustrating the outcomes of the sensitivity analysis with varying ts and drop parameters matrix plots are used with columns referring to different cn values and rows showing the hydrograph attributes q v d each sub plot presents a raster where hydrograph attributes are the cell value corresponding to model configuration associated to ts and drop x and y axes the cell values are color coded as a function of the percentage of difference to the reference model configuration also depicted as no variation white cell this latter is highlighted with black contour the three attributes q v d corresponds to the 80 quantile of the maximum annual values using q as driving variable while in the proximity of the reference model configuration the differences are limited 5 10 for the present case an higher variability compared to the previous studies grimaldi et al 2012a is quite visible in order to clarify the remarkable differences obtained it is useful to recall the effect of ts parameter increasing the ts it is expected to have longer rainfall events a larger amount of gross and excess rainfall and consequently higher peak discharge volume and hydrograph duration a secondary and opposite effect could also concur to determine such differences considering that longer rainfall event may group more than a single event and a decreasing amc class can arise causing reduction of peak discharge volume and duration these two opposite effects strive to be balanced when a large number of events are available in previous investigations grimaldi et al 2012a 500 years of synthetic rainfall series were analyzed this can motivate the test outcomes that with only 105 years of series length the ts produces more variable results this suggests that long time series are necessary and future research will be useful to verify such behavior with increasing time series length probably towards 1000 years furthermore a minor concurring cause of such a significant variability is related to the different excess rainfall estimation methods the cn4ga method as shown in fig 3 is characterized by more intermitted storms with higher variance that can amplify the ts variability effects especially when considering relatively short input rainfall time series test 3 results reporting the impact of the hydrograph selection strategies are illustrated in figs 5 and 6 fig 5 compares the q v and d values associated to empirical return periods obtained with the varying scenarios listed in table 2 the comparison is repeated for three cn values the blue line represents the reference model configuration scenario n 7 q0 the black area includes the envelopes of results corresponding to the five dry scenarios n 8 n 12 while the gray area reports the six q threshold scenarios n 1 n 6 the plots missing to include the black and gray areas show the absence of variability with scenarios overlapping to the reference model configuration this is evident by looking at the first row of the q plots where by definition any variability could occur concerning volumes shown in the second row of the matrix plot the dry scenarios exhibit no significative divergence from the reference values while for the q threshold scenarios a limited variation is visible higher for the cn 84 4 that reaches 11 2 for the scenario q03 as expected duration values are significantly affected by the selection strategies however it is confirmed the minor effect of dry compared to the q threshold scenarios specifically duration values can show variations till to 51 2 for the scenario q03 fig 6 provides a comparison among the different scenarios from a different perspective indeed the kendall s τ dependence measure estimated on pairs q v v d d q are shown results suggest that dependence structure of q v is not affected by the hydrograph selection strategies while the differences become more relevant for v d and d q for this latter the variability is more significant for low cn values results does not support to extrapolate general conclusions since they are related to a specific case study however it is evident that the duration variable appears to be particularly influenced by the different hydrograph selection strategies and the volumes are also particularly impacted by varying cn values future analyses on different case studies and using longer synthetic time series are needed to investigate and generalize such modelling behavior results of test 4 on the extreme hydrograph selection analysis are depicted in figs 7 and 8 the first one compares q v d for several return periods using different extreme event selection methods extreme values ev joint extreme values jev and annual maximum values amv concerning q and v results are similar with a tendency to be equal considering ev and jev while as expected d is more affected by the sampling strategies reaching more significant differences as in the case cn 84 4 and tr 4 years where jev and ev amv differ of 25 fig 8 provides an overview of the same comparison test using the kendall s τ here results appear significantly different suggesting the attitude of amv to provide more correlated pairs differences increase with the increase of cn values and more prominently for the d variable impacting a possible multivariate frequency analysis the discrepancies related to varying cn values are justified by the larger number of events produced with higher cn values so this is resulting in a reduction of the correlation related to the application of the jev strategy since for each peak discharge value several possible volumes are possible and available the lower τ for jev evident in general is due to the inclusion of flood events maximizing their volume and consequently their duration this is determining a variety of events that are necessarily less correlated finally the last test results related to the cosmo4sub computational times varying cn values and reduction strategies test 5 are available in fig 9 the first column values represent the computational times corresponding to model applications without any excess rainfall restrictions while varying cn values y axis computation times vary from a minimum of 100 s for the cn 55 to the maximum of 418 s for cn 85 indeed for higher cn values larger number of rainfall events need to be processed applying a higher excess rainfall threshold x axis values that is removing all the storms with cumulative excess rainfall depth less than a fixed value a reduction of the computational time is assesses this is shown in fig 9 where the gray scale cells refer to the percentage of reduction as respect to the reference model configuration interesting to note that with only a 0 25 mm threshold a significant computational time reduction is obtained 50 for cn 70 and that all configurations shown in fig 9 do not significantly alter not shown here for the sake of brevity the extreme event properties 6 conclusions continuous rainfall runoff modelling frameworks are reaching maturity for hydrologic modelling on small and ungauged basins with limited or lacking flow records remote sensing hydrologic monitoring and modelling advancements driving such modelling evolution allow continuous models to provide more accurate and more versatile outputs that may be tailored for a variety of hydrological applications in the present contribution improvements of a continuous simulation model named cosmo4sub are described and tested an advanced excess rainfall estimation module cn4ga and sensitivity analyses are provided using as input a very long rainfall time series 105 years observed at 10 min of resolution this represents an excellent case study considering this rainfall time series overcomes the issue of synthetic rainfall time series the case study results support some conclusions that in future researches can be verified using longer synthetic rainfall time series the cn4ga module performed well in the continuous framework confirming its attitude shown in previous contributions where it was applied at event based analysis the separation time parameter necessary to separate the rainfall events for applying the cn4ga method confirmed an encouraging limited variability although higher compared to previous analysis suggesting for future application of the framework to use a longer input time series possibly 1000 years hydrograph and extreme event selection strategies typically neglected in the hydrological studies needs to be seriously considered and standardized since its impact could affect final design output the computation time is coherent to the common modelling tools applied in hydrological studies and can be reduced without altering the final output although further analyses are necessary to reach more general conclusions and to identify the optimal rainfall simulation model useful for such continuous modelling it is already possible to affirm that it is worth to apply a continuous model in small and ungauged basins by the professional community since it offers some useful ameliorations in the design hydrograph estimation and consequently in the design simulation funding this work was supported by the italian ministry of the environment land and sea mattm through the projects gest river gestione ecosostenibile dei territori a rischio inondazione e valorizzazione economica delle risorse and simpro simulazione idrologico idraulico economica di progetto per la mitigazione del rischio idraulico and by the fwo project g003918n stochastic modelling of future extreme discharges as a tool for water resources engineering declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper appendix a 1 nrcs cn procedure for each gross rainfall event the time distribution of the cumulative excess rainfall pnrcs t mm is estimated according to the following formula nrcs 2008 a 1 p nrcs t p t i a 2 p t s i a f o r p t i a 0 f o r p t i a where p t mm is the time distribution of cumulative gross rainfall value s mm is the maximum potential basin retention and ia mm is the initial abstraction due to the interception infiltration and surface storage s and ia are a function of the curve number cn as in the following a 2 s 25 4 1000 cn 10 ia 0 2 s assuming the cumulative gross rainfall time distribution is known the excess rainfall pnrcs t mm step can be obtained by differenciating the pnrcs t cumulative values cn4ga procedure the cn4ga procedure merges the nrcs cn method and the following green ampt 1911 equation a 3 i t p t f o r t t pond k s 1 n s i t f o r t t pond where i mm step is the infiltration rate p t mm step is the gross rainfall intensity tpond h is the ponding time i mm is the cumulative infiltration ks is the saturated hydraulic conductivity mm h and ns is the soil moisture tension parameter mm in the mixed procedure we assume that tpond is reached when p t equals to ia this means that both nrcs cn and cn4ga have the same ponding time moreover ks is calibrated so that the excess rainfall cumulative value obtained by the cn4ga method equals to the corresponding one computed by the nrcs cn method from a practical point of view starting from the previously estimated pnrcs value the green ampt equation is firstly applied using literature values for ks and ns parameters consequently the cumulative value for excess rainfall pcn4ga is calculated and compared to the pnrcs value and the following three cases can occur 1 pcn4ga pnrcs tolerance is set as 0 1 mm in this case the cn4ga procedure converges 2 pcn4ga pnrcs in this case green ampt equation is solved again using a lower value for ks which means a lower infiltration and a higher excess rainfall ks value is iteratively reduced by δ amount until pcn4ga and pnrcs converge and δ is smoothly reduced to give finer convergence to the iterative procedure 3 pcn4ga pnrcs in this case green ampt equation is solved again using a higher value for ks which means a higher infiltration and a lower excess rainfall ks value is iteratively increased by δ until pcn4ga and pnrcs become equal again δ is smoothly reduced to give finer convergence to the iterative procedure at the convergence of the iterative procedure a calibrated value for ks is quantified and the excess rainfall time series pcn4ga is estimated through the a 3 equation further details on this procedure are available in grimaldi et al 2013a and grimaldi et al 2013b also concerning the negligible sensitivity of a 3 equation parameters that determine cn4ga as a calibration free procedure both procedures are based on the antecedent moisture condition amc evaluation that constrains cn values to some climatic variables observed five days antecedent to the rainfall event in particular the amc selection is performed according to the official nrcs 2008 formulation evaluating the cumulative rainfall in the 5 days before the generic rainfall event p5d and considering the vegetation growing season assumed from may to november or dormant season assumed from december to april amc i dry condition of soil is assigned when p5d is lower than 12 7 mm dormant season or lower than 35 6 mm growing season amc ii normal or average condition is assigned for p5d ranging between 12 7 mm and 27 9 mm dormant season or ranging between 35 6 mm and 53 3 mm growing season amc iii wet condition for soil is assigned when p5d higher than 27 9 mm dormant season or higher than 53 3 mm growing season when amc is equal to ii the original cn value estimated based on look tables on land cover and soil type is selected cn ii otherwise cn value is modified as in the following c n i 4 2 c n i i 10 0 058 c n i i f o r a m c i c n i i i 23 c n i i 10 0 13 c n i i f o r a m c i i i 
4824,the design hydrograph estimation in small and ungauged basins represents one of the most common practices and yet a challenging open research topic for hydrologists when discharge observations are not available the practitioner is compelled to apply empirical approaches the rational formula is slowly disappearing while event based approaches are more and more widespread a step forward is represented by continuous models that have the potential to address the major drawbacks of event based approaches in this work we applied a continuous model specifically designed for ungauged basins cosmo4sub and tested its use in conditions where typically the rational formula and the event based approaches are applied results confirm that the continuous modelling is suitable for rapid and effective design simulations supporting flood hazard modelling and mapping studies keywords continuous hydrologic modelling design hydrograph design simulation small basins ungauged basins 1 introduction prediction in small and ungauged basins is an evergreen topic in hydrology the understanding simulation and mitigation of flooding scenarios in watersheds characterized by limited contributing areas represent an open challenge for researchers and floodplain managers raising impacts of flash floods are prompting hydrological sciences to find viable modelling approaches in order to tackle the lack of discharge observations and the impossibility of adopting early warning systems a critical gap especially for small scale basins barredo 2007 marchi et al 2010 several studies emphasized the importance of proper knowledge of flood wave generation and dynamics in upstream basins and tributaries allamano et al 2009 convertino et al 2019 mcglynn et al 2013 peña and nardi 2018 petroselli et al 2019 2020a 2020b since the inception of the prediction in ungauged basins pub decade by the international association of hydrological sciences 2003 2012 sivapalan et al 2003 blöschl et al 2013 hrachowitz et al 2013 to most recent iahs panta rhei effort fostering crucial stimuli to address most pressing social challenges linked to hydroextremes montanari et al 2013 the meaning of the term ungauged has changed recent advancements of remote sensing technologies providing a new generation of large scale topographic and hydrologic observations are suggesting to redefine the meaning of the original desperate ungauged definition digital elevation and terrain models are nowadays freely available for the entire globe supporting topographic land and human feature characterization at adequate resolution for hydrologic studies e g yamazaki et al 2017 melchiorri et al 2018 rainfall observations are increasingly available at different spatial and time scales with length of precipitation records reaching a multiple decade length sun et al 2018 considering the attention and financial support received since the 80s while recent budget reduction and decreased interest in ground base precipitation monitoring in favor of remote sensing berne et al 2004 paz et al 2020 are posing challenges for many regions of the worlds that are lagging behind for the lack of adequate financing and implementation of ground hydrologic observations jenkins et al 2020 we posit here that the concept of ungauged shall be mainly linked to runoff processes we define ungauged those basins completely or partially lacking of hydrometric observations and consequently unable to support calibration procedures for elaborate hydrological modelling in practical terms ungauged basins represent case studies where practitioners are forced to use empirical approaches for the lack of flow discharge and hydrograph series data and frequency analyses the rational formula represented the most popular approach for rainfall runoff modelling due to its simplicity and to the limited watershed input information needed for its application digital topography and computer power advancements fostered the development of ungauged basin rainfall runoff models paving the way for effective employment of event based approach in place of the rational formula viglione and blöschl 2009 castiglioni et al 2010 blöschl et al 2013 haberlandt and radtke 2014 sene 2012 such improvements allowed to mitigate some crucial drawbacks of rational formula providing more accurate results while reducing the chronic uncertainty of empirical procedures as emphasized in grimaldi and petroselli 2015 event based approaches reduce the subjectivity of empirical procedures relaxing the flood analyst assumptions and diminishing the major uncertainty components affecting hydrologic modelling parametrizations a further pivotal scientific advancement was represented by statistical climate and weather modelling whose spatial and temporal scale accuracy and effectiveness grow considerably in the last decade indeed statistical methods for rainfall simulation rapidly evolved making available a variety of approaches and models that are able to generate any kind of synthetic scenarios just to mention some examples koutsoyiannis et al 2003 kossieris et al 2018 müller and haberlandt 2018 papalexiou 2018 toulemonde et al 2020 this represents an additional crucial outcome potentially helpful for the hydrologic modelling in ungauged basins rainfall observations daily sub daily maximum annual values for different durations and time series generations are available for as fundamental input for continuous models data availability and science advancements stimulated a variety of investigations on continuous frameworks for hydrological applications ormsbee 1989 blazkova and beven 2002 chu and steinman 2009 camici et al 2011 pathiraja et al 2012 breinl 2016 lamb et al 2016 blazkova et al 2017 davtalab et al 2017 rowe and smithers 2018 winter et al 2019 it is our opinion that continuous model evolution is mature enough to support its development for ungauged basins boughton and droop 2003 apparently it could be a contradiction to adopt a more complex approach for case studies without sufficient observations for calibration continuous hydrologic modelling are not more parameter parsimonious or less complex than event based approaches however the added value of continuous approach is significant in term of mitigating artefacts linked to synthetic and subjective characterization of design hydrograph attributes grimaldi et al 2012b rogger et al 2012 falter et al 2015 okoli et al 2019 berthet et al 2009 fleischmann et al 2019 winter et al 2019 we posit that the leap forward observed in the replacement of the rational formula with event based approaches is analogously developing for the transition from event based towards continuous modelling in practice the benefit would be to have a more realistic estimation of hydrograph volume and duration to remove some modules of the event based approach i e design hyetograph intensity duration frequency idf curves and to have available a design simulation that consists in a long runoff time series useful for a variety of applications crucial also for small basins this work is based on the application of the continuous simulation model for small ungauged basins namely cosmo4sub grimaldi et al 2012a in this work a step forward for cosmo4sub model is proposed and tested to verify its practical use compared to the original cosmo4sub contribution here the procedure is tested applying the rainfall runoff transformation on observed long rainfall time series that allows a more realistic evaluation of the continuous framework moreover the excess rainfall estimation is performed implementing the cn4ga curve number for green ampt method grimaldi et al 2013a 2013b that substitutes the standard nrcs cn national resources conservation service curve number method included in the original version of cosmo4sub in this work the model accuracy obtained comparing observed and simulated discharges is not provided since already verified in a previous work grimaldi et al 2012a while sensitivity analyses on separation time extreme event selection hydrograph identification and computational time are implemented benefiting from the use of an observed rainfall time series 2 data and materials the rainfall time series at 10 min resolution tu pham et al 2018 is employed being one the longest and consistent series available to date at global scale the time series consists of 105 years of rainfall observations from 1 january 1898 to 31 december 2002 measured by a hellmann fuess pluviograph in the climatological park of the royal meteorological institute at uccle see fig 1 a near brussels belgium demarée 2003 the recorded rainfall data have a constant high quality over the observation period because data has been recorded since 1898 by the same measuring instrument at the same location and adopting the same data processing method ntegeka and willems 2008 this time series is particularly useful for investigating on model parameters related to inter event rainfall properties that could not be well reproduced by synthetic rainfall scenarios indeed it is useful to verify if the trivial rainfall spikes or natural intermittency could affect the separation time parameters or the output hydrograph selection definition and details will be available in section 3 a brief overview of the uccle rainfall time series is provided in table 1 a small watershed located in proximity to the uccle raingauge is selected as case study see fig 1a it pertains to the catchment of the molenbeek river tributary of deender river located in west part of brussels in a region delimited by the villages of erpe mere north east corner and zottegem south west corner the watershed is identified by the outlet cross section of mere with a total contributing area of 41 1 km2 the digital elevation model dem was gathered from the copernicus land monitoring service eu dem and resampled at 50 m resolution as shown in fig 1b the selected domain of study is characterized by a long and narrow shape it is located in a flat area with an elevation range 22 92 m a s l and an average slope 2 9 the simulated drainage network is estimated using 0 5 km2 as contributing area threshold at the watershed concentration time tc is estimated to be approximately 9 8 h nrcs 1997 the watershed pertains to a region with mainly loamy soils and a gentle rolling landscape the soils have different drainage conditions ranging from dry to medium wet and profile development ranging from poorly to strongly differentiated horizons the soil moisture storage capacity is limited so the river has large discharge fluctuations the baseflow discharges are small while the response to rainfall is significant it is noteworthy that in the selected cross section measurement of hourly discharge is available from 1986 the mean and maximum flows can be estimated as 0 45 m3 s and approximately 10 m3 s respectively the land cover was classified by means of the corine land cover database at level iii and related to the year 2018 the upstream watershed area is mainly rural while the downstream part is more urbanized agricultural activities in the catchment account for the 76 of the total area the nrcs curve number value equal to 64 4 was quantified through empirical evaluation using look up tables nrcs 2008 for a more detailed characterization of the catchment see el sadek 2007 and willems 2014 3 cosmo4sub modelling approach a detailed description of continuous simulation model for small and ungauged basin cosmo4sub is available in grimaldi et al 2012a while here a brief description is reported focusing on the modules that have been the subject of novel updates the cosmo4sub approach is characterized by four steps 1 the rainfall scenario simulation 2 the excess rainfall estimation 3 the excess rainfall runoff transformation 4 the design simulation strategy the first step of cosmo4sub model is the rainfall scenario simulation starting from raingauge data series a long sub hourly rainfall time series is generated 500 or 1000 years at 10 15 min of resolution represent ideal model input in the original cosmo4sub work a mixed copula based simulator and a continuous in scale universal multifractal approach were employed noting that the identification of the appropriate rainfall generator is a crucial step considering a wide variety of options are available in literature caldwell et al 2009 kossieris et al 2018 callau poduje and haberlandt 2017 kim et al 2017 pohle et al 2018 li et al 2018 verdin et al 2019 zhao et al 2019 zhou et al 2020 a specific study for investigating which rainfall generator model would be the optimal candidate for cosmo4sub will be investigated in a further ongoing work it is important to further emphasize that the proposed framework is tailored for estimating the design hydrograph or the design simulation so it aims to appropriately reproduce extreme events for small and ungauged basin in order to avoid any bias due to the inherent approximation of a generic rainfall simulator in the present work we use the uccle rainfall time series that is a perfect input for testing the entire framework demarée 2003 tu pham et al 2018 since it is not necessary to hypothesize a design hyetograph with all related parameters as in the common event based approaches the second step of a continuous framework is the excess rainfall estimation in the previous version of cosmo4sub the standard nrcs cn method was implemented however following the interesting debate present in literature eli and lamont 2010 we are aware that this method is not appropriate to be applied at sub daily scale and in continuous framework such abuse garen and moore 2005 motivated us to deeper investigate on this problem identifying a solution in merging the nrcs cn method with the green ampt ga equation green and ampt 1911 as a result the cn4ga model grimaldi et al 2013a 2013b is proposed and here applied in practice the proposed approach applies the nrcs cn method to quantify the excess rainfall depth as recommended and expected at event scale and uses the ga equation to distribute in time the contributions to this depth the ga parameters are estimated constraining the equation to give the total excess rainfall depth equal to that estimated by nrcs cn preserving the entire procedure as calibration free in appendix a 1 some details of the procedure are briefly recalled and illustrated in previous studies the practical effect of cn4ga approach was investigated at the event scale and the results obtained using observed rainfall runoff events suggest that the nrcs cn method tend to underestimate the peak discharge due to an inappropriate effect of initial abstraction on the hyetograph peaks the present work is going to further verify the effect of cn4ga when applied in a continuous framework using as input an observed long rainfall time series we are aware that the nrcs cn approach is not the best method available for a continuous model indeed it does not include intra event soil moisture condition module however since it allows to minimize the input information it is appropriate for cosmo4sub model being tailored to small and ungauged basin one of the various drawbacks is that it still makes necessary although in contradiction to the continuous set up a sort of rainfall event identification through an additional parameter that we named separation time ts this parameter represents the dry period or almost dry that should be waited so that the initial abstraction became again effective in previous work the sensitivity of this parameter was analyzed using long synthetic rainfall time series its effect on the design hydrograph was minimal and apparently 24 h as suggested by nrcs cn implementation fennessey 2001 is a reasonable value to be used in the present manuscript the sensitivity is further verified introducing also a different definition of ts that is the period not dry but in which a minimal amount of rainfall named drop parameter is observed fig 2 describes the meaning of these parameters ts and drop their influence on the hydrograph and the interaction with tc the ts effect is limited to the excess rainfall estimation when the time distance between two storms is less than the separation time the cn4ga method is applied on the sequence of the two storms considered as a unique event case a in fig 2 on the contrary case b they are analyzed as two independent rainfall events this characterization affects the total gross precipitation amount and the antecedent moisture condition amc 5 days values in both cases the resulting flood hydrographs are influenced by the convolution of the unit hydrograph and so by the concentration time the third step of the procedure is the excess rainfall runoff transformation the wfiuh model is applied for convoluting excess rainfall into runoff time series concerning this step no specific modifications are introduced comparing to the original cosmo4sub version in our opinion the wfiuh approach appropriately modified for ungauged conditions grimaldi et al 2012c is the most efficient method available since it allows to optimize the available digital topography information enforcing hydrogeomorphic processes that represent governing factors of floodplain generation dynamics annis et al 2019 nardi et al 2018 2019 for sake of brevity here wfiuh computational details are not reported and the reader can refer to grimaldi et al 2012c the breakthrough innovative iuh definition as travel time distribution of watershed dem cells rodriguez iturbe and rinaldo 1997 opened the way to provide a calibration free iuh flow path hillslope channel discrimination velocity estimation on hillslopes are easy step useful to quantify the flow time or travel time distribution since the expected final user of cosmo4sub is the practitioner that in similar context would have applied the rational formula we prefer to constrain the channel velocity to the concentration time or to the lag time this procedural step includes two parameters to be assigned by the user while the hillslope velocities are empirically quantified using distributed slope and land cover information the contributing area threshold useful to discriminate channel and hillslope cells and concentration time should be preliminarily quantified the first one has a minor impact on the final results while the second one much more impacting is typically estimated using empirical formulas petroselli and grimaldi 2018 once the entire runoff time series is estimated in the last step the design simulation strategy is implemented there are several options available that could be applied depending on the hydrological application the practitioner could directly apply the simulated runoff time series grimaldi et al 2013c sikorska et al 2018 select the design peak discharge applying a common flood frequency analysis on the extreme values de paola et al 2018 estimate the design hydrograph serinaldi and grimaldi 2011 brunner et al 2017 or apply a montecarlo approach using the entire sample of simulated hydrographs annis et al 2020 for the two latter options it is necessary to appropriately isolate flood events preventing overestimation and underestimation of hydrograph volume and durations in section 4 a specific analysis is provided to support the assessment of the different possible approaches 4 cosmo4sub testing this section presents a sensitivity analysis of cosmo4sub modules and parameters specifically the following five tests are described test 1 comparing effects of cn4ga as respect to the nrcs cn approaches test 2 the sensitivity of design parameters to varying ts and drop parameters test 3 comparing methods to extract flood hydrograph events from the simulated continuous flow time series test 4 the influence of the sample selection criteria for flood frequency analysis test 5 the computational time reduction the five tests are conducted varying methods and parameter values as respect to reference cosmo4sub model configuration the reference cosmo4sub model for the case study is defined assuming the parameter values listed in table 2 and selecting extreme events using the annual maximum method with the peak discharge q as driving variable 4 1 test 1 cn4ga vs nrcs cn as mentioned in section 3 and in appendix a 1 the cn4ga method was previously tested in event based hydrologic modelling analyses this test aims to verify if the nrcs cn modelling behavior i e flood peak underestimation in particular is confirmed in a continuous modelling approach using a long observed time series as input the cn4ga and nrcs cn excess rainfall estimation methods are both applied using the reference model parameter set up the resulting hydrograph characteristics peak volume duration are compared and discussed considering the impact of varying cn parameter the simulations are replicated using cn 74 4 and 84 4 4 1 1 test 2 ts and drop parameters in this test the influence of ts and drop parameters is assessed in terms of flood event selection within the continuous time series as previously mentioned and illustrated in fig 2 two events are considered to be disconnected if within a certain duration ts a certain negligible rainfall amount drop is detected the drop parameter is introduced for filtering out very minor rainfall depths that could impact the flood event filtering process starting from the reference model configuration ts and drop are varied respectively from 18 to 30 h with incremental steps of 2 h and from 0 to 0 5 mm with incremental steps of 0 05 mm the aim of the analysis is to verify the sensitivity of the hydrograph characteristics discharge volume and duration to varying ts and drop parameters 4 1 2 test 3 hydrograph selection continuous model output is a long runoff time series at high time resolution the user is thus requested to extract hydrographs from the simulated series this is common straightforward practice in case of runoff time series in absence of sub surface and base flows the two main approaches generally adopted are 1 selecting the hydrograph starting from the first q 0 value and ending when the q 0 2 introducing a threshold qs value for filtering the time series q qs and selecting hydrographs as in 1 it is noted that the two different approaches determine significant differences in the obtained hydrograph volume and duration the approach selection shall be thus performed in relation to the design application for instance in case of high time resolution like in the present case study of 10 min adopting approach 1 two runoff events could be separated just because there are 10 min of null discharge in order to verify the practical differences in the hydrograph selection approaches twelve configurations as listed in table 3 are tested applying the reference configuration model 4 1 3 test 4 extreme hydrograph selection a further issue often neglected relating to the synthetic design hydrograph characterization is the extreme event selection brunner et al 2017 while the design peak discharge estimation is quite straightforward the design extreme hydrograph is not a trivial step in fact in this case three important hydrograph attributes are considered the common approach is selecting the maximum annual values referring to the peak discharge as driving variable and once the event is identified the triplets peak q volume v duration d are estimated this is a well known problem in extreme analysis since this approach not necessary select extreme values for v and d and this should be taken into account in the statistical analysis analogously to test 3 the optimal methodology strictly depends on the design application for instance the driving variable could be another attribute and not necessarily q in order to assess the effect of this procedural step on the corresponding extreme event selection three scenarios are compared the common annual maximum value amv using q as driving variable the peak over threshold using q as driving variable with a threshold level giving nearly the same sample size of amv a bivariate extreme value selection choosing all the events with a joint non exceedance probability value of q v higher than a threshold fixed to give a sample size similar to those of the other scenarios the joint non exceedance probability is empirically estimated this third scenario includes only the q v values because d is not usually relevant in design estimation and because it is an unstable parameter i e d is too variable to be considered as driving variable in the event selection approach the comparison is provided applying the basic configuration with three cn values 64 4 74 4 84 4 4 1 4 test 5 computational time reduction in the present paper the 105 years long 10 minutes resolution rainfall time series determine a computational time of few minutes for running the cosmo4sub model on a common personal computer pc considering that the final model configuration will be provided as input a synthetic rainfall time series of 500 years or 1000 years at 10 min of resolution the computational burden could be an issue for the effective transitioning to continuous modelling in practical applications this could be amplified considering that the computational time should also include the calibration and simulation of the rainfall synthetic time series module and in practical application several framework running to identify appropriate model parameter values in order to reduce the computational time a possible solution is to reduce the number of processed rainfall events considering that the excess rainfall calculation is one of the major computationally intense steps assuming that while aiming to estimate the design hydrographs the interest is linked to events with higher magnitude filtering out very minor rainfall events should have negligible impact on the design variables in practical terms the solution for optimizing the computation process is to remove all events characterized by a total excess rainfall amount that is lower than a predefined threshold consequently the computational time reduction and the effect in the flood frequency analysis are verified starting from the reference model configuration for a specific cn value 9 excess rainfall thresholds are tested considering a range starting from 0 to 2 mm with incremental step 0 25 mm since results could be strongly dependent on the cn for higher cn values a corresponding higher number of rainfall events are available the test is implemented for 7 cn values from 55 to 85 with incremental step of 5 5 test results test 1 results are presented in the matrix plot of fig 3 the maximum annual triplets of q v and d values selected using q as driving variable are shown to compare the varying results corresponding to the application of the nrcs cn and cn4ga methods the three columns refer respectively to three different cn values 64 4 74 4 84 4 while the rows correspond to the hydrograph attributes q v d in each plot the two excess rainfall estimation methods are compared showing empirical return periods in general for the conducted tests the comparison return period values are low and limited to 20 years in fact the length of the rainfall time series 105 years does not allows to focus on more representative flood events results of simulated peak discharge values confirm the attitude of the nrcs cn method in underestimating q indeed the differences among the two curves are visible on the entire return period range reach up 22 8 for tr 20 years and cn 84 4 and increasing for higher cn value the volume variable overlapping is expected considering the adopted cn4ga approach methodology see appendix a 1 that distributes in time the nrcs cn excess rainfall cumulated depth for matching volumes the varying duration values suggest that applying the cn4ga we obtain hydrographs with shorter duration this is also expected in line with previous findings align with the aim of providing excess rainfall event more intermittent and coherent to the natural rainfall behavior the difference between the durations is homogenous for the entire range of return period and for the varying cn values reaching up a 36 2 maximum variation cn 74 4 and tr 10 years test 2 results are presented in fig 4 illustrating the outcomes of the sensitivity analysis with varying ts and drop parameters matrix plots are used with columns referring to different cn values and rows showing the hydrograph attributes q v d each sub plot presents a raster where hydrograph attributes are the cell value corresponding to model configuration associated to ts and drop x and y axes the cell values are color coded as a function of the percentage of difference to the reference model configuration also depicted as no variation white cell this latter is highlighted with black contour the three attributes q v d corresponds to the 80 quantile of the maximum annual values using q as driving variable while in the proximity of the reference model configuration the differences are limited 5 10 for the present case an higher variability compared to the previous studies grimaldi et al 2012a is quite visible in order to clarify the remarkable differences obtained it is useful to recall the effect of ts parameter increasing the ts it is expected to have longer rainfall events a larger amount of gross and excess rainfall and consequently higher peak discharge volume and hydrograph duration a secondary and opposite effect could also concur to determine such differences considering that longer rainfall event may group more than a single event and a decreasing amc class can arise causing reduction of peak discharge volume and duration these two opposite effects strive to be balanced when a large number of events are available in previous investigations grimaldi et al 2012a 500 years of synthetic rainfall series were analyzed this can motivate the test outcomes that with only 105 years of series length the ts produces more variable results this suggests that long time series are necessary and future research will be useful to verify such behavior with increasing time series length probably towards 1000 years furthermore a minor concurring cause of such a significant variability is related to the different excess rainfall estimation methods the cn4ga method as shown in fig 3 is characterized by more intermitted storms with higher variance that can amplify the ts variability effects especially when considering relatively short input rainfall time series test 3 results reporting the impact of the hydrograph selection strategies are illustrated in figs 5 and 6 fig 5 compares the q v and d values associated to empirical return periods obtained with the varying scenarios listed in table 2 the comparison is repeated for three cn values the blue line represents the reference model configuration scenario n 7 q0 the black area includes the envelopes of results corresponding to the five dry scenarios n 8 n 12 while the gray area reports the six q threshold scenarios n 1 n 6 the plots missing to include the black and gray areas show the absence of variability with scenarios overlapping to the reference model configuration this is evident by looking at the first row of the q plots where by definition any variability could occur concerning volumes shown in the second row of the matrix plot the dry scenarios exhibit no significative divergence from the reference values while for the q threshold scenarios a limited variation is visible higher for the cn 84 4 that reaches 11 2 for the scenario q03 as expected duration values are significantly affected by the selection strategies however it is confirmed the minor effect of dry compared to the q threshold scenarios specifically duration values can show variations till to 51 2 for the scenario q03 fig 6 provides a comparison among the different scenarios from a different perspective indeed the kendall s τ dependence measure estimated on pairs q v v d d q are shown results suggest that dependence structure of q v is not affected by the hydrograph selection strategies while the differences become more relevant for v d and d q for this latter the variability is more significant for low cn values results does not support to extrapolate general conclusions since they are related to a specific case study however it is evident that the duration variable appears to be particularly influenced by the different hydrograph selection strategies and the volumes are also particularly impacted by varying cn values future analyses on different case studies and using longer synthetic time series are needed to investigate and generalize such modelling behavior results of test 4 on the extreme hydrograph selection analysis are depicted in figs 7 and 8 the first one compares q v d for several return periods using different extreme event selection methods extreme values ev joint extreme values jev and annual maximum values amv concerning q and v results are similar with a tendency to be equal considering ev and jev while as expected d is more affected by the sampling strategies reaching more significant differences as in the case cn 84 4 and tr 4 years where jev and ev amv differ of 25 fig 8 provides an overview of the same comparison test using the kendall s τ here results appear significantly different suggesting the attitude of amv to provide more correlated pairs differences increase with the increase of cn values and more prominently for the d variable impacting a possible multivariate frequency analysis the discrepancies related to varying cn values are justified by the larger number of events produced with higher cn values so this is resulting in a reduction of the correlation related to the application of the jev strategy since for each peak discharge value several possible volumes are possible and available the lower τ for jev evident in general is due to the inclusion of flood events maximizing their volume and consequently their duration this is determining a variety of events that are necessarily less correlated finally the last test results related to the cosmo4sub computational times varying cn values and reduction strategies test 5 are available in fig 9 the first column values represent the computational times corresponding to model applications without any excess rainfall restrictions while varying cn values y axis computation times vary from a minimum of 100 s for the cn 55 to the maximum of 418 s for cn 85 indeed for higher cn values larger number of rainfall events need to be processed applying a higher excess rainfall threshold x axis values that is removing all the storms with cumulative excess rainfall depth less than a fixed value a reduction of the computational time is assesses this is shown in fig 9 where the gray scale cells refer to the percentage of reduction as respect to the reference model configuration interesting to note that with only a 0 25 mm threshold a significant computational time reduction is obtained 50 for cn 70 and that all configurations shown in fig 9 do not significantly alter not shown here for the sake of brevity the extreme event properties 6 conclusions continuous rainfall runoff modelling frameworks are reaching maturity for hydrologic modelling on small and ungauged basins with limited or lacking flow records remote sensing hydrologic monitoring and modelling advancements driving such modelling evolution allow continuous models to provide more accurate and more versatile outputs that may be tailored for a variety of hydrological applications in the present contribution improvements of a continuous simulation model named cosmo4sub are described and tested an advanced excess rainfall estimation module cn4ga and sensitivity analyses are provided using as input a very long rainfall time series 105 years observed at 10 min of resolution this represents an excellent case study considering this rainfall time series overcomes the issue of synthetic rainfall time series the case study results support some conclusions that in future researches can be verified using longer synthetic rainfall time series the cn4ga module performed well in the continuous framework confirming its attitude shown in previous contributions where it was applied at event based analysis the separation time parameter necessary to separate the rainfall events for applying the cn4ga method confirmed an encouraging limited variability although higher compared to previous analysis suggesting for future application of the framework to use a longer input time series possibly 1000 years hydrograph and extreme event selection strategies typically neglected in the hydrological studies needs to be seriously considered and standardized since its impact could affect final design output the computation time is coherent to the common modelling tools applied in hydrological studies and can be reduced without altering the final output although further analyses are necessary to reach more general conclusions and to identify the optimal rainfall simulation model useful for such continuous modelling it is already possible to affirm that it is worth to apply a continuous model in small and ungauged basins by the professional community since it offers some useful ameliorations in the design hydrograph estimation and consequently in the design simulation funding this work was supported by the italian ministry of the environment land and sea mattm through the projects gest river gestione ecosostenibile dei territori a rischio inondazione e valorizzazione economica delle risorse and simpro simulazione idrologico idraulico economica di progetto per la mitigazione del rischio idraulico and by the fwo project g003918n stochastic modelling of future extreme discharges as a tool for water resources engineering declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper appendix a 1 nrcs cn procedure for each gross rainfall event the time distribution of the cumulative excess rainfall pnrcs t mm is estimated according to the following formula nrcs 2008 a 1 p nrcs t p t i a 2 p t s i a f o r p t i a 0 f o r p t i a where p t mm is the time distribution of cumulative gross rainfall value s mm is the maximum potential basin retention and ia mm is the initial abstraction due to the interception infiltration and surface storage s and ia are a function of the curve number cn as in the following a 2 s 25 4 1000 cn 10 ia 0 2 s assuming the cumulative gross rainfall time distribution is known the excess rainfall pnrcs t mm step can be obtained by differenciating the pnrcs t cumulative values cn4ga procedure the cn4ga procedure merges the nrcs cn method and the following green ampt 1911 equation a 3 i t p t f o r t t pond k s 1 n s i t f o r t t pond where i mm step is the infiltration rate p t mm step is the gross rainfall intensity tpond h is the ponding time i mm is the cumulative infiltration ks is the saturated hydraulic conductivity mm h and ns is the soil moisture tension parameter mm in the mixed procedure we assume that tpond is reached when p t equals to ia this means that both nrcs cn and cn4ga have the same ponding time moreover ks is calibrated so that the excess rainfall cumulative value obtained by the cn4ga method equals to the corresponding one computed by the nrcs cn method from a practical point of view starting from the previously estimated pnrcs value the green ampt equation is firstly applied using literature values for ks and ns parameters consequently the cumulative value for excess rainfall pcn4ga is calculated and compared to the pnrcs value and the following three cases can occur 1 pcn4ga pnrcs tolerance is set as 0 1 mm in this case the cn4ga procedure converges 2 pcn4ga pnrcs in this case green ampt equation is solved again using a lower value for ks which means a lower infiltration and a higher excess rainfall ks value is iteratively reduced by δ amount until pcn4ga and pnrcs converge and δ is smoothly reduced to give finer convergence to the iterative procedure 3 pcn4ga pnrcs in this case green ampt equation is solved again using a higher value for ks which means a higher infiltration and a lower excess rainfall ks value is iteratively increased by δ until pcn4ga and pnrcs become equal again δ is smoothly reduced to give finer convergence to the iterative procedure at the convergence of the iterative procedure a calibrated value for ks is quantified and the excess rainfall time series pcn4ga is estimated through the a 3 equation further details on this procedure are available in grimaldi et al 2013a and grimaldi et al 2013b also concerning the negligible sensitivity of a 3 equation parameters that determine cn4ga as a calibration free procedure both procedures are based on the antecedent moisture condition amc evaluation that constrains cn values to some climatic variables observed five days antecedent to the rainfall event in particular the amc selection is performed according to the official nrcs 2008 formulation evaluating the cumulative rainfall in the 5 days before the generic rainfall event p5d and considering the vegetation growing season assumed from may to november or dormant season assumed from december to april amc i dry condition of soil is assigned when p5d is lower than 12 7 mm dormant season or lower than 35 6 mm growing season amc ii normal or average condition is assigned for p5d ranging between 12 7 mm and 27 9 mm dormant season or ranging between 35 6 mm and 53 3 mm growing season amc iii wet condition for soil is assigned when p5d higher than 27 9 mm dormant season or higher than 53 3 mm growing season when amc is equal to ii the original cn value estimated based on look tables on land cover and soil type is selected cn ii otherwise cn value is modified as in the following c n i 4 2 c n i i 10 0 058 c n i i f o r a m c i c n i i i 23 c n i i 10 0 13 c n i i f o r a m c i i i 
