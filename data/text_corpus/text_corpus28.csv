index,text
140,machine learning methods provide new perspective for more convenient and efficient prediction of groundwater flow in this study a deep learning method gw pinn without labeled data for solving groundwater flow equations with wells was proposed gw pinn takes the physics inform neural network pinn as the backbone and uses either the hard or soft constraint in the loss function for training a locally refined sampling strategy lrs is adopted to generate the consistent spatial sampling points for problems with strong hydraulic head change and then combined with an appropriate temporal sampling scheme to obtain the final spatial temporal sampling points a snowball style two stage training strategy by dividing the temporal domain into two subdomains is designed to decrease the sampling points five cases were designed to test the training performance of gw pinn under different sampling strategies and two constraints the predicted results of gw pinn were compared with modflow and the analytical solution the results demonstrate that gw pinn possesses strong ability in capturing the hydraulic head change for both confined and un confined aquifers the hard constraint owns more robust learning ability than the soft constraint the lrs strategy can generate more accurate results with much fewer sampling points than traditional sampling strategies and the snowball style two stage training strategy is significantly efficient for problems with the drastic change of hydraulic head furthermore the application of gw pinn as a surrogate model for parameterized groundwater flow equations is illustrated this study provides an option tool for efficient groundwater flow simulation especially for those with local refinements are needed keywords deep learning method gw pinn locally refined sampling strategy hard constraint two stage training strategy 1 introduction with the improvement of computational power and explosive growth of data deep learning has achieved great success in many fields such as computation vision natural language processing and other fields krizhevsky et al 2012 he et al 2016 in the past few years significant effort also has been devoted to use these technologies to solve problems arising in computational and scientific engineering among which a typical case is numerical solution of partial differential equations pdes of various types weinan and yu 2018 jagtap et al 2020 raissi et al 2019 sirignano and spiliopoulos 2018 zhu and zabaras 2018 what we are concerned with in this paper is the numerical simulation of groundwater flow equations which is important for groundwater resources management and protection crowe et al 2004 knights et al 2017 walter et al 2020 there exists a large amount of mature traditional numerical methods for solving the partial differential equations pdes of groundwater flow e g the finite element method the finite difference method and the finite volume method brunner and simmons 2012 harbaugh et al 2000 trefry and muffels 2007 important issues in those spatial discretization methods for solving the pdes of groundwater flow are the large computational cost and difficult iteration convergence in handling aquifers with strong heterogeneity and complex boundaries or multiple source sink terms whereas the local grid refinements are needed borsi et al 2013 dickinson et al 2007 mehl and hill 2002 panday and langevin 2012 vilhelmsen et al 2011 these models are usually difficult to implement for staff of water resources management agency since very professional numerical modeling knowledge and experience are needed compared to the traditional numerical methods the deep learning approach provides a fresh perspective for solving pdes and possesses many unique advantages 1 universality it is a universal method which can solve different types of pdes on arbitrary domains 2 meshless it only requires the reasonable distribution of sample points which is much easier than the mesh generation 3 efficiency the computational costs of the traditional time stepping methods such as the forward euler scheme the crank nicolson scheme etc grow rapidly as the number of time iterations increases and the prediction should be carried out sequentially whereas the deep learning approach can predict the solution at any time very quickly once the model is well trained which can be used as a surrogate model for quick prediction for water resources management 4 convenience the traditional numerical method can only predict the solution on the grid points and additional post processes are needed to obtain the approximate solutions on the non grid points while the deep learning approach can predict the solution at arbitrary spatial temporal points to the best of our knowledge the first attempt of numerical solution of pdes using neural networks can be traced back at least to the end of the last century dissanayake and phan thien 1994 where the authors proposed an unsupervised method to train the neural network by minimizing ω l u f 2 d x ω b u g 2 d x to approximate the solution of the following pdes l u x f x ω b u x g x ω and two simple examples were considered to verify the effectiveness of the proposed method however due to the limitation of computational power at that time it did not attract enough attention until the last decade this approach has made remarkable progress and a series of fruitful research works have emerged weinan and yu 2018 meng et al 2020 raissi et al 2019 sirignano and spiliopoulos 2018 zhu and zabaras 2018 there are currently two major ways to use deep learning methods to solve pdes the first way is to convert pdes into their equivalent variational forms and then solve them using neural networks the pioneering work is the deep ritz method proposed by weinan and yu 2018 followed by a series of excellent researches liao and ming 2019 müller and zeinhofer 2019 wang and zhang 2020 chen et al 2020 the deep nitsche method liao and ming 2019 extended the deep ritz method to deal with essential boundary conditions without extra computational costs chen et al 2020 carried out the comparison study for elliptic problems with different boundary conditions including dirichlet neumann robin and periodic boundary conditions by using the deep ritz method and the deep galerkin method sirignano and spiliopoulos 2018 which observed that the deep galerkin method works better for problems with smooth solutions while the deep ritz method works better for problems with low regularity solutions based on the deep ritz method wang and zhang 2020 proposed a mesh free method to solve the interface problems where two challenging interface problems were investigated including an elliptic pde with a discontinuous and heterogeneous diffusion coefficient and a linear elasticity equation with discontinuous stress tensor the other way is to use neural networks to directly deal with the original pdes and the most representative work is the physical informed neural network pinn proposed by raissi et al 2019 where the pde residual is incorporated into the loss function as a regularizer thereby constraining the space of admissible solutions the original pinn uses the residual of pdes as the loss function which is called as the soft constraint different from the soft constraints berg and nystrom 2018 and sun et al 2020 proposed some sort of hard constraint to make the output of the neural networks satisfy the boundary and initial conditions pinns have been successfully applied to solve various pde problems such as classic time independent or time dependent pdes fractional pdes pang et al 2019 and stochastic pdes zhang et al 2020 however for high dimensional problems especially for time dependent problems the amount of data sampling tends to become huge which would consume unacceptable training time or even collapse the training of pinn in recent years the deep learning method has been applied for many hydrology problems shen 2018 e g groundwater table depth forecasting sun et al 2022 flood forecasting lv et al 2020 runoff prediction huang et al 2020 water quality prediction anshuman and eldho 2022 liang et al 2020 and uncertainty quantification or parameter inversion problems in subsurface flow mo et al 2019 zhang 2019 laloy 2018 most machine learning models for groundwater flow prediction were labeled data driven to learn the relationship between the groundwater table level with the major impact factors e g precipitation evapotranspiration groundwater exploration and irrigation the popular ones included the controlled auto regressive car method zhao et al 2020 autoregressive integrated moving average arima adhikary et al 2012 mirzavand and ghazavi 2014 artificial neural network ann kuo et al 2007 sahu et al 2020 support vector machine svm yoon et al 2011 genetic algorithms jha and sahoo 2015 ravansalar et al 2017 and long short term memory lstm zhang et al 2018 recently wang et al 2020 proposed a theory guided neural network tgnn for subsurface flow with heterogenous hydraulic conductivity field in which the groundwater flow equation was integrated with the labeled hydraulic head data and additional engineering controls to be constraints in the loss function for subsurface flow modeling and a weak form tgnn tgnn wf was further proposed for diffusivity equations with local source sink terms by xu et al 2021 and the authors mentioned that tgnn wf cannot solve the groundwater flow equation containing source sink terms when constrained only by initial conditions boundary conditions and weak form residual losses and the labeled training data was required to capture the pressure drawdown in cases with wells the current machine learning methods require a large number of label data and face the over fit problem in training srivastava et al 2014 very few studies have been proposed for solving groundwater flow equations directly without label data based on the deep learning method especially for those with local source sink terms due to the discontinuity at the source sink location which worth paying more attention in this paper a deep learning method to directly solve the pdes of the groundwater flow without label data called as gw pinn has been proposed a locally refined spatial temporal sampling strategy and a snowball style two stage training strategy are proposed and adopted which make the method suitable for situations with source sink terms where local grid refinements are needed the hard constraint is adopted which is beneficial to train gw pinn by only including the initial boundary losses and residual loss of pdes while avoids using the labeled data in the training five test cases and one application case are designed to evaluate the accuracy and efficiency of the proposed method this paper is organized as follows the description of groundwater flow equations is shown in section 2 followed by the network architecture of gw pinn the sampling strategy loss functions and the training strategy introduced in section 3 the description of the five cases is presented in section 4 ablation studies including the effects of different loss functions sampling strategies and training strategies are shown in section 5 together with comparison results of the test cases with modflow harbaugh et al 2000 model discussion is shown in section 6 finally some conclusions are drawn in section 7 2 groundwater flow equations let ω r 2 be an open connected domain in the two dimensional space ω 0 t denotes the spatial temporal region to be solved ω 0 denotes the initial region γ1 0 t denotes the boundary of first kind dirichlet boundary and γ2 0 t denotes the boundary of second kind neumann boundary moreover let x x y be a spatial point in ω and x y t be a spatial temporal point and then the groundwater flow can be described as the following system 1a k h μ h t f x y t x t ω 0 t 1b h x y t g 0 x y x y t ω 0 1c h x y t g 1 x y t x y t γ 1 0 t 1d k h x y t n x y g 2 x y t x y t γ 2 0 t where h is the hydraulic head l is the gradient operator defined by h h x h y t g 0 g 1 and g 2 refer to the specified initial value dirichlet value and neumann value of the problem respectively and n x y denotes the unit normal vector outward to ω on the neumann boundary it s remarkable that the specific form of two parameters tensor depends on the type of aquifer i e 2 μ μ e μ s m c o n f i n e d a q u i f e r μ d u n c o n f i n e d a q u i f e r and 3 k k s m c o n f i n e d a q u i f e r k s h u n c o n f i n e d a q u i f e r where μ μ e is the elastic release coefficient of the confined aquifer with the specific storativity μ s l 1 and the thickness of aquifer m l or μ μ d is the specified yield of unconfined aquifer k k sm is the transmissivity tensor if the confined aquifer is considered or k k sh is the transmissivity tensor if the unconfined aquifer is considered and 4 k s k s x 0 0 k s y denotes the saturated hydraulic conductivity tensor k s x and k s y are the saturated hydraulic conductivity in the x and y directions respectively lt 1 fis the source sink term defined by 5 f p e i 1 n w q i δ x x i where p p x y t denotes the amount of precipitation infiltration to recharge groundwater lt 1 e e x y t refers to the evapotranspiration of groundwater lt 1 and qi represents the pumping capacity of pumping well located at xi yi nw is the number of pumping wells and δ is the dirac delta function satisfying the following conditions 6 δ x 0 x 0 x 0 and r 2 δ x d x 1 the physical meaning of eq 1a is that it reflects the mass conservation relation of groundwater movement in the aquifer and represents the water balance relation of the unit volume and the unit time of aquifer under the darcy s flow condition that is to say the difference between mass of water flowing in and out of the unit volume aquifer in the unit time the left side of eq 1a is equal to that of water released or stored in the unit volume aquifer in the same time the right side of eq 1a 3 proposed method gw pinn our gw pinn takes the physics inform neural network pinn as the backbone and uses the hard constraint approach in the loss function for issues where appropriate locally refined spatial meshes are needed we adopt locally refined sampling strategy to generate the consistent spatial sampling points with the problem and then combined with appropriate temporal sampling points to obtain the ultimate spatial temporal sampling points consequently these sampling points will be used as training set to be fed into gw pinn to train it once the network is trained well it can be used to predict the hydraulic head at any time and at any point in space in order to train gw pinn effective and fast we design a snowball style two stage strategy by dividing the temporal domain into two stages and then training respective networks in each stage in sequence we find that the training cost mainly concentrate in the initial stage and in this stage the drastic change process of hydraulic head can be captured accurately without large amount of training points once the first stage network is trained the training in the second stage becomes much faster the details of gw pinn are shown in the following sections 3 1 network architecture the basic architecture of our gw pinn for solving eq 1 is shown in fig 1 the network takes a spatial temporal point x y t as an input and output a scalar u the input layer is connected to d 1 hidden layers and an output layer which form a fully connected neural network of depth d letting nk be the number of neurons in the k th layer each hidden layer receives an input v k 1 r n k 1 from the previous layer output and transforms it to 7 l k v k 1 w k v k 1 b k where w k r n k n k 1 and b k r n k the nonlinear activation function σ is applied to each component of the transformed vector before sending it to the next layer other than the last hidden layer the network thus is a composite of a sequence of nonlinear functions 8 u x y t θ l d σ l d 1 σ l 1 x y t where the operator denotes the composition and θ w k b k k 1 d represents the trainable parameters in the network 3 2 approximation of the dirac delta function in the network setting we seek for a classic smooth solution satisfying the strong form of the pde eq 1 however if the aquifer contains pumping wells there exist the dirac delta functions δ x y in the source sink term but δ x y is not differentiable everywhere and indeed it can only be well defined in the sense of distribution thus in practice we approximate the dirac delta function by a multi dimensional gaussian density function 9 ρ x y 1 2 π s 2 e x y 2 2 s 2 where the parameter s 0 denotes the standard deviation of the distribution as s 0 this function approaches to the dirac delta function 3 3 sampling strategy it is crucial to generate appropriate spatial temporal sampling points for training of the network by taking into account the features of the source sink term we propose adaptive spatial and temporal sampling strategies and training strategies in different cases 1 spatial sampling we sample the spatial domain in two cases the inner domain ω and the boundary γ which is composed of the first kind boundary γ1 and the second kind boundary γ2 i e γ γ1 γ2 sampling on the boundary γ can be done through a uniform sampling strategy such as equidistance nodes in each direction we denote γ d the set of all these sampling points on the boundary γ and then divided it into two parts γ1 d and γ2 d which denote the set of sampling points on γ1 and γ2 respectively the generation of the set of sampling points in ω denoted as ω d is determined by the property of the source sink term shown in eq 5 specifically if the source sink term only contains the precipitation term p and the evapotranspiration term e it is enough to simply adopt the uniform sampling us strategy or lattice hypercube sampling lhs strategy to generate ω d since the changes of these two terms are generally not remarkable see fig 2 a and b if pumping wells are included in the source sink term the variations of hydraulic head depend on the location of the pumping wells specifically the closer to the pumping wells the more intense the change of the hydraulic head while the farther away from the pumping wells the gentler the change of the hydraulic head under this circumstance a locally refined sampling lrs strategy is needed to be consistent with the changes of the hydraulic head to achieve this goal we use the nodelab proposed by mishra 2019 to generate ω d see fig 2 c for an aquifer with a single well and fig 2 d for an aquifer with multiple wells 2 temporal sampling since the groundwater flow equation shown in eq 1 is time dependent in addition to the spatial sampling it is also necessary to conduct the appropriate temporal sampling and we denote 0 t d the set of sampling points in the time domain 0 t by the prior knowledge of groundwater problems we know that the change of hydraulic head will eventually become stable as time goes on regardless of the type of aquifers but whether there are pumping wells or not in the aquifer will affect the change process of hydraulic head if an aquifer without pumping wells is considered the overall change of hydraulic head during the time domain is relatively gentle and therefore we can adopt the uniform sampling with relatively large time step to obtain 0 t d as shown in fig 3 a or the lattice hypercube sampling lhs as shown in fig 3 b otherwise the hydraulic head will change dramatically in the initial stage due to the influence of the pumping wells especially near the wells to capture these changes well in addition to the locally refined spatial sampling points ω d we also conduct the same strategy in the time direction to obtain 0 t d during the initial stage as shown in fig 3 c such a locally refined sampling strategy is implemented by generating a series of subintervals with equal ratio r in 0 t 3 spatial temporal sampling in the previous two subsections we have already discussed the generation of spatial sampling points and temporal sampling points respectively then we use the spatial sampling ω d γ 1 d and γ 2 d and the temporal sampling 0 t d to produce the spatial temporal sampling point sets 10 ω d t ω d 0 t d ω d 0 ω d 0 γ 1 d t γ 1 d 0 t d γ 2 d t γ 2 d 0 t d which will be fed into our gw pinn during the training process 3 4 loss functions once the spatial temporal sampling points are obtained we need to minimize a loss function to train the neural network two types of loss functions the soft constraint and the hard constraint are both investigated where the first is originated from the pioneer work pinns raissi et al 2019 and the second is inspired from sun et al 2020 1 soft constraint in this case we directly take the output of the neural network u as the hydraulic head h i e h u x y t θ and the soft constraint is expressed as 11 l θ l p d e θ i 0 2 λ i l i θ where 12a l pde θ x y t ω d 0 t d k h x y t θ μ h x y t θ t f x y t 2 12b l 0 θ x y t ω d γ 1 d γ 2 d 0 h x y t θ g 0 x y t 2 12c l 1 θ x y t γ 1 d 0 t d h x y t θ g 1 x y t 2 12d l 2 θ x y t γ 2 d 0 t d k h x y t θ n x y g 2 x y t 2 where lpde θ denotes the pointwise pde residual l 0 θ l 1 θ l 2 θ measure the initial first and second boundary errors respectively and λ0 λ1 λ2 are three hyperparameters for balancing the four terms 2 hard constraint in this case we represent the hydraulic head function h as 13 h x y t θ h x y t d x y t u x y t θ where u x y t θ is the output of the neural network h x y t is a particular function which exactly satisfies the initial condition and dirichlet boundary condition and d x y t is a function which vanishes on the initial boundary ω 0 and dirichlet boundary γ1 due to the introduction of d x y t it is easy to see that h x y t automatically satisfies the initial condition and dirichlet boundary condition and thus the loss function can be defined as 14 l θ l pde θ λ 2 l 2 θ where lpde θ and l 2 θ are defined by 12a and 12d respectively 3 construction of h x y t h x y t is a particular function which exactly satisfies the initial condition and dirichlet boundary condition simultaneously i e 15a h x y 0 g 0 x y x y ω 15b h x y t g 1 x y t x y t γ 1 0 t if the initial value and dirichlet boundary value are chosen as a constant value h x y t can also be selected as this constant otherwise h x y t can be pretrained by a simple fully connected neural network pretrained by using the initial values and dirichlet boundary values sun et al 2020 4 construction of d x y t the simplest choice of d x y t is the indicator function defined by 16 d x y t 0 x y t ω 0 γ 1 0 t 1 o t h e r w i s e but it is not smooth and inappropriate to the network based method alternatively we can choose d x y t as the distance function from the point x y t to the initial boundary ω 0 and dirichlet boundary γ1 tmin tmax i e 17 d x y t m i n x y t ω 0 γ 1 0 t x x 2 y y 2 t t 2 if the domain is regular the function d x y t may be constructed explicitly for example let ω xmin xmax ymin ymax with dirichlet boundary γ1 x y x xmin or xmax and initial boundary ω0 x y t t 0 the function d can be expressed as 18 d x y t y y m i n y m a x y t y m a x y m i n 2 t for a complex domain ω we can pretrain a simple fully connected neural network d x y t by minimizing the following loss function 19 l d d ψ x y t ω d t m i n t m a x d d x y t ψ d x y t 2 where ψ represents the trainable parameters for this network and d x y t can be precomputed using a certain distance function 3 5 training strategy we can easily get the uniform spatial temporal sampling points for aquifer without pumping wells in this case it is not necessary to use too much sampling points which makes the training of the neural network relatively easy therefore we here mainly focus on the training strategy for the aquifer with pumping wells based on the above discussion the change process of hydraulic head in this case can be divided into two stages as the initial stage with drastic change of hydraulic head and the second stage with relatively small change of hydraulic head precisely we divide the time domain 0 t into two subintervals 0 τ and τ t where τ is the watershed of the two stages which needs to be adjusted empirically or manually we will train two different networks in two stages in a snowball way i e the first network is trained in the initial stage 0 τ and once it is trained well we use the prediction value of hydraulic head at t τ as the initial value of the second stage and continue to train the second network to express this idea more clearly we illustrate the two stage training strategy in fig 4 4 testing cases and model evaluation indices to demonstrate the performance of the proposed gw pinn for simulating the groundwater problems with different types of aquifer five test cases are investigated including confined unconfined aquifer containing pumping wells confined aquifer containing multiple pumping wells and unconfined aquifer with two parallel canals the details of the test cases and the corresponding evaluation criteria are introduced below 4 1 case 1 two parallel canals in this test we consider a homogeneous isotropic unconfined aquifer with two canals lying parallel each side with a distance of 40 m in addition we set the length of the y direction as 10 m which forms the simulated domain ω 20 20 0 10 m the saturated hydraulic conductivity in both x and y directions are k s x k s y 0 5 m d the specified yield of unconfined aquifer is μ 0 1 and the thickness of the aquifer is 5 m the left and right boundaries are the canals whose water surface height are always 2 m the upper boundary is recharged by uniform precipitation whose density is 0 002 m d that is to say the source sink term in eq 5 contains only the precipitation term i e f p the details of problem settings are demonstrated in fig 5 in this case the steady solution of the hydraulic head can be expressed analytically as 20 h x 4 p k s 400 x 2 where ks k s x k s y 4 2 case 2 single pumping well of the confined aquifer in this test we consider the confined aquifer containing a single pumping well nw 1 in source sink term which is located at the center of the spatial domain ω 500 500 500 500 m and has the pumping flow q 1 10000 t d we specify the south and north boundaries as the dirichlet boundaries with constant hydraulic head i e g 1 x y t 100 m on γ1 0 t with γ1 x y y 500 m and the east and west boundaries as the non flux boundaries i e g 2 x y t 0 on γ2 0 t with γ2 x y x 500 m moreover we set the initial condition as g 0 x y t 100 m on ω 0 the remaining relevant parameters are specified as m 3 m μ s 10 3 m 1 k s x k s y 33 33 m d the details of problem settings are demonstrated in fig 6 4 3 case 3 confined aquifer containing multiple pumping wells in this test we consider the isotropic confined aquifer containing multiple pumping wells assume that four pumping wells nw 4 are located at x 1 250 250 m x 2 250 250 m x 3 250 250 m x 4 250 250 m and each well has the pumping flow qi 2500 t d i 1 2 3 4 the other settings including the geometry and property of aquifer as well as the initial and boundary conditions are the same as that of the previous case in 4 2 the details of problem settings are demonstrated in fig 7 4 4 case 4 unconfined aquifer containing a single pumping well this test case is designed to demonstrate the accuracy of gw pinn in the unconfined aquifer in this case we investigate a square homogeneous isotropic unconfined aquifer with side length of 1000 m the specific yield of the unconfined aquifer is set as μ d 0 1 and the saturated hydraulic conductivity is set as k s x k s y 33 33 m d the left and right sides are specified as non flux boundaries i e g 2 x y t 0 and the upper and lower sides are assumed to be constant head boundaries with g 1 x y t 90 m the initial hydraulic head in the simulation region is set to be constant everywhere with g 0 x y 90 m suppose that a pumping well is located in the center of the region with pumping flow q 1 40000 t d the well start pumping at the 0 th day and last to the 20 th day the problem settings are illustrated in fig 8 4 5 case 5 confined aquifer with the l shape domain containing a single pumping well this test case is designed to demonstrate the accuracy of gw pinn for irregular domain in this test we consider the confined aquifer with the l shape domain containing a single pumping well nw 1 in source sink term which is located at 250 250 m and has the pumping flow q 1 2000 t d the shape of the domain and the boundary conditions are shown in fig 9 we set the dirichlet boundaries with a constant hydraulic head 100 m and others as the non flux boundaries the initial condition of the whole domain was set as 100 m the remaining relevant parameters are specified as m 3 m μ s 10 3 m 1 k s x k s y 33 33 m d 4 6 model evaluation indices the simulation results of modflow or the analytical solution are used as reference results to evaluate the performance of gw pinn two evaluation indices including the mean absolute error mae and the relative root mean square error rrmse are used to evaluate the errors between gw pinn and reference results from modflow or the analytic solution as follows 21 m a e 1 n i 1 h i h i 22 r r m s e i 1 n h i h i 2 n 1 n i 1 n h i 2 where hi is the simulated value predicted by gw pinn h i is the simulated value of modflow or the analytic solution n is the sample number the mae value close to 0 and the rrmse value close to 0 show the accuracy of the model for each case eight observation points were set to calculate the evaluation indices the coordinates of observation points for different cases are shown in table 1 and also in figs 6 9 the overall errors of all points for cases 2 5 are also calculated 5 experimental results all the experiments are conducted by a single nvidia 2080ti gpu with pytorch 1 1 0 the simulation results of all test cases will be compared with those produced by the well known software modflow except the two parallel canals test case which has the analytical solution we always use 4 hidden layers i e d 4 and 40 neurons per each hidden layer i e nk 4 for our gw pinn except stated otherwise and the activation function is chosen as the sin function the network is trained using adam optimizer with 2000 epochs followed by lbfgs optimizer with 1000 epochs and the training process terminates when the absolute difference between the loss values of two adjacent iteration steps is less than a certain threshold value ε we choose ε 10 8 in addition the parameter s in eq 9 is selected as 30 it should be noted that the architecture of gw pinn including the number of hidden layers and neurons per each hidden layer is determined in an empirical way the training points x y t are generated by locally refined spatial sampling and uniform or quasi uniform temporal sampling and in the validation or test phase we generate the input data by uniform sampling for more convenient of visualization 5 1 ablation study in this subsection we investigate the effect of the loss function the spatial temporal sampling strategy and the training strategy on the proposed gw pinn 5 1 1 effect of loss function as mentioned earlier in section 3 4 we may use two types of loss function the soft constraint vs the hard constraint to train gw pinn here we study and compare their performance on the training process 1 learning test case 1 using the soft constraint and the hard constraint we first test an unconfined aquifer containing two parallel canals the detail of problem settings has been described in test case 1 in this case no pumping well is considered in the source term eq 5 which makes the change of hydraulic head keeps relatively gentle during the whole evolution process therefore we generate the spatial temporal sampling points using lhs as the spatial sampling strategy shown in fig 2 b and us as the temporal sampling strategy shown in fig 3 a the 3d surface of predicted values of hydraulic head by our gw pinn at t 1 15 30 45 days are presented in fig 10 from which we see that numerical performances of the two loss functions are very different it is observed that the use of soft constraint fails to train gw pinn successfully and almost nothing is learned in this case while the use of hard constraint is able to train gw pinn very well and nice prediction is obtained in this case in addition we find from fig 10 b 1 due to the amount of precipitation the hydraulic head of the entire surface shows a rising trend 2 since the hydraulic head are set to be constant on the west and east boundaries the closer to the center of the area the faster the hydraulic head rises 3 the rise of the hydraulic head tends to slow down and remains nearly stable after 45 days due to the volume of water discharged by the canals begins to cover the volume of water recharged by precipitation the prediction results are well consistent with the hydrological change process under this case further results of quantitative analysis are shown in fig 11 where the predictions by our gw pinn with the hard constraint at different time stamps are shown and compared against the analytical steady state solution where the mae is 0 010 m and the corresponding rrmse is 0 449 indicating the good performance of the hard constraint in this case 2 learning test case 2 using the soft constraint and the hard constraint we next test a confined aquifer containing a single pumping well and the detailed problem settings are described in test case 2 for simplicity only the initial stage is considered by setting τ 1 in the snowball style two stage training strategy discussed in section 3 5 in this case a pumping well is located at the center of the spatial domain which makes the hydraulic head change dramatically near the pumping well and become slow gradually far away from it during the whole evolution process therefore we recommend spatial temporal sampling points be generated by using lrs for spatial sampling and lhs for temporal sampling where the spatial sampling points ω d 1250 are shown in fig 2 a and the temporal sampling points 0 τ d 50 shown in fig 3 b the 3d surfaces of predicted values of hydraulic head by our gw pinn with the soft constraint or hard constraint at 0 25 0 5 0 75 and 1 days in the initial stage are presented in fig 12 we observe that the similar phenomenon as the previous test the soft constraint again fails to train gw pinn while the hard constraint is very suitable to train gw pinn and produces excellent prediction it is worth noting that the predictions of gw pinn are very close to those computed by modflow as demonstrated by the contour maps given in fig 13 5 1 2 effect of the sampling strategy the training quality of gw pinn depends heavily on the training set which makes it necessary to choose an effective sampling strategy for spatial temporal points as discussed in section 3 3 if there is no pumping well in the aquifer the sampling method is relatively easy and the uniform or quasi uniform spatial temporal strategy can perform well however if the pumping wells are included in the aquifer an appropriate spatial temporal sampling strategy becomes important here we mainly focus on the effect of different sampling strategies on the latter situation 1 spatial sampling after 50 temporal sampling points are generated by using lhs we take three different type of spatial sampling strategies including us lhs and lrs to show their effects on the training of our gw pinn in the initial stage of test case 2 note that the results for test case 2 predicted by our gw pinn using lrs as the spatial sampling strategy including 3d surface and contour map of the hydraulic head have been very satisfactory as shown in figs 12 b and 13 where the number of spatial sampling points is 1250 approximately here we first use us and lhs to generate approximately 2500 spatial sampling points respectively as shown in fig 2 a and b and combine them with the aforementioned temporal sampling points to form the spatial temporal sampling points and then feed them into gw pinn to train it the corresponding 3d surfaces of predicted hydraulic head are shown in fig 14 from which we can see that both us and lhs failed to capture the change of hydraulic head near the pumping well accurately compared to the result of fig 12 b the main reason for this phenomenon is that the main change of hydraulic head is concentrated in the vicinity of the pumping well and when us or lhs is used as spatial sampling strategy the sampling points falling in the adjacent area of the pumping well are actually not enough to make gw pinn to capture the details of the change of hydraulic head especially when the total number of spatial sampling points is not large next we use us and lhs to generate more spatial sampling points approximately 6000 to train gw pinn again the predicted results are shown in figs 15 and 16 from which we can observe that along with the increase of spatial sampling points the 3d surfaces visually seem to be greatly improved especially for lhs and close to those shown in fig 12 b however they are still inaccurate and the corresponding contour maps are far from those calculated by modflow although we have reasons to believe that with the continuous increase of spatial sampling points the prediction ability of gw pinn will be further improved there are also other troubling problems for example the sharp increase in the amount of training data will make the training of gw pinn slowly even intractable a natural solution for this issue is probably to use lrs to generate locally refined spatial sampling points as shown in fig 2 c where most of them are concentrated near the pumping well and gradually become sparse when further away from the well as can be seen from the predicted results shown in fig 12 b although the number of spatial sampling points ω d 1250 is only about a fifth of those by us and lrs ω d 6000 the predictions by our gw pinn using lrs are much more accurate in summary we recommend using the locally refined strategy for spatial sampling if the aquifer contains pumping wells otherwise uniform or quasi uniform spatial sampling strategy is apt for training the gw pinn 2 temporal sampling we continue to discuss the effect of temporal sampling strategy on the training of gw pinn by fixing the lrs as the spatial sampling strategy we use two different temporal sampling strategies including us and lrs to generate temporal sampling points as shown in fig 3 a and c where the ratio of lrs is chosen as r 1 04 here contour maps of hydraulic head predicted by gw pinn using us or lrs as temporal sampling strategy are shown in fig 17 from which we see that both temporal sampling strategies work similarly on the predictive performances of our gw pinn it can be concluded that the training of our gw pinn is insensitive to the temporal sampling strategies 5 1 3 effect of training strategy groundwater equation is a time evolution equation and it is usually necessary to carry out long term simulation for groundwater simulation a naive global way is to train gw pinn in the whole spatial temporal domain to capture the change of the hydraulic head at different levels enough temporal sampling points are needed to train gw pinn when the spatial sampling strategy is fixed the simulation results predicted by our gw pinn using the global training strategy are shown in fig 18 from which we see that although the overall trend of hydraulic head has been learned the details are not sufficiently accurate along with the increase of temporal sampling points the predictive ability of the gw pinn could be further improved on the other hand this will lead to a sharp increase of training data which make the training more difficult a better way to train the gw pinn is a snowball style shown in section 3 5 which is implemented by first dividing the temporal domain of eq 1 into two stages and then train the network in each stage in sequence see fig 4 for the details of the overall training process the advantage of such a strategy is to capture the drastic change of the hydraulic head quickly and accurately in the initial stage by using as few temporal sampling points as possible and in the following stage the change of hydraulic head becomes gradually stable which makes the training process relatively easier this can be verified by the loss curve shown in fig 19 from which we observe that the overall training cost is concentrated in the initial stage and once the network in the initial stage is trained well the training of the network in the second stage becomes very smooth where the whole loss value is maintained at a very low level it only needs about 2000 adam iterations to complete the training the simulation results predicted by our gw pinn including the 3d surfaces and contour maps at different times in the second stage are shown in fig 19 where the contour maps predicted by gw pinn are very close to those calculated by modflow furthermore we also conduct a quantitative analysis at eight observation points listed in table 1 at t 20 days and the results are reported in table 2 where the mae in test case 2 at 20 d is 0 43 m and the rrmse is only 0 59 which are clearly within the acceptable range 5 2 performance results for test cases 3 and 4 to further demonstrate the performance of our gw pinn we will test a confined aquifer containing multiple pumping wells see the problem settings for test case 3 and an unconfined aquifer containing a single pumping well see the problem settings for test case 4 based on the ablation studies we use the hard constraint as the loss function lrs strategy to generate spatial sampling points lhs strategy to generate temporal sampling points and the snowball style training two stage strategy with setting τ 1 for training in all the following numerical tests let us first consider test case 3 simulation results predicted by our gw pinn including the 3d surfaces and contour maps at different times are demonstrated in fig 21 for the initial stage and fig 22 for the second stage the corresponding quantitative evaluation results are reported in table 2 from figs 21 and 22 it is easy to find that the change process of hydraulic head in this case looks like that of case 2 but four depression funnels were formed near the four wells furthermore contour maps of hydraulic head demonstrate that the simulation results predicted by our gw pinn are very close to those calculated by modflow at different times we can see from table 2 that the mae in test case 3 at 20 days is 0 1 m and the corresponding rrmse is 0 14 where the error is within the acceptable range next we consider test case 4 which is a relatively complicated case to show the capacity of our gw pinn different from the networks setting in other cases we add one more layer in the fully connected network i e 5 hidden layers i e d 6 and 40 neurons per each hidden layer i e nk 40 for the architecture of our gw pinn it can be seen from the 3d surfaces in figs 23 and 24 that the change process of the hydraulic head in this case is similar to that of case 2 furthermore the corresponding contour maps show that the simulation results predicted by our gw pinn are very close to those calculated by modflow as reported in table 2 the mae in test case 4 at 20 days is 0 17 m and the corresponding rrmse is 0 20 the error is within the acceptable range 5 3 performance results for test case 5 with the l shape domain for test case 5 with the l shape domain simulation results predicted by our gw pinn including the 3d surfaces and contour maps at different times are demonstrated in fig 25 the corresponding quantitative evaluation results are reported in table 2 the contour maps of hydraulic head demonstrate that the simulation results predicted by our gw pinn are very close to those calculated by modflow at different times we can see from table 2 that the mae in test case 5 at 1 day is 0 052 m and the corresponding rrmse is 0 058 where the error is within the acceptable range this case demonstrates the accuracy of gw pinn for irregular domain which has possible application for real world cases with complex geometry 6 model discussion 6 1 model application as a surrogate model for parameterized groundwater flow in the previous sections we investigate gw pinn for solving different types of groundwater flow and satisfactory predicted results are obtained compared to the numerical results provided by modflow however the potential advantages of the network based method exist that it can serve as a surrogate model for solving parameterized pdes for example we reconsider case 2 by extending the fixed pumping capacity into variable ones in other words the pumping capacity in eq 5 is now a parameter in a certain range qmin qmax here we assume qmin 5000 t d and qmax 10000 t d this scenario is very useful in the agricultural water management because the relevant managers sometimes need to monitor the influence of the pumping capacity on the groundwater level to tackle this problem we can use gw pinn to solve it once and for all to this aim we need to make a slight modification on the original gw pinn that is to use x y t q instead of x y t as the input of the network the spatial temporal capacity sampling point set is generated as follows 23 ω d t q ω d 0 t d q m i n q m a x d where qmin qmax d denotes the uniform sampling points in qmin qmax the loss functions are the same as those in eq 12 to avoid the limitation of insufficient memory the mini patch training strategy is adopted and only adam optimizer is used in the whole training process once the training is finished about 200 epochs we can predict the groundwater level at arbitrary spatial and temporal points in the solution domain for any pumping capacity the corresponding predicted results are demonstrated in figs 26 29 where the pumping capacity q is chosen as 5550 6575 7810 and 8920 t d respectively it should be note that such values are not appeared in the training set qmin qmax d and the results of both 3d surfaces and contour maps are very satisfactory compared with the numerical solutions provided by modflow using very fined meshes in this case there are 1250 spatial sampling points 50 temporal sampling points and 50 points for pumping capacity with a uniform interval of 100 t d the training time is about 60 min 6 2 model advantages and disadvantages compared with current proposed machine learning methods to solve the groundwater flow equation wang et al 2020 xu et al 2021 gw pinn takes the advantage in that it can solve the groundwater flow equation containing source sink terms directly when constrained only by residual losses of pdes while no label data are needed the overall errors are fairly well table 2 showing high accuracy the input data are x y t which are unsupervised and can be obtained in a random and flexible way this is meaningful for accurately obtaining the large hydraulic gradient adjacent to the source sink terms e g wells by using the locally refined sampling strategy this sampling method is similar to those numerical models by using refined grids adjacent to wells the hard constrain is proposed in this study to keep the output being satisfied by the initial and boundary conditions which owns more appropriated physical meaning this method avoids the over fit problem encountered by those data drive machine learning methods another advantage of gw pinn is that it can be used as a surrogate model making the prediction task be easy and efficient the prediction takes ignorable computational cost with the well trained gw pinn and no simulation experience is required which is beneficial for those staff of water resources management agency no meshes are used in gw pinn while only sampling points without topological structure are used which is easy to carry out it should be noted that gw pinn is not proposed to compete with the traditional numerical methods one major limitation of these network based models including gw pinn to solve pdes is the computational cost during the training period when applying it to a real world case especially with large area domain and more complex boundary and initial conditions in view of the particularity of the point source problem the spatial locally refined sampling strategy we adopted greatly reduces the training points without affecting the final effect so as to effectively improve the training process nevertheless further studies including more effective constraints and more advanced training strategies should be investigated 7 conclusions in this paper we have proposed a deep learning method gw pinn for solving groundwater flow equations with source sink terms from a new perspective the hard constraint and spatial temporal sampling strategy as well as the training strategy are proposed and investigated through a series of ablation studies the major conclusions are as follows 1 the proposed gw pinn is valid for capturing the hydraulic head of groundwater flow especially for those with local source sink terms 2 the loss function using the hard constraint is more suitable to train gw pinn and can produce more accurate prediction than the soft constraint 3 the proposed locally refined spatial sampling lrs strategy can generate more accurate results with much fewer sampling points than the uniform sampling us strategy or lattice hypercube sampling lhs strategy 4 the temporal sampling strategy owns slight impact on the predictions of gw pinn 5 the proposed snowball style two stage training strategy is more efficient to capture the drastic change of the hydraulic head than using the global training strategy 6 gw pinn can be used as a surrogate model for parameterized groundwater flow prediction 7 future studies can focus on increasing the training efficiency to extend the application of gw pinn for more complex and larger area groundwater flow prediction credit authorship contribution statement xiaoping zhang methodology validation writing original draft yan zhu conceptualization methodology writing review editing jing wang methodology writing review editing lili ju methodology yingzhi qian writing review editing ming ye writing review editing jinzhong yang writing review editing declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments x zhang s research was partially supported by national key research and development program of china 2021yfd1900805 02 y zhu s research was partially supported by national natural science foundation of china through grants 52179041 l ju s research is partially supported by us department of energy grant de sc0022254 
140,machine learning methods provide new perspective for more convenient and efficient prediction of groundwater flow in this study a deep learning method gw pinn without labeled data for solving groundwater flow equations with wells was proposed gw pinn takes the physics inform neural network pinn as the backbone and uses either the hard or soft constraint in the loss function for training a locally refined sampling strategy lrs is adopted to generate the consistent spatial sampling points for problems with strong hydraulic head change and then combined with an appropriate temporal sampling scheme to obtain the final spatial temporal sampling points a snowball style two stage training strategy by dividing the temporal domain into two subdomains is designed to decrease the sampling points five cases were designed to test the training performance of gw pinn under different sampling strategies and two constraints the predicted results of gw pinn were compared with modflow and the analytical solution the results demonstrate that gw pinn possesses strong ability in capturing the hydraulic head change for both confined and un confined aquifers the hard constraint owns more robust learning ability than the soft constraint the lrs strategy can generate more accurate results with much fewer sampling points than traditional sampling strategies and the snowball style two stage training strategy is significantly efficient for problems with the drastic change of hydraulic head furthermore the application of gw pinn as a surrogate model for parameterized groundwater flow equations is illustrated this study provides an option tool for efficient groundwater flow simulation especially for those with local refinements are needed keywords deep learning method gw pinn locally refined sampling strategy hard constraint two stage training strategy 1 introduction with the improvement of computational power and explosive growth of data deep learning has achieved great success in many fields such as computation vision natural language processing and other fields krizhevsky et al 2012 he et al 2016 in the past few years significant effort also has been devoted to use these technologies to solve problems arising in computational and scientific engineering among which a typical case is numerical solution of partial differential equations pdes of various types weinan and yu 2018 jagtap et al 2020 raissi et al 2019 sirignano and spiliopoulos 2018 zhu and zabaras 2018 what we are concerned with in this paper is the numerical simulation of groundwater flow equations which is important for groundwater resources management and protection crowe et al 2004 knights et al 2017 walter et al 2020 there exists a large amount of mature traditional numerical methods for solving the partial differential equations pdes of groundwater flow e g the finite element method the finite difference method and the finite volume method brunner and simmons 2012 harbaugh et al 2000 trefry and muffels 2007 important issues in those spatial discretization methods for solving the pdes of groundwater flow are the large computational cost and difficult iteration convergence in handling aquifers with strong heterogeneity and complex boundaries or multiple source sink terms whereas the local grid refinements are needed borsi et al 2013 dickinson et al 2007 mehl and hill 2002 panday and langevin 2012 vilhelmsen et al 2011 these models are usually difficult to implement for staff of water resources management agency since very professional numerical modeling knowledge and experience are needed compared to the traditional numerical methods the deep learning approach provides a fresh perspective for solving pdes and possesses many unique advantages 1 universality it is a universal method which can solve different types of pdes on arbitrary domains 2 meshless it only requires the reasonable distribution of sample points which is much easier than the mesh generation 3 efficiency the computational costs of the traditional time stepping methods such as the forward euler scheme the crank nicolson scheme etc grow rapidly as the number of time iterations increases and the prediction should be carried out sequentially whereas the deep learning approach can predict the solution at any time very quickly once the model is well trained which can be used as a surrogate model for quick prediction for water resources management 4 convenience the traditional numerical method can only predict the solution on the grid points and additional post processes are needed to obtain the approximate solutions on the non grid points while the deep learning approach can predict the solution at arbitrary spatial temporal points to the best of our knowledge the first attempt of numerical solution of pdes using neural networks can be traced back at least to the end of the last century dissanayake and phan thien 1994 where the authors proposed an unsupervised method to train the neural network by minimizing ω l u f 2 d x ω b u g 2 d x to approximate the solution of the following pdes l u x f x ω b u x g x ω and two simple examples were considered to verify the effectiveness of the proposed method however due to the limitation of computational power at that time it did not attract enough attention until the last decade this approach has made remarkable progress and a series of fruitful research works have emerged weinan and yu 2018 meng et al 2020 raissi et al 2019 sirignano and spiliopoulos 2018 zhu and zabaras 2018 there are currently two major ways to use deep learning methods to solve pdes the first way is to convert pdes into their equivalent variational forms and then solve them using neural networks the pioneering work is the deep ritz method proposed by weinan and yu 2018 followed by a series of excellent researches liao and ming 2019 müller and zeinhofer 2019 wang and zhang 2020 chen et al 2020 the deep nitsche method liao and ming 2019 extended the deep ritz method to deal with essential boundary conditions without extra computational costs chen et al 2020 carried out the comparison study for elliptic problems with different boundary conditions including dirichlet neumann robin and periodic boundary conditions by using the deep ritz method and the deep galerkin method sirignano and spiliopoulos 2018 which observed that the deep galerkin method works better for problems with smooth solutions while the deep ritz method works better for problems with low regularity solutions based on the deep ritz method wang and zhang 2020 proposed a mesh free method to solve the interface problems where two challenging interface problems were investigated including an elliptic pde with a discontinuous and heterogeneous diffusion coefficient and a linear elasticity equation with discontinuous stress tensor the other way is to use neural networks to directly deal with the original pdes and the most representative work is the physical informed neural network pinn proposed by raissi et al 2019 where the pde residual is incorporated into the loss function as a regularizer thereby constraining the space of admissible solutions the original pinn uses the residual of pdes as the loss function which is called as the soft constraint different from the soft constraints berg and nystrom 2018 and sun et al 2020 proposed some sort of hard constraint to make the output of the neural networks satisfy the boundary and initial conditions pinns have been successfully applied to solve various pde problems such as classic time independent or time dependent pdes fractional pdes pang et al 2019 and stochastic pdes zhang et al 2020 however for high dimensional problems especially for time dependent problems the amount of data sampling tends to become huge which would consume unacceptable training time or even collapse the training of pinn in recent years the deep learning method has been applied for many hydrology problems shen 2018 e g groundwater table depth forecasting sun et al 2022 flood forecasting lv et al 2020 runoff prediction huang et al 2020 water quality prediction anshuman and eldho 2022 liang et al 2020 and uncertainty quantification or parameter inversion problems in subsurface flow mo et al 2019 zhang 2019 laloy 2018 most machine learning models for groundwater flow prediction were labeled data driven to learn the relationship between the groundwater table level with the major impact factors e g precipitation evapotranspiration groundwater exploration and irrigation the popular ones included the controlled auto regressive car method zhao et al 2020 autoregressive integrated moving average arima adhikary et al 2012 mirzavand and ghazavi 2014 artificial neural network ann kuo et al 2007 sahu et al 2020 support vector machine svm yoon et al 2011 genetic algorithms jha and sahoo 2015 ravansalar et al 2017 and long short term memory lstm zhang et al 2018 recently wang et al 2020 proposed a theory guided neural network tgnn for subsurface flow with heterogenous hydraulic conductivity field in which the groundwater flow equation was integrated with the labeled hydraulic head data and additional engineering controls to be constraints in the loss function for subsurface flow modeling and a weak form tgnn tgnn wf was further proposed for diffusivity equations with local source sink terms by xu et al 2021 and the authors mentioned that tgnn wf cannot solve the groundwater flow equation containing source sink terms when constrained only by initial conditions boundary conditions and weak form residual losses and the labeled training data was required to capture the pressure drawdown in cases with wells the current machine learning methods require a large number of label data and face the over fit problem in training srivastava et al 2014 very few studies have been proposed for solving groundwater flow equations directly without label data based on the deep learning method especially for those with local source sink terms due to the discontinuity at the source sink location which worth paying more attention in this paper a deep learning method to directly solve the pdes of the groundwater flow without label data called as gw pinn has been proposed a locally refined spatial temporal sampling strategy and a snowball style two stage training strategy are proposed and adopted which make the method suitable for situations with source sink terms where local grid refinements are needed the hard constraint is adopted which is beneficial to train gw pinn by only including the initial boundary losses and residual loss of pdes while avoids using the labeled data in the training five test cases and one application case are designed to evaluate the accuracy and efficiency of the proposed method this paper is organized as follows the description of groundwater flow equations is shown in section 2 followed by the network architecture of gw pinn the sampling strategy loss functions and the training strategy introduced in section 3 the description of the five cases is presented in section 4 ablation studies including the effects of different loss functions sampling strategies and training strategies are shown in section 5 together with comparison results of the test cases with modflow harbaugh et al 2000 model discussion is shown in section 6 finally some conclusions are drawn in section 7 2 groundwater flow equations let ω r 2 be an open connected domain in the two dimensional space ω 0 t denotes the spatial temporal region to be solved ω 0 denotes the initial region γ1 0 t denotes the boundary of first kind dirichlet boundary and γ2 0 t denotes the boundary of second kind neumann boundary moreover let x x y be a spatial point in ω and x y t be a spatial temporal point and then the groundwater flow can be described as the following system 1a k h μ h t f x y t x t ω 0 t 1b h x y t g 0 x y x y t ω 0 1c h x y t g 1 x y t x y t γ 1 0 t 1d k h x y t n x y g 2 x y t x y t γ 2 0 t where h is the hydraulic head l is the gradient operator defined by h h x h y t g 0 g 1 and g 2 refer to the specified initial value dirichlet value and neumann value of the problem respectively and n x y denotes the unit normal vector outward to ω on the neumann boundary it s remarkable that the specific form of two parameters tensor depends on the type of aquifer i e 2 μ μ e μ s m c o n f i n e d a q u i f e r μ d u n c o n f i n e d a q u i f e r and 3 k k s m c o n f i n e d a q u i f e r k s h u n c o n f i n e d a q u i f e r where μ μ e is the elastic release coefficient of the confined aquifer with the specific storativity μ s l 1 and the thickness of aquifer m l or μ μ d is the specified yield of unconfined aquifer k k sm is the transmissivity tensor if the confined aquifer is considered or k k sh is the transmissivity tensor if the unconfined aquifer is considered and 4 k s k s x 0 0 k s y denotes the saturated hydraulic conductivity tensor k s x and k s y are the saturated hydraulic conductivity in the x and y directions respectively lt 1 fis the source sink term defined by 5 f p e i 1 n w q i δ x x i where p p x y t denotes the amount of precipitation infiltration to recharge groundwater lt 1 e e x y t refers to the evapotranspiration of groundwater lt 1 and qi represents the pumping capacity of pumping well located at xi yi nw is the number of pumping wells and δ is the dirac delta function satisfying the following conditions 6 δ x 0 x 0 x 0 and r 2 δ x d x 1 the physical meaning of eq 1a is that it reflects the mass conservation relation of groundwater movement in the aquifer and represents the water balance relation of the unit volume and the unit time of aquifer under the darcy s flow condition that is to say the difference between mass of water flowing in and out of the unit volume aquifer in the unit time the left side of eq 1a is equal to that of water released or stored in the unit volume aquifer in the same time the right side of eq 1a 3 proposed method gw pinn our gw pinn takes the physics inform neural network pinn as the backbone and uses the hard constraint approach in the loss function for issues where appropriate locally refined spatial meshes are needed we adopt locally refined sampling strategy to generate the consistent spatial sampling points with the problem and then combined with appropriate temporal sampling points to obtain the ultimate spatial temporal sampling points consequently these sampling points will be used as training set to be fed into gw pinn to train it once the network is trained well it can be used to predict the hydraulic head at any time and at any point in space in order to train gw pinn effective and fast we design a snowball style two stage strategy by dividing the temporal domain into two stages and then training respective networks in each stage in sequence we find that the training cost mainly concentrate in the initial stage and in this stage the drastic change process of hydraulic head can be captured accurately without large amount of training points once the first stage network is trained the training in the second stage becomes much faster the details of gw pinn are shown in the following sections 3 1 network architecture the basic architecture of our gw pinn for solving eq 1 is shown in fig 1 the network takes a spatial temporal point x y t as an input and output a scalar u the input layer is connected to d 1 hidden layers and an output layer which form a fully connected neural network of depth d letting nk be the number of neurons in the k th layer each hidden layer receives an input v k 1 r n k 1 from the previous layer output and transforms it to 7 l k v k 1 w k v k 1 b k where w k r n k n k 1 and b k r n k the nonlinear activation function σ is applied to each component of the transformed vector before sending it to the next layer other than the last hidden layer the network thus is a composite of a sequence of nonlinear functions 8 u x y t θ l d σ l d 1 σ l 1 x y t where the operator denotes the composition and θ w k b k k 1 d represents the trainable parameters in the network 3 2 approximation of the dirac delta function in the network setting we seek for a classic smooth solution satisfying the strong form of the pde eq 1 however if the aquifer contains pumping wells there exist the dirac delta functions δ x y in the source sink term but δ x y is not differentiable everywhere and indeed it can only be well defined in the sense of distribution thus in practice we approximate the dirac delta function by a multi dimensional gaussian density function 9 ρ x y 1 2 π s 2 e x y 2 2 s 2 where the parameter s 0 denotes the standard deviation of the distribution as s 0 this function approaches to the dirac delta function 3 3 sampling strategy it is crucial to generate appropriate spatial temporal sampling points for training of the network by taking into account the features of the source sink term we propose adaptive spatial and temporal sampling strategies and training strategies in different cases 1 spatial sampling we sample the spatial domain in two cases the inner domain ω and the boundary γ which is composed of the first kind boundary γ1 and the second kind boundary γ2 i e γ γ1 γ2 sampling on the boundary γ can be done through a uniform sampling strategy such as equidistance nodes in each direction we denote γ d the set of all these sampling points on the boundary γ and then divided it into two parts γ1 d and γ2 d which denote the set of sampling points on γ1 and γ2 respectively the generation of the set of sampling points in ω denoted as ω d is determined by the property of the source sink term shown in eq 5 specifically if the source sink term only contains the precipitation term p and the evapotranspiration term e it is enough to simply adopt the uniform sampling us strategy or lattice hypercube sampling lhs strategy to generate ω d since the changes of these two terms are generally not remarkable see fig 2 a and b if pumping wells are included in the source sink term the variations of hydraulic head depend on the location of the pumping wells specifically the closer to the pumping wells the more intense the change of the hydraulic head while the farther away from the pumping wells the gentler the change of the hydraulic head under this circumstance a locally refined sampling lrs strategy is needed to be consistent with the changes of the hydraulic head to achieve this goal we use the nodelab proposed by mishra 2019 to generate ω d see fig 2 c for an aquifer with a single well and fig 2 d for an aquifer with multiple wells 2 temporal sampling since the groundwater flow equation shown in eq 1 is time dependent in addition to the spatial sampling it is also necessary to conduct the appropriate temporal sampling and we denote 0 t d the set of sampling points in the time domain 0 t by the prior knowledge of groundwater problems we know that the change of hydraulic head will eventually become stable as time goes on regardless of the type of aquifers but whether there are pumping wells or not in the aquifer will affect the change process of hydraulic head if an aquifer without pumping wells is considered the overall change of hydraulic head during the time domain is relatively gentle and therefore we can adopt the uniform sampling with relatively large time step to obtain 0 t d as shown in fig 3 a or the lattice hypercube sampling lhs as shown in fig 3 b otherwise the hydraulic head will change dramatically in the initial stage due to the influence of the pumping wells especially near the wells to capture these changes well in addition to the locally refined spatial sampling points ω d we also conduct the same strategy in the time direction to obtain 0 t d during the initial stage as shown in fig 3 c such a locally refined sampling strategy is implemented by generating a series of subintervals with equal ratio r in 0 t 3 spatial temporal sampling in the previous two subsections we have already discussed the generation of spatial sampling points and temporal sampling points respectively then we use the spatial sampling ω d γ 1 d and γ 2 d and the temporal sampling 0 t d to produce the spatial temporal sampling point sets 10 ω d t ω d 0 t d ω d 0 ω d 0 γ 1 d t γ 1 d 0 t d γ 2 d t γ 2 d 0 t d which will be fed into our gw pinn during the training process 3 4 loss functions once the spatial temporal sampling points are obtained we need to minimize a loss function to train the neural network two types of loss functions the soft constraint and the hard constraint are both investigated where the first is originated from the pioneer work pinns raissi et al 2019 and the second is inspired from sun et al 2020 1 soft constraint in this case we directly take the output of the neural network u as the hydraulic head h i e h u x y t θ and the soft constraint is expressed as 11 l θ l p d e θ i 0 2 λ i l i θ where 12a l pde θ x y t ω d 0 t d k h x y t θ μ h x y t θ t f x y t 2 12b l 0 θ x y t ω d γ 1 d γ 2 d 0 h x y t θ g 0 x y t 2 12c l 1 θ x y t γ 1 d 0 t d h x y t θ g 1 x y t 2 12d l 2 θ x y t γ 2 d 0 t d k h x y t θ n x y g 2 x y t 2 where lpde θ denotes the pointwise pde residual l 0 θ l 1 θ l 2 θ measure the initial first and second boundary errors respectively and λ0 λ1 λ2 are three hyperparameters for balancing the four terms 2 hard constraint in this case we represent the hydraulic head function h as 13 h x y t θ h x y t d x y t u x y t θ where u x y t θ is the output of the neural network h x y t is a particular function which exactly satisfies the initial condition and dirichlet boundary condition and d x y t is a function which vanishes on the initial boundary ω 0 and dirichlet boundary γ1 due to the introduction of d x y t it is easy to see that h x y t automatically satisfies the initial condition and dirichlet boundary condition and thus the loss function can be defined as 14 l θ l pde θ λ 2 l 2 θ where lpde θ and l 2 θ are defined by 12a and 12d respectively 3 construction of h x y t h x y t is a particular function which exactly satisfies the initial condition and dirichlet boundary condition simultaneously i e 15a h x y 0 g 0 x y x y ω 15b h x y t g 1 x y t x y t γ 1 0 t if the initial value and dirichlet boundary value are chosen as a constant value h x y t can also be selected as this constant otherwise h x y t can be pretrained by a simple fully connected neural network pretrained by using the initial values and dirichlet boundary values sun et al 2020 4 construction of d x y t the simplest choice of d x y t is the indicator function defined by 16 d x y t 0 x y t ω 0 γ 1 0 t 1 o t h e r w i s e but it is not smooth and inappropriate to the network based method alternatively we can choose d x y t as the distance function from the point x y t to the initial boundary ω 0 and dirichlet boundary γ1 tmin tmax i e 17 d x y t m i n x y t ω 0 γ 1 0 t x x 2 y y 2 t t 2 if the domain is regular the function d x y t may be constructed explicitly for example let ω xmin xmax ymin ymax with dirichlet boundary γ1 x y x xmin or xmax and initial boundary ω0 x y t t 0 the function d can be expressed as 18 d x y t y y m i n y m a x y t y m a x y m i n 2 t for a complex domain ω we can pretrain a simple fully connected neural network d x y t by minimizing the following loss function 19 l d d ψ x y t ω d t m i n t m a x d d x y t ψ d x y t 2 where ψ represents the trainable parameters for this network and d x y t can be precomputed using a certain distance function 3 5 training strategy we can easily get the uniform spatial temporal sampling points for aquifer without pumping wells in this case it is not necessary to use too much sampling points which makes the training of the neural network relatively easy therefore we here mainly focus on the training strategy for the aquifer with pumping wells based on the above discussion the change process of hydraulic head in this case can be divided into two stages as the initial stage with drastic change of hydraulic head and the second stage with relatively small change of hydraulic head precisely we divide the time domain 0 t into two subintervals 0 τ and τ t where τ is the watershed of the two stages which needs to be adjusted empirically or manually we will train two different networks in two stages in a snowball way i e the first network is trained in the initial stage 0 τ and once it is trained well we use the prediction value of hydraulic head at t τ as the initial value of the second stage and continue to train the second network to express this idea more clearly we illustrate the two stage training strategy in fig 4 4 testing cases and model evaluation indices to demonstrate the performance of the proposed gw pinn for simulating the groundwater problems with different types of aquifer five test cases are investigated including confined unconfined aquifer containing pumping wells confined aquifer containing multiple pumping wells and unconfined aquifer with two parallel canals the details of the test cases and the corresponding evaluation criteria are introduced below 4 1 case 1 two parallel canals in this test we consider a homogeneous isotropic unconfined aquifer with two canals lying parallel each side with a distance of 40 m in addition we set the length of the y direction as 10 m which forms the simulated domain ω 20 20 0 10 m the saturated hydraulic conductivity in both x and y directions are k s x k s y 0 5 m d the specified yield of unconfined aquifer is μ 0 1 and the thickness of the aquifer is 5 m the left and right boundaries are the canals whose water surface height are always 2 m the upper boundary is recharged by uniform precipitation whose density is 0 002 m d that is to say the source sink term in eq 5 contains only the precipitation term i e f p the details of problem settings are demonstrated in fig 5 in this case the steady solution of the hydraulic head can be expressed analytically as 20 h x 4 p k s 400 x 2 where ks k s x k s y 4 2 case 2 single pumping well of the confined aquifer in this test we consider the confined aquifer containing a single pumping well nw 1 in source sink term which is located at the center of the spatial domain ω 500 500 500 500 m and has the pumping flow q 1 10000 t d we specify the south and north boundaries as the dirichlet boundaries with constant hydraulic head i e g 1 x y t 100 m on γ1 0 t with γ1 x y y 500 m and the east and west boundaries as the non flux boundaries i e g 2 x y t 0 on γ2 0 t with γ2 x y x 500 m moreover we set the initial condition as g 0 x y t 100 m on ω 0 the remaining relevant parameters are specified as m 3 m μ s 10 3 m 1 k s x k s y 33 33 m d the details of problem settings are demonstrated in fig 6 4 3 case 3 confined aquifer containing multiple pumping wells in this test we consider the isotropic confined aquifer containing multiple pumping wells assume that four pumping wells nw 4 are located at x 1 250 250 m x 2 250 250 m x 3 250 250 m x 4 250 250 m and each well has the pumping flow qi 2500 t d i 1 2 3 4 the other settings including the geometry and property of aquifer as well as the initial and boundary conditions are the same as that of the previous case in 4 2 the details of problem settings are demonstrated in fig 7 4 4 case 4 unconfined aquifer containing a single pumping well this test case is designed to demonstrate the accuracy of gw pinn in the unconfined aquifer in this case we investigate a square homogeneous isotropic unconfined aquifer with side length of 1000 m the specific yield of the unconfined aquifer is set as μ d 0 1 and the saturated hydraulic conductivity is set as k s x k s y 33 33 m d the left and right sides are specified as non flux boundaries i e g 2 x y t 0 and the upper and lower sides are assumed to be constant head boundaries with g 1 x y t 90 m the initial hydraulic head in the simulation region is set to be constant everywhere with g 0 x y 90 m suppose that a pumping well is located in the center of the region with pumping flow q 1 40000 t d the well start pumping at the 0 th day and last to the 20 th day the problem settings are illustrated in fig 8 4 5 case 5 confined aquifer with the l shape domain containing a single pumping well this test case is designed to demonstrate the accuracy of gw pinn for irregular domain in this test we consider the confined aquifer with the l shape domain containing a single pumping well nw 1 in source sink term which is located at 250 250 m and has the pumping flow q 1 2000 t d the shape of the domain and the boundary conditions are shown in fig 9 we set the dirichlet boundaries with a constant hydraulic head 100 m and others as the non flux boundaries the initial condition of the whole domain was set as 100 m the remaining relevant parameters are specified as m 3 m μ s 10 3 m 1 k s x k s y 33 33 m d 4 6 model evaluation indices the simulation results of modflow or the analytical solution are used as reference results to evaluate the performance of gw pinn two evaluation indices including the mean absolute error mae and the relative root mean square error rrmse are used to evaluate the errors between gw pinn and reference results from modflow or the analytic solution as follows 21 m a e 1 n i 1 h i h i 22 r r m s e i 1 n h i h i 2 n 1 n i 1 n h i 2 where hi is the simulated value predicted by gw pinn h i is the simulated value of modflow or the analytic solution n is the sample number the mae value close to 0 and the rrmse value close to 0 show the accuracy of the model for each case eight observation points were set to calculate the evaluation indices the coordinates of observation points for different cases are shown in table 1 and also in figs 6 9 the overall errors of all points for cases 2 5 are also calculated 5 experimental results all the experiments are conducted by a single nvidia 2080ti gpu with pytorch 1 1 0 the simulation results of all test cases will be compared with those produced by the well known software modflow except the two parallel canals test case which has the analytical solution we always use 4 hidden layers i e d 4 and 40 neurons per each hidden layer i e nk 4 for our gw pinn except stated otherwise and the activation function is chosen as the sin function the network is trained using adam optimizer with 2000 epochs followed by lbfgs optimizer with 1000 epochs and the training process terminates when the absolute difference between the loss values of two adjacent iteration steps is less than a certain threshold value ε we choose ε 10 8 in addition the parameter s in eq 9 is selected as 30 it should be noted that the architecture of gw pinn including the number of hidden layers and neurons per each hidden layer is determined in an empirical way the training points x y t are generated by locally refined spatial sampling and uniform or quasi uniform temporal sampling and in the validation or test phase we generate the input data by uniform sampling for more convenient of visualization 5 1 ablation study in this subsection we investigate the effect of the loss function the spatial temporal sampling strategy and the training strategy on the proposed gw pinn 5 1 1 effect of loss function as mentioned earlier in section 3 4 we may use two types of loss function the soft constraint vs the hard constraint to train gw pinn here we study and compare their performance on the training process 1 learning test case 1 using the soft constraint and the hard constraint we first test an unconfined aquifer containing two parallel canals the detail of problem settings has been described in test case 1 in this case no pumping well is considered in the source term eq 5 which makes the change of hydraulic head keeps relatively gentle during the whole evolution process therefore we generate the spatial temporal sampling points using lhs as the spatial sampling strategy shown in fig 2 b and us as the temporal sampling strategy shown in fig 3 a the 3d surface of predicted values of hydraulic head by our gw pinn at t 1 15 30 45 days are presented in fig 10 from which we see that numerical performances of the two loss functions are very different it is observed that the use of soft constraint fails to train gw pinn successfully and almost nothing is learned in this case while the use of hard constraint is able to train gw pinn very well and nice prediction is obtained in this case in addition we find from fig 10 b 1 due to the amount of precipitation the hydraulic head of the entire surface shows a rising trend 2 since the hydraulic head are set to be constant on the west and east boundaries the closer to the center of the area the faster the hydraulic head rises 3 the rise of the hydraulic head tends to slow down and remains nearly stable after 45 days due to the volume of water discharged by the canals begins to cover the volume of water recharged by precipitation the prediction results are well consistent with the hydrological change process under this case further results of quantitative analysis are shown in fig 11 where the predictions by our gw pinn with the hard constraint at different time stamps are shown and compared against the analytical steady state solution where the mae is 0 010 m and the corresponding rrmse is 0 449 indicating the good performance of the hard constraint in this case 2 learning test case 2 using the soft constraint and the hard constraint we next test a confined aquifer containing a single pumping well and the detailed problem settings are described in test case 2 for simplicity only the initial stage is considered by setting τ 1 in the snowball style two stage training strategy discussed in section 3 5 in this case a pumping well is located at the center of the spatial domain which makes the hydraulic head change dramatically near the pumping well and become slow gradually far away from it during the whole evolution process therefore we recommend spatial temporal sampling points be generated by using lrs for spatial sampling and lhs for temporal sampling where the spatial sampling points ω d 1250 are shown in fig 2 a and the temporal sampling points 0 τ d 50 shown in fig 3 b the 3d surfaces of predicted values of hydraulic head by our gw pinn with the soft constraint or hard constraint at 0 25 0 5 0 75 and 1 days in the initial stage are presented in fig 12 we observe that the similar phenomenon as the previous test the soft constraint again fails to train gw pinn while the hard constraint is very suitable to train gw pinn and produces excellent prediction it is worth noting that the predictions of gw pinn are very close to those computed by modflow as demonstrated by the contour maps given in fig 13 5 1 2 effect of the sampling strategy the training quality of gw pinn depends heavily on the training set which makes it necessary to choose an effective sampling strategy for spatial temporal points as discussed in section 3 3 if there is no pumping well in the aquifer the sampling method is relatively easy and the uniform or quasi uniform spatial temporal strategy can perform well however if the pumping wells are included in the aquifer an appropriate spatial temporal sampling strategy becomes important here we mainly focus on the effect of different sampling strategies on the latter situation 1 spatial sampling after 50 temporal sampling points are generated by using lhs we take three different type of spatial sampling strategies including us lhs and lrs to show their effects on the training of our gw pinn in the initial stage of test case 2 note that the results for test case 2 predicted by our gw pinn using lrs as the spatial sampling strategy including 3d surface and contour map of the hydraulic head have been very satisfactory as shown in figs 12 b and 13 where the number of spatial sampling points is 1250 approximately here we first use us and lhs to generate approximately 2500 spatial sampling points respectively as shown in fig 2 a and b and combine them with the aforementioned temporal sampling points to form the spatial temporal sampling points and then feed them into gw pinn to train it the corresponding 3d surfaces of predicted hydraulic head are shown in fig 14 from which we can see that both us and lhs failed to capture the change of hydraulic head near the pumping well accurately compared to the result of fig 12 b the main reason for this phenomenon is that the main change of hydraulic head is concentrated in the vicinity of the pumping well and when us or lhs is used as spatial sampling strategy the sampling points falling in the adjacent area of the pumping well are actually not enough to make gw pinn to capture the details of the change of hydraulic head especially when the total number of spatial sampling points is not large next we use us and lhs to generate more spatial sampling points approximately 6000 to train gw pinn again the predicted results are shown in figs 15 and 16 from which we can observe that along with the increase of spatial sampling points the 3d surfaces visually seem to be greatly improved especially for lhs and close to those shown in fig 12 b however they are still inaccurate and the corresponding contour maps are far from those calculated by modflow although we have reasons to believe that with the continuous increase of spatial sampling points the prediction ability of gw pinn will be further improved there are also other troubling problems for example the sharp increase in the amount of training data will make the training of gw pinn slowly even intractable a natural solution for this issue is probably to use lrs to generate locally refined spatial sampling points as shown in fig 2 c where most of them are concentrated near the pumping well and gradually become sparse when further away from the well as can be seen from the predicted results shown in fig 12 b although the number of spatial sampling points ω d 1250 is only about a fifth of those by us and lrs ω d 6000 the predictions by our gw pinn using lrs are much more accurate in summary we recommend using the locally refined strategy for spatial sampling if the aquifer contains pumping wells otherwise uniform or quasi uniform spatial sampling strategy is apt for training the gw pinn 2 temporal sampling we continue to discuss the effect of temporal sampling strategy on the training of gw pinn by fixing the lrs as the spatial sampling strategy we use two different temporal sampling strategies including us and lrs to generate temporal sampling points as shown in fig 3 a and c where the ratio of lrs is chosen as r 1 04 here contour maps of hydraulic head predicted by gw pinn using us or lrs as temporal sampling strategy are shown in fig 17 from which we see that both temporal sampling strategies work similarly on the predictive performances of our gw pinn it can be concluded that the training of our gw pinn is insensitive to the temporal sampling strategies 5 1 3 effect of training strategy groundwater equation is a time evolution equation and it is usually necessary to carry out long term simulation for groundwater simulation a naive global way is to train gw pinn in the whole spatial temporal domain to capture the change of the hydraulic head at different levels enough temporal sampling points are needed to train gw pinn when the spatial sampling strategy is fixed the simulation results predicted by our gw pinn using the global training strategy are shown in fig 18 from which we see that although the overall trend of hydraulic head has been learned the details are not sufficiently accurate along with the increase of temporal sampling points the predictive ability of the gw pinn could be further improved on the other hand this will lead to a sharp increase of training data which make the training more difficult a better way to train the gw pinn is a snowball style shown in section 3 5 which is implemented by first dividing the temporal domain of eq 1 into two stages and then train the network in each stage in sequence see fig 4 for the details of the overall training process the advantage of such a strategy is to capture the drastic change of the hydraulic head quickly and accurately in the initial stage by using as few temporal sampling points as possible and in the following stage the change of hydraulic head becomes gradually stable which makes the training process relatively easier this can be verified by the loss curve shown in fig 19 from which we observe that the overall training cost is concentrated in the initial stage and once the network in the initial stage is trained well the training of the network in the second stage becomes very smooth where the whole loss value is maintained at a very low level it only needs about 2000 adam iterations to complete the training the simulation results predicted by our gw pinn including the 3d surfaces and contour maps at different times in the second stage are shown in fig 19 where the contour maps predicted by gw pinn are very close to those calculated by modflow furthermore we also conduct a quantitative analysis at eight observation points listed in table 1 at t 20 days and the results are reported in table 2 where the mae in test case 2 at 20 d is 0 43 m and the rrmse is only 0 59 which are clearly within the acceptable range 5 2 performance results for test cases 3 and 4 to further demonstrate the performance of our gw pinn we will test a confined aquifer containing multiple pumping wells see the problem settings for test case 3 and an unconfined aquifer containing a single pumping well see the problem settings for test case 4 based on the ablation studies we use the hard constraint as the loss function lrs strategy to generate spatial sampling points lhs strategy to generate temporal sampling points and the snowball style training two stage strategy with setting τ 1 for training in all the following numerical tests let us first consider test case 3 simulation results predicted by our gw pinn including the 3d surfaces and contour maps at different times are demonstrated in fig 21 for the initial stage and fig 22 for the second stage the corresponding quantitative evaluation results are reported in table 2 from figs 21 and 22 it is easy to find that the change process of hydraulic head in this case looks like that of case 2 but four depression funnels were formed near the four wells furthermore contour maps of hydraulic head demonstrate that the simulation results predicted by our gw pinn are very close to those calculated by modflow at different times we can see from table 2 that the mae in test case 3 at 20 days is 0 1 m and the corresponding rrmse is 0 14 where the error is within the acceptable range next we consider test case 4 which is a relatively complicated case to show the capacity of our gw pinn different from the networks setting in other cases we add one more layer in the fully connected network i e 5 hidden layers i e d 6 and 40 neurons per each hidden layer i e nk 40 for the architecture of our gw pinn it can be seen from the 3d surfaces in figs 23 and 24 that the change process of the hydraulic head in this case is similar to that of case 2 furthermore the corresponding contour maps show that the simulation results predicted by our gw pinn are very close to those calculated by modflow as reported in table 2 the mae in test case 4 at 20 days is 0 17 m and the corresponding rrmse is 0 20 the error is within the acceptable range 5 3 performance results for test case 5 with the l shape domain for test case 5 with the l shape domain simulation results predicted by our gw pinn including the 3d surfaces and contour maps at different times are demonstrated in fig 25 the corresponding quantitative evaluation results are reported in table 2 the contour maps of hydraulic head demonstrate that the simulation results predicted by our gw pinn are very close to those calculated by modflow at different times we can see from table 2 that the mae in test case 5 at 1 day is 0 052 m and the corresponding rrmse is 0 058 where the error is within the acceptable range this case demonstrates the accuracy of gw pinn for irregular domain which has possible application for real world cases with complex geometry 6 model discussion 6 1 model application as a surrogate model for parameterized groundwater flow in the previous sections we investigate gw pinn for solving different types of groundwater flow and satisfactory predicted results are obtained compared to the numerical results provided by modflow however the potential advantages of the network based method exist that it can serve as a surrogate model for solving parameterized pdes for example we reconsider case 2 by extending the fixed pumping capacity into variable ones in other words the pumping capacity in eq 5 is now a parameter in a certain range qmin qmax here we assume qmin 5000 t d and qmax 10000 t d this scenario is very useful in the agricultural water management because the relevant managers sometimes need to monitor the influence of the pumping capacity on the groundwater level to tackle this problem we can use gw pinn to solve it once and for all to this aim we need to make a slight modification on the original gw pinn that is to use x y t q instead of x y t as the input of the network the spatial temporal capacity sampling point set is generated as follows 23 ω d t q ω d 0 t d q m i n q m a x d where qmin qmax d denotes the uniform sampling points in qmin qmax the loss functions are the same as those in eq 12 to avoid the limitation of insufficient memory the mini patch training strategy is adopted and only adam optimizer is used in the whole training process once the training is finished about 200 epochs we can predict the groundwater level at arbitrary spatial and temporal points in the solution domain for any pumping capacity the corresponding predicted results are demonstrated in figs 26 29 where the pumping capacity q is chosen as 5550 6575 7810 and 8920 t d respectively it should be note that such values are not appeared in the training set qmin qmax d and the results of both 3d surfaces and contour maps are very satisfactory compared with the numerical solutions provided by modflow using very fined meshes in this case there are 1250 spatial sampling points 50 temporal sampling points and 50 points for pumping capacity with a uniform interval of 100 t d the training time is about 60 min 6 2 model advantages and disadvantages compared with current proposed machine learning methods to solve the groundwater flow equation wang et al 2020 xu et al 2021 gw pinn takes the advantage in that it can solve the groundwater flow equation containing source sink terms directly when constrained only by residual losses of pdes while no label data are needed the overall errors are fairly well table 2 showing high accuracy the input data are x y t which are unsupervised and can be obtained in a random and flexible way this is meaningful for accurately obtaining the large hydraulic gradient adjacent to the source sink terms e g wells by using the locally refined sampling strategy this sampling method is similar to those numerical models by using refined grids adjacent to wells the hard constrain is proposed in this study to keep the output being satisfied by the initial and boundary conditions which owns more appropriated physical meaning this method avoids the over fit problem encountered by those data drive machine learning methods another advantage of gw pinn is that it can be used as a surrogate model making the prediction task be easy and efficient the prediction takes ignorable computational cost with the well trained gw pinn and no simulation experience is required which is beneficial for those staff of water resources management agency no meshes are used in gw pinn while only sampling points without topological structure are used which is easy to carry out it should be noted that gw pinn is not proposed to compete with the traditional numerical methods one major limitation of these network based models including gw pinn to solve pdes is the computational cost during the training period when applying it to a real world case especially with large area domain and more complex boundary and initial conditions in view of the particularity of the point source problem the spatial locally refined sampling strategy we adopted greatly reduces the training points without affecting the final effect so as to effectively improve the training process nevertheless further studies including more effective constraints and more advanced training strategies should be investigated 7 conclusions in this paper we have proposed a deep learning method gw pinn for solving groundwater flow equations with source sink terms from a new perspective the hard constraint and spatial temporal sampling strategy as well as the training strategy are proposed and investigated through a series of ablation studies the major conclusions are as follows 1 the proposed gw pinn is valid for capturing the hydraulic head of groundwater flow especially for those with local source sink terms 2 the loss function using the hard constraint is more suitable to train gw pinn and can produce more accurate prediction than the soft constraint 3 the proposed locally refined spatial sampling lrs strategy can generate more accurate results with much fewer sampling points than the uniform sampling us strategy or lattice hypercube sampling lhs strategy 4 the temporal sampling strategy owns slight impact on the predictions of gw pinn 5 the proposed snowball style two stage training strategy is more efficient to capture the drastic change of the hydraulic head than using the global training strategy 6 gw pinn can be used as a surrogate model for parameterized groundwater flow prediction 7 future studies can focus on increasing the training efficiency to extend the application of gw pinn for more complex and larger area groundwater flow prediction credit authorship contribution statement xiaoping zhang methodology validation writing original draft yan zhu conceptualization methodology writing review editing jing wang methodology writing review editing lili ju methodology yingzhi qian writing review editing ming ye writing review editing jinzhong yang writing review editing declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments x zhang s research was partially supported by national key research and development program of china 2021yfd1900805 02 y zhu s research was partially supported by national natural science foundation of china through grants 52179041 l ju s research is partially supported by us department of energy grant de sc0022254 
141,a model describing immiscible fluid fluid displacements in partially saturated porous media is presented this is based on a phase field approach that interprets the mixture of wetting liquid water and non wetting air fluids within the pore space as a single saturating non uniform pore fluid characterized by a phase field parameter which is considered to be the saturation degree of the wetting fluid while the standard retention curve provides for the retention properties of the pore walls a cahn hilliard like double well energy is employed to describe the possible co existence of the immiscible fluid phases an enhanced description of the macroscopic surface tension between the fluid phases is obtained naturally within the phase field framework due to a regularization that depends on the spatial gradient of the water content a generalized darcy s law is used to describe dissipation due to fluid flow driven by the gradient of a generalized chemical potential thus in the context of soil hydrology this model is interpreted as an extension to the classical richards equation governing the spatio temporal evolution of the phase field parameter employing a convex concave flux function it is shown using one dimensional analysis that both imbibition and drainage fronts can be modeled in this phase field framework the non monotonicities observed in the resolved solutions are explained using a combination of asymptotic matching techniques and dynamical systems analysis keywords partial saturation imbibition drainage phase field modeling 1 introduction stability of a moving interface between two immiscible fluids of contrasting viscosities and densities is a classical problem in fluid mechanics further when a solid substrate is involved the problem becomes more complex with the addition of wettability of the solid surface with respect to the fluid combination this is almost always the case when two fluids are involved such as in the hele shaw flow and in multi phase flow in porous media such as soils being able to model the displacement of such interfaces has its uses in a myriad of applications ranging from hydrology to carbon dioxide co 2 sequestration in hydrology when water infiltrates into soil while displacing air the stability of the interface plays a consequential role in the transport of solutes and contaminants to the ground waters glass et al 1988 jarvis 2007 clothier et al 2008 in fact soil layers filter the rain waters before they reach the water table and this can be impacted negatively by the formation of preferential pathways due to unstable infiltration sequestration of co 2 is a key part of carbon capture and storage ccs as a solution to counter the mounting accumulation of atmospheric greenhouse gasses lackner 2003 torp and gale 2004 orr 2004 ajayi et al 2019 this process involves injection of compressed co 2 while displacing the resident wetting fluid usually water or oil in high permeable aquifer rock formations at suitable geological sites such as depleting oil or gas fields deep saline formations and unmineable coal seams a low permeable cap rock usually acts as a natural barrier to trap the injected co 2 any instability relative to an advancing interface within this layer leads to reduced efficiency of the operation yamabe et al 2015 zacharoudiou et al 2018 it can even pose an environmental risk if preferential paths are triggered by the fault planes in the cap rock thus providing an escape route to the rising or migrating co 2 plumes macminn et al 2010 gilfillan et al 2011 song and zhang 2013 when the resident defending fluid preferentially wets the solid substrate the displacement of it by a non wetting fluid is termed as drainage the contrary is termed imbibition when the invading fluid is wetting in both these scenarios numerous experimental campaigns have been carried out by various researchers with an intent to characterize the unstable displacement and the ensuing pattern formation one can refer to the seminal works of lenormand and his colleagues in the 1980s lenormand 1985 lenormand et al 1988 lenormand 1990 and the other researchers who followed this path see chen et al 2017 guo and aryana 2019 to name a few in more recent works such as méheust et al 2002 løvoll et al 2005 gravity has been shown to stabilize the invasion of a less dense non wetting fluid into a porous medium that is saturated with more viscous and denser wetting fluid on the contrary when a denser and more viscous wetting fluid displaces a resident non wetting fluid the viscosity contrast is not in favor of destabilization saffman and taylor 1958 homsy 1987 and gravity is expected to assist in destabilizing the flow this latter regime was the focus and a well engaged topic of research in soil hydrology since the 1970s one can look into dicarlo 2013 xiong 2014 among others for a review of gravity driven infiltration of water into soil experimental evidence in this context suggested that fingering type instabilities that occur during infiltration have a non monotonic profile along their length with their tips having higher water content compared to their tails this observation and related numerical studies nieber et al 2000 eliassi and glass 2001 have lead to the hypothesis that this non monotonicity is the cause rather than the consequence of the ensuing instability eliassi and glass 2001 this overshoot of water content has been further evidenced experimentally to be present during two dimensional bauters et al 2000 shiozawa and fujimaki 2004 and quasi one dimensional dicarlo 2004 dicarlo et al 2010 experiments with transverse domain size smaller than the finger size expected now coming to the modeling efforts the various methodologies that have been developed over the years for modeling flow in porous media can be broadly classified based on the spatial scale of the problem being tackled the pore scale network models such as the glass and yarrington 1996 glass et al 1998 hughes and blunt 2000 2001 al gharbi and blunt 2005 primkulov et al 2018 2019 and lattice boltzmann methods liu et al 2012 2014 zhao et al 2016 are interesting in studying the effect of rather intricate processes such as pore invasion flow by film and formation of capillary bridges among others also these methods were rather successful in describing regime transitions in the phase diagram lenormand 1990 classifying the morphology of the fluid displacement however these approaches tend to quickly become non viable for large scale practical applications on the other hand macroscopic scale continuum modeling has proven to be a reliable tool to model laboratory scale and field scale problems the most widely accepted continuum model for describing partially imbibed soils in hydrology is the now classical richards equation richards 1931 that is derived under various assumptions hilfer and steinle 2014 from the conservation of fluid mass and the darcy buckingham equation buckingham 1907 bear 1972 that relates the pressure gradient to the fluid flux in an unsaturated porous medium while this approach has been widely accepted it suffered criticism over the years primarily due to the rough up scaling law that is involved to model the retention effect of the pore walls on the fluids morrow 1970 secondly due to its inability to reproduce physically observed fingering phenomenon egorov et al 2003 nieber et al 2005 various proposals have been done over the years to remedy these drawbacks each one building on the existing structure of the richards equation in the current study we propose a non local extension to the richards equation which is based on a more general framework sciarra 2016 of thermodynamically consistent phase field modeling at the core of this approach is the inspiration from the now classical cahn hilliard cahn and hilliard 1958 1959 modeling of multi phase fluids involving phase segregation and diffused description of interfaces between the phases the proposed approach is analyzed in detail in one dimension portraying its ability to describe experimentally observed non monotonic profiles of saturation in gravity driven infiltration and their link to the specific form of the energy employed another significant novelty of this work is the modeling of drainage fronts besides imbibition realized in the context of continuum poromechanics without falling back on modeling hysteretic effects this is done thanks to the presence of a non local gradient energy contribution and by employing a non convex flux function that drives the flow under the influence of an imposed uniform pressure gradient or an equivalent uniform bulk force such description of flux functions driving the flow are prevalent in thin film flows bertozzi et al 1999 münch 2000 fractional flow formulations dicarlo et al 2012 hilfer and steinle 2014 among others our purpose being in formulating an enriched continuum model whose characteristic parameters could be in principle directly identified from experimental evidence no comparison has been proposed with lattice boltzmann methods or other numerical schemes based on the premise that the macroscopic behavior of a fluid is the result of the average behavior of many microscopic particles in the system the interested reader can for instance refer to chen and doolen 1998 and cited works within the one dimensional solutions and the analysis thereof sets the stage for part ii of this work where we show that two dimensional imbibition and drainage solutions are conditionally stable to transverse perturbations thus being able to generate fingering type instabilities this work is organized as follows in section 2 the richards equation is introduced along with a brief review of its drawbacks and the existing extended models then the proposed model is presented recalling from sciarra 2016 the aspects of energy contributions and its roots to fundamental principles the governing equation for saturation degree of wetting fluid is derived employing a generalized darcy s law in section 3 a one dimensional analysis is done employing a non convex flux function followed by a traveling wave analysis and numerical resolution of the one dimensional solutions the conclusions are presented in section 4 the physical dimensions of quantities are mentioned whenever relevant alongside the corresponding symbols and within square brackets m l t θ in table 1 one can find the main symbols and their nomenclature adopted in this work note that some of the physical quantities with dimensions are rendered dimensionless according to the scheme presented within 2 mathematical model the starting point of the current development is the classical poromechanical approach see coussy 2004 2010 along with an overarching assumption of a rigid hydrophilic porous skeleton whose pore spaces are filled with two fluids air and water now due to the immiscibility of the fluids involved triple lines arise at the pore scale when the air water interfaces meet the pore walls the motion of these triple lines governs the individual energy contributions of the interfaces formed among the solid wetting and non wetting fluids the essence of the current work is two fold to account for these interfacial energy contributions in a way that enriches the classical prescription allowing in particular for describing pinching and coalescence of fluid phases within the porous medium and secondly to shed light on the possibility of modeling both imbibition and drainage while adhering to the thermodynamic restrictions of a dissipative extended darcy flow 2 1 classical approach at the pore scale the menisci formed between the wetting and non wetting fluids have certain curvature depending on the surface tension between the two fluids their wettability with respect to the pore walls and the geometry of the pores the pressure difference between the two fluids that is the pore scale capillary pressure governs the volume fractions of those fluids within the pore space classical poromechanical practice involves assuming a simplistic geometry of the pore space and specifying that the work done by the pore scale capillary pressure in causing infinitesimal variation in the volume content of the wetting fluid occupying the pore is equivalent to the infinitesimal variation of interfacial energy coussy 2010 thus a continuum scale constitutive relation is determined between the interfacial energy u s w and the saturation degree of the wetting fluid s w i e the volume fraction of wetting fluid within the available pore space this relation allows at equilibrium for retention of a given volume of wetting fluid at a prescribed pressure difference between the two fluids p n w p w p c s w within a porous skeleton and so is called the retention relation or the retention curve in this sense it accounts not only for the surface tension between the two fluids but also for the retention effect provided by the pore walls due their texture the thermodynamic consistency of this approach is further corroborated by the concept of energy separation coussy 2004 wherein the bulk fluid energy density is considered apart from that of the interfaces and the overall interfacial energy density ϕ u s w is a priori accounted for in the free energy density of the porous solid 1 ψ s ψ s ϕ u s w where the lagrangian porosity of the skeleton ϕ is the ratio of porous volume in the current configuration to the total volume of the porous medium in the reference configuration ψ s and ψ s are respectively the free energy density of the porous solid in the classical approach and the free energy density of the porous skeleton such an approach allows to model ψ s as a state function accounting for the tensile effect on the pore walls due to the presence of interfaces the functional form of p c s w usually is empirical van genuchten 1980 brooks and corey 1964 in order to fit the experimental data and can generally be hysteretic it has been noted over the years that such one to one relation between capillary pressure and saturation degree is not enough to describe non local phenomena such as pinching and coalescence of fluids due to variations in capillary forces nevertheless such a treatment is still widely in use typically in soil hydrology see hilfer and steinle 2014 for instance water is considered to be in compressible and its density ρ w is assumed to be much higher compared to that of air ρ n w further the air phase is assumed continuously connected to the atmosphere leading to pressure gradients within that phase vanishing instantaneously consequently the only relevant variables are those of the water phase ρ w s w and p w such assumptions lead to the richards equation 2 ϕ s w t ϰ η w k w s w p c s w ρ w g e x 0 that governs the spatio temporal evolution of the volume content of wetting fluid ϕ s w here the acceleration due to gravity is assumed to be acting along the unit vector e x in the x direction the fluid flow encompassed within the richards equation is described by the extension of darcy flow to the unsaturated conditions the darcy buckingham equation buckingham 1907 k w s w is thus a dimensionless relative permeability function which is a non linear and typically empirical relation that modulates the flow of wetting fluid with respect to its saturation degree increasing with s w from 0 to 1 in terms of stability the works of egorov et al 2003 nieber et al 2005 revealed that the richards equations is unconditionally stable against traversal perturbations thus being unable to produce experimentally observed fingering type instabilities while various extensions have been proposed intending to remedy these inadequacies we mention here a few of them hassanizadeh and gray 1990 gray and hassanizadeh 1991 introduced the specific interfacial area a measure of the fluid interfaces as an internal state variable thus providing a corrective term to an otherwise coarsely defined retention relation p c s w as part of their hold back pile up postulate eliassi and glass 2002 drew parallels to this corrective term introducing the so called hypo diffusive term and showed eliassi and glass 2003 that if this correction results in a non monotonic retention relation then non monotonic overshoot saturation profiles are possible in gravity driven infiltration eliassi and glass 2002 also introduced a mixed relaxation term which is second order in space and first order in time as an extension to standard richards equation and interpreted this as a consequence of the rate dependent capillary pressure function introduced by majid hassanizadeh and gray 1993 egorov et al 2003 nieber et al 2005 have shown that such an extension to the richards equation can produce instabilities for non monotonic solution profiles dicarlo et al 2008 used this relaxation term to introduce regularization to the richards equation with non monotonic capillary pressure function from eliassi and glass 2003 and showed similar overshoot solutions cueto felgueroso and juanes 2009a introduced in their model a fourth order in space term as an extension to the standard richards equation producing non monotonic solution profiles and proposed a relevant heuristic scaling of the fourth order coefficient that resulted in favorable comparison with some experimental observations stability analysis cueto felgueroso and juanes 2009b of this model as well has revealed instabilities when saturation profiles are non monotonic 2 2 phase field approach more recently in the work of one of the authors sciarra 2016 a framework has been built that is thermodynamically consistent and naturally allows for modeling possible localized deformations of the porous skeleton vardoulakis et al 1978 andò et al 2012 desrues and andò 2015 and its coupling to the fluid flow concerning the fluid description while the standard retention curve describes the confining effect due to the pore walls an enhanced description of surface tension between the fluids is obtained by considering the two immiscible fluids as a single non uniform biphasic fluid in the spirit of cahn and hilliard 1958 1959 in this sense it can be viewed as a phase field approach to model multi phase fluid flow while accounting for the fact that the pore network through which the non uniform fluid is flowing provides additional interfacial energy due to the solid fluid interfaces such a description of fluids is adopted in the current study naturally within such a framework coexistence of isopotential phases is possible thanks to the van der waals like double well form of the fluid energy density this gives rise to a non monotonic effective retention curve when the confining effect given by the standard retention curve is added to it parallels may be drawn to the hypo diffusive term eliassi and glass 2002 dicarlo et al 2008 which resulted in a non monotonic retention relation but the mixed relaxation term is not employed in the current model instead as usual in cahn hilliard type phase field models lowengrub and truskinovsky 1998 jacqmin 2000 boyer and lapuerta 2006 kim 2012 coarsening of the fluid domains and pattern formation is made possible due to a non local gradient energy contribution giving rise to an extension to the richards equation which is now fourth order in space in this sense parallels may be as well drawn to the higher order model introduced by cueto felgueroso and juanes 2009a which however does not account for coexistence of isopotential phases and phase segregation due to its lack of a bulk energy contribution that has a double well structure 2 2 1 balance of mass according to this adopted framework sciarra 2016 the mixture of two immiscible fluids saturating the porous space is viewed as a single non uniform biphasic fluid occupying the full porous space this non uniform fluid further sub scripted f is furnished with an phase field order parameter s r in the spirit of cahn hilliard modeling which is an intensive scalar property distinguishing the two phases the role of phase field parameter is chosen to be played by the classical saturation degree of wetting fluid s w this puts a physically motivated restriction on the range of values this phase field parameter can take as such s r 0 1 s r 0 represents pure phase of air non wetting fluid and s r 1 represents that of water wetting fluid this allows to invoke the assumptions hilfer and steinle 2014 that lead to richards equation for an s r 0 1 a simple linear interpolation of individual densities of pure phases can be assumed for the apparent density ρ f of the non uniform fluid kim 2012 a non uniform fluid composed of in compressible water ρ w c o n s t and highly rarefied air the latter being continuously connected to the atmosphere implies that pure air phase is of infinite mobility thus any pressure differences in this phase s r 0 are instantaneously vanishing and the pressure itself equates to that of reference atmospheric pressure assumed 0 for convenience concurrently invoking an ideal gas law for air implies that its density ρ n w is negligible compared to that of water ρ w ρ n w 0 leading to 3 ρ f ρ w s r ρ n w 1 s r ρ w s r this leads to a further simplification of the lagrangian mass content of the non uniform fluid per unit volume of the porous medium m f ρ f ϕ ρ w s r ϕ following coussy 2004 the local form of the overall balance of mass of the non uniform fluid can be written as 4 ρ w ϕ s r t m 0 in the above m ml 2t 1 is the lagrangian fluid mass flow vector relative to the skeleton while we lay down in brief the thermodynamic restrictions that lead to the possible constitutive prescriptions for m we refer the reader to sciarra 2016 for a detailed treatment 2 2 2 fluid and interfacial energies since the model is based on the classical approach to poromechanics coussy 2004 2010 starting from the first and second principles of thermodynamics a free energy density of the porous solid ψ s is deduced subtracting the bulk contribution of the fluid ϕ ψ l from that of the overall porous medium 5 ψ s ψ ϕ ψ l this approach has its origins in the work biot 1972 according to which the porous solid is understood as a wetted porous skeleton with a thin layer of fluid attached to the pore walls thus accounting for the associated interfaces this allows one to model ψ s as a state function in the context of thermo poroelasticity where dissipation is only attributed to the fluid flow and thermal effects now the main difference between the classical and the current phase field approaches lies in the prescription of the interfacial energies and the ensuing concept of energy separation we start the following developments with the former in the phase field approach the fluid fluid interfaces are considered apart from those of the solid fluid interfaces this is quite natural since a non uniform fluid in the sense of cahn hilliard modeling already accounts for any interfaces forming between its constituent phases in this case air and water at an ideal contact between two such immiscible fluids the interface is sharp and an associated jump say in the phase field parameter should exist in a cahn hilliard type modeling of multi phase fluids lowengrub and truskinovsky 1998 jacqmin 2000 boyer and lapuerta 2006 kim 2012 the sharp interface is approximated by a diffused counterpart with a finite thickness ℓ across which large variations of the phase field parameter occur in this sense the current model intends to provide a smeared description of partial saturation and does not identify the position of pore scale menisci that form within the network an estimate of this intrinsic length ℓ can be obtained from physical measurements of transition lengths along the macroscopic air water interface as usual in landau and cahn hilliard models in order to be able to describe pattern formation during phase separation of the binary mixture the free energy of the non uniform fluid is defined as sum of a double well potential having isopotential minima in the pure phases and a non local gradient contribution thus for a given unit volume of porous medium in its reference configuration the free energy density of non uniform fluid saturating its pores is as follows 6 ϕ ψ f s r ϕ s r ϕ ψ l s r ψ n l ϕ s r where ψ l s r the local bulk contribution to the free energy as introduced in eq 5 is responsible for segregation and allows for coexistence of the immiscible phases a possible form allowing for such description is 7 ψ l s r c γ r s r 2 1 s r 2 which has a symmetric double well structure whose isopotential minima correspond to pure phases of air s r 0 and water s r 1 see fig 1 the characteristic radius of channels within which the fluid menisci form r is an intrinsic property of the porous skeleton and according to leverett 1941 it scales with ϰ ϕ 0 the derivative of ψ l s r w r t s r gives a chemical potential μ l s r whose negative spatial gradient is the local force that drives the distribution of the phases at equilibrium ψ n l ϕ s r is the non local gradient contribution allowing the formation of diffuse interface between the two phases and provides regularization of the non convex local energy this term is assumed to be quadratic in gradient of fluid content ϕ s r as follows 8 ψ n l ϕ s r c k 2 ϕ s r ϕ s r thus accounting not only for saturation gradients but also for gradients of porosity the magnitude of c k determines spatial influence of this non local energy the significance and choice of scaling of this term is reserved for later analysis however in case of a homogeneous evolution of s r this term vanishes on the other hand the classical capillary energy density introduced in eq 1 now a function of the phase field parameter u s r is assumed for the contribution of the solid fluid interfaces thus accounting for retention properties of the solid skeleton due to the texture of its pore walls in the current study the widely used van genuchten form van genuchten 1980 9 u s r s r 1 p c s d s 10 p c s r u s r π 0 s r s r r e s 1 s r r e s 1 m 1 1 m is assumed where π 0 scales as ρ w g ℓ c ℓ c l is the porous media counterpart of capillary length scale that relates intensity of capillary forces in the porous medium to that of gravity with such a description of interfacial energy contributions the classical energy separation eq 1 is revised to account for the non local fluid energy contribution 11 ψ s ψ s ϕ u s r ψ n l ϕ s r in this sense eq 5 now implies that the so called porous solid comprises of the skeleton with a thin layer of fluid attached to the pore walls and as well all the fluid fluid interfaces that form within the pore spaces thus using eq 5 the overall free energy density of the porous medium can be written as 12 ψ ψ s ϕ ψ l s r ϕ u s r ψ n l ϕ s r if we consider a rigid porous skeleton ϕ ϕ 0 c o n s t as done further then ψ s 0 and the contribution of the porous solid ψ s to the overall free energy of the porous medium reduces to just that of the interfaces resulting in 13 ψ ϕ ψ l s r ϕ u s r ψ n l ϕ s r 2 2 3 dissipation and generalized darcy s law in what follows the main implications of dissipation inequality in the framework of above mentioned modeling scheme are reported interested reader may find a formal deduction of them in sciarra 2016 also it is to be noted that the cahn hilliard nature of the fluid energy should imply that a suitable entropy function can be defined similar to what was done in beljadid et al 2020 and an underlying gradient flow structure can be identified cancès et al 2019 however this is beyond the scope of the current work starting from the fluid mass balance the principles of thermodynamics and the constitutive prescription of the non uniform fluid a characterization of dissipation of the overall porous medium can be obtained the primary assumption of a rigid porous skeleton a priori allows one to neglect the power of external forces acting to deform the skeleton itself and consequently any power of internal forces acting to generate solid strains so any dissipative phenomena should be restricted to the fluid flow interfacial changes and thermal effects referring to the developments in sciarra 2016 and those presented above the overall dissipation of the porous medium φ is given in the form of a clausius duhem inequality 14 φ φ s φ f φ t h 0 where φ s φ f and φ t h are the dissipations related respectively to the solid skeleton non uniform fluid flow and thermal effects whose particular expressions are given below as a general practice in poromechanics coussy 2004 these three contributions are independently assumed non negative in order to satisfy eq 14 so that 15 φ s ϕ u s r d s r d t ψ n l ϕ s r d ϕ s r d t s s d t d t d ψ s d t 0 16 φ f ψ l s r u s r ψ n l ϕ s r b f ϕ s r m ρ w 0 17 φ t h q t t 0 where b f ml 2t 2 is the bulk force acting on the fluid q mt 3 is the surface heat flux vector t θ is the absolute temperature and s s ml 1t 2 θ 1 is the entropy density of the porous solid eq 15 states that in the context of thermo poroelasticity if the skeleton is assumed to be rigid then the free energy of the skeleton must still account for the interfacial phenomenon due to variations in saturation degree and its spatial gradient in other words under isothermal conditions ψ s s r ϕ s r is a state function which in the current framework is given by eq 11 with ψ s 0 eq 17 states that heat flows from regions of higher temperature to those of lower temperature along the direction of negative gradient of the temperature under isothermal conditions as considered further this dissipative contribution is vanishing the dissipation due to fluid flow is encompassed within eq 16 in essence the generalized force coefficient of m ρ w causing the fluid flow must be related to the fluid velocity vector in such a way as to satisfy the dissipation inequality one way to achieve this which is an usual practice in poromechanics is to assume a linear relationship with a coefficient of proportionality that could depend on the intrinsic permeability of the skeleton saturation degree and dynamic viscosity of the fluid 18 m ρ w v ρ w ϰ η w k s r ψ l s r u s r ψ n l ϕ s r b f ϕ s r where v lt 1 is the fluid velocity vector this approach is equivalent to the extension of darcy s law to unsaturated flow conditions k s r is a dimensionless function that accounts for the non uniform resistance to the flow experienced by the fluid due to its non uniform nature accordingly in the pure air phase s r 0 the non uniform fluid must be infinitely mobile k s r 0 and when the pore network is fully saturated by water s r 1 one should recover the darcy like relation in full saturation with k s r 1 in this way eq 18 is a generalized form of the darcy s law and the classical counterpart of k s r is the relative permeability k w s w introduced in eq 2 it is to be noted that in eq 18 an isotropy of the flow within the porous medium has been assumed eq 18 and 16 imply that the fluid dissipation now reads 19 φ f η w ϰ k s r m m ρ w 2 0 this results in a restriction on the function k s r to be positive in order to ensure the positiveness of the dissipation associated to the fluid flow moreover it is worth to note at this point that there is no restriction due to thermodynamic principles on the convexity of the function k s r the particular form employed for this function in the current work is motivated further in section 3 2 2 4 towards a non uniform pore fluid looking at eq 18 in the absence of a bulk force acting on the fluid b f 0 the generalized force driving the flow is the negative spatial gradient of a chemical potential identified as 20 μ p f ψ l s r u s r ψ n l ϕ s r where a new sub script p f is introduced that represents a supposed non uniform pore fluid that is understood as a non uniform fluid as introduced in section 2 2 2 that is confined within a pore network characterized by the capillary energy u s r as usual in cahn hilliard type modeling this chemical potential μ p f can be derived as a variational derivative w r t to s r of an overall free energy of the non uniform pore fluid the density of such an overall free energy ψ p f in the current case can clearly be identified by the overall free energy density of the porous medium ψ with a rigid porous skeleton given by eq 13 21 ψ p f ψ ϕ ψ l s r ϕ u s r ψ n l ϕ s r it is worth noting that unlike ψ l s r the local part of this new energy density ψ l s r u s r has no more a symmetric double well structure between s r 0 and 1 instead the minimum associated to s r 0 no more exists and only one global minimum remains at s r 1 see fig 1 moreover depending on the relative intensities of bulk and capillary energy densities it is possible also that a minimum associated to lower s r exists but is shifted inwards of the original range of s r thus changing the corresponding local preferential states at equilibrium sciarra 2016 however these two minima would not be isopotential in both these cases when the chemical potential is non monotonic maxwell construction equal area rule can be understood as a search for the line bi tangent to this new energy density at equilibrium conditions of the non uniform pore fluid this is equivalent to construction of a linear potential due to external forces which once accounted for brings back the double well structure with two isopotential minima now these two minima both shifted inwards of original range of s r being isopotential allows for coexistence between the corresponding phases the inward shift of the minima can be understood as a correction to account for wetting properties of the skeleton at equilibrium in the case of lower minimum and as a correction to account for trapped air in the case of higher minimum shifted from s r 1 owing to this significance of physical interpretation this local contribution in eq 21 is further referred to as the effective energy density ψ e s r ψ l s r u s r of the non uniform pore fluid and its partial derivative w r t s r the effective chemical potential see fig 1 22 μ e s r ψ l s r u s r μ l s r p c s r 2 2 5 phase field governing equation with the above framework established one can obtain the spatio temporal evolution of s r and m by resolving the coupled system of partial differential equations pdes formed by the balance of mass eq 4 and the generalized darcy s law eq 18 an alternative way which renders the equations amenable for the current analysis is to resolve for the evolution of s r a fourth order pde formed by substituting eq 18 into eq 4 23 ϕ s r t ϰ η w k s r μ p f b f ϕ s r 0 in the above the expression of μ p f s r s r is given by eq 20 and ϕ ϕ 0 c o n s t in accordance with the assumption of a rigid porous skeleton in soil hydrology and various other practical applications like co 2 sequestration the bulk force acting on the fluid is due to gravity if we consider gravitational acceleration to be acting in the positive x direction then b f m f g e x ρ w s r ϕ g e x in accordance with eq 3 the structure of the above equation closely resembles that of the classical richards equation eq 2 the difference lies in the constitutive prescription that lead to the particular expression of μ p f s r s r in eq 23 compared to that of p c s w in eq 2 in what follows a more general case is considered by introducing an additional linear pressure distribution which potentially allows to describe an initial uniform background mean flow this state can then be perturbed by modifying the boundary conditions in order to investigate the evolution of either a drainage or an imbibition front thus an augmented chemical potential incorporating both the effects of initial background mean flow and of gravity forces is written as 24 μ μ p f p where the pressure distribution p λ x in the case when only gravity forces are considered p is just proportional to λ ρ w g both these scenarios may coexist in which case gravity can act to either stabilize or destabilize the motion of an air water front depending on their relative directions 2 2 6 summary of the model governing equations introducing the above mentioned augmented chemical potential μ the governing equation for s r eq 23 can be re written as follows 25 ϕ s r t ϰ λ η w k s r x ϰ η w k s r μ p f 0 with μ p f given by eq 20 and reported again below for the sake of clarity μ p f ψ l s r u s r ψ n l ϕ s r the quantity ϰ λ η w lt 1 can be identified as the magnitude of a saturated mean velocity v m in the porous medium in essence this quantity represents the intensity of advection of non uniform pore fluid in other words that of the phase field parameter s r appropriate boundary conditions will be introduced in sections 3 1 1 and 3 1 2 to close the problem 2 2 7 dimensional analysis and scaling the effective dimension of eq 25 is t 1 to render the equation dimensionless the following dimensionless variables and corresponding characteristic scaling numbers sub scripted h are introduced 26 x x x h μ p f μ p f p h μ p f r c γ t t t h t v m x h the time scale is chosen to make unity the coefficient in front of advection term t h x h v m and a particular grouping of parameters results in the dimensionless equation 27 ϕ s r t k s r x δ r c a k s r μ p f 0 the dimensionless effective chemical potential of the non uniform pore fluid μ p f along with the linear pressure contribution p can be written employing the particular expressions introduced in section 2 2 2 as 28 μ μ p f p 2 s r 1 3 s r 2 s r 2 d u s r s r r e s 1 s r r e s 1 m 1 1 m d n l ϕ s r c a δ r x the dimensionless numbers c a δ r d u and d n l are identified as follows 29 c a v m η w r 2 ϰ c γ δ r r x h d u π 0 r c γ d n l c k r c γ x h 2 π k r c γ ℓ x h 2 here c a is the capillary number signifying the competition between viscous forces and capillary forces at the air water interface δ r is the ratio of characteristic radius of porous channels to the reference length scale d u is a measure of relative strength of the coefficients of capillary interfacial energy and the air water interfacial energy and d n l is the so called cahn number signifying intensity of the gradient energy with respect to the diffusive term above in eq 29 it is shown that the expression of d n l can be recast such that the interface thickness ℓ is introduced into the equations and a free parameter π k ml 1t 2 appears this allows an input to the model from experimental measurements of observed macroscopic transition lengths further in this work the length scale x h is chosen to be the characteristic physical length of the domain under consideration these choices are shown further to produce transition lengths of order ℓ in the numerical solutions when flow is driven by gravity the full dimensionless form using eq 28 in eq 27 with the above choices of dimensionless numbers is as follows 30 ϕ s r t k s r x δ r c a k s r 2 s r 1 3 s r 2 s r 2 d u s r s r r e s 1 s r r e s 1 m 1 1 m d n l δ ϕ s r 0 it is to be noted that has been dropped in eq 30 and is done so further in this work so from this point all the variables are dimensionless unless either mentioned otherwise or referred to from earlier sections 3 one dimensional analysis in the work of saffman and taylor 1958 a fundamental study of the stability of fluid fluid interface has been done in an analogous hele shaw flow context in order to perform this an horizontal sharp interface has been assumed to separate two fluids of different viscosities moving within a hele shaw cell under the forces of gravity and pressure gradient upon this horizontal interface wave like disturbances of variable wavelengths have been assumed and their growth in time has been understood as the typical fingering instability furthermore surface tension has been shown to introduce a lower bound for the range of wavelengths of disturbances for which the interface is unstable it is the intention of this current study to characterize within the framework of the adopted model propagation of an air water interface both in the case of imbibition and in drainage and in the part ii the stability instability of these interfaces will be investigated therefore as a first step transversely homogeneous solutions of eq 30 that represent such interfaces need to be built in this section we observe that solutions assuming transverse homogeneity in y and z directions but evolving longitudinally along x coordinate are composed of similarity solutions of the one dimensional equation 31 ϕ s r t k s r x δ r c a x k s r μ e s r s r x δ r c a ϕ d n l x k s r 3 s r x 3 0 in the above the definition of effective chemical potential of non uniform pore fluid μ e s r eq 22 is invoked at larger spatial scales compared to both the length scale of the air water interface and that of diffusion the solutions of eq 31 are regularized solutions of the corresponding scalar hyperbolic conservation law lefloch 2002 in the limit of vanishing diffusion assuming such limit eq 31 simplifies as 32 ϕ s r t k s r x 0 here the function k s r plays the role of an advective flux a class of weak solutions of a riemann problem governed by eq 32 given a piece wise uniform initial condition with a jump between s and s at x 0 that represent sharp displacement of one fluid by another are piece wise uniform functions known as shocks 33 s r x t s if x c t s if x c t that move with a characteristic speed c these solutions are self similar in nature with respect to the transformation ξ x c t and propagate along the x coordinate while satisfying the rankine hugoniot jump condition 34 k s k s c ϕ s s that relates the speed of the shock wave to the uniform solution values on either side of the shock a shock is considered classical or compressive if the characteristics on either side of the shock impinge onto it this condition is given by the celebrated lax entropy condition which in the current case can be written as 35 k s ϕ c k s apart from shocks the class of smooth monotone weak solutions of the riemann problem governed by eq 32 are rarefaction waves connecting s to s these solutions are expansive and self similar with respect to the transformation ξ x t these are described by the following form 36 s r x t s if ϕ x t k s k 1 ϕ x t if t k s ϕ x t k s s if ϕ x t k s when the flux function k s r is purely convex and increasing the only possible weak solutions are either classical shocks if s s or rarefaction waves if s s and analogously for purely concave flux function lefloch 2002 in the presence of diffusion these sharp classical shock solutions satisfying eq 35 tend to be smeared up to a finite distance on the other hand for flux functions that have inflection points the structure of solutions is much more rich in the presence of higher order diffusion dispersion for instance smeared shock solutions that violate eq 35 can exist which are considered to be non classical bertozzi et al 1999 hayes and shearer 1999 the class of non classical shocks for which the characteristics on either side pass through the shock are termed under compressive dukler et al 2020 and they satisfy either of 37 k s ϕ c k s ϕ c and those for which the characteristics behind and in the front seem to expand the shock itself are termed expansion shocks el et al 2016 and they violate eq 35 as 38 k s ϕ c k s presence of these solutions and their manifestation as traveling waves in the solution structure of imbibition and drainage problems governed by eq 31 are shown in the following section further in section 3 2 the traveling wave part of these solutions are resolved in a one dimensional setting as mentioned earlier the nature of the flux function k s r has an important effect on the structure of solutions that represent air water displacements in classical partial saturation coussy 2004 the role of modulating the individual fluid velocities in space accordingly to their respective saturation degree is played by the relative permeability function in the current study we intend to use the functional form of such a relative permeability of water for the flux function owing to the phase field parameter s r of the current model being representative of the saturation degree of water typically unsaturated relative permeability functions used for various soils and fluid combinations are parametric models in order to fit experimental data especially in soil hydrology when fluid combination is water and wet air the well known van genuchten model van genuchten 1980 luckner et al 1989 is widely used which has the following form 39 k s r s r 1 1 s r a b c where a b and c are real constants obtained through fitting with experimental results as can be seen in fig 2 this functional form has the possibility to model a purely convex behavior k c s r and as well a convex concave behavior k n c s r in what follows in order to account for consolidation of the porous skeleton bear 1972 and to demonstrate in the context of the current phase field model the possibility of modeling air water displacements representing both imbibition and drainage we employ the convex concave function k s r k n c s r with a 8 0 b 2 0 and c 0 5 3 1 pde simulations in the current section we characterize the spatio temporal evolution of solutions both in imbibition and drainage scenarios to do this we choose the primary unknowns as the saturation degree s r and the regularized effective chemical potential with known spatially linear pressure contribution μ then the coupled system of equations formed by eqs 27 and 28 is resolved we acknowledge at this point that since our focus is to analyze the general structure and evolution of the solutions we have adopted a simplest numerical discretization one can definitely extend this to more sophisticated techniques of the likes of adaptive refinement martin et al 2005 boyer et al 2009 and non local operator methods ren et al 2021 spatial discretization is done employing a standard galerkin formulation and linear lagrange finite elements time discretization is done using the implicit euler scheme of first order the discrete solutions at n th time step s r n and μ n are obtained by searching in the hilbert space of admissible functions given by the cartesian product h s h μ with 40 h s s r n h 1 ω s r n s r n on ω s h μ μ n h 1 ω μ n μ n on ω μ defined over the discretized domain ω so that the ordered couple s r n μ n solve the non linear coupled variational system 41 ω q ϕ s r n s r n 1 δ t d ω ω δ r c a k s r n q μ n d ω ω n μ q δ r c a k s r n μ n n d ω n μ 0 ω s μ n μ e s r n c a δ r x d ω ω ϕ d n l s s r n d ω ω n s s ϕ d n l s r n n d ω n s 0 here q and s are test functions belonging to the hilbert space h s 0 h μ 0 of functions which vanish on ω s and ω μ where the values of s r and μ are specified respectively n is the outward unit normal vector to the boundary where it is referred to ω n μ is the part of the boundary where normal derivative of μ is specified which translates to imposing at that part of the boundary an injection or extraction velocity of the fluid with a natural form 42 v f δ r c a k s r μ ω n s is part of the boundary where normal derivative of s r is specified for one dimensional simulations the computational domain is chosen along the positive x direction such that x 0 1 the corresponding physical length l 100 m is chosen to be sufficiently large such that the limit of vanishing diffusion as discussed earlier is valid the material properties of the porous medium and the parameters of the model chosen for the purpose of demonstration are listed in table 2 which are in the range typical of silica sands saturated with air water mixture the corresponding dimensionless numbers defined in section 2 2 7 are listed in table 3 mesh convergence behavior has been tested once chosen initial and boundary conditions corresponding to an imbibition and a drainage problem which are elaborated in sections 3 1 1 and 3 1 2 to validate the numerical solution in particular successively refined discretization steps have been considered the results of this analysis are reported in appendix b 3 1 1 imbibition displacement of air by water representing imbibition can be understood as a solution which transitions from a higher degree of saturation to a lower one and moves in the direction of the lower saturation according to characteristic water retention properties of the porous skeleton see table 2 the appropriate initial condition for imbibition is set to s r 0 0 20 throughout the domain which is close to the residual saturation s r r e s and μ 0 μ p f s r 0 p for all t 0 the normal derivative of s r is set to vanish at both the boundaries x 0 and x 1 see schematic fig 3 at the left boundary an injection velocity 43 v f x 0 δ r c a k s p is imposed this has an effect of perturbing the saturation degree at the left boundary towards s s r 0 inducing imbibition while the normal derivative of μ p f vanishes the boundary at the right x 1 is drained with a dirichlet boundary condition on μ such that 44 μ x 1 μ e s r 0 p x 1 the results of simulations for various values of s and λ ρ w g are shown in fig 4 the diffused interface in the solution connecting a higher value of s r to a lower value represents the infiltration of water into a fluid poor domain under the presence of gravity acting in the positive x direction the profile within the domain of the regularized effective chemical potential μ p f follows that of the s r solution according to eq 20 with a strong gradient effect due to the interface while all the saturation profiles are non monotonic in the vicinity of s r 0 there exist overshoot and non overshoot behaviors behind the invading front the reasoning for presence or absence of such overshoots and the oscillatory behavior around s r 0 is reserved for analysis in the further sections however in all these solutions the transition from s to s r 0 seems to translate self similarly in space suggesting the presence of traveling wave type higher order approximations of shock solutions this observation is justified by a transformation into a tw coordinate ξ x c t where c is given by eq 34 with s s r 0 see fig 5 this results in the transition region of the solution to collapse into the vicinity of a single location ξ 0 the self similar shock solution eq 33 of the hyperbolic equation eq 32 as well is plotted in the same tw coordinate in fig 5 in section 3 2 1 these tw solutions are resolved and are shown to be classical or compressive in the sense of shocks 3 1 2 drainage drainage of water by air is understood as the contrary of imbibition which is a transition from lower saturation degree to higher moving in the direction of the higher saturation so the initial condition is chosen as s r 0 0 99 which is close to fully saturated condition and μ 0 μ p f s r 0 p owing to the phase field parameter s r of the current model being representative of the saturation degree of water an injection flux of the form eq 42 at the boundary would not be appropriate to induce drainage instead the initial condition is perturbed at the left boundary x 0 by imposing gradually decreasing dirichlet boundary conditions on s r and μ until the intended air saturation s r d and μ d μ e s r d are achieved within a finite time t d and then those boundary conditions are kept constant for all t t d see schematic fig 6 the boundary at x 1 is drained with a dirichlet boundary condition on μ eq 44 and the normal derivative of s r is set to vanish for all t 0 similar to the imbibition case fig 7 shows the solutions for various values of s r d and λ ρ w g we note that the solution at later times is composed of an expanding part connecting s r d to an uniform state s b which is then connected by a sharper transition to another uniform state s a s a then connects to s r 0 through a second expanding part it is interesting to observe that for all values of s r d chosen the solution settles down to the same values of s a 0 847 and s b 0 365 see fig 7 the solution μ p f has a similar structure with uniform states corresponding to μ e s a and μ e s b with a diffused transition in between akin to the imbibition case the sharper transitions between s b and s a translate self similarly in space see fig 9 b where one of the solutions from fig 7 is plotted in the tw coordinate ξ x c t where c is given by eq 34 with s s b and s s a the transition region collapses into the vicinity of ξ 0 as expected for the associated shock solution eq 33 which is also plotted the corresponding tw solutions of eq 31 will be looked for in section 3 2 2 which are shown to be non classical in the sense of shocks violating the entropy condition such that eq 38 the expanding parts of the solution in front of and behind the sharper transition do not translate in the same fashion under a transformation of variable ξ x t the part connecting s r d to s b tends to collapse into the corresponding rarefaction solution eq 36 of the hyperbolic equation eq 32 with s s r d and s s b see fig 9 c in fact the flux function is convex within the interval s s s r d s b 0 20 0 365 and since s s the rarefaction wave that is observed is expected on the other hand it can be observed that for the same transformation the part connecting s a to s r 0 does not collapse into a similarity type solution in fact the flux function is non convex within the interval s a s r 0 0 847 0 99 and so a rarefaction wave with s s a and s s r 0 is not an associated weak solution at the junction of the expanding part of the solution and the uniform state s b longitudinal oscillations are observed which seem to grow with time see fig 7 it is explained in section 3 2 2 with the help of dynamical systems analysis that these oscillations are triggered due to the nature of the equilibrium state associated to s b the growth of such oscillations with time on the other hand is justified in part ii of the current study by analyzing the linear stability of one dimensional uniform saturation states against longitudinal perturbations the overall solution structure represents a drainage scenario in which ahead of the macroscopic air water interface the air phase can start invading the pores and behind such interface there exists an uniform saturation state of the water phase corresponding to s b that is not displaced now for s r d 0 20 we vary λ see fig 8 for lower values of λ 0 5 ρ w g 1 5 ρ w g and thus of c a the solution structure is similar to that of λ ρ w g with two intermediate uniform states s a and s b appearing at later times however for relatively higher values of λ 150 ρ w g 1500 ρ w g a single uniform state s b 0 797 0 791 respectively appears which connects to the right directly to s r 0 through a sharper transition representing the air water front this intermediate state s b connects to s r d to the left through an expanding part the regularized effective chemical potential μ p f follows a similar structure in accordance with eq 20 a transformation into the tw coordinate ξ x c t where c is given by eq 34 with s s b and s s r 0 reveals the self similar nature of the sharper transition see fig 10 b in section 3 2 2 the corresponding tw solutions of eq 31 will be looked which are also non classical in the sense of shocks violating the entropy condition such that eq 37 whereas under a transformation of variable ξ x t the part connecting s r d to s b tends to collapse into the corresponding rarefaction solution eq 36 of the hyperbolic equation eq 32 with s s r d and s s b see fig 10 c 3 2 traveling wave analysis in this section we intend to resolve the tw part of the solutions observed in section 3 1 with this intent we make a transformation of the independent variables into a moving coordinate 45 s r x t s x c t s ξ x r t 0 where the tw solution s ξ and speed c are a priori not known the tw coordinate ξ is assumed to have the same speed as that of a shock representative of the transition within the solution s r x t and so the tw solution is independent of time and the transition within it is always centered at ξ 0 introducing eq 45 into eq 31 yields an ordinary differential equation ode that s ξ needs to satisfy 46 ϕ c d s d ξ d k s d ξ δ r c a d d ξ k s μ e s d s d ξ δ r c a ϕ d n l d d ξ k s d 3 s d ξ 3 0 the existence of such traveling wave type similarity solutions for eq 31 can qualitatively explain part of the complete saturation solution s r x t ranging between the two uniform states see figures in section 3 1 in other words the tw solution s ξ of eq 46 can represent a branch of the pde solution s r x t with the corresponding boundary conditions on an infinite domain 47 s ξ s d s d ξ ξ 0 s ξ s d s d ξ ξ 0 integrating eq 46 once w r t ξ using the boundary conditions at ξ and assuming higher derivatives of the solution vanish as ξ yields in a canonical form 48 d 3 s d ξ 3 c a δ r ϕ d n l k s ϕ c s s k s k s δ r c a k s μ e s d s d ξ the rankine hugoniot jump condition eq 34 for the speed c of the representative shock can be recovered by employing eq 47 as ξ since we are looking for tw solutions satisfying boundary conditions eq 47 the states s and s are two known equilibria of eq 48 in order to analyze their properties and the possibility of existence of other such equilibria it is convenient to rewrite eq 48 into a system of first order odes 49 s ξ v v ξ w w ξ c a ϕ c s s k s k s δ r ϕ d n l k s μ e s ϕ d n l v in the above sub script ξ is used to represent derivative of a variable w r t to ξ in the sense of a dynamical system with ξ playing the role of a time like independent variable the tw solutions can viewed as trajectories connecting associated equilibria s e 0 0 of such system the local stability properties of such equilibria determine the nature of the connection between them bertozzi and shearer 2000 the eigen values of a corresponding linearized system in the vicinity of an equilibrium reveals the behavior of a small perturbation to it these eigen values are the roots of the depressed cubic equation 50 β 3 μ e s e ϕ d n l β c a ϕ c k s e δ r ϕ d n l k s e 0 a detailed deduction of the above linearization is done in appendix a according to the classical cardano tartaglia formula for roots of depressed cubic equations for μ e s e 0 if the discriminant of eq 50 is negative then all three eigen values corresponding to the equilibrium are real this condition can be simplified to 51 c a ϕ d n l δ r ϕ c k s e k s e 4 27 μ e s e 3 1 2 else only one eigen value of the three is real and the other two are complex conjugates giving rise to oscillatory behavior in the vicinity of such equilibria on the other hand for a μ e s e 0 one eigen value of the three is real and other two are complex conjugates irrespective of the sign of the discriminant these relations form the basis for understanding the behavior of tw solutions in the vicinity of their respective equilibrium states s e 0 0 3 2 1 imbibition as observed in section 3 1 1 the imbibition solutions are self similar in the whole of the domain such that the uniform saturation states observed in the pde solutions correspond to the imposed boundary conditions s on the left and initial conditions s r 0 on the right hence saturation states at the boundaries of tw solutions in eq 47 are chosen as s s r 0 and s s and then the third order ode eq 48 is numerically resolved over a domain of finite physical length l 100 m that is sufficiently large in comparison to the characteristic interface thickness ℓ such that we get a satisfactory approximation of an unbounded domain within this domain the transition region from s to s would be centered at ξ 0 we discretize this domain using an uniform finite difference grid and use a second order accurate central difference scheme to approximate the derivatives in eq 47 and 48 then the solutions are obtained solving the non linear problem starting from an initial guess that is a sharp transition at ξ 0 between the intended saturation values on either side fig 11 shows these solutions and their corresponding transitions as connections on the graph of flux function k s r for various values of s and λ ρ w g the slope of these connections is the speed c of the corresponding shock that is represented by the tw solution as can be inferred from the plot the relation between characteristic speed on either side of the connection k s k s and the speed of the shock is such that these connections are representative of classical compressive shocks that satisfy the lax entropy condition eq 35 moreover similar to observations made in section 3 1 1 there exist non monotonicities of overshoot type and oscillatory type these solutions are qualitatively comparable to the results of one dimensional experiments done by dicarlo 2004 for constant rate infiltration of water into initially dry sand in those experiments while for the highest imposed flux the water saturation profile was monotonic for intermediate fluxes non monotonicities were observed which grew stronger as the flux is lowered within the intermediate range it can observed in fig 11 the same trend as in the experiments of the non monotonicities with respect to varying flux eq 43 in order to aid the analysis of the behavior in the vicinity of equilibria s 0 0 and s 0 0 these tw solutions understood as trajectories running between the equilibria are plotted see fig 12 in the phase space governed by the third order ode system eq 49 for all s the solution close to s is oscillatory however behind the front for certain values of s 0 85 0 80 there is a non oscillatory overshoot and for s 0 75 0 70 the overshoot is oscillatory as it leaves the equilibrium at s for s 0 96 there is neither an overshoot nor oscillations behind the front the oscillatory behaviors at both the equilibria can be explained analyzing the corresponding linearized eigen values for all left equilibrium states s 0 0 such that μ e s 0 results in oscillations when leaving this state as seen in the case of s 0 75 0 70 the right equilibrium state s 0 20 0 0 is such that μ e s 0 however the condition on discriminant being negative eq 51 is not satisfied for the choice of c a and d n l resulting in oscillations when arriving s 0 20 the overshoot behavior on the other hand can be explained by employing singular perturbation techniques witelski 1996 to do this we introduce a small nonzero parameter ε o ℓ x h and expand the solution using a perturbation series s ξ s 0 ξ ε s 1 ξ ε s 2 ξ which separates eq 46 into a cascade of problems each governing the solution at a particular order as ε 0 the leading order solution s 0 ξ is governed by 52 ϕ c d s 0 d ξ d k s 0 d ξ δ r c a d d ξ k s 0 μ e s 0 d s 0 d ξ 0 integrating once w r t ξ and employing boundary conditions eq 47 at ξ gives 53 ϕ c s 0 s k s 0 k s δ r c a k s 0 μ e s 0 d s 0 d ξ 0 this results in a smooth implicit solution valid outside the transition zone and so called the outer solution 54 ξ s 0 ξ m ξ m ξ d ξ s m s 0 δ r c a k s μ e s ϕ c s s k s k s d s where ξ m is a reference value chosen to be 0 0 at which an arbitrary s m s s chosen to be 0 5 occurs this implicit solution is plotted in fig 13 for values s 0 96 0 85 and s 0 20 it is clear that in both cases the solution is non monotonic in ξ for a range of s 0 within s s and thus non physical whereas the parts of the solution for s 0 within s 1 0 and s r r e s s increase monotonically with s 0 now in order to resolve the non physicality a weak solution can be constructed by traversing the non physical region with a discontinuity however this jump in the saturation degree needs to comply with a continuity in the pressure whose gradient should exist this condition can be met in the current model thanks to the double well structure of the energy density which as explained earlier gives rise to isopotential saturation states for the choice of parameters in the current study these isopotential states can be obtained as s 1 c s 2 c 0 91 0 23 using maxwell construction now exploiting the translational invariance of the implicit solution eq 54 a weak implicit solution of the following form can be built using s 1 c s 2 c 55 ξ s 0 ξ m ξ s 0 ξ s 1 c ξ ξ m ξ s 0 ξ s 2 c ξ ξ m it is to be noted that the choice of boundary conditions on saturation degree s s is independent of the isopotential saturation states determined s 1 c s 2 c thus a combination of solutions is possible and accordingly the appropriate part of the outer solution eq 54 needs to be chosen to further translate and construct the weak outer solution eq 55 for instance if s s 1 c and s s 2 c the part of outer solution ξ s 0 that is to be translated in the construction of ξ s 0 is the non monotonic part within s s see for example the case of s 0 96 in fig 13 a on the other hand if s s 1 c and s s 2 c the monotonically increasing outer solution ξ s 0 within s 1 0 is shifted to the right giving ξ s 0 ξ s 1 c and the non monotonic part within s s is shifted to the right giving ξ s 0 ξ s 2 c see the case of s 0 85 in fig 13 b the jump part of the weak implicit solutions thus constructed traversing the non physical zone can be seen as dotted vertical lines in fig 13 in this manner the presence of overshoots in the pde solutions in section 3 1 1 and in the tw solutions can be rationalized comparing the left end boundary condition of saturation with the isopotential saturation state closest to it s 1 c similarly two other combinations of solutions can be envisaged when s s 2 c which involve undershoot when connecting to equilibrium state at s on the other hand the structure of the inner transition region can be resolved by making a transformation into a stretched variable ξ ξ ξ m ε thus restricting the problem into the transition region under such transformation and further expanding the resulting solution s using a perturbation series w r t ε allows one to identify the leading order inner problem 56 μ e s 0 d s 0 d ξ ϕ d 3 s 0 d ξ 3 0 for s 0 integrating eq 56 w r t ξ using the boundary conditions that allow appropriate matching of the inner and outer solutions on one side i e s 0 s 2 c and derivatives of s 0 vanish as ξ gives the implicit inner solution 57 ξ s 0 ξ m ξ m ξ d ξ s m s 0 2 ϕ s 2 c s 0 μ e s μ e s 2 c d s 1 2 d s where ξ m 0 is a reference value where an arbitrary s m 0 5 is chosen to occur this inner solution approaches smoothly on the other side ξ to s 0 s 1 c see fig 14 thus the leading order inner solution is affected neither by the form of flux function k s nor by the boundary conditions chosen eq 47 once the implicit solutions eq 55 and 57 are determined a solution valid over the full domain can be constructed using asymptotic matching techniques with appropriate assumption on the region of overlap of those solutions one of such possible assumptions involves an uniform matching 58 s ξ s 0 ξ s 0 ξ s 1 c ξ ξ m s 0 ξ s 0 ξ s 2 c ξ ξ m in the eq 58 above s 0 ξ is the inverse mapping of ξ s 0 in eq 55 with an abuse of notation replacing ξ with ξ noting that both take values from the real number line s 0 ξ is the inverse mapping of the implicit inner solution that is scaled back from the stretched variable space ε ξ s 0 the accuracy of such solutions depends on the assumptions involved in the asymptotic matching procedure while the weak implicit outer solution eq 55 indicates whether the overshoot and undershoot behaviors are to be expected or not in the numerical solutions it is prudent to note that the integrand in eq 54 diverges to while approaching both s and s and this is irrespective of the relation between s and s i e either s s or s s thus integrating backwards from s m s s to min s s always implies ξ s 0 and integrating forwards from s m s s to max s s always implies ξ s 0 so this implicit outer solution is only representative of imbibition solutions and as such drainage solutions are not possible in the context of the leading order outer problem eq 52 as we will see further it is the second gradient term of the energy that is absent in the outer problem which is responsible for drainage solutions when k s r is non convex with respect to imbibition s represents the initial saturation condition of the porous media into which injection of fluid is done with a velocity corresponding to s of the form eq 43 fig 15 shows the effect of different initial conditions s for fixed λ ρ w g and left boundary condition s 0 85 for larger values of s the oscillatory non monotonicity ahead of the interface are stronger and more spread out along ξ whereas the overshoot behind the interface tends to reduce slightly fig 16 shows the imbibition solutions for various values of λ and for fixed boundary conditions s 0 85 s 0 20 increasing λ tends to result in a reduced spread along ξ of the non monotonicities within both behind and ahead of the interface also the strength of these non monotonicities tends to increase with λ 3 2 2 drainage contrary to the imbibition solutions in section 3 1 the drainage solutions are not self similar throughout the domain only a part of the solution seems to propagate as traveling waves with uniform intermediate saturation state s appearing for lower values of λ two intermediate states s a and s b form the traveling wave boundary conditions and for higher values of λ only one intermediate state s b connects directly to the initial condition s r 0 moreover these intermediate state s are not a priori known and hence the boundary conditions to resolve the corresponding tw solutions are not known however it has been shown numerically in the context of thin film flows that non classical under compressive shocks are unique bertozzi et al 1999 münch 2000 in the sense that they represent traveling wave type solutions between unique combination of left and right boundary conditions also in the case of lower values of λ in section 3 1 2 the intermediate states s a and s b remained unique irrespective of the changing boundary conditions taking cue from these observations in what follows we consider one of the equilibrium states in the pde solutions as a known and then we use an iterative approach to find the unknown equilibrium state employing a shooting method to integrate forward or backward in ξ the dynamical system eq 49 until the target known equilibrium state is reached to do this in the case of lower values of λ we take as input from the 1d pde results the higher equilibrium state s a 0 0 as the target and apply a small perturbation of the order 1e 6 to an initial guess of lower equilibrium state s b 0 0 0 in the direction of the eigen vector corresponding to an unstable eigen value at s b 0 0 0 then we proceed to integrate forward eq 49 using the matlab solver ode23s shampine and reichelt 1997 which is based on a modified rosenbrock method and features adaptive step size in order to provide stopping criteria for the integration and direction for the iterations we observe two qualitatively different types of trajectories starting from an s b 0 0 0 in the vicinity of lower equilibrium state obtained in the 1d pde results s b 0 0 see fig 17 a for lower values of s b 0 the trajectory reaches the target s a with a positive slope and then diverges towards full saturation for higher values of s b 0 on the other hand it reaches a local maximum missing the target and then moves to a local minimum before diverging to full saturation the required left equilibrium state would form a trajectory that reaches the target with a zero slope and curvature up to a numerical error assuming such trajectory exists for an s b 0 within the above two cases we input them as starting points of iterations in a regula falsi method galdino 2011 the stopping criteria for the iterations is chosen as a tolerance to be satisfied by the difference between the target s a and the saturation value at which a zero slope achieved this tolerance is set to 1e 8 in this work fig 17 b shows the tw solutions thus obtained for different values of λ and the lower equilibrium state s b k 0 0 associated to the last iteration for the case of higher λ where only one intermediate uniform saturation state s b was observed in the 1d pde results we follow a similar approach and stopping criteria for the iterations but with an a priori known target s r 0 0 0 0 99 0 0 again we observe two types of trajectories starting in the vicinity of equilibrium state s b 0 0 in both cases we observe an oscillatory behavior while approaching the target see fig 17 c however for lower values of s b 0 after oscillation the trajectory reaches a local minimum without traversing the target and then diverges to full saturation and for higher values of s b 0 the trajectory reaches the target s a with a negative slope and then diverges down towards residual saturation with these new stopping criteria for integration we obtain tw solutions shown in fig 17 d for different values of λ these drainage tw solutions are shown as connections on the permeability curve k s r in fig 18 the connections for lower values of λ are representative of non classical expansion shocks that violate lax entropy condition as eq 38 since these solutions are connections between two equilibria corresponding local stability properties can be analyzed in accordance with section 3 2 in the current phase field model these non classical expansion connections occur between a left equilibrium state s 0 0 which has locally one unstable real eigen value two stable complex conjugate eigen values and a right equilibrium state s 0 0 which has locally two unstable real eigen values one stable real eigen value and hence there are no oscillations observed neither when leaving the left equilibrium state along the unstable eigen vector nor when approaching the right equilibrium state along the stable eigen vector in section 3 1 2 it is observed that longitudinal oscillations appear at the junction of a rarefaction wave and the uniform intermediate saturation state associated to s b it can be inferred that these oscillations are due to the complex conjugate nature of the stable eigen pair in the vicinity of the left equilibrium state on the other hand the connections for higher values of λ violate lax entropy condition eq 35 while satisfying the first relation in eq 37 and so are representative of non classical under compressive shocks which travel faster than the characteristic speed on either side of the shock for such connections the system governed by eq 49 has a third equilibrium s e 3 0 0 such that 59 ϕ c s e 3 s k s e 3 k s 0 however the solution only represents a connection directly from s 0 0 to s 0 0 that have the same local stability properties with one unstable real eigen value two stable complex conjugate eigen values and the later are responsible for the small oscillatory non monotonicity when the solution approaches s 0 0 see inset in fig 17 d 4 conclusion in the current study we have presented a phase field model as an extension of the classical richards equation in order to address the displacement of an air water interface within a porous medium under the influence of either an imposed pressure gradient and or gravity in the framework of thermodynamically consistent phase field modeling sciarra 2016 the air water mixture in the unsaturated regime was viewed as a non uniform fluid characterized by a physically motivated phase field parameter the saturation degree of the wetting fluid water while such non uniform fluid naturally is equipped with a bulk and a non local energy contributions the confining effect due to the pore walls was assumed to be provided by the classical capillary interfacial energy the gradient of a chemical potential that is derived from the non uniform fluid energy was assumed to drive the fluid flow leading to a generalized darcy s law starting from such a constitutive assumption on the energies and dissipation due to fluid flow a conservation law has been derived for the non uniform fluid mass in a non deformable pore network an appropriate dimensional grouping has been proposed and a one dimensional analysis has been done exploiting the hyperbolic structure of the governing conservation law one dimensional pde simulations of the same have informed on the presence of similarity solutions for appropriate initial and boundary conditions in particular the part of the solution which is a similarity solution of the traveling wave type was understood as the air water displacement front as a significant novelty it has been demonstrated that both imbibition and drainage solutions are possible due to the non convexity of the proposed flux function further with an intent to analyze their linear stability the part of the solution that is a traveling wave type has been resolved by making a transformation into an appropriate moving coordinate system these solutions were analyzed by exploiting the underlying dynamical system the solutions corresponding to imbibition driven by gravity have been found to be non monotonic under certain boundary conditions and the reason for such non monotonicities has been analyzed in the current model the double well structure of the non uniform pore fluid energy has been found to cause overshoot type non monotonicities depending on the boundary conditions chosen whereas the oscillatory non monotonicities are due to the dynamical nature of the equilibria associated to the boundary conditions the solutions of imbibition under the influence of gravity have shown good qualitative agreement against one dimensional infiltration experiments with the trend of the relationship between infiltration flux and saturation degree overshoot being preserved drainage solutions connecting unknown boundary conditions as well were resolved using an iterative shooting method starting from left boundary condition taken from the pde solutions in part ii of the current study these tw solutions of both imbibition and drainage will be analyzed for their conditional stability against perturbations a linear stability analysis will be used to investigate the range of wave numbers for which such perturbations grow in time and the effect of non monotonicities within the solutions on the growth of perturbations also equipped with the knowledge on the range of unstable wave numbers two dimensional pde simulations will be done to characterize the non linear growth of initial perturbations and formation of fingering instabilities credit authorship contribution statement siddhartha h ommi conceptualization methodology formal analysis data curation writing original draft giulio sciarra conceptualization reviewing supervision panagiotis kotronis conceptualization reviewing supervision declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper appendix a linearization in the vicinity of s e 0 0 starting from the system of equations eq 49 rewritten as a 1 s ξ ξ f s ξ where s ξ s v w t and f s ξ f v g w h s v t is the associated short hand notation for the right hand side of eq 49 the system can then be expanded about an equilibrium s e ξ s e 0 0 t as a 2 s ξ ξ f s e ξ d f s e ξ ε d 2 f s e ξ ε 2 2 where d f s e ξ and d 2 f s e ξ represent the jacobian and hessian respectively of f s ξ evaluated at the equilibrium subsequently ε s ε v ε w ε t being a small perturbation in the vicinity of s e ξ allows us to ignore o ε 2 and higher order terms leaving us the linear system of equations governing ε as a 3 ε ξ d f s e ξ ε 0 1 0 0 0 1 h s s e 0 h v s e 0 0 s ε v ε w ε where a 4 h s s e 0 c a ϕ c k s e δ r ϕ d n l k s e h v s e 0 μ e s e ϕ d n l the characteristic polynomial p β whose roots are the eigen values associated with the system eq a 3 is thus given by a 5 p β det d f s e ξ β i β 3 h v s e 0 β h s s e 0 appendix b convergence properties of the one dimensional solutions in order to validate the robustness of the numerical scheme adopted to solve the one dimensional problem of sections 3 1 1 and 3 1 2 a mesh convergence analysis has been conducted for two test cases relative to the imbibition and the drainage problem as expected reducing the element size implies a decrease of the 2 norm of the difference between solutions for the saturation degree and the generalized chemical potential computed with successive mesh refinements see fig b 19 data relative to the test cases are reported in the caption of the figure 
141,a model describing immiscible fluid fluid displacements in partially saturated porous media is presented this is based on a phase field approach that interprets the mixture of wetting liquid water and non wetting air fluids within the pore space as a single saturating non uniform pore fluid characterized by a phase field parameter which is considered to be the saturation degree of the wetting fluid while the standard retention curve provides for the retention properties of the pore walls a cahn hilliard like double well energy is employed to describe the possible co existence of the immiscible fluid phases an enhanced description of the macroscopic surface tension between the fluid phases is obtained naturally within the phase field framework due to a regularization that depends on the spatial gradient of the water content a generalized darcy s law is used to describe dissipation due to fluid flow driven by the gradient of a generalized chemical potential thus in the context of soil hydrology this model is interpreted as an extension to the classical richards equation governing the spatio temporal evolution of the phase field parameter employing a convex concave flux function it is shown using one dimensional analysis that both imbibition and drainage fronts can be modeled in this phase field framework the non monotonicities observed in the resolved solutions are explained using a combination of asymptotic matching techniques and dynamical systems analysis keywords partial saturation imbibition drainage phase field modeling 1 introduction stability of a moving interface between two immiscible fluids of contrasting viscosities and densities is a classical problem in fluid mechanics further when a solid substrate is involved the problem becomes more complex with the addition of wettability of the solid surface with respect to the fluid combination this is almost always the case when two fluids are involved such as in the hele shaw flow and in multi phase flow in porous media such as soils being able to model the displacement of such interfaces has its uses in a myriad of applications ranging from hydrology to carbon dioxide co 2 sequestration in hydrology when water infiltrates into soil while displacing air the stability of the interface plays a consequential role in the transport of solutes and contaminants to the ground waters glass et al 1988 jarvis 2007 clothier et al 2008 in fact soil layers filter the rain waters before they reach the water table and this can be impacted negatively by the formation of preferential pathways due to unstable infiltration sequestration of co 2 is a key part of carbon capture and storage ccs as a solution to counter the mounting accumulation of atmospheric greenhouse gasses lackner 2003 torp and gale 2004 orr 2004 ajayi et al 2019 this process involves injection of compressed co 2 while displacing the resident wetting fluid usually water or oil in high permeable aquifer rock formations at suitable geological sites such as depleting oil or gas fields deep saline formations and unmineable coal seams a low permeable cap rock usually acts as a natural barrier to trap the injected co 2 any instability relative to an advancing interface within this layer leads to reduced efficiency of the operation yamabe et al 2015 zacharoudiou et al 2018 it can even pose an environmental risk if preferential paths are triggered by the fault planes in the cap rock thus providing an escape route to the rising or migrating co 2 plumes macminn et al 2010 gilfillan et al 2011 song and zhang 2013 when the resident defending fluid preferentially wets the solid substrate the displacement of it by a non wetting fluid is termed as drainage the contrary is termed imbibition when the invading fluid is wetting in both these scenarios numerous experimental campaigns have been carried out by various researchers with an intent to characterize the unstable displacement and the ensuing pattern formation one can refer to the seminal works of lenormand and his colleagues in the 1980s lenormand 1985 lenormand et al 1988 lenormand 1990 and the other researchers who followed this path see chen et al 2017 guo and aryana 2019 to name a few in more recent works such as méheust et al 2002 løvoll et al 2005 gravity has been shown to stabilize the invasion of a less dense non wetting fluid into a porous medium that is saturated with more viscous and denser wetting fluid on the contrary when a denser and more viscous wetting fluid displaces a resident non wetting fluid the viscosity contrast is not in favor of destabilization saffman and taylor 1958 homsy 1987 and gravity is expected to assist in destabilizing the flow this latter regime was the focus and a well engaged topic of research in soil hydrology since the 1970s one can look into dicarlo 2013 xiong 2014 among others for a review of gravity driven infiltration of water into soil experimental evidence in this context suggested that fingering type instabilities that occur during infiltration have a non monotonic profile along their length with their tips having higher water content compared to their tails this observation and related numerical studies nieber et al 2000 eliassi and glass 2001 have lead to the hypothesis that this non monotonicity is the cause rather than the consequence of the ensuing instability eliassi and glass 2001 this overshoot of water content has been further evidenced experimentally to be present during two dimensional bauters et al 2000 shiozawa and fujimaki 2004 and quasi one dimensional dicarlo 2004 dicarlo et al 2010 experiments with transverse domain size smaller than the finger size expected now coming to the modeling efforts the various methodologies that have been developed over the years for modeling flow in porous media can be broadly classified based on the spatial scale of the problem being tackled the pore scale network models such as the glass and yarrington 1996 glass et al 1998 hughes and blunt 2000 2001 al gharbi and blunt 2005 primkulov et al 2018 2019 and lattice boltzmann methods liu et al 2012 2014 zhao et al 2016 are interesting in studying the effect of rather intricate processes such as pore invasion flow by film and formation of capillary bridges among others also these methods were rather successful in describing regime transitions in the phase diagram lenormand 1990 classifying the morphology of the fluid displacement however these approaches tend to quickly become non viable for large scale practical applications on the other hand macroscopic scale continuum modeling has proven to be a reliable tool to model laboratory scale and field scale problems the most widely accepted continuum model for describing partially imbibed soils in hydrology is the now classical richards equation richards 1931 that is derived under various assumptions hilfer and steinle 2014 from the conservation of fluid mass and the darcy buckingham equation buckingham 1907 bear 1972 that relates the pressure gradient to the fluid flux in an unsaturated porous medium while this approach has been widely accepted it suffered criticism over the years primarily due to the rough up scaling law that is involved to model the retention effect of the pore walls on the fluids morrow 1970 secondly due to its inability to reproduce physically observed fingering phenomenon egorov et al 2003 nieber et al 2005 various proposals have been done over the years to remedy these drawbacks each one building on the existing structure of the richards equation in the current study we propose a non local extension to the richards equation which is based on a more general framework sciarra 2016 of thermodynamically consistent phase field modeling at the core of this approach is the inspiration from the now classical cahn hilliard cahn and hilliard 1958 1959 modeling of multi phase fluids involving phase segregation and diffused description of interfaces between the phases the proposed approach is analyzed in detail in one dimension portraying its ability to describe experimentally observed non monotonic profiles of saturation in gravity driven infiltration and their link to the specific form of the energy employed another significant novelty of this work is the modeling of drainage fronts besides imbibition realized in the context of continuum poromechanics without falling back on modeling hysteretic effects this is done thanks to the presence of a non local gradient energy contribution and by employing a non convex flux function that drives the flow under the influence of an imposed uniform pressure gradient or an equivalent uniform bulk force such description of flux functions driving the flow are prevalent in thin film flows bertozzi et al 1999 münch 2000 fractional flow formulations dicarlo et al 2012 hilfer and steinle 2014 among others our purpose being in formulating an enriched continuum model whose characteristic parameters could be in principle directly identified from experimental evidence no comparison has been proposed with lattice boltzmann methods or other numerical schemes based on the premise that the macroscopic behavior of a fluid is the result of the average behavior of many microscopic particles in the system the interested reader can for instance refer to chen and doolen 1998 and cited works within the one dimensional solutions and the analysis thereof sets the stage for part ii of this work where we show that two dimensional imbibition and drainage solutions are conditionally stable to transverse perturbations thus being able to generate fingering type instabilities this work is organized as follows in section 2 the richards equation is introduced along with a brief review of its drawbacks and the existing extended models then the proposed model is presented recalling from sciarra 2016 the aspects of energy contributions and its roots to fundamental principles the governing equation for saturation degree of wetting fluid is derived employing a generalized darcy s law in section 3 a one dimensional analysis is done employing a non convex flux function followed by a traveling wave analysis and numerical resolution of the one dimensional solutions the conclusions are presented in section 4 the physical dimensions of quantities are mentioned whenever relevant alongside the corresponding symbols and within square brackets m l t θ in table 1 one can find the main symbols and their nomenclature adopted in this work note that some of the physical quantities with dimensions are rendered dimensionless according to the scheme presented within 2 mathematical model the starting point of the current development is the classical poromechanical approach see coussy 2004 2010 along with an overarching assumption of a rigid hydrophilic porous skeleton whose pore spaces are filled with two fluids air and water now due to the immiscibility of the fluids involved triple lines arise at the pore scale when the air water interfaces meet the pore walls the motion of these triple lines governs the individual energy contributions of the interfaces formed among the solid wetting and non wetting fluids the essence of the current work is two fold to account for these interfacial energy contributions in a way that enriches the classical prescription allowing in particular for describing pinching and coalescence of fluid phases within the porous medium and secondly to shed light on the possibility of modeling both imbibition and drainage while adhering to the thermodynamic restrictions of a dissipative extended darcy flow 2 1 classical approach at the pore scale the menisci formed between the wetting and non wetting fluids have certain curvature depending on the surface tension between the two fluids their wettability with respect to the pore walls and the geometry of the pores the pressure difference between the two fluids that is the pore scale capillary pressure governs the volume fractions of those fluids within the pore space classical poromechanical practice involves assuming a simplistic geometry of the pore space and specifying that the work done by the pore scale capillary pressure in causing infinitesimal variation in the volume content of the wetting fluid occupying the pore is equivalent to the infinitesimal variation of interfacial energy coussy 2010 thus a continuum scale constitutive relation is determined between the interfacial energy u s w and the saturation degree of the wetting fluid s w i e the volume fraction of wetting fluid within the available pore space this relation allows at equilibrium for retention of a given volume of wetting fluid at a prescribed pressure difference between the two fluids p n w p w p c s w within a porous skeleton and so is called the retention relation or the retention curve in this sense it accounts not only for the surface tension between the two fluids but also for the retention effect provided by the pore walls due their texture the thermodynamic consistency of this approach is further corroborated by the concept of energy separation coussy 2004 wherein the bulk fluid energy density is considered apart from that of the interfaces and the overall interfacial energy density ϕ u s w is a priori accounted for in the free energy density of the porous solid 1 ψ s ψ s ϕ u s w where the lagrangian porosity of the skeleton ϕ is the ratio of porous volume in the current configuration to the total volume of the porous medium in the reference configuration ψ s and ψ s are respectively the free energy density of the porous solid in the classical approach and the free energy density of the porous skeleton such an approach allows to model ψ s as a state function accounting for the tensile effect on the pore walls due to the presence of interfaces the functional form of p c s w usually is empirical van genuchten 1980 brooks and corey 1964 in order to fit the experimental data and can generally be hysteretic it has been noted over the years that such one to one relation between capillary pressure and saturation degree is not enough to describe non local phenomena such as pinching and coalescence of fluids due to variations in capillary forces nevertheless such a treatment is still widely in use typically in soil hydrology see hilfer and steinle 2014 for instance water is considered to be in compressible and its density ρ w is assumed to be much higher compared to that of air ρ n w further the air phase is assumed continuously connected to the atmosphere leading to pressure gradients within that phase vanishing instantaneously consequently the only relevant variables are those of the water phase ρ w s w and p w such assumptions lead to the richards equation 2 ϕ s w t ϰ η w k w s w p c s w ρ w g e x 0 that governs the spatio temporal evolution of the volume content of wetting fluid ϕ s w here the acceleration due to gravity is assumed to be acting along the unit vector e x in the x direction the fluid flow encompassed within the richards equation is described by the extension of darcy flow to the unsaturated conditions the darcy buckingham equation buckingham 1907 k w s w is thus a dimensionless relative permeability function which is a non linear and typically empirical relation that modulates the flow of wetting fluid with respect to its saturation degree increasing with s w from 0 to 1 in terms of stability the works of egorov et al 2003 nieber et al 2005 revealed that the richards equations is unconditionally stable against traversal perturbations thus being unable to produce experimentally observed fingering type instabilities while various extensions have been proposed intending to remedy these inadequacies we mention here a few of them hassanizadeh and gray 1990 gray and hassanizadeh 1991 introduced the specific interfacial area a measure of the fluid interfaces as an internal state variable thus providing a corrective term to an otherwise coarsely defined retention relation p c s w as part of their hold back pile up postulate eliassi and glass 2002 drew parallels to this corrective term introducing the so called hypo diffusive term and showed eliassi and glass 2003 that if this correction results in a non monotonic retention relation then non monotonic overshoot saturation profiles are possible in gravity driven infiltration eliassi and glass 2002 also introduced a mixed relaxation term which is second order in space and first order in time as an extension to standard richards equation and interpreted this as a consequence of the rate dependent capillary pressure function introduced by majid hassanizadeh and gray 1993 egorov et al 2003 nieber et al 2005 have shown that such an extension to the richards equation can produce instabilities for non monotonic solution profiles dicarlo et al 2008 used this relaxation term to introduce regularization to the richards equation with non monotonic capillary pressure function from eliassi and glass 2003 and showed similar overshoot solutions cueto felgueroso and juanes 2009a introduced in their model a fourth order in space term as an extension to the standard richards equation producing non monotonic solution profiles and proposed a relevant heuristic scaling of the fourth order coefficient that resulted in favorable comparison with some experimental observations stability analysis cueto felgueroso and juanes 2009b of this model as well has revealed instabilities when saturation profiles are non monotonic 2 2 phase field approach more recently in the work of one of the authors sciarra 2016 a framework has been built that is thermodynamically consistent and naturally allows for modeling possible localized deformations of the porous skeleton vardoulakis et al 1978 andò et al 2012 desrues and andò 2015 and its coupling to the fluid flow concerning the fluid description while the standard retention curve describes the confining effect due to the pore walls an enhanced description of surface tension between the fluids is obtained by considering the two immiscible fluids as a single non uniform biphasic fluid in the spirit of cahn and hilliard 1958 1959 in this sense it can be viewed as a phase field approach to model multi phase fluid flow while accounting for the fact that the pore network through which the non uniform fluid is flowing provides additional interfacial energy due to the solid fluid interfaces such a description of fluids is adopted in the current study naturally within such a framework coexistence of isopotential phases is possible thanks to the van der waals like double well form of the fluid energy density this gives rise to a non monotonic effective retention curve when the confining effect given by the standard retention curve is added to it parallels may be drawn to the hypo diffusive term eliassi and glass 2002 dicarlo et al 2008 which resulted in a non monotonic retention relation but the mixed relaxation term is not employed in the current model instead as usual in cahn hilliard type phase field models lowengrub and truskinovsky 1998 jacqmin 2000 boyer and lapuerta 2006 kim 2012 coarsening of the fluid domains and pattern formation is made possible due to a non local gradient energy contribution giving rise to an extension to the richards equation which is now fourth order in space in this sense parallels may be as well drawn to the higher order model introduced by cueto felgueroso and juanes 2009a which however does not account for coexistence of isopotential phases and phase segregation due to its lack of a bulk energy contribution that has a double well structure 2 2 1 balance of mass according to this adopted framework sciarra 2016 the mixture of two immiscible fluids saturating the porous space is viewed as a single non uniform biphasic fluid occupying the full porous space this non uniform fluid further sub scripted f is furnished with an phase field order parameter s r in the spirit of cahn hilliard modeling which is an intensive scalar property distinguishing the two phases the role of phase field parameter is chosen to be played by the classical saturation degree of wetting fluid s w this puts a physically motivated restriction on the range of values this phase field parameter can take as such s r 0 1 s r 0 represents pure phase of air non wetting fluid and s r 1 represents that of water wetting fluid this allows to invoke the assumptions hilfer and steinle 2014 that lead to richards equation for an s r 0 1 a simple linear interpolation of individual densities of pure phases can be assumed for the apparent density ρ f of the non uniform fluid kim 2012 a non uniform fluid composed of in compressible water ρ w c o n s t and highly rarefied air the latter being continuously connected to the atmosphere implies that pure air phase is of infinite mobility thus any pressure differences in this phase s r 0 are instantaneously vanishing and the pressure itself equates to that of reference atmospheric pressure assumed 0 for convenience concurrently invoking an ideal gas law for air implies that its density ρ n w is negligible compared to that of water ρ w ρ n w 0 leading to 3 ρ f ρ w s r ρ n w 1 s r ρ w s r this leads to a further simplification of the lagrangian mass content of the non uniform fluid per unit volume of the porous medium m f ρ f ϕ ρ w s r ϕ following coussy 2004 the local form of the overall balance of mass of the non uniform fluid can be written as 4 ρ w ϕ s r t m 0 in the above m ml 2t 1 is the lagrangian fluid mass flow vector relative to the skeleton while we lay down in brief the thermodynamic restrictions that lead to the possible constitutive prescriptions for m we refer the reader to sciarra 2016 for a detailed treatment 2 2 2 fluid and interfacial energies since the model is based on the classical approach to poromechanics coussy 2004 2010 starting from the first and second principles of thermodynamics a free energy density of the porous solid ψ s is deduced subtracting the bulk contribution of the fluid ϕ ψ l from that of the overall porous medium 5 ψ s ψ ϕ ψ l this approach has its origins in the work biot 1972 according to which the porous solid is understood as a wetted porous skeleton with a thin layer of fluid attached to the pore walls thus accounting for the associated interfaces this allows one to model ψ s as a state function in the context of thermo poroelasticity where dissipation is only attributed to the fluid flow and thermal effects now the main difference between the classical and the current phase field approaches lies in the prescription of the interfacial energies and the ensuing concept of energy separation we start the following developments with the former in the phase field approach the fluid fluid interfaces are considered apart from those of the solid fluid interfaces this is quite natural since a non uniform fluid in the sense of cahn hilliard modeling already accounts for any interfaces forming between its constituent phases in this case air and water at an ideal contact between two such immiscible fluids the interface is sharp and an associated jump say in the phase field parameter should exist in a cahn hilliard type modeling of multi phase fluids lowengrub and truskinovsky 1998 jacqmin 2000 boyer and lapuerta 2006 kim 2012 the sharp interface is approximated by a diffused counterpart with a finite thickness ℓ across which large variations of the phase field parameter occur in this sense the current model intends to provide a smeared description of partial saturation and does not identify the position of pore scale menisci that form within the network an estimate of this intrinsic length ℓ can be obtained from physical measurements of transition lengths along the macroscopic air water interface as usual in landau and cahn hilliard models in order to be able to describe pattern formation during phase separation of the binary mixture the free energy of the non uniform fluid is defined as sum of a double well potential having isopotential minima in the pure phases and a non local gradient contribution thus for a given unit volume of porous medium in its reference configuration the free energy density of non uniform fluid saturating its pores is as follows 6 ϕ ψ f s r ϕ s r ϕ ψ l s r ψ n l ϕ s r where ψ l s r the local bulk contribution to the free energy as introduced in eq 5 is responsible for segregation and allows for coexistence of the immiscible phases a possible form allowing for such description is 7 ψ l s r c γ r s r 2 1 s r 2 which has a symmetric double well structure whose isopotential minima correspond to pure phases of air s r 0 and water s r 1 see fig 1 the characteristic radius of channels within which the fluid menisci form r is an intrinsic property of the porous skeleton and according to leverett 1941 it scales with ϰ ϕ 0 the derivative of ψ l s r w r t s r gives a chemical potential μ l s r whose negative spatial gradient is the local force that drives the distribution of the phases at equilibrium ψ n l ϕ s r is the non local gradient contribution allowing the formation of diffuse interface between the two phases and provides regularization of the non convex local energy this term is assumed to be quadratic in gradient of fluid content ϕ s r as follows 8 ψ n l ϕ s r c k 2 ϕ s r ϕ s r thus accounting not only for saturation gradients but also for gradients of porosity the magnitude of c k determines spatial influence of this non local energy the significance and choice of scaling of this term is reserved for later analysis however in case of a homogeneous evolution of s r this term vanishes on the other hand the classical capillary energy density introduced in eq 1 now a function of the phase field parameter u s r is assumed for the contribution of the solid fluid interfaces thus accounting for retention properties of the solid skeleton due to the texture of its pore walls in the current study the widely used van genuchten form van genuchten 1980 9 u s r s r 1 p c s d s 10 p c s r u s r π 0 s r s r r e s 1 s r r e s 1 m 1 1 m is assumed where π 0 scales as ρ w g ℓ c ℓ c l is the porous media counterpart of capillary length scale that relates intensity of capillary forces in the porous medium to that of gravity with such a description of interfacial energy contributions the classical energy separation eq 1 is revised to account for the non local fluid energy contribution 11 ψ s ψ s ϕ u s r ψ n l ϕ s r in this sense eq 5 now implies that the so called porous solid comprises of the skeleton with a thin layer of fluid attached to the pore walls and as well all the fluid fluid interfaces that form within the pore spaces thus using eq 5 the overall free energy density of the porous medium can be written as 12 ψ ψ s ϕ ψ l s r ϕ u s r ψ n l ϕ s r if we consider a rigid porous skeleton ϕ ϕ 0 c o n s t as done further then ψ s 0 and the contribution of the porous solid ψ s to the overall free energy of the porous medium reduces to just that of the interfaces resulting in 13 ψ ϕ ψ l s r ϕ u s r ψ n l ϕ s r 2 2 3 dissipation and generalized darcy s law in what follows the main implications of dissipation inequality in the framework of above mentioned modeling scheme are reported interested reader may find a formal deduction of them in sciarra 2016 also it is to be noted that the cahn hilliard nature of the fluid energy should imply that a suitable entropy function can be defined similar to what was done in beljadid et al 2020 and an underlying gradient flow structure can be identified cancès et al 2019 however this is beyond the scope of the current work starting from the fluid mass balance the principles of thermodynamics and the constitutive prescription of the non uniform fluid a characterization of dissipation of the overall porous medium can be obtained the primary assumption of a rigid porous skeleton a priori allows one to neglect the power of external forces acting to deform the skeleton itself and consequently any power of internal forces acting to generate solid strains so any dissipative phenomena should be restricted to the fluid flow interfacial changes and thermal effects referring to the developments in sciarra 2016 and those presented above the overall dissipation of the porous medium φ is given in the form of a clausius duhem inequality 14 φ φ s φ f φ t h 0 where φ s φ f and φ t h are the dissipations related respectively to the solid skeleton non uniform fluid flow and thermal effects whose particular expressions are given below as a general practice in poromechanics coussy 2004 these three contributions are independently assumed non negative in order to satisfy eq 14 so that 15 φ s ϕ u s r d s r d t ψ n l ϕ s r d ϕ s r d t s s d t d t d ψ s d t 0 16 φ f ψ l s r u s r ψ n l ϕ s r b f ϕ s r m ρ w 0 17 φ t h q t t 0 where b f ml 2t 2 is the bulk force acting on the fluid q mt 3 is the surface heat flux vector t θ is the absolute temperature and s s ml 1t 2 θ 1 is the entropy density of the porous solid eq 15 states that in the context of thermo poroelasticity if the skeleton is assumed to be rigid then the free energy of the skeleton must still account for the interfacial phenomenon due to variations in saturation degree and its spatial gradient in other words under isothermal conditions ψ s s r ϕ s r is a state function which in the current framework is given by eq 11 with ψ s 0 eq 17 states that heat flows from regions of higher temperature to those of lower temperature along the direction of negative gradient of the temperature under isothermal conditions as considered further this dissipative contribution is vanishing the dissipation due to fluid flow is encompassed within eq 16 in essence the generalized force coefficient of m ρ w causing the fluid flow must be related to the fluid velocity vector in such a way as to satisfy the dissipation inequality one way to achieve this which is an usual practice in poromechanics is to assume a linear relationship with a coefficient of proportionality that could depend on the intrinsic permeability of the skeleton saturation degree and dynamic viscosity of the fluid 18 m ρ w v ρ w ϰ η w k s r ψ l s r u s r ψ n l ϕ s r b f ϕ s r where v lt 1 is the fluid velocity vector this approach is equivalent to the extension of darcy s law to unsaturated flow conditions k s r is a dimensionless function that accounts for the non uniform resistance to the flow experienced by the fluid due to its non uniform nature accordingly in the pure air phase s r 0 the non uniform fluid must be infinitely mobile k s r 0 and when the pore network is fully saturated by water s r 1 one should recover the darcy like relation in full saturation with k s r 1 in this way eq 18 is a generalized form of the darcy s law and the classical counterpart of k s r is the relative permeability k w s w introduced in eq 2 it is to be noted that in eq 18 an isotropy of the flow within the porous medium has been assumed eq 18 and 16 imply that the fluid dissipation now reads 19 φ f η w ϰ k s r m m ρ w 2 0 this results in a restriction on the function k s r to be positive in order to ensure the positiveness of the dissipation associated to the fluid flow moreover it is worth to note at this point that there is no restriction due to thermodynamic principles on the convexity of the function k s r the particular form employed for this function in the current work is motivated further in section 3 2 2 4 towards a non uniform pore fluid looking at eq 18 in the absence of a bulk force acting on the fluid b f 0 the generalized force driving the flow is the negative spatial gradient of a chemical potential identified as 20 μ p f ψ l s r u s r ψ n l ϕ s r where a new sub script p f is introduced that represents a supposed non uniform pore fluid that is understood as a non uniform fluid as introduced in section 2 2 2 that is confined within a pore network characterized by the capillary energy u s r as usual in cahn hilliard type modeling this chemical potential μ p f can be derived as a variational derivative w r t to s r of an overall free energy of the non uniform pore fluid the density of such an overall free energy ψ p f in the current case can clearly be identified by the overall free energy density of the porous medium ψ with a rigid porous skeleton given by eq 13 21 ψ p f ψ ϕ ψ l s r ϕ u s r ψ n l ϕ s r it is worth noting that unlike ψ l s r the local part of this new energy density ψ l s r u s r has no more a symmetric double well structure between s r 0 and 1 instead the minimum associated to s r 0 no more exists and only one global minimum remains at s r 1 see fig 1 moreover depending on the relative intensities of bulk and capillary energy densities it is possible also that a minimum associated to lower s r exists but is shifted inwards of the original range of s r thus changing the corresponding local preferential states at equilibrium sciarra 2016 however these two minima would not be isopotential in both these cases when the chemical potential is non monotonic maxwell construction equal area rule can be understood as a search for the line bi tangent to this new energy density at equilibrium conditions of the non uniform pore fluid this is equivalent to construction of a linear potential due to external forces which once accounted for brings back the double well structure with two isopotential minima now these two minima both shifted inwards of original range of s r being isopotential allows for coexistence between the corresponding phases the inward shift of the minima can be understood as a correction to account for wetting properties of the skeleton at equilibrium in the case of lower minimum and as a correction to account for trapped air in the case of higher minimum shifted from s r 1 owing to this significance of physical interpretation this local contribution in eq 21 is further referred to as the effective energy density ψ e s r ψ l s r u s r of the non uniform pore fluid and its partial derivative w r t s r the effective chemical potential see fig 1 22 μ e s r ψ l s r u s r μ l s r p c s r 2 2 5 phase field governing equation with the above framework established one can obtain the spatio temporal evolution of s r and m by resolving the coupled system of partial differential equations pdes formed by the balance of mass eq 4 and the generalized darcy s law eq 18 an alternative way which renders the equations amenable for the current analysis is to resolve for the evolution of s r a fourth order pde formed by substituting eq 18 into eq 4 23 ϕ s r t ϰ η w k s r μ p f b f ϕ s r 0 in the above the expression of μ p f s r s r is given by eq 20 and ϕ ϕ 0 c o n s t in accordance with the assumption of a rigid porous skeleton in soil hydrology and various other practical applications like co 2 sequestration the bulk force acting on the fluid is due to gravity if we consider gravitational acceleration to be acting in the positive x direction then b f m f g e x ρ w s r ϕ g e x in accordance with eq 3 the structure of the above equation closely resembles that of the classical richards equation eq 2 the difference lies in the constitutive prescription that lead to the particular expression of μ p f s r s r in eq 23 compared to that of p c s w in eq 2 in what follows a more general case is considered by introducing an additional linear pressure distribution which potentially allows to describe an initial uniform background mean flow this state can then be perturbed by modifying the boundary conditions in order to investigate the evolution of either a drainage or an imbibition front thus an augmented chemical potential incorporating both the effects of initial background mean flow and of gravity forces is written as 24 μ μ p f p where the pressure distribution p λ x in the case when only gravity forces are considered p is just proportional to λ ρ w g both these scenarios may coexist in which case gravity can act to either stabilize or destabilize the motion of an air water front depending on their relative directions 2 2 6 summary of the model governing equations introducing the above mentioned augmented chemical potential μ the governing equation for s r eq 23 can be re written as follows 25 ϕ s r t ϰ λ η w k s r x ϰ η w k s r μ p f 0 with μ p f given by eq 20 and reported again below for the sake of clarity μ p f ψ l s r u s r ψ n l ϕ s r the quantity ϰ λ η w lt 1 can be identified as the magnitude of a saturated mean velocity v m in the porous medium in essence this quantity represents the intensity of advection of non uniform pore fluid in other words that of the phase field parameter s r appropriate boundary conditions will be introduced in sections 3 1 1 and 3 1 2 to close the problem 2 2 7 dimensional analysis and scaling the effective dimension of eq 25 is t 1 to render the equation dimensionless the following dimensionless variables and corresponding characteristic scaling numbers sub scripted h are introduced 26 x x x h μ p f μ p f p h μ p f r c γ t t t h t v m x h the time scale is chosen to make unity the coefficient in front of advection term t h x h v m and a particular grouping of parameters results in the dimensionless equation 27 ϕ s r t k s r x δ r c a k s r μ p f 0 the dimensionless effective chemical potential of the non uniform pore fluid μ p f along with the linear pressure contribution p can be written employing the particular expressions introduced in section 2 2 2 as 28 μ μ p f p 2 s r 1 3 s r 2 s r 2 d u s r s r r e s 1 s r r e s 1 m 1 1 m d n l ϕ s r c a δ r x the dimensionless numbers c a δ r d u and d n l are identified as follows 29 c a v m η w r 2 ϰ c γ δ r r x h d u π 0 r c γ d n l c k r c γ x h 2 π k r c γ ℓ x h 2 here c a is the capillary number signifying the competition between viscous forces and capillary forces at the air water interface δ r is the ratio of characteristic radius of porous channels to the reference length scale d u is a measure of relative strength of the coefficients of capillary interfacial energy and the air water interfacial energy and d n l is the so called cahn number signifying intensity of the gradient energy with respect to the diffusive term above in eq 29 it is shown that the expression of d n l can be recast such that the interface thickness ℓ is introduced into the equations and a free parameter π k ml 1t 2 appears this allows an input to the model from experimental measurements of observed macroscopic transition lengths further in this work the length scale x h is chosen to be the characteristic physical length of the domain under consideration these choices are shown further to produce transition lengths of order ℓ in the numerical solutions when flow is driven by gravity the full dimensionless form using eq 28 in eq 27 with the above choices of dimensionless numbers is as follows 30 ϕ s r t k s r x δ r c a k s r 2 s r 1 3 s r 2 s r 2 d u s r s r r e s 1 s r r e s 1 m 1 1 m d n l δ ϕ s r 0 it is to be noted that has been dropped in eq 30 and is done so further in this work so from this point all the variables are dimensionless unless either mentioned otherwise or referred to from earlier sections 3 one dimensional analysis in the work of saffman and taylor 1958 a fundamental study of the stability of fluid fluid interface has been done in an analogous hele shaw flow context in order to perform this an horizontal sharp interface has been assumed to separate two fluids of different viscosities moving within a hele shaw cell under the forces of gravity and pressure gradient upon this horizontal interface wave like disturbances of variable wavelengths have been assumed and their growth in time has been understood as the typical fingering instability furthermore surface tension has been shown to introduce a lower bound for the range of wavelengths of disturbances for which the interface is unstable it is the intention of this current study to characterize within the framework of the adopted model propagation of an air water interface both in the case of imbibition and in drainage and in the part ii the stability instability of these interfaces will be investigated therefore as a first step transversely homogeneous solutions of eq 30 that represent such interfaces need to be built in this section we observe that solutions assuming transverse homogeneity in y and z directions but evolving longitudinally along x coordinate are composed of similarity solutions of the one dimensional equation 31 ϕ s r t k s r x δ r c a x k s r μ e s r s r x δ r c a ϕ d n l x k s r 3 s r x 3 0 in the above the definition of effective chemical potential of non uniform pore fluid μ e s r eq 22 is invoked at larger spatial scales compared to both the length scale of the air water interface and that of diffusion the solutions of eq 31 are regularized solutions of the corresponding scalar hyperbolic conservation law lefloch 2002 in the limit of vanishing diffusion assuming such limit eq 31 simplifies as 32 ϕ s r t k s r x 0 here the function k s r plays the role of an advective flux a class of weak solutions of a riemann problem governed by eq 32 given a piece wise uniform initial condition with a jump between s and s at x 0 that represent sharp displacement of one fluid by another are piece wise uniform functions known as shocks 33 s r x t s if x c t s if x c t that move with a characteristic speed c these solutions are self similar in nature with respect to the transformation ξ x c t and propagate along the x coordinate while satisfying the rankine hugoniot jump condition 34 k s k s c ϕ s s that relates the speed of the shock wave to the uniform solution values on either side of the shock a shock is considered classical or compressive if the characteristics on either side of the shock impinge onto it this condition is given by the celebrated lax entropy condition which in the current case can be written as 35 k s ϕ c k s apart from shocks the class of smooth monotone weak solutions of the riemann problem governed by eq 32 are rarefaction waves connecting s to s these solutions are expansive and self similar with respect to the transformation ξ x t these are described by the following form 36 s r x t s if ϕ x t k s k 1 ϕ x t if t k s ϕ x t k s s if ϕ x t k s when the flux function k s r is purely convex and increasing the only possible weak solutions are either classical shocks if s s or rarefaction waves if s s and analogously for purely concave flux function lefloch 2002 in the presence of diffusion these sharp classical shock solutions satisfying eq 35 tend to be smeared up to a finite distance on the other hand for flux functions that have inflection points the structure of solutions is much more rich in the presence of higher order diffusion dispersion for instance smeared shock solutions that violate eq 35 can exist which are considered to be non classical bertozzi et al 1999 hayes and shearer 1999 the class of non classical shocks for which the characteristics on either side pass through the shock are termed under compressive dukler et al 2020 and they satisfy either of 37 k s ϕ c k s ϕ c and those for which the characteristics behind and in the front seem to expand the shock itself are termed expansion shocks el et al 2016 and they violate eq 35 as 38 k s ϕ c k s presence of these solutions and their manifestation as traveling waves in the solution structure of imbibition and drainage problems governed by eq 31 are shown in the following section further in section 3 2 the traveling wave part of these solutions are resolved in a one dimensional setting as mentioned earlier the nature of the flux function k s r has an important effect on the structure of solutions that represent air water displacements in classical partial saturation coussy 2004 the role of modulating the individual fluid velocities in space accordingly to their respective saturation degree is played by the relative permeability function in the current study we intend to use the functional form of such a relative permeability of water for the flux function owing to the phase field parameter s r of the current model being representative of the saturation degree of water typically unsaturated relative permeability functions used for various soils and fluid combinations are parametric models in order to fit experimental data especially in soil hydrology when fluid combination is water and wet air the well known van genuchten model van genuchten 1980 luckner et al 1989 is widely used which has the following form 39 k s r s r 1 1 s r a b c where a b and c are real constants obtained through fitting with experimental results as can be seen in fig 2 this functional form has the possibility to model a purely convex behavior k c s r and as well a convex concave behavior k n c s r in what follows in order to account for consolidation of the porous skeleton bear 1972 and to demonstrate in the context of the current phase field model the possibility of modeling air water displacements representing both imbibition and drainage we employ the convex concave function k s r k n c s r with a 8 0 b 2 0 and c 0 5 3 1 pde simulations in the current section we characterize the spatio temporal evolution of solutions both in imbibition and drainage scenarios to do this we choose the primary unknowns as the saturation degree s r and the regularized effective chemical potential with known spatially linear pressure contribution μ then the coupled system of equations formed by eqs 27 and 28 is resolved we acknowledge at this point that since our focus is to analyze the general structure and evolution of the solutions we have adopted a simplest numerical discretization one can definitely extend this to more sophisticated techniques of the likes of adaptive refinement martin et al 2005 boyer et al 2009 and non local operator methods ren et al 2021 spatial discretization is done employing a standard galerkin formulation and linear lagrange finite elements time discretization is done using the implicit euler scheme of first order the discrete solutions at n th time step s r n and μ n are obtained by searching in the hilbert space of admissible functions given by the cartesian product h s h μ with 40 h s s r n h 1 ω s r n s r n on ω s h μ μ n h 1 ω μ n μ n on ω μ defined over the discretized domain ω so that the ordered couple s r n μ n solve the non linear coupled variational system 41 ω q ϕ s r n s r n 1 δ t d ω ω δ r c a k s r n q μ n d ω ω n μ q δ r c a k s r n μ n n d ω n μ 0 ω s μ n μ e s r n c a δ r x d ω ω ϕ d n l s s r n d ω ω n s s ϕ d n l s r n n d ω n s 0 here q and s are test functions belonging to the hilbert space h s 0 h μ 0 of functions which vanish on ω s and ω μ where the values of s r and μ are specified respectively n is the outward unit normal vector to the boundary where it is referred to ω n μ is the part of the boundary where normal derivative of μ is specified which translates to imposing at that part of the boundary an injection or extraction velocity of the fluid with a natural form 42 v f δ r c a k s r μ ω n s is part of the boundary where normal derivative of s r is specified for one dimensional simulations the computational domain is chosen along the positive x direction such that x 0 1 the corresponding physical length l 100 m is chosen to be sufficiently large such that the limit of vanishing diffusion as discussed earlier is valid the material properties of the porous medium and the parameters of the model chosen for the purpose of demonstration are listed in table 2 which are in the range typical of silica sands saturated with air water mixture the corresponding dimensionless numbers defined in section 2 2 7 are listed in table 3 mesh convergence behavior has been tested once chosen initial and boundary conditions corresponding to an imbibition and a drainage problem which are elaborated in sections 3 1 1 and 3 1 2 to validate the numerical solution in particular successively refined discretization steps have been considered the results of this analysis are reported in appendix b 3 1 1 imbibition displacement of air by water representing imbibition can be understood as a solution which transitions from a higher degree of saturation to a lower one and moves in the direction of the lower saturation according to characteristic water retention properties of the porous skeleton see table 2 the appropriate initial condition for imbibition is set to s r 0 0 20 throughout the domain which is close to the residual saturation s r r e s and μ 0 μ p f s r 0 p for all t 0 the normal derivative of s r is set to vanish at both the boundaries x 0 and x 1 see schematic fig 3 at the left boundary an injection velocity 43 v f x 0 δ r c a k s p is imposed this has an effect of perturbing the saturation degree at the left boundary towards s s r 0 inducing imbibition while the normal derivative of μ p f vanishes the boundary at the right x 1 is drained with a dirichlet boundary condition on μ such that 44 μ x 1 μ e s r 0 p x 1 the results of simulations for various values of s and λ ρ w g are shown in fig 4 the diffused interface in the solution connecting a higher value of s r to a lower value represents the infiltration of water into a fluid poor domain under the presence of gravity acting in the positive x direction the profile within the domain of the regularized effective chemical potential μ p f follows that of the s r solution according to eq 20 with a strong gradient effect due to the interface while all the saturation profiles are non monotonic in the vicinity of s r 0 there exist overshoot and non overshoot behaviors behind the invading front the reasoning for presence or absence of such overshoots and the oscillatory behavior around s r 0 is reserved for analysis in the further sections however in all these solutions the transition from s to s r 0 seems to translate self similarly in space suggesting the presence of traveling wave type higher order approximations of shock solutions this observation is justified by a transformation into a tw coordinate ξ x c t where c is given by eq 34 with s s r 0 see fig 5 this results in the transition region of the solution to collapse into the vicinity of a single location ξ 0 the self similar shock solution eq 33 of the hyperbolic equation eq 32 as well is plotted in the same tw coordinate in fig 5 in section 3 2 1 these tw solutions are resolved and are shown to be classical or compressive in the sense of shocks 3 1 2 drainage drainage of water by air is understood as the contrary of imbibition which is a transition from lower saturation degree to higher moving in the direction of the higher saturation so the initial condition is chosen as s r 0 0 99 which is close to fully saturated condition and μ 0 μ p f s r 0 p owing to the phase field parameter s r of the current model being representative of the saturation degree of water an injection flux of the form eq 42 at the boundary would not be appropriate to induce drainage instead the initial condition is perturbed at the left boundary x 0 by imposing gradually decreasing dirichlet boundary conditions on s r and μ until the intended air saturation s r d and μ d μ e s r d are achieved within a finite time t d and then those boundary conditions are kept constant for all t t d see schematic fig 6 the boundary at x 1 is drained with a dirichlet boundary condition on μ eq 44 and the normal derivative of s r is set to vanish for all t 0 similar to the imbibition case fig 7 shows the solutions for various values of s r d and λ ρ w g we note that the solution at later times is composed of an expanding part connecting s r d to an uniform state s b which is then connected by a sharper transition to another uniform state s a s a then connects to s r 0 through a second expanding part it is interesting to observe that for all values of s r d chosen the solution settles down to the same values of s a 0 847 and s b 0 365 see fig 7 the solution μ p f has a similar structure with uniform states corresponding to μ e s a and μ e s b with a diffused transition in between akin to the imbibition case the sharper transitions between s b and s a translate self similarly in space see fig 9 b where one of the solutions from fig 7 is plotted in the tw coordinate ξ x c t where c is given by eq 34 with s s b and s s a the transition region collapses into the vicinity of ξ 0 as expected for the associated shock solution eq 33 which is also plotted the corresponding tw solutions of eq 31 will be looked for in section 3 2 2 which are shown to be non classical in the sense of shocks violating the entropy condition such that eq 38 the expanding parts of the solution in front of and behind the sharper transition do not translate in the same fashion under a transformation of variable ξ x t the part connecting s r d to s b tends to collapse into the corresponding rarefaction solution eq 36 of the hyperbolic equation eq 32 with s s r d and s s b see fig 9 c in fact the flux function is convex within the interval s s s r d s b 0 20 0 365 and since s s the rarefaction wave that is observed is expected on the other hand it can be observed that for the same transformation the part connecting s a to s r 0 does not collapse into a similarity type solution in fact the flux function is non convex within the interval s a s r 0 0 847 0 99 and so a rarefaction wave with s s a and s s r 0 is not an associated weak solution at the junction of the expanding part of the solution and the uniform state s b longitudinal oscillations are observed which seem to grow with time see fig 7 it is explained in section 3 2 2 with the help of dynamical systems analysis that these oscillations are triggered due to the nature of the equilibrium state associated to s b the growth of such oscillations with time on the other hand is justified in part ii of the current study by analyzing the linear stability of one dimensional uniform saturation states against longitudinal perturbations the overall solution structure represents a drainage scenario in which ahead of the macroscopic air water interface the air phase can start invading the pores and behind such interface there exists an uniform saturation state of the water phase corresponding to s b that is not displaced now for s r d 0 20 we vary λ see fig 8 for lower values of λ 0 5 ρ w g 1 5 ρ w g and thus of c a the solution structure is similar to that of λ ρ w g with two intermediate uniform states s a and s b appearing at later times however for relatively higher values of λ 150 ρ w g 1500 ρ w g a single uniform state s b 0 797 0 791 respectively appears which connects to the right directly to s r 0 through a sharper transition representing the air water front this intermediate state s b connects to s r d to the left through an expanding part the regularized effective chemical potential μ p f follows a similar structure in accordance with eq 20 a transformation into the tw coordinate ξ x c t where c is given by eq 34 with s s b and s s r 0 reveals the self similar nature of the sharper transition see fig 10 b in section 3 2 2 the corresponding tw solutions of eq 31 will be looked which are also non classical in the sense of shocks violating the entropy condition such that eq 37 whereas under a transformation of variable ξ x t the part connecting s r d to s b tends to collapse into the corresponding rarefaction solution eq 36 of the hyperbolic equation eq 32 with s s r d and s s b see fig 10 c 3 2 traveling wave analysis in this section we intend to resolve the tw part of the solutions observed in section 3 1 with this intent we make a transformation of the independent variables into a moving coordinate 45 s r x t s x c t s ξ x r t 0 where the tw solution s ξ and speed c are a priori not known the tw coordinate ξ is assumed to have the same speed as that of a shock representative of the transition within the solution s r x t and so the tw solution is independent of time and the transition within it is always centered at ξ 0 introducing eq 45 into eq 31 yields an ordinary differential equation ode that s ξ needs to satisfy 46 ϕ c d s d ξ d k s d ξ δ r c a d d ξ k s μ e s d s d ξ δ r c a ϕ d n l d d ξ k s d 3 s d ξ 3 0 the existence of such traveling wave type similarity solutions for eq 31 can qualitatively explain part of the complete saturation solution s r x t ranging between the two uniform states see figures in section 3 1 in other words the tw solution s ξ of eq 46 can represent a branch of the pde solution s r x t with the corresponding boundary conditions on an infinite domain 47 s ξ s d s d ξ ξ 0 s ξ s d s d ξ ξ 0 integrating eq 46 once w r t ξ using the boundary conditions at ξ and assuming higher derivatives of the solution vanish as ξ yields in a canonical form 48 d 3 s d ξ 3 c a δ r ϕ d n l k s ϕ c s s k s k s δ r c a k s μ e s d s d ξ the rankine hugoniot jump condition eq 34 for the speed c of the representative shock can be recovered by employing eq 47 as ξ since we are looking for tw solutions satisfying boundary conditions eq 47 the states s and s are two known equilibria of eq 48 in order to analyze their properties and the possibility of existence of other such equilibria it is convenient to rewrite eq 48 into a system of first order odes 49 s ξ v v ξ w w ξ c a ϕ c s s k s k s δ r ϕ d n l k s μ e s ϕ d n l v in the above sub script ξ is used to represent derivative of a variable w r t to ξ in the sense of a dynamical system with ξ playing the role of a time like independent variable the tw solutions can viewed as trajectories connecting associated equilibria s e 0 0 of such system the local stability properties of such equilibria determine the nature of the connection between them bertozzi and shearer 2000 the eigen values of a corresponding linearized system in the vicinity of an equilibrium reveals the behavior of a small perturbation to it these eigen values are the roots of the depressed cubic equation 50 β 3 μ e s e ϕ d n l β c a ϕ c k s e δ r ϕ d n l k s e 0 a detailed deduction of the above linearization is done in appendix a according to the classical cardano tartaglia formula for roots of depressed cubic equations for μ e s e 0 if the discriminant of eq 50 is negative then all three eigen values corresponding to the equilibrium are real this condition can be simplified to 51 c a ϕ d n l δ r ϕ c k s e k s e 4 27 μ e s e 3 1 2 else only one eigen value of the three is real and the other two are complex conjugates giving rise to oscillatory behavior in the vicinity of such equilibria on the other hand for a μ e s e 0 one eigen value of the three is real and other two are complex conjugates irrespective of the sign of the discriminant these relations form the basis for understanding the behavior of tw solutions in the vicinity of their respective equilibrium states s e 0 0 3 2 1 imbibition as observed in section 3 1 1 the imbibition solutions are self similar in the whole of the domain such that the uniform saturation states observed in the pde solutions correspond to the imposed boundary conditions s on the left and initial conditions s r 0 on the right hence saturation states at the boundaries of tw solutions in eq 47 are chosen as s s r 0 and s s and then the third order ode eq 48 is numerically resolved over a domain of finite physical length l 100 m that is sufficiently large in comparison to the characteristic interface thickness ℓ such that we get a satisfactory approximation of an unbounded domain within this domain the transition region from s to s would be centered at ξ 0 we discretize this domain using an uniform finite difference grid and use a second order accurate central difference scheme to approximate the derivatives in eq 47 and 48 then the solutions are obtained solving the non linear problem starting from an initial guess that is a sharp transition at ξ 0 between the intended saturation values on either side fig 11 shows these solutions and their corresponding transitions as connections on the graph of flux function k s r for various values of s and λ ρ w g the slope of these connections is the speed c of the corresponding shock that is represented by the tw solution as can be inferred from the plot the relation between characteristic speed on either side of the connection k s k s and the speed of the shock is such that these connections are representative of classical compressive shocks that satisfy the lax entropy condition eq 35 moreover similar to observations made in section 3 1 1 there exist non monotonicities of overshoot type and oscillatory type these solutions are qualitatively comparable to the results of one dimensional experiments done by dicarlo 2004 for constant rate infiltration of water into initially dry sand in those experiments while for the highest imposed flux the water saturation profile was monotonic for intermediate fluxes non monotonicities were observed which grew stronger as the flux is lowered within the intermediate range it can observed in fig 11 the same trend as in the experiments of the non monotonicities with respect to varying flux eq 43 in order to aid the analysis of the behavior in the vicinity of equilibria s 0 0 and s 0 0 these tw solutions understood as trajectories running between the equilibria are plotted see fig 12 in the phase space governed by the third order ode system eq 49 for all s the solution close to s is oscillatory however behind the front for certain values of s 0 85 0 80 there is a non oscillatory overshoot and for s 0 75 0 70 the overshoot is oscillatory as it leaves the equilibrium at s for s 0 96 there is neither an overshoot nor oscillations behind the front the oscillatory behaviors at both the equilibria can be explained analyzing the corresponding linearized eigen values for all left equilibrium states s 0 0 such that μ e s 0 results in oscillations when leaving this state as seen in the case of s 0 75 0 70 the right equilibrium state s 0 20 0 0 is such that μ e s 0 however the condition on discriminant being negative eq 51 is not satisfied for the choice of c a and d n l resulting in oscillations when arriving s 0 20 the overshoot behavior on the other hand can be explained by employing singular perturbation techniques witelski 1996 to do this we introduce a small nonzero parameter ε o ℓ x h and expand the solution using a perturbation series s ξ s 0 ξ ε s 1 ξ ε s 2 ξ which separates eq 46 into a cascade of problems each governing the solution at a particular order as ε 0 the leading order solution s 0 ξ is governed by 52 ϕ c d s 0 d ξ d k s 0 d ξ δ r c a d d ξ k s 0 μ e s 0 d s 0 d ξ 0 integrating once w r t ξ and employing boundary conditions eq 47 at ξ gives 53 ϕ c s 0 s k s 0 k s δ r c a k s 0 μ e s 0 d s 0 d ξ 0 this results in a smooth implicit solution valid outside the transition zone and so called the outer solution 54 ξ s 0 ξ m ξ m ξ d ξ s m s 0 δ r c a k s μ e s ϕ c s s k s k s d s where ξ m is a reference value chosen to be 0 0 at which an arbitrary s m s s chosen to be 0 5 occurs this implicit solution is plotted in fig 13 for values s 0 96 0 85 and s 0 20 it is clear that in both cases the solution is non monotonic in ξ for a range of s 0 within s s and thus non physical whereas the parts of the solution for s 0 within s 1 0 and s r r e s s increase monotonically with s 0 now in order to resolve the non physicality a weak solution can be constructed by traversing the non physical region with a discontinuity however this jump in the saturation degree needs to comply with a continuity in the pressure whose gradient should exist this condition can be met in the current model thanks to the double well structure of the energy density which as explained earlier gives rise to isopotential saturation states for the choice of parameters in the current study these isopotential states can be obtained as s 1 c s 2 c 0 91 0 23 using maxwell construction now exploiting the translational invariance of the implicit solution eq 54 a weak implicit solution of the following form can be built using s 1 c s 2 c 55 ξ s 0 ξ m ξ s 0 ξ s 1 c ξ ξ m ξ s 0 ξ s 2 c ξ ξ m it is to be noted that the choice of boundary conditions on saturation degree s s is independent of the isopotential saturation states determined s 1 c s 2 c thus a combination of solutions is possible and accordingly the appropriate part of the outer solution eq 54 needs to be chosen to further translate and construct the weak outer solution eq 55 for instance if s s 1 c and s s 2 c the part of outer solution ξ s 0 that is to be translated in the construction of ξ s 0 is the non monotonic part within s s see for example the case of s 0 96 in fig 13 a on the other hand if s s 1 c and s s 2 c the monotonically increasing outer solution ξ s 0 within s 1 0 is shifted to the right giving ξ s 0 ξ s 1 c and the non monotonic part within s s is shifted to the right giving ξ s 0 ξ s 2 c see the case of s 0 85 in fig 13 b the jump part of the weak implicit solutions thus constructed traversing the non physical zone can be seen as dotted vertical lines in fig 13 in this manner the presence of overshoots in the pde solutions in section 3 1 1 and in the tw solutions can be rationalized comparing the left end boundary condition of saturation with the isopotential saturation state closest to it s 1 c similarly two other combinations of solutions can be envisaged when s s 2 c which involve undershoot when connecting to equilibrium state at s on the other hand the structure of the inner transition region can be resolved by making a transformation into a stretched variable ξ ξ ξ m ε thus restricting the problem into the transition region under such transformation and further expanding the resulting solution s using a perturbation series w r t ε allows one to identify the leading order inner problem 56 μ e s 0 d s 0 d ξ ϕ d 3 s 0 d ξ 3 0 for s 0 integrating eq 56 w r t ξ using the boundary conditions that allow appropriate matching of the inner and outer solutions on one side i e s 0 s 2 c and derivatives of s 0 vanish as ξ gives the implicit inner solution 57 ξ s 0 ξ m ξ m ξ d ξ s m s 0 2 ϕ s 2 c s 0 μ e s μ e s 2 c d s 1 2 d s where ξ m 0 is a reference value where an arbitrary s m 0 5 is chosen to occur this inner solution approaches smoothly on the other side ξ to s 0 s 1 c see fig 14 thus the leading order inner solution is affected neither by the form of flux function k s nor by the boundary conditions chosen eq 47 once the implicit solutions eq 55 and 57 are determined a solution valid over the full domain can be constructed using asymptotic matching techniques with appropriate assumption on the region of overlap of those solutions one of such possible assumptions involves an uniform matching 58 s ξ s 0 ξ s 0 ξ s 1 c ξ ξ m s 0 ξ s 0 ξ s 2 c ξ ξ m in the eq 58 above s 0 ξ is the inverse mapping of ξ s 0 in eq 55 with an abuse of notation replacing ξ with ξ noting that both take values from the real number line s 0 ξ is the inverse mapping of the implicit inner solution that is scaled back from the stretched variable space ε ξ s 0 the accuracy of such solutions depends on the assumptions involved in the asymptotic matching procedure while the weak implicit outer solution eq 55 indicates whether the overshoot and undershoot behaviors are to be expected or not in the numerical solutions it is prudent to note that the integrand in eq 54 diverges to while approaching both s and s and this is irrespective of the relation between s and s i e either s s or s s thus integrating backwards from s m s s to min s s always implies ξ s 0 and integrating forwards from s m s s to max s s always implies ξ s 0 so this implicit outer solution is only representative of imbibition solutions and as such drainage solutions are not possible in the context of the leading order outer problem eq 52 as we will see further it is the second gradient term of the energy that is absent in the outer problem which is responsible for drainage solutions when k s r is non convex with respect to imbibition s represents the initial saturation condition of the porous media into which injection of fluid is done with a velocity corresponding to s of the form eq 43 fig 15 shows the effect of different initial conditions s for fixed λ ρ w g and left boundary condition s 0 85 for larger values of s the oscillatory non monotonicity ahead of the interface are stronger and more spread out along ξ whereas the overshoot behind the interface tends to reduce slightly fig 16 shows the imbibition solutions for various values of λ and for fixed boundary conditions s 0 85 s 0 20 increasing λ tends to result in a reduced spread along ξ of the non monotonicities within both behind and ahead of the interface also the strength of these non monotonicities tends to increase with λ 3 2 2 drainage contrary to the imbibition solutions in section 3 1 the drainage solutions are not self similar throughout the domain only a part of the solution seems to propagate as traveling waves with uniform intermediate saturation state s appearing for lower values of λ two intermediate states s a and s b form the traveling wave boundary conditions and for higher values of λ only one intermediate state s b connects directly to the initial condition s r 0 moreover these intermediate state s are not a priori known and hence the boundary conditions to resolve the corresponding tw solutions are not known however it has been shown numerically in the context of thin film flows that non classical under compressive shocks are unique bertozzi et al 1999 münch 2000 in the sense that they represent traveling wave type solutions between unique combination of left and right boundary conditions also in the case of lower values of λ in section 3 1 2 the intermediate states s a and s b remained unique irrespective of the changing boundary conditions taking cue from these observations in what follows we consider one of the equilibrium states in the pde solutions as a known and then we use an iterative approach to find the unknown equilibrium state employing a shooting method to integrate forward or backward in ξ the dynamical system eq 49 until the target known equilibrium state is reached to do this in the case of lower values of λ we take as input from the 1d pde results the higher equilibrium state s a 0 0 as the target and apply a small perturbation of the order 1e 6 to an initial guess of lower equilibrium state s b 0 0 0 in the direction of the eigen vector corresponding to an unstable eigen value at s b 0 0 0 then we proceed to integrate forward eq 49 using the matlab solver ode23s shampine and reichelt 1997 which is based on a modified rosenbrock method and features adaptive step size in order to provide stopping criteria for the integration and direction for the iterations we observe two qualitatively different types of trajectories starting from an s b 0 0 0 in the vicinity of lower equilibrium state obtained in the 1d pde results s b 0 0 see fig 17 a for lower values of s b 0 the trajectory reaches the target s a with a positive slope and then diverges towards full saturation for higher values of s b 0 on the other hand it reaches a local maximum missing the target and then moves to a local minimum before diverging to full saturation the required left equilibrium state would form a trajectory that reaches the target with a zero slope and curvature up to a numerical error assuming such trajectory exists for an s b 0 within the above two cases we input them as starting points of iterations in a regula falsi method galdino 2011 the stopping criteria for the iterations is chosen as a tolerance to be satisfied by the difference between the target s a and the saturation value at which a zero slope achieved this tolerance is set to 1e 8 in this work fig 17 b shows the tw solutions thus obtained for different values of λ and the lower equilibrium state s b k 0 0 associated to the last iteration for the case of higher λ where only one intermediate uniform saturation state s b was observed in the 1d pde results we follow a similar approach and stopping criteria for the iterations but with an a priori known target s r 0 0 0 0 99 0 0 again we observe two types of trajectories starting in the vicinity of equilibrium state s b 0 0 in both cases we observe an oscillatory behavior while approaching the target see fig 17 c however for lower values of s b 0 after oscillation the trajectory reaches a local minimum without traversing the target and then diverges to full saturation and for higher values of s b 0 the trajectory reaches the target s a with a negative slope and then diverges down towards residual saturation with these new stopping criteria for integration we obtain tw solutions shown in fig 17 d for different values of λ these drainage tw solutions are shown as connections on the permeability curve k s r in fig 18 the connections for lower values of λ are representative of non classical expansion shocks that violate lax entropy condition as eq 38 since these solutions are connections between two equilibria corresponding local stability properties can be analyzed in accordance with section 3 2 in the current phase field model these non classical expansion connections occur between a left equilibrium state s 0 0 which has locally one unstable real eigen value two stable complex conjugate eigen values and a right equilibrium state s 0 0 which has locally two unstable real eigen values one stable real eigen value and hence there are no oscillations observed neither when leaving the left equilibrium state along the unstable eigen vector nor when approaching the right equilibrium state along the stable eigen vector in section 3 1 2 it is observed that longitudinal oscillations appear at the junction of a rarefaction wave and the uniform intermediate saturation state associated to s b it can be inferred that these oscillations are due to the complex conjugate nature of the stable eigen pair in the vicinity of the left equilibrium state on the other hand the connections for higher values of λ violate lax entropy condition eq 35 while satisfying the first relation in eq 37 and so are representative of non classical under compressive shocks which travel faster than the characteristic speed on either side of the shock for such connections the system governed by eq 49 has a third equilibrium s e 3 0 0 such that 59 ϕ c s e 3 s k s e 3 k s 0 however the solution only represents a connection directly from s 0 0 to s 0 0 that have the same local stability properties with one unstable real eigen value two stable complex conjugate eigen values and the later are responsible for the small oscillatory non monotonicity when the solution approaches s 0 0 see inset in fig 17 d 4 conclusion in the current study we have presented a phase field model as an extension of the classical richards equation in order to address the displacement of an air water interface within a porous medium under the influence of either an imposed pressure gradient and or gravity in the framework of thermodynamically consistent phase field modeling sciarra 2016 the air water mixture in the unsaturated regime was viewed as a non uniform fluid characterized by a physically motivated phase field parameter the saturation degree of the wetting fluid water while such non uniform fluid naturally is equipped with a bulk and a non local energy contributions the confining effect due to the pore walls was assumed to be provided by the classical capillary interfacial energy the gradient of a chemical potential that is derived from the non uniform fluid energy was assumed to drive the fluid flow leading to a generalized darcy s law starting from such a constitutive assumption on the energies and dissipation due to fluid flow a conservation law has been derived for the non uniform fluid mass in a non deformable pore network an appropriate dimensional grouping has been proposed and a one dimensional analysis has been done exploiting the hyperbolic structure of the governing conservation law one dimensional pde simulations of the same have informed on the presence of similarity solutions for appropriate initial and boundary conditions in particular the part of the solution which is a similarity solution of the traveling wave type was understood as the air water displacement front as a significant novelty it has been demonstrated that both imbibition and drainage solutions are possible due to the non convexity of the proposed flux function further with an intent to analyze their linear stability the part of the solution that is a traveling wave type has been resolved by making a transformation into an appropriate moving coordinate system these solutions were analyzed by exploiting the underlying dynamical system the solutions corresponding to imbibition driven by gravity have been found to be non monotonic under certain boundary conditions and the reason for such non monotonicities has been analyzed in the current model the double well structure of the non uniform pore fluid energy has been found to cause overshoot type non monotonicities depending on the boundary conditions chosen whereas the oscillatory non monotonicities are due to the dynamical nature of the equilibria associated to the boundary conditions the solutions of imbibition under the influence of gravity have shown good qualitative agreement against one dimensional infiltration experiments with the trend of the relationship between infiltration flux and saturation degree overshoot being preserved drainage solutions connecting unknown boundary conditions as well were resolved using an iterative shooting method starting from left boundary condition taken from the pde solutions in part ii of the current study these tw solutions of both imbibition and drainage will be analyzed for their conditional stability against perturbations a linear stability analysis will be used to investigate the range of wave numbers for which such perturbations grow in time and the effect of non monotonicities within the solutions on the growth of perturbations also equipped with the knowledge on the range of unstable wave numbers two dimensional pde simulations will be done to characterize the non linear growth of initial perturbations and formation of fingering instabilities credit authorship contribution statement siddhartha h ommi conceptualization methodology formal analysis data curation writing original draft giulio sciarra conceptualization reviewing supervision panagiotis kotronis conceptualization reviewing supervision declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper appendix a linearization in the vicinity of s e 0 0 starting from the system of equations eq 49 rewritten as a 1 s ξ ξ f s ξ where s ξ s v w t and f s ξ f v g w h s v t is the associated short hand notation for the right hand side of eq 49 the system can then be expanded about an equilibrium s e ξ s e 0 0 t as a 2 s ξ ξ f s e ξ d f s e ξ ε d 2 f s e ξ ε 2 2 where d f s e ξ and d 2 f s e ξ represent the jacobian and hessian respectively of f s ξ evaluated at the equilibrium subsequently ε s ε v ε w ε t being a small perturbation in the vicinity of s e ξ allows us to ignore o ε 2 and higher order terms leaving us the linear system of equations governing ε as a 3 ε ξ d f s e ξ ε 0 1 0 0 0 1 h s s e 0 h v s e 0 0 s ε v ε w ε where a 4 h s s e 0 c a ϕ c k s e δ r ϕ d n l k s e h v s e 0 μ e s e ϕ d n l the characteristic polynomial p β whose roots are the eigen values associated with the system eq a 3 is thus given by a 5 p β det d f s e ξ β i β 3 h v s e 0 β h s s e 0 appendix b convergence properties of the one dimensional solutions in order to validate the robustness of the numerical scheme adopted to solve the one dimensional problem of sections 3 1 1 and 3 1 2 a mesh convergence analysis has been conducted for two test cases relative to the imbibition and the drainage problem as expected reducing the element size implies a decrease of the 2 norm of the difference between solutions for the saturation degree and the generalized chemical potential computed with successive mesh refinements see fig b 19 data relative to the test cases are reported in the caption of the figure 
142,temperature analysis during a pause in injection operations known as warmback analysis has been used in the petroleum industry for evaluating the injection conformance and estimating the location of the flooded front in applications such as waterflooding oil reservoirs in this work methods are introduced to extend the application of temperature warmback analysis to estimate the zonal co2 injection rate and zonal co2 plume extent during geologic co2 storage in a saline aquifer first novel analytical solutions are developed to model transient temperature in the aquifer during the injection and subsequent shut in periods considering two phase flow gaseous co2 and aqueous brine conditions in the aquifer the solution involves a discretization of the aquifer into regions the energy and mass conservation equations for the regions are solved simultaneously considering appropriate boundary conditions at the interfaces two solutions techniques are presented multi region and three region solutions inverse models are developed accordingly to evaluate the injection profile and estimate the extent of the plume front in the reservoir during the injection period the multi region solution results in an inversion approach that requires regression analysis however the three region formulation results in a simple graphical technique for inverse modeling the analytical solutions are validated against a thermally coupled reservoir simulation tool using different synthetic cases for co2 injection in deep saline aquifers the results of the developed solutions provide a good match with numerical results during forward and inverse modeling keywords temperature warmback analysis geologic co2 storage zonal injection rate allocation plume extent nomenclature α dimensionless parameter defined by eq 25 β dimensionless parameter defined by eq 25 b intercept of the fitted line with the vertical axis ct cw cg cr heat capacity of aquifer brine gas and rock l2 t2t btu lbm f j kg k dts distributed temperature sensing ϕ porosity fraction h reservoir thickness l ft m ibvp initial boundary value problem in modified bessel function of the first kind of an order n kn modified bessel function of the second kind of an order n k reservoir permeability l2 md m2 l 1 inverse laplace transformation operator q injection rate l3 t bbl day m3 s rsw rt radius of the plume and thermal front respectively l ft m s laplace dummy variable sg co2 saturation fraction t time t day s tinj injection time t day s t shut in time t day s tdinj dimensionless injection time td dimensionless shut in time t reservoir temperature t f k to initial reservoir temperature t f k tinj injected fluid temperature t f k tw sandface temperature t f k td dimensionless reservoir temperature uw darcy velocity l t ft day m s λt λr λw λg thermal conductivity of aquifer rock brine and co2 respectively m l t3t btu ft hr f w m k ρw ρr ρg density of brine rock and co2 respectively m l3 kg m3 1 introduction geologic carbon dioxide co2 storage gcs has been identified as a promising technique to mitigate climate change by reducing atmospheric greenhouse gas emissions among the potential options for geologic co2 storage saline aquifers are considered the prime candidate because of their widespread availability and their large storage capacity in terms of pore volume bachu 2000 aminu et al 2017 for successful implementation of gcs technology high injection rates are desirable to accommodate the industrial scale of co2 storage ipcc 2005 to achieve the desirable co2 injection rates co2 will be likely injected into thick multi zone aquifers that may constitute different layers with different lithologies the vertical heterogeneity of the storage aquifer can result in a non uniform injection rate distribution over the injection interval which results in poor sweep efficiency and inefficient utilization of the potential storage capacity of the storage aquifer oldenburg 2021 consequently monitoring the injection profile during co2 storage is essential to maintain uniform injection profile and achieve higher storage capacity of the storage aquifer among the methods that are used to monitor fluid flow in the wellbore temperature monitoring has recently been deployed to identify the injection zones and assess the effectiveness of the injection intervals the recent developments in the permanent downhole monitoring tools such as fiber optic dts distributed temperature sensing make real time temperature data accessible with high accuracy and resolution high performance dts systems can provide temperature data with spatial resolution down to few centimeters temporal resolution as short as 1 s and accuracy on the order of 0 01 c additionally dts tools have the flexibility to be installed in well permanently semi permanently or retrievably and they can be deployed via tubing inside the wellbore or cemented behind the casing huckabee 2009 the alternative techniques for fluid flow monitoring such as spinner survey have certain limitations for specific applications deployment of spinner survey may be infeasible in some applications because of injection deferment limited access to wellbore especially for deep injection wells cost and associated risks additionally the threshold fluid velocity of the flowmeter can be higher than the local fluid velocity in the wellbore which limit the applicability of the spinner survey to monitor injection wells operated at relatively high injection rates bateman 1985 many studies have been presented to demonstrate the potential capability of temperature monitoring for allocating flow rate through injection wells in the petroleum industry however few studies are devoted to show its application for monitoring injection profile in co2 injection wells in gcs projects brown et al 2003 brown et al 2004 bui and jalali 2004 foo et al 2014 horst et al 2015 hashish and zeidouni 2019a 2019b 2021a 2021b hashish and zeidouni 2021d 2021e different temperature interpretation techniques have been used in the oil and gas industry to provide qualitative quantitative estimation of injection profile during non isotheral fluid injection applications such as water flooding and enhanced oil recovery eor huckabee 2009 van der horst 2015 hemink et al 2016 these techniques can be applied for fluid flow monitoring using temperature data acquired during injection or shut in conditions temperature warmback analysis is one of the promising techniques that has been used to quantify injection profile during non isothermal fluid injection in a reservoir temperature decreases within the swept region mainly due to heat transfer caused by the injected fluid movement advection the temperature perturbation during the injection period will be followed by a temperature recovery during a pause in the injection activity the rate of temperature recovery during well shut in is dependent on the injectivity profile and the thermal properties of the formation and the injected fluid regions with higher injectivity exhibit lag in temperature recovery compared with those of lower injectivity consequently analyzing the temperature recovery over the injection interval can be used to give a quantitative estimation of the injection profile if the bottomhole temperature of the injected fluid is lower than the formation s temperature temperature warmback will be observed when injection is paused warmback analysis has the potential to isolate the thermal effects associated with the fluid flow in the wellbore because it is performed during a shut in period many studies are devoted to show the application of temperature warmback analysis to estimate injection profile during cold fluid injection in hydrocarbon reservoirs in these studies analytical and semi analytical models are developed by solving heat transport equation in the reservoir assuming single phase fluid flow pimenov et al 2005 hashish and zeidouni 2019a 2019b 2020 2021a 2021c 2021e in the context of co2 injection in deep saline aquifer different heat transfer processes evolve during co2 flow in the aquifer which result in a characteristic temperature profile the hydrothermal processes include 1 joule thomson expansion of co2 during co2 flow from the wellbore into the formation which results in temperature cooling 2 heat of dissolution which is released due to the exothermic co2 dissolution into the in situ brine at the plume front 3 heat of vaporization which is absorbed due to the endothermic brine vaporization into the flowing co2 4 heat conduction in the flow direction and the heat exchange with the surrounding strata and 5 heat transfer by advection which is driven by the bulk co2 movement and the contrast between the bottomhole temperature of the injected co2 and the initial reservoir temperature bielinski et al 2008 han et al 2010 mathias et al 2010 han et al 2012 zhao and cheng 2015 jayne et al 2019 the evolution of the bottomhole temperature of co2 is attributed to different factors such as the anthropogenic origin i e surface temperature of the injected co2 or the thermodynamic processes that evolve during co2 flow in the wellbore such as adiabatic compression of co2 heat exchange between co2 and the surrounding strata frictional energy loss and the potential energy loss i e work done on co2 by gravity force han et al 2012 the implications of the two phase flow conditions and the different hydrothermal processes that evolve during co2 storage in a saline aquifer make the already published solutions inefficient to estimate co2 injection profile to extend the application of temperature warmback analysis for estimating co2 injection profile during gcs a development of a new model that solves mass and heat conservation equations during two phase flow conditions gaseous co2 and aqueous brine in the storage aquifer is required in this work we show the application of temperature warmback analysis for gcs monitoring considering the two phase flow conditions that attain during co2 storage in a brine saturated aquifer first we present a numerical investigation to demonstrate the contribution of the hydrothermal processes to the temperature evolution during cold co2 injection in a saline aquifer the objective of this investigation is to determine the dominant hydrothermal processes and implications for the assumptions that can be made to obtain an analytical solution to the problem next novel analytical solutions are presented to model temperature evolution during co2 injection and a subsequent shut in period inversion procedures are provided accordingly to estimate the injection rate the radius of the thermal front the radius of the plume front and the initial temperature all per layer the results obtained using the proposed solutions and the inversion procedures are validated against those obtained using the thermal simulation tool tough3 jung et al 2018 we considered cold fluid injection in this study for consistency but the proposed analysis is equally valid for warm fluid injection applications the approach developed in this work can be used to design a thermal test at the beginning of co2 storage to allocate zonal co2 injection rate among the injection zones which in turn helps to assess the heterogeneity of the target reservoir and improve the efficiency of the completion design to achieve proper co2 storage 2 forward modeling 2 1 multi region analytical model in this section an analytical solution is developed to describe the transient temperature in an aquifer during non isothermal co2 injection and the following shut in period the solution procedure is to solve the energy balance equation during co2 brine displacement process subject to specific initial and boundary conditions that correspond to the injection and shut in conditions in appendix a we present a 1 d radial numerical simulation using tough3 eco2n simulation tool for a base case example problem to demonstrate the contribution of the hydrothermal processes to the temperature evolution during cold co2 injection in the subsurface the numerical investigation shows that temperature evolution during the injection period is dominated by advection mechanism consequently heat transfer by advection is considered the dominant mechanism of heat transfer during solving the energy and mass conservation equations besides the effect of mutual dissolution on temperature evolution can be negligible accordingly the following assumptions are used during formulating and solving the problem co2 is injected with constant injection rate q and constant injection temperature tinj in an aquifer with initial temperature to for an injection duration tinj then injection stops to allow for the temperature recovery see fig 1 the aquifer consists of multiple layers each layer is assumed to be homogenous isotropic and of an infinite extent in the lateral direction with a uniform thickness h however the aquifer can be vertically heterogeneous i e the properties of the layers are different fluid flow is assumed to be 1d radial flow fluid displacement is immiscible no mass transfer occurs between the displacing and the displaced fluids heat transfers in the flow direction by advection and conduction heat exchange with the surrounding strata is negligible during the injection and shut in periods no phase change occurs over the displacement length dindoruk and dindoruk 2008 fractional flow curve is a function of saturation and temperature only bratvold and horne 1989 capillary and gravity forces are neglected during the injection and shut in periods bratvold and horne 1989 energy contributions from kinetics and stresses pressure are neglected the mass conservation equation for co2 rich gaseous phase is described by the following hyperbolic equation 1 t φ ρ g s g 1 r r r ρ g u g 0 where u g q g a q g 2 π r h is gas phase velocity ρ g is gas phase density s g is gas phase saturation and φ is formation porosity using the assumption of incompressible fluid flow which is feasible for the brine and the supercritical state nature of the injected co2 the mass conservation equation is simplified to the following form buckley and leverett 1942 2 s g t q π h φ f g r 2 0 the volumetric fractional flow is the ratio of co2 rich gaseous phase velocity to the mixture brine co2 velocity which is given by 3 f g s g t u g u k r g μ g k r g μ g k r w μ w 1 1 k r w k r g μ g μ w since the fractional flow of co2 is only a function of temperature and co2 saturation due to the temperature dependency of viscosity ratio and the saturation dependency of relative permeability dindoruk and dindoruk 2008 respectively the mass conservation equation can be written in the following form using the chain rule 4 s g t q π h φ f g s g s g r 2 f g t t r 2 0 the energy balance equation for an immiscible co2 brine displacement is described by the following advection diffusion equation duru and horne 2010 app 2010 mao and zeidouni 2017 5 t ρ t c t t r ρ t c t u t t 1 r r λ t r t r where 6 ρ t c t φ ρ g c g s g ρ w c w 1 s g 1 φ ρ r c r 7 ρ t c t u t ρ g c g u g ρ w c w u w ρ g c g f g ρ w c w 1 f g u 8 λ t φ λ g s g λ w 1 s g 1 φ λ r assuming that porosity is constant that fluids have constant density and heat capacity and the change in the total thermal conductivity is negligible the governing equation is simplified to the following form after few manipulations 9 ρ g c g t φ s g t u f g r ρ w c w t φ 1 s g t u 1 f g r φ s g ρ g c g 1 s g ρ w c w 1 φ ρ r c r t t f g ρ g c g 1 f g ρ w c w u t r φ λ w s w λ g 1 s g 1 φ λ r 1 r r r t r the quantities in the parenthesis are identical to the mass conservation equations for co2 and brine and so the parenthesis terms are equal to zero finally re arranging the remaining temperature terms and dividing the equation by ϕ ρ g cg ρ w cw results in the following form 10 s g ρ w c w 1 φ φ ρ r c r ρ g c g ρ w c w t t f g ρ w c w ρ g c g ρ w c w q 2 π h φ 1 r t r λ g λ w ρ g c g ρ w c w s g λ w 1 φ φ λ r λ g λ w 1 r r r t r the mass and energy balance equations are subject to the following initial and boundary conditions 11 s g r t 0 0 12 s g r r w t 1 s w r 13 t r t 0 t o 14 t r r w t t i n j where swr is the residual water saturation eqs 11 and 12 describe the initial condition and boundary conditions for co2 mass conservation equation respectively while eqs 13 and 14 describe the initial and boundary condition for heat conservation equation respectively the governing equation of the above initial boundary value problem ibvp is a non linear advection diffusion equation because of the dependency of the fractional flow term fg on the temperature obtaining an exact analytical solution to the ibvp is difficult rather a semi analytical solution is presented using the operator splitting technique operator splitting technique is an approximate technique that allows the advection diffusion problem to be broken into two sub problems advection and diffusion where each problem can be solved separately the advection problem is solved at a time step considering the same initial and boundary conditions of the main ibvp next the diffusion problem is solved using the same boundary conditions of the main problem however the initial condition of the diffusion problem is the temperature solution obtained from the advection problem at the end of the time step holden et al 2000 duru and horne 2010 bahar and gürarslan 2017 generally this technique provides good results for small time steps accordingly the main ibvp described by eqs 10 14 is divided into an advection problem which is defined by eqs 15 20 and a diffusion problem which is defined by eqs 21 24 in this case a single time step is adopted for the operator splitting approach which equals the injection period 15 s g ρ w c w 1 φ φ ρ r c r ρ g c g ρ w c w t 1 t f g ρ w c w ρ g c g ρ w c w q π h φ t 1 r 2 0 16 s g t q π h φ f g s g s g r 2 f g t 1 t 1 r 2 0 the corresponding initial and boundary conditions are given by 17 s g r t 0 0 18 s g r r w t 1 s w r 19 t 1 r t 0 t o 20 t 1 r r w t t i n j 21 s g ρ w c w 1 φ φ ρ r c r ρ g c g ρ w c w t 2 t λ g λ w ρ g c g ρ w c w s g λ w 1 φ φ λ r λ g λ w 1 r r r t 2 r the corresponding initial and boundary conditions are given by 22 t 2 r t 0 t 1 r t t i n j 23 t 2 r r w t t i n j 24 lim r t 2 r 0 the mass conservation equation is not included when solving for the diffusion problem because the contribution of heat conduction slightly affects the location of the thermal front platenkamp 1985 the advection problem constitutes energy and saturation conservation equations expressed in the form of hyperbolic partial differential equations described by eqs 15 and 16 the advection problem has been solved by bratvold and horne 1989 in which the authors used the method of characteristics to solve the coupled non linear hyperbolic conservation equations the details of their solution procedure are presented in appendix b for completeness according to which the temperature and saturation profiles at the end of the injection period are obtained see fig b 2 the temperature profile obtained during the injection period is characterized by step change in the temperature at the thermal front from the injection temperature to initial aquifer temperature 2 2 multi region model solution in the next step the contribution of heat conduction to the temperature solution is obtained by solving the diffusion problem described by eqs 21 24 considering the temperature solution obtained from the advection problem as the initial condition the ibvp is rescaled using the following dimensionless parameters 25 t d t t i n j t o t i n j t d q t φ π r w 2 h r d r r w α ρ w c w ρ g c g ρ w c w β ρ w c w 1 φ φ ρ r c r ρ g c g ρ w c w η λ g λ w ρ g c g ρ w c w γ λ w 1 φ φ λ r λ g λ w χ q π h φ η g f g α s g β the governing equation of the diffusion ibvp in dimensionless form is given by 26 2 t 2 d r d 2 1 r d t 2 d r d θ r d t 2 d t d where θ r d s g r d β s g r d γ χ the corresponding initial and boundary conditions are given by 27 t 2 d r d t d 0 t 1 d r d t d t i n j d 28 t 2 d r d 1 t d 0 29 lim r d t 2 d r d 0 the governing equation described by eq 26 is a heat diffusion equation with a spatially variable coefficient the problem is solved by discretizing the aquifer into n regions in which the coefficient θ rd is constant per region and evaluated at the average saturation within the region the resulting multi region heat diffusion problem is given by 30 2 t 2 d i r d 2 1 r d t 2 d i r d θ i t 2 d i t d r d i 1 r d r d i the initial conditions for the system of the governing equations are given by 31 t 2 d i r d t d 0 t 1 d i r d t d t i n j d r d i 1 r d r d i the innermost and outermost boundary conditions are given by 32 t 2 d 1 r d 1 t d 0 33 t 2 d n r d r d e 0 where rde is the outer radius of the aquifer the boundary conditions at the interfaces are described through the conservation of heat flux and the continuity of the temperature solution at the interfaces they are described by the following equations 34 t 2 d i t 2 d i 1 a t r d r d i 35 r i i 1 t 2 d i r d t 2 d i 1 r d a t r d r d i where r i j ε i ε j and ε i s g i λ w 1 φ φ λ r λ g λ w by solving the advection diffusion problem using the operator splitting technique an approximate solution that describes the temperature profile at the end of the injection period considering heat transfer by both advection and conduction is obtained during the shut in period that follows the injection process the governing equation for the heat transfer in the reservoir is simplified to a purely heat diffusion equation because fluid velocity during the shut in period is negligible the governing equation that describes the heat transfer in the aquifer during the shut in period is given by 37 2 t d r d 2 1 r d t d r d θ r d t d δ t d where δtd td tinjd the above equation is subject to the following initial and boundary conditions 38 t d r d δ t d 0 t 2 d r d t d t i n j d 39 t d r d r d 1 0 40 lim r d t d r d 0 the ibvp during the warmback period is similar to the diffusion problem during the injection period however the innermost boundary condition is replaced by an isolated boundary condition eq 39 and the initial condition is replaced by the temperature solution obtained at the end of the injection period eq 38 laplace transformation technique is used to solve the heat conduction problem during the injection and shut in periods the solutions details are presented in appendix c according to which the sandface temperature solution during the shut in period is obtained by assigning rd 1 into the solution of the innermost region and is given by 42 t w d δ t d t 2 d 1 t d t i n j d l 1 k 11 s i o s θ 1 l 1 k 21 s k o s θ 1 where t 2d 1 td tinjd is the temperature solution at the end of the injection period for the inner most region the obtained solution is used to infer the injection profile over the storage aquifer and estimate the location of the co2 saturation front by history matching the analytical based temperature recovery with the observed temperature recovery as will be shown in section 3 2 3 three region analytical model in this section a three region analytical solution is presented for modeling the transient temperature in the aquifer during the warmback period considering the solution of the advection problem as the initial condition the aquifer is discretized into three regions as shown in fig 2 in which region 1 extends from the injection well to the thermal front region 2 extends from the thermal front to the saturation front region 3 extends from the saturation front to the outer boundary of the reservoir in this solution the effect of heat diffusion during the injection period is neglected for simplicity consequently temperature profile is described by step change in the temperature at the thermal front where the temperature upstream of the thermal front is identical to the injection temperature region 1 and the temperature downstream of the thermal front is identical to the initial aquifer temperature region 2 and region 3 during the shut in period heat transport equations for the discretized regions are described by heat conduction equations accordingly governing equations for heat transfer during the shut in period for the discretized regions are given by 43 2 t d 1 r d 2 1 r d t d 1 r d θ 1 t d 1 δ t d 0 r d r t d 44 2 t d 2 r d 2 1 r d t d 2 r d θ 2 t d 2 δ t d r t d r d r s d 45 2 t d 3 r d 2 1 r d t d 3 r d θ 3 t d 3 δ t d r s d r d the corresponding initial conditions are given by 46 t d 1 r d δ t d 0 0 47 t d 2 r d δ t d 0 1 48 t d 3 r d δ t d 0 1 the innermost and outermost boundary conditions are well described using thermally isolated boundary conditions which are given by 49 lim r d 0 t d 1 r d 0 50 lim r d t d 3 r d 0 the boundary conditions at the interfaces of the regions are described through the conservation of heat flux and the continuity of temperature which are given by 51 r 12 t d 1 r d r d r t d t d 2 r d r d r t d t d 1 r d r t d δ t d t d 2 r d r t d δ t d 52 r 23 t d 2 r d r d r s d t d 3 r d r d r s d t d 2 r d r s d δ t d t d 3 r d r s d δ t d where r i j ε i ε j and ε i s g i λ w 1 φ φ λ r λ g λ w 2 4 three region model solution the solution of the ibvp described by eqs 43 52 is obtained using laplace transformation technique in laplace domain the solution of the governing equations is obtained in terms of the modified bessel functions the details of the solution procedure are given in appendix d by which the sandface temperature solution during the warmback period is given by 53 t w d δ t d l 1 φ ψ where 54 φ θ 2 r 23 k o r s d s θ 3 i 1 r s d s θ 2 k 1 r t d s θ 2 i 1 r t d s θ 2 k 1 r s d s θ 2 θ 2 θ 3 k 1 r s d s θ 3 i 1 r t d s θ 2 k o r s d s θ 2 i o r s d s θ 2 k 1 r t d s θ 2 55 ψ s r 12 θ 1 i 1 r t d s θ 1 r 23 θ 2 k o r s d s θ 3 i 1 r s d s θ 2 k o r t d s θ 2 i o r t d s θ 2 k 1 r s d s θ 2 θ 3 k 1 r s d s θ 3 i o r s d s θ 2 k o r t d s θ 2 i o r t d s θ 2 k o r s d s θ 2 θ 2 i o r t d s θ 1 r 23 θ 2 k o r s d s θ 3 i 1 r s d s θ 2 k 1 r t d s θ 2 i 1 r t d s θ 2 k 1 r s d s θ 2 θ 3 k 1 r s d s θ 3 i 1 r t d s θ 2 k o r s d s θ 2 i o r s d s θ 2 k 1 r t d s θ 2 inverse laplace transformation is performed numerically using stehfest algorithm stehfest 1970 to obtain the solution in the real time domain at early shut in time an asymptotic solution of the sandface temperature is be obtained which is given by see appendix d for more details 56 t w d δ t d r t d θ 1 2 π e θ 1 r t d 2 8 δ t d δ t d k 1 4 θ 1 r t d 2 8 δ t d e θ 1 r t d 2 4 δ t d the above equation is re written below in a dimensional form using the dimensionless group given by eq 25 57 δ t w δ t t o t i n j e 1 4 s g 1 β s g 1 γ r t 2 η δ t where s g 1 is the average gas saturation within region 1 eq 57 is identical to the temperature solution for a single region reservoir which has thermal properties and fluid saturation identical to the innermost region this indicates that at the early shut in time the properties of the innermost region dominate the temperature recovery at injection well the early time asymptotic solution presents a simple form for the temperature recovery at the shut in period which can be casted into a simple graphical technique for the inverse modeling as will be shown in the next section 3 inverse modeling in this section inversion procedures are presented using the analytical solutions developed in section 2 to estimate the injection profile the radius of the saturation front the radius of the thermal front and the initial geotherm prior to co2 injection two types of inversion techniques are presented according to the type of analytical solution to be used multi region solution vs three region solution since the multi region solution is not presented in a closed form regression analysis is used to iterate on the injection profile that reproduces the temperature recovery observed during the shut in period the fitness function should consider the injection constraint i e summation of estimated injection rates for the injection zones must sum up to the total injection rate besides the estimation error of the temperature results an optimization routine namely genetic algorithm press et al 1992 is used in this work to perform the regression analysis the location of the saturation and thermal fronts are obtained accordingly using the optimum injection profile obtained through the regression analysis the second technique of inverse modeling is done using the early time asymptotic solution given by eq 57 this technique is fast and simple compared with the regression analysis the inversion procedure is as follows construct the solution of the advection problem using bratvold and horne 1989 procedure as illustrated in appendix b the solution describes the temperature and gas saturation profiles at the end of the injection period versus the similarity variable ζ similar to fig b 1 b in appendix b and fig 3 b in the validation section plot the change in the sandface temperature δtw δt tw δt tinj for the layer of interest versus 1 δ t on a semi log scale such that the temperature change is plotted on the logarithmic scale identify the portion of the plotted data to be fitted with a straight line estimate the slope m and the intercept with the vertical axis b of the fitted line the initial temperature of the layer of interest is estimated by 58 t o t i n j b the location of the thermal front is estimated by 59 r t 4 η s g 1 γ s g 1 β m where η γ and β are given by eq 25 and the fluid properties are estimated at the initial conditions the average gas saturation within the near wellbore region s g 1 can be obtained by averaging the saturation values located upstream of the thermal front in the sg ζ profile obtained in the first step the injection rate at the layer of interest is estimated using eq 60 where ζ t is the velocity of the thermal front which is given by f g s g 1 α s g 1 β or f g s g 2 α s g 2 β s g1 is the gas saturation upstream of the thermal front s g2 is the gas saturation downstream of the thermal front and α and β are given by eqs 25 s g1 is obtained from the intercept of the thermal tangent with fg sg plot at the injection temperature and s g2 is obtained from the tangent point of the thermal tangent on fg sg plot at the initial temperature 60 q 1 ζ t π r t 2 h φ t i n j the radius of the saturation front is estimated using eq 61 where ζ s g is the velocity of the saturation front which is given by the slope of the saturation tangent with fg sg plot at the initial temperature 61 r s g q t i n j π h φ ζ s g the results of the developed forward and inverse models presented in sections 2 and 3 are validated against numerical results in the next sections to demonstrate their validity 4 solutions validation in this section the developed forward models are validated against the results of the numerical reservoir simulator tough3 eco2n tough3 is a numerical simulator capable of simulating nonisothermal multiphase and multicomponent fluid flow in multidimensional porous media jung et al 2018 eco2n is a fluid property module that describes the thermophysical properties of brine and co2 system pruess 2005 two synthetic cases are presented for the benchmarking the first case is presented for a single zone aquifer with homogenous and isotropic properties which are identical to the base case presented in the appendix a see table a 1 the second case is presented for a heterogeneous multi zone aquifer that is subject to co2 injection via a commingled injection well see table 3 in both cases co2 is injected at a bottomhole temperature lower than the initial reservoir temperature then injection stops to allow for temperature recovery 4 1 single layer case in the base case co2 is injected at a constant injection rate of 145 6 m3 day and a constant bottomhole injection temperature of 20 c into an aquifer for a period of 3 days before the well is shut in to allow for the warmback the rock and fluid properties of the aquifer are given in table a 1 the developed forward models presented in section 2 are used to model the transient temperature in the aquifer during the injection and the following shut in periods fig 3 a illustrates fg sg plots of the co2 evaluated at the initial reservoir temperature 65 c and the injection temperature 20 c using eq 3 relative permeability for the aqueous phase is described using mualem 1976 and van genuchten 1980 and the co2 rich gaseous phase relative permeability is described using corey 1954 see table a 2 the input data for the relative permeability and capillary pressure models are given in table a 1 the solution procedure presented in appendix b is adopted to solve the advection problem fig 3 a shows the fg sg plots with the characteristic curves which have slopes of g and dfg dsg co2 saturations at the saturation and temperature fronts are obtained accordingly from the tangent points and the solution is presented in terms of the similarity variable ζ in fig 3 b next the multi region and the three region solutions are used to obtain the temperature profile by the end of the injection period 3 days as shown in fig 4 a it is observed that thermal front lags behind the saturation front due to the thermal storage capacity of the reservoir rock the extent of the thermal front propagation by the end of the injection period is 3 m while the extent of the plume front is 15 m because the three region solution assumes advection dominant heat transfer during the injection period the temperature profile obtained using this technique shows a step change in the temperature at the thermal front from the injection temperature to the initial temperature on the other hand in the multi region solution both advection and conduction heat transfer mechanisms are considered which result in a smearing of the thermal front saturation results obtained using bratvold and horne 1989 show good agreement with the numerical results except at the near wellbore region due to neglecting the dry out region two saturation shocks can be observed in the saturation profile the main saturation shock is located at the plume front 15 m and a minor saturation shock is located at the thermal front 3 m the latter is established due to the temperature contrast between the initial aquifer temperature and the bottomhole injection temperature the size of the dry out region by the end of the injection period is 0 4 m which is negligible compared with the sizes of the thermal disturbance region and the two phase region fig 4 b illustrates the temperature profile during the warmback periods at t 7 14 21 and 30 days the temperature perturbation created by the cold co2 injection dissipates by the effect of heat diffusion in the aquifer as shut in time increases heat diffuses from the unswept and warm region toward the swept region and results in temperature warmback at the injection well fig 5 illustrates the sandface temperature recovery during the shut in period which increases by 12 c by the end of the shut in period overall a good match is obtained between the analytical solutions and the numerical results however the multi region solution provides a better match with the numerical results compared with the three region solution the number of regions implemented in the multi region solution is 170 regions 4 2 five layer case in this case a 5 layer aquifer with different permeability per layer k 900 700 500 300 and 100 md is subject to cold co2 injection at a constant injection rate of 460 m3 day and a constant bottomhole injection temperature of 20 c see table 3 each layer is 10 m thick the injection profile as obtained from the numerical model is 165 129 92 55 and 18 m3 day for the injection layers from the top to the bottom of the aquifer the analytical models presented in section 2 are used to model the transient temperature during the injection and the shut in periods in each layer first the solution procedure presented in appendix b is used to solve the advection problem fig 3 a illustrates the fg sg plots at the initial reservoir temperature and the bottomhole injection temperature with the characteristic curves fig 3 b illustrates the derivative of the fractional flow curves along with the established solution fig 6 a shows the transient temperature and co2 saturation profiles at the end of the injection period for the layer 1 uppermost layer as obtained from tough3 the three region solution and the multi region solution the extent of co2 plume propagation by the end of the injection period is 15 5 m while the extent of the thermal front is 3 5 m fig 6 b illustrates the temperature profiles in layer 1 during the warmback period at t 7 14 21 and 30 days fig 7 illustrates the sandface temperature recovery over the injection zones during the warmback period different rates of temperature recovery are obtained during the shut in period due to the different injectivities of the injection layers layer 5 which has the lowest permeability k 100 md accepts the lowest percentage of the injected volume and consequently exhibits the highest temperature rebound during the shut in period on the other hand layer 1 which has the highest permeability k 900 md accepts most of the injected volume and consequently exhibits the lowest temperature rebound during the shut in period the temperature recovery for layer 1 is 8 c compared with 38 c for layer 5 at t 30 days based on these observations the characteristics of the temperature recovery reflect the injection profile and the distribution of the injected co2 over the reservoir thickness it is obtained from fig 7 that the multi region solution provides better match with the numerical results compared with the three region solution the three region solution provides underestimated temperature results at the early shut in time because it neglects the effect of heat transfer by conduction during the injection period as the injection rate increases the relative contribution of advection mechanism compared with the conduction mechanism known as péclet number increases this is why the deviation in the results obtained using three region solution and multi region solution decreases as injection rate increases from layer 5 18 m3 day to layer 1 165 m3 day based on the validation results presented in this section the multi region solution provides better match with the numerical results compared with the three region solution in the next section the inversion procedure presented in section 3 is used to infer the injection profile and the distribution of the co2 over the aquifer thickness 5 inverse modeling application in this section the inversion procedure introduced in section 3 is used for the inverse modeling two approaches are utilized based on the forward model the first approach is to use regression analysis along with the multi region solution while the second approach is to use the three region based graphical technique genetic algorithm is used as an optimization routine to perform the regression analysis for the multi region solution the results of the inverse modeling using the regression analysis for case 1 and case 2 are given in tables 4 and 5 respectively fig 8 shows the solution progress and the fitting error during the regression analysis fig 9 shows the application of the graphical technique for case 1 and case 2 disagreement is evident between the asymptotic solution and the numerical results at the early shut in time this can be attributed to neglecting the effect of heat conduction during the injection period and the adiabatic expansion of co2 at the sandface region when injection stops which results in slight decrease in the temperature signal before the warmback the corresponding inversion results for case 1 and case 2 are given in tables 4 and 5 respectively the calculations steps are shown below for case 1 using the thermal properties evaluated at the initial conditions given in table 3 the parameters β η and γ are 4 70 2 642 10 7 and 12 254 respectively the average gas saturation within region 1 s g 1 is 0 536 which is obtained from fig 3 b the initial reservoir temperature the radius of the thermal front the injection rate and the radius of the saturation front are obtained as follows t o t i n j b 20 44 64 o c r t 4 η s g 1 γ s g 1 β m 4 2 642 10 7 0 536 12 254 0 536 4 7 38 5 24 3600 3 145 m q 1 ζ t π r t 2 h φ t i n j 1 0 177 π 3 145 2 10 0 25 3 147 2 m 3 d a y r s g q t i n j π h φ ζ s g 147 2 3 π 10 0 25 3 866 14 74 m the similarity variables ζ t ζ s g represent the velocity of the thermal and saturation front respectively which are estimated as illustrated in section 3 the same procedure is used to estimate the inversion results for case 2 which are given in table 5 the inversion results and the estimation errors in parentheses shown in tables 4 and 5 show the good agreement with the numerical results and demonstrate the validity of the approach developed in this work the regression technique is shown to provide slightly accurate results compared with those obtained using the graphical technique however it requires longer calculation time on the other hand the graphical technique is simple and yet provides inversion results with good accuracy compared with the numerical results 6 discussion in this section we will discuss the assumptions but also the behavior and the applicability of the proposed solutions the proposed solutions are developed by solving mass and heat conservation equations analytically during co2 flow in saline aquifer during the injection and the subsequent shut in periods different assumptions are made while solving the problem first we assumed that fluid flow geometry around the injection well is radial this assumption is likely for a fully penetrating vertical well given the high viscous forces around the well which can effectively displace the fluids to allow for radial flow however radial flow may not develop if the injection zone is highly heterogeneous and or anisotropic we also neglected the mutual dissolution i e mass exchange between the injected co2 and aqueous brine in the reservoir this assumption is inherent in bratvold and horne 1989 s solution which is used in our work to obtain the temperature and saturation profiles during the injection period accordingly the size of dry out region is neglected despite that neglecting the dry out region may affect the pressure evolution however temperature is shown to be slightly affected this assumption is feasible for the application of the proposed technique because temperature warmback analysis is generally limited to short injection durations few days and consequently the obtained size of the dry out region is limited in case 1 the size of dry out region is shown to be small 0 4 m compared with the size of the two phase region 15 m after 3 days of co2 injection additionally a good agreement is obtained between the analytical results and those obtained numerically as shown in fig 5 which demonstrates the feasibility of this assumption neglecting the mutual dissolution between the displacing and displaced phases also results in negligible contribution of specific hydrothermal processes such as water vaporization and co2 dissolution based on the numerical investigation presented in appendix a the contribution of water vaporization and co2 dissolution to the temperature evolution are 0 5 c and 1 2 c respectively which are negligible compared with the contribution of the advection mechanism 20 c besides the solution presented in this work neglects the effect of heat exchange with the surrounding strata this assumption is invalid for extended injection and shut in durations hashish and zeidouni 2021b however the application of the warmback analysis is generally limited to short injection durations few days injecting for a long injection period may not be practical anyway because extended shut in time would be required to obtain a pronounced warmback signal the shorter the injection duration the more pronounced the temperature recovery that can be obtained during the warmback period a short shut in duration is also desirable to avoid extended pause in injection activity based on the results obtained in section 5 the proposed approach can be used as an alternative technique to estimate the injection profile through injection wells during co2 storage the multi region solution is shown to be robust and provides accurate results during forward and backward modeling because it considers both heat advection and conduction mechanisms during solving the problem however inversion procedure using regression analysis may be time consuming on the other hand three region solution provides results with lower accuracy because it discretizes the aquifer into three regions additionally it neglects the contribution of heat conduction during the injection period consequently the three region solution may underestimate temperature recovery at early shut in time especially for long injection durations however the early time asymptotic form of the three region solution can be casted into simple graphical technique for inverse modeling the proposed graphical technique is simple practical to be used by field analyst and yet provides inversion results with comparable accuracy consequently the proposed solutions can be used as alternative to the numerical simulation tools which are time consuming and may be highly non unique for inverse modeling despite that the traditional flow meters such as injection logging tools ilts can be used to derive fluid flow through injection wells they have certain limitations for specific applications injection logging tools such as spinner flowmeters have a limited access to wellbore in case of restricted completions their deployment results in injection deferment and they are relatively expensive additionally the threshold fluid velocity of the flowmeter limits the flow rate that ilts can measure to relatively high flow rates consequently ilts may provide low resolution results for estimating flow profile in injection wells operated at low flow rates compared with the proposed approach 7 conclusions in this work a novel analytical approach is presented to quantify the injection profile over co2 injection wells during geologic carbon storage in a saline aquifer the proposed approach extends the application of temperature warmback analysis to allocate co2 zonal rate during co2 injection in a saline aquifer analytical solutions are developed to model the temperature evolution during the injection and the shut in period by solving the heat and mass conservation equations considering two phase flow conditions gaseous co2 and aqueous brine in the aquifer two solutions are presented to the problem the first solution is a multi region solution which discretizes the aquifer into many regions and the energy balance equations of the discretized regions are solved considering the boundary conditions at the interfaces the second analytical solution follows the same approach however the aquifer is only discretized into three regions to obtain a closed form solution for temperature recovery during the warmback period two inversion procedures are presented accordingly the first approach is to use regression analysis along with the multi region solution to iterate on the injection profile that reproduces the temperature recovery observed during the shut in period additionally the radius of the plume front the radius of the thermal front and the initial temperature can be obtained all per layer the second approach is to reformulate the early time asymptotic form of the three region solution into a simple graphical technique that provides the same information without the need for regression analysis the graphical technique is simple practical to be used by a field analyst and yet provides accurate estimation of the inversion results compared with the alternative numerical models that are time consuming and may be highly non unique during inverse modeling the results of the developed forward and inverse models are validated against numerical results obtained by tough3 for two synthetic cases a good match is obtained between the analytically obtained results and those obtained numerically which demonstrates the validity of the presented solutions the approach presented in this work can be used to design a thermal test analogous to pressure testing at the beginning of co2 storage operation to estimate co2 injection profile assess the vertical heterogeneity of the target formation and evaluate the effectiveness of the injection interval evaluating co2 injection profile helps to identify thief zones for remedial action and maximize the storage capacity of the storage reservoir credit authorship contribution statement refaat g hashish conceptualization methodology formal analysis investigation writing original draft writing review editing mehdi zeidouni conceptualization methodology formal analysis investigation writing original draft declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgement the authors would like to thank the u s department of energy national energy technology laboratory netl for funding under grant number de fe0031557 cfda 81 089 appendix a 1 d radial numerical simulation in this appendix we first present a 1 d radial numerical simulation using tough3 eco2n simulation tool for a base case example problem to demonstrate the contribution of the hydrothermal processes to the temperature evolution during cold co2 injection in a deep aquifer the objective of this investigation is to determine the dominant hydrothermal processes and implications for the assumptions that can be made to obtain an analytical solution to the problem the base case involves injecting cold co2 with constant injection rate 1 58 kg s and constant bottomhole injection temperature 20 c for 3 days into an aquifer with a thickness of 10 m the formation is 2000 m deep with initial temperature of 65 c and initial pressure of 20 mpa the remaining properties of the base case are given in table a 1 the relative permeability and capillary pressure models of the aquifer are given in table a 2 fig a 1 a illustrates the temperature and saturation profiles for the base case the saturation behavior shown in fig a 1 a is similar to the isothermal saturation signature it is still characterized by two major discontinuities shocks as derived from the extended fractional flow theory orr 2007 they develop due to mutual dissolution between co2 and brine i e co2 dissolution into the brine aqueous phase and water vaporization into the co2 rich gaseous phase they divide the reservoir into three regions namely co2 dry out region two phase aqueous brine gaseous co2 region and single phase fresh brine region zeidouni et al 2009 the extent of the dry out region is 0 4 m compared with 15 m for the two phase region in addition to the two shocks caused by the mutual co2 brine dissolution another shock can be identified in the saturation profile as shown in the magnified subfigure of fig a 1 a the third shock is relevant to the non isothermal nature of the flow and it is located within the two phase region the third shock establishes due to the abrupt change in the fluids nobilities at the thermal shock the temperature response is also shown in fig a 1 a which can be characterized by two approximately isothermal regions separated by a shock at radial distance of 4 m this behavior is an indication that the temperature response is advection dominant and the other thermal processes may be negligible to better illustrate the effect of the other processes heat conduction jt expansion and effect of dissolution and vaporization the temperature results are shown in fig a 1 b considering that co2 is injected at the same temperature as the aquifer jt expansion results in a slight cooling 0 06 c at the near wellbore region as co2 flows outward from the injection well the water vaporization effect decreases the temperature at the trailing edge of the two phase region by 0 45 c on the other hand co2 dissolution in the in situ brine at the plume front results in a sharp increase in temperature by 1 2 c the combination of these processes shows 1 c of temperature perturbation to the reservoir temperature this has been also noted by han et al 2010 according to which temperature behavior during the co2 injection period can be approximated as advection dominant for completeness we will also account for the effect of heat conduction in this study to improve our model accuracy in addition to approximating the temperature behavior to be advection dominant we assume that the effect of mutual dissolution on the saturation behavior is negligible this latter assumption would be invalid when solving for pressure since it eliminates an important region i e the dry out region which can have important implications for co2 injectivity however this assumption is proved useful in achieving the objective of this study which is to obtain the temperature response not the pressure response as we will show in the validation section despite this assumption the temperature response still shows good agreement with the numerical simulation results the negligible dry out region assumption in deriving the thermal response can be justified due to 1 the small size of the dry out region 0 4 m for the base case compared with the size of the thermal disturbance region 4 m for the base case and the size of the two phase region 15 m for the base case 2 the effective thermal conductivity which controls the temperature recovery during the shut in period changes slightly linearly with fluid saturation because the majority of the porous media is solid grains and the thermal conductivity for the solid grains is much higher than the fluids similarly the effective heat capacity which controls the location of the thermal front during the injection period is slightly affected by fluid saturation platenkamp 1985 for example a change in brine saturation of the dry out region from 0 3 residual saturation to zero changes the effective thermal conductivity in the dry out region by 1 7 percent and the effective heat capacity by 4 percent for a formation porosity of 0 25 on the other hand the same change in the brine saturation results in a change in the brine relative permeability by 80 percent because of the non linear functionality of relative permeability to fluid saturation this clarifies why pressure behavior and fluid injectivity are more sensitive to the fluid saturation of the dry out region compared with temperature behavior appendix b solution of the advection problem in this appendix the solution of the advection problem developed by bratvold and horne 1989 is given for completeness using the dimensionless parameters given by eq 25 the hyperbolic conservation equations for gaseous co2 saturation and temperature are given by b 1 s g t d f g s g s g r d 2 f g t 1 d t 1 d r d 2 0 b 2 t 1 d t d g t 1 d r d 2 0 the corresponding initial and boundary conditions are given by b 3 t 1 d r d t d 0 1 b 4 t 1 d r d 0 t d 0 b 5 s g r d t d 0 0 b 6 s g r d 0 t d 1 s w r eqs b 1 and b 2 can be written in matrix form as follows b 7 s g t 1 d t d a s g t 1 d r d 2 0 where a is given by a f g s g f g t 1 d 0 g using the dimensionless parameters given by eq 25 the system of the hyperbolic conservation equations become b 8 s g t 1 t a s g t 1 r 2 0 where a is given by a q π h φ f g s g f g t 1 0 g the hyperbolic conservation equations described by eqs b 1 b 2 with the auxiliary initial and boundary conditions given by eqs b 3 b 6 constitute a non strictly hyperbolic riemann problem which can be solved by using the method of characteristics a reasonable solution of the problem is obtained by tracing the characteristic curves and introducing appropriate discontinuities to obtain a unique solution the solution procedure presented by bratvold and horne 1989 is summarized below construct the fg sg plots at the initial reservoir temperature to and the bottomhole injection temperature tinj using eq 3 see fig b 1 a plot the eigenvalues ζ and g of the system of hyperbolic conservation equations eq b 7 which are defined by eqs b 9 and b 10 versus gas saturation at both the initial aquifer temperature and the bottomhole injection temperature see fig b 1 b b 9 ζ r d 2 t d f g s g b 10 g f g α s g β where α and β are given by eq 25 add the characteristic curves with slopes fs and g by plotting tangents on the fg sg plot at the initial aquifer temperature starting from sg fg 0 0 and sg fg β α respectively the tangent points identify gas saturation at the saturation front and thermal front respectively as illustrated in fig b 1 a the solution is obtained by tracing the slope of the fractional flow curve and including the appropriate discontinuities represented by the tangent points obtained in the previous step in order to ensure the uniqueness of the solution start from sg fg 1 swr 1 which is the saturation condition at the injection well and follow the slope of the fractional flow curve evaluated at the bottomhole injection temperature up to point 1 which is the gas saturation upstream of the thermal front point 1 is obtained from the intercept of the characteristic curve with slope g thermal front tangent and the fg sg plot at the injection temperature which represents the transition point from the cold to the hot fractional flow curve see fig b 1 a then follow the g constant path up to point 2 which is the gas saturation downstream of the thermal front this transition represents the first discontinuity in the established solution shown in fig b 1 b point 2 is obtained from the tangent point between the characteristic curve with slope g and the fg sg plot at the initial aquifer temperature the fluid saturations obtained from point 1 to point 2 represent the saturations located at the thermal shock i e they have identical thermal velocity g next follow the slope of the fractional flow curve evaluated at the initial aquifer temperature up to point 3 which is the gas saturation upstream of the saturation front point 3 is obtained from the tangent point between the characteristic curve with slope dfg dsg saturation front tangent and the fg sg plot at the initial aquifer temperature see fig a 1 a the gas saturation ahead of the saturation front is equal to the initial gas saturation which is zero the transition from point 3 to point 4 represents the second discontinuity in the established solution which is located at the saturation front the fluid saturations obtained from point 3 to point 4 represent the saturations located at the saturation front i e they have identical saturation velocity dfg dsg accordingly the established solution constitutes a leading shock wave at the saturation front 3 4 followed by an expansion wave 2 3 followed by a trailing shock at the thermal front 1 2 and a zone of constant state 1 1 the zone of constant state reflects the difference in the speed of the propagation between the trailing shock wave and the expansion wave dindoruk and dindoruk 2008 the trailing shock 1 2 is of a minor saturation change and it is established due to the significant temperature contrast at the thermal front which results in different fluid mobilities fig b 1 b shows the derivative of the fg sg plots with the established saturation solution fig b 2 illustrates the saturation and temperature solutions of the advection problem versus the similarity variable ζ defined by eq b 9 appendix c derivation of the multi region analytical solution in this appendix the derivation steps of the multi region analytical solution during the injection and the shut in periods are given during the injection period the ibvp described by eqs 30 35 is solved using laplace transformation technique laplace transformation simplifies the system of the governing equations described by eq 30 into a system of odes which is given by c 1 2 t 2 d i r d 2 1 r d t 2 d i r d θ i s t 2 d i t 1 d i t d t i n j d s r d i 1 r d r d i the innermost and outermost boundary conditions are given by c 2 t 2 d 1 r d 1 t d 0 c 3 t 2 d n r d r d e 0 where rde is the outer radius of the aquifer the boundary conditions at the interfaces are described by the conservation of heat flux and the continuity of the temperature at the interfaces they are given by the following equations c 4 t 2 d i t 2 d i 1 a t r d r d i c 5 r i i 1 t 2 d i r d t 2 d i 1 r d a t r d r d i the solution of the system of odes in laplace domain is given by kreyszig 2009 c 6 t 2 d i t 1 d i t d t i n j d s c 1 i i o r d s θ i c 2 i k o r d s θ i the coefficients of the modified bessel functions are obtained using the boundary conditions described by eqs c 2 c 5 by substituting the boundary conditions into eq c 1 the system of the governing equations is simplified to the following form assuming 3 regions for simplicity c 7 i o s θ 1 k o s θ 1 0 0 0 0 i o r d 12 s θ 1 k o r d 12 s θ 1 i o r d 12 s θ 2 k o r d 12 s θ 2 0 0 r 12 s θ 1 i 1 r d 12 s θ 1 r 12 s θ 1 k 1 r d 12 s θ 1 s θ 2 i 1 r d 12 s θ 2 s θ 2 k 1 r d 12 s θ 2 0 0 0 0 r 23 s θ 2 i 1 r d s θ 2 r 23 s θ 2 k 1 r d s θ 2 s θ 3 i 1 r d s θ 3 s θ 3 k 1 r d s θ 3 0 0 i o r d 23 s θ 2 k o r d 23 s θ 2 i o r d 23 s θ 3 k o r d 23 s θ 3 0 0 0 0 s θ 3 i 1 r d e s θ 3 s θ 3 k 1 r d e s θ 3 c 11 c 21 c 12 c 22 c 13 c 23 0 t 1 d 2 s t 1 d 1 s 0 0 t 1 d 3 s t 1 d 2 s 0 the system of equations given by eq c 7 is solved using gaussian elimination technique kreyszig 2009 the solution of temperature in the real time domain is obtained using stehfest algorithm for numerical inverse laplace transform stehfest 1970 accordingly the solution of temperature for n regions at the end of the injection period in the real time domain is given by c 8 t 2 d 1 t 2 d 2 t 2 d 3 t 2 d n 1 t 2 d n t 1 d 1 t d t i n j d t 1 d 2 t d t i n j d t 1 d 3 t d t i n j d t 1 d n 1 t d t i n j d t 1 d n t d t i n j d l 1 c 11 s c 21 s c 12 s c 22 s c 13 s c 23 s c 1 n 1 s c 2 n 1 s c 1 n s c 2 n s i o r d s θ 1 i o r d s θ 2 i o r d s θ 3 i o r d s θ n 1 i o r d s θ n k o r d s θ 1 k o r d s θ 2 k o r d s θ 3 k o r d s θ n 1 k o r d s θ n where cij s s are the arbitrary coefficients the resulting solution is an approximate solution that describes the temperature profile at the end of the injection period considering heat transfer by both advection and conduction during the shut in period the same approach described above is used to solve the warmback problem described by eqs 37 40 there are two differences in the warmback problem firstly the initial condition is changed to be the temperature solution obtained at the end of the injection period which is described by eq c 8 secondly the innermost boundary condition is changed to be an isolated boundary condition the solution of the system of governing equations in laplace domain is given by c 9 t d i t 2 d i t d t i n j d s k 1 i i o r d s θ i k 2 i k o r d s θ i the coefficients involved in the system of equations given by c 9 are obtained through substituting the boundary conditions into the system of equations given by c 9 accordingly the following system of equations is obtained assuming 3 regions for simplicity c 10 s θ 1 i o s θ 1 s θ 1 k o s θ 1 0 0 0 0 i o r d 12 s θ 1 k o r d 12 s θ 1 i o r d 12 s θ 2 k o r d 12 s θ 2 0 0 r 12 s θ 1 i 1 r d 12 s θ 1 r 12 s θ 1 k 1 r d 12 s θ 1 s θ 2 i 1 r d 12 s θ 2 s θ 2 k 1 r d 12 s θ 2 0 0 0 0 r 23 s θ 2 i 1 r d s θ 2 r 23 s θ 2 k 1 r d s θ 2 s θ 3 i 1 r d s θ 3 s θ 3 k 1 r d s θ 3 0 0 i o r d 23 s θ 2 k o r d 23 s θ 2 i o r d 23 s θ 3 k o r d 23 s θ 3 0 0 0 0 s θ 3 i 1 r d e s θ 3 s θ 3 k 1 r d e s θ 3 k 11 k 21 k 12 k 22 k 13 k 23 0 t 2 d 2 s t 2 d 1 s 0 0 t 2 d 3 s t 2 d 2 s 0 the above system of equations is solved using gaussian elimination method to obtain the temperature solution in laplace domain the solution in the real time domain is obtained using stehfest algorithm stehfest 1970 accordingly the temperature solution during the warmback period in the real time domain for n regions is given by c 11 t d 1 t d 2 t d 3 t d n 1 t d n t 2 d 1 t d t i n j d t 2 d 2 t d t i n j d t 2 d 3 t d t i n j d t 2 d n 1 t d t i n j d t 2 d n t d t i n j d l 1 k 11 s k 12 s k 13 s k 1 n 1 s k 1 n s k 21 s k 22 s k 23 s k 2 n 1 s k 2 n s i o r d s θ 1 i o r d s θ 2 i o r d s θ 3 i o r d s θ n 1 i o r d s θ n k o r d s θ 1 k o r d s θ 2 k o r d s θ 3 k o r d s θ n 1 k o r d s θ n where kij s s are the arbitrary coefficients the sandface temperature is obtained by assigning rd 1 into the solution of the innermost region and it is given by c 12 t w d δ t d t 2 d 1 t d t i n j d l 1 k 11 s i o s θ 1 l 1 k 21 s k o s θ 1 appendix d derivation of the three region analytical solution in this appendix the solution of the ibvp described by eqs 43 52 is obtained using laplace transformation technique the system of the governing equations for the three regions is simplified to odes in laplace domain as follows d 1 2 t d 1 r d 2 1 r d t d 1 r d θ 1 s t d 1 0 0 r d r t d d 2 2 t d 2 r d 2 1 r d t d 2 r d θ 2 t d 2 1 s r t d r d r s d d 3 2 t d 3 r d 2 1 r d t d 3 r d θ 3 s t d 3 1 s r s d r d the corresponding innermost and outermost boundary conditions in laplace domain are given by d 4 lim r d 0 t d 1 r d 0 d 5 lim r d t d 3 r d 0 the boundary conditions at the interfaces of the regions in laplace domain are given by d 6 r 12 t d 1 r d r d r t d t d 2 r d r d r t d d 7 t d 1 r d r t d s t d 2 r d r t d s d 8 r 23 t d 2 r d r d r s d t d 3 r d r d r s d d 9 t d 2 r d r s d s t d 3 r d r s d s the solutions of the odes described by eqs d 1 d 3 are given by kreyszig 2009 d 10 t d 1 c 1 i o r d s θ 1 c 2 k o r d s θ 1 d 11 t d 2 1 s c 3 i o r d s θ 2 c 4 k o r d s θ 2 d 12 t d 3 1 s c 5 i o r d s θ 3 c 6 k o r d s θ 3 the arbitrary coefficients are obtained using the boundary conditions described by eqs d 4 d 9 accordingly the solutions of the three regions in laplace domain are given by d 13 t d 1 r d δ t d l 1 c 1 s i o r d s θ 1 d 14 t d 2 r d δ t d 1 l 1 c 3 s i o r d s θ 2 c 4 s k o r d s θ 2 d 15 t d 3 r d δ t d 1 l 1 c 6 s k o r d s θ 3 where d 16 c 1 φ ψ c 3 ω ψ c 4 x ψ c 6 θ ψ and d 17 φ θ 2 r 23 k o r s d s θ 3 i 1 r s d s θ 2 k 1 r t d s θ 2 i 1 r t d s θ 2 k 1 r s d s θ 2 θ 2 θ 3 k 1 r s d s θ 3 i 1 r t d s θ 2 k o r s d s θ 2 i o r s d s θ 2 k 1 r t d s θ 2 d 18 ω r 12 θ 1 i 1 r t d s θ 1 θ 3 k o r s d s θ 2 k 1 r s d s θ 3 r 23 θ 2 k o r s d s θ 3 k 1 r s d s θ 2 d 19 x r 12 θ 1 i 1 r t d s θ 1 θ 3 i o r s d s θ 2 k 1 r s d s θ 3 r 23 θ 2 k o r s d s θ 3 i 1 r s d s θ 2 d 20 θ r 12 r 23 θ 1 r s d s i 1 r t d s θ 1 d 21 ψ s r 12 θ 1 i 1 r t d s θ 1 r 23 θ 2 k o r s d s θ 3 i 1 r s d s θ 2 k o r t d s θ 2 i o r t d s θ 2 k 1 r s d s θ 2 θ 3 k 1 r s d s θ 3 i o r s d s θ 2 k o r t d s θ 2 i o r t d s θ 2 k o r s d s θ 2 θ 2 i o r t d s θ 1 r 23 θ 2 k o r s d s θ 3 i 1 r s d s θ 2 k 1 r t d s θ 2 i 1 r t d s θ 2 k 1 r s d s θ 2 θ 3 k 1 r s d s θ 3 i 1 r t d s θ 2 k o r s d s θ 2 i o r s d s θ 2 k 1 r t d s θ 2 the sandface temperature solution is obtained by assigning rd 0 in eq d 13 which yields d 22 t w d δ t d l 1 φ ψ at early shut in times an asymptotic solution of the sandface temperature can be obtained using the following asymptotic expansions of the modified bessel functions at large argument abramowitz and stegun 1964 d 23 lim z i v z e z 2 π z d 24 lim z k v z π 2 z e z consequently the early time asymptotic solution in laplace domain is given by d 25 t w d s π θ 1 2 r t d 1 s 3 4 e r t d s θ 1 the corresponding early time asymptotic solution in the real time domain is obtained using inverse laplace transformation abramowitz and stegun 1964 which is given by d 26 t w d δ t d r t d θ 1 2 π e θ 1 r t d 2 8 δ t d δ t d k 1 4 θ 1 r t d 2 8 δ t d e θ 1 r t d 2 4 δ t d 
142,temperature analysis during a pause in injection operations known as warmback analysis has been used in the petroleum industry for evaluating the injection conformance and estimating the location of the flooded front in applications such as waterflooding oil reservoirs in this work methods are introduced to extend the application of temperature warmback analysis to estimate the zonal co2 injection rate and zonal co2 plume extent during geologic co2 storage in a saline aquifer first novel analytical solutions are developed to model transient temperature in the aquifer during the injection and subsequent shut in periods considering two phase flow gaseous co2 and aqueous brine conditions in the aquifer the solution involves a discretization of the aquifer into regions the energy and mass conservation equations for the regions are solved simultaneously considering appropriate boundary conditions at the interfaces two solutions techniques are presented multi region and three region solutions inverse models are developed accordingly to evaluate the injection profile and estimate the extent of the plume front in the reservoir during the injection period the multi region solution results in an inversion approach that requires regression analysis however the three region formulation results in a simple graphical technique for inverse modeling the analytical solutions are validated against a thermally coupled reservoir simulation tool using different synthetic cases for co2 injection in deep saline aquifers the results of the developed solutions provide a good match with numerical results during forward and inverse modeling keywords temperature warmback analysis geologic co2 storage zonal injection rate allocation plume extent nomenclature α dimensionless parameter defined by eq 25 β dimensionless parameter defined by eq 25 b intercept of the fitted line with the vertical axis ct cw cg cr heat capacity of aquifer brine gas and rock l2 t2t btu lbm f j kg k dts distributed temperature sensing ϕ porosity fraction h reservoir thickness l ft m ibvp initial boundary value problem in modified bessel function of the first kind of an order n kn modified bessel function of the second kind of an order n k reservoir permeability l2 md m2 l 1 inverse laplace transformation operator q injection rate l3 t bbl day m3 s rsw rt radius of the plume and thermal front respectively l ft m s laplace dummy variable sg co2 saturation fraction t time t day s tinj injection time t day s t shut in time t day s tdinj dimensionless injection time td dimensionless shut in time t reservoir temperature t f k to initial reservoir temperature t f k tinj injected fluid temperature t f k tw sandface temperature t f k td dimensionless reservoir temperature uw darcy velocity l t ft day m s λt λr λw λg thermal conductivity of aquifer rock brine and co2 respectively m l t3t btu ft hr f w m k ρw ρr ρg density of brine rock and co2 respectively m l3 kg m3 1 introduction geologic carbon dioxide co2 storage gcs has been identified as a promising technique to mitigate climate change by reducing atmospheric greenhouse gas emissions among the potential options for geologic co2 storage saline aquifers are considered the prime candidate because of their widespread availability and their large storage capacity in terms of pore volume bachu 2000 aminu et al 2017 for successful implementation of gcs technology high injection rates are desirable to accommodate the industrial scale of co2 storage ipcc 2005 to achieve the desirable co2 injection rates co2 will be likely injected into thick multi zone aquifers that may constitute different layers with different lithologies the vertical heterogeneity of the storage aquifer can result in a non uniform injection rate distribution over the injection interval which results in poor sweep efficiency and inefficient utilization of the potential storage capacity of the storage aquifer oldenburg 2021 consequently monitoring the injection profile during co2 storage is essential to maintain uniform injection profile and achieve higher storage capacity of the storage aquifer among the methods that are used to monitor fluid flow in the wellbore temperature monitoring has recently been deployed to identify the injection zones and assess the effectiveness of the injection intervals the recent developments in the permanent downhole monitoring tools such as fiber optic dts distributed temperature sensing make real time temperature data accessible with high accuracy and resolution high performance dts systems can provide temperature data with spatial resolution down to few centimeters temporal resolution as short as 1 s and accuracy on the order of 0 01 c additionally dts tools have the flexibility to be installed in well permanently semi permanently or retrievably and they can be deployed via tubing inside the wellbore or cemented behind the casing huckabee 2009 the alternative techniques for fluid flow monitoring such as spinner survey have certain limitations for specific applications deployment of spinner survey may be infeasible in some applications because of injection deferment limited access to wellbore especially for deep injection wells cost and associated risks additionally the threshold fluid velocity of the flowmeter can be higher than the local fluid velocity in the wellbore which limit the applicability of the spinner survey to monitor injection wells operated at relatively high injection rates bateman 1985 many studies have been presented to demonstrate the potential capability of temperature monitoring for allocating flow rate through injection wells in the petroleum industry however few studies are devoted to show its application for monitoring injection profile in co2 injection wells in gcs projects brown et al 2003 brown et al 2004 bui and jalali 2004 foo et al 2014 horst et al 2015 hashish and zeidouni 2019a 2019b 2021a 2021b hashish and zeidouni 2021d 2021e different temperature interpretation techniques have been used in the oil and gas industry to provide qualitative quantitative estimation of injection profile during non isotheral fluid injection applications such as water flooding and enhanced oil recovery eor huckabee 2009 van der horst 2015 hemink et al 2016 these techniques can be applied for fluid flow monitoring using temperature data acquired during injection or shut in conditions temperature warmback analysis is one of the promising techniques that has been used to quantify injection profile during non isothermal fluid injection in a reservoir temperature decreases within the swept region mainly due to heat transfer caused by the injected fluid movement advection the temperature perturbation during the injection period will be followed by a temperature recovery during a pause in the injection activity the rate of temperature recovery during well shut in is dependent on the injectivity profile and the thermal properties of the formation and the injected fluid regions with higher injectivity exhibit lag in temperature recovery compared with those of lower injectivity consequently analyzing the temperature recovery over the injection interval can be used to give a quantitative estimation of the injection profile if the bottomhole temperature of the injected fluid is lower than the formation s temperature temperature warmback will be observed when injection is paused warmback analysis has the potential to isolate the thermal effects associated with the fluid flow in the wellbore because it is performed during a shut in period many studies are devoted to show the application of temperature warmback analysis to estimate injection profile during cold fluid injection in hydrocarbon reservoirs in these studies analytical and semi analytical models are developed by solving heat transport equation in the reservoir assuming single phase fluid flow pimenov et al 2005 hashish and zeidouni 2019a 2019b 2020 2021a 2021c 2021e in the context of co2 injection in deep saline aquifer different heat transfer processes evolve during co2 flow in the aquifer which result in a characteristic temperature profile the hydrothermal processes include 1 joule thomson expansion of co2 during co2 flow from the wellbore into the formation which results in temperature cooling 2 heat of dissolution which is released due to the exothermic co2 dissolution into the in situ brine at the plume front 3 heat of vaporization which is absorbed due to the endothermic brine vaporization into the flowing co2 4 heat conduction in the flow direction and the heat exchange with the surrounding strata and 5 heat transfer by advection which is driven by the bulk co2 movement and the contrast between the bottomhole temperature of the injected co2 and the initial reservoir temperature bielinski et al 2008 han et al 2010 mathias et al 2010 han et al 2012 zhao and cheng 2015 jayne et al 2019 the evolution of the bottomhole temperature of co2 is attributed to different factors such as the anthropogenic origin i e surface temperature of the injected co2 or the thermodynamic processes that evolve during co2 flow in the wellbore such as adiabatic compression of co2 heat exchange between co2 and the surrounding strata frictional energy loss and the potential energy loss i e work done on co2 by gravity force han et al 2012 the implications of the two phase flow conditions and the different hydrothermal processes that evolve during co2 storage in a saline aquifer make the already published solutions inefficient to estimate co2 injection profile to extend the application of temperature warmback analysis for estimating co2 injection profile during gcs a development of a new model that solves mass and heat conservation equations during two phase flow conditions gaseous co2 and aqueous brine in the storage aquifer is required in this work we show the application of temperature warmback analysis for gcs monitoring considering the two phase flow conditions that attain during co2 storage in a brine saturated aquifer first we present a numerical investigation to demonstrate the contribution of the hydrothermal processes to the temperature evolution during cold co2 injection in a saline aquifer the objective of this investigation is to determine the dominant hydrothermal processes and implications for the assumptions that can be made to obtain an analytical solution to the problem next novel analytical solutions are presented to model temperature evolution during co2 injection and a subsequent shut in period inversion procedures are provided accordingly to estimate the injection rate the radius of the thermal front the radius of the plume front and the initial temperature all per layer the results obtained using the proposed solutions and the inversion procedures are validated against those obtained using the thermal simulation tool tough3 jung et al 2018 we considered cold fluid injection in this study for consistency but the proposed analysis is equally valid for warm fluid injection applications the approach developed in this work can be used to design a thermal test at the beginning of co2 storage to allocate zonal co2 injection rate among the injection zones which in turn helps to assess the heterogeneity of the target reservoir and improve the efficiency of the completion design to achieve proper co2 storage 2 forward modeling 2 1 multi region analytical model in this section an analytical solution is developed to describe the transient temperature in an aquifer during non isothermal co2 injection and the following shut in period the solution procedure is to solve the energy balance equation during co2 brine displacement process subject to specific initial and boundary conditions that correspond to the injection and shut in conditions in appendix a we present a 1 d radial numerical simulation using tough3 eco2n simulation tool for a base case example problem to demonstrate the contribution of the hydrothermal processes to the temperature evolution during cold co2 injection in the subsurface the numerical investigation shows that temperature evolution during the injection period is dominated by advection mechanism consequently heat transfer by advection is considered the dominant mechanism of heat transfer during solving the energy and mass conservation equations besides the effect of mutual dissolution on temperature evolution can be negligible accordingly the following assumptions are used during formulating and solving the problem co2 is injected with constant injection rate q and constant injection temperature tinj in an aquifer with initial temperature to for an injection duration tinj then injection stops to allow for the temperature recovery see fig 1 the aquifer consists of multiple layers each layer is assumed to be homogenous isotropic and of an infinite extent in the lateral direction with a uniform thickness h however the aquifer can be vertically heterogeneous i e the properties of the layers are different fluid flow is assumed to be 1d radial flow fluid displacement is immiscible no mass transfer occurs between the displacing and the displaced fluids heat transfers in the flow direction by advection and conduction heat exchange with the surrounding strata is negligible during the injection and shut in periods no phase change occurs over the displacement length dindoruk and dindoruk 2008 fractional flow curve is a function of saturation and temperature only bratvold and horne 1989 capillary and gravity forces are neglected during the injection and shut in periods bratvold and horne 1989 energy contributions from kinetics and stresses pressure are neglected the mass conservation equation for co2 rich gaseous phase is described by the following hyperbolic equation 1 t φ ρ g s g 1 r r r ρ g u g 0 where u g q g a q g 2 π r h is gas phase velocity ρ g is gas phase density s g is gas phase saturation and φ is formation porosity using the assumption of incompressible fluid flow which is feasible for the brine and the supercritical state nature of the injected co2 the mass conservation equation is simplified to the following form buckley and leverett 1942 2 s g t q π h φ f g r 2 0 the volumetric fractional flow is the ratio of co2 rich gaseous phase velocity to the mixture brine co2 velocity which is given by 3 f g s g t u g u k r g μ g k r g μ g k r w μ w 1 1 k r w k r g μ g μ w since the fractional flow of co2 is only a function of temperature and co2 saturation due to the temperature dependency of viscosity ratio and the saturation dependency of relative permeability dindoruk and dindoruk 2008 respectively the mass conservation equation can be written in the following form using the chain rule 4 s g t q π h φ f g s g s g r 2 f g t t r 2 0 the energy balance equation for an immiscible co2 brine displacement is described by the following advection diffusion equation duru and horne 2010 app 2010 mao and zeidouni 2017 5 t ρ t c t t r ρ t c t u t t 1 r r λ t r t r where 6 ρ t c t φ ρ g c g s g ρ w c w 1 s g 1 φ ρ r c r 7 ρ t c t u t ρ g c g u g ρ w c w u w ρ g c g f g ρ w c w 1 f g u 8 λ t φ λ g s g λ w 1 s g 1 φ λ r assuming that porosity is constant that fluids have constant density and heat capacity and the change in the total thermal conductivity is negligible the governing equation is simplified to the following form after few manipulations 9 ρ g c g t φ s g t u f g r ρ w c w t φ 1 s g t u 1 f g r φ s g ρ g c g 1 s g ρ w c w 1 φ ρ r c r t t f g ρ g c g 1 f g ρ w c w u t r φ λ w s w λ g 1 s g 1 φ λ r 1 r r r t r the quantities in the parenthesis are identical to the mass conservation equations for co2 and brine and so the parenthesis terms are equal to zero finally re arranging the remaining temperature terms and dividing the equation by ϕ ρ g cg ρ w cw results in the following form 10 s g ρ w c w 1 φ φ ρ r c r ρ g c g ρ w c w t t f g ρ w c w ρ g c g ρ w c w q 2 π h φ 1 r t r λ g λ w ρ g c g ρ w c w s g λ w 1 φ φ λ r λ g λ w 1 r r r t r the mass and energy balance equations are subject to the following initial and boundary conditions 11 s g r t 0 0 12 s g r r w t 1 s w r 13 t r t 0 t o 14 t r r w t t i n j where swr is the residual water saturation eqs 11 and 12 describe the initial condition and boundary conditions for co2 mass conservation equation respectively while eqs 13 and 14 describe the initial and boundary condition for heat conservation equation respectively the governing equation of the above initial boundary value problem ibvp is a non linear advection diffusion equation because of the dependency of the fractional flow term fg on the temperature obtaining an exact analytical solution to the ibvp is difficult rather a semi analytical solution is presented using the operator splitting technique operator splitting technique is an approximate technique that allows the advection diffusion problem to be broken into two sub problems advection and diffusion where each problem can be solved separately the advection problem is solved at a time step considering the same initial and boundary conditions of the main ibvp next the diffusion problem is solved using the same boundary conditions of the main problem however the initial condition of the diffusion problem is the temperature solution obtained from the advection problem at the end of the time step holden et al 2000 duru and horne 2010 bahar and gürarslan 2017 generally this technique provides good results for small time steps accordingly the main ibvp described by eqs 10 14 is divided into an advection problem which is defined by eqs 15 20 and a diffusion problem which is defined by eqs 21 24 in this case a single time step is adopted for the operator splitting approach which equals the injection period 15 s g ρ w c w 1 φ φ ρ r c r ρ g c g ρ w c w t 1 t f g ρ w c w ρ g c g ρ w c w q π h φ t 1 r 2 0 16 s g t q π h φ f g s g s g r 2 f g t 1 t 1 r 2 0 the corresponding initial and boundary conditions are given by 17 s g r t 0 0 18 s g r r w t 1 s w r 19 t 1 r t 0 t o 20 t 1 r r w t t i n j 21 s g ρ w c w 1 φ φ ρ r c r ρ g c g ρ w c w t 2 t λ g λ w ρ g c g ρ w c w s g λ w 1 φ φ λ r λ g λ w 1 r r r t 2 r the corresponding initial and boundary conditions are given by 22 t 2 r t 0 t 1 r t t i n j 23 t 2 r r w t t i n j 24 lim r t 2 r 0 the mass conservation equation is not included when solving for the diffusion problem because the contribution of heat conduction slightly affects the location of the thermal front platenkamp 1985 the advection problem constitutes energy and saturation conservation equations expressed in the form of hyperbolic partial differential equations described by eqs 15 and 16 the advection problem has been solved by bratvold and horne 1989 in which the authors used the method of characteristics to solve the coupled non linear hyperbolic conservation equations the details of their solution procedure are presented in appendix b for completeness according to which the temperature and saturation profiles at the end of the injection period are obtained see fig b 2 the temperature profile obtained during the injection period is characterized by step change in the temperature at the thermal front from the injection temperature to initial aquifer temperature 2 2 multi region model solution in the next step the contribution of heat conduction to the temperature solution is obtained by solving the diffusion problem described by eqs 21 24 considering the temperature solution obtained from the advection problem as the initial condition the ibvp is rescaled using the following dimensionless parameters 25 t d t t i n j t o t i n j t d q t φ π r w 2 h r d r r w α ρ w c w ρ g c g ρ w c w β ρ w c w 1 φ φ ρ r c r ρ g c g ρ w c w η λ g λ w ρ g c g ρ w c w γ λ w 1 φ φ λ r λ g λ w χ q π h φ η g f g α s g β the governing equation of the diffusion ibvp in dimensionless form is given by 26 2 t 2 d r d 2 1 r d t 2 d r d θ r d t 2 d t d where θ r d s g r d β s g r d γ χ the corresponding initial and boundary conditions are given by 27 t 2 d r d t d 0 t 1 d r d t d t i n j d 28 t 2 d r d 1 t d 0 29 lim r d t 2 d r d 0 the governing equation described by eq 26 is a heat diffusion equation with a spatially variable coefficient the problem is solved by discretizing the aquifer into n regions in which the coefficient θ rd is constant per region and evaluated at the average saturation within the region the resulting multi region heat diffusion problem is given by 30 2 t 2 d i r d 2 1 r d t 2 d i r d θ i t 2 d i t d r d i 1 r d r d i the initial conditions for the system of the governing equations are given by 31 t 2 d i r d t d 0 t 1 d i r d t d t i n j d r d i 1 r d r d i the innermost and outermost boundary conditions are given by 32 t 2 d 1 r d 1 t d 0 33 t 2 d n r d r d e 0 where rde is the outer radius of the aquifer the boundary conditions at the interfaces are described through the conservation of heat flux and the continuity of the temperature solution at the interfaces they are described by the following equations 34 t 2 d i t 2 d i 1 a t r d r d i 35 r i i 1 t 2 d i r d t 2 d i 1 r d a t r d r d i where r i j ε i ε j and ε i s g i λ w 1 φ φ λ r λ g λ w by solving the advection diffusion problem using the operator splitting technique an approximate solution that describes the temperature profile at the end of the injection period considering heat transfer by both advection and conduction is obtained during the shut in period that follows the injection process the governing equation for the heat transfer in the reservoir is simplified to a purely heat diffusion equation because fluid velocity during the shut in period is negligible the governing equation that describes the heat transfer in the aquifer during the shut in period is given by 37 2 t d r d 2 1 r d t d r d θ r d t d δ t d where δtd td tinjd the above equation is subject to the following initial and boundary conditions 38 t d r d δ t d 0 t 2 d r d t d t i n j d 39 t d r d r d 1 0 40 lim r d t d r d 0 the ibvp during the warmback period is similar to the diffusion problem during the injection period however the innermost boundary condition is replaced by an isolated boundary condition eq 39 and the initial condition is replaced by the temperature solution obtained at the end of the injection period eq 38 laplace transformation technique is used to solve the heat conduction problem during the injection and shut in periods the solutions details are presented in appendix c according to which the sandface temperature solution during the shut in period is obtained by assigning rd 1 into the solution of the innermost region and is given by 42 t w d δ t d t 2 d 1 t d t i n j d l 1 k 11 s i o s θ 1 l 1 k 21 s k o s θ 1 where t 2d 1 td tinjd is the temperature solution at the end of the injection period for the inner most region the obtained solution is used to infer the injection profile over the storage aquifer and estimate the location of the co2 saturation front by history matching the analytical based temperature recovery with the observed temperature recovery as will be shown in section 3 2 3 three region analytical model in this section a three region analytical solution is presented for modeling the transient temperature in the aquifer during the warmback period considering the solution of the advection problem as the initial condition the aquifer is discretized into three regions as shown in fig 2 in which region 1 extends from the injection well to the thermal front region 2 extends from the thermal front to the saturation front region 3 extends from the saturation front to the outer boundary of the reservoir in this solution the effect of heat diffusion during the injection period is neglected for simplicity consequently temperature profile is described by step change in the temperature at the thermal front where the temperature upstream of the thermal front is identical to the injection temperature region 1 and the temperature downstream of the thermal front is identical to the initial aquifer temperature region 2 and region 3 during the shut in period heat transport equations for the discretized regions are described by heat conduction equations accordingly governing equations for heat transfer during the shut in period for the discretized regions are given by 43 2 t d 1 r d 2 1 r d t d 1 r d θ 1 t d 1 δ t d 0 r d r t d 44 2 t d 2 r d 2 1 r d t d 2 r d θ 2 t d 2 δ t d r t d r d r s d 45 2 t d 3 r d 2 1 r d t d 3 r d θ 3 t d 3 δ t d r s d r d the corresponding initial conditions are given by 46 t d 1 r d δ t d 0 0 47 t d 2 r d δ t d 0 1 48 t d 3 r d δ t d 0 1 the innermost and outermost boundary conditions are well described using thermally isolated boundary conditions which are given by 49 lim r d 0 t d 1 r d 0 50 lim r d t d 3 r d 0 the boundary conditions at the interfaces of the regions are described through the conservation of heat flux and the continuity of temperature which are given by 51 r 12 t d 1 r d r d r t d t d 2 r d r d r t d t d 1 r d r t d δ t d t d 2 r d r t d δ t d 52 r 23 t d 2 r d r d r s d t d 3 r d r d r s d t d 2 r d r s d δ t d t d 3 r d r s d δ t d where r i j ε i ε j and ε i s g i λ w 1 φ φ λ r λ g λ w 2 4 three region model solution the solution of the ibvp described by eqs 43 52 is obtained using laplace transformation technique in laplace domain the solution of the governing equations is obtained in terms of the modified bessel functions the details of the solution procedure are given in appendix d by which the sandface temperature solution during the warmback period is given by 53 t w d δ t d l 1 φ ψ where 54 φ θ 2 r 23 k o r s d s θ 3 i 1 r s d s θ 2 k 1 r t d s θ 2 i 1 r t d s θ 2 k 1 r s d s θ 2 θ 2 θ 3 k 1 r s d s θ 3 i 1 r t d s θ 2 k o r s d s θ 2 i o r s d s θ 2 k 1 r t d s θ 2 55 ψ s r 12 θ 1 i 1 r t d s θ 1 r 23 θ 2 k o r s d s θ 3 i 1 r s d s θ 2 k o r t d s θ 2 i o r t d s θ 2 k 1 r s d s θ 2 θ 3 k 1 r s d s θ 3 i o r s d s θ 2 k o r t d s θ 2 i o r t d s θ 2 k o r s d s θ 2 θ 2 i o r t d s θ 1 r 23 θ 2 k o r s d s θ 3 i 1 r s d s θ 2 k 1 r t d s θ 2 i 1 r t d s θ 2 k 1 r s d s θ 2 θ 3 k 1 r s d s θ 3 i 1 r t d s θ 2 k o r s d s θ 2 i o r s d s θ 2 k 1 r t d s θ 2 inverse laplace transformation is performed numerically using stehfest algorithm stehfest 1970 to obtain the solution in the real time domain at early shut in time an asymptotic solution of the sandface temperature is be obtained which is given by see appendix d for more details 56 t w d δ t d r t d θ 1 2 π e θ 1 r t d 2 8 δ t d δ t d k 1 4 θ 1 r t d 2 8 δ t d e θ 1 r t d 2 4 δ t d the above equation is re written below in a dimensional form using the dimensionless group given by eq 25 57 δ t w δ t t o t i n j e 1 4 s g 1 β s g 1 γ r t 2 η δ t where s g 1 is the average gas saturation within region 1 eq 57 is identical to the temperature solution for a single region reservoir which has thermal properties and fluid saturation identical to the innermost region this indicates that at the early shut in time the properties of the innermost region dominate the temperature recovery at injection well the early time asymptotic solution presents a simple form for the temperature recovery at the shut in period which can be casted into a simple graphical technique for the inverse modeling as will be shown in the next section 3 inverse modeling in this section inversion procedures are presented using the analytical solutions developed in section 2 to estimate the injection profile the radius of the saturation front the radius of the thermal front and the initial geotherm prior to co2 injection two types of inversion techniques are presented according to the type of analytical solution to be used multi region solution vs three region solution since the multi region solution is not presented in a closed form regression analysis is used to iterate on the injection profile that reproduces the temperature recovery observed during the shut in period the fitness function should consider the injection constraint i e summation of estimated injection rates for the injection zones must sum up to the total injection rate besides the estimation error of the temperature results an optimization routine namely genetic algorithm press et al 1992 is used in this work to perform the regression analysis the location of the saturation and thermal fronts are obtained accordingly using the optimum injection profile obtained through the regression analysis the second technique of inverse modeling is done using the early time asymptotic solution given by eq 57 this technique is fast and simple compared with the regression analysis the inversion procedure is as follows construct the solution of the advection problem using bratvold and horne 1989 procedure as illustrated in appendix b the solution describes the temperature and gas saturation profiles at the end of the injection period versus the similarity variable ζ similar to fig b 1 b in appendix b and fig 3 b in the validation section plot the change in the sandface temperature δtw δt tw δt tinj for the layer of interest versus 1 δ t on a semi log scale such that the temperature change is plotted on the logarithmic scale identify the portion of the plotted data to be fitted with a straight line estimate the slope m and the intercept with the vertical axis b of the fitted line the initial temperature of the layer of interest is estimated by 58 t o t i n j b the location of the thermal front is estimated by 59 r t 4 η s g 1 γ s g 1 β m where η γ and β are given by eq 25 and the fluid properties are estimated at the initial conditions the average gas saturation within the near wellbore region s g 1 can be obtained by averaging the saturation values located upstream of the thermal front in the sg ζ profile obtained in the first step the injection rate at the layer of interest is estimated using eq 60 where ζ t is the velocity of the thermal front which is given by f g s g 1 α s g 1 β or f g s g 2 α s g 2 β s g1 is the gas saturation upstream of the thermal front s g2 is the gas saturation downstream of the thermal front and α and β are given by eqs 25 s g1 is obtained from the intercept of the thermal tangent with fg sg plot at the injection temperature and s g2 is obtained from the tangent point of the thermal tangent on fg sg plot at the initial temperature 60 q 1 ζ t π r t 2 h φ t i n j the radius of the saturation front is estimated using eq 61 where ζ s g is the velocity of the saturation front which is given by the slope of the saturation tangent with fg sg plot at the initial temperature 61 r s g q t i n j π h φ ζ s g the results of the developed forward and inverse models presented in sections 2 and 3 are validated against numerical results in the next sections to demonstrate their validity 4 solutions validation in this section the developed forward models are validated against the results of the numerical reservoir simulator tough3 eco2n tough3 is a numerical simulator capable of simulating nonisothermal multiphase and multicomponent fluid flow in multidimensional porous media jung et al 2018 eco2n is a fluid property module that describes the thermophysical properties of brine and co2 system pruess 2005 two synthetic cases are presented for the benchmarking the first case is presented for a single zone aquifer with homogenous and isotropic properties which are identical to the base case presented in the appendix a see table a 1 the second case is presented for a heterogeneous multi zone aquifer that is subject to co2 injection via a commingled injection well see table 3 in both cases co2 is injected at a bottomhole temperature lower than the initial reservoir temperature then injection stops to allow for temperature recovery 4 1 single layer case in the base case co2 is injected at a constant injection rate of 145 6 m3 day and a constant bottomhole injection temperature of 20 c into an aquifer for a period of 3 days before the well is shut in to allow for the warmback the rock and fluid properties of the aquifer are given in table a 1 the developed forward models presented in section 2 are used to model the transient temperature in the aquifer during the injection and the following shut in periods fig 3 a illustrates fg sg plots of the co2 evaluated at the initial reservoir temperature 65 c and the injection temperature 20 c using eq 3 relative permeability for the aqueous phase is described using mualem 1976 and van genuchten 1980 and the co2 rich gaseous phase relative permeability is described using corey 1954 see table a 2 the input data for the relative permeability and capillary pressure models are given in table a 1 the solution procedure presented in appendix b is adopted to solve the advection problem fig 3 a shows the fg sg plots with the characteristic curves which have slopes of g and dfg dsg co2 saturations at the saturation and temperature fronts are obtained accordingly from the tangent points and the solution is presented in terms of the similarity variable ζ in fig 3 b next the multi region and the three region solutions are used to obtain the temperature profile by the end of the injection period 3 days as shown in fig 4 a it is observed that thermal front lags behind the saturation front due to the thermal storage capacity of the reservoir rock the extent of the thermal front propagation by the end of the injection period is 3 m while the extent of the plume front is 15 m because the three region solution assumes advection dominant heat transfer during the injection period the temperature profile obtained using this technique shows a step change in the temperature at the thermal front from the injection temperature to the initial temperature on the other hand in the multi region solution both advection and conduction heat transfer mechanisms are considered which result in a smearing of the thermal front saturation results obtained using bratvold and horne 1989 show good agreement with the numerical results except at the near wellbore region due to neglecting the dry out region two saturation shocks can be observed in the saturation profile the main saturation shock is located at the plume front 15 m and a minor saturation shock is located at the thermal front 3 m the latter is established due to the temperature contrast between the initial aquifer temperature and the bottomhole injection temperature the size of the dry out region by the end of the injection period is 0 4 m which is negligible compared with the sizes of the thermal disturbance region and the two phase region fig 4 b illustrates the temperature profile during the warmback periods at t 7 14 21 and 30 days the temperature perturbation created by the cold co2 injection dissipates by the effect of heat diffusion in the aquifer as shut in time increases heat diffuses from the unswept and warm region toward the swept region and results in temperature warmback at the injection well fig 5 illustrates the sandface temperature recovery during the shut in period which increases by 12 c by the end of the shut in period overall a good match is obtained between the analytical solutions and the numerical results however the multi region solution provides a better match with the numerical results compared with the three region solution the number of regions implemented in the multi region solution is 170 regions 4 2 five layer case in this case a 5 layer aquifer with different permeability per layer k 900 700 500 300 and 100 md is subject to cold co2 injection at a constant injection rate of 460 m3 day and a constant bottomhole injection temperature of 20 c see table 3 each layer is 10 m thick the injection profile as obtained from the numerical model is 165 129 92 55 and 18 m3 day for the injection layers from the top to the bottom of the aquifer the analytical models presented in section 2 are used to model the transient temperature during the injection and the shut in periods in each layer first the solution procedure presented in appendix b is used to solve the advection problem fig 3 a illustrates the fg sg plots at the initial reservoir temperature and the bottomhole injection temperature with the characteristic curves fig 3 b illustrates the derivative of the fractional flow curves along with the established solution fig 6 a shows the transient temperature and co2 saturation profiles at the end of the injection period for the layer 1 uppermost layer as obtained from tough3 the three region solution and the multi region solution the extent of co2 plume propagation by the end of the injection period is 15 5 m while the extent of the thermal front is 3 5 m fig 6 b illustrates the temperature profiles in layer 1 during the warmback period at t 7 14 21 and 30 days fig 7 illustrates the sandface temperature recovery over the injection zones during the warmback period different rates of temperature recovery are obtained during the shut in period due to the different injectivities of the injection layers layer 5 which has the lowest permeability k 100 md accepts the lowest percentage of the injected volume and consequently exhibits the highest temperature rebound during the shut in period on the other hand layer 1 which has the highest permeability k 900 md accepts most of the injected volume and consequently exhibits the lowest temperature rebound during the shut in period the temperature recovery for layer 1 is 8 c compared with 38 c for layer 5 at t 30 days based on these observations the characteristics of the temperature recovery reflect the injection profile and the distribution of the injected co2 over the reservoir thickness it is obtained from fig 7 that the multi region solution provides better match with the numerical results compared with the three region solution the three region solution provides underestimated temperature results at the early shut in time because it neglects the effect of heat transfer by conduction during the injection period as the injection rate increases the relative contribution of advection mechanism compared with the conduction mechanism known as péclet number increases this is why the deviation in the results obtained using three region solution and multi region solution decreases as injection rate increases from layer 5 18 m3 day to layer 1 165 m3 day based on the validation results presented in this section the multi region solution provides better match with the numerical results compared with the three region solution in the next section the inversion procedure presented in section 3 is used to infer the injection profile and the distribution of the co2 over the aquifer thickness 5 inverse modeling application in this section the inversion procedure introduced in section 3 is used for the inverse modeling two approaches are utilized based on the forward model the first approach is to use regression analysis along with the multi region solution while the second approach is to use the three region based graphical technique genetic algorithm is used as an optimization routine to perform the regression analysis for the multi region solution the results of the inverse modeling using the regression analysis for case 1 and case 2 are given in tables 4 and 5 respectively fig 8 shows the solution progress and the fitting error during the regression analysis fig 9 shows the application of the graphical technique for case 1 and case 2 disagreement is evident between the asymptotic solution and the numerical results at the early shut in time this can be attributed to neglecting the effect of heat conduction during the injection period and the adiabatic expansion of co2 at the sandface region when injection stops which results in slight decrease in the temperature signal before the warmback the corresponding inversion results for case 1 and case 2 are given in tables 4 and 5 respectively the calculations steps are shown below for case 1 using the thermal properties evaluated at the initial conditions given in table 3 the parameters β η and γ are 4 70 2 642 10 7 and 12 254 respectively the average gas saturation within region 1 s g 1 is 0 536 which is obtained from fig 3 b the initial reservoir temperature the radius of the thermal front the injection rate and the radius of the saturation front are obtained as follows t o t i n j b 20 44 64 o c r t 4 η s g 1 γ s g 1 β m 4 2 642 10 7 0 536 12 254 0 536 4 7 38 5 24 3600 3 145 m q 1 ζ t π r t 2 h φ t i n j 1 0 177 π 3 145 2 10 0 25 3 147 2 m 3 d a y r s g q t i n j π h φ ζ s g 147 2 3 π 10 0 25 3 866 14 74 m the similarity variables ζ t ζ s g represent the velocity of the thermal and saturation front respectively which are estimated as illustrated in section 3 the same procedure is used to estimate the inversion results for case 2 which are given in table 5 the inversion results and the estimation errors in parentheses shown in tables 4 and 5 show the good agreement with the numerical results and demonstrate the validity of the approach developed in this work the regression technique is shown to provide slightly accurate results compared with those obtained using the graphical technique however it requires longer calculation time on the other hand the graphical technique is simple and yet provides inversion results with good accuracy compared with the numerical results 6 discussion in this section we will discuss the assumptions but also the behavior and the applicability of the proposed solutions the proposed solutions are developed by solving mass and heat conservation equations analytically during co2 flow in saline aquifer during the injection and the subsequent shut in periods different assumptions are made while solving the problem first we assumed that fluid flow geometry around the injection well is radial this assumption is likely for a fully penetrating vertical well given the high viscous forces around the well which can effectively displace the fluids to allow for radial flow however radial flow may not develop if the injection zone is highly heterogeneous and or anisotropic we also neglected the mutual dissolution i e mass exchange between the injected co2 and aqueous brine in the reservoir this assumption is inherent in bratvold and horne 1989 s solution which is used in our work to obtain the temperature and saturation profiles during the injection period accordingly the size of dry out region is neglected despite that neglecting the dry out region may affect the pressure evolution however temperature is shown to be slightly affected this assumption is feasible for the application of the proposed technique because temperature warmback analysis is generally limited to short injection durations few days and consequently the obtained size of the dry out region is limited in case 1 the size of dry out region is shown to be small 0 4 m compared with the size of the two phase region 15 m after 3 days of co2 injection additionally a good agreement is obtained between the analytical results and those obtained numerically as shown in fig 5 which demonstrates the feasibility of this assumption neglecting the mutual dissolution between the displacing and displaced phases also results in negligible contribution of specific hydrothermal processes such as water vaporization and co2 dissolution based on the numerical investigation presented in appendix a the contribution of water vaporization and co2 dissolution to the temperature evolution are 0 5 c and 1 2 c respectively which are negligible compared with the contribution of the advection mechanism 20 c besides the solution presented in this work neglects the effect of heat exchange with the surrounding strata this assumption is invalid for extended injection and shut in durations hashish and zeidouni 2021b however the application of the warmback analysis is generally limited to short injection durations few days injecting for a long injection period may not be practical anyway because extended shut in time would be required to obtain a pronounced warmback signal the shorter the injection duration the more pronounced the temperature recovery that can be obtained during the warmback period a short shut in duration is also desirable to avoid extended pause in injection activity based on the results obtained in section 5 the proposed approach can be used as an alternative technique to estimate the injection profile through injection wells during co2 storage the multi region solution is shown to be robust and provides accurate results during forward and backward modeling because it considers both heat advection and conduction mechanisms during solving the problem however inversion procedure using regression analysis may be time consuming on the other hand three region solution provides results with lower accuracy because it discretizes the aquifer into three regions additionally it neglects the contribution of heat conduction during the injection period consequently the three region solution may underestimate temperature recovery at early shut in time especially for long injection durations however the early time asymptotic form of the three region solution can be casted into simple graphical technique for inverse modeling the proposed graphical technique is simple practical to be used by field analyst and yet provides inversion results with comparable accuracy consequently the proposed solutions can be used as alternative to the numerical simulation tools which are time consuming and may be highly non unique for inverse modeling despite that the traditional flow meters such as injection logging tools ilts can be used to derive fluid flow through injection wells they have certain limitations for specific applications injection logging tools such as spinner flowmeters have a limited access to wellbore in case of restricted completions their deployment results in injection deferment and they are relatively expensive additionally the threshold fluid velocity of the flowmeter limits the flow rate that ilts can measure to relatively high flow rates consequently ilts may provide low resolution results for estimating flow profile in injection wells operated at low flow rates compared with the proposed approach 7 conclusions in this work a novel analytical approach is presented to quantify the injection profile over co2 injection wells during geologic carbon storage in a saline aquifer the proposed approach extends the application of temperature warmback analysis to allocate co2 zonal rate during co2 injection in a saline aquifer analytical solutions are developed to model the temperature evolution during the injection and the shut in period by solving the heat and mass conservation equations considering two phase flow conditions gaseous co2 and aqueous brine in the aquifer two solutions are presented to the problem the first solution is a multi region solution which discretizes the aquifer into many regions and the energy balance equations of the discretized regions are solved considering the boundary conditions at the interfaces the second analytical solution follows the same approach however the aquifer is only discretized into three regions to obtain a closed form solution for temperature recovery during the warmback period two inversion procedures are presented accordingly the first approach is to use regression analysis along with the multi region solution to iterate on the injection profile that reproduces the temperature recovery observed during the shut in period additionally the radius of the plume front the radius of the thermal front and the initial temperature can be obtained all per layer the second approach is to reformulate the early time asymptotic form of the three region solution into a simple graphical technique that provides the same information without the need for regression analysis the graphical technique is simple practical to be used by a field analyst and yet provides accurate estimation of the inversion results compared with the alternative numerical models that are time consuming and may be highly non unique during inverse modeling the results of the developed forward and inverse models are validated against numerical results obtained by tough3 for two synthetic cases a good match is obtained between the analytically obtained results and those obtained numerically which demonstrates the validity of the presented solutions the approach presented in this work can be used to design a thermal test analogous to pressure testing at the beginning of co2 storage operation to estimate co2 injection profile assess the vertical heterogeneity of the target formation and evaluate the effectiveness of the injection interval evaluating co2 injection profile helps to identify thief zones for remedial action and maximize the storage capacity of the storage reservoir credit authorship contribution statement refaat g hashish conceptualization methodology formal analysis investigation writing original draft writing review editing mehdi zeidouni conceptualization methodology formal analysis investigation writing original draft declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgement the authors would like to thank the u s department of energy national energy technology laboratory netl for funding under grant number de fe0031557 cfda 81 089 appendix a 1 d radial numerical simulation in this appendix we first present a 1 d radial numerical simulation using tough3 eco2n simulation tool for a base case example problem to demonstrate the contribution of the hydrothermal processes to the temperature evolution during cold co2 injection in a deep aquifer the objective of this investigation is to determine the dominant hydrothermal processes and implications for the assumptions that can be made to obtain an analytical solution to the problem the base case involves injecting cold co2 with constant injection rate 1 58 kg s and constant bottomhole injection temperature 20 c for 3 days into an aquifer with a thickness of 10 m the formation is 2000 m deep with initial temperature of 65 c and initial pressure of 20 mpa the remaining properties of the base case are given in table a 1 the relative permeability and capillary pressure models of the aquifer are given in table a 2 fig a 1 a illustrates the temperature and saturation profiles for the base case the saturation behavior shown in fig a 1 a is similar to the isothermal saturation signature it is still characterized by two major discontinuities shocks as derived from the extended fractional flow theory orr 2007 they develop due to mutual dissolution between co2 and brine i e co2 dissolution into the brine aqueous phase and water vaporization into the co2 rich gaseous phase they divide the reservoir into three regions namely co2 dry out region two phase aqueous brine gaseous co2 region and single phase fresh brine region zeidouni et al 2009 the extent of the dry out region is 0 4 m compared with 15 m for the two phase region in addition to the two shocks caused by the mutual co2 brine dissolution another shock can be identified in the saturation profile as shown in the magnified subfigure of fig a 1 a the third shock is relevant to the non isothermal nature of the flow and it is located within the two phase region the third shock establishes due to the abrupt change in the fluids nobilities at the thermal shock the temperature response is also shown in fig a 1 a which can be characterized by two approximately isothermal regions separated by a shock at radial distance of 4 m this behavior is an indication that the temperature response is advection dominant and the other thermal processes may be negligible to better illustrate the effect of the other processes heat conduction jt expansion and effect of dissolution and vaporization the temperature results are shown in fig a 1 b considering that co2 is injected at the same temperature as the aquifer jt expansion results in a slight cooling 0 06 c at the near wellbore region as co2 flows outward from the injection well the water vaporization effect decreases the temperature at the trailing edge of the two phase region by 0 45 c on the other hand co2 dissolution in the in situ brine at the plume front results in a sharp increase in temperature by 1 2 c the combination of these processes shows 1 c of temperature perturbation to the reservoir temperature this has been also noted by han et al 2010 according to which temperature behavior during the co2 injection period can be approximated as advection dominant for completeness we will also account for the effect of heat conduction in this study to improve our model accuracy in addition to approximating the temperature behavior to be advection dominant we assume that the effect of mutual dissolution on the saturation behavior is negligible this latter assumption would be invalid when solving for pressure since it eliminates an important region i e the dry out region which can have important implications for co2 injectivity however this assumption is proved useful in achieving the objective of this study which is to obtain the temperature response not the pressure response as we will show in the validation section despite this assumption the temperature response still shows good agreement with the numerical simulation results the negligible dry out region assumption in deriving the thermal response can be justified due to 1 the small size of the dry out region 0 4 m for the base case compared with the size of the thermal disturbance region 4 m for the base case and the size of the two phase region 15 m for the base case 2 the effective thermal conductivity which controls the temperature recovery during the shut in period changes slightly linearly with fluid saturation because the majority of the porous media is solid grains and the thermal conductivity for the solid grains is much higher than the fluids similarly the effective heat capacity which controls the location of the thermal front during the injection period is slightly affected by fluid saturation platenkamp 1985 for example a change in brine saturation of the dry out region from 0 3 residual saturation to zero changes the effective thermal conductivity in the dry out region by 1 7 percent and the effective heat capacity by 4 percent for a formation porosity of 0 25 on the other hand the same change in the brine saturation results in a change in the brine relative permeability by 80 percent because of the non linear functionality of relative permeability to fluid saturation this clarifies why pressure behavior and fluid injectivity are more sensitive to the fluid saturation of the dry out region compared with temperature behavior appendix b solution of the advection problem in this appendix the solution of the advection problem developed by bratvold and horne 1989 is given for completeness using the dimensionless parameters given by eq 25 the hyperbolic conservation equations for gaseous co2 saturation and temperature are given by b 1 s g t d f g s g s g r d 2 f g t 1 d t 1 d r d 2 0 b 2 t 1 d t d g t 1 d r d 2 0 the corresponding initial and boundary conditions are given by b 3 t 1 d r d t d 0 1 b 4 t 1 d r d 0 t d 0 b 5 s g r d t d 0 0 b 6 s g r d 0 t d 1 s w r eqs b 1 and b 2 can be written in matrix form as follows b 7 s g t 1 d t d a s g t 1 d r d 2 0 where a is given by a f g s g f g t 1 d 0 g using the dimensionless parameters given by eq 25 the system of the hyperbolic conservation equations become b 8 s g t 1 t a s g t 1 r 2 0 where a is given by a q π h φ f g s g f g t 1 0 g the hyperbolic conservation equations described by eqs b 1 b 2 with the auxiliary initial and boundary conditions given by eqs b 3 b 6 constitute a non strictly hyperbolic riemann problem which can be solved by using the method of characteristics a reasonable solution of the problem is obtained by tracing the characteristic curves and introducing appropriate discontinuities to obtain a unique solution the solution procedure presented by bratvold and horne 1989 is summarized below construct the fg sg plots at the initial reservoir temperature to and the bottomhole injection temperature tinj using eq 3 see fig b 1 a plot the eigenvalues ζ and g of the system of hyperbolic conservation equations eq b 7 which are defined by eqs b 9 and b 10 versus gas saturation at both the initial aquifer temperature and the bottomhole injection temperature see fig b 1 b b 9 ζ r d 2 t d f g s g b 10 g f g α s g β where α and β are given by eq 25 add the characteristic curves with slopes fs and g by plotting tangents on the fg sg plot at the initial aquifer temperature starting from sg fg 0 0 and sg fg β α respectively the tangent points identify gas saturation at the saturation front and thermal front respectively as illustrated in fig b 1 a the solution is obtained by tracing the slope of the fractional flow curve and including the appropriate discontinuities represented by the tangent points obtained in the previous step in order to ensure the uniqueness of the solution start from sg fg 1 swr 1 which is the saturation condition at the injection well and follow the slope of the fractional flow curve evaluated at the bottomhole injection temperature up to point 1 which is the gas saturation upstream of the thermal front point 1 is obtained from the intercept of the characteristic curve with slope g thermal front tangent and the fg sg plot at the injection temperature which represents the transition point from the cold to the hot fractional flow curve see fig b 1 a then follow the g constant path up to point 2 which is the gas saturation downstream of the thermal front this transition represents the first discontinuity in the established solution shown in fig b 1 b point 2 is obtained from the tangent point between the characteristic curve with slope g and the fg sg plot at the initial aquifer temperature the fluid saturations obtained from point 1 to point 2 represent the saturations located at the thermal shock i e they have identical thermal velocity g next follow the slope of the fractional flow curve evaluated at the initial aquifer temperature up to point 3 which is the gas saturation upstream of the saturation front point 3 is obtained from the tangent point between the characteristic curve with slope dfg dsg saturation front tangent and the fg sg plot at the initial aquifer temperature see fig a 1 a the gas saturation ahead of the saturation front is equal to the initial gas saturation which is zero the transition from point 3 to point 4 represents the second discontinuity in the established solution which is located at the saturation front the fluid saturations obtained from point 3 to point 4 represent the saturations located at the saturation front i e they have identical saturation velocity dfg dsg accordingly the established solution constitutes a leading shock wave at the saturation front 3 4 followed by an expansion wave 2 3 followed by a trailing shock at the thermal front 1 2 and a zone of constant state 1 1 the zone of constant state reflects the difference in the speed of the propagation between the trailing shock wave and the expansion wave dindoruk and dindoruk 2008 the trailing shock 1 2 is of a minor saturation change and it is established due to the significant temperature contrast at the thermal front which results in different fluid mobilities fig b 1 b shows the derivative of the fg sg plots with the established saturation solution fig b 2 illustrates the saturation and temperature solutions of the advection problem versus the similarity variable ζ defined by eq b 9 appendix c derivation of the multi region analytical solution in this appendix the derivation steps of the multi region analytical solution during the injection and the shut in periods are given during the injection period the ibvp described by eqs 30 35 is solved using laplace transformation technique laplace transformation simplifies the system of the governing equations described by eq 30 into a system of odes which is given by c 1 2 t 2 d i r d 2 1 r d t 2 d i r d θ i s t 2 d i t 1 d i t d t i n j d s r d i 1 r d r d i the innermost and outermost boundary conditions are given by c 2 t 2 d 1 r d 1 t d 0 c 3 t 2 d n r d r d e 0 where rde is the outer radius of the aquifer the boundary conditions at the interfaces are described by the conservation of heat flux and the continuity of the temperature at the interfaces they are given by the following equations c 4 t 2 d i t 2 d i 1 a t r d r d i c 5 r i i 1 t 2 d i r d t 2 d i 1 r d a t r d r d i the solution of the system of odes in laplace domain is given by kreyszig 2009 c 6 t 2 d i t 1 d i t d t i n j d s c 1 i i o r d s θ i c 2 i k o r d s θ i the coefficients of the modified bessel functions are obtained using the boundary conditions described by eqs c 2 c 5 by substituting the boundary conditions into eq c 1 the system of the governing equations is simplified to the following form assuming 3 regions for simplicity c 7 i o s θ 1 k o s θ 1 0 0 0 0 i o r d 12 s θ 1 k o r d 12 s θ 1 i o r d 12 s θ 2 k o r d 12 s θ 2 0 0 r 12 s θ 1 i 1 r d 12 s θ 1 r 12 s θ 1 k 1 r d 12 s θ 1 s θ 2 i 1 r d 12 s θ 2 s θ 2 k 1 r d 12 s θ 2 0 0 0 0 r 23 s θ 2 i 1 r d s θ 2 r 23 s θ 2 k 1 r d s θ 2 s θ 3 i 1 r d s θ 3 s θ 3 k 1 r d s θ 3 0 0 i o r d 23 s θ 2 k o r d 23 s θ 2 i o r d 23 s θ 3 k o r d 23 s θ 3 0 0 0 0 s θ 3 i 1 r d e s θ 3 s θ 3 k 1 r d e s θ 3 c 11 c 21 c 12 c 22 c 13 c 23 0 t 1 d 2 s t 1 d 1 s 0 0 t 1 d 3 s t 1 d 2 s 0 the system of equations given by eq c 7 is solved using gaussian elimination technique kreyszig 2009 the solution of temperature in the real time domain is obtained using stehfest algorithm for numerical inverse laplace transform stehfest 1970 accordingly the solution of temperature for n regions at the end of the injection period in the real time domain is given by c 8 t 2 d 1 t 2 d 2 t 2 d 3 t 2 d n 1 t 2 d n t 1 d 1 t d t i n j d t 1 d 2 t d t i n j d t 1 d 3 t d t i n j d t 1 d n 1 t d t i n j d t 1 d n t d t i n j d l 1 c 11 s c 21 s c 12 s c 22 s c 13 s c 23 s c 1 n 1 s c 2 n 1 s c 1 n s c 2 n s i o r d s θ 1 i o r d s θ 2 i o r d s θ 3 i o r d s θ n 1 i o r d s θ n k o r d s θ 1 k o r d s θ 2 k o r d s θ 3 k o r d s θ n 1 k o r d s θ n where cij s s are the arbitrary coefficients the resulting solution is an approximate solution that describes the temperature profile at the end of the injection period considering heat transfer by both advection and conduction during the shut in period the same approach described above is used to solve the warmback problem described by eqs 37 40 there are two differences in the warmback problem firstly the initial condition is changed to be the temperature solution obtained at the end of the injection period which is described by eq c 8 secondly the innermost boundary condition is changed to be an isolated boundary condition the solution of the system of governing equations in laplace domain is given by c 9 t d i t 2 d i t d t i n j d s k 1 i i o r d s θ i k 2 i k o r d s θ i the coefficients involved in the system of equations given by c 9 are obtained through substituting the boundary conditions into the system of equations given by c 9 accordingly the following system of equations is obtained assuming 3 regions for simplicity c 10 s θ 1 i o s θ 1 s θ 1 k o s θ 1 0 0 0 0 i o r d 12 s θ 1 k o r d 12 s θ 1 i o r d 12 s θ 2 k o r d 12 s θ 2 0 0 r 12 s θ 1 i 1 r d 12 s θ 1 r 12 s θ 1 k 1 r d 12 s θ 1 s θ 2 i 1 r d 12 s θ 2 s θ 2 k 1 r d 12 s θ 2 0 0 0 0 r 23 s θ 2 i 1 r d s θ 2 r 23 s θ 2 k 1 r d s θ 2 s θ 3 i 1 r d s θ 3 s θ 3 k 1 r d s θ 3 0 0 i o r d 23 s θ 2 k o r d 23 s θ 2 i o r d 23 s θ 3 k o r d 23 s θ 3 0 0 0 0 s θ 3 i 1 r d e s θ 3 s θ 3 k 1 r d e s θ 3 k 11 k 21 k 12 k 22 k 13 k 23 0 t 2 d 2 s t 2 d 1 s 0 0 t 2 d 3 s t 2 d 2 s 0 the above system of equations is solved using gaussian elimination method to obtain the temperature solution in laplace domain the solution in the real time domain is obtained using stehfest algorithm stehfest 1970 accordingly the temperature solution during the warmback period in the real time domain for n regions is given by c 11 t d 1 t d 2 t d 3 t d n 1 t d n t 2 d 1 t d t i n j d t 2 d 2 t d t i n j d t 2 d 3 t d t i n j d t 2 d n 1 t d t i n j d t 2 d n t d t i n j d l 1 k 11 s k 12 s k 13 s k 1 n 1 s k 1 n s k 21 s k 22 s k 23 s k 2 n 1 s k 2 n s i o r d s θ 1 i o r d s θ 2 i o r d s θ 3 i o r d s θ n 1 i o r d s θ n k o r d s θ 1 k o r d s θ 2 k o r d s θ 3 k o r d s θ n 1 k o r d s θ n where kij s s are the arbitrary coefficients the sandface temperature is obtained by assigning rd 1 into the solution of the innermost region and it is given by c 12 t w d δ t d t 2 d 1 t d t i n j d l 1 k 11 s i o s θ 1 l 1 k 21 s k o s θ 1 appendix d derivation of the three region analytical solution in this appendix the solution of the ibvp described by eqs 43 52 is obtained using laplace transformation technique the system of the governing equations for the three regions is simplified to odes in laplace domain as follows d 1 2 t d 1 r d 2 1 r d t d 1 r d θ 1 s t d 1 0 0 r d r t d d 2 2 t d 2 r d 2 1 r d t d 2 r d θ 2 t d 2 1 s r t d r d r s d d 3 2 t d 3 r d 2 1 r d t d 3 r d θ 3 s t d 3 1 s r s d r d the corresponding innermost and outermost boundary conditions in laplace domain are given by d 4 lim r d 0 t d 1 r d 0 d 5 lim r d t d 3 r d 0 the boundary conditions at the interfaces of the regions in laplace domain are given by d 6 r 12 t d 1 r d r d r t d t d 2 r d r d r t d d 7 t d 1 r d r t d s t d 2 r d r t d s d 8 r 23 t d 2 r d r d r s d t d 3 r d r d r s d d 9 t d 2 r d r s d s t d 3 r d r s d s the solutions of the odes described by eqs d 1 d 3 are given by kreyszig 2009 d 10 t d 1 c 1 i o r d s θ 1 c 2 k o r d s θ 1 d 11 t d 2 1 s c 3 i o r d s θ 2 c 4 k o r d s θ 2 d 12 t d 3 1 s c 5 i o r d s θ 3 c 6 k o r d s θ 3 the arbitrary coefficients are obtained using the boundary conditions described by eqs d 4 d 9 accordingly the solutions of the three regions in laplace domain are given by d 13 t d 1 r d δ t d l 1 c 1 s i o r d s θ 1 d 14 t d 2 r d δ t d 1 l 1 c 3 s i o r d s θ 2 c 4 s k o r d s θ 2 d 15 t d 3 r d δ t d 1 l 1 c 6 s k o r d s θ 3 where d 16 c 1 φ ψ c 3 ω ψ c 4 x ψ c 6 θ ψ and d 17 φ θ 2 r 23 k o r s d s θ 3 i 1 r s d s θ 2 k 1 r t d s θ 2 i 1 r t d s θ 2 k 1 r s d s θ 2 θ 2 θ 3 k 1 r s d s θ 3 i 1 r t d s θ 2 k o r s d s θ 2 i o r s d s θ 2 k 1 r t d s θ 2 d 18 ω r 12 θ 1 i 1 r t d s θ 1 θ 3 k o r s d s θ 2 k 1 r s d s θ 3 r 23 θ 2 k o r s d s θ 3 k 1 r s d s θ 2 d 19 x r 12 θ 1 i 1 r t d s θ 1 θ 3 i o r s d s θ 2 k 1 r s d s θ 3 r 23 θ 2 k o r s d s θ 3 i 1 r s d s θ 2 d 20 θ r 12 r 23 θ 1 r s d s i 1 r t d s θ 1 d 21 ψ s r 12 θ 1 i 1 r t d s θ 1 r 23 θ 2 k o r s d s θ 3 i 1 r s d s θ 2 k o r t d s θ 2 i o r t d s θ 2 k 1 r s d s θ 2 θ 3 k 1 r s d s θ 3 i o r s d s θ 2 k o r t d s θ 2 i o r t d s θ 2 k o r s d s θ 2 θ 2 i o r t d s θ 1 r 23 θ 2 k o r s d s θ 3 i 1 r s d s θ 2 k 1 r t d s θ 2 i 1 r t d s θ 2 k 1 r s d s θ 2 θ 3 k 1 r s d s θ 3 i 1 r t d s θ 2 k o r s d s θ 2 i o r s d s θ 2 k 1 r t d s θ 2 the sandface temperature solution is obtained by assigning rd 0 in eq d 13 which yields d 22 t w d δ t d l 1 φ ψ at early shut in times an asymptotic solution of the sandface temperature can be obtained using the following asymptotic expansions of the modified bessel functions at large argument abramowitz and stegun 1964 d 23 lim z i v z e z 2 π z d 24 lim z k v z π 2 z e z consequently the early time asymptotic solution in laplace domain is given by d 25 t w d s π θ 1 2 r t d 1 s 3 4 e r t d s θ 1 the corresponding early time asymptotic solution in the real time domain is obtained using inverse laplace transformation abramowitz and stegun 1964 which is given by d 26 t w d δ t d r t d θ 1 2 π e θ 1 r t d 2 8 δ t d δ t d k 1 4 θ 1 r t d 2 8 δ t d e θ 1 r t d 2 4 δ t d 
143,we report the discovery of novel regimes of calcium carbonate dissolution in micron scale confined spaces through microfluidic experiments in the experiments hydrochloric acid is injected into a microfluidic chamber with pre deposited calcium carbonate solids as the acid flow rate is decreased the dissolution of calcium carbonate transits from a liquid solid single phase reactive transport regime to a gas liquid solid two phase one the two phase regime further splits into two different regimes one with fluctuating and the other with nonfluctuating gaseous co2 phase we name the three regimes as nongaseous gaseous breathing and gaseous nonbreathing the experimental observations are reproduced and interpreted by mathematical modeling results show that the regimes are controlled by the ratio of h concentration and saturated co2 concentration the peclet number and the second damkohler number dimensionless diagrams distinguishing different regimes are presented and an empirical relationship is proposed our results offer insights into various engineering and natural processes e g geological carbon storage petroleum reservoir acidizing karst dissolution and others that are governed by small scale multiphase reactive flow physics keywords calcium carbonate dissolution regimes microfluidics multiphase reactive transport 1 introduction geological carbon storage bickle 2009 bachu 2008 orr 2009 bui et al 2018 has become an industrial solution to address increased anthropogenic co2 in the atmosphere captured co2 from emission sources are injected into subsurface geological formations for permanent storage by various trapping mechanisms structural residual solubility and mineralization bickle 2009 bachu 2008 matter and kelemen 2009 jun et al 2013 there are several candidate types of geological formations for carbon storage to name a few depleted oil gas reservoirs stevens et al 2001 deep sea sediments house et al 2006 and deep saline aquifers nordbotten et al 2005 celia et al 2015 the storage capacity of co2 in deep saline carbonate formations is enormous because of their worldwide abundance celia et al 2015 song et al 2018 however the dissolution of carbonate minerals by co2 acidified brines may undermine the security and integrity of carbon storage song et al 2018 by chemo mechanical rock alteration sun et al 2016 on the other hand this reactivity is necessary for mineral trapping molins et al 2014 steefel et al 2013 therefore it is a nontrivial task to characterize how these minerals are dissolved by acid in the micron scale confined pore spaces of rocks not limited to carbon storage carbonate dissolution occurs in various engineering and natural processes such as petroleum reservoir acidizing mcleod 1984 and karst dissolution frisia and borsato 2010 gombert 2002 in a broader sense carbonate dissolution is an important step in global carbon cycle and impacts long term balance of carbon dioxide in the atmosphere gombert 2002 traditionally the study of carbonate dissolution has focused on the darcy scale one example is core flooding fredd and fogler 1998 depending on the flow and reaction conditions and rock heterogeneity acid can penetrate the carbonate rock in complex patterns fredd and fogler 1998 fredd and fogler 1998 tansey and balhoff 2016 e g wormholing fredd and fogler 1998 and channeling menke et al 2016 although early studies fredd and fogler 1998 fredd and fogler 1998 lund and fogler 1975 hoefner and fogler 1988 have focused primarily on the impact of macroscopic transport and reaction conditions e g acid injection rate and reactivity recent works focus more on the complexity of rock pore structure and its impact on dissolution profile for instance both numerical simulations nunes et al 2016 and experiments menke et al 2016 have shown that carbonate dissolution patterns are structure dependent the sample averaged dissolution rate could be up to two magnitudes smaller nunes et al 2016 than that from a batch experiment similarly field scale dissolution rates are reported to be orders of magnitudes smaller than experimental batch rates swoboda colberg and drever 1993 and it is believed to be caused by mineral heterogeneity and incomplete mixing in a heterogeneous flow field menke et al 2016 in addition to complexity in rock structures for carbonate dissolution by co2 acidified brine brine ph and dissolution dynamics are influenced by temperature and pressure peng et al 2013 peng et al 2015 furthermore carbonate dissolution releases cations such as ca2 which can buffer the brine ph jun et al 2013 kharaka et al 2006 therefore for a co2 acid carbonate system there can be a hierarchy of complexity spanning different physicochemical aspects as such the pore scale becomes very important since it is the scale at which fundamental physicochemical processes occur steefel et al 2013 and contribute to emerging behaviors at a larger scale roded et al 2021 advancements in rock pore scale imaging and modeling techniques blunt et al 2013 have allowed researchers to study pore scale events with unprecedented detail popular imaging techniques include micro ct scanning wildenschild and sheppard 2013 and fast synchrotron tomography menke et al 2016 berg et al 2013 micro ct delivers high spatial resolution of several micron but requires a long time hours to minutes menke et al 2016 to resolve the image thus is limited in capturing dynamic changes the fast synchrotron tomography which has been successfully applied to carbonate dissolution can reduce the processing time to about one minute per scan and thus be more suited for dynamic imaging menke et al 2016 furthermore results from experimental imaging often require numerical simulations to interpret and elucidate underlying mechanisms popular methods for simulating pore scale reactive transport include but not limit to the lattice boltzmann method tian and wang 2018 kang et al 2010 yoon et al 2015 direct numerical simulation molins et al 2012 and pore network modeling tansey and balhoff 2016 esteves et al 2020 esteves et al 2021 recently new methods are proposed to simulate carbonate dissolution e g the darcy brinkman formulation soulaine et al 2018 soulaine et al 2017 a micro continuum approach where flow in large void space is solved by navier stokes equation while in solid dominated region it is solved by darcy s law there is also work demonstrating the limitations of the darcy brinkman approach such as that it can predict early acid breakthrough d p ferreira et al 2020 another novel approach is the continuous time random walk model which is recently applied to a carbonate dissolution problem oliveira et al 2021 in general each method excels in certain aspects but has limitations in carbonate dissolution co2 is a product of acid mineral reaction which can be either solubilized in the aqueous phase or form a separate co2 phase prutton and savage 1945 bastami et al 2014 however the assumption that co2 is fully solubilized in the aqueous phase is widely employed either explicitly or implicitly in core flooding studies fredd and fogler 1998 fredd and fogler 1998 lund and fogler 1975 hoefner and fogler 1988 micromodel experiments yoon et al 2019 and numerical simulations molins et al 2014 oliveira et al 2021 yoon et al 2019 gray et al 2018 oliveira et al 2020 with full solubilization dissolution is in liquid solid single phase regime and events in a single pore can be treated in a simplistic manner such as pore enlargement and mergence between adjacent pores tansey and balhoff 2016 esteves et al 2020 esteves et al 2021 since co2 solubility in water is significantly higher under elevated pressure wiebe and gaddy 1940 it seems reasonable to adopt this assumption given the subsurface high pressure condition however previous results showed that it is dependent on the acid concentration more specifically the authors indicated that 60 of produced co2 can be solubilized by consuming a 5 hcl at 7 mpa while for a 15 hcl 70 mpa is required to keep merely 30 of produced co2 solubilized in the aqueous phase soulaine et al 2018 prutton and savage 1945 thompson and gdanskl 1993 considering that in petroleum reservoir acidizing often high concentrations of strong acid are used a co2 acid carbonate two phase dissolution regime should exist in the subsurface and the full solubilization assumption is not always valid in carbon storage the injected co2 acidifies resident brine and makes carbonic acid which is a weak acid however in industrial scale co2 injection projects due to economics the injected co2 stream is not pure and impurities such as sulfur and nitrogen oxides may inevitably present song et al 2014 which reduces the reservoir ph to as low as 1 song et al 2018 knauss et al 2005 benson and cole 2008 when there is a separate co2 phase carbonate dissolution could behave very differently from single phase for example recent numerical simulations soulaine et al 2018 suggest that presence of gaseous co2 produced by acid carbonate reaction may prevent the emergence of wormholes as a comparison core scale acid co2 co injection experiments observe the same phenomenon where the injected co2 phase prevents the growth of wormhole seeds ott and oedai 2015 the authors suggest extending the study of single phase dissolution to multiphase dissolution by introducing new parameters in addition to peclet and damkohler numbers ott and oedai 2015 recently the so called grain engulfment mechanism song et al 2018 is proposed where a calcite post in a microfluidic channel is enveloped by locally produced gaseous co2 and is protected from the acidic water similar to ott and oedai 2015 work grain engulfment is essentially nonaqueous phase covering reactive surfaces and thus redirecting the acid flux a recent numerical study li et al 2022 further shows that the mechanism by which co2 phase changes carbonate dissolution is not only by covering the reactive surfaces but also the change of local velocity profiles due to its presence in the flow path therefore one would expect that there could be some patterns regimes determined by both reaction and transport in multiphase dissolution however most of these pioneering works in multiphase carbonate dissolution remain focused on how the traditional regimes are modified by multiphase flow interactions there is not yet a study to directly showcase new multiphase regimes and characterize them in a wide parametric range furthermore given that the co2 acid carbonate two phase dissolution is confined in micropores of rock one may also expect the regimes to be shaped by geometric confinement in this work to directly observe and quantify the dissolution dynamics of calcium carbonate in micron scale confined spaces we utilize microfluidics as the experimental platform microfluidics whitesides 2006 is traditionally an important tool for chemical and biological analysis chen et al 2017 shang et al 2017 song and ismagilov 2003 nilghaz et al 2012 martinez et al 2010 however the utilization of microfluidics and micromodels microfluidic model porous media anbari et al 2018 for subsurface porous media fluid flow starts no later than the 1950s chatenever and calhoun 1952 microfluidics has emerged as a popular tool for subsurface studies in many subareas e g enhanced oil recovery lifton 2016 mejia et al 2020 xu et al 2017 xu et al 2015 underground fluid and solute transport bultreys et al 2016 geological carbon storage song et al 2018 ho and tsai 2020 morais et al 2020 kim et al 2013 sell et al 2013 miri et al 2015 nooraiepour et al 2018 etc an important advantage of microfluidics for subsurface studies is the direct visualization of pore scale phenomena which allows the development of novel mechanistic models since it is direct visualization via optics the time step of obtaining images could be small e g one second this has significant advantages over tomography type techniques in terms of capturing fast processes in our experiments calcium carbonates are deposited in a glass microchamber by precipitation reaction following which the precipitated solids are dissolved by injecting hydrochloric acid the dissolution process is recorded as image sequences and detailed mathematical modeling is conducted to interpret the results the experimental findings in conjunction with the insights from mathematical modeling reveal novel regimes and mechanisms of calcium carbonate dissolution in micron scale confined spaces 2 materials and methods 2 1 experimental procedures the experimental setups are shown in fig 1 a the system consists of syringes hamilton 500μl and a syringe pump chemyx fusion 400 that inject fluids into the microchip a microscope accuscope exi 310 which monitors the microchamber and a computer that processes the images obtained through the microscope the syringes are connected by plastic pipes to the injection port s of the chip a b or c in fig 1 b these ports are drilled with a diameter of 1mm the glass microchip is fabricated by standard photolithography and hf etching method as described by our research group mejia et al 2020 xu et al 2017 and others anbari et al 2018 fig 1 b shows the dimension of the chip it is a y junction like model with a circular chamber fig 1 c at the junction of three microchannels indicated by yellow dashed lines the radius of this chamber is 400 microns other models with 300 and 500 micron radius are also fabricated the width of the inlet outlet channel is one fifth of the chamber radius for a co2 bubble to escape the chamber it must deform at the chamber channel intersection and finger into the channel however a narrow channel guarantees the initial meniscus curvature is large and the high capillary pressure would prevent it from happening therefore the bubble will be confined within the chamber the depth of the chamber is 10 microns models with 20 micron depth are also fabricated the design serves as a proxy of a single pore in a porous medium before conducting the dissolution experiments we deposit caco3 in the chamber by mixing cacl2 and na2co3 solutions 10 wt injected from ports a and b the injection rates of reagents range between 101 and 102 µl h experiments are conducted under atmospheric pressure and room temperature depending on flow rate schuszter et al 2016 schuszter et al 2016 supersaturation value jaho et al 2016 pore size stack et al 2014 and micromodel wettability tzachristas et al 2020 the precipitants can have different spatial distribution and exhibit various morphologies however there is no need to control these variables because in situ minerals distribute nonuniformly and exhibit various morphologies in real rocks once solid deposition is complete we flush the chip with deionized water to remove remaining reagents hcl acid is then injected into the chamber 2 2 mathematical modeling to model the experiments let us consider a simple conceptual model as shown in fig 2 radius of the chamber is denoted as rc fig 1 c solids distribute in a region with radius of rs rs rc depth of the chamber is denoted as h h rc acid invades the chamber from the inlet contacts the solids reacts and leaves through the outlet the reaction is represented by fredd and fogler 1998 fredd and fogler 1998 lund and fogler 1975 hoefner and fogler 1988 esteves et al 2020 1 cac o 3 s 2 h aq ca aq 2 h 2 o l c o 2 aq g co2 can be gaseous if supersaturation in aqueous phase is reached hey et al 1994 fig 2 employs several assumptions first the co2 bubble occupies center of the water wet chamber second the bubble does not leave the chamber such that variation of its size is dictated by mass transfer at fluid interface co2 solubilization and evaporation third one can define a space averaged h concentration ch t and solubilized co2 concentration c c o 2 t in the chamber both functions of time change in ch stems from three sources first replenishment from upstream acid c h 0 in an experiment this is the h concentration we inject second consumption due to reaction with calcium carbonate third the loss due to fluid transport one can write 2 d c h t d t k t v 2 r c c h t v 2 r c c h 0 the two term coefficient of ch t measures declination rate due to reaction and transport v is the acid displacing velocity k t is defined as an effective reaction rate in unit s 1 between acid and solid the equation for solubilized co2 concentration reads 3 d c c o 2 t d t v 2 r c c c o 2 t 1 2 k t c h t the first term on the right hand side accounts for transport of co2 species to downstream the second term denotes production of co2 from eq 1 in fig 2 r g a is the apparent bubble radius we term it apparent because this bubble contains volume of solids we define m r t unit μg μm2 as the radial distribution of areal mass density of solids where r rs is an arbitrary radius from the chamber center m is a function of radius because variation in r g a leads to exposure of solids at different radii ch c c o 2 k r g a and m are the five fundamental quantities in the model and other properties can be derived from them for instance the total solid mass denoted as m t is an areal integral of m m t 0 r s m r t 2 π r d r the coupling relationship among these quantities is displayed in fig 3 an arrow in fig 3 indicates a direct relation between the two quantities relation a is in eq 2 note that v and c h 0 impact ch as well but in an experiment these two are constants hence are not included relations b and c are in eq 3 relation d represents a co2 growth model it defines a saturated co2 concentration cs in water80 solubility and the gas phase grows and shrinks following supersaturation c c o 2 c s and undersaturation c c o 2 c s relation e stems from geometric confinement the larger r g a the more acid expelled out of the chamber and less acid available for reaction with m relation f originates from the fact that the bubble contains solid volume and how m evolves regulates how gas fills in the vacant space relation i the h concentration influences how fast the exposed solids are dissolved relations g and h are the model for effective reaction rate k only the region outside r g a contributes to k relation g moreover for a location outside r g a if there are no longer solids to react it does not contribute to k relation h the maximum value of k which we denote as k 0 s 1 is achieved when no gas phase presents e g fig 2 a while k reduces to zero if all solids are covered by gas e g fig 2 c k 0 relates to the conventional kinetic constant of a heterogeneous chemical reaction kr peng et al 2015 esteves et al 2020 gray et al 2018 m s 1 by a characteristic length lc 4 k 0 k r l c in our model lc is taken as the chamber radius rc details of relations d i are in the appendix fig 3 reveals strong coupling among the quantities although individual relation may be simple equations in the model are numerically solved by the euler s method furthermore three dimensionless numbers can be constructed 5 p e v r c d d a i i k 0 r c 2 d θ c h 0 c s where d is the diffusion constant of co2 pe is the peclet number daii is the second damkohler number pe represents the strength of acid advection while daii represents the rate of acid mineral reaction θ is defined as the ratio of h concentration c h 0 to co2 solubility cs it measures the ability to reach co2 supersaturation in the aqueous phase for example if c h 0 is lower than 2cs θ 2 regardless of transport and reaction conditions c c o 2 cannot reach cs according to stoichiometric relation in eq 1 when θ 2 supersaturation is possible and transport and reaction conditions will impact dissolution behaviors faster acid mineral reaction higher daii leads to faster production of co2 and thus facilitates supersaturation however stronger advection higher pe leads to quicker evacuation of chemical species to downstream and thus retards supersaturation therefore in different range of dimensionless numbers one may expect different dissolution behavior 2 3 measurement and image processing experimental dynamics of calcium carbonate dissolution is obtained from analyzing microscopic images we process the images through a combination of imagej and matlab first we quantify areal mass density distribution namely m 0 r m r 0 and m r t second we measure r g a from images the workflow of estimating areal mass density distribution is exemplified in fig 4 starting from the raw image fig 4 a also fig 1 d in imagej an otsu color thresholding procedure is applied and the image is binarized fig 4 b images have a scale of 1 06 pixels µm solid population in fig 4 a consists of well grown crystals they are partially transparent under microscope light and when converted to binary image only the edges are in black pixels the internal white pixels must be filled to accurately count the total area occupied by particles by particle analysis in imagej a mask image can be generated as shown in fig 4 c the mask image merely blackens the internal pixels of the particles we sum the two images and obtain fig 4 d where all areas occupied by particles are black pixels a radial scanning procedure in matlab is implemented on fig 4 d to generate the areal mass density distribution at radius r a narrow annulus with a width of one hundredth of rs exaggerated in the figure is constructed the area of this annulus is denoted as δsannulus r and we count the area of black pixels in this annulus as δsblack r thus the pixel density of solids is δsblack r δsannulus r suppose the solids have a density of ρ s and an average depth of hs hs h the areal mass density is 6 m 0 r δ s b l a c k r h s ρ s δ s a n n u l u s r the unit is mass area in this expression we do not know hs a priori because the images only provide 2d information given hs we can proceed from fig 4 d to fig 4 e and use it as initial condition in the model here the estimated hs for fig 4 d is 3μm this value is determined by fitting to experimental data which is explained near the end of this section the above procedure is also applied to images at a later point such that the experimental evolution of solid mass can be determined in the measurement of r g a when bubbles are circular identification of radius is straightforward however the gas liquid interface could be deformed by the water wet grains we adopt a procedure in fig 5 an equivalent r g a is drawn in the image and two areas sin blue and sout orange are identified we adjust the equivalent r g a until the two areas are equal to make sure gas volume is conserved finally k 0 s value is needed for the model but cannot be measured from images published works provide a range for kr and by eq 4 one can calculate k 0 for example gray et al gray et al 2018 used a value of 2 5 10 4m s 1 for kr for microchambers with different radii 300μm 400μm and 500μm in our experiments k 0 would be 0 83s 1 0 63s 1 and 0 5s 1 table 1 summarizes reference values for k 0 based on literature data as a short summary hs and k 0 are the two unknowns when applying the model to experimental data the problem can thus be formulated into the following equation 7 r g a m c c o 2 f h s k 0 α i f represents the model α i are known parameters for example the chamber radius rc from experimental settings or the diffusion constant of co2 d which is well documented in the literature hs and k 0 are tunning parameters r g a and m are outputs of the model that can be measured from images therefore one could test if the model captures the behaviors of r g a and m under reasonable values of hs and k 0 table 1 provides a narrow range of k 0 in addition since the deepest micromodel we use has a 20 micron depth 0 hs h 20μm holds for all experiments the search for correct values that reproduce experimental behaviors is not prohibitively expensive due to narrow range of solution space 3 results and discussion 3 1 dissolution regimes and their interpretations we conducted seven dissolution experiments under different acid concentrations and injection rates we observed three different regimes of solid dissolution in the microchamber fig 6 shows the snapshots of three typical dissolution experiments the first row has an acid displacing velocity of 1600μm s pe 430 exp 1 the second row 290μm s exp 2 pe 62 and the third row 19μm s exp 3 pe 4 the first column is the start of observation t 0 which is approximately the time acid enters the chamber acid concentration in exp 1 3 is 0 2 mol l chamber radii for exp 1 2 3 are 500μm 400μm 400μm exp 4 7 details in supplemental materials are conducted with radii of 300 and 400 microns under different acid concentrations we use different radii of chamber to obtain more variation in dimensionless numbers in exp 1 figs 6 a d acid invades the chamber at high velocity pe 430 and the grains are dissolved without formation of gaseous co2 at lower velocity pe 62 in exp 2 figs 6 e h acid solid contact leads to gaseous co2 enveloping the solids prior to t 131s radius of the bubble starts decreasing and the protected solids are exposed the exposed solids and gas phase are dissolving simultaneously at even lower velocity pe 4 in exp 3 figs 6 i l radius of the bubble fluctuates note that t 1390s is not the earliest time of gas presence from fig 6 j to k the bubble shrinks and exposes some solids from k to l the bubble grows to full size again apparently from k to l the exposed solids and their reaction with acid induce co2 supersaturation several cycles are observed in the experiment eventually both solids and gas are dissolved by acid we name these three regimes nongaseous gaseous nonbreathing and gaseous breathing bubble breathing behavior is also found in other physical processes e g co2 bubble traveling through regions with varying temperature tumarkin et al 2011 however to our knowledge bubble breathing in calcium carbonate dissolution has not been reported importantly we observed residual water in the co2 swept region as indicated in e g fig 6 j this is caused by water wet surface of the grains and the nonwetting co2 is not able to displace all water due to capillary pressure these observations reveal interesting interactions between aqueous gaseous and solid phases in a confined geometry utilizing methods developed in section 2 3 we can quantify the experimental observations and test if the model in section 2 2 captures the dissolution dynamics inputs for the model are listed in table 2 hs and k 0 in the table are tuned values that fit experimental r g a and m data data for exp 4 7 are also included in the table it is important to note that in table 2 the values for c h 0 are taken as acid concentrations used in experiments however by definition c h 0 is the h concentration in acid and thus is in principle not the same as acid concentration because hcl is a strong acid that fully dissociates in water it is justified to take acid concentration as h concentration comparison between theoretical and experimental r g a is shown in figs 7 a b and c for exp 1 2 and 3 respectively figs 7 d e and f display the comparison between simulated solid mass evolution m t and experimental evolution of m corresponding to a b and c figs 7 g h i show the simulated c c o 2 the model fits experimental r g a and m well however there are two discrepancies first in contrast to model prediction bubble radii in experiments cannot grow to exactly 400 microns because there is a thin film of water e g in fig 6 f j l on the surface of chamber wall second the fluctuation in the model is more frequent than in the experiments this is because the model does not consider the wettability interaction between the gas liquid interface and solid grains which may have delayed the movement of the interface despite the discrepancy the model reproduces the three regimes i e nongaseous fig 7 a gaseous nonbreathing fig 7 b and gaseous breathing fig 7 c the simulation corroborates that co2 supersaturation leads to gaseous co2 in nongaseous regime figs 7 a d g c c o 2 cannot exceed cs 0 034mol l because strong advection limits accumulation of co2 species in the chamber at around 42s the solids are all consumed following which c c o 2 decreases to zero in fig 7 e and f at the beginning there is a short single phase period when the system exhibits linear dissolution like in fig 7 d following this period acid solid reaction leads to co2 supersaturation and gas phase dominates the chamber during the gas dominance acid can only migrate through edge of the chamber as a result merely the grains near wall react with acid see e g southeast edge of the chamber in fig 6 f since acid volume is small the dissolution of these boundary grains is very slow slow dissolution of the boundary grains stabilizes the bubble thus we see a period of roughly constant gas volume radius in both fig 7 b around 10s to 120s and fig 7 c around 80s to 1200s once these boundary grains are gone the bubble cannot be sustained and it dissolves dissolution of the bubble admits larger acid volume and the newly exposed solids can be dissolved faster this transition from liquid dominance to gas dominance and back to liquid dominance engenders a staged dissolution pattern as shown by fig 7 e and f where the consumption of solid has two inflection points the three staged dissolution is a common feature between the two gaseous regimes the difference is that the gaseous breathing regime could have multiple supersaturations after the first one as a result the bubble fluctuates to explain it details of solid consumption in the three stages must be investigated fig 8 shows the simulated evolution of areal mass density distribution m r t for exp 2 and 3 at the beginning before around 10s in fig 8 a and 80s in fig 8 b masses at all radii are being consumed this single phase stage gives rise to gaseous co2 and it dominates the chamber during the gas dominance around 10s 120s in fig 8 a and 80s 1200s in fig 8 b dissolution of solid is limited to radii near the chamber s edge after the dissolution of boundary grains gas phase dissolves and exposes more solids therefore in both fig 8 a and b we see a retreat of mass in the radial direction we define a quantity rmb rs the current boundary of solid mass mathematically it is the largest radius within which nonzero mass density can be found 8 r m b t max m r t 0 r if r m b r g a there are solids outside the bubble if r m b r g a all solids are covered by the bubble simulated evolutions of rmb for exp 2 and 3 are shown in fig 9 a and c compared against r g a as shown in fig 9 a in the nonbreathing regime r g a is always smaller than rmb fig 9 b is a schematic for the evolution in a from state b 4 to b 8 gas dissolution and solid dissolution occur at the same time under increasing liquid dominance in earlier states b 1 to b 3 gas dominance since acid volume is small the consumption of the boundary grains maintains co2 saturation in the liquid such that the gas phase is stabilized in exp 3 advection in the aqueous phase is much weaker which significantly increases the system s ability to accumulate co2 species fig 9 c shows r g a is almost always larger than rmb fig 9 d is a schematic for the evolution in fig 9 c states d 4 to d 9 correspond to the period where the most fluctuation is observed in fig 9 c from d 4 to d 5 acid solid contact leads to gas growth as soon as the interface exceeds the solid boundary co2 production stops thus from d 5 to d 6 gas dissolves and retreats at d 6 acid contacts solid again which leads to another growth of gas we note that the fluctuation is dampened at early and late stages at early stage d 1 to d 3 the system is under gas dominance and acid volume is small thus dissolution of boundary grains can cause large fluctuation in c c o 2 fig 7 i nevertheless it cannot drive large fluctuation in r g a because of geometric confinement at late times d 10 d 13 acid dominates the chamber the aqueous phase becomes more capable of absorbing co2 species and the concentration fluctuates less fig 7 i as a result r g a fluctuates less near the end r g a is approximately equal to rmb as we conclude this section it is worth noting that in each experiment we have different amount distribution and morphology of calcium carbonates they lead to different details of dissolution however these details do not impact the distinction between different regimes for instance exp 1 4 6 are in the nongaseous regime and exhibit the same linear dissolution see fig 7 d and fig s2 s4 s6 in supplemental materials the differences are the intercept and slope of the line exp 2 3 7 are in gaseous regimes and the dissolution is characteristically nonlinear see fig 7 e f and fig s8 in supplemental materials although there are differences in exact shape of the curves they exhibit the same three staged characteristics exp 3 and exp 7 differ greatly in initial and operating conditions but they both allow a breathing bubble therefore the three regimes should be general patterns and distribute in a wide range of transport and reaction conditions 3 2 phase diagrams to explore how the regimes distribute in parametric space we vary the dimensionless numbers eq 5 in a wide range and simulate the model in section 2 2 phase diagrams for the regimes are constructed in fig 10 as θ decreases the area of gaseous breathing regime decreases in the phase diagram while the nongaseous regime expands gaseous nonbreathing regime is in between the other two and its maximum area is achieved at intermediate θ finally when θ drops to 2 stoichiometric coefficient of eq 1 there is only nongaseous regime the evolution of these phase diagrams confirms that the regimes form because of competition between reaction and transport the locations of exp 1 2 3 θ 5 9 exp 4 θ 2 exp 5 and 6 θ 2 4 and exp 7 θ 14 7 are labeled in the diagrams dimensionless numbers and regime categorizations for exp 1 7 are listed in table 3 numbers in table 3 are calculated from table 2 because the regime boundaries in fig 10 are linear one may write simple empirical relations to summarize as follows 9 p e ξ 1 θ d a i i g a s e o u s b r e a t h i n g ξ 1 θ d a i i p e ξ 2 θ d a i i g a s e o u s n o n b r e a t h i n g p e ξ 2 θ d a i i n o n g a s e o u s ξ1 θ and ξ2 θ are empirical functions of the concentration ratio these two functions represent the slopes of boundaries in the phase diagram fig 11 shows the trend of ξ1 θ and ξ2 θ versus θ ξ1 and ξ2 increase with θ by different rate which is crucial for the origin of the gaseous nonbreathing regime with the correlation between the ξ s and θ combined with eq 9 identification of dissolution regimes can be achieved although our experiments are conducted under atmospheric conditions the phase diagrams are based on dimensionless parameters thus could still be instructive for other pressure temperature conditions isotherms of solubility cs in water wiebe and gaddy 1940 and cacl2 solution prutton and savage 1945 increases with pressure up to hundreds of atm well beyond the co2 critical point 72 8 atm 31 c hence elevated pressure tends to decrease θ however the increase of c h 0 offsets this effect so the gaseous regimes can still be favored this explains previous results where high hcl concentration for subsurface reservoir acidizing produces large amount of co2 phase in the pore space soulaine et al 2018 thompson and gdanskl 1993 note that in the subsurface co2 may be in liquid or supercritical liquid state and may not be called a gas but a supercritical co2 bubble jiménez martínez et al 2020 is still lighter than water and nonwetting wang et al 2013 hence it should behave similarly to a gaseous co2 bubble in the pore since higher h concentration means lower ph the analysis for effect of θ may also apply to that of ph albeit with a reversed trend moreover the reaction product ca2 may cause ph buffering as shown in fig 7 and fig s8 the breathing regime requires fluctuation of c c o 2 and thus fluctuation of ch from eq 1 equivalently a fluctuating ph is required hence if ph buffering occurs the fluctuation can be reduced and the breathing regime may be less favorable so its area in the phase diagrams may decrease which ultimately leads to larger gap between ξ1 and ξ2 in addition to θ daii reactivity and pe advection are also needed to determine the regime for hcl carbonate kr is on the order of 10 4m s according to references in table 1 for weak acid e g acetic acid it is on the order of 10 6m s fredd and fogler 1998 therefore daii for weak acid carbonate could be two magnitudes smaller experimental daii s are in the range of 101 to 102 with pe ranging from 100 to 102 table 3 thus for weak acid carbonate daii could range from 10 1 to 100 meaning that to obtain the same breathing and nonbreathing regimes pe for weak acid should be around 10 2 to 100 which is reasonable for subsurface flow therefore we expect all three regimes could present in the subsurface but a comprehensive evaluation of acid concentration co2 solubility advection strength and reactivity is needed to determine the regime for a specific location in the subsurface 3 3 limitations the model does not consider wettability interactions between gas liquid interface and solid grains it delays motion of the interface and may explain why the modeled r g a fluctuates more frequently than experimental data this discrepancy is salient for exp 3 however in exp 7 it is negligible fig s8 which seems to suggest under stronger advection and higher h concentration such wettability interaction is less important however in both cases the wettability effect leads to residual water between solid grains it means the model could underestimate r g a the details of wettability interactions should be studied in future work for example the breathing bubble also means periodic change of gas saturation in the chamber which can be viewed as cycles of drainage and imbibition further investigations into this reactive drainage imbibition process may improve our understanding of reactive interfacial dynamics in subsurface systems one experimental limitation is that 2d images do not provide information in the vertical direction consequently the average depth hs reduces to a tuning parameter this is not restrictive here because our purpose is to study the regimes which are independent of hs second the experiments utilize precipitation of calcium carbonate to populate minerals in the glass chamber the question is can we observe the same phenomena if instead using a geomaterial micromodel jiménez martínez et al 2020 song et al 2014 we expect at early time similar behavior would occur where reaction creates a co2 bubble in the chamber which may or may not fluctuate depending on advection and reaction however the chamber and channel become larger and wider with more dissolution and the system gradually loses geometric confinement eventually the bubble will be pushed out new bubbles can be produced but they cannot remain forming a moving train of bubbles song et al song et al 2014 s observation in a calcite channel these observations are different than those here however fundamentally they share the same physics availability of reactive surfaces is limited by co2 coverage and the interplay between acid mineral reaction and liquid transport regulates co2 growth decay movement which in turn determines availability of reactive surfaces therefore we believe the coupling relations in fig 3 are still valid but the details of each relation may change due to different experimental setups 4 conclusions we have discovered novel regimes of calcium carbonate dissolution in micron scale confined spaces via microfluidic experiments the experimental observations are verified and interpreted by a simple mathematical model the three regimes nongaseous gaseous nonbreathing and gaseous breathing are shown to result from the interplay between reaction transport and geometric confinement diagrams distinguishing different regimes are charted under dimensionless numbers and an empirical relation is proposed it must be emphasized that our experimental platform and the accompanying mathematical model are still simplistic compared to real subsurface systems however the key contribution of our work is demonstrating that the coverage of reactive surface areas by co2 in carbonate system can interact with dissolution reaction and liquid transport leading to characteristic patterns of motion of fluid interfaces we believe this mechanism should be widely present in nature and may deserve further investigations declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgement the authors thank lucas mejia for his help in micromodel fabrication supplementary materials supplementary material associated with this article can be found in the online version at doi 10 1016 j advwatres 2022 104200 appendix b supplementary materials image application 1 appendix model development relations a c relations a c are described by eq 2 and eq 3 here we list them for completeness as eq a1 and eq a2 a 1 d c h t d t k t v 2 r c c h t v 2 r c c h 0 a 2 d c c o 2 t d t v 2 r c c c o 2 t 1 2 k t c h t relation d relation d is a co2 growth model let us consider a bulk co2 bubble which observes the following equation hey et al 1994 a 3 d r d t d c c o 2 t c s ρ g r where r is radius of a spherical bubble d is the diffusion constant of co2 in water cs is the saturated concentration of co2 in water and ρ g is gaseous co2 density one may integrate eq a 3 and consider r t 0 0 which leads to r t 2 d ρ g i t 1 2 where a 4 i t 0 t c c o 2 t c s d t if i t 0 the system is undersaturated and there would be no gaseous co2 hence we must enforce r t to be zero one may conveniently rewrite eq a 4 as a 5 r t 2 d ρ g i t θ i t 1 2 here θ x 0 i f x 0 1 i f x 0 is the heaviside function abramowitz and stegun 1972 volume of this bubble is therefore a 6 v g t 4 3 π r t 3 4 3 π 2 d ρ g i t θ i t 3 2 when it is fitted into the chamber in fig 2 the resultant r g a is determined by both vg and the current volume of solids in the chamber relation f based on m r t we can calculate how many solids m t are currently in the region of 0 rs hence the available vacant space within rs is a 7 v a v a t π r s 2 h m t ρ s where ρ s is the density of solids if vg t vava t the bubble cannot fill the vacant space within rs and cover all the solids hence r g a t r s consequently r g a is determined by a 8 v g t 0 r g a t m r t ρ s 2 π r d r π r g a t 2 h if v g t v a v a t this equation states that volume enveloped by r g a is the sum of gas and solid volumes eq a 8 is an implicit equation for r g a on the other hand if vg t vava t r g a would be larger than or equal to rs in this case equation for r g a t is simply a 9 π r g a t 2 r s 2 h v a v a t v g t if v g t v a v a t this equation is quadratic for r g a relations g and h relations g and h are the model for effective reaction rate k we define a local reaction rate constant as follows a 10 k l o c a l r t k 0 π r s 2 θ m r t the maximum value k 0 is distributed uniformly within 0 rs heaviside function enforces that if no solids are present there would be no local rate given r g a t at time t k collects all local contributions a 11 k t r g a t r s k l o c a l r t 2 π r d r at first acid solid contact all solids are exposed r g a 0 0 and eq a 11 gives k k 0 when r g a exceeds rs k 0 relations e and i the local mass change reads a 12 d d t m r t 1 2 k l o c a l r t c h t x c a c o 3 π r c 2 r g a t 2 h x c a c o 3 is the molar mass of calcium carbonate π r c 2 r g a t 2 h is the current volume of acid in the chamber which converts h concentration to moles the combination of eqs a 1 2 6 12 simulates the evolution of r g a and solid mass they are numerically solved by the euler s method 
143,we report the discovery of novel regimes of calcium carbonate dissolution in micron scale confined spaces through microfluidic experiments in the experiments hydrochloric acid is injected into a microfluidic chamber with pre deposited calcium carbonate solids as the acid flow rate is decreased the dissolution of calcium carbonate transits from a liquid solid single phase reactive transport regime to a gas liquid solid two phase one the two phase regime further splits into two different regimes one with fluctuating and the other with nonfluctuating gaseous co2 phase we name the three regimes as nongaseous gaseous breathing and gaseous nonbreathing the experimental observations are reproduced and interpreted by mathematical modeling results show that the regimes are controlled by the ratio of h concentration and saturated co2 concentration the peclet number and the second damkohler number dimensionless diagrams distinguishing different regimes are presented and an empirical relationship is proposed our results offer insights into various engineering and natural processes e g geological carbon storage petroleum reservoir acidizing karst dissolution and others that are governed by small scale multiphase reactive flow physics keywords calcium carbonate dissolution regimes microfluidics multiphase reactive transport 1 introduction geological carbon storage bickle 2009 bachu 2008 orr 2009 bui et al 2018 has become an industrial solution to address increased anthropogenic co2 in the atmosphere captured co2 from emission sources are injected into subsurface geological formations for permanent storage by various trapping mechanisms structural residual solubility and mineralization bickle 2009 bachu 2008 matter and kelemen 2009 jun et al 2013 there are several candidate types of geological formations for carbon storage to name a few depleted oil gas reservoirs stevens et al 2001 deep sea sediments house et al 2006 and deep saline aquifers nordbotten et al 2005 celia et al 2015 the storage capacity of co2 in deep saline carbonate formations is enormous because of their worldwide abundance celia et al 2015 song et al 2018 however the dissolution of carbonate minerals by co2 acidified brines may undermine the security and integrity of carbon storage song et al 2018 by chemo mechanical rock alteration sun et al 2016 on the other hand this reactivity is necessary for mineral trapping molins et al 2014 steefel et al 2013 therefore it is a nontrivial task to characterize how these minerals are dissolved by acid in the micron scale confined pore spaces of rocks not limited to carbon storage carbonate dissolution occurs in various engineering and natural processes such as petroleum reservoir acidizing mcleod 1984 and karst dissolution frisia and borsato 2010 gombert 2002 in a broader sense carbonate dissolution is an important step in global carbon cycle and impacts long term balance of carbon dioxide in the atmosphere gombert 2002 traditionally the study of carbonate dissolution has focused on the darcy scale one example is core flooding fredd and fogler 1998 depending on the flow and reaction conditions and rock heterogeneity acid can penetrate the carbonate rock in complex patterns fredd and fogler 1998 fredd and fogler 1998 tansey and balhoff 2016 e g wormholing fredd and fogler 1998 and channeling menke et al 2016 although early studies fredd and fogler 1998 fredd and fogler 1998 lund and fogler 1975 hoefner and fogler 1988 have focused primarily on the impact of macroscopic transport and reaction conditions e g acid injection rate and reactivity recent works focus more on the complexity of rock pore structure and its impact on dissolution profile for instance both numerical simulations nunes et al 2016 and experiments menke et al 2016 have shown that carbonate dissolution patterns are structure dependent the sample averaged dissolution rate could be up to two magnitudes smaller nunes et al 2016 than that from a batch experiment similarly field scale dissolution rates are reported to be orders of magnitudes smaller than experimental batch rates swoboda colberg and drever 1993 and it is believed to be caused by mineral heterogeneity and incomplete mixing in a heterogeneous flow field menke et al 2016 in addition to complexity in rock structures for carbonate dissolution by co2 acidified brine brine ph and dissolution dynamics are influenced by temperature and pressure peng et al 2013 peng et al 2015 furthermore carbonate dissolution releases cations such as ca2 which can buffer the brine ph jun et al 2013 kharaka et al 2006 therefore for a co2 acid carbonate system there can be a hierarchy of complexity spanning different physicochemical aspects as such the pore scale becomes very important since it is the scale at which fundamental physicochemical processes occur steefel et al 2013 and contribute to emerging behaviors at a larger scale roded et al 2021 advancements in rock pore scale imaging and modeling techniques blunt et al 2013 have allowed researchers to study pore scale events with unprecedented detail popular imaging techniques include micro ct scanning wildenschild and sheppard 2013 and fast synchrotron tomography menke et al 2016 berg et al 2013 micro ct delivers high spatial resolution of several micron but requires a long time hours to minutes menke et al 2016 to resolve the image thus is limited in capturing dynamic changes the fast synchrotron tomography which has been successfully applied to carbonate dissolution can reduce the processing time to about one minute per scan and thus be more suited for dynamic imaging menke et al 2016 furthermore results from experimental imaging often require numerical simulations to interpret and elucidate underlying mechanisms popular methods for simulating pore scale reactive transport include but not limit to the lattice boltzmann method tian and wang 2018 kang et al 2010 yoon et al 2015 direct numerical simulation molins et al 2012 and pore network modeling tansey and balhoff 2016 esteves et al 2020 esteves et al 2021 recently new methods are proposed to simulate carbonate dissolution e g the darcy brinkman formulation soulaine et al 2018 soulaine et al 2017 a micro continuum approach where flow in large void space is solved by navier stokes equation while in solid dominated region it is solved by darcy s law there is also work demonstrating the limitations of the darcy brinkman approach such as that it can predict early acid breakthrough d p ferreira et al 2020 another novel approach is the continuous time random walk model which is recently applied to a carbonate dissolution problem oliveira et al 2021 in general each method excels in certain aspects but has limitations in carbonate dissolution co2 is a product of acid mineral reaction which can be either solubilized in the aqueous phase or form a separate co2 phase prutton and savage 1945 bastami et al 2014 however the assumption that co2 is fully solubilized in the aqueous phase is widely employed either explicitly or implicitly in core flooding studies fredd and fogler 1998 fredd and fogler 1998 lund and fogler 1975 hoefner and fogler 1988 micromodel experiments yoon et al 2019 and numerical simulations molins et al 2014 oliveira et al 2021 yoon et al 2019 gray et al 2018 oliveira et al 2020 with full solubilization dissolution is in liquid solid single phase regime and events in a single pore can be treated in a simplistic manner such as pore enlargement and mergence between adjacent pores tansey and balhoff 2016 esteves et al 2020 esteves et al 2021 since co2 solubility in water is significantly higher under elevated pressure wiebe and gaddy 1940 it seems reasonable to adopt this assumption given the subsurface high pressure condition however previous results showed that it is dependent on the acid concentration more specifically the authors indicated that 60 of produced co2 can be solubilized by consuming a 5 hcl at 7 mpa while for a 15 hcl 70 mpa is required to keep merely 30 of produced co2 solubilized in the aqueous phase soulaine et al 2018 prutton and savage 1945 thompson and gdanskl 1993 considering that in petroleum reservoir acidizing often high concentrations of strong acid are used a co2 acid carbonate two phase dissolution regime should exist in the subsurface and the full solubilization assumption is not always valid in carbon storage the injected co2 acidifies resident brine and makes carbonic acid which is a weak acid however in industrial scale co2 injection projects due to economics the injected co2 stream is not pure and impurities such as sulfur and nitrogen oxides may inevitably present song et al 2014 which reduces the reservoir ph to as low as 1 song et al 2018 knauss et al 2005 benson and cole 2008 when there is a separate co2 phase carbonate dissolution could behave very differently from single phase for example recent numerical simulations soulaine et al 2018 suggest that presence of gaseous co2 produced by acid carbonate reaction may prevent the emergence of wormholes as a comparison core scale acid co2 co injection experiments observe the same phenomenon where the injected co2 phase prevents the growth of wormhole seeds ott and oedai 2015 the authors suggest extending the study of single phase dissolution to multiphase dissolution by introducing new parameters in addition to peclet and damkohler numbers ott and oedai 2015 recently the so called grain engulfment mechanism song et al 2018 is proposed where a calcite post in a microfluidic channel is enveloped by locally produced gaseous co2 and is protected from the acidic water similar to ott and oedai 2015 work grain engulfment is essentially nonaqueous phase covering reactive surfaces and thus redirecting the acid flux a recent numerical study li et al 2022 further shows that the mechanism by which co2 phase changes carbonate dissolution is not only by covering the reactive surfaces but also the change of local velocity profiles due to its presence in the flow path therefore one would expect that there could be some patterns regimes determined by both reaction and transport in multiphase dissolution however most of these pioneering works in multiphase carbonate dissolution remain focused on how the traditional regimes are modified by multiphase flow interactions there is not yet a study to directly showcase new multiphase regimes and characterize them in a wide parametric range furthermore given that the co2 acid carbonate two phase dissolution is confined in micropores of rock one may also expect the regimes to be shaped by geometric confinement in this work to directly observe and quantify the dissolution dynamics of calcium carbonate in micron scale confined spaces we utilize microfluidics as the experimental platform microfluidics whitesides 2006 is traditionally an important tool for chemical and biological analysis chen et al 2017 shang et al 2017 song and ismagilov 2003 nilghaz et al 2012 martinez et al 2010 however the utilization of microfluidics and micromodels microfluidic model porous media anbari et al 2018 for subsurface porous media fluid flow starts no later than the 1950s chatenever and calhoun 1952 microfluidics has emerged as a popular tool for subsurface studies in many subareas e g enhanced oil recovery lifton 2016 mejia et al 2020 xu et al 2017 xu et al 2015 underground fluid and solute transport bultreys et al 2016 geological carbon storage song et al 2018 ho and tsai 2020 morais et al 2020 kim et al 2013 sell et al 2013 miri et al 2015 nooraiepour et al 2018 etc an important advantage of microfluidics for subsurface studies is the direct visualization of pore scale phenomena which allows the development of novel mechanistic models since it is direct visualization via optics the time step of obtaining images could be small e g one second this has significant advantages over tomography type techniques in terms of capturing fast processes in our experiments calcium carbonates are deposited in a glass microchamber by precipitation reaction following which the precipitated solids are dissolved by injecting hydrochloric acid the dissolution process is recorded as image sequences and detailed mathematical modeling is conducted to interpret the results the experimental findings in conjunction with the insights from mathematical modeling reveal novel regimes and mechanisms of calcium carbonate dissolution in micron scale confined spaces 2 materials and methods 2 1 experimental procedures the experimental setups are shown in fig 1 a the system consists of syringes hamilton 500μl and a syringe pump chemyx fusion 400 that inject fluids into the microchip a microscope accuscope exi 310 which monitors the microchamber and a computer that processes the images obtained through the microscope the syringes are connected by plastic pipes to the injection port s of the chip a b or c in fig 1 b these ports are drilled with a diameter of 1mm the glass microchip is fabricated by standard photolithography and hf etching method as described by our research group mejia et al 2020 xu et al 2017 and others anbari et al 2018 fig 1 b shows the dimension of the chip it is a y junction like model with a circular chamber fig 1 c at the junction of three microchannels indicated by yellow dashed lines the radius of this chamber is 400 microns other models with 300 and 500 micron radius are also fabricated the width of the inlet outlet channel is one fifth of the chamber radius for a co2 bubble to escape the chamber it must deform at the chamber channel intersection and finger into the channel however a narrow channel guarantees the initial meniscus curvature is large and the high capillary pressure would prevent it from happening therefore the bubble will be confined within the chamber the depth of the chamber is 10 microns models with 20 micron depth are also fabricated the design serves as a proxy of a single pore in a porous medium before conducting the dissolution experiments we deposit caco3 in the chamber by mixing cacl2 and na2co3 solutions 10 wt injected from ports a and b the injection rates of reagents range between 101 and 102 µl h experiments are conducted under atmospheric pressure and room temperature depending on flow rate schuszter et al 2016 schuszter et al 2016 supersaturation value jaho et al 2016 pore size stack et al 2014 and micromodel wettability tzachristas et al 2020 the precipitants can have different spatial distribution and exhibit various morphologies however there is no need to control these variables because in situ minerals distribute nonuniformly and exhibit various morphologies in real rocks once solid deposition is complete we flush the chip with deionized water to remove remaining reagents hcl acid is then injected into the chamber 2 2 mathematical modeling to model the experiments let us consider a simple conceptual model as shown in fig 2 radius of the chamber is denoted as rc fig 1 c solids distribute in a region with radius of rs rs rc depth of the chamber is denoted as h h rc acid invades the chamber from the inlet contacts the solids reacts and leaves through the outlet the reaction is represented by fredd and fogler 1998 fredd and fogler 1998 lund and fogler 1975 hoefner and fogler 1988 esteves et al 2020 1 cac o 3 s 2 h aq ca aq 2 h 2 o l c o 2 aq g co2 can be gaseous if supersaturation in aqueous phase is reached hey et al 1994 fig 2 employs several assumptions first the co2 bubble occupies center of the water wet chamber second the bubble does not leave the chamber such that variation of its size is dictated by mass transfer at fluid interface co2 solubilization and evaporation third one can define a space averaged h concentration ch t and solubilized co2 concentration c c o 2 t in the chamber both functions of time change in ch stems from three sources first replenishment from upstream acid c h 0 in an experiment this is the h concentration we inject second consumption due to reaction with calcium carbonate third the loss due to fluid transport one can write 2 d c h t d t k t v 2 r c c h t v 2 r c c h 0 the two term coefficient of ch t measures declination rate due to reaction and transport v is the acid displacing velocity k t is defined as an effective reaction rate in unit s 1 between acid and solid the equation for solubilized co2 concentration reads 3 d c c o 2 t d t v 2 r c c c o 2 t 1 2 k t c h t the first term on the right hand side accounts for transport of co2 species to downstream the second term denotes production of co2 from eq 1 in fig 2 r g a is the apparent bubble radius we term it apparent because this bubble contains volume of solids we define m r t unit μg μm2 as the radial distribution of areal mass density of solids where r rs is an arbitrary radius from the chamber center m is a function of radius because variation in r g a leads to exposure of solids at different radii ch c c o 2 k r g a and m are the five fundamental quantities in the model and other properties can be derived from them for instance the total solid mass denoted as m t is an areal integral of m m t 0 r s m r t 2 π r d r the coupling relationship among these quantities is displayed in fig 3 an arrow in fig 3 indicates a direct relation between the two quantities relation a is in eq 2 note that v and c h 0 impact ch as well but in an experiment these two are constants hence are not included relations b and c are in eq 3 relation d represents a co2 growth model it defines a saturated co2 concentration cs in water80 solubility and the gas phase grows and shrinks following supersaturation c c o 2 c s and undersaturation c c o 2 c s relation e stems from geometric confinement the larger r g a the more acid expelled out of the chamber and less acid available for reaction with m relation f originates from the fact that the bubble contains solid volume and how m evolves regulates how gas fills in the vacant space relation i the h concentration influences how fast the exposed solids are dissolved relations g and h are the model for effective reaction rate k only the region outside r g a contributes to k relation g moreover for a location outside r g a if there are no longer solids to react it does not contribute to k relation h the maximum value of k which we denote as k 0 s 1 is achieved when no gas phase presents e g fig 2 a while k reduces to zero if all solids are covered by gas e g fig 2 c k 0 relates to the conventional kinetic constant of a heterogeneous chemical reaction kr peng et al 2015 esteves et al 2020 gray et al 2018 m s 1 by a characteristic length lc 4 k 0 k r l c in our model lc is taken as the chamber radius rc details of relations d i are in the appendix fig 3 reveals strong coupling among the quantities although individual relation may be simple equations in the model are numerically solved by the euler s method furthermore three dimensionless numbers can be constructed 5 p e v r c d d a i i k 0 r c 2 d θ c h 0 c s where d is the diffusion constant of co2 pe is the peclet number daii is the second damkohler number pe represents the strength of acid advection while daii represents the rate of acid mineral reaction θ is defined as the ratio of h concentration c h 0 to co2 solubility cs it measures the ability to reach co2 supersaturation in the aqueous phase for example if c h 0 is lower than 2cs θ 2 regardless of transport and reaction conditions c c o 2 cannot reach cs according to stoichiometric relation in eq 1 when θ 2 supersaturation is possible and transport and reaction conditions will impact dissolution behaviors faster acid mineral reaction higher daii leads to faster production of co2 and thus facilitates supersaturation however stronger advection higher pe leads to quicker evacuation of chemical species to downstream and thus retards supersaturation therefore in different range of dimensionless numbers one may expect different dissolution behavior 2 3 measurement and image processing experimental dynamics of calcium carbonate dissolution is obtained from analyzing microscopic images we process the images through a combination of imagej and matlab first we quantify areal mass density distribution namely m 0 r m r 0 and m r t second we measure r g a from images the workflow of estimating areal mass density distribution is exemplified in fig 4 starting from the raw image fig 4 a also fig 1 d in imagej an otsu color thresholding procedure is applied and the image is binarized fig 4 b images have a scale of 1 06 pixels µm solid population in fig 4 a consists of well grown crystals they are partially transparent under microscope light and when converted to binary image only the edges are in black pixels the internal white pixels must be filled to accurately count the total area occupied by particles by particle analysis in imagej a mask image can be generated as shown in fig 4 c the mask image merely blackens the internal pixels of the particles we sum the two images and obtain fig 4 d where all areas occupied by particles are black pixels a radial scanning procedure in matlab is implemented on fig 4 d to generate the areal mass density distribution at radius r a narrow annulus with a width of one hundredth of rs exaggerated in the figure is constructed the area of this annulus is denoted as δsannulus r and we count the area of black pixels in this annulus as δsblack r thus the pixel density of solids is δsblack r δsannulus r suppose the solids have a density of ρ s and an average depth of hs hs h the areal mass density is 6 m 0 r δ s b l a c k r h s ρ s δ s a n n u l u s r the unit is mass area in this expression we do not know hs a priori because the images only provide 2d information given hs we can proceed from fig 4 d to fig 4 e and use it as initial condition in the model here the estimated hs for fig 4 d is 3μm this value is determined by fitting to experimental data which is explained near the end of this section the above procedure is also applied to images at a later point such that the experimental evolution of solid mass can be determined in the measurement of r g a when bubbles are circular identification of radius is straightforward however the gas liquid interface could be deformed by the water wet grains we adopt a procedure in fig 5 an equivalent r g a is drawn in the image and two areas sin blue and sout orange are identified we adjust the equivalent r g a until the two areas are equal to make sure gas volume is conserved finally k 0 s value is needed for the model but cannot be measured from images published works provide a range for kr and by eq 4 one can calculate k 0 for example gray et al gray et al 2018 used a value of 2 5 10 4m s 1 for kr for microchambers with different radii 300μm 400μm and 500μm in our experiments k 0 would be 0 83s 1 0 63s 1 and 0 5s 1 table 1 summarizes reference values for k 0 based on literature data as a short summary hs and k 0 are the two unknowns when applying the model to experimental data the problem can thus be formulated into the following equation 7 r g a m c c o 2 f h s k 0 α i f represents the model α i are known parameters for example the chamber radius rc from experimental settings or the diffusion constant of co2 d which is well documented in the literature hs and k 0 are tunning parameters r g a and m are outputs of the model that can be measured from images therefore one could test if the model captures the behaviors of r g a and m under reasonable values of hs and k 0 table 1 provides a narrow range of k 0 in addition since the deepest micromodel we use has a 20 micron depth 0 hs h 20μm holds for all experiments the search for correct values that reproduce experimental behaviors is not prohibitively expensive due to narrow range of solution space 3 results and discussion 3 1 dissolution regimes and their interpretations we conducted seven dissolution experiments under different acid concentrations and injection rates we observed three different regimes of solid dissolution in the microchamber fig 6 shows the snapshots of three typical dissolution experiments the first row has an acid displacing velocity of 1600μm s pe 430 exp 1 the second row 290μm s exp 2 pe 62 and the third row 19μm s exp 3 pe 4 the first column is the start of observation t 0 which is approximately the time acid enters the chamber acid concentration in exp 1 3 is 0 2 mol l chamber radii for exp 1 2 3 are 500μm 400μm 400μm exp 4 7 details in supplemental materials are conducted with radii of 300 and 400 microns under different acid concentrations we use different radii of chamber to obtain more variation in dimensionless numbers in exp 1 figs 6 a d acid invades the chamber at high velocity pe 430 and the grains are dissolved without formation of gaseous co2 at lower velocity pe 62 in exp 2 figs 6 e h acid solid contact leads to gaseous co2 enveloping the solids prior to t 131s radius of the bubble starts decreasing and the protected solids are exposed the exposed solids and gas phase are dissolving simultaneously at even lower velocity pe 4 in exp 3 figs 6 i l radius of the bubble fluctuates note that t 1390s is not the earliest time of gas presence from fig 6 j to k the bubble shrinks and exposes some solids from k to l the bubble grows to full size again apparently from k to l the exposed solids and their reaction with acid induce co2 supersaturation several cycles are observed in the experiment eventually both solids and gas are dissolved by acid we name these three regimes nongaseous gaseous nonbreathing and gaseous breathing bubble breathing behavior is also found in other physical processes e g co2 bubble traveling through regions with varying temperature tumarkin et al 2011 however to our knowledge bubble breathing in calcium carbonate dissolution has not been reported importantly we observed residual water in the co2 swept region as indicated in e g fig 6 j this is caused by water wet surface of the grains and the nonwetting co2 is not able to displace all water due to capillary pressure these observations reveal interesting interactions between aqueous gaseous and solid phases in a confined geometry utilizing methods developed in section 2 3 we can quantify the experimental observations and test if the model in section 2 2 captures the dissolution dynamics inputs for the model are listed in table 2 hs and k 0 in the table are tuned values that fit experimental r g a and m data data for exp 4 7 are also included in the table it is important to note that in table 2 the values for c h 0 are taken as acid concentrations used in experiments however by definition c h 0 is the h concentration in acid and thus is in principle not the same as acid concentration because hcl is a strong acid that fully dissociates in water it is justified to take acid concentration as h concentration comparison between theoretical and experimental r g a is shown in figs 7 a b and c for exp 1 2 and 3 respectively figs 7 d e and f display the comparison between simulated solid mass evolution m t and experimental evolution of m corresponding to a b and c figs 7 g h i show the simulated c c o 2 the model fits experimental r g a and m well however there are two discrepancies first in contrast to model prediction bubble radii in experiments cannot grow to exactly 400 microns because there is a thin film of water e g in fig 6 f j l on the surface of chamber wall second the fluctuation in the model is more frequent than in the experiments this is because the model does not consider the wettability interaction between the gas liquid interface and solid grains which may have delayed the movement of the interface despite the discrepancy the model reproduces the three regimes i e nongaseous fig 7 a gaseous nonbreathing fig 7 b and gaseous breathing fig 7 c the simulation corroborates that co2 supersaturation leads to gaseous co2 in nongaseous regime figs 7 a d g c c o 2 cannot exceed cs 0 034mol l because strong advection limits accumulation of co2 species in the chamber at around 42s the solids are all consumed following which c c o 2 decreases to zero in fig 7 e and f at the beginning there is a short single phase period when the system exhibits linear dissolution like in fig 7 d following this period acid solid reaction leads to co2 supersaturation and gas phase dominates the chamber during the gas dominance acid can only migrate through edge of the chamber as a result merely the grains near wall react with acid see e g southeast edge of the chamber in fig 6 f since acid volume is small the dissolution of these boundary grains is very slow slow dissolution of the boundary grains stabilizes the bubble thus we see a period of roughly constant gas volume radius in both fig 7 b around 10s to 120s and fig 7 c around 80s to 1200s once these boundary grains are gone the bubble cannot be sustained and it dissolves dissolution of the bubble admits larger acid volume and the newly exposed solids can be dissolved faster this transition from liquid dominance to gas dominance and back to liquid dominance engenders a staged dissolution pattern as shown by fig 7 e and f where the consumption of solid has two inflection points the three staged dissolution is a common feature between the two gaseous regimes the difference is that the gaseous breathing regime could have multiple supersaturations after the first one as a result the bubble fluctuates to explain it details of solid consumption in the three stages must be investigated fig 8 shows the simulated evolution of areal mass density distribution m r t for exp 2 and 3 at the beginning before around 10s in fig 8 a and 80s in fig 8 b masses at all radii are being consumed this single phase stage gives rise to gaseous co2 and it dominates the chamber during the gas dominance around 10s 120s in fig 8 a and 80s 1200s in fig 8 b dissolution of solid is limited to radii near the chamber s edge after the dissolution of boundary grains gas phase dissolves and exposes more solids therefore in both fig 8 a and b we see a retreat of mass in the radial direction we define a quantity rmb rs the current boundary of solid mass mathematically it is the largest radius within which nonzero mass density can be found 8 r m b t max m r t 0 r if r m b r g a there are solids outside the bubble if r m b r g a all solids are covered by the bubble simulated evolutions of rmb for exp 2 and 3 are shown in fig 9 a and c compared against r g a as shown in fig 9 a in the nonbreathing regime r g a is always smaller than rmb fig 9 b is a schematic for the evolution in a from state b 4 to b 8 gas dissolution and solid dissolution occur at the same time under increasing liquid dominance in earlier states b 1 to b 3 gas dominance since acid volume is small the consumption of the boundary grains maintains co2 saturation in the liquid such that the gas phase is stabilized in exp 3 advection in the aqueous phase is much weaker which significantly increases the system s ability to accumulate co2 species fig 9 c shows r g a is almost always larger than rmb fig 9 d is a schematic for the evolution in fig 9 c states d 4 to d 9 correspond to the period where the most fluctuation is observed in fig 9 c from d 4 to d 5 acid solid contact leads to gas growth as soon as the interface exceeds the solid boundary co2 production stops thus from d 5 to d 6 gas dissolves and retreats at d 6 acid contacts solid again which leads to another growth of gas we note that the fluctuation is dampened at early and late stages at early stage d 1 to d 3 the system is under gas dominance and acid volume is small thus dissolution of boundary grains can cause large fluctuation in c c o 2 fig 7 i nevertheless it cannot drive large fluctuation in r g a because of geometric confinement at late times d 10 d 13 acid dominates the chamber the aqueous phase becomes more capable of absorbing co2 species and the concentration fluctuates less fig 7 i as a result r g a fluctuates less near the end r g a is approximately equal to rmb as we conclude this section it is worth noting that in each experiment we have different amount distribution and morphology of calcium carbonates they lead to different details of dissolution however these details do not impact the distinction between different regimes for instance exp 1 4 6 are in the nongaseous regime and exhibit the same linear dissolution see fig 7 d and fig s2 s4 s6 in supplemental materials the differences are the intercept and slope of the line exp 2 3 7 are in gaseous regimes and the dissolution is characteristically nonlinear see fig 7 e f and fig s8 in supplemental materials although there are differences in exact shape of the curves they exhibit the same three staged characteristics exp 3 and exp 7 differ greatly in initial and operating conditions but they both allow a breathing bubble therefore the three regimes should be general patterns and distribute in a wide range of transport and reaction conditions 3 2 phase diagrams to explore how the regimes distribute in parametric space we vary the dimensionless numbers eq 5 in a wide range and simulate the model in section 2 2 phase diagrams for the regimes are constructed in fig 10 as θ decreases the area of gaseous breathing regime decreases in the phase diagram while the nongaseous regime expands gaseous nonbreathing regime is in between the other two and its maximum area is achieved at intermediate θ finally when θ drops to 2 stoichiometric coefficient of eq 1 there is only nongaseous regime the evolution of these phase diagrams confirms that the regimes form because of competition between reaction and transport the locations of exp 1 2 3 θ 5 9 exp 4 θ 2 exp 5 and 6 θ 2 4 and exp 7 θ 14 7 are labeled in the diagrams dimensionless numbers and regime categorizations for exp 1 7 are listed in table 3 numbers in table 3 are calculated from table 2 because the regime boundaries in fig 10 are linear one may write simple empirical relations to summarize as follows 9 p e ξ 1 θ d a i i g a s e o u s b r e a t h i n g ξ 1 θ d a i i p e ξ 2 θ d a i i g a s e o u s n o n b r e a t h i n g p e ξ 2 θ d a i i n o n g a s e o u s ξ1 θ and ξ2 θ are empirical functions of the concentration ratio these two functions represent the slopes of boundaries in the phase diagram fig 11 shows the trend of ξ1 θ and ξ2 θ versus θ ξ1 and ξ2 increase with θ by different rate which is crucial for the origin of the gaseous nonbreathing regime with the correlation between the ξ s and θ combined with eq 9 identification of dissolution regimes can be achieved although our experiments are conducted under atmospheric conditions the phase diagrams are based on dimensionless parameters thus could still be instructive for other pressure temperature conditions isotherms of solubility cs in water wiebe and gaddy 1940 and cacl2 solution prutton and savage 1945 increases with pressure up to hundreds of atm well beyond the co2 critical point 72 8 atm 31 c hence elevated pressure tends to decrease θ however the increase of c h 0 offsets this effect so the gaseous regimes can still be favored this explains previous results where high hcl concentration for subsurface reservoir acidizing produces large amount of co2 phase in the pore space soulaine et al 2018 thompson and gdanskl 1993 note that in the subsurface co2 may be in liquid or supercritical liquid state and may not be called a gas but a supercritical co2 bubble jiménez martínez et al 2020 is still lighter than water and nonwetting wang et al 2013 hence it should behave similarly to a gaseous co2 bubble in the pore since higher h concentration means lower ph the analysis for effect of θ may also apply to that of ph albeit with a reversed trend moreover the reaction product ca2 may cause ph buffering as shown in fig 7 and fig s8 the breathing regime requires fluctuation of c c o 2 and thus fluctuation of ch from eq 1 equivalently a fluctuating ph is required hence if ph buffering occurs the fluctuation can be reduced and the breathing regime may be less favorable so its area in the phase diagrams may decrease which ultimately leads to larger gap between ξ1 and ξ2 in addition to θ daii reactivity and pe advection are also needed to determine the regime for hcl carbonate kr is on the order of 10 4m s according to references in table 1 for weak acid e g acetic acid it is on the order of 10 6m s fredd and fogler 1998 therefore daii for weak acid carbonate could be two magnitudes smaller experimental daii s are in the range of 101 to 102 with pe ranging from 100 to 102 table 3 thus for weak acid carbonate daii could range from 10 1 to 100 meaning that to obtain the same breathing and nonbreathing regimes pe for weak acid should be around 10 2 to 100 which is reasonable for subsurface flow therefore we expect all three regimes could present in the subsurface but a comprehensive evaluation of acid concentration co2 solubility advection strength and reactivity is needed to determine the regime for a specific location in the subsurface 3 3 limitations the model does not consider wettability interactions between gas liquid interface and solid grains it delays motion of the interface and may explain why the modeled r g a fluctuates more frequently than experimental data this discrepancy is salient for exp 3 however in exp 7 it is negligible fig s8 which seems to suggest under stronger advection and higher h concentration such wettability interaction is less important however in both cases the wettability effect leads to residual water between solid grains it means the model could underestimate r g a the details of wettability interactions should be studied in future work for example the breathing bubble also means periodic change of gas saturation in the chamber which can be viewed as cycles of drainage and imbibition further investigations into this reactive drainage imbibition process may improve our understanding of reactive interfacial dynamics in subsurface systems one experimental limitation is that 2d images do not provide information in the vertical direction consequently the average depth hs reduces to a tuning parameter this is not restrictive here because our purpose is to study the regimes which are independent of hs second the experiments utilize precipitation of calcium carbonate to populate minerals in the glass chamber the question is can we observe the same phenomena if instead using a geomaterial micromodel jiménez martínez et al 2020 song et al 2014 we expect at early time similar behavior would occur where reaction creates a co2 bubble in the chamber which may or may not fluctuate depending on advection and reaction however the chamber and channel become larger and wider with more dissolution and the system gradually loses geometric confinement eventually the bubble will be pushed out new bubbles can be produced but they cannot remain forming a moving train of bubbles song et al song et al 2014 s observation in a calcite channel these observations are different than those here however fundamentally they share the same physics availability of reactive surfaces is limited by co2 coverage and the interplay between acid mineral reaction and liquid transport regulates co2 growth decay movement which in turn determines availability of reactive surfaces therefore we believe the coupling relations in fig 3 are still valid but the details of each relation may change due to different experimental setups 4 conclusions we have discovered novel regimes of calcium carbonate dissolution in micron scale confined spaces via microfluidic experiments the experimental observations are verified and interpreted by a simple mathematical model the three regimes nongaseous gaseous nonbreathing and gaseous breathing are shown to result from the interplay between reaction transport and geometric confinement diagrams distinguishing different regimes are charted under dimensionless numbers and an empirical relation is proposed it must be emphasized that our experimental platform and the accompanying mathematical model are still simplistic compared to real subsurface systems however the key contribution of our work is demonstrating that the coverage of reactive surface areas by co2 in carbonate system can interact with dissolution reaction and liquid transport leading to characteristic patterns of motion of fluid interfaces we believe this mechanism should be widely present in nature and may deserve further investigations declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgement the authors thank lucas mejia for his help in micromodel fabrication supplementary materials supplementary material associated with this article can be found in the online version at doi 10 1016 j advwatres 2022 104200 appendix b supplementary materials image application 1 appendix model development relations a c relations a c are described by eq 2 and eq 3 here we list them for completeness as eq a1 and eq a2 a 1 d c h t d t k t v 2 r c c h t v 2 r c c h 0 a 2 d c c o 2 t d t v 2 r c c c o 2 t 1 2 k t c h t relation d relation d is a co2 growth model let us consider a bulk co2 bubble which observes the following equation hey et al 1994 a 3 d r d t d c c o 2 t c s ρ g r where r is radius of a spherical bubble d is the diffusion constant of co2 in water cs is the saturated concentration of co2 in water and ρ g is gaseous co2 density one may integrate eq a 3 and consider r t 0 0 which leads to r t 2 d ρ g i t 1 2 where a 4 i t 0 t c c o 2 t c s d t if i t 0 the system is undersaturated and there would be no gaseous co2 hence we must enforce r t to be zero one may conveniently rewrite eq a 4 as a 5 r t 2 d ρ g i t θ i t 1 2 here θ x 0 i f x 0 1 i f x 0 is the heaviside function abramowitz and stegun 1972 volume of this bubble is therefore a 6 v g t 4 3 π r t 3 4 3 π 2 d ρ g i t θ i t 3 2 when it is fitted into the chamber in fig 2 the resultant r g a is determined by both vg and the current volume of solids in the chamber relation f based on m r t we can calculate how many solids m t are currently in the region of 0 rs hence the available vacant space within rs is a 7 v a v a t π r s 2 h m t ρ s where ρ s is the density of solids if vg t vava t the bubble cannot fill the vacant space within rs and cover all the solids hence r g a t r s consequently r g a is determined by a 8 v g t 0 r g a t m r t ρ s 2 π r d r π r g a t 2 h if v g t v a v a t this equation states that volume enveloped by r g a is the sum of gas and solid volumes eq a 8 is an implicit equation for r g a on the other hand if vg t vava t r g a would be larger than or equal to rs in this case equation for r g a t is simply a 9 π r g a t 2 r s 2 h v a v a t v g t if v g t v a v a t this equation is quadratic for r g a relations g and h relations g and h are the model for effective reaction rate k we define a local reaction rate constant as follows a 10 k l o c a l r t k 0 π r s 2 θ m r t the maximum value k 0 is distributed uniformly within 0 rs heaviside function enforces that if no solids are present there would be no local rate given r g a t at time t k collects all local contributions a 11 k t r g a t r s k l o c a l r t 2 π r d r at first acid solid contact all solids are exposed r g a 0 0 and eq a 11 gives k k 0 when r g a exceeds rs k 0 relations e and i the local mass change reads a 12 d d t m r t 1 2 k l o c a l r t c h t x c a c o 3 π r c 2 r g a t 2 h x c a c o 3 is the molar mass of calcium carbonate π r c 2 r g a t 2 h is the current volume of acid in the chamber which converts h concentration to moles the combination of eqs a 1 2 6 12 simulates the evolution of r g a and solid mass they are numerically solved by the euler s method 
144,several studies addressed the water footprint wf of countries and virtual water vw trade in agricultural and industrial products but freshwater use associated with wood products has received little attention yet international trade in wood products has been growing and forestry competes with other forest ecosystem services over limited freshwater resources therefore the objective of this paper is to assess nations wfs of consumption of wood products the sustainability of these wfs and the vw flows associated with international trade in wood products we account nations wfs of and vw trade in wood products with a multi regional input output model mrio forest that tracks wood flows along global supply chains production processing trade and final uses for the period 1997 2017 and assess the sustainability of the green and blue wf of wood products in 2017 the wf of wood production increased from 8 37 1011 m3 y in 1997 to 9 87 1011 m3 y in 2017 about 38 3 76 1011 m3 y of this wf relates to wood products for export in 2017 which means that vw trade associated with wood products ranks in between agricultural and industrial products in absolute volumes about 10 9 9 1010 m³ y of the green wf and 11 3 4 109 m³ y of the blue wf of wood products in 2017 are unsustainable meaning that they are located in areas where the total green blue wf exceeds the maximum sustainable green blue wf the unsustainable green wf occurs mainly in germany indonesia the czech republic and the uk and mainly relates to coniferous sawnwood paper and paperboard other than newsprint fibreboard and non coniferous sawnwood the unsustainable blue wf which is much smaller occurs in the usa russia nigeria canada and india and mainly relates to fuelwood paper and paperboard other than newsprint sawnwood and fibreboard this study increases our understanding of how forest evaporation flows link to the final consumption of wood products and contributes to the wider debate on the allocation of freshwater resources in the global economy keywords water footprint virtual water trade forestry timber wood multi regional input output 1 introduction global sustainability challenges are closely intertwined including air pollution biodiversity loss climate change energy and food security disease spread species invasion and water shortages and pollution liu et al 2015 today humanity increasingly faces many of these challenges and is dependent on the goods and services provided by the planet deng et al 2016 moran 2016 motesharrei et al 2016 reid et al 2005 rockström et al 2017 stern et al 2016 teeb 2010 tietenberg and lewis 2016 in a connected world goods and services consumed in one country are often produced in other countries and exchanged via international trade thus local consumption is increasingly satisfied by global supply chains oftentimes involving large geographical distances and leading to global environmental change hubacek et al 2014 this idea has been also reflected e g in the special issue led by yu et al 2013 with the concept of teleconnections to describe the remote spatial linkages between local consumption embedded in its local context and remote environmental impacts the rising world resource consumption is satisfied more and more through international trade giljum et al 2014 kastner et al 2014 plank et al 2018 schaffartzik et al 2014 warren hertel and villoria 2011 wiedmann et al 2015 yang et al 2020 this also applies to the case of the consumption of wood products international trade in primary and manufactured wood products more than doubled in the period of 1997 to 2014 according to the faostat database of the food and agriculture organization fao in science a growing interest has emerged to analyse and quantify the virtual water vw and land embedded in final forest products furukawa et al 2015 kastner et al 2011a 2011b lambin and meyfroidt 2011 liu 2013 o brien and bringezu 2018 schyns et al 2017 some of these works had used fao data to assess the forest footprint of nations and forest land embodied in international trade but have shortcomings in the tracing of global wood product supply chains regarding differentiating between intermediate and final consumption in input output models and presenting multiple interrelations of inputs and outputs arto et al 2022 developed a multi regional input output mrio framework that overcomes these shortcomings in this study we further develop this mrio model to trace global wood product supply chains and apply it to the case of freshwater to assess the water footprint wf of and vw flows of globally traded wood products nation s wfs of consumption of and vw trade in agricultural and industrial products has been studied hoekstra and chapagain 2007 hoekstra and mekonnen 2012 but not for wood products assessing nations wfs of globally traded wood products is a needed contribution to the wider debate on freshwater resources allocation in the global economy considering the importance of forests forests play an important role in local hydrology bagley et al 2014 marhaento et al 2018 and regional moisture recycling ellison et al 2017 van der ent et al 2010 forest evaporation is vital and unavoidable however annual forest evaporation is also limited since it ultimately originates from annual precipitation over the forest hence it is relevant to address the question how forest evaporation is made productive for different competing consumption goods by means of wf accounting in which the rate of moisture recycling is irrelevant schyns et al 2019 the wf of forestry products indicates which fraction of forest evaporation is attributed to forestry products the rest being attributed to other forest ecosystem services schyns et al 2017 van oel and hoekstra 2012 2010 pointed towards the relevance of wood products in the freshwater debate by assessing the wf of paper schyns et al 2017 presented estimates of global water use in the forestry sector related to roundwood production for lumber pulp paper fuel and firewood in recent decades in this study we build upon the work of schyns et al 2017 by linking the wf of wood production to final consumption of wood products captured in a mrio framework by providing estimates of the wf of consumption of wood products for all nations assessing their sustainability and showing international vw flows related to trade in wood products this article constitutes a novel contribution to our understanding of the wf of humanity the objective of this paper is to assess nations wfs of consumption of wood products the sustainability of these wfs and the vw flows associated with international trade in wood products we insert estimates on the wf per unit of roundwood production into the mrio model to account the green and blue wf of wood products and the vw flows resulting from international trade in wood products the framework covers 20 wood products types and 223 nations for the period 1997 2017 finally we assess the unsustainable part of the green and blue wf of wood products by analysing where the wf contributes to a situation in which the maximum sustainable wf is surpassed by the actual wf 2 materials and methods we account nations wfs of wood products by inserting estimates of the wf per unit of roundwood section 2 1 into the mrio model sections 2 2 to 2 4 section 2 2 describes the structure of i o tables section 2 3 summarizes the methods for the construction of these i o tables and section 2 4 describes how the nations wfs and vw flows associated with wood products are estimated with the mrio model section 2 5 described how we use structural decomposition analysis to understand the drivers of change of the wf of wood products over 1997 2017 lastly we assess the sustainability of the green and blue wf of wood products in 2017 section 2 6 2 1 the water footprint per unit of roundwood to assess the wf of traded forest products and national wfs associated with consumption of forest products we couple the mrio model to national average estimates of the wf per unit of roundwood and roundwood to forest product conversion factors we have estimated the national average wf per unit of roundwood production for the period 1997 2015 according to the method by schyns et al 2017 but used updated wood harvest maps luh2 version v2h instead of v1 0h from hurtt et al 2019a 2019b 2020 the luh2 v2h update addresses known issues and further features amongst others a wood harvest reconstruction based on fao and other sources and a spatial pattern of wood harvesting constrained by landsat data hurt et al 2016 first annual forest evaporation et from harvested wood areas is estimated on a 30 30 arc minute grid across the globe with separation between green water direct et of precipitation and blue water capillary uptake from shallow groundwater second this et flow is attributed to roundwood production based on ecosystem service values lastly we divide total et attributed to roundwood production by total roundwood produced per country over the period 1997 2015 to arrive at the wf in m³ water per m³ roundwood the country average values are presented in table a1 and are provided together with the underlying raster data as a separate dataset schyns 2022 we compared our updated estimates with those by schyns et al 2017 for the overlapping period 1997 2010 the global average wf of roundwood m³ m³ rw is 2 8 smaller in our study for the top 15 producers of roundwood the relative changes are in the range of 24 6 china to 9 7 canada 2 2 structure of input output tables mrio tables represent the flows of commodities among two or more countries regions matrices 1 1 bold faced lower case letters are used to indicate vectors bold faced capital letters indicate matrices and italic lower case letters indicate scalars including elements of a vector or matrix subscripts indicate industries and superscripts indicate countries vectors are columns by definition row vectors are obtained by transposition denoted by a prime e g x diagonal matrices are denoted e g x z and mean the intermediate inputs and their element zij are the physical amount of domestically produced or imported commodity i e g wood chips used to produce commodity j e g pulp similarly y denote the matrices of final uses wood products and their element yif indicates the final demand for commodity i to satisfy final use f x denotes the column vector of the total output by commodity and matrix of water use accounts w and its element whj is the physical amount of water footprint of production of type h in primary commodity i roundwood using bilateral trade data we get the structure presented in table 1 the scripts r s and t represent countries showing bilateral trade matrices origin for the first superscript destination for the second so for a specific country r we have total exports as e r z rs u z rt u y rs v y rt v and imports as m r z sr u z rr u y sr v y tr v being and u and v the summation vectors 2 3 building global mrio tables for forest faostat provides free access to historical data on food agriculture forestry and trade for over 200 countries these data have been extensively used to analyse issues related to land use production consumption and trade alexander et al 2015 faostat 2018a kastner et al 2014 2012 2011b lambin and meyfroidt 2011 van vliet et al 2016 weinzettel et al 2013 in order to get full advantage of these datasets we processed reconciled and assembled in a comprehensive accounting framework the following data i extraction and trade of wood fuel and roundwood ii the production of wood products by country and iii exports and imports by country and partner of wood products primary and processed products the accounting method departs from the i o framework i o tables represent national economies and are reported in monetary terms but a similar approach can be used to represent a sub system of an economy such as the extraction the processing and the consumption of forest products e g in physical units tonnes or cubic meters representing data in physical units analogously to faostat structures we obtain the physical mrio of forest products see arto et al 2022 making consistent the balances and classifications notably of national and trade data making compatible inconsistent data sources in particular firstly we build national i o tables for forest products from forest production and trade statistics secondly detailed trade statistics are used to connect the national i o tables of forest products to get the mrio forest table in the first procedure the production and trade statistics of wood products come from fao faostat 2018b extraction rates and level of processing of the different wood products also trade statistics are more aggregated than the production statistics so we built classification with 20 wood products see fig a1 although some are not explicitly shown anymore in bilateral trade data updates it distinguishes between raw materials intermediate products and final products input requirements for production of intermediate and final products is obtained by the production of each commodity times the input factor which is the volume of roundwood per unit of product joint forest sector questionnaire conversion factors unece and fao 2010 unece and fao 2005 finally we did a reconciliation between input requirement available for intermediate use and estimated finally a bi proportional adjustment method see miller and blair 2009 served to match available supply and input requirements of the commodities obtaining the set of 223 national i o tables of forest products in the second procedure we linked the national i o tables with the unreconciled bilateral detailed trade fao statistics which we reconciled replacing the exports imports by the maximum flow reported after consulting experts who agreed that underreporting is more likely to occur than overreporting e g due to problems of reporting in certain countries or issues of underreported illegal harvesting and obtaining shares among countries for splitting trade when partner countries are not specified 2 2 still additional adjustments were needed such as 1 modifying the country trade figures when there are zeroes in the country trade for a product but there is a value reported in the detailed trade statistics 2 replacing those flows with zero total exports imports in the detailed trade and non zero values in the country trade by the weighted average world bilateral trade patterns of the detailed trade 3 allocating to statistical difference the differences between the total country trade and the world totals 4 applying a bi proportional adjustment method for the final reconciliation 2 4 applying mrio tables to estimate the water footprint of national consumption of wood products the mrio database for forest products is used to study wfs of national consumption of wood products and vw flows resulting from international trade in wood products with a leontief demand driven model see leontief 1936 1937 miller and blair 2009 from equation x zu yv where x z and y are the elements of the mrio and u and v are the summations vectors we obtain x i a 1 yv byv a z x 1 represents the matrix of technical coefficients of the mrio being the element a i j r s of a the quantity of good i from country r needed to produce a unit of good j in country s b the leontief inverse matrix b i a 1 has as element b i j r s the total output of good i from country r needed to satisfy a unit of final demand of good j produced in country s the vector w represents the unitary water use coefficients of water use of wood product type h per unit of output the elements of w are the wf in country s needed to get one unit of good j w j s w h j s x j s we represent the vector of wf as w i a 1 yv myv with element m i j r s of m denoting the water used in country r to produce the quantity of good i needed to satisfy a unit of final demand of good j produced in country s the wf of consumption can be shown at various levels of aggregation e g the forest water uses in canadian roundwood that ends up in the newsprint consumption of the usa or the worldwide forest water needed in the total demand of wood products of usa the water in region t to satisfy the final uses of country s water footprint of country t in country r is obtained from r t s m rs y st v furthermore we can differentiate between the internal or domestic part of the wf of consumption i e usa forest water needed for usa consumption when t r and the external part i e foreign forest water needed for usa consumption when t r 2 5 structural decomposition analysis sda to understand drivers of change finally in order to understand the drivers of change we perform a structural decomposition analysis sda following the method proposed by dietzenbacher and los 1998 1997 see also a similar decomposition into components of emissions over time in arto and dietzenbacher 2014 as fully developed in appendix b we decompose the forest wf of consumption in country r into the following 7 components by assumption the average water per unit of output for each product in country r is the same along years the change in input structure in country t the change in the intermediate trade structure in country t the change in the final trade structure in country t the change in the composition of the final demand in country t the change in the consumption propensity in country t the change in the affluence in country t and the change in population in country t we can also distinguish the forest wf of consumption in country r that are driven by changes in domestic factors when t r or foreign factors t r 2 6 assessing the sustainability of the water footprint of wood products after the appearance of many studies on wfs recently other considerations such as sustainability of the uses are being associated in some recent studies of this type as e g on global crop production in mekonnen and hoekstra 2020 here we assess the sustainability of the green and blue wf of wood products in accordance with the global standard for wf assessment hoekstra et al 2011 separately by overlaying them with green schyns et al 2019a and blue mekonnen and hoekstra 2016 water scarcity statistics the green water scarcity index by schyns et al 2019a is defined as the ratio of the actual to the maximum sustainable green wf similarly the blue water scarcity index by mekonnen and hoekstra 2016 is defined as the ratio of the actual to the maximum sustainable blue wf for both indices the maximum sustainable wf has been estimated by subtracting environmental green blue water requirements from the total green blue flow also for both indices when the ratio exceeds 1 this indicates a situation in which the wf exceeds the maximum sustainable level we assess which part of the green and blue wf of wood products is located in areas where the total green blue wf of all activities in the area exceeds the maximum sustainable green blue wf i e where the green blue water scarcity ratio exceeds 1 which we label as unsustainable for green water we make the overlay at the level of nations following schyns and vanham 2019 who made a similar assessment for the case of the wf of wood for energy in the eu when the green water scarcity index for a nation is 1 we label the green wf in that nation as unsustainable for blue water we use the gridded 30 30 arc minutes average 1997 2015 blue wf of wood production section 2 1 which we overlay with the gridded 30 30 arc minutes blue water scarcity index map we then calculate the fraction of the blue wf of wood products in a nation that is unsustainable as the ratio of the blue wf of wood production in the nation in grid cells where the blue water scarcity index is 1 to the total blue wf of wood production in the nation 3 results first we analyse the wf of wood products from the production section 3 1 and consumption section 3 2 perspective then we analyse patterns of vw flows resulting from international trade in wood products section 3 3 lastly we assess the sustainability of the wood products wfs section 3 4 3 1 the water footprint of global and national production of wood products the wf of production of wood products increased from 8 37 1011 m3 y in 1997 to 9 87 1011 m3 y 97 green 3 1 blue in 2017 with a mean value of 9 06 1011 m3 y and a median value of 9 45 1011 m3 y fig 1 in 2008 2009 the wf of wood production decreased as a consequence of reduced demand for wood during the real estate crisis using sda we aim to identify the main drivers behind year to year changes in the global wf of wood products appendix c globally the main drivers of increased wfs were affluence and to a lesser extent population changes also minimally the demand structure while those lowering the wfs ceteris paribus from the initial to the end point of the period were technology trade structure and especially from the mid 2000s onwards the propensity to consume effect the largest part of the wf of production of wood products is located in europe incl russia 42 5 followed by america 34 and asia 17 9 fig 2 table a2 in terms of forestland harvested arto et al 2020 have found the largest contributors to be in a different order america 32 followed by asia 29 and europe 28 this has to do with the fact that south america and asia have large areas of tropical forests see schyns et al 2017 which a smaller share of total forest et attributed to roundwood production but a higher share of forest et attributed to other ecosystem services compared to the predominantly temporal and boreal forests in europe the top five individual countries with a large share in the global wf of forest production are the usa 19 russia 12 canada 10 china 6 and sweden 5 the wf of global production consumption of wood products relates for 99 to nine types of products paper and paperboard 27 coniferous sawnwood 25 wood fuel 20 fibreboard 9 non coniferous sawnwood 5 plywood 4 wood pellets 4 wood charcoal 3 and newsprint paper 2 table a3 the first three listed products together account for 72 of the global wf of wood products 3 2 the water footprint of national consumption of wood products a nation s wf of consumption of wood products fig 3 table a2 reflects the water use both within the nation and in other nations associated with all wood products consumed within the nation we observe a different picture compared to the wf of production fig 2 the largest part of the wf of consumption is located in europe incl russia 33 3 followed by asia 31 4 and america 28 6 notable countries with a smaller wf of consumption vs wf of production are russia 5 vs 12 canada 3 vs 10 and sweden 2 vs 5 vice versa countries with a larger wf of consumption vs wf of production are for example china 14 vs 6 usa 21 vs 19 and germany 5 vs 4 3 3 virtual water flows resulting from international trade in wood products the displacement between production and consumption of wood products is associated with international trade in wood products which results in vw flows in the year 2017 more than 3 76 1011 m3 y of water i e 38 of the wf of global production of wood products is used to produce wood products for export international trade in wood products ranks in between trade in agricultural and industrial products in terms of volumes of green and blue embedded in these trade flows as we can see by comparing our results with those from hoekstra and mekonnen 2012 they estimated that in 1996 2005 the total volume of international vw flows incl grey water related to trade in agricultural and industrial products amounted to 2 03 1012 and 2 82 1011 respectively we find that the total volume of international virtual green plus blue water flows related to trade in wood products was 3 30 1011 m³ y in 1997 2005 international vw flows are associated with certain wood products table a4 in 2017 about 90 of the vw flows were related to trade in six wood products raw industrial roundwood from coniferous 1 9 1011 m3 y and non coniferous non tropical 5 3 1010 m3 y sources wood chips and particles 4 3 1010 m3 y coniferous sawnwood 2 6 1010 m3 y wood residues 1 3 1010 m3 y and industrial roundwood from non coniferous tropical sources 1 0 1010 m3 y fig 4 shows the main vw flows by product and trading nations in 2017 highlighting the 10 main origins the main vw flows are concentrated on the northern hemisphere the largest virtual forest water flows relate to export from russia to china and from canada to the usa and china fig 5 shows that some countries are net exporters of virtual forest water while others are net importers of virtual forest water there is a minority of net exporters of vw 53 in 2007 46 in 2017 compared to net importers of vw 143 in 2007 121 in 2017 furthermore in 2017 only 19 countries had net exports of vw in wood products larger than one billion m³ y and 30 countries had net imports of vw in wood products larger than one billion m³ y the main net vw exporters are countries with a large forest production sector like russia canada sweden and finland the largest net virtual forest water importer is china at a distance followed by uk italy japan germany and the usa fig 6 shows a larger number of flows but still it is limited to the vw flows for countries with total imports or exports below 5 0 109 m3 y this leaves with 17 exporting and 18 importing regions plus the all other group showing flows only interacting with the former hence the graph highlights the most important origins destinations and vw flows the explanation is given at the bottom of the figure on the items ribbons a f and the country codes in table a1 also some below fig 5 indicates that some countries with are large net vw importers like the usa fig 5 also have some large vw export flows for example to mexico in the case of the usa 3 4 the sustainability of the water footprint of wood products about 10 9 9 1010 m³ y of the green wf of wood products in 2017 is labelled as unsustainable meaning that it is located in countries where the total green wf i e of all activities incl wood production exceeds the maximum sustainable green wf which implies that al large share of the green wf taps into environmental green water requirement and indicates fierce competition over limited available green water flows between human society and nature this unsustainable green wf is mainly in germany 37 5 indonesia 12 3 the czech republic 11 5 and the uk 9 1 another 16 1 56 1011 m³ y of the green wf of wood products in 2017 is located in countries where the total green wf is 75 100 of the maximum sustainable green wf indicating significant pressure on green water resources this part of the green wf is mainly in poland 20 india 19 france 11 ukraine 6 romania 6 and latvia 6 out of the total unsustainable green wf 40 3 9 1010 m³ y relates to wood products for export while 60 6 0 1010 m³ y relates to domestic wood supply in terms of product types 68 6 7 1010 m³ y of the unsustainable green wf relates to roundwood products and 32 3 1 1010 m³ y to fuelwood within the unsustainable green wf of roundwood products products of particular relevance are coniferous sawnwood 38 with germany and the uk as main final destinations paper and paperboard other than newsprint 30 with china and the uk as main final destinations fibreboard 16 with germany the uk and china as main final destinations and non coniferous sawnwood 8 with china indonesia and vietnam as main final destinations about 11 3 4 109 m³ y of the blue wf of wood products in 2017 is labelled as unsustainable meaning that it is located in places where the average monthly total blue wf i e of all activities incl wood production exceeds blue water availability indicating significant severe alteration of runoff and violation of environmental flow requirements note that share of blue 3 1 is much smaller than the share of green 97 in the wf of wood production section 3 1 and so the volume of the unsustainable blue wf is much smaller than of the green wf the unsustainable blue wf is mainly in the united states of america 23 8 russia 9 7 nigeria 9 4 canada 8 6 india 6 5 hungary 4 1 bangladesh 4 0 democratic republic of the congo 3 8 netherlands 3 5 and somalia 2 7 this list reflects areas where blue water contributes significantly to forest water use through capillary rise as depicted in schyns et al 2017 out of the total unsustainable blue wf 77 2 6 109 m³ y relates to wood products for export while 23 0 79 109 m³ y relates to domestic wood supply about half of the unsustainable blue wf relates to fuelwood mainly in nigeria 16 india 11 bangladesh 8 democratic republic of the congo 7 usa 7 and somalia 5 and the other half to roundwood products in particular paper and paperboard other than newsprint 32 with the usa and china as main final destinations coniferous sawnwood 25 with the usa and china as main final destinations non coniferous sawnwood 23 with the usa nigeria and china as main final destinations and fibreboard 10 with the usa russia and china as main final destinations from the consumption perspective the top 30 nations with a large unsustainable wf related to the use of wood products are shown in fig 7 and in table a2 also for other nations top of this list are germany the united kingdom china indonesia and czech republic for these countries except for china the unsustainable fraction is close to the internal fraction of the wf of consumption of wood products data not shown i e the unsustainable wf is in the consuming country itself countries for which the unsustainable fraction of the wf of consumption of wood products exceeds 50 are shown in fig 8 all these nations rely for a large share on wood from areas in which green or blue wf is unsustainable which may form a risk to their future wood supply in absolute volumetric terms the list is led by indonesia czech republic vietnam thailand bangladesh guatemala the philippines and switzerland further several small island states appear in fig 8 4 discussion 4 1 limitations of this study the framework we have applied has some limitations that are worth noting one is the limitation of not being able to fully capture the forest final products transformations and destinations due to faostat and trade data limitations to register all these such as the final processing of furniture for which we find some attempts of better capturing this see schütz et al 2003 with economy wide material flow analysis and conversions of volumes of processed products to primary equivalent also despite the attempt made to capture most of the best features of process analysis type of studies and mrio modelling distinction of intermediates and final goods to avoid usual results disparities see feng et al 2011 further integration of the mrio forest with other global databases e g detailed trade statistics and economy wide mrio databases e g exiobase or eora could be applied to expand system boundaries to cover upstream and downstream chains and vw flows related to wood products such as final furniture products inputs used in the activity such as machinery energy transportation etc we coupled the physical mrio forest model with national average estimates of the wf of roundwood ideally if we had information on which specific areas are used to harvest wood for export vs domestic use we could have used subnational averages this lack of spatially explicit information on the end purposes of harvested goods is also playing a role in previous studies that looked agricultural products and related vw trade hoekstra and mekonnen 2012 in general it would be desirable to refine the estimates of wood products and vw trade among subnational regions but data is lacking for this this relates to the issue of limitations on roundwood data reported to fao since it would be desirable to find ways to deal with illegal harvest which might be substantial in some countries see e g dieter 2009 haore 2015 lee et al 2009 mcpfe liaison unit warsaw 2005 ottitsch et al n d wwf 2008 zhang et al 2016 on another technical note based on the updated accounts from schyns et al 2017 we were able to differentiate between the wf of coniferous and non coniferous roundwood however we were not able to track this difference further along the wood supply chains since it is only in the first transformations where this distinction is documented in production statistics 4 2 comparison with methods of other studies despite the mentioned limitations this study includes a number of methodological advances our framework allows for examining wood and associated vw flows looking at the multilateral supply chains by connecting primary intermediate and final products this distinction results in detailed information on the production transformation trade and final use of 20 wood products and 252 fao country codes leading to 223 countries with non zero values for wfs it is also the main advantage with respect to the previous literature for the analysis of land use changes the work of kastner et al 2011a 2011b with a process analysis perspective followed a similar method but without this distinction as acknowledged and hinted as possible future research while o brien and bringezu 2018 accounted for timber flows and footprints also converting processed products into volume of primary equivalent our analysis of the decomposition of drivers of change in the wf of wood products also fits within similar exercises of decompositions of energy and emission pressures arto and dietzenbacher 2014 cao et al 2019 lan et al 2016 wang et al 2017 2019 and can also feed into future scenario assessments by showing how e g a change in one place e g increased final demand or a change in some of the drivers i e population affluence etc affects the forest wf of production in another place country 4 3 policy implications in the article we have shown that consumption and import of forestry products puts a claim on foreign water resources as water scarcity and drought occurrence intensify this may disrupt forest production and wood supply chains in the future which could have cascading effects on wood dependent sectors such as energy and construction this is relevant for policy makers to realize especially for those in the large net virtual water importing countries which are to some degree dependent on how the wood producing countries respond to such disruptions e g restrain wood export and focus on domestic supply our results are intended to show the links between forest product consumption in one place and water use elsewhere such that they can feed discussions on the sustainability and reliability of future wood supplies of nations we stress that such discussions cannot focus on water alone but should also include other environmental e g deforestation forest fires economic e g comparative advantages transport routes trade agreements and social e g provision of labour considerations associated with forest production in this context future research could focus on vw displaced by trade from areas where forest water use contributes to the climate system tipping points for example in semi natural or forests in the amazon congo or mekong basins eisenhammer 2021 lenton et al 2009 welch 2021 which could contribute to disruptions of the regional climate system and associated risks 5 conclusions we have estimated nations green and blue wfs and vw flows of globally traded wood products with a mrio framework for the period 1997 2017 and assessed the sustainability of these wfs for the year 2017 we find that over the study period the global wf of wood production and consumption increased and mostly refers to green water use 97 in 2017 the wf of production and consumption of wood products can vary strongly per nation depending on their character as net exporters of importers of virtual forest water we find there are relatively few net exporters 53 in 2007 46 in 2017 compared to net importers 143 in 2007 121 in 2017 of virtual forest water the main net exporters are russia canada sweden and finland the main net importers are china at a large distance followed by the uk italy japan germany and the usa the sum of international vw flows resulting from trade in wood products ranks in between the vw volumes associated with trade in agricultural and industrial products as estimated by others about 10 9 9 1010 m³ y of the green wf and 11 3 4 109 m³ y of the blue wf of wood products in 2017 are unsustainable meaning that they are located in areas where the total green blue wf exceeds the maximum sustainable green blue wf the unsustainable green wf is mainly in germany indonesia the czech republic and the uk and mainly relates to coniferous sawnwood paper and paperboard other than newsprint fibreboard and non coniferous sawnwood the unsustainable blue wf which is much smaller is mainly in the usa russia nigeria canada and india and mainly relates to fuelwood paper and paperboard other than newsprint sawnwood and fibreboard the application of mrio forest to the case of freshwater resources represents a powerful toolkit to better understand past present and future forest uses and wfs at multiple levels i e global regional national and product commodity this study has increased our understanding of how forest evaporation flows link to the final consumption of wood products and contributes to the wider debate on the allocation of freshwater resources in the global economy credit author statement ignacio cazcarro conceptualization methodology data curation resources investigation validation formal analysis software visualization writing original draft preparation reviewing and editing funding acquisition joep f schyns conceptualization methodology data curation resources investigation validation formal analysis software visualization writing original draft preparation reviewing and editing funding acquisition iñaki arto conceptualization methodology data curation resources investigation validation formal analysis software writing original draft preparation reviewing and editing funding acquisition maría josé sanz conceptualization resources investigation validation writing original draft preparation reviewing and editing supervision project administration funding acquisition credit authorship contribution statement ignacio cazcarro conceptualization methodology data curation resources investigation validation formal analysis software visualization writing original draft writing review editing funding acquisition joep f schyns conceptualization methodology data curation resources investigation validation formal analysis software visualization writing original draft writing review editing funding acquisition iñaki arto conceptualization methodology data curation resources investigation validation formal analysis software writing original draft writing review editing funding acquisition m jose sanz conceptualization resources investigation validation writing original draft writing review editing supervision project administration funding acquisition declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments bc3 authors thank the support of the spanish ministry of science innovation and universities through the project modeling and analysis of low carbon transitions malcon rti2018 099858 a i00 and the spanish state research agency through maría de maeztu excellence unit accreditation 2018 2022 ref mdm 2017 0714 funded by mcin aei 10 13039 501100011033 and basque government berc 2022 2025 programme i cazcarro thanks the support of the spanish ministry of science innovation and universities state research agency 2019 call for r d i pid2019 106822rb i0 multisectoral and multiregional models innovation and dynamics for economic social and environmental sustainability j f schyns was supported by funding from the european research council erc under the european union s horizon 2020 research and innovation programme earth lternatives project grant agreement no 834716 this article has been also a parallel study to one developed on land footprints under letter of agreement between the food and agriculture organization of the united nations fao un redd programme and the basque centre for climate change bc3 bc3 authors thank the staff of the fao and bc3 for their comments discussions and suggestions related to forest data and policy we are especially grateful to malgorzata buszko briggs and tina vahanen fao forestry department for their contribution to frame and coordinate the research and to salar tayyib daniela di filippo tomasz filipczuk fao statistics division and arvydas lebedys fao forestry department for providing datasets and for their discussions and comments on data and methodological issues appendix a extra tables and figures tables a1 to a5 and fig a1 appendix b analysis of drivers of forest water footprint of consumption changes the time series of mrio can also be used in combination with decomposition techniques to analyse the drivers of change in water footprint of consumption there is a considerable body of literature on how to decompose the effects of different factors in the evolution of a variable there are basically 2 techniques for such decompositions index decomposition analysis ida and structural decomposition analysis sda ida is usually adopted when the scope of the study is to have a better understanding of the drivers of the changes of emissions of a specific sector sda is based on i o analysis and is used to analyse the changes of the whole economy su and ang 2012 offer a detailed review of the literature on the application of sda the sda is based on leontief s demand driven model as describe in expression w i a 1 yv the elements of the vector of forest water footprint by commodity can expressed as b1 i r j s t w i r b i j r s y j s t furthermore the elements of the matrix of final demand can expressed as the product of different components as follows b2 y j s t y j s t s y j s t s y j s t j s y j s t j s y j s t g d p t g d p t p t p t t j s t s j t c t a t p t where pt is the population of country t at is the affluence or gdp per capita of region t ct is the propensity to consume wood products measured as the total consumption of commodities wood products per unit of gdp in country t st is the share of each commodity i in the total final demand of country t t j s t is the fraction of the total final demand of commodity i that is imported from country s if s t or is produced domestically if s t from expression b1 the total forest water footprint of production in country r can be expressed b3 i r j s t w i r b i j r s t j s t s j t c t a t p t expression b3 shows the forest water footprint as the product of a series of factors as we have pointed before from a policy perspective it results interesting to quantify the effect of each of these factors there are several ways to decompose expression b3 with an sda see su and ang 2012 for the different methods we follow the simplified method proposed by dietzenbacher and los 1998 1997 the changes in the water footprint between 2 points in time indicated by the subscripts 0 and 1 are δ ϖ ϖ 1 r ϖ 0 r where subscripts indicate the years the 2 polar decompositions δ ϖ a r and δ ϖ b r are b4 δ ϖ a r i j s t δ w i r b i j 1 r s t j 1 s t s j 1 t c 1 t a 1 t p 1 t i j s t w i 0 r δ b i j r s t j 1 s t s j 1 t c 1 t a 1 t p 1 t i j s t w i 0 r b i j 0 r s δ t j s t s j 1 t c 1 t a 1 t p 1 t i j s t w i 0 r b i j 0 r s t j 0 s t δ s j t c 1 t a 1 t p 1 t i j s t w i 0 r b i j 0 r s t j 0 s t s j 0 t δ c t a 1 t p 1 t i j s t w i 0 r b i j 0 r s t j 0 s t s j 0 t c 0 t δ a t p 1 t i j s t w i 0 r b i j 0 r s t j 0 s t s j 0 t c 0 t a 0 t δ p t b5 δ ϖ b r i j s t δ w i r b i j 0 r s t j 0 s t s j 0 t c 0 t a 0 t p 0 t i j s t w i 1 r δ b i j r s t j 0 s t s j 0 t c 0 t a 0 t p 0 t i j s t w i 1 r b i j 1 r s δ t j s t s j 0 t c 0 t a 0 t p 0 t i j s t w i 1 r b i j 1 r s t j 1 s t δ s j t c 0 t a 0 t p 0 t i j s t w i 1 r b i j 1 r s t j 1 s t s j 1 t δ c t a 0 t p 0 t i j s t w i 1 r b i j 1 r s t j 1 s t s j 1 t c 1 t δ a t p 0 t i j s t w i 1 r b i j 1 r s t j 1 s t s j 1 t c 1 t a 1 t δ p t and the average of the polar decompositions b6 δ ϖ r 1 2 δ w a r δ w b r the 2nd element of b4 and b5 can further be decomposed to distinguish between changes in the total intermediate input structure and changes in the trade structure of intermediate consumption since x byv and δb b 1 δa b 0 b 0 δa b 1 we have then that the 2nd element of b4 and b5 can be b7 i j s t w i 0 r δ b i j r s t j 1 s t s j 1 t c 1 t a 1 t p 1 t i j h s t w i 0 r b i j 0 r s δ a j h s t x h 1 t b8 i j s t w i 1 r δ b i j r s t j 0 s t s j 0 t c 0 t a 0 t p 0 t i j h s t w i 1 r b i j 1 r s δ a j h s t x h 0 t the following step is to split the change in the input coefficients in eqs b7 and b8 into the change in the total intermediate input structure and the change in the trade coefficients we define the country specific input coefficients d i j r s a i j s r and country trade coefficients τ i j s r a i j s r d i j r for each intermediate input i and output j the corresponding τ i j s r indicates the fraction that is imported from country s if s r or is produced domestically if s r hence we may write the change in δ a j i s t b9 δ a j i s t 1 2 τ j i 0 s t τ j i 1 s t δ d j i t 1 2 δ τ j i s t d j i 0 t d j i 1 t from expressions b4 to b8 we may also obtain how much of the change in water footprint of consumption in country s is driven by the changes in the socio economic structure in each other country b10 δ ϖ r 1 2 i j s t δ w i r x i 1 r x i 0 r b11 1 4 i j h s t w i 0 r b i j 0 r s τ j h 0 s t τ j h 1 s t δ d j h t x h 1 t w i 1 r b i j 1 r s τ j h 0 s t τ j h 1 s t δ d j h t x h 0 t b12 1 4 i j h s t w i 0 r b i j 0 r s δ τ j h s t d j h 0 t δ d j h 1 t x h 1 t w i 1 r b i j 1 r s δ τ j h s t d j h 0 t δ d j h 1 t x h 0 t b13 1 2 i j s t w i 0 r b i j 0 r s δ t j s t s j 1 t c 1 t a 1 t p 1 t w i 1 r b i j 1 r s δ t j s t s j 0 t c 0 t a 0 t p 0 t b14 1 2 i j s t w i 0 r b i j 0 r s t j 0 s t δ s j t c 1 t a 1 t p 1 t w i 1 r b i j 1 r s t j 1 s t δ s j t c 0 t a 0 t p 0 t b15 1 2 i j s t w i 0 r b i j 0 r s t j 0 s t s j 0 t δ c t a 1 t p 1 t w i 1 r b i j 1 r s t j 1 s t s j 1 t δ c t a 0 t p 0 t b16 1 2 i j s t w i 0 r b i j 0 r s t j 0 s t s j 0 t c 0 t δ a t p 1 t w i 1 r b i j 1 r s t j 1 s t s j 1 t c 1 t δ a t p 0 t b17 1 2 i j s t w i 0 r b i j 0 r s t j 0 s t s j 0 t c 0 t a 0 t δ p t w i 1 r b i j 1 r s t j 1 s t s j 1 t c 1 t a 1 t δ p t expressions b10 b17 decompose the forest wf of consumption in country r into the following 8 components the change in the yield in country r b10 which is zero due to using an average one over the years the change in input structure in country t b11 the change in the intermediate trade structure in country t b12 the change in the final trade structure in country t b13 the change in the composition of the final demand in country t b14 the change in the consumption propensity in country t b15 the change in the affluence in country t b16 and the change in population in country t b17 note that we can also distinguish the forest wf of consumption in country r that are driven by changes in domestic factors when t r or foreign factors t r appendix c drivers of change in the water footprint of wood products using structural decomposition analysis sda we decomposed drivers of change in the wf of wood products into 7 components fig c1 globally we see how affluence higher gdp per capita tends to drive the total changes showing also the shape of decrease in the years 2008 2009 to a much smaller extent typically representing about a third of the change due to affluence population also drove part of the increases in global wf the propensity effect i e the tendency to consume wood products measured as the total consumption of wood products per unit of gdp was clearly negative showing the opposite trend to affluence the trade structure i e the composition of trade shows in general negative values revealing that from 1997 onwards there were slight changes favouring a reduction in wfs of consumption the technological effect also played an important role in buffering the general changes of increased wfs fig c2 shows the attribution of changes in the global wf of wood products to domestic vs foreign factors in the beginning of the study period these changes are mostly driven by domestic changes i e changes in a nation s demand for wood products in later years the role of trade becomes increasingly important with foreign changes explaining the largest part around 75 of annual changes in the global wf of wood products in contrast to the temporal development of the global wf of wood products and underlying drivers at the global scale the picture looks different for two important countries on the global market of forest products china and the usa several studies have addressed the specifics of the general water footprints mainly from food products in relation to other sectors etc e g for china among many others chen et al 2017 guan and hubacek 2007 hubacek et al 2009 liqiang et al 2016 ma et al 2006 wang et al 2013 zhao et al 2015 2009 zhuo et al 2020 and for the usa among others chini et al 2020 2017 konar and marston 2020 marston et al 2018 in china the wf of consumption of wood products increased by roughly a factor 2 5 while the external component of the wf related to imported wood products increased from 35 to nearly 60 during the study period fig c3 no effect of the real estate crisis in 2008 and 2009 is visible in terms of drivers behind annual changes fig c4 we see that affluence as key driver has also a more upward and continuous trend compared to the global picture fig c1 it is quite interesting to observe how this effect seems to hide capturing most of the positive effects the role of growing population the propensity effect is less negative in china than globally this relates to the fact that there is not such a clear cut reduction in the share of demand of wood products when becoming richer while technology played an important role in compensating partially the upward trend of wfs of consumption in the case of the wf of national consumption of wood products of the usa we observe affluence and population and to a lesser degree the demand structure as clear drivers of the increase in the wf fig c5 from 2006 onwards the total change becomes negative strongly driven by the propensity effect closely linked to the financial crisis and in particular with the slowdown of the building sector years 2007 2009 it is remarkable how the reduction in building but also the move in demand in housing towards other materials than wood typically also more expensive have reduced the wf of wood products consumed in the usa 
144,several studies addressed the water footprint wf of countries and virtual water vw trade in agricultural and industrial products but freshwater use associated with wood products has received little attention yet international trade in wood products has been growing and forestry competes with other forest ecosystem services over limited freshwater resources therefore the objective of this paper is to assess nations wfs of consumption of wood products the sustainability of these wfs and the vw flows associated with international trade in wood products we account nations wfs of and vw trade in wood products with a multi regional input output model mrio forest that tracks wood flows along global supply chains production processing trade and final uses for the period 1997 2017 and assess the sustainability of the green and blue wf of wood products in 2017 the wf of wood production increased from 8 37 1011 m3 y in 1997 to 9 87 1011 m3 y in 2017 about 38 3 76 1011 m3 y of this wf relates to wood products for export in 2017 which means that vw trade associated with wood products ranks in between agricultural and industrial products in absolute volumes about 10 9 9 1010 m³ y of the green wf and 11 3 4 109 m³ y of the blue wf of wood products in 2017 are unsustainable meaning that they are located in areas where the total green blue wf exceeds the maximum sustainable green blue wf the unsustainable green wf occurs mainly in germany indonesia the czech republic and the uk and mainly relates to coniferous sawnwood paper and paperboard other than newsprint fibreboard and non coniferous sawnwood the unsustainable blue wf which is much smaller occurs in the usa russia nigeria canada and india and mainly relates to fuelwood paper and paperboard other than newsprint sawnwood and fibreboard this study increases our understanding of how forest evaporation flows link to the final consumption of wood products and contributes to the wider debate on the allocation of freshwater resources in the global economy keywords water footprint virtual water trade forestry timber wood multi regional input output 1 introduction global sustainability challenges are closely intertwined including air pollution biodiversity loss climate change energy and food security disease spread species invasion and water shortages and pollution liu et al 2015 today humanity increasingly faces many of these challenges and is dependent on the goods and services provided by the planet deng et al 2016 moran 2016 motesharrei et al 2016 reid et al 2005 rockström et al 2017 stern et al 2016 teeb 2010 tietenberg and lewis 2016 in a connected world goods and services consumed in one country are often produced in other countries and exchanged via international trade thus local consumption is increasingly satisfied by global supply chains oftentimes involving large geographical distances and leading to global environmental change hubacek et al 2014 this idea has been also reflected e g in the special issue led by yu et al 2013 with the concept of teleconnections to describe the remote spatial linkages between local consumption embedded in its local context and remote environmental impacts the rising world resource consumption is satisfied more and more through international trade giljum et al 2014 kastner et al 2014 plank et al 2018 schaffartzik et al 2014 warren hertel and villoria 2011 wiedmann et al 2015 yang et al 2020 this also applies to the case of the consumption of wood products international trade in primary and manufactured wood products more than doubled in the period of 1997 to 2014 according to the faostat database of the food and agriculture organization fao in science a growing interest has emerged to analyse and quantify the virtual water vw and land embedded in final forest products furukawa et al 2015 kastner et al 2011a 2011b lambin and meyfroidt 2011 liu 2013 o brien and bringezu 2018 schyns et al 2017 some of these works had used fao data to assess the forest footprint of nations and forest land embodied in international trade but have shortcomings in the tracing of global wood product supply chains regarding differentiating between intermediate and final consumption in input output models and presenting multiple interrelations of inputs and outputs arto et al 2022 developed a multi regional input output mrio framework that overcomes these shortcomings in this study we further develop this mrio model to trace global wood product supply chains and apply it to the case of freshwater to assess the water footprint wf of and vw flows of globally traded wood products nation s wfs of consumption of and vw trade in agricultural and industrial products has been studied hoekstra and chapagain 2007 hoekstra and mekonnen 2012 but not for wood products assessing nations wfs of globally traded wood products is a needed contribution to the wider debate on freshwater resources allocation in the global economy considering the importance of forests forests play an important role in local hydrology bagley et al 2014 marhaento et al 2018 and regional moisture recycling ellison et al 2017 van der ent et al 2010 forest evaporation is vital and unavoidable however annual forest evaporation is also limited since it ultimately originates from annual precipitation over the forest hence it is relevant to address the question how forest evaporation is made productive for different competing consumption goods by means of wf accounting in which the rate of moisture recycling is irrelevant schyns et al 2019 the wf of forestry products indicates which fraction of forest evaporation is attributed to forestry products the rest being attributed to other forest ecosystem services schyns et al 2017 van oel and hoekstra 2012 2010 pointed towards the relevance of wood products in the freshwater debate by assessing the wf of paper schyns et al 2017 presented estimates of global water use in the forestry sector related to roundwood production for lumber pulp paper fuel and firewood in recent decades in this study we build upon the work of schyns et al 2017 by linking the wf of wood production to final consumption of wood products captured in a mrio framework by providing estimates of the wf of consumption of wood products for all nations assessing their sustainability and showing international vw flows related to trade in wood products this article constitutes a novel contribution to our understanding of the wf of humanity the objective of this paper is to assess nations wfs of consumption of wood products the sustainability of these wfs and the vw flows associated with international trade in wood products we insert estimates on the wf per unit of roundwood production into the mrio model to account the green and blue wf of wood products and the vw flows resulting from international trade in wood products the framework covers 20 wood products types and 223 nations for the period 1997 2017 finally we assess the unsustainable part of the green and blue wf of wood products by analysing where the wf contributes to a situation in which the maximum sustainable wf is surpassed by the actual wf 2 materials and methods we account nations wfs of wood products by inserting estimates of the wf per unit of roundwood section 2 1 into the mrio model sections 2 2 to 2 4 section 2 2 describes the structure of i o tables section 2 3 summarizes the methods for the construction of these i o tables and section 2 4 describes how the nations wfs and vw flows associated with wood products are estimated with the mrio model section 2 5 described how we use structural decomposition analysis to understand the drivers of change of the wf of wood products over 1997 2017 lastly we assess the sustainability of the green and blue wf of wood products in 2017 section 2 6 2 1 the water footprint per unit of roundwood to assess the wf of traded forest products and national wfs associated with consumption of forest products we couple the mrio model to national average estimates of the wf per unit of roundwood and roundwood to forest product conversion factors we have estimated the national average wf per unit of roundwood production for the period 1997 2015 according to the method by schyns et al 2017 but used updated wood harvest maps luh2 version v2h instead of v1 0h from hurtt et al 2019a 2019b 2020 the luh2 v2h update addresses known issues and further features amongst others a wood harvest reconstruction based on fao and other sources and a spatial pattern of wood harvesting constrained by landsat data hurt et al 2016 first annual forest evaporation et from harvested wood areas is estimated on a 30 30 arc minute grid across the globe with separation between green water direct et of precipitation and blue water capillary uptake from shallow groundwater second this et flow is attributed to roundwood production based on ecosystem service values lastly we divide total et attributed to roundwood production by total roundwood produced per country over the period 1997 2015 to arrive at the wf in m³ water per m³ roundwood the country average values are presented in table a1 and are provided together with the underlying raster data as a separate dataset schyns 2022 we compared our updated estimates with those by schyns et al 2017 for the overlapping period 1997 2010 the global average wf of roundwood m³ m³ rw is 2 8 smaller in our study for the top 15 producers of roundwood the relative changes are in the range of 24 6 china to 9 7 canada 2 2 structure of input output tables mrio tables represent the flows of commodities among two or more countries regions matrices 1 1 bold faced lower case letters are used to indicate vectors bold faced capital letters indicate matrices and italic lower case letters indicate scalars including elements of a vector or matrix subscripts indicate industries and superscripts indicate countries vectors are columns by definition row vectors are obtained by transposition denoted by a prime e g x diagonal matrices are denoted e g x z and mean the intermediate inputs and their element zij are the physical amount of domestically produced or imported commodity i e g wood chips used to produce commodity j e g pulp similarly y denote the matrices of final uses wood products and their element yif indicates the final demand for commodity i to satisfy final use f x denotes the column vector of the total output by commodity and matrix of water use accounts w and its element whj is the physical amount of water footprint of production of type h in primary commodity i roundwood using bilateral trade data we get the structure presented in table 1 the scripts r s and t represent countries showing bilateral trade matrices origin for the first superscript destination for the second so for a specific country r we have total exports as e r z rs u z rt u y rs v y rt v and imports as m r z sr u z rr u y sr v y tr v being and u and v the summation vectors 2 3 building global mrio tables for forest faostat provides free access to historical data on food agriculture forestry and trade for over 200 countries these data have been extensively used to analyse issues related to land use production consumption and trade alexander et al 2015 faostat 2018a kastner et al 2014 2012 2011b lambin and meyfroidt 2011 van vliet et al 2016 weinzettel et al 2013 in order to get full advantage of these datasets we processed reconciled and assembled in a comprehensive accounting framework the following data i extraction and trade of wood fuel and roundwood ii the production of wood products by country and iii exports and imports by country and partner of wood products primary and processed products the accounting method departs from the i o framework i o tables represent national economies and are reported in monetary terms but a similar approach can be used to represent a sub system of an economy such as the extraction the processing and the consumption of forest products e g in physical units tonnes or cubic meters representing data in physical units analogously to faostat structures we obtain the physical mrio of forest products see arto et al 2022 making consistent the balances and classifications notably of national and trade data making compatible inconsistent data sources in particular firstly we build national i o tables for forest products from forest production and trade statistics secondly detailed trade statistics are used to connect the national i o tables of forest products to get the mrio forest table in the first procedure the production and trade statistics of wood products come from fao faostat 2018b extraction rates and level of processing of the different wood products also trade statistics are more aggregated than the production statistics so we built classification with 20 wood products see fig a1 although some are not explicitly shown anymore in bilateral trade data updates it distinguishes between raw materials intermediate products and final products input requirements for production of intermediate and final products is obtained by the production of each commodity times the input factor which is the volume of roundwood per unit of product joint forest sector questionnaire conversion factors unece and fao 2010 unece and fao 2005 finally we did a reconciliation between input requirement available for intermediate use and estimated finally a bi proportional adjustment method see miller and blair 2009 served to match available supply and input requirements of the commodities obtaining the set of 223 national i o tables of forest products in the second procedure we linked the national i o tables with the unreconciled bilateral detailed trade fao statistics which we reconciled replacing the exports imports by the maximum flow reported after consulting experts who agreed that underreporting is more likely to occur than overreporting e g due to problems of reporting in certain countries or issues of underreported illegal harvesting and obtaining shares among countries for splitting trade when partner countries are not specified 2 2 still additional adjustments were needed such as 1 modifying the country trade figures when there are zeroes in the country trade for a product but there is a value reported in the detailed trade statistics 2 replacing those flows with zero total exports imports in the detailed trade and non zero values in the country trade by the weighted average world bilateral trade patterns of the detailed trade 3 allocating to statistical difference the differences between the total country trade and the world totals 4 applying a bi proportional adjustment method for the final reconciliation 2 4 applying mrio tables to estimate the water footprint of national consumption of wood products the mrio database for forest products is used to study wfs of national consumption of wood products and vw flows resulting from international trade in wood products with a leontief demand driven model see leontief 1936 1937 miller and blair 2009 from equation x zu yv where x z and y are the elements of the mrio and u and v are the summations vectors we obtain x i a 1 yv byv a z x 1 represents the matrix of technical coefficients of the mrio being the element a i j r s of a the quantity of good i from country r needed to produce a unit of good j in country s b the leontief inverse matrix b i a 1 has as element b i j r s the total output of good i from country r needed to satisfy a unit of final demand of good j produced in country s the vector w represents the unitary water use coefficients of water use of wood product type h per unit of output the elements of w are the wf in country s needed to get one unit of good j w j s w h j s x j s we represent the vector of wf as w i a 1 yv myv with element m i j r s of m denoting the water used in country r to produce the quantity of good i needed to satisfy a unit of final demand of good j produced in country s the wf of consumption can be shown at various levels of aggregation e g the forest water uses in canadian roundwood that ends up in the newsprint consumption of the usa or the worldwide forest water needed in the total demand of wood products of usa the water in region t to satisfy the final uses of country s water footprint of country t in country r is obtained from r t s m rs y st v furthermore we can differentiate between the internal or domestic part of the wf of consumption i e usa forest water needed for usa consumption when t r and the external part i e foreign forest water needed for usa consumption when t r 2 5 structural decomposition analysis sda to understand drivers of change finally in order to understand the drivers of change we perform a structural decomposition analysis sda following the method proposed by dietzenbacher and los 1998 1997 see also a similar decomposition into components of emissions over time in arto and dietzenbacher 2014 as fully developed in appendix b we decompose the forest wf of consumption in country r into the following 7 components by assumption the average water per unit of output for each product in country r is the same along years the change in input structure in country t the change in the intermediate trade structure in country t the change in the final trade structure in country t the change in the composition of the final demand in country t the change in the consumption propensity in country t the change in the affluence in country t and the change in population in country t we can also distinguish the forest wf of consumption in country r that are driven by changes in domestic factors when t r or foreign factors t r 2 6 assessing the sustainability of the water footprint of wood products after the appearance of many studies on wfs recently other considerations such as sustainability of the uses are being associated in some recent studies of this type as e g on global crop production in mekonnen and hoekstra 2020 here we assess the sustainability of the green and blue wf of wood products in accordance with the global standard for wf assessment hoekstra et al 2011 separately by overlaying them with green schyns et al 2019a and blue mekonnen and hoekstra 2016 water scarcity statistics the green water scarcity index by schyns et al 2019a is defined as the ratio of the actual to the maximum sustainable green wf similarly the blue water scarcity index by mekonnen and hoekstra 2016 is defined as the ratio of the actual to the maximum sustainable blue wf for both indices the maximum sustainable wf has been estimated by subtracting environmental green blue water requirements from the total green blue flow also for both indices when the ratio exceeds 1 this indicates a situation in which the wf exceeds the maximum sustainable level we assess which part of the green and blue wf of wood products is located in areas where the total green blue wf of all activities in the area exceeds the maximum sustainable green blue wf i e where the green blue water scarcity ratio exceeds 1 which we label as unsustainable for green water we make the overlay at the level of nations following schyns and vanham 2019 who made a similar assessment for the case of the wf of wood for energy in the eu when the green water scarcity index for a nation is 1 we label the green wf in that nation as unsustainable for blue water we use the gridded 30 30 arc minutes average 1997 2015 blue wf of wood production section 2 1 which we overlay with the gridded 30 30 arc minutes blue water scarcity index map we then calculate the fraction of the blue wf of wood products in a nation that is unsustainable as the ratio of the blue wf of wood production in the nation in grid cells where the blue water scarcity index is 1 to the total blue wf of wood production in the nation 3 results first we analyse the wf of wood products from the production section 3 1 and consumption section 3 2 perspective then we analyse patterns of vw flows resulting from international trade in wood products section 3 3 lastly we assess the sustainability of the wood products wfs section 3 4 3 1 the water footprint of global and national production of wood products the wf of production of wood products increased from 8 37 1011 m3 y in 1997 to 9 87 1011 m3 y 97 green 3 1 blue in 2017 with a mean value of 9 06 1011 m3 y and a median value of 9 45 1011 m3 y fig 1 in 2008 2009 the wf of wood production decreased as a consequence of reduced demand for wood during the real estate crisis using sda we aim to identify the main drivers behind year to year changes in the global wf of wood products appendix c globally the main drivers of increased wfs were affluence and to a lesser extent population changes also minimally the demand structure while those lowering the wfs ceteris paribus from the initial to the end point of the period were technology trade structure and especially from the mid 2000s onwards the propensity to consume effect the largest part of the wf of production of wood products is located in europe incl russia 42 5 followed by america 34 and asia 17 9 fig 2 table a2 in terms of forestland harvested arto et al 2020 have found the largest contributors to be in a different order america 32 followed by asia 29 and europe 28 this has to do with the fact that south america and asia have large areas of tropical forests see schyns et al 2017 which a smaller share of total forest et attributed to roundwood production but a higher share of forest et attributed to other ecosystem services compared to the predominantly temporal and boreal forests in europe the top five individual countries with a large share in the global wf of forest production are the usa 19 russia 12 canada 10 china 6 and sweden 5 the wf of global production consumption of wood products relates for 99 to nine types of products paper and paperboard 27 coniferous sawnwood 25 wood fuel 20 fibreboard 9 non coniferous sawnwood 5 plywood 4 wood pellets 4 wood charcoal 3 and newsprint paper 2 table a3 the first three listed products together account for 72 of the global wf of wood products 3 2 the water footprint of national consumption of wood products a nation s wf of consumption of wood products fig 3 table a2 reflects the water use both within the nation and in other nations associated with all wood products consumed within the nation we observe a different picture compared to the wf of production fig 2 the largest part of the wf of consumption is located in europe incl russia 33 3 followed by asia 31 4 and america 28 6 notable countries with a smaller wf of consumption vs wf of production are russia 5 vs 12 canada 3 vs 10 and sweden 2 vs 5 vice versa countries with a larger wf of consumption vs wf of production are for example china 14 vs 6 usa 21 vs 19 and germany 5 vs 4 3 3 virtual water flows resulting from international trade in wood products the displacement between production and consumption of wood products is associated with international trade in wood products which results in vw flows in the year 2017 more than 3 76 1011 m3 y of water i e 38 of the wf of global production of wood products is used to produce wood products for export international trade in wood products ranks in between trade in agricultural and industrial products in terms of volumes of green and blue embedded in these trade flows as we can see by comparing our results with those from hoekstra and mekonnen 2012 they estimated that in 1996 2005 the total volume of international vw flows incl grey water related to trade in agricultural and industrial products amounted to 2 03 1012 and 2 82 1011 respectively we find that the total volume of international virtual green plus blue water flows related to trade in wood products was 3 30 1011 m³ y in 1997 2005 international vw flows are associated with certain wood products table a4 in 2017 about 90 of the vw flows were related to trade in six wood products raw industrial roundwood from coniferous 1 9 1011 m3 y and non coniferous non tropical 5 3 1010 m3 y sources wood chips and particles 4 3 1010 m3 y coniferous sawnwood 2 6 1010 m3 y wood residues 1 3 1010 m3 y and industrial roundwood from non coniferous tropical sources 1 0 1010 m3 y fig 4 shows the main vw flows by product and trading nations in 2017 highlighting the 10 main origins the main vw flows are concentrated on the northern hemisphere the largest virtual forest water flows relate to export from russia to china and from canada to the usa and china fig 5 shows that some countries are net exporters of virtual forest water while others are net importers of virtual forest water there is a minority of net exporters of vw 53 in 2007 46 in 2017 compared to net importers of vw 143 in 2007 121 in 2017 furthermore in 2017 only 19 countries had net exports of vw in wood products larger than one billion m³ y and 30 countries had net imports of vw in wood products larger than one billion m³ y the main net vw exporters are countries with a large forest production sector like russia canada sweden and finland the largest net virtual forest water importer is china at a distance followed by uk italy japan germany and the usa fig 6 shows a larger number of flows but still it is limited to the vw flows for countries with total imports or exports below 5 0 109 m3 y this leaves with 17 exporting and 18 importing regions plus the all other group showing flows only interacting with the former hence the graph highlights the most important origins destinations and vw flows the explanation is given at the bottom of the figure on the items ribbons a f and the country codes in table a1 also some below fig 5 indicates that some countries with are large net vw importers like the usa fig 5 also have some large vw export flows for example to mexico in the case of the usa 3 4 the sustainability of the water footprint of wood products about 10 9 9 1010 m³ y of the green wf of wood products in 2017 is labelled as unsustainable meaning that it is located in countries where the total green wf i e of all activities incl wood production exceeds the maximum sustainable green wf which implies that al large share of the green wf taps into environmental green water requirement and indicates fierce competition over limited available green water flows between human society and nature this unsustainable green wf is mainly in germany 37 5 indonesia 12 3 the czech republic 11 5 and the uk 9 1 another 16 1 56 1011 m³ y of the green wf of wood products in 2017 is located in countries where the total green wf is 75 100 of the maximum sustainable green wf indicating significant pressure on green water resources this part of the green wf is mainly in poland 20 india 19 france 11 ukraine 6 romania 6 and latvia 6 out of the total unsustainable green wf 40 3 9 1010 m³ y relates to wood products for export while 60 6 0 1010 m³ y relates to domestic wood supply in terms of product types 68 6 7 1010 m³ y of the unsustainable green wf relates to roundwood products and 32 3 1 1010 m³ y to fuelwood within the unsustainable green wf of roundwood products products of particular relevance are coniferous sawnwood 38 with germany and the uk as main final destinations paper and paperboard other than newsprint 30 with china and the uk as main final destinations fibreboard 16 with germany the uk and china as main final destinations and non coniferous sawnwood 8 with china indonesia and vietnam as main final destinations about 11 3 4 109 m³ y of the blue wf of wood products in 2017 is labelled as unsustainable meaning that it is located in places where the average monthly total blue wf i e of all activities incl wood production exceeds blue water availability indicating significant severe alteration of runoff and violation of environmental flow requirements note that share of blue 3 1 is much smaller than the share of green 97 in the wf of wood production section 3 1 and so the volume of the unsustainable blue wf is much smaller than of the green wf the unsustainable blue wf is mainly in the united states of america 23 8 russia 9 7 nigeria 9 4 canada 8 6 india 6 5 hungary 4 1 bangladesh 4 0 democratic republic of the congo 3 8 netherlands 3 5 and somalia 2 7 this list reflects areas where blue water contributes significantly to forest water use through capillary rise as depicted in schyns et al 2017 out of the total unsustainable blue wf 77 2 6 109 m³ y relates to wood products for export while 23 0 79 109 m³ y relates to domestic wood supply about half of the unsustainable blue wf relates to fuelwood mainly in nigeria 16 india 11 bangladesh 8 democratic republic of the congo 7 usa 7 and somalia 5 and the other half to roundwood products in particular paper and paperboard other than newsprint 32 with the usa and china as main final destinations coniferous sawnwood 25 with the usa and china as main final destinations non coniferous sawnwood 23 with the usa nigeria and china as main final destinations and fibreboard 10 with the usa russia and china as main final destinations from the consumption perspective the top 30 nations with a large unsustainable wf related to the use of wood products are shown in fig 7 and in table a2 also for other nations top of this list are germany the united kingdom china indonesia and czech republic for these countries except for china the unsustainable fraction is close to the internal fraction of the wf of consumption of wood products data not shown i e the unsustainable wf is in the consuming country itself countries for which the unsustainable fraction of the wf of consumption of wood products exceeds 50 are shown in fig 8 all these nations rely for a large share on wood from areas in which green or blue wf is unsustainable which may form a risk to their future wood supply in absolute volumetric terms the list is led by indonesia czech republic vietnam thailand bangladesh guatemala the philippines and switzerland further several small island states appear in fig 8 4 discussion 4 1 limitations of this study the framework we have applied has some limitations that are worth noting one is the limitation of not being able to fully capture the forest final products transformations and destinations due to faostat and trade data limitations to register all these such as the final processing of furniture for which we find some attempts of better capturing this see schütz et al 2003 with economy wide material flow analysis and conversions of volumes of processed products to primary equivalent also despite the attempt made to capture most of the best features of process analysis type of studies and mrio modelling distinction of intermediates and final goods to avoid usual results disparities see feng et al 2011 further integration of the mrio forest with other global databases e g detailed trade statistics and economy wide mrio databases e g exiobase or eora could be applied to expand system boundaries to cover upstream and downstream chains and vw flows related to wood products such as final furniture products inputs used in the activity such as machinery energy transportation etc we coupled the physical mrio forest model with national average estimates of the wf of roundwood ideally if we had information on which specific areas are used to harvest wood for export vs domestic use we could have used subnational averages this lack of spatially explicit information on the end purposes of harvested goods is also playing a role in previous studies that looked agricultural products and related vw trade hoekstra and mekonnen 2012 in general it would be desirable to refine the estimates of wood products and vw trade among subnational regions but data is lacking for this this relates to the issue of limitations on roundwood data reported to fao since it would be desirable to find ways to deal with illegal harvest which might be substantial in some countries see e g dieter 2009 haore 2015 lee et al 2009 mcpfe liaison unit warsaw 2005 ottitsch et al n d wwf 2008 zhang et al 2016 on another technical note based on the updated accounts from schyns et al 2017 we were able to differentiate between the wf of coniferous and non coniferous roundwood however we were not able to track this difference further along the wood supply chains since it is only in the first transformations where this distinction is documented in production statistics 4 2 comparison with methods of other studies despite the mentioned limitations this study includes a number of methodological advances our framework allows for examining wood and associated vw flows looking at the multilateral supply chains by connecting primary intermediate and final products this distinction results in detailed information on the production transformation trade and final use of 20 wood products and 252 fao country codes leading to 223 countries with non zero values for wfs it is also the main advantage with respect to the previous literature for the analysis of land use changes the work of kastner et al 2011a 2011b with a process analysis perspective followed a similar method but without this distinction as acknowledged and hinted as possible future research while o brien and bringezu 2018 accounted for timber flows and footprints also converting processed products into volume of primary equivalent our analysis of the decomposition of drivers of change in the wf of wood products also fits within similar exercises of decompositions of energy and emission pressures arto and dietzenbacher 2014 cao et al 2019 lan et al 2016 wang et al 2017 2019 and can also feed into future scenario assessments by showing how e g a change in one place e g increased final demand or a change in some of the drivers i e population affluence etc affects the forest wf of production in another place country 4 3 policy implications in the article we have shown that consumption and import of forestry products puts a claim on foreign water resources as water scarcity and drought occurrence intensify this may disrupt forest production and wood supply chains in the future which could have cascading effects on wood dependent sectors such as energy and construction this is relevant for policy makers to realize especially for those in the large net virtual water importing countries which are to some degree dependent on how the wood producing countries respond to such disruptions e g restrain wood export and focus on domestic supply our results are intended to show the links between forest product consumption in one place and water use elsewhere such that they can feed discussions on the sustainability and reliability of future wood supplies of nations we stress that such discussions cannot focus on water alone but should also include other environmental e g deforestation forest fires economic e g comparative advantages transport routes trade agreements and social e g provision of labour considerations associated with forest production in this context future research could focus on vw displaced by trade from areas where forest water use contributes to the climate system tipping points for example in semi natural or forests in the amazon congo or mekong basins eisenhammer 2021 lenton et al 2009 welch 2021 which could contribute to disruptions of the regional climate system and associated risks 5 conclusions we have estimated nations green and blue wfs and vw flows of globally traded wood products with a mrio framework for the period 1997 2017 and assessed the sustainability of these wfs for the year 2017 we find that over the study period the global wf of wood production and consumption increased and mostly refers to green water use 97 in 2017 the wf of production and consumption of wood products can vary strongly per nation depending on their character as net exporters of importers of virtual forest water we find there are relatively few net exporters 53 in 2007 46 in 2017 compared to net importers 143 in 2007 121 in 2017 of virtual forest water the main net exporters are russia canada sweden and finland the main net importers are china at a large distance followed by the uk italy japan germany and the usa the sum of international vw flows resulting from trade in wood products ranks in between the vw volumes associated with trade in agricultural and industrial products as estimated by others about 10 9 9 1010 m³ y of the green wf and 11 3 4 109 m³ y of the blue wf of wood products in 2017 are unsustainable meaning that they are located in areas where the total green blue wf exceeds the maximum sustainable green blue wf the unsustainable green wf is mainly in germany indonesia the czech republic and the uk and mainly relates to coniferous sawnwood paper and paperboard other than newsprint fibreboard and non coniferous sawnwood the unsustainable blue wf which is much smaller is mainly in the usa russia nigeria canada and india and mainly relates to fuelwood paper and paperboard other than newsprint sawnwood and fibreboard the application of mrio forest to the case of freshwater resources represents a powerful toolkit to better understand past present and future forest uses and wfs at multiple levels i e global regional national and product commodity this study has increased our understanding of how forest evaporation flows link to the final consumption of wood products and contributes to the wider debate on the allocation of freshwater resources in the global economy credit author statement ignacio cazcarro conceptualization methodology data curation resources investigation validation formal analysis software visualization writing original draft preparation reviewing and editing funding acquisition joep f schyns conceptualization methodology data curation resources investigation validation formal analysis software visualization writing original draft preparation reviewing and editing funding acquisition iñaki arto conceptualization methodology data curation resources investigation validation formal analysis software writing original draft preparation reviewing and editing funding acquisition maría josé sanz conceptualization resources investigation validation writing original draft preparation reviewing and editing supervision project administration funding acquisition credit authorship contribution statement ignacio cazcarro conceptualization methodology data curation resources investigation validation formal analysis software visualization writing original draft writing review editing funding acquisition joep f schyns conceptualization methodology data curation resources investigation validation formal analysis software visualization writing original draft writing review editing funding acquisition iñaki arto conceptualization methodology data curation resources investigation validation formal analysis software writing original draft writing review editing funding acquisition m jose sanz conceptualization resources investigation validation writing original draft writing review editing supervision project administration funding acquisition declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments bc3 authors thank the support of the spanish ministry of science innovation and universities through the project modeling and analysis of low carbon transitions malcon rti2018 099858 a i00 and the spanish state research agency through maría de maeztu excellence unit accreditation 2018 2022 ref mdm 2017 0714 funded by mcin aei 10 13039 501100011033 and basque government berc 2022 2025 programme i cazcarro thanks the support of the spanish ministry of science innovation and universities state research agency 2019 call for r d i pid2019 106822rb i0 multisectoral and multiregional models innovation and dynamics for economic social and environmental sustainability j f schyns was supported by funding from the european research council erc under the european union s horizon 2020 research and innovation programme earth lternatives project grant agreement no 834716 this article has been also a parallel study to one developed on land footprints under letter of agreement between the food and agriculture organization of the united nations fao un redd programme and the basque centre for climate change bc3 bc3 authors thank the staff of the fao and bc3 for their comments discussions and suggestions related to forest data and policy we are especially grateful to malgorzata buszko briggs and tina vahanen fao forestry department for their contribution to frame and coordinate the research and to salar tayyib daniela di filippo tomasz filipczuk fao statistics division and arvydas lebedys fao forestry department for providing datasets and for their discussions and comments on data and methodological issues appendix a extra tables and figures tables a1 to a5 and fig a1 appendix b analysis of drivers of forest water footprint of consumption changes the time series of mrio can also be used in combination with decomposition techniques to analyse the drivers of change in water footprint of consumption there is a considerable body of literature on how to decompose the effects of different factors in the evolution of a variable there are basically 2 techniques for such decompositions index decomposition analysis ida and structural decomposition analysis sda ida is usually adopted when the scope of the study is to have a better understanding of the drivers of the changes of emissions of a specific sector sda is based on i o analysis and is used to analyse the changes of the whole economy su and ang 2012 offer a detailed review of the literature on the application of sda the sda is based on leontief s demand driven model as describe in expression w i a 1 yv the elements of the vector of forest water footprint by commodity can expressed as b1 i r j s t w i r b i j r s y j s t furthermore the elements of the matrix of final demand can expressed as the product of different components as follows b2 y j s t y j s t s y j s t s y j s t j s y j s t j s y j s t g d p t g d p t p t p t t j s t s j t c t a t p t where pt is the population of country t at is the affluence or gdp per capita of region t ct is the propensity to consume wood products measured as the total consumption of commodities wood products per unit of gdp in country t st is the share of each commodity i in the total final demand of country t t j s t is the fraction of the total final demand of commodity i that is imported from country s if s t or is produced domestically if s t from expression b1 the total forest water footprint of production in country r can be expressed b3 i r j s t w i r b i j r s t j s t s j t c t a t p t expression b3 shows the forest water footprint as the product of a series of factors as we have pointed before from a policy perspective it results interesting to quantify the effect of each of these factors there are several ways to decompose expression b3 with an sda see su and ang 2012 for the different methods we follow the simplified method proposed by dietzenbacher and los 1998 1997 the changes in the water footprint between 2 points in time indicated by the subscripts 0 and 1 are δ ϖ ϖ 1 r ϖ 0 r where subscripts indicate the years the 2 polar decompositions δ ϖ a r and δ ϖ b r are b4 δ ϖ a r i j s t δ w i r b i j 1 r s t j 1 s t s j 1 t c 1 t a 1 t p 1 t i j s t w i 0 r δ b i j r s t j 1 s t s j 1 t c 1 t a 1 t p 1 t i j s t w i 0 r b i j 0 r s δ t j s t s j 1 t c 1 t a 1 t p 1 t i j s t w i 0 r b i j 0 r s t j 0 s t δ s j t c 1 t a 1 t p 1 t i j s t w i 0 r b i j 0 r s t j 0 s t s j 0 t δ c t a 1 t p 1 t i j s t w i 0 r b i j 0 r s t j 0 s t s j 0 t c 0 t δ a t p 1 t i j s t w i 0 r b i j 0 r s t j 0 s t s j 0 t c 0 t a 0 t δ p t b5 δ ϖ b r i j s t δ w i r b i j 0 r s t j 0 s t s j 0 t c 0 t a 0 t p 0 t i j s t w i 1 r δ b i j r s t j 0 s t s j 0 t c 0 t a 0 t p 0 t i j s t w i 1 r b i j 1 r s δ t j s t s j 0 t c 0 t a 0 t p 0 t i j s t w i 1 r b i j 1 r s t j 1 s t δ s j t c 0 t a 0 t p 0 t i j s t w i 1 r b i j 1 r s t j 1 s t s j 1 t δ c t a 0 t p 0 t i j s t w i 1 r b i j 1 r s t j 1 s t s j 1 t c 1 t δ a t p 0 t i j s t w i 1 r b i j 1 r s t j 1 s t s j 1 t c 1 t a 1 t δ p t and the average of the polar decompositions b6 δ ϖ r 1 2 δ w a r δ w b r the 2nd element of b4 and b5 can further be decomposed to distinguish between changes in the total intermediate input structure and changes in the trade structure of intermediate consumption since x byv and δb b 1 δa b 0 b 0 δa b 1 we have then that the 2nd element of b4 and b5 can be b7 i j s t w i 0 r δ b i j r s t j 1 s t s j 1 t c 1 t a 1 t p 1 t i j h s t w i 0 r b i j 0 r s δ a j h s t x h 1 t b8 i j s t w i 1 r δ b i j r s t j 0 s t s j 0 t c 0 t a 0 t p 0 t i j h s t w i 1 r b i j 1 r s δ a j h s t x h 0 t the following step is to split the change in the input coefficients in eqs b7 and b8 into the change in the total intermediate input structure and the change in the trade coefficients we define the country specific input coefficients d i j r s a i j s r and country trade coefficients τ i j s r a i j s r d i j r for each intermediate input i and output j the corresponding τ i j s r indicates the fraction that is imported from country s if s r or is produced domestically if s r hence we may write the change in δ a j i s t b9 δ a j i s t 1 2 τ j i 0 s t τ j i 1 s t δ d j i t 1 2 δ τ j i s t d j i 0 t d j i 1 t from expressions b4 to b8 we may also obtain how much of the change in water footprint of consumption in country s is driven by the changes in the socio economic structure in each other country b10 δ ϖ r 1 2 i j s t δ w i r x i 1 r x i 0 r b11 1 4 i j h s t w i 0 r b i j 0 r s τ j h 0 s t τ j h 1 s t δ d j h t x h 1 t w i 1 r b i j 1 r s τ j h 0 s t τ j h 1 s t δ d j h t x h 0 t b12 1 4 i j h s t w i 0 r b i j 0 r s δ τ j h s t d j h 0 t δ d j h 1 t x h 1 t w i 1 r b i j 1 r s δ τ j h s t d j h 0 t δ d j h 1 t x h 0 t b13 1 2 i j s t w i 0 r b i j 0 r s δ t j s t s j 1 t c 1 t a 1 t p 1 t w i 1 r b i j 1 r s δ t j s t s j 0 t c 0 t a 0 t p 0 t b14 1 2 i j s t w i 0 r b i j 0 r s t j 0 s t δ s j t c 1 t a 1 t p 1 t w i 1 r b i j 1 r s t j 1 s t δ s j t c 0 t a 0 t p 0 t b15 1 2 i j s t w i 0 r b i j 0 r s t j 0 s t s j 0 t δ c t a 1 t p 1 t w i 1 r b i j 1 r s t j 1 s t s j 1 t δ c t a 0 t p 0 t b16 1 2 i j s t w i 0 r b i j 0 r s t j 0 s t s j 0 t c 0 t δ a t p 1 t w i 1 r b i j 1 r s t j 1 s t s j 1 t c 1 t δ a t p 0 t b17 1 2 i j s t w i 0 r b i j 0 r s t j 0 s t s j 0 t c 0 t a 0 t δ p t w i 1 r b i j 1 r s t j 1 s t s j 1 t c 1 t a 1 t δ p t expressions b10 b17 decompose the forest wf of consumption in country r into the following 8 components the change in the yield in country r b10 which is zero due to using an average one over the years the change in input structure in country t b11 the change in the intermediate trade structure in country t b12 the change in the final trade structure in country t b13 the change in the composition of the final demand in country t b14 the change in the consumption propensity in country t b15 the change in the affluence in country t b16 and the change in population in country t b17 note that we can also distinguish the forest wf of consumption in country r that are driven by changes in domestic factors when t r or foreign factors t r appendix c drivers of change in the water footprint of wood products using structural decomposition analysis sda we decomposed drivers of change in the wf of wood products into 7 components fig c1 globally we see how affluence higher gdp per capita tends to drive the total changes showing also the shape of decrease in the years 2008 2009 to a much smaller extent typically representing about a third of the change due to affluence population also drove part of the increases in global wf the propensity effect i e the tendency to consume wood products measured as the total consumption of wood products per unit of gdp was clearly negative showing the opposite trend to affluence the trade structure i e the composition of trade shows in general negative values revealing that from 1997 onwards there were slight changes favouring a reduction in wfs of consumption the technological effect also played an important role in buffering the general changes of increased wfs fig c2 shows the attribution of changes in the global wf of wood products to domestic vs foreign factors in the beginning of the study period these changes are mostly driven by domestic changes i e changes in a nation s demand for wood products in later years the role of trade becomes increasingly important with foreign changes explaining the largest part around 75 of annual changes in the global wf of wood products in contrast to the temporal development of the global wf of wood products and underlying drivers at the global scale the picture looks different for two important countries on the global market of forest products china and the usa several studies have addressed the specifics of the general water footprints mainly from food products in relation to other sectors etc e g for china among many others chen et al 2017 guan and hubacek 2007 hubacek et al 2009 liqiang et al 2016 ma et al 2006 wang et al 2013 zhao et al 2015 2009 zhuo et al 2020 and for the usa among others chini et al 2020 2017 konar and marston 2020 marston et al 2018 in china the wf of consumption of wood products increased by roughly a factor 2 5 while the external component of the wf related to imported wood products increased from 35 to nearly 60 during the study period fig c3 no effect of the real estate crisis in 2008 and 2009 is visible in terms of drivers behind annual changes fig c4 we see that affluence as key driver has also a more upward and continuous trend compared to the global picture fig c1 it is quite interesting to observe how this effect seems to hide capturing most of the positive effects the role of growing population the propensity effect is less negative in china than globally this relates to the fact that there is not such a clear cut reduction in the share of demand of wood products when becoming richer while technology played an important role in compensating partially the upward trend of wfs of consumption in the case of the wf of national consumption of wood products of the usa we observe affluence and population and to a lesser degree the demand structure as clear drivers of the increase in the wf fig c5 from 2006 onwards the total change becomes negative strongly driven by the propensity effect closely linked to the financial crisis and in particular with the slowdown of the building sector years 2007 2009 it is remarkable how the reduction in building but also the move in demand in housing towards other materials than wood typically also more expensive have reduced the wf of wood products consumed in the usa 
