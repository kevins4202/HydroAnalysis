index,text
2210,widespread surveillance cameras that continuously record rainfall information offer an opportunity for high spatiotemporal resolution rainfall inversion surveillance video based rainfall data estimation has become one of the most promising methods however existing relevant studies have focused on rainfall observations during the day little attention has been given to developing a surveillance camera based rain gauge that works at night generally ordinary surveillance cameras actively emit near infrared light nir to supplement the insufficient illumination of a surveillance scenario providing an essential prerequisite for rainfall observations at night in this paper an nir surveillance video based rain gauge nir vrg was constructed first combining the meteorological and microphysical characteristics of raindrops with the camera imaging principle the abilities of different nir surveillance cameras to capture raindrops during different rainfall scenarios were discussed providing the theoretical basis for subsequent work second a tensor based algorithm was proposed for rain streak extraction from nir surveillance video and finally a one dimensional convolutional neural network 1d cnn based regression algorithm was proposed and used to build a mapping relationship between the extracted rain streaks and the rainfall intensity ri experimental results on synthetic rainy videos showed that the proposed rain streak extraction algorithm achieves robust performance in a light breeze speed approximately 3 m s and still works in a gentle breeze speed approximately 5 m s moreover experiments during various rainfall scenarios show that the designed nir vrg measures rainfall information with high accuracy the relative error of the ri and cumulative rainfall ranged from 8 86 to 84 84 and 7 82 to 30 70 respectively the nir vrg fills the gap of rainfall observations at night by using surveillance cameras and provides a reference for constructing an all weather rainfall observation network keywords rainfall observation surveillance camera near infrared light video all weather convolutional neural network data availability data will be made available on request 1 introduction rainfall data with high spatiotemporal resolution are of great value in the meteorology hydrology global warming and urban disaster monitoring fields xiao et al 2018 under the dual effect of global climate change and rapid urbanization urban heat island and rain island effects frequently occur min et al 2011 with the rainfall in urban areas presenting high degrees of randomness and complexity current rainfall observation systems including ground based rain gauges kathiravelu et al 2016 kidd et al 2017 and remote sensing based radar or satellites brunetti et al 2018 zorzetto and marani 2020 however have difficulty producing rainfall data with relatively high resolution to meet these needs mccabe et al 2017 njue et al 2019 therefore developing a high resolution low cost ground level rainfall monitoring network has become a research hotspot in hydrology and meteorology related fields in recent years exploring alternative means of rainfall sensing has become a popular topic videos from surveillance cameras allamano et al 2015 garg and nayar 2004 garg and nayar 2007 jiang et al 2019 audio recordings from smartphones on rainy days guo et al 2018 the signal strength of commercial cellular communication networks barthès and mallet 2013 and windshield wiper motion patterns or optical sensor readings in moving vehicles rabiei et al 2016 have been discussed as alternative rainfall information indicators in contrast surveillance video based rain gauges vrgs 1 1 acronyms and definitions in this study can be found in appendix 1 have the following advantages i densely distributed surveillance cameras provide a hardware basis for high spatial resolution rainfall observations ii the rapid transmission processing and interpretation of surveillance videos offer software support for high temporal resolution rainfall measurements iii vrgs can be implemented on existing city surveillance resources which greatly reduces maintenance and implantation costs existing studies have demonstrated the potential for surveillance cameras to act as low cost weather stations mccabe et al 2017 njue et al 2019 and a state of the art study jiang et al 2019 achieved a mean absolute percentage error of 21 8 performance which further promotes the deployment of vrg networks in practical applications in summary ordinary surveillance video camera based rainfall estimation has become one of the most promising rainfall estimation methods jiang et al 2019 mccabe et al 2017 however existing studies have mainly explored visible light video acquired during the daytime allamano et al 2015 dong et al 2017 garg and nayar 2004 garg and nayar 2007 haurum et al 2019 jiang et al 2019 zen et al 2019 with little development and discussion of vrgs working operating at night the damage caused by disasters induced by rainfall events at night is usually worse than that during the day hence the perception of rainfall at night is also essential currently ordinary surveillance cameras are usually equipped with near infrared nir lamps ariff et al 2015 under low visibility scenarios e g at night these cameras actively emit nir light to provide an additional light supplement thus enabling them to capture target objects the low visibility environment perception ability of surveillance cameras makes it possible for vrgs to continue working at night the development of nir surveillance video based rain gauges nir vrgs has become our focus the main contributions of this study are as follows i the meteorological and microphysical knowledge of raindrops was combined with the nir camera s imaging principle and the ability of nir surveillance video to capture raindrops with different diameters was proven which provides the theoretical basis for accurate rainfall inversion ii taking the influencing factors wind water vapour particles insects etc into account a tensor based rain streak extraction algorithm was proposed for nir surveillance videos after a comprehensive analysis of the sparsity of rain streaks in nir videos and the low rank property of a rain free background iii a one dimensional convolutional neural network 1d cnn based regression algorithm was used to build the mapping relationship between the extracted rain streaks and the rainfall intensity to the best of our knowledge this is the first attempt to apply nir surveillance video for rainfall estimation our research makes up for the shortcomings of current vrgs which can only work during the day and provides support for obtaining all weather high spatiotemporal resolution rainfall data the rest of this paper is organized as follows following this introduction we present the images of raindrops in nir surveillance cameras in section 2 to theoretically explore the ability of nir surveillance cameras to perceive rainfall events we explain our improved rain streak extraction algorithm in section 3 and the ri estimation network in section 4 finally we discuss the experimental results in section 5 and conclude in section 6 2 near infrared surveillance cameras and rain on rainy days the video image pixels blurred by high speed falling raindrops are often shown as lines called rain streaks garg and nayar 2004 garg and nayar 2007 raindrops are the basic elements of rainfall events and the size and distribution of raindrops reflect the intensity and process of rainfall the speed of natural falling raindrops varies with size during the camera exposure interval a nir video camera is assumed to capture only the low speed raindrops and fails to track those at high speed which would lead to an underestimation of rainfall moreover complete sharp rain streaks in images videos during rainfall scenarios are crucial for the inversion of rainfall information rainfall intensity ri or cumulative rainfall cr hence whether a nir video camera able to capture rain streaks of any sized falling raindrops is our first concern in addition whether the rain streaks obtained by the nir video can reflect the dynamic changes in rainfall is our second concern therefore the ability of nir surveillance cameras 2 2 it should be noted that all of the surveillance cameras in this study operate based on the pinhole imaging principle to capture rainfall events rain particles is an important issue to verify and discuss existing studies have indicated that the shape size and velocity of raindrops are important to the calculation of the scattering properties of raindrops at nir light wavelengths guo et al 2015 xi chuan et al 2010 in this section the imaging patterns of raindrops at nir wavelengths are presented in section 2 1 then the possibility of raindrops being captured by different types of surveillance cameras during various rainfall scenarios is discussed in section 2 2 and a brief introduction to the microphysical properties and meteorological knowledge of rain particles can be found in appendix 2 2 1 scattering properties of raindrops the scattering properties of raindrops depend mainly on the wavelength dependent refractive index and geometry wei et al 2021 for spherical atmospheric particulate matter fog haze raindrops etc scattering can be divided into three categories rayleigh scattering mie scattering and unselected scattering wetzel 1990 however when a raindrop is larger than 1 mm its shape is not ideally spherical and differs from the typical spherical model as shown in fig 21 in appendix 2 resulting in certain computational errors in the scattering calculation usually the raindrop size is much larger than the wavelengths of visible or nir light the nir wavelength is typically between 780 nm and 1000 nm for surveillance cameras in this case the rayleigh and mie scattering theories do not work properly because the dimensionless scale parameter of raindrops is much larger than 100 li et al 2015 geometric optical scattering methods are the most popular choice guo et al 2015 ross and bradley 2002 wei et al 2021 xi chuan et al 2010 from a geometric optics viewpoint scattered light amplitude is considered to be the superposition of the diffracted refracted and reflected fractions xu et al 2004 we briefly describe the scattering properties of raindrops in visible light in appendix 2 in contrast to visible light in nir light over 90 of the scattering energy of raindrops is forward scattered hulst and van de hulst 1981 moreover the geometric scattering of raindrops is mainly centralized in the forward direction at 0 60 and quite weak at other angles guo et al 2015 li et al 2007 xu et al 2004 specifically fig 1 a shows a raindrop captured by an nir surveillance camera as shown in fig 1 b a raindrop with a 1 5 mm diameter is taken as an example a 1 5 m m the parallel polarization direction is mainly centralized in the forward 0 30 direction but less in other scattering angles the reflection in the perpendicular polarization direction is mainly centralized in the forward direction at 0 60 guo et al 2015 the larger the raindrop is the more concentrated the light scattering and the smaller the scattering angle that is the forward scattering light affected by the incident angle has a significant influence on the imaging of raindrops considering that a surveillance camera is often stationary the position of the infrared transmitter is constant the incident angle of nir light changes during raindrop fall therefore as shown in fig 1 c and d the intensity values of the pixels i r 1 i r 2 i r 3 i r 4 i r 5 blurred by a raindrop may vary rain streaks captured by an nir surveillance camera may be uneven as shown in fig 1 e existing rain streak extraction algorithms designed based on the consistency of grey values of raindrop blurred pixels are no longer applicable in nir vrgs these scattering properties are very important for the design of rain streak extraction algorithms in ideal rainfall scenarios the brightness of a raindrop at both visible and nir wavelengths is not affected by other raindrops garg and nayar 2004 garg and nayar 2007 xichuan et al 2013 the rainfall scattering corresponds to a linear superposition of the scattering of all raindrops in the sampled volume in summary nir surveillance videos can record raindrop information to some extent and the imaging of raindrops is influenced by the relative position and size of the rain particles 2 2 probability of raindrops captured by camera for vrgs and nir vrgs raindrops appear in the form of rain streaks sharp and complete rain streaks are important prerequisites for rainfall information interpretation dong et al 2017 jiang et al 2019 in both visible and nir cameras objects appear sharp within a certain range near the focus distance that is the range between the near focus distance point and far focus distance point of acceptable sharpness allamano et al 2015 jiang et al 2019 as shown in fig 2 a the range mentioned above can be defined as the spatial volume of rainfall svor perceived by cameras as shown in fig 2 a the prism formed by the plane between the near focus point and far focus point labelled by solid red orange lines note that the svor refers to the estimated volume in garg and nayar 2005 the sampling volume in allamano et al 2015 and the depth of field in jiang et al 2019 however nir surveillance cameras capture images videos using actively emitted nir light and the svor will be affected by the sensing range of the equipped nir transmitter furthermore differences in the lighting environment of the surveillance scenarios can also result in the actual svor being less than the theoretical value by varying degrees for an ordinary surveillance camera to save resources and ensure the maximum surveillance range at night the nir sensing range is usually designed to be approximately equal to the theoretical value of the field of view fov therefore surveillance cameras with different parameters usually have various nir light sensing ranges as shown in fig 2 b typically the svor of the cameras in fig 2 b will be most affected by the lens focus length f when the other configurations are the same or do not differ much meaning that f c a m e r a 1 f c a m e r a 2 f c a m e r a 3 f c a m e r a 4 in fig 2 b nir cameras with different parameters usually have different svor values and different nir sensing ranges the blur effect of raindrops within the svor is almost null outside the svor however the blur effect causes the size of raindrops to be overestimated next whether the raindrops within the svor can be captured by the camera is another important issue to be discussed taking fig 2 a as an example defining the vertical plane where a raindrop χ is located as the target plane the horizontal distance between χ and camera lens is l mm without considering the exposure interval of the nir transmitter the probability of a raindrop being completely captured can be expressed as liu et al 2014 1 p d l h l r 90 2 v d t exp v d t exp where t exp is the exposure time in ms r 90 is the size of the rain particle in the vertical direction which can be calculated using the b c model please see appendix 2 eq 2 1 v d represents the terminal speed of raindrops which can be obtained by using eq 2 3 in appendix 2 and h l is the vertical size of the target plane mm h l can be calculated as follows 2 h l h f l where h represents the horizontal size of the active area of the imaging sensor mm and is the focus length mm for the same raindrop same velocity the longer the falling trajectory within the svor the more likely it is to be captured considering the sharpness of the rain streaks the range of h l values depends on the distance of the near focus point and far focus point therefore the h l value should be set to h l near h l h l far the distance of the near focus point l near can be calculated using eq 3 3 l near d f f 2 f 2 n c p d f f l far d f f 2 f 2 n c p d f f where d f is the focus distance of the camera mm n is the f number of the lens relevant to the aperture diameter and c p is the maximum permissible circle of confusion mm details about the camera parameters can be found in jiang et al 2019 and allamano et al 2015 2 2 1 capture probability vs raindrop size raindrops with different sizes have different contributions to the ri calculation the ability of an nir camera to capture raindrops is the basis for exploring the ability of the camera to acquire rainfall information we first discuss the relationship between the captured probability p d l and raindrop size d taking the general surveillance camera parameters as input t exp was set to 20 25 30 and 35 and h l was set to 400 500 600 and 700 simulation results can be found in fig 3 fig 3 shows that as h l increases p d l also becomes larger under the same t exp indicating that the camera is becoming more efficient in capturing raindrops in addition as t exp increases p d l decreases indicating that the camera is becoming less effective in capturing raindrops in conclusion p d l is positively correlated with h l and negatively correlated with t exp without loss of generality we take t exp 35 as an example to explore the relationship between h l and p d l the results are shown in fig 4 fig 4 illustrates that raindrops with larger sizes are less likely to be captured than smaller ones with the same nir camera an nir camera with a relatively large h l facilitates the capture of raindrops when h l 989 a camera with a t exp 35 was able to capture 100 of the raindrops of different sizes the h l near value of commercially available surveillance cameras is usually greater than 1000 mm that is conventional surveillance cameras are able to capture different sizes of naturally generated raindrops 2 2 2 capture probability vs rainfall intensity in this section we discuss the ability of nir cameras to capture raindrops during different rainfall scenarios ri is often used to identify different rainfall events considering that the raindrop size in real rainfall follows a gamma distribution n d as shown in eqs 2 2 in appendix 2 and the raindrop size is generally not more than 6 mm the average probability of raindrops being captured during various rainfall events can be defined using eq 4 4 a v e probability 0 6 p d l n d d d 0 6 n d d d we compared a v e probability during different rainfall scenarios in fig 5 for comparison purposes in fig 5 a we set t exp 35 and h l 600 in fig 5 b from fig 5 we can find that in general with the same camera an increase in ri leads to a decrease in a v e probability combined with fig 4 we can learn that general surveillance cameras are able to capture all raindrops comprehensively when h l is large enough moreover we take ordinary surveillance cameras available on the market as simulation objects the camera parameters as shown in appendix 4 the simulation results show that a common surveillance camera is able to capture 100 of the comprehensive rain streaks during various rainfall scenarios ri can be used for cr calculation according to the definition ri can be calculated by obtaining all raindrops in a unit space although the svor of the nir surveillance camera is unknown the volumetric value of svor can be considered to be a stable constant because the surveillance cameras are usually fixed and the surveillance scenes are highly consistent in other words if nir video can capture different sizes raindrops it can calculate the ri and cr the nir surveillance camera that meets the above conditions is capable of inverting the rainfall dynamics the above analyses show that nir videos obtained by ordinary surveillance cameras satisfy these conditions and are feasible for calculating rainfall information 3 rain streak extraction how to accurately extract rain steaks is the first task of an nir vrg the rain streak extraction model aims at separating rain streaks and clean video from the input rainy video jiang et al 2018 the rainy video o r m n t can be modelled as a linear superimposition of the desired unknown video background b r m n t and the rain streaks r r m n t i e o b r decomposing the rain streaks r and the desired video background b is an ill posed inverse problem jiang et al 2017 jiang et al 2018 wang et al 2019a as described in section 2 the brightness of the rain streaks in nir video may be uneven some methods based on the premise of consistent rain streak brightness brewer and liu 2008 liu et al 2009 may no longer be applicable in nir videos in recent years tensor based approaches have been extensively studied for rain extraction removal from videos wang et al 2019b in this part a tensor based variational model for video rain streak detection is proposed as follows 5 min b r α 1 dtv r 1 α 2 r 1 α 3 y b 1 α 4 t b 1 r a n k b s t o r b r b 0 where dtv and y are the dtv and derivative operator along the rain streak direction and the perpendicular direction of the rain streaks respectively t indicates the time directional difference operator suppose tensor x r i 1 i 2 i n the mode k unfolding of tensor x is denoted as unflo d k x x k r i 1 i 2 i n and x f is the frobenius norm of tensor x the array of rank x rank x 1 rank x 2 rank x n is the n rank of tensor x please refer to kolda and bader 2009 for an extensive overview 3 1 rain streak modelling rain streaks maintain similarity and repeatability in nir surveillance video as shown in fig 6 a the direction of the rain streaks is vertical by default in our rain streaks extraction algorithm in realistic scenarios mainly due to the influence of wind the falling direction of raindrops is not vertical as shown in fig 6 b for example sieck et al 2007 demonstrated that wind with a speed of 3 m s would result in a rainfall inclination angle of 15 when larger inclination angles are encountered the performance of rain streak detection will decline jiang et al 2019 jiang et al 2018 different methods for determining the angles of rain streaks have been proposed to mitigate the interference of wind on the performance of rain streak identification du et al 2018 kolda and bader 2009 sun et al 2019 based on extensive analyses and observations this study assumes that rain streaks are always in the same direction within one video frame inspired by sun et al 2019 and kolda and bader 2009 from the derivative domain dtv r 1 kongskov et al 2019 are adopted to calculate the image derivatives along the rain streak direction to model the sparsity of rain streaks under the assumption that the magnitudes of rain streaks are commonly sparse the l1 norm regularizer r 1 is employed to model the sparsity of rain streaks in the spatial domain additionally in real applications insects attracted by infrared light flying around the camera lens as shown in fig 6 c the motion imaging of water vapour particles on rainy days as shown in fig 6 d and waving tree leaves in wind bring new challenges to the distinction of rain streaks in nir video the appearance of rain streaks is always piecewise smooth along the perpendicular direction of rain streaks jiang et al 2017 sun et al 2019 although rain streaks appear inclined due to the influence of wind the above conclusions remain valid extensive observations and analysis have revealed that insects and water vapour particles are primarily in the shape of dotted spots such as circles or ellipses modelling the sparsity of rain streaks is an important means of distinguishing between rain streaks insects and water vapour particles in nir surveillance videos furthermore the spatiotemporal properties of the background in section 3 2 are employed to represent rain streaks in the above complex scenarios 3 2 background modelling compared to surveillance video during the day despite the interference mentioned before the background of nir surveillance video scenarios during the night is more homogeneous primarily black the spatial and temporal self similarities between any two consecutive frames are strong similar to natural images in visible light nir images can also be well distributed as a laplacian distribution in spatial and temporal directions liu et al 2014 sun et al 2019 the tv regularizer is a suitable candidate for the assumption of a laplacian prior first a tv regularizer t b 1 is used to model the sparsity of video intensities in the temporal direction mining video features in the temporal dimension plays an important role in identifying regularly moving objects in the background such as waving leaves as mentioned before the appearance of rain streaks is always piecewise smooth along the perpendicular direction of rain streaks jiang et al 2017 the directional smoothness of the image was used to construct more robust rules for separating rain streaks from the background with various interfering factors e g water vapour particles insects to reduce the complexity and improve the real time of the model a tv regularizer y b 1 is employed to model the sparsity of video intensities in the vertical direction moreover nir surveillance videos taken by static cameras or with static backgrounds are always low rank combined with existing research cao et al 2016 jiang et al 2017 using the spatiotemporal coherences of video rank b is minimized to promote the decomposition of rain streaks and background in our model we used the alternating direction method of multipliers admm framework to solve eq 5 for the rain streak extraction task from the nir video the details can be found in appendix 3 4 rainfall intensity estimation as a common variable utilized to describe the characteristics of rainfall events in meteorology ri is defined as the ratio of the total amount of rain rainfall depth falling during a given period to the duration of the period it is expressed in depth units per unit time usually as mm per hour mm h according to its definition the ri value can be estimated based on the size and speed of all identified rain streaks within the svor we refer to this mapping method between rain streaks and ri as the meteorological based approach allamano et al 2015 garg and nayar 2007 jiang et al 2019 in contrast bossu et al 2011 tan et al 2018 haurum et al 2019 and zen et al 2019 derived a relative estimate of ri by counting the statistical values of rain streak pixels we refer to this mapping method between rain streaks and ri as the regression or fitting based approach for surveillance cameras usually at night when the brightness of the svor is below a previously set threshold the camera automatically enters nir mode most of the surveillance camera installations are fixed with a defined svor furthermore with fewer human activities at night the possibility of background anomalies in the background of the nir video is much lower than that of a video captured during the day hence an nir video has more substantial consistency and provides a favourable condition for mapping rain streaks and ri however for the meteorological based ri estimation mechanism one significant difficulty needs to be overcome the svor of nir surveillance cameras varies depending on the lighting conditions of the surveillance scenario calibration of the svor is essential and complex in practical applications in conclusion we use a regression based approach to estimate ri in recent years deep learning based methods have achieved great success in classification and regression problems in the computer vision cv and neuro linguistic programming nlp fields a 1d cnn based ri regression network was proposed as shown in fig 7 the proposed cnn network contains 6 convolutional blocks 3 fully connected layers and the last linear layer used as the output prediction each convolutional block consists of a 1d convolutional layer and a rectified linear unit relu xu et al 2015 layer we also add a batch normalization bn ioffe and szegedy 2015 layer after relu activation in the second and fourth convolutional blocks to normalize the input features by adjusting and scaling the activations the proposed 1d cnn takes the rain streaks extracted by eq 5 in section 3 as input and the outputs are the corresponding rainfall intensity values after the rain streaks r i of frame i were extracted the sum of rain pixels in all frames within 1 s was regarded as an indicator of ri which can be expressed by 6 s u m p i x e l i 1 t r i where t is the frame rate to reduce the interference of wind and other influencing factors similar to the operator in allamano et al 2015 dong et al 2017 and jiang et al 2019 we take the average value of s u m p i x e l every 10 s to represent the ri in the current time period which can be calculated as follows 7 a ve pixel 1 10 j 1 10 s u m p i x e l j hence the feature dimension sizes of the input data are 6 1 as shown in fig 8 5 experiments and results 5 1 evaluation of the rain streaks extraction algorithm 5 1 1 experimental setup due to the complexity and difficulty of obtaining rain streaks in different directions from real surveillance videos we use synthetic data to validate the effectiveness and efficiency of the rain streak detection algorithm additionally after numerical experiments the regularization parameters α 1 α 2 α 3 α 4 α 5 were manually selected from 10 1 10 2 10 3 and β 1 β 2 β 3 β 4 β 5 were set to 55 details of these parameters can be found in section 3 2 the details of the parameter settings of the rain streak extraction algorithm are shown in table 1 these parameters are used in the real scenario experiments in section 5 2 for synthetic data since the ground truth of rain streaks is available we use a black background to simulate the nir surveillance scenario named nir we have added similar pixels of water vapour particles and insects to the nir videos which are named water vapour particles and insects respectively typically visible rainfall videos often have more complex backgrounds than nir videos since it is difficult to add various moving backgrounds to nir videos we use visible rainfall videos to investigate the effect of moving targets on our rain streak extraction algorithm three classical videos named waterfall girl and highway were selected as the ground truth background videos 3 3 https trace eas asu edu yuv different from waterfall there are moving objects in the background of girl and highway various types i e direction and intensity of rain streaks were added to the background videos using the photoshop software whose degrees of rain streaks ranged from 0 to 45 in 15 intervals corresponding to tiny drizzling to heavy rainfall the synthetic heavy rainfall scenarios with a 45 inclination and the rain streak extraction results are shown in table 2 since the ground truth videos without rain streaks are known we can quantitatively compare all competing scenarios videos the gradient magnitude similarity deviation gmsd xue et al 2013 is commonly used to measure the pixelwise gradient magnitude similarity between the original image i e the true rain streak image and the reproduced image i e the identified rain streak image jiang et al 2019 the higher the gmsd score is the larger the distortion range xue et al 2013 the gmsd was employed as the index for rain streak detection quality assessment in this study the total gmsd for each video is obtained from the averaged gmsd values of all the frames 5 1 2 results and analysis the distribution of gmsd values among different rainfall scenarios is shown in fig 9 fig 9 illustrates that when the inclination angle of the rain streaks is between 0 and 15 the variation in gmsd values is slight and the performance of our proposed rain streak extraction algorithm is robust when the inclination angle of the rain streaks is within 15 and 30 the gmsd values increase to a certain extent and our proposed rain streak extraction algorithm still works however when the inclination angle of the rain streaks is between 30 and 45 the gmsd values increase rapidly and the accuracy of the proposed rain streak extraction algorithm decreases significantly the above conclusions are valid for both visible and nir videos suggesting that our rain streak extraction algorithm can also be applied to visible surveillance rainfall videos it is worth mentioning that relevant studies erpul et al 2003 helming 1999 sieck et al 2007 pointed out that the rainfall inclination angle is usually below 15 when the wind speed is less than 3 m s and the rainfall inclination angle is usually approximately 30 when the wind speed is approximately 5 m s it can be concluded that our proposed method is effective in breezy wind speed lower than 5 m s and rainy scenarios 5 2 evaluation of the rainfall estimation in real rainy scenarios 5 2 1 experimental setup in this section the performance of the ri and cr estimation in a real surveillance scenario are evaluated the experimental site is located at nanjing normal university nanjing city jiangsu province china as shown in fig 10 on may 08 and 20 2021 denoted as 2021 03 08 and 2021 03 21 two long term rainfall events occurred in the study area including a variety of rainfall types from light rain to heavy rain and these rainfall data were typical and representative for our research ground based rainfall observations are usually regarded as ground truth in meteorological and hydrological studies in this study the reading from a high precision electronic rain gauge zjc v zhejiang hengda instrument metre co ltd is regarded as the verification data the electronic rain gauge is a kind of siphon rain gauge capable of reporting rainfall information every 0 1 mm of cr or every minute the reading from the electronic rain gauge is regarded as the ri label considering the spatial and temporal variability of natural rainfall the distance between the surveillance cameras and the rain gauge is approximately 80 m to ensure the accuracy of the obtained ri labels two different scenarios were observed simultaneously to test the stability of rainfall estimation in different lighting environments as shown in fig 11 we denote the camera in scenario 1 as camera 1 and in scenario 2 as camera 2 in the subsequent discussion the parameters of the cameras are shown in table 3 moving targets were present in both surveillance scenarios including moving cars electric bicycles and pedestrians for example between 22 36 and 22 39 on 8 march a car and an electric bicycle with their lights on passed through two surveillance areas fig 10 shows that the rain streaks in surveillance scenario 1 are thinner and longer than those in surveillance scenario 2 moreover because of the different light environments of the background the rain streaks in surveillance scenario 2 are brighter and have a higher contrast ratio combined with eq 2 and table 3 the h l value of camera 1 is 1235 mm and that of camera 2 is 1624 mm according to eq 1 the capture probability for raindrops of different sizes by a camera can be obtained it can be concluded that in theory our experimental cameras can capture raindrops of different size during various rainfall intensity scenarios 5 2 2 1d cnn training details in our cnn model training the adaptive moment estimation admm kingma and ba 2014 was selected as the optimizer and the mean squared error mse was chosen as the loss function the coefficient of determination r 2 is a well known quantity in linear regression nagelkerke 1991 was employed as the metric to evaluate the performance a perfect match would result in r 2 1 which indicates that the model describes the data perfectly r 2 can be calculated by eq 10 8 redisual y true y pred 2 9 total y true y true 2 10 r 2 1 r e s i d u a l t o t a l where y true is the true value y true is the average of true value and y pred is the observed value historical data from the two surveillance scenarios were labelled producing a total of 4368 labels employed for rainfall intensity estimation 1d cnn model training the dataset is divided into a training dataset 70 and a validation dataset 30 we implemented the proposed 1d cnn model on a 64 bit windows 10 pro for workstations operating system a nvidia geforce gtx2080ti graphics card equipped with 11 gb gddr6 memory was used for training to ensure the smooth operation of the experiments keras tensorflow was employed as a deep learning framework after a large number of training attempts we found that the 1d cnn model was optimally trained with an epoch of 100 and a batch size of 10 as shown in fig 12 which took a total of 305 s 5 2 3 metrics of rainfall estimation the mean absolute error mae of rainfall intensity r e ri and the relative error of cumulative rainfall r e cr are employed as the metrics the r e ri and r e cr can be calculated as 11 r e ri 1 n i 1 n r i i r i i r i i 100 12 r e cr 1 n i 1 n c r i c r i c r i 100 where r i i is the i t h ri reading of the electronic rain gauge r i i is the i t h ri estimated using various regression algorithms c r i is the i t h cr reading of the electronic rain gauge and c r i is the i t h cr calculated using various regression algorithms 5 2 4 results and analysis to validate the effectiveness of the proposed cnn mapping algorithm five classical regression algorithms namely a decision tree dt hastie et al 2009 pedregosa et al 2011 random forest rf breiman 2001 linear support vector classification svc l pedregosa et al 2011 c support vector classification with a poly kernel svc p platt 1999 and ridge regression model ridge r pedregosa et al 2011 were used for comparison the input features of our proposed cnn algorithm introduced in section 4 were also fed into the above comparison methods for training and testing the experimental results of the two cameras in terms of ri and cr are shown in figs 13 and 14 as shown in figs 13 and 14 the ri values estimated by the six regression algorithms generally agree with the trend of the rain gauge readings however the accuracy of the ri values estimated by the different methods varies widely it can be observed that the statistical values of rain streaks extracted from the nir surveillance videos are positively correlated with ri similar to the findings of bossu et al 2011 who used visible cameras to obtain rainy videos the r e ri and r e cr values estimated by the different regression algorithms are shown in tables 4 and 5 respectively for the rainfall event on 2021 3 20 the higher ri from 00 03 to 00 45 can be considered a heavy rainfall scenario in contrast the lower ri from 00 45 01 45 can be considered a light rainfall scenario the performance of each method during the above two rainfall scenarios is also subsequently listed eq 12 shows that the cumulative error in the r e cr values is highly likely to increase as the rainfall event continues jiang et al 2019 hence the estimated and verified cr values at 00 45 were reset to 0 in table 5 the experimental results illustrate that 1 as shown in table 4 during all listed rainfall events the r e ri estimated is 18 12 to 168 67 for the dt algorithm 6 93 to 105 01 for the rf algorithm 37 25 to 86 45 for the svc p algorithm 58 76 to 86 33 for the svc l algorithm 13 59 to 128 18 for the ridge r algorithm and 8 86 to 84 84 for our proposed cnn algorithm furthermore the proposed cnn method achieves optimal ri estimation performance on the surveillance scenario obtained by camera 2 however for surveillance scenario 1 our cnn method is not optimal during rainfall event 1 and heavy rainfall scenarios rainfall 2 1 in general our cnn method achieves robust performance which can be considered the optimal ri value mapping choice 2 in table 5 the r e cr estimated is 3 02 to 56 45 for the dt algorithm 1 13 to 77 47 for the rf algorithm 18 99 to 80 51 for the svc p 51 15 to 82 40 for the svc l algorithm 2 53 to 91 85 for the ridge r algorithm and 7 82 to 30 70 for our proposed cnn method our cnn achieves the optimal performance in surveillance scenario 2 obtained by camera 2 while achieving a relatively good performance in scenario 1 these results suggest that the proposed cnn algorithm can invert the accumulated rainfall with stability and high accuracy 3 quantitatively for the proposed cnn model table 4 and table 5 illustrate that the optimal r e ri estimated using camera 1 is lower than that using camera 2 by approximately 51 23 within rainfall event 1 and 32 27 for rainfall event 2 moreover it can be observed in fig 13 that the cr estimated by our proposed cnn in surveillance scenario 1 is lower than the electric rain gauge readings but higher in surveillance scenario 2 the main reasons for these are the different light environments of the two surveillance scenarios as shown in fig 11 the contrast ratio of the rain streaks in camera 2 is more obvious which is more conducive to the rain streak extraction and rainfall estimation according to these findings cameras with different parameters influence the accuracy of rainfall measurements we prefer to use nir cameras that can capture rain streaks with a clear and high contrast ratio 4 for both camera 1 and camera 2 the r e ri estimated by the six algorithms become larger during the light rain scenarios the raindrop size in drizzle or light rainfall events is usually smaller than that of heavy rainfall please take fig 22 in appendix 2 as reference as mentioned in section 2 1 the larger the raindrop is the more concentrated the light scattering and the smaller the scattering angle in summary we conclude that the small raindrops in drizzle rainfall scenarios forward scatter less nir light at a larger scattering angle making it difficult to find rain streaks in nir surveillance videos with lower image quality moreover fig 11 reveals the presence of interference light in the background of the two surveillance scenarios under the interference of light in the background the contrast of the rain streak is reduced and rain streak detection becomes more difficult unlike the ideal environment this is common in real surveillance scenarios 5 3 discussion 5 3 1 uncertainty and analysis in recent years vrg has gained increasing interest the most advanced vrg provides rainfall estimates with a mean absolute percentage error ranging between 13 5 and 21 9 despite the influence of yin et al 2022 and despite the complex backgrounds containing many disturbances e g moving vehicles swaying trees and the impact of wind while that of our proposed nir vrg ranges between 7 82 and 30 7 in surveillance scenario 2 this value is raised to 7 82 and 12 03 it can be considered that vrg and nir vrg achieve comparable accuracy for rainfall estimation thanks to the ability of the surveillance cameras to automatically switch whether the visible or nir video is acquired according to the lighting conditions the vrg and nir vrg can complement each other providing an important basis for producing surveillance camera based all weather rainfall products we attribute the outperformance of our ri estimation to i the rain streak extraction algorithm achieving robust performance in real surveillance scenarios ii the 1d cnn model having a strong generalization ability which can mine the relationship between rain streaks and the ri value with high precision under the conditions of the training dataset and iii a large amount of training data are derived from the historical data of the two surveillance scenes used for testing containing sufficient diverse samples of complex changes in the surveillance scenarios accurate rain streak extraction is the basis of vrg and nir vrg previous studies have indicated that wind mutual occlusion between rain streaks in heavy violent rain scenes jiang et al 2019 wang et al 2022 and the appearance of moving objects tan et al 2018 are the leading causes of vrg accuracy degradation for nir vrg in addition to the factors mentioned above wind water vapour particles insects in section 3 2 and the presence of moving lighting objects e g headlights of moving vehicles in nir surveillance scenarios have also been suggested as significant causes of rain streak extraction errors taking rainfall event 1 as an example we can see from fig 13 that between 22 36 and 22 39 nir vrg overestimates the ri by reviewing the surveillance videos we believe that the presence of lighting moving targets significantly contributed to this phenomenon specifically as shown in fig 15 we select two cases of moving objects that appear in surveillance scenario 2 during rainfall 1 in fig 15 a at 22 38 an electric bicycle travels in the surveillance area and the light from its headlights seriously interferes with rain streaking extraction fig 13 indicates that ri is significantly overestimated in corresponding periods however at 22 40 in fig 15 b the appearance of a pedestrian with an umbrella has little effect on the extraction of the rain streaks and nir vrg achieved a high ri estimation accuracy in the corresponding periods these shortcomings of nir vrg require better solutions in the future 5 3 2 deployment in real applications in our experiments two surveillance cameras using the same 1d cnn regression model ensure the accuracy of the estimation results in practical applications this mechanism can be implemented continuously however configuring a separate cnn model for each camera or several cameras with similar surveillance scenarios is still a considerable workload for widespread and dense surveillance videos we suggest that training a common cnn model for cameras with similar light spaces is an effective option to alleviate the above problem here two prerequisites need to be considered i the lighting conditions and ii the parameters of cameras lighting conditions affect the visual characteristics of raindrops determining whether they can be detected and extracted by the proposed rain streak extraction model meanwhile the analysis in section 2 2 indicates that the camera s parameters determine the representation and capture ability of rainfall by nir video assuming consistent lighting conditions for the surveillance scenarios there is a difference between images of the same raindrop captured by cameras with different parameters wang et al 2022 as shown in fig 16 the exact raindrop image sizes differ between small and large svor cameras there is a difference in the representation of the same falling raindrop by surveillance cameras with different svor values which is likely to affect the accuracy of the proposed 1d cnn rainfall intensity calculation when the difference is large as described in section 2 1 the svor value of a camera is mainly determined by a combination of parameters such as the camera lens lens focus length and the size of the active area of the imaging sensor therefore under the premise that the camera s nir video has sufficient sensing capability for rainfall events discussed in section 2 2 sharing the same 1d cnn model is recommended where the lighting conditions of the surveillance area and the main parameters of the cameras do not differ significantly such as the two cameras used in this study for the user the svor values of surveillance cameras with similar lighting conditions can be evaluated by eqs 2 and 3 or eq 1 in wang et al 2022 after the relevant hardware parameters have already been checked in the manual book of the surveillance camera a common 1d cnn model can then be trained tested and deployed in the observation network formed by these cameras the rain streaks of the same raindrops are likely different in different surveillance light environments inspired by the meteorological based vrgs allamano et al 2015 jiang et al 2019 an alternative solution is to feed more rain streak information e g shape size brightness etc to the cnn in this way a more general and robust cnn model can be built to enhance the representation and distinction of different surveillance light environments 6 conclusion the potential of surveillance cameras providing high spatiotemporal resolution rainfall data has been of increasing appeal to many scholars however existing relevant studies have focused on rainfall observations during the day with little attention paid to observations at night the nir video obtained from an ordinary surveillance camera provides an opportunity for all weather rainfall observations in this paper we try to invert rainfall information using nir surveillance cameras after a systematic theoretical analysis a tensor based algorithm for rain streak extraction was proposed and employed in nir surveillance videos then a 1d cnn regression algorithm was designed to map extracted rain streaks and ri the experimental results show that our method is able to invert rainfall information with high accuracy in terms of ri and cr our study allows a surveillance camera to obtain rainfall information at night enriching the current research on vrgs moreover our study provides a helpful supplement to develop a low cost all weather high resolution and ground based rainfall observation network our method suffers mainly from two limitations i the rain streak extraction model was optimized under the admm framework requiring high time and hardware costs and ii our nir vrg does not work well in light rainfall scenarios in the future developing a fast rain streak extraction algorithm and adding geometric information of extracted rain streaks to the input features to improve the reliability of the 1d cnn model will become our focus declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgements this research was funded by the national key r d program of china 2021yfe0112300 the national natural science foundation of china nsfc no 41771420 no 41801305 and no 41971364 the state scholarship fund from the china scholarship council csc no 202006860047 and no 201906860035 the postgraduate research and practice innovation program of jiangsu province no kycx20 1180 and a project funded by the priority academic program development of jiangsu higher education institutions no 164320h116 appendix a acronyms and definitions acronym meaning admm alternating direction method of multipliers cnn convolutional neural network cr cumulative rainfall cv computer vision dsd probability distribution of raindrop size distribution fov field of view nir near infrared light nir vrgs surveillance video based rain gauges in near infrared light ri rainfall intensity svor spatial volume of rainfall svor perceived by cameras vrgs surveillance video based rain gauges in visible light appendix 2 microphysical and meteorological properties of raindrops a shape of raindrops the equilibrium shape of falling raindrops is determined by a balance of hydrostatic surface tension and aerodynamic forces beard 1976 beard and chuang 1987 the shape of a drop can be expressed as a function of its size there has been considerable discussion about the raindrop shape models including the pruppacher pitter model pruppacher and pitter 1971 beard chuang model beard and chuang 1987 and approximate ellipsoidal model ross and bradley 2002 the vertical section area of the b c model drops can be calculated from the following 2 1 r θ a 0 1 n 0 10 c n cos n θ where r θ is the magnitude of the radius vector to a point on the drop surface with respect to the angle θ in mm a 0 is the equivalent radius of the raindrop in mm and c n represents the shape coefficient fig 21 shows the shapes of raindrops of various sizes calculated using eq 2 1 existing studies ross and bradley 2002 xichuan et al 2013 give the comparison results between the b c model and the actual drop shapes that is the approximate ellipsoid model is close to the actual raindrop shape hence we use the b c model to fit the shape of raindrops in the following parts b raindrop size distribution the probability distribution of raindrop size distribution dsd can be an exponential gamma or marshall palmer distribution k ufre mfon et al 2015 and the gamma distribution was found to be more reasonable in describing the characteristics of dsd for both small and large particle diameters han et al 2021 the gamma distribution of the dsd is as follows 2 2 n d n 0 d μ e λ d where n d is the number of raindrops in the sampling volume whose diameter is d μ is the shape parameter n 0 is the intercept parameter and λ is the slope parameter in this study the gamma distribution was employed as the dsd function in the following analysis fig 22 shows the dsd in different rainfall intensity scenarios existing studies wen et al 2019 indicate that the raindrop size is within 0 5 6 mm in diameter and generally not more than 6 mm hence in fig 22 only 0 5 d 6 is considered c raindrop terminal velocity the terminal velocity of a raindrop is also related to its size which can be well approximated by the empirical formulas of raindrop diameter beard 1976 the most popular formula in a standard atmosphere of 1013 hpa is given by 2 3 v d 9 65 10 3 e 0 6 d where v d is the terminal velocity of a raindrop in m s dependent on d which is the droplet diameter equivalent to d in mm in eq 2 2 d scattering properties of raindrops in visible light garg and nayar 2005 used geometric optics methods to analyse the scattering properties of raindrops at visible wavelengths and pointed out that raindrops refract light from a large solid angle the field of view fov of raindrops is approximately 165 as shown in fig 23 b thus a raindrop distance from the camera z as shown in fig 23 a tends to be much brighter than its background fig 23 e the brightness of raindrops does not depend strongly on their background garg and nayar 2005 thus the intensity of each pixel value of a rain streak is approximately the same as shown in fig 23 c and d the intensity values of the pixels i r 1 i r 2 i r 3 i r 4 i r 5 blurred by a raindrop are almost the same that is i r 1 i r 2 i r 3 i r 4 i r 5 appendix 3 the main parameters of surveillance cameras employed for simulation the alternating direction method of multipliers admm framework will be used to effectively solve the complicated unconstrained optimization problem eq 5 3 1 min r d s x t l α 1 dtv d 1 α 2 s 1 α 3 x 1 α 4 t 1 l s t d r s r x y o r t t o r l o r o b 0 the lagrange multiplier of eq 3 1 is as follows 3 2 l β α 1 dtv d 1 α 2 s 1 α 3 x 1 α 4 t 1 l β 1 2 d r κ 1 β 1 f 2 β 2 2 s r κ 2 β 2 f 2 β 3 2 x y o r κ 3 β 3 f 2 β 4 2 t t o r κ 4 β 4 f 2 β 5 2 l o r κ 5 β 5 f 2 where κ κ 1 κ 2 κ 5 are lagrangian multipliers and β β 1 β 2 β 5 are positive parameters minimizing l β over r d s t and l leads to subproblems whose solutions can be efficiently obtained using simple numerical methods as presented below a d subproblem 3 3 min d α 1 dtv d 1 β 1 2 d r κ 1 β 1 f 2 b s x t subproblems 3 3 min s α 2 s 1 β 2 2 r s κ 2 β 2 f 2 which has a closed form solution using soft thresholding 3 4 s t 1 s h r i n k α 2 β 2 r t κ 2 t β 2 here the tensor nonnegative soft thresholding operator shrin k α β is defined as 3 5 shrin k α β x s i g n x max x α β 0 therefore analogous to the s subproblem 10 3 6 x t 1 s h r i n k α 3 β 3 y o r t κ 3 t β 3 3 7 t t 1 s h r i n k α 4 β 4 t o r t κ 4 t β 4 c l subproblem 3 8 min l l β 5 2 o r l κ 5 β 5 f 2 in this study we adopt the tensor nuclear norm definition as l i 1 n x i x i u n f o l d i x then l can be undated as 3 9 l t 1 i 1 3 1 3 f o l d i l i t 1 where l i t 1 ƛ 1 β 5 b i t κ i t β 5 and ƛ 1 β 5 x indicate the soft thresholding to the singular values of x d r subproblem 3 10 min r β 1 2 r d f 2 β 2 2 r s f 2 β 3 2 x y o r κ 3 β 3 f 2 β 4 2 t t o r κ 4 β 4 f 2 β 5 2 l o r κ 5 β 5 f 2 which has the following closed form solution 3 11 r t 1 f 1 f w 1 f w 2 where f and f 1 denote the fast fourier transform and its inverse 3 12 w 1 β 1 d t 1 κ 1 t β 2 s t 1 κ 2 t y t β 3 y o β 3 x t 1 κ 3 t t t β 4 t o β 4 t t 1 κ 4 t β 5 o l t 1 κ 5 t 3 13 w 2 1 β 1 β 2 i β 3 y t y β 4 t t t e κ update 3 14 κ 1 t 1 κ 1 t β 1 r t 1 d t 1 κ 2 t 1 κ 2 t β 2 r t 1 s t 1 κ 3 t 1 κ 3 t β 3 y o r t 1 x t 1 κ 4 t 1 κ 4 t β 4 t o r t 1 t t 1 κ 5 t 1 κ 5 t β 5 o r t 1 l t 1 the proposed algorithm for rain streak extraction detection in nir videos can be summarized by algorithm 1 algorithm 1 rain streak extraction detection appendix 4 the main parameters of surveillance cameras employed for simulation 
2210,widespread surveillance cameras that continuously record rainfall information offer an opportunity for high spatiotemporal resolution rainfall inversion surveillance video based rainfall data estimation has become one of the most promising methods however existing relevant studies have focused on rainfall observations during the day little attention has been given to developing a surveillance camera based rain gauge that works at night generally ordinary surveillance cameras actively emit near infrared light nir to supplement the insufficient illumination of a surveillance scenario providing an essential prerequisite for rainfall observations at night in this paper an nir surveillance video based rain gauge nir vrg was constructed first combining the meteorological and microphysical characteristics of raindrops with the camera imaging principle the abilities of different nir surveillance cameras to capture raindrops during different rainfall scenarios were discussed providing the theoretical basis for subsequent work second a tensor based algorithm was proposed for rain streak extraction from nir surveillance video and finally a one dimensional convolutional neural network 1d cnn based regression algorithm was proposed and used to build a mapping relationship between the extracted rain streaks and the rainfall intensity ri experimental results on synthetic rainy videos showed that the proposed rain streak extraction algorithm achieves robust performance in a light breeze speed approximately 3 m s and still works in a gentle breeze speed approximately 5 m s moreover experiments during various rainfall scenarios show that the designed nir vrg measures rainfall information with high accuracy the relative error of the ri and cumulative rainfall ranged from 8 86 to 84 84 and 7 82 to 30 70 respectively the nir vrg fills the gap of rainfall observations at night by using surveillance cameras and provides a reference for constructing an all weather rainfall observation network keywords rainfall observation surveillance camera near infrared light video all weather convolutional neural network data availability data will be made available on request 1 introduction rainfall data with high spatiotemporal resolution are of great value in the meteorology hydrology global warming and urban disaster monitoring fields xiao et al 2018 under the dual effect of global climate change and rapid urbanization urban heat island and rain island effects frequently occur min et al 2011 with the rainfall in urban areas presenting high degrees of randomness and complexity current rainfall observation systems including ground based rain gauges kathiravelu et al 2016 kidd et al 2017 and remote sensing based radar or satellites brunetti et al 2018 zorzetto and marani 2020 however have difficulty producing rainfall data with relatively high resolution to meet these needs mccabe et al 2017 njue et al 2019 therefore developing a high resolution low cost ground level rainfall monitoring network has become a research hotspot in hydrology and meteorology related fields in recent years exploring alternative means of rainfall sensing has become a popular topic videos from surveillance cameras allamano et al 2015 garg and nayar 2004 garg and nayar 2007 jiang et al 2019 audio recordings from smartphones on rainy days guo et al 2018 the signal strength of commercial cellular communication networks barthès and mallet 2013 and windshield wiper motion patterns or optical sensor readings in moving vehicles rabiei et al 2016 have been discussed as alternative rainfall information indicators in contrast surveillance video based rain gauges vrgs 1 1 acronyms and definitions in this study can be found in appendix 1 have the following advantages i densely distributed surveillance cameras provide a hardware basis for high spatial resolution rainfall observations ii the rapid transmission processing and interpretation of surveillance videos offer software support for high temporal resolution rainfall measurements iii vrgs can be implemented on existing city surveillance resources which greatly reduces maintenance and implantation costs existing studies have demonstrated the potential for surveillance cameras to act as low cost weather stations mccabe et al 2017 njue et al 2019 and a state of the art study jiang et al 2019 achieved a mean absolute percentage error of 21 8 performance which further promotes the deployment of vrg networks in practical applications in summary ordinary surveillance video camera based rainfall estimation has become one of the most promising rainfall estimation methods jiang et al 2019 mccabe et al 2017 however existing studies have mainly explored visible light video acquired during the daytime allamano et al 2015 dong et al 2017 garg and nayar 2004 garg and nayar 2007 haurum et al 2019 jiang et al 2019 zen et al 2019 with little development and discussion of vrgs working operating at night the damage caused by disasters induced by rainfall events at night is usually worse than that during the day hence the perception of rainfall at night is also essential currently ordinary surveillance cameras are usually equipped with near infrared nir lamps ariff et al 2015 under low visibility scenarios e g at night these cameras actively emit nir light to provide an additional light supplement thus enabling them to capture target objects the low visibility environment perception ability of surveillance cameras makes it possible for vrgs to continue working at night the development of nir surveillance video based rain gauges nir vrgs has become our focus the main contributions of this study are as follows i the meteorological and microphysical knowledge of raindrops was combined with the nir camera s imaging principle and the ability of nir surveillance video to capture raindrops with different diameters was proven which provides the theoretical basis for accurate rainfall inversion ii taking the influencing factors wind water vapour particles insects etc into account a tensor based rain streak extraction algorithm was proposed for nir surveillance videos after a comprehensive analysis of the sparsity of rain streaks in nir videos and the low rank property of a rain free background iii a one dimensional convolutional neural network 1d cnn based regression algorithm was used to build the mapping relationship between the extracted rain streaks and the rainfall intensity to the best of our knowledge this is the first attempt to apply nir surveillance video for rainfall estimation our research makes up for the shortcomings of current vrgs which can only work during the day and provides support for obtaining all weather high spatiotemporal resolution rainfall data the rest of this paper is organized as follows following this introduction we present the images of raindrops in nir surveillance cameras in section 2 to theoretically explore the ability of nir surveillance cameras to perceive rainfall events we explain our improved rain streak extraction algorithm in section 3 and the ri estimation network in section 4 finally we discuss the experimental results in section 5 and conclude in section 6 2 near infrared surveillance cameras and rain on rainy days the video image pixels blurred by high speed falling raindrops are often shown as lines called rain streaks garg and nayar 2004 garg and nayar 2007 raindrops are the basic elements of rainfall events and the size and distribution of raindrops reflect the intensity and process of rainfall the speed of natural falling raindrops varies with size during the camera exposure interval a nir video camera is assumed to capture only the low speed raindrops and fails to track those at high speed which would lead to an underestimation of rainfall moreover complete sharp rain streaks in images videos during rainfall scenarios are crucial for the inversion of rainfall information rainfall intensity ri or cumulative rainfall cr hence whether a nir video camera able to capture rain streaks of any sized falling raindrops is our first concern in addition whether the rain streaks obtained by the nir video can reflect the dynamic changes in rainfall is our second concern therefore the ability of nir surveillance cameras 2 2 it should be noted that all of the surveillance cameras in this study operate based on the pinhole imaging principle to capture rainfall events rain particles is an important issue to verify and discuss existing studies have indicated that the shape size and velocity of raindrops are important to the calculation of the scattering properties of raindrops at nir light wavelengths guo et al 2015 xi chuan et al 2010 in this section the imaging patterns of raindrops at nir wavelengths are presented in section 2 1 then the possibility of raindrops being captured by different types of surveillance cameras during various rainfall scenarios is discussed in section 2 2 and a brief introduction to the microphysical properties and meteorological knowledge of rain particles can be found in appendix 2 2 1 scattering properties of raindrops the scattering properties of raindrops depend mainly on the wavelength dependent refractive index and geometry wei et al 2021 for spherical atmospheric particulate matter fog haze raindrops etc scattering can be divided into three categories rayleigh scattering mie scattering and unselected scattering wetzel 1990 however when a raindrop is larger than 1 mm its shape is not ideally spherical and differs from the typical spherical model as shown in fig 21 in appendix 2 resulting in certain computational errors in the scattering calculation usually the raindrop size is much larger than the wavelengths of visible or nir light the nir wavelength is typically between 780 nm and 1000 nm for surveillance cameras in this case the rayleigh and mie scattering theories do not work properly because the dimensionless scale parameter of raindrops is much larger than 100 li et al 2015 geometric optical scattering methods are the most popular choice guo et al 2015 ross and bradley 2002 wei et al 2021 xi chuan et al 2010 from a geometric optics viewpoint scattered light amplitude is considered to be the superposition of the diffracted refracted and reflected fractions xu et al 2004 we briefly describe the scattering properties of raindrops in visible light in appendix 2 in contrast to visible light in nir light over 90 of the scattering energy of raindrops is forward scattered hulst and van de hulst 1981 moreover the geometric scattering of raindrops is mainly centralized in the forward direction at 0 60 and quite weak at other angles guo et al 2015 li et al 2007 xu et al 2004 specifically fig 1 a shows a raindrop captured by an nir surveillance camera as shown in fig 1 b a raindrop with a 1 5 mm diameter is taken as an example a 1 5 m m the parallel polarization direction is mainly centralized in the forward 0 30 direction but less in other scattering angles the reflection in the perpendicular polarization direction is mainly centralized in the forward direction at 0 60 guo et al 2015 the larger the raindrop is the more concentrated the light scattering and the smaller the scattering angle that is the forward scattering light affected by the incident angle has a significant influence on the imaging of raindrops considering that a surveillance camera is often stationary the position of the infrared transmitter is constant the incident angle of nir light changes during raindrop fall therefore as shown in fig 1 c and d the intensity values of the pixels i r 1 i r 2 i r 3 i r 4 i r 5 blurred by a raindrop may vary rain streaks captured by an nir surveillance camera may be uneven as shown in fig 1 e existing rain streak extraction algorithms designed based on the consistency of grey values of raindrop blurred pixels are no longer applicable in nir vrgs these scattering properties are very important for the design of rain streak extraction algorithms in ideal rainfall scenarios the brightness of a raindrop at both visible and nir wavelengths is not affected by other raindrops garg and nayar 2004 garg and nayar 2007 xichuan et al 2013 the rainfall scattering corresponds to a linear superposition of the scattering of all raindrops in the sampled volume in summary nir surveillance videos can record raindrop information to some extent and the imaging of raindrops is influenced by the relative position and size of the rain particles 2 2 probability of raindrops captured by camera for vrgs and nir vrgs raindrops appear in the form of rain streaks sharp and complete rain streaks are important prerequisites for rainfall information interpretation dong et al 2017 jiang et al 2019 in both visible and nir cameras objects appear sharp within a certain range near the focus distance that is the range between the near focus distance point and far focus distance point of acceptable sharpness allamano et al 2015 jiang et al 2019 as shown in fig 2 a the range mentioned above can be defined as the spatial volume of rainfall svor perceived by cameras as shown in fig 2 a the prism formed by the plane between the near focus point and far focus point labelled by solid red orange lines note that the svor refers to the estimated volume in garg and nayar 2005 the sampling volume in allamano et al 2015 and the depth of field in jiang et al 2019 however nir surveillance cameras capture images videos using actively emitted nir light and the svor will be affected by the sensing range of the equipped nir transmitter furthermore differences in the lighting environment of the surveillance scenarios can also result in the actual svor being less than the theoretical value by varying degrees for an ordinary surveillance camera to save resources and ensure the maximum surveillance range at night the nir sensing range is usually designed to be approximately equal to the theoretical value of the field of view fov therefore surveillance cameras with different parameters usually have various nir light sensing ranges as shown in fig 2 b typically the svor of the cameras in fig 2 b will be most affected by the lens focus length f when the other configurations are the same or do not differ much meaning that f c a m e r a 1 f c a m e r a 2 f c a m e r a 3 f c a m e r a 4 in fig 2 b nir cameras with different parameters usually have different svor values and different nir sensing ranges the blur effect of raindrops within the svor is almost null outside the svor however the blur effect causes the size of raindrops to be overestimated next whether the raindrops within the svor can be captured by the camera is another important issue to be discussed taking fig 2 a as an example defining the vertical plane where a raindrop χ is located as the target plane the horizontal distance between χ and camera lens is l mm without considering the exposure interval of the nir transmitter the probability of a raindrop being completely captured can be expressed as liu et al 2014 1 p d l h l r 90 2 v d t exp v d t exp where t exp is the exposure time in ms r 90 is the size of the rain particle in the vertical direction which can be calculated using the b c model please see appendix 2 eq 2 1 v d represents the terminal speed of raindrops which can be obtained by using eq 2 3 in appendix 2 and h l is the vertical size of the target plane mm h l can be calculated as follows 2 h l h f l where h represents the horizontal size of the active area of the imaging sensor mm and is the focus length mm for the same raindrop same velocity the longer the falling trajectory within the svor the more likely it is to be captured considering the sharpness of the rain streaks the range of h l values depends on the distance of the near focus point and far focus point therefore the h l value should be set to h l near h l h l far the distance of the near focus point l near can be calculated using eq 3 3 l near d f f 2 f 2 n c p d f f l far d f f 2 f 2 n c p d f f where d f is the focus distance of the camera mm n is the f number of the lens relevant to the aperture diameter and c p is the maximum permissible circle of confusion mm details about the camera parameters can be found in jiang et al 2019 and allamano et al 2015 2 2 1 capture probability vs raindrop size raindrops with different sizes have different contributions to the ri calculation the ability of an nir camera to capture raindrops is the basis for exploring the ability of the camera to acquire rainfall information we first discuss the relationship between the captured probability p d l and raindrop size d taking the general surveillance camera parameters as input t exp was set to 20 25 30 and 35 and h l was set to 400 500 600 and 700 simulation results can be found in fig 3 fig 3 shows that as h l increases p d l also becomes larger under the same t exp indicating that the camera is becoming more efficient in capturing raindrops in addition as t exp increases p d l decreases indicating that the camera is becoming less effective in capturing raindrops in conclusion p d l is positively correlated with h l and negatively correlated with t exp without loss of generality we take t exp 35 as an example to explore the relationship between h l and p d l the results are shown in fig 4 fig 4 illustrates that raindrops with larger sizes are less likely to be captured than smaller ones with the same nir camera an nir camera with a relatively large h l facilitates the capture of raindrops when h l 989 a camera with a t exp 35 was able to capture 100 of the raindrops of different sizes the h l near value of commercially available surveillance cameras is usually greater than 1000 mm that is conventional surveillance cameras are able to capture different sizes of naturally generated raindrops 2 2 2 capture probability vs rainfall intensity in this section we discuss the ability of nir cameras to capture raindrops during different rainfall scenarios ri is often used to identify different rainfall events considering that the raindrop size in real rainfall follows a gamma distribution n d as shown in eqs 2 2 in appendix 2 and the raindrop size is generally not more than 6 mm the average probability of raindrops being captured during various rainfall events can be defined using eq 4 4 a v e probability 0 6 p d l n d d d 0 6 n d d d we compared a v e probability during different rainfall scenarios in fig 5 for comparison purposes in fig 5 a we set t exp 35 and h l 600 in fig 5 b from fig 5 we can find that in general with the same camera an increase in ri leads to a decrease in a v e probability combined with fig 4 we can learn that general surveillance cameras are able to capture all raindrops comprehensively when h l is large enough moreover we take ordinary surveillance cameras available on the market as simulation objects the camera parameters as shown in appendix 4 the simulation results show that a common surveillance camera is able to capture 100 of the comprehensive rain streaks during various rainfall scenarios ri can be used for cr calculation according to the definition ri can be calculated by obtaining all raindrops in a unit space although the svor of the nir surveillance camera is unknown the volumetric value of svor can be considered to be a stable constant because the surveillance cameras are usually fixed and the surveillance scenes are highly consistent in other words if nir video can capture different sizes raindrops it can calculate the ri and cr the nir surveillance camera that meets the above conditions is capable of inverting the rainfall dynamics the above analyses show that nir videos obtained by ordinary surveillance cameras satisfy these conditions and are feasible for calculating rainfall information 3 rain streak extraction how to accurately extract rain steaks is the first task of an nir vrg the rain streak extraction model aims at separating rain streaks and clean video from the input rainy video jiang et al 2018 the rainy video o r m n t can be modelled as a linear superimposition of the desired unknown video background b r m n t and the rain streaks r r m n t i e o b r decomposing the rain streaks r and the desired video background b is an ill posed inverse problem jiang et al 2017 jiang et al 2018 wang et al 2019a as described in section 2 the brightness of the rain streaks in nir video may be uneven some methods based on the premise of consistent rain streak brightness brewer and liu 2008 liu et al 2009 may no longer be applicable in nir videos in recent years tensor based approaches have been extensively studied for rain extraction removal from videos wang et al 2019b in this part a tensor based variational model for video rain streak detection is proposed as follows 5 min b r α 1 dtv r 1 α 2 r 1 α 3 y b 1 α 4 t b 1 r a n k b s t o r b r b 0 where dtv and y are the dtv and derivative operator along the rain streak direction and the perpendicular direction of the rain streaks respectively t indicates the time directional difference operator suppose tensor x r i 1 i 2 i n the mode k unfolding of tensor x is denoted as unflo d k x x k r i 1 i 2 i n and x f is the frobenius norm of tensor x the array of rank x rank x 1 rank x 2 rank x n is the n rank of tensor x please refer to kolda and bader 2009 for an extensive overview 3 1 rain streak modelling rain streaks maintain similarity and repeatability in nir surveillance video as shown in fig 6 a the direction of the rain streaks is vertical by default in our rain streaks extraction algorithm in realistic scenarios mainly due to the influence of wind the falling direction of raindrops is not vertical as shown in fig 6 b for example sieck et al 2007 demonstrated that wind with a speed of 3 m s would result in a rainfall inclination angle of 15 when larger inclination angles are encountered the performance of rain streak detection will decline jiang et al 2019 jiang et al 2018 different methods for determining the angles of rain streaks have been proposed to mitigate the interference of wind on the performance of rain streak identification du et al 2018 kolda and bader 2009 sun et al 2019 based on extensive analyses and observations this study assumes that rain streaks are always in the same direction within one video frame inspired by sun et al 2019 and kolda and bader 2009 from the derivative domain dtv r 1 kongskov et al 2019 are adopted to calculate the image derivatives along the rain streak direction to model the sparsity of rain streaks under the assumption that the magnitudes of rain streaks are commonly sparse the l1 norm regularizer r 1 is employed to model the sparsity of rain streaks in the spatial domain additionally in real applications insects attracted by infrared light flying around the camera lens as shown in fig 6 c the motion imaging of water vapour particles on rainy days as shown in fig 6 d and waving tree leaves in wind bring new challenges to the distinction of rain streaks in nir video the appearance of rain streaks is always piecewise smooth along the perpendicular direction of rain streaks jiang et al 2017 sun et al 2019 although rain streaks appear inclined due to the influence of wind the above conclusions remain valid extensive observations and analysis have revealed that insects and water vapour particles are primarily in the shape of dotted spots such as circles or ellipses modelling the sparsity of rain streaks is an important means of distinguishing between rain streaks insects and water vapour particles in nir surveillance videos furthermore the spatiotemporal properties of the background in section 3 2 are employed to represent rain streaks in the above complex scenarios 3 2 background modelling compared to surveillance video during the day despite the interference mentioned before the background of nir surveillance video scenarios during the night is more homogeneous primarily black the spatial and temporal self similarities between any two consecutive frames are strong similar to natural images in visible light nir images can also be well distributed as a laplacian distribution in spatial and temporal directions liu et al 2014 sun et al 2019 the tv regularizer is a suitable candidate for the assumption of a laplacian prior first a tv regularizer t b 1 is used to model the sparsity of video intensities in the temporal direction mining video features in the temporal dimension plays an important role in identifying regularly moving objects in the background such as waving leaves as mentioned before the appearance of rain streaks is always piecewise smooth along the perpendicular direction of rain streaks jiang et al 2017 the directional smoothness of the image was used to construct more robust rules for separating rain streaks from the background with various interfering factors e g water vapour particles insects to reduce the complexity and improve the real time of the model a tv regularizer y b 1 is employed to model the sparsity of video intensities in the vertical direction moreover nir surveillance videos taken by static cameras or with static backgrounds are always low rank combined with existing research cao et al 2016 jiang et al 2017 using the spatiotemporal coherences of video rank b is minimized to promote the decomposition of rain streaks and background in our model we used the alternating direction method of multipliers admm framework to solve eq 5 for the rain streak extraction task from the nir video the details can be found in appendix 3 4 rainfall intensity estimation as a common variable utilized to describe the characteristics of rainfall events in meteorology ri is defined as the ratio of the total amount of rain rainfall depth falling during a given period to the duration of the period it is expressed in depth units per unit time usually as mm per hour mm h according to its definition the ri value can be estimated based on the size and speed of all identified rain streaks within the svor we refer to this mapping method between rain streaks and ri as the meteorological based approach allamano et al 2015 garg and nayar 2007 jiang et al 2019 in contrast bossu et al 2011 tan et al 2018 haurum et al 2019 and zen et al 2019 derived a relative estimate of ri by counting the statistical values of rain streak pixels we refer to this mapping method between rain streaks and ri as the regression or fitting based approach for surveillance cameras usually at night when the brightness of the svor is below a previously set threshold the camera automatically enters nir mode most of the surveillance camera installations are fixed with a defined svor furthermore with fewer human activities at night the possibility of background anomalies in the background of the nir video is much lower than that of a video captured during the day hence an nir video has more substantial consistency and provides a favourable condition for mapping rain streaks and ri however for the meteorological based ri estimation mechanism one significant difficulty needs to be overcome the svor of nir surveillance cameras varies depending on the lighting conditions of the surveillance scenario calibration of the svor is essential and complex in practical applications in conclusion we use a regression based approach to estimate ri in recent years deep learning based methods have achieved great success in classification and regression problems in the computer vision cv and neuro linguistic programming nlp fields a 1d cnn based ri regression network was proposed as shown in fig 7 the proposed cnn network contains 6 convolutional blocks 3 fully connected layers and the last linear layer used as the output prediction each convolutional block consists of a 1d convolutional layer and a rectified linear unit relu xu et al 2015 layer we also add a batch normalization bn ioffe and szegedy 2015 layer after relu activation in the second and fourth convolutional blocks to normalize the input features by adjusting and scaling the activations the proposed 1d cnn takes the rain streaks extracted by eq 5 in section 3 as input and the outputs are the corresponding rainfall intensity values after the rain streaks r i of frame i were extracted the sum of rain pixels in all frames within 1 s was regarded as an indicator of ri which can be expressed by 6 s u m p i x e l i 1 t r i where t is the frame rate to reduce the interference of wind and other influencing factors similar to the operator in allamano et al 2015 dong et al 2017 and jiang et al 2019 we take the average value of s u m p i x e l every 10 s to represent the ri in the current time period which can be calculated as follows 7 a ve pixel 1 10 j 1 10 s u m p i x e l j hence the feature dimension sizes of the input data are 6 1 as shown in fig 8 5 experiments and results 5 1 evaluation of the rain streaks extraction algorithm 5 1 1 experimental setup due to the complexity and difficulty of obtaining rain streaks in different directions from real surveillance videos we use synthetic data to validate the effectiveness and efficiency of the rain streak detection algorithm additionally after numerical experiments the regularization parameters α 1 α 2 α 3 α 4 α 5 were manually selected from 10 1 10 2 10 3 and β 1 β 2 β 3 β 4 β 5 were set to 55 details of these parameters can be found in section 3 2 the details of the parameter settings of the rain streak extraction algorithm are shown in table 1 these parameters are used in the real scenario experiments in section 5 2 for synthetic data since the ground truth of rain streaks is available we use a black background to simulate the nir surveillance scenario named nir we have added similar pixels of water vapour particles and insects to the nir videos which are named water vapour particles and insects respectively typically visible rainfall videos often have more complex backgrounds than nir videos since it is difficult to add various moving backgrounds to nir videos we use visible rainfall videos to investigate the effect of moving targets on our rain streak extraction algorithm three classical videos named waterfall girl and highway were selected as the ground truth background videos 3 3 https trace eas asu edu yuv different from waterfall there are moving objects in the background of girl and highway various types i e direction and intensity of rain streaks were added to the background videos using the photoshop software whose degrees of rain streaks ranged from 0 to 45 in 15 intervals corresponding to tiny drizzling to heavy rainfall the synthetic heavy rainfall scenarios with a 45 inclination and the rain streak extraction results are shown in table 2 since the ground truth videos without rain streaks are known we can quantitatively compare all competing scenarios videos the gradient magnitude similarity deviation gmsd xue et al 2013 is commonly used to measure the pixelwise gradient magnitude similarity between the original image i e the true rain streak image and the reproduced image i e the identified rain streak image jiang et al 2019 the higher the gmsd score is the larger the distortion range xue et al 2013 the gmsd was employed as the index for rain streak detection quality assessment in this study the total gmsd for each video is obtained from the averaged gmsd values of all the frames 5 1 2 results and analysis the distribution of gmsd values among different rainfall scenarios is shown in fig 9 fig 9 illustrates that when the inclination angle of the rain streaks is between 0 and 15 the variation in gmsd values is slight and the performance of our proposed rain streak extraction algorithm is robust when the inclination angle of the rain streaks is within 15 and 30 the gmsd values increase to a certain extent and our proposed rain streak extraction algorithm still works however when the inclination angle of the rain streaks is between 30 and 45 the gmsd values increase rapidly and the accuracy of the proposed rain streak extraction algorithm decreases significantly the above conclusions are valid for both visible and nir videos suggesting that our rain streak extraction algorithm can also be applied to visible surveillance rainfall videos it is worth mentioning that relevant studies erpul et al 2003 helming 1999 sieck et al 2007 pointed out that the rainfall inclination angle is usually below 15 when the wind speed is less than 3 m s and the rainfall inclination angle is usually approximately 30 when the wind speed is approximately 5 m s it can be concluded that our proposed method is effective in breezy wind speed lower than 5 m s and rainy scenarios 5 2 evaluation of the rainfall estimation in real rainy scenarios 5 2 1 experimental setup in this section the performance of the ri and cr estimation in a real surveillance scenario are evaluated the experimental site is located at nanjing normal university nanjing city jiangsu province china as shown in fig 10 on may 08 and 20 2021 denoted as 2021 03 08 and 2021 03 21 two long term rainfall events occurred in the study area including a variety of rainfall types from light rain to heavy rain and these rainfall data were typical and representative for our research ground based rainfall observations are usually regarded as ground truth in meteorological and hydrological studies in this study the reading from a high precision electronic rain gauge zjc v zhejiang hengda instrument metre co ltd is regarded as the verification data the electronic rain gauge is a kind of siphon rain gauge capable of reporting rainfall information every 0 1 mm of cr or every minute the reading from the electronic rain gauge is regarded as the ri label considering the spatial and temporal variability of natural rainfall the distance between the surveillance cameras and the rain gauge is approximately 80 m to ensure the accuracy of the obtained ri labels two different scenarios were observed simultaneously to test the stability of rainfall estimation in different lighting environments as shown in fig 11 we denote the camera in scenario 1 as camera 1 and in scenario 2 as camera 2 in the subsequent discussion the parameters of the cameras are shown in table 3 moving targets were present in both surveillance scenarios including moving cars electric bicycles and pedestrians for example between 22 36 and 22 39 on 8 march a car and an electric bicycle with their lights on passed through two surveillance areas fig 10 shows that the rain streaks in surveillance scenario 1 are thinner and longer than those in surveillance scenario 2 moreover because of the different light environments of the background the rain streaks in surveillance scenario 2 are brighter and have a higher contrast ratio combined with eq 2 and table 3 the h l value of camera 1 is 1235 mm and that of camera 2 is 1624 mm according to eq 1 the capture probability for raindrops of different sizes by a camera can be obtained it can be concluded that in theory our experimental cameras can capture raindrops of different size during various rainfall intensity scenarios 5 2 2 1d cnn training details in our cnn model training the adaptive moment estimation admm kingma and ba 2014 was selected as the optimizer and the mean squared error mse was chosen as the loss function the coefficient of determination r 2 is a well known quantity in linear regression nagelkerke 1991 was employed as the metric to evaluate the performance a perfect match would result in r 2 1 which indicates that the model describes the data perfectly r 2 can be calculated by eq 10 8 redisual y true y pred 2 9 total y true y true 2 10 r 2 1 r e s i d u a l t o t a l where y true is the true value y true is the average of true value and y pred is the observed value historical data from the two surveillance scenarios were labelled producing a total of 4368 labels employed for rainfall intensity estimation 1d cnn model training the dataset is divided into a training dataset 70 and a validation dataset 30 we implemented the proposed 1d cnn model on a 64 bit windows 10 pro for workstations operating system a nvidia geforce gtx2080ti graphics card equipped with 11 gb gddr6 memory was used for training to ensure the smooth operation of the experiments keras tensorflow was employed as a deep learning framework after a large number of training attempts we found that the 1d cnn model was optimally trained with an epoch of 100 and a batch size of 10 as shown in fig 12 which took a total of 305 s 5 2 3 metrics of rainfall estimation the mean absolute error mae of rainfall intensity r e ri and the relative error of cumulative rainfall r e cr are employed as the metrics the r e ri and r e cr can be calculated as 11 r e ri 1 n i 1 n r i i r i i r i i 100 12 r e cr 1 n i 1 n c r i c r i c r i 100 where r i i is the i t h ri reading of the electronic rain gauge r i i is the i t h ri estimated using various regression algorithms c r i is the i t h cr reading of the electronic rain gauge and c r i is the i t h cr calculated using various regression algorithms 5 2 4 results and analysis to validate the effectiveness of the proposed cnn mapping algorithm five classical regression algorithms namely a decision tree dt hastie et al 2009 pedregosa et al 2011 random forest rf breiman 2001 linear support vector classification svc l pedregosa et al 2011 c support vector classification with a poly kernel svc p platt 1999 and ridge regression model ridge r pedregosa et al 2011 were used for comparison the input features of our proposed cnn algorithm introduced in section 4 were also fed into the above comparison methods for training and testing the experimental results of the two cameras in terms of ri and cr are shown in figs 13 and 14 as shown in figs 13 and 14 the ri values estimated by the six regression algorithms generally agree with the trend of the rain gauge readings however the accuracy of the ri values estimated by the different methods varies widely it can be observed that the statistical values of rain streaks extracted from the nir surveillance videos are positively correlated with ri similar to the findings of bossu et al 2011 who used visible cameras to obtain rainy videos the r e ri and r e cr values estimated by the different regression algorithms are shown in tables 4 and 5 respectively for the rainfall event on 2021 3 20 the higher ri from 00 03 to 00 45 can be considered a heavy rainfall scenario in contrast the lower ri from 00 45 01 45 can be considered a light rainfall scenario the performance of each method during the above two rainfall scenarios is also subsequently listed eq 12 shows that the cumulative error in the r e cr values is highly likely to increase as the rainfall event continues jiang et al 2019 hence the estimated and verified cr values at 00 45 were reset to 0 in table 5 the experimental results illustrate that 1 as shown in table 4 during all listed rainfall events the r e ri estimated is 18 12 to 168 67 for the dt algorithm 6 93 to 105 01 for the rf algorithm 37 25 to 86 45 for the svc p algorithm 58 76 to 86 33 for the svc l algorithm 13 59 to 128 18 for the ridge r algorithm and 8 86 to 84 84 for our proposed cnn algorithm furthermore the proposed cnn method achieves optimal ri estimation performance on the surveillance scenario obtained by camera 2 however for surveillance scenario 1 our cnn method is not optimal during rainfall event 1 and heavy rainfall scenarios rainfall 2 1 in general our cnn method achieves robust performance which can be considered the optimal ri value mapping choice 2 in table 5 the r e cr estimated is 3 02 to 56 45 for the dt algorithm 1 13 to 77 47 for the rf algorithm 18 99 to 80 51 for the svc p 51 15 to 82 40 for the svc l algorithm 2 53 to 91 85 for the ridge r algorithm and 7 82 to 30 70 for our proposed cnn method our cnn achieves the optimal performance in surveillance scenario 2 obtained by camera 2 while achieving a relatively good performance in scenario 1 these results suggest that the proposed cnn algorithm can invert the accumulated rainfall with stability and high accuracy 3 quantitatively for the proposed cnn model table 4 and table 5 illustrate that the optimal r e ri estimated using camera 1 is lower than that using camera 2 by approximately 51 23 within rainfall event 1 and 32 27 for rainfall event 2 moreover it can be observed in fig 13 that the cr estimated by our proposed cnn in surveillance scenario 1 is lower than the electric rain gauge readings but higher in surveillance scenario 2 the main reasons for these are the different light environments of the two surveillance scenarios as shown in fig 11 the contrast ratio of the rain streaks in camera 2 is more obvious which is more conducive to the rain streak extraction and rainfall estimation according to these findings cameras with different parameters influence the accuracy of rainfall measurements we prefer to use nir cameras that can capture rain streaks with a clear and high contrast ratio 4 for both camera 1 and camera 2 the r e ri estimated by the six algorithms become larger during the light rain scenarios the raindrop size in drizzle or light rainfall events is usually smaller than that of heavy rainfall please take fig 22 in appendix 2 as reference as mentioned in section 2 1 the larger the raindrop is the more concentrated the light scattering and the smaller the scattering angle in summary we conclude that the small raindrops in drizzle rainfall scenarios forward scatter less nir light at a larger scattering angle making it difficult to find rain streaks in nir surveillance videos with lower image quality moreover fig 11 reveals the presence of interference light in the background of the two surveillance scenarios under the interference of light in the background the contrast of the rain streak is reduced and rain streak detection becomes more difficult unlike the ideal environment this is common in real surveillance scenarios 5 3 discussion 5 3 1 uncertainty and analysis in recent years vrg has gained increasing interest the most advanced vrg provides rainfall estimates with a mean absolute percentage error ranging between 13 5 and 21 9 despite the influence of yin et al 2022 and despite the complex backgrounds containing many disturbances e g moving vehicles swaying trees and the impact of wind while that of our proposed nir vrg ranges between 7 82 and 30 7 in surveillance scenario 2 this value is raised to 7 82 and 12 03 it can be considered that vrg and nir vrg achieve comparable accuracy for rainfall estimation thanks to the ability of the surveillance cameras to automatically switch whether the visible or nir video is acquired according to the lighting conditions the vrg and nir vrg can complement each other providing an important basis for producing surveillance camera based all weather rainfall products we attribute the outperformance of our ri estimation to i the rain streak extraction algorithm achieving robust performance in real surveillance scenarios ii the 1d cnn model having a strong generalization ability which can mine the relationship between rain streaks and the ri value with high precision under the conditions of the training dataset and iii a large amount of training data are derived from the historical data of the two surveillance scenes used for testing containing sufficient diverse samples of complex changes in the surveillance scenarios accurate rain streak extraction is the basis of vrg and nir vrg previous studies have indicated that wind mutual occlusion between rain streaks in heavy violent rain scenes jiang et al 2019 wang et al 2022 and the appearance of moving objects tan et al 2018 are the leading causes of vrg accuracy degradation for nir vrg in addition to the factors mentioned above wind water vapour particles insects in section 3 2 and the presence of moving lighting objects e g headlights of moving vehicles in nir surveillance scenarios have also been suggested as significant causes of rain streak extraction errors taking rainfall event 1 as an example we can see from fig 13 that between 22 36 and 22 39 nir vrg overestimates the ri by reviewing the surveillance videos we believe that the presence of lighting moving targets significantly contributed to this phenomenon specifically as shown in fig 15 we select two cases of moving objects that appear in surveillance scenario 2 during rainfall 1 in fig 15 a at 22 38 an electric bicycle travels in the surveillance area and the light from its headlights seriously interferes with rain streaking extraction fig 13 indicates that ri is significantly overestimated in corresponding periods however at 22 40 in fig 15 b the appearance of a pedestrian with an umbrella has little effect on the extraction of the rain streaks and nir vrg achieved a high ri estimation accuracy in the corresponding periods these shortcomings of nir vrg require better solutions in the future 5 3 2 deployment in real applications in our experiments two surveillance cameras using the same 1d cnn regression model ensure the accuracy of the estimation results in practical applications this mechanism can be implemented continuously however configuring a separate cnn model for each camera or several cameras with similar surveillance scenarios is still a considerable workload for widespread and dense surveillance videos we suggest that training a common cnn model for cameras with similar light spaces is an effective option to alleviate the above problem here two prerequisites need to be considered i the lighting conditions and ii the parameters of cameras lighting conditions affect the visual characteristics of raindrops determining whether they can be detected and extracted by the proposed rain streak extraction model meanwhile the analysis in section 2 2 indicates that the camera s parameters determine the representation and capture ability of rainfall by nir video assuming consistent lighting conditions for the surveillance scenarios there is a difference between images of the same raindrop captured by cameras with different parameters wang et al 2022 as shown in fig 16 the exact raindrop image sizes differ between small and large svor cameras there is a difference in the representation of the same falling raindrop by surveillance cameras with different svor values which is likely to affect the accuracy of the proposed 1d cnn rainfall intensity calculation when the difference is large as described in section 2 1 the svor value of a camera is mainly determined by a combination of parameters such as the camera lens lens focus length and the size of the active area of the imaging sensor therefore under the premise that the camera s nir video has sufficient sensing capability for rainfall events discussed in section 2 2 sharing the same 1d cnn model is recommended where the lighting conditions of the surveillance area and the main parameters of the cameras do not differ significantly such as the two cameras used in this study for the user the svor values of surveillance cameras with similar lighting conditions can be evaluated by eqs 2 and 3 or eq 1 in wang et al 2022 after the relevant hardware parameters have already been checked in the manual book of the surveillance camera a common 1d cnn model can then be trained tested and deployed in the observation network formed by these cameras the rain streaks of the same raindrops are likely different in different surveillance light environments inspired by the meteorological based vrgs allamano et al 2015 jiang et al 2019 an alternative solution is to feed more rain streak information e g shape size brightness etc to the cnn in this way a more general and robust cnn model can be built to enhance the representation and distinction of different surveillance light environments 6 conclusion the potential of surveillance cameras providing high spatiotemporal resolution rainfall data has been of increasing appeal to many scholars however existing relevant studies have focused on rainfall observations during the day with little attention paid to observations at night the nir video obtained from an ordinary surveillance camera provides an opportunity for all weather rainfall observations in this paper we try to invert rainfall information using nir surveillance cameras after a systematic theoretical analysis a tensor based algorithm for rain streak extraction was proposed and employed in nir surveillance videos then a 1d cnn regression algorithm was designed to map extracted rain streaks and ri the experimental results show that our method is able to invert rainfall information with high accuracy in terms of ri and cr our study allows a surveillance camera to obtain rainfall information at night enriching the current research on vrgs moreover our study provides a helpful supplement to develop a low cost all weather high resolution and ground based rainfall observation network our method suffers mainly from two limitations i the rain streak extraction model was optimized under the admm framework requiring high time and hardware costs and ii our nir vrg does not work well in light rainfall scenarios in the future developing a fast rain streak extraction algorithm and adding geometric information of extracted rain streaks to the input features to improve the reliability of the 1d cnn model will become our focus declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgements this research was funded by the national key r d program of china 2021yfe0112300 the national natural science foundation of china nsfc no 41771420 no 41801305 and no 41971364 the state scholarship fund from the china scholarship council csc no 202006860047 and no 201906860035 the postgraduate research and practice innovation program of jiangsu province no kycx20 1180 and a project funded by the priority academic program development of jiangsu higher education institutions no 164320h116 appendix a acronyms and definitions acronym meaning admm alternating direction method of multipliers cnn convolutional neural network cr cumulative rainfall cv computer vision dsd probability distribution of raindrop size distribution fov field of view nir near infrared light nir vrgs surveillance video based rain gauges in near infrared light ri rainfall intensity svor spatial volume of rainfall svor perceived by cameras vrgs surveillance video based rain gauges in visible light appendix 2 microphysical and meteorological properties of raindrops a shape of raindrops the equilibrium shape of falling raindrops is determined by a balance of hydrostatic surface tension and aerodynamic forces beard 1976 beard and chuang 1987 the shape of a drop can be expressed as a function of its size there has been considerable discussion about the raindrop shape models including the pruppacher pitter model pruppacher and pitter 1971 beard chuang model beard and chuang 1987 and approximate ellipsoidal model ross and bradley 2002 the vertical section area of the b c model drops can be calculated from the following 2 1 r θ a 0 1 n 0 10 c n cos n θ where r θ is the magnitude of the radius vector to a point on the drop surface with respect to the angle θ in mm a 0 is the equivalent radius of the raindrop in mm and c n represents the shape coefficient fig 21 shows the shapes of raindrops of various sizes calculated using eq 2 1 existing studies ross and bradley 2002 xichuan et al 2013 give the comparison results between the b c model and the actual drop shapes that is the approximate ellipsoid model is close to the actual raindrop shape hence we use the b c model to fit the shape of raindrops in the following parts b raindrop size distribution the probability distribution of raindrop size distribution dsd can be an exponential gamma or marshall palmer distribution k ufre mfon et al 2015 and the gamma distribution was found to be more reasonable in describing the characteristics of dsd for both small and large particle diameters han et al 2021 the gamma distribution of the dsd is as follows 2 2 n d n 0 d μ e λ d where n d is the number of raindrops in the sampling volume whose diameter is d μ is the shape parameter n 0 is the intercept parameter and λ is the slope parameter in this study the gamma distribution was employed as the dsd function in the following analysis fig 22 shows the dsd in different rainfall intensity scenarios existing studies wen et al 2019 indicate that the raindrop size is within 0 5 6 mm in diameter and generally not more than 6 mm hence in fig 22 only 0 5 d 6 is considered c raindrop terminal velocity the terminal velocity of a raindrop is also related to its size which can be well approximated by the empirical formulas of raindrop diameter beard 1976 the most popular formula in a standard atmosphere of 1013 hpa is given by 2 3 v d 9 65 10 3 e 0 6 d where v d is the terminal velocity of a raindrop in m s dependent on d which is the droplet diameter equivalent to d in mm in eq 2 2 d scattering properties of raindrops in visible light garg and nayar 2005 used geometric optics methods to analyse the scattering properties of raindrops at visible wavelengths and pointed out that raindrops refract light from a large solid angle the field of view fov of raindrops is approximately 165 as shown in fig 23 b thus a raindrop distance from the camera z as shown in fig 23 a tends to be much brighter than its background fig 23 e the brightness of raindrops does not depend strongly on their background garg and nayar 2005 thus the intensity of each pixel value of a rain streak is approximately the same as shown in fig 23 c and d the intensity values of the pixels i r 1 i r 2 i r 3 i r 4 i r 5 blurred by a raindrop are almost the same that is i r 1 i r 2 i r 3 i r 4 i r 5 appendix 3 the main parameters of surveillance cameras employed for simulation the alternating direction method of multipliers admm framework will be used to effectively solve the complicated unconstrained optimization problem eq 5 3 1 min r d s x t l α 1 dtv d 1 α 2 s 1 α 3 x 1 α 4 t 1 l s t d r s r x y o r t t o r l o r o b 0 the lagrange multiplier of eq 3 1 is as follows 3 2 l β α 1 dtv d 1 α 2 s 1 α 3 x 1 α 4 t 1 l β 1 2 d r κ 1 β 1 f 2 β 2 2 s r κ 2 β 2 f 2 β 3 2 x y o r κ 3 β 3 f 2 β 4 2 t t o r κ 4 β 4 f 2 β 5 2 l o r κ 5 β 5 f 2 where κ κ 1 κ 2 κ 5 are lagrangian multipliers and β β 1 β 2 β 5 are positive parameters minimizing l β over r d s t and l leads to subproblems whose solutions can be efficiently obtained using simple numerical methods as presented below a d subproblem 3 3 min d α 1 dtv d 1 β 1 2 d r κ 1 β 1 f 2 b s x t subproblems 3 3 min s α 2 s 1 β 2 2 r s κ 2 β 2 f 2 which has a closed form solution using soft thresholding 3 4 s t 1 s h r i n k α 2 β 2 r t κ 2 t β 2 here the tensor nonnegative soft thresholding operator shrin k α β is defined as 3 5 shrin k α β x s i g n x max x α β 0 therefore analogous to the s subproblem 10 3 6 x t 1 s h r i n k α 3 β 3 y o r t κ 3 t β 3 3 7 t t 1 s h r i n k α 4 β 4 t o r t κ 4 t β 4 c l subproblem 3 8 min l l β 5 2 o r l κ 5 β 5 f 2 in this study we adopt the tensor nuclear norm definition as l i 1 n x i x i u n f o l d i x then l can be undated as 3 9 l t 1 i 1 3 1 3 f o l d i l i t 1 where l i t 1 ƛ 1 β 5 b i t κ i t β 5 and ƛ 1 β 5 x indicate the soft thresholding to the singular values of x d r subproblem 3 10 min r β 1 2 r d f 2 β 2 2 r s f 2 β 3 2 x y o r κ 3 β 3 f 2 β 4 2 t t o r κ 4 β 4 f 2 β 5 2 l o r κ 5 β 5 f 2 which has the following closed form solution 3 11 r t 1 f 1 f w 1 f w 2 where f and f 1 denote the fast fourier transform and its inverse 3 12 w 1 β 1 d t 1 κ 1 t β 2 s t 1 κ 2 t y t β 3 y o β 3 x t 1 κ 3 t t t β 4 t o β 4 t t 1 κ 4 t β 5 o l t 1 κ 5 t 3 13 w 2 1 β 1 β 2 i β 3 y t y β 4 t t t e κ update 3 14 κ 1 t 1 κ 1 t β 1 r t 1 d t 1 κ 2 t 1 κ 2 t β 2 r t 1 s t 1 κ 3 t 1 κ 3 t β 3 y o r t 1 x t 1 κ 4 t 1 κ 4 t β 4 t o r t 1 t t 1 κ 5 t 1 κ 5 t β 5 o r t 1 l t 1 the proposed algorithm for rain streak extraction detection in nir videos can be summarized by algorithm 1 algorithm 1 rain streak extraction detection appendix 4 the main parameters of surveillance cameras employed for simulation 
2211,understanding the relationship between trunk sap flow and tree diameter is crucial for tree stand transpiration upscaling and sap flow measurement strategy design because of well known tree to tree variations in sap flow metrics however whether and how this relationship will vary intra and inter annually and the underlying mechanisms are still poorly understood we measured the sap flow of 126 trees throughout a six year experiment 2016 2021 in a temperate poplar populus tomentosa forest with five irrigation management regimes simultaneously we also monitored meteorological factors leaf area indices and soil water contents there was a great variability of both sap flux sf and sap flux density sfd across trees and this variability tended to be larger in older stands patterns of the relationships between sf sfd and diameter at breast height dbh changed markedly from year to year a nonlinear positive correlation p 0 001 between sf and dbh was found except in 2016 when canopy closure did not occur in contrast no correlations between sfd and dbh were observed in most years but their correlations became positive and linear in two wet years 2018 2021 p 0 05 the power q of dbh to explain tree to tree sap flow variations exhibited enormous change on both intra and inter annual scales underpinned by different mechanisms the potential transpiration demand of trees mainly determined the intra annual variation of q but its effect depended on stand development whereas the environmental water supply mostly controlled the inter annual variation of q based on these results we provide some recommendations on sap flow measurement and stand transpiration estimation for pure tree plantations in water limited regions our findings should assist the accurate prediction of stand water use in plantation forests of both poplar and other tree species keywords sap flow stand transpiration upscaling sap flux water use plantation forests data availability data will be made available on request 1 introduction forests occupy about 1 3 of the global land area and play an essential role in supporting terrestrial ecosystems by supplying multiple ecological services such as water and soil conservation carbon sequestration atmospheric composition regulation and timber production among others fao 2020 forests also play a crucial role in the hydrological cycle between the atmosphere and the pedosphere through evapotranspiration liu et al 2020 schwärzel et al 2020 zhang et al 2020 transpiration as the primary component of forest evapotranspiration not only symbolizes the fundamental physiological and ecological activities of plants but also has a critical influence on forest hydrological balance di et al 2019a liu et al 2022 jasechko et al 2013 thus accurate estimation of forest transpiration is essential to a thorough understanding of forest ecophysiological and hydrological processes and their underlying mechanisms which subsequently can help us to develop sustainable forest management strategies for maintaining regional hydrological balance in the context of climate change flo et al 2019 liu et al 2022 tfwala et al 2019 many methods have been developed to quantify forest transpiration in the past few decades the commonly applied approaches have included the water balance method the micro meteorological method and the sap flow method flo et al 2019 köstner et al 1992 schwärzel et al 2020 the water balance method has the advantages of being able to be used in forests with different areas and avoids the effects of complex underlying surfaces but its estimation precision strongly depends on accurate measurements of other water balance components which are in fact difficult to achieve in areas with complex terrain and in forests with deep root systems liu et al 2022 the micro meteorological method can successfully measure the evapotranspiration of different types of forests on different scales but the accurate partitioning of the measured evapotranspiration into transpiration and evaporation remains a challenge that has not been well solved li et al 2019 as an alternative the thermal based sap flow method possessing many advantages over other methods such as being cheap and easy to apply and being able to explain more detailed physiological and ecological processes and mechanisms of plants has become the most widely used approach to estimate forest transpiration at both the individual tree and stand scales flo et al 2019 komatsu et al 2013 liu et al 2022 the sap flow method is a transpiration measurement approach for individual trees thus one of the key challenges in applying this method to estimate forest transpiration is how to upscale the sap flow of individual trees to stand level transpiration as it is unrealistic to measure the sap flow of all trees in a stand chiu et al 2016 two demonstrated effective approaches commonly applied for this upscaling purpose are 1 to multiply the mean sap flux densities sfd of trees by the total sapwood area of all trees in a stand kume et al 2010 liu et al 2022 and 2 to calculate the transpiration of all trees by using their diameters and an allometric model describing the quantitative relationship between tree sap flux sf and diameter and then summarize them to obtain the stand transpiration berry et al 2017 otieno et al 2017 the successful application of either of these methods requires a clear understanding of how sfd and sf vary across different sized trees berry et al 2017 this is because this information can help us to determine the optimal sampling strategies for selecting fully representative trees to measure sap flow and to establish a robust allometric model between tree diameter and sf for extrapolating the transpiration of trees without sap flow measurement berry et al 2017 chiu et al 2016 tsuruta et al 2019 therefore up until now many studies have been conducted to investigate the variations of sfd or and sf among trees of various diameters for different tree species and forest types butz et al 2018 niu et al 2017 schoppach et al 2021 yan et al 2016 however there is still no universal conclusion regarding the relationships between sfd sf and tree diameter this issue is illustrated by the different correlations positive negative and uncorrelated found between these variables and by the allometric models linear or nonlinear optimally describing their relationships often changing with tree species forest types and environments jung et al 2011 meinzer et al 2001 niu et al 2017 tsuruta et al 2019 therefore it may not be appropriate to thoughtlessly extrapolate existing findings on the relationships between sfd sf and diameter to that of other different forests most previous studies related to this topic used only averaged data over a short term a few days weeks or months to derive how sf and sfd change with tree diameter meinzer et al 2005 moon et al 2016 phillips et al 1999 leading to uncertainties regarding whether their relationships will vary seasonally and or inter annually this in turn raises another unanswered question whether tree diameter can always explain the tree to tree sf and sfd variations even though tree diameter has been widely proved to be a scalar entity strongly correlated with sap flow metrics as it can reflect the metabolic capacity leaf area and competitive position of trees jung et al 2011 niinemets 2002 oren et al 1998 if tree to tree variations in sf and sfd cannot always be explained by tree diameter the frequently recommended sampling strategies for selecting trees to measure sap flow and the derived allometric models for extrapolating tree transpiration will all need to be revisited and revised unfortunately few efforts have yet been devoted to solving the above questions but see hassler et al 2018 schoppach et al 2021 the mechanisms underlying sf and sfd variations across different sized trees are well understood after many years of study across different regions around the world moore et al 2017 niu et al 2017 oren et al 1998 otieno et al 2014 xiong et al 2008 however unexpectedly there is only a very limited understanding of the mechanisms underpinning the dynamic of tree diameter s relative importance or explanatory power in explaining these tree to tree sf and sfd variations using relative importance analysis the innovative works of hassler et al 2018 and schoppach et al 2021 showed that potential evapotranspiration soil water condition and species specific water use strategies are important factors determining the intra annual dynamics of the degree to which tree diameter explains the variation of sfd unfortunately their findings cannot answer whether these factors are still the critical determinants at different stand development stages or in different years as they collected their data only over less than one year in addition as limited influencing factors were investigated and sf data were not considered in these studies of hassler et al 2018 and schoppach et al 2021 we still do not know if other biotic and abiotic factors can control the power of tree diameter to explain tree to tree variations in sf and sfd on both intra and inter annual scales populus tomentosa as a unique native tree species to china plays a vital role in the development of fast growing high yielding plantation forests on the north china plain ncp as water stress is a crucial limiting factor to the growth of poplar species and water sustainability is seriously threatened on the ncp xi et al 2021 xu et al 2020 adopting a well designed irrigation management regime is essential to maintain and promote the performance of p tomentosa plantations in the context of climate change one of the fundamental premises for developing efficient irrigation regimes is to precisely estimate the stand level transpiration xi et al 2021 the sap flow of p tomentosa has been investigated for multiple purposes including stand transpiration estimation xi et al 2017 di et al 2019b liu et al 2022 but to the best of our knowledge the relationships between diameter and sap flow metrics and the underlying mechanisms have never been studied for this species furthermore such information has not been considered in estimating its stand transpiration and designing its sap flow measurement strategies although relevant research has been conducted in many studies as mentioned above their findings may not apply to the short rotation plantation forests of fast growing and high yield tree species like populus spp as most previous studies are targeted for old pure or mixed forests of 20 years old consequently we conducted a continuous study in 2 to 7 year old p tomentosa plantations with three objectives 1 to investigate the patterns of the relationships between trunk sap flux density sap flux and tree diameter 2 to determine whether and how these relationships would vary intra and inter annually and 3 to reveal the effects of different factors on the power of tree diameter to explain tree to tree sap flow variation on both intra and inter annual scales finally we apply these findings to make recommendations on sap flow measurement and stand transpiration estimation for pure plantations in water limited regions 2 materials and methods 2 1 experimental site and experimental plantations the experiment site was located at the state owned jiucheng forest farm in gaotang county shandong province latitude 36 81 n longitude 116 09 e this site has a very flat terrain with an altitude of about 30 m this region has a semi humid monsoon climate the average annual temperature is 13 4 and the mean annual precipitation was 563 mm from 1981 to 2010 the groundwater level fluctuates relatively stably between 7 and 9 m depths liu et al 2022 the experimental plantation was established in the spring of 2015 with a hybrid poplar clone p tomentosa p bolleana p tomentosa the planting density was 1666 trees ha 1 with 2 0 m within row spacing and 3 0 m between tree rows fig s1 the planted samplings had an average diameter at breast height 1 3 m dbh of 3 cm and an average height of 3 m there were five irrigation management treatments applied with a randomized complete block design fig s1 for each treatment there were five replicated plots these treatments included full and deficit drip irrigation and full and deficit basin irrigation fig s1 one rainfed treatment was also included as a control at the end of march every year i e before leaves appeared irrigation was applied to all treatments to promote budburst in the full and deficit drip irrigation treatments the stands were irrigated in 2016 and 2017 when the soil matric potential under the dripper reached 20 kpa and 45 kpa respectively with the increase in stand age the water consumption of trees increased gradually liu et al 2022 therefore the irrigation threshold of the full drip irrigation treatment was increased to 18 kpa since 2018 we irrigated trees in the full basin irrigation treatment every 5 7 days during the experimental period the irrigation times of the deficit basin irrigation treatment followed the deficit drip irrigation frequency accordingly there are obvious differences in soil water content between different water treatments fig s2 and detailed information on soil water dynamics in different treatments was shown in zou et al 2022 liu et al 2022 and liu et al 2021 the other details of our experimental design can be found in liu et al 2022 and jiao et al 2021 2 2 field experiment measurements 2 2 1 sap flow different sized thermal dissipation td probes dynamax inc tx usa were used to monitor the trunk sap flux density cm s 1 during the growing season april october from 2016 to 2021 in 2016 the td 10 probes 1 cm in length were chosen to measure the sfd afterward the td 30 probes 3 cm in length were selected for measurement from 2017 to 2021 owing to the increase in tree diameter the probes were inserted into the stem sapwood at 1 3 1 5 m above the ground after installation waterproof glue was coated around the probes and then we used foam to fix them and act as thermal insulation finally reflective bubble insulation was wrapped around the probes and the stem the sfd was measured every 10 s and its average value calculated every 10 min was stored in two different types of data loggers cr1000 campbell scientific inc ut usa ilogger beijing sinton technology company beijing china because of limitations on the numbers of probes available for measuring sfd the numbers of sample trees selected from the third or and fourth block in different treatments fig s1 were 4 5 in 2016 2018 3 9 in 2019 3 10 in 2020 and 6 28 in 2021 basic information on the sample trees is shown in table 1 the sfd was estimated using the empirical equation eq 1 given by granier 1987 1 sfd 0 0119 δ t m a x δ t δ t 1 231 where δt is the temperature difference between the heated and reference probes and δt max is the maximal temperature difference between these two probes δt max was acquired from the maximal daily δt max during a period of every 7 10 days to avoid neglecting night time sap flow lu et al 2004 the temperature difference data were processed by the baseliner software oishi et al 2016 from 2016 to 2019 100 trees from different treatments were harvested for biomass measurement liu et al 2022 so that we had an opportunity to measure the dbh bark thickness and heartwood diameter at different heights of the stem sapwood area sa cm2 is part of the wood between bark and heartwood according to lu et al 2004 sapwood can be determined by examining the natural macroscopic features such as color in p tomentosa the wood color generally changes from light sapwood to brown heartwood thus the sapwood area can be easily obtained by subtracting the heartwood area from the cross sectional area of the trunk without bark then the 202 sets of data obtained were used to establish an allometric equation between sa and trunk diameter fig 1 which was applied to calculate the sas of all sample trees finally the sap flux sf l d 1 of each tree was obtained by the product of sfd and sa eq 2 2 sf s f d s a the sfd measured using td probes can be influenced by many error sources such as wounding radial velocity profile and wood properties clearwater et al 1999 lopez et al 2019 wiedemann et al 2016 therefore it has been found in many studies that sfd can be over or under estimated to different degrees flo et al 2019 fuchs et al 2017 wiedemann et al 2016 however the present study focused only on the relationships between sfd sf and dbh and not on the accurately absolute values of sfd and sf so any systematic estimation and measurement errors would not affect the results 2 2 2 meteorological factors the meteorological factors including global solar radiation r s mj m 2 day 1 air temperature relative humidity and precipitation mm day 1 were measured using a weather station at our study site all the data were measured every 10 min and stored in a data logger dl2 data logger delta t devices ltd cambridge uk the measured total precipitation values during the growing season were 585 449 700 487 467 and 784 mm in 2016 2017 2018 2019 2020 and 2021 respectively the measured data were also used to calculate the reference crop potential evapotranspiration eto mm d 1 using the fao 56 penman monteith equation eq 3 allen et al 1998 3 e t o 0 408 δ r s g γ 900 t 273 u 2 e a e d δ γ 1 0 34 u 2 where is the slope of the saturation pressure versus temperature function kpa 1 g is the soil heat flux mj m2 d 1 t is the daily average temperature γ is the psychometric constant kpa 1 u 2 is the wind speed m s 1 e a is the saturated vapor pressure kpa e d the actual vapor pressure difference kpa 2 2 3 leaf area index and soil water content the leaf area index lai m2 m 2 of each plot of all treatments fig s1 was measured regularly at sunset by the lai 2200c plant canopy analyzer pca li cor inc lincoln usa other details of the lai measurements are given in liu et al 2022 in the third and fourth replicated plots of both the full drip irrigation and rainfed treatments soil water content θ cm3 cm 3 was monitored using the tube probes gs301 sinton technology ltd beijing china installed at 30 and 120 cm distances from the tree the measurement points were set to 10 30 60 100 150 200 250 300 350 400 450 500 and 550 cm depths the data were measured with a frequency of every 30 min and were stored in a data logger g30 sinton technology ltd beijing china the collected data were then used to calculate the soil water availability r θ using eq 4 4 r θ θ θ min θ max θ min where θ max and θ max are the maximum and minimum θ measured in all treatments during 2019 2021 respectively 2 3 data analysis to increase the sample number for data analysis all data from the five irrigation management treatments fig s1 were used to investigate the relationships between sf sfd and dbh except those of the two basin irrigation treatments in 2018 and that of the deficit basin irrigation treatment in 2019 owing to some data quality problems however the difference in θ among treatments caused by various irrigation regimes might influence the results fig s2 to eliminate this influence only the data under adequate soil water conditions in all treatments were selected for most analyses to be specific firstly the data on rainy days and one to five days depending on the precipitation after rainfall were selected as it was considered that rainfall would ensure that tree transpiration in all treatments was not constrained by soil water deficit in the short term secondly the data during the initial growing period were also used for analysis i e 6 to 10 april in 2017 and 1 to 10 april for later years because transpiration during this period was also not restricted by soil water owing to the budburst promotion irrigation see section 2 1 and the low transpiration rates liu et al 2022 thirdly the data in the rainy season 1 july to 31 august were also included for analysis as the frequent rainfall events in the rainy season can guarantee trees in all treatments were under well water conditions linear or nonlinear regressions were conducted to investigate the relationships between sf sfd and dbh on the daily annual and whole experimental period six year scales here it should be noted that for each tree all its daily sf and sfd data under the aforementioned adequate soil water conditions in a year were averaged for analysis on the annual scale in contrast we selected the data covering three days with maximum sf and sfd for each sample tree in each year and then combined these to do the analysis over the whole experimental period scale the determination coefficients r2 of these regression lines and curves were used to indicate the explanatory power q of dbh for tree to tree variations in sf q sf and sfd q sfd hereafter this r2 is referred to as the explanatory power of dbh we used the value of eto lai to indicate the potential transpiration demand t pot mm of trees when calculating t pot on the daily scale the daily lai obtained by interpolation and the daily eto were used while on the annual scale the total eto and daily mean lai during the growing season were used here the lai was the average value of five treatments in addition the r θ and growing season precipitation values were used to indicate the environmental water supply on the daily and annual scales respectively then we used linear or nonlinear regression analyses to determine the effects of various factors stand age t pot r θ and precipitation on the intra or inter annual variations of the r2 i e the explanatory power of dbh mentioned above which represented their impacts on the relationships between sfd sf and dbh when analyzing the effect of t pot on the intra annual variation of q the data during the adequate soil water condition period excluding rainy days were selected to avoid the impacts of soil water deficit and rainfall in contrast for the impact of r θ we used the data throughout the whole growing season i e rather than using only the data from the adequate soil water condition period and this analysis was conducted under both long term high and long term low soil water conditions for which purpose we used only the data from the full drip irrigation i e high soil water condition and rainfed low soil water condition treatments in 2021 fig s1 this was because the numbers of sample trees in these two treatments were large n 10 in 2021 and there was an enormous difference in soil water condition between these two treatments throughout the whole root zone fig s3 to investigate whether the long term soil water status influences the relationship patterns between sf sfd and dbh the linear or nonlinear regressions were first used to fit these relationships in the full drip irrigation and rainfed treatments fig s1 then an f test was applied to detect if there were significant differences between treatments in the slope of the fitted line and or the parameters of the fitted curve in addition we used the coefficient of variation cv to analyze the variability of sf and sfd among different sized trees our data analyses were conducted in originpro 2022 originlab corporation ma usa 3 results 3 1 sapwood area to dbh relationship and tree to tree sap flow variation the sapwood area of p tomentosa was positively correlated with the dbh p 0 001 fig 1 their relationship could be simulated well with a power function with the dbh explaining 99 of the variation in sapwood area seasonal variation of the cv of the sap flow among trees was similar in different years fig s4 the cvs of sf and sfd changed dramatically within the growing season with their values being always large at the beginning and at the end of the growing season but varying within a relatively stable and narrow range at other times except on occasional days the annual mean sap flow cv also changed with the year but the degree of change was much less than that within the growing season data not shown there were significant linear relationships between stand age and the annual average cvs of both sfd r2 0 661 p 0 049 and sf r2 0 793 p 0 017 3 2 patterns of the relationships between sf sfd and dbh patterns in the relationships between sfd sf and dbh changed markedly over the years fig 2 the annual average sf was not correlated with dbh in 2016 but their relationship became nonlinearly positive after that and could be modeled by a power function p 0 001 although there was a linear relationship p 0 05 between the annual average sfd and dbh in 2018 and 2021 fig 2c f these variables were not correlated in other years fig 2a b d e in contrast when using all data from the six years 2016 2021 for analysis the nonlinear scaling of sf with dbh could still be well described by a power function r2 0 657 p 0 0001 but no relationship was detected between sfd and dbh p 0 05 fig s5 in addition there were no significant differences p 0 05 between high full drip irrigation treatment and low rainfed treatment soil water conditions in the fitted curves for the sf to dbh relationship or in the fitted lines for the sfd to dbh relationship fig s6 this suggests that the long term difference in root zone water status did not influence the scaling relationship between sap flow and dbh on an annual scale 3 3 dynamics of the power of dbh to explain tree to tree sf and sfd variations the sizes of the sf and sfd changes among trees explained by dbh each day showed distinct intra annual variations fig 3 in 2016 2017 dbh significantly explained the tree to tree variation of sf only in a few cases p 0 05 fig 3a b in contrast in each year from 2018 to 2021 the sf variation among trees could always be significantly explained by dbh p 0 05 except at the beginning and the end of the growing season fig 3c f whereas dbh significantly explained the variation in sfd among trees p 0 05 over most of the growing season only in 2018 and 2021 fig 3c f both the averaged q sf 6 71 and q sfd 3 48 over the growing season showed enormous inter annual variation without apparent regularity but dbh was always better at explaining sf than sfd except in 2016 fig 4 3 4 relationships between different factors and intra annual variation in the explanatory power of dbh the influence of t pot on q sf changed considerably with year having no effect in 2021 p 0 873 a linear negative effect in 2016 p 0 024 but being linearly or nonlinearly positive in 2017 2020 p 0 001 fig 5 additionally the significant influence of t pot was very weak in 2016 r2 0 085 and 2017 r2 0 236 fig 5a b it became much stronger in 2018 2020 r2 0 532 0 911 when q sf first increased with t pot but remained stable after t pot reached a critical value fig 5c e no relationship was detected between t pot and q sfd in 2016 p 0 757 2020 p 0 777 or 2021 p 0 103 fig 5a e f however q sfd showed a slightly linear increase with t pot in 2017 p 0 014 fig 5b while in 2018 q sfd firstly increased with t pot but then decreased gradually with it p 0 001 fig 5c unexpectedly a different phenomenon was found in 2019 when q sfd firstly decreased with t pot and then remained stable p 0 001 fig 5d under both high i e drip full irrigation treatment and low rainfed treatment soil water conditions r θ in all soil layers exhibited no apparent relationships with the intra annual variations of either q sf or q sfd fig 6 3 5 relationships between different factors and inter annual variation in the explanatory power of dbh the inter annual variations of neither q sf nor q sfd were influenced by stand age p 0 05 or by t pot p 0 05 fig 7 a b in contrast q sfd increased linearly with rainfall in the growing season p 0 005 fig 7c q sf also showed an increasing trend with precipitation but this relationship was statistically significant p 0 012 only when the data from 2016 were excluded fig 7c 4 discussion 4 1 dynamics of the tree to tree variation in sap flow the stand specific variation in sf and sfd is one of the major uncertainties in estimating stand transpiration by the thermal based sap flow method kumagai et al 2005 our results from p tomentosa showed that the variability i e cv of sap flow among trees had a larger intra annual than inter annual change fig s4 meanwhile the significant linear relationship between stand age and sap flow mean cv indicated that the average tree to tree sap flow variation tended to be larger in older p tomentosa stands probably because of the increasing differentiation among trees this finding was consistent with the comparison between young and old forests made by moore et al 2004 additionally relative to other studies the mean cvs of both sf 0 41 0 73 in different years and sfd 0 39 0 51 of p tomentosa were very large ballester et al 2011 hadiwijaya et al 2020 moon et al 2016 moore et al 2004 shinohara et al 2013 xiong et al 2008 which was especially true with similar sample tree numbers moon et al 2016 shinohara et al 2013 xiong et al 2008 this phenomenon might be attributed to the more intensive inter tree competition in our stand brought by high planting density fast spreading of both canopy and root systems and the high water and nutrient demands of poplar trees coleman and aubrey 2018 li et al 2021b liu et al 2022 4 2 effects of different factors on the temporal variation in the explanatory power of dbh it is still poorly understood whether and how the relationship between sap flow and tree diameter will change intra and inter annually in theory their relationship should possess temporal variation as many factors that influence sap flow e g meteorological factors leaf area and stomatal conductance and stand and hydraulic structure change enormously with season and year chiu et al 2016 li et al 2021a niinemets 2002 this hypothesis has been verified in a few studies moon et al 2016 niu et al 2017 for example niu et al 2017 found that the slope of the linear sf dbh relationship was higher in young than in old rubber plantations an opposite result was observed in a temperate mixed forest where the monthly differences in both the slope and intercept of the sfd and sf to dbh relationships were non significant chiu et al 2016 consistent with the former case we found that the sap flow to dbh relationship showed extensive inter and intra annual variations in terms of both the relationship pattern fig 2 and the r2 i e the dbh explanatory power of the fitted line or curve figs 3 4 this finding emphasizes that the high variability of the sap flow to dbh relationship should be considered when designing a sap flow measurement strategy and when upscaling individual tree sap flux measurements to stand transpiration the intra annual dynamic of the power of dbh to explain tree to tree variation in sfd has proved to be species specific mainly because of species specific water use habit and physiological responses to environmental change hassler et al 2018 schoppach et al 2021 in most years of our study q sfd was low both at the inception early season and late at the end of the growing season but remained relatively high at other times fig 3b c e f this was similar to findings for oak and conifers in temperate forests schoppach et al 2021 unexpectedly our observed intra annual q sfd and q sf variations were not influenced by r θ in any soil layer even under long term low soil water conditions fig 6 fig s3 which phenomenon was also found in a temperate mixed forest hassler et al 2018 and in beech schoppach et al 2021 however the intra annual variations of both q sfd and q sf could be controlled by the potential transpiration demand i e t pot but this control changed annually fig 5 in 2016 i e before canopy closure because all trees were fully exposed to radiation and the tree differentiation was very low dbh explained only a small portion of the tree to tree sfd variation all the time so that its explanatory power q sfd did not change with t pot fig 5a otieno et al 2017 ringgaard et al 2012 in 2017 the stand canopy closed in early summer and afterward there was some minor mutual shading thus larger trees with slightly higher radiation and vapor pressure deficit vpd exposure and leaf area could have slightly higher sfd values after early summer otieno et al 2017 ringgaard et al 2012 this slight sfd advantage of larger trees would increase under higher t pot consequently leading to the slightly increasing q sfd with t pot i e dbh explained more tree to tree sfd variation under higher potential transpiration demand fig 5b a similar phenomenon was also observed in temperate mixed forests hassler et al 2018 schoppach et al 2021 by 2018 the larger trees advantage in radiation and vpd exposure and their stronger competitive capacities for abundant shallow soil water because of their higher root density in the shallow layer brought by high precipitation 700 mm could jointly maintain their higher sfd values fig 2c coleman and aubrey 2018 li et al 2017 however relative to smaller trees the embolism or water transport resistance in larger trees xylem might have a greater possibility for increase under high t pot owing to the coupling effects of their longer water transport path and higher water demand this might result in the sfd difference between larger and smaller trees becoming smaller under high t pot than under moderate t pot consequently decreasing the power of dbh to explain tree to tree sfd variation under high transpiration demand this mechanism could explain the unimodal variation of q sfd with t pot in 2018 fig 5c owing to the potential accumulated xylem embolism and the low precipitation 487 mm in 2019 larger trees might have adopted a tighter stomatal regulation strategy to protect themselves from hydraulic failure therefore with increasing t pot the increase in larger trees sfd might have been slower so that the difference in sfd between larger and smaller trees decreased gradually this could explain the phenomenon in 2019 in which q sfd firstly decreased gradually with t pot and then remained stable at a very low level fig 5d with the continuously increasing degree of xylem embolism the sfd of larger trees in 2020 the driest year seemed to be limited even when the potential transpiration demand was still low consequently resulting in very small q sfd throughout the growing season and no variation of q sfd with t pot fig 5e with the arrival of heavy rainfall in 2021 784 mm their better ability to compete for abundant shallow soil water might have ensured that larger trees always had higher sfd under any t pot condition fig 2f however the very severe mutual shading might have eliminated the larger trees advantages in radiation and vpd exposure so that q sfd was not influenced by t pot anymore fig 5f the above findings imply that the variations in stand structure tree hydraulics and below ground competitive power with stand development might jointly determine the influence of t pot on the intra annual change of q sfd the influence of t pot on q sf was strongly related to its effect on q sfd because sf was calculated from sfd in 2016 q sf was not related to q sfd fig s7 in later years there was a positive linear correlation between q sf and q sfd except in 2019 when this relationship became negative and in 2020 when any correlation disappeared fig s7 these results could explain the different impacts of t pot on the intra annual variations of q sf and q sfd fig s7 additionally the inter annual variations in neither q sf nor q sfd were determined by stand age and t pot but both could be strongly affected by the precipitation fig 7 4 3 variation in the relationship pattern between sap flow and tree diameter there are reported large differences in previously observed sfd dbh relationship patterns which include non correlation otieno et al 2014 tsuruta et al 2019 negative meinzer et al 2001 niu et al 2017 or positive correlations chiu et al 2016 jung et al 2011 in our study both no and positive correlations existed with the former appearing in most years fig 2 meanwhile in contrast to the weakly positive sfd dbh correlation often found in many other studies chiu et al 2016 jung et al 2011 moon et al 2016 our observed positive linear correlations in 2018 and 2021 were very strong fig 2c f furthermore when we reanalyzed the result using a large dataset of 118 trees collected over six years sfd was also not correlated with dbh fig s5 firstly these findings demonstrated that the sfd dbh relationship pattern of p tomentosa possesses great inter annual variation and this relationship pattern could be either insignificant or significant even for the same tree species which phenomenon has also been found in other forests niu et al 2017 thorburn et al 1993 secondly our results indicate that the differences in sample tree numbers and datasets may influence the detected sfd dbh relationship patterns which agrees with the findings from some subtropical and tropical forests berry et al 2017 phillips et al 1999 tsuruta et al 2019 additionally and unexpectedly we found no significant difference in the sfd dbh relationship between long term high and long term low soil water conditions fig s6 this phenomenon might have been due to the high precipitation eliminating the potential difference in inter tree water competition intensity between contrasting soil water conditions by bringing similar water availability into shallow soils with dense roots during most of the growing season fig s3 different sf dbh relationship patterns were also found in various studies but in the vast majority of cases sf was positively and nonlinearly correlated with dbh chiu et al 2016 jung et al 2007 meinzer et al 2005 niu et al 2017 yan et al 2016 consistent with this in our study there was a nonlinear relationship between sf and dbh for p tomentosa in all years except 2016 fig 2 the sf is a product of sfd and sapwood area sa with the latter being calculated from dbh so its relationship with dbh is simultaneously controlled by the relationships between dbh and both sfd and sa berry et al 2017 chiu et al 2016 mcjannet et al 2007 tsuruta et al 2019 however it was still unknown from previous studies whether their control degrees could change with stand development our long term study of six years provided an opportunity to address this question according to our results before stand canopy closure 2016 the sfd dbh relationship no correlation had a stronger influence on the sf dbh relationship no correlation which could be attributed to the tree to tree sa variability being small but that of sfd being large table 1 fig 2a however after the closure of the canopy which occurred in the early summer of 2017 the sa dbh relationship started to mainly affect the scaling of sf with dbh which was consistent with the findings from other pure forests at the canopy closure stage tsuruta et al 2019 xiong et al 2008 it can be reflected by the fact that the relationship between sf and dbh mainly followed that between sa and dbh fig 2b f fig 1 additionally the sf dbh relationship became much stronger in wet years 2018 2021 when dbh significantly influenced the tree to tree sfd variation fig 2c f consequently our findings highlight that the relative influences of the sfd dbh and sa dbh relationships on the scaling of sf with dbh strongly depend on stand development and the hydro meteorological conditions what kind of model will best describe the widely observed nonlinear relationship between sf and dbh is still inconclusive but this is crucial for stand transpiration estimation the form of the model will significantly influence estimation of the transpiration of large trees berry et al 2017 based on the sap flow data of 65 trees from multiple tree species in temperate and tropical forests meinzer et al 2005 concluded that sigmoid functions rather than power functions may be universally applicable for describing the scaling of sf with tree diameter this suggested sigmoid trajectory is also supported by the size dependence of other biological processes e g growth photosynthesis and respiration that diminish when trees grow above a size threshold meir and grace 2002 mcdowell et al 2002 niinemets 2002 also the sigmoid function seems to better approximate the sf dbh relationship from the biologically meaningful perspective as it will not predict an indefinite increase of sf with dbh although the sigmoid trajectory of sf with increasing dbh has been confirmed by the model results of berry et al 2017 for a multiple species forest such a relationship was rarely found in many other cases including forests with multiple and single tree species moore et al 2017 otieno et al 2017 yan et al 2016 similarly we also did not observe an asymptotic relationship between sf and dbh in our p tomentosa plantations even when using the data of 118 trees for analysis fig s5 in contrast the power function described the sf dbh relationship of p tomentosa well as was also widely found for other tree species jung et al 2007 moore et al 2017 otieno et al 2017 yan et al 2016 the limited range of dbh might influence our discovery of the asymptotic sf dbh relationship however it was also not observed in other studies even when there was a vast dbh range of 116 cm moore et al 2017 therefore further validation is still needed in different forest ecosystems especially in pure forests to confirm whether there really exists an asymptotic relationship between transpiration and indices of plant size 4 4 implications for sap flow measurements and stand transpiration upscaling based on the findings in this study we provide the following recommendations on sap flow measurement strategy and stand transpiration upscaling for pure plantations in water limited regions 1 before the closure of the canopy and in the year when it just happens there is no need to consider the difference in tree diameter when selecting trees for sap flow measurement after canopy closure for rainfed plantations in wet years and always for fully irrigated plantations tree diameter difference should be taken into account however for rainfed plantations in dry years it may not need to be considered note that this suggestion is only applicable to cases where stand transpiration estimation is not the study objective 2 during wet years at the canopy closure stage the sf dbh model derived in stands under different soil water conditions can be used mutually to predict individual trees transpiration and stand transpiration upscaling this approach was demonstrated to be reasonable by our comparison results in the full drip irrigation and rainfed treatments method 1 in fig s8 the trees used for developing the model should cover as wide a diameter range as possible 3 the sf dbh model established in wet years is suggested to be used for stand transpiration upscaling however the model developed in dry years should be used with caution owing to its possibly low determination coefficient such as in our case in 2019 2020 fig 2d e 4 the dbh power to explain tree to tree sap flux variation has large intra annual variation therefore a dynamic sf dbh model i e develop the model for each day should be developed for precisely upscaling stand transpiration on a daily basis but do not apply this model at the start or the end of the growing season because of the possibly low determination coefficient e g our case in 2018 fig 3c 5 before canopy closure or in dry years the approach method 2 in fig s8 of multiplying the mean sap flux densities of sample trees by the total sapwood area of all trees in a stand might be a better choice for estimating stand transpiration because during these stages the sf dbh relationship may be very weak e g our case in 2016 and 2019 fig 2a d however during wet years after canopy closure applying the sf dbh model for stand transpiration upscaling method 1 might be the optimal choice in our study the prediction error of method 1 was much lower than that of method 2 fig s8 5 conclusions to the best of our knowledge the present study is the first that uses extremely long term six year sap flow data to investigate the relationships between sap flow metrics and tree diameter and their influencing factors our results demonstrated that tree to tree sap flow variation was very high in short rotation poplar plantations and this variability would increase with stand development the power of tree diameter to explain tree to tree variation in sap flow exhibited large intra and inter annual variations which were determined by different mechanisms the potential transpiration demand of trees mainly determined the intra annual variation of the tree diameter s explanatory power but its effect depended on stand development in contrast the environmental water supply mainly controlled the inter annual variation of the explanatory power of the diameter the relationship pattern between sap flow and diameter also possessed large inter annual variation in addition before stand canopy closure the sfd dbh relationship had a stronger influence on the scaling of sf with dbh however after the full closure of the canopy it was mainly influenced by the sa dbh relationship to sum up our findings will be helpful for precisely predicting stand water use in plantation forests of both poplar and other tree species declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgements this research was jointly supported by the national key research and development program of china grant no 2021yfd2201203 and the national natural science foundation of china 32171763 appendix a supplementary data supplementary data to this article can be found online at https doi org 10 1016 j jhydrol 2023 129189 appendix a supplementary data the following are the supplementary data to this article supplementary data 1 supplementary data 2 
2211,understanding the relationship between trunk sap flow and tree diameter is crucial for tree stand transpiration upscaling and sap flow measurement strategy design because of well known tree to tree variations in sap flow metrics however whether and how this relationship will vary intra and inter annually and the underlying mechanisms are still poorly understood we measured the sap flow of 126 trees throughout a six year experiment 2016 2021 in a temperate poplar populus tomentosa forest with five irrigation management regimes simultaneously we also monitored meteorological factors leaf area indices and soil water contents there was a great variability of both sap flux sf and sap flux density sfd across trees and this variability tended to be larger in older stands patterns of the relationships between sf sfd and diameter at breast height dbh changed markedly from year to year a nonlinear positive correlation p 0 001 between sf and dbh was found except in 2016 when canopy closure did not occur in contrast no correlations between sfd and dbh were observed in most years but their correlations became positive and linear in two wet years 2018 2021 p 0 05 the power q of dbh to explain tree to tree sap flow variations exhibited enormous change on both intra and inter annual scales underpinned by different mechanisms the potential transpiration demand of trees mainly determined the intra annual variation of q but its effect depended on stand development whereas the environmental water supply mostly controlled the inter annual variation of q based on these results we provide some recommendations on sap flow measurement and stand transpiration estimation for pure tree plantations in water limited regions our findings should assist the accurate prediction of stand water use in plantation forests of both poplar and other tree species keywords sap flow stand transpiration upscaling sap flux water use plantation forests data availability data will be made available on request 1 introduction forests occupy about 1 3 of the global land area and play an essential role in supporting terrestrial ecosystems by supplying multiple ecological services such as water and soil conservation carbon sequestration atmospheric composition regulation and timber production among others fao 2020 forests also play a crucial role in the hydrological cycle between the atmosphere and the pedosphere through evapotranspiration liu et al 2020 schwärzel et al 2020 zhang et al 2020 transpiration as the primary component of forest evapotranspiration not only symbolizes the fundamental physiological and ecological activities of plants but also has a critical influence on forest hydrological balance di et al 2019a liu et al 2022 jasechko et al 2013 thus accurate estimation of forest transpiration is essential to a thorough understanding of forest ecophysiological and hydrological processes and their underlying mechanisms which subsequently can help us to develop sustainable forest management strategies for maintaining regional hydrological balance in the context of climate change flo et al 2019 liu et al 2022 tfwala et al 2019 many methods have been developed to quantify forest transpiration in the past few decades the commonly applied approaches have included the water balance method the micro meteorological method and the sap flow method flo et al 2019 köstner et al 1992 schwärzel et al 2020 the water balance method has the advantages of being able to be used in forests with different areas and avoids the effects of complex underlying surfaces but its estimation precision strongly depends on accurate measurements of other water balance components which are in fact difficult to achieve in areas with complex terrain and in forests with deep root systems liu et al 2022 the micro meteorological method can successfully measure the evapotranspiration of different types of forests on different scales but the accurate partitioning of the measured evapotranspiration into transpiration and evaporation remains a challenge that has not been well solved li et al 2019 as an alternative the thermal based sap flow method possessing many advantages over other methods such as being cheap and easy to apply and being able to explain more detailed physiological and ecological processes and mechanisms of plants has become the most widely used approach to estimate forest transpiration at both the individual tree and stand scales flo et al 2019 komatsu et al 2013 liu et al 2022 the sap flow method is a transpiration measurement approach for individual trees thus one of the key challenges in applying this method to estimate forest transpiration is how to upscale the sap flow of individual trees to stand level transpiration as it is unrealistic to measure the sap flow of all trees in a stand chiu et al 2016 two demonstrated effective approaches commonly applied for this upscaling purpose are 1 to multiply the mean sap flux densities sfd of trees by the total sapwood area of all trees in a stand kume et al 2010 liu et al 2022 and 2 to calculate the transpiration of all trees by using their diameters and an allometric model describing the quantitative relationship between tree sap flux sf and diameter and then summarize them to obtain the stand transpiration berry et al 2017 otieno et al 2017 the successful application of either of these methods requires a clear understanding of how sfd and sf vary across different sized trees berry et al 2017 this is because this information can help us to determine the optimal sampling strategies for selecting fully representative trees to measure sap flow and to establish a robust allometric model between tree diameter and sf for extrapolating the transpiration of trees without sap flow measurement berry et al 2017 chiu et al 2016 tsuruta et al 2019 therefore up until now many studies have been conducted to investigate the variations of sfd or and sf among trees of various diameters for different tree species and forest types butz et al 2018 niu et al 2017 schoppach et al 2021 yan et al 2016 however there is still no universal conclusion regarding the relationships between sfd sf and tree diameter this issue is illustrated by the different correlations positive negative and uncorrelated found between these variables and by the allometric models linear or nonlinear optimally describing their relationships often changing with tree species forest types and environments jung et al 2011 meinzer et al 2001 niu et al 2017 tsuruta et al 2019 therefore it may not be appropriate to thoughtlessly extrapolate existing findings on the relationships between sfd sf and diameter to that of other different forests most previous studies related to this topic used only averaged data over a short term a few days weeks or months to derive how sf and sfd change with tree diameter meinzer et al 2005 moon et al 2016 phillips et al 1999 leading to uncertainties regarding whether their relationships will vary seasonally and or inter annually this in turn raises another unanswered question whether tree diameter can always explain the tree to tree sf and sfd variations even though tree diameter has been widely proved to be a scalar entity strongly correlated with sap flow metrics as it can reflect the metabolic capacity leaf area and competitive position of trees jung et al 2011 niinemets 2002 oren et al 1998 if tree to tree variations in sf and sfd cannot always be explained by tree diameter the frequently recommended sampling strategies for selecting trees to measure sap flow and the derived allometric models for extrapolating tree transpiration will all need to be revisited and revised unfortunately few efforts have yet been devoted to solving the above questions but see hassler et al 2018 schoppach et al 2021 the mechanisms underlying sf and sfd variations across different sized trees are well understood after many years of study across different regions around the world moore et al 2017 niu et al 2017 oren et al 1998 otieno et al 2014 xiong et al 2008 however unexpectedly there is only a very limited understanding of the mechanisms underpinning the dynamic of tree diameter s relative importance or explanatory power in explaining these tree to tree sf and sfd variations using relative importance analysis the innovative works of hassler et al 2018 and schoppach et al 2021 showed that potential evapotranspiration soil water condition and species specific water use strategies are important factors determining the intra annual dynamics of the degree to which tree diameter explains the variation of sfd unfortunately their findings cannot answer whether these factors are still the critical determinants at different stand development stages or in different years as they collected their data only over less than one year in addition as limited influencing factors were investigated and sf data were not considered in these studies of hassler et al 2018 and schoppach et al 2021 we still do not know if other biotic and abiotic factors can control the power of tree diameter to explain tree to tree variations in sf and sfd on both intra and inter annual scales populus tomentosa as a unique native tree species to china plays a vital role in the development of fast growing high yielding plantation forests on the north china plain ncp as water stress is a crucial limiting factor to the growth of poplar species and water sustainability is seriously threatened on the ncp xi et al 2021 xu et al 2020 adopting a well designed irrigation management regime is essential to maintain and promote the performance of p tomentosa plantations in the context of climate change one of the fundamental premises for developing efficient irrigation regimes is to precisely estimate the stand level transpiration xi et al 2021 the sap flow of p tomentosa has been investigated for multiple purposes including stand transpiration estimation xi et al 2017 di et al 2019b liu et al 2022 but to the best of our knowledge the relationships between diameter and sap flow metrics and the underlying mechanisms have never been studied for this species furthermore such information has not been considered in estimating its stand transpiration and designing its sap flow measurement strategies although relevant research has been conducted in many studies as mentioned above their findings may not apply to the short rotation plantation forests of fast growing and high yield tree species like populus spp as most previous studies are targeted for old pure or mixed forests of 20 years old consequently we conducted a continuous study in 2 to 7 year old p tomentosa plantations with three objectives 1 to investigate the patterns of the relationships between trunk sap flux density sap flux and tree diameter 2 to determine whether and how these relationships would vary intra and inter annually and 3 to reveal the effects of different factors on the power of tree diameter to explain tree to tree sap flow variation on both intra and inter annual scales finally we apply these findings to make recommendations on sap flow measurement and stand transpiration estimation for pure plantations in water limited regions 2 materials and methods 2 1 experimental site and experimental plantations the experiment site was located at the state owned jiucheng forest farm in gaotang county shandong province latitude 36 81 n longitude 116 09 e this site has a very flat terrain with an altitude of about 30 m this region has a semi humid monsoon climate the average annual temperature is 13 4 and the mean annual precipitation was 563 mm from 1981 to 2010 the groundwater level fluctuates relatively stably between 7 and 9 m depths liu et al 2022 the experimental plantation was established in the spring of 2015 with a hybrid poplar clone p tomentosa p bolleana p tomentosa the planting density was 1666 trees ha 1 with 2 0 m within row spacing and 3 0 m between tree rows fig s1 the planted samplings had an average diameter at breast height 1 3 m dbh of 3 cm and an average height of 3 m there were five irrigation management treatments applied with a randomized complete block design fig s1 for each treatment there were five replicated plots these treatments included full and deficit drip irrigation and full and deficit basin irrigation fig s1 one rainfed treatment was also included as a control at the end of march every year i e before leaves appeared irrigation was applied to all treatments to promote budburst in the full and deficit drip irrigation treatments the stands were irrigated in 2016 and 2017 when the soil matric potential under the dripper reached 20 kpa and 45 kpa respectively with the increase in stand age the water consumption of trees increased gradually liu et al 2022 therefore the irrigation threshold of the full drip irrigation treatment was increased to 18 kpa since 2018 we irrigated trees in the full basin irrigation treatment every 5 7 days during the experimental period the irrigation times of the deficit basin irrigation treatment followed the deficit drip irrigation frequency accordingly there are obvious differences in soil water content between different water treatments fig s2 and detailed information on soil water dynamics in different treatments was shown in zou et al 2022 liu et al 2022 and liu et al 2021 the other details of our experimental design can be found in liu et al 2022 and jiao et al 2021 2 2 field experiment measurements 2 2 1 sap flow different sized thermal dissipation td probes dynamax inc tx usa were used to monitor the trunk sap flux density cm s 1 during the growing season april october from 2016 to 2021 in 2016 the td 10 probes 1 cm in length were chosen to measure the sfd afterward the td 30 probes 3 cm in length were selected for measurement from 2017 to 2021 owing to the increase in tree diameter the probes were inserted into the stem sapwood at 1 3 1 5 m above the ground after installation waterproof glue was coated around the probes and then we used foam to fix them and act as thermal insulation finally reflective bubble insulation was wrapped around the probes and the stem the sfd was measured every 10 s and its average value calculated every 10 min was stored in two different types of data loggers cr1000 campbell scientific inc ut usa ilogger beijing sinton technology company beijing china because of limitations on the numbers of probes available for measuring sfd the numbers of sample trees selected from the third or and fourth block in different treatments fig s1 were 4 5 in 2016 2018 3 9 in 2019 3 10 in 2020 and 6 28 in 2021 basic information on the sample trees is shown in table 1 the sfd was estimated using the empirical equation eq 1 given by granier 1987 1 sfd 0 0119 δ t m a x δ t δ t 1 231 where δt is the temperature difference between the heated and reference probes and δt max is the maximal temperature difference between these two probes δt max was acquired from the maximal daily δt max during a period of every 7 10 days to avoid neglecting night time sap flow lu et al 2004 the temperature difference data were processed by the baseliner software oishi et al 2016 from 2016 to 2019 100 trees from different treatments were harvested for biomass measurement liu et al 2022 so that we had an opportunity to measure the dbh bark thickness and heartwood diameter at different heights of the stem sapwood area sa cm2 is part of the wood between bark and heartwood according to lu et al 2004 sapwood can be determined by examining the natural macroscopic features such as color in p tomentosa the wood color generally changes from light sapwood to brown heartwood thus the sapwood area can be easily obtained by subtracting the heartwood area from the cross sectional area of the trunk without bark then the 202 sets of data obtained were used to establish an allometric equation between sa and trunk diameter fig 1 which was applied to calculate the sas of all sample trees finally the sap flux sf l d 1 of each tree was obtained by the product of sfd and sa eq 2 2 sf s f d s a the sfd measured using td probes can be influenced by many error sources such as wounding radial velocity profile and wood properties clearwater et al 1999 lopez et al 2019 wiedemann et al 2016 therefore it has been found in many studies that sfd can be over or under estimated to different degrees flo et al 2019 fuchs et al 2017 wiedemann et al 2016 however the present study focused only on the relationships between sfd sf and dbh and not on the accurately absolute values of sfd and sf so any systematic estimation and measurement errors would not affect the results 2 2 2 meteorological factors the meteorological factors including global solar radiation r s mj m 2 day 1 air temperature relative humidity and precipitation mm day 1 were measured using a weather station at our study site all the data were measured every 10 min and stored in a data logger dl2 data logger delta t devices ltd cambridge uk the measured total precipitation values during the growing season were 585 449 700 487 467 and 784 mm in 2016 2017 2018 2019 2020 and 2021 respectively the measured data were also used to calculate the reference crop potential evapotranspiration eto mm d 1 using the fao 56 penman monteith equation eq 3 allen et al 1998 3 e t o 0 408 δ r s g γ 900 t 273 u 2 e a e d δ γ 1 0 34 u 2 where is the slope of the saturation pressure versus temperature function kpa 1 g is the soil heat flux mj m2 d 1 t is the daily average temperature γ is the psychometric constant kpa 1 u 2 is the wind speed m s 1 e a is the saturated vapor pressure kpa e d the actual vapor pressure difference kpa 2 2 3 leaf area index and soil water content the leaf area index lai m2 m 2 of each plot of all treatments fig s1 was measured regularly at sunset by the lai 2200c plant canopy analyzer pca li cor inc lincoln usa other details of the lai measurements are given in liu et al 2022 in the third and fourth replicated plots of both the full drip irrigation and rainfed treatments soil water content θ cm3 cm 3 was monitored using the tube probes gs301 sinton technology ltd beijing china installed at 30 and 120 cm distances from the tree the measurement points were set to 10 30 60 100 150 200 250 300 350 400 450 500 and 550 cm depths the data were measured with a frequency of every 30 min and were stored in a data logger g30 sinton technology ltd beijing china the collected data were then used to calculate the soil water availability r θ using eq 4 4 r θ θ θ min θ max θ min where θ max and θ max are the maximum and minimum θ measured in all treatments during 2019 2021 respectively 2 3 data analysis to increase the sample number for data analysis all data from the five irrigation management treatments fig s1 were used to investigate the relationships between sf sfd and dbh except those of the two basin irrigation treatments in 2018 and that of the deficit basin irrigation treatment in 2019 owing to some data quality problems however the difference in θ among treatments caused by various irrigation regimes might influence the results fig s2 to eliminate this influence only the data under adequate soil water conditions in all treatments were selected for most analyses to be specific firstly the data on rainy days and one to five days depending on the precipitation after rainfall were selected as it was considered that rainfall would ensure that tree transpiration in all treatments was not constrained by soil water deficit in the short term secondly the data during the initial growing period were also used for analysis i e 6 to 10 april in 2017 and 1 to 10 april for later years because transpiration during this period was also not restricted by soil water owing to the budburst promotion irrigation see section 2 1 and the low transpiration rates liu et al 2022 thirdly the data in the rainy season 1 july to 31 august were also included for analysis as the frequent rainfall events in the rainy season can guarantee trees in all treatments were under well water conditions linear or nonlinear regressions were conducted to investigate the relationships between sf sfd and dbh on the daily annual and whole experimental period six year scales here it should be noted that for each tree all its daily sf and sfd data under the aforementioned adequate soil water conditions in a year were averaged for analysis on the annual scale in contrast we selected the data covering three days with maximum sf and sfd for each sample tree in each year and then combined these to do the analysis over the whole experimental period scale the determination coefficients r2 of these regression lines and curves were used to indicate the explanatory power q of dbh for tree to tree variations in sf q sf and sfd q sfd hereafter this r2 is referred to as the explanatory power of dbh we used the value of eto lai to indicate the potential transpiration demand t pot mm of trees when calculating t pot on the daily scale the daily lai obtained by interpolation and the daily eto were used while on the annual scale the total eto and daily mean lai during the growing season were used here the lai was the average value of five treatments in addition the r θ and growing season precipitation values were used to indicate the environmental water supply on the daily and annual scales respectively then we used linear or nonlinear regression analyses to determine the effects of various factors stand age t pot r θ and precipitation on the intra or inter annual variations of the r2 i e the explanatory power of dbh mentioned above which represented their impacts on the relationships between sfd sf and dbh when analyzing the effect of t pot on the intra annual variation of q the data during the adequate soil water condition period excluding rainy days were selected to avoid the impacts of soil water deficit and rainfall in contrast for the impact of r θ we used the data throughout the whole growing season i e rather than using only the data from the adequate soil water condition period and this analysis was conducted under both long term high and long term low soil water conditions for which purpose we used only the data from the full drip irrigation i e high soil water condition and rainfed low soil water condition treatments in 2021 fig s1 this was because the numbers of sample trees in these two treatments were large n 10 in 2021 and there was an enormous difference in soil water condition between these two treatments throughout the whole root zone fig s3 to investigate whether the long term soil water status influences the relationship patterns between sf sfd and dbh the linear or nonlinear regressions were first used to fit these relationships in the full drip irrigation and rainfed treatments fig s1 then an f test was applied to detect if there were significant differences between treatments in the slope of the fitted line and or the parameters of the fitted curve in addition we used the coefficient of variation cv to analyze the variability of sf and sfd among different sized trees our data analyses were conducted in originpro 2022 originlab corporation ma usa 3 results 3 1 sapwood area to dbh relationship and tree to tree sap flow variation the sapwood area of p tomentosa was positively correlated with the dbh p 0 001 fig 1 their relationship could be simulated well with a power function with the dbh explaining 99 of the variation in sapwood area seasonal variation of the cv of the sap flow among trees was similar in different years fig s4 the cvs of sf and sfd changed dramatically within the growing season with their values being always large at the beginning and at the end of the growing season but varying within a relatively stable and narrow range at other times except on occasional days the annual mean sap flow cv also changed with the year but the degree of change was much less than that within the growing season data not shown there were significant linear relationships between stand age and the annual average cvs of both sfd r2 0 661 p 0 049 and sf r2 0 793 p 0 017 3 2 patterns of the relationships between sf sfd and dbh patterns in the relationships between sfd sf and dbh changed markedly over the years fig 2 the annual average sf was not correlated with dbh in 2016 but their relationship became nonlinearly positive after that and could be modeled by a power function p 0 001 although there was a linear relationship p 0 05 between the annual average sfd and dbh in 2018 and 2021 fig 2c f these variables were not correlated in other years fig 2a b d e in contrast when using all data from the six years 2016 2021 for analysis the nonlinear scaling of sf with dbh could still be well described by a power function r2 0 657 p 0 0001 but no relationship was detected between sfd and dbh p 0 05 fig s5 in addition there were no significant differences p 0 05 between high full drip irrigation treatment and low rainfed treatment soil water conditions in the fitted curves for the sf to dbh relationship or in the fitted lines for the sfd to dbh relationship fig s6 this suggests that the long term difference in root zone water status did not influence the scaling relationship between sap flow and dbh on an annual scale 3 3 dynamics of the power of dbh to explain tree to tree sf and sfd variations the sizes of the sf and sfd changes among trees explained by dbh each day showed distinct intra annual variations fig 3 in 2016 2017 dbh significantly explained the tree to tree variation of sf only in a few cases p 0 05 fig 3a b in contrast in each year from 2018 to 2021 the sf variation among trees could always be significantly explained by dbh p 0 05 except at the beginning and the end of the growing season fig 3c f whereas dbh significantly explained the variation in sfd among trees p 0 05 over most of the growing season only in 2018 and 2021 fig 3c f both the averaged q sf 6 71 and q sfd 3 48 over the growing season showed enormous inter annual variation without apparent regularity but dbh was always better at explaining sf than sfd except in 2016 fig 4 3 4 relationships between different factors and intra annual variation in the explanatory power of dbh the influence of t pot on q sf changed considerably with year having no effect in 2021 p 0 873 a linear negative effect in 2016 p 0 024 but being linearly or nonlinearly positive in 2017 2020 p 0 001 fig 5 additionally the significant influence of t pot was very weak in 2016 r2 0 085 and 2017 r2 0 236 fig 5a b it became much stronger in 2018 2020 r2 0 532 0 911 when q sf first increased with t pot but remained stable after t pot reached a critical value fig 5c e no relationship was detected between t pot and q sfd in 2016 p 0 757 2020 p 0 777 or 2021 p 0 103 fig 5a e f however q sfd showed a slightly linear increase with t pot in 2017 p 0 014 fig 5b while in 2018 q sfd firstly increased with t pot but then decreased gradually with it p 0 001 fig 5c unexpectedly a different phenomenon was found in 2019 when q sfd firstly decreased with t pot and then remained stable p 0 001 fig 5d under both high i e drip full irrigation treatment and low rainfed treatment soil water conditions r θ in all soil layers exhibited no apparent relationships with the intra annual variations of either q sf or q sfd fig 6 3 5 relationships between different factors and inter annual variation in the explanatory power of dbh the inter annual variations of neither q sf nor q sfd were influenced by stand age p 0 05 or by t pot p 0 05 fig 7 a b in contrast q sfd increased linearly with rainfall in the growing season p 0 005 fig 7c q sf also showed an increasing trend with precipitation but this relationship was statistically significant p 0 012 only when the data from 2016 were excluded fig 7c 4 discussion 4 1 dynamics of the tree to tree variation in sap flow the stand specific variation in sf and sfd is one of the major uncertainties in estimating stand transpiration by the thermal based sap flow method kumagai et al 2005 our results from p tomentosa showed that the variability i e cv of sap flow among trees had a larger intra annual than inter annual change fig s4 meanwhile the significant linear relationship between stand age and sap flow mean cv indicated that the average tree to tree sap flow variation tended to be larger in older p tomentosa stands probably because of the increasing differentiation among trees this finding was consistent with the comparison between young and old forests made by moore et al 2004 additionally relative to other studies the mean cvs of both sf 0 41 0 73 in different years and sfd 0 39 0 51 of p tomentosa were very large ballester et al 2011 hadiwijaya et al 2020 moon et al 2016 moore et al 2004 shinohara et al 2013 xiong et al 2008 which was especially true with similar sample tree numbers moon et al 2016 shinohara et al 2013 xiong et al 2008 this phenomenon might be attributed to the more intensive inter tree competition in our stand brought by high planting density fast spreading of both canopy and root systems and the high water and nutrient demands of poplar trees coleman and aubrey 2018 li et al 2021b liu et al 2022 4 2 effects of different factors on the temporal variation in the explanatory power of dbh it is still poorly understood whether and how the relationship between sap flow and tree diameter will change intra and inter annually in theory their relationship should possess temporal variation as many factors that influence sap flow e g meteorological factors leaf area and stomatal conductance and stand and hydraulic structure change enormously with season and year chiu et al 2016 li et al 2021a niinemets 2002 this hypothesis has been verified in a few studies moon et al 2016 niu et al 2017 for example niu et al 2017 found that the slope of the linear sf dbh relationship was higher in young than in old rubber plantations an opposite result was observed in a temperate mixed forest where the monthly differences in both the slope and intercept of the sfd and sf to dbh relationships were non significant chiu et al 2016 consistent with the former case we found that the sap flow to dbh relationship showed extensive inter and intra annual variations in terms of both the relationship pattern fig 2 and the r2 i e the dbh explanatory power of the fitted line or curve figs 3 4 this finding emphasizes that the high variability of the sap flow to dbh relationship should be considered when designing a sap flow measurement strategy and when upscaling individual tree sap flux measurements to stand transpiration the intra annual dynamic of the power of dbh to explain tree to tree variation in sfd has proved to be species specific mainly because of species specific water use habit and physiological responses to environmental change hassler et al 2018 schoppach et al 2021 in most years of our study q sfd was low both at the inception early season and late at the end of the growing season but remained relatively high at other times fig 3b c e f this was similar to findings for oak and conifers in temperate forests schoppach et al 2021 unexpectedly our observed intra annual q sfd and q sf variations were not influenced by r θ in any soil layer even under long term low soil water conditions fig 6 fig s3 which phenomenon was also found in a temperate mixed forest hassler et al 2018 and in beech schoppach et al 2021 however the intra annual variations of both q sfd and q sf could be controlled by the potential transpiration demand i e t pot but this control changed annually fig 5 in 2016 i e before canopy closure because all trees were fully exposed to radiation and the tree differentiation was very low dbh explained only a small portion of the tree to tree sfd variation all the time so that its explanatory power q sfd did not change with t pot fig 5a otieno et al 2017 ringgaard et al 2012 in 2017 the stand canopy closed in early summer and afterward there was some minor mutual shading thus larger trees with slightly higher radiation and vapor pressure deficit vpd exposure and leaf area could have slightly higher sfd values after early summer otieno et al 2017 ringgaard et al 2012 this slight sfd advantage of larger trees would increase under higher t pot consequently leading to the slightly increasing q sfd with t pot i e dbh explained more tree to tree sfd variation under higher potential transpiration demand fig 5b a similar phenomenon was also observed in temperate mixed forests hassler et al 2018 schoppach et al 2021 by 2018 the larger trees advantage in radiation and vpd exposure and their stronger competitive capacities for abundant shallow soil water because of their higher root density in the shallow layer brought by high precipitation 700 mm could jointly maintain their higher sfd values fig 2c coleman and aubrey 2018 li et al 2017 however relative to smaller trees the embolism or water transport resistance in larger trees xylem might have a greater possibility for increase under high t pot owing to the coupling effects of their longer water transport path and higher water demand this might result in the sfd difference between larger and smaller trees becoming smaller under high t pot than under moderate t pot consequently decreasing the power of dbh to explain tree to tree sfd variation under high transpiration demand this mechanism could explain the unimodal variation of q sfd with t pot in 2018 fig 5c owing to the potential accumulated xylem embolism and the low precipitation 487 mm in 2019 larger trees might have adopted a tighter stomatal regulation strategy to protect themselves from hydraulic failure therefore with increasing t pot the increase in larger trees sfd might have been slower so that the difference in sfd between larger and smaller trees decreased gradually this could explain the phenomenon in 2019 in which q sfd firstly decreased gradually with t pot and then remained stable at a very low level fig 5d with the continuously increasing degree of xylem embolism the sfd of larger trees in 2020 the driest year seemed to be limited even when the potential transpiration demand was still low consequently resulting in very small q sfd throughout the growing season and no variation of q sfd with t pot fig 5e with the arrival of heavy rainfall in 2021 784 mm their better ability to compete for abundant shallow soil water might have ensured that larger trees always had higher sfd under any t pot condition fig 2f however the very severe mutual shading might have eliminated the larger trees advantages in radiation and vpd exposure so that q sfd was not influenced by t pot anymore fig 5f the above findings imply that the variations in stand structure tree hydraulics and below ground competitive power with stand development might jointly determine the influence of t pot on the intra annual change of q sfd the influence of t pot on q sf was strongly related to its effect on q sfd because sf was calculated from sfd in 2016 q sf was not related to q sfd fig s7 in later years there was a positive linear correlation between q sf and q sfd except in 2019 when this relationship became negative and in 2020 when any correlation disappeared fig s7 these results could explain the different impacts of t pot on the intra annual variations of q sf and q sfd fig s7 additionally the inter annual variations in neither q sf nor q sfd were determined by stand age and t pot but both could be strongly affected by the precipitation fig 7 4 3 variation in the relationship pattern between sap flow and tree diameter there are reported large differences in previously observed sfd dbh relationship patterns which include non correlation otieno et al 2014 tsuruta et al 2019 negative meinzer et al 2001 niu et al 2017 or positive correlations chiu et al 2016 jung et al 2011 in our study both no and positive correlations existed with the former appearing in most years fig 2 meanwhile in contrast to the weakly positive sfd dbh correlation often found in many other studies chiu et al 2016 jung et al 2011 moon et al 2016 our observed positive linear correlations in 2018 and 2021 were very strong fig 2c f furthermore when we reanalyzed the result using a large dataset of 118 trees collected over six years sfd was also not correlated with dbh fig s5 firstly these findings demonstrated that the sfd dbh relationship pattern of p tomentosa possesses great inter annual variation and this relationship pattern could be either insignificant or significant even for the same tree species which phenomenon has also been found in other forests niu et al 2017 thorburn et al 1993 secondly our results indicate that the differences in sample tree numbers and datasets may influence the detected sfd dbh relationship patterns which agrees with the findings from some subtropical and tropical forests berry et al 2017 phillips et al 1999 tsuruta et al 2019 additionally and unexpectedly we found no significant difference in the sfd dbh relationship between long term high and long term low soil water conditions fig s6 this phenomenon might have been due to the high precipitation eliminating the potential difference in inter tree water competition intensity between contrasting soil water conditions by bringing similar water availability into shallow soils with dense roots during most of the growing season fig s3 different sf dbh relationship patterns were also found in various studies but in the vast majority of cases sf was positively and nonlinearly correlated with dbh chiu et al 2016 jung et al 2007 meinzer et al 2005 niu et al 2017 yan et al 2016 consistent with this in our study there was a nonlinear relationship between sf and dbh for p tomentosa in all years except 2016 fig 2 the sf is a product of sfd and sapwood area sa with the latter being calculated from dbh so its relationship with dbh is simultaneously controlled by the relationships between dbh and both sfd and sa berry et al 2017 chiu et al 2016 mcjannet et al 2007 tsuruta et al 2019 however it was still unknown from previous studies whether their control degrees could change with stand development our long term study of six years provided an opportunity to address this question according to our results before stand canopy closure 2016 the sfd dbh relationship no correlation had a stronger influence on the sf dbh relationship no correlation which could be attributed to the tree to tree sa variability being small but that of sfd being large table 1 fig 2a however after the closure of the canopy which occurred in the early summer of 2017 the sa dbh relationship started to mainly affect the scaling of sf with dbh which was consistent with the findings from other pure forests at the canopy closure stage tsuruta et al 2019 xiong et al 2008 it can be reflected by the fact that the relationship between sf and dbh mainly followed that between sa and dbh fig 2b f fig 1 additionally the sf dbh relationship became much stronger in wet years 2018 2021 when dbh significantly influenced the tree to tree sfd variation fig 2c f consequently our findings highlight that the relative influences of the sfd dbh and sa dbh relationships on the scaling of sf with dbh strongly depend on stand development and the hydro meteorological conditions what kind of model will best describe the widely observed nonlinear relationship between sf and dbh is still inconclusive but this is crucial for stand transpiration estimation the form of the model will significantly influence estimation of the transpiration of large trees berry et al 2017 based on the sap flow data of 65 trees from multiple tree species in temperate and tropical forests meinzer et al 2005 concluded that sigmoid functions rather than power functions may be universally applicable for describing the scaling of sf with tree diameter this suggested sigmoid trajectory is also supported by the size dependence of other biological processes e g growth photosynthesis and respiration that diminish when trees grow above a size threshold meir and grace 2002 mcdowell et al 2002 niinemets 2002 also the sigmoid function seems to better approximate the sf dbh relationship from the biologically meaningful perspective as it will not predict an indefinite increase of sf with dbh although the sigmoid trajectory of sf with increasing dbh has been confirmed by the model results of berry et al 2017 for a multiple species forest such a relationship was rarely found in many other cases including forests with multiple and single tree species moore et al 2017 otieno et al 2017 yan et al 2016 similarly we also did not observe an asymptotic relationship between sf and dbh in our p tomentosa plantations even when using the data of 118 trees for analysis fig s5 in contrast the power function described the sf dbh relationship of p tomentosa well as was also widely found for other tree species jung et al 2007 moore et al 2017 otieno et al 2017 yan et al 2016 the limited range of dbh might influence our discovery of the asymptotic sf dbh relationship however it was also not observed in other studies even when there was a vast dbh range of 116 cm moore et al 2017 therefore further validation is still needed in different forest ecosystems especially in pure forests to confirm whether there really exists an asymptotic relationship between transpiration and indices of plant size 4 4 implications for sap flow measurements and stand transpiration upscaling based on the findings in this study we provide the following recommendations on sap flow measurement strategy and stand transpiration upscaling for pure plantations in water limited regions 1 before the closure of the canopy and in the year when it just happens there is no need to consider the difference in tree diameter when selecting trees for sap flow measurement after canopy closure for rainfed plantations in wet years and always for fully irrigated plantations tree diameter difference should be taken into account however for rainfed plantations in dry years it may not need to be considered note that this suggestion is only applicable to cases where stand transpiration estimation is not the study objective 2 during wet years at the canopy closure stage the sf dbh model derived in stands under different soil water conditions can be used mutually to predict individual trees transpiration and stand transpiration upscaling this approach was demonstrated to be reasonable by our comparison results in the full drip irrigation and rainfed treatments method 1 in fig s8 the trees used for developing the model should cover as wide a diameter range as possible 3 the sf dbh model established in wet years is suggested to be used for stand transpiration upscaling however the model developed in dry years should be used with caution owing to its possibly low determination coefficient such as in our case in 2019 2020 fig 2d e 4 the dbh power to explain tree to tree sap flux variation has large intra annual variation therefore a dynamic sf dbh model i e develop the model for each day should be developed for precisely upscaling stand transpiration on a daily basis but do not apply this model at the start or the end of the growing season because of the possibly low determination coefficient e g our case in 2018 fig 3c 5 before canopy closure or in dry years the approach method 2 in fig s8 of multiplying the mean sap flux densities of sample trees by the total sapwood area of all trees in a stand might be a better choice for estimating stand transpiration because during these stages the sf dbh relationship may be very weak e g our case in 2016 and 2019 fig 2a d however during wet years after canopy closure applying the sf dbh model for stand transpiration upscaling method 1 might be the optimal choice in our study the prediction error of method 1 was much lower than that of method 2 fig s8 5 conclusions to the best of our knowledge the present study is the first that uses extremely long term six year sap flow data to investigate the relationships between sap flow metrics and tree diameter and their influencing factors our results demonstrated that tree to tree sap flow variation was very high in short rotation poplar plantations and this variability would increase with stand development the power of tree diameter to explain tree to tree variation in sap flow exhibited large intra and inter annual variations which were determined by different mechanisms the potential transpiration demand of trees mainly determined the intra annual variation of the tree diameter s explanatory power but its effect depended on stand development in contrast the environmental water supply mainly controlled the inter annual variation of the explanatory power of the diameter the relationship pattern between sap flow and diameter also possessed large inter annual variation in addition before stand canopy closure the sfd dbh relationship had a stronger influence on the scaling of sf with dbh however after the full closure of the canopy it was mainly influenced by the sa dbh relationship to sum up our findings will be helpful for precisely predicting stand water use in plantation forests of both poplar and other tree species declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgements this research was jointly supported by the national key research and development program of china grant no 2021yfd2201203 and the national natural science foundation of china 32171763 appendix a supplementary data supplementary data to this article can be found online at https doi org 10 1016 j jhydrol 2023 129189 appendix a supplementary data the following are the supplementary data to this article supplementary data 1 supplementary data 2 
2212,the development and application of reliable hydrological models are challenging in ungauged or poorly gauged catchments although several regionalization methods have been developed for predicting hydrological variables in ungauged catchments a large uncertainty usually exists in the prediction because previous methods typically depended on several static catchment attributes or long term mean climatic descriptors thereby neglecting the spatiotemporal variability of the climate in this study we propose a new regionalization method called sediment response similarity srs using the soil and water assessment tool model and self organizing maps to estimate sediment load in ungauged catchments considering spatiotemporal variability and the sediment load relation to rainfall characteristics of individual catchments the performance of srs was evaluated by comparing it against the conventional regionalization method i e physical similarity and calibration model results in four gauged catchments of the lower mekong river basin the srs method showed improved performance over the conventional approach in estimating sediment loads with an average nash sutcliffe efficiency nse and coefficient of determination r2 of 0 75 and 0 76 respectively which were close to the respective values of nse and r2 0 77 of the calibration model additionally the srs approach showed an error reduction of up to 7 compared with that of the physical similarity method indicating the potential of the proposed regionalization method in estimating catchment wide sediment load in ungauged catchments the findings indicate that the srs method ideally determines the similarity of sediment loads between gauged and ungauged catchments the srs approach effectively tackled the main challenge of selecting catchment attributes in the conventional regionalization method and minimizing the uncertainty of sediment prediction in ungauged catchments this novel srs method is a promising method for estimating not only sediment load but also other hydrological variables and rainfall driven phenomena in the ungauged catchments globally keywords sediment response similarity regionalization swat model som ungauged catchment the tonle sap lake basin data availability data will be made available on request 1 introduction ground monitored and satellite based hydrometeorological and water quality datasets play vital roles in developing reliable hydrological models for regional environmental assessments of land use change and anthropogenic threats such as climate change ang et al 2022 guo et al 2020 zhao et al 2022b however the sparse and uneven distribution of hydrometeorological and water quality monitoring stations typically found in developing countries hinders the development of reliable hydrological models and accurate simulations of the hydro environmental impacts ang et al 2022 to solve this problem a common method known as regionalization in which hydrological information model parameters from well monitored catchments donors are transferred to ungauged or sparsely gauged catchments receptors is used to predict the time series of hydrological variables such as streamflow and sediment load several regionalization methods have been developed for modeling hydrological variables especially for runoff simulation in ungauged catchments the most common regionalization approaches include physical similarity ps spatial proximity spx arithmetic mean am and regression based approach rg guo et al 2020 heng and suetsugi 2014 tegegne and kim 2018a zhao et al 2022a in the ps approach one or more donor catchments with similar physical characteristics i e climate land use and geological conditions to ungauged catchments are identified subsequently a complete parameter set from the donor catchment is transferred to the corresponding ungauged catchment asurza véliz and lavado casimiro 2020 guo et al 2020 the performance of this technique depends on the selection of descriptors to explain the similarity the spx approach assumes that the nearby catchments should have similar characteristics and hydrological behaviors and the entire parameter set is transferrable from the neighboring donors to the ungauged catchment by interpolation or averaging swain and patra 2017 however the model performance is inaccurate if strong heterogeneity is not present in the catchment characteristics as assumed parajka et al 2005 in the am approach each calibrated model parameter from gauged catchments located in a given region is averaged and then transferred to the ungauged catchments in the same region consequently the value of each corresponding parameter is identical for all ungauged catchments which might not be realistic for heterogeneous catchments tegegne and kim 2018 the rg method aims to find the relationships between catchment attributes and model parameters calibrated in the gauged catchments the established relationships are further used to quantify the model parameters for ungauged catchments heng and suetsugi 2014 oudin et al 2008 heng and suetsugi 2014 zhang and chiew 2009 mentioned that the equifinality problem of model parameterization is a major weakness of this method since different groups of model parameters could also provide similar model outputs they added that the values of calibrated parameters depend on the input datasets and parameterization techniques i e input errors and data inadequacies will lead to highly uncertain model parameters numerous studies have compared the performance of different regionalization approaches for modeling streamflow and sediment in river basins and have reported the outperformance of the ps and spx approaches over other regionalization methods guo et al 2020 heng and suetsugi 2014 oudin et al 2008 parajka et al 2013 2005 tegegne and kim 2018 zhang and chiew 2009 heng and suetsugi 2014 compared three regionalization approaches ps rg and spx to estimate sediment rating curves in ungauged catchments for predicting instantaneous suspended sediment yield in 16 catchments of the lower mekong river basin lmrb they found that the ps approach provided the best performance while the spx technique produced the least effective regionalization solution owing to a sparse network of monitoring stations in the study area parajka et al 2005 conducted runoff modeling across 320 austrian catchments and revealed that the ps and spx approaches perform similarly and were close to the calibration results oudin et al 2008 compared three regionalization methods ps spx and rg for runoff modeling in 913 catchments in france and found that wherever a dense network of gauging stations was available the spx provided the best regionalization solution while the performance of ps approach is intermediary parajka et al 2013 compared four regionalization techniques i e ps spx am and rg for runoff prediction based on a review of 34 past studies for 3 874 catchments results indicated a lower performance of the rg method than other methods used in those studies additionally it was found that the spx and ps techniques performed best in humid catchments while the ps and rg methods performed slightly better in arid catchments however in studies with dense streamflow gauge networks there was a tendency for the spx technique to outperform the rg and am methods parajka et al 2013 a common conclusion from this research is that the spx approach has a relatively enhanced performance when dense streamflow gauge networks are available in other conditions the ps method is more likely to provide the best regionalization solution for the hydrological estimation of ungauged catchments the ps method assumes that the similarity in the input attributes e g such as rainfall land use and geological conditions between gauged and ungauged catchments is connected to the corresponding similar responses such as sediment or runoff however the relationship between the inputs and outputs can be inherently different between gauged and ungauged catchments owing to the spatiotemporal variability of the hydrologic process in individual catchments tegegne and kim 2018 moreover the proximity among catchment centroids introduced in the spx method is not necessarily translated into hydrologic similarity kokkonen et al 2003 to overcome the problems associated with the spx and ps methods tegegne and kim 2018 proposed the new catchment runoff response similarity crrs regionalization method to identify the attributes of a critical catchment and more accurately represent the hydrological similarities the crrs is based on the idea that catchments with similar runoff responses have similar hydrological processes and therefore similar model parameter values the crrs outperformed other regionalization methods including the next best regionalization approach the ps method with 10 14 and 4 7 during the calibration and validation tests respectively tegegne and kim 2018 overall the regionalization approaches examined in previous studies assume that the catchment classification or clustering is possible based on several static catchment descriptors i e land use and geological conditions with long term mean climatic descriptors e g mean annual rainfall or a combination however spatiotemporal variability in climate within the catchment is neglected samaniego et al 2010 wagener et al 2007 also found that the prediction of hydrological variables streamflow and sediment load in ungauged catchments is a challenging task primarily because the hydrologic processes occurring within a catchment occur over a wide range of spatiotemporal scales therefore catchment attributes descriptors that represent the spatiotemporal variability of climate and hydrological process in gauged and ungauged catchments are required for the regionalization of catchments therefore in this study a new regionalization method was proposed this sediment response similarity srs method aims to find appropriate attributes that can ideally transfer the response of gauged catchments associated with sediment erosion and transport to that of ungauged catchments considering spatiotemporal variability of the hydrologic processes occurring within the catchments the method was developed by using a conventional regionalization method an am and two statistical indices of catchment attributes the coefficient of variation cv and correlation coefficient r these describe the spatiotemporal variations of sediment response and its relationship with rainfall characteristics in gauged and ungauged catchments the values of these indices can characterize and compare the sediment response behavior in terms of catchment attributes between gauged and ungauged catchments briefly the srs steps are as follows 1 apply the am regionalization approach to transfer the calibrated parameters used in the soil and water assessment tool swat model from the gauged to ungauged catchment and simulate model output i e sediment response 2 calculate the cv for observed rainfall input and the simulated sediment response obtained in the first step and calculate the r between the rainfall and the sediment response for each gauged and ungauged catchment 3 identify the catchment clusters gauged and ungauged catchments which are based on the sediment response similarities using the similar cv and r values 4 update the final parameter values from the same clusters from the gauged to ungauged catchments i e similar sediment responses represented by the cv and r values and 5 rerun the swat model to simulate the time series of sediment load in the ungauged catchments to examine the validity and effectiveness of this proposed srs approach the method was applied to tributary basins located in the lmrb the performance of the srs method was compared with the conventional regionalization method i e physical similarity finally the sediment load time series was estimated using the srs method for the ungauged tributaries of the tonle sap lake tsl basin a sub basin of the lmrb which has a limited number of monitoring stations the paper structure is as follows first the methodology is explained followed by the study area results and discussion and conclusions 2 materials and methods 2 1 hydrological model setup fig 1 top dash box shows the framework of the swat model setup section 2 5 first the spatial and meteorological data were input into the swat model to set up hydrological models for both gauged and ungauged catchments next the whole catchment was delineated into sub catchments the sub catchment boundaries were delineated based on information from the digital elevation model dem for the area a combination of land cover slope soil properties and management practices of the sub catchments was classified and overlaid to form hydrologic response units hrus therefore the gauged and ungauged sub catchments were clustered using srs section 2 2 1 and ps section 2 2 2 regionalization methods 2 2 regionalization methods 2 2 1 sediment response similarity in this study the new srs regionalization method was based on a two phase approach of transferring parameters fig 1 in the first phase the conventional regionalization methods were used to tentatively transfer the calibrated model parameters from the gauged to ungauged catchments the am regionalization method was used in this study because the number of gauged catchments is insufficient in the two case study basins see fig 3 the number of ungauged receiver catchments will be too high compared to the number of donor catchments if the catchment clusters were to be identified based on the ps or spx approaches owing to the differences between donor and receiver catchments however the ps or spx approaches can be used to tentatively transfer model parameters from gauged to ungauged catchments where there are many donor catchments the second phase of the parameter transfer approach was based on srs the catchments with similar rainfall characteristics and sediment responses are considered hydrologically similar once similar catchments were identified the final parameter values of each gauged catchment were transferred to the ungauged catchments the similarity of runoff response and sediment load simulated in the model implies that dominant hydrological processes within a particular ungauged catchment are well incorporated into the model consequently the regionalization methods that consider the similarity in the rainfall characteristics and the sediment load response as the main attributes could reduce the hydrologic uncertainty in the predicted results of the ungauged catchments tegegne and kim 2018 the hydrological processes within a catchment occur over a wide spatiotemporal scale therefore catchment attributes that represent the spatiotemporal variability of climate and hydrological processes in the catchments are required for the regionalization of catchments the cv index is a statistical measure of the dispersion of data points in a data series around the mean and it is beneficial when comparing the degree of variation from one data series to another even if the means are considerably different brown 1998 the r index measures the strength of the statistical relationship or a linear association between two variables the cv and r indices describe the spatiotemporal variations of sediment response and the relationship with rainfall characteristics in gauged and ungauged catchments this can partially characterize the unique sediment response behavior of each catchment therefore the cv and r indices could be ideal catchment attributes for identifying srs in long term spatiotemporal variations between gauged and ungauged catchments the detailed and systematic procedures of the srs method are summarized in five steps fig 1 as follows step 1 during the first phase the am regionalization approach was applied to tentatively transfer the calibrated parameters used in the swat model from the gauged to ungauged catchment and simulate model output such as sediment response or load step 2 in the second phase the daily sediment load for each sub catchment simulated in step 1 is normalized by the corresponding sub catchment area the index values of cv of daily rainfall normalized sediment load and r between daily rainfall and normalized sediment load were then calculated for each sub catchment step 3 the self organizing map som section 2 3 clustering technique was used to identify similar sub catchments using the daily time series cv and r index values computed for each sub catchment see figs 4 and 5 step 4 the model parameters for the ungauged catchments were updated with the final parameter values from the gauged catchments in the same cluster this means that similar sediment responses or cv and r values were considered step 5 finally the swat model was rerun to simulate the sediment load time series in the ungauged catchments 2 2 2 physical similarity the ps method is one of the best performing regionalization solutions reported in previous studies guo et al 2020 heng and suetsugi 2014 oudin et al 2008 parajka et al 2013 2005 tegegne and kim 2018 zhang and chiew 2009 among others it was used for comparison against the performance of the srs method the ps approach assumes that catchment physiographic characteristics predetermine the hydrological behavior the catchment descriptors or attributes are generally used to define the similarity and are related to the topography land cover and soil type of the catchment in this study the area weighted catchment slope the universal soil loss equation usle the land cover and management factor cusle and the usle soil erodibility factor kusle were used in previous studies these attributes were considered the main drivers of hydrological responses in different catchments merz and blöschl 2004 tegegne and kim 2018 the area weighted average value of each catchment attribute of each sub catchment was computed as follows 1 ca i area ratio ca 1 area ratio ca 2 area ratio ca m where ca is a catchment attribute value i e cusle kusle and slope i is the number of sub catchments the area ratio is the area occupied by the corresponding catchment attribute divided by the total area of the sub catchment i and m denotes different land use types soil types and slope classes for cusle kusle and slope respectively table s1 presents the cusle and kusle values of different land use and soil types respectively which were retrieved from the swat land use and soil type databases ang et al 2022 the slope percentage of each sub catchment was calculated from the dem input data see table 2 the schematic framework of the ps method is illustrated using that of the srs approach in fig 1 first the area weighted slope cusle and kusle values of gauged and ungauged sub catchments were computed and inputted into the som algorithm the som clustering technique was then used to identify similar cluster sub catchments using the area weighted slope cusle and kusle of each sub catchment see figs 4 and 5 finally the model parameters for the ungauged catchments were transferred from similar gauged catchments to simulate the time series of sediment load in the ungauged catchments this simulated time series from the ps approach was compared with that from the srs method to evaluate the srs method s performance 2 3 self organizing map an som is an unsupervised learning algorithm based on artificial neural networks used to cluster and visualize the structure of high dimensional data sets kohonen 1990 1982 an som consists of input and output layers linked by weightings fig 2a the input layer is formed by a set of nodes consisting of input vectors fig 2a and the output layer is formed by nodes arranged in a two dimensional 2 d grid map this 2 d grid map also called the unified distance matrix or u matrix shows the data similarities by grouping similar data into the same clusters as indicated by the same numbers inserted in the grids shown in fig 2b in this study the values of cusle kusle and slope and the values of cv and r derived from the daily rainfall and sediment response of individual sub catchments i e gauged and ungauged were used as the input vectors to create the som clustering map fig 2b for the ps and srs methods respectively the input vectors were normalized to prevent unintentional weighting of vector attributes during the training process see appendix the number of output neurons i e the size of the output map see fig 2b in an som can be selected using the empirical rule by vesanto and alhoniemi 2000 the optimal number of neurons i e in the som is calculated approximately by 5 l where l is the number of samples in input vectors number of sub catchments see fig 4 farsadnia et al 2014 the som assigns values to represent the input vector called the reference vector in each neuron which is generated and adjusted during the process of clustering or training farsadnia et al 2014 hamel and brown 2011 during the training process similar input vectors were close to each other and dissimilar ones were further apart this implies that similar input vectors between gauged and ungauged sub catchments will be mapped to the same clusters then the most similar gauged to ungauged sub catchment will be found based on the relative distance as shown in fig 2b additionally the maximum number of clusters identified in each catchment is beneficial as the more clusters identified the larger the number of donor catchments the complete process for training the som can be found in appendix the applications of the som in sediment load estimation can be found in previous studies ferde et al 2021 gao et al 2019 king and bjorneberg 2022 tabatabaei et al 2019 among others the detailed information on the som algorithm is documented in kohonen 1990 1982 and the applications of the som in hydrological studies can also be found in previous research farsadnia et al 2014 ley et al 2011 nourani et al 2013 tegegne and kim 2018 wallner et al 2013 2 4 study area the tsl basin and the basins of the sekong sesan and srepok rivers collectively known as the 3s rivers located in the lmrb were selected to test the applicability of the srs approach proposed in this study fig 3 the tropical monsoon driven climate dominates the hydro climatic conditions in these basins and is characterized by a rainy season may october and a dry season november april shrestha et al 2017 world bank 2011 the tsl basin is the largest freshwater body in southeast asia and one of the most important natural resources in cambodia kummu et al 2008 covering over 45 approximately 85 850 km2 of the national land surface area approximately 5 of the total basin area is shared with thailand fig 3 the tsl basin consists of 11 major tributary basins and is connected to the tonle sap river which flows to the mekong river delta the basin area and land use area of each tributary basin are summarized in table 1 seven of the 11 tributary basins are predominantly forested land 50 while agriculture is dominant in the mongkol borey baribo dauntri and siem reap tributary basins ang et al 2022 oeurng et al 2019 the tsl basin is covered by alluvial deposits composed of unconsolidated silt sand and gravel overlaying on the older bedrock tsukawaki and lao 1994 the basins predominantly consist of gentle sloping lowlands with an elevation of less than 100 m above sea level masl the elevation increases to over 1700 masl in the cardamom mountains to the southwest fig 3 kummu et al 2014 estimated that approximately 29 1 km3 year of the water volume in the lake originates from the 11 basins the 3s river basins are transboundary rivers that flow through three countries with a total catchment area of 78 650 km2 of which 33 is in cambodia 29 is in the lao people s democratic republic and 38 is in vietnam see fig 3 lópez et al 2017 shrestha et al 2017 trang et al 2017 the sesan and srepok rivers flow through cambodia joining the sekong river and finally meeting with the mekong river at stung treng province in cambodia fig 3 the elevation of the 3s basins ranges from less than 100masl downstream to over 2000 masl in the upstream areas of the sekong basin the basin area and land use distribution of the sekong and srepok river basins are presented in table 1 in which the areas are dominated by forest cover 80 constable 2015 trang et al 2017 acrisols 68 and ferralsols 12 with sandy clay loam and clay texture are the dominant soils in the 3s basins shrestha et al 2017 the annual discharge from the 3s basins represents approximately 17 20 of the total annual streamflow of the mekong river an average of 2 886 m3 s piman et al 2013 the 3s basins are also a primary source of sediment in the lmrb and the annual sediment load from the 3s basins is estimated at 10 25 mt million tons kondolf et al 2014 2 5 hydrological model the swat model was used in this analysis it is a semi distributed model a widely used hydrological model to simulate streamflow sediments and other hydrological variables under diverse environments and different scales arnold et al 1998 the swat has gained international acceptance as a comprehensive watershed modeling tool gassman et al 2007 and has been applied globally including in the united states yuan and forshay 2021 europe bärlund et al 2007 cambodia ang et al 2022 ang and oeurng 2018 thailand shrestha et al 2018 lao people s democratic republic vilaysane et al 2015 vietnam vu et al 2012 china hao et al 2004 india kaur et al 2004 australia sun and cornish 2006 and africa schuol and abbaspour 2006 among others the swat requires topography soil and land use information to account for heterogeneity and divide the basin into sub basins which are further subdivided into hrus each hru is created from a unique combination of land cover slope soil properties and management practices the prediction of the sediment in the swat model is based on a modified universal soil loss equation musle williams 1975 developed initially by wischmeier and smith 1965 where rainfall and runoff are the main drivers of soil loss the surface runoff from each hru is simulated based on the scs curve number method usda 1972 with daily rainfall defined at the centroid of the sub catchment where the default swat daily rainfall using observed rainfall at a gauging station located closest to the centroid of each sub catchment was not used arnold et al 1998 daily rainfall was obtained by applying the bilinear interpolation method to the daily gridded precipitation dataset ang et al 2022 this approach of using interpolated areal precipitation provides an improved model calibration compared to the swat default abbas and xuan 2020 masih et al 2011 more details about the swat can be found in the official theoretical documentation neitsch et al 2011 and the review paper by gassman et al 2007 2 6 data collection and preprocessing each dataset used for the swat model setup is summarized in table 2 the mekong river commission water quality monitoring network mrc wqmn dataset has been widely used in sediment load simulation studies in the mekong river basin kummu et al 2008 kummu and varis 2007 sok et al 2020 wang et al 2011 the total suspended solids tss samples were taken from this dataset collected at 0 30 m below the water surface in the center of the river cross section at each monitoring station sok et al 2020 and were analyzed using the recommended analytical methods mrc 2019 there are limited water level and sediment monitoring stations in the study basins the monthly observed sediment data at four gauging stations chinit and sen catchments in the tsl basin and sekong and srepok catchments in the 3s basin see fig 3 were used to calibrate and validate swat model parameters suspended sediment loads were estimated from the time series data of daily observed streamflow and monthly tss concentrations which were monitored at the same location using the regression model built into the load estimator loadest program runkel et al 2004 the applicability of the loadest was verified through many studies in estimating daily pollutant loads for various water quality parameters including sediment duan et al 2013 jha and jha 2013 jha et al 2007 park and engel 2016 2015 among others and calibrating swat model parameters cakir et al 2020 epelde et al 2015 nepal and parajuli 2022 sok et al 2020 teshager et al 2016 detailed information on topography land use soil type and water level data can be found in the previous study by ang et al 2022 the study evaluated seven gridded meteorological datasets and found that precipitation from integrated multi satellite retrievals for global precipitation measurement gpm imerg and air temperature data of southeast asia observational sa obs are the optimal meteorological data for comprehensive basin wide hydrological impact assessments in the tsl basin previous studies also revealed that the models using imerg precipitation data simulated streamflow well in the lmrb and the 3s basins li et al 2018 mohammed et al 2018 wang et al 2017 therefore the precipitation and air temperature values of imerg and sa obs respectively were interpolated using the values at the four grids nearest to the centroid of each sub catchment for use in the swat model for the sekong and srepok catchments water level data which were provided by the mrc table 2 from a monitoring station of each catchment see fig 3 were used as the observed data for flow model calibration 2005 2008 and validation 2009 2011 the results of the flow simulation model achieved good performance in the sekong catchment while good and satisfactory performance of model calibration and validation respectively were obtained in the srepok catchment fig s1 tables s2 and s5 2 7 model calibration validation and evaluation the calibration of model parameters for streamflow and sediment load was performed using the swat calibration and uncertainty programs swat cup abbaspour 2015 among several methods for calibration in swat cup to deal with parameter uncertainty the sequential uncertainty fitting version 2 sufi 2 method was selected nkonge et al 2014 wu and chen 2015 to provide more reasonable daily streamflow and sediment simulations at the outlet of each gauged drainage area table 1 and fig 3 the streamflow in each catchment was calibrated before calibrating the sediment load abbaspour 2015 then parameters for sediment load were calibrated while maintaining the flow parameter ranges which were obtained through the flow calibration owing to the availability and consistency of continuous sediment load data in each catchment the model parameters were calibrated with available data between 2005 and 2008 based on previous studies ang et al 2022 ang and oeurng 2018 oeurng et al 2019 roth et al 2016 sao et al 2020 sok et al 2020 vilaysane et al 2015 vu et al 2012 26 sensitive parameters were selected and calibrated for streamflow and sediment load simulation using the swat cup model table s3 to validate the approach proposed in this study the leave one out cross validation approach also known as the jack knife method introduced by quenouille 1956 and tukey 1958 is typically used to validate the regionalization approach athira et al 2016 gitau and chaubey 2010 heng and suetsugi 2014 parajka et al 2005 razavi and coulibaly 2013 samuel et al 2011 tegegne and kim 2018 in this procedure one of the gauged catchments is assumed as a pseudo ungauged catchment while the remaining catchments are regarded as the candidate donors for example when validation was conducted for the chinit catchment see fig 3 for the location of the chinit catchment the remaining three catchments i e sen sekong and srepok functioned as its candidate donors see fig 5 subsequently the ps and srs methods were applied to select the best donor sub catchments from the same cluster with the smallest relative distance see fig 2b finally using the calibrated model parameters transferred from the best donor sub catchments the time series of sediment load in the chinit catchment was estimated and compared with the observed data in the validation phase for evaluating model performance in estimating the time series of sediment load three quantitative metrics were employed these were the nash sutcliffe efficiency nse percent bias pbias and coefficient of determination r2 as shown in table s4 moriasi et al 2007 the nse indicates agreement between the simulated and the observed time series values nash and sutcliffe 1970 the pbias measures the average tendency of the simulated values to be larger or smaller than their observed counterparts gupta et al 1999 the r2 estimates the linear relationship between two variables by assessing the extent of difference in one variable by another furthermore the performance ratings suggested by moriasi et al 2007 were applied to evaluate the integrated performance of simulated results table s5 3 results and discussion 3 1 interpretation of sub catchment descriptors and clusters for each regionalization method based on the elevation data the chinit sen sekong and srepok catchments were delineated into 14 29 23 and 29 sub catchments respectively the total of 95 sub catchments is shown in fig 4 which displays the spatial variation of the area weighted values of the catchment descriptors in the four test catchments these were subsequently used to create the som for generating sub catchment clusters for each regionalization method the area weighted values of cusle in the chinit sen and sekong catchments are similar more so than that of the srepok catchment while similar kusle values were observed in the chinit sen and srepok catchments fig 4a h the chinit and sen catchments are neighboring tributaries in the tsl basin therefore the slopes were more similar to each other compared with sekong and srepok catchments fig 4i l specifically slight slopes 10 20 were observed in most sub catchments of the chinit and sen catchments however steep slopes were observed in the upstream sekong catchment 20 in contrast to the low slope in a large area of the srepok catchment fig 4i l in the chinit catchment a relatively low variation of rainfall cv 0 6 0 7 was observed which covers most of the catchment area fig 4m the cv of rainfall is similar for the sen sekong and srepok catchments at 0 6 0 9 except for the downstream areas of the sekong and srepok catchments where the cv 0 9 fig 4n p the cv values of sediment were higher than that of rainfall indicating a higher temporal variation in sediment than rainfall in each sub catchment fig 4q t the relatively homogenous cv values of sediment were observed in most sub catchments of the chinit and sen catchments fig 4q r whereas uneven cv values were observed in the sekong and srepok catchments indicating the different sedimentation processes caused by slope in these two catchments fig 4s t a high correlation r 0 6 0 8 between rainfall and sediment was observed in most of all sub catchments demonstrating a high linear relationship between rainfall and sediment response fig 4u x the sub catchments were classified into the same four clusters for each regionalization method additionally several sub catchments within a catchment e g sen catchment were grouped into a single cluster through the ps approach fig 5a however the srs approach provided more clusters in one catchment fig 5b this may add to the improvement of estimating sediment load in ungauged catchments section 3 2 the donor sub catchments identified by the ps regionalization approach were dominated by the sub catchments of the sen catchment 10 out of 14 sub catchments when the chinit was considered the pseudo ungauged catchment indicating that these two catchments have similar physical characteristics fig 5a b 3 2 evaluation of the performance of regionalization methods the performance of the srs and ps approaches were compared based on three statistical indicators nse pbias and r2 for sediment load simulation at each monitoring station in the chinit sen sekong and srepok catchments with the leave one out cross validation approach the daily observed and simulated sediment load of all catchments for the model calibration and cross validation phases from 2005 to 2008 are shown in fig 6 most results for the three model simulation schemes reproduced the seasonal patterns well for both seasons however there were some underestimations specifically for extreme peak flow periods fig 6 statistical indices summarized for the calibration model on site table 3 demonstrate a very good performance of daily sediment load simulations with nse and r2 values of 0 75 and pbias values within 10 in the three catchments i e chinit sen and sekong a satisfactory performance was found for the srepok catchment nse and r2 of 0 61 suggesting that the model parameters in each catchment were calibrated well in the cross validation phase on average the performance of the srs approach nse and r2 of 0 75 and 0 76 respectively was slightly better than the ps approach nse and r2 of 0 72 and 0 74 respectively and close to the results of the at site calibrated models nse and r2 of 0 77 table 3 fig 7 compares the monthly sediment load simulated by each method i e calibration on site ps and srs and the observations for each catchment the high values of the coefficient of determination r2 0 70 indicate that simulated sediments of the calibration and cross validation approaches have a strong linear relationship with the observed monthly data as seen in the scatter plots the srs method outperformed the ps method in three catchments chinit sen and sekong additionally the same correlation coefficients were obtained for the srepok catchment demonstrating more reliable sediment load estimation by the srs regionalization method fig 8 shows the observed and simulated mean monthly sediment load for each catchment 2005 2008 the simulated sediment load obtained from the three methods showed a seasonal pattern similar to the observed results it was found that the ps based sediment loads in the sekong catchment showed marked overestimation during october and december while results from the srs and calibrated models were close to the observed results fig 8 the comparison of observed and simulated annual sediment load from each catchment indicated that the srs cross validation and at site calibration showed similar and better overall performances in sediment simulations whereas the estimated errors of total sediment load based on the ps method cross validation were up to 16 fig 9 and s2 the srs approach proved to be superior for sediment prediction in the ungauged catchments with an improvement of up to 7 compared with the ps method fig s2 the reliability of seasonal variation of sediment simulated by the ps models was relatively lower as shown in figs 6 and 8 and could result in an overestimation in the total annual sediment load simulation subsequent to updating the model parameters in the second phase of the srs procedure the sub catchments were clustered again as shown in fig 5c using the simulated sediment load therefore the sub catchment clusters were derived from the am transferred parameters in the first phase and then derived from the updated parameters in the second phase which could be compared and checked fig s3 there were a few sub catchments that were assigned with different cluster numbers between fig 3a and 3b this indicated that the am method was reliable in tentatively transferring parameters the proposed srs regionalization method effectively addressed the main challenge of selecting ideal catchment attributes in conventional approaches the conventional regionalization methods found it difficult to select the catchment s key attributes that ideally identified hydrological and sediment similarities thus relatively higher uncertainty was found in the hydrological prediction at the ungauged catchments for the ps method however the srs method considered the spatiotemporal variations of rainfall and sediment response through the cv and r indices as the catchment attributes that could determine the hydrological and sediment similarities between gauged and ungauged catchments eventually the new regionalization srs approach could reduce the uncertainty of sediment estimation in ungauged catchments compared with the conventional method as shown in figs 6 9 s2 and table 3 additionally it showed the potential for catchment wide sediment load simulations in the ungauged catchments section 3 3 3 3 the application of the proposed regionalization method in ungauged catchments of the tsl basin the newly proposed regionalization method i e sediment response similarity needed to be validated before being applied in the actual ungauged catchments through the comprehensive analyses shown in sections 3 1 3 2 the srs method was successfully validated and outperformed the conventional method therefore the srs approach was selected to simulate the sediment load at the stations of the nine ungauged catchments of the tsl basin see fig 3 during the past decades i e 2001 2011 ang et al 2022 successfully calibrated and validated the swat model parameters in flow simulations at the hydrological monitoring stations of each catchment therefore those flow calibrated parameters see table s2 and the regionalized sediment parameters from the best donor catchments i e chinit sen sekong and srepok catchments see fig s4 and table s2 were inputted into the swat model subsequently the sediment load in each ungauged catchment was simulated from 2001 to 2011 eleven catchments drain into the lake fig 3 the total area of the tsl basin disregarding the floodplain is 83 107 km2 and the flows of 41 159 km2 50 are gauged table 1 for computational purposes the tributary basins can be divided into gauged ungauged and flooded areas kummu et al 2008 see fig s5 and table s6 fig 10 illustrates the mean simulated annual sediment load values from the total drainage area 2001 2011 from the srs approach and swat modeling excluding the flooded regions in each catchment the simulated mean annual total sediment load from all catchments was approximately 2 30 mt year from 2001 to 2011 dashed line in fig 10 kummu et al 2008 used hydrodynamic modeling to estimate the mean annual total sediment load for the same 11 catchments of the tsl basin during the period 2001 2003 and found that the annual total load was approximately 1 77 mt year the current study result for the corresponding period 2001 2003 was 1 81 mt year which is similar to that of the previous study the annual variation of sediment load flux into the lake was significant for example it varied from 1 45mt in 2003 to 3 40 mt in 2006 as presented in fig 10 the long term mean monthly variations in total sediment load from all catchments flowing into the lake from 2001 to 2011 are presented in fig 11 results showed that the sediment transport was dominant in the high rainfall period september october and the highest sediment load and discharge occurred in october exceeding 0 80 mt and dropped to 0 01 0 25 mt during the dry season or receding flood period november april the total annual sediment loads from sen sangker and baribo catchments contributed approximately 65 1 55 mt of the total sediment into the lake from all catchments while the smallest contribution 0 20 mt was from the dauntri and sreng catchments fig s6 additionally the average total sediment yield from all catchments was approximately 29 t km2 year between 2001 and 2011 fig s7 the total annual sediment yields from the sen sangker and baribo catchments were higher than other catchments 50 t km2 year the annual sediment yield of the sekong catchment was the highest 200 t km2 year the srepok catchment produced a sediment yield of approximately 70 t km2 year which was comparable with that of some catchments of the tsl basin including the baribo sangker and sen catchments which had a sediment yield of 55 98 t km2 year between 2005 and 2011 fig s8 4 conclusion in this study a novel srs regionalization method has been proposed using the swat model and som clustering technique to overcome the limitation of the critical attributes of a catchment favoring sediment similarity which usually exists in the conventional regionalization approaches additionally the srs minimizes uncertainty when simulating sediment load in ungauged catchments the performance of the srs model was evaluated by comparing it with the conventional regionalization methods and the results of model calibration in four catchments of the tsl and 3s basins the results indicated the comprehensive performance of the srs regionalization method for estimating sediment load in the ungauged catchments it considered the spatiotemporal variations of sediment response and its relationship with rainfall characteristics as a catchment attribute and showed the potential to ideally determine hydrological and sediment similarities between gauged and ungauged catchments the srs approach obtained an estimation error reduction of up to 7 compared with the ps regionalization method compared to the conventional approach there was an improvement in statistical metrics nse and r2 0 75 and 0 76 respectively for the srs method which was close to the calibration model results nse and r2 0 77 thereby outperforming the conventional approach the srs method was also selected to estimate sediment load in the ungauged tributaries of the tsl basin results showed that the annual total sediment flux into the lake from its tributaries is approximately 2 3 mt year with the highest sediment load occurring in october exceeding 0 8mt the proposed srs regionalization method effectively addressed the main challenge in conventional approaches which is the selection of ideal catchment attributes that favor hydrologic similarity between gauged and ungauged catchments thus the srs regionalization method proposed in this study is a global alternative method for estimating sediment load as well as other hydrological variables and rainfall driven phenomena such as streamflow and nutrient transport in ungauged catchments however in this study the applicability of the srs regionalization method is tested on a limited number of catchments and gauged datasets therefore it is recommended to incorporate more gauged catchments especially those with a larger scale and more sufficient in situ data to widely extend the method s applicability and minimize the associated uncertainty credit authorship contribution statement raksmey ang conceptualization methodology data curation software formal analysis investigation visualization validation writing original draft tsuyoshi kinouchi supervision investigation visualization writing review editing wenpeng zhao conceptualization methodology investigation validation software writing review editing declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments the authors thank the mekong river commission mrc for providing total suspended solids concentration land use and soil data and the department of hydrology and river works ministry of water resources and meteorology mowram of cambodia for providing observed daily water level datasets this research is supported by heiwa nakajima foundation japan appendix a the self organizing map som a sequential regression process carries out the training process of the som wallner et al 2013 1 set j 1 and select the input vector xj 2 identify the node with the reference vector mi most similar to the current input vector xj this neuron is called the winner neuron or best matching unit bmu a1 c arg min i x i m i t i 1 k where the index i ranges over all reference vectors on the map the quantity mi t refers to the reference vector at position i on the map at time step t 3 update the reference vector of the winner neuron mc and the neighboring neurons mi based on the current input vector xj a2 m i t 1 m i t α t h ci t x j m i t i 1 k where hci is the neighborhood function which decreases with increasing distance to the winner neuron and α is the learning rate which decreases with increasing time 4 set j j 1 and go back to step 2 until all input vectors are considered 5 set t t 1 and go back to step 1 until a fixed number of iterations is reached the above computation is usually repeated over the available input vectors many times during the training phase of the map each iteration is called a training epoch one of the advantages of the som is that they have an appealing visual representation as the 2 d unified distance matrix as seen in fig 2b as before the colors on the map represent the relative distances between reference vectors light colors indicate short distances and dark colors indicate long distances contiguous areas of light colors represent strong clusters hamel and brown 2011 appendix b supplementary data supplementary data to this article can be found online at https doi org 10 1016 j jhydrol 2023 129198 appendix b supplementary data the following are the supplementary data to this article supplementary data 1 
2212,the development and application of reliable hydrological models are challenging in ungauged or poorly gauged catchments although several regionalization methods have been developed for predicting hydrological variables in ungauged catchments a large uncertainty usually exists in the prediction because previous methods typically depended on several static catchment attributes or long term mean climatic descriptors thereby neglecting the spatiotemporal variability of the climate in this study we propose a new regionalization method called sediment response similarity srs using the soil and water assessment tool model and self organizing maps to estimate sediment load in ungauged catchments considering spatiotemporal variability and the sediment load relation to rainfall characteristics of individual catchments the performance of srs was evaluated by comparing it against the conventional regionalization method i e physical similarity and calibration model results in four gauged catchments of the lower mekong river basin the srs method showed improved performance over the conventional approach in estimating sediment loads with an average nash sutcliffe efficiency nse and coefficient of determination r2 of 0 75 and 0 76 respectively which were close to the respective values of nse and r2 0 77 of the calibration model additionally the srs approach showed an error reduction of up to 7 compared with that of the physical similarity method indicating the potential of the proposed regionalization method in estimating catchment wide sediment load in ungauged catchments the findings indicate that the srs method ideally determines the similarity of sediment loads between gauged and ungauged catchments the srs approach effectively tackled the main challenge of selecting catchment attributes in the conventional regionalization method and minimizing the uncertainty of sediment prediction in ungauged catchments this novel srs method is a promising method for estimating not only sediment load but also other hydrological variables and rainfall driven phenomena in the ungauged catchments globally keywords sediment response similarity regionalization swat model som ungauged catchment the tonle sap lake basin data availability data will be made available on request 1 introduction ground monitored and satellite based hydrometeorological and water quality datasets play vital roles in developing reliable hydrological models for regional environmental assessments of land use change and anthropogenic threats such as climate change ang et al 2022 guo et al 2020 zhao et al 2022b however the sparse and uneven distribution of hydrometeorological and water quality monitoring stations typically found in developing countries hinders the development of reliable hydrological models and accurate simulations of the hydro environmental impacts ang et al 2022 to solve this problem a common method known as regionalization in which hydrological information model parameters from well monitored catchments donors are transferred to ungauged or sparsely gauged catchments receptors is used to predict the time series of hydrological variables such as streamflow and sediment load several regionalization methods have been developed for modeling hydrological variables especially for runoff simulation in ungauged catchments the most common regionalization approaches include physical similarity ps spatial proximity spx arithmetic mean am and regression based approach rg guo et al 2020 heng and suetsugi 2014 tegegne and kim 2018a zhao et al 2022a in the ps approach one or more donor catchments with similar physical characteristics i e climate land use and geological conditions to ungauged catchments are identified subsequently a complete parameter set from the donor catchment is transferred to the corresponding ungauged catchment asurza véliz and lavado casimiro 2020 guo et al 2020 the performance of this technique depends on the selection of descriptors to explain the similarity the spx approach assumes that the nearby catchments should have similar characteristics and hydrological behaviors and the entire parameter set is transferrable from the neighboring donors to the ungauged catchment by interpolation or averaging swain and patra 2017 however the model performance is inaccurate if strong heterogeneity is not present in the catchment characteristics as assumed parajka et al 2005 in the am approach each calibrated model parameter from gauged catchments located in a given region is averaged and then transferred to the ungauged catchments in the same region consequently the value of each corresponding parameter is identical for all ungauged catchments which might not be realistic for heterogeneous catchments tegegne and kim 2018 the rg method aims to find the relationships between catchment attributes and model parameters calibrated in the gauged catchments the established relationships are further used to quantify the model parameters for ungauged catchments heng and suetsugi 2014 oudin et al 2008 heng and suetsugi 2014 zhang and chiew 2009 mentioned that the equifinality problem of model parameterization is a major weakness of this method since different groups of model parameters could also provide similar model outputs they added that the values of calibrated parameters depend on the input datasets and parameterization techniques i e input errors and data inadequacies will lead to highly uncertain model parameters numerous studies have compared the performance of different regionalization approaches for modeling streamflow and sediment in river basins and have reported the outperformance of the ps and spx approaches over other regionalization methods guo et al 2020 heng and suetsugi 2014 oudin et al 2008 parajka et al 2013 2005 tegegne and kim 2018 zhang and chiew 2009 heng and suetsugi 2014 compared three regionalization approaches ps rg and spx to estimate sediment rating curves in ungauged catchments for predicting instantaneous suspended sediment yield in 16 catchments of the lower mekong river basin lmrb they found that the ps approach provided the best performance while the spx technique produced the least effective regionalization solution owing to a sparse network of monitoring stations in the study area parajka et al 2005 conducted runoff modeling across 320 austrian catchments and revealed that the ps and spx approaches perform similarly and were close to the calibration results oudin et al 2008 compared three regionalization methods ps spx and rg for runoff modeling in 913 catchments in france and found that wherever a dense network of gauging stations was available the spx provided the best regionalization solution while the performance of ps approach is intermediary parajka et al 2013 compared four regionalization techniques i e ps spx am and rg for runoff prediction based on a review of 34 past studies for 3 874 catchments results indicated a lower performance of the rg method than other methods used in those studies additionally it was found that the spx and ps techniques performed best in humid catchments while the ps and rg methods performed slightly better in arid catchments however in studies with dense streamflow gauge networks there was a tendency for the spx technique to outperform the rg and am methods parajka et al 2013 a common conclusion from this research is that the spx approach has a relatively enhanced performance when dense streamflow gauge networks are available in other conditions the ps method is more likely to provide the best regionalization solution for the hydrological estimation of ungauged catchments the ps method assumes that the similarity in the input attributes e g such as rainfall land use and geological conditions between gauged and ungauged catchments is connected to the corresponding similar responses such as sediment or runoff however the relationship between the inputs and outputs can be inherently different between gauged and ungauged catchments owing to the spatiotemporal variability of the hydrologic process in individual catchments tegegne and kim 2018 moreover the proximity among catchment centroids introduced in the spx method is not necessarily translated into hydrologic similarity kokkonen et al 2003 to overcome the problems associated with the spx and ps methods tegegne and kim 2018 proposed the new catchment runoff response similarity crrs regionalization method to identify the attributes of a critical catchment and more accurately represent the hydrological similarities the crrs is based on the idea that catchments with similar runoff responses have similar hydrological processes and therefore similar model parameter values the crrs outperformed other regionalization methods including the next best regionalization approach the ps method with 10 14 and 4 7 during the calibration and validation tests respectively tegegne and kim 2018 overall the regionalization approaches examined in previous studies assume that the catchment classification or clustering is possible based on several static catchment descriptors i e land use and geological conditions with long term mean climatic descriptors e g mean annual rainfall or a combination however spatiotemporal variability in climate within the catchment is neglected samaniego et al 2010 wagener et al 2007 also found that the prediction of hydrological variables streamflow and sediment load in ungauged catchments is a challenging task primarily because the hydrologic processes occurring within a catchment occur over a wide range of spatiotemporal scales therefore catchment attributes descriptors that represent the spatiotemporal variability of climate and hydrological process in gauged and ungauged catchments are required for the regionalization of catchments therefore in this study a new regionalization method was proposed this sediment response similarity srs method aims to find appropriate attributes that can ideally transfer the response of gauged catchments associated with sediment erosion and transport to that of ungauged catchments considering spatiotemporal variability of the hydrologic processes occurring within the catchments the method was developed by using a conventional regionalization method an am and two statistical indices of catchment attributes the coefficient of variation cv and correlation coefficient r these describe the spatiotemporal variations of sediment response and its relationship with rainfall characteristics in gauged and ungauged catchments the values of these indices can characterize and compare the sediment response behavior in terms of catchment attributes between gauged and ungauged catchments briefly the srs steps are as follows 1 apply the am regionalization approach to transfer the calibrated parameters used in the soil and water assessment tool swat model from the gauged to ungauged catchment and simulate model output i e sediment response 2 calculate the cv for observed rainfall input and the simulated sediment response obtained in the first step and calculate the r between the rainfall and the sediment response for each gauged and ungauged catchment 3 identify the catchment clusters gauged and ungauged catchments which are based on the sediment response similarities using the similar cv and r values 4 update the final parameter values from the same clusters from the gauged to ungauged catchments i e similar sediment responses represented by the cv and r values and 5 rerun the swat model to simulate the time series of sediment load in the ungauged catchments to examine the validity and effectiveness of this proposed srs approach the method was applied to tributary basins located in the lmrb the performance of the srs method was compared with the conventional regionalization method i e physical similarity finally the sediment load time series was estimated using the srs method for the ungauged tributaries of the tonle sap lake tsl basin a sub basin of the lmrb which has a limited number of monitoring stations the paper structure is as follows first the methodology is explained followed by the study area results and discussion and conclusions 2 materials and methods 2 1 hydrological model setup fig 1 top dash box shows the framework of the swat model setup section 2 5 first the spatial and meteorological data were input into the swat model to set up hydrological models for both gauged and ungauged catchments next the whole catchment was delineated into sub catchments the sub catchment boundaries were delineated based on information from the digital elevation model dem for the area a combination of land cover slope soil properties and management practices of the sub catchments was classified and overlaid to form hydrologic response units hrus therefore the gauged and ungauged sub catchments were clustered using srs section 2 2 1 and ps section 2 2 2 regionalization methods 2 2 regionalization methods 2 2 1 sediment response similarity in this study the new srs regionalization method was based on a two phase approach of transferring parameters fig 1 in the first phase the conventional regionalization methods were used to tentatively transfer the calibrated model parameters from the gauged to ungauged catchments the am regionalization method was used in this study because the number of gauged catchments is insufficient in the two case study basins see fig 3 the number of ungauged receiver catchments will be too high compared to the number of donor catchments if the catchment clusters were to be identified based on the ps or spx approaches owing to the differences between donor and receiver catchments however the ps or spx approaches can be used to tentatively transfer model parameters from gauged to ungauged catchments where there are many donor catchments the second phase of the parameter transfer approach was based on srs the catchments with similar rainfall characteristics and sediment responses are considered hydrologically similar once similar catchments were identified the final parameter values of each gauged catchment were transferred to the ungauged catchments the similarity of runoff response and sediment load simulated in the model implies that dominant hydrological processes within a particular ungauged catchment are well incorporated into the model consequently the regionalization methods that consider the similarity in the rainfall characteristics and the sediment load response as the main attributes could reduce the hydrologic uncertainty in the predicted results of the ungauged catchments tegegne and kim 2018 the hydrological processes within a catchment occur over a wide spatiotemporal scale therefore catchment attributes that represent the spatiotemporal variability of climate and hydrological processes in the catchments are required for the regionalization of catchments the cv index is a statistical measure of the dispersion of data points in a data series around the mean and it is beneficial when comparing the degree of variation from one data series to another even if the means are considerably different brown 1998 the r index measures the strength of the statistical relationship or a linear association between two variables the cv and r indices describe the spatiotemporal variations of sediment response and the relationship with rainfall characteristics in gauged and ungauged catchments this can partially characterize the unique sediment response behavior of each catchment therefore the cv and r indices could be ideal catchment attributes for identifying srs in long term spatiotemporal variations between gauged and ungauged catchments the detailed and systematic procedures of the srs method are summarized in five steps fig 1 as follows step 1 during the first phase the am regionalization approach was applied to tentatively transfer the calibrated parameters used in the swat model from the gauged to ungauged catchment and simulate model output such as sediment response or load step 2 in the second phase the daily sediment load for each sub catchment simulated in step 1 is normalized by the corresponding sub catchment area the index values of cv of daily rainfall normalized sediment load and r between daily rainfall and normalized sediment load were then calculated for each sub catchment step 3 the self organizing map som section 2 3 clustering technique was used to identify similar sub catchments using the daily time series cv and r index values computed for each sub catchment see figs 4 and 5 step 4 the model parameters for the ungauged catchments were updated with the final parameter values from the gauged catchments in the same cluster this means that similar sediment responses or cv and r values were considered step 5 finally the swat model was rerun to simulate the sediment load time series in the ungauged catchments 2 2 2 physical similarity the ps method is one of the best performing regionalization solutions reported in previous studies guo et al 2020 heng and suetsugi 2014 oudin et al 2008 parajka et al 2013 2005 tegegne and kim 2018 zhang and chiew 2009 among others it was used for comparison against the performance of the srs method the ps approach assumes that catchment physiographic characteristics predetermine the hydrological behavior the catchment descriptors or attributes are generally used to define the similarity and are related to the topography land cover and soil type of the catchment in this study the area weighted catchment slope the universal soil loss equation usle the land cover and management factor cusle and the usle soil erodibility factor kusle were used in previous studies these attributes were considered the main drivers of hydrological responses in different catchments merz and blöschl 2004 tegegne and kim 2018 the area weighted average value of each catchment attribute of each sub catchment was computed as follows 1 ca i area ratio ca 1 area ratio ca 2 area ratio ca m where ca is a catchment attribute value i e cusle kusle and slope i is the number of sub catchments the area ratio is the area occupied by the corresponding catchment attribute divided by the total area of the sub catchment i and m denotes different land use types soil types and slope classes for cusle kusle and slope respectively table s1 presents the cusle and kusle values of different land use and soil types respectively which were retrieved from the swat land use and soil type databases ang et al 2022 the slope percentage of each sub catchment was calculated from the dem input data see table 2 the schematic framework of the ps method is illustrated using that of the srs approach in fig 1 first the area weighted slope cusle and kusle values of gauged and ungauged sub catchments were computed and inputted into the som algorithm the som clustering technique was then used to identify similar cluster sub catchments using the area weighted slope cusle and kusle of each sub catchment see figs 4 and 5 finally the model parameters for the ungauged catchments were transferred from similar gauged catchments to simulate the time series of sediment load in the ungauged catchments this simulated time series from the ps approach was compared with that from the srs method to evaluate the srs method s performance 2 3 self organizing map an som is an unsupervised learning algorithm based on artificial neural networks used to cluster and visualize the structure of high dimensional data sets kohonen 1990 1982 an som consists of input and output layers linked by weightings fig 2a the input layer is formed by a set of nodes consisting of input vectors fig 2a and the output layer is formed by nodes arranged in a two dimensional 2 d grid map this 2 d grid map also called the unified distance matrix or u matrix shows the data similarities by grouping similar data into the same clusters as indicated by the same numbers inserted in the grids shown in fig 2b in this study the values of cusle kusle and slope and the values of cv and r derived from the daily rainfall and sediment response of individual sub catchments i e gauged and ungauged were used as the input vectors to create the som clustering map fig 2b for the ps and srs methods respectively the input vectors were normalized to prevent unintentional weighting of vector attributes during the training process see appendix the number of output neurons i e the size of the output map see fig 2b in an som can be selected using the empirical rule by vesanto and alhoniemi 2000 the optimal number of neurons i e in the som is calculated approximately by 5 l where l is the number of samples in input vectors number of sub catchments see fig 4 farsadnia et al 2014 the som assigns values to represent the input vector called the reference vector in each neuron which is generated and adjusted during the process of clustering or training farsadnia et al 2014 hamel and brown 2011 during the training process similar input vectors were close to each other and dissimilar ones were further apart this implies that similar input vectors between gauged and ungauged sub catchments will be mapped to the same clusters then the most similar gauged to ungauged sub catchment will be found based on the relative distance as shown in fig 2b additionally the maximum number of clusters identified in each catchment is beneficial as the more clusters identified the larger the number of donor catchments the complete process for training the som can be found in appendix the applications of the som in sediment load estimation can be found in previous studies ferde et al 2021 gao et al 2019 king and bjorneberg 2022 tabatabaei et al 2019 among others the detailed information on the som algorithm is documented in kohonen 1990 1982 and the applications of the som in hydrological studies can also be found in previous research farsadnia et al 2014 ley et al 2011 nourani et al 2013 tegegne and kim 2018 wallner et al 2013 2 4 study area the tsl basin and the basins of the sekong sesan and srepok rivers collectively known as the 3s rivers located in the lmrb were selected to test the applicability of the srs approach proposed in this study fig 3 the tropical monsoon driven climate dominates the hydro climatic conditions in these basins and is characterized by a rainy season may october and a dry season november april shrestha et al 2017 world bank 2011 the tsl basin is the largest freshwater body in southeast asia and one of the most important natural resources in cambodia kummu et al 2008 covering over 45 approximately 85 850 km2 of the national land surface area approximately 5 of the total basin area is shared with thailand fig 3 the tsl basin consists of 11 major tributary basins and is connected to the tonle sap river which flows to the mekong river delta the basin area and land use area of each tributary basin are summarized in table 1 seven of the 11 tributary basins are predominantly forested land 50 while agriculture is dominant in the mongkol borey baribo dauntri and siem reap tributary basins ang et al 2022 oeurng et al 2019 the tsl basin is covered by alluvial deposits composed of unconsolidated silt sand and gravel overlaying on the older bedrock tsukawaki and lao 1994 the basins predominantly consist of gentle sloping lowlands with an elevation of less than 100 m above sea level masl the elevation increases to over 1700 masl in the cardamom mountains to the southwest fig 3 kummu et al 2014 estimated that approximately 29 1 km3 year of the water volume in the lake originates from the 11 basins the 3s river basins are transboundary rivers that flow through three countries with a total catchment area of 78 650 km2 of which 33 is in cambodia 29 is in the lao people s democratic republic and 38 is in vietnam see fig 3 lópez et al 2017 shrestha et al 2017 trang et al 2017 the sesan and srepok rivers flow through cambodia joining the sekong river and finally meeting with the mekong river at stung treng province in cambodia fig 3 the elevation of the 3s basins ranges from less than 100masl downstream to over 2000 masl in the upstream areas of the sekong basin the basin area and land use distribution of the sekong and srepok river basins are presented in table 1 in which the areas are dominated by forest cover 80 constable 2015 trang et al 2017 acrisols 68 and ferralsols 12 with sandy clay loam and clay texture are the dominant soils in the 3s basins shrestha et al 2017 the annual discharge from the 3s basins represents approximately 17 20 of the total annual streamflow of the mekong river an average of 2 886 m3 s piman et al 2013 the 3s basins are also a primary source of sediment in the lmrb and the annual sediment load from the 3s basins is estimated at 10 25 mt million tons kondolf et al 2014 2 5 hydrological model the swat model was used in this analysis it is a semi distributed model a widely used hydrological model to simulate streamflow sediments and other hydrological variables under diverse environments and different scales arnold et al 1998 the swat has gained international acceptance as a comprehensive watershed modeling tool gassman et al 2007 and has been applied globally including in the united states yuan and forshay 2021 europe bärlund et al 2007 cambodia ang et al 2022 ang and oeurng 2018 thailand shrestha et al 2018 lao people s democratic republic vilaysane et al 2015 vietnam vu et al 2012 china hao et al 2004 india kaur et al 2004 australia sun and cornish 2006 and africa schuol and abbaspour 2006 among others the swat requires topography soil and land use information to account for heterogeneity and divide the basin into sub basins which are further subdivided into hrus each hru is created from a unique combination of land cover slope soil properties and management practices the prediction of the sediment in the swat model is based on a modified universal soil loss equation musle williams 1975 developed initially by wischmeier and smith 1965 where rainfall and runoff are the main drivers of soil loss the surface runoff from each hru is simulated based on the scs curve number method usda 1972 with daily rainfall defined at the centroid of the sub catchment where the default swat daily rainfall using observed rainfall at a gauging station located closest to the centroid of each sub catchment was not used arnold et al 1998 daily rainfall was obtained by applying the bilinear interpolation method to the daily gridded precipitation dataset ang et al 2022 this approach of using interpolated areal precipitation provides an improved model calibration compared to the swat default abbas and xuan 2020 masih et al 2011 more details about the swat can be found in the official theoretical documentation neitsch et al 2011 and the review paper by gassman et al 2007 2 6 data collection and preprocessing each dataset used for the swat model setup is summarized in table 2 the mekong river commission water quality monitoring network mrc wqmn dataset has been widely used in sediment load simulation studies in the mekong river basin kummu et al 2008 kummu and varis 2007 sok et al 2020 wang et al 2011 the total suspended solids tss samples were taken from this dataset collected at 0 30 m below the water surface in the center of the river cross section at each monitoring station sok et al 2020 and were analyzed using the recommended analytical methods mrc 2019 there are limited water level and sediment monitoring stations in the study basins the monthly observed sediment data at four gauging stations chinit and sen catchments in the tsl basin and sekong and srepok catchments in the 3s basin see fig 3 were used to calibrate and validate swat model parameters suspended sediment loads were estimated from the time series data of daily observed streamflow and monthly tss concentrations which were monitored at the same location using the regression model built into the load estimator loadest program runkel et al 2004 the applicability of the loadest was verified through many studies in estimating daily pollutant loads for various water quality parameters including sediment duan et al 2013 jha and jha 2013 jha et al 2007 park and engel 2016 2015 among others and calibrating swat model parameters cakir et al 2020 epelde et al 2015 nepal and parajuli 2022 sok et al 2020 teshager et al 2016 detailed information on topography land use soil type and water level data can be found in the previous study by ang et al 2022 the study evaluated seven gridded meteorological datasets and found that precipitation from integrated multi satellite retrievals for global precipitation measurement gpm imerg and air temperature data of southeast asia observational sa obs are the optimal meteorological data for comprehensive basin wide hydrological impact assessments in the tsl basin previous studies also revealed that the models using imerg precipitation data simulated streamflow well in the lmrb and the 3s basins li et al 2018 mohammed et al 2018 wang et al 2017 therefore the precipitation and air temperature values of imerg and sa obs respectively were interpolated using the values at the four grids nearest to the centroid of each sub catchment for use in the swat model for the sekong and srepok catchments water level data which were provided by the mrc table 2 from a monitoring station of each catchment see fig 3 were used as the observed data for flow model calibration 2005 2008 and validation 2009 2011 the results of the flow simulation model achieved good performance in the sekong catchment while good and satisfactory performance of model calibration and validation respectively were obtained in the srepok catchment fig s1 tables s2 and s5 2 7 model calibration validation and evaluation the calibration of model parameters for streamflow and sediment load was performed using the swat calibration and uncertainty programs swat cup abbaspour 2015 among several methods for calibration in swat cup to deal with parameter uncertainty the sequential uncertainty fitting version 2 sufi 2 method was selected nkonge et al 2014 wu and chen 2015 to provide more reasonable daily streamflow and sediment simulations at the outlet of each gauged drainage area table 1 and fig 3 the streamflow in each catchment was calibrated before calibrating the sediment load abbaspour 2015 then parameters for sediment load were calibrated while maintaining the flow parameter ranges which were obtained through the flow calibration owing to the availability and consistency of continuous sediment load data in each catchment the model parameters were calibrated with available data between 2005 and 2008 based on previous studies ang et al 2022 ang and oeurng 2018 oeurng et al 2019 roth et al 2016 sao et al 2020 sok et al 2020 vilaysane et al 2015 vu et al 2012 26 sensitive parameters were selected and calibrated for streamflow and sediment load simulation using the swat cup model table s3 to validate the approach proposed in this study the leave one out cross validation approach also known as the jack knife method introduced by quenouille 1956 and tukey 1958 is typically used to validate the regionalization approach athira et al 2016 gitau and chaubey 2010 heng and suetsugi 2014 parajka et al 2005 razavi and coulibaly 2013 samuel et al 2011 tegegne and kim 2018 in this procedure one of the gauged catchments is assumed as a pseudo ungauged catchment while the remaining catchments are regarded as the candidate donors for example when validation was conducted for the chinit catchment see fig 3 for the location of the chinit catchment the remaining three catchments i e sen sekong and srepok functioned as its candidate donors see fig 5 subsequently the ps and srs methods were applied to select the best donor sub catchments from the same cluster with the smallest relative distance see fig 2b finally using the calibrated model parameters transferred from the best donor sub catchments the time series of sediment load in the chinit catchment was estimated and compared with the observed data in the validation phase for evaluating model performance in estimating the time series of sediment load three quantitative metrics were employed these were the nash sutcliffe efficiency nse percent bias pbias and coefficient of determination r2 as shown in table s4 moriasi et al 2007 the nse indicates agreement between the simulated and the observed time series values nash and sutcliffe 1970 the pbias measures the average tendency of the simulated values to be larger or smaller than their observed counterparts gupta et al 1999 the r2 estimates the linear relationship between two variables by assessing the extent of difference in one variable by another furthermore the performance ratings suggested by moriasi et al 2007 were applied to evaluate the integrated performance of simulated results table s5 3 results and discussion 3 1 interpretation of sub catchment descriptors and clusters for each regionalization method based on the elevation data the chinit sen sekong and srepok catchments were delineated into 14 29 23 and 29 sub catchments respectively the total of 95 sub catchments is shown in fig 4 which displays the spatial variation of the area weighted values of the catchment descriptors in the four test catchments these were subsequently used to create the som for generating sub catchment clusters for each regionalization method the area weighted values of cusle in the chinit sen and sekong catchments are similar more so than that of the srepok catchment while similar kusle values were observed in the chinit sen and srepok catchments fig 4a h the chinit and sen catchments are neighboring tributaries in the tsl basin therefore the slopes were more similar to each other compared with sekong and srepok catchments fig 4i l specifically slight slopes 10 20 were observed in most sub catchments of the chinit and sen catchments however steep slopes were observed in the upstream sekong catchment 20 in contrast to the low slope in a large area of the srepok catchment fig 4i l in the chinit catchment a relatively low variation of rainfall cv 0 6 0 7 was observed which covers most of the catchment area fig 4m the cv of rainfall is similar for the sen sekong and srepok catchments at 0 6 0 9 except for the downstream areas of the sekong and srepok catchments where the cv 0 9 fig 4n p the cv values of sediment were higher than that of rainfall indicating a higher temporal variation in sediment than rainfall in each sub catchment fig 4q t the relatively homogenous cv values of sediment were observed in most sub catchments of the chinit and sen catchments fig 4q r whereas uneven cv values were observed in the sekong and srepok catchments indicating the different sedimentation processes caused by slope in these two catchments fig 4s t a high correlation r 0 6 0 8 between rainfall and sediment was observed in most of all sub catchments demonstrating a high linear relationship between rainfall and sediment response fig 4u x the sub catchments were classified into the same four clusters for each regionalization method additionally several sub catchments within a catchment e g sen catchment were grouped into a single cluster through the ps approach fig 5a however the srs approach provided more clusters in one catchment fig 5b this may add to the improvement of estimating sediment load in ungauged catchments section 3 2 the donor sub catchments identified by the ps regionalization approach were dominated by the sub catchments of the sen catchment 10 out of 14 sub catchments when the chinit was considered the pseudo ungauged catchment indicating that these two catchments have similar physical characteristics fig 5a b 3 2 evaluation of the performance of regionalization methods the performance of the srs and ps approaches were compared based on three statistical indicators nse pbias and r2 for sediment load simulation at each monitoring station in the chinit sen sekong and srepok catchments with the leave one out cross validation approach the daily observed and simulated sediment load of all catchments for the model calibration and cross validation phases from 2005 to 2008 are shown in fig 6 most results for the three model simulation schemes reproduced the seasonal patterns well for both seasons however there were some underestimations specifically for extreme peak flow periods fig 6 statistical indices summarized for the calibration model on site table 3 demonstrate a very good performance of daily sediment load simulations with nse and r2 values of 0 75 and pbias values within 10 in the three catchments i e chinit sen and sekong a satisfactory performance was found for the srepok catchment nse and r2 of 0 61 suggesting that the model parameters in each catchment were calibrated well in the cross validation phase on average the performance of the srs approach nse and r2 of 0 75 and 0 76 respectively was slightly better than the ps approach nse and r2 of 0 72 and 0 74 respectively and close to the results of the at site calibrated models nse and r2 of 0 77 table 3 fig 7 compares the monthly sediment load simulated by each method i e calibration on site ps and srs and the observations for each catchment the high values of the coefficient of determination r2 0 70 indicate that simulated sediments of the calibration and cross validation approaches have a strong linear relationship with the observed monthly data as seen in the scatter plots the srs method outperformed the ps method in three catchments chinit sen and sekong additionally the same correlation coefficients were obtained for the srepok catchment demonstrating more reliable sediment load estimation by the srs regionalization method fig 8 shows the observed and simulated mean monthly sediment load for each catchment 2005 2008 the simulated sediment load obtained from the three methods showed a seasonal pattern similar to the observed results it was found that the ps based sediment loads in the sekong catchment showed marked overestimation during october and december while results from the srs and calibrated models were close to the observed results fig 8 the comparison of observed and simulated annual sediment load from each catchment indicated that the srs cross validation and at site calibration showed similar and better overall performances in sediment simulations whereas the estimated errors of total sediment load based on the ps method cross validation were up to 16 fig 9 and s2 the srs approach proved to be superior for sediment prediction in the ungauged catchments with an improvement of up to 7 compared with the ps method fig s2 the reliability of seasonal variation of sediment simulated by the ps models was relatively lower as shown in figs 6 and 8 and could result in an overestimation in the total annual sediment load simulation subsequent to updating the model parameters in the second phase of the srs procedure the sub catchments were clustered again as shown in fig 5c using the simulated sediment load therefore the sub catchment clusters were derived from the am transferred parameters in the first phase and then derived from the updated parameters in the second phase which could be compared and checked fig s3 there were a few sub catchments that were assigned with different cluster numbers between fig 3a and 3b this indicated that the am method was reliable in tentatively transferring parameters the proposed srs regionalization method effectively addressed the main challenge of selecting ideal catchment attributes in conventional approaches the conventional regionalization methods found it difficult to select the catchment s key attributes that ideally identified hydrological and sediment similarities thus relatively higher uncertainty was found in the hydrological prediction at the ungauged catchments for the ps method however the srs method considered the spatiotemporal variations of rainfall and sediment response through the cv and r indices as the catchment attributes that could determine the hydrological and sediment similarities between gauged and ungauged catchments eventually the new regionalization srs approach could reduce the uncertainty of sediment estimation in ungauged catchments compared with the conventional method as shown in figs 6 9 s2 and table 3 additionally it showed the potential for catchment wide sediment load simulations in the ungauged catchments section 3 3 3 3 the application of the proposed regionalization method in ungauged catchments of the tsl basin the newly proposed regionalization method i e sediment response similarity needed to be validated before being applied in the actual ungauged catchments through the comprehensive analyses shown in sections 3 1 3 2 the srs method was successfully validated and outperformed the conventional method therefore the srs approach was selected to simulate the sediment load at the stations of the nine ungauged catchments of the tsl basin see fig 3 during the past decades i e 2001 2011 ang et al 2022 successfully calibrated and validated the swat model parameters in flow simulations at the hydrological monitoring stations of each catchment therefore those flow calibrated parameters see table s2 and the regionalized sediment parameters from the best donor catchments i e chinit sen sekong and srepok catchments see fig s4 and table s2 were inputted into the swat model subsequently the sediment load in each ungauged catchment was simulated from 2001 to 2011 eleven catchments drain into the lake fig 3 the total area of the tsl basin disregarding the floodplain is 83 107 km2 and the flows of 41 159 km2 50 are gauged table 1 for computational purposes the tributary basins can be divided into gauged ungauged and flooded areas kummu et al 2008 see fig s5 and table s6 fig 10 illustrates the mean simulated annual sediment load values from the total drainage area 2001 2011 from the srs approach and swat modeling excluding the flooded regions in each catchment the simulated mean annual total sediment load from all catchments was approximately 2 30 mt year from 2001 to 2011 dashed line in fig 10 kummu et al 2008 used hydrodynamic modeling to estimate the mean annual total sediment load for the same 11 catchments of the tsl basin during the period 2001 2003 and found that the annual total load was approximately 1 77 mt year the current study result for the corresponding period 2001 2003 was 1 81 mt year which is similar to that of the previous study the annual variation of sediment load flux into the lake was significant for example it varied from 1 45mt in 2003 to 3 40 mt in 2006 as presented in fig 10 the long term mean monthly variations in total sediment load from all catchments flowing into the lake from 2001 to 2011 are presented in fig 11 results showed that the sediment transport was dominant in the high rainfall period september october and the highest sediment load and discharge occurred in october exceeding 0 80 mt and dropped to 0 01 0 25 mt during the dry season or receding flood period november april the total annual sediment loads from sen sangker and baribo catchments contributed approximately 65 1 55 mt of the total sediment into the lake from all catchments while the smallest contribution 0 20 mt was from the dauntri and sreng catchments fig s6 additionally the average total sediment yield from all catchments was approximately 29 t km2 year between 2001 and 2011 fig s7 the total annual sediment yields from the sen sangker and baribo catchments were higher than other catchments 50 t km2 year the annual sediment yield of the sekong catchment was the highest 200 t km2 year the srepok catchment produced a sediment yield of approximately 70 t km2 year which was comparable with that of some catchments of the tsl basin including the baribo sangker and sen catchments which had a sediment yield of 55 98 t km2 year between 2005 and 2011 fig s8 4 conclusion in this study a novel srs regionalization method has been proposed using the swat model and som clustering technique to overcome the limitation of the critical attributes of a catchment favoring sediment similarity which usually exists in the conventional regionalization approaches additionally the srs minimizes uncertainty when simulating sediment load in ungauged catchments the performance of the srs model was evaluated by comparing it with the conventional regionalization methods and the results of model calibration in four catchments of the tsl and 3s basins the results indicated the comprehensive performance of the srs regionalization method for estimating sediment load in the ungauged catchments it considered the spatiotemporal variations of sediment response and its relationship with rainfall characteristics as a catchment attribute and showed the potential to ideally determine hydrological and sediment similarities between gauged and ungauged catchments the srs approach obtained an estimation error reduction of up to 7 compared with the ps regionalization method compared to the conventional approach there was an improvement in statistical metrics nse and r2 0 75 and 0 76 respectively for the srs method which was close to the calibration model results nse and r2 0 77 thereby outperforming the conventional approach the srs method was also selected to estimate sediment load in the ungauged tributaries of the tsl basin results showed that the annual total sediment flux into the lake from its tributaries is approximately 2 3 mt year with the highest sediment load occurring in october exceeding 0 8mt the proposed srs regionalization method effectively addressed the main challenge in conventional approaches which is the selection of ideal catchment attributes that favor hydrologic similarity between gauged and ungauged catchments thus the srs regionalization method proposed in this study is a global alternative method for estimating sediment load as well as other hydrological variables and rainfall driven phenomena such as streamflow and nutrient transport in ungauged catchments however in this study the applicability of the srs regionalization method is tested on a limited number of catchments and gauged datasets therefore it is recommended to incorporate more gauged catchments especially those with a larger scale and more sufficient in situ data to widely extend the method s applicability and minimize the associated uncertainty credit authorship contribution statement raksmey ang conceptualization methodology data curation software formal analysis investigation visualization validation writing original draft tsuyoshi kinouchi supervision investigation visualization writing review editing wenpeng zhao conceptualization methodology investigation validation software writing review editing declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments the authors thank the mekong river commission mrc for providing total suspended solids concentration land use and soil data and the department of hydrology and river works ministry of water resources and meteorology mowram of cambodia for providing observed daily water level datasets this research is supported by heiwa nakajima foundation japan appendix a the self organizing map som a sequential regression process carries out the training process of the som wallner et al 2013 1 set j 1 and select the input vector xj 2 identify the node with the reference vector mi most similar to the current input vector xj this neuron is called the winner neuron or best matching unit bmu a1 c arg min i x i m i t i 1 k where the index i ranges over all reference vectors on the map the quantity mi t refers to the reference vector at position i on the map at time step t 3 update the reference vector of the winner neuron mc and the neighboring neurons mi based on the current input vector xj a2 m i t 1 m i t α t h ci t x j m i t i 1 k where hci is the neighborhood function which decreases with increasing distance to the winner neuron and α is the learning rate which decreases with increasing time 4 set j j 1 and go back to step 2 until all input vectors are considered 5 set t t 1 and go back to step 1 until a fixed number of iterations is reached the above computation is usually repeated over the available input vectors many times during the training phase of the map each iteration is called a training epoch one of the advantages of the som is that they have an appealing visual representation as the 2 d unified distance matrix as seen in fig 2b as before the colors on the map represent the relative distances between reference vectors light colors indicate short distances and dark colors indicate long distances contiguous areas of light colors represent strong clusters hamel and brown 2011 appendix b supplementary data supplementary data to this article can be found online at https doi org 10 1016 j jhydrol 2023 129198 appendix b supplementary data the following are the supplementary data to this article supplementary data 1 
2213,the study of hyporheic exchange and the temperature response law driven by spur dikes is helpful to promote the protection of ecological river environments taking the river channel course with a spur dike as the research object the numerical simulation method was used to study the influence of the river width narrowing rate l b spur dike angle θ surface water velocity u and hydraulic conductivity k on the hyporheic exchange characteristics and the temperature response of the hyporheic zone research shows that the degree of hyporheic exchange and the spatial range of the temperature response of the hyporheic zone are positively correlated with the river width narrowing rate surface water velocity and hydraulic conductivity and negatively correlated with the spur dike angle the temperature response law of the hyporheic zone is affected by spur dikes in different spatial locations in the following ways from the cross section the upstream response area of the spur dike deepens near the dam bank while the downstream response area deepens on the other side of the spur dikes and the downstream response area affected by spur dikes is significantly larger than the upstream response area in the vertical range from the side section the response area of the curved boundary appears around the spur dike in the central section of the river and the curvature radius of the response area of the curved boundary around the spur dike in the side section near the dam is smaller from the longitudinal section the sensitivity of the temperature response of the shallow section is significantly stronger than that of the deep section consequently we found that the hyporheic exchange law driven by spur dikes we offer recommendations for future studies seeking to choose the reasonable structure of the spur dam in practical engineering and optimize the design of the spur dam keywords coupled surface subsurface model spur dike hyporheic exchange temperature response data availability no data was used for the research described in the article 1 introduction the surface water in natural rivers interacts with groundwater all the time and the hydraulic zone is the key area in which the surface water and groundwater in rivers are connected it is also an important place for water purification in rivers ren et al 2021 and the hyporheic exchange process occurring in this area is a common component of the surface water groundwater interaction chow et al 2019 kiel and cardenas 2014 lane et al 2018 lu et al 2020 trauth et al 2013 in this process a variety of substances nutrients and energy are transported and at the same time some pollutants in the water body are filtered out this is an important foundation for the ecological functions of rivers ward 2016 brunner et al 2017 weatherill et al 2018 harvey and gooseff 2015 the concept of the hydraulic zone was first put forward in romanian by orghidan kaser 2010 followed by the hydraulic zone corridor stanford and ward 1993 and river liver fischer et al 2005 the bioreactor lewandowski et al 2019 concept has gradually developed linking the relationship between the hyporheic zone and the ecological environment janse et al 2019 the study of hyporheic zones in recent decades has led to the realization of the important ecological significance of the connectivity between surface water and groundwater krause et al 2011 reviewed the water exchange process biogeochemical process and ecohydrological process of the hyporheic zone emphasizing that interdisciplinary research is of great significance to promote the development of research on the hyporheic zone surface water infiltration intensifies the temperature fluctuation in the hyporheic zone while groundwater upwelling slows the temperature fluctuation in the hyporheic zone norman and cardenas 2014 nan et al 2022 used heat as a tracer to verify the fluid heat coupling model shi et al 2020 monitored the temperature and water level changes in the hyporheic zone and analyzed the hydrothermal dynamics of the hyporheic zone after hydraulic development cranswick et al 2014 lautz 2012 wang et al 2018 used heat as a tracer to analyze and quantify groundwater and hyporheic flux as the spawning ground of some animals malcolm et al 2004 the refuge of biological escape from natural enemies williams and hynes 1974 and the place where microorganisms play a role in decomposition the temperature fluctuations between them play an important role in regulating these processes in view of the ecological importance of river temperature understanding and controlling heat flux is the key to effective river management king and neilson 2019 wu et al 2020 the restoration of river structures such as logs boulder weirs and spur dikes can not only regulate the surface water dynamics and reduce river scouring zhou and endreny 2012 but can also improve the landscape of the river basin and regulate the hyporheic exchange of rivers kasahara and hillm 2010 as an integral part of river restoration structures and they can play an active role in bank protection flood control waterway regulation river beach reclamation and river channel ecological restoration przedwojski 1995 based on theoretical analysis and numerical simulation methods this study takes the spur dike in a river restoration project as the research object analyzes the flow field around the spur dike the characteristic point pressure gradient the range and maximum flux of the active area of hyporheic exchange the hyporheic flux in all directions on the water sand interface the velocity and distribution of upwelling and downwelling the spatial range of temperature response in the hyporheic zone etc and studies the law of hyporheic exchange and temperature response driven by spur dikes 2 numerical model 2 1 numerical simulation control equation the coupling model of surface water and groundwater driven by spur dikes is mainly composed of the reynolds average ns rans equation rng k ε turbulence model darcy s law and the heat conduction equation 2 1 1 flow control equation in the cartesian coordinate system the continuity equation and momentum equation in the three dimensional model are as follows cao 2014 1 u x x u y y u z z 0 2 f x 1 ρ p x μ ρ 2 u x du x dt 3 f y 1 ρ p y μ ρ 2 u y du y dt 4 f z 1 ρ p z μ ρ 2 u z du z dt where ux uy and uz are the components of velocity in three directions t is time μ is the viscosity coefficient ρ is density p is pressure and fx fy and fz are the components of mass force in three directions there are two main methods to solve the ns equation the first method is direct numerical simulation dns which is rarely used in engineering except for some simple problems the second is to simplify or approximate the equation this study adopts the rans equation in the simplified method the instantaneous variables in the ns equation are decomposed into average terms and pulsation terms such as formula 5 cao 2014 5 ϕ ϕ ϕ where ϕ is stands for some variable for example p v and are then brought into the above formula and the time averaged continuous equation and rans equation can be obtained as follows cao 2014 6 u x x u y y u z z 0 7 ρ f x p x x μ u x x ρ u x 2 y μ u x y ρ u y u x z μ u x z ρ u z u x ρ u x t x u x u x y u y u x z u z u x 8 ρ f y p y x μ u y x ρ u y u x y μ u y y ρ u y 2 z μ u y z ρ u z u y ρ u y t x u y u x y u y u y z u z u y 9 ρ f z p z x μ u z x ρ u z u x y μ uz y ρ u y u z z μ u z z ρ u z 2 ρ u z t x u z u x y u y u z z u z u z where ρ u x 2 ρ u y 2 ρ u z 2 is the normal stress caused by pulsation and ρ u x u y ρ u z u x ρ u y u z is the additional shear stress the first three represent the normal stress caused by pulsation and the last three represent the additional shear stress which are collectively known as reynolds stress 2 1 2 surface water turbulence model because of the reynolds stress generated by the rans equation the related governing equations are not closed so the method of adding the transport coefficient is adopted and the corresponding turbulence model is the k ε model the k ε model can be divided into the standard k ε model rng k ε model and realizable k ε model among which the rng renormalization group model puts the influence of small scale turbulent motion on average flow into large scale turbulent motion and makes improvements based on the standard k ε model fluent inc 2014 first the rng k ε model has an additional annex in the ε equation second the rng k ε model can describe the vortex flow more accurately in this paper the rng k ε turbulence model fluent inc 2014 is adopted as follows 10 t ρ k x i ρ k u i x j α k μ eff k x j g k g b ρ ε y m s k 11 t ρ ε x i ρ ε u i x j α ε μ eff ε x j c 1 ε ε k g k g 3 ε g b c 2 ε ρ ε 2 k r ε s ε where k is kinetic energy μ eff eff is coefficient of viscosity ε is turbulent energy dissipation rate gk is the turbulent kinetic energy caused by the laminar velocity gradient gb is the turbulent kinetic energy caused by buoyancy α ε α k is the reciprocal value of the prandtl number and c 1 ε c 2 ε is the default model constant 2 1 3 equation of groundwater movement pore water movement in riverbed sediments is expressed by darcy s law as follows ren et al 2019 12 k μ p 0 where k is sediment permeability μ is the viscosity coefficient and p is pressure 2 1 4 porous medium temperature control equation 1 fourier law in 1822 fourier a french mathematician and physicist studied heat conduction in solids and believed that the heat passing through a fixed area per unit time was proportional to the temperature gradient and the cross sectional area and the direction of heat transmission was opposite to the direction of temperature growth namely the famous fourier law which is as follows zhu and xie 1990 13 q λ t x λ g r a d t where q is the heat flux λ is the thermal conductivity and gradt is the temperature gradient 2 heat transfer equation of the temperature field based on the law of conservation of energy the heat transfer equation of porous media is as follows farouki 1981 14 x λ xx t x y λ yy t y z λ zz t z ρ f c f v x t x v y t y v z t z ρ eq c eq t t the nabla operator has the following form 15 λ e q 2 t c w ρ w t u q g c eq ρ eq t t where t is temperature qg is the source sink term of the temperature field λ eq is the equivalent thermal conductivity of the aquifer ρ eq is the density of the aquifer c eq is the specific heat capacity of the aquifer u is the seepage velocity ρ w is the fluid density and c w is the specific heat capacity of the fluid 16 λ eq n λ w 1 n λ s 17 ρ eq c eq n ρ w c w 1 n ρ s c s where λ w is the thermal conductivity of the fluid λ s is the thermal conductivity of porous media ρs is the density of porous media and cs is the specific heat capacity of porous media 2 2 establishment of the computational domain and mesh generation the model calculation domain under study is modeled by dm the length of the flume is 18 m the width is 0 9 m and the height is 0 4 m the length of the spur dike is 0 3 m the width is 0 04 m and the height is 0 4 m the angle θ of the spur dike is 90 and it is arranged on the right bank 9 m away from the entrance section the dam body is a nonsubmerged impervious spur dike which is consistent with the relevant parameters of the validated model test jeon at el 2018 due to the large lengths upstream and downstream of the spur dike in the model test after verification of the numerical model 3 m upstream of the spur dike 10 times the maximum dam length and 8 m downstream 20 times the maximum dam length are selected as the study areas for parameters such as spur dike length and spur dike angle that change with the test conditions the dimensions are adjusted according to the conditions because the calculation domain of surface water is a standard and square structure a hexahedral grid is selected for subdivision after completing partial grid subdivision the grids around the spur dikes the two phase flow interface and the water sand interface are locally encrypted the surface water part is divided into approximately 1 380 000 unit grids and the unit grid quality range is between 0 95 and 1 00 freeform quadrilateral grids are partially selected for groundwater and grids near the spur dike and water sand interface are locally densified and the average grid quality is between 0 88 and 0 95 the grid quality test continues until the solution accuracy is no longer obviously changed due to the further encryption of the grid which indicates that the grid settings meet the calculation requirements 2 3 model boundary conditions the boundary conditions of the model are set as shown in fig 1 for the surface water part the inlet is set as the pressure inlet and velocity inlet boundary the interface between the upper part and the atmosphere is set as the pressure inlet boundary the outlet is set as the pressure outlet boundary and the remaining boundaries are set as the wall boundaries groundwater part the spur dike is set as a noncirculating boundary similar to the study of liu and chui 2020 and the water sand interface exerts a pressure transmission boundary and a periodic temperature boundary while the rest of the sidewalls and the bottom of the riverbed are set as noncirculating boundaries the water sand interface pressure calculated from the surface water part is transferred to the groundwater part as the pressure boundary at the top of the groundwater model through this process the surface water and groundwater area coupling study is carried out which is similar to the mainstream research method of hyporheic exchange trauth et al 2013 sawyer et al 2012 3 verification of surface water flow field based on the spur dike physical model test to test the accuracy of the model according to the model verification method of yuan et al 2021 in the study of hyporheic exchange the indoor flume model test of jeon et al 2018 was selected to verify the surface water flow field 3 1 introduction to the physical model test of the spur dike channel the experimental water tank is located at hanyang university in seoul south korea the sidewall and bottom of the water tank are made of glass and polyvinyl chloride pvc respectively the slope of the flume is zero and a nonsubmerged spur dike is installed at 9 m away from the entrance and perpendicular to the right sidewall during the test a nortek adv vectrino profiler is used to collect the instantaneous velocity at a sampling rate of 100 hz the relevant arrangement of the physical model test is shown in fig 2 and the direction of the arrow is the direction of water flow 3 2 layout of relevant test parameters and flow rate monitoring points this part of the verification only involves the simulation of the surface water flow field and the software used is ansys fluent see the introduction to the surface water model in sections 2 2 and 2 3 for the boundary conditions and mesh division the working conditions and model geometric parameters of the verified spur dike physical model test are shown in table 1 as shown in fig 3 the flow rate monitoring positions of the indoor flume test are arranged at 0 9 times the length of the spur dike upstream and 1 67 3 33 6 67 10 13 33 and 16 67 times the length of the spur dike downstream in this verification the test condition of a flow rate of 0 00528 m3 s is selected for simulation and the average flow rate under this condition is 0 273 m s 3 3 comparison and evaluation of simulation results the comparison between the monitoring point velocity and the model test results is shown in fig 4 x l represents the ratio of the distance between the monitoring point and the spur dike side to the dam length and u u represents the ratio of the longitudinal average velocity to the average velocity it can be observed that upstream of the spur dike x l 0 9 and the longitudinal velocity simulation effect of the whole cross section is better when x l l 67 x l 3 33 and x l 6 67 downstream of the spur dike the simulation effect of the longitudinal velocity near the spur dike is good but the simulation result far from the spur dike is small the simulation values of the three cross sections at the lower reaches of the spur dike x l 10 x l 3 33 and x l 16 67 are slightly smaller but according to the simulation results of the seven cross sections the theoretical method selected in the model has a good effect on the flow field simulation under the spur dike the error between the numerical simulation and model test results is evaluated and the simulation accuracy of the model is evaluated by the following two indicators root mean square error rmse and coefficient of determination r2 the relevant formula is as follows 18 rmse 1 n o i s i 2 n 19 r 2 1 i 1 n o i s i 2 i 1 n o i o 2 where o i is the actual measured value s i is the model fitting value n is the sample volume in the test and o is the average value of the test results the range for rmse is from 0 to positive infinity and the smaller the value is the better the simulation effect of the model xie and batlle aguilar 2017 for r2 the closer its value is to 1 the smaller the deviation between the simulated value and the measured value is and the higher the fitting accuracy is quinino et al 2013 as shown in fig 5 the rmse values of the seven monitoring sections vary from 0 094 to 0 178 the average rmse value is 0 157 which is much smaller than the experimental average value the range of r2 is 0 813 0 982 and the average value of r2 is 0 915 0 9 which shows that the simulation effect of the flow field in surface water is good 4 results and discussion 4 1 analysis of the flow field around the spur dike fig 6 shows the flow field distribution of the z 0 06 m section under the action of different influencing factors l b 0 represents the working condition without a spur dike and its cross sectional velocity is almost constant along the way in the flow field with spur dikes the water flows through the main flow area on the other side of the spur dikes the velocity increases and a clockwise backflow area is generated downstream of the spur dikes fig 6 a shows that with the increase in the river width narrowing rate the maximum velocity in the main flow area increases and the longitudinal distance required for the velocity to return to the initial velocity after flowing through the spur dike increases the width of the backflow area in the transverse direction increases from 0 35 m to approximately 0 5 m and the length in the longitudinal direction increases from 2 3 m to approximately 5 5 m the maximum velocity and the range of the backflow area in the main flow area are positively correlated with the river width narrowing rate l b fig 6 b shows that the angle of the spur dike has little influence on the flow velocity of the section and the scope of the backflow area behind the dam however the angle of the spur dike affects the position of the vortex center in the backwater area behind the dam for the vortex center under three working conditions from 0 9 m behind the dam corresponding to 67 5 to 1 1 m behind the dam corresponding to 112 5 with the increase in the spur dike angle the vortex center gradually moves downstream while horizontal distance from the dam head remains almost unchanged fig 6 c shows that as the surface water velocity u increases from 0 164 m s to 0 273 m s the longitudinal length of the backwater area behind the dam changes slightly but the transverse width shrinks slightly 4 2 pressure gradient at characteristic points of the water sediment interface when the spur dam is placed in the river channel the local flow structure can be changed under the action of the surface flow field in the spur dam structure the local backwater area will appear in upstream and the vortex backflow area appears in downstream of the dam the local pressure gradient change reflects the degree of hyporheic exchange at the water sand interface to some extent in the study the water sediment interface which is 0 2 m 0 5 m and 1 m away from the upstream and downstream areas of the spur dike and one or two times the minimum dam length from the spur dike bank is selected and 12 pressure monitoring points are set from the side near the spur dike to the side far away from the spur dike and from the upstream to the downstream and is the points are denoted as follows a1 a2 b1 b2 c1 c2 c1 c2 b1 b2 a1 and a2 as shown in fig 7 the pressure gradient of the upstream and downstream monitoring points equidistant from the dam axis is calculated as shown in the equation 20 p a 1 p a 1 p a 1 fig 8 shows the pressure gradient of the measuring points under different influencing factors for the river channel without a spur dike the pressure gradient of the measuring points is between 0 146 pa and 0 843 pa which is obviously lower than that under other working conditions for the river channel with spur dikes with the increase in the river width narrowing rate l b the pressure gradient p significantly increased as shown in a a1 as an example the pressure gradient of l b 3 15 is 23 740 pa that of l b 4 15 is 31 093 pa and that of l b 5 15 is 47 794 pa showing that the pressure gradient of l b 4 15 is higher than that of l b 3 15 compared with the l b 4 15 working condition the l b 5 15 working condition increased by 53 713 as fig 8 shows the pressure gradients of the other five calculation points in different working conditions also increased significantly the river width narrowing rate l b has a great influence on the pressure gradient of the calculation points with the increase in the river width narrowing rate the cross section of the river channel narrows and the phenomenon of backwater in front of the dam is more obvious the backwater in front of the dam causes the water face on the other side of the spur dike to become inclined additionally the horizontal gradient of the water surface increases and the height of the water drop at the head of the dam also increases which affects the pressure distribution at the water sediment interface at the same time the range of the downstream backflow area of the spur dike increases with increasing river width narrowing rate and the hydrodynamic characteristics in the backflow area are affected b the figure shows the pressure gradient of measuring points corresponding to different spur dike angles θ it can be observed that with the increase in the angle of the spur dike the pressure gradient p shows a decreasing trend to b1 for example the pressure gradient of θ 67 5 is 25 452 pa that of θ 90 is 24 476 pa that of θ 112 5 is 21 847 pa and that of θ 90 is 3 835 less than that of θ 67 5 because the local turbulence effect corresponding to θ 67 5 is greater than θ 90 and θ 112 5 the flow separation phenomenon at the dam head is more obvious and a local detention area is formed upstream of the dam the larger the spur dike angle θ is the smaller the detention area is which to some extent causes the above phenomenon c the figure shows the pressure gradient of measuring points under the action of different surface water velocities u it can be observed that with the increase in the surface water velocity u the pressure gradient p shows a significant increasing trend to c1 for example the pressure gradient of u 0 164 m s is 24 439 pa that of u 0 218 m s is 44 129 pa and that of u 0 273 m s is 70 684 pa showing that the pressure gradient of u 0 218 m s is higher than that of u 0 164 m s with the increase in surface water velocity u the turbulent strength and shear stress of the interface change more around the spur dike and the pressure gradient of the interface increases significantly for the pressure gradient near the spur dike and that far away from the spur dike take the l b 5 15 working condition as an example from left to right the pressure gradient values at the calculation points are 47 794 pa 43 339 pa 48 36 pa 42 234 pa 48 673 pa and 35 753 pa respectively it can be observed that the pressure gradients of a1 b1 and c1 are greater than those of a2 b2 and c2 the figure shows a similar rule for other working conditions as a series of measuring points far from the spur dike even under the working condition of the maximum river width narrowing ratio l b 5 15 the longitudinal connecting line between measuring points does not pass through the spur dike the connecting line of measuring points near the spur dike is blocked by the spur dike and a local backwater area is formed upstream of the dam the water flows around the spur dike and enters the mainstream area thus increasing the pressure of the water sand interface 4 3 distribution of the active area of hyporheic exchange 4 3 1 distribution of the active area of lateral hyporheic exchange fig 9 shows the distribution of the lateral hyporheic exchange flux in the zx section at y 0 45 m that is the lateral section in the middle of the riverbed for the working condition without a spur dike the lateral hyporheic exchange flux of the whole section is almost zero for the working condition with spur dikes the active area of hyporheic exchange is distributed around the spur dikes the sign only represents the direction regardless of the flux the same is true below the active area of hyporheic exchange is positive along the y axis upstream of the spur dikes and negative along the y axis downstream of the spur dikes fig 9 a shows that from the narrowing rate of the river width l b 3 15 to l b 5 15 the maximum value q y max of the lateral hyporheic exchange flux in the positive direction along the y axis increases from 7 326 l m 2 h 1 to 31 110 l m 2 h 1 the numerical range of the coordinate axis is unified in the figure for convenience of comparison and the lateral hyporheic exchange flux along the negative direction of the y axis is the highest q y max from 3 887 l m 2 h 1 the flux in the negative direction is expressed in absolute value the same below to 42 193 l m 2 h 1 for q y 1 8 l m 2 h 1 we can obtain a q y 1 8 l m 2 h 1 from 0 404 m2 to 2 691 m2 it can be observed that with the increase in the river width narrowing rate l b the flux in the active area of lateral hyporheic exchange is the highest q y max significantly increased and the range of the active area of lateral hyporheic exchange also showed a trend of significant increase with the increase in the river width narrowing ratio l b the overflow section narrows the flow velocity in the main flow area increases the gradient of the flow velocity behind the dam increases the nonuniformity of the surface water velocity increases the phenomenon of backwater in front of the dam occurs the horizontal gradient of the water surface increases and the lateral pressure gradient at the water sand interface increases which causes a more intense lateral hyporheic exchange fig 9 b shows the lateral hyporheic exchange flux distribution under the action of different spur dike angles for q y 1 8 l m 2 h 1 the active area of lateral exchange is integrated and the angles θ 67 5 θ 90 and θ 112 5 for the three working conditions of the corresponding a q y 1 8 l m 2 h 1 are 0 609 m2 0 404 m2 and 0 240 m2 it can be observed that with the increase in angle θ the area of lateral hyporheic exchange gradually decreases under the condition that the projection length of the dam length along the vertical flow direction section is the same the upward spur dike with θ 67 5 has a significant effect on the water flow and the disturbance to the river water is stronger than that of the forward spur dike and downward spur dike with θ 90 and θ 112 5 the phenomenon of backwater in front of the dam is obvious the area of slow flow detention is large and the horizontal gradient of the water surface is relatively large which makes the formation even worse fig 9 c shows that from the condition of surface water velocity u 0 164 m s to the condition of u 0 273 m s the lateral hyporheic exchange flux in the positive direction along the y axis of the section has the maximum value q y max it increased from 7 326 l m 2 h 1 to 20 507 l m 2 h 1 and the lateral hyporheic exchange flux in the negative direction along the y axis reached the maximum value q y max it increased from 3 887 l m 2 h 1 to 11 916 l m 2 h 1 for q y 1 8 l m 2 h 1 we can obtain a q y 1 8 l m 2 h 1 from 0 404 m2 to 1 779 m2 with the increase in surface water velocity u the flux in the active area of lateral hyporheic exchange reaches its maximum value q y max is significantly increased and the range of the active area of lateral hyporheic exchange also showed a trend of significant increase with the increase in surface water velocity u the turbulence intensity of water flowing near spur dikes increases the horizontal gradient of the water surface increases and the lateral pressure gradient of the water sand interface increases which drives more intense lateral hyporheic exchange fig 9 d shows that from the condition of sediment hydraulic conductivity k 7 350 10 4 m s to k 1 225 10 3 m s the lateral hyporheic exchange flux in the positive direction along the y axis of the section is the maximum the q y max increased from 7 326 l m 2 h 1 to 9 075 l m 2 h 1 and the lateral hyporheic exchange flux in the negative direction along the y axis is the highest the q y max increased from 3 887 l m 2 h 1 to 4 815 l m 2 h 1 by integrating the area of the lateral exchange active region we can obtain a q y 1 8 l m 2 h 1 values ranging from 0 182 m2 to 0 635 m2 it can be observed that with the increase in hydraulic conductivity k the maximum flux q y max in the active area of lateral hyporheic exchange increases and the active area of lateral hyporheic exchange also shows an increasing trend under the same pressure gradient with the increase in hydraulic conductivity k the interaction between surface water and groundwater is stronger and the lateral hyporheic exchange flux is larger 4 3 2 distribution of the active area of the vertical hyporheic exchange in the section fig 10 shows the distribution of vertical hyporheic exchange flux in the xy section at z 0 2 m the section 0 2 m below the water sand interface for the working condition without spur dikes the vertical hyporheic exchange flux is small in the middle area along the y axis and upwelling along the z axis appears at the sidewalls on both sides because the research is based on the indoor flume test the velocity near the sidewall of the flume decreases and the corresponding pressure decreases forming a weak hyporheic exchange from the center of the river to both sides for the working condition with the spur dike it can be observed that the vertical hyporheic exchange is active in the area around the spur dike there is an active area of vertical hyporheic exchange along the negative z axis upstream of the spur dike and there is an active area of vertical hyporheic exchange along the positive z axis downstream of the spur dike fig 10 a shows that from the narrowing rate of the river width l b 3 15 to l b 5 15 the vertical hyporheic exchange flux in the positive direction along the z axis in the section is the maximum q z max ranges from 7 673 l m 2 h 1 to 11 544 l m 2 h 1 and the vertical hyporheic exchange flux in the negative direction along the z axis is the highest q z max increased from 5 260 l m 2 h 1 to 10 444 l m 2 h 1 for q y 1 8 l m 2 h 1 in the vertical exchange active area we can obtain a q z 1 8 l m 2 h 1 values ranging from 0 849 m2 to 3 890 m2 it can be observed that with the increase in the river width narrowing rate l b the range of the vertical hyporheic exchange active area increases and the flux in the active area reaches the maximum value q z max also shows an increasing trend with the increase in the river width narrowing rate l b the greater the narrowing degree of the river channel is the more obvious the water blocking effect the height of falling water at the dam head increases which increases the pressure gradient at the local water sand interface and promotes vertical hyporheic exchange around the spur dike fig 10 b shows that the vertical hyporheic exchange flux along the positive direction of the z axis in the section is the highest in the three working conditions of angles θ 67 5 θ 90 and θ 112 5 and the maximum q z max values of the vertical hyporheic exchange flux along the z axis in the section are 7 734 l m 2 h 1 7 673 l m 2 h 1 and 7 184 l m 2 h 1 respectively on the a q z 1 8 l m 2 h 1 vertical exchange of the active region for the integral area we can obtain that the a q z 1 8 l m 2 h 1 values are 0 885 m2 0 849 m2 0 724 m2 it can be observed that with the increase in the spur dike angle θ the flux in the active area of vertical hyporheic exchange is the highest q z max is slightly reduced and the range of active area of vertical hyporheic exchange also shows a decreasing trend with the increase in the angle θ of the spur dike the influence of the spur dike on the water flow structure changes from blocking the water flow to receiving the water flow the horizontal gradient of the water surface in front of the dam and the height of the water drop at the dam head decrease the nonuniformity of the pressure distribution at the water sand interface decreases and the degree of vertical hyporheic exchange decreases fig 10 c shows that from the surface water velocity ranging from u 0 164 m s to u 0 273 m s the vertical hyporheic exchange flux in the positive direction along the z axis in the section is the maximum q z max ranges from 7 673 l m 2 h 1 to 24 025 l m 2 h 1 and the vertical hyporheic exchange flux in the negative direction along the z axis is the highest q z max increased from 5 260 l m 2 h 1 to 13 913 l m 2 h 1 for q z 1 8 l m 2 h 1 in the vertical exchange active area we can obtain a q z 1 8 l m 2 h 1 values ranging from 0 849 m2 to 3 754 m2 it can be observed that with the increase in surface water velocity u the maximum flux q z max in the active area of vertical hyporheic exchange increases and the range of the active area of vertical hyporheic exchange also shows a significant increasing trend with the increase in the surface water velocity u the turbulence intensity of water flow in the flow field is increased and the spur dike more obviously obstructs the water flow which causes a larger shear stress to form at the water sand interface increases the pressure gradient at the interface and promotes vertical hyporheic exchange around the spur dike fig 10 d shows that from the hydraulic conductivity k 7 350 10 4 m s to k 1 225 10 3 m s the vertical hyporheic exchange flux in the positive direction along the z axis of the cross section is the maximum q z max ranges from 7 673 l m 2 h 1 to 9 780 l m 2 h 1 and the maximum value of q z max of the negative vertical hyporheic exchange flux along the negative direction of the z axis increases from 5 260 l m 2 h 1 to 6 730 l m 2 h 1 for q z 1 8 l m 2 h 1 the vertical exchange active area integral and available a q z 1 8 l m 2 h 1 increase from 0 639 m2 to 1 062 m2 it can be observed that with the increase in sediment hydraulic conductivity k the maximum flux q z max in the active area of vertical hyporheic exchange increases and the active area of vertical hyporheic exchange also shows an increasing trend under the same pressure gradient with the increase in hydraulic conductivity k the interaction between surface water and groundwater is strengthened and the vertical hyporheic exchange flux increases 4 4 comparison of the hyporheic exchange at the water sediment interface fig 11 shows the hyporheic exchange at the water sand interface in all directions under different influencing factors and l b 0 indicates that there is no spur dike in the river channel fig 11 a shows that the layout of the spur dike promoted hyporheic exchange in all directions at the water sand interface for the case of the spur dike taking the case of l b 5 15 as an example the exchange capacity values of the water sand interface in the lateral vertical and longitudinal directions are 2 235 10 5 m3 s 2 563 10 5 m3 s and 5 107 10 6 m3 s respectively it can be observed from the figure that other working conditions also show a small exchange capacity phenomenon along the longitudinal direction and it can be observed that the water sand interface is mainly dominated by vertical and lateral hyporheic exchange taking the total exchange capacity of the water sand interface as an example the total exchange capacity values under the three working conditions of l b 3 15 l b 4 15 and l b 5 15 are 1 435 10 5 m3 s 1 871 10 5 m3 s and 3 990 10 5 m3 s respectively compared with the l b 3 15 working condition the l b 4 15 working condition increased by 30 383 and the l b 5 15 working condition increased by 113 255 it can be observed from the figure that the hyporheic exchange capacity values in the other three directions also present similar change rules and it can be seen that the hyporheic exchange capacity and total exchange capacity values in all directions of the water sand interface are positively correlated with the river width narrowing rate l b with the increase in the river width narrowing rate l b the narrowing degree of the river channel increases the obstruction to the water flow becomes more obvious the horizontal gradient of the water surface and the falling height of the dam head increase and the pressure gradient of the water sand interface also increases which intensifies the degree of hyporheic exchange in all directions of the interface fig 11 b shows that taking the total exchange capacity of the water sand interface as an example the corresponding total exchange capacity values are 1 584 10 5 m3 s 1 435 10 5 m3 s and 1 166 10 5 m3 s under the three working conditions of angles θ 67 5 θ 90 and θ 112 5 respectively compared with θ 112 5 θ 90 increased by 23 070 and θ 67 5 increased by 10 382 compared with θ 90 it can be observed from the figure that the hyporheic exchange capacity values in the other three directions also show similar change rules and it can be observed that the hyporheic exchange capacity and total exchange capacity values in all directions of the water sand interface are negatively correlated with the spur dike angle θ with the increase in the angle θ of the spur dike the influence degree on the flow structure decreases from obstructing the flow to receiving the flow the horizontal gradient of the water surface in front of the dam and the falling height at the head of the dam decrease and the uneven distribution of vertical and lateral pressure at the water sand interface weakens resulting in the decrease in the degree of hyporheic exchange in all directions at the interface and the decrease in the total exchange capacity fig 11 c shows that taking the total exchange capacity of the interface as an example the total exchange capacity values of the water sand interface under the three working conditions of u 0 164 m s u 0 218 m s and u 0 273 m s are 1 435 10 5 m3 s 3 204 10 5 m3 s and 4 841 10 5 m3 s respectively compared with u 0 164 m s the working condition of u 0 218 m s increased by 123 275 and the working condition of u 0 273 m s increased by 51 092 it can be observed from the figure that the hyporheic exchange capacity values in the other three directions also show similar change rules and it can be observed that the hyporheic exchange capacity at the water sand interface is positively correlated with the surface water velocity u with the increase in surface water velocity u the turbulent kinetic energy of water flow in the river channel increases and the pressure gradient of the water sand interface becomes larger which intensifies the degree of hyporheic exchange in all directions of the interface fig 11 d shows that taking the total exchange capacity of the water sand interface as an example the total exchange capacity values of the water sand interface under the three working conditions of k 7 350 10 4 m s k 9 800 10 4 m s and k 1 125 10 3 m s are 1 076 10 5 m3 s 1 435 10 5 m3 s and 1 794 10 5 m3 s respectively compared with the condition of k 7 350 10 4 m s the working condition of k 9 800 10 4 m s increased by 33 364 and the condition of k 1 125 10 3 m s increased by 25 017 compared with the working condition of k 9 800 10 4 m s it can be observed from the figure that the exchange capacity values of the other three directions also show similar change laws with the increase in hydraulic conductivity k the interaction between surface water and groundwater is strengthened and the amount of hyporheic exchange occurring in all directions of the interface also increases 4 5 comparison of the temperature response 4 5 1 comparison of the lateral profile temperature response to compare and describe the influence of different working conditions on the temperature field distribution in the hyporheic zone the area close to the surface water temperature at the moment in the hyporheic zone is defined as the temperature response area of the hyporheic zone hereinafter referred to as the response area for the analysis of the following response areas the cloud picture of the temperature field at t 36 h is selected at this time the surface water experienced the second temperature rise cycle and started to cool down for a period of time considering the lag of the temperature in the hyporheic zone with the surface water temperature the temperature in the hyporheic zone is higher at t 36 h than at most other times fig 12 shows the temperature distribution of the lateral section of zx at y 0 1 m and 0 45 m under the action of different river width narrowing ratios l b for the working condition without a spur dike the response area is shallow in the vertical direction and unchanged along the path and the response areas of the two sections y 0 1 m and 0 45 m are similar for the working condition with a spur dike in the y 0 1 m section an arc shaped response area with a smaller curvature radius appears near the spur dike with the increase in the river width narrowing ratio l b surface water velocity u and hydraulic conductivity k and the decrease in the spur dike angle θ the curvature radius of the arc boundary decreases and the response area appears only in the shallow layer of the riverbed at the upstream and downstream ends of the river in the y 0 45 m section the vertical depth of the response area near the spur dike is positively correlated with the river width narrowing rate l b the layout of the spur dike changed the pressure gradient of the surrounding riverbed and promoted the degree of hyporheic exchange the exchanged water transferred the surface water heat in the hyporheic zone which affected the temperature field response near the spur dike with the increase in the river width and the narrowing of the l b ratio the surface water heat is hindered more strongly the pressure gradient at the water sand interface is increased the intensity of hyporheic exchange is increased and the response area increases 4 5 2 cross sectional temperature response comparison fig 13 shows the cross sectional temperature distribution at x 3 m 0 2 m 0 5 m and 4 m under different river width narrowing rates l b for the working condition without a spur dike the response areas of the four sections are almost unchanged and the response areas of the left and right banks are basically flush the x 3 m section is located 3 m upstream of the spur dike and the response areas of the left and right banks are basically flush which is similar to the response areas of this section without a spur dike and the response areas with different influencing factors in this section are similar the layout of the spur dike has little influence on the response areas in this section the x 0 2 m section is located 0 2 m upstream of the spur dike compared with the x 3 m section the response area on the spur dike side is deepened vertically by integrating the area of the response area with t 22 85 c it can be concluded that the a t 22 85 c values are 0 158 m2 0 176 m2 and 0 200 m2 with the increase in the river width narrowing rate l b with the increase in the spur dike angle θ the values are 0 159 m2 0 158 m2 and 0 154 m2 with the increase in the surface water velocity u the a t 22 85 c values are 0 158 m2 0 183 m2 and 0 217 m2 with the increase in hydraulic conductivity k the a t 22 85 c values are 0 150 m2 0 158 m2 and 0 166 m2 the response area of the x 0 2 m section is positively correlated with the river width narrowing rate l b surface water velocity u and hydraulic conductivity k and negatively correlated with the spur dike angle θ the x 0 5 m section is located 0 5 m downstream of the spur dike compared with the x 3 m section the response area of the spur dike on the other side is deepened vertically and the deepening degree is positively correlated with the river width narrowing rate l b surface water velocity u and hydraulic conductivity k and negatively correlated with the spur dike angle θ the x 4 m section is located 4 m downstream of the spur dike it can be observed from the figure that there is a downward protruding arc shaped boundary between the dam head and the other side of the spur dike in the response area with the increase in the river width narrowing rate l b surface water velocity u and hydraulic conductivity k and the decrease in the spur dike angle θ the arc shaped boundary is more prominent the layout of spur dikes hinders the water flow in the river channel and the water flow near the spur dikes upstream of the dam is greatly blocked so the surface water needs to bypass the spur dikes and the local backwater phenomenon occurs in front of the dam facing the opposite bank of the spur dike the horizontal gradient of the water surface increases forming a detention area in front of the spur dike with low velocity which increases the pressure gradient at the local water sand interface the descending flow in front of the spur dike transfers the surface water temperature in the hyporheic zone thus increasing the response area in front of the spur dike 4 5 3 comparison of the longitudinal section temperature response fig 14 shows the temperature distribution of the xy longitudinal section at z 0 2 m and 0 35 m for the working condition without a spur dike the temperature of the z 0 2 m section is approximately 22 2 c and that of the z 0 35 m section is approximately 21 0 c which remains almost unchanged along the way for the working condition with spur dikes a local low temperature area appears near the spur dikes downstream of the z 0 2 m section and the distance between the upstream boundary of the low temperature area and the spur dikes increases slightly with increasing river width narrowing rate l b in the z 0 35 m section there is a relatively high temperature area upstream of the spur dike and a relatively low temperature area downstream of the spur dike the areas of both areas increase with the increase in the river width narrowing rate l b surface water velocity u and hydraulic conductivity k and the decrease in the spur dike angle θ compared with the two sections the average temperature of the z 0 2 m section is significantly higher than that of the z 0 35 m section considering that the surface water temperature has proceeded through the second temperature rise cycle it can be observed that the sensitivity of the z 0 2 m section to the temperature response is obviously stronger than that of the z 0 35 m section the layout of spur dikes changes the river flow structure increases the turbulence intensity of the water flow around the dam and increases the pressure gradient of the water sand interface around the dam resulting in a downward flow upstream of the dam and an upward flow downstream of the dam the downward flow transfers the surface water temperature to the hyporheic zone and the upward flow transfers the temperature of the hyporheic zone to the surface water due to the simulated temperature change in the two cycles the average value of the fluctuating temperature in the cycle is higher than that in the sediment so the surface water transfers high heat to the hyporheic zone and the groundwater transfers low heat to the river flow forming the phenomenon shown in the figure below with the increase in the river width narrowing ratio l b surface water velocity u and hydraulic conductivity k and the decrease in the spur dike angle θ the turbulence intensity of local water flow increases forming a larger pressure gradient and the upwelling and downflowing fluxes increase resulting in a larger local high temperature area and local low temperature area 4 6 comparison of temperature time series six temperature monitoring points are arranged for riverbed sediments namely tl 0 5 0 45 0 1 t2 0 5 0 45 0 2 t3 0 5 0 45 0 3 t4 0 5 0 45 0 1 t5 0 5 0 45 0 2 and t6 0 5 0 45 0 3 i e y 0 45 m 0 1 m 0 2 m and 0 3 m away from the water sediment interface between 0 5 m in front of the dam and 0 5 m behind the dam fig 15 shows the fluctuation of the river water temperature and temperature at six monitoring points with time under the action of different river width narrowing ratios l b for the working condition without a spur dike the temperature time series curves of tl and t4 t2 and t5 and t3 and t6 coincide indicating that at the same depth the temperature changes at different monitoring points are similar for the case of the spur dike taking l b 3 15 as an example the surface water temperature rises at t 8 h and the time for t1 and t4 to end the temperature rise is t 13 h the temperature change of the two monitoring points at z 0 1 m has a certain lag compared with the change in river water temperature since the river water temperature is higher than the initial temperature of the riverbed sediment the temperatures at the t2 t3 t5 and t6 monitoring points showed a slow upward trend within 48 h and the hysteresis of temperature change with the change in river water temperature could not be found in the study period compared with the temperature changes of the monitoring points at different depths under the same working conditions it can be observed that the temperature fluctuation amplitude at z 0 1 m is significantly greater than that at z 0 2 m and the temperature fluctuation amplitude at z 0 2 m is slightly greater than that at z 0 3 m the perception ability of the shallow riverbed to surface water temperature change is significantly stronger than that of the deep riverbed and the perception gradient gradually decreases with increasing depth comparing the temperature time series of different working conditions taking the t2 and t5 monitoring points as examples it can be observed that with the increase in the narrowing ratio l b surface water velocity u hydraulic conductivity k and spur dike angle θ the temperature difference between the two points gradually increases it can be observed from the figure that there are similar rules for the tl and t4 t3 and t6 monitoring points with the increase in the river width narrowing ratio l b surface flow velocity u hydraulic conductivity k and spur dike angle θ the results show that the flow velocity in the mainstream area increases the turbulence intensity around the spur dike increases and the nonuniformity of the flow behind the spur dike increases which increases the pressure gradient of the water sediment interface around the spur dike the descending velocity rate upstream of the spur dike increases significantly and the local bed temperature upstream is closer to the relatively high temperature of the surface water the rising velocity rate downstream of the spur dike increases and the temperature of the local riverbed downstream is closer to the relatively low temperature of the groundwater which forms a graphical phenomenon 5 conclusion based on the model verification method of yuan and the physical model test of spur dikes carried out by scholar jeon the surface water groundwater coupling model driven by spur dikes was verified the simulation results were evaluated by the root mean square error rmse and determination coefficient rmse the range of the rmse values of the monitoring section is 0 094 0 178 and the average value of rmse is 0 157 which is far less than the mean value of the measured results r2 ranges from 0 813 to 0 982 and r2 is 0 915 which is 0 9 and shows that the simulation effect of the surface water flow field is better compared with the channel without a spur dike the layout of the spur dike changes the flow structure of the river channel and causes the shear stress and pressure distribution of the water sediment interface near the dam body to increase the increase in the river width narrowing ratio and surface water velocity promotes the change in shear stress and pressure distribution and the increase in the spur dike angle inhibits the change in shear stress and pressure distribution the arrangement of spur dikes strengthens the exchange degree of riverbed subsurface flow and increases the spatial range of the temperature response in the hyporheic zone in the river channel with a spur dike the active area of hyporheic exchange is distributed around the spur dike and the river width narrowing ratio l b and spur dike angle are found θ the surface water velocity u changes the flow field characteristics of the spur dike and causes changes in the hyporheic exchange characteristics and temperature field response the exchange degree of subsurface flow and the spatial range of the temperature response are positively correlated with the river width narrowing rate l b surface water velocity u and hydraulic conductivity k and are related to the spur dike angle θ there was a negative correlation the results show that the upstream response region of the spur dike deepens near the dam bank while the downstream response region deepens on the opposite side of the spur dike the downstream response area affected by the spur dike is significantly larger than that upstream in the longitudinal range from the side section the response area of the arc boundary appears around the spur dike in the central section of the river channel and the radius of curvature of the arc boundary response area around the spur dike is smaller in the near dam side section from the longitudinal section the sensitivity of the temperature response of the shallow section is significantly stronger than that of the deep section the summary of the law of hyporheic exchange and temperature response under the drive of the groin provides very useful results for the application of the spur dike in practical engineering especially in optimizing the structural design of the spur dike which will help the structure of the spur dike play a better role in the river ecological restoration credit authorship contribution statement jie ren funding acquisition formal analysis resources software methodology supervision writing review editing ting zhuang conceptualization software methodology validation writing review editing fan wang software data curation juan dai writing review editing jie wang software data curation declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments we thank the precious suggestions by anonymous reviewers and editors which have greatly helped the improvement of the paper this work was supported by the program 2022td 01 for shaanxi provincial innovative research team and the key scientific research project of the education department of shaanxi province grant no dfzx202007 and supported by the open research fund program of state key laboratory of eco hydraulics in northwest arid region xi an university of technology grant no 2021kfkt 3 and supported by open research fund program of state key laboratory of hydraulics and mountain river engineering sichuan university grant no skhl2106 
2213,the study of hyporheic exchange and the temperature response law driven by spur dikes is helpful to promote the protection of ecological river environments taking the river channel course with a spur dike as the research object the numerical simulation method was used to study the influence of the river width narrowing rate l b spur dike angle θ surface water velocity u and hydraulic conductivity k on the hyporheic exchange characteristics and the temperature response of the hyporheic zone research shows that the degree of hyporheic exchange and the spatial range of the temperature response of the hyporheic zone are positively correlated with the river width narrowing rate surface water velocity and hydraulic conductivity and negatively correlated with the spur dike angle the temperature response law of the hyporheic zone is affected by spur dikes in different spatial locations in the following ways from the cross section the upstream response area of the spur dike deepens near the dam bank while the downstream response area deepens on the other side of the spur dikes and the downstream response area affected by spur dikes is significantly larger than the upstream response area in the vertical range from the side section the response area of the curved boundary appears around the spur dike in the central section of the river and the curvature radius of the response area of the curved boundary around the spur dike in the side section near the dam is smaller from the longitudinal section the sensitivity of the temperature response of the shallow section is significantly stronger than that of the deep section consequently we found that the hyporheic exchange law driven by spur dikes we offer recommendations for future studies seeking to choose the reasonable structure of the spur dam in practical engineering and optimize the design of the spur dam keywords coupled surface subsurface model spur dike hyporheic exchange temperature response data availability no data was used for the research described in the article 1 introduction the surface water in natural rivers interacts with groundwater all the time and the hydraulic zone is the key area in which the surface water and groundwater in rivers are connected it is also an important place for water purification in rivers ren et al 2021 and the hyporheic exchange process occurring in this area is a common component of the surface water groundwater interaction chow et al 2019 kiel and cardenas 2014 lane et al 2018 lu et al 2020 trauth et al 2013 in this process a variety of substances nutrients and energy are transported and at the same time some pollutants in the water body are filtered out this is an important foundation for the ecological functions of rivers ward 2016 brunner et al 2017 weatherill et al 2018 harvey and gooseff 2015 the concept of the hydraulic zone was first put forward in romanian by orghidan kaser 2010 followed by the hydraulic zone corridor stanford and ward 1993 and river liver fischer et al 2005 the bioreactor lewandowski et al 2019 concept has gradually developed linking the relationship between the hyporheic zone and the ecological environment janse et al 2019 the study of hyporheic zones in recent decades has led to the realization of the important ecological significance of the connectivity between surface water and groundwater krause et al 2011 reviewed the water exchange process biogeochemical process and ecohydrological process of the hyporheic zone emphasizing that interdisciplinary research is of great significance to promote the development of research on the hyporheic zone surface water infiltration intensifies the temperature fluctuation in the hyporheic zone while groundwater upwelling slows the temperature fluctuation in the hyporheic zone norman and cardenas 2014 nan et al 2022 used heat as a tracer to verify the fluid heat coupling model shi et al 2020 monitored the temperature and water level changes in the hyporheic zone and analyzed the hydrothermal dynamics of the hyporheic zone after hydraulic development cranswick et al 2014 lautz 2012 wang et al 2018 used heat as a tracer to analyze and quantify groundwater and hyporheic flux as the spawning ground of some animals malcolm et al 2004 the refuge of biological escape from natural enemies williams and hynes 1974 and the place where microorganisms play a role in decomposition the temperature fluctuations between them play an important role in regulating these processes in view of the ecological importance of river temperature understanding and controlling heat flux is the key to effective river management king and neilson 2019 wu et al 2020 the restoration of river structures such as logs boulder weirs and spur dikes can not only regulate the surface water dynamics and reduce river scouring zhou and endreny 2012 but can also improve the landscape of the river basin and regulate the hyporheic exchange of rivers kasahara and hillm 2010 as an integral part of river restoration structures and they can play an active role in bank protection flood control waterway regulation river beach reclamation and river channel ecological restoration przedwojski 1995 based on theoretical analysis and numerical simulation methods this study takes the spur dike in a river restoration project as the research object analyzes the flow field around the spur dike the characteristic point pressure gradient the range and maximum flux of the active area of hyporheic exchange the hyporheic flux in all directions on the water sand interface the velocity and distribution of upwelling and downwelling the spatial range of temperature response in the hyporheic zone etc and studies the law of hyporheic exchange and temperature response driven by spur dikes 2 numerical model 2 1 numerical simulation control equation the coupling model of surface water and groundwater driven by spur dikes is mainly composed of the reynolds average ns rans equation rng k ε turbulence model darcy s law and the heat conduction equation 2 1 1 flow control equation in the cartesian coordinate system the continuity equation and momentum equation in the three dimensional model are as follows cao 2014 1 u x x u y y u z z 0 2 f x 1 ρ p x μ ρ 2 u x du x dt 3 f y 1 ρ p y μ ρ 2 u y du y dt 4 f z 1 ρ p z μ ρ 2 u z du z dt where ux uy and uz are the components of velocity in three directions t is time μ is the viscosity coefficient ρ is density p is pressure and fx fy and fz are the components of mass force in three directions there are two main methods to solve the ns equation the first method is direct numerical simulation dns which is rarely used in engineering except for some simple problems the second is to simplify or approximate the equation this study adopts the rans equation in the simplified method the instantaneous variables in the ns equation are decomposed into average terms and pulsation terms such as formula 5 cao 2014 5 ϕ ϕ ϕ where ϕ is stands for some variable for example p v and are then brought into the above formula and the time averaged continuous equation and rans equation can be obtained as follows cao 2014 6 u x x u y y u z z 0 7 ρ f x p x x μ u x x ρ u x 2 y μ u x y ρ u y u x z μ u x z ρ u z u x ρ u x t x u x u x y u y u x z u z u x 8 ρ f y p y x μ u y x ρ u y u x y μ u y y ρ u y 2 z μ u y z ρ u z u y ρ u y t x u y u x y u y u y z u z u y 9 ρ f z p z x μ u z x ρ u z u x y μ uz y ρ u y u z z μ u z z ρ u z 2 ρ u z t x u z u x y u y u z z u z u z where ρ u x 2 ρ u y 2 ρ u z 2 is the normal stress caused by pulsation and ρ u x u y ρ u z u x ρ u y u z is the additional shear stress the first three represent the normal stress caused by pulsation and the last three represent the additional shear stress which are collectively known as reynolds stress 2 1 2 surface water turbulence model because of the reynolds stress generated by the rans equation the related governing equations are not closed so the method of adding the transport coefficient is adopted and the corresponding turbulence model is the k ε model the k ε model can be divided into the standard k ε model rng k ε model and realizable k ε model among which the rng renormalization group model puts the influence of small scale turbulent motion on average flow into large scale turbulent motion and makes improvements based on the standard k ε model fluent inc 2014 first the rng k ε model has an additional annex in the ε equation second the rng k ε model can describe the vortex flow more accurately in this paper the rng k ε turbulence model fluent inc 2014 is adopted as follows 10 t ρ k x i ρ k u i x j α k μ eff k x j g k g b ρ ε y m s k 11 t ρ ε x i ρ ε u i x j α ε μ eff ε x j c 1 ε ε k g k g 3 ε g b c 2 ε ρ ε 2 k r ε s ε where k is kinetic energy μ eff eff is coefficient of viscosity ε is turbulent energy dissipation rate gk is the turbulent kinetic energy caused by the laminar velocity gradient gb is the turbulent kinetic energy caused by buoyancy α ε α k is the reciprocal value of the prandtl number and c 1 ε c 2 ε is the default model constant 2 1 3 equation of groundwater movement pore water movement in riverbed sediments is expressed by darcy s law as follows ren et al 2019 12 k μ p 0 where k is sediment permeability μ is the viscosity coefficient and p is pressure 2 1 4 porous medium temperature control equation 1 fourier law in 1822 fourier a french mathematician and physicist studied heat conduction in solids and believed that the heat passing through a fixed area per unit time was proportional to the temperature gradient and the cross sectional area and the direction of heat transmission was opposite to the direction of temperature growth namely the famous fourier law which is as follows zhu and xie 1990 13 q λ t x λ g r a d t where q is the heat flux λ is the thermal conductivity and gradt is the temperature gradient 2 heat transfer equation of the temperature field based on the law of conservation of energy the heat transfer equation of porous media is as follows farouki 1981 14 x λ xx t x y λ yy t y z λ zz t z ρ f c f v x t x v y t y v z t z ρ eq c eq t t the nabla operator has the following form 15 λ e q 2 t c w ρ w t u q g c eq ρ eq t t where t is temperature qg is the source sink term of the temperature field λ eq is the equivalent thermal conductivity of the aquifer ρ eq is the density of the aquifer c eq is the specific heat capacity of the aquifer u is the seepage velocity ρ w is the fluid density and c w is the specific heat capacity of the fluid 16 λ eq n λ w 1 n λ s 17 ρ eq c eq n ρ w c w 1 n ρ s c s where λ w is the thermal conductivity of the fluid λ s is the thermal conductivity of porous media ρs is the density of porous media and cs is the specific heat capacity of porous media 2 2 establishment of the computational domain and mesh generation the model calculation domain under study is modeled by dm the length of the flume is 18 m the width is 0 9 m and the height is 0 4 m the length of the spur dike is 0 3 m the width is 0 04 m and the height is 0 4 m the angle θ of the spur dike is 90 and it is arranged on the right bank 9 m away from the entrance section the dam body is a nonsubmerged impervious spur dike which is consistent with the relevant parameters of the validated model test jeon at el 2018 due to the large lengths upstream and downstream of the spur dike in the model test after verification of the numerical model 3 m upstream of the spur dike 10 times the maximum dam length and 8 m downstream 20 times the maximum dam length are selected as the study areas for parameters such as spur dike length and spur dike angle that change with the test conditions the dimensions are adjusted according to the conditions because the calculation domain of surface water is a standard and square structure a hexahedral grid is selected for subdivision after completing partial grid subdivision the grids around the spur dikes the two phase flow interface and the water sand interface are locally encrypted the surface water part is divided into approximately 1 380 000 unit grids and the unit grid quality range is between 0 95 and 1 00 freeform quadrilateral grids are partially selected for groundwater and grids near the spur dike and water sand interface are locally densified and the average grid quality is between 0 88 and 0 95 the grid quality test continues until the solution accuracy is no longer obviously changed due to the further encryption of the grid which indicates that the grid settings meet the calculation requirements 2 3 model boundary conditions the boundary conditions of the model are set as shown in fig 1 for the surface water part the inlet is set as the pressure inlet and velocity inlet boundary the interface between the upper part and the atmosphere is set as the pressure inlet boundary the outlet is set as the pressure outlet boundary and the remaining boundaries are set as the wall boundaries groundwater part the spur dike is set as a noncirculating boundary similar to the study of liu and chui 2020 and the water sand interface exerts a pressure transmission boundary and a periodic temperature boundary while the rest of the sidewalls and the bottom of the riverbed are set as noncirculating boundaries the water sand interface pressure calculated from the surface water part is transferred to the groundwater part as the pressure boundary at the top of the groundwater model through this process the surface water and groundwater area coupling study is carried out which is similar to the mainstream research method of hyporheic exchange trauth et al 2013 sawyer et al 2012 3 verification of surface water flow field based on the spur dike physical model test to test the accuracy of the model according to the model verification method of yuan et al 2021 in the study of hyporheic exchange the indoor flume model test of jeon et al 2018 was selected to verify the surface water flow field 3 1 introduction to the physical model test of the spur dike channel the experimental water tank is located at hanyang university in seoul south korea the sidewall and bottom of the water tank are made of glass and polyvinyl chloride pvc respectively the slope of the flume is zero and a nonsubmerged spur dike is installed at 9 m away from the entrance and perpendicular to the right sidewall during the test a nortek adv vectrino profiler is used to collect the instantaneous velocity at a sampling rate of 100 hz the relevant arrangement of the physical model test is shown in fig 2 and the direction of the arrow is the direction of water flow 3 2 layout of relevant test parameters and flow rate monitoring points this part of the verification only involves the simulation of the surface water flow field and the software used is ansys fluent see the introduction to the surface water model in sections 2 2 and 2 3 for the boundary conditions and mesh division the working conditions and model geometric parameters of the verified spur dike physical model test are shown in table 1 as shown in fig 3 the flow rate monitoring positions of the indoor flume test are arranged at 0 9 times the length of the spur dike upstream and 1 67 3 33 6 67 10 13 33 and 16 67 times the length of the spur dike downstream in this verification the test condition of a flow rate of 0 00528 m3 s is selected for simulation and the average flow rate under this condition is 0 273 m s 3 3 comparison and evaluation of simulation results the comparison between the monitoring point velocity and the model test results is shown in fig 4 x l represents the ratio of the distance between the monitoring point and the spur dike side to the dam length and u u represents the ratio of the longitudinal average velocity to the average velocity it can be observed that upstream of the spur dike x l 0 9 and the longitudinal velocity simulation effect of the whole cross section is better when x l l 67 x l 3 33 and x l 6 67 downstream of the spur dike the simulation effect of the longitudinal velocity near the spur dike is good but the simulation result far from the spur dike is small the simulation values of the three cross sections at the lower reaches of the spur dike x l 10 x l 3 33 and x l 16 67 are slightly smaller but according to the simulation results of the seven cross sections the theoretical method selected in the model has a good effect on the flow field simulation under the spur dike the error between the numerical simulation and model test results is evaluated and the simulation accuracy of the model is evaluated by the following two indicators root mean square error rmse and coefficient of determination r2 the relevant formula is as follows 18 rmse 1 n o i s i 2 n 19 r 2 1 i 1 n o i s i 2 i 1 n o i o 2 where o i is the actual measured value s i is the model fitting value n is the sample volume in the test and o is the average value of the test results the range for rmse is from 0 to positive infinity and the smaller the value is the better the simulation effect of the model xie and batlle aguilar 2017 for r2 the closer its value is to 1 the smaller the deviation between the simulated value and the measured value is and the higher the fitting accuracy is quinino et al 2013 as shown in fig 5 the rmse values of the seven monitoring sections vary from 0 094 to 0 178 the average rmse value is 0 157 which is much smaller than the experimental average value the range of r2 is 0 813 0 982 and the average value of r2 is 0 915 0 9 which shows that the simulation effect of the flow field in surface water is good 4 results and discussion 4 1 analysis of the flow field around the spur dike fig 6 shows the flow field distribution of the z 0 06 m section under the action of different influencing factors l b 0 represents the working condition without a spur dike and its cross sectional velocity is almost constant along the way in the flow field with spur dikes the water flows through the main flow area on the other side of the spur dikes the velocity increases and a clockwise backflow area is generated downstream of the spur dikes fig 6 a shows that with the increase in the river width narrowing rate the maximum velocity in the main flow area increases and the longitudinal distance required for the velocity to return to the initial velocity after flowing through the spur dike increases the width of the backflow area in the transverse direction increases from 0 35 m to approximately 0 5 m and the length in the longitudinal direction increases from 2 3 m to approximately 5 5 m the maximum velocity and the range of the backflow area in the main flow area are positively correlated with the river width narrowing rate l b fig 6 b shows that the angle of the spur dike has little influence on the flow velocity of the section and the scope of the backflow area behind the dam however the angle of the spur dike affects the position of the vortex center in the backwater area behind the dam for the vortex center under three working conditions from 0 9 m behind the dam corresponding to 67 5 to 1 1 m behind the dam corresponding to 112 5 with the increase in the spur dike angle the vortex center gradually moves downstream while horizontal distance from the dam head remains almost unchanged fig 6 c shows that as the surface water velocity u increases from 0 164 m s to 0 273 m s the longitudinal length of the backwater area behind the dam changes slightly but the transverse width shrinks slightly 4 2 pressure gradient at characteristic points of the water sediment interface when the spur dam is placed in the river channel the local flow structure can be changed under the action of the surface flow field in the spur dam structure the local backwater area will appear in upstream and the vortex backflow area appears in downstream of the dam the local pressure gradient change reflects the degree of hyporheic exchange at the water sand interface to some extent in the study the water sediment interface which is 0 2 m 0 5 m and 1 m away from the upstream and downstream areas of the spur dike and one or two times the minimum dam length from the spur dike bank is selected and 12 pressure monitoring points are set from the side near the spur dike to the side far away from the spur dike and from the upstream to the downstream and is the points are denoted as follows a1 a2 b1 b2 c1 c2 c1 c2 b1 b2 a1 and a2 as shown in fig 7 the pressure gradient of the upstream and downstream monitoring points equidistant from the dam axis is calculated as shown in the equation 20 p a 1 p a 1 p a 1 fig 8 shows the pressure gradient of the measuring points under different influencing factors for the river channel without a spur dike the pressure gradient of the measuring points is between 0 146 pa and 0 843 pa which is obviously lower than that under other working conditions for the river channel with spur dikes with the increase in the river width narrowing rate l b the pressure gradient p significantly increased as shown in a a1 as an example the pressure gradient of l b 3 15 is 23 740 pa that of l b 4 15 is 31 093 pa and that of l b 5 15 is 47 794 pa showing that the pressure gradient of l b 4 15 is higher than that of l b 3 15 compared with the l b 4 15 working condition the l b 5 15 working condition increased by 53 713 as fig 8 shows the pressure gradients of the other five calculation points in different working conditions also increased significantly the river width narrowing rate l b has a great influence on the pressure gradient of the calculation points with the increase in the river width narrowing rate the cross section of the river channel narrows and the phenomenon of backwater in front of the dam is more obvious the backwater in front of the dam causes the water face on the other side of the spur dike to become inclined additionally the horizontal gradient of the water surface increases and the height of the water drop at the head of the dam also increases which affects the pressure distribution at the water sediment interface at the same time the range of the downstream backflow area of the spur dike increases with increasing river width narrowing rate and the hydrodynamic characteristics in the backflow area are affected b the figure shows the pressure gradient of measuring points corresponding to different spur dike angles θ it can be observed that with the increase in the angle of the spur dike the pressure gradient p shows a decreasing trend to b1 for example the pressure gradient of θ 67 5 is 25 452 pa that of θ 90 is 24 476 pa that of θ 112 5 is 21 847 pa and that of θ 90 is 3 835 less than that of θ 67 5 because the local turbulence effect corresponding to θ 67 5 is greater than θ 90 and θ 112 5 the flow separation phenomenon at the dam head is more obvious and a local detention area is formed upstream of the dam the larger the spur dike angle θ is the smaller the detention area is which to some extent causes the above phenomenon c the figure shows the pressure gradient of measuring points under the action of different surface water velocities u it can be observed that with the increase in the surface water velocity u the pressure gradient p shows a significant increasing trend to c1 for example the pressure gradient of u 0 164 m s is 24 439 pa that of u 0 218 m s is 44 129 pa and that of u 0 273 m s is 70 684 pa showing that the pressure gradient of u 0 218 m s is higher than that of u 0 164 m s with the increase in surface water velocity u the turbulent strength and shear stress of the interface change more around the spur dike and the pressure gradient of the interface increases significantly for the pressure gradient near the spur dike and that far away from the spur dike take the l b 5 15 working condition as an example from left to right the pressure gradient values at the calculation points are 47 794 pa 43 339 pa 48 36 pa 42 234 pa 48 673 pa and 35 753 pa respectively it can be observed that the pressure gradients of a1 b1 and c1 are greater than those of a2 b2 and c2 the figure shows a similar rule for other working conditions as a series of measuring points far from the spur dike even under the working condition of the maximum river width narrowing ratio l b 5 15 the longitudinal connecting line between measuring points does not pass through the spur dike the connecting line of measuring points near the spur dike is blocked by the spur dike and a local backwater area is formed upstream of the dam the water flows around the spur dike and enters the mainstream area thus increasing the pressure of the water sand interface 4 3 distribution of the active area of hyporheic exchange 4 3 1 distribution of the active area of lateral hyporheic exchange fig 9 shows the distribution of the lateral hyporheic exchange flux in the zx section at y 0 45 m that is the lateral section in the middle of the riverbed for the working condition without a spur dike the lateral hyporheic exchange flux of the whole section is almost zero for the working condition with spur dikes the active area of hyporheic exchange is distributed around the spur dikes the sign only represents the direction regardless of the flux the same is true below the active area of hyporheic exchange is positive along the y axis upstream of the spur dikes and negative along the y axis downstream of the spur dikes fig 9 a shows that from the narrowing rate of the river width l b 3 15 to l b 5 15 the maximum value q y max of the lateral hyporheic exchange flux in the positive direction along the y axis increases from 7 326 l m 2 h 1 to 31 110 l m 2 h 1 the numerical range of the coordinate axis is unified in the figure for convenience of comparison and the lateral hyporheic exchange flux along the negative direction of the y axis is the highest q y max from 3 887 l m 2 h 1 the flux in the negative direction is expressed in absolute value the same below to 42 193 l m 2 h 1 for q y 1 8 l m 2 h 1 we can obtain a q y 1 8 l m 2 h 1 from 0 404 m2 to 2 691 m2 it can be observed that with the increase in the river width narrowing rate l b the flux in the active area of lateral hyporheic exchange is the highest q y max significantly increased and the range of the active area of lateral hyporheic exchange also showed a trend of significant increase with the increase in the river width narrowing ratio l b the overflow section narrows the flow velocity in the main flow area increases the gradient of the flow velocity behind the dam increases the nonuniformity of the surface water velocity increases the phenomenon of backwater in front of the dam occurs the horizontal gradient of the water surface increases and the lateral pressure gradient at the water sand interface increases which causes a more intense lateral hyporheic exchange fig 9 b shows the lateral hyporheic exchange flux distribution under the action of different spur dike angles for q y 1 8 l m 2 h 1 the active area of lateral exchange is integrated and the angles θ 67 5 θ 90 and θ 112 5 for the three working conditions of the corresponding a q y 1 8 l m 2 h 1 are 0 609 m2 0 404 m2 and 0 240 m2 it can be observed that with the increase in angle θ the area of lateral hyporheic exchange gradually decreases under the condition that the projection length of the dam length along the vertical flow direction section is the same the upward spur dike with θ 67 5 has a significant effect on the water flow and the disturbance to the river water is stronger than that of the forward spur dike and downward spur dike with θ 90 and θ 112 5 the phenomenon of backwater in front of the dam is obvious the area of slow flow detention is large and the horizontal gradient of the water surface is relatively large which makes the formation even worse fig 9 c shows that from the condition of surface water velocity u 0 164 m s to the condition of u 0 273 m s the lateral hyporheic exchange flux in the positive direction along the y axis of the section has the maximum value q y max it increased from 7 326 l m 2 h 1 to 20 507 l m 2 h 1 and the lateral hyporheic exchange flux in the negative direction along the y axis reached the maximum value q y max it increased from 3 887 l m 2 h 1 to 11 916 l m 2 h 1 for q y 1 8 l m 2 h 1 we can obtain a q y 1 8 l m 2 h 1 from 0 404 m2 to 1 779 m2 with the increase in surface water velocity u the flux in the active area of lateral hyporheic exchange reaches its maximum value q y max is significantly increased and the range of the active area of lateral hyporheic exchange also showed a trend of significant increase with the increase in surface water velocity u the turbulence intensity of water flowing near spur dikes increases the horizontal gradient of the water surface increases and the lateral pressure gradient of the water sand interface increases which drives more intense lateral hyporheic exchange fig 9 d shows that from the condition of sediment hydraulic conductivity k 7 350 10 4 m s to k 1 225 10 3 m s the lateral hyporheic exchange flux in the positive direction along the y axis of the section is the maximum the q y max increased from 7 326 l m 2 h 1 to 9 075 l m 2 h 1 and the lateral hyporheic exchange flux in the negative direction along the y axis is the highest the q y max increased from 3 887 l m 2 h 1 to 4 815 l m 2 h 1 by integrating the area of the lateral exchange active region we can obtain a q y 1 8 l m 2 h 1 values ranging from 0 182 m2 to 0 635 m2 it can be observed that with the increase in hydraulic conductivity k the maximum flux q y max in the active area of lateral hyporheic exchange increases and the active area of lateral hyporheic exchange also shows an increasing trend under the same pressure gradient with the increase in hydraulic conductivity k the interaction between surface water and groundwater is stronger and the lateral hyporheic exchange flux is larger 4 3 2 distribution of the active area of the vertical hyporheic exchange in the section fig 10 shows the distribution of vertical hyporheic exchange flux in the xy section at z 0 2 m the section 0 2 m below the water sand interface for the working condition without spur dikes the vertical hyporheic exchange flux is small in the middle area along the y axis and upwelling along the z axis appears at the sidewalls on both sides because the research is based on the indoor flume test the velocity near the sidewall of the flume decreases and the corresponding pressure decreases forming a weak hyporheic exchange from the center of the river to both sides for the working condition with the spur dike it can be observed that the vertical hyporheic exchange is active in the area around the spur dike there is an active area of vertical hyporheic exchange along the negative z axis upstream of the spur dike and there is an active area of vertical hyporheic exchange along the positive z axis downstream of the spur dike fig 10 a shows that from the narrowing rate of the river width l b 3 15 to l b 5 15 the vertical hyporheic exchange flux in the positive direction along the z axis in the section is the maximum q z max ranges from 7 673 l m 2 h 1 to 11 544 l m 2 h 1 and the vertical hyporheic exchange flux in the negative direction along the z axis is the highest q z max increased from 5 260 l m 2 h 1 to 10 444 l m 2 h 1 for q y 1 8 l m 2 h 1 in the vertical exchange active area we can obtain a q z 1 8 l m 2 h 1 values ranging from 0 849 m2 to 3 890 m2 it can be observed that with the increase in the river width narrowing rate l b the range of the vertical hyporheic exchange active area increases and the flux in the active area reaches the maximum value q z max also shows an increasing trend with the increase in the river width narrowing rate l b the greater the narrowing degree of the river channel is the more obvious the water blocking effect the height of falling water at the dam head increases which increases the pressure gradient at the local water sand interface and promotes vertical hyporheic exchange around the spur dike fig 10 b shows that the vertical hyporheic exchange flux along the positive direction of the z axis in the section is the highest in the three working conditions of angles θ 67 5 θ 90 and θ 112 5 and the maximum q z max values of the vertical hyporheic exchange flux along the z axis in the section are 7 734 l m 2 h 1 7 673 l m 2 h 1 and 7 184 l m 2 h 1 respectively on the a q z 1 8 l m 2 h 1 vertical exchange of the active region for the integral area we can obtain that the a q z 1 8 l m 2 h 1 values are 0 885 m2 0 849 m2 0 724 m2 it can be observed that with the increase in the spur dike angle θ the flux in the active area of vertical hyporheic exchange is the highest q z max is slightly reduced and the range of active area of vertical hyporheic exchange also shows a decreasing trend with the increase in the angle θ of the spur dike the influence of the spur dike on the water flow structure changes from blocking the water flow to receiving the water flow the horizontal gradient of the water surface in front of the dam and the height of the water drop at the dam head decrease the nonuniformity of the pressure distribution at the water sand interface decreases and the degree of vertical hyporheic exchange decreases fig 10 c shows that from the surface water velocity ranging from u 0 164 m s to u 0 273 m s the vertical hyporheic exchange flux in the positive direction along the z axis in the section is the maximum q z max ranges from 7 673 l m 2 h 1 to 24 025 l m 2 h 1 and the vertical hyporheic exchange flux in the negative direction along the z axis is the highest q z max increased from 5 260 l m 2 h 1 to 13 913 l m 2 h 1 for q z 1 8 l m 2 h 1 in the vertical exchange active area we can obtain a q z 1 8 l m 2 h 1 values ranging from 0 849 m2 to 3 754 m2 it can be observed that with the increase in surface water velocity u the maximum flux q z max in the active area of vertical hyporheic exchange increases and the range of the active area of vertical hyporheic exchange also shows a significant increasing trend with the increase in the surface water velocity u the turbulence intensity of water flow in the flow field is increased and the spur dike more obviously obstructs the water flow which causes a larger shear stress to form at the water sand interface increases the pressure gradient at the interface and promotes vertical hyporheic exchange around the spur dike fig 10 d shows that from the hydraulic conductivity k 7 350 10 4 m s to k 1 225 10 3 m s the vertical hyporheic exchange flux in the positive direction along the z axis of the cross section is the maximum q z max ranges from 7 673 l m 2 h 1 to 9 780 l m 2 h 1 and the maximum value of q z max of the negative vertical hyporheic exchange flux along the negative direction of the z axis increases from 5 260 l m 2 h 1 to 6 730 l m 2 h 1 for q z 1 8 l m 2 h 1 the vertical exchange active area integral and available a q z 1 8 l m 2 h 1 increase from 0 639 m2 to 1 062 m2 it can be observed that with the increase in sediment hydraulic conductivity k the maximum flux q z max in the active area of vertical hyporheic exchange increases and the active area of vertical hyporheic exchange also shows an increasing trend under the same pressure gradient with the increase in hydraulic conductivity k the interaction between surface water and groundwater is strengthened and the vertical hyporheic exchange flux increases 4 4 comparison of the hyporheic exchange at the water sediment interface fig 11 shows the hyporheic exchange at the water sand interface in all directions under different influencing factors and l b 0 indicates that there is no spur dike in the river channel fig 11 a shows that the layout of the spur dike promoted hyporheic exchange in all directions at the water sand interface for the case of the spur dike taking the case of l b 5 15 as an example the exchange capacity values of the water sand interface in the lateral vertical and longitudinal directions are 2 235 10 5 m3 s 2 563 10 5 m3 s and 5 107 10 6 m3 s respectively it can be observed from the figure that other working conditions also show a small exchange capacity phenomenon along the longitudinal direction and it can be observed that the water sand interface is mainly dominated by vertical and lateral hyporheic exchange taking the total exchange capacity of the water sand interface as an example the total exchange capacity values under the three working conditions of l b 3 15 l b 4 15 and l b 5 15 are 1 435 10 5 m3 s 1 871 10 5 m3 s and 3 990 10 5 m3 s respectively compared with the l b 3 15 working condition the l b 4 15 working condition increased by 30 383 and the l b 5 15 working condition increased by 113 255 it can be observed from the figure that the hyporheic exchange capacity values in the other three directions also present similar change rules and it can be seen that the hyporheic exchange capacity and total exchange capacity values in all directions of the water sand interface are positively correlated with the river width narrowing rate l b with the increase in the river width narrowing rate l b the narrowing degree of the river channel increases the obstruction to the water flow becomes more obvious the horizontal gradient of the water surface and the falling height of the dam head increase and the pressure gradient of the water sand interface also increases which intensifies the degree of hyporheic exchange in all directions of the interface fig 11 b shows that taking the total exchange capacity of the water sand interface as an example the corresponding total exchange capacity values are 1 584 10 5 m3 s 1 435 10 5 m3 s and 1 166 10 5 m3 s under the three working conditions of angles θ 67 5 θ 90 and θ 112 5 respectively compared with θ 112 5 θ 90 increased by 23 070 and θ 67 5 increased by 10 382 compared with θ 90 it can be observed from the figure that the hyporheic exchange capacity values in the other three directions also show similar change rules and it can be observed that the hyporheic exchange capacity and total exchange capacity values in all directions of the water sand interface are negatively correlated with the spur dike angle θ with the increase in the angle θ of the spur dike the influence degree on the flow structure decreases from obstructing the flow to receiving the flow the horizontal gradient of the water surface in front of the dam and the falling height at the head of the dam decrease and the uneven distribution of vertical and lateral pressure at the water sand interface weakens resulting in the decrease in the degree of hyporheic exchange in all directions at the interface and the decrease in the total exchange capacity fig 11 c shows that taking the total exchange capacity of the interface as an example the total exchange capacity values of the water sand interface under the three working conditions of u 0 164 m s u 0 218 m s and u 0 273 m s are 1 435 10 5 m3 s 3 204 10 5 m3 s and 4 841 10 5 m3 s respectively compared with u 0 164 m s the working condition of u 0 218 m s increased by 123 275 and the working condition of u 0 273 m s increased by 51 092 it can be observed from the figure that the hyporheic exchange capacity values in the other three directions also show similar change rules and it can be observed that the hyporheic exchange capacity at the water sand interface is positively correlated with the surface water velocity u with the increase in surface water velocity u the turbulent kinetic energy of water flow in the river channel increases and the pressure gradient of the water sand interface becomes larger which intensifies the degree of hyporheic exchange in all directions of the interface fig 11 d shows that taking the total exchange capacity of the water sand interface as an example the total exchange capacity values of the water sand interface under the three working conditions of k 7 350 10 4 m s k 9 800 10 4 m s and k 1 125 10 3 m s are 1 076 10 5 m3 s 1 435 10 5 m3 s and 1 794 10 5 m3 s respectively compared with the condition of k 7 350 10 4 m s the working condition of k 9 800 10 4 m s increased by 33 364 and the condition of k 1 125 10 3 m s increased by 25 017 compared with the working condition of k 9 800 10 4 m s it can be observed from the figure that the exchange capacity values of the other three directions also show similar change laws with the increase in hydraulic conductivity k the interaction between surface water and groundwater is strengthened and the amount of hyporheic exchange occurring in all directions of the interface also increases 4 5 comparison of the temperature response 4 5 1 comparison of the lateral profile temperature response to compare and describe the influence of different working conditions on the temperature field distribution in the hyporheic zone the area close to the surface water temperature at the moment in the hyporheic zone is defined as the temperature response area of the hyporheic zone hereinafter referred to as the response area for the analysis of the following response areas the cloud picture of the temperature field at t 36 h is selected at this time the surface water experienced the second temperature rise cycle and started to cool down for a period of time considering the lag of the temperature in the hyporheic zone with the surface water temperature the temperature in the hyporheic zone is higher at t 36 h than at most other times fig 12 shows the temperature distribution of the lateral section of zx at y 0 1 m and 0 45 m under the action of different river width narrowing ratios l b for the working condition without a spur dike the response area is shallow in the vertical direction and unchanged along the path and the response areas of the two sections y 0 1 m and 0 45 m are similar for the working condition with a spur dike in the y 0 1 m section an arc shaped response area with a smaller curvature radius appears near the spur dike with the increase in the river width narrowing ratio l b surface water velocity u and hydraulic conductivity k and the decrease in the spur dike angle θ the curvature radius of the arc boundary decreases and the response area appears only in the shallow layer of the riverbed at the upstream and downstream ends of the river in the y 0 45 m section the vertical depth of the response area near the spur dike is positively correlated with the river width narrowing rate l b the layout of the spur dike changed the pressure gradient of the surrounding riverbed and promoted the degree of hyporheic exchange the exchanged water transferred the surface water heat in the hyporheic zone which affected the temperature field response near the spur dike with the increase in the river width and the narrowing of the l b ratio the surface water heat is hindered more strongly the pressure gradient at the water sand interface is increased the intensity of hyporheic exchange is increased and the response area increases 4 5 2 cross sectional temperature response comparison fig 13 shows the cross sectional temperature distribution at x 3 m 0 2 m 0 5 m and 4 m under different river width narrowing rates l b for the working condition without a spur dike the response areas of the four sections are almost unchanged and the response areas of the left and right banks are basically flush the x 3 m section is located 3 m upstream of the spur dike and the response areas of the left and right banks are basically flush which is similar to the response areas of this section without a spur dike and the response areas with different influencing factors in this section are similar the layout of the spur dike has little influence on the response areas in this section the x 0 2 m section is located 0 2 m upstream of the spur dike compared with the x 3 m section the response area on the spur dike side is deepened vertically by integrating the area of the response area with t 22 85 c it can be concluded that the a t 22 85 c values are 0 158 m2 0 176 m2 and 0 200 m2 with the increase in the river width narrowing rate l b with the increase in the spur dike angle θ the values are 0 159 m2 0 158 m2 and 0 154 m2 with the increase in the surface water velocity u the a t 22 85 c values are 0 158 m2 0 183 m2 and 0 217 m2 with the increase in hydraulic conductivity k the a t 22 85 c values are 0 150 m2 0 158 m2 and 0 166 m2 the response area of the x 0 2 m section is positively correlated with the river width narrowing rate l b surface water velocity u and hydraulic conductivity k and negatively correlated with the spur dike angle θ the x 0 5 m section is located 0 5 m downstream of the spur dike compared with the x 3 m section the response area of the spur dike on the other side is deepened vertically and the deepening degree is positively correlated with the river width narrowing rate l b surface water velocity u and hydraulic conductivity k and negatively correlated with the spur dike angle θ the x 4 m section is located 4 m downstream of the spur dike it can be observed from the figure that there is a downward protruding arc shaped boundary between the dam head and the other side of the spur dike in the response area with the increase in the river width narrowing rate l b surface water velocity u and hydraulic conductivity k and the decrease in the spur dike angle θ the arc shaped boundary is more prominent the layout of spur dikes hinders the water flow in the river channel and the water flow near the spur dikes upstream of the dam is greatly blocked so the surface water needs to bypass the spur dikes and the local backwater phenomenon occurs in front of the dam facing the opposite bank of the spur dike the horizontal gradient of the water surface increases forming a detention area in front of the spur dike with low velocity which increases the pressure gradient at the local water sand interface the descending flow in front of the spur dike transfers the surface water temperature in the hyporheic zone thus increasing the response area in front of the spur dike 4 5 3 comparison of the longitudinal section temperature response fig 14 shows the temperature distribution of the xy longitudinal section at z 0 2 m and 0 35 m for the working condition without a spur dike the temperature of the z 0 2 m section is approximately 22 2 c and that of the z 0 35 m section is approximately 21 0 c which remains almost unchanged along the way for the working condition with spur dikes a local low temperature area appears near the spur dikes downstream of the z 0 2 m section and the distance between the upstream boundary of the low temperature area and the spur dikes increases slightly with increasing river width narrowing rate l b in the z 0 35 m section there is a relatively high temperature area upstream of the spur dike and a relatively low temperature area downstream of the spur dike the areas of both areas increase with the increase in the river width narrowing rate l b surface water velocity u and hydraulic conductivity k and the decrease in the spur dike angle θ compared with the two sections the average temperature of the z 0 2 m section is significantly higher than that of the z 0 35 m section considering that the surface water temperature has proceeded through the second temperature rise cycle it can be observed that the sensitivity of the z 0 2 m section to the temperature response is obviously stronger than that of the z 0 35 m section the layout of spur dikes changes the river flow structure increases the turbulence intensity of the water flow around the dam and increases the pressure gradient of the water sand interface around the dam resulting in a downward flow upstream of the dam and an upward flow downstream of the dam the downward flow transfers the surface water temperature to the hyporheic zone and the upward flow transfers the temperature of the hyporheic zone to the surface water due to the simulated temperature change in the two cycles the average value of the fluctuating temperature in the cycle is higher than that in the sediment so the surface water transfers high heat to the hyporheic zone and the groundwater transfers low heat to the river flow forming the phenomenon shown in the figure below with the increase in the river width narrowing ratio l b surface water velocity u and hydraulic conductivity k and the decrease in the spur dike angle θ the turbulence intensity of local water flow increases forming a larger pressure gradient and the upwelling and downflowing fluxes increase resulting in a larger local high temperature area and local low temperature area 4 6 comparison of temperature time series six temperature monitoring points are arranged for riverbed sediments namely tl 0 5 0 45 0 1 t2 0 5 0 45 0 2 t3 0 5 0 45 0 3 t4 0 5 0 45 0 1 t5 0 5 0 45 0 2 and t6 0 5 0 45 0 3 i e y 0 45 m 0 1 m 0 2 m and 0 3 m away from the water sediment interface between 0 5 m in front of the dam and 0 5 m behind the dam fig 15 shows the fluctuation of the river water temperature and temperature at six monitoring points with time under the action of different river width narrowing ratios l b for the working condition without a spur dike the temperature time series curves of tl and t4 t2 and t5 and t3 and t6 coincide indicating that at the same depth the temperature changes at different monitoring points are similar for the case of the spur dike taking l b 3 15 as an example the surface water temperature rises at t 8 h and the time for t1 and t4 to end the temperature rise is t 13 h the temperature change of the two monitoring points at z 0 1 m has a certain lag compared with the change in river water temperature since the river water temperature is higher than the initial temperature of the riverbed sediment the temperatures at the t2 t3 t5 and t6 monitoring points showed a slow upward trend within 48 h and the hysteresis of temperature change with the change in river water temperature could not be found in the study period compared with the temperature changes of the monitoring points at different depths under the same working conditions it can be observed that the temperature fluctuation amplitude at z 0 1 m is significantly greater than that at z 0 2 m and the temperature fluctuation amplitude at z 0 2 m is slightly greater than that at z 0 3 m the perception ability of the shallow riverbed to surface water temperature change is significantly stronger than that of the deep riverbed and the perception gradient gradually decreases with increasing depth comparing the temperature time series of different working conditions taking the t2 and t5 monitoring points as examples it can be observed that with the increase in the narrowing ratio l b surface water velocity u hydraulic conductivity k and spur dike angle θ the temperature difference between the two points gradually increases it can be observed from the figure that there are similar rules for the tl and t4 t3 and t6 monitoring points with the increase in the river width narrowing ratio l b surface flow velocity u hydraulic conductivity k and spur dike angle θ the results show that the flow velocity in the mainstream area increases the turbulence intensity around the spur dike increases and the nonuniformity of the flow behind the spur dike increases which increases the pressure gradient of the water sediment interface around the spur dike the descending velocity rate upstream of the spur dike increases significantly and the local bed temperature upstream is closer to the relatively high temperature of the surface water the rising velocity rate downstream of the spur dike increases and the temperature of the local riverbed downstream is closer to the relatively low temperature of the groundwater which forms a graphical phenomenon 5 conclusion based on the model verification method of yuan and the physical model test of spur dikes carried out by scholar jeon the surface water groundwater coupling model driven by spur dikes was verified the simulation results were evaluated by the root mean square error rmse and determination coefficient rmse the range of the rmse values of the monitoring section is 0 094 0 178 and the average value of rmse is 0 157 which is far less than the mean value of the measured results r2 ranges from 0 813 to 0 982 and r2 is 0 915 which is 0 9 and shows that the simulation effect of the surface water flow field is better compared with the channel without a spur dike the layout of the spur dike changes the flow structure of the river channel and causes the shear stress and pressure distribution of the water sediment interface near the dam body to increase the increase in the river width narrowing ratio and surface water velocity promotes the change in shear stress and pressure distribution and the increase in the spur dike angle inhibits the change in shear stress and pressure distribution the arrangement of spur dikes strengthens the exchange degree of riverbed subsurface flow and increases the spatial range of the temperature response in the hyporheic zone in the river channel with a spur dike the active area of hyporheic exchange is distributed around the spur dike and the river width narrowing ratio l b and spur dike angle are found θ the surface water velocity u changes the flow field characteristics of the spur dike and causes changes in the hyporheic exchange characteristics and temperature field response the exchange degree of subsurface flow and the spatial range of the temperature response are positively correlated with the river width narrowing rate l b surface water velocity u and hydraulic conductivity k and are related to the spur dike angle θ there was a negative correlation the results show that the upstream response region of the spur dike deepens near the dam bank while the downstream response region deepens on the opposite side of the spur dike the downstream response area affected by the spur dike is significantly larger than that upstream in the longitudinal range from the side section the response area of the arc boundary appears around the spur dike in the central section of the river channel and the radius of curvature of the arc boundary response area around the spur dike is smaller in the near dam side section from the longitudinal section the sensitivity of the temperature response of the shallow section is significantly stronger than that of the deep section the summary of the law of hyporheic exchange and temperature response under the drive of the groin provides very useful results for the application of the spur dike in practical engineering especially in optimizing the structural design of the spur dike which will help the structure of the spur dike play a better role in the river ecological restoration credit authorship contribution statement jie ren funding acquisition formal analysis resources software methodology supervision writing review editing ting zhuang conceptualization software methodology validation writing review editing fan wang software data curation juan dai writing review editing jie wang software data curation declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments we thank the precious suggestions by anonymous reviewers and editors which have greatly helped the improvement of the paper this work was supported by the program 2022td 01 for shaanxi provincial innovative research team and the key scientific research project of the education department of shaanxi province grant no dfzx202007 and supported by the open research fund program of state key laboratory of eco hydraulics in northwest arid region xi an university of technology grant no 2021kfkt 3 and supported by open research fund program of state key laboratory of hydraulics and mountain river engineering sichuan university grant no skhl2106 
2214,accurate inflow forecasts with sufficient lead time are highly crucial for efficient reservoir operation for which this study advocates the popular mike11 nam hd mike standalone conceptual hydrological model and its two error updating frameworks for 1 5 days ahead inflow forecasting these two modelling frameworks integrate the recently developed wavelet based nonlinear autoregressive neural network with exogenous inputs wnarx and a novel nested smoothing based long short term memory lstm network as the error updating models with the standalone mike11 nam hd model respectively the available rainfall forecasts are bias corrected using the gaussian and archimedean copulas enhanced kohonen self organizing maps eksom and hybrid copula eksom cop som approaches the mike11 nam hd forced with the raw india meteorological department multi model ensemble imd mme and the selected bias corrected rainfall forecasts are hereafter named as rmike and bcmike respectively these proposed frameworks are tested for daily streamflow forecasting into the hirakud multi purpose reservoir in eastern india the results reveal that the hybrid cop som could provide improved rainfall forecast skills with up to 5 days lead time as compared to the standalone copula and eksom the standalone rmike and bcmike forecasting frameworks are useful for up to 2 days lead time whereas the bcmike wnarx and bcmike lstm error updating frameworks are useful up to 5 days lead time with the nash sutcliffe efficiency nse of 0 67 0 88 and 0 81 0 92 respectively overall the lstm proves to be a robust error forecasting model at 1 5 days lead time with reliable reproduction of peak flows and the mike lstm framework forced with the cop som based bias corrected rainfall forecasts has the lowest model prediction uncertainty with the narrowest confidence bands keywords bias correction error updating mike11 nam hd smoothing based lstm streamflow forecasting wnarx data availability all datasets used in the study appears in the manuscript 1 introduction reliable forecasting of river flows with sufficient lead time aids for developing early warning systems against flood havoc and in regulating reservoir releases for proper water resources management as heavy rainfall in the upstream catchments usually results in the reservoirs being rapidly filled up there is a need to release the excess flood water from the reservoir to prevent dam failure for which reliable inflow forecasts are important moreover judicious releases from the reservoir would prevent high floods in the downstream floodplains of the large river basins during the last two decades various river flow forecasting techniques bürger et al 2009 odiyo et al 2012 valipour et al 2013 shah and mishra 2015 mosavi et al 2018 yao et al 2019 have been developed that use the satellite based or ensemble rainfall input forcings generally the meteorological forecasts from numerical weather prediction nwp models are widely used as forcings in the rainfall runoff models for operational flood forecasting e g bartholmes et al 2009 hopson and webster 2010 voisin et al 2011 tong et al 2014a b wu et al 2014 kauffeldt et al 2016 however with the inherent discrepancies in the hydrometeorological forecasts the nwp models cannot accurately represent the physical atmospheric processes at a finer scale hamill et al 2013 su et al 2014 thus bias correction of these ensemble rainfall forecasts can help to improve the quality of hydrological model simulated streamflow forecasts by reducing the biases in the mean rainfall and its variance robertson et al 2013 tao et al 2014 khajehei and moradkhani 2017 for this a suitable bias correction technique e g wood et al 2004 lenderink et al 2007 hempel et al 2013 maity et al 2019 bisht et al 2020 could be employed reducing the systematic and random errors in the rainfall forecasts however in the hydrologic literature the adopted bias correction tools mostly either reduce the random or systematic errors and not both in the literature methods like bayesian model average ma et al 2018 neural network yuan et al 2007 logistic regression roulin and vannitsem 2012 etc have been widely used to correct the biases in ensemble rainfall forecasts zhu and luo 2015 developed a frequency mapping method for bias correcting the quantitative rainfall forecasts for the national centers for environmental prediction ncep global ensemble forecast system gefs in the continental united states while the bayesian model average and neural network methods are highly computation demanding the frequency mapping method is found to improve mainly the light and moderate rainfalls yang et al 2020 a few recent studies e g sahai et al 2017 khatun et al 2022b tested the kohonen self organizing map ksom an unsupervised neural network nn based algorithm as a bias correction and downscaling tool in its basic and enhanced form for operational extended range rainfall forecasting moreover for a geographical area characterized with tropical monsoon type of rainfall pattern having a major proportion of daily rainfall time series data of zero values the copula based bias correction technique with a special focus on zero inflated rainfall maity et al 2019 may be advantageous to date a plethora of methods dealing with the data driven conceptual and physically based approaches have been developed to model the complex nonlinear rainfall runoff process wang and ding 2003 owing to high computational cost large data requirements and multiple model runs in an ensemble framework use of a lumped conceptual hydrological model may be advantageous over the data driven and fully distributed physically based models clark et al 2017 among the conceptual models the mike11 nam nedbør afstrømnings model is found to be popular makungo et al 2010 doulgeris et al 2011 odiyo et al 2012 singh et al 2014 mockler et al 2016 kumar et al 2019 bisht et al 2020 khatun et al 2022a to simulate the runoff generation dynamics from small to large catchments with a varied climate as it could be easily integrated with the mike11 hd hydrodynamic module to simulate the channel routing process in operational streamflow forecasting limited studies e g xiong and o connor 2002 parvaze et al 2022 so far have attempted to use the mike11 nam model moreover in a large catchment as considered in this study the residence time of water in channels is much more than that on overlands therefore in streamflow forecasting an accurate estimation of translation time of flood waves by a physically based routing scheme such as mike11 hd is very important to obtain an accurate forecast lead time this mike11 hd routing model integrated with the mike11 nam rainfall runoff model is named as the mike11 nam hd model however despite using improved input forcings and advanced calibration techniques the outputs of hydrological models still suffer from poor prediction accuracy shen et al 2022 this may be due to the uncertainties associated with the model structure its inputs and the parameters liu and gupta 2007 this problem is taken care of by adopting a suitable error updating approach which involves correction of the errors in the hydrological model prediction shamseldin and o connor 2001 in the hydrologic literature although different combinations of hydrological and error updating models are evaluated xiong and o connor 2002 shamseldin et al 2007 young and liu 2015 noori and kalin 2016 wu et al 2019 wang et al 2022 very limited studies e g parvaze et al 2022 tested the potential of improving the lumped conceptual mike11 nam forecasts with an error updating model therefore this study tries to answer the research question whether the streamflow simulation capability of the lumped conceptual model like the mike11 nam could be enhanced further by coupling it with a suitable error updating model to improve the prediction accuracies in flood forecasting several studies in the recent past have employed different autoregressive ar based error updating methods with exogenous inputs as an advancement to the basic ar models such as autoregressive with exogenous input arx models shamseldin and o connor 2001 autoregressive moving average with exogenous input armax models bogner and kalas 2008 and nonlinear autoregressive with exogenous input narx models anctil et al 2003 goswami et al 2005 recently nanda et al 2019 developed a wavelet based nonlinear autoregressive with exogenous input wnarx error updating model and showed the superiority of the wnarx over the linear ar armax and wavelet neural network wnn error updating models when integrated with the physically based variable infiltration capacity vic model a detailed review of literature suggests that the machine deep learning models have been widely used for error updating the hydrological model based forecasts abrahart et al 2012 bogner et al 2016 hosseini and mahjouri 2016 humphrey et al 2016 young et al 2017 papacharalampous et al 2019 tyralis et al 2019 shen et al 2022 among the available deep learning techniques the long short term memory lstm a special type of recurrent neural network rnn is the state of the art network structure that can learn or preserve the long term dependencies among the input output variables most recently lstm in its basic and hybrid form have been widely used as a rainfall runoff model to simulate runoff responses from a catchment kratzert et al 2018 kao et al 2020 xu et al 2020 wu et al 2020 feng et al 2021 frame et al 2021 ghimire et al 2021 xu et al 2022 ding et al 2020 developed a spatio temporal attention lstm sta lstm model for flood forecasting that performed better than the basic lstm kao et al 2020 proposed an lstm based encoder decoder framework lstm ed for flood forecasting based on hourly hydrological data of typhoon events this study revealed better learning of the lstm ed model that provides reliable forecasts up to 6 h ahead as compared to a feed forward nn based ed model livieris et al 2021 developed a smoothing based framework for time series forecasting and justified the incorporation of a smoothing technique in enhancing the forecast performance of a deep learning model in a typical example yin et al 2022 proposed a novel lstm based step sequence framework lstm ss for multi step ahead runoff prediction this model follows a nested approach constituted by m specific lstm models for m step ahead runoff predictions cui et al 2022 developed an lstm based encoder decoder framework with exogenous inputs lstm ede for flood forecasting although the application of the lstms is rapidly developing in the field of hydrology being a deep learning model variant this has never been tested as an error updating model till date in light of the above discussed research gaps this study covers the following novel aspects i develops a hybrid bias correction approach cop som which integrates the copula approach and the enhanced kohonen self organized maps with spatially varying optimum map units eksom khatun et al 2022b with a view to deal with the random and systematic errors in the rainfall forecasts ii develops a simplified nested smoothing based long short term memory hereafter lstm error updating model to improve the daily discharge forecasts simulated by the integrated mike11 nam hd model and iii evaluates the performance of wnarx in error updating a conceptual hydrological model hence the specific objectives of this study are proposed as i to evaluate the efficacy of copula eksom and hybrid cop som approaches in bias correcting the imd mme rainfall forecasts at 1 5 days lead times ii to develop a nested smoothing based lstm error forecasting model framework enhancing the streamflow prediction ability of the typical mike11 nam hd conceptual hydrological model at 1 5 days lead times iii to test the performance of a recently developed wavelet based nonlinear autoregressive neural network with exogenous inputs wnarx error updating model in the mike11 nam hd conceptual model for streamflow forecasting up to 5 days lead time and iv to inter compare the streamflow forecasting efficiency of the standalone mike11 nam hd model with the formulated integrated error updating models the organization of this paper is as follows section 2 depicts the study area and data used in this study section 3 describes the methodology adopted and the results are presented in section 4 followed by the summary and conclusions in section 5 2 study area and datasets 2 1 study area the hirakud reservoir catchment of the upstream mahanadi river basin comprises of 83 400 km2 area that is located in between 19 90ʹn 23 35ʹn latitudes and 80 30ʹe 84 80ʹe longitudes in eastern india fig 1 it is characterized by flat to moderate slopes having a minimum temperature of about 4 12 c december january and a maximum temperature of about 42 45 c occurring in may central water commission cwc 2014 this tropical rainfed catchment receives an average rainfall of about 1400 mm annually 75 of which occurs during the southwest monsoon season during june to september central water commission cwc 2017 with long series of zero rainfall events during the non monsoon season the hirakud dam is one of the largest earthen dams in the world in operation since 1957 which is constructed with a live storage capacity of 5818 106 m3 the current live storage capacity of the reservoir is about 4823 106 m3 jena et al 2014 the area downstream of the hirakud dam is mostly flood prone in this typical study area rapid industrialization and adverse effects of climate change have largely affected the water availability scenario despite the presence of a large multi purpose dam namely the hirakud reservoir in the upstream reach in the odisha state this basin experiences floods and droughts in the middle and delta regions that drain into the bay of bengal the delta region of this basin has suffered from 23 floods during 1969 2011 src 2011 2012 samantaray et al 2015 since the year 2000 six major floods 2001 2003 2006 2008 2011 and 2014 have occurred in the delta region of the river basin jena et al 2014 gouda 2019 out of these the floods that occurred in the years 2011 and 2014 with peak flows of about 38 738 m3 s and 31 547 m3 s at the mouth of the delta were mainly due to subjective reservoir operation respectively gouda 2019 while very high floods 35 000 m3 s have occurred in the delta region in the years 2001 and 2011 jena et al 2014 some areas in the middle reach of the basin have also suffered from devastating droughts of an average duration of seven months in the years 2002 and 2012 samantaray et al 2019 including irrigation water stress dsouza et al 2017 as the hirakud multi purpose reservoir plays a vital role in addressing the water deficit problems in this river basin there is a need of reliable inflow forecasts into the hirakud reservoir with sufficient lead time facilitating an efficient dam operation the past studies jena et al 2014 khatun et al 2022a revealed that the time of concentration of the runoff in the hirakud reservoir catchment is about 2 3 days this justifies the consideration of a daily inflow forecasting time step in this study it may be noted that the current operational inflow forecasting system of the central water commission cwc india for the hirakud reservoir is based on the gauge to gauge correlation method with 24 h lead time which needs to use advanced techniques for enhanced forecasts 2 2 data used based on the period of data availability the short to medium range forecasts of meteorological variables such as rainfall and temperature from the imd mme forecast datasets over six years 2008 2013 is used in this study the imd mme forecast datasets are developed using five ensemble members i national centre for medium range weather forecasting ncmrwf t 254 at 0 5 0 5 ii european centre for medium range weather forecasting ecmwf t 799 at 0 25 0 25 iii japan meteorological agency jma t 959 at 0 25 0 25 iv united kingdom meteorological office ukmo at 1 1 and v national centre for environmental prediction global forecast system ncep gfs t 382 at 1 1 spatial resolution the gridded rainfall forecasts are statistically downscaled to a spatial resolution of 27 27 km and then ensembling is applied following krishnamurti et al 2000 and bhowmik and durai 2008 the model weights are finalized based on the past performance of the ensemble members these datasets are available in the public domain at a district scale and daily temporal resolution for up to 5 days lead time limited for the monsoon season only to maintain uniformity the daily meteorological forecasts from june to september are used in this study to interpolate the district scale forecasts to 0 25 0 25 grid resolution bi cubic spline interpolation for irregular data akima 1978 1996 is applied daily observed rainfall at 0 25 0 25 pai et al 2014 and minimum and maximum temperatures at 1 1 srivastava et al 2009 spatial resolution are obtained for 15 years 2000 2014 from the india meteorological department imd pune the obtained daily temperature minimum and maximum datasets are re gridded to 0 25 spatial resolution using bilinear interpolation sharma and mujumdar 2017 using the daily minimum and maximum temperature datasets potential evapotranspiration et is estimated by the hargreaves temperature method hargreaves et al 1985 for setting up the mike11 nam among the geospatial data shuttle radar topography mission srtm 30 30 m digital elevation model dem is used for catchment delineation and extraction of cross sections of the river channels and floodplains by using arcgis 10 1 software the daily observed discharges over the period 2000 2014 at 10 gauging sites fig 1 are obtained from the india water resources information system india wris the hirakud dam circle hdc burla provided the inflows to hirakud reservoir over the period 2000 2014 3 methodology the detailed methodology used in this study is illustrated in fig 2 3 1 bias correction approaches for imd mme rainfall forecasts for correcting the biases in multi daily 1 5 days ahead 0 25 0 25 gridded imd mme rainfall forecasts this study employs the recently developed gaussian and archimedean family of copulas enhanced kohonen self organizing maps eksom and the proposed hybrid cop som approaches due to limited forecast data availability a leave one out cross validation technique kim et al 2016 is adopted for correcting the rainfall biases in this approach the daily bias corrected rainfall forecasts of a given year say 2010 are derived considering the daily rainfall data of the remaining years 2008 2009 2011 2012 and 2013 as training data 3 1 1 copula based bias correction approach as the copula based technique of bias correction considers the probability mass accumulated at zero values e g maity et al 2019 this method is used to correct the biases in rainfall forecasts from 1 to 5 days lead time for the years 2008 2013 sahoo et al 2020 a detailed description of the copula based bias correction approach is presented in appendix a following maity et al 2019 the training dataset is split into three parts in the first dataset the ten univariate marginal distributions viz generalized pareto generalized extreme value generalized normal generalized logistic exponential gumbel normal pearson type iii weibull and wakeby are fitted to both the observed and forecasted rainfalls using the l moments method following khatun et al 2022a the best fit marginal distribution is selected based on the minimum root mean square error rmse and the kolmogorov smirnov test statistics ks statistics the gaussian gumbel frank and clayton e g sahoo et al 2020 copulas are fitted to the observed and forecasted rainfall data pairs the copula family with the minimum cramér von mises statistic sn minimum akaike information criteria aic value and the largest p value of the parametric bootstrap based approach genest et al 2009 is selected as the best fit copula khatun et al 2022a the p value is computed considering 10 000 random samples following genest and favre 2007 in the second dataset an exponential decay curve of the form p a e mb is fitted where b is the forecasted rainfall p is the probability of zero observed rainfall and a and m are the parameters in the third dataset pairs where forecasted rainfalls are zero valued the frequencies of zero observed rainfall are computed thereafter a suitable probability distribution viz generalized pareto generalized extreme value generalized normal generalized logistic exponential gumbel normal pearson type iii weibull and wakeby is fitted to the non zero positive observed rainfall values then the mixed conditional distribution fig 3 a of the bias corrected rainfall forecasts is obtained focusing on the zero inflated rainfall values subsequently the pseudo observations at the 50th quantile of the bias corrected rainfall are computed to obtain the bias corrected rainfall estimates 3 1 2 eksom based bias correction approach kohonen self organizing maps ksom are the unsupervised neural networks that use the clustering approach to train itself by first quantifying the training dataset into code or weight vectors and then mapping them into a two dimensional grid of nodes adeloye et al 2011 nanda et al 2017 in this method the input output dataset forms a matrix with n rows of d dimensional data vector represented by a two dimensional grid of nodes output layer the nodes or neurons are d dimensional code or weight vectors termed as map units during the training of these self organizing maps the codebook of m d weight vectors is randomly initialized where m is the number of map units the best matching unit bmu is then selected by computing the euclidean distance between the input output data vector and the code or weight vector the schematic representation of the original ksom approach is presented in fig 3b instead of using the default map units as a function of the number of data points in the original ksom e g rustum and adeloye 2007 rustum et al 2008 adeloye and rustum 2010 adeloye et al 2011 sahai et al 2017 recently khatun et al 2022b have adopted an enhanced ksom eksom approach that estimates the optimum map units at each spatial grid in the study area following khatun et al 2022b the present study tests the application of eksom as a bias correcting technique by varying the map units externally with a sequential increment of 10 units from the default value m up to a value less than the total number of data points this operation of determining the optimum map units is carried out for each spatial grid in the river basin to obtain the bias corrected rainfall values at each grid separately for brevity the details of the ksom and eksom can be found in nanda et al 2017 and khatun et al 2022b respectively the som toolbox in matlab is used to develop the self organizing maps 3 1 3 proposed hybrid cop som bias correction approach the bivariate copulas are widely accepted in the hydrologic literature to assess the dependence structure between the target variables characterized by nonlinearity and randomness sahoo et al 2020 on the other hand the ksoms are able to reduce the systematic bias component of a given model sahai et al 2017 the nwp models are characterized with high systematic biases yang et al 2020 and ideally a suitable bias correction approach is expected to reduce the systematic error component in the total associated model prediction errors aghakouchak et al 2012 thus to reduce the effects of both the random and systematic errors in the nwp model forecasts this study proposes a hybrid copula and eksom based bias correction approach the cop som in the hybrid cop som approach the pre processed outputs of the copula based bias correction method for the years 2008 2013 are forced as inputs into the eksom as described in section 3 1 2 the eksom is also applied herein using the spatially varying optimum map units at each of the grids in the study area 3 1 4 evaluation of bias corrected rainfall forecasts the accuracy of the multi step 1 5 days ahead rainfall forecasts prior to application of bias correction referred to as raw imd mme and post bias correction referred to as copula eksom and cop som are evaluated with respect to the observed daily rainfall values at each spatial grid the existing bias correction approaches are ideally expected to reduce the systematic biases in the ensemble rainfall forecasts only aghakouchak et al 2012 yang et al 2020 therefore to test the superiority of the advocated bias correction tools herein the systematic and random error components as estimated by the raw imd mme copula eksom and cop som methods are separated following willmott 1981 it may be noted that the decomposition of the error components is based on the total mean squared error mse left hand side of eq 1 as 1 y x 2 n y x 2 n y y 2 n 2 y a x b where x and y are the observed and forecasted rainfalls respectively and n is the total number of observations y is a linear function with a and b as the slope and intercept respectively the degree of association of the imd mme rainfall forecasts and its bias corrected estimates by the copula eksom and cop som based rainfall forecasts with the observed rainfall are expressed in terms of percentage bias pbias and modified kling gupta efficiency mkge while the pbias has an ideal value of zero a negative value shows underestimation and a positive value shows overestimation by the model conversely the mkge kling et al 2012 metric evaluates the deviation between the mean and variance and the correlation between the observed and simulated values it varies from a value 0 to a best value of 1 both pbias and mkge are widely used to represent the systematic error reduction capability of a bias correction model e g hosseini moghari and tang 2020 the performance indicators used in this study are given below 3 p b i a s i 1 n f i o i i 1 n o i 100 4 mkge 1 r 1 2 β 1 2 γ 1 2 where 5 β μ f μ o 6 γ cv f cv o where o i and f i are the observed and forecasted rainfalls respectively o is the mean of the observed rainfall r is the correlation coefficient between the observed and forecasted rainfalls β is the bias ratio γ is the variability ratio μ is the mean discharge and cv is the coefficient of variation and the suffixes f and o represent the forecasted and observed rainfalls respectively 3 2 mike11 nam hd standalone hydrological modelling framework in large river basins the channel flows are dominant over the overland flows therefore the mike11 nam conceptual model is used herein to simulate the pluvial surface runoff at the sub catchment scale which is then routed by using the physically based mike11 hd model with the full saint venant equations of continuity and momentum conservation this integration is termed as mike11 nam hd mike11 nam is a lumped conceptual model which simulates the rainfall runoff transformation process based on four different but inter related storages viz snow storage surface storage root zone storage and groundwater storage the nine model parameters in mike11 nam table 1 are auto calibrated using the shuffled complex evolution sce algorithm madsen 2000 since the mahanadi river basin is fully rainfed snow storage is not considered in the hydrological modelling framework following a multi objective calibration criterion e g refsgaard 1997 madsen et al 2002 and auto calibration routine three objectives are considered for calibrating mike11 nam i to minimize the overall volume error ii to minimize the overall rmse and iii to minimize the rmse of the peak flows the manning s roughness coefficient is the only calibration parameter in the mike11 hd model in the mike11 nam hd model the mike11 nam simulated sub catchment wise fig 1 surface runoff is laterally linked as the upstream boundary condition to the mike11 hd model this coupled mike11 nam hd model is finally calibrated to obtain the optimum manning s roughness coefficient n so as to best reproduce the observed streamflow hydrograph in this study mike11 nam hd is calibrated and validated using the hydrometeorological viz mean areal rainfall mean areal potential evapotranspiration and streamflow datasets of the monsoon season june september of the years 2000 2007 and 2008 2014 respectively ten sub catchments corresponding to the gauging stations except basantpur and two intermediate sub catchments ic 1 and ic 2 in the upstream and downstream of the basantpur gauging station fig 1 are considered for setting up the mike11 nam hd model in mike11 hd the manning s n is manually calibrated in the interval of 0 02 0 04 with an increment of 0 002 to best reproduce the observed discharge hydrograph at the downstream gauging station the model performances during the calibration and validation are evaluated based on the nash sutcliffe efficiency nse nash and sutcliffe 1970 asce 1993 correlation coefficient r mean absolute error mae and ratio of root mean square error rmse to standard deviation of observed data sd observed rsr a careful review of literature e g moriasi et al 2007 tiwari and chatterjee 2011 nanda et al 2016 2019 parvaze et al 2022 suggests that these model evaluation criteria have been widely used to assess the streamflow prediction ability of a hydrological model nse presents the overall agreement between the explained variances by the observed and simulated values the correlation coefficient shows the linear association between the two variables that ranges from 1 to 1 mae provides a balanced idea of the model prediction error by evaluating all deviations from the observed values irrespective of the sign tiwari and chatterjee 2011 rsr on the other hand includes the advantages of the rmse but with a normalizing factor to make it applicable for a wide range of variables akhtar et al 2009 keeping in view of the importance of the total volume of water flowing into a reservoir this study employs the e vol criterion to assess the error in the flow volume simulated by the model the goodness of fit measures used herein are expressed as 7 nse 1 i 1 n o i s i 2 i 1 n o i o 2 8 r i 1 n o i o s i s i 1 n o i o 2 i 1 n s i s 2 9 mae 1 n i 1 n o i s i 10 rsr rmse sd observed i 1 n o i s i 2 i 1 n o i o 2 11 e vol i 1 n s i i 1 n o i i 1 n o i 100 where o i and s i are the observed and simulated discharges and o and s are the means of the observed and simulated discharges respectively the calibrated and validated mike11 nam hd model is then used to simulate the inflows into the hirakud reservoir 3 3 development of nested smoothing based long short term memory lstm error updating model unlike the recently developed lstm based step sequence framework lstm ss containing m specific models for m step ahead flood forecasting yin et al 2022 which becomes highly complicated with the increase in lead times this study proposes a nested approach characterized with a cascade of six lstm models in the first phase of lstm modelling setup and one lstm model in the second phase of setup figs 4 and 5 a detailed description of the basic lstm networks is presented in appendix b as a pre processing of input datasets in the lstm network the variance in the error time series is smoothed using hanning hamming bartlett and blackman smoothing windows out of which the blackman window is found to be the best operation of these smoothing windows are shown in the scipy cookbook of python language https scipy cookbook readthedocs io items signalsmooth html the details of the smoothing windows appendix b used herein can be found in oppenheim and schafer 1999 note that the window size considered herein is a model parameter thus an optimum window size of 20 is obtained by trial and error approach to prevent the subsequent loss of data convolution fig 4 is applied after passing the error time series through the smoothing windows for efficient learning the smoothed errors are then scaled in the range of 1 1 using minmaxscaler the predicted errors generated by each of the lstm model are back transformed to the original domain using the same scaler each lstm model used herein follows a sequence to single output procedure in the form of sliding windows considering a total of past five time lagged inputs errors to forecast the single δ day ahead output gao et al 2020 this past time steps here five used for error forecasting at t δ day lead time is obtained by trial and error method the architecture of the lstm models used in this study includes three recurrent layers with 256 64 and 32 units respectively followed by a single fully connected dense layer with an activation function tanh the weights and biases of this lstm neural network model are updated using the backpropagation through time algorithm for updating the learning rates and other parameters involved in the network adaptive momentum or adam is used as an optimization function huber loss function is used as the objective criterion for loss calculation to obtain an optimized lstm model the network is trained with 350 epochs with a batch size of 32 the entire lstm modelling framework is coded using python programming language and the model parameters are calibrated using a trial and error approach e g kao et al 2020 faraji et al 2022 nourani et al 2022 since the meteorological forecasts in the study area are available from 2008 to 2013 which is relatively short both the training and validation steps are performed to ensure adequate model learning before applying it on the testing data a 60 40 ratio of data length is adopted for model training and testing to prevent overfitting 40 of the training data is used for model validation rahimzad et al 2021 a schematic representation of the nested smoothing based lstm modelling framework is shown in fig 5 the error time series e t up to the time of forecast t is computed as the difference between the observed and mike11 nam hd simulated discharges using raw imd mme and bias corrected rainfall input forcings at each lead time all the sequential errors at 1 5 day lag times eqs 12 16 and the error forecasts at the δ day lead time eq 17 as computed during the first phase of lstm modelling setup with the cascade of six lstm models are governed by 12 e t 4 f e t 8 δ e t 7 δ e t 6 δ e t 5 δ e t 4 δ 13 e t 3 f e t 7 δ e t 6 δ e t 5 δ e t 4 δ e t 3 δ 14 e t 2 f e t 6 δ e t 5 δ e t 4 δ e t 3 δ e t 2 δ 15 e t 1 f e t 5 δ e t 4 δ e t 3 δ e t 2 δ e t 1 δ 16 e t f e t 4 δ e t 3 δ e t 2 δ e t 1 δ e t δ 17 e t δ f e t 3 δ e t 2 δ e t 1 δ e t δ e t to estimate the forecasted error at δ day lead time the predicted errors up to time t by eqs 12 16 are forced as inputs to the second phase of lstm modelling setup as 18 e t δ f e t 4 e t 3 e t 2 e t 1 e t in this study first the unrefined streamflow forecasts q t δ are simulated by the rmike and bcmike variants of the mike11 nam hd model in the rmike variant mike11 nam hd is forced with the raw imd mme rainfall forecasts prefixed as r whereas in the bcmike variant mike11 nam hd is forced with the bias corrected rainfall forecasts by the best performing bias correction approach prefixed as bc fig 2 subsequently these unrefined forecasted discharges are updated using the lstm as 19 q t δ u p d a t e d q t δ e t δ e t δ where q t δ u p d a t e d is the updated discharge forecasts at δ day lead time it may be noted that the forecasted errors at δ day ahead e t δ and e t δ are obtained from the first and second phases of the lstm modelling setup respectively 3 4 wnarx error updating model for a comparative study a recently developed efficient error updating model namely the dynamic wavelet based nonlinear autoregressive with exogenous inputs wnarx model nanda et al 2016 2019 is also coupled with the mike11 nam hd model the error forecasting framework of the wnarx model is presented in fig 6 in this study the wnarx model is trained with 3 day time lagged error forecasts between the observed and mike11 nam hd simulated discharges during the calibration period 2000 2007 wherein the effective time lag is estimated based on the autocorrelation function acf 0 4 fig s1 in supplementary materials in this method the pre processed errors with discrete wavelet transform dwt are forced into the narx model a major advantage of this model is its ability to address the nonstationarity in the input dataset due to the dwt operation in the wnarx model the daubechies db2 wavelet function is chosen to maintain uniformity with nanda et al 2019 the level 5 of db2 function is selected based on the pearson s correlation coefficient r estimated between the two error time series that are obtained at a given lead time and the corresponding discrete wavelet component following nanda et al 2019 r 0 1 is considered to be satisfactory for this purpose the autoregressive nature of the wnarx model preserves the catchment memory up to a higher lead time improving the forecasting accuracy the log sigmoid function of the hidden layer in the wnarx model forecasts the δ time step ahead error e t δ with a neuron weight of w as 20 e t δ 1 1 e x p i 1 d e t 1 i w i j 1 τ e t δ j w j where d and τ are the effective time lags for the exogenous et et 1 et d and endogenous et δ 1 et δ τ inputs of error time series respectively the forecasted error at a given lead time δ is then added to the mike11 nam hd simulated unrefined discharges q t δ as 21 q t δ u p d a t e d q t δ e t δ where q t δ u p d a t e d is the updated discharge forecasts maintaining uniformity with the lstm error model setup the wnarx model is tested using the datasets of the period 2011 2013 error forecasting using wnarx is carried out in matlab similar to the lstm model the error updating models thus developed in this section are referred to as rmike wnarx and bcmike wnarx for using the raw imd mme and the bias corrected imd mme rainfall forecasts using the best performing bias correction approach respectively 3 5 model evaluation criteria the multi step ahead discharge prediction skills of the developed rmike bcmike rmike wnarx bcmike wnarx rmike lstm and bcmike lstm model variants are evaluated using nse r mae rsr and e vol as discussed in section 3 2 further the equations for the calculation of different performance evaluation measures are given in eqs 7 11 moreover the probabilistic forecast skills of the models are evaluated using the continuous ranked probability score crps the crps is mathematically expressed as gneiting and raftery 2007 22 c r p s f y f x h x y 2 d x where f x is the cumulative distribution function cdf of the probabilistic forecasts x y is the observed streamflow and h x y is the heaviside function h x y has a value of 1 for x y and 0 for x y a smaller value of the crps indicates better forecasts to capture the errors in the high peaks of the simulated discharges the peak flow error is estimated as 23 e peak q s q o 1 100 where q o and q s are the observed and model simulated peak flows respectively further the mean difference in peak flow timing defined as the average offset between the observed and model simulated peak flow timing during the testing period kratzert et al 2021 is also computed note that the annual maximum peak flow is considered herein for the computation of e peak and the mean difference in peak flow timing the predictive uncertainty associated with the forecasted discharges is estimated using the quantile regression qr technique the details of qr technique is presented in appendix c 4 results and discussion 4 1 comparative evaluation of the bias correction methods for imd mme rainfall forecasts to reduce the biases in the multi step ahead raw imd mme rainfall forecasts copula eksom and cop som hybrid bias correction approaches are employed out of the four copula families tested herein to capture the nonlinear dependency between the observed and forecasted rainfalls the frank copula is found to be the best for most of the cases the optimum map units obtained for each grid in the eksom and cop som approaches are presented in the supplementary section figs s2 s13 the accuracy of the bias corrected rainfall forecasts is compared with the raw imd mme rainfall forecasts at each spatial grid in the upper mahanadi river basin fig 7 and s14 in the supplementary materials illustrate the spatially distributed systematic errors se and random errors re in the raw and bias corrected rainfall forecasts respectively the relatively higher se median 49 5 55 6 present in the raw imd mme rainfall as shown in fig 7 justifies the use of a bias correction tool to improve the lead time rainfall forecasts the results reveal that the copula based rainfall forecasts could address the random error component at each lead time fig s14 however with a higher systematic error fig 7 as compared to the imd mme forecasts note that aghakouchak et al 2012 and hosseini moghari and tang 2020 advocated that an se 50 is acceptable for daily rainfall forecasts however in this study use of copula increased the systematic error in the raw imd mme forecasts to the median se of 89 7 94 4 which is unacceptable conversely with the use of cop som hybrid model these spatially distributed median systematic errors by the copula 89 7 94 4 and eksom 35 5 39 7 member models could be reduced to 34 3 35 9 acceptable range revealing the cop som being the best model with the least values of se at all the lead times to assess the overall agreement between the observed and forecasted pre and post bias correction rainfalls at each lead time the spatial plots of pbias are presented in fig d 1 in appendix d the pbias estimates for the raw imd mme rainfall forecasts in fig d 1 ranges from 0 9 to 79 3 across all the grids at 1 5 days lead times these results are found to be consistent with durai and bhardwaj 2014 wherein relatively higher errors in the raw imd mme rainfall forecasts are observed it is evident from fig d 1 that the p b i a s in the imd mme rainfall forecasts for the north western region of the upper mahanadi river basin are relatively high interestingly the variation in the range of p b i a s estimates for the raw imd mme rainfall are found to be higher at a smaller lead time say 1 0 70 5 at 1 day ahead as compared to the 5 day ahead rainfall 20 5 64 4 however the reason behind such variation is not known and needs further investigation in contrast the copula based approach reduces the positive biases and simultaneously increases the negative biases median 40 7 to 47 4 in the imd mme rainfall forecasts thus the overall effect of bias correction using the copula based approach deteriorated the raw imd mme forecasts the large negative biases in the copula based bias corrected rainfall forecasts makes this approach unacceptable and needs further enhancement e g hosseini moghari and tang 2020 conversely the eksom performed very well as a bias correction tool with pbias 15 across all the lead times whereas the cop som performed the best with pbias 7 mostly further both these approaches also seem to correct the existing spatial patterns of the biases in the raw imd mme rainfall forecasts fig d 1 the spatial distribution of modified kge mkge for the gridded rainfall forecasts is shown in fig d 2 in appendix d like the se and pbias estimates a similar interpretation can be made from the mkge estimate the higher mkge estimates by the eksom median 0 27 0 36 and cop som median 0 39 0 43 reveal improved forecast skills as compared to the raw imd mme median 0 04 0 20 and copula median 0 09 to 0 02 the lower mkge 0 5 estimates reveal that a daily temporal resolution of rainfall may be too high for quantitative applications balogun et al 2018 many recent studies gebremichael et al 2019 abebe et al 2020 gebremicael et al 2022 also reported relatively poor performance of satellite based rainfall products at a daily temporal scale conversely the negative or very low positive close to zero mkge estimates median 0 09 to 0 02 by the copula based bias corrected rainfall forecasts makes them unsatisfactory for using in a hydrological model for operational flood forecasting furthermore to assess the bias correction approaches in correcting the biases associated with the forecasted rainfall at a regional scale taylor diagrams taylor 2001 are prepared for each lead time fig 8 for this analysis the pre and post bias corrected imd mme rainfall forecasts are lumped by averaging them for the entire upper mahanadi river basin fig 8 reveals that the rmse estimates for the imd mme rainfall are comparatively high 10 mm at all lead times the correlation coefficient r 0 5 for the raw imd mme forecasts at 1 day lead time may be acceptable however it becomes unacceptable at higher lead times these findings are in agreement with bhowmik and durai 2012 and durai and bhardwaj 2014 wherein higher rmse and lower r values were obtained for the raw imd mme rainfall for the eastern part of india in general the eksom and cop som models are found to improve the raw imd mme rainfall forecasts across all the lead times the spatial analysis of the cop som based rainfall forecasts proves cop som to be the best at the regional scale with the least errors and highest correlation with the observed rainfall similar to the study by sahai et al 2017 showing significantly better prediction skills of traditional som self organizing maps based seasonal mme rainfall in the mahanadi river basin the enhanced ksom both in basic eksom and hybrid cop som modes in this study exhibits better prediction skills in a short to medium range forecast horizon in contrast the copula based approach which was previously tested to be effective for the correction of regional climate model derived rainfall with probability mass accumulated at zero rainfall maity et al 2019 could not perform satisfactorily in correcting the biases in the ensemble rainfall forecasts from the analysis carried out in this study it is evident that the copula based approach reduces the random error component and increases the systematic error component which could be a possible reason for its poor performance another possible reason may be attributed to the consideration of 50th quantile to solve the mixed conditional probability distribution there is always an underlying uncertainty associated with the quantile value which best represents the observed value in employing copulas for prediction of random variables an uncertainty band for the copula based estimates can be obtained mao et al 2015 to address this statistical question thus selection of an appropriate quantile to obtain the predicted value from a copula function is a research question and its investigation can be considered as a future scope of this study overall the cop som approach indicated the best prediction skills among the three different bias correction approaches tested herein and hence the cop som based rainfall forecasts are further considered as the input forcings for the mike11 nam hd hydrological model for lead time discharge predictions 4 2 performance of standalone mike11 nam hd model the mike11 nam hd model is calibrated at the inflow location of the hirakud reservoir using the observed daily streamflow records from 2000 to 2007 and validated from 2008 to 2014 for the monsoon season considering auto calibration technique and multi objective criteria the calibrated values of the nine model parameters are presented in table 2 fig 9 illustrates the capability of the selected model in reproducing the observed inflows into the hirakud reservoir during both the calibration and validation phases from fig 9 it is clear that the developed mike11 nam hd model is able to capture the seasonal variability of observed discharge pattern very well although some of the high peaks are slightly underestimated which is inevitable in the hydrological modelling framework during calibration the mike11 nam hd model showed satisfactory performance with nse 0 83 r 0 91 mae 608 65 m3 s rsr 0 42 and e vol 2 84 similarly during validation this model performed with nse 0 91 r 0 95 mae 500 66 m3 s rsr 0 30 and e vol 1 55 overall the mike11 nam hd model performed very well during both the calibration and validation phases 4 3 comparison of streamflow forecasting model variants figs 10 and 11 illustrate the reproduction of the observed streamflow hydrographs by the developed forecasting model variants during the testing period it is evident from fig 10 that the rmike is not able to capture the streamflow forecasts relatively well especially at higher lead times of 3 5 days wherein these forecasts are associated with the random fluctuations these fluctuations may be attributed to the relatively poor quality of the raw imd mme rainfall forecasts which are used as the input forcings into the hydrological model even though the resulting streamflow forecasts are error updated using the wnarx and lstm as the post processing tools this can be reconfirmed from fig 11 as these random fluctuations do not appear in the hydrological model simulated streamflow forecasts while using the bias corrected rainfall forecasts as the input forcings the estimates of the model evaluation criteria considered herein are presented in table 3 from table 3 it is evident that the standalone rmike model forced with the raw imd mme rainfall is capable of forecasting the discharges up to 2 days lead time with nse 0 68 0 81 and r 0 86 0 90 however with an increase in the forecast lead times the forecasting accuracy deteriorates drastically with nse 0 36 to 0 51 and r 0 73 to 0 47 conversely up to 3 days lead time the rmike wnarx error updating model improves the forecasted discharges with nse 0 51 0 87 and r 0 76 0 94 whereas the rmike lstm performed the best with nse 0 67 0 92 and r 0 85 0 96 at 3 5 days lead times the forecasted discharges by the standalone rmike are not acceptable nse 0 5 from fig 11 and table 3 it is evident that the standalone mike11 nam hd model forced with the cop som based bias corrected rainfall forecast products perform relatively better at all the lead times bcmike nse 0 53 0 81 r 0 74 0 91 than that with the raw imd mme rainfall it is also evident from figs 10 11 and table 3 that the bcmike model when integrated with the error updating models namely bcmike wnarx and bcmike lstm outperform the standalone rmike and bcmike models the intercomparison of all the developed models reveals that the bcmike lstm model performs remarkably well at all the lead times with nse 0 81 0 92 and r 0 90 0 96 similarly at these lead times bcmike wnarx performed satisfactorily with the nse 0 67 0 88 and r 0 89 0 94 respectively this proves that the advocated nested smoothing based lstm error forecasting model integrated with the mike11 nam hd model is able to better forecast the river flow as compared to the mike wnarx framework table 3 reveals that the mae estimates by the rmike wnarx rmike lstm bcmike wnarx and bcmike lstm frameworks are in the range of 645 97 2070 31 m3 s 580 28 2002 05 m3 s 628 36 1777 59 m3 s and 569 09 948 82 m3 s respectively while the mike11 nam hd model variants with the bias corrected rainfall forecasts viz bcmike bcmike wnarx and bcmike lstm performed satisfactorily at all the lead times with the mae estimates less than half of the standard deviation 1922 44 m3 s of the observed data moriasi et al 2007 the performance of rmike and rmike wnarx rmike lstm are unacceptable beyond 3 and 4 days lead times respectively similarly the rmike and rmike wnarx rmike lstm models with an rsr 0 70 shows poor performance at 3 5 days and 4 5 days lead times respectively table 3 although bcmike and bcmike wnarx variants perform satisfactorily with rsr 0 44 0 68 and rsr 0 35 0 57 respectively at 1 5 days lead times the bcmike lstm model shows very good rsr 0 29 0 44 streamflow forecasting skills with an rsr 0 5 e g singh et al 2004 moreover the prediction error in the total inflow volume by all the model variants may be considered as acceptable with e vol 20 except rmike e vol 29 34 47 25 at 3 5 days and bcmike wnarx e vol 36 28 at 5 days lead times in addition the crps estimates as shown in table 3 indicates that the bcmike lstm model exhibits the best probabilistic forecast skills with the least crps estimates of 52 62 65 62 m3 s 2 followed by the bcmike wnarx model crps 53 98 67 03 m3 s 2 like mo et al 2021 although the crps increases with increasing lead time indicating deterioration of the forecast accuracy of the models the numerical values of the crps are relatively less this may be due to the shorter length of the testing period considered in this study fig 12 shows the box plots of the absolute prediction error p e in m3 s of the discharge forecasts for the testing period the prediction error estimated here is the difference between the observed and simulated discharges by the model the distributions of p e fig 12 exhibit the smallest quartile for the bcmike lstm model followed by the bcmike wnarx model further the spread in the model prediction error by the rmike lstm at 1 2 days lead times are found to be comparable with that of the bcmike lstm model however with the increase in lead time the variation in the prediction error increases in general the effect of bias correction of rainfall forecasts is found to improve the discharge prediction skills of the mike11 nam hd model among the various model variants tested herein the overall performance decreased in the order bcmike lstm bcmike wnarx bcmike rmike lstm rmike wnarx rmike the downstream reaches of the mahanadi river basin has witnessed severe flooding during the years 2011 2012 and 2013 due to high peak inflows into the hirakud reservoir nanda et al 2019 therefore the capability of the developed streamflow forecasting models is assessed for reproducing these typical observed high peaks table 4 presenting the errors in peak flows by these models reveals that the bcmike lstm simulated peak flows are mostly within the acceptable limit e peak 20 for up to 5 days lead time the peak flood in the year 2011 which is one of the most devastating floods experienced in the mahanadi river basin with 35 000 m3 s of flow at the head of the mahanadi delta is attributed to improper dam operation in the absence of reliable inflow forecasts into the hirakud reservoir jena et al 2014 gouda 2019 it is evident from table 4 that the rmike lstm e peak 10 11 12 37 and bcmike lstm e peak 12 94 15 55 error updating frameworks are able to reproduce the 2011 peak flood with reasonable accuracy up to 3 and 4 days lead times respectively further the mean difference in peak flow timing during the testing period is presented in table 5 in general this assessment reveals that the average time difference in the occurrence of peak flows increases with the increase in lead time the bcmike lstm depicts the least average offset in peak flow timing among the tested models table 5 it is evident from table 5 that the bcmike lstm model is able to predict the peak flows quite accurately up to 2 days lead time with an average offset of about 0 33 days i e 8 h as the lead time increases from 3 to 5 days the mean difference in peak flow timing as predicted by the bcmike lstm is found to be 1 day in the past studies e g parvaze et al 2022 kratzert et al 2021 the considered basin area is relatively small as compared to the large basin area of 83 400 km2 considered herein in the present study area the time of concentration is about 2 3 days jena et al 2014 khatun et al 2022a therefore an offset of 8 h in the case of the streamflow forecasts with 2 days lead time and an offset of 1 day in the case of the streamflow forecasts in fig 10 with 3 5 days lead times can still help in flood preparedness for the downstream reaches overall the performance of the bcmike lstm model is considered satisfactory in capturing the timing of occurrence of the peak flows the superior performance of these mike lstm frameworks may be attributed to the inherent memory of the nested smoothing based lstm modelling architecture integrated with the feedback structure sufi karimi et al 2019 the overall assessment reveals that the mike11 nam hd modelling frameworks forced with the cop som based rainfall forecasts integrated with the wnarx and lstm error updating models are able to simulate the discharges satisfactorily at the inflow location of the hirakud reservoir up to a lead time of 5 days in general it may be inferred that the wnarx error updating model can store the catchment memory with higher lead times through the feedback loop which can aid to capture the flow variations relatively well conversely lstms consist of cells that help in storing information at a current time step to retain the long term dependencies in which smoothing by convolution addresses the nonstationarity reducing the forecasting error variance significantly therefore the lstm error updating model could also capture the observed high peak flows with reasonable accuracy this makes the nested smoothing based lstm model lstm integrated with mike11 nam hd superior in operational river flow forecasting with ensemble meteorological forecasts up to 5 days lead time 4 4 assessment of predictive uncertainty pu in streamflow forecasting the predictive uncertainty analyses in river flow forecasting at each lead time are estimated using the quantile regression qr technique as shown in figs 13 and 14 and fig s15 in supplementary materials the 50 and 90 uncertainty bands for all the model variants are found to be inter comparable up to 2 days lead time figs 13 14 and fig s15 while the rmike model fails to capture the discharges within the 50 and 90 confidence interval ci bands at 3 5 days lead times fig s15 the rmike wnarx and rmike lstm exhibit relatively wider ci bands up to 5 days lead time fig 13 as envisaged from fig s15 the standalone rmike and bcmike variants overestimate the streamflows at almost all the lead times indicating poor credibility of the models in operational river flow forecasting similarly the bcmike wnarx is found to overestimate the discharges at 5 days lead time in terms of uncertainty associated with the river flow forecasts the bcmike lstm model is found to outperform all the other model variants with the narrowest uncertainty bands at all the lead times fig 14 as the smoothing filters could reduce the noise in time series data livieris et al 2021 the lstm error updated model variants have relatively better performance in predictive uncertainty estimation since the uncertainty fluctuates based on the forecasted values and lead time weerts et al 2011 the river flow prediction uncertainty depicted by the wnarx error updated model bcmike wnarx can also be considered satisfactory up to 3 days lead time 5 conclusions this study reveals the robustness of the coupled lstm and mike11 nam hd hydrological model in improving the streamflow prediction accuracy and predictive uncertainty at daily scale this framework can be applied in river basins in india and other places world wide unlike the complex nested lstm approach e g yin et al 2022 this study proposes a relatively simple smoothing technique since the rainfall forecasts world wide are having low accuracy levels the copula eksom based bias correction technique developed herein could reduce both the systematic and random errors note that the existing standalone bias correction methods either address the random error or systematic error only therefore the proposed framework has wide scale applicability in improving the streamflow forecasts in world river basins both at smaller and larger lead times based on the results the major conclusions from this study are summarized as below i the raw imd mme rainfall forecasts with relatively high biases make them inappropriate for river flow forecasting while the copula based bias correction approach focuses on reducing the random error component of the total rainfall forecast errors the enhanced ksom based methods eksom and cop som show improvement in forecast skills of the raw imd mme rainfall out of the eksom and cop som approaches the cop som performs the best with relatively lower p b i a s and higher modified kge values ii the standalone mike11 nam hd conceptual hydrological model forced with the raw imd mme rainfall forecasts can predict the river flow reasonably well up to 2 days lead time the bcmike model on the other hand could simulate acceptable discharge forecasts up to 5 days ahead however with lower nse estimates nse 0 53 0 81 iii the bcmike wnarx error updating model proves to be skilful in producing the discharge forecasts up to 5 days lead time nse 0 67 0 88 iv the bcmike lstm framework outperforms all other model variants in forecasting the overall discharge time series at 1 5 days lead times nse 0 81 0 92 as well as the high flood peaks however the rmike lstm model is useful for the discharge forecasts with the lower prediction errors up to 2 days lead time only v as far as the forecasting uncertainty is concerned the bcmike lstm model performs the best in terms of daily river flow with the narrowest confidence interval bands at all the lead times however the rmike and bcmike variants at 1 5 days lead times and the bcmike wnarx variant at 4 5 days lead time are not acceptable due to significant overestimation of the predictive uncertainty overall the present study suggests that the bias correction of imd mme rainfall forecasts using the hybrid copula enhanced kohonen self organizing maps cop som can aid in improving the streamflow forecasts by a hydrological model after its integration with the wnarx or nested smoothing based lstm lstm error updating model unlike the previous studies e g chen et al 2020 livieris et al 2021 xie et al 2021 this study establishes that the implementation of a smoothing based feature enhancement technique which increases the simplicity and robustness of the basic lstm network both in terms of the prediction accuracy and predictive uncertainty in operational streamflow forecasting while the recently developed lstm based step sequence framework lstm ss containing m specific models for m step ahead flood forecasting e g yin et al 2022 may become highly complicated as the lead time increases the simple nested smoothing based lstm model developed herein is characterized by a two step cascade of six smoothing based lstm models in the first phase of modelling setup and one smoothing based lstm model in the second phase although the wnarx integrated hydrological model mike11 nam hd herein provides reasonably accurate streamflow forecasts the mike11 nam hd lstm model framework performed the best thus the lstm integrated error updating framework is one of its kind and a similar methodology can be implemented in any world river basin including the tropical river basins however exploring the effect of different types of hydrometeorological datasets and their sizes on the developed lstm error model can be considered as the future scope of this study credit authorship contribution statement amina khatun conceptualization methodology data curation formal analysis investigation software writing original draft visualization writing review editing bhabagrahi sahoo conceptualization methodology writing review editing supervision resources chandranath chatterjee conceptualization methodology writing review editing supervision resources declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgements this study was carried out as a part of the sub project impact of climate change on flood risk of the center of excellence coe in climate change studies activity established at the indian institute of technology iit kharagpur the authors thank the department of science and technology dst government of india for the financial support the authors acknowledge the india meteorological department imd hirakud dam circle hdc burla and central water commission cwc for providing the datasets used in this study appendix a copula based bias correction approach to deal with the tropical rainfall pattern the copula based bias correction approach revised by maity et al 2019 uses a conditional probability distribution with special focus on the zero inflated rainfall values for this the training dataset for each spatial grid is formulated considering the pairs of a the non zero positive values of both the observed and forecasted rainfalls b zero values of the observed and non zero values of the forecasted rainfalls and c non zero values of the observed and zero values of the forecasted rainfalls in the first data pair a a suitable marginal distribution is fitted to the observed and forecasted rainfalls subsequently the dependence between the non zero pairs of observed and forecasted rainfalls is modelled by a suitable copula function c of the form f x y x y c f x x f y y where x and y represent the observed and forecasted rainfalls and f x x and f y y represent the marginal distributions of x and y respectively considering the best fit copula family the conditional probability distribution of the observed x rainfall for a given forecasted y rainfall is obtained as a 1 f x y x y c f x x f y y f y y in the second data pair b an exponential decay curve of the form p a e mb is fitted where b is the forecasted rainfall p is the probability of zero observed rainfall and a and m are the parameters the probability mass for zero observed rainfall for a given value of the forecasted rainfall is then used to update the conditional probability distribution in eq a 1 as a 2 f x y x y p f o r x 0 y 0 p 1 p f x y x y f o r x 0 y 0 where f x y x y is the updated or mixed conditional probability distribution in the third data pair c the zero observed rainfall frequencies are computed and a suitable probability distribution is fitted to the non zero positive observed rainfall values then the mixed conditional distribution of the bias corrected rainfall forecasts is obtained focusing on the zero inflated rainfall values as maity et al 2019 a 3 f x y 0 x n f o r x 0 y 0 n 1 n h x x f o r x 0 y 0 where n is the frequency of zero observed rainfall values determined from the y intercept of the equation of the form p a e mb and h x x is the marginal distribution of the non zero observed values for the third pair of dataset the graphical depiction of the mixed distribution thus obtained is shown in fig 3a subsequently the pseudo observations of the bias corrected rainfalls are derived and transformed to obtain the bias corrected values in the original data space using the integral probability transformation a detailed description of the copula based bias correction approach can be found in maity et al 2019 appendix b long short term memory lstm networks and smoothing windows lstm hochreiter and schmidhuber 1997 is a specially designed rnn framework with the ability to capture the sequential order of inputs preserving the long term dependencies between the input and output variables an lstm cell comprises of two basic elements i cell memory s t and ii three gates f i and o as encircled in fig b 1 the cell memory stores information whereas the gates control the flow of information among the gates the forget gate f gers felix et al 2000 decides the component and the degree up to which a component in the previous t 1 cell state vector is to be stored at time t resulting in the vector f t with the values ranging from 0 to 1 expressed as b 1 f t σ w f e t u f h t 1 b f where σ is the logistic sigmoid function e t is the input forecasting error vector h t 1 is the previous hidden state w f and u f are the weight matrices and b f is the bias vector in the first time step the hidden state h is initialized with zero vector of user defined length using the present input e t and the previous hidden state h t 1 a potential updated cell state vector s t with values ranging from 1 to 1 is defined as b 2 s t t a n h w s e t u s h t 1 b s where t a n h is the hyperbolic tangent w s and u s and b s are the weight matrices and bias vector for the updated cell state respectively i the input gate fig b 1 controls which and what degree of information in the potential cell state s t are to be used for updating the current cell state resulting in vector i t with the values ranging from 0 to 1 as b 3 i t σ w i e t u i h t 1 b i where w i and u i are the weight matrices and b i is the bias vector finally the current cell state s t is updated using eqs b 1 b 3 as b 4 s t f t s t 1 i t s t where represents the multiplication of each element in the first time step the cell state is initialized with the zero vector with the length equal to that of the hidden state vector then the output gate o controls which and what degree of information from s t will flow to the next hidden state h t as b 5 o t σ w o e t u o h t 1 b o where w o and u o are weight matrices and b o is the bias vector note that w u and b are the learnable parameters here finally using eqs b 4 b 5 the new hidden state is computed as b 6 h t t a n h s t o t the input at any time t is processed sequentially in the cells of each layer of the lstm network and the last hidden state output h z is connected to a single output neuron using a dense layer subsequently the final output forecasting error at time t δ with the lead time δ is computed as b 7 e t δ w d h z b d where w d and b d are the weight matrix and bias term of the dense layer respectively during the training of the lstm network the learnable parameters are updated in each iteration called epoch based on a loss function each iteration starts with generating batches of a user defined number of random samples from the training data as shown in fig 4 in this study a nested smoothing based lstm lstm model is developed to forecast the multi step up to 5 days ahead errors given the known historical forecast error data during the previous 5 days the application of smoothing operation in a particular epoch of the lstm model run is presented in fig 4 the smoothing window functions are commonly referred to as apodization or tapering functions nuttall 1981 and are usually symmetric around the centre of a specific interval they taper away to become zero valued outside the interval these smoothing windows are capable of capturing the underlying pattern in the error time series while leaving out the noise present in it in this study the bartlett eq b 8 blackman eq b 9 hamming eq b 10 and hanning eq b 11 smoothing window functions are used b 8 w n 2 m 1 m 1 2 n m 1 2 b 9 w n 0 42 0 5 cos 2 π n m 0 08 cos 4 π n m b 10 w n 0 54 0 46 cos 2 π n m 1 0 n m 1 b 11 w n 0 5 0 5 cos 2 π n m 1 0 n m 1 where w n is the window function and m is the order of the window function appendix c quantile regression based predictive uncertainty estimation the predictive uncertainties pu of all the model variants developed herein are computed using the quantile regression qr technique e g koenker 2005 weerts et al 2011 kumar et al 2015 barbetta et al 2017 in this technique linear qr relationships between the probability distribution of discharge forecasts and the errors at each lead time are established for a given quantile assuming a linear relationship the forecasted discharges q and the errors e are first transformed to a gaussian domain at any lead time of interest as c 1 ne i mnq i c where nq i and ne i are the discharges and associated errors in gaussian form and m and c are the slope and intercept at a given data level i a detailed description of qr technique can be found in weerts et al 2011 in this study the regression coefficients between nq i and ne i at 5 25 50 75 and 95 are derived using the calibration datasets the quantreg package in r s cran repository is used for applying the qr technique the derived errors at different quantiles are then de normalized e x and added to the forecasted discharges q t δ to obtain the updated forecasts q x t δ as c 2 q x t δ q t δ e x appendix d miscellaneous figures appendix e supplementary data supplementary data to this article can be found online at https doi org 10 1016 j jhydrol 2023 129199 appendix e supplementary data the following are the supplementary data to this article supplementary data 1 
2214,accurate inflow forecasts with sufficient lead time are highly crucial for efficient reservoir operation for which this study advocates the popular mike11 nam hd mike standalone conceptual hydrological model and its two error updating frameworks for 1 5 days ahead inflow forecasting these two modelling frameworks integrate the recently developed wavelet based nonlinear autoregressive neural network with exogenous inputs wnarx and a novel nested smoothing based long short term memory lstm network as the error updating models with the standalone mike11 nam hd model respectively the available rainfall forecasts are bias corrected using the gaussian and archimedean copulas enhanced kohonen self organizing maps eksom and hybrid copula eksom cop som approaches the mike11 nam hd forced with the raw india meteorological department multi model ensemble imd mme and the selected bias corrected rainfall forecasts are hereafter named as rmike and bcmike respectively these proposed frameworks are tested for daily streamflow forecasting into the hirakud multi purpose reservoir in eastern india the results reveal that the hybrid cop som could provide improved rainfall forecast skills with up to 5 days lead time as compared to the standalone copula and eksom the standalone rmike and bcmike forecasting frameworks are useful for up to 2 days lead time whereas the bcmike wnarx and bcmike lstm error updating frameworks are useful up to 5 days lead time with the nash sutcliffe efficiency nse of 0 67 0 88 and 0 81 0 92 respectively overall the lstm proves to be a robust error forecasting model at 1 5 days lead time with reliable reproduction of peak flows and the mike lstm framework forced with the cop som based bias corrected rainfall forecasts has the lowest model prediction uncertainty with the narrowest confidence bands keywords bias correction error updating mike11 nam hd smoothing based lstm streamflow forecasting wnarx data availability all datasets used in the study appears in the manuscript 1 introduction reliable forecasting of river flows with sufficient lead time aids for developing early warning systems against flood havoc and in regulating reservoir releases for proper water resources management as heavy rainfall in the upstream catchments usually results in the reservoirs being rapidly filled up there is a need to release the excess flood water from the reservoir to prevent dam failure for which reliable inflow forecasts are important moreover judicious releases from the reservoir would prevent high floods in the downstream floodplains of the large river basins during the last two decades various river flow forecasting techniques bürger et al 2009 odiyo et al 2012 valipour et al 2013 shah and mishra 2015 mosavi et al 2018 yao et al 2019 have been developed that use the satellite based or ensemble rainfall input forcings generally the meteorological forecasts from numerical weather prediction nwp models are widely used as forcings in the rainfall runoff models for operational flood forecasting e g bartholmes et al 2009 hopson and webster 2010 voisin et al 2011 tong et al 2014a b wu et al 2014 kauffeldt et al 2016 however with the inherent discrepancies in the hydrometeorological forecasts the nwp models cannot accurately represent the physical atmospheric processes at a finer scale hamill et al 2013 su et al 2014 thus bias correction of these ensemble rainfall forecasts can help to improve the quality of hydrological model simulated streamflow forecasts by reducing the biases in the mean rainfall and its variance robertson et al 2013 tao et al 2014 khajehei and moradkhani 2017 for this a suitable bias correction technique e g wood et al 2004 lenderink et al 2007 hempel et al 2013 maity et al 2019 bisht et al 2020 could be employed reducing the systematic and random errors in the rainfall forecasts however in the hydrologic literature the adopted bias correction tools mostly either reduce the random or systematic errors and not both in the literature methods like bayesian model average ma et al 2018 neural network yuan et al 2007 logistic regression roulin and vannitsem 2012 etc have been widely used to correct the biases in ensemble rainfall forecasts zhu and luo 2015 developed a frequency mapping method for bias correcting the quantitative rainfall forecasts for the national centers for environmental prediction ncep global ensemble forecast system gefs in the continental united states while the bayesian model average and neural network methods are highly computation demanding the frequency mapping method is found to improve mainly the light and moderate rainfalls yang et al 2020 a few recent studies e g sahai et al 2017 khatun et al 2022b tested the kohonen self organizing map ksom an unsupervised neural network nn based algorithm as a bias correction and downscaling tool in its basic and enhanced form for operational extended range rainfall forecasting moreover for a geographical area characterized with tropical monsoon type of rainfall pattern having a major proportion of daily rainfall time series data of zero values the copula based bias correction technique with a special focus on zero inflated rainfall maity et al 2019 may be advantageous to date a plethora of methods dealing with the data driven conceptual and physically based approaches have been developed to model the complex nonlinear rainfall runoff process wang and ding 2003 owing to high computational cost large data requirements and multiple model runs in an ensemble framework use of a lumped conceptual hydrological model may be advantageous over the data driven and fully distributed physically based models clark et al 2017 among the conceptual models the mike11 nam nedbør afstrømnings model is found to be popular makungo et al 2010 doulgeris et al 2011 odiyo et al 2012 singh et al 2014 mockler et al 2016 kumar et al 2019 bisht et al 2020 khatun et al 2022a to simulate the runoff generation dynamics from small to large catchments with a varied climate as it could be easily integrated with the mike11 hd hydrodynamic module to simulate the channel routing process in operational streamflow forecasting limited studies e g xiong and o connor 2002 parvaze et al 2022 so far have attempted to use the mike11 nam model moreover in a large catchment as considered in this study the residence time of water in channels is much more than that on overlands therefore in streamflow forecasting an accurate estimation of translation time of flood waves by a physically based routing scheme such as mike11 hd is very important to obtain an accurate forecast lead time this mike11 hd routing model integrated with the mike11 nam rainfall runoff model is named as the mike11 nam hd model however despite using improved input forcings and advanced calibration techniques the outputs of hydrological models still suffer from poor prediction accuracy shen et al 2022 this may be due to the uncertainties associated with the model structure its inputs and the parameters liu and gupta 2007 this problem is taken care of by adopting a suitable error updating approach which involves correction of the errors in the hydrological model prediction shamseldin and o connor 2001 in the hydrologic literature although different combinations of hydrological and error updating models are evaluated xiong and o connor 2002 shamseldin et al 2007 young and liu 2015 noori and kalin 2016 wu et al 2019 wang et al 2022 very limited studies e g parvaze et al 2022 tested the potential of improving the lumped conceptual mike11 nam forecasts with an error updating model therefore this study tries to answer the research question whether the streamflow simulation capability of the lumped conceptual model like the mike11 nam could be enhanced further by coupling it with a suitable error updating model to improve the prediction accuracies in flood forecasting several studies in the recent past have employed different autoregressive ar based error updating methods with exogenous inputs as an advancement to the basic ar models such as autoregressive with exogenous input arx models shamseldin and o connor 2001 autoregressive moving average with exogenous input armax models bogner and kalas 2008 and nonlinear autoregressive with exogenous input narx models anctil et al 2003 goswami et al 2005 recently nanda et al 2019 developed a wavelet based nonlinear autoregressive with exogenous input wnarx error updating model and showed the superiority of the wnarx over the linear ar armax and wavelet neural network wnn error updating models when integrated with the physically based variable infiltration capacity vic model a detailed review of literature suggests that the machine deep learning models have been widely used for error updating the hydrological model based forecasts abrahart et al 2012 bogner et al 2016 hosseini and mahjouri 2016 humphrey et al 2016 young et al 2017 papacharalampous et al 2019 tyralis et al 2019 shen et al 2022 among the available deep learning techniques the long short term memory lstm a special type of recurrent neural network rnn is the state of the art network structure that can learn or preserve the long term dependencies among the input output variables most recently lstm in its basic and hybrid form have been widely used as a rainfall runoff model to simulate runoff responses from a catchment kratzert et al 2018 kao et al 2020 xu et al 2020 wu et al 2020 feng et al 2021 frame et al 2021 ghimire et al 2021 xu et al 2022 ding et al 2020 developed a spatio temporal attention lstm sta lstm model for flood forecasting that performed better than the basic lstm kao et al 2020 proposed an lstm based encoder decoder framework lstm ed for flood forecasting based on hourly hydrological data of typhoon events this study revealed better learning of the lstm ed model that provides reliable forecasts up to 6 h ahead as compared to a feed forward nn based ed model livieris et al 2021 developed a smoothing based framework for time series forecasting and justified the incorporation of a smoothing technique in enhancing the forecast performance of a deep learning model in a typical example yin et al 2022 proposed a novel lstm based step sequence framework lstm ss for multi step ahead runoff prediction this model follows a nested approach constituted by m specific lstm models for m step ahead runoff predictions cui et al 2022 developed an lstm based encoder decoder framework with exogenous inputs lstm ede for flood forecasting although the application of the lstms is rapidly developing in the field of hydrology being a deep learning model variant this has never been tested as an error updating model till date in light of the above discussed research gaps this study covers the following novel aspects i develops a hybrid bias correction approach cop som which integrates the copula approach and the enhanced kohonen self organized maps with spatially varying optimum map units eksom khatun et al 2022b with a view to deal with the random and systematic errors in the rainfall forecasts ii develops a simplified nested smoothing based long short term memory hereafter lstm error updating model to improve the daily discharge forecasts simulated by the integrated mike11 nam hd model and iii evaluates the performance of wnarx in error updating a conceptual hydrological model hence the specific objectives of this study are proposed as i to evaluate the efficacy of copula eksom and hybrid cop som approaches in bias correcting the imd mme rainfall forecasts at 1 5 days lead times ii to develop a nested smoothing based lstm error forecasting model framework enhancing the streamflow prediction ability of the typical mike11 nam hd conceptual hydrological model at 1 5 days lead times iii to test the performance of a recently developed wavelet based nonlinear autoregressive neural network with exogenous inputs wnarx error updating model in the mike11 nam hd conceptual model for streamflow forecasting up to 5 days lead time and iv to inter compare the streamflow forecasting efficiency of the standalone mike11 nam hd model with the formulated integrated error updating models the organization of this paper is as follows section 2 depicts the study area and data used in this study section 3 describes the methodology adopted and the results are presented in section 4 followed by the summary and conclusions in section 5 2 study area and datasets 2 1 study area the hirakud reservoir catchment of the upstream mahanadi river basin comprises of 83 400 km2 area that is located in between 19 90ʹn 23 35ʹn latitudes and 80 30ʹe 84 80ʹe longitudes in eastern india fig 1 it is characterized by flat to moderate slopes having a minimum temperature of about 4 12 c december january and a maximum temperature of about 42 45 c occurring in may central water commission cwc 2014 this tropical rainfed catchment receives an average rainfall of about 1400 mm annually 75 of which occurs during the southwest monsoon season during june to september central water commission cwc 2017 with long series of zero rainfall events during the non monsoon season the hirakud dam is one of the largest earthen dams in the world in operation since 1957 which is constructed with a live storage capacity of 5818 106 m3 the current live storage capacity of the reservoir is about 4823 106 m3 jena et al 2014 the area downstream of the hirakud dam is mostly flood prone in this typical study area rapid industrialization and adverse effects of climate change have largely affected the water availability scenario despite the presence of a large multi purpose dam namely the hirakud reservoir in the upstream reach in the odisha state this basin experiences floods and droughts in the middle and delta regions that drain into the bay of bengal the delta region of this basin has suffered from 23 floods during 1969 2011 src 2011 2012 samantaray et al 2015 since the year 2000 six major floods 2001 2003 2006 2008 2011 and 2014 have occurred in the delta region of the river basin jena et al 2014 gouda 2019 out of these the floods that occurred in the years 2011 and 2014 with peak flows of about 38 738 m3 s and 31 547 m3 s at the mouth of the delta were mainly due to subjective reservoir operation respectively gouda 2019 while very high floods 35 000 m3 s have occurred in the delta region in the years 2001 and 2011 jena et al 2014 some areas in the middle reach of the basin have also suffered from devastating droughts of an average duration of seven months in the years 2002 and 2012 samantaray et al 2019 including irrigation water stress dsouza et al 2017 as the hirakud multi purpose reservoir plays a vital role in addressing the water deficit problems in this river basin there is a need of reliable inflow forecasts into the hirakud reservoir with sufficient lead time facilitating an efficient dam operation the past studies jena et al 2014 khatun et al 2022a revealed that the time of concentration of the runoff in the hirakud reservoir catchment is about 2 3 days this justifies the consideration of a daily inflow forecasting time step in this study it may be noted that the current operational inflow forecasting system of the central water commission cwc india for the hirakud reservoir is based on the gauge to gauge correlation method with 24 h lead time which needs to use advanced techniques for enhanced forecasts 2 2 data used based on the period of data availability the short to medium range forecasts of meteorological variables such as rainfall and temperature from the imd mme forecast datasets over six years 2008 2013 is used in this study the imd mme forecast datasets are developed using five ensemble members i national centre for medium range weather forecasting ncmrwf t 254 at 0 5 0 5 ii european centre for medium range weather forecasting ecmwf t 799 at 0 25 0 25 iii japan meteorological agency jma t 959 at 0 25 0 25 iv united kingdom meteorological office ukmo at 1 1 and v national centre for environmental prediction global forecast system ncep gfs t 382 at 1 1 spatial resolution the gridded rainfall forecasts are statistically downscaled to a spatial resolution of 27 27 km and then ensembling is applied following krishnamurti et al 2000 and bhowmik and durai 2008 the model weights are finalized based on the past performance of the ensemble members these datasets are available in the public domain at a district scale and daily temporal resolution for up to 5 days lead time limited for the monsoon season only to maintain uniformity the daily meteorological forecasts from june to september are used in this study to interpolate the district scale forecasts to 0 25 0 25 grid resolution bi cubic spline interpolation for irregular data akima 1978 1996 is applied daily observed rainfall at 0 25 0 25 pai et al 2014 and minimum and maximum temperatures at 1 1 srivastava et al 2009 spatial resolution are obtained for 15 years 2000 2014 from the india meteorological department imd pune the obtained daily temperature minimum and maximum datasets are re gridded to 0 25 spatial resolution using bilinear interpolation sharma and mujumdar 2017 using the daily minimum and maximum temperature datasets potential evapotranspiration et is estimated by the hargreaves temperature method hargreaves et al 1985 for setting up the mike11 nam among the geospatial data shuttle radar topography mission srtm 30 30 m digital elevation model dem is used for catchment delineation and extraction of cross sections of the river channels and floodplains by using arcgis 10 1 software the daily observed discharges over the period 2000 2014 at 10 gauging sites fig 1 are obtained from the india water resources information system india wris the hirakud dam circle hdc burla provided the inflows to hirakud reservoir over the period 2000 2014 3 methodology the detailed methodology used in this study is illustrated in fig 2 3 1 bias correction approaches for imd mme rainfall forecasts for correcting the biases in multi daily 1 5 days ahead 0 25 0 25 gridded imd mme rainfall forecasts this study employs the recently developed gaussian and archimedean family of copulas enhanced kohonen self organizing maps eksom and the proposed hybrid cop som approaches due to limited forecast data availability a leave one out cross validation technique kim et al 2016 is adopted for correcting the rainfall biases in this approach the daily bias corrected rainfall forecasts of a given year say 2010 are derived considering the daily rainfall data of the remaining years 2008 2009 2011 2012 and 2013 as training data 3 1 1 copula based bias correction approach as the copula based technique of bias correction considers the probability mass accumulated at zero values e g maity et al 2019 this method is used to correct the biases in rainfall forecasts from 1 to 5 days lead time for the years 2008 2013 sahoo et al 2020 a detailed description of the copula based bias correction approach is presented in appendix a following maity et al 2019 the training dataset is split into three parts in the first dataset the ten univariate marginal distributions viz generalized pareto generalized extreme value generalized normal generalized logistic exponential gumbel normal pearson type iii weibull and wakeby are fitted to both the observed and forecasted rainfalls using the l moments method following khatun et al 2022a the best fit marginal distribution is selected based on the minimum root mean square error rmse and the kolmogorov smirnov test statistics ks statistics the gaussian gumbel frank and clayton e g sahoo et al 2020 copulas are fitted to the observed and forecasted rainfall data pairs the copula family with the minimum cramér von mises statistic sn minimum akaike information criteria aic value and the largest p value of the parametric bootstrap based approach genest et al 2009 is selected as the best fit copula khatun et al 2022a the p value is computed considering 10 000 random samples following genest and favre 2007 in the second dataset an exponential decay curve of the form p a e mb is fitted where b is the forecasted rainfall p is the probability of zero observed rainfall and a and m are the parameters in the third dataset pairs where forecasted rainfalls are zero valued the frequencies of zero observed rainfall are computed thereafter a suitable probability distribution viz generalized pareto generalized extreme value generalized normal generalized logistic exponential gumbel normal pearson type iii weibull and wakeby is fitted to the non zero positive observed rainfall values then the mixed conditional distribution fig 3 a of the bias corrected rainfall forecasts is obtained focusing on the zero inflated rainfall values subsequently the pseudo observations at the 50th quantile of the bias corrected rainfall are computed to obtain the bias corrected rainfall estimates 3 1 2 eksom based bias correction approach kohonen self organizing maps ksom are the unsupervised neural networks that use the clustering approach to train itself by first quantifying the training dataset into code or weight vectors and then mapping them into a two dimensional grid of nodes adeloye et al 2011 nanda et al 2017 in this method the input output dataset forms a matrix with n rows of d dimensional data vector represented by a two dimensional grid of nodes output layer the nodes or neurons are d dimensional code or weight vectors termed as map units during the training of these self organizing maps the codebook of m d weight vectors is randomly initialized where m is the number of map units the best matching unit bmu is then selected by computing the euclidean distance between the input output data vector and the code or weight vector the schematic representation of the original ksom approach is presented in fig 3b instead of using the default map units as a function of the number of data points in the original ksom e g rustum and adeloye 2007 rustum et al 2008 adeloye and rustum 2010 adeloye et al 2011 sahai et al 2017 recently khatun et al 2022b have adopted an enhanced ksom eksom approach that estimates the optimum map units at each spatial grid in the study area following khatun et al 2022b the present study tests the application of eksom as a bias correcting technique by varying the map units externally with a sequential increment of 10 units from the default value m up to a value less than the total number of data points this operation of determining the optimum map units is carried out for each spatial grid in the river basin to obtain the bias corrected rainfall values at each grid separately for brevity the details of the ksom and eksom can be found in nanda et al 2017 and khatun et al 2022b respectively the som toolbox in matlab is used to develop the self organizing maps 3 1 3 proposed hybrid cop som bias correction approach the bivariate copulas are widely accepted in the hydrologic literature to assess the dependence structure between the target variables characterized by nonlinearity and randomness sahoo et al 2020 on the other hand the ksoms are able to reduce the systematic bias component of a given model sahai et al 2017 the nwp models are characterized with high systematic biases yang et al 2020 and ideally a suitable bias correction approach is expected to reduce the systematic error component in the total associated model prediction errors aghakouchak et al 2012 thus to reduce the effects of both the random and systematic errors in the nwp model forecasts this study proposes a hybrid copula and eksom based bias correction approach the cop som in the hybrid cop som approach the pre processed outputs of the copula based bias correction method for the years 2008 2013 are forced as inputs into the eksom as described in section 3 1 2 the eksom is also applied herein using the spatially varying optimum map units at each of the grids in the study area 3 1 4 evaluation of bias corrected rainfall forecasts the accuracy of the multi step 1 5 days ahead rainfall forecasts prior to application of bias correction referred to as raw imd mme and post bias correction referred to as copula eksom and cop som are evaluated with respect to the observed daily rainfall values at each spatial grid the existing bias correction approaches are ideally expected to reduce the systematic biases in the ensemble rainfall forecasts only aghakouchak et al 2012 yang et al 2020 therefore to test the superiority of the advocated bias correction tools herein the systematic and random error components as estimated by the raw imd mme copula eksom and cop som methods are separated following willmott 1981 it may be noted that the decomposition of the error components is based on the total mean squared error mse left hand side of eq 1 as 1 y x 2 n y x 2 n y y 2 n 2 y a x b where x and y are the observed and forecasted rainfalls respectively and n is the total number of observations y is a linear function with a and b as the slope and intercept respectively the degree of association of the imd mme rainfall forecasts and its bias corrected estimates by the copula eksom and cop som based rainfall forecasts with the observed rainfall are expressed in terms of percentage bias pbias and modified kling gupta efficiency mkge while the pbias has an ideal value of zero a negative value shows underestimation and a positive value shows overestimation by the model conversely the mkge kling et al 2012 metric evaluates the deviation between the mean and variance and the correlation between the observed and simulated values it varies from a value 0 to a best value of 1 both pbias and mkge are widely used to represent the systematic error reduction capability of a bias correction model e g hosseini moghari and tang 2020 the performance indicators used in this study are given below 3 p b i a s i 1 n f i o i i 1 n o i 100 4 mkge 1 r 1 2 β 1 2 γ 1 2 where 5 β μ f μ o 6 γ cv f cv o where o i and f i are the observed and forecasted rainfalls respectively o is the mean of the observed rainfall r is the correlation coefficient between the observed and forecasted rainfalls β is the bias ratio γ is the variability ratio μ is the mean discharge and cv is the coefficient of variation and the suffixes f and o represent the forecasted and observed rainfalls respectively 3 2 mike11 nam hd standalone hydrological modelling framework in large river basins the channel flows are dominant over the overland flows therefore the mike11 nam conceptual model is used herein to simulate the pluvial surface runoff at the sub catchment scale which is then routed by using the physically based mike11 hd model with the full saint venant equations of continuity and momentum conservation this integration is termed as mike11 nam hd mike11 nam is a lumped conceptual model which simulates the rainfall runoff transformation process based on four different but inter related storages viz snow storage surface storage root zone storage and groundwater storage the nine model parameters in mike11 nam table 1 are auto calibrated using the shuffled complex evolution sce algorithm madsen 2000 since the mahanadi river basin is fully rainfed snow storage is not considered in the hydrological modelling framework following a multi objective calibration criterion e g refsgaard 1997 madsen et al 2002 and auto calibration routine three objectives are considered for calibrating mike11 nam i to minimize the overall volume error ii to minimize the overall rmse and iii to minimize the rmse of the peak flows the manning s roughness coefficient is the only calibration parameter in the mike11 hd model in the mike11 nam hd model the mike11 nam simulated sub catchment wise fig 1 surface runoff is laterally linked as the upstream boundary condition to the mike11 hd model this coupled mike11 nam hd model is finally calibrated to obtain the optimum manning s roughness coefficient n so as to best reproduce the observed streamflow hydrograph in this study mike11 nam hd is calibrated and validated using the hydrometeorological viz mean areal rainfall mean areal potential evapotranspiration and streamflow datasets of the monsoon season june september of the years 2000 2007 and 2008 2014 respectively ten sub catchments corresponding to the gauging stations except basantpur and two intermediate sub catchments ic 1 and ic 2 in the upstream and downstream of the basantpur gauging station fig 1 are considered for setting up the mike11 nam hd model in mike11 hd the manning s n is manually calibrated in the interval of 0 02 0 04 with an increment of 0 002 to best reproduce the observed discharge hydrograph at the downstream gauging station the model performances during the calibration and validation are evaluated based on the nash sutcliffe efficiency nse nash and sutcliffe 1970 asce 1993 correlation coefficient r mean absolute error mae and ratio of root mean square error rmse to standard deviation of observed data sd observed rsr a careful review of literature e g moriasi et al 2007 tiwari and chatterjee 2011 nanda et al 2016 2019 parvaze et al 2022 suggests that these model evaluation criteria have been widely used to assess the streamflow prediction ability of a hydrological model nse presents the overall agreement between the explained variances by the observed and simulated values the correlation coefficient shows the linear association between the two variables that ranges from 1 to 1 mae provides a balanced idea of the model prediction error by evaluating all deviations from the observed values irrespective of the sign tiwari and chatterjee 2011 rsr on the other hand includes the advantages of the rmse but with a normalizing factor to make it applicable for a wide range of variables akhtar et al 2009 keeping in view of the importance of the total volume of water flowing into a reservoir this study employs the e vol criterion to assess the error in the flow volume simulated by the model the goodness of fit measures used herein are expressed as 7 nse 1 i 1 n o i s i 2 i 1 n o i o 2 8 r i 1 n o i o s i s i 1 n o i o 2 i 1 n s i s 2 9 mae 1 n i 1 n o i s i 10 rsr rmse sd observed i 1 n o i s i 2 i 1 n o i o 2 11 e vol i 1 n s i i 1 n o i i 1 n o i 100 where o i and s i are the observed and simulated discharges and o and s are the means of the observed and simulated discharges respectively the calibrated and validated mike11 nam hd model is then used to simulate the inflows into the hirakud reservoir 3 3 development of nested smoothing based long short term memory lstm error updating model unlike the recently developed lstm based step sequence framework lstm ss containing m specific models for m step ahead flood forecasting yin et al 2022 which becomes highly complicated with the increase in lead times this study proposes a nested approach characterized with a cascade of six lstm models in the first phase of lstm modelling setup and one lstm model in the second phase of setup figs 4 and 5 a detailed description of the basic lstm networks is presented in appendix b as a pre processing of input datasets in the lstm network the variance in the error time series is smoothed using hanning hamming bartlett and blackman smoothing windows out of which the blackman window is found to be the best operation of these smoothing windows are shown in the scipy cookbook of python language https scipy cookbook readthedocs io items signalsmooth html the details of the smoothing windows appendix b used herein can be found in oppenheim and schafer 1999 note that the window size considered herein is a model parameter thus an optimum window size of 20 is obtained by trial and error approach to prevent the subsequent loss of data convolution fig 4 is applied after passing the error time series through the smoothing windows for efficient learning the smoothed errors are then scaled in the range of 1 1 using minmaxscaler the predicted errors generated by each of the lstm model are back transformed to the original domain using the same scaler each lstm model used herein follows a sequence to single output procedure in the form of sliding windows considering a total of past five time lagged inputs errors to forecast the single δ day ahead output gao et al 2020 this past time steps here five used for error forecasting at t δ day lead time is obtained by trial and error method the architecture of the lstm models used in this study includes three recurrent layers with 256 64 and 32 units respectively followed by a single fully connected dense layer with an activation function tanh the weights and biases of this lstm neural network model are updated using the backpropagation through time algorithm for updating the learning rates and other parameters involved in the network adaptive momentum or adam is used as an optimization function huber loss function is used as the objective criterion for loss calculation to obtain an optimized lstm model the network is trained with 350 epochs with a batch size of 32 the entire lstm modelling framework is coded using python programming language and the model parameters are calibrated using a trial and error approach e g kao et al 2020 faraji et al 2022 nourani et al 2022 since the meteorological forecasts in the study area are available from 2008 to 2013 which is relatively short both the training and validation steps are performed to ensure adequate model learning before applying it on the testing data a 60 40 ratio of data length is adopted for model training and testing to prevent overfitting 40 of the training data is used for model validation rahimzad et al 2021 a schematic representation of the nested smoothing based lstm modelling framework is shown in fig 5 the error time series e t up to the time of forecast t is computed as the difference between the observed and mike11 nam hd simulated discharges using raw imd mme and bias corrected rainfall input forcings at each lead time all the sequential errors at 1 5 day lag times eqs 12 16 and the error forecasts at the δ day lead time eq 17 as computed during the first phase of lstm modelling setup with the cascade of six lstm models are governed by 12 e t 4 f e t 8 δ e t 7 δ e t 6 δ e t 5 δ e t 4 δ 13 e t 3 f e t 7 δ e t 6 δ e t 5 δ e t 4 δ e t 3 δ 14 e t 2 f e t 6 δ e t 5 δ e t 4 δ e t 3 δ e t 2 δ 15 e t 1 f e t 5 δ e t 4 δ e t 3 δ e t 2 δ e t 1 δ 16 e t f e t 4 δ e t 3 δ e t 2 δ e t 1 δ e t δ 17 e t δ f e t 3 δ e t 2 δ e t 1 δ e t δ e t to estimate the forecasted error at δ day lead time the predicted errors up to time t by eqs 12 16 are forced as inputs to the second phase of lstm modelling setup as 18 e t δ f e t 4 e t 3 e t 2 e t 1 e t in this study first the unrefined streamflow forecasts q t δ are simulated by the rmike and bcmike variants of the mike11 nam hd model in the rmike variant mike11 nam hd is forced with the raw imd mme rainfall forecasts prefixed as r whereas in the bcmike variant mike11 nam hd is forced with the bias corrected rainfall forecasts by the best performing bias correction approach prefixed as bc fig 2 subsequently these unrefined forecasted discharges are updated using the lstm as 19 q t δ u p d a t e d q t δ e t δ e t δ where q t δ u p d a t e d is the updated discharge forecasts at δ day lead time it may be noted that the forecasted errors at δ day ahead e t δ and e t δ are obtained from the first and second phases of the lstm modelling setup respectively 3 4 wnarx error updating model for a comparative study a recently developed efficient error updating model namely the dynamic wavelet based nonlinear autoregressive with exogenous inputs wnarx model nanda et al 2016 2019 is also coupled with the mike11 nam hd model the error forecasting framework of the wnarx model is presented in fig 6 in this study the wnarx model is trained with 3 day time lagged error forecasts between the observed and mike11 nam hd simulated discharges during the calibration period 2000 2007 wherein the effective time lag is estimated based on the autocorrelation function acf 0 4 fig s1 in supplementary materials in this method the pre processed errors with discrete wavelet transform dwt are forced into the narx model a major advantage of this model is its ability to address the nonstationarity in the input dataset due to the dwt operation in the wnarx model the daubechies db2 wavelet function is chosen to maintain uniformity with nanda et al 2019 the level 5 of db2 function is selected based on the pearson s correlation coefficient r estimated between the two error time series that are obtained at a given lead time and the corresponding discrete wavelet component following nanda et al 2019 r 0 1 is considered to be satisfactory for this purpose the autoregressive nature of the wnarx model preserves the catchment memory up to a higher lead time improving the forecasting accuracy the log sigmoid function of the hidden layer in the wnarx model forecasts the δ time step ahead error e t δ with a neuron weight of w as 20 e t δ 1 1 e x p i 1 d e t 1 i w i j 1 τ e t δ j w j where d and τ are the effective time lags for the exogenous et et 1 et d and endogenous et δ 1 et δ τ inputs of error time series respectively the forecasted error at a given lead time δ is then added to the mike11 nam hd simulated unrefined discharges q t δ as 21 q t δ u p d a t e d q t δ e t δ where q t δ u p d a t e d is the updated discharge forecasts maintaining uniformity with the lstm error model setup the wnarx model is tested using the datasets of the period 2011 2013 error forecasting using wnarx is carried out in matlab similar to the lstm model the error updating models thus developed in this section are referred to as rmike wnarx and bcmike wnarx for using the raw imd mme and the bias corrected imd mme rainfall forecasts using the best performing bias correction approach respectively 3 5 model evaluation criteria the multi step ahead discharge prediction skills of the developed rmike bcmike rmike wnarx bcmike wnarx rmike lstm and bcmike lstm model variants are evaluated using nse r mae rsr and e vol as discussed in section 3 2 further the equations for the calculation of different performance evaluation measures are given in eqs 7 11 moreover the probabilistic forecast skills of the models are evaluated using the continuous ranked probability score crps the crps is mathematically expressed as gneiting and raftery 2007 22 c r p s f y f x h x y 2 d x where f x is the cumulative distribution function cdf of the probabilistic forecasts x y is the observed streamflow and h x y is the heaviside function h x y has a value of 1 for x y and 0 for x y a smaller value of the crps indicates better forecasts to capture the errors in the high peaks of the simulated discharges the peak flow error is estimated as 23 e peak q s q o 1 100 where q o and q s are the observed and model simulated peak flows respectively further the mean difference in peak flow timing defined as the average offset between the observed and model simulated peak flow timing during the testing period kratzert et al 2021 is also computed note that the annual maximum peak flow is considered herein for the computation of e peak and the mean difference in peak flow timing the predictive uncertainty associated with the forecasted discharges is estimated using the quantile regression qr technique the details of qr technique is presented in appendix c 4 results and discussion 4 1 comparative evaluation of the bias correction methods for imd mme rainfall forecasts to reduce the biases in the multi step ahead raw imd mme rainfall forecasts copula eksom and cop som hybrid bias correction approaches are employed out of the four copula families tested herein to capture the nonlinear dependency between the observed and forecasted rainfalls the frank copula is found to be the best for most of the cases the optimum map units obtained for each grid in the eksom and cop som approaches are presented in the supplementary section figs s2 s13 the accuracy of the bias corrected rainfall forecasts is compared with the raw imd mme rainfall forecasts at each spatial grid in the upper mahanadi river basin fig 7 and s14 in the supplementary materials illustrate the spatially distributed systematic errors se and random errors re in the raw and bias corrected rainfall forecasts respectively the relatively higher se median 49 5 55 6 present in the raw imd mme rainfall as shown in fig 7 justifies the use of a bias correction tool to improve the lead time rainfall forecasts the results reveal that the copula based rainfall forecasts could address the random error component at each lead time fig s14 however with a higher systematic error fig 7 as compared to the imd mme forecasts note that aghakouchak et al 2012 and hosseini moghari and tang 2020 advocated that an se 50 is acceptable for daily rainfall forecasts however in this study use of copula increased the systematic error in the raw imd mme forecasts to the median se of 89 7 94 4 which is unacceptable conversely with the use of cop som hybrid model these spatially distributed median systematic errors by the copula 89 7 94 4 and eksom 35 5 39 7 member models could be reduced to 34 3 35 9 acceptable range revealing the cop som being the best model with the least values of se at all the lead times to assess the overall agreement between the observed and forecasted pre and post bias correction rainfalls at each lead time the spatial plots of pbias are presented in fig d 1 in appendix d the pbias estimates for the raw imd mme rainfall forecasts in fig d 1 ranges from 0 9 to 79 3 across all the grids at 1 5 days lead times these results are found to be consistent with durai and bhardwaj 2014 wherein relatively higher errors in the raw imd mme rainfall forecasts are observed it is evident from fig d 1 that the p b i a s in the imd mme rainfall forecasts for the north western region of the upper mahanadi river basin are relatively high interestingly the variation in the range of p b i a s estimates for the raw imd mme rainfall are found to be higher at a smaller lead time say 1 0 70 5 at 1 day ahead as compared to the 5 day ahead rainfall 20 5 64 4 however the reason behind such variation is not known and needs further investigation in contrast the copula based approach reduces the positive biases and simultaneously increases the negative biases median 40 7 to 47 4 in the imd mme rainfall forecasts thus the overall effect of bias correction using the copula based approach deteriorated the raw imd mme forecasts the large negative biases in the copula based bias corrected rainfall forecasts makes this approach unacceptable and needs further enhancement e g hosseini moghari and tang 2020 conversely the eksom performed very well as a bias correction tool with pbias 15 across all the lead times whereas the cop som performed the best with pbias 7 mostly further both these approaches also seem to correct the existing spatial patterns of the biases in the raw imd mme rainfall forecasts fig d 1 the spatial distribution of modified kge mkge for the gridded rainfall forecasts is shown in fig d 2 in appendix d like the se and pbias estimates a similar interpretation can be made from the mkge estimate the higher mkge estimates by the eksom median 0 27 0 36 and cop som median 0 39 0 43 reveal improved forecast skills as compared to the raw imd mme median 0 04 0 20 and copula median 0 09 to 0 02 the lower mkge 0 5 estimates reveal that a daily temporal resolution of rainfall may be too high for quantitative applications balogun et al 2018 many recent studies gebremichael et al 2019 abebe et al 2020 gebremicael et al 2022 also reported relatively poor performance of satellite based rainfall products at a daily temporal scale conversely the negative or very low positive close to zero mkge estimates median 0 09 to 0 02 by the copula based bias corrected rainfall forecasts makes them unsatisfactory for using in a hydrological model for operational flood forecasting furthermore to assess the bias correction approaches in correcting the biases associated with the forecasted rainfall at a regional scale taylor diagrams taylor 2001 are prepared for each lead time fig 8 for this analysis the pre and post bias corrected imd mme rainfall forecasts are lumped by averaging them for the entire upper mahanadi river basin fig 8 reveals that the rmse estimates for the imd mme rainfall are comparatively high 10 mm at all lead times the correlation coefficient r 0 5 for the raw imd mme forecasts at 1 day lead time may be acceptable however it becomes unacceptable at higher lead times these findings are in agreement with bhowmik and durai 2012 and durai and bhardwaj 2014 wherein higher rmse and lower r values were obtained for the raw imd mme rainfall for the eastern part of india in general the eksom and cop som models are found to improve the raw imd mme rainfall forecasts across all the lead times the spatial analysis of the cop som based rainfall forecasts proves cop som to be the best at the regional scale with the least errors and highest correlation with the observed rainfall similar to the study by sahai et al 2017 showing significantly better prediction skills of traditional som self organizing maps based seasonal mme rainfall in the mahanadi river basin the enhanced ksom both in basic eksom and hybrid cop som modes in this study exhibits better prediction skills in a short to medium range forecast horizon in contrast the copula based approach which was previously tested to be effective for the correction of regional climate model derived rainfall with probability mass accumulated at zero rainfall maity et al 2019 could not perform satisfactorily in correcting the biases in the ensemble rainfall forecasts from the analysis carried out in this study it is evident that the copula based approach reduces the random error component and increases the systematic error component which could be a possible reason for its poor performance another possible reason may be attributed to the consideration of 50th quantile to solve the mixed conditional probability distribution there is always an underlying uncertainty associated with the quantile value which best represents the observed value in employing copulas for prediction of random variables an uncertainty band for the copula based estimates can be obtained mao et al 2015 to address this statistical question thus selection of an appropriate quantile to obtain the predicted value from a copula function is a research question and its investigation can be considered as a future scope of this study overall the cop som approach indicated the best prediction skills among the three different bias correction approaches tested herein and hence the cop som based rainfall forecasts are further considered as the input forcings for the mike11 nam hd hydrological model for lead time discharge predictions 4 2 performance of standalone mike11 nam hd model the mike11 nam hd model is calibrated at the inflow location of the hirakud reservoir using the observed daily streamflow records from 2000 to 2007 and validated from 2008 to 2014 for the monsoon season considering auto calibration technique and multi objective criteria the calibrated values of the nine model parameters are presented in table 2 fig 9 illustrates the capability of the selected model in reproducing the observed inflows into the hirakud reservoir during both the calibration and validation phases from fig 9 it is clear that the developed mike11 nam hd model is able to capture the seasonal variability of observed discharge pattern very well although some of the high peaks are slightly underestimated which is inevitable in the hydrological modelling framework during calibration the mike11 nam hd model showed satisfactory performance with nse 0 83 r 0 91 mae 608 65 m3 s rsr 0 42 and e vol 2 84 similarly during validation this model performed with nse 0 91 r 0 95 mae 500 66 m3 s rsr 0 30 and e vol 1 55 overall the mike11 nam hd model performed very well during both the calibration and validation phases 4 3 comparison of streamflow forecasting model variants figs 10 and 11 illustrate the reproduction of the observed streamflow hydrographs by the developed forecasting model variants during the testing period it is evident from fig 10 that the rmike is not able to capture the streamflow forecasts relatively well especially at higher lead times of 3 5 days wherein these forecasts are associated with the random fluctuations these fluctuations may be attributed to the relatively poor quality of the raw imd mme rainfall forecasts which are used as the input forcings into the hydrological model even though the resulting streamflow forecasts are error updated using the wnarx and lstm as the post processing tools this can be reconfirmed from fig 11 as these random fluctuations do not appear in the hydrological model simulated streamflow forecasts while using the bias corrected rainfall forecasts as the input forcings the estimates of the model evaluation criteria considered herein are presented in table 3 from table 3 it is evident that the standalone rmike model forced with the raw imd mme rainfall is capable of forecasting the discharges up to 2 days lead time with nse 0 68 0 81 and r 0 86 0 90 however with an increase in the forecast lead times the forecasting accuracy deteriorates drastically with nse 0 36 to 0 51 and r 0 73 to 0 47 conversely up to 3 days lead time the rmike wnarx error updating model improves the forecasted discharges with nse 0 51 0 87 and r 0 76 0 94 whereas the rmike lstm performed the best with nse 0 67 0 92 and r 0 85 0 96 at 3 5 days lead times the forecasted discharges by the standalone rmike are not acceptable nse 0 5 from fig 11 and table 3 it is evident that the standalone mike11 nam hd model forced with the cop som based bias corrected rainfall forecast products perform relatively better at all the lead times bcmike nse 0 53 0 81 r 0 74 0 91 than that with the raw imd mme rainfall it is also evident from figs 10 11 and table 3 that the bcmike model when integrated with the error updating models namely bcmike wnarx and bcmike lstm outperform the standalone rmike and bcmike models the intercomparison of all the developed models reveals that the bcmike lstm model performs remarkably well at all the lead times with nse 0 81 0 92 and r 0 90 0 96 similarly at these lead times bcmike wnarx performed satisfactorily with the nse 0 67 0 88 and r 0 89 0 94 respectively this proves that the advocated nested smoothing based lstm error forecasting model integrated with the mike11 nam hd model is able to better forecast the river flow as compared to the mike wnarx framework table 3 reveals that the mae estimates by the rmike wnarx rmike lstm bcmike wnarx and bcmike lstm frameworks are in the range of 645 97 2070 31 m3 s 580 28 2002 05 m3 s 628 36 1777 59 m3 s and 569 09 948 82 m3 s respectively while the mike11 nam hd model variants with the bias corrected rainfall forecasts viz bcmike bcmike wnarx and bcmike lstm performed satisfactorily at all the lead times with the mae estimates less than half of the standard deviation 1922 44 m3 s of the observed data moriasi et al 2007 the performance of rmike and rmike wnarx rmike lstm are unacceptable beyond 3 and 4 days lead times respectively similarly the rmike and rmike wnarx rmike lstm models with an rsr 0 70 shows poor performance at 3 5 days and 4 5 days lead times respectively table 3 although bcmike and bcmike wnarx variants perform satisfactorily with rsr 0 44 0 68 and rsr 0 35 0 57 respectively at 1 5 days lead times the bcmike lstm model shows very good rsr 0 29 0 44 streamflow forecasting skills with an rsr 0 5 e g singh et al 2004 moreover the prediction error in the total inflow volume by all the model variants may be considered as acceptable with e vol 20 except rmike e vol 29 34 47 25 at 3 5 days and bcmike wnarx e vol 36 28 at 5 days lead times in addition the crps estimates as shown in table 3 indicates that the bcmike lstm model exhibits the best probabilistic forecast skills with the least crps estimates of 52 62 65 62 m3 s 2 followed by the bcmike wnarx model crps 53 98 67 03 m3 s 2 like mo et al 2021 although the crps increases with increasing lead time indicating deterioration of the forecast accuracy of the models the numerical values of the crps are relatively less this may be due to the shorter length of the testing period considered in this study fig 12 shows the box plots of the absolute prediction error p e in m3 s of the discharge forecasts for the testing period the prediction error estimated here is the difference between the observed and simulated discharges by the model the distributions of p e fig 12 exhibit the smallest quartile for the bcmike lstm model followed by the bcmike wnarx model further the spread in the model prediction error by the rmike lstm at 1 2 days lead times are found to be comparable with that of the bcmike lstm model however with the increase in lead time the variation in the prediction error increases in general the effect of bias correction of rainfall forecasts is found to improve the discharge prediction skills of the mike11 nam hd model among the various model variants tested herein the overall performance decreased in the order bcmike lstm bcmike wnarx bcmike rmike lstm rmike wnarx rmike the downstream reaches of the mahanadi river basin has witnessed severe flooding during the years 2011 2012 and 2013 due to high peak inflows into the hirakud reservoir nanda et al 2019 therefore the capability of the developed streamflow forecasting models is assessed for reproducing these typical observed high peaks table 4 presenting the errors in peak flows by these models reveals that the bcmike lstm simulated peak flows are mostly within the acceptable limit e peak 20 for up to 5 days lead time the peak flood in the year 2011 which is one of the most devastating floods experienced in the mahanadi river basin with 35 000 m3 s of flow at the head of the mahanadi delta is attributed to improper dam operation in the absence of reliable inflow forecasts into the hirakud reservoir jena et al 2014 gouda 2019 it is evident from table 4 that the rmike lstm e peak 10 11 12 37 and bcmike lstm e peak 12 94 15 55 error updating frameworks are able to reproduce the 2011 peak flood with reasonable accuracy up to 3 and 4 days lead times respectively further the mean difference in peak flow timing during the testing period is presented in table 5 in general this assessment reveals that the average time difference in the occurrence of peak flows increases with the increase in lead time the bcmike lstm depicts the least average offset in peak flow timing among the tested models table 5 it is evident from table 5 that the bcmike lstm model is able to predict the peak flows quite accurately up to 2 days lead time with an average offset of about 0 33 days i e 8 h as the lead time increases from 3 to 5 days the mean difference in peak flow timing as predicted by the bcmike lstm is found to be 1 day in the past studies e g parvaze et al 2022 kratzert et al 2021 the considered basin area is relatively small as compared to the large basin area of 83 400 km2 considered herein in the present study area the time of concentration is about 2 3 days jena et al 2014 khatun et al 2022a therefore an offset of 8 h in the case of the streamflow forecasts with 2 days lead time and an offset of 1 day in the case of the streamflow forecasts in fig 10 with 3 5 days lead times can still help in flood preparedness for the downstream reaches overall the performance of the bcmike lstm model is considered satisfactory in capturing the timing of occurrence of the peak flows the superior performance of these mike lstm frameworks may be attributed to the inherent memory of the nested smoothing based lstm modelling architecture integrated with the feedback structure sufi karimi et al 2019 the overall assessment reveals that the mike11 nam hd modelling frameworks forced with the cop som based rainfall forecasts integrated with the wnarx and lstm error updating models are able to simulate the discharges satisfactorily at the inflow location of the hirakud reservoir up to a lead time of 5 days in general it may be inferred that the wnarx error updating model can store the catchment memory with higher lead times through the feedback loop which can aid to capture the flow variations relatively well conversely lstms consist of cells that help in storing information at a current time step to retain the long term dependencies in which smoothing by convolution addresses the nonstationarity reducing the forecasting error variance significantly therefore the lstm error updating model could also capture the observed high peak flows with reasonable accuracy this makes the nested smoothing based lstm model lstm integrated with mike11 nam hd superior in operational river flow forecasting with ensemble meteorological forecasts up to 5 days lead time 4 4 assessment of predictive uncertainty pu in streamflow forecasting the predictive uncertainty analyses in river flow forecasting at each lead time are estimated using the quantile regression qr technique as shown in figs 13 and 14 and fig s15 in supplementary materials the 50 and 90 uncertainty bands for all the model variants are found to be inter comparable up to 2 days lead time figs 13 14 and fig s15 while the rmike model fails to capture the discharges within the 50 and 90 confidence interval ci bands at 3 5 days lead times fig s15 the rmike wnarx and rmike lstm exhibit relatively wider ci bands up to 5 days lead time fig 13 as envisaged from fig s15 the standalone rmike and bcmike variants overestimate the streamflows at almost all the lead times indicating poor credibility of the models in operational river flow forecasting similarly the bcmike wnarx is found to overestimate the discharges at 5 days lead time in terms of uncertainty associated with the river flow forecasts the bcmike lstm model is found to outperform all the other model variants with the narrowest uncertainty bands at all the lead times fig 14 as the smoothing filters could reduce the noise in time series data livieris et al 2021 the lstm error updated model variants have relatively better performance in predictive uncertainty estimation since the uncertainty fluctuates based on the forecasted values and lead time weerts et al 2011 the river flow prediction uncertainty depicted by the wnarx error updated model bcmike wnarx can also be considered satisfactory up to 3 days lead time 5 conclusions this study reveals the robustness of the coupled lstm and mike11 nam hd hydrological model in improving the streamflow prediction accuracy and predictive uncertainty at daily scale this framework can be applied in river basins in india and other places world wide unlike the complex nested lstm approach e g yin et al 2022 this study proposes a relatively simple smoothing technique since the rainfall forecasts world wide are having low accuracy levels the copula eksom based bias correction technique developed herein could reduce both the systematic and random errors note that the existing standalone bias correction methods either address the random error or systematic error only therefore the proposed framework has wide scale applicability in improving the streamflow forecasts in world river basins both at smaller and larger lead times based on the results the major conclusions from this study are summarized as below i the raw imd mme rainfall forecasts with relatively high biases make them inappropriate for river flow forecasting while the copula based bias correction approach focuses on reducing the random error component of the total rainfall forecast errors the enhanced ksom based methods eksom and cop som show improvement in forecast skills of the raw imd mme rainfall out of the eksom and cop som approaches the cop som performs the best with relatively lower p b i a s and higher modified kge values ii the standalone mike11 nam hd conceptual hydrological model forced with the raw imd mme rainfall forecasts can predict the river flow reasonably well up to 2 days lead time the bcmike model on the other hand could simulate acceptable discharge forecasts up to 5 days ahead however with lower nse estimates nse 0 53 0 81 iii the bcmike wnarx error updating model proves to be skilful in producing the discharge forecasts up to 5 days lead time nse 0 67 0 88 iv the bcmike lstm framework outperforms all other model variants in forecasting the overall discharge time series at 1 5 days lead times nse 0 81 0 92 as well as the high flood peaks however the rmike lstm model is useful for the discharge forecasts with the lower prediction errors up to 2 days lead time only v as far as the forecasting uncertainty is concerned the bcmike lstm model performs the best in terms of daily river flow with the narrowest confidence interval bands at all the lead times however the rmike and bcmike variants at 1 5 days lead times and the bcmike wnarx variant at 4 5 days lead time are not acceptable due to significant overestimation of the predictive uncertainty overall the present study suggests that the bias correction of imd mme rainfall forecasts using the hybrid copula enhanced kohonen self organizing maps cop som can aid in improving the streamflow forecasts by a hydrological model after its integration with the wnarx or nested smoothing based lstm lstm error updating model unlike the previous studies e g chen et al 2020 livieris et al 2021 xie et al 2021 this study establishes that the implementation of a smoothing based feature enhancement technique which increases the simplicity and robustness of the basic lstm network both in terms of the prediction accuracy and predictive uncertainty in operational streamflow forecasting while the recently developed lstm based step sequence framework lstm ss containing m specific models for m step ahead flood forecasting e g yin et al 2022 may become highly complicated as the lead time increases the simple nested smoothing based lstm model developed herein is characterized by a two step cascade of six smoothing based lstm models in the first phase of modelling setup and one smoothing based lstm model in the second phase although the wnarx integrated hydrological model mike11 nam hd herein provides reasonably accurate streamflow forecasts the mike11 nam hd lstm model framework performed the best thus the lstm integrated error updating framework is one of its kind and a similar methodology can be implemented in any world river basin including the tropical river basins however exploring the effect of different types of hydrometeorological datasets and their sizes on the developed lstm error model can be considered as the future scope of this study credit authorship contribution statement amina khatun conceptualization methodology data curation formal analysis investigation software writing original draft visualization writing review editing bhabagrahi sahoo conceptualization methodology writing review editing supervision resources chandranath chatterjee conceptualization methodology writing review editing supervision resources declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgements this study was carried out as a part of the sub project impact of climate change on flood risk of the center of excellence coe in climate change studies activity established at the indian institute of technology iit kharagpur the authors thank the department of science and technology dst government of india for the financial support the authors acknowledge the india meteorological department imd hirakud dam circle hdc burla and central water commission cwc for providing the datasets used in this study appendix a copula based bias correction approach to deal with the tropical rainfall pattern the copula based bias correction approach revised by maity et al 2019 uses a conditional probability distribution with special focus on the zero inflated rainfall values for this the training dataset for each spatial grid is formulated considering the pairs of a the non zero positive values of both the observed and forecasted rainfalls b zero values of the observed and non zero values of the forecasted rainfalls and c non zero values of the observed and zero values of the forecasted rainfalls in the first data pair a a suitable marginal distribution is fitted to the observed and forecasted rainfalls subsequently the dependence between the non zero pairs of observed and forecasted rainfalls is modelled by a suitable copula function c of the form f x y x y c f x x f y y where x and y represent the observed and forecasted rainfalls and f x x and f y y represent the marginal distributions of x and y respectively considering the best fit copula family the conditional probability distribution of the observed x rainfall for a given forecasted y rainfall is obtained as a 1 f x y x y c f x x f y y f y y in the second data pair b an exponential decay curve of the form p a e mb is fitted where b is the forecasted rainfall p is the probability of zero observed rainfall and a and m are the parameters the probability mass for zero observed rainfall for a given value of the forecasted rainfall is then used to update the conditional probability distribution in eq a 1 as a 2 f x y x y p f o r x 0 y 0 p 1 p f x y x y f o r x 0 y 0 where f x y x y is the updated or mixed conditional probability distribution in the third data pair c the zero observed rainfall frequencies are computed and a suitable probability distribution is fitted to the non zero positive observed rainfall values then the mixed conditional distribution of the bias corrected rainfall forecasts is obtained focusing on the zero inflated rainfall values as maity et al 2019 a 3 f x y 0 x n f o r x 0 y 0 n 1 n h x x f o r x 0 y 0 where n is the frequency of zero observed rainfall values determined from the y intercept of the equation of the form p a e mb and h x x is the marginal distribution of the non zero observed values for the third pair of dataset the graphical depiction of the mixed distribution thus obtained is shown in fig 3a subsequently the pseudo observations of the bias corrected rainfalls are derived and transformed to obtain the bias corrected values in the original data space using the integral probability transformation a detailed description of the copula based bias correction approach can be found in maity et al 2019 appendix b long short term memory lstm networks and smoothing windows lstm hochreiter and schmidhuber 1997 is a specially designed rnn framework with the ability to capture the sequential order of inputs preserving the long term dependencies between the input and output variables an lstm cell comprises of two basic elements i cell memory s t and ii three gates f i and o as encircled in fig b 1 the cell memory stores information whereas the gates control the flow of information among the gates the forget gate f gers felix et al 2000 decides the component and the degree up to which a component in the previous t 1 cell state vector is to be stored at time t resulting in the vector f t with the values ranging from 0 to 1 expressed as b 1 f t σ w f e t u f h t 1 b f where σ is the logistic sigmoid function e t is the input forecasting error vector h t 1 is the previous hidden state w f and u f are the weight matrices and b f is the bias vector in the first time step the hidden state h is initialized with zero vector of user defined length using the present input e t and the previous hidden state h t 1 a potential updated cell state vector s t with values ranging from 1 to 1 is defined as b 2 s t t a n h w s e t u s h t 1 b s where t a n h is the hyperbolic tangent w s and u s and b s are the weight matrices and bias vector for the updated cell state respectively i the input gate fig b 1 controls which and what degree of information in the potential cell state s t are to be used for updating the current cell state resulting in vector i t with the values ranging from 0 to 1 as b 3 i t σ w i e t u i h t 1 b i where w i and u i are the weight matrices and b i is the bias vector finally the current cell state s t is updated using eqs b 1 b 3 as b 4 s t f t s t 1 i t s t where represents the multiplication of each element in the first time step the cell state is initialized with the zero vector with the length equal to that of the hidden state vector then the output gate o controls which and what degree of information from s t will flow to the next hidden state h t as b 5 o t σ w o e t u o h t 1 b o where w o and u o are weight matrices and b o is the bias vector note that w u and b are the learnable parameters here finally using eqs b 4 b 5 the new hidden state is computed as b 6 h t t a n h s t o t the input at any time t is processed sequentially in the cells of each layer of the lstm network and the last hidden state output h z is connected to a single output neuron using a dense layer subsequently the final output forecasting error at time t δ with the lead time δ is computed as b 7 e t δ w d h z b d where w d and b d are the weight matrix and bias term of the dense layer respectively during the training of the lstm network the learnable parameters are updated in each iteration called epoch based on a loss function each iteration starts with generating batches of a user defined number of random samples from the training data as shown in fig 4 in this study a nested smoothing based lstm lstm model is developed to forecast the multi step up to 5 days ahead errors given the known historical forecast error data during the previous 5 days the application of smoothing operation in a particular epoch of the lstm model run is presented in fig 4 the smoothing window functions are commonly referred to as apodization or tapering functions nuttall 1981 and are usually symmetric around the centre of a specific interval they taper away to become zero valued outside the interval these smoothing windows are capable of capturing the underlying pattern in the error time series while leaving out the noise present in it in this study the bartlett eq b 8 blackman eq b 9 hamming eq b 10 and hanning eq b 11 smoothing window functions are used b 8 w n 2 m 1 m 1 2 n m 1 2 b 9 w n 0 42 0 5 cos 2 π n m 0 08 cos 4 π n m b 10 w n 0 54 0 46 cos 2 π n m 1 0 n m 1 b 11 w n 0 5 0 5 cos 2 π n m 1 0 n m 1 where w n is the window function and m is the order of the window function appendix c quantile regression based predictive uncertainty estimation the predictive uncertainties pu of all the model variants developed herein are computed using the quantile regression qr technique e g koenker 2005 weerts et al 2011 kumar et al 2015 barbetta et al 2017 in this technique linear qr relationships between the probability distribution of discharge forecasts and the errors at each lead time are established for a given quantile assuming a linear relationship the forecasted discharges q and the errors e are first transformed to a gaussian domain at any lead time of interest as c 1 ne i mnq i c where nq i and ne i are the discharges and associated errors in gaussian form and m and c are the slope and intercept at a given data level i a detailed description of qr technique can be found in weerts et al 2011 in this study the regression coefficients between nq i and ne i at 5 25 50 75 and 95 are derived using the calibration datasets the quantreg package in r s cran repository is used for applying the qr technique the derived errors at different quantiles are then de normalized e x and added to the forecasted discharges q t δ to obtain the updated forecasts q x t δ as c 2 q x t δ q t δ e x appendix d miscellaneous figures appendix e supplementary data supplementary data to this article can be found online at https doi org 10 1016 j jhydrol 2023 129199 appendix e supplementary data the following are the supplementary data to this article supplementary data 1 
