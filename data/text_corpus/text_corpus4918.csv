index,text
24590,bayesian inference has become an important framework for calibrating complex ecological and environmental models markov chain monte carlo mcmc algorithms are the methodological backbone of this framework but they are not easily parallelizable and can thus not make optimal use of modern computer architectures a possible solution is the use of sequential monte carlo smc algorithms currently smcs are used mainly for bayesian state updating for example in weather forecasting and are thought to be less efficient for parameter calibration than mcmcs unlike mcmcs however smcs are easily parallelizable thus smcs may become an interesting alternative when modelers have access to parallel computing environments the purpose of this paper is to provide an introduction to smc algorithms for bayesian model calibration and to explore the trade off between efficiency and parallelizability for mcmc and smc algorithms to that end we discuss different smc variants and benchmark them against a state of the art mcmc algorithm by calibrating three ecological models of increasing complexity our results show that with appropriately chosen settings smcs can be faster than state of the art mcmc algorithms when a sufficiently large number of parallel cores are available and when the model runtime is large compared to communication overhead for parallelization on our hardware a model runtime of 20 ms was enough to favor smc algorithms efficient smc settings were characterized by a balanced mix of smc filtering and mcmc mutation steps suggesting that mixing mcmc and smc principles may be ideal for creating efficient and parallelizable calibration algorithms the algorithms used in this study are provided within the bayesiantools r package for bayesian inference with complex ecological models keywords bayesian inference sequential monte carlo smc mechanistic models model calibration particle filters equifinality 1 introduction many research communities within ecology and environmental sciences traditionally rely strongly on complex process based system models e g global circulation models gcms global dynamic vegetation models g dvms or hydrological models see jeffers 1982 other ecological fields have recently moved in the direction of mechanistic modeling approaches for models of biodiversity change e g urban et al 2016 or models of biogeography or macroevolutionary processes pontarp et al 2019 through this increasing use complex process based models in particular for forecasting e g dietze 2017 the question of how to choose model parameters and determine their uncertainties has become more prominent historically parameters for complex process based models were often chosen ad hoc either by direct measurements or by literature reviews without formal model calibrations cf hartig et al 2012 dietze 2017 with sufficient computing power however process based models can be fit in very much the same way as statistical models and standard statistical procedures such as residual checks model comparison or model averaging can be performed on top of the fitted model e g van oijen et al 2005 schoups and vrugt 2010 a practical difference to statistical models however is that process based models tend to be more nonlinear and connected which together with data limitations results in frequent occurrences of multiple optima or trade offs between parameters non identifiability or equifinality equifinality means that there is no unique optimal parameter set but that many combinations of parameters fit the observations equally well see beven and freer 2001 moreover unlike for statistical models parameters in mechanistic models have a clear meaning and researchers often have prior expectations about their likely value optimization approaches often perform poorly for such nonlinear equifinal problems and frequentist statistical approaches such as maximum likelihood estimation struggle to provide a framework for considering prior information about ecologically plausible parameter values in the calibration procedure for all these reasons bayesian approaches have risen in popularity for calibrating complex process based models in recent years for example to model vegetation dynamics van oijen et al 2005 lagarrigues et al 2015 hydrological processes beven and freer 2001 jeremiah et al 2012 2011 zhu et al 2018 or biogeochemical processes arhonditsis et al 2008 ahrens et al 2014 the aim of the bayesian calibration procedure is to calculate the posterior uncertainty p θ y for the model parameters the posterior is interpreted as the probability density for a given parameter set θ to be correct conditional on the observed data y and our prior beliefs p θ the latter representing our knowledge about the likely parameter values beyond the calibration data the ability to include prior information in a bayesian calibration provides a framework to build upon pre existing knowledge on the values of parameters conversely where there is little empirical basis for constraining the values of a certain parameter this can be accounted for by setting a wide prior distribution the posterior is proportional to the product of the prior distribution p θ representing our best knowledge about parameter values before model calibration and the likelihood function p y θ the probability of observing the data y given the model with parameters θ informally one can view the likelihood as the goodness of fit of the model with parameters θ and the bayesian posterior as a mix between prior information and the information provided by the data through the likelihood because the bayesian framework does not search for an optimal parameter combination but only updates the prior uncertainty by the new data there is no lower limit of how many data are needed for calculating a posterior estimate nor pose multiple optima or equifinality a fundamental problem for a valid posterior estimate for a more thorough description of the typical bayesian calibration process we refer to van oijen et al 2005 or hartig et al 2012 a practical challenge for using bayesian inference is that the posterior can usually not be calculated analytically and must therefore be approximated numerically which is often computationally demanding the current standard solution to this problem are markov chain monte carlo mcmc methods see andrieu et al 2003 for an overview very briefly the idea of an mcmc is to specify a stochastic markov process that performs a random walk in parameter space the markov process is chosen such that the probability of visiting each parameter combination is proportional to its posterior density p θ y the simplest algorithm of this kind is the so called metropolis hastings mcmc many mcmc variants have been proposed to increase the efficiency this algorithm for example through dynamically adapting the transition process haario et al 2006 or combining principles of mcmc with evolutionary algorithms ter braak and vrugt 2008 those variants have improved sampling efficiency i e the number of iterations needed to get a good estimate of the posterior but they all still require a substantial number of model evaluations to fit a complex model often in the range of 106 108 which can make calibrations of complex models a matter of weeks or even months more recent mcmc algorithms run several markov chains concurrently e g ter braak and vrugt 2008 vrugt et al 2009 but because all mcmcs principally evaluate a new parameter proposal relative a current parameter set calculations can be parallelized only to a very limited degree this lack of mcmc parallelizability currently limits the use of bayesian inference for calibrating models with a runtime of minutes or longer and poses a serious problem for the wider adoptation of bayesian inference in the ecological modeling community outside the context of model calibration a widely used alternative to mcmc sampling are sequential monte carlo smc algorithms see del moral et al 2006 for an extensive treatment of the mathematical aspects of smc and speekenbrink 2016 for an introduction the idea of an smc is to generate a usually large e g 103 population of parameter sets termed particles which are then iteratively filtered according to their fit to the data in a way that the final particle population approximates p θ y the main use of smc methods are situations where it is advantageous to use data iteratively for example in state space models or when data becomes available in real time as in weather forecasting doucet and johansen 2009 speekenbrink 2016 however smcs can also be used to estimate parameters for statistical fan et al 2008 dufays 2016 and dynamic models jeremiah et al 2012 2011 sisson et al 2007 zhu et al 2018 the attractive property of doing so is that unlike mcmcs this process can be parallelized making it potentially suitable for calibrating complex time consuming models the downside of replacing mcmcs with smcs is that the latter tend to be less efficient for a single model calibration than an mcmc and require careful tuning to avoid sample degeneracy and impoverishment detailed in the methods below moreover the markovian nature of mcmcs integrates information from past model evaluations faster into the algorithm s exploration of the parameter space although many methods exist to reduce the risk of these problems jasra et al 2011 jeremiah et al 2012 li et al 2014 those are not guaranteed to prevent their occurrence and smcs have therefore rarely been used for model calibration whether this neglect of smcs is justified however is an open question in particular when considering that modern computer hardware is moving towards parallel architectures that cannot be efficiently used by mcmcs so far there have been few serious attempts to benchmark the two approaches against each other an exception is jeremiah et al 2011 who found in a direct comparison between an smc and an mcmc sampler that smc was less likely to be trapped in local optima leading to greater sample robustness however the adaptive metropolis mcmc haario et al 2001 used in that study is known for its inferior performance in the presence of multiple optima compared to more advanced mcmc algorithms e g haario et al 2006 ter braak and vrugt 2008 overall the relative performance of smc and mcmc samplers is therefore still somewhat unresolved a key question so far not systematically investigated is whether the parallelizability of smc samplers could offset possible disadvantages regarding efficiency in practical situations here we address these issues by first giving an overview of the design principles and flavors of smc algorithms identifying the most promising smc variants for parameter calibration we then implement an smc algorithm with the possibility to modify various smc tuning parameters and variants and evaluate their ability to calibrate three models of increasing complexity against a state of the art mcmc sampler as a benchmark the considered models were a multivariate normal distribution a simple dynamic vegetation model and a state of the art forest growth model we assessed the approximation error of the multivariate posterior distribution against the time used by the algorithm 2 methods 2 1 a primer to smc sampling sequential monte carlo smc is a generic term for a range of algorithms based on similar principles smcs also known as particle filters are always initialized by generating a population of n particles each particle corresponding to a possible parameter set typically drawn from some initial distribution the smc will now filter these particles in a way that the final distribution of particles approximates the posterior distribution this filtering typically consists of three steps weighting resampling and mutation illustrated on fig 1 a which are iteratively applied while data is added at each iteration weighting means that each particle is assigned a weight usually proportional to its likelihood i e fit to the data in the next step the particles are resampled with replacement with their sampling probability given by their normalized weights this means that particles with low weights bad fit tend to be discarded whereas particles with high weights good fit are more likely to be replicated the purpose of this step is preventing the issue of particle or sample degeneracy li et al 2014 i e the concentration of weights on a small number of particles finally to avoid having identical particles a mutation step is performed where particles are slightly moved in parameter space based on a defined transition rule this alleviates the risk of sample impoverishment li et al 2014 i e the situation where nearly all particles have identical parameter values the typical use case for smc algorithms are iterative filtering problems fig 1b for example for estimating time varying model states such as the location of a tracked object djuric et al 2003 or soil moisture moradkhani et al 2005 vrugt et al 2013 they may also be used to update model parameter values if new observations become available in real time fig 1c for an example see e g speekenbrink 2016 however smcs can also be used to fit static model parameters fig 1d which is our interest in this study 2 2 using smc algorithms for model calibration as explained above the principle of an smc is to iteratively filter a population of particles regarding their fit to new information unlike in traditional smc applications fig 1b c data in a model calibration do not have a natural time order or appear iteratively one could still establish an iterative filtering by adding the data step wise to the smc but a more flexible approach is to use all data at once and instead increase the weight of the data step wise during the smc iterations technically this is done by creating a sequence of intermediary distributions moving gradually from an initial distribution π 0 to the posterior distribution in a so called bridge approach neal 2001 fan et al 2008 in the few instances where smc was applied to model calibration e g fan et al 2008 jeremiah et al 2012 2011 zhu et al 2018 this approach was always used in practice the initial distribution π 0 is usually the prior although any distribution can be chosen in principle the intermediate distributions π n are then defined as 1 π n π 0 θ 1 β n π θ y β n where the sequence of parameters β n defined so that 0 β 1 β 2 β n 1 controls the mix between the initial distribution and the final posterior based on all data when choosing a sequence β n a trade off exists between stability avoiding particle degeneracy and efficiency speed if the difference between the intermediate distributions is too great filtering will be too aggressive leading to particle degeneracy jeremiah et al 2011 if the difference is too narrow the algorithm will perform more iterations than necessary to solve this trade off jeremiah et al 2012 proposed an adaptive approach starting with a pre defined series β n and decreasing the spacing if the algorithm is at risk of becoming unstable mutating the particles after resampling is crucial for the efficiency of smc samplers zhu et al 2018 for smcs designed for parameter calibration some variation of the metropolis algorithm metropolis et al 1953 is typically used which also forms the basis of many mcmc samplers the principle of the metropolis move is that a new parameter value is generated based on the current one according to some proposal function the probability to accept the move is given by the metropolis ratio the ratio of p θ y for the proposed over the current parameters in an smc mutation step this procedure is applied to each particle possibly multiple times per iteration indeed the number of mcmc mutation steps per smc iteration has been shown to have a substantial effect on sampler efficiency fearnhead and taylor 2013 the simplest metropolis mcmcs use pre defined univariate normal distributions as proposal distributions many of the improvements over this simple choice in the context of mcmc e g haario et al 2006 ter braak and vrugt 2008 have also been applied within smc samplers for example the covariance structure of a multivariate proposal distribution can be updated at each iteration based on the covariance matrix of the particles chopin 2002 fan et al 2008 jeremiah et al 2012 another example is zhu et al 2018 who use a combination of genetic and evolutionary algorithms to generate proposals leading to a considerable increase in sampler efficiency 2 3 description of the smc algorithm used in this study the algorithm proposed in this study fig 2 a was based on the lessons drawn from our literature review regarding efficient smc implementations for model calibration it uses an adaptive scheme to determine the series of intermediate distributions following jasra et al 2011 the sampler is initialized by drawing n particles from an initial distribution π 0 the initial exponent β which controls the position between the initial and the final distribution is set to zero as the initial population represents an unweighted sample from p 0 all weights are set to 1 n at each iteration the algorithm calculates the particle weights and then searches for a new value β based on an informal measure of particle diversity the effective sample size n eff 2 n eff 1 i 1 n w i 2 where w i are the normalized weights of the n particles and takes values between 1 when all the weight is concentrated on a single particle and n when all particles have equal weight the algorithm will determine the value of β for which the effective sample size n eff equals a fraction a of the current n eff one can think of this choice as a trade off between stability large effective sample size and efficiency large β steps to minimize the number of filtering steps next a resample move step is made the particles are first resampled using systematic resampling see douc and cappe 2005 and all weights are reset to 1 n next the particles are mutated by an mcmc step based on differential evolution and snooker update ter braak 2006 ter braak and vrugt 2008 for each particle x i two particles x j and x k are randomly sampled with i j k the proposal x i is obtained as follows 3 x i x i γ x j x k ε where γ is a scaling factor typically set to 2 38 2 d ter braak 2006 with d being the number of parameters under calibration and ε is drawn from a narrow distribution n 0 b with a default of b 10 4 in 10 of the cases randomly selected a snooker update is performed instead following ter braak and vrugt 2008 as b implies a particular scale for the parameters b should be either adjusted to the prior or expected posterior parameter uncertainty or parameters should be scaled accordingly when β reaches 1 meaning that the full data is used a last resampling step is performed step 5 so that the particles can be considered an unweighted sample from π θ y as this sample likely contains many identical particles a final round of mutation steps step 6 are executed to increase sample diversity during the search for β step 4a some weights may take infinite values due to p x i x i ratios exceeding the numeric accuracy of the computer in this case omitted from the listing in fig 2 a resample move step is executed and the current value for β is kept for the next iteration this is a failsafe to keep the sampler from crashing due to numerical issues the output of an exemplary smc simulation is displayed on fig 2b the emerging series of β values reveals that small changes between intermediary distributions are necessary at the beginning to avoid sample impoverishment and while β increases these changes become larger as the smc progresses the acceptance rate of the mcmc steps averaged over all s mcmc steps at each iteration fluctuates between 6 and 9 in this example the distance d s a measure of dissimilarity to the true posterior is defined below 2 4 benchmarking the smc against a state of the art mcmc we benchmarked the performance of the smc algorithm in four calibration case studies of increasing complexity against a differential evolution mcmc with snooker update dezs ter braak and vrugt 2008 which is a state of the art mcmc algorithm as performance measure we calculated the similarity between smc or mcmc samples to a reference distribution using the following metric d s proposed by laloy and vrugt 2012 4 d s 1 2 d i 1 d μ i 1 μ i 2 σ i 1 2 σ i 1 σ i 2 σ i 1 2 where μ i x and σ i x x 1 2 are the mean and standard deviation of the marginal distribution of each parameter in the reference sample x 1 and the sample being evaluated x 2 and d is the number of parameters essentially d s expresses the average normalized euclidean distance between the means and standard deviations of both distributions as reference distribution we used the analytical posterior when it was available and otherwise an extremely long independent dezs run as case studies for the benchmark we selected a multivariate normal distribution a simple ecosystem model and a state of the art forest growth model as shown in table 1 these case studies differ greatly in model complexity the first example is a simple three dimensional multi variate normal distribution with a strong correlation r 0 9 the second case study consisted of calibrating the very simple ecosystem model vsem a simple ecosystem model serving as benchmark in r s bayesiantools package two configurations were tested with vsem in one case we included two parameters in the calibration for which the posterior was strongly correlated r 0 95 whereas in the second case there were no strong posterior correlations between parameters the third case study used the model 3 pgn minunno et al 2018 a recent extension of the forest growth model 3 pg landsberg and waring 1997 with 51 parameters 3 pgn is substantially more complex than the vsem model but due to its monthly time step the model still executes very fast table 1 to emulate the calibration of a computationally more expensive model a fourth case study 3 pgnsleep was set up in which the execution time of 3 pgn was increased by adding a pause of 50 ms after each model execution all other settings are identical in case of the multivariate distribution the distribution itself was the calibration target for the dynamic models we simulated synthetic data from the model s default parameters and added a normally distributed observation error on top and specified a likelihood from these assumptions including parameters for the error terms 1 for vsem and 2 for 3 pgn because two outputs were used for calibration in the latter case for all models we used wide uniform uninformative priors as min max values for the priors we chose 5 5 for the multivariate normal distribution and for the vsem 3 pgn model we chose the min max values for calibration provided by the model developers see supplementary material for details to explore how the smc s control parameters influence the sampler s efficiency we ran all case studies in a full factorial design varying the values of the control parameters table 2 resulting in 240 alternative smc configurations an exception is the multivariate normal case where n was set to 50 100 and 1000 particles yielding 180 algorithm configurations that we tested for each model the experiment was repeated five times with different random seeds to assess convergence of the algorithm and variations in runtime and sample quality convergence was assessed using the gelman rubin diagnostic r brooks and gelman 1998 gelman and rubin 1992 it was assumed that convergence is reached when no univariate r for point estimates and upper confidence interval is greater than 1 05 and the multivariate r estimate brooks and gelman 1998 is less than 1 2 the mcmc dezs algorithm used as a benchmark requires several chains to be run independently from each other based on the results of ter braak and vrugt 2008 the number of chains was set to 3 convergence was assessed by estimating r over the 3 chains of a run with the same criteria as for the smc runs the number of iterations given in table 1 was selected to ensure convergence of the reference run because each single mcmc iteration depends on the previous iteration mcmcs iterations can in general not be computed in parallel however for the mcmc dezs each mcmc iteration requires several model evaluations to calculate the posterior values for the in our case three internal de chains these internal computations will make the algorithm somewhat faster at maximum by a factor 3 unless the model evaluates very fast in this case parallelization overhead will offset parallelization gains for all case studies we tried both options parallel and sequential selected the faster option for the benchmark table 1 in general we note that although the mcmc dezs offers some options for parallelization these are very limited because only a small number of computer cores can sensibly be used in parallel with this algorithm smcs however scale practically linearly with the number of cores up to a large number of cores see our later results fig 4 which is one of their core advantages over mcmcs 2 5 effect of parallelization all the experiments described above were executed on the same computer cluster nemo at the university of freiburg technical specifications see supplementary material each node on this cluster consists of 20 cores for the smc experiments 40 cores were used spanning no more than 2 different nodes to assess the effect of parallelization on runtime further tests were run on a varying number of cores 1 2 5 10 20 and 40 cores in these tests the smc parameters were set to n 50 000 a 0 9 s 30 and γ 0 1 for each of these settings 3 pgn was run without artificial runtime increase as well as with a runtime increase of 20 and 50 ms each combination was executed five times to account for potential variations in execution time 3 results 3 1 quality and efficiency for the multivariate normal case fig s1 in the supplementary material mcmc runs converged after 22 8 s on average and achieved a d s score of 0 0018 83 out of 180 smc runs reached convergence and the lowest d s score is 0 028 execution time for the converging smc runs ranged between 0 35 and 36 32 s smc runs were more likely to reach convergence with a greater number of particles and mutation steps the results for the more complex models are summarized in fig 3 for the mcmc the distance from the reference run was monitored every 1000 iterations of the algorithm the blue area indicates the spread of the five mcmc runs for smc only converged runs are shown on the graph smc runs located below the shaded area compare favorably to the mcmc algorithm i e the same sample quality can be achieved in less time in both vsem examples the mcmc sampler quickly reached a state close to the reference d s 0 01 most of the smc runs converged according to the gelman rubin criterion 180 and 166 out of 240 for the cases with and without strong correlation respectively although the sample quality as expressed by d s varied greatly none of the smc runs are located below the mcmc curves meaning that they did not outperform the mcmc the plot shows a strong dependency of sample quality on the scaling factor of the mcmc proposals γ the higher the value for γ the better the sample quality interestingly more particles by themselves did not translate into better performance for the 3 pgn benchmark the mcmc sampler reached levels of d s as low as 0 04 of the 240 smc runs 32 reached convergence all those that did had a at least 10 mutation steps s and for most the value of γ was either 0 1 or 0 333 some of the smc runs were located at the same level as the mcmc curves indicating a similar efficiency sample quality generally increased d s decreased with increasing s at the expense of additional runtime increasing the number of particles n generally had a positive effect on the performance of the algorithm but this effect was often small runtime in contrast increases greatly with n for the three runs with a 0 9 γ 0 1 and s 30 for example d s only improved marginally with n whereas runtime was six times higher for n 100 000 than for n 20 000 the ranking of the different smc settings stayed qualitatively similar for the benchmarks with 3 pgnsleep compared to 3 pgn which is unsurprising given that the two models are functionally identical and differ only in their runtime in this case 29 of the smc settings achieved convergence small differences between the ranking of different settings for 3 pgnsleep and 3 pgn are likely due to the inherent stochasticity of the sampler for the 3 pgnsleep model all converged smc runs were at the same level or below the mcmc curves indicating that the smc sampler was typically more efficient than the mcmc sampler for this model 3 2 effect of parallelization to better understand the trade off between communication overhead i e the computation time lost during parallelization due to the necessary communication between cores and speed up due to parallelization we performed smc simulations with models of different runtime across a range of used cpu cores and regressed the relationship between runtime and cores with a linear regression on the log log scale fig 4 for the standard 3 pgn model runtime approx 1 ms parallelization could reduce the total smc runtime maximally by a factor 3 when using 10 cores instead of running the algorithm serially fig 4 left runtime increased with less than linearly with the number of cores log log slope estimate 0 5 and adding more cores beyond 10 did not increase a further speed up scaling was much better for the calibrations of the identical 3 pgn model which was modified to include a pause of 20 and 50 ms after model execution fig 4 middle right the log log slope estimates were 0 88 and 0 94 suggesting that the scaling would likely approach the ideal value of 1 i e a runtime 1 cores scaling for even slower models a detailed regression table with slope estimates is provided in the supplementary material fig s2 4 discussion and conclusions the purpose of this paper was to provide an introduction into smc sampling for the calibration of complex environmental models to explore which smc settings work well for complex dynamic model and to assess the potential runtime reduction through parallelization for smc algorithms compared to mcmc methods our main findings are that smc samplers are efficient algorithms for model calibration that can outperform mcmcs for runtime intensive models when at least a moderate number of parallel computer cores in the order of some 10 cores is available to the user see figs 3 4 a possible drawback of smcs is that convergence and sampling efficiency depended strongly on the tuning parameters of the algorithm for the best settings of the tuning parameters we could achieve relatively reliable convergence but badly tuned algorithms often showed particle degeneracy and other problems once these phenomena occur it is difficult for the algorithm to recover unlike for an mcmc which can always be run longer even if it mixes badly it is therefore vital that smc algorithms are correctly tuned from the start assuming that the results from our test cases can be extrapolated to other ecological models we would conclude that a large number of particles is less important than a sufficient number of intermediate mcmc steps to achieve favorable convergence behavior the smc settings that were most efficient in our simulations effectively prescribe an algorithm that consists of a mix between mcmc and smc steps we conjecture that such mixed algorithms may be an interesting direction for future research the values for the tuning parameter γ scaling factor for the de mcmc steps during mutation that led to greatest sampling efficiency were close to the optimal value for normal distributions in standard mcmc tuning γ 2 38 d 1 2 0 9 for vsem and 0 3 for 3 pg suggesting that many of the lessons learned from mcmc tuning can be taken over to the mutation steps in an smc given the apparent importance of the mutation steps it seems obvious that further research should be directed towards optimizing this part of the algorithm a particularly promising idea seems to us to examine adaptive procedures to determine the number of mcmc steps as suggested by fearnhead and taylor 2013 whether smc calibration can outperform mcmc calibration depends primarily on the trade off between communication overhead and parallelizability fig 4 in the case of the standard 3 pgn model without artificial runtime increase the fastest smc configurations came close to but did not beat the time taken by the mcmc dezs algorithm to reach the same sample quality expressed as d s 1700s cf fig 3 by contrast for the 3 pgn with a 50 ms pause executing the smc sampler with 5 or more cores took less time than using mcmc dezs for the same sample quality communication overhead is also the reason why we used the possible parallelization option for the dezs mcmc algorithm in the bayesiantoools r package which would have allowed using 3 cpu cores only for the 3 pgnsleep scenario for all faster models running the mcmc without parallelization was faster due to communication overhead given that we parallelized on a setup that has in our experience a comparatively low communication overhead we conclude that a model runtime of around 20 ms 50 ms is needed to make the use of an smc worthwhile when parallelizing across more cluster nodes or in a distributed system communication overhead will likely be larger and models should therefore likely be even slower until the advantages of parallelization are offset by their costs given that many ecological and environmental models have runtimes of minutes or even hours however this does not appear to pose a major limitation for the applicability of smc algorithms to model calibration our results are less favorable for smcs than those of jeremiah et al 2011 which we attribute to the fact that we benchmark against a state of the art mcmc algorithm rather than against a metropolis hastings mcmc although we anticipate that our results are fairly representative in that smc will eventually outperform mcmc regarding given sufficient parallel resources it would be interesting to run further tests varying both the models and parameters under calibration as well as the algorithm settings in particular our results that favor a balanced mix of smc and mcmc steps points towards exploring more aggressive design principles that mix smc and mcmc ideas e g zhu et al 2018 another issue that seems to require urgent attention are robust adaptation procedures that would for example automatically select the smc settings that we identified as most efficient in fig 3 and reliable convergence checks that monitor and report potential issues during an smc run while there is some development in this direction for example our automatic adaptation of the β steps we find that smcs lack in this respect compared to state of the art mcmc algorithms such as the dezs which is completely self adaptive under mildly beneficial circumstances although we do provide the posterior parameter estimates in the code repository see section data accessibility we stress that the purpose of this study was not to test the ecological plausibility of the fitted models or the identifiability of their parameters with real data for an ecologically interpretable calibration of 3 pgn with real forest data see for example trotsiuk et al 2020 moreover the use of synthetic data circumvented possible problems that can arise when calibrating models with structural error e g oberpriller et al 2021 such problems can potentially increase or decrease convergence speed of mcmcs or smcs in practical applications as we only compare across mcmc and smcs with different settings in a fixed scenario however we do not see this as a potential limitation for our results 5 conclusions in conclusion our paper demonstrates that smc algorithms should be considered as an alternative to mcmc samplers by modelers who want to calibrate slow models and have access to appropriate parallel computing hardware for slow models communication overhead due to parallel computing becomes negligible and smcs can draw on the opportunity provided by their superior parallelizability our results also suggest that smcs with a large share of internal mcmc steps work best possibly supporting a broader insight that a mix of both design principles as it is already done to a lesser degree in population based mcmc algorithms where several mcmc chains are run in parallel such as the dezs mcmc that we used as a reference might actually be the most successful strategy for calibrating complex models on modern computer hardware our study also highlighted various opportunities for further research in particular with regard to further development of robust adaptive methods for tuning smc parameters and the need to develop better tools for monitoring efficiency and convergence issues in smcs data accessibility the smc algorithm presented in this paper is based on the bayesiantools r package which is available on cran hartig et al 2019 the bayesiantools package is a framework for bayesian inference that includes a several mcmc samplers as well as plots and diagnostic functions for bayesian computations the bayesiantools vignette available via https cran r project org web packages bayesiantools vignettes bayesiantools html explains in detail how to specify likelihoods and prior in the format that is expected by the package installation instructions and code for reproducing the results of this paper are available at https github com florianhartig bayesiantools tree master publications speichetal smcformodelcalibration credit authorship contribution statement matthias speich methodology software formal analysis project administration writing original draft carsten f dormann conceptualization writing review editing florian hartig conceptualization methodology project administration writing review editing declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments we gratefully acknowledge support by the dfg dor 786 8 1 as part of the priority program 1374 infrastructure biodiversity exploratories johannes oberpriller provided helpful comments on the presentation of the manuscript we are grateful to the comments and suggestions by two anonymous reviewers supplementary materials supplementary material associated with this article can be found in the online version at doi 10 1016 j ecolmodel 2021 109608 appendix supplementary materials image application 1 
24590,bayesian inference has become an important framework for calibrating complex ecological and environmental models markov chain monte carlo mcmc algorithms are the methodological backbone of this framework but they are not easily parallelizable and can thus not make optimal use of modern computer architectures a possible solution is the use of sequential monte carlo smc algorithms currently smcs are used mainly for bayesian state updating for example in weather forecasting and are thought to be less efficient for parameter calibration than mcmcs unlike mcmcs however smcs are easily parallelizable thus smcs may become an interesting alternative when modelers have access to parallel computing environments the purpose of this paper is to provide an introduction to smc algorithms for bayesian model calibration and to explore the trade off between efficiency and parallelizability for mcmc and smc algorithms to that end we discuss different smc variants and benchmark them against a state of the art mcmc algorithm by calibrating three ecological models of increasing complexity our results show that with appropriately chosen settings smcs can be faster than state of the art mcmc algorithms when a sufficiently large number of parallel cores are available and when the model runtime is large compared to communication overhead for parallelization on our hardware a model runtime of 20 ms was enough to favor smc algorithms efficient smc settings were characterized by a balanced mix of smc filtering and mcmc mutation steps suggesting that mixing mcmc and smc principles may be ideal for creating efficient and parallelizable calibration algorithms the algorithms used in this study are provided within the bayesiantools r package for bayesian inference with complex ecological models keywords bayesian inference sequential monte carlo smc mechanistic models model calibration particle filters equifinality 1 introduction many research communities within ecology and environmental sciences traditionally rely strongly on complex process based system models e g global circulation models gcms global dynamic vegetation models g dvms or hydrological models see jeffers 1982 other ecological fields have recently moved in the direction of mechanistic modeling approaches for models of biodiversity change e g urban et al 2016 or models of biogeography or macroevolutionary processes pontarp et al 2019 through this increasing use complex process based models in particular for forecasting e g dietze 2017 the question of how to choose model parameters and determine their uncertainties has become more prominent historically parameters for complex process based models were often chosen ad hoc either by direct measurements or by literature reviews without formal model calibrations cf hartig et al 2012 dietze 2017 with sufficient computing power however process based models can be fit in very much the same way as statistical models and standard statistical procedures such as residual checks model comparison or model averaging can be performed on top of the fitted model e g van oijen et al 2005 schoups and vrugt 2010 a practical difference to statistical models however is that process based models tend to be more nonlinear and connected which together with data limitations results in frequent occurrences of multiple optima or trade offs between parameters non identifiability or equifinality equifinality means that there is no unique optimal parameter set but that many combinations of parameters fit the observations equally well see beven and freer 2001 moreover unlike for statistical models parameters in mechanistic models have a clear meaning and researchers often have prior expectations about their likely value optimization approaches often perform poorly for such nonlinear equifinal problems and frequentist statistical approaches such as maximum likelihood estimation struggle to provide a framework for considering prior information about ecologically plausible parameter values in the calibration procedure for all these reasons bayesian approaches have risen in popularity for calibrating complex process based models in recent years for example to model vegetation dynamics van oijen et al 2005 lagarrigues et al 2015 hydrological processes beven and freer 2001 jeremiah et al 2012 2011 zhu et al 2018 or biogeochemical processes arhonditsis et al 2008 ahrens et al 2014 the aim of the bayesian calibration procedure is to calculate the posterior uncertainty p θ y for the model parameters the posterior is interpreted as the probability density for a given parameter set θ to be correct conditional on the observed data y and our prior beliefs p θ the latter representing our knowledge about the likely parameter values beyond the calibration data the ability to include prior information in a bayesian calibration provides a framework to build upon pre existing knowledge on the values of parameters conversely where there is little empirical basis for constraining the values of a certain parameter this can be accounted for by setting a wide prior distribution the posterior is proportional to the product of the prior distribution p θ representing our best knowledge about parameter values before model calibration and the likelihood function p y θ the probability of observing the data y given the model with parameters θ informally one can view the likelihood as the goodness of fit of the model with parameters θ and the bayesian posterior as a mix between prior information and the information provided by the data through the likelihood because the bayesian framework does not search for an optimal parameter combination but only updates the prior uncertainty by the new data there is no lower limit of how many data are needed for calculating a posterior estimate nor pose multiple optima or equifinality a fundamental problem for a valid posterior estimate for a more thorough description of the typical bayesian calibration process we refer to van oijen et al 2005 or hartig et al 2012 a practical challenge for using bayesian inference is that the posterior can usually not be calculated analytically and must therefore be approximated numerically which is often computationally demanding the current standard solution to this problem are markov chain monte carlo mcmc methods see andrieu et al 2003 for an overview very briefly the idea of an mcmc is to specify a stochastic markov process that performs a random walk in parameter space the markov process is chosen such that the probability of visiting each parameter combination is proportional to its posterior density p θ y the simplest algorithm of this kind is the so called metropolis hastings mcmc many mcmc variants have been proposed to increase the efficiency this algorithm for example through dynamically adapting the transition process haario et al 2006 or combining principles of mcmc with evolutionary algorithms ter braak and vrugt 2008 those variants have improved sampling efficiency i e the number of iterations needed to get a good estimate of the posterior but they all still require a substantial number of model evaluations to fit a complex model often in the range of 106 108 which can make calibrations of complex models a matter of weeks or even months more recent mcmc algorithms run several markov chains concurrently e g ter braak and vrugt 2008 vrugt et al 2009 but because all mcmcs principally evaluate a new parameter proposal relative a current parameter set calculations can be parallelized only to a very limited degree this lack of mcmc parallelizability currently limits the use of bayesian inference for calibrating models with a runtime of minutes or longer and poses a serious problem for the wider adoptation of bayesian inference in the ecological modeling community outside the context of model calibration a widely used alternative to mcmc sampling are sequential monte carlo smc algorithms see del moral et al 2006 for an extensive treatment of the mathematical aspects of smc and speekenbrink 2016 for an introduction the idea of an smc is to generate a usually large e g 103 population of parameter sets termed particles which are then iteratively filtered according to their fit to the data in a way that the final particle population approximates p θ y the main use of smc methods are situations where it is advantageous to use data iteratively for example in state space models or when data becomes available in real time as in weather forecasting doucet and johansen 2009 speekenbrink 2016 however smcs can also be used to estimate parameters for statistical fan et al 2008 dufays 2016 and dynamic models jeremiah et al 2012 2011 sisson et al 2007 zhu et al 2018 the attractive property of doing so is that unlike mcmcs this process can be parallelized making it potentially suitable for calibrating complex time consuming models the downside of replacing mcmcs with smcs is that the latter tend to be less efficient for a single model calibration than an mcmc and require careful tuning to avoid sample degeneracy and impoverishment detailed in the methods below moreover the markovian nature of mcmcs integrates information from past model evaluations faster into the algorithm s exploration of the parameter space although many methods exist to reduce the risk of these problems jasra et al 2011 jeremiah et al 2012 li et al 2014 those are not guaranteed to prevent their occurrence and smcs have therefore rarely been used for model calibration whether this neglect of smcs is justified however is an open question in particular when considering that modern computer hardware is moving towards parallel architectures that cannot be efficiently used by mcmcs so far there have been few serious attempts to benchmark the two approaches against each other an exception is jeremiah et al 2011 who found in a direct comparison between an smc and an mcmc sampler that smc was less likely to be trapped in local optima leading to greater sample robustness however the adaptive metropolis mcmc haario et al 2001 used in that study is known for its inferior performance in the presence of multiple optima compared to more advanced mcmc algorithms e g haario et al 2006 ter braak and vrugt 2008 overall the relative performance of smc and mcmc samplers is therefore still somewhat unresolved a key question so far not systematically investigated is whether the parallelizability of smc samplers could offset possible disadvantages regarding efficiency in practical situations here we address these issues by first giving an overview of the design principles and flavors of smc algorithms identifying the most promising smc variants for parameter calibration we then implement an smc algorithm with the possibility to modify various smc tuning parameters and variants and evaluate their ability to calibrate three models of increasing complexity against a state of the art mcmc sampler as a benchmark the considered models were a multivariate normal distribution a simple dynamic vegetation model and a state of the art forest growth model we assessed the approximation error of the multivariate posterior distribution against the time used by the algorithm 2 methods 2 1 a primer to smc sampling sequential monte carlo smc is a generic term for a range of algorithms based on similar principles smcs also known as particle filters are always initialized by generating a population of n particles each particle corresponding to a possible parameter set typically drawn from some initial distribution the smc will now filter these particles in a way that the final distribution of particles approximates the posterior distribution this filtering typically consists of three steps weighting resampling and mutation illustrated on fig 1 a which are iteratively applied while data is added at each iteration weighting means that each particle is assigned a weight usually proportional to its likelihood i e fit to the data in the next step the particles are resampled with replacement with their sampling probability given by their normalized weights this means that particles with low weights bad fit tend to be discarded whereas particles with high weights good fit are more likely to be replicated the purpose of this step is preventing the issue of particle or sample degeneracy li et al 2014 i e the concentration of weights on a small number of particles finally to avoid having identical particles a mutation step is performed where particles are slightly moved in parameter space based on a defined transition rule this alleviates the risk of sample impoverishment li et al 2014 i e the situation where nearly all particles have identical parameter values the typical use case for smc algorithms are iterative filtering problems fig 1b for example for estimating time varying model states such as the location of a tracked object djuric et al 2003 or soil moisture moradkhani et al 2005 vrugt et al 2013 they may also be used to update model parameter values if new observations become available in real time fig 1c for an example see e g speekenbrink 2016 however smcs can also be used to fit static model parameters fig 1d which is our interest in this study 2 2 using smc algorithms for model calibration as explained above the principle of an smc is to iteratively filter a population of particles regarding their fit to new information unlike in traditional smc applications fig 1b c data in a model calibration do not have a natural time order or appear iteratively one could still establish an iterative filtering by adding the data step wise to the smc but a more flexible approach is to use all data at once and instead increase the weight of the data step wise during the smc iterations technically this is done by creating a sequence of intermediary distributions moving gradually from an initial distribution π 0 to the posterior distribution in a so called bridge approach neal 2001 fan et al 2008 in the few instances where smc was applied to model calibration e g fan et al 2008 jeremiah et al 2012 2011 zhu et al 2018 this approach was always used in practice the initial distribution π 0 is usually the prior although any distribution can be chosen in principle the intermediate distributions π n are then defined as 1 π n π 0 θ 1 β n π θ y β n where the sequence of parameters β n defined so that 0 β 1 β 2 β n 1 controls the mix between the initial distribution and the final posterior based on all data when choosing a sequence β n a trade off exists between stability avoiding particle degeneracy and efficiency speed if the difference between the intermediate distributions is too great filtering will be too aggressive leading to particle degeneracy jeremiah et al 2011 if the difference is too narrow the algorithm will perform more iterations than necessary to solve this trade off jeremiah et al 2012 proposed an adaptive approach starting with a pre defined series β n and decreasing the spacing if the algorithm is at risk of becoming unstable mutating the particles after resampling is crucial for the efficiency of smc samplers zhu et al 2018 for smcs designed for parameter calibration some variation of the metropolis algorithm metropolis et al 1953 is typically used which also forms the basis of many mcmc samplers the principle of the metropolis move is that a new parameter value is generated based on the current one according to some proposal function the probability to accept the move is given by the metropolis ratio the ratio of p θ y for the proposed over the current parameters in an smc mutation step this procedure is applied to each particle possibly multiple times per iteration indeed the number of mcmc mutation steps per smc iteration has been shown to have a substantial effect on sampler efficiency fearnhead and taylor 2013 the simplest metropolis mcmcs use pre defined univariate normal distributions as proposal distributions many of the improvements over this simple choice in the context of mcmc e g haario et al 2006 ter braak and vrugt 2008 have also been applied within smc samplers for example the covariance structure of a multivariate proposal distribution can be updated at each iteration based on the covariance matrix of the particles chopin 2002 fan et al 2008 jeremiah et al 2012 another example is zhu et al 2018 who use a combination of genetic and evolutionary algorithms to generate proposals leading to a considerable increase in sampler efficiency 2 3 description of the smc algorithm used in this study the algorithm proposed in this study fig 2 a was based on the lessons drawn from our literature review regarding efficient smc implementations for model calibration it uses an adaptive scheme to determine the series of intermediate distributions following jasra et al 2011 the sampler is initialized by drawing n particles from an initial distribution π 0 the initial exponent β which controls the position between the initial and the final distribution is set to zero as the initial population represents an unweighted sample from p 0 all weights are set to 1 n at each iteration the algorithm calculates the particle weights and then searches for a new value β based on an informal measure of particle diversity the effective sample size n eff 2 n eff 1 i 1 n w i 2 where w i are the normalized weights of the n particles and takes values between 1 when all the weight is concentrated on a single particle and n when all particles have equal weight the algorithm will determine the value of β for which the effective sample size n eff equals a fraction a of the current n eff one can think of this choice as a trade off between stability large effective sample size and efficiency large β steps to minimize the number of filtering steps next a resample move step is made the particles are first resampled using systematic resampling see douc and cappe 2005 and all weights are reset to 1 n next the particles are mutated by an mcmc step based on differential evolution and snooker update ter braak 2006 ter braak and vrugt 2008 for each particle x i two particles x j and x k are randomly sampled with i j k the proposal x i is obtained as follows 3 x i x i γ x j x k ε where γ is a scaling factor typically set to 2 38 2 d ter braak 2006 with d being the number of parameters under calibration and ε is drawn from a narrow distribution n 0 b with a default of b 10 4 in 10 of the cases randomly selected a snooker update is performed instead following ter braak and vrugt 2008 as b implies a particular scale for the parameters b should be either adjusted to the prior or expected posterior parameter uncertainty or parameters should be scaled accordingly when β reaches 1 meaning that the full data is used a last resampling step is performed step 5 so that the particles can be considered an unweighted sample from π θ y as this sample likely contains many identical particles a final round of mutation steps step 6 are executed to increase sample diversity during the search for β step 4a some weights may take infinite values due to p x i x i ratios exceeding the numeric accuracy of the computer in this case omitted from the listing in fig 2 a resample move step is executed and the current value for β is kept for the next iteration this is a failsafe to keep the sampler from crashing due to numerical issues the output of an exemplary smc simulation is displayed on fig 2b the emerging series of β values reveals that small changes between intermediary distributions are necessary at the beginning to avoid sample impoverishment and while β increases these changes become larger as the smc progresses the acceptance rate of the mcmc steps averaged over all s mcmc steps at each iteration fluctuates between 6 and 9 in this example the distance d s a measure of dissimilarity to the true posterior is defined below 2 4 benchmarking the smc against a state of the art mcmc we benchmarked the performance of the smc algorithm in four calibration case studies of increasing complexity against a differential evolution mcmc with snooker update dezs ter braak and vrugt 2008 which is a state of the art mcmc algorithm as performance measure we calculated the similarity between smc or mcmc samples to a reference distribution using the following metric d s proposed by laloy and vrugt 2012 4 d s 1 2 d i 1 d μ i 1 μ i 2 σ i 1 2 σ i 1 σ i 2 σ i 1 2 where μ i x and σ i x x 1 2 are the mean and standard deviation of the marginal distribution of each parameter in the reference sample x 1 and the sample being evaluated x 2 and d is the number of parameters essentially d s expresses the average normalized euclidean distance between the means and standard deviations of both distributions as reference distribution we used the analytical posterior when it was available and otherwise an extremely long independent dezs run as case studies for the benchmark we selected a multivariate normal distribution a simple ecosystem model and a state of the art forest growth model as shown in table 1 these case studies differ greatly in model complexity the first example is a simple three dimensional multi variate normal distribution with a strong correlation r 0 9 the second case study consisted of calibrating the very simple ecosystem model vsem a simple ecosystem model serving as benchmark in r s bayesiantools package two configurations were tested with vsem in one case we included two parameters in the calibration for which the posterior was strongly correlated r 0 95 whereas in the second case there were no strong posterior correlations between parameters the third case study used the model 3 pgn minunno et al 2018 a recent extension of the forest growth model 3 pg landsberg and waring 1997 with 51 parameters 3 pgn is substantially more complex than the vsem model but due to its monthly time step the model still executes very fast table 1 to emulate the calibration of a computationally more expensive model a fourth case study 3 pgnsleep was set up in which the execution time of 3 pgn was increased by adding a pause of 50 ms after each model execution all other settings are identical in case of the multivariate distribution the distribution itself was the calibration target for the dynamic models we simulated synthetic data from the model s default parameters and added a normally distributed observation error on top and specified a likelihood from these assumptions including parameters for the error terms 1 for vsem and 2 for 3 pgn because two outputs were used for calibration in the latter case for all models we used wide uniform uninformative priors as min max values for the priors we chose 5 5 for the multivariate normal distribution and for the vsem 3 pgn model we chose the min max values for calibration provided by the model developers see supplementary material for details to explore how the smc s control parameters influence the sampler s efficiency we ran all case studies in a full factorial design varying the values of the control parameters table 2 resulting in 240 alternative smc configurations an exception is the multivariate normal case where n was set to 50 100 and 1000 particles yielding 180 algorithm configurations that we tested for each model the experiment was repeated five times with different random seeds to assess convergence of the algorithm and variations in runtime and sample quality convergence was assessed using the gelman rubin diagnostic r brooks and gelman 1998 gelman and rubin 1992 it was assumed that convergence is reached when no univariate r for point estimates and upper confidence interval is greater than 1 05 and the multivariate r estimate brooks and gelman 1998 is less than 1 2 the mcmc dezs algorithm used as a benchmark requires several chains to be run independently from each other based on the results of ter braak and vrugt 2008 the number of chains was set to 3 convergence was assessed by estimating r over the 3 chains of a run with the same criteria as for the smc runs the number of iterations given in table 1 was selected to ensure convergence of the reference run because each single mcmc iteration depends on the previous iteration mcmcs iterations can in general not be computed in parallel however for the mcmc dezs each mcmc iteration requires several model evaluations to calculate the posterior values for the in our case three internal de chains these internal computations will make the algorithm somewhat faster at maximum by a factor 3 unless the model evaluates very fast in this case parallelization overhead will offset parallelization gains for all case studies we tried both options parallel and sequential selected the faster option for the benchmark table 1 in general we note that although the mcmc dezs offers some options for parallelization these are very limited because only a small number of computer cores can sensibly be used in parallel with this algorithm smcs however scale practically linearly with the number of cores up to a large number of cores see our later results fig 4 which is one of their core advantages over mcmcs 2 5 effect of parallelization all the experiments described above were executed on the same computer cluster nemo at the university of freiburg technical specifications see supplementary material each node on this cluster consists of 20 cores for the smc experiments 40 cores were used spanning no more than 2 different nodes to assess the effect of parallelization on runtime further tests were run on a varying number of cores 1 2 5 10 20 and 40 cores in these tests the smc parameters were set to n 50 000 a 0 9 s 30 and γ 0 1 for each of these settings 3 pgn was run without artificial runtime increase as well as with a runtime increase of 20 and 50 ms each combination was executed five times to account for potential variations in execution time 3 results 3 1 quality and efficiency for the multivariate normal case fig s1 in the supplementary material mcmc runs converged after 22 8 s on average and achieved a d s score of 0 0018 83 out of 180 smc runs reached convergence and the lowest d s score is 0 028 execution time for the converging smc runs ranged between 0 35 and 36 32 s smc runs were more likely to reach convergence with a greater number of particles and mutation steps the results for the more complex models are summarized in fig 3 for the mcmc the distance from the reference run was monitored every 1000 iterations of the algorithm the blue area indicates the spread of the five mcmc runs for smc only converged runs are shown on the graph smc runs located below the shaded area compare favorably to the mcmc algorithm i e the same sample quality can be achieved in less time in both vsem examples the mcmc sampler quickly reached a state close to the reference d s 0 01 most of the smc runs converged according to the gelman rubin criterion 180 and 166 out of 240 for the cases with and without strong correlation respectively although the sample quality as expressed by d s varied greatly none of the smc runs are located below the mcmc curves meaning that they did not outperform the mcmc the plot shows a strong dependency of sample quality on the scaling factor of the mcmc proposals γ the higher the value for γ the better the sample quality interestingly more particles by themselves did not translate into better performance for the 3 pgn benchmark the mcmc sampler reached levels of d s as low as 0 04 of the 240 smc runs 32 reached convergence all those that did had a at least 10 mutation steps s and for most the value of γ was either 0 1 or 0 333 some of the smc runs were located at the same level as the mcmc curves indicating a similar efficiency sample quality generally increased d s decreased with increasing s at the expense of additional runtime increasing the number of particles n generally had a positive effect on the performance of the algorithm but this effect was often small runtime in contrast increases greatly with n for the three runs with a 0 9 γ 0 1 and s 30 for example d s only improved marginally with n whereas runtime was six times higher for n 100 000 than for n 20 000 the ranking of the different smc settings stayed qualitatively similar for the benchmarks with 3 pgnsleep compared to 3 pgn which is unsurprising given that the two models are functionally identical and differ only in their runtime in this case 29 of the smc settings achieved convergence small differences between the ranking of different settings for 3 pgnsleep and 3 pgn are likely due to the inherent stochasticity of the sampler for the 3 pgnsleep model all converged smc runs were at the same level or below the mcmc curves indicating that the smc sampler was typically more efficient than the mcmc sampler for this model 3 2 effect of parallelization to better understand the trade off between communication overhead i e the computation time lost during parallelization due to the necessary communication between cores and speed up due to parallelization we performed smc simulations with models of different runtime across a range of used cpu cores and regressed the relationship between runtime and cores with a linear regression on the log log scale fig 4 for the standard 3 pgn model runtime approx 1 ms parallelization could reduce the total smc runtime maximally by a factor 3 when using 10 cores instead of running the algorithm serially fig 4 left runtime increased with less than linearly with the number of cores log log slope estimate 0 5 and adding more cores beyond 10 did not increase a further speed up scaling was much better for the calibrations of the identical 3 pgn model which was modified to include a pause of 20 and 50 ms after model execution fig 4 middle right the log log slope estimates were 0 88 and 0 94 suggesting that the scaling would likely approach the ideal value of 1 i e a runtime 1 cores scaling for even slower models a detailed regression table with slope estimates is provided in the supplementary material fig s2 4 discussion and conclusions the purpose of this paper was to provide an introduction into smc sampling for the calibration of complex environmental models to explore which smc settings work well for complex dynamic model and to assess the potential runtime reduction through parallelization for smc algorithms compared to mcmc methods our main findings are that smc samplers are efficient algorithms for model calibration that can outperform mcmcs for runtime intensive models when at least a moderate number of parallel computer cores in the order of some 10 cores is available to the user see figs 3 4 a possible drawback of smcs is that convergence and sampling efficiency depended strongly on the tuning parameters of the algorithm for the best settings of the tuning parameters we could achieve relatively reliable convergence but badly tuned algorithms often showed particle degeneracy and other problems once these phenomena occur it is difficult for the algorithm to recover unlike for an mcmc which can always be run longer even if it mixes badly it is therefore vital that smc algorithms are correctly tuned from the start assuming that the results from our test cases can be extrapolated to other ecological models we would conclude that a large number of particles is less important than a sufficient number of intermediate mcmc steps to achieve favorable convergence behavior the smc settings that were most efficient in our simulations effectively prescribe an algorithm that consists of a mix between mcmc and smc steps we conjecture that such mixed algorithms may be an interesting direction for future research the values for the tuning parameter γ scaling factor for the de mcmc steps during mutation that led to greatest sampling efficiency were close to the optimal value for normal distributions in standard mcmc tuning γ 2 38 d 1 2 0 9 for vsem and 0 3 for 3 pg suggesting that many of the lessons learned from mcmc tuning can be taken over to the mutation steps in an smc given the apparent importance of the mutation steps it seems obvious that further research should be directed towards optimizing this part of the algorithm a particularly promising idea seems to us to examine adaptive procedures to determine the number of mcmc steps as suggested by fearnhead and taylor 2013 whether smc calibration can outperform mcmc calibration depends primarily on the trade off between communication overhead and parallelizability fig 4 in the case of the standard 3 pgn model without artificial runtime increase the fastest smc configurations came close to but did not beat the time taken by the mcmc dezs algorithm to reach the same sample quality expressed as d s 1700s cf fig 3 by contrast for the 3 pgn with a 50 ms pause executing the smc sampler with 5 or more cores took less time than using mcmc dezs for the same sample quality communication overhead is also the reason why we used the possible parallelization option for the dezs mcmc algorithm in the bayesiantoools r package which would have allowed using 3 cpu cores only for the 3 pgnsleep scenario for all faster models running the mcmc without parallelization was faster due to communication overhead given that we parallelized on a setup that has in our experience a comparatively low communication overhead we conclude that a model runtime of around 20 ms 50 ms is needed to make the use of an smc worthwhile when parallelizing across more cluster nodes or in a distributed system communication overhead will likely be larger and models should therefore likely be even slower until the advantages of parallelization are offset by their costs given that many ecological and environmental models have runtimes of minutes or even hours however this does not appear to pose a major limitation for the applicability of smc algorithms to model calibration our results are less favorable for smcs than those of jeremiah et al 2011 which we attribute to the fact that we benchmark against a state of the art mcmc algorithm rather than against a metropolis hastings mcmc although we anticipate that our results are fairly representative in that smc will eventually outperform mcmc regarding given sufficient parallel resources it would be interesting to run further tests varying both the models and parameters under calibration as well as the algorithm settings in particular our results that favor a balanced mix of smc and mcmc steps points towards exploring more aggressive design principles that mix smc and mcmc ideas e g zhu et al 2018 another issue that seems to require urgent attention are robust adaptation procedures that would for example automatically select the smc settings that we identified as most efficient in fig 3 and reliable convergence checks that monitor and report potential issues during an smc run while there is some development in this direction for example our automatic adaptation of the β steps we find that smcs lack in this respect compared to state of the art mcmc algorithms such as the dezs which is completely self adaptive under mildly beneficial circumstances although we do provide the posterior parameter estimates in the code repository see section data accessibility we stress that the purpose of this study was not to test the ecological plausibility of the fitted models or the identifiability of their parameters with real data for an ecologically interpretable calibration of 3 pgn with real forest data see for example trotsiuk et al 2020 moreover the use of synthetic data circumvented possible problems that can arise when calibrating models with structural error e g oberpriller et al 2021 such problems can potentially increase or decrease convergence speed of mcmcs or smcs in practical applications as we only compare across mcmc and smcs with different settings in a fixed scenario however we do not see this as a potential limitation for our results 5 conclusions in conclusion our paper demonstrates that smc algorithms should be considered as an alternative to mcmc samplers by modelers who want to calibrate slow models and have access to appropriate parallel computing hardware for slow models communication overhead due to parallel computing becomes negligible and smcs can draw on the opportunity provided by their superior parallelizability our results also suggest that smcs with a large share of internal mcmc steps work best possibly supporting a broader insight that a mix of both design principles as it is already done to a lesser degree in population based mcmc algorithms where several mcmc chains are run in parallel such as the dezs mcmc that we used as a reference might actually be the most successful strategy for calibrating complex models on modern computer hardware our study also highlighted various opportunities for further research in particular with regard to further development of robust adaptive methods for tuning smc parameters and the need to develop better tools for monitoring efficiency and convergence issues in smcs data accessibility the smc algorithm presented in this paper is based on the bayesiantools r package which is available on cran hartig et al 2019 the bayesiantools package is a framework for bayesian inference that includes a several mcmc samplers as well as plots and diagnostic functions for bayesian computations the bayesiantools vignette available via https cran r project org web packages bayesiantools vignettes bayesiantools html explains in detail how to specify likelihoods and prior in the format that is expected by the package installation instructions and code for reproducing the results of this paper are available at https github com florianhartig bayesiantools tree master publications speichetal smcformodelcalibration credit authorship contribution statement matthias speich methodology software formal analysis project administration writing original draft carsten f dormann conceptualization writing review editing florian hartig conceptualization methodology project administration writing review editing declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments we gratefully acknowledge support by the dfg dor 786 8 1 as part of the priority program 1374 infrastructure biodiversity exploratories johannes oberpriller provided helpful comments on the presentation of the manuscript we are grateful to the comments and suggestions by two anonymous reviewers supplementary materials supplementary material associated with this article can be found in the online version at doi 10 1016 j ecolmodel 2021 109608 appendix supplementary materials image application 1 
24591,two plants can influence one another indirectly by affecting population dynamics of shared exploiters and or shared mutualists giving rise to apparent competition or apparent mutualism respectively indirect interactions between plants also occur when the preferences of exploiters and mutualists adapt to changes in relative plant densities here we study simultaneous effects of adaptive herbivore and pollinator preferences on the dynamics of two competing plant populations as a result of feedbacks between plant dynamics and adaptive animal preferences plants coexist at alternative stable states this outcome is favored at low abundances of herbivores and pollinators when consumers tend to specialize on a single plant as herbivore and pollinator abundances increase generalism becomes more common this promotes plant coexistence by balancing antagonistic and mutualistic effects between plants plant community dynamics become also more predictable due to reduction in the number of alternative stable states this shows that the global decline in insect populations can lead to structural changes in plant communities that are difficult to predict graphical abstract keywords adaptive herbivory competition for pollination trait mediated interactions isoclines and isolegs alternative states 1 introduction during the last three decades populations of insects have decreased globally hallmann et al 2017 this has important consequences as insects play a central role in a variety of processes including pollination herbivory and detrivory nutrient cycling and providing a food source for higher trophic levels such as birds mammals and amphibians sic hallmann et al 2017 this situation associated with the expansion of monospecific crops holzschuh et al 2011 geslin et al 2017 threatens the persistence and stability of natural communities both density and trait mediated effects of herbivores on plants and effects of pollinators on plants see below were analyzed theoretically using simple food web modules in this article our concern is to study how behavioral changes of both insect pollinators and herbivores impact coexistence of two plant populations early models of struggle for existence focused on predator prey interactions and consumer competition for resources e g volterra 1926 1928 1938 gause 1934 these works that consider two interacting species were quickly extended to small food webs also called community modules holt 1997 consisting of three or four species these early works considered fixed interaction strength between populations and led to an important general prediction that coexistence of several species is either difficult or impossible to achieve e g the competitive exclusion principle gause 1934 hardin 1960 levin 1970 odum 1971 suggested that to explain a higher species richness more interactions e g mutualism commensalism parasitism etc need to be considered this view was challenged by may s 1972 observation that for randomly assembled model interaction webs there is a sharp transition from stability to instability when complexity measured as the food web connectance i e the number of realized links in the food web divided by the number of all possible links exceeds a critical threshold another research line focused on interaction strengths e g paine 1980 mccann et al 1998 bascompte et al 2005 that are assumed to be strong and fixed in these early models e g in the predator prey lotka volterra model the predator specializes on the particular prey that has no possibility to escape predation when even at low densities research on optimal foraging showed murdoch 1969 charnov 1976 stephens and krebs 1986 that animals often forage to maximize their food intake rate which is a proxy for their fitness other research also showed that prey try to avoid predators by using physical gause et al 1936 or behavioral refuges either by reducing their activity or changing their habitat sih 1980 1986 lima and dill 1990 peacor and werner 2001 brown and kotler 2004 such adaptive behaviors make interactions between consumers and their resources weaker and promote species persistence e g křivan 1996 1997 fryxell and lundberg 1998 huxel and mccann 1998 van baalen et al 2001 these works mostly focus on food web modules but similar predictions also carry over to complex food webs e g brose et al 2003 kondoh 2006 uchida and drossel 2007 berec et al 2010 křivan 2014 early mathematical models of symbiosis and commensalism were studied by kostitzin 1934 for english translation see scudo and ziegler 1978 and gause and witt 1935 these models have the form of the lotka volterra type equations where originally negative interactions are replaced by positive interactions thus presence of a symbiont increases the per capita population growth rate of the recipient species the important aspect of these models is that they are phenomenological i e they do not attempt to model causal mechanisms driving these positive interactions they do allow researchers to model both facultative mutualism when a species can achieve a positive population growth without the mutualist and obligate mutualism where positive population growth is possible only when a mutualist is present e g vandermeer and boucher 1978 a serious issue with lotka volterra models is the prediction of limitless growth due to strong positive mutualistic feedbacks the so called orgy of mutual benefaction may 1981 to prevent unbounded population growth modelers added negative feedbacks at high populations densities dean 1983 addicott and freedman 1984 hernandez 1998 moore et al 2017 or assumed saturating mutualistic feedbacks based on principles from consumer resource theory e g type ii functional responses holland and deangelis 2010 revilla 2015 mathematical models of mutualism were also combined with models of competition exploitation e g predation herbivory commensalism etc e g ringel et al 1996 melián et al 2009 georgelin and loeuille 2014 mougi and kondoh 2014 sauve et al 2014 2015 2016 these works showed that effects of mutualism on stability and species coexistence are diverse and complex due to combination of positive and negative feedbacks that can be either direct but often are indirect and transmitted through a third species bolker et al 2003 e g sharing a common pollinator leads to apparent mutualism between two plants where increase in population density of one species increases abundance of the pollinator which in turn has a positive effect on the population of the other species feinsinger 1987 when the two plants also share a common herbivore there is yet another density mediated indirect interactions called apparent competition holt 1977 where an increase in one plant increases the herbivore density which exerts negative effects on the other plant thus in an interaction module with two plants sharing a mutualist and a herbivore it is difficult to predict which of these indirect density mediated interactions will prevail models suggest that plant coexistence requires balances favoring indirect facilitation apparent mutualism over apparent competition sauve et al 2015 and in the case of large communities a nested topology for mutualistic interactions bastolla et al 2009 thébault and fontaine 2010 many important mutualisms involve animals that pollinate flowers disperse seeds or defend plants while obtaining plant food resources e g nectar pollen or fruits mutualistic consumers coexist with antagonistic consumers e g folivores or granivores species coexistence in mutualistic antagonistic systems was studied for small community modules georgelin and loeuille 2014 sauve et al 2015 and large interaction networks melián et al 2009 sauve et al 2014 2016 some articles analyzed animal adaptation within these hybrid systems mougi and kondoh 2014 georgelin and loeuille 2016 in this article we study conditions for coexistence of two competing plants that interact both with herbivores and mutualists which are adaptive foragers adaptive foraging allows consumers to use the most profitable plants at a given time and place rosenzweig 1981 i e those combining highest abundance and energetic reward this has varied effects on the plant community for example adaptive herbivores that prefer abundant plants help rare plants indirectly promoting plant diversity by weakening interaction strengths by excluding the rare plant from their diet on the other hand adaptive mutualists that prefer abundant plants create unfavorable conditions for rare plants that get less pollination causing loss of plant diversity revilla and křivan 2016 2018 in our mutualistic antagonistic model direct interactions between plants and plants and animals combine with indirect interactions between plants that are mediated by changes in herbivores and mutualists preferences for plants due to the complexity of such interaction networks we consider plant population dynamics at fixed herbivore and mutualist densities i e herbivore and mutualist population dynamics are not modeled in this article instead we manipulate animal densities and we study their effects on the coexistence of the two plants in particular we are interested in effects when both pollinator and herbivore densities are decreasing which reflects the current situation hallmann et al 2017 in this setting the indirect interactions between plants are caused not by changes in animal population densities but by changes in animal preferences for plants this is an example of trait mediated indirect interactions tmiis where indirect interaction between two plant species results from changes in traits adaptive foraging behavior of another species herbivores and pollinators in the community bolker et al 2003 as tmiis can be as strong as or even stronger than density mediated interactions schmitz et al 2004 we study combined density effects i e direct competition between plants and tmiis effects caused by adaptive herbivore and mutualist foraging behavior on plant coexistence first we study conditions for plant coexistence when animal preferences are fixed i e animals have fixed preferences for plants see section 4 1 second we assume animals are adaptive foragers and we study how plant coexistence and interaction topology depend on population densities of herbivores and pollinators section 4 2 finally we study dependence of plant equilibria on population density of herbivores and mutualists sections 4 2 1 and 4 2 2 which allows us to predict possible scenarios of declining insect population numbers 2 model and methods we consider a community of two plants with population densities p i i 1 2 an antagonistic herbivore population with density h and a mutualistic pollinator population with density m plants produce two types of resources foliar resources f i i e leaves are consumed by herbivores while pollination resources r i i e nectar or pollen are consumed by mutualists to model mutualism we assume that plant growth rates correlate with the consumption rate of r i scheuring 1992 revilla 2015 to model antagonism we assume that consumption of f i increases plant mortality dobbertin and brang 2001 this assumption is valid for many terrestrial plants where herbivores are folivores e g lepidopterans leaf cutters e g ants xylophages e g beetles or mucivores e g aphids that do not kill plants instantly like predators do with prey but the damage inflicted accelerates plant death by secondary causes such as lower photosynthetic rates nutrient loss or infections kulman 1971 kosola et al 2001 cowie et al 2016 das et al 2016 we then follow the mechanism described by revilla 2015 where fast dynamics of resources f i and r i when compared with plant population dynamics allow a steady state equilibrium of resources at the current plant densities in appendix a we use these assumptions to derive differential equations for plant population dynamics 1a d p 1 d t g 1 r 1 v 1 m q 1 v 1 m 1 p 1 c 2 p 2 k 1 m 1 p 1 u 1 h p 1 1b d p 2 d t g 2 r 2 v 2 m q 2 v 2 m 1 p 2 c 1 p 1 k 2 m 2 p 2 u 2 h p 2 where g i is the rate of vegetative growth in the absence of mutualism r i is the asymptotic growth rate due to pollination and q i is a half saturation constant growth is regulated by competition with established plants i e plant recruitment tends to zero as p i approaches k i and c j measures the competitive effect of plant j relative to the effect of plant i on itself herbivores raise intrinsic mortality rates according to parameter m i non herbivore mortality is accounted for by parameter p i the quantitative effect of herbivores on plants is controlled by parameters 0 u i 1 u 1 u 2 1 i e the relative herbivore preference for plant i similarly the effect of mutualists is controlled by relative mutualist preferences 0 v i 1 v 1 v 2 1 for plant i in this article we study effects of adaptive changes in animal preferences u i s and v i s on plants and we define fitnesses in terms of animal payoffs fitnesses are given by appendix a 2a w h e 1 u 1 p 1 p 1 u 1 h e 2 u 2 p 2 p 2 u 2 h 2b w m f 1 v 1 p 1 q 1 v 1 m f 2 v 2 p 2 q 2 v 2 m for herbivores and mutualists respectively here e i f i are herbivore mutualist payoffs when feeding on plant i in order to obtain analytical results useful for this paper we assume fixed herbivore and mutualist densities this assumption requires that consumer dynamics are limited by factors different from plant resources such as predators availability of nesting sites etc this makes h and m critical parameters i e independent variables that modify the feedbacks between plant dynamics and consumer preferences which in turn determine plant coexistence and plant animal interaction topologies our results are presented in the following sections specifically in section 3 we employ methods from evolutionary game theory hofbauer and sigmund 1998 to derive the optimal foraging strategies for herbivores and mutualists according to fitnesses 2 in section 4 we employ methods from the theory of dynamical systems e g local stability bifurcation analysis to study the coexistence between plants 1 and 2 table 1 lists our model variables parameters and numerical values used in simulations 3 herbivore and pollinator evolutionarily stable strategies at fixed plant population densities when herbivores and pollinators are adaptive foragers their preferences change in the direction that maximizes fitnesses given in 2 for given p 1 p 2 h and m we want to find evolutionarily stable strategies ess for herbivores and mutualists in appendix b we show that for the fitness function 2a the herbivore ess is given by 3 u 1 p 1 p 2 h 1 if p 2 e 1 p 2 p 1 e 2 p 1 h e 1 p 1 e 1 p 1 e 2 p 2 e 1 p 2 p 1 e 2 p 1 p 2 h e 1 p 1 e 2 p 2 if e 1 p 2 p 1 e 2 p 1 h p 2 e 1 p 2 h p 1 e 2 p 1 0 if p 2 e 1 p 2 h p 1 e 2 p 1 and the mutualist ess is given by 4 v 1 p 1 p 2 m 1 if p 2 f 1 q 2 p 1 f 2 q 1 m f 1 p 1 f 1 p 1 f 2 p 2 f 1 q 2 p 1 f 2 q 1 p 2 m f 1 p 1 f 2 p 2 if f 1 q 2 p 1 f 2 q 1 m p 2 f 1 q 2 m p 1 f 2 q 1 0 if p 2 f 1 q 2 m p 1 f 2 q 1 these optimal preferences show that the more abundant a plant is the more it attracts both herbivores and mutualists i e preferences are frequency dependent however there are minimum thresholds that must be met for a plant to attract animals at all these expressions also show that as herbivore mutualist population density increases u 1 v 1 converges to e 1 p 1 e 1 p 1 e 2 p 2 f 1 p 1 f 1 p 1 f 2 p 2 which corresponds to the proportional product of quality and quantity of resource 1 for herbivores mutualists table 2 lists all possible qualitatively different esss given by 3 and 4 for given herbivore h and pollinator m abundances the positive part of the plant abundance plane can be divided into five sectors that specify qualitatively different foraging preferences of herbivores h and mutualists m the sector boundaries for herbivores 5a i h 0 p 2 e 1 p 2 h e 2 p 1 p 1 5b i h 1 p 2 e 1 p 2 e 2 p 1 h p 1 and pollinators 5c i m 0 p 2 f 1 q 2 m f 2 q 1 p 1 5d i m 1 p 2 f 1 q 2 f 2 q 1 m p 1 are straight lines radiating from the origin as shown in fig 1 these lines are called isolegs in the optimal foraging literature e g rosenzweig 1986 rosenzweig and abramsky 1986 revilla and křivan 2018 in the sector between i h 0 and i h 1 isolegs herbivores are generalists i e 0 u 1 1 and optimal herbivore preferences given in 3 change continuously with p 1 and p 2 we call this sector the cone of herbivore generalism from here onward in the region above the cone of generalism above i h 0 isoleg in fig 1 herbivores specialize exclusively on plant 2 i e u 1 0 and in the region below the cone i e below i h 1 isoleg in fig 1 they specialize on plant 1 i e u 1 1 for mutualists isolegs i m 0 and i m 1 define the corresponding cone of mutualist generalism fig 1 shows that there are four qualitative arrangements for herbivore and mutualist cones of generalism the cones do not overlap fig 1a they overlap partially fig 1b the herbivore s cone lies within the mutualist s cone fig 1c or the mutualist s cone lies within the herbivore s cone fig 1d as foragers densities increase their cones of generalism get wider and overlaps of the two cones become more likely different arrangements of cones give rise to different combinations of herbivore and mutualist preferences that modify plant population dynamics which in turn modify herbivore and mutualist preference as we will see in the next sections 4 plant population dynamics in this section we study plant population dynamics first we assume that herbivore and pollinator preferences for plants are fixed i e animals are inflexible consumers this leads to the classic lotka volterra plant population dynamics second we consider the case where animals are adaptive foragers that change their preferences so as to maximize their fitness we assume that these adaptations are very fast when compared to population dynamics so that animal preferences track instantaneously plant population densities 4 1 plant dynamics with fixed animal preferences when herbivore and pollinator preferences are fixed system 1 becomes the lotka volterra lv competition model that has a trivial equilibrium 0 0 and two single plant i e monoculture equilibria p 1 0 q 1 0 and 0 p 2 0 q 2 where plants reach their environmental carrying capacities 6 q i k i 1 m i p i u i h g i r i v i m q i v i m a plant s carrying capacity increases with mutualist preference and density v i m and decreases with herbivore preference and density u i h a plant is viable at given herbivore and mutualist densities if q i is positive i e when 7 g i r i v i m q i v i m m i p i u i h and not viable otherwise we observe that plant viability requires that the plant growth rate which is the sum of the plant vegetative growth rate and the growth rate due to pollination must be larger than plant mortality caused by herbivory in particular a necessary condition for plant i viability obtained for v i m tending to infinity in 7 is g i r i m i p i u i h furthermore mutualism is facultative if g i m i p i i e when in absence of herbivory u i h 0 a plant overcomes mortality solely by vegetative growth on the contrary if m i p i g i mutualism is obligate for the plant i e vegetative growth alone is not enough to compensate mortality even without herbivory u i h 0 provided 7 holds for i 1 2 a plant community equilibrium is at the intersection of the plant isoclines 1 1 by isoclines we mean non trivial ones trivial isoclines p 1 0 and p 2 0 are considered only implicitly 8a p 1 c 2 p 2 q 1 8b p 2 c 1 p 1 q 2 and such coexistence is globally stable if each plant can invade the other s monoculture i e when both monoculture plant equilibria 0 q 2 and q 1 0 are unstable the invasion conditions for plant 1 and 2 are respectively 9a q 1 c 2 q 2 9b q 2 c 1 q 1 from these conditions 10 c 1 c 2 1 that is interpreted as intra specific competition is stronger than inter specific if invasibility conditions in 9 hold the stable plant coexistence equilibrium is 11 p ˆ 1 p ˆ 2 q 1 c 2 q 2 1 c 1 c 2 q 2 c 1 q 1 1 c 1 c 2 if opposite inequalities in 9 hold c 1 c 2 1 the equilibrium is unstable and plant population dynamics are bi stable depending on the initial conditions plant 1 or plant 2 wins the competition reaches its carrying capacity and the other plant goes extinct if 9a holds but 9b does not plant 1 excludes plant 2 vice versa if 9b holds but 9a does not plant 2 excludes plant 1 the last two cases show that 10 is necessary but not sufficient for stable coexistence in the next section we consider adaptive herbivores and mutualists that maximize their fitnesses 4 2 plant population dynamics with adaptive animal preferences for the rest of this article we assume that herbivores preferences u i given in 3 and mutualists preferences v i given in 4 track current plant population densities instantaneously and we substitute these formulas in plant population dynamics 1 the resulting model is highly non linear and analytical formulas for equilibria and stability are very complex expressions thus we study the dynamics of the interaction network using numerical methods fig 2 shows the dependence of the interaction network topology on herbivore and mutualist densities this figure assumes that inter specific competition between plants is weaker than intra specific competition i e the inequality in 10 holds and both plants coexist at a single stable state in absence of herbivores and pollinators h m 0 in the dark shaded region of the plot both plant monocultures are viable because parameters are such that inequality in 7 holds for both plants plant 1 monoculture which has a slightly higher r 1 0 022 when compared to plant 2 r 2 0 02 is also viable in the light shaded region where plant 2 monoculture goes extinct in the white region the negative effect of herbivory overweighs the positive effect of mutualism and neither plant monoculture survives however as we see this does not mean that the two plants cannot coexist when they are together e g see the upper right white region gg where both plans coexist stable plant coexistence is possible in 15 out of total 17 regions shown in fig 2 at one two or three alternative stable states that are labeled according to interaction patterns listed in table 2 these labels indicate preference of herbivores the symbol at the first position and mutualists the symbol at the second position for plants at the corresponding stable plant equilibrium animal generalism is indicated by g following the convention introduced in table 2 for example g1 means that herbivores are generalists and mutualists specialize on plant 1 at the corresponding plant equilibrium these labels also indicate the interaction topology see fig 1 there are two regions where plant coexistence is not possible in region e the negative effect of herbivory on plants is too strong when compared to the positive effect of mutualism and plants go globally extinct this is because the density of herbivores when compared to density of mutualists is too high in the region denoted by b in fig 2 either plant 1 or plant 2 is excluded depending on initial conditions and herbivores and mutualists specialize on the surviving monoculture we observe that most regions allow plant coexistence at several alternative stable states e g in the region denoted by g1 g2 gg plants coexistence is possible at three different stable states here g1 means that at the plant equilibrium herbivores are generalists feeding on both plants while pollinators specialize on plant 1 at equilibrium g2 herbivores are generalists while mutualists specialize on plant 2 and at equilibrium gg both herbivores and mutualists are generalists at which of these alternative equilibria plants settle depends on initial conditions see the next section fig 2 suggests that the number of states at which plants can coexist is highest and equal to three at intermediate densities of herbivores and mutualists when herbivore and mutualist densities are very low the number of stable states tends to be one or two with at least one specialist consumer e g regions 22 11 22 11 g2 or g1 g2 when herbivore and mutualist densities are large enough plants coexist at a single stable state where both consumers are generalist gg region and where neither of the two plants can survive at positive densities without the other plant being present since model 1 is two dimensional we can use phase plane analysis to gain insights about plant community dynamics when herbivores and mutualists preferences for plants quickly adapt to changes in plant densities for this purpose we graph the plant isoclines 8 with u i and v i given in 3 and 4 respectively in formulas 6 in the following paragraph we describe the general features of the isoclines and we illustrate plant population dynamics at herbivores and mutualists densities marked with x in fig 2 fig 3 displays global dynamics at 9 points marked by x in fig 2 the nonlinear dependence of herbivore 3 and mutualist 4 preferences on plant densities leads to nonlinear isoclines that are defined separately at each sector in marginal sectors that are adjacent to the axes i e below isolegs i h 1 and i m 1 or above isolegs i h 0 and i m 0 corresponding isocline segments are linear and given by the lotka volterra model because animal preferences are either 1 or 0 there i e u 1 v 1 1 or u 1 v 1 0 plant i 1 2 isocline meets the p i axis at p i q i denoted by diamond symbols in fig 3 given by eq 6 between isolegs i e within the cones of generalism one or both of animal preferences for plants u 1 and v 1 given in 3 are nonlinear functions of plant densities and the corresponding isocline segments are polynomial curves of degree 2 or 3 like with the lv model plant p i has positive net growth d p i d t 0 in the positive part of the p 1 p 2 plane bounded by its isocline and p i axes and negative net growth d p i d t 0 outside stable unstable plant equilibria are denoted by dots circles first we observe that unlike the lv competition model with fixed animal preferences where plants can only coexist at a single equilibrium for our choice of parameters nonlinear isoclines allow multiple plant equilibria see panels a g in fig 3 coexistence of multiple stable states implies that the fate of the system depends on initial conditions and not knowing this information it cannot be predicted where the system will converge to in particular the priority effect young et al 2001 will have a strong effect on the community composition the priority effect is due to adaptive mutualism which causes strong competition for pollination services that favors resident or abundant plants e g agricultural crops see holzschuh et al 2011 in detriment to rarer plants e g invaders we also observe that besides multiple stable states where both plant species coexist there are stable equilibria with one plant only panels d and g in fig 3 second we observe the effect of herbivores and mutualists on plant monoculture equilibrium densities denoted by the diamond symbol on the axes in fig 3 it is obvious that the negative effect of herbivores on plant monocultures is much stronger than is the positive effect of mutualists this already follows from formula 6 which shows that plant population densities linearly decrease as herbivore density increases while the positive effect of mutualists on plant densities is saturating thus when mutualists are abundant an increase in their density will have a negligible effect on plant density e g cf fig 3d vs fig 3g third we observe facilitation effects of one plant on the other at the stable coexistence equilibrium e g figs 3f h indeed in these panels the plant densities at the gg equilibrium are higher when compared with their monoculture densities such facilitation effect requires herbivore generalism so that both plants share the costs of herbivory and also mutualist generalism so that neither plant is the sole winner of mutualist benefits thus facilitation happens at plant equilibria that are in the overlap of herbivore and mutualist cones of generalism i e a gg equilibrium point when extreme levels of herbivory turn monocultures nonviable i e 7 does not hold the facilitation effect is the only mean by which plants can persist at all e g panel i fig 3 also shows how plant population dynamics determines plant animal interaction topologies i e consumer preferences for example figs 3e f display qualitatively similar plant dynamics with three coexistence equilibria however at the two equilibria that are dominated by one of the two plants interaction dynamics differ between the two panels while in panel e herbivores specialize on the more abundant plant at these two equilibria they generalize in panel f this is because herbivore density is higher in panel f and generalism of herbivores prevents one plant to be excluded which in turn increases herbivore fitness in the next section we examine the dependence of stable plant equilibria on herbivore and mutualist densities 4 2 1 effect of adaptive herbivory on plant densities fig 4 shows dependence of plant 1 top panel and plant 2 bottom panel equilibrium densities along the herbivore gradient when mutualist density is fixed at m 0 4 this corresponds to moving along the vertical dotted line in fig 2 solid dotted lines denote stable unstable equilibria in general plant densities decrease with increasing herbivore density which is expected from the antagonistic relationship between plants and herbivores for example monocultures decrease linearly with h according to eq 6 exceptions happen when herbivores or mutualists specialize on a single plant as we describe next at very low herbivore density both monocultures are stable against invasion and the system is bi stable this is evident from fig 4 that shows stable monoculture equilibria solid q1 and q2 respectively and one line of unstable equilibria starting at h 0 dotted line which corresponds to the unstable equilibrium in fig 3d plant 1 plant 2 monoculture becomes invasible i e unstable indicated by dashes at the branching point bp1 bp2 in fig 4 where an interior stable plant equilibrium at which both animals specialize on plant 1 on plant 2 branches from q1 q2 these branches are straight lines given by 6 with u 1 v 1 1 11 line or u 1 v 1 0 22 line and they correspond to lv equilibria on marginal sectors adjacent to the axes e g fig 3e the branching point bp1 h 0 4 lies on the boundary between regions 22 gg and 11 22 1g in fig 2 whereas bp2 h 0 058 lies on the boundary between 1g and 22 1g as h increases further plant 1 experiences more herbivory but plant 2 none so that the equilibrium density of plant 1 decreases while that of plant 2 increases at h 0 932 this equilibrium reaches i h 1 isoleg 5b where herbivores become generalists i e interaction topology changes to g1 from this point on both plants are affected by herbivory and both equilibria densities decrease until they disappear at h 1 667 denoted as ep1 in fig 4 the circle in fig 4 denotes the point at which herbivores switch from plant 1 specialization to generalism this point corresponds to herbivore density on the boundary between regions 11 g2 gg and g1 g2 gg in fig 2 in the case of branch line 22 that describes the interior plant equilibria where both animals specialize on plant 2 equilibrium density of plant 2 decreases while density of plant 1 increases with h but unlike the switch in interaction topology from 11 to g1 described before we observe a gap between lines denoted by 22 and g2 at limit point lp1 where h 0 717 the 22 equilibrium hits the i m 0 isoleg 5b and this equilibrium vanishes then at limit point lp2 where h 0 879 the isoclines intersect again within the herbivore s cone of generalism and the equilibrium g2 appears until the joint extinction of plants due to herbivory at h 1 533 denoted as ep2 limit point lp1 lies on the boundary between regions 11 22 gg and 11 gg in fig 2 whereas lp2 lies on the boundary between 11 gg and 11 g2 gg finally we have the third line of stable plant coexistence where mutualists are generalist this line starts at the limit point h 0 022 denoted as lp3 where the dynamic turns from bi stable i e region b in fig 2 e g fig 3d to locally stable coexistence with herbivores specializing on plant 1 i e line 1g like in the case of equilibrium line 11 plant 1 decreases with h while plant 2 increases until this equilibrium crosses the i h 1 isoleg at h 0 097 and herbivores become generalist i e the gg line starts indicated with the open circle from this point on both plants decrease with h until joint extinction at h 2 288 denoted as ep3 4 2 2 effect of adaptive mutualism on plant densities fig 5 shows dependence of plant 1 top panel and plant 2 bottom panel equilibrium densities along the mutualist gradient when herbivore density is fixed at h 1 1 which corresponds to moving along the horizontal dotted line in fig 2 solid dotted lines denote stable unstable equilibria monocultures are viable for m 0 167 in the case of plant 1 q 1 line and for m 0 2 in the case of plant 2 q 2 line when condition 7 holds they are unstable against invasion by the missing plant and increase with diminishing returns as m increases to infinity according to 6 we observe three lines of stable coexistence g1 g2 and gg the g1 line starts at the extinction point m 0 139 denoted as ep1 where mutualist density is insufficient to compensate for herbivory for similar reasons line g2 starts at m 0 167 denoted as ep2 these equilibria branches terminate at limit point m 0 519 lp1 for g1 or m 0 457 lp2 for g2 since then on plant coexistence is possible along the gg branch where both animals are generalists which starts at the limit point lp3 where m 0 287 which is connected to branch g1 by an unstable branch i e dots connecting lp3 to lp1in fig 5 thus at the current herbivore density h 1 1 mutualists turn generalist when their densities are large enough or specialists on plant 1 or 2 when their densities are low enough fig 5 also shows that plants can attain larger densities when together compared with their monocultures this happens for both plants along the whole gg branch only for plant 1 along a part of the g1 branch where m 0 333 or only for plant 2 along the whole g2 branch this is due to the indirect facilitation when herbivores are generalists both plant densities increase along branch gg since both benefit from increased level of mutualism however both plants also increase along branches g1 and g2 despite mutualist specialization in g1 as mutualists specialize on plant 1 plant 1 density increases with m because plant 1 gets more pollination but also more herbivory as herbivores preference for plant 1 increases this decreases herbivory on plant 2 which can also increase with m this mechanism operates along the g2 branch too mutatis mutandis the plant monopolizing mutualists increases faster with m i e d p 1 d m d p 2 d m along g1 and d p 2 d m d p 1 d m along g2 we observe that as mutualist density increases the number of alternative stable coexistence states increases from 0 for m 0 139 to 1 for 0 139 m 0 167 to 2 for 0 167 m 0 287 to 3 for 0 287 m 0 457 for yet higher mutualist densities the number of coexistence stable states decreases to a single one for m 0 519 5 discussion in this article we study direct and indirect interactions between two competing plants that are mediated by shared herbivores and pollinators both called consumers here we consider plant population dynamics under the assumption that consumer density is fixed but preferences for plants are adaptive and maximize consumer fitness while without consumers plants can coexist at most at a single equilibrium we show that adaptive consumer behavior promotes plant coexistence at alternative stable states through apparent plant facilitation which increases plant densities above those that each plant can achieve when alone we also show that decrease in insect i e consumer population densities can lead to unpredictable patterns of plant extinction interaction webs are driven by direct e g direct feeding of predators on their prey and indirect interactions e g trophic cascades hairston et al 1960 apparent competition holt 1977 all these interactions are caused by changes in population densities it has been argued schmitz et al 2004 that interactions caused by changes in animal behavior even when population densities stay constant i e trait mediated interactions can cause effects of similar or even larger magnitude such effects can be either direct i e direct trait mediated interactions or indirect for a review see bolker et al 2003 in this article we study two indirect trait mediated interactions between two competing plant populations mediated by changes in foraging preferences of shared pollinators and herbivores understanding effects of trait mediated interactions in model systems is important because in reality it is often impossible to separate trait and density mediated interactions e g in plant communities sharing a common herbivore both trait and density mediated interactions will occur while density mediated apparent competition between plants is detrimental to plant coexistence because an increase in one plant density increases population density of the herbivore which in turn exerts a negative effect on the other plant the trait mediated indirect interactions caused by changes in herbivore preference for the more abundant plant promotes plant coexistence and we call this trait mediated facilitation it was shown that such apparent facilitation can be stronger than apparent competition and lead to plant coexistence in two resource single consumer system křivan 1997 the other trait mediated interaction in our interaction network is mediated by adaptive pollinator preferences for plants as one plant density increases pollinator preference for this plant increases which is detrimental for the other plant that receives less pollination we call this trait mediated apparent competition in this article we developed a new plant herbivore pollinator model where the plants supply one resource for pollinators e g pollen or nectar and a different resource for herbivores e g leaves this extends the mechanism used in previous papers to model resource for services mutualisms revilla 2015 revilla and křivan 2016 2018 to the realm of exploitative interactions e g resource for antagonism this causes resource competition schoener 1978 within the herbivore and within the pollinator populations which are the driving forces behind adaptation towards specialization or generalism in foraging preferences when pollinator and herbivore densities are fixed as well as their preferences for either plant plant dynamics are described by the classic lotka volterra competition model where either both plants coexist only one plant survives or the model is bi stable in that the fate of the system depends on the history the situation dramatically changes when both herbivore and pollinator foraging preferences for plants are adaptive so that consumers maximize their fitnesses at current plant population densities as mentioned before trait mediated interactions via herbivore adaptation tends to equalize plant densities and promotes plant coexistence on the other hand mutualist adaptation works in the opposite direction i e positive feedbacks between preferences and population densities increase competitive asymmetries between plants mougi and kondoh 2014 revilla and křivan 2016 and promote exclusion of one plant by the other when these two mechanisms are considered together it is difficult to predict which mechanism i e trait mediated facilitation or competition will drive the system with two animal consumers the preferences of one of them can drive plant population dynamics in directions that affect the preference of the other consumer and vice versa we show that the chain of indirect feedbacks between plants and animals creates a rich set of population dynamics where plants can attain coexistence at up to three alternative stable states fig 3 adaptive mutualism tends to increase differences in plant abundances by specialization on the more common plant which leads to alternative stable states this was also observed in interaction modules with two plants and mutualists revilla and křivan 2016 2018 křivan and revilla 2019 on the other hand adaptive herbivory tends to prevent competitive exclusion by steering preferences towards common plants and away from rare which are at risk of extinction by fixing animal densities we remove indirect density mediated effects such as apparent competition holt 1977 and facilitation feinsinger 1987 but frequency dependent effects mediated by animal preferences remain and can be analyzed the joint effects of density and trait mediated interactions are more difficult to study because the number of variables involved increases i e 4 species densities we know that for two prey and one predator adaptive foraging counteracts apparent competition e g křivan 1996 1997 and for two plants and one pollinator competition for plant resources promotes pollinator generalism which allows plant plant facilitation revilla and křivan 2016 in both situations antagonistic or mutualistic the growth of consumer populations promotes their generalism which in turn promotes the stability of plant communities for the reasons discussed in previous paragraphs our results highlight the importance that trait mediated interactions can have for plant coexistence this has important implications in current times of insect declines hallmann et al 2017 and large scale perturbations of pollination services holzschuh et al 2011 geslin et al 2017 caused by human activities we can hypothesize that the decrease of insect populations leads to regimes of alternative states caused by adaptive specialization as a result predictability of plant insect dynamics becomes difficult some alternative states can be very unbalanced in plant abundances e g coexistence states denoted by 11 and 22 in fig 3e making species loss easier as a result of small perturbations on the other hand management policies that sustain reasonably large and diverse insect populations would promote their generalism in such conditions the provision of mutualistic services is favorable for a large number of plant species and potential pests can be kept in check by the dynamic control by herbivores credit authorship contribution statement tomás a revilla conceived the study model analysis manuscript writing thomas marcou model analysis manuscript revision vlastimil křivan model analysis manuscript writing declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments we thank two anonymous reviewers for comments and suggestions this project has received funding from the european union s horizon 2020 research and innovation programme under grant agreement no 955708 project evogamesplus evolutionary games and population dynamics from theory to applications appendix a model derivation herbivore f i leaves and mutualist r i nectar or pollen resources of plant i 1 2 follow supply consumption dynamics a 1 d f i d t π i p i ω i f i u i α i f i h d r i d t σ i p i λ i r i v i β i r i m where p i is plant population density π i and σ i represent production supply e g leafing nectar secretion rates per plant and λ i and ω i are non consumptive decay rates e g falling withering re absorption herbivores mutualists with population density h m consume resources with specific rates α i β i and relative preference 0 u i 1 u 1 u 2 1 for plant i we consider plant p i population dynamics a 2 d p i d t g i p i ρ i v i β i r i m 1 p i c j p j k i μ i f i p i p i i 1 2 where the growth rate g i p i ρ i v i β i r i m consists of two terms the first term corresponds to growth without mutualism with vegetative rate g i the second term links plant growth to consumption of mutualistic resources r i in a 1 by means of the constant ρ i that translates pollination to seed numbers plant i experiences intra specific competition and inter specific competition from plant j according to the competition coefficient c i k i is the density of plant p i at which competition results in zero recruitment of new plants in order to relate plant mortality with consumption of herbivore resources f i in a 1 we assume that mortality increases with the intensity of defoliation caused by the herbivores a simple and convenient way to state this dependency is by making intrinsic mortality inversely proportional to foliar biomass per plant f i p i with a proportionality constant μ i under the assumption that foliage is evenly distributed among individual plants now we assume that the turnover of plant resources is fast and they instantaneously track plant population densities i e d f i d t 0 and d r i d t 0 in a 1 which yields a 3 f i π i p i ω i u i α i h r i σ i p i λ i v i β i m substituting these expressions in a 2 leads to the system of two differential equations 1 studied in the main text where we group r i ρ i σ i m i μ i α i π i p i ω i α i q i λ i β i next animal payoffs when feeding on plant i are measured by the instantaneous plant consumption rate multiplied by conversion factors ϵ i ϕ i for herbivores pollinators for example herbivore payoff when feeding on plant 1 only is ϵ 1 α 1 f 1 animal fitnesses are then defined as mean animal payoffs a 4 w h ϵ 1 u 1 α 1 f 1 ϵ 2 u 2 α 2 f 2 w m ϕ 1 v 1 β 1 r 1 ϕ 2 v 2 β 2 r 2 for herbivores and pollinators respectively substituting expressions a 3 into a 4 leads to herbivore and mutualists fitnesses 2 in the main text grouping e i ϵ i π i f i ϕ i σ i appendix b evolutionarily stable strategy let us consider herbivores and their fitness function 2a in a population where u 1 h herbivores forage on plant 1 and u 2 h 1 u 1 h on plant 2 the payoffs that an herbivore gets from interaction with plant 1 or plant 2 are a 5 u 1 u 1 e 1 p 1 p 1 u 1 h u 2 u 1 e 2 p 2 p 2 1 u 1 h these payoffs depend on plant densities herbivore densities and herbivore preferences the herbivore with preference u 1 for plant 1 in a resident population with preference u 1 obtains fitness given by the average payoff a 6 w h u 1 u 1 u 1 u 1 u 1 1 u 1 u 2 u 1 the optimal preference u 1 is calculated as the nash equilibrium ne for the fitness function a 6 at an interior i e generalist ne the two payoffs a 5 must be the same i e u 1 u 2 which yields u 1 e 1 p 1 e 1 p 1 e 2 p 2 e 1 p 2 p 1 e 2 p 1 p 2 h e 1 p 1 e 2 p 2 provided 0 u 1 1 if u 1 u 1 u 2 u 1 u 1 u 1 u 2 u 1 for all 0 u 1 1 the ne and the only evolutionary outcome is u 1 1 u 1 0 because for u 1 u 1 w h u 1 u 1 w h u 1 u 1 e 1 p 1 p 2 1 u 1 h e 2 p 2 p 1 u 1 h 2 h e 1 p 1 e 2 p 2 p 2 1 u 1 h p 1 u 1 h 0 the interior nash equilibrium u 1 is also resistant to mutant invasions i e w h u 1 u 1 w h u 1 u 1 for all strategies u 1 u 1 and it is an evolutionarily stable strategy hofbauer and sigmund 1998 thus u 1 p 1 p 2 h 1 if p 2 e 1 p 2 p 1 e 2 p 1 h e 1 p 1 e 1 p 1 e 2 p 2 e 1 p 2 p 1 e 2 p 1 p 2 h e 1 p 1 e 2 p 2 if e 1 p 2 p 1 e 2 p 1 h p 2 e 1 p 2 h p 1 e 2 p 1 0 if p 2 e 1 p 2 h p 1 e 2 p 1 which is function 3 in the main text making appropriate changes of symbols and using fitness function 2b instead we can derive function 4 for the mutualists in the main text 
24591,two plants can influence one another indirectly by affecting population dynamics of shared exploiters and or shared mutualists giving rise to apparent competition or apparent mutualism respectively indirect interactions between plants also occur when the preferences of exploiters and mutualists adapt to changes in relative plant densities here we study simultaneous effects of adaptive herbivore and pollinator preferences on the dynamics of two competing plant populations as a result of feedbacks between plant dynamics and adaptive animal preferences plants coexist at alternative stable states this outcome is favored at low abundances of herbivores and pollinators when consumers tend to specialize on a single plant as herbivore and pollinator abundances increase generalism becomes more common this promotes plant coexistence by balancing antagonistic and mutualistic effects between plants plant community dynamics become also more predictable due to reduction in the number of alternative stable states this shows that the global decline in insect populations can lead to structural changes in plant communities that are difficult to predict graphical abstract keywords adaptive herbivory competition for pollination trait mediated interactions isoclines and isolegs alternative states 1 introduction during the last three decades populations of insects have decreased globally hallmann et al 2017 this has important consequences as insects play a central role in a variety of processes including pollination herbivory and detrivory nutrient cycling and providing a food source for higher trophic levels such as birds mammals and amphibians sic hallmann et al 2017 this situation associated with the expansion of monospecific crops holzschuh et al 2011 geslin et al 2017 threatens the persistence and stability of natural communities both density and trait mediated effects of herbivores on plants and effects of pollinators on plants see below were analyzed theoretically using simple food web modules in this article our concern is to study how behavioral changes of both insect pollinators and herbivores impact coexistence of two plant populations early models of struggle for existence focused on predator prey interactions and consumer competition for resources e g volterra 1926 1928 1938 gause 1934 these works that consider two interacting species were quickly extended to small food webs also called community modules holt 1997 consisting of three or four species these early works considered fixed interaction strength between populations and led to an important general prediction that coexistence of several species is either difficult or impossible to achieve e g the competitive exclusion principle gause 1934 hardin 1960 levin 1970 odum 1971 suggested that to explain a higher species richness more interactions e g mutualism commensalism parasitism etc need to be considered this view was challenged by may s 1972 observation that for randomly assembled model interaction webs there is a sharp transition from stability to instability when complexity measured as the food web connectance i e the number of realized links in the food web divided by the number of all possible links exceeds a critical threshold another research line focused on interaction strengths e g paine 1980 mccann et al 1998 bascompte et al 2005 that are assumed to be strong and fixed in these early models e g in the predator prey lotka volterra model the predator specializes on the particular prey that has no possibility to escape predation when even at low densities research on optimal foraging showed murdoch 1969 charnov 1976 stephens and krebs 1986 that animals often forage to maximize their food intake rate which is a proxy for their fitness other research also showed that prey try to avoid predators by using physical gause et al 1936 or behavioral refuges either by reducing their activity or changing their habitat sih 1980 1986 lima and dill 1990 peacor and werner 2001 brown and kotler 2004 such adaptive behaviors make interactions between consumers and their resources weaker and promote species persistence e g křivan 1996 1997 fryxell and lundberg 1998 huxel and mccann 1998 van baalen et al 2001 these works mostly focus on food web modules but similar predictions also carry over to complex food webs e g brose et al 2003 kondoh 2006 uchida and drossel 2007 berec et al 2010 křivan 2014 early mathematical models of symbiosis and commensalism were studied by kostitzin 1934 for english translation see scudo and ziegler 1978 and gause and witt 1935 these models have the form of the lotka volterra type equations where originally negative interactions are replaced by positive interactions thus presence of a symbiont increases the per capita population growth rate of the recipient species the important aspect of these models is that they are phenomenological i e they do not attempt to model causal mechanisms driving these positive interactions they do allow researchers to model both facultative mutualism when a species can achieve a positive population growth without the mutualist and obligate mutualism where positive population growth is possible only when a mutualist is present e g vandermeer and boucher 1978 a serious issue with lotka volterra models is the prediction of limitless growth due to strong positive mutualistic feedbacks the so called orgy of mutual benefaction may 1981 to prevent unbounded population growth modelers added negative feedbacks at high populations densities dean 1983 addicott and freedman 1984 hernandez 1998 moore et al 2017 or assumed saturating mutualistic feedbacks based on principles from consumer resource theory e g type ii functional responses holland and deangelis 2010 revilla 2015 mathematical models of mutualism were also combined with models of competition exploitation e g predation herbivory commensalism etc e g ringel et al 1996 melián et al 2009 georgelin and loeuille 2014 mougi and kondoh 2014 sauve et al 2014 2015 2016 these works showed that effects of mutualism on stability and species coexistence are diverse and complex due to combination of positive and negative feedbacks that can be either direct but often are indirect and transmitted through a third species bolker et al 2003 e g sharing a common pollinator leads to apparent mutualism between two plants where increase in population density of one species increases abundance of the pollinator which in turn has a positive effect on the population of the other species feinsinger 1987 when the two plants also share a common herbivore there is yet another density mediated indirect interactions called apparent competition holt 1977 where an increase in one plant increases the herbivore density which exerts negative effects on the other plant thus in an interaction module with two plants sharing a mutualist and a herbivore it is difficult to predict which of these indirect density mediated interactions will prevail models suggest that plant coexistence requires balances favoring indirect facilitation apparent mutualism over apparent competition sauve et al 2015 and in the case of large communities a nested topology for mutualistic interactions bastolla et al 2009 thébault and fontaine 2010 many important mutualisms involve animals that pollinate flowers disperse seeds or defend plants while obtaining plant food resources e g nectar pollen or fruits mutualistic consumers coexist with antagonistic consumers e g folivores or granivores species coexistence in mutualistic antagonistic systems was studied for small community modules georgelin and loeuille 2014 sauve et al 2015 and large interaction networks melián et al 2009 sauve et al 2014 2016 some articles analyzed animal adaptation within these hybrid systems mougi and kondoh 2014 georgelin and loeuille 2016 in this article we study conditions for coexistence of two competing plants that interact both with herbivores and mutualists which are adaptive foragers adaptive foraging allows consumers to use the most profitable plants at a given time and place rosenzweig 1981 i e those combining highest abundance and energetic reward this has varied effects on the plant community for example adaptive herbivores that prefer abundant plants help rare plants indirectly promoting plant diversity by weakening interaction strengths by excluding the rare plant from their diet on the other hand adaptive mutualists that prefer abundant plants create unfavorable conditions for rare plants that get less pollination causing loss of plant diversity revilla and křivan 2016 2018 in our mutualistic antagonistic model direct interactions between plants and plants and animals combine with indirect interactions between plants that are mediated by changes in herbivores and mutualists preferences for plants due to the complexity of such interaction networks we consider plant population dynamics at fixed herbivore and mutualist densities i e herbivore and mutualist population dynamics are not modeled in this article instead we manipulate animal densities and we study their effects on the coexistence of the two plants in particular we are interested in effects when both pollinator and herbivore densities are decreasing which reflects the current situation hallmann et al 2017 in this setting the indirect interactions between plants are caused not by changes in animal population densities but by changes in animal preferences for plants this is an example of trait mediated indirect interactions tmiis where indirect interaction between two plant species results from changes in traits adaptive foraging behavior of another species herbivores and pollinators in the community bolker et al 2003 as tmiis can be as strong as or even stronger than density mediated interactions schmitz et al 2004 we study combined density effects i e direct competition between plants and tmiis effects caused by adaptive herbivore and mutualist foraging behavior on plant coexistence first we study conditions for plant coexistence when animal preferences are fixed i e animals have fixed preferences for plants see section 4 1 second we assume animals are adaptive foragers and we study how plant coexistence and interaction topology depend on population densities of herbivores and pollinators section 4 2 finally we study dependence of plant equilibria on population density of herbivores and mutualists sections 4 2 1 and 4 2 2 which allows us to predict possible scenarios of declining insect population numbers 2 model and methods we consider a community of two plants with population densities p i i 1 2 an antagonistic herbivore population with density h and a mutualistic pollinator population with density m plants produce two types of resources foliar resources f i i e leaves are consumed by herbivores while pollination resources r i i e nectar or pollen are consumed by mutualists to model mutualism we assume that plant growth rates correlate with the consumption rate of r i scheuring 1992 revilla 2015 to model antagonism we assume that consumption of f i increases plant mortality dobbertin and brang 2001 this assumption is valid for many terrestrial plants where herbivores are folivores e g lepidopterans leaf cutters e g ants xylophages e g beetles or mucivores e g aphids that do not kill plants instantly like predators do with prey but the damage inflicted accelerates plant death by secondary causes such as lower photosynthetic rates nutrient loss or infections kulman 1971 kosola et al 2001 cowie et al 2016 das et al 2016 we then follow the mechanism described by revilla 2015 where fast dynamics of resources f i and r i when compared with plant population dynamics allow a steady state equilibrium of resources at the current plant densities in appendix a we use these assumptions to derive differential equations for plant population dynamics 1a d p 1 d t g 1 r 1 v 1 m q 1 v 1 m 1 p 1 c 2 p 2 k 1 m 1 p 1 u 1 h p 1 1b d p 2 d t g 2 r 2 v 2 m q 2 v 2 m 1 p 2 c 1 p 1 k 2 m 2 p 2 u 2 h p 2 where g i is the rate of vegetative growth in the absence of mutualism r i is the asymptotic growth rate due to pollination and q i is a half saturation constant growth is regulated by competition with established plants i e plant recruitment tends to zero as p i approaches k i and c j measures the competitive effect of plant j relative to the effect of plant i on itself herbivores raise intrinsic mortality rates according to parameter m i non herbivore mortality is accounted for by parameter p i the quantitative effect of herbivores on plants is controlled by parameters 0 u i 1 u 1 u 2 1 i e the relative herbivore preference for plant i similarly the effect of mutualists is controlled by relative mutualist preferences 0 v i 1 v 1 v 2 1 for plant i in this article we study effects of adaptive changes in animal preferences u i s and v i s on plants and we define fitnesses in terms of animal payoffs fitnesses are given by appendix a 2a w h e 1 u 1 p 1 p 1 u 1 h e 2 u 2 p 2 p 2 u 2 h 2b w m f 1 v 1 p 1 q 1 v 1 m f 2 v 2 p 2 q 2 v 2 m for herbivores and mutualists respectively here e i f i are herbivore mutualist payoffs when feeding on plant i in order to obtain analytical results useful for this paper we assume fixed herbivore and mutualist densities this assumption requires that consumer dynamics are limited by factors different from plant resources such as predators availability of nesting sites etc this makes h and m critical parameters i e independent variables that modify the feedbacks between plant dynamics and consumer preferences which in turn determine plant coexistence and plant animal interaction topologies our results are presented in the following sections specifically in section 3 we employ methods from evolutionary game theory hofbauer and sigmund 1998 to derive the optimal foraging strategies for herbivores and mutualists according to fitnesses 2 in section 4 we employ methods from the theory of dynamical systems e g local stability bifurcation analysis to study the coexistence between plants 1 and 2 table 1 lists our model variables parameters and numerical values used in simulations 3 herbivore and pollinator evolutionarily stable strategies at fixed plant population densities when herbivores and pollinators are adaptive foragers their preferences change in the direction that maximizes fitnesses given in 2 for given p 1 p 2 h and m we want to find evolutionarily stable strategies ess for herbivores and mutualists in appendix b we show that for the fitness function 2a the herbivore ess is given by 3 u 1 p 1 p 2 h 1 if p 2 e 1 p 2 p 1 e 2 p 1 h e 1 p 1 e 1 p 1 e 2 p 2 e 1 p 2 p 1 e 2 p 1 p 2 h e 1 p 1 e 2 p 2 if e 1 p 2 p 1 e 2 p 1 h p 2 e 1 p 2 h p 1 e 2 p 1 0 if p 2 e 1 p 2 h p 1 e 2 p 1 and the mutualist ess is given by 4 v 1 p 1 p 2 m 1 if p 2 f 1 q 2 p 1 f 2 q 1 m f 1 p 1 f 1 p 1 f 2 p 2 f 1 q 2 p 1 f 2 q 1 p 2 m f 1 p 1 f 2 p 2 if f 1 q 2 p 1 f 2 q 1 m p 2 f 1 q 2 m p 1 f 2 q 1 0 if p 2 f 1 q 2 m p 1 f 2 q 1 these optimal preferences show that the more abundant a plant is the more it attracts both herbivores and mutualists i e preferences are frequency dependent however there are minimum thresholds that must be met for a plant to attract animals at all these expressions also show that as herbivore mutualist population density increases u 1 v 1 converges to e 1 p 1 e 1 p 1 e 2 p 2 f 1 p 1 f 1 p 1 f 2 p 2 which corresponds to the proportional product of quality and quantity of resource 1 for herbivores mutualists table 2 lists all possible qualitatively different esss given by 3 and 4 for given herbivore h and pollinator m abundances the positive part of the plant abundance plane can be divided into five sectors that specify qualitatively different foraging preferences of herbivores h and mutualists m the sector boundaries for herbivores 5a i h 0 p 2 e 1 p 2 h e 2 p 1 p 1 5b i h 1 p 2 e 1 p 2 e 2 p 1 h p 1 and pollinators 5c i m 0 p 2 f 1 q 2 m f 2 q 1 p 1 5d i m 1 p 2 f 1 q 2 f 2 q 1 m p 1 are straight lines radiating from the origin as shown in fig 1 these lines are called isolegs in the optimal foraging literature e g rosenzweig 1986 rosenzweig and abramsky 1986 revilla and křivan 2018 in the sector between i h 0 and i h 1 isolegs herbivores are generalists i e 0 u 1 1 and optimal herbivore preferences given in 3 change continuously with p 1 and p 2 we call this sector the cone of herbivore generalism from here onward in the region above the cone of generalism above i h 0 isoleg in fig 1 herbivores specialize exclusively on plant 2 i e u 1 0 and in the region below the cone i e below i h 1 isoleg in fig 1 they specialize on plant 1 i e u 1 1 for mutualists isolegs i m 0 and i m 1 define the corresponding cone of mutualist generalism fig 1 shows that there are four qualitative arrangements for herbivore and mutualist cones of generalism the cones do not overlap fig 1a they overlap partially fig 1b the herbivore s cone lies within the mutualist s cone fig 1c or the mutualist s cone lies within the herbivore s cone fig 1d as foragers densities increase their cones of generalism get wider and overlaps of the two cones become more likely different arrangements of cones give rise to different combinations of herbivore and mutualist preferences that modify plant population dynamics which in turn modify herbivore and mutualist preference as we will see in the next sections 4 plant population dynamics in this section we study plant population dynamics first we assume that herbivore and pollinator preferences for plants are fixed i e animals are inflexible consumers this leads to the classic lotka volterra plant population dynamics second we consider the case where animals are adaptive foragers that change their preferences so as to maximize their fitness we assume that these adaptations are very fast when compared to population dynamics so that animal preferences track instantaneously plant population densities 4 1 plant dynamics with fixed animal preferences when herbivore and pollinator preferences are fixed system 1 becomes the lotka volterra lv competition model that has a trivial equilibrium 0 0 and two single plant i e monoculture equilibria p 1 0 q 1 0 and 0 p 2 0 q 2 where plants reach their environmental carrying capacities 6 q i k i 1 m i p i u i h g i r i v i m q i v i m a plant s carrying capacity increases with mutualist preference and density v i m and decreases with herbivore preference and density u i h a plant is viable at given herbivore and mutualist densities if q i is positive i e when 7 g i r i v i m q i v i m m i p i u i h and not viable otherwise we observe that plant viability requires that the plant growth rate which is the sum of the plant vegetative growth rate and the growth rate due to pollination must be larger than plant mortality caused by herbivory in particular a necessary condition for plant i viability obtained for v i m tending to infinity in 7 is g i r i m i p i u i h furthermore mutualism is facultative if g i m i p i i e when in absence of herbivory u i h 0 a plant overcomes mortality solely by vegetative growth on the contrary if m i p i g i mutualism is obligate for the plant i e vegetative growth alone is not enough to compensate mortality even without herbivory u i h 0 provided 7 holds for i 1 2 a plant community equilibrium is at the intersection of the plant isoclines 1 1 by isoclines we mean non trivial ones trivial isoclines p 1 0 and p 2 0 are considered only implicitly 8a p 1 c 2 p 2 q 1 8b p 2 c 1 p 1 q 2 and such coexistence is globally stable if each plant can invade the other s monoculture i e when both monoculture plant equilibria 0 q 2 and q 1 0 are unstable the invasion conditions for plant 1 and 2 are respectively 9a q 1 c 2 q 2 9b q 2 c 1 q 1 from these conditions 10 c 1 c 2 1 that is interpreted as intra specific competition is stronger than inter specific if invasibility conditions in 9 hold the stable plant coexistence equilibrium is 11 p ˆ 1 p ˆ 2 q 1 c 2 q 2 1 c 1 c 2 q 2 c 1 q 1 1 c 1 c 2 if opposite inequalities in 9 hold c 1 c 2 1 the equilibrium is unstable and plant population dynamics are bi stable depending on the initial conditions plant 1 or plant 2 wins the competition reaches its carrying capacity and the other plant goes extinct if 9a holds but 9b does not plant 1 excludes plant 2 vice versa if 9b holds but 9a does not plant 2 excludes plant 1 the last two cases show that 10 is necessary but not sufficient for stable coexistence in the next section we consider adaptive herbivores and mutualists that maximize their fitnesses 4 2 plant population dynamics with adaptive animal preferences for the rest of this article we assume that herbivores preferences u i given in 3 and mutualists preferences v i given in 4 track current plant population densities instantaneously and we substitute these formulas in plant population dynamics 1 the resulting model is highly non linear and analytical formulas for equilibria and stability are very complex expressions thus we study the dynamics of the interaction network using numerical methods fig 2 shows the dependence of the interaction network topology on herbivore and mutualist densities this figure assumes that inter specific competition between plants is weaker than intra specific competition i e the inequality in 10 holds and both plants coexist at a single stable state in absence of herbivores and pollinators h m 0 in the dark shaded region of the plot both plant monocultures are viable because parameters are such that inequality in 7 holds for both plants plant 1 monoculture which has a slightly higher r 1 0 022 when compared to plant 2 r 2 0 02 is also viable in the light shaded region where plant 2 monoculture goes extinct in the white region the negative effect of herbivory overweighs the positive effect of mutualism and neither plant monoculture survives however as we see this does not mean that the two plants cannot coexist when they are together e g see the upper right white region gg where both plans coexist stable plant coexistence is possible in 15 out of total 17 regions shown in fig 2 at one two or three alternative stable states that are labeled according to interaction patterns listed in table 2 these labels indicate preference of herbivores the symbol at the first position and mutualists the symbol at the second position for plants at the corresponding stable plant equilibrium animal generalism is indicated by g following the convention introduced in table 2 for example g1 means that herbivores are generalists and mutualists specialize on plant 1 at the corresponding plant equilibrium these labels also indicate the interaction topology see fig 1 there are two regions where plant coexistence is not possible in region e the negative effect of herbivory on plants is too strong when compared to the positive effect of mutualism and plants go globally extinct this is because the density of herbivores when compared to density of mutualists is too high in the region denoted by b in fig 2 either plant 1 or plant 2 is excluded depending on initial conditions and herbivores and mutualists specialize on the surviving monoculture we observe that most regions allow plant coexistence at several alternative stable states e g in the region denoted by g1 g2 gg plants coexistence is possible at three different stable states here g1 means that at the plant equilibrium herbivores are generalists feeding on both plants while pollinators specialize on plant 1 at equilibrium g2 herbivores are generalists while mutualists specialize on plant 2 and at equilibrium gg both herbivores and mutualists are generalists at which of these alternative equilibria plants settle depends on initial conditions see the next section fig 2 suggests that the number of states at which plants can coexist is highest and equal to three at intermediate densities of herbivores and mutualists when herbivore and mutualist densities are very low the number of stable states tends to be one or two with at least one specialist consumer e g regions 22 11 22 11 g2 or g1 g2 when herbivore and mutualist densities are large enough plants coexist at a single stable state where both consumers are generalist gg region and where neither of the two plants can survive at positive densities without the other plant being present since model 1 is two dimensional we can use phase plane analysis to gain insights about plant community dynamics when herbivores and mutualists preferences for plants quickly adapt to changes in plant densities for this purpose we graph the plant isoclines 8 with u i and v i given in 3 and 4 respectively in formulas 6 in the following paragraph we describe the general features of the isoclines and we illustrate plant population dynamics at herbivores and mutualists densities marked with x in fig 2 fig 3 displays global dynamics at 9 points marked by x in fig 2 the nonlinear dependence of herbivore 3 and mutualist 4 preferences on plant densities leads to nonlinear isoclines that are defined separately at each sector in marginal sectors that are adjacent to the axes i e below isolegs i h 1 and i m 1 or above isolegs i h 0 and i m 0 corresponding isocline segments are linear and given by the lotka volterra model because animal preferences are either 1 or 0 there i e u 1 v 1 1 or u 1 v 1 0 plant i 1 2 isocline meets the p i axis at p i q i denoted by diamond symbols in fig 3 given by eq 6 between isolegs i e within the cones of generalism one or both of animal preferences for plants u 1 and v 1 given in 3 are nonlinear functions of plant densities and the corresponding isocline segments are polynomial curves of degree 2 or 3 like with the lv model plant p i has positive net growth d p i d t 0 in the positive part of the p 1 p 2 plane bounded by its isocline and p i axes and negative net growth d p i d t 0 outside stable unstable plant equilibria are denoted by dots circles first we observe that unlike the lv competition model with fixed animal preferences where plants can only coexist at a single equilibrium for our choice of parameters nonlinear isoclines allow multiple plant equilibria see panels a g in fig 3 coexistence of multiple stable states implies that the fate of the system depends on initial conditions and not knowing this information it cannot be predicted where the system will converge to in particular the priority effect young et al 2001 will have a strong effect on the community composition the priority effect is due to adaptive mutualism which causes strong competition for pollination services that favors resident or abundant plants e g agricultural crops see holzschuh et al 2011 in detriment to rarer plants e g invaders we also observe that besides multiple stable states where both plant species coexist there are stable equilibria with one plant only panels d and g in fig 3 second we observe the effect of herbivores and mutualists on plant monoculture equilibrium densities denoted by the diamond symbol on the axes in fig 3 it is obvious that the negative effect of herbivores on plant monocultures is much stronger than is the positive effect of mutualists this already follows from formula 6 which shows that plant population densities linearly decrease as herbivore density increases while the positive effect of mutualists on plant densities is saturating thus when mutualists are abundant an increase in their density will have a negligible effect on plant density e g cf fig 3d vs fig 3g third we observe facilitation effects of one plant on the other at the stable coexistence equilibrium e g figs 3f h indeed in these panels the plant densities at the gg equilibrium are higher when compared with their monoculture densities such facilitation effect requires herbivore generalism so that both plants share the costs of herbivory and also mutualist generalism so that neither plant is the sole winner of mutualist benefits thus facilitation happens at plant equilibria that are in the overlap of herbivore and mutualist cones of generalism i e a gg equilibrium point when extreme levels of herbivory turn monocultures nonviable i e 7 does not hold the facilitation effect is the only mean by which plants can persist at all e g panel i fig 3 also shows how plant population dynamics determines plant animal interaction topologies i e consumer preferences for example figs 3e f display qualitatively similar plant dynamics with three coexistence equilibria however at the two equilibria that are dominated by one of the two plants interaction dynamics differ between the two panels while in panel e herbivores specialize on the more abundant plant at these two equilibria they generalize in panel f this is because herbivore density is higher in panel f and generalism of herbivores prevents one plant to be excluded which in turn increases herbivore fitness in the next section we examine the dependence of stable plant equilibria on herbivore and mutualist densities 4 2 1 effect of adaptive herbivory on plant densities fig 4 shows dependence of plant 1 top panel and plant 2 bottom panel equilibrium densities along the herbivore gradient when mutualist density is fixed at m 0 4 this corresponds to moving along the vertical dotted line in fig 2 solid dotted lines denote stable unstable equilibria in general plant densities decrease with increasing herbivore density which is expected from the antagonistic relationship between plants and herbivores for example monocultures decrease linearly with h according to eq 6 exceptions happen when herbivores or mutualists specialize on a single plant as we describe next at very low herbivore density both monocultures are stable against invasion and the system is bi stable this is evident from fig 4 that shows stable monoculture equilibria solid q1 and q2 respectively and one line of unstable equilibria starting at h 0 dotted line which corresponds to the unstable equilibrium in fig 3d plant 1 plant 2 monoculture becomes invasible i e unstable indicated by dashes at the branching point bp1 bp2 in fig 4 where an interior stable plant equilibrium at which both animals specialize on plant 1 on plant 2 branches from q1 q2 these branches are straight lines given by 6 with u 1 v 1 1 11 line or u 1 v 1 0 22 line and they correspond to lv equilibria on marginal sectors adjacent to the axes e g fig 3e the branching point bp1 h 0 4 lies on the boundary between regions 22 gg and 11 22 1g in fig 2 whereas bp2 h 0 058 lies on the boundary between 1g and 22 1g as h increases further plant 1 experiences more herbivory but plant 2 none so that the equilibrium density of plant 1 decreases while that of plant 2 increases at h 0 932 this equilibrium reaches i h 1 isoleg 5b where herbivores become generalists i e interaction topology changes to g1 from this point on both plants are affected by herbivory and both equilibria densities decrease until they disappear at h 1 667 denoted as ep1 in fig 4 the circle in fig 4 denotes the point at which herbivores switch from plant 1 specialization to generalism this point corresponds to herbivore density on the boundary between regions 11 g2 gg and g1 g2 gg in fig 2 in the case of branch line 22 that describes the interior plant equilibria where both animals specialize on plant 2 equilibrium density of plant 2 decreases while density of plant 1 increases with h but unlike the switch in interaction topology from 11 to g1 described before we observe a gap between lines denoted by 22 and g2 at limit point lp1 where h 0 717 the 22 equilibrium hits the i m 0 isoleg 5b and this equilibrium vanishes then at limit point lp2 where h 0 879 the isoclines intersect again within the herbivore s cone of generalism and the equilibrium g2 appears until the joint extinction of plants due to herbivory at h 1 533 denoted as ep2 limit point lp1 lies on the boundary between regions 11 22 gg and 11 gg in fig 2 whereas lp2 lies on the boundary between 11 gg and 11 g2 gg finally we have the third line of stable plant coexistence where mutualists are generalist this line starts at the limit point h 0 022 denoted as lp3 where the dynamic turns from bi stable i e region b in fig 2 e g fig 3d to locally stable coexistence with herbivores specializing on plant 1 i e line 1g like in the case of equilibrium line 11 plant 1 decreases with h while plant 2 increases until this equilibrium crosses the i h 1 isoleg at h 0 097 and herbivores become generalist i e the gg line starts indicated with the open circle from this point on both plants decrease with h until joint extinction at h 2 288 denoted as ep3 4 2 2 effect of adaptive mutualism on plant densities fig 5 shows dependence of plant 1 top panel and plant 2 bottom panel equilibrium densities along the mutualist gradient when herbivore density is fixed at h 1 1 which corresponds to moving along the horizontal dotted line in fig 2 solid dotted lines denote stable unstable equilibria monocultures are viable for m 0 167 in the case of plant 1 q 1 line and for m 0 2 in the case of plant 2 q 2 line when condition 7 holds they are unstable against invasion by the missing plant and increase with diminishing returns as m increases to infinity according to 6 we observe three lines of stable coexistence g1 g2 and gg the g1 line starts at the extinction point m 0 139 denoted as ep1 where mutualist density is insufficient to compensate for herbivory for similar reasons line g2 starts at m 0 167 denoted as ep2 these equilibria branches terminate at limit point m 0 519 lp1 for g1 or m 0 457 lp2 for g2 since then on plant coexistence is possible along the gg branch where both animals are generalists which starts at the limit point lp3 where m 0 287 which is connected to branch g1 by an unstable branch i e dots connecting lp3 to lp1in fig 5 thus at the current herbivore density h 1 1 mutualists turn generalist when their densities are large enough or specialists on plant 1 or 2 when their densities are low enough fig 5 also shows that plants can attain larger densities when together compared with their monocultures this happens for both plants along the whole gg branch only for plant 1 along a part of the g1 branch where m 0 333 or only for plant 2 along the whole g2 branch this is due to the indirect facilitation when herbivores are generalists both plant densities increase along branch gg since both benefit from increased level of mutualism however both plants also increase along branches g1 and g2 despite mutualist specialization in g1 as mutualists specialize on plant 1 plant 1 density increases with m because plant 1 gets more pollination but also more herbivory as herbivores preference for plant 1 increases this decreases herbivory on plant 2 which can also increase with m this mechanism operates along the g2 branch too mutatis mutandis the plant monopolizing mutualists increases faster with m i e d p 1 d m d p 2 d m along g1 and d p 2 d m d p 1 d m along g2 we observe that as mutualist density increases the number of alternative stable coexistence states increases from 0 for m 0 139 to 1 for 0 139 m 0 167 to 2 for 0 167 m 0 287 to 3 for 0 287 m 0 457 for yet higher mutualist densities the number of coexistence stable states decreases to a single one for m 0 519 5 discussion in this article we study direct and indirect interactions between two competing plants that are mediated by shared herbivores and pollinators both called consumers here we consider plant population dynamics under the assumption that consumer density is fixed but preferences for plants are adaptive and maximize consumer fitness while without consumers plants can coexist at most at a single equilibrium we show that adaptive consumer behavior promotes plant coexistence at alternative stable states through apparent plant facilitation which increases plant densities above those that each plant can achieve when alone we also show that decrease in insect i e consumer population densities can lead to unpredictable patterns of plant extinction interaction webs are driven by direct e g direct feeding of predators on their prey and indirect interactions e g trophic cascades hairston et al 1960 apparent competition holt 1977 all these interactions are caused by changes in population densities it has been argued schmitz et al 2004 that interactions caused by changes in animal behavior even when population densities stay constant i e trait mediated interactions can cause effects of similar or even larger magnitude such effects can be either direct i e direct trait mediated interactions or indirect for a review see bolker et al 2003 in this article we study two indirect trait mediated interactions between two competing plant populations mediated by changes in foraging preferences of shared pollinators and herbivores understanding effects of trait mediated interactions in model systems is important because in reality it is often impossible to separate trait and density mediated interactions e g in plant communities sharing a common herbivore both trait and density mediated interactions will occur while density mediated apparent competition between plants is detrimental to plant coexistence because an increase in one plant density increases population density of the herbivore which in turn exerts a negative effect on the other plant the trait mediated indirect interactions caused by changes in herbivore preference for the more abundant plant promotes plant coexistence and we call this trait mediated facilitation it was shown that such apparent facilitation can be stronger than apparent competition and lead to plant coexistence in two resource single consumer system křivan 1997 the other trait mediated interaction in our interaction network is mediated by adaptive pollinator preferences for plants as one plant density increases pollinator preference for this plant increases which is detrimental for the other plant that receives less pollination we call this trait mediated apparent competition in this article we developed a new plant herbivore pollinator model where the plants supply one resource for pollinators e g pollen or nectar and a different resource for herbivores e g leaves this extends the mechanism used in previous papers to model resource for services mutualisms revilla 2015 revilla and křivan 2016 2018 to the realm of exploitative interactions e g resource for antagonism this causes resource competition schoener 1978 within the herbivore and within the pollinator populations which are the driving forces behind adaptation towards specialization or generalism in foraging preferences when pollinator and herbivore densities are fixed as well as their preferences for either plant plant dynamics are described by the classic lotka volterra competition model where either both plants coexist only one plant survives or the model is bi stable in that the fate of the system depends on the history the situation dramatically changes when both herbivore and pollinator foraging preferences for plants are adaptive so that consumers maximize their fitnesses at current plant population densities as mentioned before trait mediated interactions via herbivore adaptation tends to equalize plant densities and promotes plant coexistence on the other hand mutualist adaptation works in the opposite direction i e positive feedbacks between preferences and population densities increase competitive asymmetries between plants mougi and kondoh 2014 revilla and křivan 2016 and promote exclusion of one plant by the other when these two mechanisms are considered together it is difficult to predict which mechanism i e trait mediated facilitation or competition will drive the system with two animal consumers the preferences of one of them can drive plant population dynamics in directions that affect the preference of the other consumer and vice versa we show that the chain of indirect feedbacks between plants and animals creates a rich set of population dynamics where plants can attain coexistence at up to three alternative stable states fig 3 adaptive mutualism tends to increase differences in plant abundances by specialization on the more common plant which leads to alternative stable states this was also observed in interaction modules with two plants and mutualists revilla and křivan 2016 2018 křivan and revilla 2019 on the other hand adaptive herbivory tends to prevent competitive exclusion by steering preferences towards common plants and away from rare which are at risk of extinction by fixing animal densities we remove indirect density mediated effects such as apparent competition holt 1977 and facilitation feinsinger 1987 but frequency dependent effects mediated by animal preferences remain and can be analyzed the joint effects of density and trait mediated interactions are more difficult to study because the number of variables involved increases i e 4 species densities we know that for two prey and one predator adaptive foraging counteracts apparent competition e g křivan 1996 1997 and for two plants and one pollinator competition for plant resources promotes pollinator generalism which allows plant plant facilitation revilla and křivan 2016 in both situations antagonistic or mutualistic the growth of consumer populations promotes their generalism which in turn promotes the stability of plant communities for the reasons discussed in previous paragraphs our results highlight the importance that trait mediated interactions can have for plant coexistence this has important implications in current times of insect declines hallmann et al 2017 and large scale perturbations of pollination services holzschuh et al 2011 geslin et al 2017 caused by human activities we can hypothesize that the decrease of insect populations leads to regimes of alternative states caused by adaptive specialization as a result predictability of plant insect dynamics becomes difficult some alternative states can be very unbalanced in plant abundances e g coexistence states denoted by 11 and 22 in fig 3e making species loss easier as a result of small perturbations on the other hand management policies that sustain reasonably large and diverse insect populations would promote their generalism in such conditions the provision of mutualistic services is favorable for a large number of plant species and potential pests can be kept in check by the dynamic control by herbivores credit authorship contribution statement tomás a revilla conceived the study model analysis manuscript writing thomas marcou model analysis manuscript revision vlastimil křivan model analysis manuscript writing declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments we thank two anonymous reviewers for comments and suggestions this project has received funding from the european union s horizon 2020 research and innovation programme under grant agreement no 955708 project evogamesplus evolutionary games and population dynamics from theory to applications appendix a model derivation herbivore f i leaves and mutualist r i nectar or pollen resources of plant i 1 2 follow supply consumption dynamics a 1 d f i d t π i p i ω i f i u i α i f i h d r i d t σ i p i λ i r i v i β i r i m where p i is plant population density π i and σ i represent production supply e g leafing nectar secretion rates per plant and λ i and ω i are non consumptive decay rates e g falling withering re absorption herbivores mutualists with population density h m consume resources with specific rates α i β i and relative preference 0 u i 1 u 1 u 2 1 for plant i we consider plant p i population dynamics a 2 d p i d t g i p i ρ i v i β i r i m 1 p i c j p j k i μ i f i p i p i i 1 2 where the growth rate g i p i ρ i v i β i r i m consists of two terms the first term corresponds to growth without mutualism with vegetative rate g i the second term links plant growth to consumption of mutualistic resources r i in a 1 by means of the constant ρ i that translates pollination to seed numbers plant i experiences intra specific competition and inter specific competition from plant j according to the competition coefficient c i k i is the density of plant p i at which competition results in zero recruitment of new plants in order to relate plant mortality with consumption of herbivore resources f i in a 1 we assume that mortality increases with the intensity of defoliation caused by the herbivores a simple and convenient way to state this dependency is by making intrinsic mortality inversely proportional to foliar biomass per plant f i p i with a proportionality constant μ i under the assumption that foliage is evenly distributed among individual plants now we assume that the turnover of plant resources is fast and they instantaneously track plant population densities i e d f i d t 0 and d r i d t 0 in a 1 which yields a 3 f i π i p i ω i u i α i h r i σ i p i λ i v i β i m substituting these expressions in a 2 leads to the system of two differential equations 1 studied in the main text where we group r i ρ i σ i m i μ i α i π i p i ω i α i q i λ i β i next animal payoffs when feeding on plant i are measured by the instantaneous plant consumption rate multiplied by conversion factors ϵ i ϕ i for herbivores pollinators for example herbivore payoff when feeding on plant 1 only is ϵ 1 α 1 f 1 animal fitnesses are then defined as mean animal payoffs a 4 w h ϵ 1 u 1 α 1 f 1 ϵ 2 u 2 α 2 f 2 w m ϕ 1 v 1 β 1 r 1 ϕ 2 v 2 β 2 r 2 for herbivores and pollinators respectively substituting expressions a 3 into a 4 leads to herbivore and mutualists fitnesses 2 in the main text grouping e i ϵ i π i f i ϕ i σ i appendix b evolutionarily stable strategy let us consider herbivores and their fitness function 2a in a population where u 1 h herbivores forage on plant 1 and u 2 h 1 u 1 h on plant 2 the payoffs that an herbivore gets from interaction with plant 1 or plant 2 are a 5 u 1 u 1 e 1 p 1 p 1 u 1 h u 2 u 1 e 2 p 2 p 2 1 u 1 h these payoffs depend on plant densities herbivore densities and herbivore preferences the herbivore with preference u 1 for plant 1 in a resident population with preference u 1 obtains fitness given by the average payoff a 6 w h u 1 u 1 u 1 u 1 u 1 1 u 1 u 2 u 1 the optimal preference u 1 is calculated as the nash equilibrium ne for the fitness function a 6 at an interior i e generalist ne the two payoffs a 5 must be the same i e u 1 u 2 which yields u 1 e 1 p 1 e 1 p 1 e 2 p 2 e 1 p 2 p 1 e 2 p 1 p 2 h e 1 p 1 e 2 p 2 provided 0 u 1 1 if u 1 u 1 u 2 u 1 u 1 u 1 u 2 u 1 for all 0 u 1 1 the ne and the only evolutionary outcome is u 1 1 u 1 0 because for u 1 u 1 w h u 1 u 1 w h u 1 u 1 e 1 p 1 p 2 1 u 1 h e 2 p 2 p 1 u 1 h 2 h e 1 p 1 e 2 p 2 p 2 1 u 1 h p 1 u 1 h 0 the interior nash equilibrium u 1 is also resistant to mutant invasions i e w h u 1 u 1 w h u 1 u 1 for all strategies u 1 u 1 and it is an evolutionarily stable strategy hofbauer and sigmund 1998 thus u 1 p 1 p 2 h 1 if p 2 e 1 p 2 p 1 e 2 p 1 h e 1 p 1 e 1 p 1 e 2 p 2 e 1 p 2 p 1 e 2 p 1 p 2 h e 1 p 1 e 2 p 2 if e 1 p 2 p 1 e 2 p 1 h p 2 e 1 p 2 h p 1 e 2 p 1 0 if p 2 e 1 p 2 h p 1 e 2 p 1 which is function 3 in the main text making appropriate changes of symbols and using fitness function 2b instead we can derive function 4 for the mutualists in the main text 
24592,conducting a thermodynamic analysis of a plant community can be an approach to macro ecology that emphasizes not only the diversity and abundances of plant species but also the exchange of matter and energy among species within the community and that with its physical and biological environment the experimental data used for the test were obtained from an ecological restoration project implemented at a manganese tailing site the relations derived from the maximal discrete entropy theorem show that the maximum entropy will increase with increase in the total number of species n suggesting that n has an upper limit n m at a habitat subject to its heterogeneity in physical conditions and species resource in its surrounding areas as an important macroscopic property of an ecosystem n is the number of species that are present at a habitat while its upper limit n m is the potential number of species that have been or can be adapted to the physical conditions of the habitat and can thus possibly be present at the habitat as a function of the maximum entropy ln n is applied as a biodiversity index as an upper limit of ln n ln n m can be regarded as a biodiversity potential index as it takes into account the available number of species distributed in the surrounding areas of the habitat showing the potential limit for further increase in its biodiversity following the thermodynamic laws given that there is no further change in system enthalpy h h 0 the equilibrium number of species n eq can be found at the point n 0 and n m can be determined by n m n eq 2 the restoration of the investigated plant community was shown to be an irreversible process characterized by spontaneous increases in its total biomass and total number of plant species associated with increases in its enthalpy gibbs free energy and entropy the analytical results gave support to the argument that the internal energy factors of a plant community are functions of its productivity and biodiversity and the difference between ln n and ln n m determines its internal energy distribution graphical abstract measured ln n versus 1 c t curve for determination of n eq and n m n total number of species c t total biomass quantity n eq equilibrium n n m maximum n image graphical abstract keywords ecological restoration thermodynamic factors maximum entropy maximum number of species equilibrium number of species spontaneous changes 1 introduction a plant community is an open system consisting of living species as material components that obtain their energy from photosynthesis known as autotrophs at the bottom trophic level of the energy pyramid ricklefs and relyea 2014 conducting a thermodynamic analysis of a plant community can thus be an approach to macro ecology that emphasizes not only the diversity and abundances of plant species but also the exchange of matter and energy among species within the community and that with its physical and biological environment a number of studies has been carried out on eco exergy jørgensen 2010 jørgensen and nielsen 2007 buonocore et al 2020 and entropy based indicators laner et al 2017 ludovisi 2014 ludovisi and scharler 2017 zhang et al 2020 as a matter of fact the conventional approach related to entropy is the introduction of the shannon form of information entropy to ecology molles 2016 pueyo et al 2007 being presented as a function of species richness and abundance the shannon form of information entropy has been directly applied as a biodiversity index known as the shannon wiener index ricklefs and relyea 2014 based on information entropy an ecological niche modeling software named the maximum information entropy model maxent has been established to serve multiple purposes including prediction of species abundance distribution harte et al 2009 phillips et al 2006 white et al 2012 wiltshire and tanner 2020 identification of key state variables getz et al 2018 detection of early warning signals ewss clements and ozgul 2018 and assessment of wildfire environment relationship parisien and moritz 2009 based on the fact that the maxent model has often produced accurate predictions though it is a null model without explicit mechanisms o dwyer et al 2017 harte and newman 2014 efforts have been made on its extension as a potential foundation for development of ecological theory harte et al 2008 combined with a state variable approach a theoretical framework named the maximum entropy theory of ecology mete has been proposed and tested for predicting the biodiversity scaling metrics in macro ecology newman et al 2014 harte et al 2015 xiao et al 2015 the fundamental basis for the shannon wiener index maxent and mete is a probability distribution function according to harte and newman 2014 the term entropy refers to information entropy rather than thermodynamic entropy it is thus necessary to review their original connections with thermodynamic theories following the logic way of thinking that the maxent model can help identifying the mechanisms in ecology that matter most harte and newman 2014 clarifying both the connection and distinction between information entropy and thermodynamic entropy can be a meaningful approach to support the development in ecological theories the connection between abundance and body size has been extensively studied with attempts to quantify its form white et al 2007 and to understand its significance in regulating the productivity diversity or biodiversity ecosystem functioning relationship storch et al 2018 loreau 2012 and the trade off effect ferraro and gagliostro 2017 body size and species abundance are the two primary determinants of metabolism that determines both the quantity and distribution of matter and energy stored by an ecosystem study on the internal energy state of an ecosystem can provide a new angle for analyzing the size abundance relationship and related phenomena following the rapid development in systems ecology jørgensen et al 2016 notte et al 2017 hall et al 2018 patten and fath 2018 wu et al 2017 presented a simple thermodynamic model for evaluating the ecological restoration effect on a manganese tailing wasteland as the biomass mental uptake enthalpy h gibbs free energy g entropy s and the number of naturally germinated plant species of the plant community all increased in its restoration process wu et al 2018 argued that the traditional criterion g 0 applied in fundamental physical chemistry would no longer be valid as a spontaneity index for description of a growing plant community in their efforts to identify the key mechanisms that govern the changes in internal energy distribution wu et al 2018 noticed that the plant community possessed a trend of increase in the ratio of s to h associated with a decrease in the ratio of g to h towards increase in its biomass quantity and biodiversity this is in agreement with the mete theory that the changes in species richness and abundance of an ecosystem play important roles in determining the metabolic energy flow and distribution of the system in their analysis on internal energy ratios wu et al 2018 also noticed that there are two characteristic values of the total number of species n at respectively two specific states of which one is its upper limit n m and the other one is a critical value n c at the interception point g h ts h 1 2 wu et al 2018 suggested that n c could possibly be a critical index to indicate the arrival of a steady state for the growth and development of a plant community the present study is focused on discussions of the essential connections among n n m and n c and their significances in ecology and thermodynamics 2 theoretical 2 1 maximum entropy of a plant community the gibbs free energy g is related to enthalpy h entropy s temperature t molar mass quantity of the ith component c i and its chemical potential μ i by 1 g h ts g i c i μ i i 1 2 3 n the chemical potential is defined as a partial derivative of g i with respect to c i 2 μ i g i c i μ i 0 r t ln x i μ i 0 r t ln 1 x i where r denotes the gas constant μ i 0 stands for the standard chemical potential of the ith component and x i is the ratio of c i to the total molar quantity of the system c t engel and reid 2006 combining eqs 1 and 2 and using h f and s to denote h rt g rt and s r respectively to eleminate the temperature effect the conventional functions can be transformed to the following forms for a plant community consisting of n plant species 3 f g r t h r t t s r t h s c i μ i 0 r t c i ln 1 x i 4 h h r t c i μ i 0 r t 5 s s r c i ln 1 x i the mass ratio x i is an important factor connecting μ i to system composition or to n wu et al 2018 have confirmed the general validity of the basic relationship between μ i and x i described by eq 2 the enthalpy factor h is independent of x i while the entropy factor s and gibbs free energy factor f are both functions of x i subject to the following constraint 6 x i 1 x i c i c t 1 c t c i c i c ij j 1 2 m i where c ij denotes the mass quantity of the jth plant of the ith species and m i denotes the total number of the individual plants of the ith plant species for simplicity in comparison the shannon form of the information entropy si can be expressed in the following natural logarithm form 7 si p i ln p i p i ln 1 p i i 1 2 n subject to the constraint 8 p i 1 p i m i m m m i where m denotes the total number of individual plants of the plant community and p i stands for the relative abundance of the ith species molles 2016 dividing the thermodynamic entropy factor s by c t eq 5 becomes 9 s c t 1 c t c i ln 1 x i c i c t ln 1 x i x i ln 1 x i the mathematical expression of s c t is an analogy of si with similar constraints defined respectively by eqs 6 and 8 the mathematical procedure for determining the function that yields the constrained maximum information entropy is the method of lagrange multipliers for applying the maximal discrete entropy theorem we can have a function f based on eqs 7 and 8 f p 1 p 2 p n p i ln p i λ p i 1 where λ is a lagrange multiplier taking the partial derivative of f with respect to each p i and letting f p i p i p i ln p i λ p i 1 0 will yield n differential equations in the same form ln p i 1 λ 0 or ln p i λ 1 this indicates that given n the condition for si to reach its maximum is p i p j p n e λ 1 meaning that all n species have the same p i value since p i p j implies that m i m j m m i n where m denotes the mean m i we obtain 10 p i m i m i m n m p 1 n the maximum information entropy will be 11 s i m p i ln 1 p i 1 n ln n ln n as p i 1 at n 1 si 0 and the definition range of si is 0 si ln n it follows logically that the condition for s to reach its maximum will be x i x j since x i x j means that c i c j c c i n c t n where c denotes the mean c i we also obtain 12 x i x j c i c i c n c x 1 n on substitution the maximum s will be 13 s c i ln 1 x i c i ln n ln n c i c t ln n s m the connection between s m and si m will be 14 s m c t s i m ln n as x i 1 at n 1 s 0 the definition range of s c t is also 0 s c t ln n the increase in si or s c t towards ln n is apparently a process of increase in species evenness in terms of species abundance or body size which suggests that an ecosystem may possess a potential trend towards increase in its species evenness the necessary condition for s c t si is x i p i which demands that the biomass quantity of all individual plants are identical namely c i c j c such that c i c i m i c m i c m i m thus for a system without significant difference in body size among individuals s c t does not differ from the commonly applied biodiversity index si with respect to both their concepts and magnitudes equation 14 shows that both s m c t and si m are maximums only under given n conditions and as a linear function of ln n they will increase with increasing n this leads to a logical argument that the real upper limit of these two entropy factors may be linked to a maximum number of species n m 2 2 maximum number of species the total biomass of a plant community c t and biomass ratio x i are calculated respectively by c t c i and x i c i c i implying that c i and c j are additive subject to an important condition that c i and c j are given in equivalent quantities disregarding the difference between species i and j this requires that the biomass of different plant species has the same quality in terms of standard chemical potential namely μ i 0 μ j 0 wu et al 2018 strictly speaking this usually is not true since there will be more or less difference in biomass quality among different plants grown under different site conditions to solve this problem a simple solution for determining c t and x i is to use a weighted average μ for species i by introducing a weight factor γ i and let μ i 0 γ i μ 0 then eq 4 can be simplified to h c i μ i 0 r t c i γ i μ 0 r t μ 0 r t c i γ i μ 0 r t c γ i μ 0 r t c γ t where cγ i c i γ i stands for the weighted or equivalent mass quantity of the ith species and cγ t c i γ i is the total equivalent mass quantity of the system if the difference in mass quality among species can be ignored such that γ i γ j 1 and 15 μ i 0 μ j 0 μ 0 we have c i c i γ i c t cγ t and 16 h c γ t μ 0 r t c t μ 0 r t for simplicity eq 16 subject to eq 15 is applied in the present study since given t μ 0 rt is a constant using k as a constant parameter we can write μ 0 r t ln k then eq 16 can be expressed as h c t μ 0 r t c t ln k based on eq 13 at the point s s m we have 17 f h s m c t μ 0 r t ln n c t ln k ln n c t ln k n if n k ln k n 0 f 0 and s reaches its upper limit h which accordingly suggests that k is the upper limit of n namely k n m then we obtain 18 μ 0 r t ln n m and 19 h c t μ 0 r t c t ln n m in agreement with the maximal discrete entropy theorem eqs 18 and 19 define n m as the theoretical limit of n at s h and f 0 the general validity of eq 19 demands convincible answears to at least the following three questions i why the ratio of μ 0 to rt is related to the maximum number of species or in general to the maximum number of mass components of a thermodynamic system ii whether or not there should be such a theoretical limit and iii how to determine it if it does exsit the explanation referring to the first question is simple equation 17 shows that μ 0 rt is a dimensionless constant linked to ln n expressing μ 0 rt as ln k gives a physical meaning to k as a parameter of n the term h defined by eq 4 is a mass quantity factor consisting of f and s when part of h is present as s c tln n the remaining part of h will be f c t ln k n c t ln n m n the answear to the second question is relatively complicated as there are numbers of factors that affect n the internal energy state of a plant community will be subject to at least four basic factors habitat area solar energy input nutrient availabilty and matter and enrgy transformation capacity of the plant community because of the competition for space energy and nutrient among different species the number of species n of a plant community at a given habitat can hardly go to inifinite and thus theoretically there has to be an upper limit of n among all possible constraints competition for available space may be one of the basic mechanisms that determine the limit of n this should hold true for all open thermodynamic systems the term body size c i refers to biomass weight or volume of a species at a community level if c i is given on volume base the number of components that a system could possibly hold should be limited by its space volume v for an ecosystem if we ignore the height dimension effect though the effect can be significant e g competition for sunlight its area a will become the limiting factor that determines the potential number of the inhabited species the condition given body size for a to be a limiting factor implies that given a body size can become the factor that matters it is known that matter is made of particles at different organization levels each component molecule compond or species existed as an entity has a defined structure dimension under given temperature and pressure conditions if the defined structures were broken the components as their orginal entities would no longer exist from c c t n we see that given c t the average mass quantity c will decrease with increasing n the reason for c t to become a limiting factor given a is still a space effect as increasing c t can lead to a stronger competition among components for available space though a and c t are two important limitng factors n does not necessarily increase with either a or c t simply because n c t and a are three mutually independent variables apart from the competition for available living space many other sophisticated mechanimsms including the effect of symbiosis the functions of keystone species and the availability of species resource etc can play important roles in determining the species composition in reality n can remain unchanged no matter how great c t and a are unless new species appear in or old species desappear from the system therefore in addition to space limitation species resource is another key factor that matters most ecologists may have to pay more attention to system dieversity since conservation of species is a hot topic of gloable interest the concepts of n and n m are clear and concrete the differenence between them is that n is a variable while n m is a constant parameter that defines the variation range of n as 1 n n m theoretically once a habitat is given n m should be in principle more or less a fixed value uniquely determined by the nature of the habitat related to its heterogeneity or diversity in physical conditions at a given habitat n may be found to change with time while n m as the upper limit of n should remain constant generally speaking n is the number of plant species that are currently present at a habitat while n m is the potential number of plant species that have been or can be adapted to the physical conditions of the habitat and can thus possibly be present in the area as a function of ln 1 x n is a factor subject to both physical and biological interactions at a habitat as a function of μ 0 rt however n m is a physical environment dependent parameter similar to the concept of fundamental niche n m as an upper limit of n takes into account the number of species that could persist at a habitat with no biological interactions under the assumption that there were neither formation of new species nor extinction of existed species in an isolated region under concern we could write an expression for conservation of species for the region 20 n total n system n surroundings constant d n total d t 0 subjec to a surroundings a region a system 0 n surroundings n surroundings n system surroundings 0 this equa tion shou ld be remo ved this equa tion shou ld also be remo ved where t denotes time n surroundings is the number of species that are only present in the surroundings n system surroundings is the number of species that are distributed in both the system and its surroundings and n total stands for the total number of species existed in both the system area a system and its effective surrounding area a surroundings subjec to the assumption made for eq 20 for the region n total will be a t independent parameter as an important parameter n total defines not only the level of species richness for the region but also the potential availability of species resource for the concerned system area since only those species that have been or can be adapted to the physical conditions of a habitat can survive at the habitat using n m to denote the number of such species for the system subject to n surroundings 0 we have 21 n total n m n system living species can expand their territories by various effective means of multiplication if there were no other limiting factors a plant species could spread its individuals over the entire region through either seed or vegetative reproduction equation 21 shows thus the potential trend of increasing n towards n m it is noted from eq 20 that the number of different species is additive thus as important macroscopic properties of a system n and n m are capacity factors in comparison the concepts of ln n and ln n m are relatively abstract since at s s m f h s m c t ln n m c t ln n the precise definitions of ln n ln n m and l n n m n will be f c t h c t s m c t ln n m ln n ln n m n which shows that unlike n and n m ln n and ln n m are intensity factors it is necessary to mention that for a given h we may have different h values for systems that possess different n m values a higher h does not necessarily mean a higher h as h is related to μ 0 while h is related to μ 0 r t ln n m given c t a higher h corresponds to a higher weighted standard chemical potential of the mass components while a higher h corresponds to a higher species richness potential of the system the values of ln n and ln n m do not dtermine the levels of h g and s but the distribution of h as g and ts or that of h as f and s which implies that the internal energy distribution is a function of productivity and biodiversity in accordance with the concept of s i m s m c t ln n applied as a biodiversity index for an ecosystem ln n m can be regarded as a biodiversity potential index as it takes into account the available numbers of species distributed in the effective surrounding areas of the system showing thus the potential limit for further increase in its biodiversity as an ideal species richness index for a region n total can be determined through regional investigations for a given system area under study however n m n total since n m is a potential limit that may never be reached in reality its real value is unknown theoretically there can be a connection between n m and a critical n at a specific system state determination of the critical n e g at a quasi steady state may offer a proper mean to obtain a relative n m value 2 3 equilibrium number of plant species application of g 0 as spontaneity and equilibrium indexes for a reaction in fundamental physical chemistry brown et al 2006 engel and reid 2006 is subject to a basic constraint h 0 such application is thus only valid for reactions taking place in either isolated systems or closed systems under isothermal condions wu et al 2018 ecosystems are open systems characterized by exchanges of both matter and energy with their surroundings in accordance with the basic laws of thermodynamics h g and ts of a growing plant community will all increase resulting in h 0 g 0 and ts 0 wu et al 2018 thus g 0 can no longer be valid as a spontaneity indicator for an ecological process and neither can g 0 be applied as an equilibrium index since h 0 indicates that the system state is changing while g 0 gives ts h 0 changes can continue until ts 0 by definition ln n m is a constant and h 0 corresponds to h 0 or c t 0 given t the relation c c t n shows that given c t both n and c can vary until n 0 thus subject to h 0 the condition n 0 is also a crucial criterion for judging if a system has reached an equilibrium state the equilibrium n to be denoted as n eq in later discussions can be found at a site where the number of inhabited species remains unchanged then a question reamins that if or not there will be futher changes in a plant community at the point h 0 n 0 and n neq wu et al 2018 presented the following relation by dividing eq 3 by h rt g r t h r t 1 s r h r t g h 1 ts h f h 1 s h based on eqs 3 5 and 19 f h and s h can be expressed as a single function of x i f h 1 s h 1 c i ln 1 x i c t ln n m 1 x i ln 1 x i ln n m considering a special case in which the enthalpy h stored in net biomass forms by a plant community is evenly distributed as g and ts namely g ts or f s we have 23 f h s h x i ln 1 x i ln n m s c t h c t 1 2 which gives 24 f c t s c t x i ln 1 x i 1 2 ln n m showing that ln nm is equal to 2 x i ln 1 x i at the point f s since x i varies among species the condition for x i ln 1 x i to be a fixed value at the point f s needs to be determined assuming that f i s i for the ith species we have f i s i c i μ i r t c i ln 1 x i c i μ i r t ln 1 x i 0 since c i 0 the condition for f i s i 0 will be μ i r t ln 1 x i 0 as μ i 0 r t μ i r t ln 1 x i we get μ i r t ln 1 x i 1 2 μ i 0 r t then subject to eq 15 μ i 0 μ j 0 μ 0 and eq 18 μ 0 r t ln n m we have 25 μ i r t ln 1 x i 1 2 μ i 0 r t 1 2 μ 0 r t 1 2 ln n m from eqs 24 and 25 we see that ln 1 x i at f i s i is equal to x i ln 1 x i at f s s c t x i ln 1 x i ln 1 x i 1 2 ln n m as the condition for f i s i is ln 1 x i 1 2 μ 0 the condition for f s will demand that the relation holds for all species namely μ i r t ln 1 x i μ j r t ln 1 x j 1 2 μ 0 r t it is seen that the above relation actualy defines a very specific condition under which eqs 12 and 13 hold namely x i x j x 1 n and s c t s m c t ln n s c t x i ln 1 x i s m c t ln 1 x ln n 1 2 ln n m then at f s eq 24 becomes 26 f c t s c t x i ln 1 x i ln 1 x ln n c 1 2 ln n m where nc denotes n at the critical point f s the criteria h 0 and n 0 actually indicate that a plant community has reached an external equilibrium with its surroundings under h 0 and n 0 conditions however the internal changes crossing species in a plant community can continue just as various reactions among components of a thermodynamic system can take place under isolated conditions according to the third law of thermodynamics increase in entropy in an isolated system is a spontaneous process namely s isolated 0 engel and reid 2006 a system that has reached an external equilibrium with its surroundings can be considered as an isolated system thus given h 0 and n 0 if s s m s will have a potential trend to increase resulting in s 0 and f s 0 since in the process n remains constant namely n n eq the internal changes can only possibly be caused by an increase in s associated with a decrease in f towards the direction to reduce the difference in internal energy or net biomass distribution among species for a plant species we have h i f i s i the transformation between system f and s given h and n will be an ecological process characterized by a decrease in h i of the ith species with a higher c i value accompanied by an equal increase in h j of the jth species with a lower c j value until all h i or c i values are equalized such that h i h j and f s s m at the point c i c j c since there is no other driving mechanisms for further increase in s after s reaches s m changes in both s and f will be zero namely f s 0 this implies that given h 0 n 0 and thus n n eq the critical point f s is the internal equilibrium point and that n eq is the critical n c from eq 26 we obtain the connection between n m and n eq 27 n m n c 2 n eq 2 the state f s is a theoretical point that may not be found in reality existence of such a potential trend of increasing s towards s m at n n eq does not mean that s could really reach s m the key mechanism that yields such trend can possibly be the competition among species for available matter and energy sources which in principle should be ultimately determined by the integrated function of the ecological niches of the inhibited species thus the real equilibrium or steady state may be arrived at a point at which s s m since however the equilibrium neq can be found at a site where the number of the inhibited species remains unchanged n m can be estimated by eq 27 using n eq despite that the observed s may be lower than s m 3 methods 3 1 applied remediation measures the experimental site under study was a manganese tailing wasteland located at xiangtan hunan china the site was poor in nitrogen and phosphorus but very high in contents of manganese lead zinc copper cadmium and chromium the applied remediation strategy was a combination of the commonly applied methods using metal tolerant species tree species and remediation reagent two fast growing tree species paulownia fortunei and koelreuteria bipinnata screened from the native species naturally distributed in the uncontaminated region nearby the tailing site were used as dominant phyto remediation species before transplanting their seedlings an organic bacteri rich manure prepared for the tailing site was amended to their rhizospheric areas the enrichment of the site s biodiversity was counted on natural germination of the native metal tolerant plant species based on the soil seed bank theory tang et al 2006 to prevent the spread of metal contamination to surrounding areas an ecological interception belt along the border of the tailing site was established using a constructed wetland technology for purification of runoff detailed experimental information refers to ouyang et al 2016 and wu et al 2017 2018 some of the background information are briefly described below 3 2 experimental plots and sample analyses the total experimental area was 4 4 hectares consisting of three plots i 4 0 hm2 manganese tailing site amended with an organic manure as a base fertilizer to increase the nutrient availability and reduce the metal toxicity in the rhizosphere before transplanting one year old seedlings of paulownia fortunei koelreuteria bipinnata spacing 2 2 5m 1000 plants of each species hm2 ii 0 2 hm2 manganese tailing site amended with equivalent amounts of chemical fertilizers in the rhizosphere before transplanting one year old seedlings of the same tree species spacing 2 2 5m 1000 plants of each species hm2 and iii 0 2 hm2 uncontaminated site in the vicinity of the tailing wasteland a plant community naturally developed under normal soil conditions plant and soil samples were collected from three fixed standard blocks approximately 667 m2 each in each plots in june and october each year from 2010 to 2016 and analyzed following standard procedures gb15618 1995 gb3838 2002 gb18918 2002 people s republic of china the numbers of individual plant and plant species were counted on site the relative standard deviations in duplicate sample analyses ranged between 8 4 16 4 in biomass measurement and 5 1 18 3 in metal uptake determination the average values were used for further calculation the differences in related values between treatment plots were compared with lsd analysis of variance 3 3 calculation the largest number of plant species 66 was obtained from the plant community naturally developed in the non polluted surrounding area of the mining region changes in both c t and n of the plant community in the later investigated years satisfied approximately the condition c t 0 and n 0 the number 66 can thus be regarded as n eq for the mining region considering that nm is a constant parameter and use of any nm value will not affect the trend of change in h r t the number 66 had been directly used as nm for comparison in earlier studies wu et al 2018 in the present study the s factor is determined by eq 5 using the measured net dry biomass data based on eq 27 using 66 as n eq the h and f factors are calculated respectively by 28 h c t ln n m c t ln 66 2 29 f h s c t ln 66 2 c i ln 1 x i 4 results and analysis 4 1 observed changes the changes in the total net dry biomass c t total number of species n and related thermodynamic factors h f and s of the plant communities in plots i amended with organic manures ii amended with chemical fertilizers and iii uncontaminated site during the period 2010 2016 are given in table 1 the total uptake quantities of the measured metals for year 2016 are given in table 2 the differences in the entropy factor s i among species between years 2015 and 2016 are compared in fig 1 as a record of restoration history of the plant communities the presented data show the dynamic changes in their ecological and thermodynamic states the effect of the applied restoration method has been discussed in previous papers wu et al 2017 2018 some of the results are briefly summarized below i the applied restoration method had not only enhanced the biomass growth and heavy metal uptake of the plant community but also enriched its species composition tables 1 and 2 in the later period the total dry biomass quantity total metal uptake and total number of species in plot i were all several folds greater than those in plot ii and their differences were highly significant p 0 01 ii the species enrichment in both plots i and ii after land preparation was attributed to the natural germination of native metal tolerant species from the soil seed inventory while the difference in n between plots was mainly caused by the applied remediation methods the transplanted p fortunei and k bipinnata did not survive under the metal contaminated conditions in plot ii iii the highest number of plant species was 66 found in plot iii for the plant community naturally developed under uncontaminated soil conditions table 1 the c t value of plot iii was lower than that of plot i and the difference was attributed to the contribution of the transplanted p fortunei and k bipinnata in plot i the total uptake quantities of all measured metals table 2 were very low in plot iii showing that the metal toxicity was not the factor limiting the plant growth in this plot iv the calculated values of h s and f all increased with time in both plots i and ii table 1 in contrast the s c t ratio increased while the f c t ratio decreased with increasing n in both plots the s c t ratio was positively correlated with ln n at high level of significance in both plots i the squared correlation coefficient r2 0 9449 and ii r2 0 9950 v the significant differences in c t n table 1 and that in s i between years 2015 and 2016 in both plots i fig 1a and ii fig 1b p 0 01 indicated that the plant communities in the two plots were still undergoing fast development in contrast the displayed patterns of s i in plot iii between years 2015 and 2016 are nearly overlapped with a few exceptions fig 1c the total number of species n in plot iii remained unchanged table 1 while the relative deviations in c t between the two years were low being 8 28 which was in an acceptable range of random errors resulted from sampling and analysis plot iii had been a preserved area in the metal mining region for more than 20 years the experimental data obtained from plot iii satisfied approximately the conditions c t 0 and n 0 suggesting that the plant community in plot iii had reached a relatively steady state the number 66 can thus be taken as n eq for the experimental site 4 2 contribution of plant species the contributions of the transplanted species p fortunei and k bipinnata to relevant indexes in plots i and iii are compared in table 3 using the data obtained from year 2016 these two species were shown to be fast growing tree species with high growth and metal uptake rates under the improved site conditions the sum of their number of individual plants in plot i was only 0 104 of that of the restored plant community while the sum of their net dry biomass quantity mn uptake and land coverage contributed respectively 84 77 67 63 and 56 30 to the plant community the high contribution percentage of the two species to s h and f further showed their importance in matter and energy transformation and conservation the two species are not the dominant species under natural conditions in this region and their contributions to all listed indexes were much lower in plot iii than in plot i table 3 another phenomenon depicted in fig 2 was that the contribution percentages of the two transplanted species to c t fig 2a and m fig 2b decreased while those of the other species increased with increasing n in the investigated period the contribution percentages of the two species to c t and m are equal to the sum of their x i biomass ratio and p i individual number ratio values given in percentage respectively the curves in fig 2 thus show clearly the negative effect of species richness and abundance on x i and p i of the transplanted species 4 3 potential limit of species number the changes in the total number of species n with time are illustrated in fig 3 a for both plots i and ii the dotted line the hypothetically extended line following smoothly the slope of the measured curve shows the potential trend of increase in n in plot i towards the point 66 in approximately the 16th year after transplanting p fortunei and k bipinnata the dotted line however is still increasing at the point 66 suggesting that 66 is not the upper limit of n and that the n value in plot i may continue to increase in later years the dotted line in fig 3a shows that plot ii also possesses a potential trend of increasing n towards higher levels but the slope of the curve is much lower compared to that for plot i if there were no differences in site conditions it would be reasonable to assume that plots i ii and iii possess the same potential limit of n since they share the same regional species resource the metal contaminated site condition had apparently prevented the increase in n in plot ii at the point s s m c t ln n f c t ln n m n eq 29 can be transformed to 30 ln n ln n m f 1 c t s m c t showing that ln n can be expressed as a function of 1 c t with ln n m as the intercept and f as the slope the ln n versus 1 c t curve is not linear because its slope f also changes with 1 c t the intercept ln n m however is by definition a constant and can be determined at the point at which the curve intercepts the ln n axis as 1 c t approaches zero or theoretically c t approaches infinite the observed ln n versus 1 c t curves in fig 3b for plot i show the trend of increasing ln n towards approximately the point 4 19 ln 66 on the ln n axis on the early plant community growth and development stage 7 years after transplanting the effect of competitive mutual exclusion has not become significant it is thus reasonable to see in fig 3 that the number of species in plot i got closer and closer to 66 since plots i and iii share the same regional species resource using the relation n m n eq 2 the ln n m n or f c t curve can be determined by ln 66 2 n which as shown in fig 3b is a symmetrical curve inversely related to ln n in comparison the potential limit for ln n shown in fig 3b for plot ii is much lower if 66 should also be used as n eq for plot ii a much longer time of period would be expected to take for its n to reach 66 5 discussions 5 1 spontaneous changes because of matter and energy input the growth and development of a plant community should be in principle a natural process characterized by spontaneous increases in its total biomass quantity c t and total number of plant species n the total enthalpy h gibbs free energy g and entropy s of a plant community are state functions all positively related to c t and n their increments h g and s will be greater than zero subject to c t 0 and n 0 such changes shown by the experimental data in table 1 thus follow the 1st law of thermodynamics in contrast the observed decrease in f c t associated with the increase in s c t with increasing n table 1 obeys the 2nd law of thermodynamics that the spontaneous change in the internal energy state of a system is an irreversible process towards only the direction of decrease in its intensity factor engel and reid 2006 for a given system ln n and ln n m are intensity factors related to the average chemical potential μ weighted standard chemical potential μ 0 and average mass ratio x respectively by f c t h c t s m c t μ r t μ 0 r t ln 1 x ln n m ln n given temperature t ln n m or μ 0 rt is a constant while increasing n will reduce x since x 1 n we shall have x 0 and μ 0 as long as n 0 indicating that the change in the state of an ecosystem is essentially a spontaneous process of species enrichment that leads to the decease in μ the observed changes in s c t and f c t table 1 also obey the 3rd law of thermodynamics regarding the principle of entropy increase engel and reid 2006 as been discussed in the theoretical section there can be two spontaneous changes related to entropy increase of which one is increasing s with increasing n and the other one is increasing s towards s m at a given n the general trend of increasing s with increasing n is clearly seen in table 1 the decrease in the mass ratio of the transplanted species with increasing n illustrated in fig 2a shows the potential trend of increasing s towards s m the increase in the contribution of new species to the total biomass quantity c t reduced the difference between the peak x i and average x values in accordance with the maximum entropy theorem s s m at x i x j x 1 n s will get closer to s m subject to the constraint x i 1 the decrease in the individual number ratio of the transplanted species with increasing n illustrated in fig 2b also shows the potential trend of increasing si towards si m the increase in the contribution of new species to the total individual number of plants m reduced the difference between the peak p i and average p values in accordance with the maximum entropy theorem si si m at p i p j p 1 n si will get closer to si m subject to the constraint p i 1 the fact that increasing n is the essential cause for μ 0 makes n 0 a useful indicator for judging the spontaneity of an ecological process as it is technically convenient to observe the change in n in the field since the basic trend holds in general with no specific constraints the criterion n 0 should be a valid spontaneity index for determining the direction of spontaneous changes in all open thermodynamic systems with continuous input of matter and energy 5 2 internal equilibrium it is necessary to mention that h 0 is a necessary condition for n n c n eq at n 0 the number of species of an ecosystem can remain unchanged at different levels if h 0 meaning that c t 0 the state of the system will change and n n eq though n 0 theoretically it is f s subject to h 0 and n 0 that determines the internal equilibrium of a system developed under natural conditions for this reason eq 27 is only valid for a spontaneous process with no unnatural interferences because only under natural conditions increase in n and thus s of a system before arrival of its equilibrium is an irreversible process the transformation between g and ts or f and s should be a spontaneous process governed by changes in their intensity factors μ i rt and ln 1 x i from eq 2 for a system consisting of n species we can write μ i r t ln 1 x i μ i 0 r t n μ 0 r t μ 0 r t where μ 0 μ i 0 n showing that the weighted standard chemical potential is the average standard chemical potential of the n species given t and n nμ 0 rt is a constant and μ i rt will decrease with increasing ln 1 x i according to the principle of mass action for chemical reactions the chemical potentials of the reactants and products are equalized at equilibrium engel and reid 2006 as an analogy to a chemical reaction the equilibrium condition for the biological reactions taking place in a plant community that govern the transformation between g and ts will be μ i r t ln 1 x i 1 2 n μ 0 r t 1 2 μ 0 r t which subject to eq 15 μ i 0 μ j 0 μ 0 gives ln 1 x i ln 1 x j 1 2 μ 0 r t since at equilibrium ln 1 x i ln 1 x j corresponds to x i x j x 1 n eq and f s replacing μ 0 rt by ln n m we obtain the same solution for eq 27 based on the law of mass action ln 1 x ln n eq 1 2 μ 0 r t 1 2 ln n m this confirms that f s is the equilibrium point and eq 27 can be applied to determine n m it is noted that the ln n versus 1 c t curve fig 3b is a function defined by eq 30 that describes the productivity biodiversity relationship this indicates that the transformation between f and s is the mechanism in regulating the productivity biodiversity relationship 6 conclusions in accordance with the conventional laws of thermodynamics and ecology there are two characteristic values of the total number of species n at two specific states of a plant community of which one is its upper limit n m and the other one is the equilibrium number of species n eq given that there is no further change in system enthalpy h 0 n eq can be found at the point n 0 and n m can be determined by n m n eq 2 as an upper limit of ln n ln n m can be regarded as a biodiversity potential index as it takes into account the available number of species distributed in the surrounding areas of the habitat showing the potential limit for further increase in its biodiversity the change in the state of the restored plant community was an irreversible process characterized by spontaneous increase in c t and n associated with increase in its h g and s the observed trends of increasing n towards n m and increasing s towards s m indicated that the restored plant community possessed natural trends towards increase in both its species richness and evenness as a function of productivity and biodiversity the ln n versus 1 c t curve can be used for description of the internal energy distribution of a plant community credit author statement we all the authors have approved the revised paper for release and are in agreement with its content declaration of competing interest we all the authors have no competing interests to declare acknowledgement the present study forms part of the projects supported by the educational department of hunan province cx2016b341 the ministry of environmental protection 200909066 and the ministry of science and technology p r china 2012gs430203 
24592,conducting a thermodynamic analysis of a plant community can be an approach to macro ecology that emphasizes not only the diversity and abundances of plant species but also the exchange of matter and energy among species within the community and that with its physical and biological environment the experimental data used for the test were obtained from an ecological restoration project implemented at a manganese tailing site the relations derived from the maximal discrete entropy theorem show that the maximum entropy will increase with increase in the total number of species n suggesting that n has an upper limit n m at a habitat subject to its heterogeneity in physical conditions and species resource in its surrounding areas as an important macroscopic property of an ecosystem n is the number of species that are present at a habitat while its upper limit n m is the potential number of species that have been or can be adapted to the physical conditions of the habitat and can thus possibly be present at the habitat as a function of the maximum entropy ln n is applied as a biodiversity index as an upper limit of ln n ln n m can be regarded as a biodiversity potential index as it takes into account the available number of species distributed in the surrounding areas of the habitat showing the potential limit for further increase in its biodiversity following the thermodynamic laws given that there is no further change in system enthalpy h h 0 the equilibrium number of species n eq can be found at the point n 0 and n m can be determined by n m n eq 2 the restoration of the investigated plant community was shown to be an irreversible process characterized by spontaneous increases in its total biomass and total number of plant species associated with increases in its enthalpy gibbs free energy and entropy the analytical results gave support to the argument that the internal energy factors of a plant community are functions of its productivity and biodiversity and the difference between ln n and ln n m determines its internal energy distribution graphical abstract measured ln n versus 1 c t curve for determination of n eq and n m n total number of species c t total biomass quantity n eq equilibrium n n m maximum n image graphical abstract keywords ecological restoration thermodynamic factors maximum entropy maximum number of species equilibrium number of species spontaneous changes 1 introduction a plant community is an open system consisting of living species as material components that obtain their energy from photosynthesis known as autotrophs at the bottom trophic level of the energy pyramid ricklefs and relyea 2014 conducting a thermodynamic analysis of a plant community can thus be an approach to macro ecology that emphasizes not only the diversity and abundances of plant species but also the exchange of matter and energy among species within the community and that with its physical and biological environment a number of studies has been carried out on eco exergy jørgensen 2010 jørgensen and nielsen 2007 buonocore et al 2020 and entropy based indicators laner et al 2017 ludovisi 2014 ludovisi and scharler 2017 zhang et al 2020 as a matter of fact the conventional approach related to entropy is the introduction of the shannon form of information entropy to ecology molles 2016 pueyo et al 2007 being presented as a function of species richness and abundance the shannon form of information entropy has been directly applied as a biodiversity index known as the shannon wiener index ricklefs and relyea 2014 based on information entropy an ecological niche modeling software named the maximum information entropy model maxent has been established to serve multiple purposes including prediction of species abundance distribution harte et al 2009 phillips et al 2006 white et al 2012 wiltshire and tanner 2020 identification of key state variables getz et al 2018 detection of early warning signals ewss clements and ozgul 2018 and assessment of wildfire environment relationship parisien and moritz 2009 based on the fact that the maxent model has often produced accurate predictions though it is a null model without explicit mechanisms o dwyer et al 2017 harte and newman 2014 efforts have been made on its extension as a potential foundation for development of ecological theory harte et al 2008 combined with a state variable approach a theoretical framework named the maximum entropy theory of ecology mete has been proposed and tested for predicting the biodiversity scaling metrics in macro ecology newman et al 2014 harte et al 2015 xiao et al 2015 the fundamental basis for the shannon wiener index maxent and mete is a probability distribution function according to harte and newman 2014 the term entropy refers to information entropy rather than thermodynamic entropy it is thus necessary to review their original connections with thermodynamic theories following the logic way of thinking that the maxent model can help identifying the mechanisms in ecology that matter most harte and newman 2014 clarifying both the connection and distinction between information entropy and thermodynamic entropy can be a meaningful approach to support the development in ecological theories the connection between abundance and body size has been extensively studied with attempts to quantify its form white et al 2007 and to understand its significance in regulating the productivity diversity or biodiversity ecosystem functioning relationship storch et al 2018 loreau 2012 and the trade off effect ferraro and gagliostro 2017 body size and species abundance are the two primary determinants of metabolism that determines both the quantity and distribution of matter and energy stored by an ecosystem study on the internal energy state of an ecosystem can provide a new angle for analyzing the size abundance relationship and related phenomena following the rapid development in systems ecology jørgensen et al 2016 notte et al 2017 hall et al 2018 patten and fath 2018 wu et al 2017 presented a simple thermodynamic model for evaluating the ecological restoration effect on a manganese tailing wasteland as the biomass mental uptake enthalpy h gibbs free energy g entropy s and the number of naturally germinated plant species of the plant community all increased in its restoration process wu et al 2018 argued that the traditional criterion g 0 applied in fundamental physical chemistry would no longer be valid as a spontaneity index for description of a growing plant community in their efforts to identify the key mechanisms that govern the changes in internal energy distribution wu et al 2018 noticed that the plant community possessed a trend of increase in the ratio of s to h associated with a decrease in the ratio of g to h towards increase in its biomass quantity and biodiversity this is in agreement with the mete theory that the changes in species richness and abundance of an ecosystem play important roles in determining the metabolic energy flow and distribution of the system in their analysis on internal energy ratios wu et al 2018 also noticed that there are two characteristic values of the total number of species n at respectively two specific states of which one is its upper limit n m and the other one is a critical value n c at the interception point g h ts h 1 2 wu et al 2018 suggested that n c could possibly be a critical index to indicate the arrival of a steady state for the growth and development of a plant community the present study is focused on discussions of the essential connections among n n m and n c and their significances in ecology and thermodynamics 2 theoretical 2 1 maximum entropy of a plant community the gibbs free energy g is related to enthalpy h entropy s temperature t molar mass quantity of the ith component c i and its chemical potential μ i by 1 g h ts g i c i μ i i 1 2 3 n the chemical potential is defined as a partial derivative of g i with respect to c i 2 μ i g i c i μ i 0 r t ln x i μ i 0 r t ln 1 x i where r denotes the gas constant μ i 0 stands for the standard chemical potential of the ith component and x i is the ratio of c i to the total molar quantity of the system c t engel and reid 2006 combining eqs 1 and 2 and using h f and s to denote h rt g rt and s r respectively to eleminate the temperature effect the conventional functions can be transformed to the following forms for a plant community consisting of n plant species 3 f g r t h r t t s r t h s c i μ i 0 r t c i ln 1 x i 4 h h r t c i μ i 0 r t 5 s s r c i ln 1 x i the mass ratio x i is an important factor connecting μ i to system composition or to n wu et al 2018 have confirmed the general validity of the basic relationship between μ i and x i described by eq 2 the enthalpy factor h is independent of x i while the entropy factor s and gibbs free energy factor f are both functions of x i subject to the following constraint 6 x i 1 x i c i c t 1 c t c i c i c ij j 1 2 m i where c ij denotes the mass quantity of the jth plant of the ith species and m i denotes the total number of the individual plants of the ith plant species for simplicity in comparison the shannon form of the information entropy si can be expressed in the following natural logarithm form 7 si p i ln p i p i ln 1 p i i 1 2 n subject to the constraint 8 p i 1 p i m i m m m i where m denotes the total number of individual plants of the plant community and p i stands for the relative abundance of the ith species molles 2016 dividing the thermodynamic entropy factor s by c t eq 5 becomes 9 s c t 1 c t c i ln 1 x i c i c t ln 1 x i x i ln 1 x i the mathematical expression of s c t is an analogy of si with similar constraints defined respectively by eqs 6 and 8 the mathematical procedure for determining the function that yields the constrained maximum information entropy is the method of lagrange multipliers for applying the maximal discrete entropy theorem we can have a function f based on eqs 7 and 8 f p 1 p 2 p n p i ln p i λ p i 1 where λ is a lagrange multiplier taking the partial derivative of f with respect to each p i and letting f p i p i p i ln p i λ p i 1 0 will yield n differential equations in the same form ln p i 1 λ 0 or ln p i λ 1 this indicates that given n the condition for si to reach its maximum is p i p j p n e λ 1 meaning that all n species have the same p i value since p i p j implies that m i m j m m i n where m denotes the mean m i we obtain 10 p i m i m i m n m p 1 n the maximum information entropy will be 11 s i m p i ln 1 p i 1 n ln n ln n as p i 1 at n 1 si 0 and the definition range of si is 0 si ln n it follows logically that the condition for s to reach its maximum will be x i x j since x i x j means that c i c j c c i n c t n where c denotes the mean c i we also obtain 12 x i x j c i c i c n c x 1 n on substitution the maximum s will be 13 s c i ln 1 x i c i ln n ln n c i c t ln n s m the connection between s m and si m will be 14 s m c t s i m ln n as x i 1 at n 1 s 0 the definition range of s c t is also 0 s c t ln n the increase in si or s c t towards ln n is apparently a process of increase in species evenness in terms of species abundance or body size which suggests that an ecosystem may possess a potential trend towards increase in its species evenness the necessary condition for s c t si is x i p i which demands that the biomass quantity of all individual plants are identical namely c i c j c such that c i c i m i c m i c m i m thus for a system without significant difference in body size among individuals s c t does not differ from the commonly applied biodiversity index si with respect to both their concepts and magnitudes equation 14 shows that both s m c t and si m are maximums only under given n conditions and as a linear function of ln n they will increase with increasing n this leads to a logical argument that the real upper limit of these two entropy factors may be linked to a maximum number of species n m 2 2 maximum number of species the total biomass of a plant community c t and biomass ratio x i are calculated respectively by c t c i and x i c i c i implying that c i and c j are additive subject to an important condition that c i and c j are given in equivalent quantities disregarding the difference between species i and j this requires that the biomass of different plant species has the same quality in terms of standard chemical potential namely μ i 0 μ j 0 wu et al 2018 strictly speaking this usually is not true since there will be more or less difference in biomass quality among different plants grown under different site conditions to solve this problem a simple solution for determining c t and x i is to use a weighted average μ for species i by introducing a weight factor γ i and let μ i 0 γ i μ 0 then eq 4 can be simplified to h c i μ i 0 r t c i γ i μ 0 r t μ 0 r t c i γ i μ 0 r t c γ i μ 0 r t c γ t where cγ i c i γ i stands for the weighted or equivalent mass quantity of the ith species and cγ t c i γ i is the total equivalent mass quantity of the system if the difference in mass quality among species can be ignored such that γ i γ j 1 and 15 μ i 0 μ j 0 μ 0 we have c i c i γ i c t cγ t and 16 h c γ t μ 0 r t c t μ 0 r t for simplicity eq 16 subject to eq 15 is applied in the present study since given t μ 0 rt is a constant using k as a constant parameter we can write μ 0 r t ln k then eq 16 can be expressed as h c t μ 0 r t c t ln k based on eq 13 at the point s s m we have 17 f h s m c t μ 0 r t ln n c t ln k ln n c t ln k n if n k ln k n 0 f 0 and s reaches its upper limit h which accordingly suggests that k is the upper limit of n namely k n m then we obtain 18 μ 0 r t ln n m and 19 h c t μ 0 r t c t ln n m in agreement with the maximal discrete entropy theorem eqs 18 and 19 define n m as the theoretical limit of n at s h and f 0 the general validity of eq 19 demands convincible answears to at least the following three questions i why the ratio of μ 0 to rt is related to the maximum number of species or in general to the maximum number of mass components of a thermodynamic system ii whether or not there should be such a theoretical limit and iii how to determine it if it does exsit the explanation referring to the first question is simple equation 17 shows that μ 0 rt is a dimensionless constant linked to ln n expressing μ 0 rt as ln k gives a physical meaning to k as a parameter of n the term h defined by eq 4 is a mass quantity factor consisting of f and s when part of h is present as s c tln n the remaining part of h will be f c t ln k n c t ln n m n the answear to the second question is relatively complicated as there are numbers of factors that affect n the internal energy state of a plant community will be subject to at least four basic factors habitat area solar energy input nutrient availabilty and matter and enrgy transformation capacity of the plant community because of the competition for space energy and nutrient among different species the number of species n of a plant community at a given habitat can hardly go to inifinite and thus theoretically there has to be an upper limit of n among all possible constraints competition for available space may be one of the basic mechanisms that determine the limit of n this should hold true for all open thermodynamic systems the term body size c i refers to biomass weight or volume of a species at a community level if c i is given on volume base the number of components that a system could possibly hold should be limited by its space volume v for an ecosystem if we ignore the height dimension effect though the effect can be significant e g competition for sunlight its area a will become the limiting factor that determines the potential number of the inhabited species the condition given body size for a to be a limiting factor implies that given a body size can become the factor that matters it is known that matter is made of particles at different organization levels each component molecule compond or species existed as an entity has a defined structure dimension under given temperature and pressure conditions if the defined structures were broken the components as their orginal entities would no longer exist from c c t n we see that given c t the average mass quantity c will decrease with increasing n the reason for c t to become a limiting factor given a is still a space effect as increasing c t can lead to a stronger competition among components for available space though a and c t are two important limitng factors n does not necessarily increase with either a or c t simply because n c t and a are three mutually independent variables apart from the competition for available living space many other sophisticated mechanimsms including the effect of symbiosis the functions of keystone species and the availability of species resource etc can play important roles in determining the species composition in reality n can remain unchanged no matter how great c t and a are unless new species appear in or old species desappear from the system therefore in addition to space limitation species resource is another key factor that matters most ecologists may have to pay more attention to system dieversity since conservation of species is a hot topic of gloable interest the concepts of n and n m are clear and concrete the differenence between them is that n is a variable while n m is a constant parameter that defines the variation range of n as 1 n n m theoretically once a habitat is given n m should be in principle more or less a fixed value uniquely determined by the nature of the habitat related to its heterogeneity or diversity in physical conditions at a given habitat n may be found to change with time while n m as the upper limit of n should remain constant generally speaking n is the number of plant species that are currently present at a habitat while n m is the potential number of plant species that have been or can be adapted to the physical conditions of the habitat and can thus possibly be present in the area as a function of ln 1 x n is a factor subject to both physical and biological interactions at a habitat as a function of μ 0 rt however n m is a physical environment dependent parameter similar to the concept of fundamental niche n m as an upper limit of n takes into account the number of species that could persist at a habitat with no biological interactions under the assumption that there were neither formation of new species nor extinction of existed species in an isolated region under concern we could write an expression for conservation of species for the region 20 n total n system n surroundings constant d n total d t 0 subjec to a surroundings a region a system 0 n surroundings n surroundings n system surroundings 0 this equa tion shou ld be remo ved this equa tion shou ld also be remo ved where t denotes time n surroundings is the number of species that are only present in the surroundings n system surroundings is the number of species that are distributed in both the system and its surroundings and n total stands for the total number of species existed in both the system area a system and its effective surrounding area a surroundings subjec to the assumption made for eq 20 for the region n total will be a t independent parameter as an important parameter n total defines not only the level of species richness for the region but also the potential availability of species resource for the concerned system area since only those species that have been or can be adapted to the physical conditions of a habitat can survive at the habitat using n m to denote the number of such species for the system subject to n surroundings 0 we have 21 n total n m n system living species can expand their territories by various effective means of multiplication if there were no other limiting factors a plant species could spread its individuals over the entire region through either seed or vegetative reproduction equation 21 shows thus the potential trend of increasing n towards n m it is noted from eq 20 that the number of different species is additive thus as important macroscopic properties of a system n and n m are capacity factors in comparison the concepts of ln n and ln n m are relatively abstract since at s s m f h s m c t ln n m c t ln n the precise definitions of ln n ln n m and l n n m n will be f c t h c t s m c t ln n m ln n ln n m n which shows that unlike n and n m ln n and ln n m are intensity factors it is necessary to mention that for a given h we may have different h values for systems that possess different n m values a higher h does not necessarily mean a higher h as h is related to μ 0 while h is related to μ 0 r t ln n m given c t a higher h corresponds to a higher weighted standard chemical potential of the mass components while a higher h corresponds to a higher species richness potential of the system the values of ln n and ln n m do not dtermine the levels of h g and s but the distribution of h as g and ts or that of h as f and s which implies that the internal energy distribution is a function of productivity and biodiversity in accordance with the concept of s i m s m c t ln n applied as a biodiversity index for an ecosystem ln n m can be regarded as a biodiversity potential index as it takes into account the available numbers of species distributed in the effective surrounding areas of the system showing thus the potential limit for further increase in its biodiversity as an ideal species richness index for a region n total can be determined through regional investigations for a given system area under study however n m n total since n m is a potential limit that may never be reached in reality its real value is unknown theoretically there can be a connection between n m and a critical n at a specific system state determination of the critical n e g at a quasi steady state may offer a proper mean to obtain a relative n m value 2 3 equilibrium number of plant species application of g 0 as spontaneity and equilibrium indexes for a reaction in fundamental physical chemistry brown et al 2006 engel and reid 2006 is subject to a basic constraint h 0 such application is thus only valid for reactions taking place in either isolated systems or closed systems under isothermal condions wu et al 2018 ecosystems are open systems characterized by exchanges of both matter and energy with their surroundings in accordance with the basic laws of thermodynamics h g and ts of a growing plant community will all increase resulting in h 0 g 0 and ts 0 wu et al 2018 thus g 0 can no longer be valid as a spontaneity indicator for an ecological process and neither can g 0 be applied as an equilibrium index since h 0 indicates that the system state is changing while g 0 gives ts h 0 changes can continue until ts 0 by definition ln n m is a constant and h 0 corresponds to h 0 or c t 0 given t the relation c c t n shows that given c t both n and c can vary until n 0 thus subject to h 0 the condition n 0 is also a crucial criterion for judging if a system has reached an equilibrium state the equilibrium n to be denoted as n eq in later discussions can be found at a site where the number of inhabited species remains unchanged then a question reamins that if or not there will be futher changes in a plant community at the point h 0 n 0 and n neq wu et al 2018 presented the following relation by dividing eq 3 by h rt g r t h r t 1 s r h r t g h 1 ts h f h 1 s h based on eqs 3 5 and 19 f h and s h can be expressed as a single function of x i f h 1 s h 1 c i ln 1 x i c t ln n m 1 x i ln 1 x i ln n m considering a special case in which the enthalpy h stored in net biomass forms by a plant community is evenly distributed as g and ts namely g ts or f s we have 23 f h s h x i ln 1 x i ln n m s c t h c t 1 2 which gives 24 f c t s c t x i ln 1 x i 1 2 ln n m showing that ln nm is equal to 2 x i ln 1 x i at the point f s since x i varies among species the condition for x i ln 1 x i to be a fixed value at the point f s needs to be determined assuming that f i s i for the ith species we have f i s i c i μ i r t c i ln 1 x i c i μ i r t ln 1 x i 0 since c i 0 the condition for f i s i 0 will be μ i r t ln 1 x i 0 as μ i 0 r t μ i r t ln 1 x i we get μ i r t ln 1 x i 1 2 μ i 0 r t then subject to eq 15 μ i 0 μ j 0 μ 0 and eq 18 μ 0 r t ln n m we have 25 μ i r t ln 1 x i 1 2 μ i 0 r t 1 2 μ 0 r t 1 2 ln n m from eqs 24 and 25 we see that ln 1 x i at f i s i is equal to x i ln 1 x i at f s s c t x i ln 1 x i ln 1 x i 1 2 ln n m as the condition for f i s i is ln 1 x i 1 2 μ 0 the condition for f s will demand that the relation holds for all species namely μ i r t ln 1 x i μ j r t ln 1 x j 1 2 μ 0 r t it is seen that the above relation actualy defines a very specific condition under which eqs 12 and 13 hold namely x i x j x 1 n and s c t s m c t ln n s c t x i ln 1 x i s m c t ln 1 x ln n 1 2 ln n m then at f s eq 24 becomes 26 f c t s c t x i ln 1 x i ln 1 x ln n c 1 2 ln n m where nc denotes n at the critical point f s the criteria h 0 and n 0 actually indicate that a plant community has reached an external equilibrium with its surroundings under h 0 and n 0 conditions however the internal changes crossing species in a plant community can continue just as various reactions among components of a thermodynamic system can take place under isolated conditions according to the third law of thermodynamics increase in entropy in an isolated system is a spontaneous process namely s isolated 0 engel and reid 2006 a system that has reached an external equilibrium with its surroundings can be considered as an isolated system thus given h 0 and n 0 if s s m s will have a potential trend to increase resulting in s 0 and f s 0 since in the process n remains constant namely n n eq the internal changes can only possibly be caused by an increase in s associated with a decrease in f towards the direction to reduce the difference in internal energy or net biomass distribution among species for a plant species we have h i f i s i the transformation between system f and s given h and n will be an ecological process characterized by a decrease in h i of the ith species with a higher c i value accompanied by an equal increase in h j of the jth species with a lower c j value until all h i or c i values are equalized such that h i h j and f s s m at the point c i c j c since there is no other driving mechanisms for further increase in s after s reaches s m changes in both s and f will be zero namely f s 0 this implies that given h 0 n 0 and thus n n eq the critical point f s is the internal equilibrium point and that n eq is the critical n c from eq 26 we obtain the connection between n m and n eq 27 n m n c 2 n eq 2 the state f s is a theoretical point that may not be found in reality existence of such a potential trend of increasing s towards s m at n n eq does not mean that s could really reach s m the key mechanism that yields such trend can possibly be the competition among species for available matter and energy sources which in principle should be ultimately determined by the integrated function of the ecological niches of the inhibited species thus the real equilibrium or steady state may be arrived at a point at which s s m since however the equilibrium neq can be found at a site where the number of the inhibited species remains unchanged n m can be estimated by eq 27 using n eq despite that the observed s may be lower than s m 3 methods 3 1 applied remediation measures the experimental site under study was a manganese tailing wasteland located at xiangtan hunan china the site was poor in nitrogen and phosphorus but very high in contents of manganese lead zinc copper cadmium and chromium the applied remediation strategy was a combination of the commonly applied methods using metal tolerant species tree species and remediation reagent two fast growing tree species paulownia fortunei and koelreuteria bipinnata screened from the native species naturally distributed in the uncontaminated region nearby the tailing site were used as dominant phyto remediation species before transplanting their seedlings an organic bacteri rich manure prepared for the tailing site was amended to their rhizospheric areas the enrichment of the site s biodiversity was counted on natural germination of the native metal tolerant plant species based on the soil seed bank theory tang et al 2006 to prevent the spread of metal contamination to surrounding areas an ecological interception belt along the border of the tailing site was established using a constructed wetland technology for purification of runoff detailed experimental information refers to ouyang et al 2016 and wu et al 2017 2018 some of the background information are briefly described below 3 2 experimental plots and sample analyses the total experimental area was 4 4 hectares consisting of three plots i 4 0 hm2 manganese tailing site amended with an organic manure as a base fertilizer to increase the nutrient availability and reduce the metal toxicity in the rhizosphere before transplanting one year old seedlings of paulownia fortunei koelreuteria bipinnata spacing 2 2 5m 1000 plants of each species hm2 ii 0 2 hm2 manganese tailing site amended with equivalent amounts of chemical fertilizers in the rhizosphere before transplanting one year old seedlings of the same tree species spacing 2 2 5m 1000 plants of each species hm2 and iii 0 2 hm2 uncontaminated site in the vicinity of the tailing wasteland a plant community naturally developed under normal soil conditions plant and soil samples were collected from three fixed standard blocks approximately 667 m2 each in each plots in june and october each year from 2010 to 2016 and analyzed following standard procedures gb15618 1995 gb3838 2002 gb18918 2002 people s republic of china the numbers of individual plant and plant species were counted on site the relative standard deviations in duplicate sample analyses ranged between 8 4 16 4 in biomass measurement and 5 1 18 3 in metal uptake determination the average values were used for further calculation the differences in related values between treatment plots were compared with lsd analysis of variance 3 3 calculation the largest number of plant species 66 was obtained from the plant community naturally developed in the non polluted surrounding area of the mining region changes in both c t and n of the plant community in the later investigated years satisfied approximately the condition c t 0 and n 0 the number 66 can thus be regarded as n eq for the mining region considering that nm is a constant parameter and use of any nm value will not affect the trend of change in h r t the number 66 had been directly used as nm for comparison in earlier studies wu et al 2018 in the present study the s factor is determined by eq 5 using the measured net dry biomass data based on eq 27 using 66 as n eq the h and f factors are calculated respectively by 28 h c t ln n m c t ln 66 2 29 f h s c t ln 66 2 c i ln 1 x i 4 results and analysis 4 1 observed changes the changes in the total net dry biomass c t total number of species n and related thermodynamic factors h f and s of the plant communities in plots i amended with organic manures ii amended with chemical fertilizers and iii uncontaminated site during the period 2010 2016 are given in table 1 the total uptake quantities of the measured metals for year 2016 are given in table 2 the differences in the entropy factor s i among species between years 2015 and 2016 are compared in fig 1 as a record of restoration history of the plant communities the presented data show the dynamic changes in their ecological and thermodynamic states the effect of the applied restoration method has been discussed in previous papers wu et al 2017 2018 some of the results are briefly summarized below i the applied restoration method had not only enhanced the biomass growth and heavy metal uptake of the plant community but also enriched its species composition tables 1 and 2 in the later period the total dry biomass quantity total metal uptake and total number of species in plot i were all several folds greater than those in plot ii and their differences were highly significant p 0 01 ii the species enrichment in both plots i and ii after land preparation was attributed to the natural germination of native metal tolerant species from the soil seed inventory while the difference in n between plots was mainly caused by the applied remediation methods the transplanted p fortunei and k bipinnata did not survive under the metal contaminated conditions in plot ii iii the highest number of plant species was 66 found in plot iii for the plant community naturally developed under uncontaminated soil conditions table 1 the c t value of plot iii was lower than that of plot i and the difference was attributed to the contribution of the transplanted p fortunei and k bipinnata in plot i the total uptake quantities of all measured metals table 2 were very low in plot iii showing that the metal toxicity was not the factor limiting the plant growth in this plot iv the calculated values of h s and f all increased with time in both plots i and ii table 1 in contrast the s c t ratio increased while the f c t ratio decreased with increasing n in both plots the s c t ratio was positively correlated with ln n at high level of significance in both plots i the squared correlation coefficient r2 0 9449 and ii r2 0 9950 v the significant differences in c t n table 1 and that in s i between years 2015 and 2016 in both plots i fig 1a and ii fig 1b p 0 01 indicated that the plant communities in the two plots were still undergoing fast development in contrast the displayed patterns of s i in plot iii between years 2015 and 2016 are nearly overlapped with a few exceptions fig 1c the total number of species n in plot iii remained unchanged table 1 while the relative deviations in c t between the two years were low being 8 28 which was in an acceptable range of random errors resulted from sampling and analysis plot iii had been a preserved area in the metal mining region for more than 20 years the experimental data obtained from plot iii satisfied approximately the conditions c t 0 and n 0 suggesting that the plant community in plot iii had reached a relatively steady state the number 66 can thus be taken as n eq for the experimental site 4 2 contribution of plant species the contributions of the transplanted species p fortunei and k bipinnata to relevant indexes in plots i and iii are compared in table 3 using the data obtained from year 2016 these two species were shown to be fast growing tree species with high growth and metal uptake rates under the improved site conditions the sum of their number of individual plants in plot i was only 0 104 of that of the restored plant community while the sum of their net dry biomass quantity mn uptake and land coverage contributed respectively 84 77 67 63 and 56 30 to the plant community the high contribution percentage of the two species to s h and f further showed their importance in matter and energy transformation and conservation the two species are not the dominant species under natural conditions in this region and their contributions to all listed indexes were much lower in plot iii than in plot i table 3 another phenomenon depicted in fig 2 was that the contribution percentages of the two transplanted species to c t fig 2a and m fig 2b decreased while those of the other species increased with increasing n in the investigated period the contribution percentages of the two species to c t and m are equal to the sum of their x i biomass ratio and p i individual number ratio values given in percentage respectively the curves in fig 2 thus show clearly the negative effect of species richness and abundance on x i and p i of the transplanted species 4 3 potential limit of species number the changes in the total number of species n with time are illustrated in fig 3 a for both plots i and ii the dotted line the hypothetically extended line following smoothly the slope of the measured curve shows the potential trend of increase in n in plot i towards the point 66 in approximately the 16th year after transplanting p fortunei and k bipinnata the dotted line however is still increasing at the point 66 suggesting that 66 is not the upper limit of n and that the n value in plot i may continue to increase in later years the dotted line in fig 3a shows that plot ii also possesses a potential trend of increasing n towards higher levels but the slope of the curve is much lower compared to that for plot i if there were no differences in site conditions it would be reasonable to assume that plots i ii and iii possess the same potential limit of n since they share the same regional species resource the metal contaminated site condition had apparently prevented the increase in n in plot ii at the point s s m c t ln n f c t ln n m n eq 29 can be transformed to 30 ln n ln n m f 1 c t s m c t showing that ln n can be expressed as a function of 1 c t with ln n m as the intercept and f as the slope the ln n versus 1 c t curve is not linear because its slope f also changes with 1 c t the intercept ln n m however is by definition a constant and can be determined at the point at which the curve intercepts the ln n axis as 1 c t approaches zero or theoretically c t approaches infinite the observed ln n versus 1 c t curves in fig 3b for plot i show the trend of increasing ln n towards approximately the point 4 19 ln 66 on the ln n axis on the early plant community growth and development stage 7 years after transplanting the effect of competitive mutual exclusion has not become significant it is thus reasonable to see in fig 3 that the number of species in plot i got closer and closer to 66 since plots i and iii share the same regional species resource using the relation n m n eq 2 the ln n m n or f c t curve can be determined by ln 66 2 n which as shown in fig 3b is a symmetrical curve inversely related to ln n in comparison the potential limit for ln n shown in fig 3b for plot ii is much lower if 66 should also be used as n eq for plot ii a much longer time of period would be expected to take for its n to reach 66 5 discussions 5 1 spontaneous changes because of matter and energy input the growth and development of a plant community should be in principle a natural process characterized by spontaneous increases in its total biomass quantity c t and total number of plant species n the total enthalpy h gibbs free energy g and entropy s of a plant community are state functions all positively related to c t and n their increments h g and s will be greater than zero subject to c t 0 and n 0 such changes shown by the experimental data in table 1 thus follow the 1st law of thermodynamics in contrast the observed decrease in f c t associated with the increase in s c t with increasing n table 1 obeys the 2nd law of thermodynamics that the spontaneous change in the internal energy state of a system is an irreversible process towards only the direction of decrease in its intensity factor engel and reid 2006 for a given system ln n and ln n m are intensity factors related to the average chemical potential μ weighted standard chemical potential μ 0 and average mass ratio x respectively by f c t h c t s m c t μ r t μ 0 r t ln 1 x ln n m ln n given temperature t ln n m or μ 0 rt is a constant while increasing n will reduce x since x 1 n we shall have x 0 and μ 0 as long as n 0 indicating that the change in the state of an ecosystem is essentially a spontaneous process of species enrichment that leads to the decease in μ the observed changes in s c t and f c t table 1 also obey the 3rd law of thermodynamics regarding the principle of entropy increase engel and reid 2006 as been discussed in the theoretical section there can be two spontaneous changes related to entropy increase of which one is increasing s with increasing n and the other one is increasing s towards s m at a given n the general trend of increasing s with increasing n is clearly seen in table 1 the decrease in the mass ratio of the transplanted species with increasing n illustrated in fig 2a shows the potential trend of increasing s towards s m the increase in the contribution of new species to the total biomass quantity c t reduced the difference between the peak x i and average x values in accordance with the maximum entropy theorem s s m at x i x j x 1 n s will get closer to s m subject to the constraint x i 1 the decrease in the individual number ratio of the transplanted species with increasing n illustrated in fig 2b also shows the potential trend of increasing si towards si m the increase in the contribution of new species to the total individual number of plants m reduced the difference between the peak p i and average p values in accordance with the maximum entropy theorem si si m at p i p j p 1 n si will get closer to si m subject to the constraint p i 1 the fact that increasing n is the essential cause for μ 0 makes n 0 a useful indicator for judging the spontaneity of an ecological process as it is technically convenient to observe the change in n in the field since the basic trend holds in general with no specific constraints the criterion n 0 should be a valid spontaneity index for determining the direction of spontaneous changes in all open thermodynamic systems with continuous input of matter and energy 5 2 internal equilibrium it is necessary to mention that h 0 is a necessary condition for n n c n eq at n 0 the number of species of an ecosystem can remain unchanged at different levels if h 0 meaning that c t 0 the state of the system will change and n n eq though n 0 theoretically it is f s subject to h 0 and n 0 that determines the internal equilibrium of a system developed under natural conditions for this reason eq 27 is only valid for a spontaneous process with no unnatural interferences because only under natural conditions increase in n and thus s of a system before arrival of its equilibrium is an irreversible process the transformation between g and ts or f and s should be a spontaneous process governed by changes in their intensity factors μ i rt and ln 1 x i from eq 2 for a system consisting of n species we can write μ i r t ln 1 x i μ i 0 r t n μ 0 r t μ 0 r t where μ 0 μ i 0 n showing that the weighted standard chemical potential is the average standard chemical potential of the n species given t and n nμ 0 rt is a constant and μ i rt will decrease with increasing ln 1 x i according to the principle of mass action for chemical reactions the chemical potentials of the reactants and products are equalized at equilibrium engel and reid 2006 as an analogy to a chemical reaction the equilibrium condition for the biological reactions taking place in a plant community that govern the transformation between g and ts will be μ i r t ln 1 x i 1 2 n μ 0 r t 1 2 μ 0 r t which subject to eq 15 μ i 0 μ j 0 μ 0 gives ln 1 x i ln 1 x j 1 2 μ 0 r t since at equilibrium ln 1 x i ln 1 x j corresponds to x i x j x 1 n eq and f s replacing μ 0 rt by ln n m we obtain the same solution for eq 27 based on the law of mass action ln 1 x ln n eq 1 2 μ 0 r t 1 2 ln n m this confirms that f s is the equilibrium point and eq 27 can be applied to determine n m it is noted that the ln n versus 1 c t curve fig 3b is a function defined by eq 30 that describes the productivity biodiversity relationship this indicates that the transformation between f and s is the mechanism in regulating the productivity biodiversity relationship 6 conclusions in accordance with the conventional laws of thermodynamics and ecology there are two characteristic values of the total number of species n at two specific states of a plant community of which one is its upper limit n m and the other one is the equilibrium number of species n eq given that there is no further change in system enthalpy h 0 n eq can be found at the point n 0 and n m can be determined by n m n eq 2 as an upper limit of ln n ln n m can be regarded as a biodiversity potential index as it takes into account the available number of species distributed in the surrounding areas of the habitat showing the potential limit for further increase in its biodiversity the change in the state of the restored plant community was an irreversible process characterized by spontaneous increase in c t and n associated with increase in its h g and s the observed trends of increasing n towards n m and increasing s towards s m indicated that the restored plant community possessed natural trends towards increase in both its species richness and evenness as a function of productivity and biodiversity the ln n versus 1 c t curve can be used for description of the internal energy distribution of a plant community credit author statement we all the authors have approved the revised paper for release and are in agreement with its content declaration of competing interest we all the authors have no competing interests to declare acknowledgement the present study forms part of the projects supported by the educational department of hunan province cx2016b341 the ministry of environmental protection 200909066 and the ministry of science and technology p r china 2012gs430203 
24593,survival reproduction and detection rates may vary greatly amongst individuals failure to account for this variation results in biased inferences about age effects and population size however individual variation is not normally considered in population viability analysis potentially leading to misleading projections for small populations we present a novel data augmentation approach for incorporating individual variation in rates in integrated population models by adding rows to survival and reproduction matrices for hypothetical individuals in both the past and future inferences about individual variation derived from bayesian hierarchical modelling are propagated into population projections we apply this method to a small reintroduced population of hihi notiomystis cincta at bushy park new zealand where individuals vary greatly in reproductive success longevity and detection probability and ongoing management decisions depend on modelling projections we compare the results to those from an alternative model that ignores individual variation but incorporates sex and age effects the modelling confirmed pronounced individual variation in all rates and greatly altered their interpretation estimated survival and reproduction rates of average individuals became much lower and apparent age effects disappeared in addition the estimated proportion of fledglings produced by unmonitored females dropped from 23 to 9 incorporation of individual variation in the integrated population model resulted in more optimistic population projections over the next four years although the difference was minor in relation to the 95 prediction limits the methodology presented has broad potential for assessing whether population projections used to guide management of small populations are sensitive to individual variation graphical abstract image graphical abstract keywords bayesian inference data augmentation demographic heterogeneity integrated population model openbugs population viability analysis reintroduction translocation 1 introduction it is well known that small populations are inherently vulnerable shaffer 1981 small populations may be affected by allee effects whereby survival and reproduction rates are depressed at low population densities courchamp et al 2008 and in the long term are generally expected to be affected by inbreeding depression where survival and reproduction rates decline as inbreeding levels increase over time frankham et al 2019 small populations are more variable than large populations due to demographic stochasticity and are also more prone to extinction due to environmental stochasticity i e random variation in conditions lande et al 2003 because demographic and environmental stochasticity affect all small populations these processes have been routinely incorporated in population viability analysis pva since the early 1990s boyce 1992 inferences about small populations are also strongly affected by uncertainty in estimates of vital rates such age specific survival and reproduction parameters failure to account for parametric uncertainty leads to biased inferences about demographic and environmental stochasticity and potentially to misleading estimates of population viability mcgowan et al 2011 although parametric uncertainty was ignored in most pvas until recently there are established methods for propagating such uncertainty into population projections through bayesian hierarchical modelling barker et al 2009 king et al 2010 mcgowan et al 2011 it is also now possible to incorporate parametric uncertainty when using pva packages such as vortex pacioni and mayer 2017 consequently parametric uncertainty should be considered an essential feature of pva an additional factor relevant to the dynamics of small populations is individual variation i e individual variation in vital rates that is unrelated to age sex or environmental stochasticity white 2000 such variation is also called demographic heterogeneity stover et al 2012 or individual heterogeneity plard et al 2019 failure to account for individual variation leads to biased inferences about state dependence in rates cam et al 2016 for example apparent increases in survival probability with age may be due to individual variation in frailty wienke 2010 failure to account for individual variation in detection probability leads to biased estimates of population size borchers et al 2002 the effects of individual variation on inferences about population dynamics are currently less clear kendall and fox 2002 vindenes et al 2008 lindberg et al 2013 cressler et al 2017 however the potential for such effects is greatest in small populations as the growth or decline of the whole population can be affected by the performance of a small number of individuals stover et al 2012 accounting for individual variation is technically challenging but has become tractable through bayesian hierarchical modelling using markov chain monte carlo mcmc fitting link and barker 2010 this methodology makes it possible to quantify random variation in reproduction survival and detection rates amongst individuals in a data set while simultaneously modelling fixed effects such as age and other random effects such as annual variation it also makes it possible to extend these inferences to additional individuals through data augmentation i e by modelling data sets augmented to include unobserved individuals that may or may not exist link and barker 2010 for example closed population mark recapture data can be augmented by adding encounter histories for hypothetical individuals that were never observed and the augmented data set modelled to estimate how many additional individuals were present royle et al 2007 because inferences about individual variation in capture probability can be extrapolated from observed to unobserved individuals it is possible to obtain estimates of population size that are robust to this individual variation link and barker 2010 kéry and schaub 2012 this approach has subsequently been extended to open population mark recapture royle and dorazio 2008 kéry and schaub 2012 and to closed population density estimation for multiple populations over time royle and converse 2014 here we apply data augmentation within an integrated population model ipm extending the approach to include hypothetical future individuals as well as unobserved past individuals we also use augmentation to model individual variation in reproductive success as well as survival and reproduction rates consequently our approach involves adding rows to survival and reproduction matrices for unobserved individuals in both past and future cohorts and modelling their existence as well as their potential survival and reproduction under this approach inferences about individual variation from longitudinal data for observed individuals are extrapolated to unobserved individuals in both the past and future and therefore propagated into population projections these projections can then be compared to those from models assuming constant rates within sex and age classes to assess the sensitivity of the projections to assumptions about individual variation we apply this approach to a small reintroduced population that was known to have substantial individual variation in reproductive success longevity and detection probability ongoing management decisions for the population are contingent on annual population projections hence it was important to assess whether models that ignored this variation were producing misleading projections consequently it provided an ideal case study for developing a methodology for assessing sensitivity of projections to individual variation 2 methods 2 1 case study in march 2013 a population of hihi notiomystis cincta a threatened bird endemic to new zealand was reintroduced to bushy park tarapuruhi 39 80 s 174 93 e hereafter bushy park an 87 ha lowland rainforest remnant the initial release of 44 birds 23 male 21 female was followed by a reinforcement of 10 birds 5 male 5 female in april 2018 with all birds sourced from tiritiri matangi island hihi are small ca 40 g forest passerines that feed on fruit nectar and invertebrates and naturally nest in tree cavities higgins et al 2001 males have conspicuous black white and yellow markings whereas females are predominantly grey brown hence sexes can be visually distinguished hihi breed from september to march usually rearing up to two broods from clutches of up to 5 eggs juveniles fledge ca 4 weeks after hatching become independent 1 2 weeks after fledging and become sexually mature in their first year hihi were extirpated throughout their original range except for one offshore island te hauturu o toi due to habitat loss and exotic mammalian predators however since 1980 they have been reintroduced to additional islands and mainland sites such as bushy park surrounded by fences that exclude mammalian predators ewen et al 2013 the six extant reintroduced populations are managed through supplementary feeding all sites provision of nest boxes 4 sites including bushy park and population reinforcements and removals decisions about these actions are made annually by the hihi recovery group based on population projections which have not so far incorporated individual variation parlato et al 2021 provision of supplementary food and nest boxes has so far remained consistent at bushy park so is not expected to have affected annual variation in vital rates 2 2 data the data set consisted of encounter histories generated from 43 surveys conducted between march 2013 reintroduction and march 2020 reproduction observations numbers of young fledged by each monitored female for the first seven breeding seasons 2013 2014 to 2019 2020 and counts of unbanded recruits from unmonitored breeding females seen in september surveys start of breeding season surveys were always conducted in september january and march with 18 additional surveys carried out in the two years following initial release and three additional surveys carried out in 2018 after the reinforcement these surveys involved walking a set of monitoring lines spaced 50 200 m apart observing each feeder for at least 1 h and recording individual colour band combinations of all hihi seen we also recorded the number of male and female recruits found at the start of each breeding season these counts included newly banded birds that were unbanded at the time of fledging the remaining unbanded recruits were usually banded once detected following capture in mist nets or feeder traps and were aged using feather morphology to confirm first year status reproduction data were collected by identifying females at their nest boxes then checking nests sufficiently regularly to determine numbers of young fledged chicks were colour banded in the nest ca 1 week before fledging and all chicks banded in each cohort were considered to enter the encounter history at the january survey some females bred undetected in natural cavities as revealed by the presence of unbanded birds it was clear from this monitoring that detection was highly variable amongst individuals as some birds were recorded almost every survey whereas others went undetected for 12 18 months before being recorded again it was also apparent that some females had consistently high reproductive success whereas most produced no or few young and that longevity was more variable than expected if survival probability was constant amongst individuals 2 3 modelling we modelled the data using two alternative ipms appendix a appendix b fitted using openbugs 3 2 3 spiegelhalter et al 2014 the survival reproduction and count data were modelled in an integrated framework in both cases but only the second model incorporated random individual variation in vital rates under model 1 survival reproduction and detection rates were assumed constant amongst individuals of the same sex and age class for reproduction we distinguished between first year and older females based on research showing that first year hihi generally produce fewer young and that this dichotomy captures most of the age related variation armstrong et al 2002 low et al 2007 for survival we also recognized two age classes with fledglings considered to enter the population at the january survey then transition to adults at the march survey based on previous research at bushy park panfylova et al 2016 under model 2 the same sex and age structure was retained but individual random effects were added see below the two ipms use similar data structures but under model 2 the data are augmented to allow individual variation to be incorporated into projections to facilitate the integrated analysis of the different data types in both cases the data are structured into two parallel matrices representing individual encounter and reproduction histories and two arrays representing counts of unbanded males and females seen in september surveys fig 1 appendix c appendix d this integration is explained in detail by parlato et al 2021 and it is the data augmentation that is the novel aspect presented here whereas model 1 was fitted to data for the 228 observed individuals for model 2 this data set was augmented by adding 1000 hypothetical individuals these included 100 potential unobserved birds from previous cohorts i e birds potentially produced by unmonitored females and not observed as adults and 300 potential juveniles produced in each of the three breeding seasons after the last data were collected fig 1 these numbers were set higher than maximum plausible numbers of unobserved or future birds in these cohorts as they were selected to express absence of prior information see royle et al 2007 we initially assessed those maximum plausible numbers using the output from model 1 see below then checked the posterior distributions produced by model 2 to ensure that the augmentation did not constrain the numbers of undetected and future individuals estimated based on the data the component models for analysing survival detection and reproduction were similar in the two ipms except for the incorporation of individual random effects in model 2 we modelled survival using a state space formulation of the cormack jolly seber cjs model kéry and schaub 2012 meaning survival and detection probabilities were modelled conditional on first encounter using logit link functions and bernoulli error distributions the survival function took the form 1 logit χ i j α χ β prei j β χ fl f l i j β χ sex se x i j 1 f l i j ε χ y fl ε χ y ad ε χ i where χ i j is the probability of individual i surviving the interval from j 1 to j α χ is the intercept β prei j is a post release effect to account for high female mortality in the first six months after translocation see panfylova et al 2016 β χ fl is an age effect applied to the first interval after fledging up to march β χ sex is a sex effect applied to older birds sex 0 if female 1 if male ε χ y fl and ε χ y ad are annual random effects applied to fledglings and older birds respectively with the year running from september september and ε χ i is the individual random effect added in model 2 in model 2 the existence of hypothetical individuals in each cohort was modelled based on the counts of unbanded birds found in september in combination with the survival and reproduction data described in more detail below if a hypothetical individual was deemed to exist in a particular mcmc iteration i e survival status 1 its survival status in subsequent surveys was modelled as a series of missing values fig 1 the detection function took the form 2 logit p i j α p β p sex se x i ε p j ε p i where α p is the intercept β p sex is a sex effect ε p j is survey specific random effect and ε p i is the individual random effect added in model 2 all random effects in survival and detection functions were taken to be logit normally distributed we modelled reproduction using a generalized linear model with log link function and poisson error distribution the expected number of fledglings produced in breeding season y by a female alive in september was 3 log μ livefemal e i y α f β f age ag e i y ε f y ε f i where α f is the intercept β f age is the effect of the female s age class age 0 if first year 1 if older ε f y is an annual random effect and ε f i is the individual random effect added in model 2 these random effects were taken to be log normally distributed if a female was known to be alive but it was unknown whether she was nesting her reproductive output that year was sampled as a missing value to set reproductive success to zero for males and dead females the expected number of fledglings produced by any individual i in year y was 4 μ i y μ livefemal e i y aliv e i j 1 se x i where aliv e i j is its survival status at the september survey that year 1 alive 0 dead or not yet entered population if the survival status or sex of the individual was unknown including for hypothetical individuals its expected number of fledglings would be μ livefemal e i y in mcmc iterations where it was deemed to be a live female and set to zero otherwise the potential reproductive output of unmonitored females including those not known to be alive or not known to exist was further informed by the counts of unbanded recruits found in september in model 1 the numbers of unbanded recruits seen were sampled from binomial distributions to simulate the detection process and infer the numbers present 5 n u b s e x y d b i n p s e x j y n u b s e x y where n u b s e x y is the sex specific number of unbanded recruits detected at the start of year y p s e x j y is the sex specific resighting probability for survey j at start of year y and n u b s e x y is the sex specific number of unbanded recruits present the numbers present were in turn sampled from binomial distributions to simulate juvenile survival and therefore infer the numbers of young fledged by unmonitored females the previous season 6 n u b s e x y d b i n ø j u v s e x y 1 u b f l s s e x y 1 where u b f l s s e x y 1 is the sex specific number of unbanded fledglings produced the previous season and ø j u v s e x y 1 is the sex specific juvenile survival probability for individuals in that cohort in contrast in model 2 the number of hypothetical individuals in each cohort that actually exist equals the number of unbanded fledglings produced u b f l s y 1 minus those detected as recruits in september n u b y consequently the numbers of young fledged by unmonitored females were informed by the encounter histories for the hypothetical unobserved individuals fig 1 as well as the number of unbanded recruits detected see appendix b for further detail population projections from both models directly incorporated parameter distributions modelled from the data and also incorporated demographic stochasticity however these projections were done in different ways in model 1 a traditional sex and age based simulation model was appended to the code used to model the data and this model tracked the numbers of first year and older females present in future years appendix a in contrast in model 2 there was no distinction between the data analysis and simulations instead projections were made through the data augmentation which allows the future fates of individuals both observed and hypothetical to be tracked in each mcmc iteration appendix b fig 1 this individual based framework allows individual survival and reproduction rates to be assigned to all individuals using eqs 1 and 3 meaning this individual variation is incorporated into projections the individual random effects for observed individuals are informed by the specific data for these individuals whereas for hypothetical individuals they are sampled from the distributions 7 ε χ i n 0 σ χ i and 8 ε f i n 0 σ f i where σ χ i and σ f i are the estimated standard deviations amongst individuals in survival and reproduction respectively we set priors for main parameters to n 0 1 which was sufficiently diffuse to be non informative in all cases we set the priors for hyperparameters standard deviations of random effects to u 0 1 for annual and survey effects σ f y σ χ y ad σ χ y fl σ p j and to u 0 2 for individual effects σ f i σ χ i σ p i the priors for hyperparameters were weakly informative banner et al 2020 due to the difficulty of resolving them with a relatively small data set and were designed to constrain the effects to plausible ranges for example under these constraints reproduction rates can still vary up to 7 fold amongst years and up to 55 fold amongst individuals we initially sampled the three individual random effects from separate distributions but found that individual random effects for survival and reproduction were closely correlated appendix e we therefore modified model 2 so that values were selected from a single distribution with the two random effects scaled as 7 ε f i ε χ i scale where the scale parameter was estimated from the data we obtained posterior distributions from 100 000 iterations with three chains appendix f after an initial burn in of 10 000 with convergence checked using standard mcmc diagnostics link and barker 2010 we assessed the degree of individual variation in reproduction survival and detection rates by examining the posterior distributions for their hyperparameters we also performed posterior predictive checks gelman et al 2004 on models 1 and 2 to assess how well they fit the survival and reproduction data this involved generated a new simulated set of encounter histories and reproduction observations at each mcmc iteration calculating the deviances 2 log likelihood of those data sets based on the expected values for each cell in the matrices and comparing these deviances to those of the real data sets to assess how incorporation of individual variation affected population projections we compared the median numbers of females and 95 prediction intervals over the next four years under models 1 and 2 3 results the posterior distributions for standard deviations of individual random effects under model 2 showed substantial individual variation in rates as was expected fig 2 there was clear evidence of individual variation in reproduction and detection rates as the distributions were concentrated well away from zero whereas the evidence for individual variation in survival rates was less clear when the survival and reproduction effects were combined due to the correlation between them appendix e this resulted in a tighter posterior distribution indicating clear evidence for variation in overall individual quality this modification to model 2 was retained in subsequent analysis posterior predictive checks showed that model 1 which ignores individual variation gave a poor fit to the reproduction data as the deviance of the data was consistently higher than that of simulated data sets fig 3 this higher deviance was due to greater variation in reproduction rates amongst individual females than predicted under model 1 fig 4 the incorporation of individual variation in model 2 therefore substantially reduced that deviance giving reasonable fit fig 3 the deviance from the survival data was also substantially reduced under model 2 however this was the case for the simulated data as well as the real data hence models 1 and 2 both appeared to have reasonable fit to the survival data based on the posterior predictive checks fig 3 the apparent patterns in survival and reproduction were very different under the two models output from model 1 appeared to support the sex and age distinctions made as shown by the 95 credible intervals for the main parameters table 1 and the posterior distributions for rates derived from those parameters fig 5 that is first year females produced fewer fledglings than older females survival probability was lower for fledglings than adults and lower for adult females than adult males and detection probability was higher for males than females fig 5 these were all clear differences based on the posterior distributions except for the age effect on survival β ø f l where the 95 credible interval slightly overlapped zero table 1 the posterior distributions for hyperparameters also showed annual variation in survival and reproduction rates and variation in detection probability amongst surveys table 1 in contrast the apparent age effects on survival and reproduction completely disappeared under model 2 fig 5 in addition the reproduction survival and detection rates for an average individual were generally much lower than the age and sex specific rates estimated under model 1 as the latter estimates reflect the high representation of long lived individuals in the data set the estimated sex differences and seasonal variation were fairly similar under the two models but the precision of these estimates was generally lower under model 2 table 1 accounting for individual variation also greatly reduced the estimated number of fledglings produced by unmonitored females under model 1 these fledglings were estimated to make up 23 of those produced over the first six breeding seasons whereas this proportion dropped to 9 under model 2 fig 6 the incorporation of individual variation in the integrated population model resulted in more optimistic population projections over the next four years although the difference was minor in relation to the 95 prediction limits fig 7 the estimated number of females present at the start of the latest breeding season september 2019 increased from 13 to 16 when individual variation in detection probability was accounted for under both models the number of females was predicted to initially drop ca 30 due to a poor breeding season in 2019 20 and to subsequently increase under model 1 there was projected to be a median of 20 females in 2023 with 95 prediction interval ranging from 1 to 130 whereas under model 2 there was projected to be 30 females with 95 prediction interval ranging from 3 to 155 4 discussion for the bushy park hihi population accounting for individual variation greatly changes our interpretation of the population s demographics but not our predictions about its dynamics the key change is that apparent age effects on survival and reproduction are attributed to variation in individual frailty wienke 2010 with a relatively small proportion of high quality individuals surviving to breed for several years and producing most of the offspring although the complexities of hierarchical modelling make it difficult to unambiguously determine which interpretation is correct royle et al 2008 link and barker 2010 dorazio 2016 the posterior distributions produced under model 2 showed substantial individual variation in rates in addition posterior predictive checks showed that model 1 which excluded individual variation gave a poor fit to the reproduction data whereas model 2 had reasonable fit to those data the substantially lower number of fledglings attributed to unmonitored females under model 2 also appeared more realistic then the numbers estimated under model 1 if a female is not observed breeding it is usually impossible to determine whether she is not breeding or is breeding unobserved hence these females are usually considered unmonitored by allowing for individual variation we avoid the need to assume either that these females are not breeding or that they are breeding at same rates as monitored females given the pronounced individual variation revealed in the bushy park hihi population it was important for management to see that population projections were not greatly different when individual variation was accounted for however it is also important not to over generalise this result theoretical and laboratory studies have shown the impacts of individual variation on population dynamics to be very complex with many possible effects acting simultaneously and potentially cancelling each other e g kendall and fox 2002 vindenes et al 2008 stover et al 2012 cressler et al 2017 it is therefore impossible to empirically answer the overall question of whether individual variation is relevant to population dynamics the key contribution of our research is providing an effective methodology for assessing whether population projections used to guide management are sensitive to individual variation such sensitivity seems most likely to occur in populations that are both small and show pronounced individual variation in rates however small populations will also tend to have high parametric uncertainty due to small sample sizes mcgowan et al 2011 we suspect that any sensitivity of projections to individual variation will be commonly swamped by this parametric uncertainty it is therefore critical that parametric uncertainty is accounted for our methodology allows for concurrent estimation of parametric uncertainty and individual variation through an integrated state space population modelling framework ipms are increasingly recognised as offering valuable opportunities for understanding the influence of individual variation on population dynamics by combining individual and population level data plard et al 2019 ipms are not only useful for making optimal use of multiple data types but also for automatically propagating uncertainties and covariances into population projections schaub and abadi 2011 dorazio 2016 we have capitalised on these strengths to develop an approach that models random variation amongst future individuals so that this source of variability can also be accounted for when predicting population dynamics the forms of individual variation considered could potentially be quite flexible we took individual random effects to be log normally or logit normally distributed because these are standard distributions applied to reproduction and survival data respectively but other distributions could be used if considered more plausible variation could potentially be age or sex related but modelling such complexity requires very large sets péron et al 2016 a key feature of our model is that we ultimately treated individual variation in survival and reproduction as reflecting a single measure of individual quality after finding these effects to be positively correlated appendix e such covariance was also found in cam et al s 2002 classic study in which long lived kittiwakes rissa trydactyla tended to have higher age specific breeding rates and we expect this to be a common phenomenon however survival and reproductive rates can also be negatively correlated or relatively independent van noordwijk and de jong 1986 regardless of the forms of individual variation considered it is essential that any variation in rates included in the data analysis is propagated through to the future when making projections otherwise the population projections simply reflect dynamics expected with a set of average individuals which may be quite different from those expected with suites of individuals varying greatly in their vital rates the data augmentation method we present here allows a seamless transition between the past and future facilitating the propagation of all sources of variation into projections the same code is used to sample real and augmented data hence projecting to the future just requires extending loops to future sampling occasions and hypothetical individuals appendix b however such augmentation is likely to greatly increase the size of data sets in the example presented here the population was intensively monitored meaning there were likely to be relatively few unobserved individuals and the time frame for projections was kept short 4 years nevertheless the augmentation increased the number of individuals by ca 5 fold this increased running time by only 35 3 2 h for model 2 vs 2 4 h for model 1 however extending the method to larger populations and longer time frames would require much greater numbers of augmented individuals and therefore greater increases in running times large scale augmentation is not necessarily a major constraint as scripts can be used to automatically generate the augmented individuals however as with any data augmentation method the number of augmented individuals needs to be chosen carefully adding too few individuals will bias results whereas adding too many will reduce computational efficiency royle et al 2007 long time frames pose additional issues in the context of individual variation it raises the question of whether rates are heritable and therefore whether their distributions are expected to change over time through selection cressler et al 2017 it also raises the question of whether rates will decline with inbreeding which is expected to increase rapidly in populations where there is high variation in reproductive success frankham et al 2019 however shorter term projections are much more relevant to small threatened populations such as the bushy park hihi where management decisions are contingent on the immediate and highly uncertain fate of the population we expect this to be true for the practical management of many small populations declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgements we thank the many people who have contributed to hihi monitoring at bushy park tarapuruhi including mandy brooke sarah treadgold mhairi mccready julia panfylova chris smith chris devine brittany koning caitlin andrews zoe stone interns from wageningen university ellis bemelmans emmy van de vijver natasja van nijen sabine hoek and marjolein van haaren with supervision from marc naguib and camilla hinde and van hall larenstein university carolin klangwald and étienne vergne with supervision from henry kuipers and 46 students from the postgraduate wildlife management class at massey university we also thank two anonymous reviewers for comments on the manuscript and richard barker for advice on the posterior predictive checks the translocations were led by kevin parker and instigated by the late allan anderson who raised the funding for these translocations and the predator proof fence that made them possible monitoring is conducted under new zealand department of conservation permit 35669 fau with support of the bushy park trust forest and bird and ngā rauru the research presented here was funded by grant mau1708 from the marsden fund supplementary materials supplementary material associated with this article can be found in the online version at doi 10 1016 j ecolmodel 2021 109647 appendix supplementary materials image application 1 image application 2 image application 3 image application 4 image application 5 image application 6 
24593,survival reproduction and detection rates may vary greatly amongst individuals failure to account for this variation results in biased inferences about age effects and population size however individual variation is not normally considered in population viability analysis potentially leading to misleading projections for small populations we present a novel data augmentation approach for incorporating individual variation in rates in integrated population models by adding rows to survival and reproduction matrices for hypothetical individuals in both the past and future inferences about individual variation derived from bayesian hierarchical modelling are propagated into population projections we apply this method to a small reintroduced population of hihi notiomystis cincta at bushy park new zealand where individuals vary greatly in reproductive success longevity and detection probability and ongoing management decisions depend on modelling projections we compare the results to those from an alternative model that ignores individual variation but incorporates sex and age effects the modelling confirmed pronounced individual variation in all rates and greatly altered their interpretation estimated survival and reproduction rates of average individuals became much lower and apparent age effects disappeared in addition the estimated proportion of fledglings produced by unmonitored females dropped from 23 to 9 incorporation of individual variation in the integrated population model resulted in more optimistic population projections over the next four years although the difference was minor in relation to the 95 prediction limits the methodology presented has broad potential for assessing whether population projections used to guide management of small populations are sensitive to individual variation graphical abstract image graphical abstract keywords bayesian inference data augmentation demographic heterogeneity integrated population model openbugs population viability analysis reintroduction translocation 1 introduction it is well known that small populations are inherently vulnerable shaffer 1981 small populations may be affected by allee effects whereby survival and reproduction rates are depressed at low population densities courchamp et al 2008 and in the long term are generally expected to be affected by inbreeding depression where survival and reproduction rates decline as inbreeding levels increase over time frankham et al 2019 small populations are more variable than large populations due to demographic stochasticity and are also more prone to extinction due to environmental stochasticity i e random variation in conditions lande et al 2003 because demographic and environmental stochasticity affect all small populations these processes have been routinely incorporated in population viability analysis pva since the early 1990s boyce 1992 inferences about small populations are also strongly affected by uncertainty in estimates of vital rates such age specific survival and reproduction parameters failure to account for parametric uncertainty leads to biased inferences about demographic and environmental stochasticity and potentially to misleading estimates of population viability mcgowan et al 2011 although parametric uncertainty was ignored in most pvas until recently there are established methods for propagating such uncertainty into population projections through bayesian hierarchical modelling barker et al 2009 king et al 2010 mcgowan et al 2011 it is also now possible to incorporate parametric uncertainty when using pva packages such as vortex pacioni and mayer 2017 consequently parametric uncertainty should be considered an essential feature of pva an additional factor relevant to the dynamics of small populations is individual variation i e individual variation in vital rates that is unrelated to age sex or environmental stochasticity white 2000 such variation is also called demographic heterogeneity stover et al 2012 or individual heterogeneity plard et al 2019 failure to account for individual variation leads to biased inferences about state dependence in rates cam et al 2016 for example apparent increases in survival probability with age may be due to individual variation in frailty wienke 2010 failure to account for individual variation in detection probability leads to biased estimates of population size borchers et al 2002 the effects of individual variation on inferences about population dynamics are currently less clear kendall and fox 2002 vindenes et al 2008 lindberg et al 2013 cressler et al 2017 however the potential for such effects is greatest in small populations as the growth or decline of the whole population can be affected by the performance of a small number of individuals stover et al 2012 accounting for individual variation is technically challenging but has become tractable through bayesian hierarchical modelling using markov chain monte carlo mcmc fitting link and barker 2010 this methodology makes it possible to quantify random variation in reproduction survival and detection rates amongst individuals in a data set while simultaneously modelling fixed effects such as age and other random effects such as annual variation it also makes it possible to extend these inferences to additional individuals through data augmentation i e by modelling data sets augmented to include unobserved individuals that may or may not exist link and barker 2010 for example closed population mark recapture data can be augmented by adding encounter histories for hypothetical individuals that were never observed and the augmented data set modelled to estimate how many additional individuals were present royle et al 2007 because inferences about individual variation in capture probability can be extrapolated from observed to unobserved individuals it is possible to obtain estimates of population size that are robust to this individual variation link and barker 2010 kéry and schaub 2012 this approach has subsequently been extended to open population mark recapture royle and dorazio 2008 kéry and schaub 2012 and to closed population density estimation for multiple populations over time royle and converse 2014 here we apply data augmentation within an integrated population model ipm extending the approach to include hypothetical future individuals as well as unobserved past individuals we also use augmentation to model individual variation in reproductive success as well as survival and reproduction rates consequently our approach involves adding rows to survival and reproduction matrices for unobserved individuals in both past and future cohorts and modelling their existence as well as their potential survival and reproduction under this approach inferences about individual variation from longitudinal data for observed individuals are extrapolated to unobserved individuals in both the past and future and therefore propagated into population projections these projections can then be compared to those from models assuming constant rates within sex and age classes to assess the sensitivity of the projections to assumptions about individual variation we apply this approach to a small reintroduced population that was known to have substantial individual variation in reproductive success longevity and detection probability ongoing management decisions for the population are contingent on annual population projections hence it was important to assess whether models that ignored this variation were producing misleading projections consequently it provided an ideal case study for developing a methodology for assessing sensitivity of projections to individual variation 2 methods 2 1 case study in march 2013 a population of hihi notiomystis cincta a threatened bird endemic to new zealand was reintroduced to bushy park tarapuruhi 39 80 s 174 93 e hereafter bushy park an 87 ha lowland rainforest remnant the initial release of 44 birds 23 male 21 female was followed by a reinforcement of 10 birds 5 male 5 female in april 2018 with all birds sourced from tiritiri matangi island hihi are small ca 40 g forest passerines that feed on fruit nectar and invertebrates and naturally nest in tree cavities higgins et al 2001 males have conspicuous black white and yellow markings whereas females are predominantly grey brown hence sexes can be visually distinguished hihi breed from september to march usually rearing up to two broods from clutches of up to 5 eggs juveniles fledge ca 4 weeks after hatching become independent 1 2 weeks after fledging and become sexually mature in their first year hihi were extirpated throughout their original range except for one offshore island te hauturu o toi due to habitat loss and exotic mammalian predators however since 1980 they have been reintroduced to additional islands and mainland sites such as bushy park surrounded by fences that exclude mammalian predators ewen et al 2013 the six extant reintroduced populations are managed through supplementary feeding all sites provision of nest boxes 4 sites including bushy park and population reinforcements and removals decisions about these actions are made annually by the hihi recovery group based on population projections which have not so far incorporated individual variation parlato et al 2021 provision of supplementary food and nest boxes has so far remained consistent at bushy park so is not expected to have affected annual variation in vital rates 2 2 data the data set consisted of encounter histories generated from 43 surveys conducted between march 2013 reintroduction and march 2020 reproduction observations numbers of young fledged by each monitored female for the first seven breeding seasons 2013 2014 to 2019 2020 and counts of unbanded recruits from unmonitored breeding females seen in september surveys start of breeding season surveys were always conducted in september january and march with 18 additional surveys carried out in the two years following initial release and three additional surveys carried out in 2018 after the reinforcement these surveys involved walking a set of monitoring lines spaced 50 200 m apart observing each feeder for at least 1 h and recording individual colour band combinations of all hihi seen we also recorded the number of male and female recruits found at the start of each breeding season these counts included newly banded birds that were unbanded at the time of fledging the remaining unbanded recruits were usually banded once detected following capture in mist nets or feeder traps and were aged using feather morphology to confirm first year status reproduction data were collected by identifying females at their nest boxes then checking nests sufficiently regularly to determine numbers of young fledged chicks were colour banded in the nest ca 1 week before fledging and all chicks banded in each cohort were considered to enter the encounter history at the january survey some females bred undetected in natural cavities as revealed by the presence of unbanded birds it was clear from this monitoring that detection was highly variable amongst individuals as some birds were recorded almost every survey whereas others went undetected for 12 18 months before being recorded again it was also apparent that some females had consistently high reproductive success whereas most produced no or few young and that longevity was more variable than expected if survival probability was constant amongst individuals 2 3 modelling we modelled the data using two alternative ipms appendix a appendix b fitted using openbugs 3 2 3 spiegelhalter et al 2014 the survival reproduction and count data were modelled in an integrated framework in both cases but only the second model incorporated random individual variation in vital rates under model 1 survival reproduction and detection rates were assumed constant amongst individuals of the same sex and age class for reproduction we distinguished between first year and older females based on research showing that first year hihi generally produce fewer young and that this dichotomy captures most of the age related variation armstrong et al 2002 low et al 2007 for survival we also recognized two age classes with fledglings considered to enter the population at the january survey then transition to adults at the march survey based on previous research at bushy park panfylova et al 2016 under model 2 the same sex and age structure was retained but individual random effects were added see below the two ipms use similar data structures but under model 2 the data are augmented to allow individual variation to be incorporated into projections to facilitate the integrated analysis of the different data types in both cases the data are structured into two parallel matrices representing individual encounter and reproduction histories and two arrays representing counts of unbanded males and females seen in september surveys fig 1 appendix c appendix d this integration is explained in detail by parlato et al 2021 and it is the data augmentation that is the novel aspect presented here whereas model 1 was fitted to data for the 228 observed individuals for model 2 this data set was augmented by adding 1000 hypothetical individuals these included 100 potential unobserved birds from previous cohorts i e birds potentially produced by unmonitored females and not observed as adults and 300 potential juveniles produced in each of the three breeding seasons after the last data were collected fig 1 these numbers were set higher than maximum plausible numbers of unobserved or future birds in these cohorts as they were selected to express absence of prior information see royle et al 2007 we initially assessed those maximum plausible numbers using the output from model 1 see below then checked the posterior distributions produced by model 2 to ensure that the augmentation did not constrain the numbers of undetected and future individuals estimated based on the data the component models for analysing survival detection and reproduction were similar in the two ipms except for the incorporation of individual random effects in model 2 we modelled survival using a state space formulation of the cormack jolly seber cjs model kéry and schaub 2012 meaning survival and detection probabilities were modelled conditional on first encounter using logit link functions and bernoulli error distributions the survival function took the form 1 logit χ i j α χ β prei j β χ fl f l i j β χ sex se x i j 1 f l i j ε χ y fl ε χ y ad ε χ i where χ i j is the probability of individual i surviving the interval from j 1 to j α χ is the intercept β prei j is a post release effect to account for high female mortality in the first six months after translocation see panfylova et al 2016 β χ fl is an age effect applied to the first interval after fledging up to march β χ sex is a sex effect applied to older birds sex 0 if female 1 if male ε χ y fl and ε χ y ad are annual random effects applied to fledglings and older birds respectively with the year running from september september and ε χ i is the individual random effect added in model 2 in model 2 the existence of hypothetical individuals in each cohort was modelled based on the counts of unbanded birds found in september in combination with the survival and reproduction data described in more detail below if a hypothetical individual was deemed to exist in a particular mcmc iteration i e survival status 1 its survival status in subsequent surveys was modelled as a series of missing values fig 1 the detection function took the form 2 logit p i j α p β p sex se x i ε p j ε p i where α p is the intercept β p sex is a sex effect ε p j is survey specific random effect and ε p i is the individual random effect added in model 2 all random effects in survival and detection functions were taken to be logit normally distributed we modelled reproduction using a generalized linear model with log link function and poisson error distribution the expected number of fledglings produced in breeding season y by a female alive in september was 3 log μ livefemal e i y α f β f age ag e i y ε f y ε f i where α f is the intercept β f age is the effect of the female s age class age 0 if first year 1 if older ε f y is an annual random effect and ε f i is the individual random effect added in model 2 these random effects were taken to be log normally distributed if a female was known to be alive but it was unknown whether she was nesting her reproductive output that year was sampled as a missing value to set reproductive success to zero for males and dead females the expected number of fledglings produced by any individual i in year y was 4 μ i y μ livefemal e i y aliv e i j 1 se x i where aliv e i j is its survival status at the september survey that year 1 alive 0 dead or not yet entered population if the survival status or sex of the individual was unknown including for hypothetical individuals its expected number of fledglings would be μ livefemal e i y in mcmc iterations where it was deemed to be a live female and set to zero otherwise the potential reproductive output of unmonitored females including those not known to be alive or not known to exist was further informed by the counts of unbanded recruits found in september in model 1 the numbers of unbanded recruits seen were sampled from binomial distributions to simulate the detection process and infer the numbers present 5 n u b s e x y d b i n p s e x j y n u b s e x y where n u b s e x y is the sex specific number of unbanded recruits detected at the start of year y p s e x j y is the sex specific resighting probability for survey j at start of year y and n u b s e x y is the sex specific number of unbanded recruits present the numbers present were in turn sampled from binomial distributions to simulate juvenile survival and therefore infer the numbers of young fledged by unmonitored females the previous season 6 n u b s e x y d b i n ø j u v s e x y 1 u b f l s s e x y 1 where u b f l s s e x y 1 is the sex specific number of unbanded fledglings produced the previous season and ø j u v s e x y 1 is the sex specific juvenile survival probability for individuals in that cohort in contrast in model 2 the number of hypothetical individuals in each cohort that actually exist equals the number of unbanded fledglings produced u b f l s y 1 minus those detected as recruits in september n u b y consequently the numbers of young fledged by unmonitored females were informed by the encounter histories for the hypothetical unobserved individuals fig 1 as well as the number of unbanded recruits detected see appendix b for further detail population projections from both models directly incorporated parameter distributions modelled from the data and also incorporated demographic stochasticity however these projections were done in different ways in model 1 a traditional sex and age based simulation model was appended to the code used to model the data and this model tracked the numbers of first year and older females present in future years appendix a in contrast in model 2 there was no distinction between the data analysis and simulations instead projections were made through the data augmentation which allows the future fates of individuals both observed and hypothetical to be tracked in each mcmc iteration appendix b fig 1 this individual based framework allows individual survival and reproduction rates to be assigned to all individuals using eqs 1 and 3 meaning this individual variation is incorporated into projections the individual random effects for observed individuals are informed by the specific data for these individuals whereas for hypothetical individuals they are sampled from the distributions 7 ε χ i n 0 σ χ i and 8 ε f i n 0 σ f i where σ χ i and σ f i are the estimated standard deviations amongst individuals in survival and reproduction respectively we set priors for main parameters to n 0 1 which was sufficiently diffuse to be non informative in all cases we set the priors for hyperparameters standard deviations of random effects to u 0 1 for annual and survey effects σ f y σ χ y ad σ χ y fl σ p j and to u 0 2 for individual effects σ f i σ χ i σ p i the priors for hyperparameters were weakly informative banner et al 2020 due to the difficulty of resolving them with a relatively small data set and were designed to constrain the effects to plausible ranges for example under these constraints reproduction rates can still vary up to 7 fold amongst years and up to 55 fold amongst individuals we initially sampled the three individual random effects from separate distributions but found that individual random effects for survival and reproduction were closely correlated appendix e we therefore modified model 2 so that values were selected from a single distribution with the two random effects scaled as 7 ε f i ε χ i scale where the scale parameter was estimated from the data we obtained posterior distributions from 100 000 iterations with three chains appendix f after an initial burn in of 10 000 with convergence checked using standard mcmc diagnostics link and barker 2010 we assessed the degree of individual variation in reproduction survival and detection rates by examining the posterior distributions for their hyperparameters we also performed posterior predictive checks gelman et al 2004 on models 1 and 2 to assess how well they fit the survival and reproduction data this involved generated a new simulated set of encounter histories and reproduction observations at each mcmc iteration calculating the deviances 2 log likelihood of those data sets based on the expected values for each cell in the matrices and comparing these deviances to those of the real data sets to assess how incorporation of individual variation affected population projections we compared the median numbers of females and 95 prediction intervals over the next four years under models 1 and 2 3 results the posterior distributions for standard deviations of individual random effects under model 2 showed substantial individual variation in rates as was expected fig 2 there was clear evidence of individual variation in reproduction and detection rates as the distributions were concentrated well away from zero whereas the evidence for individual variation in survival rates was less clear when the survival and reproduction effects were combined due to the correlation between them appendix e this resulted in a tighter posterior distribution indicating clear evidence for variation in overall individual quality this modification to model 2 was retained in subsequent analysis posterior predictive checks showed that model 1 which ignores individual variation gave a poor fit to the reproduction data as the deviance of the data was consistently higher than that of simulated data sets fig 3 this higher deviance was due to greater variation in reproduction rates amongst individual females than predicted under model 1 fig 4 the incorporation of individual variation in model 2 therefore substantially reduced that deviance giving reasonable fit fig 3 the deviance from the survival data was also substantially reduced under model 2 however this was the case for the simulated data as well as the real data hence models 1 and 2 both appeared to have reasonable fit to the survival data based on the posterior predictive checks fig 3 the apparent patterns in survival and reproduction were very different under the two models output from model 1 appeared to support the sex and age distinctions made as shown by the 95 credible intervals for the main parameters table 1 and the posterior distributions for rates derived from those parameters fig 5 that is first year females produced fewer fledglings than older females survival probability was lower for fledglings than adults and lower for adult females than adult males and detection probability was higher for males than females fig 5 these were all clear differences based on the posterior distributions except for the age effect on survival β ø f l where the 95 credible interval slightly overlapped zero table 1 the posterior distributions for hyperparameters also showed annual variation in survival and reproduction rates and variation in detection probability amongst surveys table 1 in contrast the apparent age effects on survival and reproduction completely disappeared under model 2 fig 5 in addition the reproduction survival and detection rates for an average individual were generally much lower than the age and sex specific rates estimated under model 1 as the latter estimates reflect the high representation of long lived individuals in the data set the estimated sex differences and seasonal variation were fairly similar under the two models but the precision of these estimates was generally lower under model 2 table 1 accounting for individual variation also greatly reduced the estimated number of fledglings produced by unmonitored females under model 1 these fledglings were estimated to make up 23 of those produced over the first six breeding seasons whereas this proportion dropped to 9 under model 2 fig 6 the incorporation of individual variation in the integrated population model resulted in more optimistic population projections over the next four years although the difference was minor in relation to the 95 prediction limits fig 7 the estimated number of females present at the start of the latest breeding season september 2019 increased from 13 to 16 when individual variation in detection probability was accounted for under both models the number of females was predicted to initially drop ca 30 due to a poor breeding season in 2019 20 and to subsequently increase under model 1 there was projected to be a median of 20 females in 2023 with 95 prediction interval ranging from 1 to 130 whereas under model 2 there was projected to be 30 females with 95 prediction interval ranging from 3 to 155 4 discussion for the bushy park hihi population accounting for individual variation greatly changes our interpretation of the population s demographics but not our predictions about its dynamics the key change is that apparent age effects on survival and reproduction are attributed to variation in individual frailty wienke 2010 with a relatively small proportion of high quality individuals surviving to breed for several years and producing most of the offspring although the complexities of hierarchical modelling make it difficult to unambiguously determine which interpretation is correct royle et al 2008 link and barker 2010 dorazio 2016 the posterior distributions produced under model 2 showed substantial individual variation in rates in addition posterior predictive checks showed that model 1 which excluded individual variation gave a poor fit to the reproduction data whereas model 2 had reasonable fit to those data the substantially lower number of fledglings attributed to unmonitored females under model 2 also appeared more realistic then the numbers estimated under model 1 if a female is not observed breeding it is usually impossible to determine whether she is not breeding or is breeding unobserved hence these females are usually considered unmonitored by allowing for individual variation we avoid the need to assume either that these females are not breeding or that they are breeding at same rates as monitored females given the pronounced individual variation revealed in the bushy park hihi population it was important for management to see that population projections were not greatly different when individual variation was accounted for however it is also important not to over generalise this result theoretical and laboratory studies have shown the impacts of individual variation on population dynamics to be very complex with many possible effects acting simultaneously and potentially cancelling each other e g kendall and fox 2002 vindenes et al 2008 stover et al 2012 cressler et al 2017 it is therefore impossible to empirically answer the overall question of whether individual variation is relevant to population dynamics the key contribution of our research is providing an effective methodology for assessing whether population projections used to guide management are sensitive to individual variation such sensitivity seems most likely to occur in populations that are both small and show pronounced individual variation in rates however small populations will also tend to have high parametric uncertainty due to small sample sizes mcgowan et al 2011 we suspect that any sensitivity of projections to individual variation will be commonly swamped by this parametric uncertainty it is therefore critical that parametric uncertainty is accounted for our methodology allows for concurrent estimation of parametric uncertainty and individual variation through an integrated state space population modelling framework ipms are increasingly recognised as offering valuable opportunities for understanding the influence of individual variation on population dynamics by combining individual and population level data plard et al 2019 ipms are not only useful for making optimal use of multiple data types but also for automatically propagating uncertainties and covariances into population projections schaub and abadi 2011 dorazio 2016 we have capitalised on these strengths to develop an approach that models random variation amongst future individuals so that this source of variability can also be accounted for when predicting population dynamics the forms of individual variation considered could potentially be quite flexible we took individual random effects to be log normally or logit normally distributed because these are standard distributions applied to reproduction and survival data respectively but other distributions could be used if considered more plausible variation could potentially be age or sex related but modelling such complexity requires very large sets péron et al 2016 a key feature of our model is that we ultimately treated individual variation in survival and reproduction as reflecting a single measure of individual quality after finding these effects to be positively correlated appendix e such covariance was also found in cam et al s 2002 classic study in which long lived kittiwakes rissa trydactyla tended to have higher age specific breeding rates and we expect this to be a common phenomenon however survival and reproductive rates can also be negatively correlated or relatively independent van noordwijk and de jong 1986 regardless of the forms of individual variation considered it is essential that any variation in rates included in the data analysis is propagated through to the future when making projections otherwise the population projections simply reflect dynamics expected with a set of average individuals which may be quite different from those expected with suites of individuals varying greatly in their vital rates the data augmentation method we present here allows a seamless transition between the past and future facilitating the propagation of all sources of variation into projections the same code is used to sample real and augmented data hence projecting to the future just requires extending loops to future sampling occasions and hypothetical individuals appendix b however such augmentation is likely to greatly increase the size of data sets in the example presented here the population was intensively monitored meaning there were likely to be relatively few unobserved individuals and the time frame for projections was kept short 4 years nevertheless the augmentation increased the number of individuals by ca 5 fold this increased running time by only 35 3 2 h for model 2 vs 2 4 h for model 1 however extending the method to larger populations and longer time frames would require much greater numbers of augmented individuals and therefore greater increases in running times large scale augmentation is not necessarily a major constraint as scripts can be used to automatically generate the augmented individuals however as with any data augmentation method the number of augmented individuals needs to be chosen carefully adding too few individuals will bias results whereas adding too many will reduce computational efficiency royle et al 2007 long time frames pose additional issues in the context of individual variation it raises the question of whether rates are heritable and therefore whether their distributions are expected to change over time through selection cressler et al 2017 it also raises the question of whether rates will decline with inbreeding which is expected to increase rapidly in populations where there is high variation in reproductive success frankham et al 2019 however shorter term projections are much more relevant to small threatened populations such as the bushy park hihi where management decisions are contingent on the immediate and highly uncertain fate of the population we expect this to be true for the practical management of many small populations declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgements we thank the many people who have contributed to hihi monitoring at bushy park tarapuruhi including mandy brooke sarah treadgold mhairi mccready julia panfylova chris smith chris devine brittany koning caitlin andrews zoe stone interns from wageningen university ellis bemelmans emmy van de vijver natasja van nijen sabine hoek and marjolein van haaren with supervision from marc naguib and camilla hinde and van hall larenstein university carolin klangwald and étienne vergne with supervision from henry kuipers and 46 students from the postgraduate wildlife management class at massey university we also thank two anonymous reviewers for comments on the manuscript and richard barker for advice on the posterior predictive checks the translocations were led by kevin parker and instigated by the late allan anderson who raised the funding for these translocations and the predator proof fence that made them possible monitoring is conducted under new zealand department of conservation permit 35669 fau with support of the bushy park trust forest and bird and ngā rauru the research presented here was funded by grant mau1708 from the marsden fund supplementary materials supplementary material associated with this article can be found in the online version at doi 10 1016 j ecolmodel 2021 109647 appendix supplementary materials image application 1 image application 2 image application 3 image application 4 image application 5 image application 6 
24594,sensitivity analysis sa is a fundamental practice for analyzing model behavior under different conditions of application a number of sa techniques were proposed ranging from simple screening methods to computationally expensive variance based ones in this study we compared the morris and e fast methods by applying them to three widely used generic crop models largely differing for complexity and for the approaches used to formalize knowledge on crop physiology i e stics cropsyst and wofost sa experiments were carried out at sub model level on rice crops grown under different environmental conditions results highlighted the lack of linearity between the total order sensitivity estimates provided by e fast and morris although the concordance tdcc between the parameter rankings obtained with the two methods was always significant at the 0 05 level for parameters involved with crop growth and for those involved with phenological development for stics whereas it was significant at the 0 10 level for the phenology parameters of cropsyst and wofost given morris required less than 3 of the model executions needed by e fast our results allow considering morris as a suitable alternative to more demanding sa methods when ranking parameters or discriminating between influential and non influential model factors are the sa goals especially in computationally expensive sa studies keywords crop model cropsyst e fast fourier amplitude sensitivity test stics wofost 1 introduction sensitivity analysis sa i e the investigation of how changes in input factors influence numerical model outputs is increasingly used in different research areas saltelli 2002 pianosi et al 2015 for a variety of purposes including the support to model analysis tarantola and saltelli 2003 reduction degenring et al 2004 hsieh et al 2018 and calibration makowski et al 2006 mathieu et al 2018 the analysis of system drivers pastres et al 1999 confalonieri 2012 and the support to decision making anderson et al 2014 there is a number of methods available to run sa e g borgonovo and plischke 2016 pianosi et al 2016 and their performance were compared for a variety of modeling domains e g hamby 1995 confalonieri et al 2010 nguyen and reiter 2015 in light of different criteria like e g their computational efficiency and the capability of managing interactions among factors as well as model non linearities in other cases the evaluation of approaches for sa was carried out with the aim of identifying the most appropriate sa method for a given type of model ligmann zielinska et al 2020 moreover some studies analysed the robustness of some of these methods with respect to changes in the values of their own parameters e g confalonieri et al 2010 herman et al 2013 vanrolleghem et al 2015 different classifications were proposed for sa methods each deriving from the classification criteria that were adopted in case e g the criterion is parsimony number of model executions needed to derive the sensitivity metrics sa methods can be ranked from screening methods highest parsimony to variance based ones lowest parsimony regardless of the type of model morris morris 1991 and e fast saltelli et al 1999 play a key role among the most popular sa methods they have been widely used alone e g campolongo et al 2007 xu and gertner 2011 or in an integrated fashion e g martre et al 2015 with morris used to screen for non influential parameters in case of computationally expensive simulation experiments before the application of the more demanding e fast method on the remaining ones although they are classified in two distinct categories of sa methods i e screening in the case of morris and variance based for e fast and the theoretical principles behind their algorithms are drastically different their popularity is likely due to the same peculiarity the efficiency in sampling the hyperspace of parameters within their category of sa techniques indeed morris is considered as one of the most effective screening method whereas e fast is less computationally expensive than other methods based on the decomposition of output variance like sobol 1993 confalonieri et al 2010 however in spite of the continuous increase in the power of computers of the already mentioned possibility to combine screening and variance based methods and of a certain tendency to instability of morris in case of strong model non linearities confalonieri et al 2010 hsieh et al 2018 the extreme efficiency of morris makes this method somehow seductive this is particularly true when sa techniques are applied to spatially distributed models for which variance based methods sometimes require a prohibitive number of model executions herman et al 2013 moreover although variance based methods are considered as benchmark approaches for quantifying total order effects e g saltelli and sobol 1995 sa is often carried out just to discriminate between influential and non influential parameters for practical purposes like e g in cases when target parameters for calibration need to be identified mathieu et al 2018 for this purpose ranking parameters according to their relative importance is what is needed and modelers in this case aim at reaching a trade off between accuracy and computational cost of sa herman et al 2013 nevertheless findings of studies where morris was evaluated against variance based methods also for ranking purposes are not unambiguous with good morris performances highlighted in some of these studies e g herman et al 2013 and poor reliability of the method discussed in others e g vanrolleghem et al 2015 despite the reasons for this are not clear some authors suggested that the differences in morris performance could deal with intrinsic factors of models from different disciplines or with the fact that sa is not always properly performed saltelli et al 2019 in some cases when poor performances were achieved they were explained with a tendency of morris to be prone to type ii error e g campolongo et al 2007 i e to underestimate the relevance of input factors with a large effect on model outputs especially in case of strong model non linearities confalonieri et al 2010 hsieh et al 2018 other authors underlined that disagreement between morris and variance based results could arise when non uniform distributions of input factors are used e g feng et al 2018 this study aimed at comparing morris and e fast methods using three generic crop models that greatly differ for complexity and for the approaches used to formalize knowledge on crop growth and development by running sa experiments at sub model level crop models can be considered as particularly suitable for evaluating and comparing sa methods given they are strongly non linear and they often present correlations among parameters moreover sa should be considered as mandatory before using crop models since their calibration is often performed under conditions characterized by unfavorable number of parameters to number of observations ratio therefore running sa to identify target parameters for calibration for the specific conditions of application sa is situational stearns 1992 reduces the risk of losing robustness because of equifinality and overfitting whittaker et al 2010 her and chaubey 2015 simulations were carried out for rice while exploring different environmental conditions by paying particular attention to parameter distributions and related uncertainty this being something whose impact on sa results if quantified paleari and confalonieri 2016 can be considerable especially when results from morris and variance based methods are compared using non uniform distributions for model parameters feng et al 2018 2 materials and methods 2 1 sensitivity analysis methods 2 1 1 the morris method assuming x x 1 x n as the vector of model parameters each x i is forced to assume values in the set 0 1 p 1 2 p 1 3 p 1 p 2 p 1 1 with p being the number of levels i e values over which parameters can be sampled in the n dimensional p level unit hypercube parameter space ω after defining δ 1 p 1 an elementary effect r i for the ith parameter is calculated as 1 r i x δ y x 1 x i 1 x i δ x i 1 x n y x δ where y x is the model output the ω hyperspace is sampled by selecting r trajectories each composed by n 1 points with δ being applied at each point to a single parameter compared to traditional one factor at a time sa design model evaluations are carried out while varying single parameters along trajectories through the ω hyperspace the morris sampling method prevents parameters from assuming any of the previous values when varied and it allows limiting the number of model evaluations to r n 1 after the sampling parameters are scaled back from the unit hypercube to their original ranges according to the specified parameter distributions based on quantiles mean μ and standard deviation σ are calculated for each distribution of r i that represent the sensitivity measures for the parameter x i μ strength quantifying the overall influence of x i on y x total order effect and σ spread identifying parameters with a non linear effect on y x or that are involved in interactions with other parameters saltelli et al 2004 in this study we used the version of the morris method proposed by campolongo et al 2007 where μ is derived by averaging r i instead of r i further details on the morris method are available e g in morris 1991 campolongo et al 2007 and king and perera 2013 2 1 2 the e fast method variance based methods use variance ratios to quantify the importance of parameters the total variance of model output v y is decomposed into terms of increasing dimension partial variances that represent the contribution of single parameters 1st order effects and of pairs of parameters 2nd order effects triplets 3rd order effects etc to the overall variability of y 2 v y i 1 n d i i j n n d i j i n n d i n where d i v e y x i is the first order effect of x i d i j v e y x i x j d i d j is the 2nd order effect interaction between x i and x j and terms up to d i n represent higher order effects the 1st order effect sensitivity index for x i is calculated as 3 s i v e y x i v y given the high computational cost required to estimate the sensitivity indices of higher order interactions homma and saltelli 1996 proposed the concept of total sensitivity index which allows markedly reducing the computational effort at the cost of a reasonable number of model runs the total sensitivity index s t i eq 4 provides a measure of the overall effect of a parameter considering the interactions with all the others 4 s t i s i j i s i j s 1 n compared to other variance based methods e g sobol 1993 e fast explores the n dimensional parameter hyperspace by using a search curve defined by a set of parametric equations 5 x i s 0 5 1 π ω i s φ i where ω i i 1 n is the angular frequency associated to the factor x i s is a scalar variable ranging from to and φ i 0 2 π is a random factor random phase shift indicating the starting point of the search curve the sampling procedure driven by the transformation presented in eq 5 is repeated different times by selecting different values of φ i and final sensitivity metrics are obtain as the arithmetic means of the metrics obtained for the different φ i this transformation allows e fast exploring very efficiently the hyperspace reducing the number of model executions compared to other variance based methods and it is one of the reasons for its great popularity further details on the e fast method are available e g in saltelli et al 1999 and ryan et al 2018 2 2 the crop models the three crop models used in this study cropsyst stöckle et al 1994 stics brisson et al 1998 and wofost van keulen and wolf 1986 are generic able to reproduce growth and development of different species with different sets of parameters and widely used within the modellers community they all simulate phenological development based on thermal time accumulation although they use different functions to reproduce crop response to mean daily temperature with options to account for photoperiod sensitivity the main differences among the three models are in the algorithms used to simulate crop growth with cropsyst and stics that are based on monolayer canopy representations beer s law analogies for intercepting radiation and net photosynthesis estimated using radiation use efficiency rue in the case of stics and both rue and vapor pressure deficit vpd corrected transpiration use efficiency tanner and sinclair 1983 for cropsyst on the contrary wofost uses a gross photosynthesis approach based on leaf light response curve with instantaneous gross co2 assimilation estimated at three moments in the day and at three canopy depths for this model daily biomass accumulation is estimated after growth and maintenance respiration are considered the main driver for estimating leaf area index lai in stics is crop development whereas wofost derives the same variable based on a development dependent specific leaf area sla and the amount of assimilates daily partitioned to leaves for cropsyst lai is estimated according to the early stage sla the daily rate and state of aboveground biomass agb and an empiric parameter named stem leaf partition coefficient slp leaf senescence is estimated by the three models as a function of the thermal time accumulated by daily emitted lai units with wofost considering also the effect of self shading yield is derived based on the concept of harvest index for stics and cropsyst and with a dynamic partitioning of assimilates for wofost concerning wofost we used the version proposed by stella et al 2014 based on the substitution of afgen tables arbitrary function generator with functions driven by few parameters further details on the models algorithms are available in the seminal literature and in the models documentation whereas their suitability for simulating rice growth and development has been demonstrated by confalonieri and bocchi 2005 cropsyst stella et al 2014 wofost and li et al 2015 stics who evaluated the performances of the three models for rice under a variety of environmental conditions the three models and related documentations are available at http modeling bsyse wsu edu cs suite cropsyst index html cropsyst https www wur nl en research results research institutes environmental research facilities tools software models and databases wofost htm wofost https www6 paca inrae fr stics eng stics 2 3 simulation experiment the e fast and morris methods were used to run sa experiments with the three crop models under temperate northern italy and tropical philippines conditions only parameters involved with crop growth and development under unlimiting conditions for water and nitrogen were considered the simulations carried out in italy refer to experiments conducted in vignate 45 29 n 9 22 e 121 m a s l and opera 45 22 n 9 12 e 99 m a s l in 2002 where the tropical japonica profile cultivars thaibonnet and sillaro were sown on 29 april crops were grown continuous flooding under different nitrogen treatments and harvested at physiological maturity on 29 vignate and 20 opera september simulations in the philippines refer to experiments carried out in los baños 14 10 n 121 15 e 118 m a s l at the international rice research institute irri with the indica rice cultivar ir64 transplanted on 30 november 2011 dry season and 6 june 2012 wet season in this case rice was grown under continuous flooding and different salinity levels including a control treatment irrigated with fresh water and harvested on 19 march 2012 dry season and 19 september 2012 wet season further details on the experiments are provided by confalonieri and bocchi 2005 and radanielson et al 2018 for the experiments carried out in italy and in the philippines respectively given parameters involved with phenological development markedly affect also processes involved with crop growth their sensitivity metrics calculated on variables such as agb or yield can assume values much higher than those of parameters involved with other processes like radiation interception photosynthesis or leaf area expansion richter et al 2010 this could decrease the capability of sa to discriminate among the relevance of parameters not involved with phenology for this reason although the variable analyzed was always agb simulated at physiological maturity synthetically representing all processes involved with crop growth and development sa experiments were carried out separately for parameters involved with phenological development and growth confalonieri et al 2010 this allowed increasing the discriminating power of sa while quantifying the impact of changes in parameter values on the variability of the model output parameter distributions and related sources of information are presented in appendices a to c for the parameters for which sources were not enough to check distribution available values were averaged and distribution was assumed to be normal with standard deviation equal to 5 of the mean richter et al 2010 according to confalonieri et al 2010 the morris method was parameterized with six trajectories and six levels for stics this corresponded to 78 and 156 model executions for the sa experiments carried out on parameters involved with phenology and growth respectively corresponding values for cropsyst were 48 and 60 whereas they were 54 and 120 for wofost previous studies suggested to parameterize the e fast method to get a number of model executions of about 250 multiplied by the number of model parameters confalonieri et al 2010 this led to 2988 and 6225 executions for phenology and growth in case of stics 1743 phenology and 2241 growth for cropsyst and 1992 phenology and 4731 growth for wofost these sample sizes are consistent with what suggested in the literature e g campolongo et al 2007 however their suitability was evaluated for all the models and for sample environments and processes using smaller five trajectories for morris and 200 times the number of parameters for e fast and larger seven trajectories and 300 times the parameters sample sizes to verify the stability of sa results in order to compare the rankings obtained i using the morris and e fast sa methods within each environment concordance among sa methods and ii using each of the two methods in different environments concordance among environments we used the top down concordance coefficient tdcc 0 to 1 1 indicating complete concordance iman and conover 1987 compared to other concordance metrics tdcc emphasizes the agreement among high ranked parameters and vice versa the first step to calculate tdcc is to rank the model parameters according to their sensitivity metrics rank 1 is assigned to the parameter that achieved the highest sensitivity metric rank n to the parameter with the lowest sensitivity metric this step was performed for each sa experiment j i e for each combination environment sa method process growth or phenological development the second step was the calculation of the savage scores savage 1956 s s s i j from the 1 i n ranks r s i j assigned to each parameter i 6 s s s i j i r s i j n 1 i where s i j is the sensitivity metric of the ith parameter after parameters have been ranked according to their relevance as achieved in the jth sa experiment the third step was the calculation of tdcc from the s s s i j calculated for the different sa experiments eq 7 7 t d c c i 1 n j 1 n s a s s s i j 2 n s a 2 n n s a 2 n i 1 n 1 i where n s a is the number of sa experiments for which rankings are compared e g rankings obtained for parameters involved with phenological development in a certain environment using morris and e fast sa methods the fourth final step was the evaluation of the significance of the concordance under the null hypothesis of no concordance among parameter rankings the p value for tdcc can be estimated using the statistics t which approximates a χ 2 distribution with n 1 degrees of freedom 8 t n s a n 1 t d c c with concordance among rankings considered non statistically significant for p values higher than 0 05 3 results table 1 shows the values of e fast st and morris µ calculated for the stics model both methods identified thermal time from emergence to beginning of grain filling stlevdrp as decidedly the most relevant among the parameters involved with phenological development it explained on average 90 of the variability in model output according to e fast followed by thermal time from emergence to end of juvenile phase stlevamf and minimum temperature below which development stops tdmin on average the relevance of tdmin was larger for the two italian environments 56 and 32 according to µ and st respectively likely because of the lower temperatures experienced by rice especially in the first part of the cycle concerning the parameters involved with crop growth both methods led canopy extinction coefficient extin and maximum rue during vegetative phase efcroiveg to achieve the highest sa indices for efcroiveg higher values for the sensitivity metrics were obtained in the italian environments because changes in parameters involved with photosynthetic efficiency especially after the close canopy stage have a larger effect on productivity in temperate environments where radiation may be suboptimal for rice compared to results of sa experiments performed on stics parameters involved with phenology both morris and e fast provided metric values more homogeneous in case of parameters affecting crop growth although a discontinuity was still observed between top ranked parameter and the others fig 1 although with different ranks indeed the two methods identified as relevant also other parameters involved with photosynthetic efficiency rue in different phenological phases and parameters modulating the thermal limitation to photosynthesis as already observed for stics also the sa preformed on cropsyst table 2 indicated thermal time to complete the vegetative phase gddfl as the most relevant in affecting agb at maturity among the parameters involved with phenological development this was particularly evident for e fast for which the parameter explained more than 90 of the total variance in the model output moreover like for stics base temperature for thermal time accumulation tbasedev resulted as one of the most important parameters being ranked 3rd and 2nd according to morris and e fast respectively on the contrary morris identified one of the parameters involved with photoperiod as highly impacting on agb at maturity in the tropical environments whereas photoperiod parameters were never high ranked for stics both sa methods indicated canopy extinction coefficient k as the parameter with the largest impact on agb accumulation also for cropsyst followed by optimum temperature for biomass accumulation topt with the latter achieving in the temperate environments larger values for µ compared to what estimated in tropical ones and vice versa for st this was one of the largest differences between the two sa methods in terms of values assumed by the sa metrics for high ranked parameters in the different environments parameters involved with leaf area expansion were low ranked regardless of the sa method and environment and rue resulted decidedly less importance compared to what observed for stics given biomass accumulation in cropsyst is driven by rue only for very low vpd values otherwise net photosynthesis is driven by the water potentially transpired coherently with the results achieved for the other two models thermal time during the vegetative phase tsum1 resulted largely the most relevant parameter also for wofost regardless of the sa method and the environment for which simulations were run table 3 base temperature for development tbdev was ranked 2nd according to both st and µ in line with the importance achieved by the corresponding parameters for stics and cropsyst concerning this parameter only the e fast method assigned higher sensitivity in the temperate environments whereas the opposite was obtained using morris this is in line with the results of the sa experiments performed on cropsyst whereas stics was the only model for which both sa metrics were coherent in identifying the parameter as more important in case of lower thermal regimes although with values of the sensitivity metrics decidedly lower than those estimated for tsum1 the 3rd ranked parameter according to both methods was phinib involved with photoperiod response contrarily to what obtained for stics and cropsyst the parameters with the highest relevance according to both sa methods were involved with the simulation of leaf area expansion before the close canopy stage laiem and rgrlai and not with photosynthetic efficiency e g amax was ranked only fourth and sixth by morris and e fast respectively however the 3rd ranked parameter was involved with the temperature response functions limiting co2 assimilation with morris results underlying the higher importance of thermal limitation in temperate environments already observed when the same sa method was applied to cropsyst another marked difference between the sa results obtained for wofost compared to what achieved for the other two models was related with extinction coefficient which was ranked 1st in the two models based on net photosynthesis whereas it was only 6th morris and 9th e fast in wofost although both morris µ and e fast st represent the overall influence of a parameter on the model output total order effect they are not directly comparable given they share neither the same conceptual meaning nor the same unit for this reason to investigate their relationships we applied a linear normalization to the means and the standard deviations of the values of the metrics that were estimated for each model and parameter for the different environments this allowed re scaling all the mean values of µ μ and st s t in the range 0 to 1 and to get coherent information on their variability across environments fig 1 regardless of the model and of the process considered phenological development or growth it is possible to notice the absence of linearity in the relationships between the normalized values of the two sensitivity metrics given variance based methods are considered as benchmark approaches for quantifying total order effects e g saltelli and sobol 1995 fig 1 shows the low reliability of the morris method for quantifying the absolute importance of parameters the savage scores of the sensitivity metrics estimated for the different environments were averaged to compare the overall capability of the two methods to rank parameters according to their total order effect fig 2 mean savage scores highlighted the overall reliability of the morris method in ranking model parameters the main exception being represented by low ranked parameters for processes involved with crop growth for stics and wofost in particular mean savage scores estimated on the sensitivity metrics provided by the two methods were consistent for top ranked parameters in most cases despite a certain variability bars in fig 2 among the values achieved for some parameters across different environments the comparison of the rankings obtained with the two methods for each environment always led to tdcc values higher than 0 90 with the concordance being significant p 0 05 regardless of the model and the environment for the parameters involved with crop growth and for the stics parameters involved with phenological development the concordance was instead significant only at p 0 10 for the cropsyst and wofost parameters involved with phenology the differences in the rankings obtained for different environments within the same sa method were always considered as minor according to tdcc p values always lower than 0 05 with e fast achieving the highest tdcc values for all the combinations process development vs growth crop model the only exception being represented by the cropsyst parameters involved with crop growth 4 discussion for all crop models parameters representing thermal time to complete the vegetative phase were decidedly the most relevant among those involved with phenological development this is consistent with the great importance of the underlying plant trait within rice breeding programs given this trait is among those for which breeders have the largest possibility to generate variability among genotypes to increase their suitability to different environments e g shrestha et al 2014 gao et al 2014 moreover thermal time to complete the vegetative phase has a large effect on the amount of green leaf area produced by the crop before the reproductive phase and thus it directly affects the amount of radiation that is intercepted and in turn the amount of biomass accumulated at the end of the crop cycle i e the model output investigated in this study however besides the importance of related parameters for genetic and physiological reasons the high sensitivity metrics achieved by the parameters representing thermal time to complete the vegetative phase was partly due to the fact that values found in literature led to uniform distributions whereas normal ones were achieved for all the other parameters appendices a c contrarily to what achieved for stics and to what should be to a certain extent expected the relevance of base temperature for development for cropsyst and wofost was not larger in the colder environments italy according to the morris method thus suggesting that the different temperature response functions implemented in the three models led to compensations among parameters that were differently captured by the two sa methods concerning crop growth the most important parameters for stics and cropsyst were involved with canopy structure extinction coefficient ranked 1st regardless of the model and method and photosynthetic efficiency rue for stics tue for cropsyst whereas for wofost the highest values for the sensitivity metrics were achieved by parameters involved with leaf area expansion before the close canopy stage besides the great conceptual difference in the way knowledge on processes involved with photosynthesis is formalized in wofost compared to the other two models which could translate per se in different models behavior the lower importance of wofost parameters involved with photosynthetic efficiency can likely be due also to the number of parameters involved for wofost indeed there are many parameters dealing with gross co2 assimilation as well as with growth and maintenance respiration that at the end of each time step contribute to the quantification of biomass accumulation on the contrary biomass accumulation is typically driven by few parameters in models based on the concept of net photosynthesis hammer et al 2019 in practice the portion of agb variability due to photosynthesis is attributed to few parameters for stics and cropsyst and to many parameters for wofost the lack of linearity in the relationships between the values of µ and st fig 1 is in line with what achieved by herman et al 2013 during sa experiments carried out on distributed watershed models these authors observed that the relationships between µ and st the latter estimated using the sobol method were approximatively linear for low sensitive parameters whereas they were nonlinear for high sensitive ones this pattern is partly reproduced in the relationships we found regardless of the process model and environment fig 1 differences between morris and e fast mean savage scores fig 2 increased with the number of parameters for which the sa was performed with the lowest differences observed for phenology in cropsyst and wofost 7 and 8 parameters respectively and the largest for growth in stics and wofost 25 and 19 parameters indeed the linear relationships between the number of parameters and the relative root mean square error rrmse calculated on mean st and µ savage scores was almost significant r2 0 65 p value 0 054 the same linear relationship was instead significant p value 0 026 when st and µ savage scores were considered separately for the different environments this finding could be considered as in line with what achieved by silvestro et al 2017 who reported that the correlation between morris µ and e fast st was higher for the safye crop model 17 parameters than for aquacrop 34 parameters for water limited wheat yield simulations in china and italy this consideration higher morris instability for large number of parameters seems to be supported also by hsieh et al 2018 who discussed divergence between µ and st based rankings with a physiologically based pharmacokinetic model with 58 parameters however this aspect needs further investigation given the number of parameters per se is likely not enough to explain the performances of the morris method when they are compared with variance based approaches indeed herman et al 2013 achieved good performance when morris was applied to a spatially distributed model with 1092 parameters whereas menberg et al 2016 considered the morris method as unstable with a building energy model with only 11 parameters as well as vanrolleghem et al 2015 with an urban water quality model with 17 parameters despite minor differences in the parameter rankings obtained with the two sa methods their concordance tdcc resulted always significant at the 0 10 level and this is to a certain extent surprising in light of the number of model executions needed by the two methods to provide the sensitivity metrics which for morris was less than 3 of the number of executions needed by e fast the sample sizes we used for the two sa methods allowed achieving stable results indeed the comparison between the rankings presented in fig 2 obtained using six trajectories morris and 250 times the number of parameters e fast and the rankings obtained with five and seven trajectories and 200 and 300 times the parameters led to tdcc values ranging from 0 979 to 1 000 with concordance being always significant p 0 05 our results seem to contradict the findings from other authors e g sobol and kucherenko 2009 feng et al 2018 who observed distortions in the relationships between sensitivity metrics from morris and variance based methods in case non uniform distributions for input factors were used indeed regardless of the crop model and of the environmental conditions explored morris and e fast results were consistent despite the values for the parameters we collected from the literature led to normal distributions for all the parameters but one thermal time to complete the vegetative phase 5 conclusions in this study a number of sa experiments was performed for the first time using different sa methods on different crop models at sub model level phenological development vs crop growth while exploring different environmental conditions results achieved by morris seem to a certain extent to cast a shadow on the need of using sa methods more demanding in terms of model executions especially in case of computationally expensive models or for high resolution spatially distributed sa experiments e g herman et al 2013 koo et al 2020 however the solution is more complex since it depends on the specific objectives of the sa study indeed although sa is often performed to identify relevant parameters before calibration e g mathieu et al 2018 or non influential ones for model reduction or simplification e g hsieh et al 2018 there are cases where the contribution of parameters to output variance needs to be quantified beyond what is needed to rank parameters this means that the sensitivity metrics of the different parameters are important also in term of their absolute value not only in relative terms as when ranking is the final goal this is the case when sensitivity metrics are used for further analyses like for deriving quantitative criteria to identify crop ideotypes e g paleari et al 2017 or in general when an accurate estimate of the contribution of parameters to output variability is needed indeed the lack of linearity between e fast st and morris µ confirmed the unsuitability of the latter for quantifying parameter relevance in absolute terms credit authorship contribution statement livia paleari conceptualization methodology investigation formal analysis writing original draft writing review editing ermes movedi methodology investigation formal analysis writing review editing michele zoli investigation formal analysis writing review editing andrea burato investigation formal analysis writing review editing irene cecconi investigation formal analysis writing review editing jabir errahouly investigation formal analysis writing review editing eleonora pecollo investigation formal analysis writing review editing carla sorvillo investigation formal analysis writing review editing roberto confalonieri conceptualization methodology investigation formal analysis writing original draft writing review editing declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgements we would like to gratefully acknowledge dr tao li from dndc applications research and training and dr ando radanielson from the university of southern queensland for providing information needed to run the simulations in the two environments in the philippines appendices appendix a stics parameters distributions and sources of information parameter name acronym units distribution sourcea phenological development minimum temperature below which development stops tdmin c normal 11 5 0 71 1 maximum temperature above which development stops tdmax c normal 30 1 5 1 saturating photoperiod for development phosat h normal 10 0 5 2 base photoperiod for development phobase h normal 14 0 7 2 index of photoperiod sensitivity 1 insensitive sensiphot normal 0 9 0 045 2 duration between sowing and emergence stpltger c days normal 50 2 5 2 minimum temperature for emergence tgmin c normal 8 5 0 43 2 3 thermal time emerg end of juvenile phase stlevamf c days normal 447 4 146 1 2 4 therm time max acceleration of leaf growth max lai stamflax c days normal 359 44 4 2 4 thermal time emergence beginning of grain filling stlevdrp c days uniform 330 1100 2 4 duration grain filling onset water dynamics in grains stdrpdes c days normal 250 12 5 2 thermal time beginning of grain filling maturity stdrpmat c days normal 477 7 35 2 2 4 growth light interception photosynthesis assimilate partitioning leaf area yield formation minim density above which interplant competition starts bdens plants m 2 normal 34 5 1 72 2 temperature beyond which foliar growth stops tcxstop c normal 36 1 8 2 minimum temperature at which growth ceases tcmin c normal 12 0 6 2 maximum temperature at which growth ceases tcmax c normal 30 1 5 2 max rate of the setting up of lai dlaimaxbrut m2 leaf plant 1 c day 1 normal 6 10 4 3 10 5 2 4 parameter of the logistic curve of lai growth pentlai normal 5 5 0 275 2 maximum height of the crop hautmax m normal 0 96 0 12 2 extinction coefficient of photosynthetic active radiation extin normal 0 45 0 08 1 5 6 minimum temperature for plant growth temin c normal 12 0 6 1 2 optimal temperature 2 2 for plant growth teoptbis c normal 28 2 1 4 optimal temperature 1 2 for plant growth teopt c normal 20 27 1 01 2 4 maximum threshold temp for net photosynthesis temax c normal 38 15 1 91 2 4 max rue during the juvenile phase efcroijuv g mj 1 normal 2 95 0 15 1 2 4 6 max rue during the vegetative stage efcroiveg g mj 1 normal 3 2 0 16 1 2 4 6 max rue during the grain filling phase efcroirepro g mj 1 normal 2 8 0 14 1 2 4 6 minimum specific leaf area of green leaves slamin m2 kg 1 normal 18 9 1 2 maximum specific leaf area of green leaves slamax m2 kg 1 normal 500 25 1 2 stem leaf proportion tgefeuille normal 3 5 0 175 2 rate of increase of the c harvest index vitircarb g grain g plant 1 day 1 normal 0 01 5 10 5 2 4 maximum c harvest index irmax g grain g plant 1 normal 0 65 0 034 2 max temperature above which grain filling stops tmaxremp c normal 36 1 8 2 minimal temperature below which grain filling stops tminremp c normal 12 0 6 2 max grain weight at 0 water content pgrainmaxi g grain 1 norm 25 10 3 2 7 10 3 2 4 7 interplant competition parameter adens normal 0 6 0 03 2 4 max lifespan of adult leaves in sum q10 2 2 t tbase durvief normal 120 6 2 a1 confalonieri and bocchi 2005 2 model default 3 sanchez et al 2014 4 bregaglio et al 2017 5 kiniri et al 2001 6 boschetti et al 2006 7 timsina and humphreys 2006 appendix b cropsyst parameters distributions and sources of information parameter name acronym units distribution sourcea phenological development thermal time from flowering to maturity gddmat c days normal 388 61 1 2 thermal time from emergence to flowering gddfl c days uniform 400 1560 1 2 thermal time to reach emergence gddem c days normal 70 3 5 1 2 base temperature for thermal time accumulation tbasedev c normal 11 5 0 7 1 optimum temperature for thermal time accumulation toptdev c normal 30 1 5 1 critical day length duration phototh h normal 12 16 1 13 3 photoperiod sensitivity photosens normal 0 9 0 05 4 growth light interception photosynthesis assimilate partitioning leaf area yield formation specific leaf area at early stages sla m2 kg 1 normal 28 05 1 4 1 5 stem leaf partition coefficient slp normal 1 45 0 53 1 maximum radiation use efficiency rue g mj 1 normal 2 7 0 1 5 6 canopy light extinction coefficient k normal 0 45 0 08 1 5 6 minimum temperature for growth tmin c normal 10 9 0 75 1 4 optimum temperature for growth topt c normal 28 2 1 leaf duration leafduration c day normal 700 80 1 4 biomass transpiration coefficient btr kpa kg m 3 normal 6 1 0 3 1 leaf area index at emergence laiini m2 m 2 normal 0 01 0 005 1 4 a 1 confalonieri and bocchi 2005 2 li et al 2015 3 timsina and humphreys 2006 4 unpublished data 5 boschetti et al 2006 6 kiniri et al 2001 appendix c wofost parameters distributions and sources of information parameter name acronym units distribution sourcea phenological development base temperature for development tbdev c normal 11 5 0 7 1 optimum temperature for development toptdev c normal 30 1 5 1 maximum threshold temperature for development tmaxdev c normal 42 2 1 1 thermal time from flowering to maturity tsum2 c days normal 388 61 1 2 thermal time from emergence to flowering tsum1 c days uniform 400 1560 1 2 thermal time from sowing to emergence tsumem c days normal 70 3 5 1 2 critical day length phinib h normal 12 16 1 13 3 photoperiod sensitivity phins normal 0 9 0 05 4 growth light interception photosynthesis assimilate partitioning leaf area yield formation maximum leaf co2 assimilation rate amax kg ha 1 h 1 normal 49 6 2 48 5 6 7 lower threshold of temp effects on co2 assimilation tb c normal 12 0 6 1 7 optimum temp effects on co2 assimilation topt c normal 28 2 1 7 max threshold of temp effects on co2 assimilation tmax c normal 42 2 1 7 8 rel maintenance respiration rate for roots rmr kg ch2o kg 1 day 1 normal 0 012 0 0011 5 7 9 rel maintenance respiration rate for leaves rml kg ch2o kg 1 day 1 normal 0 028 0 0005 5 7 9 rel maintenance respiration rate for stems rms kg ch2o kg 1 day 1 normal 0 018 0 001 5 7 9 rel maint resp rate for storage organs rmo kg ch2o kg 1 day 1 normal 0 01 0 0005 5 7 9 efficiency of conversion into roots cvr normal 0 7125 0 0356 5 7 9 efficiency of conversion into leaves cvl normal 0 7125 0 0356 5 7 9 efficiency of conversion into stems cvs normal 0 7125 0 0356 5 7 9 efficiency of conversion into storage organs cvo normal 0 675 0 0338 5 7 9 specific leaf area at emergence slaini kg m 2 normal 0 0045 0 0003 5 specific leaf area at tillering slatill kg m 2 normal 0 003 0 0002 5 partitioning of assimilates to leaves at emergence ripl0 normal 0 7 0 1 5 10 leaf area index at emergence laiem normal 0 01 0 005 5 10 life span of leaves growing at 35 c span days normal 35 3 5 7 canopy light extinction coefficient k normal 0 45 0 08 7 8 11 maximum relative increase in leaf area index rgrlai normal 0 0085 0 00048 5 7 9 a1 confalonieri and bocchi 2005 li et al 2015 3 timsina and humphreys 2006 4 unpublished data 5 stella et al 2014 6 ziska and teramura 1992 7 kropff et al 1994 8 dingkuhn et al 1999 9 van diepen et al 1988 10 confalonieri et al 2010 11 boschetti et al 2006 
24594,sensitivity analysis sa is a fundamental practice for analyzing model behavior under different conditions of application a number of sa techniques were proposed ranging from simple screening methods to computationally expensive variance based ones in this study we compared the morris and e fast methods by applying them to three widely used generic crop models largely differing for complexity and for the approaches used to formalize knowledge on crop physiology i e stics cropsyst and wofost sa experiments were carried out at sub model level on rice crops grown under different environmental conditions results highlighted the lack of linearity between the total order sensitivity estimates provided by e fast and morris although the concordance tdcc between the parameter rankings obtained with the two methods was always significant at the 0 05 level for parameters involved with crop growth and for those involved with phenological development for stics whereas it was significant at the 0 10 level for the phenology parameters of cropsyst and wofost given morris required less than 3 of the model executions needed by e fast our results allow considering morris as a suitable alternative to more demanding sa methods when ranking parameters or discriminating between influential and non influential model factors are the sa goals especially in computationally expensive sa studies keywords crop model cropsyst e fast fourier amplitude sensitivity test stics wofost 1 introduction sensitivity analysis sa i e the investigation of how changes in input factors influence numerical model outputs is increasingly used in different research areas saltelli 2002 pianosi et al 2015 for a variety of purposes including the support to model analysis tarantola and saltelli 2003 reduction degenring et al 2004 hsieh et al 2018 and calibration makowski et al 2006 mathieu et al 2018 the analysis of system drivers pastres et al 1999 confalonieri 2012 and the support to decision making anderson et al 2014 there is a number of methods available to run sa e g borgonovo and plischke 2016 pianosi et al 2016 and their performance were compared for a variety of modeling domains e g hamby 1995 confalonieri et al 2010 nguyen and reiter 2015 in light of different criteria like e g their computational efficiency and the capability of managing interactions among factors as well as model non linearities in other cases the evaluation of approaches for sa was carried out with the aim of identifying the most appropriate sa method for a given type of model ligmann zielinska et al 2020 moreover some studies analysed the robustness of some of these methods with respect to changes in the values of their own parameters e g confalonieri et al 2010 herman et al 2013 vanrolleghem et al 2015 different classifications were proposed for sa methods each deriving from the classification criteria that were adopted in case e g the criterion is parsimony number of model executions needed to derive the sensitivity metrics sa methods can be ranked from screening methods highest parsimony to variance based ones lowest parsimony regardless of the type of model morris morris 1991 and e fast saltelli et al 1999 play a key role among the most popular sa methods they have been widely used alone e g campolongo et al 2007 xu and gertner 2011 or in an integrated fashion e g martre et al 2015 with morris used to screen for non influential parameters in case of computationally expensive simulation experiments before the application of the more demanding e fast method on the remaining ones although they are classified in two distinct categories of sa methods i e screening in the case of morris and variance based for e fast and the theoretical principles behind their algorithms are drastically different their popularity is likely due to the same peculiarity the efficiency in sampling the hyperspace of parameters within their category of sa techniques indeed morris is considered as one of the most effective screening method whereas e fast is less computationally expensive than other methods based on the decomposition of output variance like sobol 1993 confalonieri et al 2010 however in spite of the continuous increase in the power of computers of the already mentioned possibility to combine screening and variance based methods and of a certain tendency to instability of morris in case of strong model non linearities confalonieri et al 2010 hsieh et al 2018 the extreme efficiency of morris makes this method somehow seductive this is particularly true when sa techniques are applied to spatially distributed models for which variance based methods sometimes require a prohibitive number of model executions herman et al 2013 moreover although variance based methods are considered as benchmark approaches for quantifying total order effects e g saltelli and sobol 1995 sa is often carried out just to discriminate between influential and non influential parameters for practical purposes like e g in cases when target parameters for calibration need to be identified mathieu et al 2018 for this purpose ranking parameters according to their relative importance is what is needed and modelers in this case aim at reaching a trade off between accuracy and computational cost of sa herman et al 2013 nevertheless findings of studies where morris was evaluated against variance based methods also for ranking purposes are not unambiguous with good morris performances highlighted in some of these studies e g herman et al 2013 and poor reliability of the method discussed in others e g vanrolleghem et al 2015 despite the reasons for this are not clear some authors suggested that the differences in morris performance could deal with intrinsic factors of models from different disciplines or with the fact that sa is not always properly performed saltelli et al 2019 in some cases when poor performances were achieved they were explained with a tendency of morris to be prone to type ii error e g campolongo et al 2007 i e to underestimate the relevance of input factors with a large effect on model outputs especially in case of strong model non linearities confalonieri et al 2010 hsieh et al 2018 other authors underlined that disagreement between morris and variance based results could arise when non uniform distributions of input factors are used e g feng et al 2018 this study aimed at comparing morris and e fast methods using three generic crop models that greatly differ for complexity and for the approaches used to formalize knowledge on crop growth and development by running sa experiments at sub model level crop models can be considered as particularly suitable for evaluating and comparing sa methods given they are strongly non linear and they often present correlations among parameters moreover sa should be considered as mandatory before using crop models since their calibration is often performed under conditions characterized by unfavorable number of parameters to number of observations ratio therefore running sa to identify target parameters for calibration for the specific conditions of application sa is situational stearns 1992 reduces the risk of losing robustness because of equifinality and overfitting whittaker et al 2010 her and chaubey 2015 simulations were carried out for rice while exploring different environmental conditions by paying particular attention to parameter distributions and related uncertainty this being something whose impact on sa results if quantified paleari and confalonieri 2016 can be considerable especially when results from morris and variance based methods are compared using non uniform distributions for model parameters feng et al 2018 2 materials and methods 2 1 sensitivity analysis methods 2 1 1 the morris method assuming x x 1 x n as the vector of model parameters each x i is forced to assume values in the set 0 1 p 1 2 p 1 3 p 1 p 2 p 1 1 with p being the number of levels i e values over which parameters can be sampled in the n dimensional p level unit hypercube parameter space ω after defining δ 1 p 1 an elementary effect r i for the ith parameter is calculated as 1 r i x δ y x 1 x i 1 x i δ x i 1 x n y x δ where y x is the model output the ω hyperspace is sampled by selecting r trajectories each composed by n 1 points with δ being applied at each point to a single parameter compared to traditional one factor at a time sa design model evaluations are carried out while varying single parameters along trajectories through the ω hyperspace the morris sampling method prevents parameters from assuming any of the previous values when varied and it allows limiting the number of model evaluations to r n 1 after the sampling parameters are scaled back from the unit hypercube to their original ranges according to the specified parameter distributions based on quantiles mean μ and standard deviation σ are calculated for each distribution of r i that represent the sensitivity measures for the parameter x i μ strength quantifying the overall influence of x i on y x total order effect and σ spread identifying parameters with a non linear effect on y x or that are involved in interactions with other parameters saltelli et al 2004 in this study we used the version of the morris method proposed by campolongo et al 2007 where μ is derived by averaging r i instead of r i further details on the morris method are available e g in morris 1991 campolongo et al 2007 and king and perera 2013 2 1 2 the e fast method variance based methods use variance ratios to quantify the importance of parameters the total variance of model output v y is decomposed into terms of increasing dimension partial variances that represent the contribution of single parameters 1st order effects and of pairs of parameters 2nd order effects triplets 3rd order effects etc to the overall variability of y 2 v y i 1 n d i i j n n d i j i n n d i n where d i v e y x i is the first order effect of x i d i j v e y x i x j d i d j is the 2nd order effect interaction between x i and x j and terms up to d i n represent higher order effects the 1st order effect sensitivity index for x i is calculated as 3 s i v e y x i v y given the high computational cost required to estimate the sensitivity indices of higher order interactions homma and saltelli 1996 proposed the concept of total sensitivity index which allows markedly reducing the computational effort at the cost of a reasonable number of model runs the total sensitivity index s t i eq 4 provides a measure of the overall effect of a parameter considering the interactions with all the others 4 s t i s i j i s i j s 1 n compared to other variance based methods e g sobol 1993 e fast explores the n dimensional parameter hyperspace by using a search curve defined by a set of parametric equations 5 x i s 0 5 1 π ω i s φ i where ω i i 1 n is the angular frequency associated to the factor x i s is a scalar variable ranging from to and φ i 0 2 π is a random factor random phase shift indicating the starting point of the search curve the sampling procedure driven by the transformation presented in eq 5 is repeated different times by selecting different values of φ i and final sensitivity metrics are obtain as the arithmetic means of the metrics obtained for the different φ i this transformation allows e fast exploring very efficiently the hyperspace reducing the number of model executions compared to other variance based methods and it is one of the reasons for its great popularity further details on the e fast method are available e g in saltelli et al 1999 and ryan et al 2018 2 2 the crop models the three crop models used in this study cropsyst stöckle et al 1994 stics brisson et al 1998 and wofost van keulen and wolf 1986 are generic able to reproduce growth and development of different species with different sets of parameters and widely used within the modellers community they all simulate phenological development based on thermal time accumulation although they use different functions to reproduce crop response to mean daily temperature with options to account for photoperiod sensitivity the main differences among the three models are in the algorithms used to simulate crop growth with cropsyst and stics that are based on monolayer canopy representations beer s law analogies for intercepting radiation and net photosynthesis estimated using radiation use efficiency rue in the case of stics and both rue and vapor pressure deficit vpd corrected transpiration use efficiency tanner and sinclair 1983 for cropsyst on the contrary wofost uses a gross photosynthesis approach based on leaf light response curve with instantaneous gross co2 assimilation estimated at three moments in the day and at three canopy depths for this model daily biomass accumulation is estimated after growth and maintenance respiration are considered the main driver for estimating leaf area index lai in stics is crop development whereas wofost derives the same variable based on a development dependent specific leaf area sla and the amount of assimilates daily partitioned to leaves for cropsyst lai is estimated according to the early stage sla the daily rate and state of aboveground biomass agb and an empiric parameter named stem leaf partition coefficient slp leaf senescence is estimated by the three models as a function of the thermal time accumulated by daily emitted lai units with wofost considering also the effect of self shading yield is derived based on the concept of harvest index for stics and cropsyst and with a dynamic partitioning of assimilates for wofost concerning wofost we used the version proposed by stella et al 2014 based on the substitution of afgen tables arbitrary function generator with functions driven by few parameters further details on the models algorithms are available in the seminal literature and in the models documentation whereas their suitability for simulating rice growth and development has been demonstrated by confalonieri and bocchi 2005 cropsyst stella et al 2014 wofost and li et al 2015 stics who evaluated the performances of the three models for rice under a variety of environmental conditions the three models and related documentations are available at http modeling bsyse wsu edu cs suite cropsyst index html cropsyst https www wur nl en research results research institutes environmental research facilities tools software models and databases wofost htm wofost https www6 paca inrae fr stics eng stics 2 3 simulation experiment the e fast and morris methods were used to run sa experiments with the three crop models under temperate northern italy and tropical philippines conditions only parameters involved with crop growth and development under unlimiting conditions for water and nitrogen were considered the simulations carried out in italy refer to experiments conducted in vignate 45 29 n 9 22 e 121 m a s l and opera 45 22 n 9 12 e 99 m a s l in 2002 where the tropical japonica profile cultivars thaibonnet and sillaro were sown on 29 april crops were grown continuous flooding under different nitrogen treatments and harvested at physiological maturity on 29 vignate and 20 opera september simulations in the philippines refer to experiments carried out in los baños 14 10 n 121 15 e 118 m a s l at the international rice research institute irri with the indica rice cultivar ir64 transplanted on 30 november 2011 dry season and 6 june 2012 wet season in this case rice was grown under continuous flooding and different salinity levels including a control treatment irrigated with fresh water and harvested on 19 march 2012 dry season and 19 september 2012 wet season further details on the experiments are provided by confalonieri and bocchi 2005 and radanielson et al 2018 for the experiments carried out in italy and in the philippines respectively given parameters involved with phenological development markedly affect also processes involved with crop growth their sensitivity metrics calculated on variables such as agb or yield can assume values much higher than those of parameters involved with other processes like radiation interception photosynthesis or leaf area expansion richter et al 2010 this could decrease the capability of sa to discriminate among the relevance of parameters not involved with phenology for this reason although the variable analyzed was always agb simulated at physiological maturity synthetically representing all processes involved with crop growth and development sa experiments were carried out separately for parameters involved with phenological development and growth confalonieri et al 2010 this allowed increasing the discriminating power of sa while quantifying the impact of changes in parameter values on the variability of the model output parameter distributions and related sources of information are presented in appendices a to c for the parameters for which sources were not enough to check distribution available values were averaged and distribution was assumed to be normal with standard deviation equal to 5 of the mean richter et al 2010 according to confalonieri et al 2010 the morris method was parameterized with six trajectories and six levels for stics this corresponded to 78 and 156 model executions for the sa experiments carried out on parameters involved with phenology and growth respectively corresponding values for cropsyst were 48 and 60 whereas they were 54 and 120 for wofost previous studies suggested to parameterize the e fast method to get a number of model executions of about 250 multiplied by the number of model parameters confalonieri et al 2010 this led to 2988 and 6225 executions for phenology and growth in case of stics 1743 phenology and 2241 growth for cropsyst and 1992 phenology and 4731 growth for wofost these sample sizes are consistent with what suggested in the literature e g campolongo et al 2007 however their suitability was evaluated for all the models and for sample environments and processes using smaller five trajectories for morris and 200 times the number of parameters for e fast and larger seven trajectories and 300 times the parameters sample sizes to verify the stability of sa results in order to compare the rankings obtained i using the morris and e fast sa methods within each environment concordance among sa methods and ii using each of the two methods in different environments concordance among environments we used the top down concordance coefficient tdcc 0 to 1 1 indicating complete concordance iman and conover 1987 compared to other concordance metrics tdcc emphasizes the agreement among high ranked parameters and vice versa the first step to calculate tdcc is to rank the model parameters according to their sensitivity metrics rank 1 is assigned to the parameter that achieved the highest sensitivity metric rank n to the parameter with the lowest sensitivity metric this step was performed for each sa experiment j i e for each combination environment sa method process growth or phenological development the second step was the calculation of the savage scores savage 1956 s s s i j from the 1 i n ranks r s i j assigned to each parameter i 6 s s s i j i r s i j n 1 i where s i j is the sensitivity metric of the ith parameter after parameters have been ranked according to their relevance as achieved in the jth sa experiment the third step was the calculation of tdcc from the s s s i j calculated for the different sa experiments eq 7 7 t d c c i 1 n j 1 n s a s s s i j 2 n s a 2 n n s a 2 n i 1 n 1 i where n s a is the number of sa experiments for which rankings are compared e g rankings obtained for parameters involved with phenological development in a certain environment using morris and e fast sa methods the fourth final step was the evaluation of the significance of the concordance under the null hypothesis of no concordance among parameter rankings the p value for tdcc can be estimated using the statistics t which approximates a χ 2 distribution with n 1 degrees of freedom 8 t n s a n 1 t d c c with concordance among rankings considered non statistically significant for p values higher than 0 05 3 results table 1 shows the values of e fast st and morris µ calculated for the stics model both methods identified thermal time from emergence to beginning of grain filling stlevdrp as decidedly the most relevant among the parameters involved with phenological development it explained on average 90 of the variability in model output according to e fast followed by thermal time from emergence to end of juvenile phase stlevamf and minimum temperature below which development stops tdmin on average the relevance of tdmin was larger for the two italian environments 56 and 32 according to µ and st respectively likely because of the lower temperatures experienced by rice especially in the first part of the cycle concerning the parameters involved with crop growth both methods led canopy extinction coefficient extin and maximum rue during vegetative phase efcroiveg to achieve the highest sa indices for efcroiveg higher values for the sensitivity metrics were obtained in the italian environments because changes in parameters involved with photosynthetic efficiency especially after the close canopy stage have a larger effect on productivity in temperate environments where radiation may be suboptimal for rice compared to results of sa experiments performed on stics parameters involved with phenology both morris and e fast provided metric values more homogeneous in case of parameters affecting crop growth although a discontinuity was still observed between top ranked parameter and the others fig 1 although with different ranks indeed the two methods identified as relevant also other parameters involved with photosynthetic efficiency rue in different phenological phases and parameters modulating the thermal limitation to photosynthesis as already observed for stics also the sa preformed on cropsyst table 2 indicated thermal time to complete the vegetative phase gddfl as the most relevant in affecting agb at maturity among the parameters involved with phenological development this was particularly evident for e fast for which the parameter explained more than 90 of the total variance in the model output moreover like for stics base temperature for thermal time accumulation tbasedev resulted as one of the most important parameters being ranked 3rd and 2nd according to morris and e fast respectively on the contrary morris identified one of the parameters involved with photoperiod as highly impacting on agb at maturity in the tropical environments whereas photoperiod parameters were never high ranked for stics both sa methods indicated canopy extinction coefficient k as the parameter with the largest impact on agb accumulation also for cropsyst followed by optimum temperature for biomass accumulation topt with the latter achieving in the temperate environments larger values for µ compared to what estimated in tropical ones and vice versa for st this was one of the largest differences between the two sa methods in terms of values assumed by the sa metrics for high ranked parameters in the different environments parameters involved with leaf area expansion were low ranked regardless of the sa method and environment and rue resulted decidedly less importance compared to what observed for stics given biomass accumulation in cropsyst is driven by rue only for very low vpd values otherwise net photosynthesis is driven by the water potentially transpired coherently with the results achieved for the other two models thermal time during the vegetative phase tsum1 resulted largely the most relevant parameter also for wofost regardless of the sa method and the environment for which simulations were run table 3 base temperature for development tbdev was ranked 2nd according to both st and µ in line with the importance achieved by the corresponding parameters for stics and cropsyst concerning this parameter only the e fast method assigned higher sensitivity in the temperate environments whereas the opposite was obtained using morris this is in line with the results of the sa experiments performed on cropsyst whereas stics was the only model for which both sa metrics were coherent in identifying the parameter as more important in case of lower thermal regimes although with values of the sensitivity metrics decidedly lower than those estimated for tsum1 the 3rd ranked parameter according to both methods was phinib involved with photoperiod response contrarily to what obtained for stics and cropsyst the parameters with the highest relevance according to both sa methods were involved with the simulation of leaf area expansion before the close canopy stage laiem and rgrlai and not with photosynthetic efficiency e g amax was ranked only fourth and sixth by morris and e fast respectively however the 3rd ranked parameter was involved with the temperature response functions limiting co2 assimilation with morris results underlying the higher importance of thermal limitation in temperate environments already observed when the same sa method was applied to cropsyst another marked difference between the sa results obtained for wofost compared to what achieved for the other two models was related with extinction coefficient which was ranked 1st in the two models based on net photosynthesis whereas it was only 6th morris and 9th e fast in wofost although both morris µ and e fast st represent the overall influence of a parameter on the model output total order effect they are not directly comparable given they share neither the same conceptual meaning nor the same unit for this reason to investigate their relationships we applied a linear normalization to the means and the standard deviations of the values of the metrics that were estimated for each model and parameter for the different environments this allowed re scaling all the mean values of µ μ and st s t in the range 0 to 1 and to get coherent information on their variability across environments fig 1 regardless of the model and of the process considered phenological development or growth it is possible to notice the absence of linearity in the relationships between the normalized values of the two sensitivity metrics given variance based methods are considered as benchmark approaches for quantifying total order effects e g saltelli and sobol 1995 fig 1 shows the low reliability of the morris method for quantifying the absolute importance of parameters the savage scores of the sensitivity metrics estimated for the different environments were averaged to compare the overall capability of the two methods to rank parameters according to their total order effect fig 2 mean savage scores highlighted the overall reliability of the morris method in ranking model parameters the main exception being represented by low ranked parameters for processes involved with crop growth for stics and wofost in particular mean savage scores estimated on the sensitivity metrics provided by the two methods were consistent for top ranked parameters in most cases despite a certain variability bars in fig 2 among the values achieved for some parameters across different environments the comparison of the rankings obtained with the two methods for each environment always led to tdcc values higher than 0 90 with the concordance being significant p 0 05 regardless of the model and the environment for the parameters involved with crop growth and for the stics parameters involved with phenological development the concordance was instead significant only at p 0 10 for the cropsyst and wofost parameters involved with phenology the differences in the rankings obtained for different environments within the same sa method were always considered as minor according to tdcc p values always lower than 0 05 with e fast achieving the highest tdcc values for all the combinations process development vs growth crop model the only exception being represented by the cropsyst parameters involved with crop growth 4 discussion for all crop models parameters representing thermal time to complete the vegetative phase were decidedly the most relevant among those involved with phenological development this is consistent with the great importance of the underlying plant trait within rice breeding programs given this trait is among those for which breeders have the largest possibility to generate variability among genotypes to increase their suitability to different environments e g shrestha et al 2014 gao et al 2014 moreover thermal time to complete the vegetative phase has a large effect on the amount of green leaf area produced by the crop before the reproductive phase and thus it directly affects the amount of radiation that is intercepted and in turn the amount of biomass accumulated at the end of the crop cycle i e the model output investigated in this study however besides the importance of related parameters for genetic and physiological reasons the high sensitivity metrics achieved by the parameters representing thermal time to complete the vegetative phase was partly due to the fact that values found in literature led to uniform distributions whereas normal ones were achieved for all the other parameters appendices a c contrarily to what achieved for stics and to what should be to a certain extent expected the relevance of base temperature for development for cropsyst and wofost was not larger in the colder environments italy according to the morris method thus suggesting that the different temperature response functions implemented in the three models led to compensations among parameters that were differently captured by the two sa methods concerning crop growth the most important parameters for stics and cropsyst were involved with canopy structure extinction coefficient ranked 1st regardless of the model and method and photosynthetic efficiency rue for stics tue for cropsyst whereas for wofost the highest values for the sensitivity metrics were achieved by parameters involved with leaf area expansion before the close canopy stage besides the great conceptual difference in the way knowledge on processes involved with photosynthesis is formalized in wofost compared to the other two models which could translate per se in different models behavior the lower importance of wofost parameters involved with photosynthetic efficiency can likely be due also to the number of parameters involved for wofost indeed there are many parameters dealing with gross co2 assimilation as well as with growth and maintenance respiration that at the end of each time step contribute to the quantification of biomass accumulation on the contrary biomass accumulation is typically driven by few parameters in models based on the concept of net photosynthesis hammer et al 2019 in practice the portion of agb variability due to photosynthesis is attributed to few parameters for stics and cropsyst and to many parameters for wofost the lack of linearity in the relationships between the values of µ and st fig 1 is in line with what achieved by herman et al 2013 during sa experiments carried out on distributed watershed models these authors observed that the relationships between µ and st the latter estimated using the sobol method were approximatively linear for low sensitive parameters whereas they were nonlinear for high sensitive ones this pattern is partly reproduced in the relationships we found regardless of the process model and environment fig 1 differences between morris and e fast mean savage scores fig 2 increased with the number of parameters for which the sa was performed with the lowest differences observed for phenology in cropsyst and wofost 7 and 8 parameters respectively and the largest for growth in stics and wofost 25 and 19 parameters indeed the linear relationships between the number of parameters and the relative root mean square error rrmse calculated on mean st and µ savage scores was almost significant r2 0 65 p value 0 054 the same linear relationship was instead significant p value 0 026 when st and µ savage scores were considered separately for the different environments this finding could be considered as in line with what achieved by silvestro et al 2017 who reported that the correlation between morris µ and e fast st was higher for the safye crop model 17 parameters than for aquacrop 34 parameters for water limited wheat yield simulations in china and italy this consideration higher morris instability for large number of parameters seems to be supported also by hsieh et al 2018 who discussed divergence between µ and st based rankings with a physiologically based pharmacokinetic model with 58 parameters however this aspect needs further investigation given the number of parameters per se is likely not enough to explain the performances of the morris method when they are compared with variance based approaches indeed herman et al 2013 achieved good performance when morris was applied to a spatially distributed model with 1092 parameters whereas menberg et al 2016 considered the morris method as unstable with a building energy model with only 11 parameters as well as vanrolleghem et al 2015 with an urban water quality model with 17 parameters despite minor differences in the parameter rankings obtained with the two sa methods their concordance tdcc resulted always significant at the 0 10 level and this is to a certain extent surprising in light of the number of model executions needed by the two methods to provide the sensitivity metrics which for morris was less than 3 of the number of executions needed by e fast the sample sizes we used for the two sa methods allowed achieving stable results indeed the comparison between the rankings presented in fig 2 obtained using six trajectories morris and 250 times the number of parameters e fast and the rankings obtained with five and seven trajectories and 200 and 300 times the parameters led to tdcc values ranging from 0 979 to 1 000 with concordance being always significant p 0 05 our results seem to contradict the findings from other authors e g sobol and kucherenko 2009 feng et al 2018 who observed distortions in the relationships between sensitivity metrics from morris and variance based methods in case non uniform distributions for input factors were used indeed regardless of the crop model and of the environmental conditions explored morris and e fast results were consistent despite the values for the parameters we collected from the literature led to normal distributions for all the parameters but one thermal time to complete the vegetative phase 5 conclusions in this study a number of sa experiments was performed for the first time using different sa methods on different crop models at sub model level phenological development vs crop growth while exploring different environmental conditions results achieved by morris seem to a certain extent to cast a shadow on the need of using sa methods more demanding in terms of model executions especially in case of computationally expensive models or for high resolution spatially distributed sa experiments e g herman et al 2013 koo et al 2020 however the solution is more complex since it depends on the specific objectives of the sa study indeed although sa is often performed to identify relevant parameters before calibration e g mathieu et al 2018 or non influential ones for model reduction or simplification e g hsieh et al 2018 there are cases where the contribution of parameters to output variance needs to be quantified beyond what is needed to rank parameters this means that the sensitivity metrics of the different parameters are important also in term of their absolute value not only in relative terms as when ranking is the final goal this is the case when sensitivity metrics are used for further analyses like for deriving quantitative criteria to identify crop ideotypes e g paleari et al 2017 or in general when an accurate estimate of the contribution of parameters to output variability is needed indeed the lack of linearity between e fast st and morris µ confirmed the unsuitability of the latter for quantifying parameter relevance in absolute terms credit authorship contribution statement livia paleari conceptualization methodology investigation formal analysis writing original draft writing review editing ermes movedi methodology investigation formal analysis writing review editing michele zoli investigation formal analysis writing review editing andrea burato investigation formal analysis writing review editing irene cecconi investigation formal analysis writing review editing jabir errahouly investigation formal analysis writing review editing eleonora pecollo investigation formal analysis writing review editing carla sorvillo investigation formal analysis writing review editing roberto confalonieri conceptualization methodology investigation formal analysis writing original draft writing review editing declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgements we would like to gratefully acknowledge dr tao li from dndc applications research and training and dr ando radanielson from the university of southern queensland for providing information needed to run the simulations in the two environments in the philippines appendices appendix a stics parameters distributions and sources of information parameter name acronym units distribution sourcea phenological development minimum temperature below which development stops tdmin c normal 11 5 0 71 1 maximum temperature above which development stops tdmax c normal 30 1 5 1 saturating photoperiod for development phosat h normal 10 0 5 2 base photoperiod for development phobase h normal 14 0 7 2 index of photoperiod sensitivity 1 insensitive sensiphot normal 0 9 0 045 2 duration between sowing and emergence stpltger c days normal 50 2 5 2 minimum temperature for emergence tgmin c normal 8 5 0 43 2 3 thermal time emerg end of juvenile phase stlevamf c days normal 447 4 146 1 2 4 therm time max acceleration of leaf growth max lai stamflax c days normal 359 44 4 2 4 thermal time emergence beginning of grain filling stlevdrp c days uniform 330 1100 2 4 duration grain filling onset water dynamics in grains stdrpdes c days normal 250 12 5 2 thermal time beginning of grain filling maturity stdrpmat c days normal 477 7 35 2 2 4 growth light interception photosynthesis assimilate partitioning leaf area yield formation minim density above which interplant competition starts bdens plants m 2 normal 34 5 1 72 2 temperature beyond which foliar growth stops tcxstop c normal 36 1 8 2 minimum temperature at which growth ceases tcmin c normal 12 0 6 2 maximum temperature at which growth ceases tcmax c normal 30 1 5 2 max rate of the setting up of lai dlaimaxbrut m2 leaf plant 1 c day 1 normal 6 10 4 3 10 5 2 4 parameter of the logistic curve of lai growth pentlai normal 5 5 0 275 2 maximum height of the crop hautmax m normal 0 96 0 12 2 extinction coefficient of photosynthetic active radiation extin normal 0 45 0 08 1 5 6 minimum temperature for plant growth temin c normal 12 0 6 1 2 optimal temperature 2 2 for plant growth teoptbis c normal 28 2 1 4 optimal temperature 1 2 for plant growth teopt c normal 20 27 1 01 2 4 maximum threshold temp for net photosynthesis temax c normal 38 15 1 91 2 4 max rue during the juvenile phase efcroijuv g mj 1 normal 2 95 0 15 1 2 4 6 max rue during the vegetative stage efcroiveg g mj 1 normal 3 2 0 16 1 2 4 6 max rue during the grain filling phase efcroirepro g mj 1 normal 2 8 0 14 1 2 4 6 minimum specific leaf area of green leaves slamin m2 kg 1 normal 18 9 1 2 maximum specific leaf area of green leaves slamax m2 kg 1 normal 500 25 1 2 stem leaf proportion tgefeuille normal 3 5 0 175 2 rate of increase of the c harvest index vitircarb g grain g plant 1 day 1 normal 0 01 5 10 5 2 4 maximum c harvest index irmax g grain g plant 1 normal 0 65 0 034 2 max temperature above which grain filling stops tmaxremp c normal 36 1 8 2 minimal temperature below which grain filling stops tminremp c normal 12 0 6 2 max grain weight at 0 water content pgrainmaxi g grain 1 norm 25 10 3 2 7 10 3 2 4 7 interplant competition parameter adens normal 0 6 0 03 2 4 max lifespan of adult leaves in sum q10 2 2 t tbase durvief normal 120 6 2 a1 confalonieri and bocchi 2005 2 model default 3 sanchez et al 2014 4 bregaglio et al 2017 5 kiniri et al 2001 6 boschetti et al 2006 7 timsina and humphreys 2006 appendix b cropsyst parameters distributions and sources of information parameter name acronym units distribution sourcea phenological development thermal time from flowering to maturity gddmat c days normal 388 61 1 2 thermal time from emergence to flowering gddfl c days uniform 400 1560 1 2 thermal time to reach emergence gddem c days normal 70 3 5 1 2 base temperature for thermal time accumulation tbasedev c normal 11 5 0 7 1 optimum temperature for thermal time accumulation toptdev c normal 30 1 5 1 critical day length duration phototh h normal 12 16 1 13 3 photoperiod sensitivity photosens normal 0 9 0 05 4 growth light interception photosynthesis assimilate partitioning leaf area yield formation specific leaf area at early stages sla m2 kg 1 normal 28 05 1 4 1 5 stem leaf partition coefficient slp normal 1 45 0 53 1 maximum radiation use efficiency rue g mj 1 normal 2 7 0 1 5 6 canopy light extinction coefficient k normal 0 45 0 08 1 5 6 minimum temperature for growth tmin c normal 10 9 0 75 1 4 optimum temperature for growth topt c normal 28 2 1 leaf duration leafduration c day normal 700 80 1 4 biomass transpiration coefficient btr kpa kg m 3 normal 6 1 0 3 1 leaf area index at emergence laiini m2 m 2 normal 0 01 0 005 1 4 a 1 confalonieri and bocchi 2005 2 li et al 2015 3 timsina and humphreys 2006 4 unpublished data 5 boschetti et al 2006 6 kiniri et al 2001 appendix c wofost parameters distributions and sources of information parameter name acronym units distribution sourcea phenological development base temperature for development tbdev c normal 11 5 0 7 1 optimum temperature for development toptdev c normal 30 1 5 1 maximum threshold temperature for development tmaxdev c normal 42 2 1 1 thermal time from flowering to maturity tsum2 c days normal 388 61 1 2 thermal time from emergence to flowering tsum1 c days uniform 400 1560 1 2 thermal time from sowing to emergence tsumem c days normal 70 3 5 1 2 critical day length phinib h normal 12 16 1 13 3 photoperiod sensitivity phins normal 0 9 0 05 4 growth light interception photosynthesis assimilate partitioning leaf area yield formation maximum leaf co2 assimilation rate amax kg ha 1 h 1 normal 49 6 2 48 5 6 7 lower threshold of temp effects on co2 assimilation tb c normal 12 0 6 1 7 optimum temp effects on co2 assimilation topt c normal 28 2 1 7 max threshold of temp effects on co2 assimilation tmax c normal 42 2 1 7 8 rel maintenance respiration rate for roots rmr kg ch2o kg 1 day 1 normal 0 012 0 0011 5 7 9 rel maintenance respiration rate for leaves rml kg ch2o kg 1 day 1 normal 0 028 0 0005 5 7 9 rel maintenance respiration rate for stems rms kg ch2o kg 1 day 1 normal 0 018 0 001 5 7 9 rel maint resp rate for storage organs rmo kg ch2o kg 1 day 1 normal 0 01 0 0005 5 7 9 efficiency of conversion into roots cvr normal 0 7125 0 0356 5 7 9 efficiency of conversion into leaves cvl normal 0 7125 0 0356 5 7 9 efficiency of conversion into stems cvs normal 0 7125 0 0356 5 7 9 efficiency of conversion into storage organs cvo normal 0 675 0 0338 5 7 9 specific leaf area at emergence slaini kg m 2 normal 0 0045 0 0003 5 specific leaf area at tillering slatill kg m 2 normal 0 003 0 0002 5 partitioning of assimilates to leaves at emergence ripl0 normal 0 7 0 1 5 10 leaf area index at emergence laiem normal 0 01 0 005 5 10 life span of leaves growing at 35 c span days normal 35 3 5 7 canopy light extinction coefficient k normal 0 45 0 08 7 8 11 maximum relative increase in leaf area index rgrlai normal 0 0085 0 00048 5 7 9 a1 confalonieri and bocchi 2005 li et al 2015 3 timsina and humphreys 2006 4 unpublished data 5 stella et al 2014 6 ziska and teramura 1992 7 kropff et al 1994 8 dingkuhn et al 1999 9 van diepen et al 1988 10 confalonieri et al 2010 11 boschetti et al 2006 
