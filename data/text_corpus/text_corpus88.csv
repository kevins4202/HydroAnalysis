index,text
440,assessments of groundwater and surface water budgets at a large scale such as the contiguous united states often separately analyze the complex dynamics linking the surface and subsurface categories of water resources these dynamics include recharge and groundwater contributions to streamflow the time varying simulation of these complex hydrologic dynamics across large spatial and temporal scales remains a scientific challenge due to the complexity of the processes and data availability in this study groundwater fluxes and surface hydrologic processes are simulated across the contiguous us for 1950 2010 the simulation estimates the monthly water budget components such as groundwater recharge surface runoff and evapotranspiration streamflow in major rivers is routed while accounting for groundwater exchange human impacts are included through groundwater pumping and climate variability is included including variability in precipitation temperature and potential evapotranspiration the simulated groundwater level and river discharge have strong correlation with usgs observation wells and streamflow gages with r2 values of 0 992 and 0 946 respectively the simulated evapotranspiration is compared with three other published estimation methods showing that it is able to capture the magnitude and seasonality of evapotranspiration over the mississippi river basin as such the model is able to reasonably simulate the surface and groundwater budgets over the us allowing for questions of the relative importance of climate and human impacts to be explored in the future keywords modflow owhm surface groundwater interactions water budgets climate variability evapotranspiration streamflow 1 introduction surface water and groundwater interact with one another with surface hydrologic processes impacting groundwater recharge and groundwater levels determining baseflow in streams the water budgets are dynamically affected by climate conditions such as precipitation and temperature human activities such as water withdrawals from rivers groundwater pumping and land use change and terrestrial processes such as plant water use estimating the surface and groundwater budgets is critical for quantifying water resources across large spatial and temporal scales yet it remains a challenging task due to a lack of in situ observations of critical hydrologic processes and poor characterization of subsurface hydrogeologic properties this study presents a contiguous us conus set up of the modflow one water hydrologic model version 2 mf owhm2 hanson et al 2014a boyce et al 2020 which is a surface and groundwater model capable of simulating the hydrologic fluxes and storages for water budget assessment climate subsurface conditions and human activities all impact groundwater levels for example during periods of low rainfall groundwater levels decline due to a reduction in groundwater storage from low recharge rates wada et al 2014 if the lateral groundwater flow is limited de graaf et al 2017 condon and maxwell 2017 furthermore excessive groundwater pumping can threaten groundwater sources with high groundwater depletion döll et al 2014b scanlon et al 2012 in some regions such as the great plains groundwater levels increase slowly due to low recharge rate and relatively low hydraulic conductivity peterson et al 2016 the sensitivity analysis of groundwater level is analyzed on global scale with respect to hydraulic conductivity groundwater recharge and surface water body elevation by reinecke et al 2019 to maintain the groundwater availability and baseflow to rivers some global studies döll et al 2014a pokhrel et al 2012 wada et al 2010 analyzed the groundwater recharge rate and groundwater storage from water budget components and other studies peterson et al 2016 faunt et al 2009 analyzed the streamflow in regional aquifer systems although it is widely accepted that understanding surface and groundwater fluxes and storages is critical for water resources planning collecting extensive in situ observations such as groundwater levels and subsurface geological properties is prohibitively expensive over large regions remote sensing data can provide estimates of hydrologic fluxes over large spatial scales but remote sensing has relatively short time series and can typically only observe surface processes the exception is grace tapley et al 2004 which can estimate groundwater storage change through gravity field changes but only at coarse spatial and temporal resolutions to overcome the remote sensing limitations numerical models can be utilized to estimate and reconstruct the hydrologic fluxes and stores thereby overcoming the observational data limitations these models can be useful tools to address critical questions for instance what is the impact of climate variability and groundwater pumping on groundwater availability regional hydrological and groundwater models have been used to simulate numerically the surface water and groundwater hydrologic processes for example three regional models have been set up in detail over three major aquifers in the united states in central valley high plains and rio grande aquifer systems the first groundwater flow model simulates the northern high plains aquifer peterson et al 2016 and uses modflow with the newton rhapson solver niswonger et al 2011 the second is the central valley hydrologic model cvhm faunt et al 2009 for california s central valley aquifer using modflow fmp2 schmid and hanson 2009 the forthcoming new version of cvhm cvhm2 is being updated to use mf owhm2 a third model is the rio grande transboundary integrated hydrologic model rgtihm that simulates portions of new mexico texas and mexico hanson et al 2020 using mf owhm2 these regional models provide a better understanding of the surface and subsurface regional water budgets and their dynamics however regional models typically cover a single aquifer neglecting processes at the model boundaries this means the streamflow surface runoff and lateral groundwater flow may be neglected at the boundaries of these regional models these assumptions can misrepresent the modeled water budgets schaller and fan 2009 krakauer et al 2014 depending on the regional conditions such as topography geology and climate continental and global scale groundwater models were developed de graaf et al 2015 fan et al 2007 maxwell et al 2015 to not only solve the problem of lateral flow at model boundaries but because they can provide a better understanding of the hydrology of an entire large scale system for example large scale models can analyze the spatial variation of climate geology and topography and its effect on surface water and groundwater availability and they can analyze the surface groundwater interaction in different aquifers one of the first studies to simulate the groundwater depth across the contiguous united states was conducted by fan et al 2007 where the water table was estimated as the equilibrium of long term climatic forcing on groundwater level under a steady state model followed by a study of global observations of water table depth fan et al 2013 these studies led to the ability to connect groundwater with other hydrologic fluxes which has been investigated in several later studies over the united states for example maxwell et al 2015 used an integrated groundwater model parflow maxwell and miller 2005 to analyze the surface and subsurface flow system over the majority of conus to do a high spatial resolution run the model was run under steady state conditions but can be run transiently as in kollett 2009 and maxwell et al 2016 other studies simulate the groundwater on the global scale using a model run at steady state de graaf et al 2015 and transient de graaf et al 2017 then analyzing the groundwater depletion de graaf et al 2019 these models simulate recharge and river discharge from the global hydrological model pcr globwb wada et al 2011 then simulates the groundwater lateral flow from modflow the modflow one water hydrologic model mf owhm2 used in this paper simulates both surface hydrologic processes and groundwater flow simultaneously in one model overcoming the limitation of coupling two models some of these large scale models assume the magnitude and direction of the fluxes are constant over time fan et al 2007 maxwell et al 2015 de graaf et al 2015 thereby neglecting the temporal dynamics of seasonal and interannual climate variability in addition human activity such as groundwater pumping is often neglected however in recent studies de graaf et al 2017 condon et al 2019 de graaf et al 2019 the groundwater pumping is simulated in addition incorporating streamflow routing is still a challenging component to model with a coupled groundwater model because of modeling limitations or the scarcity of needed data such as river hydraulic conductance over such a vast area such as the united states these challenges have led some past studies to simplify the modeling of such a complex system by neglecting human activity and simplifying or neglecting the streamflow routing and its interaction with groundwater this study s objectives are 1 to evaluate the feasibility of using mf owhm2 at continental scales for water budget estimation and 2 to develop and validate a conus wide mf owhm2 model set up that explicitly simulates hydrologic processes that link the surface and groundwater hydrologic processes and human impacts the focus is on capturing large scale hydrologic patterns and human impacts to provide a baseline model for the hydrologic community which can then expand the model to include more detailed processes relevant for specific research questions this model is complementary to other us focused modeling efforts such as that of parflow as it is more focused on including human impacts in a parsimonious framework that would not require high performance computing resources in this paper we first present the model set up including simplifications the observation based input data and the assumptions made in some input variables then the model validation and water budget results are presented including both groundwater and surface water the conclusions are presented in the final section 2 model and data to simulate the surface and subsurface hydrology of the contiguous us conus this study uses modflow one water hydrologic model version 2 mf owhm2 boyce et al 2020 boyce 2020 which is a modular modeling software developed by the u s geological survey and u s bureau of reclamation mf owhm2 builds on the widely used modflow model harbaugh et al 2000 harbaugh 2005 which simulates groundwater fluxes at a range of spatial and temporal scales in addition to simulating groundwater fluxes the standard version of modflow includes pumping and surface water routing prudic et al 2004 mf owhm2 incorporates a surface water model allowing for simulation of the partitioning of precipitation into infiltration and surface runoff evapotranspiration and irrigation mf owhm2 is able to holistically simulate the hydrologic system including some of the ways human s impact hydrologic processes it also allows for better quantifying surface water and groundwater availability by directly coupling the surface and subsurface hydrologic fluxes table 1 compares four large scale models simulating the lateral groundwater flow the model domain covers conus extending from 132 437 w to 72 502 w and 22 177 n to 49 822 n fig 1 and to a depth of 60 m below the water table as a single vertical layer the mf owhm2 study area is divided into a finite difference equal area grid of approximately 13km using the north america albers equal area conic projection the domain covers a land area of approximately 11 790 960 km2 which extends into canada and mexico the ocean boundary conditions are represented as a cauchy boundary condition using the modflow general head boundary ghb module that specifies a single average sea level elevation the simulation time frame is from 1950 to 2010 at a monthly time step called a stress period in modflow with boundary conditions specified for each month for model convergence reasons each stress period contains two transient sub steps where the model breaks up the monthly data into sub periods the model is simulated using modflow s convertible option which uses the unconfined equation when the water table is above the layer bottom and converts to the confined equation when the water table is below the layer bottom of a grid cell confined layers are omitted due to insufficient well observations in some confined aquifers to accurately set up and validate the model across the conus domain the model empirically estimates the evapotranspiration based on the monthly precipitation reference evaporation crop coefficient and the groundwater evapotranspiration extinction depth the crop coefficient is the ratio of the actual evapotranspiration to the reference evapotranspiration for each crop type and the extinction depth is the depth at which there is no evaporation from groundwater sources the surface runoff to rivers is estimated based on the surface runoff coefficient which is the ratio of the surface runoff from the rainfall over the infiltration groundwater recharge is estimated as the residual of the water budget mf owhm2 calculates the vertical and the horizontal groundwater flows using a finite difference scheme of the three dimensional groundwater equations and estimates the interaction between the groundwater and surface water these fluxes are calculated based on the subsurface properties harbaugh 2005 prudic et al 2004 such as the hydraulic conductivity and layer thickness and the climatic conditions the unsaturated zone is not simulated in this study which increases the simulation error when water that infiltrates takes longer than the model timestep to reach the water table this is common in very dry areas such as the southwestern deserts scanlon et al 2006 flint et al 2007 and may result in an over or underestimate of the groundwater fluxes both surface runoff and baseflow from the groundwater to rivers are simulated and streamflow is routed in the major rivers section 2 4 in addition to the effect of climate variability the model includes the human impact on groundwater levels by simulating withdrawals using the modflow well module and explained section 2 3 details of the model set up are described below 2 1 subsurface hydrogeologic parameters the ground surface elevation was specified using the hydrosheds 30 second resolution digital elevation model lehner et al 2006 using hydrosheds the average ground surface elevation of each 13km model grid cell was calculated modflow calculates the layer thickness as the difference between the ground surface elevation and the layer bottom explained in section 2 2 this layer thickness is used in the groundwater equations the model hydraulic conductivity was estimated using the method derived by fan et al 2007 that is based on soil type the soil type was first characterized into fractions of sand silt and clay using the polaris soil database chaney et al 2016 and the average for the top 1 5m depth is calculated then the fractions were used to specify in which of the twelve soil types in the united states department of agriculture usda soil type classification the grid cell belongs fig 1a this was then used to estimate the hydraulic conductivity at 1 5 m depth the vertical hydraulic conductivity is calculated for each soil type from the land data assimilation system ldas http ldas gsfc nasa gov and the horizontal hydraulic conductivity is calculated using the anisotropy ratio estimated by fan et al 2007 using the estimated hydraulic conductivity at 1 5m depth below the ground surface each grid cell s horizontal hydraulic conductivity was estimated for the full depth of the model layer thickness extending to 60 m below the groundwater level this was done using the depth dependent exponential relationship derived by fan et al 2007 1 k k o exp z f 2 w h e r e f a 1 b β f o r β 0 16 5 m f o r β 0 16 where a and b are constants z is the depth where the hydraulic conductivity is calculated β is the terrain slope ko is the hydraulic conductivity at 1 5m depth and f is the e folding depth which is the depth interval in which the exponential decline of hydraulic conductivity decreases by a factor of the natural logarithm constant e e 2 71828 the constants a and b were taken from the best fit in fan et al 2007 where a equals 120 m and b equals 150 m to calculate the terrain slope β and e folding depth f additional data is required the terrain slope β is calculated as the average slope of the 1 25 km pixels within the modflow grid cell for both regolith fig 1b and bedrock the regolith is a layer of sediment such as dust soil sand gravel and loose rock that covers a hard rock formation the 1 25 km pixel slopes are calculated from the hydrosheds elevation data first reprojected to the north american albers equal area conic projection used in this modflow set up the depth to bedrock data was downloaded from http www soilinfo psu edu index cgi soil data conus data cov dtb methods which is available for a depth of 152 cm across the united states fan et al 2007 since this study focuses on the united states the depth to the bedrock in mexico and canada was assumed to be zero to simplify the model because of the equations form this has only a minor impact on the estimated hydraulic conductivity the assumption of 13 km grid size increases the error in the simulation due to the uncertainty related to averaging the depth to bedrock and the ground surface elevation over a relatively large grid cell especially in the heterogeneous terrain such as the southwest region the e folding depth f was calculated for both bedrock and regolith at 1 5 m depth and depends on the topography fig 1c in eq 1 the hydraulic conductivity k decreases exponentially with depth z to calculate a depth averaged hydraulic conductivity the horizontal hydraulic conductivity was calculated for every 0 5 m depth interval from the ground surface elevation to the layer bottom of 60 m below water table and the integrated equivalent horizontal hydraulic conductivity was calculated using the following equation todd and mays 2005 3 k x i 1 n k i d z i h where h is the model layer thickness and kx is the final horizontal hydraulic conductivity figure 1d for the model layer thickness dzi is the 0 5m depth interval increment ki is the horizontal hydraulic conductivity at each 0 5 m interval increment within the model single layer as mentioned above the model consists of one layer with a thickness of 60m below the estimated observed groundwater level used to initialize the model details of estimating the initial groundwater level are below the exception is below rivers where a minimum thickness of 20m below the riverbed is specified to allow for model convergence in a few river grid cells the river segment is below the average 13km layer bottom due to large topographic gradients and this is not allowed in the model impermeable conditions were assumed below the model layer because the hydraulic conductivity values below 60 m are prohibitively small when using the exponentially decreasing hydraulic conductivity method in eq 1 the specific yield figure s1 was estimated from the aquifer sediment and rock type using heath 1983 and morris and johnson 1967 the aquifer sediment and rock type map is taken from the usgs miller 1990 2 2 groundwater observations and model initial conditions u s geological survey usgs observation well data was used to specify the model initial conditions and to validate the modeled groundwater levels there are 780 851 wells with at least one observation between january 1950 and december 2010 across the united states of these wells were excluded if they met any of the following conditions 1 the well was identified by the usgs as confined mixed aquifer type or undefined aquifer type 2 the well elevation is unavailable 3 the well elevation is below 10 meters to eliminate wells with missing data flags or unrealistic elevation values 4 the well elevation is greater than 4000 meters above sea level 4 the well is designated as pumping wells injection wells obstructed damaged plugged dried or flowing 5 the well has an average observed water depth deeper than 300 m implying it is in a deep aquifer outside this model s bounds the latter condition was necessary to provide preliminary initial conditions of the water level after the model was spun up the simulated water level was used to determine the model layer thickness which is a minimum of 60m below the water table of each grid cell after the layer thickness was determined we verified that no wells are below the model s vertical extent and that 300m below the water table was a reasonable assumption for the model layer thickness applying these five criteria resulted in 642 839 wells that could be used for initializing the model this approach was similar to that used in fan et al 2007 water depths from the selected wells were utilized to calculate the water level of the model initial conditions for january 1950 water level observations were spatially interpolated using a triangulation based natural neighbor interpolation which is a mix between linear and cubic nonlinear interpolation using the matlab function griddata with the natural interpolation option the interpolated groundwater level is constrained to not exceed the average ground surface elevation for each grid cell because there are a limited number of wells with observations dating back to 1950 a strategy was developed to utilize well observations whenever they exist for wells with observations beginning after january 1950 the water level for the earliest january observation is used selecting one month in this case january eliminates the impact of seasonal variability on water levels for wells with only one observation the water level is assumed to be the same as january 1950 this assumption allowed for the inclusion of more wells particularly in large areas of the country that were data scarce in the mid 20th century the impact of this assumption on the model s performance is discussed in the next section the water level in the ocean and lakes is assumed to be constant over time and is simulated using the general head boundary ghb module in mf owhm2 in the major lakes the water level was estimated from the hydrosheds digital elevation map lehner et al 2006 the ocean boundary condition water level is set equal to mean sea level the initial conditions for the model consist of the interpolated january 1950 water level combined with the boundary condition for lakes and oceans fig 2 and data for canada and mexico were linearly extrapolated and run under a spin up model as explained in detail in section 3 2 3 groundwater pumping well pumping was estimated using the usgs water use dataset https water usgs gov watuse data last accessed on july 18 2019 which is available on a county scale every five years since 1985 county groundwater withdrawals are uniformly distributed across the model grid cells located within the county the available usgs groundwater withdrawal data do not specify aquifer type for withdrawals all pumping regardless of aquifer source is assumed to be from the unconfined aquifer furthermore because the usgs groundwater withdrawals data is only available for every five years the pumping rate is assumed to be temporally constant between the available years pre 1985 years are assumed to be the same as 1985 withdrawals this imposes errors but in the absence of data for before 1985 it allows for incorporating human influence on the hydrologic cycle to simplify the pumping simulation each grid cell in the model contains one effective well in the center which represents all the pumping wells within the grid cell 2 4 surface water routing streamflow is simulated using two different modules the major rivers are routed using the streamflow routing sfr module and the tributaries using the rivers riv module fig 3 a the river network shapefile was downloaded from https www naturalearthdata com which primarily derived the data from the u s world data bank 2 2006 they classified the main rivers from the double lined rivers classification level this data is used for the main rivers in this study the small rivers and tributaries obtained from the same source for lower river classification levels the sfr module calculates the water exchange in the river channel between surface water and groundwater and routes the river discharge downstream accounting for surface runoff and baseflow inputs to the river for each river grid cell the riv module only calculates the water flux between the streamflow and baseflow from groundwater without routing making it computationally more efficient than the sfr module in the river validation the baseflow to rivers calculated by the riv module is added to the rivers simulated by the sfr module for each month because the riv module does not incorporate surface runoff into the streamflow all the surface runoff is included in the sfr routing there are 358 usgs streamflow gages selected for the sfr module that are located on the sfr river network and that have at least 50 years of continuous monthly observations from 1950 to 2010 the sfr river network consists of 5241 grid cells that are divided into 595 segments where 358 of these segments have a usgs gage station at the start of the segment thus the discharge at the upstream grid cell for each segment is equal to the observed discharge of that usgs gage station during the simulation the model sfr module routes the streamflow for each river segment downstream accounting for interactions between surface water and groundwater via baseflow and for the surface runoff that runs off to the river segments in this study infrastructure such as dams and water transfers are neglected the model study area was divided into 183 water balance subregions wbs fig 3b using the 1 250 000 scale hydrologic units huc250k steeves and nebert 1994 and watersheds without a sfr river segment were combined so that each water balance region has a river except canada and mexico this allows the farm process fmp in mf owhm2 to distribute the surface runoff water from each water balance subregion over the number of sfr rivers grid cells located within each one uniformly to simplify the sfr model some assumptions were made first due to a paucity of large scale data on river bed hydraulic conductivity the river bed hydraulic conductivity was assumed to be equal to the grid cell s horizontal hydraulic conductivity this used by the model to calculate the river bed conductance the river bed thickness is set to 1m and the manning s roughness coefficient is 0 04 which is typical for natural streams chow 1959 if a stream gage was missing stream width or elevation data it was taken from google earth or the usgs dem respectively in this model the stream width and elevation data linearly interpolated for grid cells between the gage stations by the model this option can be changed to specify the stream width and elevation data for each grid cell the model allows for precipitation and evaporation from the river water surface this was assumed to be zero given the large scale nature of the simulation and the lack of data with which to validate these processes the river module riv was used for the smaller river tributaries this tributary river network covers the united states with 4625 grid cells included in this model the river elevation for riv grid cells was estimated from the usgs digital elevation map the water depth was assumed to be 3m for all riv tributaries 2 5 land cover land cover data was taken from usda s cropscape usda national agricultural statistics service cropland data layer 2010 for 2010 and held constant over the modeling period for canada and mexico land cover is from modis channan et al 2014 the land cover dataset was first aggregated into 23 types using the california department of water resources 2000 classification system then the dominant land cover within each model grid cell was selected fig 4 b the land cover data is used to specify crop coefficients and calculate potential evapotranspiration the crop coefficient values were estimated from previous studies allen et al 1998 faunt et al 2009 hanson et al 2014a hanson et al 2014b boyce et al 2020 fig 4a and the crop coefficient of non cropped land cover types is set equal to one by construct for cropped land cover types the crop coefficients are constant across the study domain 2 6 climate data climate conditions such as precipitation potential evaporation and temperature have a significant impact on water supply and demand for both surface and groundwater climate data such as precipitation and temperature are available on daily intervals but in this study climate data are simulated on a monthly time interval called a stress period in this model the monthly climate related input data are precipitation snowmelt and reference evapotranspiration then mf owhm2 simulates the impact of climate variability on both surface water and groundwater processes mf owhm2 assumes all precipitation is rainfall and therefore capable of being partitioned into runoff and infiltration a portion of which can be consumed as evapotranspiration however much of the us has a significant snow season and this assumption would be inappropriate in the northern and western us to account for the snowmelt lag the variable infiltration capacity vic hydrologic model liang et al 1994 liang et al 1996 snowmelt outputs were used vic is a land surface model that solves for energy and water budget closure at the land surface and includes a snow model vic was implemented using the meteorological forcings of maurer et al 2002 updated to extend from 1950 to 2010 and the calibrated parameters from troy et al 2008 the vic simulated liquid input to the soil essentially rainfall and snowmelt is then passed to mf owhm2 to account for the time lag in precipitation that would occur due to the snowpack because mf owhm2 is on the north america albers equal area conic projection and the maurer and vic data are on the world geodetic system of 1984 wgs84 projection the vic and maurer datasets are interpolated using a bilinear interpolation method the monthly reference evaporation was calculated by vic for natural vegetation and tall and short reference crops and the minimum potential evaporation for the mf owhm2 is constrained to be at least the actual evaporation from vic model finally mf owhm2 calculates the potential evapotranspiration by multiplying the reference evapotranspiration by the crop coefficient for each land cover type for canada and mexico precipitation and evapotranspiration data were taken from global vic simulations sheffield and wood 2008 forced with the dataset of sheffield et al 2006 further details on evapotranspiration calculations are in the following section in this model the irrigation withdrawals from streams were neglected and all irrigation water from pumping is assumed to be consumed thus the simulated evapotranspiration is only calculated from the precipitation and groundwater this may increase the potential simulation errors and neglecting the seasonality variation of the irrigated in future studies the irrigation water supply and demand from pumping and streams and its consumptive use could be included 3 model spin up and calibration for calibration purposes a simplified 12 month model using the seasonal averaged climate variables from 1950 to 2010 was created for the model spin up and calibrated to estimate the groundwater level in an equilibrium state and to calibrate the extinction depth of groundwater sourced evapotranspiration using the farm process version 4 fmp of modflow owhm2 the simplified 12 month model was run with the seasonal climatology allowing for errors in initial conditions to dissipate evaluation of the water levels in the model shows that changes in water levels exponentially decline across several months such that water levels are stable by the end of the 12 month run these errors can also be due to uncertainty in the estimated hydraulic conductivity used in this model errors in the hydraulic conductivity can lead to incorrect hydraulic gradients and lateral water movement in addition hydraulic gradients between rivers and the surrounding topography can lead to inaccurate baseflow estimates until equilibrium is reached at the end of the 12 month model spin up the water levels are used as the initial conditions for both the calibration and the full study period simulations for modeling evapotranspiration it is important to note that mf owhm2 does not separately simulate the near surface soil moisture that is directly accessible to the plants in their rooting zone hanson et al 2014b instead the near surface soil moisture is included in the groundwater budget as part of the water stored in the unconfined aquifer layer thus the change in both soil moisture and groundwater level is included in the simulated change in groundwater level in the fmp evaporation and transpiration are modeled separately one of evapotranspiration concepts employed in fmp is to linearly increase groundwater consumption as transpiration when the water table plus a capillary fringe length intersects the average root depth until the water table reaches the average root depth when the water table intersects the average root depth the transpiration consumption linearly decreases to represent anoxic conditions due to the size of this simulation domain a positive feedback loop occurred when the water table resulted in too much anoxia causing a reduction in transpiration which further increased the water table elevation and the amount of anoxia to avoid this feedback loop all evapotranspiration is modeled as evaporation which does not include anoxia as part of its simulation because crop coefficients are used in conjunction with reference evaporation this results in reasonable simulations of evapotranspiration within the model structure in this model a linear relationship is used for the subsurface sourced evapotranspiration calculations where the calculated evapotranspiration will be equal to the potential evapotranspiration when the groundwater level reaches the ground surface elevation and subsurface evapotranspiration from groundwater and near surface soil moisture equal to zero when the groundwater level is lower than the groundwater evapotranspiration extinction depth the model extinction depth was calibrated using the 12 month calibration model with the objective of matching the evapotranspiration calculated by the vic model specifically the spatial average of the absolute difference between mf owhm2 and vic simulated et is minimized compared to the vic estimated et the mf owhm2 simulated evapotranspiration for the 12 month model of the conus simulation domain had an average absolute bias of 1 033 mm month and a root mean square error of 3 701 mm month because there are no accurate observations of evapotranspiration over the us we are using vic estimated et to calibrate the constant extinction depth for this model for the 732 month model the average absolute bias is 2 66 mm month and the average root mean square error is 5 46 mm month these error statistics demonstrate that the calibration with the simplified model can be used with the full version with a small increase in errors this allows for a much faster calibration over such a large domain the surface runoff coefficient was calibrated using the full model simulation from 1950 to 2010 this calibration was conducted because sensitivity studies show that the cumulative change in groundwater level is very sensitive to the surface runoff coefficient parameter as this controls infiltration to the subsurface the calibration allows for the assumption of negligible change in groundwater storage from 1950 to 2010 the calibration error of groundwater level for the calibrated surface runoff coefficient is calculated as the spatial average of root mean square error and it is equal to 0 135 m for the conus simulation domain this calibrated surface runoff coefficient was used for the full monthly model simulation from 1950 to 2010 which also included groundwater pumping 4 model validation results and discussion 4 1 groundwater validation the full monthly model simulation from 1950 to 2010 with groundwater pumping is validated against the observed groundwater levels from the selected usgs wells for unconfined aquifers the validation was implemented between usgs well measurements and the simulated groundwater level in the grid cell that contains that well for the months when a measurement was made the criteria to select the usgs observation wells for the groundwater level validation is similar to the criteria used for the model initial condition but wells with only one month of observations were removed this results in 151 415 usgs wells with time series for the groundwater validation of the selected wells 900 have at least 30 years of data and 16 054 have at least five years of data because the well observations have different record lengths the statistics are calculated for each well for those months with observed groundwater levels the statistics for grid cells with observations beginning in january 1950 and those grid cells with later data are similar indicating that the assumption made to include wells in the initial conditions regardless of data availability at the start of the model period did not significantly impact the model performance simulated and measured mean annual groundwater levels for 1950 to 2010 across the 151 415 usgs groundwater observation sites have an r2 value of 0 9926 fig 5 a this is similar to the r2 of the estimated groundwater level by previous studies for example an r2 value of 0 999 was calculated by fan et al 2007 where the water table was estimated as the equilibrium of long term climatic forcing on groundwater level under a steady state model maxwell et al 2015 simulated the water table using the parflow groundwater model maxwell et al 2015 over most of conus using a high spatial resolution steady state run with an r2 value of 0 998 another example of simulating the water table is a study by de graaf and others 2017 using modflow model globally with r2 value of 0 94 fig 5b shows the histogram of model bias in groundwater level the mean bias is 2 28m with relatively few wells having a large bias for example 5 2 of the wells have a negative bias greater than 50m and 9 1 of the wells have a positive bias greater than 50m the bias results for many reasons there is uncertainty in model parameters boundary conditions and pumping observations errors are introduced due to the difference between the observed water level for each individual usgs well and the average groundwater level for wells located on a 13 13 km grid cell area in other words the elevation of the water level measurement can be very different from the average grid cell elevation the largest error in groundwater level values occurs in three regions fig 6 and figures s2 s4 heterogeneous terrain near rivers and the regions with high pumping rates in heterogeneous terrain the errors occur for two reasons first significant errors are introduced due to the topography as groundwater levels can vary significantly within a 13 13km grid cell the error is calculated as an average throughout the grid cell and is therefore sensitive to where the individual usgs wells are located within a grid cell the large 13 km grid cell may mischaracterize the deep arid zones in the west and increase the simulation error in addition this model includes only unconfined aquifer type wells following previous studies fan et al 2007 maxwell et al 2015 groundwater flow in the confined aquifer is neglected this assumption increases the model uncertainty and misrepresents the aquifers system because groundwater in the confined aquifer has much lower storativity therefore calibrating to groundwater head will lead to skewed parameterization second there is simulation error due to the uncertainty in model parameters for example overestimating hydraulic conductivity k allows the groundwater to move too quickly from higher to lower groundwater levels resulting in a milder hydraulic gradient than the hydraulic gradient of the interpolated usgs observation wells near rivers the errors occur due to the uncertainty in river parameters and due to topography for example in the sfr module the errors result from uncertainty in the river bed hydraulic conductivity the difference between the groundwater level and water level in streams and accumulated errors from river routing outside of heterogeneous regions and along rivers the model has a high correlation with the usgs historical observed groundwater levels in these areas the model is able to simulate the mean water levels well with larger errors in simulating the variability figure s5 4 2 river routing and water budget validation results of both sfr and riv modules were post processed by adding the monthly simulated baseflow between the rivers and groundwater in the riv module to the sfr module where the riv flow within each watershed was uniformly distributed across the sfr grid cells located within the same watershed the routed streamflow was validated against the observed discharge from the available usgs gage stations located on the sfr river network with at least 50 years of monthly streamflow observations from 1950 to 2010 the simulated routed outflow from each river segment downstream was validated with the usgs gage station located on the upstream of next river segment that connected with it the usgs observed streamflow is used as the upstream boundary condition for each routed segment fig 7 a shows the scatter plot of the average observed versus simulated streamflow on a log scale and fig 7b shows nash sutcliffe efficiency values which represents how well the model simulates both the mean and variability in streamflow the results show a strong correlation between the simulated and observed discharge for each sfr river segment with a r2 equal to 0 95 for the actual values and 0 87 for the log values the model overestimates streamflow in smaller basins this occurs because the current version of the farm process fmp distributes surface runoff water equally over the sfr river grid cells that are located within the same water balance subregion time series of randomly selected gages are plotted in figure s6 surface water withdrawals for irrigation are not included in this model because usgs observations are used as upstream boundary conditions this will not have a significant impact on the routed streamflow as it is implicitly accounted for in the observations fig 8 shows the time series of the simulated evapotranspiration against evapotranspiration estimated using different methods over the mississippi basin presented by sheffield et al 2009 the data were digitized from the published paper the simulated evapotranspiration using mf owhm2 is compared with three estimation methods of daily evapotranspiration 1 estimation of daily evapotranspiration using remote sensing based on the penman monteith equation monteith 1965 these remote sensing penman monteith rc pm estimations of evapotranspiration data are the ensemble mean with varying inputs which are calculated using a revised penman monteith equation from mu et al 2007 2 evapotranspiration inferred as a residual from the north american regional reanalysis narr mesinger et al 2006 atmospheric water budget 3 estimation of daily evapotranspiration using the vic hydrologic model set up described in section 2 6 in this mf owhm2 set up the extinction depth of groundwater evapotranspiration was calibrated to get simulated evapotranspiration similar to the estimated evapotranspiration using this vic hydrologic model the root mean square error between the mf owhm2 simulated evapotranspiration and the rc pm narr inferred and vic estimations are 8 57 8 29 and 4 69 mm month respectively over the mississippi basin from 2003 to 2006 the evapotranspiration from near surface soil moisture was assumed to be part of the groundwater budget and both groundwater and near surface soil moisture changes are accounted for in the simulated groundwater level change this assumption was made because mf owhm2 does not explicitly account for the soil moisture term in its equations 4 3 water budget fig 9 shows the seasonal cycle of the simulated water budget for various water resource regions across the united states the water budget is averaged from 1950 to 2010 which includes the average monthly precipitation as input data the simulated total evapotranspiration et and the partitioning of et from precipitation and groundwater sources the simulated surface runoff and the deep percolation which is calculated as the residual of the surface water budget precipitation minus the surface runoff minus the evapotranspiration from precipitation results show how the simulated water budget components vary spatially and seasonally over the model domain each region has a different seasonal behavior depending on its climatological and geological conditions for example california has a mediterranean climate with precipitation occurring in the winter whereas the the ohio and missouri river basins have higher precipitation in the summer consequently the evapotranspiration seasonality is weaker in california than other regions new england demonstrates the importance of snowmelt on the water budget whereas the texas gulf water resource region has the smallest effect of snow incorporating snowmelt into modflow affected the simulated seasonality of the water budget but not the long term averages figure s7 plots the last decade of model results showing that rainfall and runoff have the largest interannual variability variability in evapotranspiration is dominated by the seasonal cycle rather than interannual variability in humid climates like the great lakes and ohio water resource regions deep percolation primarily occurs in the winter months when et demand is low the same is true for california but in this case the wet season coincides with low et in the winter months leading to stronger seasonality the great basin which is arid shows a tighter relationship between precipitation and deep percolation than in the other water resource regions throughout the usgs water resource regions evapotranspiration has the lowest coefficient of variation of the hydrologic fluxes analyzed here deep percolation and evapotranspiration had the largest likely due to the model structure and that these integrate the impacts of both precipitation variability and et variability drier regions have larger variation in precipitation and this propagates into higher coefficients of variation in all the other hydrologic fluxes in these regions 5 conclusions in this paper the groundwater and surface water budgets were simulated on a monthly time step across the united states using the transient modflow one water hydrologic model version 2 mf owhm2 boyce et al 2020 boyce 2020 the model includes the impact of climate variability and human activities specifically groundwater pumping on the groundwater levels including their seasonality in addition the lateral groundwater flow is simulated and interacts with surface water this model contributes to the literature by fully coupling the simulation of surface and groundwater processes over a large spatial scale in a publicly available usgs supported model in this paper version 4 of the farm process fmp is used for evapotranspiration surface runoff and recharge estimations the fmp module works simultaneously with the groundwater streamflow routing and wells pumping modules as one integrated hydrologic model model validation shows that both the simulated groundwater levels and streamflow have a good correlation with the 151 415 selected observation wells and the 358 selected river gage stations with a r2 equal to 0 992 and 0 946 respectively the simulated evapotranspiration et also is well simulated compared with other estimation methods the root mean square error values between the simulated evapotranspiration using mf owhm2 and rc pm narr inferred and vic estimations are 7 97 7 23 and 3 27 mm month respectively over the mississippi basin from 2003 to 2006 based on validation of et streamflow and water levels the model is well constrained and able to simulate the water budgets overall the simulation results match well with observed head streamflow and vic evapotranspiration estimates with the exceptions likely originating from model structural error lack of sufficient input datasets and exhaustive automatic calibration the largest source of model structural error is the large grid cell size 13km each grid cell has uniform aquifer properties such as hydraulic conductivity uniform land surface properties such as elevation and land use and calculates a single water table elevation the single water table elevation represents the hydraulic head at the center of the grid cell which is used for determining stream aquifer interaction and consumption of groundwater as evapotranspiration consumption due to this large grid cell size most model error occurs in highly heterogenous terrain due to the variation in surface elevation and aquifer properties within a single grid cell another potential structural error is the monthly stress periods stress periods specify input stresses such as precipitation and potential evapotranspiration rates and assumes they are constant over the time steps in the stress period each stress period contained 2 time steps making the average time step length about two weeks within the time step the calculated evapotranspiration surface runoff infiltration and stream flow are constant which averages out the effect of synoptic events another source of error are the available input datasets for groundwater pumping and how accurate the pumping is reported or estimated lastly given sufficient computing power and time a robust automatic calibration can improve the model simulation methods such as global and gradient based optimization schemes can refine the input parameters to improve the simulated results another model construction error is assuming the 2010 land use data does not vary in the simulation that is the same data set is repeated for multiple years this assumption affects the hydrological fluxes especially the evapotranspiration estimation and can be improved in the future work by including landcover change over time for streamflow simulations we only included the major rivers for the stream flow routing module sfr for computational efficiency future studies can include the river tributaries to the routing sfr module instead of the river riv module for improved representation of the physics in this model set up reservoirs are not explicitly included which may affect the streamflow results particularly where there is significant storage capacity however using usgs observed streamflow as an upstream boundary condition for river segments implicitly incorporates the impacts of surface water management this model does not simulate the water demand and irrigation supply from surface water fmp can estimate unknown pumpage but this option was beyond the scope of this study a future study can include estimating irrigation pumpage for a better representation of water use in the united states further this would improve the estimated stream flow from irrigation runoff and stream flow delivery as irrigation as with any model there are improvements that can be implemented to give more realistic simulations but these improvements depend on data availability and the model s structural limitations hydraulic conductivity can be estimated from the available baseflow data or it can be calibrated to better estimate baseflow in addition the specific yield can be calibrated to better estimate seasonal fluctuations in groundwater levels the land surface simulation with the farm process can be improved by specifying multiple crops per grid cell this version of the model selected the dominant crop to be represented as the land use for each grid cell in addition we can include the historical land cover data change over time this will allow us to analyze the impact the human activities such as crops use for agriculture and urbanizing expansion and the impact of the natural land cover changes such as deforestation and the natural vegetation change on the hydrologic processes across the united states with this addition we can calculate the irrigation water supply and demand for each crop type and include the water irrigation from surface water and groundwater in conclusion the model can simulate the groundwater levels and surface water budgets well across the large scale region of the contiguous united states the results show high correlation with observational data tradeoffs were made between model realism and computational efficiency to realistically simulate the contiguous us while prioritizing the inclusions of the dominant hydrologic cycle dynamics the model has the capacity of simulating the evapotranspiration surface runoff infiltration groundwater pumping three dimensional groundwater fluxes interaction between surface water and groundwater and stream flow routing holistically on monthly time step across the large scale region of the united states declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgements the authors gratefully acknowledge the support of nsf water sustainability and climate grant 1360446 wsc category 3 collaborative america s water the changing landscape of risk competing demands and climate and the support of nsf division of mathematical sciences 1720114 they thank nathaniel chaney for sharing the polaris dataset any use of trade firm or product names is for descriptive purposes only and does not imply endorsement by the u s government supplementary materials supplementary material associated with this article can be found in the online version at doi 10 1016 j advwatres 2020 103682 appendix supplementary materials image application 1 image application 2 
440,assessments of groundwater and surface water budgets at a large scale such as the contiguous united states often separately analyze the complex dynamics linking the surface and subsurface categories of water resources these dynamics include recharge and groundwater contributions to streamflow the time varying simulation of these complex hydrologic dynamics across large spatial and temporal scales remains a scientific challenge due to the complexity of the processes and data availability in this study groundwater fluxes and surface hydrologic processes are simulated across the contiguous us for 1950 2010 the simulation estimates the monthly water budget components such as groundwater recharge surface runoff and evapotranspiration streamflow in major rivers is routed while accounting for groundwater exchange human impacts are included through groundwater pumping and climate variability is included including variability in precipitation temperature and potential evapotranspiration the simulated groundwater level and river discharge have strong correlation with usgs observation wells and streamflow gages with r2 values of 0 992 and 0 946 respectively the simulated evapotranspiration is compared with three other published estimation methods showing that it is able to capture the magnitude and seasonality of evapotranspiration over the mississippi river basin as such the model is able to reasonably simulate the surface and groundwater budgets over the us allowing for questions of the relative importance of climate and human impacts to be explored in the future keywords modflow owhm surface groundwater interactions water budgets climate variability evapotranspiration streamflow 1 introduction surface water and groundwater interact with one another with surface hydrologic processes impacting groundwater recharge and groundwater levels determining baseflow in streams the water budgets are dynamically affected by climate conditions such as precipitation and temperature human activities such as water withdrawals from rivers groundwater pumping and land use change and terrestrial processes such as plant water use estimating the surface and groundwater budgets is critical for quantifying water resources across large spatial and temporal scales yet it remains a challenging task due to a lack of in situ observations of critical hydrologic processes and poor characterization of subsurface hydrogeologic properties this study presents a contiguous us conus set up of the modflow one water hydrologic model version 2 mf owhm2 hanson et al 2014a boyce et al 2020 which is a surface and groundwater model capable of simulating the hydrologic fluxes and storages for water budget assessment climate subsurface conditions and human activities all impact groundwater levels for example during periods of low rainfall groundwater levels decline due to a reduction in groundwater storage from low recharge rates wada et al 2014 if the lateral groundwater flow is limited de graaf et al 2017 condon and maxwell 2017 furthermore excessive groundwater pumping can threaten groundwater sources with high groundwater depletion döll et al 2014b scanlon et al 2012 in some regions such as the great plains groundwater levels increase slowly due to low recharge rate and relatively low hydraulic conductivity peterson et al 2016 the sensitivity analysis of groundwater level is analyzed on global scale with respect to hydraulic conductivity groundwater recharge and surface water body elevation by reinecke et al 2019 to maintain the groundwater availability and baseflow to rivers some global studies döll et al 2014a pokhrel et al 2012 wada et al 2010 analyzed the groundwater recharge rate and groundwater storage from water budget components and other studies peterson et al 2016 faunt et al 2009 analyzed the streamflow in regional aquifer systems although it is widely accepted that understanding surface and groundwater fluxes and storages is critical for water resources planning collecting extensive in situ observations such as groundwater levels and subsurface geological properties is prohibitively expensive over large regions remote sensing data can provide estimates of hydrologic fluxes over large spatial scales but remote sensing has relatively short time series and can typically only observe surface processes the exception is grace tapley et al 2004 which can estimate groundwater storage change through gravity field changes but only at coarse spatial and temporal resolutions to overcome the remote sensing limitations numerical models can be utilized to estimate and reconstruct the hydrologic fluxes and stores thereby overcoming the observational data limitations these models can be useful tools to address critical questions for instance what is the impact of climate variability and groundwater pumping on groundwater availability regional hydrological and groundwater models have been used to simulate numerically the surface water and groundwater hydrologic processes for example three regional models have been set up in detail over three major aquifers in the united states in central valley high plains and rio grande aquifer systems the first groundwater flow model simulates the northern high plains aquifer peterson et al 2016 and uses modflow with the newton rhapson solver niswonger et al 2011 the second is the central valley hydrologic model cvhm faunt et al 2009 for california s central valley aquifer using modflow fmp2 schmid and hanson 2009 the forthcoming new version of cvhm cvhm2 is being updated to use mf owhm2 a third model is the rio grande transboundary integrated hydrologic model rgtihm that simulates portions of new mexico texas and mexico hanson et al 2020 using mf owhm2 these regional models provide a better understanding of the surface and subsurface regional water budgets and their dynamics however regional models typically cover a single aquifer neglecting processes at the model boundaries this means the streamflow surface runoff and lateral groundwater flow may be neglected at the boundaries of these regional models these assumptions can misrepresent the modeled water budgets schaller and fan 2009 krakauer et al 2014 depending on the regional conditions such as topography geology and climate continental and global scale groundwater models were developed de graaf et al 2015 fan et al 2007 maxwell et al 2015 to not only solve the problem of lateral flow at model boundaries but because they can provide a better understanding of the hydrology of an entire large scale system for example large scale models can analyze the spatial variation of climate geology and topography and its effect on surface water and groundwater availability and they can analyze the surface groundwater interaction in different aquifers one of the first studies to simulate the groundwater depth across the contiguous united states was conducted by fan et al 2007 where the water table was estimated as the equilibrium of long term climatic forcing on groundwater level under a steady state model followed by a study of global observations of water table depth fan et al 2013 these studies led to the ability to connect groundwater with other hydrologic fluxes which has been investigated in several later studies over the united states for example maxwell et al 2015 used an integrated groundwater model parflow maxwell and miller 2005 to analyze the surface and subsurface flow system over the majority of conus to do a high spatial resolution run the model was run under steady state conditions but can be run transiently as in kollett 2009 and maxwell et al 2016 other studies simulate the groundwater on the global scale using a model run at steady state de graaf et al 2015 and transient de graaf et al 2017 then analyzing the groundwater depletion de graaf et al 2019 these models simulate recharge and river discharge from the global hydrological model pcr globwb wada et al 2011 then simulates the groundwater lateral flow from modflow the modflow one water hydrologic model mf owhm2 used in this paper simulates both surface hydrologic processes and groundwater flow simultaneously in one model overcoming the limitation of coupling two models some of these large scale models assume the magnitude and direction of the fluxes are constant over time fan et al 2007 maxwell et al 2015 de graaf et al 2015 thereby neglecting the temporal dynamics of seasonal and interannual climate variability in addition human activity such as groundwater pumping is often neglected however in recent studies de graaf et al 2017 condon et al 2019 de graaf et al 2019 the groundwater pumping is simulated in addition incorporating streamflow routing is still a challenging component to model with a coupled groundwater model because of modeling limitations or the scarcity of needed data such as river hydraulic conductance over such a vast area such as the united states these challenges have led some past studies to simplify the modeling of such a complex system by neglecting human activity and simplifying or neglecting the streamflow routing and its interaction with groundwater this study s objectives are 1 to evaluate the feasibility of using mf owhm2 at continental scales for water budget estimation and 2 to develop and validate a conus wide mf owhm2 model set up that explicitly simulates hydrologic processes that link the surface and groundwater hydrologic processes and human impacts the focus is on capturing large scale hydrologic patterns and human impacts to provide a baseline model for the hydrologic community which can then expand the model to include more detailed processes relevant for specific research questions this model is complementary to other us focused modeling efforts such as that of parflow as it is more focused on including human impacts in a parsimonious framework that would not require high performance computing resources in this paper we first present the model set up including simplifications the observation based input data and the assumptions made in some input variables then the model validation and water budget results are presented including both groundwater and surface water the conclusions are presented in the final section 2 model and data to simulate the surface and subsurface hydrology of the contiguous us conus this study uses modflow one water hydrologic model version 2 mf owhm2 boyce et al 2020 boyce 2020 which is a modular modeling software developed by the u s geological survey and u s bureau of reclamation mf owhm2 builds on the widely used modflow model harbaugh et al 2000 harbaugh 2005 which simulates groundwater fluxes at a range of spatial and temporal scales in addition to simulating groundwater fluxes the standard version of modflow includes pumping and surface water routing prudic et al 2004 mf owhm2 incorporates a surface water model allowing for simulation of the partitioning of precipitation into infiltration and surface runoff evapotranspiration and irrigation mf owhm2 is able to holistically simulate the hydrologic system including some of the ways human s impact hydrologic processes it also allows for better quantifying surface water and groundwater availability by directly coupling the surface and subsurface hydrologic fluxes table 1 compares four large scale models simulating the lateral groundwater flow the model domain covers conus extending from 132 437 w to 72 502 w and 22 177 n to 49 822 n fig 1 and to a depth of 60 m below the water table as a single vertical layer the mf owhm2 study area is divided into a finite difference equal area grid of approximately 13km using the north america albers equal area conic projection the domain covers a land area of approximately 11 790 960 km2 which extends into canada and mexico the ocean boundary conditions are represented as a cauchy boundary condition using the modflow general head boundary ghb module that specifies a single average sea level elevation the simulation time frame is from 1950 to 2010 at a monthly time step called a stress period in modflow with boundary conditions specified for each month for model convergence reasons each stress period contains two transient sub steps where the model breaks up the monthly data into sub periods the model is simulated using modflow s convertible option which uses the unconfined equation when the water table is above the layer bottom and converts to the confined equation when the water table is below the layer bottom of a grid cell confined layers are omitted due to insufficient well observations in some confined aquifers to accurately set up and validate the model across the conus domain the model empirically estimates the evapotranspiration based on the monthly precipitation reference evaporation crop coefficient and the groundwater evapotranspiration extinction depth the crop coefficient is the ratio of the actual evapotranspiration to the reference evapotranspiration for each crop type and the extinction depth is the depth at which there is no evaporation from groundwater sources the surface runoff to rivers is estimated based on the surface runoff coefficient which is the ratio of the surface runoff from the rainfall over the infiltration groundwater recharge is estimated as the residual of the water budget mf owhm2 calculates the vertical and the horizontal groundwater flows using a finite difference scheme of the three dimensional groundwater equations and estimates the interaction between the groundwater and surface water these fluxes are calculated based on the subsurface properties harbaugh 2005 prudic et al 2004 such as the hydraulic conductivity and layer thickness and the climatic conditions the unsaturated zone is not simulated in this study which increases the simulation error when water that infiltrates takes longer than the model timestep to reach the water table this is common in very dry areas such as the southwestern deserts scanlon et al 2006 flint et al 2007 and may result in an over or underestimate of the groundwater fluxes both surface runoff and baseflow from the groundwater to rivers are simulated and streamflow is routed in the major rivers section 2 4 in addition to the effect of climate variability the model includes the human impact on groundwater levels by simulating withdrawals using the modflow well module and explained section 2 3 details of the model set up are described below 2 1 subsurface hydrogeologic parameters the ground surface elevation was specified using the hydrosheds 30 second resolution digital elevation model lehner et al 2006 using hydrosheds the average ground surface elevation of each 13km model grid cell was calculated modflow calculates the layer thickness as the difference between the ground surface elevation and the layer bottom explained in section 2 2 this layer thickness is used in the groundwater equations the model hydraulic conductivity was estimated using the method derived by fan et al 2007 that is based on soil type the soil type was first characterized into fractions of sand silt and clay using the polaris soil database chaney et al 2016 and the average for the top 1 5m depth is calculated then the fractions were used to specify in which of the twelve soil types in the united states department of agriculture usda soil type classification the grid cell belongs fig 1a this was then used to estimate the hydraulic conductivity at 1 5 m depth the vertical hydraulic conductivity is calculated for each soil type from the land data assimilation system ldas http ldas gsfc nasa gov and the horizontal hydraulic conductivity is calculated using the anisotropy ratio estimated by fan et al 2007 using the estimated hydraulic conductivity at 1 5m depth below the ground surface each grid cell s horizontal hydraulic conductivity was estimated for the full depth of the model layer thickness extending to 60 m below the groundwater level this was done using the depth dependent exponential relationship derived by fan et al 2007 1 k k o exp z f 2 w h e r e f a 1 b β f o r β 0 16 5 m f o r β 0 16 where a and b are constants z is the depth where the hydraulic conductivity is calculated β is the terrain slope ko is the hydraulic conductivity at 1 5m depth and f is the e folding depth which is the depth interval in which the exponential decline of hydraulic conductivity decreases by a factor of the natural logarithm constant e e 2 71828 the constants a and b were taken from the best fit in fan et al 2007 where a equals 120 m and b equals 150 m to calculate the terrain slope β and e folding depth f additional data is required the terrain slope β is calculated as the average slope of the 1 25 km pixels within the modflow grid cell for both regolith fig 1b and bedrock the regolith is a layer of sediment such as dust soil sand gravel and loose rock that covers a hard rock formation the 1 25 km pixel slopes are calculated from the hydrosheds elevation data first reprojected to the north american albers equal area conic projection used in this modflow set up the depth to bedrock data was downloaded from http www soilinfo psu edu index cgi soil data conus data cov dtb methods which is available for a depth of 152 cm across the united states fan et al 2007 since this study focuses on the united states the depth to the bedrock in mexico and canada was assumed to be zero to simplify the model because of the equations form this has only a minor impact on the estimated hydraulic conductivity the assumption of 13 km grid size increases the error in the simulation due to the uncertainty related to averaging the depth to bedrock and the ground surface elevation over a relatively large grid cell especially in the heterogeneous terrain such as the southwest region the e folding depth f was calculated for both bedrock and regolith at 1 5 m depth and depends on the topography fig 1c in eq 1 the hydraulic conductivity k decreases exponentially with depth z to calculate a depth averaged hydraulic conductivity the horizontal hydraulic conductivity was calculated for every 0 5 m depth interval from the ground surface elevation to the layer bottom of 60 m below water table and the integrated equivalent horizontal hydraulic conductivity was calculated using the following equation todd and mays 2005 3 k x i 1 n k i d z i h where h is the model layer thickness and kx is the final horizontal hydraulic conductivity figure 1d for the model layer thickness dzi is the 0 5m depth interval increment ki is the horizontal hydraulic conductivity at each 0 5 m interval increment within the model single layer as mentioned above the model consists of one layer with a thickness of 60m below the estimated observed groundwater level used to initialize the model details of estimating the initial groundwater level are below the exception is below rivers where a minimum thickness of 20m below the riverbed is specified to allow for model convergence in a few river grid cells the river segment is below the average 13km layer bottom due to large topographic gradients and this is not allowed in the model impermeable conditions were assumed below the model layer because the hydraulic conductivity values below 60 m are prohibitively small when using the exponentially decreasing hydraulic conductivity method in eq 1 the specific yield figure s1 was estimated from the aquifer sediment and rock type using heath 1983 and morris and johnson 1967 the aquifer sediment and rock type map is taken from the usgs miller 1990 2 2 groundwater observations and model initial conditions u s geological survey usgs observation well data was used to specify the model initial conditions and to validate the modeled groundwater levels there are 780 851 wells with at least one observation between january 1950 and december 2010 across the united states of these wells were excluded if they met any of the following conditions 1 the well was identified by the usgs as confined mixed aquifer type or undefined aquifer type 2 the well elevation is unavailable 3 the well elevation is below 10 meters to eliminate wells with missing data flags or unrealistic elevation values 4 the well elevation is greater than 4000 meters above sea level 4 the well is designated as pumping wells injection wells obstructed damaged plugged dried or flowing 5 the well has an average observed water depth deeper than 300 m implying it is in a deep aquifer outside this model s bounds the latter condition was necessary to provide preliminary initial conditions of the water level after the model was spun up the simulated water level was used to determine the model layer thickness which is a minimum of 60m below the water table of each grid cell after the layer thickness was determined we verified that no wells are below the model s vertical extent and that 300m below the water table was a reasonable assumption for the model layer thickness applying these five criteria resulted in 642 839 wells that could be used for initializing the model this approach was similar to that used in fan et al 2007 water depths from the selected wells were utilized to calculate the water level of the model initial conditions for january 1950 water level observations were spatially interpolated using a triangulation based natural neighbor interpolation which is a mix between linear and cubic nonlinear interpolation using the matlab function griddata with the natural interpolation option the interpolated groundwater level is constrained to not exceed the average ground surface elevation for each grid cell because there are a limited number of wells with observations dating back to 1950 a strategy was developed to utilize well observations whenever they exist for wells with observations beginning after january 1950 the water level for the earliest january observation is used selecting one month in this case january eliminates the impact of seasonal variability on water levels for wells with only one observation the water level is assumed to be the same as january 1950 this assumption allowed for the inclusion of more wells particularly in large areas of the country that were data scarce in the mid 20th century the impact of this assumption on the model s performance is discussed in the next section the water level in the ocean and lakes is assumed to be constant over time and is simulated using the general head boundary ghb module in mf owhm2 in the major lakes the water level was estimated from the hydrosheds digital elevation map lehner et al 2006 the ocean boundary condition water level is set equal to mean sea level the initial conditions for the model consist of the interpolated january 1950 water level combined with the boundary condition for lakes and oceans fig 2 and data for canada and mexico were linearly extrapolated and run under a spin up model as explained in detail in section 3 2 3 groundwater pumping well pumping was estimated using the usgs water use dataset https water usgs gov watuse data last accessed on july 18 2019 which is available on a county scale every five years since 1985 county groundwater withdrawals are uniformly distributed across the model grid cells located within the county the available usgs groundwater withdrawal data do not specify aquifer type for withdrawals all pumping regardless of aquifer source is assumed to be from the unconfined aquifer furthermore because the usgs groundwater withdrawals data is only available for every five years the pumping rate is assumed to be temporally constant between the available years pre 1985 years are assumed to be the same as 1985 withdrawals this imposes errors but in the absence of data for before 1985 it allows for incorporating human influence on the hydrologic cycle to simplify the pumping simulation each grid cell in the model contains one effective well in the center which represents all the pumping wells within the grid cell 2 4 surface water routing streamflow is simulated using two different modules the major rivers are routed using the streamflow routing sfr module and the tributaries using the rivers riv module fig 3 a the river network shapefile was downloaded from https www naturalearthdata com which primarily derived the data from the u s world data bank 2 2006 they classified the main rivers from the double lined rivers classification level this data is used for the main rivers in this study the small rivers and tributaries obtained from the same source for lower river classification levels the sfr module calculates the water exchange in the river channel between surface water and groundwater and routes the river discharge downstream accounting for surface runoff and baseflow inputs to the river for each river grid cell the riv module only calculates the water flux between the streamflow and baseflow from groundwater without routing making it computationally more efficient than the sfr module in the river validation the baseflow to rivers calculated by the riv module is added to the rivers simulated by the sfr module for each month because the riv module does not incorporate surface runoff into the streamflow all the surface runoff is included in the sfr routing there are 358 usgs streamflow gages selected for the sfr module that are located on the sfr river network and that have at least 50 years of continuous monthly observations from 1950 to 2010 the sfr river network consists of 5241 grid cells that are divided into 595 segments where 358 of these segments have a usgs gage station at the start of the segment thus the discharge at the upstream grid cell for each segment is equal to the observed discharge of that usgs gage station during the simulation the model sfr module routes the streamflow for each river segment downstream accounting for interactions between surface water and groundwater via baseflow and for the surface runoff that runs off to the river segments in this study infrastructure such as dams and water transfers are neglected the model study area was divided into 183 water balance subregions wbs fig 3b using the 1 250 000 scale hydrologic units huc250k steeves and nebert 1994 and watersheds without a sfr river segment were combined so that each water balance region has a river except canada and mexico this allows the farm process fmp in mf owhm2 to distribute the surface runoff water from each water balance subregion over the number of sfr rivers grid cells located within each one uniformly to simplify the sfr model some assumptions were made first due to a paucity of large scale data on river bed hydraulic conductivity the river bed hydraulic conductivity was assumed to be equal to the grid cell s horizontal hydraulic conductivity this used by the model to calculate the river bed conductance the river bed thickness is set to 1m and the manning s roughness coefficient is 0 04 which is typical for natural streams chow 1959 if a stream gage was missing stream width or elevation data it was taken from google earth or the usgs dem respectively in this model the stream width and elevation data linearly interpolated for grid cells between the gage stations by the model this option can be changed to specify the stream width and elevation data for each grid cell the model allows for precipitation and evaporation from the river water surface this was assumed to be zero given the large scale nature of the simulation and the lack of data with which to validate these processes the river module riv was used for the smaller river tributaries this tributary river network covers the united states with 4625 grid cells included in this model the river elevation for riv grid cells was estimated from the usgs digital elevation map the water depth was assumed to be 3m for all riv tributaries 2 5 land cover land cover data was taken from usda s cropscape usda national agricultural statistics service cropland data layer 2010 for 2010 and held constant over the modeling period for canada and mexico land cover is from modis channan et al 2014 the land cover dataset was first aggregated into 23 types using the california department of water resources 2000 classification system then the dominant land cover within each model grid cell was selected fig 4 b the land cover data is used to specify crop coefficients and calculate potential evapotranspiration the crop coefficient values were estimated from previous studies allen et al 1998 faunt et al 2009 hanson et al 2014a hanson et al 2014b boyce et al 2020 fig 4a and the crop coefficient of non cropped land cover types is set equal to one by construct for cropped land cover types the crop coefficients are constant across the study domain 2 6 climate data climate conditions such as precipitation potential evaporation and temperature have a significant impact on water supply and demand for both surface and groundwater climate data such as precipitation and temperature are available on daily intervals but in this study climate data are simulated on a monthly time interval called a stress period in this model the monthly climate related input data are precipitation snowmelt and reference evapotranspiration then mf owhm2 simulates the impact of climate variability on both surface water and groundwater processes mf owhm2 assumes all precipitation is rainfall and therefore capable of being partitioned into runoff and infiltration a portion of which can be consumed as evapotranspiration however much of the us has a significant snow season and this assumption would be inappropriate in the northern and western us to account for the snowmelt lag the variable infiltration capacity vic hydrologic model liang et al 1994 liang et al 1996 snowmelt outputs were used vic is a land surface model that solves for energy and water budget closure at the land surface and includes a snow model vic was implemented using the meteorological forcings of maurer et al 2002 updated to extend from 1950 to 2010 and the calibrated parameters from troy et al 2008 the vic simulated liquid input to the soil essentially rainfall and snowmelt is then passed to mf owhm2 to account for the time lag in precipitation that would occur due to the snowpack because mf owhm2 is on the north america albers equal area conic projection and the maurer and vic data are on the world geodetic system of 1984 wgs84 projection the vic and maurer datasets are interpolated using a bilinear interpolation method the monthly reference evaporation was calculated by vic for natural vegetation and tall and short reference crops and the minimum potential evaporation for the mf owhm2 is constrained to be at least the actual evaporation from vic model finally mf owhm2 calculates the potential evapotranspiration by multiplying the reference evapotranspiration by the crop coefficient for each land cover type for canada and mexico precipitation and evapotranspiration data were taken from global vic simulations sheffield and wood 2008 forced with the dataset of sheffield et al 2006 further details on evapotranspiration calculations are in the following section in this model the irrigation withdrawals from streams were neglected and all irrigation water from pumping is assumed to be consumed thus the simulated evapotranspiration is only calculated from the precipitation and groundwater this may increase the potential simulation errors and neglecting the seasonality variation of the irrigated in future studies the irrigation water supply and demand from pumping and streams and its consumptive use could be included 3 model spin up and calibration for calibration purposes a simplified 12 month model using the seasonal averaged climate variables from 1950 to 2010 was created for the model spin up and calibrated to estimate the groundwater level in an equilibrium state and to calibrate the extinction depth of groundwater sourced evapotranspiration using the farm process version 4 fmp of modflow owhm2 the simplified 12 month model was run with the seasonal climatology allowing for errors in initial conditions to dissipate evaluation of the water levels in the model shows that changes in water levels exponentially decline across several months such that water levels are stable by the end of the 12 month run these errors can also be due to uncertainty in the estimated hydraulic conductivity used in this model errors in the hydraulic conductivity can lead to incorrect hydraulic gradients and lateral water movement in addition hydraulic gradients between rivers and the surrounding topography can lead to inaccurate baseflow estimates until equilibrium is reached at the end of the 12 month model spin up the water levels are used as the initial conditions for both the calibration and the full study period simulations for modeling evapotranspiration it is important to note that mf owhm2 does not separately simulate the near surface soil moisture that is directly accessible to the plants in their rooting zone hanson et al 2014b instead the near surface soil moisture is included in the groundwater budget as part of the water stored in the unconfined aquifer layer thus the change in both soil moisture and groundwater level is included in the simulated change in groundwater level in the fmp evaporation and transpiration are modeled separately one of evapotranspiration concepts employed in fmp is to linearly increase groundwater consumption as transpiration when the water table plus a capillary fringe length intersects the average root depth until the water table reaches the average root depth when the water table intersects the average root depth the transpiration consumption linearly decreases to represent anoxic conditions due to the size of this simulation domain a positive feedback loop occurred when the water table resulted in too much anoxia causing a reduction in transpiration which further increased the water table elevation and the amount of anoxia to avoid this feedback loop all evapotranspiration is modeled as evaporation which does not include anoxia as part of its simulation because crop coefficients are used in conjunction with reference evaporation this results in reasonable simulations of evapotranspiration within the model structure in this model a linear relationship is used for the subsurface sourced evapotranspiration calculations where the calculated evapotranspiration will be equal to the potential evapotranspiration when the groundwater level reaches the ground surface elevation and subsurface evapotranspiration from groundwater and near surface soil moisture equal to zero when the groundwater level is lower than the groundwater evapotranspiration extinction depth the model extinction depth was calibrated using the 12 month calibration model with the objective of matching the evapotranspiration calculated by the vic model specifically the spatial average of the absolute difference between mf owhm2 and vic simulated et is minimized compared to the vic estimated et the mf owhm2 simulated evapotranspiration for the 12 month model of the conus simulation domain had an average absolute bias of 1 033 mm month and a root mean square error of 3 701 mm month because there are no accurate observations of evapotranspiration over the us we are using vic estimated et to calibrate the constant extinction depth for this model for the 732 month model the average absolute bias is 2 66 mm month and the average root mean square error is 5 46 mm month these error statistics demonstrate that the calibration with the simplified model can be used with the full version with a small increase in errors this allows for a much faster calibration over such a large domain the surface runoff coefficient was calibrated using the full model simulation from 1950 to 2010 this calibration was conducted because sensitivity studies show that the cumulative change in groundwater level is very sensitive to the surface runoff coefficient parameter as this controls infiltration to the subsurface the calibration allows for the assumption of negligible change in groundwater storage from 1950 to 2010 the calibration error of groundwater level for the calibrated surface runoff coefficient is calculated as the spatial average of root mean square error and it is equal to 0 135 m for the conus simulation domain this calibrated surface runoff coefficient was used for the full monthly model simulation from 1950 to 2010 which also included groundwater pumping 4 model validation results and discussion 4 1 groundwater validation the full monthly model simulation from 1950 to 2010 with groundwater pumping is validated against the observed groundwater levels from the selected usgs wells for unconfined aquifers the validation was implemented between usgs well measurements and the simulated groundwater level in the grid cell that contains that well for the months when a measurement was made the criteria to select the usgs observation wells for the groundwater level validation is similar to the criteria used for the model initial condition but wells with only one month of observations were removed this results in 151 415 usgs wells with time series for the groundwater validation of the selected wells 900 have at least 30 years of data and 16 054 have at least five years of data because the well observations have different record lengths the statistics are calculated for each well for those months with observed groundwater levels the statistics for grid cells with observations beginning in january 1950 and those grid cells with later data are similar indicating that the assumption made to include wells in the initial conditions regardless of data availability at the start of the model period did not significantly impact the model performance simulated and measured mean annual groundwater levels for 1950 to 2010 across the 151 415 usgs groundwater observation sites have an r2 value of 0 9926 fig 5 a this is similar to the r2 of the estimated groundwater level by previous studies for example an r2 value of 0 999 was calculated by fan et al 2007 where the water table was estimated as the equilibrium of long term climatic forcing on groundwater level under a steady state model maxwell et al 2015 simulated the water table using the parflow groundwater model maxwell et al 2015 over most of conus using a high spatial resolution steady state run with an r2 value of 0 998 another example of simulating the water table is a study by de graaf and others 2017 using modflow model globally with r2 value of 0 94 fig 5b shows the histogram of model bias in groundwater level the mean bias is 2 28m with relatively few wells having a large bias for example 5 2 of the wells have a negative bias greater than 50m and 9 1 of the wells have a positive bias greater than 50m the bias results for many reasons there is uncertainty in model parameters boundary conditions and pumping observations errors are introduced due to the difference between the observed water level for each individual usgs well and the average groundwater level for wells located on a 13 13 km grid cell area in other words the elevation of the water level measurement can be very different from the average grid cell elevation the largest error in groundwater level values occurs in three regions fig 6 and figures s2 s4 heterogeneous terrain near rivers and the regions with high pumping rates in heterogeneous terrain the errors occur for two reasons first significant errors are introduced due to the topography as groundwater levels can vary significantly within a 13 13km grid cell the error is calculated as an average throughout the grid cell and is therefore sensitive to where the individual usgs wells are located within a grid cell the large 13 km grid cell may mischaracterize the deep arid zones in the west and increase the simulation error in addition this model includes only unconfined aquifer type wells following previous studies fan et al 2007 maxwell et al 2015 groundwater flow in the confined aquifer is neglected this assumption increases the model uncertainty and misrepresents the aquifers system because groundwater in the confined aquifer has much lower storativity therefore calibrating to groundwater head will lead to skewed parameterization second there is simulation error due to the uncertainty in model parameters for example overestimating hydraulic conductivity k allows the groundwater to move too quickly from higher to lower groundwater levels resulting in a milder hydraulic gradient than the hydraulic gradient of the interpolated usgs observation wells near rivers the errors occur due to the uncertainty in river parameters and due to topography for example in the sfr module the errors result from uncertainty in the river bed hydraulic conductivity the difference between the groundwater level and water level in streams and accumulated errors from river routing outside of heterogeneous regions and along rivers the model has a high correlation with the usgs historical observed groundwater levels in these areas the model is able to simulate the mean water levels well with larger errors in simulating the variability figure s5 4 2 river routing and water budget validation results of both sfr and riv modules were post processed by adding the monthly simulated baseflow between the rivers and groundwater in the riv module to the sfr module where the riv flow within each watershed was uniformly distributed across the sfr grid cells located within the same watershed the routed streamflow was validated against the observed discharge from the available usgs gage stations located on the sfr river network with at least 50 years of monthly streamflow observations from 1950 to 2010 the simulated routed outflow from each river segment downstream was validated with the usgs gage station located on the upstream of next river segment that connected with it the usgs observed streamflow is used as the upstream boundary condition for each routed segment fig 7 a shows the scatter plot of the average observed versus simulated streamflow on a log scale and fig 7b shows nash sutcliffe efficiency values which represents how well the model simulates both the mean and variability in streamflow the results show a strong correlation between the simulated and observed discharge for each sfr river segment with a r2 equal to 0 95 for the actual values and 0 87 for the log values the model overestimates streamflow in smaller basins this occurs because the current version of the farm process fmp distributes surface runoff water equally over the sfr river grid cells that are located within the same water balance subregion time series of randomly selected gages are plotted in figure s6 surface water withdrawals for irrigation are not included in this model because usgs observations are used as upstream boundary conditions this will not have a significant impact on the routed streamflow as it is implicitly accounted for in the observations fig 8 shows the time series of the simulated evapotranspiration against evapotranspiration estimated using different methods over the mississippi basin presented by sheffield et al 2009 the data were digitized from the published paper the simulated evapotranspiration using mf owhm2 is compared with three estimation methods of daily evapotranspiration 1 estimation of daily evapotranspiration using remote sensing based on the penman monteith equation monteith 1965 these remote sensing penman monteith rc pm estimations of evapotranspiration data are the ensemble mean with varying inputs which are calculated using a revised penman monteith equation from mu et al 2007 2 evapotranspiration inferred as a residual from the north american regional reanalysis narr mesinger et al 2006 atmospheric water budget 3 estimation of daily evapotranspiration using the vic hydrologic model set up described in section 2 6 in this mf owhm2 set up the extinction depth of groundwater evapotranspiration was calibrated to get simulated evapotranspiration similar to the estimated evapotranspiration using this vic hydrologic model the root mean square error between the mf owhm2 simulated evapotranspiration and the rc pm narr inferred and vic estimations are 8 57 8 29 and 4 69 mm month respectively over the mississippi basin from 2003 to 2006 the evapotranspiration from near surface soil moisture was assumed to be part of the groundwater budget and both groundwater and near surface soil moisture changes are accounted for in the simulated groundwater level change this assumption was made because mf owhm2 does not explicitly account for the soil moisture term in its equations 4 3 water budget fig 9 shows the seasonal cycle of the simulated water budget for various water resource regions across the united states the water budget is averaged from 1950 to 2010 which includes the average monthly precipitation as input data the simulated total evapotranspiration et and the partitioning of et from precipitation and groundwater sources the simulated surface runoff and the deep percolation which is calculated as the residual of the surface water budget precipitation minus the surface runoff minus the evapotranspiration from precipitation results show how the simulated water budget components vary spatially and seasonally over the model domain each region has a different seasonal behavior depending on its climatological and geological conditions for example california has a mediterranean climate with precipitation occurring in the winter whereas the the ohio and missouri river basins have higher precipitation in the summer consequently the evapotranspiration seasonality is weaker in california than other regions new england demonstrates the importance of snowmelt on the water budget whereas the texas gulf water resource region has the smallest effect of snow incorporating snowmelt into modflow affected the simulated seasonality of the water budget but not the long term averages figure s7 plots the last decade of model results showing that rainfall and runoff have the largest interannual variability variability in evapotranspiration is dominated by the seasonal cycle rather than interannual variability in humid climates like the great lakes and ohio water resource regions deep percolation primarily occurs in the winter months when et demand is low the same is true for california but in this case the wet season coincides with low et in the winter months leading to stronger seasonality the great basin which is arid shows a tighter relationship between precipitation and deep percolation than in the other water resource regions throughout the usgs water resource regions evapotranspiration has the lowest coefficient of variation of the hydrologic fluxes analyzed here deep percolation and evapotranspiration had the largest likely due to the model structure and that these integrate the impacts of both precipitation variability and et variability drier regions have larger variation in precipitation and this propagates into higher coefficients of variation in all the other hydrologic fluxes in these regions 5 conclusions in this paper the groundwater and surface water budgets were simulated on a monthly time step across the united states using the transient modflow one water hydrologic model version 2 mf owhm2 boyce et al 2020 boyce 2020 the model includes the impact of climate variability and human activities specifically groundwater pumping on the groundwater levels including their seasonality in addition the lateral groundwater flow is simulated and interacts with surface water this model contributes to the literature by fully coupling the simulation of surface and groundwater processes over a large spatial scale in a publicly available usgs supported model in this paper version 4 of the farm process fmp is used for evapotranspiration surface runoff and recharge estimations the fmp module works simultaneously with the groundwater streamflow routing and wells pumping modules as one integrated hydrologic model model validation shows that both the simulated groundwater levels and streamflow have a good correlation with the 151 415 selected observation wells and the 358 selected river gage stations with a r2 equal to 0 992 and 0 946 respectively the simulated evapotranspiration et also is well simulated compared with other estimation methods the root mean square error values between the simulated evapotranspiration using mf owhm2 and rc pm narr inferred and vic estimations are 7 97 7 23 and 3 27 mm month respectively over the mississippi basin from 2003 to 2006 based on validation of et streamflow and water levels the model is well constrained and able to simulate the water budgets overall the simulation results match well with observed head streamflow and vic evapotranspiration estimates with the exceptions likely originating from model structural error lack of sufficient input datasets and exhaustive automatic calibration the largest source of model structural error is the large grid cell size 13km each grid cell has uniform aquifer properties such as hydraulic conductivity uniform land surface properties such as elevation and land use and calculates a single water table elevation the single water table elevation represents the hydraulic head at the center of the grid cell which is used for determining stream aquifer interaction and consumption of groundwater as evapotranspiration consumption due to this large grid cell size most model error occurs in highly heterogenous terrain due to the variation in surface elevation and aquifer properties within a single grid cell another potential structural error is the monthly stress periods stress periods specify input stresses such as precipitation and potential evapotranspiration rates and assumes they are constant over the time steps in the stress period each stress period contained 2 time steps making the average time step length about two weeks within the time step the calculated evapotranspiration surface runoff infiltration and stream flow are constant which averages out the effect of synoptic events another source of error are the available input datasets for groundwater pumping and how accurate the pumping is reported or estimated lastly given sufficient computing power and time a robust automatic calibration can improve the model simulation methods such as global and gradient based optimization schemes can refine the input parameters to improve the simulated results another model construction error is assuming the 2010 land use data does not vary in the simulation that is the same data set is repeated for multiple years this assumption affects the hydrological fluxes especially the evapotranspiration estimation and can be improved in the future work by including landcover change over time for streamflow simulations we only included the major rivers for the stream flow routing module sfr for computational efficiency future studies can include the river tributaries to the routing sfr module instead of the river riv module for improved representation of the physics in this model set up reservoirs are not explicitly included which may affect the streamflow results particularly where there is significant storage capacity however using usgs observed streamflow as an upstream boundary condition for river segments implicitly incorporates the impacts of surface water management this model does not simulate the water demand and irrigation supply from surface water fmp can estimate unknown pumpage but this option was beyond the scope of this study a future study can include estimating irrigation pumpage for a better representation of water use in the united states further this would improve the estimated stream flow from irrigation runoff and stream flow delivery as irrigation as with any model there are improvements that can be implemented to give more realistic simulations but these improvements depend on data availability and the model s structural limitations hydraulic conductivity can be estimated from the available baseflow data or it can be calibrated to better estimate baseflow in addition the specific yield can be calibrated to better estimate seasonal fluctuations in groundwater levels the land surface simulation with the farm process can be improved by specifying multiple crops per grid cell this version of the model selected the dominant crop to be represented as the land use for each grid cell in addition we can include the historical land cover data change over time this will allow us to analyze the impact the human activities such as crops use for agriculture and urbanizing expansion and the impact of the natural land cover changes such as deforestation and the natural vegetation change on the hydrologic processes across the united states with this addition we can calculate the irrigation water supply and demand for each crop type and include the water irrigation from surface water and groundwater in conclusion the model can simulate the groundwater levels and surface water budgets well across the large scale region of the contiguous united states the results show high correlation with observational data tradeoffs were made between model realism and computational efficiency to realistically simulate the contiguous us while prioritizing the inclusions of the dominant hydrologic cycle dynamics the model has the capacity of simulating the evapotranspiration surface runoff infiltration groundwater pumping three dimensional groundwater fluxes interaction between surface water and groundwater and stream flow routing holistically on monthly time step across the large scale region of the united states declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgements the authors gratefully acknowledge the support of nsf water sustainability and climate grant 1360446 wsc category 3 collaborative america s water the changing landscape of risk competing demands and climate and the support of nsf division of mathematical sciences 1720114 they thank nathaniel chaney for sharing the polaris dataset any use of trade firm or product names is for descriptive purposes only and does not imply endorsement by the u s government supplementary materials supplementary material associated with this article can be found in the online version at doi 10 1016 j advwatres 2020 103682 appendix supplementary materials image application 1 image application 2 
441,the gravity recovery and climate experiment grace satellites provide unprecedented perspectives to hydrologists and geoscientists for observing and understanding the variation of terrestrial water storage tws at continental to global scales however there are few reliable datasets of past tws variations before grace observations were available pre 2002 to fill this gap we attempt to develop an approach to calibrate tws anomalies twsa data of past decades based on available grace solution and land surface model simulations and a case study was conducted at the nile river basin two ensemble learning algorithms the random forest rf and the extreme gradient boost xgb combined with a spatially moving window structure are used to build the reconstruction model respectively reconstructed twsa are validated against a precipitation evapotranspiration index as well as other grace based reconstructed twsa datasets results show that the xgb model performs slightly better than the rf model in reconstructing grace twsa data the twsa produced by the two ensemble learning algorithms are comparable and better than other examined reconstructed grace like datasets and are well correlation with original grace solution and past precipitation evapotranspiration series the profile soil moisture and groundwater storage show significant contributions to the rf and xgb model but their variable importance values present different spatial patterns in the rf and xgb model further experiments are expected to investigate the contribution of human induced factors to simulate terrestrial water storage dynamics especially in intensely managed basins rather than modifying the structure and inputs of land surface models this study provides an alternative way of improving the twsa estimations of global land surface models and extending time range of grace datasets the experiments are expected to promote and enrich the integration of physical and machine learning models for optimal simulationsin geoscience research keywords terrestrial water storage machine learning grace the nile river basin 1 introduction hydrological fluxes simulated by global models have been one of the most preferred data resources for studying climate changes and their impacts on water resources chang et al 2009 dai 2012 sahoo dirmeyer houser kafatos 2008 reliability of the simulated fluxes is undoubtedly critical for obtaining unbiased results and correct conclusions however discrepancies between model simulated fluxes and observations have increasingly been reported worldwide agutu et al 2017 gevaert miralles de jeu schellekens dolman 2018 jiménez et al 2011 l li et al 2018 reichle koster dong berg 2004 these discrepancies may lead to reliability of climate change evaluations bridget r scanlon et al 2018 because global models are developed on large physical basis with numerous sub models updating the models is complex and needs long term collaborative efforts from groups of scientists m rodell et al 2004a wood et al 2011 this is particularly true for hydrological flux models due to the intervention from human and absence of direct observations for large scale water storage wood et al 2011 it is acknowledged that satellite based remote sensing products are more direct and reliable than global models outputs and are increasingly used to assess and diagnose the models jin liang 2006 long longuevergne scanlon 2014 reichle 2005 wang et al 2015 data from remote sensing satellites such as the gravity recovery and climate experiment grace provide monitoring of monthly water storage changes save bettadpur tapley 2016 bridget r scanlon et al 2016 although not absolute quantities of water storage the data adds unprecedented perspectives for global hydrology liking a giant weighing scale in the sky grace provides a more direct estimation of water resource variabilities at continental to global scales than global models horizontal profiles of water storages subject to combinations of climatic and human impacts are all considered in the grace data therefore the grace data have been a reliable reference for assessing terrestrial water storage from models bridget r scanlon et al 2018 sun chen donges 2015 the terrestrial or total water storage tws is integration of water storage in canopy land surface water body soil moisture groundwater and snow variations of tws reflect the balance of water resources balance at large scales well comparison of the tws trends obtained from global surface models with the grace tws anomalies twsa have been conducted for multiple basins worldwide bridget r scanlon et al 2018 as well as some individual basins lv ma li zheng 2019 mo wu wang zhou 2016 notable differences were found in twsa trends between global models and grace satellites observations beyond the role as a reference for evaluating tws trends estimated by global surface models the grace data have been recently used to calibrate and adjust the twsa from the models additionally forced by long term climatic data global models produce simulations covering long term span therefore given by historical hydrology simulations those calibrated or adjusted models have potential to extend time span of grace twsa 2002 present back to the initial time of the models success stories were reported in the amazon river basin and southeast china etc becker et al 2011 humphrey gudmundsson seneviratne 2017 long shen et al 2014 nie zhang zhang guo ishwaran 2015 in amazon basin some studies claimed a linear or polynomial relationship between twsa from grace and the gldas models humphrey et al 2017 nie et al 2015 however the linear and polynomial regressions are only individual cases that do not apply in other basins especially those in arid zone or with intense human interventions over multiple basins attempts have been made to link climatic and hydrological variables to grace twsa by using machine learning algorithms for example an artificial neural networks ann model was used to link hydrological variable with grace twsa data to extend the twsa back to 1980s long shen et al 2014 as a matter of fact machine learning is increasingly used to make better prediction and deeper understanding of water cycle and land surface process in an era of big data ever enriched stream of geospatial data gives competitive advantages to machine learning over classical geoscientific models on extracting new patterns and insights and improving the prediction based on data driven approaches rather than amending or modifying classical physical models reichstein et al 2019 applications of machine learning in weather forecasting land cover mapping and soil moisture retrievals were successful ahmad kalra stephen 2010 bauer thorpe brunet 2015 rogan et al 2008 among those machine learning families the ensemble learning has been increasingly applied to solve multiple issues in earth system science and remote sensing due to their good performance and relative better interpretability abbaszadeh moradkhani zhan 2019 belgiu drăguţ 2016 the random forest rf and extreme gradient boost xgb are two of currently dominating ensemble learning algorithms fan et al 2018 hutengs vohland 2016 liang chen yang zhou shi 2019 based on tree structure they are more easily to be self explanatory moreover variable importance rankings can be identified by calculating frequencies and gains of each variable in nodes georganos et al 2018 hao zhan wang niu shakir 2015 this is an advantage that provides a tool to improve the interpretability of machine learning models on a basic concern what are the important features for predicting a target variable and how important they are this is especially significant concern for hydro system models this study attempts to develop long and consistent time series of tws variability the reconstruction concept here is to calibrate a land surface model s terrestrial water storage simulation by learning the matching patterns between the land surface model and the grace observations using ensemble learning algorithms e g rf xgb a case study was conducted in the river basin of nile the longest river on earth considering that the matching patterns may have spatial variations a spatially moving window structure was combined with the ensemble learning algorithms the structure of this paper is organized as follows first the nile river basin and the data sources are introduced second the concept of reconstruction model and the ensemble learning algorithms are described third the results are presented and analyzed and finally the discussion on the model and summary of this study are given 2 study area and data resources 2 1 the nile river basin the nile is the longest river on earth and has a drainage area of about 3 2 million km2 running 6 695 kilometers through 11 countries from south to north the river flows over 35 degrees of latitude traversing highly diverse landscapes and climatic zones the nile river basin nrb feeds over 257 million people accounting for more than half of the total population of the 11 countries that share the nile the nrb has very diverse ecosystems with a significant part classified as arid and semi arid these diverse ecosystems coupled with the diverse climatic zones have been used to determine the distribution of the population within the basin in this study the whole basin has been divided into four sub regions for analysis purpose fig 1 table 1 the b1 includes lake albert basin lake victoria basin and victoria nile basin and the main climate zones in b1 are tropical wet tropical monsoonal and tropical wet dry the b2 includes bahr el jebel and bahr el ghazal basins and the climate zones of b2 are tropical wet dry subtropical dry semiarid the b3 covers baro akobo sobat basin blue nile basin white nile basin and tezeke atbara basin and its climate zones include tropical wet dry subtropical dry arid desert and subtropical dry semiarid the b4 is main nile basin which is dominated by subtropical dry arid zone 2 2 data resources 2 2 1 the grace and gldas data the officially released monthly grace science data from the jet propulsion laboratory jpl was used in this study the tws products are obtained by using the mass concentration blocks mascons techniques the mascons techniques make the implementation of geophysical constraints which are referred as mascons the latest jpl mascons jpl m solution tellus 2018 watkins wiese yuan boening landerer 2015 used in this study is the rl06 at 1 2 0 5 degree resolution which are available at https podaac jpl nasa gov grace the dataset is provided as anomalies relative to the january 2004 december 2009 time mean baseline therefore the tws datasets from grace are referred as terrestrial water storage anomalies twsa in this study forced by the global meteorological forcing data set from princeton university sheffield goteti wood 2006 the global land data assimilation system gldas models provide optimal fields of land surface states and fluxes m rodell et al 2004b current gldas version 2 0 gldas 2 0 model simulations were initialized on january 1 1948 and extended through 2014 daily products from gldas 2 0 catchment model at spatial resolution of 0 25 0 25 were used in this study the simulation for terrestrial water storage tws includes surface soil moisture sms profile soil moisture smp root zone soil moisture smrz snow water storage snws canopy water storage cws and groundwater storage gws listed in table 2 the unit of these variables is converted to centimeter cm to being consistent with the grace solution 2 2 2 the grace rec datasets another grace based twsa reconstruction dataset was used for comparison with the results in this study the grace rec dataset includes several sub datasets that were reconstructed based on different meteorological forcing datasets humphrey gudmundsson 2019 the grace rec constructs tws changes on a water balance basis and then calibrates them by using the grace observations the released grace rec products are twsa data after removing the seasonal cycle i e deseasonalized twsa and the datasets are available at https doi org 10 6084 m9 figshare 7670849 in this study three monthly grace rec sub datasets based on the jpl m rl06 solution were used for comparison they are generated from three different meteorological forcing datasets respectively which are the european centre for medium range weatherforecasts ecmwf re analysis era5 the global soil wetness project phase 3 gswp3 and the multisource weighted ensemble precipitationdataset mswep combining multiple data sources thus the three grace rec datasets are referred as jpl m era and jpl m gswp and jpl m mswep in the following parts the three sub datasets are provided at the same spatial resolution 0 5 degree and different time spans the jpl m era and jpl m starts from 1979 through recent years while the jpl m gswp are provided over the period of 1901 2014 in this study these datasets covering the 1979 2013 period are used 2 2 3 a multi scalar drought index for validation purpose a multi scalar drought index dataset the standardized precipitation evapotranspiration index spei sergio m vicente serrano beguería lópez moreno 2010 s m vicente serrano beguería lópez moreno angulo kenawy 2010 is introduced to compare against the reconstructed grace like twsa differing from the well known palmer drought severity index pdsi the spei is calculated based on multiple time scales water balance e g 3 month 6 month 12 month water balance at different time scales reflects different drought wetness duration and onset for example short time scales are related to dry wet conditions on the surface and shallow soil depth and long time scales are mainly related to groundwater storage variations thus the spei could be used to identify different types of drought wetness the multi scalar spei dataset which were downloaded at https spei csic es spei database are used to test the past reconstructed twsa in this study 3 methodology 3 1 modelling terrestrial water storage anomalies 3 1 1 the catchment twsa for the catchment model the tws is calculated by summing up water storage from all the components 1 t w s c m s n w s c w s s m s s s m s p s m s r z g w s where snws is snow water storage cws is canopy water storage smss is surface soil moisture storage smsp is profile soil moisture storage smsrz is root zone soil moisture storage and gws is groundwater storage in catchment model snws cws sms and gws shallow unconfined aquifer are simulated and catchment tws is calculated by summing up these components to be comparable with grace twsa the tws should be processed in the same way as grace twsa subtracting averaged tws of january 2004 to december 2009 from original tws 2 t w s a c m t w s c m t w s c m where twsacm is the catchment twsa twscm is the catchment tws as is expressed in eq 1 and t w s c m is averaged twscm of january 2004 to december 2009 3 1 2 the linear regression model as is reviewed in the introduction section of this paper the twsas estimated from global models have been reported to be more uncertain than the grace based data if the relationship between the catchment twsa and grace twsa is approximate a linear relationship the catchment twsa can be calibrated by using a linear regression model considering the linear relationship could vary spatially and temporally the regression coefficients are spatially different and a time variable is considered thus the linear regression is expressed as follow 3 t w s a i j α 0 i j s n w s a i j α 1 i j c w s a i j α 2 i j s m a s i j α 3 i j s m a p i j α 4 i j s m a r z i j α 5 i j g w s a i j α 6 i j t β i j where twsa i j represents the grace twsa at the grid of location i j the snwsa i j cwsa i j smsa s i j smsa p i j smsa rz ij andgwsa i j are the anomalies relative to the baseline of 2004 2009 of snws cws smss smsp smsrz and gws from the catchment model at the grid of location i j t represents time variable expressed as month by 1 2 12 and α0 i j α1 i j α6 i j are the corresponding coefficients β i j is the constant value of the location i j 3 1 3 the ensemble learning model however the matching patterns between catchment model and grace observations might not follow the linear relationship since their mismatch is the mixed uncertainties of input data model structure and initial conditions therefore we assumed a model f in the form y f x i j to calibrate the catchment twsa against grace observations 4 t w s a i j f s n w s a i j c w s a i j s m s a s i j s m s a p i j s m s a r z i j g w s a i j t where twsa i j represents the grace twsa at the grid of location i j the snwsa i j cwsa i j smsa s i j smsa p i j smsa rz ij gwsa i j and t are same as the variable in the eq 3 to construct the model y f xi two ensemble learning algorithms the random forest rf breiman 2001 and the extreme gradient boost xgb chen guestrin 2016 are used respectively to learn the matching patterns the rf and xgb are the most representative algorithms for bagging rf and boosting xgb in the ensemble learning families altman krzywinski 2017 nielsen 2016 bagging is a way to decrease the variance in the prediction by generating multiple subsets from the original data for training breiman 1996 and boosting is an iterative technique that reduces the residuals of a prediction to correct errors of its predecessor schapire 2003 details of the learning process of the rf and the xgb are given in appendix these two algorithms both use the decision tree as the basic learner in a tree based model importance of each variable to the model can be quantified by calculating variables contribution to the tree nodes in this way the relative significance of each variable in the rf and xgb model can be evaluated and compared 3 2 a spatially moving window structure a spatially moving window smw structure is used to address the spatial variations of f x i j instead of simply including geolocations in the model the smw processing steps are described as follows 1 a 2 d moving window of w w grids rolls through the twsa gridswith size ofi j rows columns ata step of s see step 0 in fig 2 for each window k all the grids w w within the window are input into a local linear regression lr or ensemble learning model rf and xgb for training referred as lr k rf k or xgb k respectively 2 for lr k the ordinary least squares regression method is used to fit the coefficients and constant of the function eq 3 in window k all the grids in the window k w w grids are given the fitted coefficients and constant of eq 2 for rf k and xgb k the rf and xgb algorithm are used to fit the model in window k respectively all the grids in the window kare given the fitted rf k or xgb k step 1 in fig 2 the scores of the models at window kare evaluated based on the coefficient of determination r2 the r2ofrf k xgb k and lr k are referred as r f r k 2 x g b r k 2 and l r r k 2 respectively 3 in the next window k 1 the rf k 1 xgb k 1 and lr k 1 are fitted based on the same process in the former step the scores of the model in the window k 1is referred as r f r k 1 2 x g b r k 1 2 and l r r k 1 2 respectively and for the overlapped grids between window k and k 1 see red grids in step 0 in fig 2 if the new model s score r k 1 2 is higher than that of the prior window s r k 2 the models of these overlapped grids are replaced with the new model of window k 1 step 2 in fig 3 as a result the models at grids in each window can be obtained by the recursively updating step 3 in fig 3 4 for the rf and xgb the models produced by the smw structure aremodel matrix of i rows j columns and for the lr the model is represented by the regression coefficients and constant at each grid thus the model matrix and the gridded regression coefficients can be used to estimate past grace like twsa from catchment model tws simulations by applying the spatially moving window structure when training the models the variable importance values of the ensemble learning models rf and xgb as well as the linear regression coefficients of the linear models can be calculated grid by grid this provides an insight into how the variable importance of the models vary spatially for estimating the tws changes over the study area there are two parameters in the smw structure window size and step size we examined five combinations of window and step size for training the models table 3 besides two experimental groups were set up for testing the extrapolation performance of the presented models three temporal years at the start as well as the end of the entire period were set as validation dataset respectively table 4 3 3 time series decomposition a time series decomposition approach the seasonal trend decomposition using local regression stl was used to remove the seasonal cycle before analyzing the twsa time series the stl approach proposed by cleveland et al robert b cleveland cleveland mcrae terpenning 1990 has been increasingly reported to be a versatile and robust method of time series decomposition lu 2003 bridget r scanlon et al 2018 the local regression smoothing is the core idea behind the stl it fits a smoothed series x j to an input time series x j x tj where tj is a sequence of discrete sampling times the smoothed value at each point j is given by the value at time tj of a polynomial fitted to the sampled values of x over a window j q j q with decreasing weight assigned to points in this window as their distance from point j increases the stl consists of outer and inner loops with a sequence of smoothing operator local regression and generates three components from a time series r b cleveland cleveland 1990 5 s t o t a l s l o n g t e r m s s e a s o n a l s r e s i d u a l the long term signal is then detrended into linear and non linear trends by fitting a least squares linear regression and a cubic spline regression respectively the residuals reflect sub seasonal signal and noise details of stl decomposition approach can be found in related publications robert b cleveland et al 1990 lu 2003 the twsa trends as a result refer to the linear trends estimated from the long term deseasonalized twsa after stl analysis 3 4 measurement and leakage error to assess data uncertainties related to measurement and leakage error we implemented approaches similar to those described in bridget r scanlon et al 2018 the uncertainty is approximated by using the root mean square rms of the residuals which is obtained after removing the component signals including long term and seasonal using stl analysis eq 5 in addition to present a more comprehensive understanding of the data uncertainties the measurement and leakage errors from the gridded grace spherical harmonics sh solutions swenson 2012 provided by grace tellus were used for comparison purpose basin mean errors were calculated following landerer swenson 2012 6 e r r t o t e r r m e r 2 e r r l e r 2 7 e r r m e r l e r v a r 8 v a r i 1 n j 1 n w i w j c o v x i x j 9 c o v x i x j e i e j e x p d i j 2 2 d 0 2 10 d i j a π 180 l o n g i l o n g j c o s l a t i 2 l a t i l a t j 2 where errtot is the total error of a basin which is calculated by summing the measurement error errmer and leakage error errler in quadrature for the basin n is the number of grid cells in a basin iand j represent two different grid cells in a basin var is the measurement or leakage error variance of mean twsa of a basin w is the area weight at each grid cell in the basin and simplified to 1 n under the assumption of equal contribution from each grid cell to the basin average twsa cov is the covariance between two grid cells e is the measurement or leakage error of a grid cell which were obtained in the gain factors file from grace tellus website https grace jpl nasa gov data get data monthly mass grids land d i j is the distance between two grid cells d 0 is a decorrelation length scale i e 300 km for measurement error and 100 km for leakage error a is the radius of the earth 6371 km and long and lat are longitude and latitude of a grid cell 4 results and analysis 4 1 reproduced twsa from different algorithms the models were trained based on the dataset extracted from the training groups table 3 respectively data in the validation years were produced by the trained models figs 3 and 4 present the spatial patterns of the reproduced twsa in the nile river basin nrb in may 2004 g1 and july 2012 g2 as well as the grace twsa catchment twsa and the grace rec data because the reconstructed twsa data in the grace rec datasets are deseasonalized twsa the data shown in figs 3 and 4 are also deseasonalized by using the stl approach for comparison notable discrepancies can be detected between the grace twsa and catchment model for example the catchment model overestimates the decline of twsa in b1 and b2 relative to the grace observation in may 2004 fig 3 a b and underestimates the decline of twsa in b2 and b4 relative to the grace observation in july 2004 fig 4 a b in the case of grace rec dataset the spatial pattern of the mswep twsa figs 3 d and 4 d matches better with the grace observation than the era and gswp twsa the results produced by using the approaches presented in this study calibrate the catchment twsa specifically the rf and xgb twsa matches well with the grace observation and the biases between catchment twsa and grace twsa are adjusted the xgb twsa is closer to the grace twsa than the rf twsa through visual inspection the lr model performs poorer than the two ensemble learning models according to figs 3 and 4 in the case of different combinations of window and step size the results from the models with window size of 4 and step of 2 generally have better agreements with those with other parameter combinations the basin average twsa time series from different models as well as the grace twsa are displayed in fig 5 the time ranges of validation periods are highlighted with red panel background the raw twsa time series and the deseaonalized twsa time series are all presented because the twsa provided in the grace rec dataset are already deseasonlized the era gswp and mswep twsa are only displayed with deseasonlized twsa for comparison fig 5 b d f in general the models could well capture the seasonal twsa variations and trends according to fig 5 a c e after removing the seasonal cycle some differences between grace observations and the models could be revealed fig 5 b d f to quantify the correlations and differences the correlation coefficients r and root mean square error rmse between the deseasonalized grace twsa and the deseasonalized twsa from different models are calculated for the whole basin as well as sub basins and the results are presented in fig 6 for g1 and fig 7 for g2 both the grace rec and the models presented in this study have better performances than the catchment model with higher r values and lower rmse for the whole basin and sub basins the mswep twsa performs better against other two grcace rec datasets era and gswp the presented ensemble learning approaches rf and xgb in this study have comparable r values and lower rmse compared with the grace rec mswep dataset in the case of sub basins the ensemble learning approaches strongly outperform the mswep data especially in b4 figs 6 i j and 7 i j discrepancies between the ensemble learning models with different parameter combinations are also more significant in b4 than in other sub regions correlations decrease with the increasing of window and step size this tendency can be inspected from figs 6 i and 7 i and is also true in b2 and b3 for g2 fig 7 e g consequently the calibrated twsa by using the presented ensemble learning models outperform the catchment model tws simulation and have comparable or better performances with the grace rec mswep dataset in the examined validation groups the combination of window size of 4 and step size of 2 is better than other combinations examined in this study 4 2 reconstruction of long term twsa in light of above analysis the ensemble learning models combined with the moving window with window size of 4 and step size of 2 have the best performance thus the rf and xgb models were used to produce the twsa with integration use of spatially moving window w 4 and s 2 all the data during the 2003 2013 period were input for training the trained models were then applied to the catchment twsa simulations to generate grace consistent twsa back to 1979 table 5 summarizes the measurement and leakage errors for the csr sh solution and the rms of residuals of the grace jpl m rl06 solution as well as the reconstructed jpl m twsa by using the rf and xgb model respectively in general there are higher measurement errors in b1 because twsa has more seasonal varieties in this region the residuals from the stl analysis may contain higher variable sub seasonal signals the errors calculated from the csr sh solution are close to those of jpl m rl06 solution but it should be noted that both approaches may overestimate the uncertainties because csr sh solution has a different pre processing and a lower spatial resolution 1 1 and the residuals from stl analysis may still contain sub seasonal signals which was explicitly pointed out in previous researches reager et al 2016 bridget r scanlon et al 2018 besides measurement and leakage uncertainties do notcontribute to trend uncertainties reager et al 2016 bridget r scanlon et al 2018 therefore no additional correction was taken on the reconstructed grace mascon solutions in this study to address the connections between the reconstructed tws dynamics and climatic conditions the basin average reconstructed twsa deseasonalized in sub basins are shown in fig 8 as well as the standardized precipitation evapotranspiration index spei time series of 3 6 12 and 18 month scales the correlation coefficients between the twsa and spei time series at different scales in each sub basin are displayed in fig 9 the decadal reconstructed twsa well correlate with spei time series variations but correlation coefficients vary among sub regions generally close connections can be found between twsa and mid long spei time series in sub basin b1 b2 and b3 the correlations tend to increase with changes of spei scales and peak at 12 month scale in b1 at 8 month scale in b2 and b3 and at 15 month scale in b4 spatial patterns of the correlation coefficients at these three scales are presented in fig 10 the correlation of the rf and xgb twsa with the spei time series shows similar patterns with the jpl m mswep and the r value of the rf twsa is slightly higher than that of the xgb twsa in b1 b2 and b3 according fig 10 which is also can be detected from the comparison of twsa time series in fig 8 in b4 the gwsp and mswep have higher correlation coefficients with spei time series than the rf and xgb model the spei has the ability to quantify drought episodes because it calculates water balance at different time scales based on the relations between water balance of hydrology sub systems and climatic variations the spei can provide indications for dry wet conditions through different hydro systems the spei of short medium and long timescales address the water storage from shallow surface and subsurface soil to deep groundwater respectively sergio m vicente serrano et al 2010 s m vicente serrano et al 2010 this explains that the spei and twsa have higher correlations over longer time scales the twsa represents moisture variations from all hydrological components groundwater pumping and agricultural irrigation would affect the agreement between spei and twsa time series this is the case for b4 the main nile sub basin referred as b4 region in this study covering egypt and sudan has low annual precipitation average annual precipitation is 198 mm and high potential evapotranspiration annual average potential evapotranspiration is 2206 mm and is a heavily irrigated area fig 11 a presents the land cover map of africa 2016 from the european space agency esa esa 2017 fig 11 b shows the area equipped for irrigation with groundwater given as the percentage of cell area of 5 5 arcmin grids siebert et al 2010 the irrigation equipped crop area in the nile delta as is shown in fig 11 b accounts for majority of intensity equipped area in nrb according to fao 2011 agriculture dominates the water uses in the nrb accounting for more than 80 of water withdrawals and egypt has the highest cropping intensity cropped area divided by equipped area in the basin due to higher cropping intensity approximately 79 of the total cropped area under irrigated agriculture in the nrb lies in egypt an estimated 80 of the irrigation water abstraction in the nrb occurs in egypt followed by sudan about 17 of the total basin wide abstraction for irrigation fig 12 fao 2011 over rest part of the nile basin countries the croplands are mostly rainfed and there are no appreciable deficits in meeting the total annual irrigation requirements therefore the water storage changes in the b1 b2 b3 are more subject to the anomalies of rainfall and evapotranspiration and the water storage changes in b4 are highly impacted by irrigation withdrawals which is probably the major reason leading to the low correlation between twsa and spei series 4 3 model interpretation variable importance vi values provide possibilities of evaluating significance of each independent variable to the ensemble learning model significate spatial difference of the vi in the study area is not unexpected due to the spatial variation of the tws change patterns throughout the study area by combining the ensemble learning and the moving window approach variable importance can be provided on grid cell level and the spatial patterns of variable importance can be mapped fig 13 shows the spatial patterns of the vi values for the rf and xgb models and their regional statistics are presented as violet charts in fig 14 because the models with window size of 4 and step size of 2 have better performance than the models with other combinations only the models of w4 s2 are analyzed in this part in general the vi values have significant spatially varying patterns the smsap and gwsa dominate the variable importance in the rf model the hotspot areas in the smsap and gwsa importance maps fig 13 are consistent with the crop cover areas shown in fig 11 especially in b4 the gswa is the onlydominate factor in the rf model according to fig 14 d this is rational because soil moisture and groundwater are major components of the terrestrial water storage and are closely correlated with the changes of tws hirschi seneviratne schär 2006 pokhrel fan miguez macho yeh han 2013 matthew rodell velicogna famiglietti 2009 soni syed 2015 and agriculture activities have underlying impacts on the soil hydro system and groundwater d odorico porporato 2004 haddeland lettenmaier skaugen 2006 kendy zhang liu wang steenhuis 2004 rotiroti et al 2019 this is especially true for the heavily irrigation depending like b4 region as analysis above the surface soil moisture smas has few significance contributions to the model because it accounts for only a fraction of the terrestrial water and its changes are mainly related to surface moisture e g rainfall rather than the total water storage crow van den berg huffman pellarin 2011 pan peters lidard sale 2003 in the case of the xgb model although smsap and gwsa also have higher vi than other examined variables they have notable different spatial patterns with those of the rf model for example the smsap has comparable vi values with the gwsa in b4 and the time variable as is shown in figs 13 and 14 is more important to the xgb model than the rf model this could attribute to the different ensemble type of the two algorithms because they use the same decision tree model as the basic learner in the boosting based ensemble learning model i e xgb the basic learners recursively fit the residuals of their predecessors freund schapire 1996 friedman 2002 in this sense the variable importance rankings in the xgb model may indicate the variables importance contribution to the residual reduction rather than the target estimation value the variable importance is beneficial to explain the relative significance of the variables in the rf and xgb model however the vi values present different patterns due to their different ensemble strategies thus the vi estimation is far from a real contribution measure of variables to the target predictions and should be interpreted with cautions the lr based model gives the regression coefficients in each grid which are shown in fig 15 the coefficients of cwsa snwsa and smsas are in narrow range this is consistent with the variable importance patterns of the rf and xgb model the coefficients of smsap and gwsa are significantly negative around the lower stream of b4 indicating the catchment model smsap and gwsa simulations may fail to capture the declining tws in b4 relative to grace observations but it should be noted that the variables are anomalies therefore the positive negative regression coefficients of the variables do not indicate exactly their positive negative contributions to the twsa simulations 5 discussion and conclusion this study provides an approach to fill the mismatch of tws changes between the gldas model and grace observations for generating past scenario of grace like twsa the differences between gldas models and the grace observations are not unexpected because mixed uncertainties exist in the model structures parameters and inputs gonzalez miralles et al 2011 hartley macbean georgievski bontemps 2017 nakaegawa 2011 xia yang jackson stoffa sen 2004 although different parameters processing cap grids and measurement and leakage errors also give rise to uncertainties in the grace solutions f w landerer s swenson 2012 f w landerer s c swenson 2012 bridget r scanlon et al 2016 it is widely accepted that the grace observations are more direct and reliable solutions for inspecting changes of tws kumar et al 2016 b li et al 2019 tian renzullo van dijk tregoning walker 2019 zaitchik rodell reichle 2008 the primary aim of this study is attempting to link a gldas model s tws simulations to the grace solution by fitting their matching patterns by using ensemble learning algorithms the results can be interpreted as a calibrated gldas twsa based on the grace observations the presented approaches nicely reproduce spatial patterns and time series of the grace twsa and the results are comparable with another grace based reconstruction dataset garce rec and are consistent with the spei time series the rf and xgb models produced the twsa that match grace observations much better than the pure gldas born results this indicatesthat biases in gldas twsa have been filled by the presented models but it is obvious that human interventions are still not considered in the reconstruction models possible solutions may rely on the integration of global hydrology models ghms outputs of human water use and irrigation future work is expected on the comparison of modelling twsa with and without human interventions for evaluating the impacts from human activity the ensemble learning algorithms have been reported great performance in various earth system modelling applications catani lagomarsino segoni tofani 2013 keller evans 2019 o gorman dwyer 2018 however the tree based structure which is the basic structure of the two algorithms used in this study would limit value range of the predictions within the range of the training data sinha et al 2019 therefore extremely anomalies in tws could be ignored when backtracking the past status this is also a general issue with machine learning that the models become absolute once being trained and they are unable to predict a pattern that falls far beyond the scope of the input training data utilizing a machine learning model misses the physical basic of the terrestrial hydro system in this sense the reconstructed twsa should only be interpreted as one possible scenario of grace like twsa dataset that could enrich the grace reconstruction data and method families the variable importance is a meaningful way for inspecting the significance contribution of each variable to the ensemble learning models the combination of ensemble learning algorithms with spatially moving window structure provides visualizations of the spatial patterns of the variable importance values this is especially valuable to geoscientific applications because geographical and geophysical patterns always vary among different locations with diverse climate and landscapes but the variable importance should be interpreted with cautions since it is just a statistical relative ranking rather than the variables exact contributions the advancement in machine learning has increasingly improved our ability to model and predict the world we combine grace twsa with land surface model simulations by using machine learning in this study to improve the twsa estimations attempting to add new alternative perspectives for extending grace time range and calibrate tws simulations of global models results of this study are expected to provide possibilities of complementing and enriching land surface models with machine learning techniques data availability the datasets generated and analyzed during the current study are open access from mygeohub repository using link https mygeohub org resources 1468 author contributions w j l d and l y conceived and designed the experiments x z and w j performed the experiments w j analyzed the data and wrote the paper y l and x x edit the language c z j y and l y reviewed and revised the paper declaration of competing interest no potential conflict of interest was reported by the authors acknowledgement this study was jointly supported by the national natural science foundation of china china 41801362 41976190 the national postdoctoral program for innovative talents china bx20200100 the national earth system science data sharing infrastructure china 2005dka32300 the guangdong provincial science and technology program china 2018b030324001 the gdas s project of science and technology development china 2020gdasyl 20200104003 2016gdasrc 0211 2017gdascx 0601 2018gdascx 0101 0403 2019gdasyl 0502001 0301001 0302001 0501001 and 0401001 the key special project for introduced talents team of southern marine science and engineering guangdong laboratory guangzhou china gml2019zd0301 and the guangdong innovative and entrepreneurial research team program china 2016zt06d336 supplementary materials supplementary material associated with this article can be found in the online version at doi 10 1016 j advwatres 2020 103683 appendix supplementary materials image application 1 image application 2 
441,the gravity recovery and climate experiment grace satellites provide unprecedented perspectives to hydrologists and geoscientists for observing and understanding the variation of terrestrial water storage tws at continental to global scales however there are few reliable datasets of past tws variations before grace observations were available pre 2002 to fill this gap we attempt to develop an approach to calibrate tws anomalies twsa data of past decades based on available grace solution and land surface model simulations and a case study was conducted at the nile river basin two ensemble learning algorithms the random forest rf and the extreme gradient boost xgb combined with a spatially moving window structure are used to build the reconstruction model respectively reconstructed twsa are validated against a precipitation evapotranspiration index as well as other grace based reconstructed twsa datasets results show that the xgb model performs slightly better than the rf model in reconstructing grace twsa data the twsa produced by the two ensemble learning algorithms are comparable and better than other examined reconstructed grace like datasets and are well correlation with original grace solution and past precipitation evapotranspiration series the profile soil moisture and groundwater storage show significant contributions to the rf and xgb model but their variable importance values present different spatial patterns in the rf and xgb model further experiments are expected to investigate the contribution of human induced factors to simulate terrestrial water storage dynamics especially in intensely managed basins rather than modifying the structure and inputs of land surface models this study provides an alternative way of improving the twsa estimations of global land surface models and extending time range of grace datasets the experiments are expected to promote and enrich the integration of physical and machine learning models for optimal simulationsin geoscience research keywords terrestrial water storage machine learning grace the nile river basin 1 introduction hydrological fluxes simulated by global models have been one of the most preferred data resources for studying climate changes and their impacts on water resources chang et al 2009 dai 2012 sahoo dirmeyer houser kafatos 2008 reliability of the simulated fluxes is undoubtedly critical for obtaining unbiased results and correct conclusions however discrepancies between model simulated fluxes and observations have increasingly been reported worldwide agutu et al 2017 gevaert miralles de jeu schellekens dolman 2018 jiménez et al 2011 l li et al 2018 reichle koster dong berg 2004 these discrepancies may lead to reliability of climate change evaluations bridget r scanlon et al 2018 because global models are developed on large physical basis with numerous sub models updating the models is complex and needs long term collaborative efforts from groups of scientists m rodell et al 2004a wood et al 2011 this is particularly true for hydrological flux models due to the intervention from human and absence of direct observations for large scale water storage wood et al 2011 it is acknowledged that satellite based remote sensing products are more direct and reliable than global models outputs and are increasingly used to assess and diagnose the models jin liang 2006 long longuevergne scanlon 2014 reichle 2005 wang et al 2015 data from remote sensing satellites such as the gravity recovery and climate experiment grace provide monitoring of monthly water storage changes save bettadpur tapley 2016 bridget r scanlon et al 2016 although not absolute quantities of water storage the data adds unprecedented perspectives for global hydrology liking a giant weighing scale in the sky grace provides a more direct estimation of water resource variabilities at continental to global scales than global models horizontal profiles of water storages subject to combinations of climatic and human impacts are all considered in the grace data therefore the grace data have been a reliable reference for assessing terrestrial water storage from models bridget r scanlon et al 2018 sun chen donges 2015 the terrestrial or total water storage tws is integration of water storage in canopy land surface water body soil moisture groundwater and snow variations of tws reflect the balance of water resources balance at large scales well comparison of the tws trends obtained from global surface models with the grace tws anomalies twsa have been conducted for multiple basins worldwide bridget r scanlon et al 2018 as well as some individual basins lv ma li zheng 2019 mo wu wang zhou 2016 notable differences were found in twsa trends between global models and grace satellites observations beyond the role as a reference for evaluating tws trends estimated by global surface models the grace data have been recently used to calibrate and adjust the twsa from the models additionally forced by long term climatic data global models produce simulations covering long term span therefore given by historical hydrology simulations those calibrated or adjusted models have potential to extend time span of grace twsa 2002 present back to the initial time of the models success stories were reported in the amazon river basin and southeast china etc becker et al 2011 humphrey gudmundsson seneviratne 2017 long shen et al 2014 nie zhang zhang guo ishwaran 2015 in amazon basin some studies claimed a linear or polynomial relationship between twsa from grace and the gldas models humphrey et al 2017 nie et al 2015 however the linear and polynomial regressions are only individual cases that do not apply in other basins especially those in arid zone or with intense human interventions over multiple basins attempts have been made to link climatic and hydrological variables to grace twsa by using machine learning algorithms for example an artificial neural networks ann model was used to link hydrological variable with grace twsa data to extend the twsa back to 1980s long shen et al 2014 as a matter of fact machine learning is increasingly used to make better prediction and deeper understanding of water cycle and land surface process in an era of big data ever enriched stream of geospatial data gives competitive advantages to machine learning over classical geoscientific models on extracting new patterns and insights and improving the prediction based on data driven approaches rather than amending or modifying classical physical models reichstein et al 2019 applications of machine learning in weather forecasting land cover mapping and soil moisture retrievals were successful ahmad kalra stephen 2010 bauer thorpe brunet 2015 rogan et al 2008 among those machine learning families the ensemble learning has been increasingly applied to solve multiple issues in earth system science and remote sensing due to their good performance and relative better interpretability abbaszadeh moradkhani zhan 2019 belgiu drăguţ 2016 the random forest rf and extreme gradient boost xgb are two of currently dominating ensemble learning algorithms fan et al 2018 hutengs vohland 2016 liang chen yang zhou shi 2019 based on tree structure they are more easily to be self explanatory moreover variable importance rankings can be identified by calculating frequencies and gains of each variable in nodes georganos et al 2018 hao zhan wang niu shakir 2015 this is an advantage that provides a tool to improve the interpretability of machine learning models on a basic concern what are the important features for predicting a target variable and how important they are this is especially significant concern for hydro system models this study attempts to develop long and consistent time series of tws variability the reconstruction concept here is to calibrate a land surface model s terrestrial water storage simulation by learning the matching patterns between the land surface model and the grace observations using ensemble learning algorithms e g rf xgb a case study was conducted in the river basin of nile the longest river on earth considering that the matching patterns may have spatial variations a spatially moving window structure was combined with the ensemble learning algorithms the structure of this paper is organized as follows first the nile river basin and the data sources are introduced second the concept of reconstruction model and the ensemble learning algorithms are described third the results are presented and analyzed and finally the discussion on the model and summary of this study are given 2 study area and data resources 2 1 the nile river basin the nile is the longest river on earth and has a drainage area of about 3 2 million km2 running 6 695 kilometers through 11 countries from south to north the river flows over 35 degrees of latitude traversing highly diverse landscapes and climatic zones the nile river basin nrb feeds over 257 million people accounting for more than half of the total population of the 11 countries that share the nile the nrb has very diverse ecosystems with a significant part classified as arid and semi arid these diverse ecosystems coupled with the diverse climatic zones have been used to determine the distribution of the population within the basin in this study the whole basin has been divided into four sub regions for analysis purpose fig 1 table 1 the b1 includes lake albert basin lake victoria basin and victoria nile basin and the main climate zones in b1 are tropical wet tropical monsoonal and tropical wet dry the b2 includes bahr el jebel and bahr el ghazal basins and the climate zones of b2 are tropical wet dry subtropical dry semiarid the b3 covers baro akobo sobat basin blue nile basin white nile basin and tezeke atbara basin and its climate zones include tropical wet dry subtropical dry arid desert and subtropical dry semiarid the b4 is main nile basin which is dominated by subtropical dry arid zone 2 2 data resources 2 2 1 the grace and gldas data the officially released monthly grace science data from the jet propulsion laboratory jpl was used in this study the tws products are obtained by using the mass concentration blocks mascons techniques the mascons techniques make the implementation of geophysical constraints which are referred as mascons the latest jpl mascons jpl m solution tellus 2018 watkins wiese yuan boening landerer 2015 used in this study is the rl06 at 1 2 0 5 degree resolution which are available at https podaac jpl nasa gov grace the dataset is provided as anomalies relative to the january 2004 december 2009 time mean baseline therefore the tws datasets from grace are referred as terrestrial water storage anomalies twsa in this study forced by the global meteorological forcing data set from princeton university sheffield goteti wood 2006 the global land data assimilation system gldas models provide optimal fields of land surface states and fluxes m rodell et al 2004b current gldas version 2 0 gldas 2 0 model simulations were initialized on january 1 1948 and extended through 2014 daily products from gldas 2 0 catchment model at spatial resolution of 0 25 0 25 were used in this study the simulation for terrestrial water storage tws includes surface soil moisture sms profile soil moisture smp root zone soil moisture smrz snow water storage snws canopy water storage cws and groundwater storage gws listed in table 2 the unit of these variables is converted to centimeter cm to being consistent with the grace solution 2 2 2 the grace rec datasets another grace based twsa reconstruction dataset was used for comparison with the results in this study the grace rec dataset includes several sub datasets that were reconstructed based on different meteorological forcing datasets humphrey gudmundsson 2019 the grace rec constructs tws changes on a water balance basis and then calibrates them by using the grace observations the released grace rec products are twsa data after removing the seasonal cycle i e deseasonalized twsa and the datasets are available at https doi org 10 6084 m9 figshare 7670849 in this study three monthly grace rec sub datasets based on the jpl m rl06 solution were used for comparison they are generated from three different meteorological forcing datasets respectively which are the european centre for medium range weatherforecasts ecmwf re analysis era5 the global soil wetness project phase 3 gswp3 and the multisource weighted ensemble precipitationdataset mswep combining multiple data sources thus the three grace rec datasets are referred as jpl m era and jpl m gswp and jpl m mswep in the following parts the three sub datasets are provided at the same spatial resolution 0 5 degree and different time spans the jpl m era and jpl m starts from 1979 through recent years while the jpl m gswp are provided over the period of 1901 2014 in this study these datasets covering the 1979 2013 period are used 2 2 3 a multi scalar drought index for validation purpose a multi scalar drought index dataset the standardized precipitation evapotranspiration index spei sergio m vicente serrano beguería lópez moreno 2010 s m vicente serrano beguería lópez moreno angulo kenawy 2010 is introduced to compare against the reconstructed grace like twsa differing from the well known palmer drought severity index pdsi the spei is calculated based on multiple time scales water balance e g 3 month 6 month 12 month water balance at different time scales reflects different drought wetness duration and onset for example short time scales are related to dry wet conditions on the surface and shallow soil depth and long time scales are mainly related to groundwater storage variations thus the spei could be used to identify different types of drought wetness the multi scalar spei dataset which were downloaded at https spei csic es spei database are used to test the past reconstructed twsa in this study 3 methodology 3 1 modelling terrestrial water storage anomalies 3 1 1 the catchment twsa for the catchment model the tws is calculated by summing up water storage from all the components 1 t w s c m s n w s c w s s m s s s m s p s m s r z g w s where snws is snow water storage cws is canopy water storage smss is surface soil moisture storage smsp is profile soil moisture storage smsrz is root zone soil moisture storage and gws is groundwater storage in catchment model snws cws sms and gws shallow unconfined aquifer are simulated and catchment tws is calculated by summing up these components to be comparable with grace twsa the tws should be processed in the same way as grace twsa subtracting averaged tws of january 2004 to december 2009 from original tws 2 t w s a c m t w s c m t w s c m where twsacm is the catchment twsa twscm is the catchment tws as is expressed in eq 1 and t w s c m is averaged twscm of january 2004 to december 2009 3 1 2 the linear regression model as is reviewed in the introduction section of this paper the twsas estimated from global models have been reported to be more uncertain than the grace based data if the relationship between the catchment twsa and grace twsa is approximate a linear relationship the catchment twsa can be calibrated by using a linear regression model considering the linear relationship could vary spatially and temporally the regression coefficients are spatially different and a time variable is considered thus the linear regression is expressed as follow 3 t w s a i j α 0 i j s n w s a i j α 1 i j c w s a i j α 2 i j s m a s i j α 3 i j s m a p i j α 4 i j s m a r z i j α 5 i j g w s a i j α 6 i j t β i j where twsa i j represents the grace twsa at the grid of location i j the snwsa i j cwsa i j smsa s i j smsa p i j smsa rz ij andgwsa i j are the anomalies relative to the baseline of 2004 2009 of snws cws smss smsp smsrz and gws from the catchment model at the grid of location i j t represents time variable expressed as month by 1 2 12 and α0 i j α1 i j α6 i j are the corresponding coefficients β i j is the constant value of the location i j 3 1 3 the ensemble learning model however the matching patterns between catchment model and grace observations might not follow the linear relationship since their mismatch is the mixed uncertainties of input data model structure and initial conditions therefore we assumed a model f in the form y f x i j to calibrate the catchment twsa against grace observations 4 t w s a i j f s n w s a i j c w s a i j s m s a s i j s m s a p i j s m s a r z i j g w s a i j t where twsa i j represents the grace twsa at the grid of location i j the snwsa i j cwsa i j smsa s i j smsa p i j smsa rz ij gwsa i j and t are same as the variable in the eq 3 to construct the model y f xi two ensemble learning algorithms the random forest rf breiman 2001 and the extreme gradient boost xgb chen guestrin 2016 are used respectively to learn the matching patterns the rf and xgb are the most representative algorithms for bagging rf and boosting xgb in the ensemble learning families altman krzywinski 2017 nielsen 2016 bagging is a way to decrease the variance in the prediction by generating multiple subsets from the original data for training breiman 1996 and boosting is an iterative technique that reduces the residuals of a prediction to correct errors of its predecessor schapire 2003 details of the learning process of the rf and the xgb are given in appendix these two algorithms both use the decision tree as the basic learner in a tree based model importance of each variable to the model can be quantified by calculating variables contribution to the tree nodes in this way the relative significance of each variable in the rf and xgb model can be evaluated and compared 3 2 a spatially moving window structure a spatially moving window smw structure is used to address the spatial variations of f x i j instead of simply including geolocations in the model the smw processing steps are described as follows 1 a 2 d moving window of w w grids rolls through the twsa gridswith size ofi j rows columns ata step of s see step 0 in fig 2 for each window k all the grids w w within the window are input into a local linear regression lr or ensemble learning model rf and xgb for training referred as lr k rf k or xgb k respectively 2 for lr k the ordinary least squares regression method is used to fit the coefficients and constant of the function eq 3 in window k all the grids in the window k w w grids are given the fitted coefficients and constant of eq 2 for rf k and xgb k the rf and xgb algorithm are used to fit the model in window k respectively all the grids in the window kare given the fitted rf k or xgb k step 1 in fig 2 the scores of the models at window kare evaluated based on the coefficient of determination r2 the r2ofrf k xgb k and lr k are referred as r f r k 2 x g b r k 2 and l r r k 2 respectively 3 in the next window k 1 the rf k 1 xgb k 1 and lr k 1 are fitted based on the same process in the former step the scores of the model in the window k 1is referred as r f r k 1 2 x g b r k 1 2 and l r r k 1 2 respectively and for the overlapped grids between window k and k 1 see red grids in step 0 in fig 2 if the new model s score r k 1 2 is higher than that of the prior window s r k 2 the models of these overlapped grids are replaced with the new model of window k 1 step 2 in fig 3 as a result the models at grids in each window can be obtained by the recursively updating step 3 in fig 3 4 for the rf and xgb the models produced by the smw structure aremodel matrix of i rows j columns and for the lr the model is represented by the regression coefficients and constant at each grid thus the model matrix and the gridded regression coefficients can be used to estimate past grace like twsa from catchment model tws simulations by applying the spatially moving window structure when training the models the variable importance values of the ensemble learning models rf and xgb as well as the linear regression coefficients of the linear models can be calculated grid by grid this provides an insight into how the variable importance of the models vary spatially for estimating the tws changes over the study area there are two parameters in the smw structure window size and step size we examined five combinations of window and step size for training the models table 3 besides two experimental groups were set up for testing the extrapolation performance of the presented models three temporal years at the start as well as the end of the entire period were set as validation dataset respectively table 4 3 3 time series decomposition a time series decomposition approach the seasonal trend decomposition using local regression stl was used to remove the seasonal cycle before analyzing the twsa time series the stl approach proposed by cleveland et al robert b cleveland cleveland mcrae terpenning 1990 has been increasingly reported to be a versatile and robust method of time series decomposition lu 2003 bridget r scanlon et al 2018 the local regression smoothing is the core idea behind the stl it fits a smoothed series x j to an input time series x j x tj where tj is a sequence of discrete sampling times the smoothed value at each point j is given by the value at time tj of a polynomial fitted to the sampled values of x over a window j q j q with decreasing weight assigned to points in this window as their distance from point j increases the stl consists of outer and inner loops with a sequence of smoothing operator local regression and generates three components from a time series r b cleveland cleveland 1990 5 s t o t a l s l o n g t e r m s s e a s o n a l s r e s i d u a l the long term signal is then detrended into linear and non linear trends by fitting a least squares linear regression and a cubic spline regression respectively the residuals reflect sub seasonal signal and noise details of stl decomposition approach can be found in related publications robert b cleveland et al 1990 lu 2003 the twsa trends as a result refer to the linear trends estimated from the long term deseasonalized twsa after stl analysis 3 4 measurement and leakage error to assess data uncertainties related to measurement and leakage error we implemented approaches similar to those described in bridget r scanlon et al 2018 the uncertainty is approximated by using the root mean square rms of the residuals which is obtained after removing the component signals including long term and seasonal using stl analysis eq 5 in addition to present a more comprehensive understanding of the data uncertainties the measurement and leakage errors from the gridded grace spherical harmonics sh solutions swenson 2012 provided by grace tellus were used for comparison purpose basin mean errors were calculated following landerer swenson 2012 6 e r r t o t e r r m e r 2 e r r l e r 2 7 e r r m e r l e r v a r 8 v a r i 1 n j 1 n w i w j c o v x i x j 9 c o v x i x j e i e j e x p d i j 2 2 d 0 2 10 d i j a π 180 l o n g i l o n g j c o s l a t i 2 l a t i l a t j 2 where errtot is the total error of a basin which is calculated by summing the measurement error errmer and leakage error errler in quadrature for the basin n is the number of grid cells in a basin iand j represent two different grid cells in a basin var is the measurement or leakage error variance of mean twsa of a basin w is the area weight at each grid cell in the basin and simplified to 1 n under the assumption of equal contribution from each grid cell to the basin average twsa cov is the covariance between two grid cells e is the measurement or leakage error of a grid cell which were obtained in the gain factors file from grace tellus website https grace jpl nasa gov data get data monthly mass grids land d i j is the distance between two grid cells d 0 is a decorrelation length scale i e 300 km for measurement error and 100 km for leakage error a is the radius of the earth 6371 km and long and lat are longitude and latitude of a grid cell 4 results and analysis 4 1 reproduced twsa from different algorithms the models were trained based on the dataset extracted from the training groups table 3 respectively data in the validation years were produced by the trained models figs 3 and 4 present the spatial patterns of the reproduced twsa in the nile river basin nrb in may 2004 g1 and july 2012 g2 as well as the grace twsa catchment twsa and the grace rec data because the reconstructed twsa data in the grace rec datasets are deseasonalized twsa the data shown in figs 3 and 4 are also deseasonalized by using the stl approach for comparison notable discrepancies can be detected between the grace twsa and catchment model for example the catchment model overestimates the decline of twsa in b1 and b2 relative to the grace observation in may 2004 fig 3 a b and underestimates the decline of twsa in b2 and b4 relative to the grace observation in july 2004 fig 4 a b in the case of grace rec dataset the spatial pattern of the mswep twsa figs 3 d and 4 d matches better with the grace observation than the era and gswp twsa the results produced by using the approaches presented in this study calibrate the catchment twsa specifically the rf and xgb twsa matches well with the grace observation and the biases between catchment twsa and grace twsa are adjusted the xgb twsa is closer to the grace twsa than the rf twsa through visual inspection the lr model performs poorer than the two ensemble learning models according to figs 3 and 4 in the case of different combinations of window and step size the results from the models with window size of 4 and step of 2 generally have better agreements with those with other parameter combinations the basin average twsa time series from different models as well as the grace twsa are displayed in fig 5 the time ranges of validation periods are highlighted with red panel background the raw twsa time series and the deseaonalized twsa time series are all presented because the twsa provided in the grace rec dataset are already deseasonlized the era gswp and mswep twsa are only displayed with deseasonlized twsa for comparison fig 5 b d f in general the models could well capture the seasonal twsa variations and trends according to fig 5 a c e after removing the seasonal cycle some differences between grace observations and the models could be revealed fig 5 b d f to quantify the correlations and differences the correlation coefficients r and root mean square error rmse between the deseasonalized grace twsa and the deseasonalized twsa from different models are calculated for the whole basin as well as sub basins and the results are presented in fig 6 for g1 and fig 7 for g2 both the grace rec and the models presented in this study have better performances than the catchment model with higher r values and lower rmse for the whole basin and sub basins the mswep twsa performs better against other two grcace rec datasets era and gswp the presented ensemble learning approaches rf and xgb in this study have comparable r values and lower rmse compared with the grace rec mswep dataset in the case of sub basins the ensemble learning approaches strongly outperform the mswep data especially in b4 figs 6 i j and 7 i j discrepancies between the ensemble learning models with different parameter combinations are also more significant in b4 than in other sub regions correlations decrease with the increasing of window and step size this tendency can be inspected from figs 6 i and 7 i and is also true in b2 and b3 for g2 fig 7 e g consequently the calibrated twsa by using the presented ensemble learning models outperform the catchment model tws simulation and have comparable or better performances with the grace rec mswep dataset in the examined validation groups the combination of window size of 4 and step size of 2 is better than other combinations examined in this study 4 2 reconstruction of long term twsa in light of above analysis the ensemble learning models combined with the moving window with window size of 4 and step size of 2 have the best performance thus the rf and xgb models were used to produce the twsa with integration use of spatially moving window w 4 and s 2 all the data during the 2003 2013 period were input for training the trained models were then applied to the catchment twsa simulations to generate grace consistent twsa back to 1979 table 5 summarizes the measurement and leakage errors for the csr sh solution and the rms of residuals of the grace jpl m rl06 solution as well as the reconstructed jpl m twsa by using the rf and xgb model respectively in general there are higher measurement errors in b1 because twsa has more seasonal varieties in this region the residuals from the stl analysis may contain higher variable sub seasonal signals the errors calculated from the csr sh solution are close to those of jpl m rl06 solution but it should be noted that both approaches may overestimate the uncertainties because csr sh solution has a different pre processing and a lower spatial resolution 1 1 and the residuals from stl analysis may still contain sub seasonal signals which was explicitly pointed out in previous researches reager et al 2016 bridget r scanlon et al 2018 besides measurement and leakage uncertainties do notcontribute to trend uncertainties reager et al 2016 bridget r scanlon et al 2018 therefore no additional correction was taken on the reconstructed grace mascon solutions in this study to address the connections between the reconstructed tws dynamics and climatic conditions the basin average reconstructed twsa deseasonalized in sub basins are shown in fig 8 as well as the standardized precipitation evapotranspiration index spei time series of 3 6 12 and 18 month scales the correlation coefficients between the twsa and spei time series at different scales in each sub basin are displayed in fig 9 the decadal reconstructed twsa well correlate with spei time series variations but correlation coefficients vary among sub regions generally close connections can be found between twsa and mid long spei time series in sub basin b1 b2 and b3 the correlations tend to increase with changes of spei scales and peak at 12 month scale in b1 at 8 month scale in b2 and b3 and at 15 month scale in b4 spatial patterns of the correlation coefficients at these three scales are presented in fig 10 the correlation of the rf and xgb twsa with the spei time series shows similar patterns with the jpl m mswep and the r value of the rf twsa is slightly higher than that of the xgb twsa in b1 b2 and b3 according fig 10 which is also can be detected from the comparison of twsa time series in fig 8 in b4 the gwsp and mswep have higher correlation coefficients with spei time series than the rf and xgb model the spei has the ability to quantify drought episodes because it calculates water balance at different time scales based on the relations between water balance of hydrology sub systems and climatic variations the spei can provide indications for dry wet conditions through different hydro systems the spei of short medium and long timescales address the water storage from shallow surface and subsurface soil to deep groundwater respectively sergio m vicente serrano et al 2010 s m vicente serrano et al 2010 this explains that the spei and twsa have higher correlations over longer time scales the twsa represents moisture variations from all hydrological components groundwater pumping and agricultural irrigation would affect the agreement between spei and twsa time series this is the case for b4 the main nile sub basin referred as b4 region in this study covering egypt and sudan has low annual precipitation average annual precipitation is 198 mm and high potential evapotranspiration annual average potential evapotranspiration is 2206 mm and is a heavily irrigated area fig 11 a presents the land cover map of africa 2016 from the european space agency esa esa 2017 fig 11 b shows the area equipped for irrigation with groundwater given as the percentage of cell area of 5 5 arcmin grids siebert et al 2010 the irrigation equipped crop area in the nile delta as is shown in fig 11 b accounts for majority of intensity equipped area in nrb according to fao 2011 agriculture dominates the water uses in the nrb accounting for more than 80 of water withdrawals and egypt has the highest cropping intensity cropped area divided by equipped area in the basin due to higher cropping intensity approximately 79 of the total cropped area under irrigated agriculture in the nrb lies in egypt an estimated 80 of the irrigation water abstraction in the nrb occurs in egypt followed by sudan about 17 of the total basin wide abstraction for irrigation fig 12 fao 2011 over rest part of the nile basin countries the croplands are mostly rainfed and there are no appreciable deficits in meeting the total annual irrigation requirements therefore the water storage changes in the b1 b2 b3 are more subject to the anomalies of rainfall and evapotranspiration and the water storage changes in b4 are highly impacted by irrigation withdrawals which is probably the major reason leading to the low correlation between twsa and spei series 4 3 model interpretation variable importance vi values provide possibilities of evaluating significance of each independent variable to the ensemble learning model significate spatial difference of the vi in the study area is not unexpected due to the spatial variation of the tws change patterns throughout the study area by combining the ensemble learning and the moving window approach variable importance can be provided on grid cell level and the spatial patterns of variable importance can be mapped fig 13 shows the spatial patterns of the vi values for the rf and xgb models and their regional statistics are presented as violet charts in fig 14 because the models with window size of 4 and step size of 2 have better performance than the models with other combinations only the models of w4 s2 are analyzed in this part in general the vi values have significant spatially varying patterns the smsap and gwsa dominate the variable importance in the rf model the hotspot areas in the smsap and gwsa importance maps fig 13 are consistent with the crop cover areas shown in fig 11 especially in b4 the gswa is the onlydominate factor in the rf model according to fig 14 d this is rational because soil moisture and groundwater are major components of the terrestrial water storage and are closely correlated with the changes of tws hirschi seneviratne schär 2006 pokhrel fan miguez macho yeh han 2013 matthew rodell velicogna famiglietti 2009 soni syed 2015 and agriculture activities have underlying impacts on the soil hydro system and groundwater d odorico porporato 2004 haddeland lettenmaier skaugen 2006 kendy zhang liu wang steenhuis 2004 rotiroti et al 2019 this is especially true for the heavily irrigation depending like b4 region as analysis above the surface soil moisture smas has few significance contributions to the model because it accounts for only a fraction of the terrestrial water and its changes are mainly related to surface moisture e g rainfall rather than the total water storage crow van den berg huffman pellarin 2011 pan peters lidard sale 2003 in the case of the xgb model although smsap and gwsa also have higher vi than other examined variables they have notable different spatial patterns with those of the rf model for example the smsap has comparable vi values with the gwsa in b4 and the time variable as is shown in figs 13 and 14 is more important to the xgb model than the rf model this could attribute to the different ensemble type of the two algorithms because they use the same decision tree model as the basic learner in the boosting based ensemble learning model i e xgb the basic learners recursively fit the residuals of their predecessors freund schapire 1996 friedman 2002 in this sense the variable importance rankings in the xgb model may indicate the variables importance contribution to the residual reduction rather than the target estimation value the variable importance is beneficial to explain the relative significance of the variables in the rf and xgb model however the vi values present different patterns due to their different ensemble strategies thus the vi estimation is far from a real contribution measure of variables to the target predictions and should be interpreted with cautions the lr based model gives the regression coefficients in each grid which are shown in fig 15 the coefficients of cwsa snwsa and smsas are in narrow range this is consistent with the variable importance patterns of the rf and xgb model the coefficients of smsap and gwsa are significantly negative around the lower stream of b4 indicating the catchment model smsap and gwsa simulations may fail to capture the declining tws in b4 relative to grace observations but it should be noted that the variables are anomalies therefore the positive negative regression coefficients of the variables do not indicate exactly their positive negative contributions to the twsa simulations 5 discussion and conclusion this study provides an approach to fill the mismatch of tws changes between the gldas model and grace observations for generating past scenario of grace like twsa the differences between gldas models and the grace observations are not unexpected because mixed uncertainties exist in the model structures parameters and inputs gonzalez miralles et al 2011 hartley macbean georgievski bontemps 2017 nakaegawa 2011 xia yang jackson stoffa sen 2004 although different parameters processing cap grids and measurement and leakage errors also give rise to uncertainties in the grace solutions f w landerer s swenson 2012 f w landerer s c swenson 2012 bridget r scanlon et al 2016 it is widely accepted that the grace observations are more direct and reliable solutions for inspecting changes of tws kumar et al 2016 b li et al 2019 tian renzullo van dijk tregoning walker 2019 zaitchik rodell reichle 2008 the primary aim of this study is attempting to link a gldas model s tws simulations to the grace solution by fitting their matching patterns by using ensemble learning algorithms the results can be interpreted as a calibrated gldas twsa based on the grace observations the presented approaches nicely reproduce spatial patterns and time series of the grace twsa and the results are comparable with another grace based reconstruction dataset garce rec and are consistent with the spei time series the rf and xgb models produced the twsa that match grace observations much better than the pure gldas born results this indicatesthat biases in gldas twsa have been filled by the presented models but it is obvious that human interventions are still not considered in the reconstruction models possible solutions may rely on the integration of global hydrology models ghms outputs of human water use and irrigation future work is expected on the comparison of modelling twsa with and without human interventions for evaluating the impacts from human activity the ensemble learning algorithms have been reported great performance in various earth system modelling applications catani lagomarsino segoni tofani 2013 keller evans 2019 o gorman dwyer 2018 however the tree based structure which is the basic structure of the two algorithms used in this study would limit value range of the predictions within the range of the training data sinha et al 2019 therefore extremely anomalies in tws could be ignored when backtracking the past status this is also a general issue with machine learning that the models become absolute once being trained and they are unable to predict a pattern that falls far beyond the scope of the input training data utilizing a machine learning model misses the physical basic of the terrestrial hydro system in this sense the reconstructed twsa should only be interpreted as one possible scenario of grace like twsa dataset that could enrich the grace reconstruction data and method families the variable importance is a meaningful way for inspecting the significance contribution of each variable to the ensemble learning models the combination of ensemble learning algorithms with spatially moving window structure provides visualizations of the spatial patterns of the variable importance values this is especially valuable to geoscientific applications because geographical and geophysical patterns always vary among different locations with diverse climate and landscapes but the variable importance should be interpreted with cautions since it is just a statistical relative ranking rather than the variables exact contributions the advancement in machine learning has increasingly improved our ability to model and predict the world we combine grace twsa with land surface model simulations by using machine learning in this study to improve the twsa estimations attempting to add new alternative perspectives for extending grace time range and calibrate tws simulations of global models results of this study are expected to provide possibilities of complementing and enriching land surface models with machine learning techniques data availability the datasets generated and analyzed during the current study are open access from mygeohub repository using link https mygeohub org resources 1468 author contributions w j l d and l y conceived and designed the experiments x z and w j performed the experiments w j analyzed the data and wrote the paper y l and x x edit the language c z j y and l y reviewed and revised the paper declaration of competing interest no potential conflict of interest was reported by the authors acknowledgement this study was jointly supported by the national natural science foundation of china china 41801362 41976190 the national postdoctoral program for innovative talents china bx20200100 the national earth system science data sharing infrastructure china 2005dka32300 the guangdong provincial science and technology program china 2018b030324001 the gdas s project of science and technology development china 2020gdasyl 20200104003 2016gdasrc 0211 2017gdascx 0601 2018gdascx 0101 0403 2019gdasyl 0502001 0301001 0302001 0501001 and 0401001 the key special project for introduced talents team of southern marine science and engineering guangdong laboratory guangzhou china gml2019zd0301 and the guangdong innovative and entrepreneurial research team program china 2016zt06d336 supplementary materials supplementary material associated with this article can be found in the online version at doi 10 1016 j advwatres 2020 103683 appendix supplementary materials image application 1 image application 2 
442,it has been observed in both laboratory and field studies that unfrozen soil moisture content is hysteretic between freezing and thawing conditions while a few explanations have been provided for the causes of this hysteresis there is no general agreement in the literature on underlying causal mechanisms in this study we use pore scale simulations to investigate the role that contact angle hysteresis during freezing and thawing conditions may play in the observed differences in soil moisture content during freezing and thawing conditions we also use these pore scale simulations to better assess the similarities between freezing and water drainage processes in pore space as such realistic assessments are very limited in the literature specifically we use 3d images of natural sand packs and synthetic silicates to generate pore scale model domains and to simulate water drainage and water freezing in the soil pore space the simulated water drainage curve and relative permeability saturation relations for the sand packs agrees well with measured data available in the literature for sandy soils the simulated soil freezing curves were successfully converted to simulated water drainage curve confirming conclusions of previous studies on coarse granular soils water freezing simulations using different contact angles for freezing water receding and thawing water advancing showed that the hysteresis in soil freezing curves could be driven by a hysteresis in the contact angle of water ice interface at the pore wall i e grain surface in addition simulations of water drainage in partially frozen soils revealed that soil freezing enhances liquid water retention in pore space due to reduction of mean active pore radius and increased frequency of pore corners which agrees with the observations of published studies in laboratory and field conditions graphical abstract image graphical abstract keywords pore scale modelling soil freezing freezing hysteresis relative permeability water ice equilibrium 1 introduction shallow soil layer freezing and thawing play important roles in the annual hydrologic cycle of systems in cold regions because the degree to which soil freezes determines the infiltration rate of precipitated water or snowmelt and thus affects the partitioning of water between surface runoff and infiltration hayashi 2013 understanding the fundamental processes governing the freeze thaw dynamics in near surface soils and its impact on soils hydraulic and transport properties are important for both hydrological and hydrogeological assessments including assessment of engineering designs forecasting the migration of nutrients contaminant leaching through frozen soil layers and appropriately parameterizing soil freeze thaw relationships for fully integrated surface water and groundwater models such as hydrogeosphere aquanty 2019 additionally understanding the details of these processes at the pore scale will facilitate the development of upscaling methodologies such that soil freezing processes can be effectively represented in local to large scale numerical models e g clausnitzer and mirnyy 2016 grenier et al 2018 berg and sudicky 2019 langford et al 2019 while several fundamental studies have been published on soil freezing processes and the hydraulic properties of frozen soils e g williams 1964 koopmans and miller 1966 black and tice 1989 spaans and baker 1996 andersland et al 1996 stähli et al 1999 watanabe and flury 2008 kurylyk and watanabe 2013 there still remain several fundamental questions that haven t been fully answered for example it not clearly known how partial freezing of soil could influence retention of unfrozen water or is permeability saturation relation of unfrozen water in partially frozen soil different from that under partially drained condition what role ice nucleation could play in soil freezing and how important it could be in the natural shallow groundwater systems how different is the transport of solutes e g nutrient or dissolved contaminants through partially frozen soil from their transport in partially saturated soil while analogies between the soil moisture curve smc the relation between soil water content and water pressure in unsaturated conditions sometimes also referred to as water retention curve and the soil freezing curve sfc the relation between unfrozen water content and soil temperature in partially frozen soils have been proposed e g williams 1964 koopmans and miller 1966 black and tice 1989 kurylyk and watanabe 2013 the role of pore structure and connectivity in their similarity remains unclear for a given soil type it is well known that shape of the smc is determined by its pore scale properties such as pore size distribution pore connectivity and aspect ratio as the ratio of pore body size to that of connected pore throat however it is not clear if the sfc has the same sensitivity and functionality to these pore scale properties in addition given that the distribution of water in the pore space determines the relative permeability saturation kr s relationship for the water phase the similarities and differences of the kr s relation of unfrozen water in partially frozen soils to that of water in partially saturated soils have remained uninvestigated the primary mechanisms controlling hysteresis observed in sfcs between freezing and thawing conditions are uncertain hysteresis in the sfc is observed as a difference in the unfrozen moisture content of the soil at a given temperature and depends on whether the soil is in freezing decreasing temperature or thawing increasing temperature conditions this hysteretic behavior has been documented in several laboratory and field studies e g black and tice 1989 spaans and baker 1996 quinton and blatzer 2013 however very few studies have attempted to explain the mechanisms for sfc hysteresis in granular soils where capillarity is dominant in a study on gas hydrate growth in pore space anderson et al 2009 explained the hysteresis in hydrate growth and desiccation curves with the ink bottle effect tian et al 2014 referred to the arguments of anderson et al 2009 and extended it to explain hysteresis in sfcs in soil it should be noted that while there are similarities between gas hydrate growth and ice growth in pore space i e both follow the gibbs thomson equation for solid phase thermodynamic stability there are fundamental differences between them gas hydrate is not exclusively formed out of water and requires ch4 and or co2 for its growth this means gas hydrate cannot start growing from the middle of a porous medium and its growth must be piston like starting from the edges of the system and spreading into its center in contrast ice growth can occur anywhere in liquid water of the pore space as ice can be formed out of water and without a need for a secondary molecule during freezing this means that thermodynamics determines the ice water interface and not the fluid transport wettlaufer and worster 2006 as a result ice growth or melting in a given pore is not necessarily controlled by the connectivity of the pore to a continuous ice phase and thus is not subject to the effects of pore connectivity consequently the ink bottle effect on freezing and melting is negligible in addition tien et al 2014 argued that the freezing point depression during freezing is twice that in thawing in identical unfrozen water contents and used it as an evidence to support their explanations for sfc hysteresis however the results of black and tice 1989 and spaans and barker 1996 doesn t support this which necessitates considering the possibility of other explanations in another study spaans and baker 1996 note that the hysteresis in sfc is similar to the hysteresis in smc however comparisons of causal mechanisms in each case were not discussed another potential mechanism that may play a role in sfc hysteresis is hysteresis of the water ice contact angle hysteresis of the water contact angle for advancing and receding conditions has been vastly documented for multiphase systems e g morrow 1975 bikkina 2011 andrew et al 2014 khishvand et al 2016 gharedaghloo and price 2017 and it is a well established point that a hysteresis in contact angle causes a hysteresis in the capillary pressure and soil moisture curves e g zhou 2013 ruspini et al 2017 sun et al 2020 such hysteresis and variability in the contact angle at the front of the solidifying phase at its interface with the unsolidified liquid phase has been observed and discussed before grosse et al 1997 wei et al 2004 however it has not been directly used to describe the hysteresis in soil freezing and thawing curves it is worthwhile to assess whether the hysteresis of sfc can be explained by hysteresis in water ice contact angles this will provide insight for further investigations using high resolution laboratory imaging techniques during soil freezing when the frost front establishes and grows in the vadose zone liquid water potential drops in the frozen zone causing a pressure gradient that drives liquid water to move from unfrozen depths to the freezing front hayashi 2013 this is associated with an increase in total water content in the frozen portion of the vadose zone quinton and blatzer 2013 potentially providing water for additional freezing and leading to increased ice saturation ice saturation antecedent to snowmelt events significantly influences infiltration of meltwater iwata et al 2010 and partitioning of meltwater between surface runoff and subsurface flow kane and stein 1983 an improved understanding of the upward migration of water during freezing could inform forecasts of pre melt ice saturation and support estimations of surface subsurface water partitioning ratios pore scale numerical studies in porous media have been previously conducted to investigate other related phenomena e g the relationship of pore size and pore connectivity to processes and properties including two phase and three phase flow e g ioannidis et al 1993 blunt 2001 valvatne and blunt 2004 vogel et al 2005 culligan et al 2006 raeini et al 2012 blunt et al 2013 berg et al 2016 solute transport e g bijeljic et al 2004 2013 mehmani et al 2012 gharedaghloo et al 2018 biofilm growth von der schulenburg et al 2009 peszynska et al 2016 and phase change duval et al 2004 despite the advances in pore scale simulation techniques the micro scale studies of soil freezing have been limited to the bundle of capillaries model e g watanabe and flury 2008 lebeau and konrad 2012 ming et al 2020 due to the complex nature of soil freezing thawing the simplifying assumptions used in the bundle of capillaries modelling approach are not necessarily valid for water freezing process in porous media for example these models lack micro scale pore morphologies including pore bodies and pore throats and connection between individual pores capillary water and ice cannot be present simultaneously inside an individual pore additionally the bundle of capillaries approach is over parameterized e g tortuosity hydraulic conductivity and pore size distribution parameters in comparison to realistic 3d pore space models which explicitly represent these features in their pore space representations and do not require such fitting parameters furthermore bundle of tubes models cannot evaluate the possible causes of hysteresis in soil freezing given the significant challenges associated with experimentally isolating the individual mechanisms that govern soil freezing both in the field and the laboratory we propose that pore scale simulations of water freezing and water drainage with 3d pore space models helps addressing some of the abovementioned points for example with the 3d pore scale simulations the similarities between sfc and smc and between kr s relations of soils undergoing freezing or drainage can be evaluated considering the uncertainty in the causes of sfc hysteresis and the difficulty in conducting pore scale experiments pore scale numerical simulations may serve as an informative laboratory for hypothesis testing and can be used to explore the effect of contact angle hysteresis on sfc hysteresis furthermore it provides the ability to evaluate variations in water retention characteristics after a soil partially freezes clarifying whether ice growth in pore space enhances or reduces the retention of liquid water with the use of pore scale simulations the objectives of this study are 1 to assess the analogies between smc and sfc and kr s relations of water in drainage and freezing conditions 2 to study the influence of water ice contact angle hysteresis on hysteresis of sfc and 3 to explore the influences of ice growth in the pore space on unfrozen water retention in the partially frozen soils to our knowledge this is the first study that proposes an algorithm and a model for simulating ice nucleation and ice growth in realistic 3d pore spaces here for the first time independent water drainage and water freezing simulation results are validated against an empirically validated phase equilibrium equation the methods and workflow presented in this manuscript can also be extended to explore other phenomena including nutrients leaching solute transport and spilled non aqueous phase liquids napls percolation in frozen porous media 2 methods 2 1 theory the curvature at the interface of unfrozen water and frozen water denoted as ice hereafter causes a decrease in the water s freezing temperature this is known as the gibbs thomson effect wettlaufer and worster 2006 and in porous media it causes the water in micropores and pore corners that necessitates a smaller water ice interface curvature to freeze in cooler temperatures in comparison to the water in the macropores eq 1 describes this process liu et al 2003 relating radius of water ice interface curvature m to the melting point depression δt k 1 δ t 2 t m σ w i ρ i l f r w i where tm is bulk freezing temperature of water k σwi is the water ice interfacial tension j m2 lf is the latent heat of fusion freezing j kg ρi is the density of ice kg m3 and rwi is the ice water interface curvature radius m values for these parameters which were held constant in this study are presented in table 1 based on eq 1 as temperature declines below bulk freezing temperature the water present in the pores with the largest radii freezes first as the temperature continues to decrease new ice nuclii form in the other pores and the ice phase spreads to the smaller pores micropores and pore corners this process is similar to but not necessarily identical to the water drainage process in the vadose zone the drainage of water in a porous medium is controlled by its capillary pressure which can be described by the young laplace equation eq 2 2 p c 2 σ w a r w a where pc is capillary pressure pa σwa is water air interfacial tension n m and rwa is the curvature radius of the water air interface m due to similarities between gibbs thomson equation eq 1 and young laplace equation eq 2 and analogies in water freezing and water drainage processes in porous media several studies have tried to derive sfc from smc these studies were summarized by kurylyk and watanabe 2013 2 2 definition and properties of the tested porous media the porous media used for this study are derived from 3d images of three different sand packs f42a f42b f42c and one synthetic silicate imperial college consortium on pore scale modelling 2014a imperial college consortium on pore scale modelling 2014b imperial college consortium on pore scale modelling 2014c imperial college consortium on pore scale modelling 2014d from each original image 2 smaller subsets were extracted i and ii table 2 presents the physical properties of the sand packs and synthetic silicate the porosities for the three different sand packs are very similar ranging from 32 0 to 34 2 for comparison the average measured porosity of the characterized sand was 35 4 talabi et al 2009 average porosity of the synthetic silicate image is 42 5 the specific surface as the ratio of pore surface area to the bulk volume ssab and the ratio of pore surface area to pore volume ssap were relatively uniform across the sand pack samples ssab ranged between 13 0 mm2 mm3 to 14 0 mm2 mm3 and were similar to the values reported in literature on these sand packs ranging between 14 4 14 7 15 0 15 2 and 15 1 15 4 mm2 mm3 respectively for f42a f42b and f42c talabi et al 2009 mostaghimi et al 2013 2 3 process representation 2 3 1 water drainage for the simulation of water drainage in a given 3d soil image where the voxels represent grains and void spaces the maximized sphere radii for all void voxels needs to be determined to compute the maximum sphere radii the algorithm by silin and patzek 2006 and silin et al 2011 was used which is presented as fig a1 of the appendix a heterogeneous contact angle distribution could be given as an input to the algorithm for the maximized sphere radii calculations this was adopted from mohammadmoradi and kantzas 2016 2017 during water drainage air intrusion into the pore space is a piston like process and for air to occupy a given void voxel it is essential to have a continuous air phase from the voxel of interest to the air source on the face of the 3d image the second condition for imbibition of the voxel of interest is that the radius of the largest sphere in which the voxel of interest is located at be higher than the radius of water air interface meniscus the water air interface meniscus is related to the capillary pressure via young laplace equation eq 2 the algorithm for incorporating these conditions are discussed and demonstrated in the appendix a and fig a2 all the algorithms for calculating the maximum sphere water drainage air intrusion and ice growths were implemented in r it must be clarified that simulation of water drainage using a 3d pore space has been done before e g raeini et al 2014 mohammadmoradi and kantzas 2017 here these simulations are done to 1 validate the maximal sphere calculation and water drainage simulation algorithms figs a1 and a3 2 obtain the smcs that will be compared against the sfcs upon validating them with the phase equilibrium equation and 3 acquire the kr s relation for the water drainage process in the same medium in which the kr s relation of water in partially frozen condition is calculated complex topography of the pore space in the simulated soils does not allow a visual assessment of the drainage algorithm thus two synthetic numerical pore systems were constructed and water drainage was simulated in them appendix b allowing visual assessment of the drainage algorithm results 2 3 2 water freezing at a given temperature below the bulk freezing temperature tm ice growth into a voxel depends on the size of the pore that the voxel is located in and the contact angle of water ice interface on that pore s wall this means the radius of the maximized sphere calculated based on fig a1 in which that specific voxel is located equals the water ice interface meniscus rwi at which that voxel becomes occupied by ice the δt corresponding to rwi is determined using eq 1 in contrast to air intrusion into pore space ice growth does not require a continuous connection from the freezing pore and voxel to an ice phase source at the edge of the porous medium the algorithm of ice growth via processing the maximum sphere radii data are illustrated in fig a3 to test the freezing algorithm and visually assess its reliability water freezing was simulated in the same synthetic pores of appendix b it must be clarified that the proposed model assumes thermodynamic equilibrium between the supercooled unfrozen water phase present in pore corners and smaller pores and the ice phase present in center of the pores and the larger pores at temperatures below the bulk freezing melting temperature when modelling the cooling process as the temperature drops gradually the ice phase grows further into the pore corners and into the pores with smaller radii the ice growth stops once thermodynamic equilibrium is established between supercooled water and ice phases the assumption is that the rate of temperature rise drop is not too high leading to disequilibrium between two phases the rates of temperature rise fall above which freezing and thawing in pore scale deviate from equilibrium are not known however in macro scale the equilibrium requires the rate of soil temperature rise fall be less than 0 1 c hour kurylyk and watanabe 2013 as a result of this condition the kinetics of ice growth melt will not be a controlling factor and capturing the freezing melting in snapshots of equilibrium states will be reasonable if between two successive equilibrium snapshots a fraction of an ice bulb disappears it doesn t mean that the melting of that ice fraction happened instantaneously but it means that melting was gradually ongoing between two temperatures corresponding to two successive snapshots while unfrozen water and ice remained in equilibrium another assumption of this model is that ice formation in the pore space does not lead to water being isolated and over pressurized this assumption is valid in natural systems over a wide range of ice contents where unfrozen water remains a continuous phase in micro pores and pore corners allowing the pressurized unfrozen water to flow out of the partially frozen pores besides the film of unfrozen water covering the grains and the ice bulbs provides another path for the unfrozen water to flow out of the pressurized pores although this unfrozen film of water is not explicitly represented in this study it still keeps our assumption valid as the aim of our model is to forecast the behavior of natural soils since the snapshots of water ice equilibrium are captured in the proposed algorithm the expansion in water ice volume due to ice formation is not required to be considered explicitly this is because the snapshots represent the times when pressurized unfrozen water has left the partially frozen pores this must be noted that if the aim of the study was to model kinetics of ice formation and rate of ice growth indeed conservation of water mass would necessitate including the volume change in the calculations it is essential to clarify that in the shallow groundwater systems where freezing thawing are governing the aqueous phase always contains suspended sediments particulate organic matter unconsolidated grains microbes etc that can act as the nucleus where the ice nucleation can start from in such a system the nucleation is heterogeneous thus an extremely supercooled condition which might be observed in the freezing of distilled water leading to homogenous nucleation will not take place as mentioned above the existence of suspended particulates in a pore will determine if ice phase initiate from that pore however limited nucleation can cause phase change curve deviate from equilibrium curve e g firoozabadi et al 1992 nucleation depended simulations appendix c in which ice formation in a pore is controlled by both temperature and nuclei existence in that pore will help assessing the level of particulate density in porewater which ascertains equilibrium freezing the impact of hysteresis in the water ice contact angle at the grain surface on the hysteresis in sfc was evaluated by using a contact angle for thawing condition θwi thawing different than the contact angle used to simulate ice growth in freezing process this was accomplished by calculating a new set of maximized sphere radii fig a1 using θwi thawing as the contact angle then calculating ice phase distribution in pore space fig a3 at a range of rwi values using the new maximized sphere radii data next using eq 1 and σwi from table 1 the equivalent δt of rwi was obtained as mentioned earlier this model captures the thermodynamic equilibrium states between the ice and water phases without describing the kinetics of nucleation or melting this means even if during the warming melting stage superheating of ice happens it is assumed a temporary state of the system this is because superheated ice is thermodynamically unstable wettlaufer and worster 2006 consequently the model describes the stable state after this temporary condition when the superheated ice has already melted phase equilibrium equations have frequently been used to determine δt that is equivalent of pore water pressure and vice versa e g williams 1964 koopmans and miller 1966 kurylyk and watanabe 2013 based on this equation sfc can be calculated from smc using 3 h l f g t m δ t where h is water pressure m and g is gravitational acceleration constant m2 s δt is the melting point depression at water pressure of h williams 1964 here after calculation of sfc the smc data equivalent of simulated sfc are calculated using eq 3 and are compared directly to the simulated smc data from water drainage simulations the results of the comparisons provide insight on the applicability of the phase equilibrium equation eq 3 in the tested porous media 2 4 water relative permeability having the spatial distributions of ice unfrozen water and grains in partially frozen soil and water air and grains in partially saturated soils derived from the previous section allows for the simulation of water flow through partially saturated and partially frozen soils at the pore scale by solving the navier stokes equation for the liquid water phase domain these simulations are performed using openfoam openfoam 2020 openfoam is a commonly used numerical simulation package for modelling fluid dynamics in pore scale studies blunt et al 2013 and has been used in a growing number of recent studies e g raeini et al 2014 2015 rabbani et al 2016 mohammadmoradi and kantzas 2017 hu et al 2017 for the water relatively permeability simulations only pore space f42a i was used as the simulation domain for the water drainage cases the 3d distribution of the water phase at different saturations were determined and the exterior shell of the water phase domain representing its outer boundary was exported as a stereolithography stl file using microview parallax innovations microview 2020 next the stl file was imported in the snappyhexmesh meshing module of openfoam to produce the 3d mesh of the water filled pore space for numerical simulations finally water flow through the mesh was simulated using icofoam solver of openfoam the x 0 surface was considered as the inlet face and the x l surface where l is the length of the domain was the outlet face of the domain the constant uniform pressure boundary conditions bc were assigned to the inlet and outlet faces applying a constant pressure difference between inlet and outlet of the domain velocity bcs at the inlet and outlet were zero gradient the pressure bcs at the interior faces of the shell e g on grains surfaces and at the rest of exterior faces were zero gradient and the velocity bcs at them were no slip the flow simulation was run until a steady state condition was established in the simulation domain repeating this approach at different water saturations water flow through saturated and partially saturated pore spaces were simulated finally paraview was used to calculate volumetric discharge through the domain as a result of the imposed pressure difference the workflow for producing stl files and importing them into openfoam was adopted from gharedaghloo et al 2018 the approach for the water flow simulations in partially frozen soil was almost identical to the approach discussed above the only difference was that for the partially frozen case the initial spatial distribution of unfrozen water liquid phase was exported as the flow domain having the macroscopic dimensions of the domains which were 1 5 mm x 1 5 mm x 1 5 mm the applied pressure gradient and the calculated volumetric rates saturated permeability ksat and effective permeability keff for partially frozen or partially saturated cases were calculated having ksat and keff values kr as the ratio of keff ksat was determined for each water saturation case which together gives the kr s relations of water in freezing and in drainage conditions the simulated velocity and pressure fields were analyzed to assess the validity of hill s condition in the pore scale flow simulations based on du and ostoja starzewski 2006 details of those analyses are discussed in supplementary material comparisons of simulated kr s relations to those available in literature for similar sand soils were used to assess the accuracy of the drainage algorithm and the validity of the applied modelling approach it also provides the required data for comparing kr s relation of water in the drainage process to that of liquid water in the freezing process comparisons of simulated kr s in partially frozen and partially saturated soils can provide insights on the similarities and differences of these relationships in coarse granular media 2 5 liquid water drainage in partially frozen soil simulation of liquid water drainage in a partially frozen soil is done as a combination of water freezing and water drainage simulations figs a2 and a3 first water freezing in the pore space is simulated using the abovementioned algorithms fig a3 next by treating frozen voxels as a form of grains the maximum sphere radii in the unfrozen water filled domain were calculated fig a1 then water drainage in the same domain was simulated since for the calculation of maximum sphere radii the solid pore wall may belong to either soil grain or ice a heterogeneous contact angle distribution was assumed this is because the contact angle of water air on grain which is assumed to be 0 in this study does not necessarily represent the contact angle of water air on ice considering that the water ice interfacial tension σwi is 0 032 n m table 1 water air surface tension σwa is 0 072 n m table 1 and the ice air surface tension σia is 0 09 n m based on young s equation the contact angle of water air interface on ice phase should equal cos 1 0 09 0 032 0 072 or 36 3 this means in partially frozen soil where pore walls are either grain surface or ice surface the pore wall will be fractional wet where the contact angle of water air interface on the soil grains is 0 and contact angle of water air interface on the ice phase is 36 3 thus for the simulation of liquid water drainage in a partially frozen soil the solid surfaces were categorized into two groups 1 grain and 2 ice and a distribution of contact angles were applied when searching for maximized sphere and when simulating air intrusion details on water drainage simulations in fractional wet media are available in mohammadmoradi and kantzas 2016 3 results and discussion 3 1 water drainage the modelling approach was verified by simulating water drainage for the 3 sand packs and comparing the simulated capillary pressure saturation curves to previously published relations for similar sand packs in the literature fig 1 illustrates the simulated black and grey curves capillary pressure water saturation pc s curves which is equivalent of smc and compares them to data measured for sand packs and sands available in literature brooks and corey 1964 likos and jaafer 2013 wang et al 2016 it should be noted that the observed data belong particularly to sand soil type data in the literature that were labeled differently e g silty sand silt sandstone were not included also the data measured for fluid fluid systems other than water air or brine air were not included e g water oil water napl this was to prevent imposing uncertainties due to pc s scaling results show that the simulated drainage pc s curves are in good agreement with the literature data confirming that the algorithm and its implementation in the simulation code r for modelling water drainage in the 3d sand pack images produce reliable predictions water drainage simulations in the synthetic pores in appendix b also demonstrate that the implemented drainage algorithm produces physically meaningful results near the lowest simulated water saturations sw 0 1 the simulated drainage curves slightly deviate from the observed data points the deviation is partly because in those water saturations the radius of water air interface meniscus is 2 3 times of the image resolution consequently obtaining the exact interface meniscus radii is not feasible as a result the simulated capillary pressure curve that uses those interface meniscus radii as input slightly deviates from the measured curves this issue can be resolved via imaging with a finer resolution 3 2 comparisons of water drainage drying and water freezing processes several studies have highlighted the analogies between water drainage in ice free soils and water freezing in air free soils koopmans and miller 1966 black and tice 1989 kurylyk and watanabe 2013 and have shown that under specific condition sfc and smc can be equivalent the process of water freezing and ice growth in a pore space while similar to water drainage in granular soils and controlled by capillary forces koopmans and miller 1966 is not identical to the drainage process as discussed in earlier sections the water drainage process requires piston like intrusion of air phase into the pore space while ice growth does not need to be piston like this difference necessitates air intrusion be controlled by the radii of pore throats which means air phase cannot imbibe into a pore space unless the radius of air water interface meniscus is smaller than the radius of largest pore throat connected to the pore space on the other hand ice can form in that very pore without having a water ice interface radius less than that of the largest pore throat this is the primary cause of difference between sfc and smc in high water saturations the pore scale difference between water drainage and freezing processes is demonstrated in fig 2 for sand pack f42a i and in appendix b for the synthetic pore systems as a result of this difference at lower potentials higher two phase interface meniscus radii the spatial frequency and saturation of the ice phase in freezing process is more than that of air phase in drainage process for a given two phase interface meniscus radius fig 2 as the radius of the two phase interface meniscus decreases the control of pore throats on distribution of imbibed air phase diminishes and the air distribution becomes very similar to the ice distribution these similarities and differences in the relations of water unfrozen water saturation with two phase interface meniscus radii are demonstrated in fig 3 an animation visualizing the ice phase growth in pore space during pore water freezing process is in the supplementary material section despite the pore scale differences in propagation of air and ice in the pore space laboratory observations reported in the literature suggest that sfc and smc data can be accurately calculated from each other using the phase equilibrium equation based on these studies an adjustment factor in the phase equilibrium equation equal to σwa σwi was suggested by and koopmans and miller koopmans and miller 1966 when calculating sfc from smc and vice versa in soils where capillary forces dominate adhesive forces in the case of soils with coarse pore sizes as presented in this study a scaling factor of 2 25 or 0 07199 0 032 is appropriate the need for the scaling factor is raised from the fact that water drainage in a relatively coarse pore is controlled by the water air interfacial tension while the freezing point depression in the same pore is controlled by the water ice interfacial tension thus a conversion between characteristics relations of two processes i e smc and sfc respectively would require a factor including both the interfacial tensions considering that in this case pore sizes are sufficiently large in the sand packs and synthetic silicate and given that water potential is in the range where water adhesion is not the dominant process in water retention it was feasible to assess whether an adjustment is required for phase equilibrium equation eq 3 to explore this sfc relations of the tested sand packs and synthetic silicates were used to calculate their equivalent smc data and the converted smc data were compared to the simulated smc for each soil sample fig 4 shows the soil moisture relationship calculated from soil freezing relations using the phase equilibrium equation eq 3 with the adjustment factor of σwa σwi orange circles and compares them to the simulated soil moisture relation of each soil sample blue curve the figure shows agreements between directly simulated smc via pore scale water drainage simulations and the calculated smc from converting sfc in the sand packs and synthetic silicates an alternative way to show the validity of phase equilibrium equation is to compare water pressure to its equivalent melting point depression watanabe and flury 2008 and kurylyk and watanabe 2013 have used such comparisons to illustrate the validity of the phase equilibrium equation using observed data this comparison was performed by plotting water pressure h at a given simulated water saturation in water drainage case against the melting point depression δt at an identical simulated unfrozen water saturation from water freezing case this was repeated for a range of water saturations for both f42a i ii and synthetic silicate i ii fig 5 shows the results for sand packs f42a i and ii and synthetic silicate i ii and compares them to some measured data from kurylyk and watanabe 2013 and to phase equilibrium equation with and without σwa σwi adjustments the comparisons confirm that phase equilibrium equation with the adjustment factor is valid for soils used in this study where capillarity is dominant as suggested by koopmans and miller koopmans and miller 1966 the simulated points in this study follow the same trend as that of the measured points from kurylyk and watanabe 2013 for sand silt and kaolinite soils in lower ranges of water pressure h i e where capillarity is dominant illustrating the similarity between the simulated data and the measured data this further confirms that the implemented algorithms for modelling ice growth in pore space and calculating sfcs produces reliable results at the higher h and δt the observed data deviate from adjusted equilibrium curve fig 5 this is particularly because the dominance of capillarity becomes less in the larger δt and h values in those water pressure and soil temperature ranges the drainage and freezing of the absorbed water film become the dominant process modelling the drainage and freezing of absorbed water is indeed an important process which require new drainage and freezing algorithms however the absorbed water is not important in the simulated soils of this study for example with a film thickness of 50 nanometer and for the sand packs with specific surface of 14 mm2 mm3 the volumetric fraction of water film will be 0 0007 mm3 mm3 this means in coarse granular soils including those of this study excluding the volumetric content of film water from calculations might not impose significant error in the simulated water and ice distributions it should be noted that there might be contaminations such as solute species present in the aqueous phase in shallow groundwater systems in cold regions where seasonal freezing thawing takes place dissolutions of salts and contaminants in aqueous solutions causes a reduction in the bulk freezing temperature tm of water in addition it can potentially change the σwi hardy and coriell 1973 this means that to model the freezing thawing of an aqueous solution in the pore space different parameter values e g tm σwi should be used in eqs 1 and 3 to relate the radius of the water ice interface meniscus rwi to the freezing melting point depression δt it is important to consider that this will not change the validity of the phase equilibrium equation eq 3 in relating the δt to h as long as the updated σwi is used in the adjustment factor σwa σwi of the water ice equilibrium equation and as long as the δt is freezing melting point depression due to curvature of water ice interface while the methodology presented in this study can consider the effect of solutes on the freezing thawing including solutes in the calculations is out of the scope of this study 3 3 relative permeability of water in unsaturated and partially frozen soil the absolute permeability of f42a i from pore scale simulations was 8 0 10 11 m2 which is equivalent to an absolute permeability of 80 9 d this value agrees with the results of mostaghimi et al 2013 who found the permeability of f42a sand pack to be 62 d the 3d distribution of velocity field in f42a i is demonstrated in fig 6 showing velocity increases from pore walls to pore centers processing the simulated pressure and velocity values for the saturated soil case confirmed the validity of hill s condition in the flow simulations done with openfoam details of these analyses are in supplementary material section to our knowledge this is the first pore scale numerical simulation study that has explicitly included an assessment on the validity of hill s condition for flow simulations in porous media the kr s relations were computed for both partially frozen and partially saturated cases and were compared to kr s relations available in literature for sandy soils fig 7 the figure shows that simulated kr s relation for water drainage condition black square in fig 7 matches those of sand soils from literature from childs and collis george 1950 talsma 1970 kastanek 1971 shown as grey symbols in fig 7 this further confirms that validity of the approach used to simulated water drainage process the kr s relationship for partially frozen sand black circle in fig 7 have similar trend as that of partially saturated sand this observation agrees well with observations of watanabe and osada 2016 in which partially drained soil and partially frozen soil had similar relative permeability to water at similar liquid water saturations characterizing the kr s relation in partially frozen soil might be challenging in the laboratory the results obtained here via pore scale simulations in 3d pore images might justify using the kr s relationship of water drainage condition for parameterizing the macro scale models of water flow in partially frozen soils and when the kr s relations for soil freezing process is not available the relative permeability of unfrozen water stays higher than 0 even in the lower end of unfrozen water saturations this means unfrozen water remains a continuous phase allowing the pressurized water to flow out of the partially frozen pores 3 4 hysteresis in sfc during freezing and thawing conditions several causes of hysteresis in two phase liquid liquid or liquid gas systems have been proposed including the ink bottle effect contact angle hysteresis trapping hillel and hatfield 2005 and nuclei limited freezing however not all these reasons apply to the water ice system first the ink bottle effect is not relevant in the water ice system because ice advancing or receding in the pore space doesn t need to be piston like during warming melting ice can disappear anywhere in the pore space and turn into water phase through a phase change unlike the liquid liquid and liquid gas systems where the non wetting phase needs to flow out of a pore during which the ink bottle effect takes pace in water ice system ice doesn t move out of a pore but becomes liquid water via phase change and during gradual temperature rise for the same reason trapping will not happen thermodynamically it is impossible to have trapped ice bulbs remaining in pore space during warming when the temperature rises above a specific limit even if warmer unfrozen water is presented on two sides of ice bulb in a pore similar to bypassing of the non wetting phase by the wetting phase in liquid liquid or liquid gas systems the ice bulb will change its phase and become liquid water and will not remain as a solid phase in that pore in other words superheated ice cannot thermodynamically happen in the system wettlaufer and worster 2006 firoozabadi et al 1992 showed that phase change curve can deviate from the theoretical equilibrium one due to limitations in number of nuclei on which the phase change can initiate among freezing and thawing processes freezing is the one that needs nuclei to initiate the phase change process therefore insufficient number of nuclei can delay the ice formation in some of the pores causing freezing sfc deviate from the unlimited nucleation one appendix c considering that phase change in thawing is not nucleation depended limited nucleation can cause some differences between soil freezing and soil thawing curves i e hysteresis in sfc however sensitivity analyses on the concentration of nuclei in pore water appendix c suggest that this might not be the case in natural shallow groundwater systems where a significant number of suspended particulates are present in pore water this means nuclei limited phase change might not necessarily be a cause of sfc hysteresis in the shallow groundwater systems the remaining cause is the contact angle hysteresis which might explain the hysteresis in sfc the causes of contact angle hysteresis could be solid surface roughness chemical heterogeneity of the solid surface and the variations of solid soil grain liquid interactions with time buschow et al 2001 eick et al 1975 neumann and good 1972 penn and miller 1980 zografi and johnson 1984 which are potentially valid in any natural multiphase system including water ice on soil grains grosse et al 1997 and wei et al 2004 have shown and discussed that the contact angle at the interface of a liquid substance and its solidified phase can be associated with hysteresis and be time varying the impact of contact angle on freeze thaw hysteresis was investigated by simulating the formation and existence of ice in the pore space with different contact angles it was assumed that water ice contact angle on the grain surface during freezing process is zero two different contact angles of 30 and 60 were assumed for the thawing process by assuming that the water advancing contact angle during the thawing process is higher than the water receding contact angle during freezing larger contact angle in thawing process allows water ice interface meniscus radius to be larger in a pore during thawing compared to freezing the larger meniscus radius leads to a smaller freezing melting point depression δt in the pore during melting process compared to freezing δt determines the lowest temperature that water can remain unfrozen in a pore this means at a temperature below tm the number of pores thus the fraction of pore space occupied by unfrozen water will be less in thawing process compared to freezing thus in a temperature below tm the unfrozen water content becomes less in the thawing curve relative to the freezing curve fig 8 showing a hysteresis in sfc the simulated variations of unfrozen water saturation versus temperature fig 8 showed that a hysteresis in water ice contact angle on soil grains results in hysteresis in temperature saturation relations the higher the water advancing contact angle the more significant the hysteresis is these results suggest that the hysteresis observed for soil freezing thawing relations might be caused by hysteresis in water ice contact angles it should be noted that recent studies have shown that euler characteristics might be an important factor in describing the hysteresis in two phase fluid fluid systems schlüter et al 2016 considering that trapping does not take place in water ice fluid solid systems in the pore space excluding the euler characteristics from our model likely does not introduce a significant error in the calculations indeed future pore scale imaging capturing the spatial water and ice distributions in partially frozen soil can help to more certainly assess the value of those morphological analyses in fundamental understanding of freezing and thawing processes the sfc relation for sand pack f42a i fig 8a shows that within a narrow range of temperature change the unfrozen water saturation decreases dramatically and reaches values near zero this rapid change in sandy soils has been observed before e g watanabe and wake 2009 and is characteristic of sands in which capillary forces dominate adhesive forces and which have negligible silt and clay contents a set of drying drainage and wetting imbibition soil moisture curves are characteristic of a soil and are used in modelling wetting in the vadose zone due to water table rise or surface infiltration and drying in the vadose zone due to water table decline or surface evaporation for a given soil the drying and wetting curves do not vary based on the location or direction of moisture variations in a similar analogy the sfcs of freezing and thawing processes that are obtained through pore scale simulations or other characterization methods are characteristic curves of the soils and are not specifically representing top downward or bottom upward freezing and thawing phenomena 3 5 water drainage in partially frozen soil under isothermal conditions and after formation of ice bulbs in pore space water drainage was simulated into the partially frozen soils for a given height above the water table the unfrozen water content in the unsaturated zone increases with soil freezing figs 9 and 10 in each soil type the increase in water retention is more significant in the case with higher ice saturations fig 9 meaning that increase in retention of unfrozen water in partially frozen soils are positively correlated with the ice content as ice content in the pore space increases the volumetric fraction of pore corners increases also with the growth of the ice phase in pore space the average active pore radii decreases in comparison to unfrozen soil as a cumulative effect unfrozen water retention increases in addition to the unfrozen water content the total water content unfrozen frozen also increase in the unsaturated zone after freezing fig 9 in early freezing times in natural systems when ice saturation is low e g here 0 25 in fig 9b and d the presence of ice in the pore space leads to a slight increase in unfrozen water retention the enhanced unfrozen water content in the frozen soil provides the water for further freezing and subsequently further retention increase and upward moisture movement fig 9a and c certainly this process is subject to the relative permeability of liquid in the partially frozen zone and availability of water in the lower area e g between freezing front and water table where the unfrozen water phase moves upwards over time if enough water is supplied from the deeper soil this can lead to higher ice saturations prior to the snowmelt quinton and blatzer 2013 which can significantly reduce the snowmelt infiltration causing meltwater ponding and increased surface runoff iwata et al 2010 hayashi 2013 4 conclusion in this study we develop a pore scale simulator capable of reproducing soil freeze thaw and water drainage processes this simulator was verified by simulating sfc and smc for sand packs and synthetic silicate soil by illustrating that the adjusted phase equilibrium equation can calculate smc out of sfc and vice versa this agrees with the results of previous studies in the simulations water drainage is controlled by the throat radii and requires connection of the air phase to one side of the medium while the throat radii do not control the growth of ice in the interior pores of the same porous medium as air intrusion into the pore space continues and air spreads more evenly its intrusion becomes less controlled by the throat radii this causes the conversion of smc to sfc to be more accurate in the intermediate and low water saturations compared to the higher end of water saturation next we investigated the water kr s relation for water freezing and water drainage conditions and demonstrated the similarities between the kr s relations of two processes these pore scale simulation results might be useful when parameterizing the soil freezing characteristics at macroscale where the numerical models require kr s relations for partially frozen soils and when these relations have not been directly characterized for the soil in this condition such pore scale simulation results might provide the justification for using smc and kr s relations of partially drained soils for parameterizing partially frozen soils the pore scale simulations also showed that hysteresis in sfc can be due to a hysteresis in water ice contact angles considering the recent advances in micro scale imaging including fast synchrotron based x ray berg et al 2013 2016 pore scale imaging could more fundamentally assess the distribution of ice and unfrozen water phases during the freezing and thawing processes fast pore scale imaging can capture snapshots of ice and unfrozen water distributions in pore space during temperature rise and fall scenarios such pore scale imaging can reveal other possible causes of sfc hysteresis and can be used for visual validation of pore scale simulation results moreover similar to the recent advances in pore scale phase morphology quantifications in fluid fluid systems e g mcclure et al 2018 sun et al 2020 the imaged pore scale ice and water distributions and similar morphological analyses could assess the suitability of minkowski s functionals in explaining the observed hysteresis in soil freezing characteristics pore scale simulations of water retention in partially frozen soils demonstrated that freezing can increase the retention of liquid water in the unfrozen part of a partially frozen soil the increase in the retention of water was due to reduction in active pores radii and enhanced volumetric fraction of pore corners that require larger water potentials to be drained the new approach reported in this manuscript for pore scale simulations of ice growth and melt in pore space can reproduce observations reported in the literature and provides reliable results in predictive simulations in future pore scale simulations this approach can be used to predict parameters and processes that are very difficult to be characterized in laboratory when the rate of temperature rise fall is too high preventing equilibrium pore scale kinetics based freezing simulations which would require new modelling algorithms other than those presented here will help assessing the effects of disequilibrium and temperature rise fall rates on soil freezing thawing processes as a predictive tool the algorithm presented here can be used to estimate the solute transport properties in partially frozen soils which are almost impossible to quantify in the laboratory scale and field scale studies these parameters may include diffusional tortuosity or the dispersivity tensor and their sensitivity to the unfrozen water saturation considering recent advances in the simulation of soil freezing and surface subsurface integrated models schilling et al 2019 cochand et al 2019 and when the directly measured properties are not available the predicted data sets from pore scale simulations on 3d ct images of soils might help users to parameterize the numerical models and for example to forecast dissolved contaminants transport and nutrients cycling and leaching in surface and subsurface aqueous systems credit authorship contribution statement behrad gharedaghloo conceptualization methodology software validation visualization writing original draft writing review editing resources steven j berg writing review editing resources supervision writing review editing resources edward a sudicky writing review editing resources supervision declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgements we would like to thank all anonymous reviewers their comments and suggestions significantly improved this work supplementary materials supplementary material associated with this article can be found in the online version at doi 10 1016 j advwatres 2020 103681 appendix d supplementary materials image application 1 image video 2 image application 3 appendix a algorithms of calculating maximum sphere radii water drainage and water freezing appendix b simple examples as validations of implemented algorithms case 1 case 1 is a bottle neck shaped pore whose axis is along x direction the pore s image on yz plane is circular and the radii of the fitting sphere change along the pore fig b1 and fig b2 respectively show the 2d and 3d view of the pore in case 1 the distribution of air light green in the pore of case 1 is compared to the distribution of ice light grey under the same interface curvature radii the results show that air percolation into the second pore body pore body on the right is prohibited by the radius of the pore throat connecting two pore bodies fig b3c causing water blue to remain in the second pore body once the curvature of water air interface is small enough to dominate the capillary pressure at the pore throat air phase passes the pore throat and occupies the second pore body fig b3e during temperature drop and freezing ice forms when the ice water interface curvature radius that is corresponding to the temperature equals the pore radii fig b3b as the temperature decline continues ice continues to grow toward narrower parts of the pore body fig b3d unlike the air percolation in water drainage process ice nucleation and growth is not limited by the pore throat radius as a result ice nucleation happens in the second pore body fig b3d once the water ice interface curvature radius drops below the radius of the second pore body the ice distribution and grow and the air intrusion and distribution in the synthetic pore are along the expectations which verifies the implementation of the suggested algorithms in figs a2 and a3 case 2 case 2 is a pore space formed of two half torus void space with two different inner radii and two cylindrical pores in two ends fig b4 and fig b5 respectively show the 2d and 3d views of the pore the distribution of air light green in the pore of case 2 is compared to the distribution of ice light grey under the same interface curvature radii fig b6 the results show that air percolation into the cylindrical pore on the right is controlled by radii of the half torus pores fig b6a and fig b6c as a result although the water air interface meniscus radius is smaller than the radius of the cylindrical pore on the right air cannot percolate into it this is inverse to distribution of ice where it is not limited by the radii of the half torus pores and ice grows in the cylindrical pore on the right fig b6b and d as the capillary pressure increases and the water air interface radius become smaller than the pore radii of the larger half torus air passes through it and sweeps the right cylindrical pore fig b6e once the air water interface meniscus radius becomes less than the pore radius of the smaller half torus the smaller half torus also becomes occupied by the air phase fig b6g for water ice case the distribution of ice becomes similar to distribution of air in air water system when the air distribution is not limited by the pore throats fig b6e h similar to case 1 the distribution of ice and air in the pore space of case 2 follows the same pattern described in the text and implemented in algorithms presented in figs a2 and a3 confirming the implemented algorithms produce physically meaningful results appendix c nucleation modelling and the effect of number of nuclei in ice growth in the algorithm discussed earlier fig a3 it is assumed that the ice growth is not limited by the number of nuclei present in pore water however theoretically in near pure systems where there are limited number of nuclei in pore space the phase change curve here sfc might deviation from the equilibrium curve e g firoozabadi et al 1992 to assess whether and when such nuclei limitations influence soil freezing a nucleation algorithm fig c1 for ice growth is proposed the algorithm is similar to the water drainage algorithm fig a2 the difference is that in the nucleation algorithm ice growth initiates from a nucleus within the pore space and not from the side of the 3d pore space since the latter is the case for air intrusion in drainage algorithm to test sensitivity of sfc to the concentration of nuclei in pore water different nuclei concentrations with 10 100 and 1000 nuclei present in pore space of f42a1 were assumed and for each case five random realizations of spatial distributions of nuclei were generated fig c2 illustrates examples of nuclei distributions in the different nucleation scenarios next ice nucleation was simulated for each realization with the algorithm presented in fig c1 using this algorithm if a pore does not contain a nucleus even in temperatures below the equilibrium freezing temperature of that pore ice growth will not initiate within that pore eventually the water in that pore will freeze by growth of the ice phase initiated from the nearby pores that did have nuclei in them to that pore variations of sfc under different nuclei concentrations and distributions in pore water fig c3 show that the limitations in number of nuclei in pore water can change the shape of the freezing sfc in the figure all five realizations of each scenario are demonstrated with the same marker the results show that as the concentration of nuclei in pore water increases the deviation from equilibrium freezing curve black line in fig c3 decreases and at a specific nuclei concentration the freezing curve matches the equilibrium based curve although freezing of water in pore space is associated with presence of nuclei the thawing process is not and follows the equilibrium thawing curves this means freezing of a water with low nuclei content where ice growth in some pores might not happen due to the lack of nuclei might deviate from equilibrium curve while its thawing stays on equilibrium relation this can be an additional cause of hysteresis in sfc when the water phase contains negligible amount of particulates however the results show as the number of nuclei present in pore space grows to 1000 nuclei in 1 1ml of pore water 1 5cm 1 5cm 1 5cm 0 33 1 1cm3 the freezing curve converges to that of the equilibrium curve this means in systems where there are enough number of nuclei in pore water such nuclei limited deviations from equilibrium freezing curve might not happen as mentioned earlier in high latitude area where soil freezing over the winter is an important process the pore water contains a large number of sediments microbes particulate organic matters etc where their concentration is significantly higher than 1000 units per 1 1 ml of pore water this mean despite controlled laboratory condition where homogeneous pure liquids are used causing nuclei limited phase change phenomenon e g firoozabadi et al 1992 in shallow natural aquifers the phase change i e water freezing and ice growth might not necessarily be nuclei limited and the freezing curve will likely be the same as the equilibrium freezing curve 
442,it has been observed in both laboratory and field studies that unfrozen soil moisture content is hysteretic between freezing and thawing conditions while a few explanations have been provided for the causes of this hysteresis there is no general agreement in the literature on underlying causal mechanisms in this study we use pore scale simulations to investigate the role that contact angle hysteresis during freezing and thawing conditions may play in the observed differences in soil moisture content during freezing and thawing conditions we also use these pore scale simulations to better assess the similarities between freezing and water drainage processes in pore space as such realistic assessments are very limited in the literature specifically we use 3d images of natural sand packs and synthetic silicates to generate pore scale model domains and to simulate water drainage and water freezing in the soil pore space the simulated water drainage curve and relative permeability saturation relations for the sand packs agrees well with measured data available in the literature for sandy soils the simulated soil freezing curves were successfully converted to simulated water drainage curve confirming conclusions of previous studies on coarse granular soils water freezing simulations using different contact angles for freezing water receding and thawing water advancing showed that the hysteresis in soil freezing curves could be driven by a hysteresis in the contact angle of water ice interface at the pore wall i e grain surface in addition simulations of water drainage in partially frozen soils revealed that soil freezing enhances liquid water retention in pore space due to reduction of mean active pore radius and increased frequency of pore corners which agrees with the observations of published studies in laboratory and field conditions graphical abstract image graphical abstract keywords pore scale modelling soil freezing freezing hysteresis relative permeability water ice equilibrium 1 introduction shallow soil layer freezing and thawing play important roles in the annual hydrologic cycle of systems in cold regions because the degree to which soil freezes determines the infiltration rate of precipitated water or snowmelt and thus affects the partitioning of water between surface runoff and infiltration hayashi 2013 understanding the fundamental processes governing the freeze thaw dynamics in near surface soils and its impact on soils hydraulic and transport properties are important for both hydrological and hydrogeological assessments including assessment of engineering designs forecasting the migration of nutrients contaminant leaching through frozen soil layers and appropriately parameterizing soil freeze thaw relationships for fully integrated surface water and groundwater models such as hydrogeosphere aquanty 2019 additionally understanding the details of these processes at the pore scale will facilitate the development of upscaling methodologies such that soil freezing processes can be effectively represented in local to large scale numerical models e g clausnitzer and mirnyy 2016 grenier et al 2018 berg and sudicky 2019 langford et al 2019 while several fundamental studies have been published on soil freezing processes and the hydraulic properties of frozen soils e g williams 1964 koopmans and miller 1966 black and tice 1989 spaans and baker 1996 andersland et al 1996 stähli et al 1999 watanabe and flury 2008 kurylyk and watanabe 2013 there still remain several fundamental questions that haven t been fully answered for example it not clearly known how partial freezing of soil could influence retention of unfrozen water or is permeability saturation relation of unfrozen water in partially frozen soil different from that under partially drained condition what role ice nucleation could play in soil freezing and how important it could be in the natural shallow groundwater systems how different is the transport of solutes e g nutrient or dissolved contaminants through partially frozen soil from their transport in partially saturated soil while analogies between the soil moisture curve smc the relation between soil water content and water pressure in unsaturated conditions sometimes also referred to as water retention curve and the soil freezing curve sfc the relation between unfrozen water content and soil temperature in partially frozen soils have been proposed e g williams 1964 koopmans and miller 1966 black and tice 1989 kurylyk and watanabe 2013 the role of pore structure and connectivity in their similarity remains unclear for a given soil type it is well known that shape of the smc is determined by its pore scale properties such as pore size distribution pore connectivity and aspect ratio as the ratio of pore body size to that of connected pore throat however it is not clear if the sfc has the same sensitivity and functionality to these pore scale properties in addition given that the distribution of water in the pore space determines the relative permeability saturation kr s relationship for the water phase the similarities and differences of the kr s relation of unfrozen water in partially frozen soils to that of water in partially saturated soils have remained uninvestigated the primary mechanisms controlling hysteresis observed in sfcs between freezing and thawing conditions are uncertain hysteresis in the sfc is observed as a difference in the unfrozen moisture content of the soil at a given temperature and depends on whether the soil is in freezing decreasing temperature or thawing increasing temperature conditions this hysteretic behavior has been documented in several laboratory and field studies e g black and tice 1989 spaans and baker 1996 quinton and blatzer 2013 however very few studies have attempted to explain the mechanisms for sfc hysteresis in granular soils where capillarity is dominant in a study on gas hydrate growth in pore space anderson et al 2009 explained the hysteresis in hydrate growth and desiccation curves with the ink bottle effect tian et al 2014 referred to the arguments of anderson et al 2009 and extended it to explain hysteresis in sfcs in soil it should be noted that while there are similarities between gas hydrate growth and ice growth in pore space i e both follow the gibbs thomson equation for solid phase thermodynamic stability there are fundamental differences between them gas hydrate is not exclusively formed out of water and requires ch4 and or co2 for its growth this means gas hydrate cannot start growing from the middle of a porous medium and its growth must be piston like starting from the edges of the system and spreading into its center in contrast ice growth can occur anywhere in liquid water of the pore space as ice can be formed out of water and without a need for a secondary molecule during freezing this means that thermodynamics determines the ice water interface and not the fluid transport wettlaufer and worster 2006 as a result ice growth or melting in a given pore is not necessarily controlled by the connectivity of the pore to a continuous ice phase and thus is not subject to the effects of pore connectivity consequently the ink bottle effect on freezing and melting is negligible in addition tien et al 2014 argued that the freezing point depression during freezing is twice that in thawing in identical unfrozen water contents and used it as an evidence to support their explanations for sfc hysteresis however the results of black and tice 1989 and spaans and barker 1996 doesn t support this which necessitates considering the possibility of other explanations in another study spaans and baker 1996 note that the hysteresis in sfc is similar to the hysteresis in smc however comparisons of causal mechanisms in each case were not discussed another potential mechanism that may play a role in sfc hysteresis is hysteresis of the water ice contact angle hysteresis of the water contact angle for advancing and receding conditions has been vastly documented for multiphase systems e g morrow 1975 bikkina 2011 andrew et al 2014 khishvand et al 2016 gharedaghloo and price 2017 and it is a well established point that a hysteresis in contact angle causes a hysteresis in the capillary pressure and soil moisture curves e g zhou 2013 ruspini et al 2017 sun et al 2020 such hysteresis and variability in the contact angle at the front of the solidifying phase at its interface with the unsolidified liquid phase has been observed and discussed before grosse et al 1997 wei et al 2004 however it has not been directly used to describe the hysteresis in soil freezing and thawing curves it is worthwhile to assess whether the hysteresis of sfc can be explained by hysteresis in water ice contact angles this will provide insight for further investigations using high resolution laboratory imaging techniques during soil freezing when the frost front establishes and grows in the vadose zone liquid water potential drops in the frozen zone causing a pressure gradient that drives liquid water to move from unfrozen depths to the freezing front hayashi 2013 this is associated with an increase in total water content in the frozen portion of the vadose zone quinton and blatzer 2013 potentially providing water for additional freezing and leading to increased ice saturation ice saturation antecedent to snowmelt events significantly influences infiltration of meltwater iwata et al 2010 and partitioning of meltwater between surface runoff and subsurface flow kane and stein 1983 an improved understanding of the upward migration of water during freezing could inform forecasts of pre melt ice saturation and support estimations of surface subsurface water partitioning ratios pore scale numerical studies in porous media have been previously conducted to investigate other related phenomena e g the relationship of pore size and pore connectivity to processes and properties including two phase and three phase flow e g ioannidis et al 1993 blunt 2001 valvatne and blunt 2004 vogel et al 2005 culligan et al 2006 raeini et al 2012 blunt et al 2013 berg et al 2016 solute transport e g bijeljic et al 2004 2013 mehmani et al 2012 gharedaghloo et al 2018 biofilm growth von der schulenburg et al 2009 peszynska et al 2016 and phase change duval et al 2004 despite the advances in pore scale simulation techniques the micro scale studies of soil freezing have been limited to the bundle of capillaries model e g watanabe and flury 2008 lebeau and konrad 2012 ming et al 2020 due to the complex nature of soil freezing thawing the simplifying assumptions used in the bundle of capillaries modelling approach are not necessarily valid for water freezing process in porous media for example these models lack micro scale pore morphologies including pore bodies and pore throats and connection between individual pores capillary water and ice cannot be present simultaneously inside an individual pore additionally the bundle of capillaries approach is over parameterized e g tortuosity hydraulic conductivity and pore size distribution parameters in comparison to realistic 3d pore space models which explicitly represent these features in their pore space representations and do not require such fitting parameters furthermore bundle of tubes models cannot evaluate the possible causes of hysteresis in soil freezing given the significant challenges associated with experimentally isolating the individual mechanisms that govern soil freezing both in the field and the laboratory we propose that pore scale simulations of water freezing and water drainage with 3d pore space models helps addressing some of the abovementioned points for example with the 3d pore scale simulations the similarities between sfc and smc and between kr s relations of soils undergoing freezing or drainage can be evaluated considering the uncertainty in the causes of sfc hysteresis and the difficulty in conducting pore scale experiments pore scale numerical simulations may serve as an informative laboratory for hypothesis testing and can be used to explore the effect of contact angle hysteresis on sfc hysteresis furthermore it provides the ability to evaluate variations in water retention characteristics after a soil partially freezes clarifying whether ice growth in pore space enhances or reduces the retention of liquid water with the use of pore scale simulations the objectives of this study are 1 to assess the analogies between smc and sfc and kr s relations of water in drainage and freezing conditions 2 to study the influence of water ice contact angle hysteresis on hysteresis of sfc and 3 to explore the influences of ice growth in the pore space on unfrozen water retention in the partially frozen soils to our knowledge this is the first study that proposes an algorithm and a model for simulating ice nucleation and ice growth in realistic 3d pore spaces here for the first time independent water drainage and water freezing simulation results are validated against an empirically validated phase equilibrium equation the methods and workflow presented in this manuscript can also be extended to explore other phenomena including nutrients leaching solute transport and spilled non aqueous phase liquids napls percolation in frozen porous media 2 methods 2 1 theory the curvature at the interface of unfrozen water and frozen water denoted as ice hereafter causes a decrease in the water s freezing temperature this is known as the gibbs thomson effect wettlaufer and worster 2006 and in porous media it causes the water in micropores and pore corners that necessitates a smaller water ice interface curvature to freeze in cooler temperatures in comparison to the water in the macropores eq 1 describes this process liu et al 2003 relating radius of water ice interface curvature m to the melting point depression δt k 1 δ t 2 t m σ w i ρ i l f r w i where tm is bulk freezing temperature of water k σwi is the water ice interfacial tension j m2 lf is the latent heat of fusion freezing j kg ρi is the density of ice kg m3 and rwi is the ice water interface curvature radius m values for these parameters which were held constant in this study are presented in table 1 based on eq 1 as temperature declines below bulk freezing temperature the water present in the pores with the largest radii freezes first as the temperature continues to decrease new ice nuclii form in the other pores and the ice phase spreads to the smaller pores micropores and pore corners this process is similar to but not necessarily identical to the water drainage process in the vadose zone the drainage of water in a porous medium is controlled by its capillary pressure which can be described by the young laplace equation eq 2 2 p c 2 σ w a r w a where pc is capillary pressure pa σwa is water air interfacial tension n m and rwa is the curvature radius of the water air interface m due to similarities between gibbs thomson equation eq 1 and young laplace equation eq 2 and analogies in water freezing and water drainage processes in porous media several studies have tried to derive sfc from smc these studies were summarized by kurylyk and watanabe 2013 2 2 definition and properties of the tested porous media the porous media used for this study are derived from 3d images of three different sand packs f42a f42b f42c and one synthetic silicate imperial college consortium on pore scale modelling 2014a imperial college consortium on pore scale modelling 2014b imperial college consortium on pore scale modelling 2014c imperial college consortium on pore scale modelling 2014d from each original image 2 smaller subsets were extracted i and ii table 2 presents the physical properties of the sand packs and synthetic silicate the porosities for the three different sand packs are very similar ranging from 32 0 to 34 2 for comparison the average measured porosity of the characterized sand was 35 4 talabi et al 2009 average porosity of the synthetic silicate image is 42 5 the specific surface as the ratio of pore surface area to the bulk volume ssab and the ratio of pore surface area to pore volume ssap were relatively uniform across the sand pack samples ssab ranged between 13 0 mm2 mm3 to 14 0 mm2 mm3 and were similar to the values reported in literature on these sand packs ranging between 14 4 14 7 15 0 15 2 and 15 1 15 4 mm2 mm3 respectively for f42a f42b and f42c talabi et al 2009 mostaghimi et al 2013 2 3 process representation 2 3 1 water drainage for the simulation of water drainage in a given 3d soil image where the voxels represent grains and void spaces the maximized sphere radii for all void voxels needs to be determined to compute the maximum sphere radii the algorithm by silin and patzek 2006 and silin et al 2011 was used which is presented as fig a1 of the appendix a heterogeneous contact angle distribution could be given as an input to the algorithm for the maximized sphere radii calculations this was adopted from mohammadmoradi and kantzas 2016 2017 during water drainage air intrusion into the pore space is a piston like process and for air to occupy a given void voxel it is essential to have a continuous air phase from the voxel of interest to the air source on the face of the 3d image the second condition for imbibition of the voxel of interest is that the radius of the largest sphere in which the voxel of interest is located at be higher than the radius of water air interface meniscus the water air interface meniscus is related to the capillary pressure via young laplace equation eq 2 the algorithm for incorporating these conditions are discussed and demonstrated in the appendix a and fig a2 all the algorithms for calculating the maximum sphere water drainage air intrusion and ice growths were implemented in r it must be clarified that simulation of water drainage using a 3d pore space has been done before e g raeini et al 2014 mohammadmoradi and kantzas 2017 here these simulations are done to 1 validate the maximal sphere calculation and water drainage simulation algorithms figs a1 and a3 2 obtain the smcs that will be compared against the sfcs upon validating them with the phase equilibrium equation and 3 acquire the kr s relation for the water drainage process in the same medium in which the kr s relation of water in partially frozen condition is calculated complex topography of the pore space in the simulated soils does not allow a visual assessment of the drainage algorithm thus two synthetic numerical pore systems were constructed and water drainage was simulated in them appendix b allowing visual assessment of the drainage algorithm results 2 3 2 water freezing at a given temperature below the bulk freezing temperature tm ice growth into a voxel depends on the size of the pore that the voxel is located in and the contact angle of water ice interface on that pore s wall this means the radius of the maximized sphere calculated based on fig a1 in which that specific voxel is located equals the water ice interface meniscus rwi at which that voxel becomes occupied by ice the δt corresponding to rwi is determined using eq 1 in contrast to air intrusion into pore space ice growth does not require a continuous connection from the freezing pore and voxel to an ice phase source at the edge of the porous medium the algorithm of ice growth via processing the maximum sphere radii data are illustrated in fig a3 to test the freezing algorithm and visually assess its reliability water freezing was simulated in the same synthetic pores of appendix b it must be clarified that the proposed model assumes thermodynamic equilibrium between the supercooled unfrozen water phase present in pore corners and smaller pores and the ice phase present in center of the pores and the larger pores at temperatures below the bulk freezing melting temperature when modelling the cooling process as the temperature drops gradually the ice phase grows further into the pore corners and into the pores with smaller radii the ice growth stops once thermodynamic equilibrium is established between supercooled water and ice phases the assumption is that the rate of temperature rise drop is not too high leading to disequilibrium between two phases the rates of temperature rise fall above which freezing and thawing in pore scale deviate from equilibrium are not known however in macro scale the equilibrium requires the rate of soil temperature rise fall be less than 0 1 c hour kurylyk and watanabe 2013 as a result of this condition the kinetics of ice growth melt will not be a controlling factor and capturing the freezing melting in snapshots of equilibrium states will be reasonable if between two successive equilibrium snapshots a fraction of an ice bulb disappears it doesn t mean that the melting of that ice fraction happened instantaneously but it means that melting was gradually ongoing between two temperatures corresponding to two successive snapshots while unfrozen water and ice remained in equilibrium another assumption of this model is that ice formation in the pore space does not lead to water being isolated and over pressurized this assumption is valid in natural systems over a wide range of ice contents where unfrozen water remains a continuous phase in micro pores and pore corners allowing the pressurized unfrozen water to flow out of the partially frozen pores besides the film of unfrozen water covering the grains and the ice bulbs provides another path for the unfrozen water to flow out of the pressurized pores although this unfrozen film of water is not explicitly represented in this study it still keeps our assumption valid as the aim of our model is to forecast the behavior of natural soils since the snapshots of water ice equilibrium are captured in the proposed algorithm the expansion in water ice volume due to ice formation is not required to be considered explicitly this is because the snapshots represent the times when pressurized unfrozen water has left the partially frozen pores this must be noted that if the aim of the study was to model kinetics of ice formation and rate of ice growth indeed conservation of water mass would necessitate including the volume change in the calculations it is essential to clarify that in the shallow groundwater systems where freezing thawing are governing the aqueous phase always contains suspended sediments particulate organic matter unconsolidated grains microbes etc that can act as the nucleus where the ice nucleation can start from in such a system the nucleation is heterogeneous thus an extremely supercooled condition which might be observed in the freezing of distilled water leading to homogenous nucleation will not take place as mentioned above the existence of suspended particulates in a pore will determine if ice phase initiate from that pore however limited nucleation can cause phase change curve deviate from equilibrium curve e g firoozabadi et al 1992 nucleation depended simulations appendix c in which ice formation in a pore is controlled by both temperature and nuclei existence in that pore will help assessing the level of particulate density in porewater which ascertains equilibrium freezing the impact of hysteresis in the water ice contact angle at the grain surface on the hysteresis in sfc was evaluated by using a contact angle for thawing condition θwi thawing different than the contact angle used to simulate ice growth in freezing process this was accomplished by calculating a new set of maximized sphere radii fig a1 using θwi thawing as the contact angle then calculating ice phase distribution in pore space fig a3 at a range of rwi values using the new maximized sphere radii data next using eq 1 and σwi from table 1 the equivalent δt of rwi was obtained as mentioned earlier this model captures the thermodynamic equilibrium states between the ice and water phases without describing the kinetics of nucleation or melting this means even if during the warming melting stage superheating of ice happens it is assumed a temporary state of the system this is because superheated ice is thermodynamically unstable wettlaufer and worster 2006 consequently the model describes the stable state after this temporary condition when the superheated ice has already melted phase equilibrium equations have frequently been used to determine δt that is equivalent of pore water pressure and vice versa e g williams 1964 koopmans and miller 1966 kurylyk and watanabe 2013 based on this equation sfc can be calculated from smc using 3 h l f g t m δ t where h is water pressure m and g is gravitational acceleration constant m2 s δt is the melting point depression at water pressure of h williams 1964 here after calculation of sfc the smc data equivalent of simulated sfc are calculated using eq 3 and are compared directly to the simulated smc data from water drainage simulations the results of the comparisons provide insight on the applicability of the phase equilibrium equation eq 3 in the tested porous media 2 4 water relative permeability having the spatial distributions of ice unfrozen water and grains in partially frozen soil and water air and grains in partially saturated soils derived from the previous section allows for the simulation of water flow through partially saturated and partially frozen soils at the pore scale by solving the navier stokes equation for the liquid water phase domain these simulations are performed using openfoam openfoam 2020 openfoam is a commonly used numerical simulation package for modelling fluid dynamics in pore scale studies blunt et al 2013 and has been used in a growing number of recent studies e g raeini et al 2014 2015 rabbani et al 2016 mohammadmoradi and kantzas 2017 hu et al 2017 for the water relatively permeability simulations only pore space f42a i was used as the simulation domain for the water drainage cases the 3d distribution of the water phase at different saturations were determined and the exterior shell of the water phase domain representing its outer boundary was exported as a stereolithography stl file using microview parallax innovations microview 2020 next the stl file was imported in the snappyhexmesh meshing module of openfoam to produce the 3d mesh of the water filled pore space for numerical simulations finally water flow through the mesh was simulated using icofoam solver of openfoam the x 0 surface was considered as the inlet face and the x l surface where l is the length of the domain was the outlet face of the domain the constant uniform pressure boundary conditions bc were assigned to the inlet and outlet faces applying a constant pressure difference between inlet and outlet of the domain velocity bcs at the inlet and outlet were zero gradient the pressure bcs at the interior faces of the shell e g on grains surfaces and at the rest of exterior faces were zero gradient and the velocity bcs at them were no slip the flow simulation was run until a steady state condition was established in the simulation domain repeating this approach at different water saturations water flow through saturated and partially saturated pore spaces were simulated finally paraview was used to calculate volumetric discharge through the domain as a result of the imposed pressure difference the workflow for producing stl files and importing them into openfoam was adopted from gharedaghloo et al 2018 the approach for the water flow simulations in partially frozen soil was almost identical to the approach discussed above the only difference was that for the partially frozen case the initial spatial distribution of unfrozen water liquid phase was exported as the flow domain having the macroscopic dimensions of the domains which were 1 5 mm x 1 5 mm x 1 5 mm the applied pressure gradient and the calculated volumetric rates saturated permeability ksat and effective permeability keff for partially frozen or partially saturated cases were calculated having ksat and keff values kr as the ratio of keff ksat was determined for each water saturation case which together gives the kr s relations of water in freezing and in drainage conditions the simulated velocity and pressure fields were analyzed to assess the validity of hill s condition in the pore scale flow simulations based on du and ostoja starzewski 2006 details of those analyses are discussed in supplementary material comparisons of simulated kr s relations to those available in literature for similar sand soils were used to assess the accuracy of the drainage algorithm and the validity of the applied modelling approach it also provides the required data for comparing kr s relation of water in the drainage process to that of liquid water in the freezing process comparisons of simulated kr s in partially frozen and partially saturated soils can provide insights on the similarities and differences of these relationships in coarse granular media 2 5 liquid water drainage in partially frozen soil simulation of liquid water drainage in a partially frozen soil is done as a combination of water freezing and water drainage simulations figs a2 and a3 first water freezing in the pore space is simulated using the abovementioned algorithms fig a3 next by treating frozen voxels as a form of grains the maximum sphere radii in the unfrozen water filled domain were calculated fig a1 then water drainage in the same domain was simulated since for the calculation of maximum sphere radii the solid pore wall may belong to either soil grain or ice a heterogeneous contact angle distribution was assumed this is because the contact angle of water air on grain which is assumed to be 0 in this study does not necessarily represent the contact angle of water air on ice considering that the water ice interfacial tension σwi is 0 032 n m table 1 water air surface tension σwa is 0 072 n m table 1 and the ice air surface tension σia is 0 09 n m based on young s equation the contact angle of water air interface on ice phase should equal cos 1 0 09 0 032 0 072 or 36 3 this means in partially frozen soil where pore walls are either grain surface or ice surface the pore wall will be fractional wet where the contact angle of water air interface on the soil grains is 0 and contact angle of water air interface on the ice phase is 36 3 thus for the simulation of liquid water drainage in a partially frozen soil the solid surfaces were categorized into two groups 1 grain and 2 ice and a distribution of contact angles were applied when searching for maximized sphere and when simulating air intrusion details on water drainage simulations in fractional wet media are available in mohammadmoradi and kantzas 2016 3 results and discussion 3 1 water drainage the modelling approach was verified by simulating water drainage for the 3 sand packs and comparing the simulated capillary pressure saturation curves to previously published relations for similar sand packs in the literature fig 1 illustrates the simulated black and grey curves capillary pressure water saturation pc s curves which is equivalent of smc and compares them to data measured for sand packs and sands available in literature brooks and corey 1964 likos and jaafer 2013 wang et al 2016 it should be noted that the observed data belong particularly to sand soil type data in the literature that were labeled differently e g silty sand silt sandstone were not included also the data measured for fluid fluid systems other than water air or brine air were not included e g water oil water napl this was to prevent imposing uncertainties due to pc s scaling results show that the simulated drainage pc s curves are in good agreement with the literature data confirming that the algorithm and its implementation in the simulation code r for modelling water drainage in the 3d sand pack images produce reliable predictions water drainage simulations in the synthetic pores in appendix b also demonstrate that the implemented drainage algorithm produces physically meaningful results near the lowest simulated water saturations sw 0 1 the simulated drainage curves slightly deviate from the observed data points the deviation is partly because in those water saturations the radius of water air interface meniscus is 2 3 times of the image resolution consequently obtaining the exact interface meniscus radii is not feasible as a result the simulated capillary pressure curve that uses those interface meniscus radii as input slightly deviates from the measured curves this issue can be resolved via imaging with a finer resolution 3 2 comparisons of water drainage drying and water freezing processes several studies have highlighted the analogies between water drainage in ice free soils and water freezing in air free soils koopmans and miller 1966 black and tice 1989 kurylyk and watanabe 2013 and have shown that under specific condition sfc and smc can be equivalent the process of water freezing and ice growth in a pore space while similar to water drainage in granular soils and controlled by capillary forces koopmans and miller 1966 is not identical to the drainage process as discussed in earlier sections the water drainage process requires piston like intrusion of air phase into the pore space while ice growth does not need to be piston like this difference necessitates air intrusion be controlled by the radii of pore throats which means air phase cannot imbibe into a pore space unless the radius of air water interface meniscus is smaller than the radius of largest pore throat connected to the pore space on the other hand ice can form in that very pore without having a water ice interface radius less than that of the largest pore throat this is the primary cause of difference between sfc and smc in high water saturations the pore scale difference between water drainage and freezing processes is demonstrated in fig 2 for sand pack f42a i and in appendix b for the synthetic pore systems as a result of this difference at lower potentials higher two phase interface meniscus radii the spatial frequency and saturation of the ice phase in freezing process is more than that of air phase in drainage process for a given two phase interface meniscus radius fig 2 as the radius of the two phase interface meniscus decreases the control of pore throats on distribution of imbibed air phase diminishes and the air distribution becomes very similar to the ice distribution these similarities and differences in the relations of water unfrozen water saturation with two phase interface meniscus radii are demonstrated in fig 3 an animation visualizing the ice phase growth in pore space during pore water freezing process is in the supplementary material section despite the pore scale differences in propagation of air and ice in the pore space laboratory observations reported in the literature suggest that sfc and smc data can be accurately calculated from each other using the phase equilibrium equation based on these studies an adjustment factor in the phase equilibrium equation equal to σwa σwi was suggested by and koopmans and miller koopmans and miller 1966 when calculating sfc from smc and vice versa in soils where capillary forces dominate adhesive forces in the case of soils with coarse pore sizes as presented in this study a scaling factor of 2 25 or 0 07199 0 032 is appropriate the need for the scaling factor is raised from the fact that water drainage in a relatively coarse pore is controlled by the water air interfacial tension while the freezing point depression in the same pore is controlled by the water ice interfacial tension thus a conversion between characteristics relations of two processes i e smc and sfc respectively would require a factor including both the interfacial tensions considering that in this case pore sizes are sufficiently large in the sand packs and synthetic silicate and given that water potential is in the range where water adhesion is not the dominant process in water retention it was feasible to assess whether an adjustment is required for phase equilibrium equation eq 3 to explore this sfc relations of the tested sand packs and synthetic silicates were used to calculate their equivalent smc data and the converted smc data were compared to the simulated smc for each soil sample fig 4 shows the soil moisture relationship calculated from soil freezing relations using the phase equilibrium equation eq 3 with the adjustment factor of σwa σwi orange circles and compares them to the simulated soil moisture relation of each soil sample blue curve the figure shows agreements between directly simulated smc via pore scale water drainage simulations and the calculated smc from converting sfc in the sand packs and synthetic silicates an alternative way to show the validity of phase equilibrium equation is to compare water pressure to its equivalent melting point depression watanabe and flury 2008 and kurylyk and watanabe 2013 have used such comparisons to illustrate the validity of the phase equilibrium equation using observed data this comparison was performed by plotting water pressure h at a given simulated water saturation in water drainage case against the melting point depression δt at an identical simulated unfrozen water saturation from water freezing case this was repeated for a range of water saturations for both f42a i ii and synthetic silicate i ii fig 5 shows the results for sand packs f42a i and ii and synthetic silicate i ii and compares them to some measured data from kurylyk and watanabe 2013 and to phase equilibrium equation with and without σwa σwi adjustments the comparisons confirm that phase equilibrium equation with the adjustment factor is valid for soils used in this study where capillarity is dominant as suggested by koopmans and miller koopmans and miller 1966 the simulated points in this study follow the same trend as that of the measured points from kurylyk and watanabe 2013 for sand silt and kaolinite soils in lower ranges of water pressure h i e where capillarity is dominant illustrating the similarity between the simulated data and the measured data this further confirms that the implemented algorithms for modelling ice growth in pore space and calculating sfcs produces reliable results at the higher h and δt the observed data deviate from adjusted equilibrium curve fig 5 this is particularly because the dominance of capillarity becomes less in the larger δt and h values in those water pressure and soil temperature ranges the drainage and freezing of the absorbed water film become the dominant process modelling the drainage and freezing of absorbed water is indeed an important process which require new drainage and freezing algorithms however the absorbed water is not important in the simulated soils of this study for example with a film thickness of 50 nanometer and for the sand packs with specific surface of 14 mm2 mm3 the volumetric fraction of water film will be 0 0007 mm3 mm3 this means in coarse granular soils including those of this study excluding the volumetric content of film water from calculations might not impose significant error in the simulated water and ice distributions it should be noted that there might be contaminations such as solute species present in the aqueous phase in shallow groundwater systems in cold regions where seasonal freezing thawing takes place dissolutions of salts and contaminants in aqueous solutions causes a reduction in the bulk freezing temperature tm of water in addition it can potentially change the σwi hardy and coriell 1973 this means that to model the freezing thawing of an aqueous solution in the pore space different parameter values e g tm σwi should be used in eqs 1 and 3 to relate the radius of the water ice interface meniscus rwi to the freezing melting point depression δt it is important to consider that this will not change the validity of the phase equilibrium equation eq 3 in relating the δt to h as long as the updated σwi is used in the adjustment factor σwa σwi of the water ice equilibrium equation and as long as the δt is freezing melting point depression due to curvature of water ice interface while the methodology presented in this study can consider the effect of solutes on the freezing thawing including solutes in the calculations is out of the scope of this study 3 3 relative permeability of water in unsaturated and partially frozen soil the absolute permeability of f42a i from pore scale simulations was 8 0 10 11 m2 which is equivalent to an absolute permeability of 80 9 d this value agrees with the results of mostaghimi et al 2013 who found the permeability of f42a sand pack to be 62 d the 3d distribution of velocity field in f42a i is demonstrated in fig 6 showing velocity increases from pore walls to pore centers processing the simulated pressure and velocity values for the saturated soil case confirmed the validity of hill s condition in the flow simulations done with openfoam details of these analyses are in supplementary material section to our knowledge this is the first pore scale numerical simulation study that has explicitly included an assessment on the validity of hill s condition for flow simulations in porous media the kr s relations were computed for both partially frozen and partially saturated cases and were compared to kr s relations available in literature for sandy soils fig 7 the figure shows that simulated kr s relation for water drainage condition black square in fig 7 matches those of sand soils from literature from childs and collis george 1950 talsma 1970 kastanek 1971 shown as grey symbols in fig 7 this further confirms that validity of the approach used to simulated water drainage process the kr s relationship for partially frozen sand black circle in fig 7 have similar trend as that of partially saturated sand this observation agrees well with observations of watanabe and osada 2016 in which partially drained soil and partially frozen soil had similar relative permeability to water at similar liquid water saturations characterizing the kr s relation in partially frozen soil might be challenging in the laboratory the results obtained here via pore scale simulations in 3d pore images might justify using the kr s relationship of water drainage condition for parameterizing the macro scale models of water flow in partially frozen soils and when the kr s relations for soil freezing process is not available the relative permeability of unfrozen water stays higher than 0 even in the lower end of unfrozen water saturations this means unfrozen water remains a continuous phase allowing the pressurized water to flow out of the partially frozen pores 3 4 hysteresis in sfc during freezing and thawing conditions several causes of hysteresis in two phase liquid liquid or liquid gas systems have been proposed including the ink bottle effect contact angle hysteresis trapping hillel and hatfield 2005 and nuclei limited freezing however not all these reasons apply to the water ice system first the ink bottle effect is not relevant in the water ice system because ice advancing or receding in the pore space doesn t need to be piston like during warming melting ice can disappear anywhere in the pore space and turn into water phase through a phase change unlike the liquid liquid and liquid gas systems where the non wetting phase needs to flow out of a pore during which the ink bottle effect takes pace in water ice system ice doesn t move out of a pore but becomes liquid water via phase change and during gradual temperature rise for the same reason trapping will not happen thermodynamically it is impossible to have trapped ice bulbs remaining in pore space during warming when the temperature rises above a specific limit even if warmer unfrozen water is presented on two sides of ice bulb in a pore similar to bypassing of the non wetting phase by the wetting phase in liquid liquid or liquid gas systems the ice bulb will change its phase and become liquid water and will not remain as a solid phase in that pore in other words superheated ice cannot thermodynamically happen in the system wettlaufer and worster 2006 firoozabadi et al 1992 showed that phase change curve can deviate from the theoretical equilibrium one due to limitations in number of nuclei on which the phase change can initiate among freezing and thawing processes freezing is the one that needs nuclei to initiate the phase change process therefore insufficient number of nuclei can delay the ice formation in some of the pores causing freezing sfc deviate from the unlimited nucleation one appendix c considering that phase change in thawing is not nucleation depended limited nucleation can cause some differences between soil freezing and soil thawing curves i e hysteresis in sfc however sensitivity analyses on the concentration of nuclei in pore water appendix c suggest that this might not be the case in natural shallow groundwater systems where a significant number of suspended particulates are present in pore water this means nuclei limited phase change might not necessarily be a cause of sfc hysteresis in the shallow groundwater systems the remaining cause is the contact angle hysteresis which might explain the hysteresis in sfc the causes of contact angle hysteresis could be solid surface roughness chemical heterogeneity of the solid surface and the variations of solid soil grain liquid interactions with time buschow et al 2001 eick et al 1975 neumann and good 1972 penn and miller 1980 zografi and johnson 1984 which are potentially valid in any natural multiphase system including water ice on soil grains grosse et al 1997 and wei et al 2004 have shown and discussed that the contact angle at the interface of a liquid substance and its solidified phase can be associated with hysteresis and be time varying the impact of contact angle on freeze thaw hysteresis was investigated by simulating the formation and existence of ice in the pore space with different contact angles it was assumed that water ice contact angle on the grain surface during freezing process is zero two different contact angles of 30 and 60 were assumed for the thawing process by assuming that the water advancing contact angle during the thawing process is higher than the water receding contact angle during freezing larger contact angle in thawing process allows water ice interface meniscus radius to be larger in a pore during thawing compared to freezing the larger meniscus radius leads to a smaller freezing melting point depression δt in the pore during melting process compared to freezing δt determines the lowest temperature that water can remain unfrozen in a pore this means at a temperature below tm the number of pores thus the fraction of pore space occupied by unfrozen water will be less in thawing process compared to freezing thus in a temperature below tm the unfrozen water content becomes less in the thawing curve relative to the freezing curve fig 8 showing a hysteresis in sfc the simulated variations of unfrozen water saturation versus temperature fig 8 showed that a hysteresis in water ice contact angle on soil grains results in hysteresis in temperature saturation relations the higher the water advancing contact angle the more significant the hysteresis is these results suggest that the hysteresis observed for soil freezing thawing relations might be caused by hysteresis in water ice contact angles it should be noted that recent studies have shown that euler characteristics might be an important factor in describing the hysteresis in two phase fluid fluid systems schlüter et al 2016 considering that trapping does not take place in water ice fluid solid systems in the pore space excluding the euler characteristics from our model likely does not introduce a significant error in the calculations indeed future pore scale imaging capturing the spatial water and ice distributions in partially frozen soil can help to more certainly assess the value of those morphological analyses in fundamental understanding of freezing and thawing processes the sfc relation for sand pack f42a i fig 8a shows that within a narrow range of temperature change the unfrozen water saturation decreases dramatically and reaches values near zero this rapid change in sandy soils has been observed before e g watanabe and wake 2009 and is characteristic of sands in which capillary forces dominate adhesive forces and which have negligible silt and clay contents a set of drying drainage and wetting imbibition soil moisture curves are characteristic of a soil and are used in modelling wetting in the vadose zone due to water table rise or surface infiltration and drying in the vadose zone due to water table decline or surface evaporation for a given soil the drying and wetting curves do not vary based on the location or direction of moisture variations in a similar analogy the sfcs of freezing and thawing processes that are obtained through pore scale simulations or other characterization methods are characteristic curves of the soils and are not specifically representing top downward or bottom upward freezing and thawing phenomena 3 5 water drainage in partially frozen soil under isothermal conditions and after formation of ice bulbs in pore space water drainage was simulated into the partially frozen soils for a given height above the water table the unfrozen water content in the unsaturated zone increases with soil freezing figs 9 and 10 in each soil type the increase in water retention is more significant in the case with higher ice saturations fig 9 meaning that increase in retention of unfrozen water in partially frozen soils are positively correlated with the ice content as ice content in the pore space increases the volumetric fraction of pore corners increases also with the growth of the ice phase in pore space the average active pore radii decreases in comparison to unfrozen soil as a cumulative effect unfrozen water retention increases in addition to the unfrozen water content the total water content unfrozen frozen also increase in the unsaturated zone after freezing fig 9 in early freezing times in natural systems when ice saturation is low e g here 0 25 in fig 9b and d the presence of ice in the pore space leads to a slight increase in unfrozen water retention the enhanced unfrozen water content in the frozen soil provides the water for further freezing and subsequently further retention increase and upward moisture movement fig 9a and c certainly this process is subject to the relative permeability of liquid in the partially frozen zone and availability of water in the lower area e g between freezing front and water table where the unfrozen water phase moves upwards over time if enough water is supplied from the deeper soil this can lead to higher ice saturations prior to the snowmelt quinton and blatzer 2013 which can significantly reduce the snowmelt infiltration causing meltwater ponding and increased surface runoff iwata et al 2010 hayashi 2013 4 conclusion in this study we develop a pore scale simulator capable of reproducing soil freeze thaw and water drainage processes this simulator was verified by simulating sfc and smc for sand packs and synthetic silicate soil by illustrating that the adjusted phase equilibrium equation can calculate smc out of sfc and vice versa this agrees with the results of previous studies in the simulations water drainage is controlled by the throat radii and requires connection of the air phase to one side of the medium while the throat radii do not control the growth of ice in the interior pores of the same porous medium as air intrusion into the pore space continues and air spreads more evenly its intrusion becomes less controlled by the throat radii this causes the conversion of smc to sfc to be more accurate in the intermediate and low water saturations compared to the higher end of water saturation next we investigated the water kr s relation for water freezing and water drainage conditions and demonstrated the similarities between the kr s relations of two processes these pore scale simulation results might be useful when parameterizing the soil freezing characteristics at macroscale where the numerical models require kr s relations for partially frozen soils and when these relations have not been directly characterized for the soil in this condition such pore scale simulation results might provide the justification for using smc and kr s relations of partially drained soils for parameterizing partially frozen soils the pore scale simulations also showed that hysteresis in sfc can be due to a hysteresis in water ice contact angles considering the recent advances in micro scale imaging including fast synchrotron based x ray berg et al 2013 2016 pore scale imaging could more fundamentally assess the distribution of ice and unfrozen water phases during the freezing and thawing processes fast pore scale imaging can capture snapshots of ice and unfrozen water distributions in pore space during temperature rise and fall scenarios such pore scale imaging can reveal other possible causes of sfc hysteresis and can be used for visual validation of pore scale simulation results moreover similar to the recent advances in pore scale phase morphology quantifications in fluid fluid systems e g mcclure et al 2018 sun et al 2020 the imaged pore scale ice and water distributions and similar morphological analyses could assess the suitability of minkowski s functionals in explaining the observed hysteresis in soil freezing characteristics pore scale simulations of water retention in partially frozen soils demonstrated that freezing can increase the retention of liquid water in the unfrozen part of a partially frozen soil the increase in the retention of water was due to reduction in active pores radii and enhanced volumetric fraction of pore corners that require larger water potentials to be drained the new approach reported in this manuscript for pore scale simulations of ice growth and melt in pore space can reproduce observations reported in the literature and provides reliable results in predictive simulations in future pore scale simulations this approach can be used to predict parameters and processes that are very difficult to be characterized in laboratory when the rate of temperature rise fall is too high preventing equilibrium pore scale kinetics based freezing simulations which would require new modelling algorithms other than those presented here will help assessing the effects of disequilibrium and temperature rise fall rates on soil freezing thawing processes as a predictive tool the algorithm presented here can be used to estimate the solute transport properties in partially frozen soils which are almost impossible to quantify in the laboratory scale and field scale studies these parameters may include diffusional tortuosity or the dispersivity tensor and their sensitivity to the unfrozen water saturation considering recent advances in the simulation of soil freezing and surface subsurface integrated models schilling et al 2019 cochand et al 2019 and when the directly measured properties are not available the predicted data sets from pore scale simulations on 3d ct images of soils might help users to parameterize the numerical models and for example to forecast dissolved contaminants transport and nutrients cycling and leaching in surface and subsurface aqueous systems credit authorship contribution statement behrad gharedaghloo conceptualization methodology software validation visualization writing original draft writing review editing resources steven j berg writing review editing resources supervision writing review editing resources edward a sudicky writing review editing resources supervision declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgements we would like to thank all anonymous reviewers their comments and suggestions significantly improved this work supplementary materials supplementary material associated with this article can be found in the online version at doi 10 1016 j advwatres 2020 103681 appendix d supplementary materials image application 1 image video 2 image application 3 appendix a algorithms of calculating maximum sphere radii water drainage and water freezing appendix b simple examples as validations of implemented algorithms case 1 case 1 is a bottle neck shaped pore whose axis is along x direction the pore s image on yz plane is circular and the radii of the fitting sphere change along the pore fig b1 and fig b2 respectively show the 2d and 3d view of the pore in case 1 the distribution of air light green in the pore of case 1 is compared to the distribution of ice light grey under the same interface curvature radii the results show that air percolation into the second pore body pore body on the right is prohibited by the radius of the pore throat connecting two pore bodies fig b3c causing water blue to remain in the second pore body once the curvature of water air interface is small enough to dominate the capillary pressure at the pore throat air phase passes the pore throat and occupies the second pore body fig b3e during temperature drop and freezing ice forms when the ice water interface curvature radius that is corresponding to the temperature equals the pore radii fig b3b as the temperature decline continues ice continues to grow toward narrower parts of the pore body fig b3d unlike the air percolation in water drainage process ice nucleation and growth is not limited by the pore throat radius as a result ice nucleation happens in the second pore body fig b3d once the water ice interface curvature radius drops below the radius of the second pore body the ice distribution and grow and the air intrusion and distribution in the synthetic pore are along the expectations which verifies the implementation of the suggested algorithms in figs a2 and a3 case 2 case 2 is a pore space formed of two half torus void space with two different inner radii and two cylindrical pores in two ends fig b4 and fig b5 respectively show the 2d and 3d views of the pore the distribution of air light green in the pore of case 2 is compared to the distribution of ice light grey under the same interface curvature radii fig b6 the results show that air percolation into the cylindrical pore on the right is controlled by radii of the half torus pores fig b6a and fig b6c as a result although the water air interface meniscus radius is smaller than the radius of the cylindrical pore on the right air cannot percolate into it this is inverse to distribution of ice where it is not limited by the radii of the half torus pores and ice grows in the cylindrical pore on the right fig b6b and d as the capillary pressure increases and the water air interface radius become smaller than the pore radii of the larger half torus air passes through it and sweeps the right cylindrical pore fig b6e once the air water interface meniscus radius becomes less than the pore radius of the smaller half torus the smaller half torus also becomes occupied by the air phase fig b6g for water ice case the distribution of ice becomes similar to distribution of air in air water system when the air distribution is not limited by the pore throats fig b6e h similar to case 1 the distribution of ice and air in the pore space of case 2 follows the same pattern described in the text and implemented in algorithms presented in figs a2 and a3 confirming the implemented algorithms produce physically meaningful results appendix c nucleation modelling and the effect of number of nuclei in ice growth in the algorithm discussed earlier fig a3 it is assumed that the ice growth is not limited by the number of nuclei present in pore water however theoretically in near pure systems where there are limited number of nuclei in pore space the phase change curve here sfc might deviation from the equilibrium curve e g firoozabadi et al 1992 to assess whether and when such nuclei limitations influence soil freezing a nucleation algorithm fig c1 for ice growth is proposed the algorithm is similar to the water drainage algorithm fig a2 the difference is that in the nucleation algorithm ice growth initiates from a nucleus within the pore space and not from the side of the 3d pore space since the latter is the case for air intrusion in drainage algorithm to test sensitivity of sfc to the concentration of nuclei in pore water different nuclei concentrations with 10 100 and 1000 nuclei present in pore space of f42a1 were assumed and for each case five random realizations of spatial distributions of nuclei were generated fig c2 illustrates examples of nuclei distributions in the different nucleation scenarios next ice nucleation was simulated for each realization with the algorithm presented in fig c1 using this algorithm if a pore does not contain a nucleus even in temperatures below the equilibrium freezing temperature of that pore ice growth will not initiate within that pore eventually the water in that pore will freeze by growth of the ice phase initiated from the nearby pores that did have nuclei in them to that pore variations of sfc under different nuclei concentrations and distributions in pore water fig c3 show that the limitations in number of nuclei in pore water can change the shape of the freezing sfc in the figure all five realizations of each scenario are demonstrated with the same marker the results show that as the concentration of nuclei in pore water increases the deviation from equilibrium freezing curve black line in fig c3 decreases and at a specific nuclei concentration the freezing curve matches the equilibrium based curve although freezing of water in pore space is associated with presence of nuclei the thawing process is not and follows the equilibrium thawing curves this means freezing of a water with low nuclei content where ice growth in some pores might not happen due to the lack of nuclei might deviate from equilibrium curve while its thawing stays on equilibrium relation this can be an additional cause of hysteresis in sfc when the water phase contains negligible amount of particulates however the results show as the number of nuclei present in pore space grows to 1000 nuclei in 1 1ml of pore water 1 5cm 1 5cm 1 5cm 0 33 1 1cm3 the freezing curve converges to that of the equilibrium curve this means in systems where there are enough number of nuclei in pore water such nuclei limited deviations from equilibrium freezing curve might not happen as mentioned earlier in high latitude area where soil freezing over the winter is an important process the pore water contains a large number of sediments microbes particulate organic matters etc where their concentration is significantly higher than 1000 units per 1 1 ml of pore water this mean despite controlled laboratory condition where homogeneous pure liquids are used causing nuclei limited phase change phenomenon e g firoozabadi et al 1992 in shallow natural aquifers the phase change i e water freezing and ice growth might not necessarily be nuclei limited and the freezing curve will likely be the same as the equilibrium freezing curve 
443,the lattice boltzmann method lbm is a widely used numerical technique for simulation of single and two phase flow in geometries that are obtained using tomographic imaging of natural porous media due to ease of implementation and numerical robustness a vast majority of lbm based pore scale simulations employ the so called bounceback scheme to enforce no slip velocity boundary condition bounceback however requires an implicit and tight coupling between the numerical computational and image voxel grid this coupling results in large discretization errors since the pore matrix interface within the 3d image is rough this leads to overestimation of the interfacial area and thereby inaccurate permeability predictions the use of the bounceback scheme also causes other numerical artifacts such as viscosity dependent permeability results in order to address these deficiencies in this work the classical marching cubes algorithm is used to reconstruct a surface mesh from the 3d voxel grid this mesh approximates the pore matrix surface with higher accuracy compared to the inherent stair stepped representation in addition nominally second order accurate curved boundary schemes are used to enforce no slip velocity conditions at the reconstructed pore matrix interface the various pre processing steps such as surface mesh generation and voxelization that are necessary to use curved boundary schemes are described in detail the proposed approach of using curved surfaces and boundary schemes is tested and validated on benchmark pore geometries including a random packing of monodisperse spheres we conclude that compared to current methods curved boundary schemes provide a viable option for obtaining more accurate transport properties for digital rock physics based applications keywords lattice boltzmann method digital rock physics permeability pore scale flow simulations boundary conditions 1 introduction and motivation digital rock physics drp is an approach in which high resolution 3d images along with sophisticated modeling and simulation methods are used to numerically compute petrophysical properties of geologic porous media such as reservoir rocks properties that can be computed include absolute intrinsic permeability relative permeability capillary pressure electrical properties elastic moduli and formation factors berg et al 2017 knackstedt et al 2004 mavko et al 2009 dvorkin et al 2012 saxena et al 2017a kainourgiakis et al 2005 fredrich et al 2014 the 3d images can be obtained from microtomography mct scanning electron microscopy sem or synthetically using statistical reconstruction procedures with lower cost computing and imaging equipment and better numerical methods drp technology has the potential to provide a cheaper faster and accurate alternative to services provided by conventional laboratory techniques permeability is one of the fundamental properties of a porous medium and is needed for investigating a variety of processes such as multi phase oil and gas flow groundwater flow and in general any processes modeled using darcy s law in this study the focus is on numerical computation of permeability of a porous medium with single phase flow under darcian continuum theory the lattice boltzmann method lbm is a widely used numerical method for computation of intrinsic permeability in pores spaces obtained using direct imaging ferréol and rothman 1995 fredrich et al 2006 2014 knackstedt et al 2004 manwart et al 2002 saxena et al 2017b after tomographic imaging of a sample a cubic voxel of the 3d image is segmented such that each voxel is labeled as either a pore or a matrix the resulting pore matrix interface henceforth called the solid boundary is inherently rough and stair step patterned and represents the surface roughness of the sample at a length scale comparable to the resolution of the image since the pore space is already spatially discretized in terms of the image voxels the segmented binary image lends itself immediately to simulations via the lbm resulting in a tight coupling of the voxel and the numerical grids the additional pre processing tasks such as surface mesh extraction and volume meshing that are required in traditional finite element finite volume based approaches to drp are not required in lbm pre processing of complex geologic porous geometries can be tedious and difficult to scale and automate the coupling of voxel and numerical grids leads to an ease of programming of the solver this feature along with the localized nature of the algorithm that enables good parallel scalability and explicit time stepping etc makes the lbm a suitable numerical solver for rapid and routine analysis of industrial scale 5123 samples with minimal user interface one of the main challenges however is the accuracy of the numerical simulations the scheme used to enforce a no slip velocity dirichlet condition on the solid boundary the so called bounceback scheme is major source of the overall error the bounceback scheme follows a simple heuristic rule a distribution reverses its momentum when colliding with a solid boundary at rest the simplicity of implementation of the bounceback boundary scheme has been one of the major contributors in the popularity of the lbm the simplicity of the approach is that one simply needs to label a voxel as a solid or fluid and no additional numerical procedure is required although it is numerically robust the use of bounceback for complex and curved solid boundaries leads to errors from two sources the first source is the modeling error due to approximation of a curved boundary surface by a stair case shape geometrical discretization error this error leads to first order spatial accuracy for boundaries that are not aligned with the lattice vectors a simple approach to reduce the discretization error is to increase the resolution of the image however in many cases this approach may not be feasible due to practical imaging equipment constraints the second source of error is more subtle but well documented in the lbm literature chen et al 1996 ginzbourg and adler 1994 skordos 1993 when the bounceback scheme is used in conjunction with the single relaxation time or the bhatnagar gross krook bgk collision model the exact physical location of the solid boundary i e the location where the flow velocity is exactly equal to 0 depends on the relaxation time τ the relaxation time is a parameter in the bgk collision operator that numerically sets the kinematic viscosity of the fluid via the relation ν τ 0 5 3 with the bounceback bgk combination the exact location of the solid boundary can be derived analytically only for very simple cases for instance the solid boundary lies exactly one half grid distance beyond the fluid voxel if τ 1 and the solid boundary and lattice links are parallel luo et al 2010 in general the exact location of the solid boundary where flow velocity is exactly zero is a complex function of the collision operators relaxation parameters and implementation details in the porous media context it follows that the effective pore volume that is available for flow is a function of viscosity making permeability a function of viscosity a violation of physical behavior since τ controls both the kinematic viscosity and solution accuracy the computed permeability is said to be viscosity dependent the use of the multiple relaxation time mrt collision kernel can reduce the nonphysical dependence of permeability on viscosity via an optimal choice of relaxation parameters rao and schaefer 2019 however geometrical discretization errors due to the stair step nature of the solid boundary still remain accurate treatment of the pore matrix interface or solid boundary is essential due to the high surface to volume ratios typical of a geologic porous medium even small variations in the pore volume or surface can cause large changes in the computed permeability in contrast to the bounceback scheme curved boundary schemes with second order nominal accuracy offer enhanced accuracy at a small computational and user effort while broadly maintaining the ease of use of the lbm maier and bernard 2010 pan et al 2006 in general curved boundary schemes involve interpolations or extrapolations to obtain unknown distributions at the boundary voxels they also require computation of the distance from the boundary voxel to the solid boundary along each lattice vector sub grid distance to account for the complex shape of the solid boundary these schemes have been used within the lbm community to study aerodynamics krüger et al 2017 guo and shu 2013 mussa et al 2009 hemodynamics mazzeo and coveney 2008 and to a much smaller extent pore scale flow in porous media maier and bernard 2010 pan et al 2006 yang et al 2016 van der hoef et al 2005 the pore scale flow studies conducted so far employ solid boundaries that are smooth surfaces and mathematically precise and which are obtained either using 3d cad or using sphere filling packing algorithms e g random packing of spheres jia and williams 2001 jodrey and tory 1985 powell 1980 visscher and bolsterli 1972 in addition to approximating a porous medium as a collection of smooth spheres these studies focused mainly on the fundamental fluid mechanics and the associated drag coefficients in prototype porous media eshghinejadfard et al 2016 fattahi et al 2016 khirevich et al 2015 maier et al 1998 talon et al 2012 van der hoef et al 2005 however the situation in the drp context is rather different the simulation geometry for a realistic geologic porous medium cannot be generated using cad or sphere packing algorithms therefore the extension of curved boundary schemes and the associated workflow to the more practical and challenging cases of voxel based pore geometries remains unaddressed therefore the main aim of this work is to apply second order accurate curved boundary schemes instead of the first order bounceback scheme to estimate the permeability of a complex and realistic porous medium represented via its binary 3d image the proposed methodology involves additional pre processing steps such as generation of surface and voxel meshes and sub grid distance estimations which are required to convert the tomographic images into a format amenable for lbm computations using curved boundaries schemes the rest of the paper is organized as follows in section 2 the essential details of the lb method are described along with a description of the two major categories of curved boundary conditions in section 3 the various steps involved in converting a 3d binary tomographic image into a format that is amenable to lbm calculations with curved boundary schemes are detailed in section 4 the results obtained from the numerical experimentation on two representative porous structures are discussed and in section 5 the resulting conclusions are presented 2 numerical methodology 2 1 overview of mrt lbe compared to the classical approach of directly solving the navier stokes equations to model isothermal incompressible flow the lattice boltzmann equation lbe is based on kinetic theory and the boltzmann equation krüger et al 2017 the lbe tracks the evolution of the discrete velocity distribution function fi x t at position x time t and discrete velocity c i 1 f i x c i δ t t δ t f i x t ω i f i 0 1 q 1 in the above equation ω i f is the discrete collision model δt is the temporal discretization step and q is the total number of discrete velocities in the chosen lattice in this work the lbe with the multiple relaxation time mrt collision model is used the mrt collision model is based on the generalized lattice boltzmann equation glbe method where the streaming of the populations occurs in the velocity space and the collision occurs in the moment space which is spanned by the orthogonal eigenvectors basis of the collision operator dhumières 2002 luo et al 2010 the mrt collision operator is expressed as in vector form 2 ω m 1 s m f f eq m 1 s m m eq where m is a q q matrix that linearly transforms the q dimensional vector of distribution function f from the velocity space to a q dimensional vector m in the moment space 3 m m f f m 1 m the lbe mrt equation is therefore given as 4 f x c i δ t t δ t f x t m 1 s m m eq δ t the rows of the transformation matrix m for the d3q19 lattice which consists of 19 orthogonal basis vectors in three dimensions and the functional form of the equilibrium moments m eq employed in this study can be found in rao and schaefer 2019 the relaxation rate matrix s is a q q diagonal matrix which consists of the relaxation rate for each corresponding moment and which are the eigenvalues of the collision operator m 1 s m 5 s diag 0 s e s ϵ 0 s q 0 s q 0 s q s ν s π s ν s π s ν s ν s ν s m s m s m the relaxation rates si determine the transport coefficients in the system the relaxation rate s ν 1 τ is related to the kinematic viscosity ν via ν c s 2 1 s ν 0 5 δ t for isothermal hydrodynamics c s 2 c 2 3 where c δx δt and τ is the relaxation time parameter the remaining relaxation rates se s ϵ sq sπ and sm can be set in the range 0 si 2 in order to improve the accuracy and stability rao and schaefer 2019 the lbe usually employs a uniform cartesian volumetric grid lattice such that if x is a node of the grid x c i δ t is also a grid node space and time steps are generally set as δ x δ t 1 in the drp context such a lattice coincides with a discretization of the voxel grid computationally the lbe mrt is solved in two steps 6 c o l l i s i o n f x t f x t m 1 s m m eq δ t streaming f x c i δ t t δ t f x t the macroscopic fluid density ρ and velocity u are the zeroth and first order moments of fi respectively 7 ρ x t i f i x t ρ u x t i c i f i x t flow in the simulation domain can be initiated either by applying pressure boundary conditions at the simulation domain boundaries or using volumetric body forcing a detailed discussion of both these methods along can be found in krüger et al 2017 and guo and shu 2013 2 2 curved boundary schemes the central idea behind curved boundary schemes is to take into account the position of a reconstructed solid boundary with respect to the underlying voxel grid in this way these schemes approximate the body fitted mesh technique used in fe fv based approaches consider an idealized situation in 2d where a smooth curve a surface in 3d is overlaid on a regular cartesian mesh lattice as shown in fig 1 a in the drp context the solid boundary is approximated by a discrete triangulated surface which is overlaid on a 3d lattice the procedure to obtain a triangulated surfaces from mct images will be described in section 3 as shown in fig 1 c consider a solid boundary located at an arbitrary position x w on a lattice link connecting a node in the non fluid solid zone x s and a node in the fluid zone x b the nodes in the fluid zone which lie adjacent to the solid boundary are designated as boundary nodes x b they have links connecting interior fluid nodes x f x b c i δ t on one side of the link and nodes in the solid region x s x b c i δ t on the other side suppose the population fi is streaming from x b toward the solid boundary with momentum c i the reversed momentum from x w to x b is c i c i after collision at time t populations f i x b t are known however to finish the streaming process at x b at time t δ t an estimate for f i x b t δ t is needed thus the central task for curved boundary schemes is to devise methods to approximate f i x b t δ t various curved boundary schemes have been proposed which differ in their methods to estimate f i x b t δ t these can be classified into two broad categories interpolation based and extrapolation based schemes in the interpolated boundary schemes f i x b t δ t is constructed from information post collision populations located within the fluid zone while in the extrapolated schemes information constructed at the nodes in the solid zone is utilized the basic approaches for these two categories are outlined below 2 2 1 interpolation based schemes the most widely used curved boundary scheme is the bfl scheme named after the authors which is a combination of 1d spatial interpolation and the bounceback rule bouzidi et al 2001 the basic idea is as follows define a parameter q x b x w x b x s as the fraction of an intersected lattice vector that lies in the fluid region thus x w x b q c i δ t since x x w c i δ t as shown in fig 1 c it is clear that 0 q 1 intuitively q captures the location of the solid boundary in reference to the underlying voxel grid as per the standard lbe each population fi travels at distance of c i δt during the steaming process if a solid boundary is located exactly halfway q 1 2 between x b and x s as is modeled by the halfway bounceback rule then it follows that the populations travel a distance of c i δt 2 from x b to x w and an additional distance of c i δt 2 from x w back to the x b after the bounceback however when the solid boundary is not located halfway between x b and x s q 1 2 a particle streaming from x b towards the solid boundary cannot be reflected back exactly to x b within a time span δt in fact as shown in fig 1 c depending upon the value of q the reflected population would end up at a fictitious location x d because x d is not a lattice node populations need to be constructed depending upon the value of q using interpolations of known post collision populations at x b and x f thus if linear interpolation is used f i x b t δ t is constructed as bouzidi et al 2001 8 f i x b t δ t 2 q i f i x b t 1 2 q i f i x f t q 1 2 1 2 q i f i x b t 2 q i 1 q i f i x b t q 1 2 the bfl scheme has second order spatial accurate for arbitrarily shaped solid boundaries and can be used with any collision operator from an implementation point of view eq 8 requires only a two point stencil of nodes all of which lie within the fluid zone more details can be found in guo and shu 2013 and bouzidi et al 2001 due to the use of interpolation the bfl scheme leads to errors in mass conservation near the boundaries in the drp context though this error is negligible due to very low mass flow rates within the porous medium several improvements to the original bfl schemes have been proposed to address its shortcomings these include schemes that conserve mass schemes such as the interpolation free scheme kao and yang 2008 ginzburg and dhumieres 2003 schemes with a smaller computational stencil chun and ladd 2007 tao et al 2018 etc however most of these schemes involve additional computational complexities for implementation especially when considering the tortuous nature of the solid boundaries and very large computations domains it should be noted that while the geometric discretization error is reduced using the bfl scheme when it used in conjunction with the bgk operator the slip errors still persist i e the wall location depends on the relaxation parameter τ this can be remedied to a large extent using the bfl scheme with the multi relaxation time mrt collision operator lallemand and luo 2003 along with carefully chosen relaxation parameters hence in the current work the bfl scheme is implemented as described by eq 8 along with the mrt collision operator 2 2 2 extrapolation based schemes in the extrapolation based approach distributions are reconstructed on nodes which lie outside the fluid domain i e on nodes that lie in the solid zone but which are connected to boundary nodes in the fluid zone x b by a lattice vector a widely used extrapolation based scheme was proposed by guo et al 2002 according to this scheme populations are constructed on solid nodes x s instead of on x b as in the bfl scheme 9 f i x s t f i e q x s t f i n e q x s t where f i e q and f i n e q are the equilibrium and non equilibrium parts of distributions respectively the equilibrium distributions are constructed according to the standard isothermal equilibrium distributions f i e q x s t f i e q ρ s u s the density ρs ρ x s t and the velocity u s u x s t that are required to calculate the equilibrium distributions at the solid nodes are extrapolated from nodes within the fluid zone for density it is proposed to use ρ x s t ρ x b t and for velocity guo et al 2002 10 u x s t q u 1 1 q u 2 q 3 4 u 1 q 3 4 where u 1 and u 2 are obtained using velocity values at the fluid nodes x b and x f thus making this a three point stencil scheme 11 u 1 u x w t q 1 u x b t q 12 u 2 2 u x w t q 1 u x f t q 1 note that for the usual no slip velocity condition u w u x w 0 in the gzs scheme in addition to equilibrium distributions the non equilibrium distributions are calculated as 13 f i n e q x s t q f i n e q x b t 1 q f i n e q x f t q 3 4 q f i n e q x b t q 3 4 once f i x s t are constructed regular streaming and collision is performed on all nodes including the solid nodes x s once streaming is performed at x s at time t f i x b t δ t is obtained which is the goal for all curved boundary schemes whether interpolation or extrapolation based several other schemes based on idea of extrapolation reconstructing f i x s t have been proposed they differ mainly in the way the velocity is extrapolated xu et al 2016 filippova and hänel 1998 mei et al 1999 tiwari and vanka 2012 3 preprossessing workflow in order to implement curved boundary schemes in drp context a series of steps are required to convert a 3d mct image of a sample into a format suitable for a lbm solver that implements a curved boundary scheme the tomographic images are assumed to be already segmented so that each voxel is classified either a solid or fluid the steps required to convert raw tomographic images into a binary one consists of image processing steps such as denoising filtering thresholding etc image processing in itself is a wide and active area of research within the drp community more details of recent developments in this field can be found in bultreys et al 2016 verri et al 2017 schlüter et al 2014 and saxena et al 2017b in the following sub sections the preprocessing steps are first described using an example of a 3d image of a random packing of spheres the entire simulation workflow for computing permeability is summarized in fig 2 the dataset consists of 793 images in bmp file format each of size 788x791 the image resolution is 7 μm and the reported porosity of the sample is ϕ 0 34 fig 3 a and b show a cross sectional view in the direction of applied forcing of the sphere pack and its 3d rendering respectively these image data were obtained from the supplementary data published in saxena et al 2017a which is also available online at saxena 2017 3 1 surface meshing image to surface mesh after the two regions of interest pore and matrix are obtained using image segmentation the corresponding pore matrix interface which represents the solid boundary surface must be extracted or reconstructed in the workflow for this study the first step consists of converting the 3d image which is available in the bmp file format into the ascii dat txt file format this is done using a python script that assigns values of 0 1 2 for fluid bounceback and solid voxels respectively each voxel is categorized according to the following rule a fluid voxel is one whose neighbors are fluid voxels in all eighteen lattice vector directions similarly for solid voxels a bounceback voxel on the other hand has at least one neighbor in the eighteen lattice direction that is a fluid voxel fig 3 b shows the pictorial representation of the voxel categorization process the resulting dat file forms the input to permeability calculation using bounceback boundary conditions rao and schaefer 2019 in bounceback based simulations regular lbm operations streaming and collision are performed on fluid voxels bounceback operations are performed on bounceback voxels and no computations are performed on solid voxels the second step in the workflow is to extract an isosurface using themarching cubes mc algorithm lorensen and cline 1987 wenger 2013 an isosurface is defined as follows given a 3d scalar field f x a surface that satisfies f x σ is called an isosurface and σ is called the isovalue the core idea of the marching cubes algorithm is that a voxel cube can be defined by the pixel values at the eight corners of the cube if one or more pixels of a cube have values less than the user specified isovalue and one or more have values greater than this value it can be inferred that the voxel contributes a fraction of the isosurface by determining which edges of the cube are intersected by the isosurface triangular patches can be created which divide the voxel between regions inside and outside the isosurface by connecting the triangular patches from all cubes on the isosurface boundary the overall isosurface mesh is obtained which is described in terms of its constituent triangles the mesh data is generally stored in a ascii or binary stl file format for drp by applying the mc algorithm to a 3d image which is essentially a 3d scalar field a surface is obtained that approximates the solid boundary and which forms the input for subsequent lbm computations fig 4 a shows a 3d view of the isosurface mesh of the solid boundary of the random packing of spheres and fig 4 b shows a closeup of a section in this work an implementation of the classical marching cubes algorithm available within the palabos framework team 2009 2017 is used alternatives include commercial software such as mimics and avizo and free software such as imagej and cgal it should be noted that in many cases the classical marching cubes algorithms results in non manifold surface meshes which can lead to meshing related errors since manifold or water tight meshes are required for the lbm simulations in cases where non manifold surface meshes are generated the meshmixer tool can be used to repair the mesh or more sophisticated isosurfacing algorithms can be used that guarantee topological properties i e produce isosurfaces without cracks holes and other discontinuities lewiner et al 2003 3 1 1 choice of isovalue the isovalue is an important user specified parameter value that determines whether a voxel is either inside or outside the surface in the drp context the isovalue dictates the exact location of the solid boundary within the voxel grid artificial smoothing of the pore spaces especially in throat region can change the overall pore volume available for fluid flow and therefore the computed permeability jones and feng 2016 saxena et al 2017b for binary tomographic images i e if a black fluid 0 and white solid 1image classification scheme is followed the isovalue should be chosen such that 0 σ 1 as observed in fig 5 a larger isovalue within the range leads to a larger pore volume thus making the computed permeability weakly dependent on the choice of the isovalue in this work we set isovalue to a default value of σ 0 5 finally it should be noted that a 3d binary image can be directly converted into a surface mesh bmp stl without the intermediate step of generating a dat file bmp dat stl however this intermediate step is included in any event since dat files are required as input to permeability computations using the bounceback boundary conditions 3 2 volume meshing surface mesh to volume mesh the surface mesh generated using the mc algorithm contains only the solid boundary information for 3d simulations a numerical grid is needed which in the lbm is a 3d uniform cartesian voxel grid therefore for a given isosurface and a 3d voxel grid of a particular resolution size of the smallest voxel the next task is to place the isosurface inside the 3d domain and then decide which voxels are inside the domain bounded the isosurface and which are not this process is called voxelization patil and ravi 2005 möller and trumbore 2005 in the lbm with the curved boundary approach voxelization consists of two major tasks i determine voxels that lie inside or outside of the domain bounded by the isosurface but within the overall 3d voxel grid ii for voxels that lie partially inside or outside determine the distance between the isosurface and the boundary voxels along the eighteen lattice vectors the distance between the points of intersection and boundary voxels along the eighteen directions gives the sub grid distance qi which was discussed in section 2 2 note that qi take non zero values only on boundary voxels for all interior voxels q i 0 the voxelization and sub grid distance calculation is done using the ray triangle intersection algorithm which were originally developed in computer graphics field marschner and shirley 2015 similar to the marching cubes algorithm an implementation of the ray tracing algorithm available within palabos environment is used a major difference between classical ray tracing and its lbm implementation is that in lbm the ray tracing procedure is done along eighteen lattice directions instead of along three co ordinate axes aligned directions fig 6 shows the result of the voxelization process finally computational aspects of the entire pre processing workflow including time to mesh and voxelise memory requirements etc are discussed in section 4 4 4 numerical implementation the application of the workflow and the results of the simulations performed with the two curved boundary schemes are now discussed three prototype porous media are considered for which tomographic images and numerical results are available from the literature i a circular pipe ii a 3d square block with a six pointed star shaped channel fig 9 and ii a 3d random packing of monodisperse spheres figs 3 and 4 the 3d images for star shaped channel and sphere pack were obtained from the supplementary material provided by saxena et al 2017a step 1 of the workflow bmp to dat conversion was performed using a python script the resulting dat file serves as an input to the lbm simulations with bounceback boundary condition all subsequent steps listed in fig 2 were done within the palabos simulation framework palabos is a c based open source parallel general purpose lbm library team 2009 2017 obtaining permeability from a simulated velocity field using darcy s equation the main output of the palabos solver is the local velocity field u x which is the steady state solution of the navier stokes equations as recovered by eq 4 based on darcy s law isotropic permeability k is computed as gerke et al 2018 talon et al 2012 14 k μ l q δ p s where q is flowrate through a cross sectional area s δ p p i n p o u t where pin and pout are the prescribed pressures at the inlet and outlet boundaries respectively and l is the distance over which the pressure difference is applied the flowrate can be determined according to q u s e f f where u is the velocity averaged over the entire cross sectional area s and seff is the effective area which is equal to the cross sectional area of only the pores a fraction of the total cross section area s for faster convergence and to smooth out numerical fluctuations it is convenient to perform averaging over the entire volume v and effective pore volume vpore instead of over the cross sectional areas 15 k μ l u v p o r e δ p v ϕ μ l u δ p here ϕ v p o r e v is the porosity as a convergence criterion a steady state solution is assumed when the normalized difference between permeability values between time n and n 1 is less than 10 4 16 k n k n 1 k n 10 4 for the three geometries tested here the flow is initiated by prescribing dirichlet boundary conditions for density pressure at the inlet and outlet using the zou he boundary scheme the density pressure difference is kept low enough that the stokes flow condition re 1 is maintained and lbm compressibility errors are negligible the relaxation parameter was chosen as τ 1 2 and the rest of the mrt relaxation parameters were fixed according to the guidelines developed in rao and schaefer 2019 4 1 circular channel a pipe with a circular cross section provides a simple non trivial benchmark geometry for validation of the entire workflow and the flow solver for a circular pipe of radius r the permeability is given analytically k r e f p π r 4 8 a where a is the cross sectional area of the square channel into which the circular pipe is bored the circular cross section geometry used in the simulation was created using a raster graphics editor paint net and multiple 2d images were stacked in the stream wise direction to create a 3d voxel grid of the pipe fig 7 a show a stair stepped cross sectional area of a 3d pipe while 7 b shows the triangulated surface representation of the pipe as obtained from the steps described in section 3 two series of tests were conducted on the circular pipe geometry first to check the dependency of permeability on orientation of the pipe with respect to the underlying voxel lattice simulations were performed on two different diameter pipes with d 8 16 and l 64 that are rotated at three different angles θ 30 45 60 second to test the effect of voxel refinement three different voxel grids 643 1283 2563 were tested for the d 8 pipe fig 8 shows that the permeability calculated using the bounceback scheme depends strongly on the inclination of the circular pipe relative to the voxel grid lattice since a stair step representation is only a first order approximation of the actual circular cross section the discretization errors are much larger when the channel walls are not aligned with the lattice this additional discretization error is generally reduced by aligning the channel with the lattice however this approach is not feasible for complex porous medium also note that the error in the bounceback based permeability at θ 45 is smaller that the errors at θ 30 and θ 60 this is because at θ 45 the channel is aligned with some of the 19 lattice vectors on the other hand it can be observed that the permeability estimated using bfl curved boundary scheme remains largely constant with an increase in θ moreover due to the second order curved representation of the circular cross section errors in permeability calculated with the bfl scheme are smaller that those with bounceback schemes it is also evident that from fig 8 that a refinement in the voxel grid resolution leads to more accurate estimates of permeability these observations provide evidence of the advantages of using curved surfaces for representing the pore matrix boundary and curved boundary schemes for implementing the no slip velocity boundary condition it should be noted that in general both the curved and bounceback schemes underestimate the permeability of the circular channel 4 2 star hexagram cross sectional channel the pre processing workflow and the solver was next validated on a channel with a star shaped cross section fig 9 a shows the binary segmented image of the cross section the hexagram has a length of 200 3 2 in image units and the size of the image dataset is 10243 with a resolution of 1µm this high resolution image dataset was obtained from saxena 2017 fig 9 b shows the surface mesh obtained from the 3d image using the marching cubes algorithm and fig 9 c shows a cross section after the voxelization process the porosity of the geometry is 0 02 which closely matches the porosity of 0 0204 that is obtained after pre processing the surface mesh consists of around 840 000 triangles it should be noted that although the original image dataset is 10243 only 512 images were used in the streamwise x direction since the medium is homogeneous along this direction i e the simulation domain for lbm simulations is 512 1024 1024 although a closed form analytic solution does not exist for this pore geometry numerical estimates of its permeability were computed using different numerical methods such as lbm fem cfd and voxel based direct navier stokes solvers vbs in saxena et al 2017a based on the different flow solvers saxena et al reported a mean permeability of 7584 millidarcy and a median density of 7485 millidarcy with 225 millidarcy as the standard deviation in the subsequent discussions the reference permeability for the star shaped pore geometry is taken to be k r e f h 7584 millidarcy fig 10 shows the results of permeability estimated using the bounceback bfl interpolated and gzs extrapolated curved boundary schemes it can be observed that the permeability predicted by bounceback and the two curved boundary schemes are relatively close to each other in magnitude this is because the input geometry used in all cases is of a very high resolution 1µm however this may not be the case if the input image is of coarse resolution and where the second order accurate curved boundary schemes would yield more accurate predictions than bounceback the bounceback permeability is also smaller than those predicted by the curved boundary schemes a possible explanation is provided in the following section 4 2 1 effect of surface mesh refinement for an image of a given resolution the solid boundary mesh obtained using the marching cubes algorithm can be further refined to provide a higher fidelity representation of the pore matrix surface for instance as mentioned above at the base resolution around 840 000 triangles represent the solid surface whereas with mesh refinement 1 22 8000 triangles represent the same surface theoretically increasing the number of triangles leads to a smoother surface description and more accurate estimate of the sub grid distance qi for the base resolution surface mesh and the bfl curved boundary scheme a permeability value of k 7406 md was observed while with the refined surface mesh a permeability value of k 7388 md was observed as mentioned before the difference between the permeability obtained using the base and refined meshes is not significant since the base resolution mesh is already of sufficiently high resolution it should also be noted that since the image and numerical grid are uncoupled the numerical lattice grid can be further refined volumetric grid refinement to obtain more accurate estimates of permeability 4 2 2 effect of relaxation time it was shown in our previous work that the single relaxation time bgk collision model and a sub optimal choice of the mrt collision parameters can both lead to permeability predictions that depend on the relaxation parameter τ this parametric dependence is nonphysical for stokes flow in porous media and moreover it also leads to much larger number of iterations required for convergence in order to investigate the dependence on permeability on the relaxation parameter in the context of curved boundary schemes we calculated permeability for the star cross section geometry with different values of τ and using the mrt relaxation parameters as described in rao and schaefer 2019 fig 10 shows the results of this numerical investigation it can be seen that the computed permeability shows a much smaller variance over a wide range of τ indicating that curved boundary schemes with mrt collision model can result in relatively parameter independent permeability 4 3 random packing of spheres random dense packing of identical monodisperse spheres beads is a synthetic porous geometry which serves as a useful canonical geometry for studying its fluid mechanics and also as a benchmark case for numerical validation of flow solvers the permeability of the random sphere packing has been widely investigated by many fluid solvers including lbm using bounceback and the fe fd and fv methods van der hoef et al 2005 talon et al 2012 maier et al 1998 ferréol and rothman 1995 fredrich et al 2006 saxena et al 2017a yang et al 2016 gerke et al 2018 the voxel grid of the sphere pack that was used in this study measures 793 788 791 corresponding to a cubic volume of 5 53mm 3 the pre processing steps involved in conversion of the 3d binary segmented image to the corresponding surface mesh and its voxelization were described in detail in section 3 note that unlike previous numerical experiments with sphere packs where the size number and resolution of the spheres can be parametrically changed in this case the size and the resolution were kept fixed this mirrors the case in a drp context where for a given geological sample the resolution and physical parameters of the sample cannot be changed arbitrarily a simple counting of voxels after generation of the isosurface indicates that the numerical porosity of the sample is 35 66 this compares well with the reported porosity of 36 saxena et al 2017b which indicates that the underlying pore structure is maintained even after the pre processing steps the small difference in porosity may attributed to the fact that very small sub micron pore spaces cannot be fully captured due to resolution limitations similar to our previous work with sphere packs the symmetry boundary condition was applied on domain boundaries that are normal to the flow directions along the flow direction a 10 layer padding is applied at both the inlet and outlet domain to minimize numerical artifacts due to entry and exit effects ferréol and rothman 1995 the flow is driven by applying a uniform pressure difference across the inlet and outlet boundaries using the zou he boundary scheme for the no slip velocity boundary condition bounceback and the bfl and gzs curved boundary conditions as described in section 2 2 are investigated the relaxation parameter is set at τ 1 2 and the rest of the mrt collision parameters follow the rules followed in rao and schaefer 2019 to obtain viscosity independent permeability solutions although the whole domain 7903 is simulated the permeability reported below is based on a slightly smaller sample volume 7503 to remove the artifacts associated with the hanging triangles at the edges of the simulation domain the analyzed sample 7503 is assumed to be of representative elementary volume rev scale this assumption is consistent with previous numerical investigations that suggest that a sample must be of a minimum of 200 3 300 3 volume for darcy s law to be applicable for sandstone and ceramic samples mostaghimi et al 2013 saxena et al 2017b pan et al 2006 therefore given the large size of the computational domain it can be assumed that permeability is independent of the sample volume from the steady state lbm velocity solution the permeability is computed using eqn 15 for example fig 11 shows a snapshot of the velocity field with the sphere pack after 2000 lbm iterations various empirical correlations have been proposed to relate the permeability of the sphere pack to its porosity and diameter of the constituent spheres for example rumpf and gupte proposed the correlation k ϕ 5 5 d 2 5 6 rumpf and gupte 1971 where d is the diameter of the sphere however for reference permeability a value of k r e f s p 280 151 millidarcy was used which is the median value of permeability that was obtained using different numerical fluid solvers lbm and non lbm based on the same 3d image of the sphere pack used in this study saxena et al 2017a table 1 shows the permeability of the sphere pack calculated using the bounceback and the two curved boundary schemes the computed permeability is in broad agreement with the results from other permeability solvers this broad agreement provides evidence of the validation of the code and also of the overall approach of using curved boundary conditions for drp related studies also consistent with other published works the bounceback based permeability values are smaller than those computed with curved boundary schemes fattahi et al 2016 pan et al 2006 saxena et al 2017b this observation may be explained as a result of the stair stepped nature of the pore matrix surface involved in the bounceback simulations where the effective hydraulic diameter of a characteristic pore throat would be slightly smaller than if the surface is represented by a smooth isosurface since a smaller pore volume is available for flow the bounceback based permeability is observed to be smaller a significant difference was not observed between the permeability predicted by the interpolated and extrapolated curved boundary schemes however this observation should be investigated on other pore geometries 4 4 computational aspects given a 3d binary image of arbitrary resolution e g 5003 of 10µm resolution the wall time required to generate a surface mesh of the solid boundary using the marching cubes algorithm is comparatively negligible typical wall times for surface mesh generation for various voxel grid sizes are reported in table 2 and graphically in fig 12 wall times are based on a palabos based custom code running on a single node of rice university s davinci high performance computing cluster each node consists of 12 intel westmere processor cores of 2 83 ghz with 48 gb of ram per node note however that for baseline performance purposes the wall times reported in table 2 are based on running the pre processing operations in serial mode even if the code allows mpi based parallelization for the actual lbm flow simulations four to six nodes of the westmere cluster were used in parallel mode depending upon the queue availability it is evident from fig 12 that it takes less than one minute to obtain a surface mesh from a 5003 image of packed spheres on the other hand the voxelization operation which includes time to compute sub grid distances allocate large blocks of memory for the 3d lattice and initialize flow takes substantially more compute time compared to the time required to obtain a surface mesh specifically it was observed that the time required to compute the sub grid distances requires up to 80 the total time to voxelise issues regarding the relative cost of pre processing over that of the actual flow solver are discussed in the following section 5 discussion and conclusions the question of whether the computed permeability is accurate is multifaceted it is obvious that most natural and synthetic porous media do not have closed form solutions for finding permeability from the numerical solution of the navier stokes equations hence characterizing and quantifying the sources of errors is challenging this is especially true in the drp context since each step in the overall workflow introduces errors and uncertainties dvorkin et al 2011 deviation in computed permeability from experimental values may arise from imaging resolution limitations segmentation and thresholding errors size rev effects boundary and initial conditions errors and numerical artifacts of the flow solver while some of these errors can be rigorously quantified such as errors due to boundary schemes or discretization errors others are human dependent such as errors due to segmentation leu et al 2014 schlüter et al 2014 chhatre et al 2018 wildenschild and sheppard 2013 soulaine et al 2016 the relative contribution of each of the factors to the overall error uncertainty is also challenging to quantify in light of the above constraints the following question arises for a 3d image of fixed resolution does using curved boundary schemes guarantee more accurate permeability solutions compared to those obtained using bounceback the answer mainly depends upon the resolution of the available 3d image if the resolution of the image is of the same order as a characteristic pore throat it is unlikely that the curved boundary schemes would provide any more accurate solutions than bounceback in such cases bounceback may be a better option however if high resolution images are available in which a characteristic pore is resolved by 3 5 voxels curved boundary schemes and the pre processing steps developed in this paper theoretically will provide more accurate solutions moreover for rocks with very low permeability for e g 100 millidarcy very high resolution images are required to capture the sub micron level pore spaces for the permeability calculations to be meaningful saxena et al 2017b nishiyama and yokoyama 2017 hence it is recommended that curved boundary schemes be used only if high resolution tomographic images are available there are of course additional computational costs and complexity involved in using curved boundary schemes as compared to bounceback based simulations clearly the additional steps of generating a surface mesh voxelization and computations of sub grid distance qi at the boundary voxels add to the overall computational costs one could argue that instead of adopting the curved boundary approach to reduce the stairstep effect one could just double the resolution of the original 3d image and then use the simpler bounceback scheme to obtain more accurate estimates of permeability while in theory this approach is reasonable further investigations are required to determine whether the 8x increase in the size of the computational domain resulting from doubling the resolution results in the same order of accuracy as using curved surfaces and at approximately the same computational cost an important yet sometimes underestimated cost is that associated with human intervention due to the tight coupling between the numerical and 3d image discretization a bounceback based solver can be easily integrated and even automated to a large extent within the overall software of the imaging equipment manufacturer fredrich et al 2014 however the use of curved boundary schemes requires solid boundary extraction and mesh cleanup which can be tedious for heterogeneous samples these manual tasks can make automation of the workflow difficult additional memory storage is required for handling and storing large gb sized stl files and for storing sub grid distances in all eighteen directions for all of the boundary voxels sparse memory implementation such as that in palabos along with standardization of image processing and pre processing for certain classes of rocks can mitigate some of these costs and aid automation of the workflow finally perhaps the biggest hurdle that limits the wider adoption of curved boundary schemes is the algorithmic complexity of locating the solid boundary surface within the 3d voxel grid and finding the distance of the surface from the boundary voxel maier and bernard 2010 location of the boundary surface is relatively easier if the surface has an analytic or smooth description such as for spheres or cylinders for example a sphere filling algorithm generates the center locations and radii of the spheres the exact boundary surface is then located with respect to the background lattice using ray sphere or ray cylinder intersection algorithms marschner and shirley 2015 however quickly and efficiently locating arbitrarily shaped triangulated surfaces such as ones obtained via the marching cubes algorithm on mct images of rocks is challenging some of the challenges include the various orientation shape and size of the triangles that must accounted for in a ray triangle intersection algorithm möller and trumbore 2005 this also involves software engineering challenges of producing a code that is robust scalable and efficient for large 3d domains the workflow and the palabos based code developed in this work address some of these challenges future tasks include comparison of the accuracy of each of the curved boundary schemes scaling tests and rigorous validation on a larger and more complex set of reservoir rock images credit authorship contribution statement parthib rao conceptualization methodology software validation investigation data curation writing original draft visualization laura schaefer conceptualization methodology validation resources writing review editing supervision declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments financial support from the energy and environment institute eei at rice university is gratefully acknowledged this work was supported in part by the data analysis and visualization cyber infrastructure funded by the national science foundation nsf under grant oci 0959097 and rice university we also thank the developers of palabos for their technical assistance berg lopez berland 2017 c f berg o lopez h berland industrial applications of digital rock technology j petrol sci eng 157 2017 131 147 berg c f lopez o berland h 2017 industrial applications of digital rock technology journal of petroleum science and engineering 157 131 147 bouzidi firdaouss lallemand 2001 m bouzidi m firdaouss p lallemand momentum transfer of a boltzmann lattice fluid with boundaries phys fluids 13 11 2001 3452 3459 bouzidi m firdaouss m lallemand p 2001 momentum transfer of a boltzmann lattice fluid with boundaries physics of fluids 13 11 3452 3459 bultreys de boever cnudde 2016 t bultreys w de boever v cnudde imaging and image based fluid transport modeling at the pore scale in geological materials a practical introduction to the current state of the art earth sci rev 155 2016 93 128 bultreys t de boever w cnudde v 2016 imaging and image based fluid transport modeling at the pore scale in geological materials a practical introduction to the current state of the art earth science reviews 155 93 128 chen martínez mei 1996 s chen d martínez r mei on boundary conditions in lattice boltzmann methods phys fluids 8 9 1996 2527 2536 10 1063 1 869035 chen s martínez d mei r 1996 on boundary conditions in lattice boltzmann methods phys fluids 8 9 2527 2536 10 1063 1 869035 chhatre sahoo leonardi vidal rainey braun patel et al 2018 s s chhatre h sahoo s leonardi k vidal j rainey e m braun p patel a blind study of four digital rock physics vendor laboratories on porosity absolute permeability and primary drainage capillary pressure data on tight outcrops petrophysics 59 01 2018 15 24 chhatre s s sahoo h leonardi s vidal k rainey j braun e m patel p et al 2018 a blind study of four digital rock physics vendor laboratories on porosity absolute permeability and primary drainage capillary pressure data on tight outcrops petrophysics 59 01 15 24 chun ladd 2007 b chun a ladd interpolated boundary condition for lattice boltzmannsimulations of flows in narrow gaps phys rev e 75 6 2007 066705 chun b ladd a 2007 interpolated boundary condition for lattice boltzmann simulations of flows in narrow gaps physical review e 75 6 066705 dhumières 2002 d dhumières multiple relaxation time lattice boltzmann models in three dimensions philos trans r soc lond a 360 1792 2002 437 451 dhumières d 2002 multiple relaxation time lattice boltzmann models in three dimensions philosophical transactions of the royal society of london a mathematical physical and engineering sciences 360 1792 437 451 dvorkin derzhi diaz fang 2011 j dvorkin n derzhi e diaz q fang relevance of computational rock physics geophysics 76 5 2011 e141 e153 dvorkin j derzhi n diaz e fang q 2011 relevance of computational rock physics geophysics 76 5 e141 e153 dvorkin fang derzhi 2012 j dvorkin q fang n derzhi etudes in computational rock physics alterations and benchmarkingetudes in computational rock physics geophysics 77 3 2012 d45 d52 dvorkin j fang q derzhi n 2012 etudes in computational rock physics alterations and benchmarkingetudes in computational rock physics geophysics 77 3 d45 d52 eshghinejadfard daróczy janiga thévenin 2016 a eshghinejadfard l daróczy g janiga d thévenin calculation of the permeability in porous media using the lattice boltzmann method int j heat fluid flow 62 2016 93 103 eshghinejadfard a daróczy l janiga g thévenin d 2016 calculation of the permeability in porous media using the lattice boltzmann method international journal of heat and fluid flow 62 93 103 fattahi waluga wohlmuth rüde manhart helmig 2016 e fattahi c waluga b wohlmuth u rüde m manhart r helmig lattice boltzmann methods in porous media simulations from laminar to turbulent flow comput fluids 140 2016 247 259 fattahi e waluga c wohlmuth b rüde u manhart m helmig r 2016 lattice boltzmann methods in porous media simulations from laminar to turbulent flow computers fluids 140 247 259 ferréol rothman 1995 b ferréol d h rothman lattice boltzmann simulations of flow through fontainebleau sandstone transp porous media 20 1 1995 3 20 10 1007 bf00616923 ferréol b rothman d h 1995 lattice boltzmann simulations of flow through fontainebleau sandstone transport in porous media 20 1 3 20 10 1007 bf00616923 filippova hänel 1998 o filippova d hänel grid refinement for lattice bgk models j comput phys 147 1 1998 219 228 filippova o hänel d 1998 grid refinement for lattice bgk models journal of computational physics 147 1 219 228 fredrich digiovanni noble 2006 j fredrich a digiovanni d noble predicting macroscopic transport properties using microscopic image data j geophys res 111 b3 2006 fredrich j digiovanni a noble d 2006 predicting macroscopic transport properties using microscopic image data journal of geophysical research solid earth 111 b3 fredrich lakshtanov lane liu natarajan ni toms et al 2014 j t fredrich d lakshtanov n lane e b liu c natarajan d m ni j toms digital rocks developing an emerging technology through to a proven capability deployed in the business spe annual technical conference and exhibition 2014 society of petroleum engineers fredrich j t lakshtanov d lane n liu e b natarajan c ni d m toms j et al 2014 digital rocks developing an emerging technology through to a proven capability deployed in the business in spe annual technical conference and exhibition society of petroleum engineers gerke vasilyev khirevich collins karsanina sizonenko korost lamontagne mallants 2018 k m gerke r v vasilyev s khirevich d collins m v karsanina t o sizonenko d v korost s lamontagne d mallants finite difference method stokes solver fdmss for 3d pore geometries software development validation and case studies comput geosci 114 2018 41 58 gerke k m vasilyev r v khirevich s collins d karsanina m v sizonenko t o korost d v lamontagne s mallants d 2018 finite difference method stokes solver fdmss for 3d pore geometries software development validation and case studies computers geosciences 114 41 58 ginzbourg adler 1994 i ginzbourg p adler boundary flow condition analysis for the three dimensional lattice boltzmann model j phys ii 4 2 1994 191 214 ginzbourg i adler p 1994 boundary flow condition analysis for the three dimensional lattice boltzmann model journal de physique ii 4 2 191 214 ginzburg dhumieres 2003 i ginzburg d dhumieres multireflection boundary conditions for lattice boltzmann models phys rev e 68 6 2003 066614 ginzburg i dhumieres d 2003 multireflection boundary conditions for lattice boltzmann models physical review e 68 6 066614 guo shu 2013 z guo c shu lattice boltzmann method and its applications in engineering 3 2013 world scientific guo z shu c 2013 lattice boltzmann method and its applications in engineering vol 3 world scientific guo zheng shi 2002 z guo c zheng b shi an extrapolation method for boundary conditions in lattice boltzmann method phys fluids 14 6 2002 2007 2010 guo z zheng c shi b 2002 an extrapolation method for boundary conditions in lattice boltzmann method physics of fluids 14 6 2007 2010 van der hoef beetstra kuipers 2005 m a van der hoef r beetstra j kuipers lattice boltzmann simulations of low reynolds number flow past mono and bidisperse arrays of spheres results for the permeability and drag force j fluid mech 528 2005 233 254 van der hoef m a beetstra r kuipers j 2005 lattice boltzmann simulations of low reynolds number flow past mono and bidisperse arrays of spheres results for the permeability and drag force journal of fluid mechanics 528 233 254 jia williams 2001 x jia r a williams a packing algorithm for particles of arbitrary shapes powder technol 120 3 2001 175 186 jia x williams r a 2001 a packing algorithm for particles of arbitrary shapes powder technology 120 3 175 186 jodrey tory 1985 w jodrey e tory computer simulation of close random packing of equal spheres phys rev a 32 4 1985 2347 jodrey w tory e 1985 computer simulation of close random packing of equal spheres physical review a 32 4 2347 jones feng 2016 b jones y feng effect of image scaling and segmentation in digital rock characterisation comput part mech 3 2 2016 201 213 jones b feng y 2016 effect of image scaling and segmentation in digital rock characterisation computational particle mechanics 3 2 201 213 kainourgiakis kikkinides galani charalambopoulou stubos 2005 m kainourgiakis e kikkinides a galani g c charalambopoulou a stubos digitally reconstructed porous media transport and sorption properties transp porous media 58 1 2 2005 43 62 kainourgiakis m kikkinides e galani a charalambopoulou g c stubos a 2005 digitally reconstructed porous media transport and sorption properties transport in porous media 58 1 2 43 62 kao yang 2008 p h kao r j yang an investigation into curved and moving boundary treatments in the lattice boltzmann method j comput phys 227 11 2008 5671 5690 kao p h yang r j 2008 an investigation into curved and moving boundary treatments in the lattice boltzmann method journal of computational physics 227 11 5671 5690 khirevich ginzburg tallarek 2015 s khirevich i ginzburg u tallarek coarse and fine grid numerical behavior of mrt trt lattice boltzmann schemes in regular and random sphere packings j comput phys 281 2015 708 742 khirevich s ginzburg i tallarek u 2015 coarse and fine grid numerical behavior of mrt trt lattice boltzmann schemes in regular and random sphere packings journal of computational physics 281 708 742 knackstedt arns limaye sakellariou senden sheppard sok pinczewski bunn et al 2004 m knackstedt c arns a limaye a sakellariou t senden a sheppard r sok w v pinczewski g bunn digital core laboratory properties of reservoir core derived from 3d images spe asia pacific conference on integrated modelling for asset management 2004 society of petroleum engineers knackstedt m arns c limaye a sakellariou a senden t sheppard a sok r pinczewski w v bunn g et al 2004 digital core laboratory properties of reservoir core derived from 3d images in spe asia pacific conference on integrated modelling for asset management society of petroleum engineers krüger kusumaatmaja kuzmin shardt silva viggen 2017 t krüger h kusumaatmaja a kuzmin o shardt g silva e m viggen the lattice boltzmann method 2017 krüger t kusumaatmaja h kuzmin a shardt o silva g viggen e m 2017 the lattice boltzmann method lallemand luo 2003 p lallemand l s luo lattice boltzmann method for moving boundaries j comput phys 184 2 2003 406 421 lallemand p luo l s 2003 lattice boltzmann method for moving boundaries journal of computational physics 184 2 406 421 leu berg enzmann armstrong kersten 2014 l leu s berg f enzmann r t armstrong m kersten fast x ray micro tomography of multiphase flow in berea sandstone a sensitivity study on image processing transp porous media 105 2 2014 451 469 leu l berg s enzmann f armstrong r t kersten m 2014 fast x ray micro tomography of multiphase flow in berea sandstone a sensitivity study on image processing transport in porous media 105 2 451 469 lewiner lopes vieira tavares 2003 t lewiner h lopes a w vieira g tavares efficient implementation of marching cubes cases with topological guarantees j graph tools 8 2 2003 1 15 lewiner t lopes h vieira a w tavares g 2003 efficient implementation of marching cubes cases with topological guarantees journal of graphics tools 8 2 1 15 lorensen cline 1987 w e lorensen h e cline marching cubes a high resolution 3d surface construction algorithm siggraph comput graph 21 4 1987 163 169 10 1145 37402 37422 lorensen w e cline h e 1987 marching cubes a high resolution 3d surface construction algorithm siggraph comput graph 21 4 163 169 10 1145 37402 37422 luo krafczyk shyy 2010 l s luo m krafczyk w shyy lattice boltzmann method for computational fluid dynamics encyclopedia of aerospace engineering 2010 651 660 luo l s krafczyk m shyy w 2010 lattice boltzmann method for computational fluid dynamics encyclopedia of aerospace engineering 651 660 maier bernard 2010 r maier r bernard lattice boltzmann accuracy in pore scale flow simulation j comput phys 229 2 2010 233 255 maier r bernard r 2010 lattice boltzmann accuracy in pore scale flow simulation journal of computational physics 229 2 233 255 maier kroll kutsovsky davis bernard 1998 r s maier d kroll y kutsovsky h davis r s bernard simulation of flow through bead packs using the lattice boltzmann method phys fluids 10 1 1998 60 74 maier r s kroll d kutsovsky y davis h bernard r s 1998 simulation of flow through bead packs using the lattice boltzmann method physics of fluids 10 1 60 74 manwart aaltosalmi koponen hilfer timonen 2002 c manwart u aaltosalmi a koponen r hilfer j timonen lattice boltzmann and finite difference simulations for the permeability for three dimensional porous media phys rev e 66 1 2002 016702 manwart c aaltosalmi u koponen a hilfer r timonen j 2002 lattice boltzmann and finite difference simulations for the permeability for three dimensional porous media physical review e 66 1 016702 marschner shirley 2015 s marschner p shirley fundamentals of computer graphics 2015 crc press marschner s shirley p 2015 fundamentals of computer graphics crc press mavko mukerji dvorkin 2009 g mavko t mukerji j dvorkin the rock physics handbook tools for seismic analysis of porous media 2009 cambridge university press mavko g mukerji t dvorkin j 2009 the rock physics handbook tools for seismic analysis of porous media cambridge university press mazzeo coveney 2008 m d mazzeo p v coveney hemelb a high performance parallel lattice boltzmanncode for large scale fluid flow in complex geometries comput phys commun 178 12 2008 894 914 mazzeo m d coveney p v 2008 hemelb a high performance parallel lattice boltzmann code for large scale fluid flow in complex geometries computer physics communications 178 12 894 914 mei luo shyy 1999 r mei l s luo w shyy an accurate curved boundary treatment in the lattice boltzmann method j comput phys 155 2 1999 307 330 mei r luo l s shyy w 1999 an accurate curved boundary treatment in the lattice boltzmann method journal of computational physics 155 2 307 330 möller trumbore 2005 t möller b trumbore fast minimum storage ray triangle intersection acm siggraph 2005 courses 2005 acm 7 möller t trumbore b 2005 fast minimum storage ray triangle intersection in acm siggraph 2005 courses acm p 7 mostaghimi blunt bijeljic 2013 p mostaghimi m j blunt b bijeljic computations of absolute permeability on micro ct images math geosci 45 1 2013 103 125 mostaghimi p blunt m j bijeljic b 2013 computations of absolute permeability on micro ct images mathematical geosciences 45 1 103 125 mussa asinari luo 2009 a mussa p asinari l s luo lattice boltzmann simulations of 2d laminar flows past two tandem cylinders j comput phys 228 4 2009 983 999 mussa a asinari p luo l s 2009 lattice boltzmann simulations of 2d laminar flows past two tandem cylinders journal of computational physics 228 4 983 999 nishiyama yokoyama 2017 n nishiyama t yokoyama permeability of porous media role of the critical pore size j geophys res 122 9 2017 6955 6971 nishiyama n yokoyama t 2017 permeability of porous media role of the critical pore size journal of geophysical research solid earth 122 9 6955 6971 pan luo miller 2006 c pan l s luo c t miller an evaluation of lattice boltzmann schemes for porous medium flow simulation comput fluids 35 8 9 2006 898 909 pan c luo l s miller c t 2006 an evaluation of lattice boltzmann schemes for porous medium flow simulation computers fluids 35 8 9 898 909 patil ravi 2005 s patil b ravi voxel based representation display and thickness analysis of intricate shapes ninth international conference on computer aided design and computer graphics cad cg 05 2005 ieee 6 pp patil s ravi b 2005 voxel based representation display and thickness analysis of intricate shapes in ninth international conference on computer aided design and computer graphics cad cg 05 ieee pp 6 pp powell 1980 m powell computer simulated random packing of spheres powder technol 25 1 1980 45 52 powell m 1980 computer simulated random packing of spheres powder technology 25 1 45 52 rao schaefer 2019 p rao l schaefer lattice boltzmann models for micro tomographic pore spaces comput fluids 193 2019 104294 10 1016 j compfluid 2019 104294 rao p schaefer l 2019 lattice boltzmann models for micro tomographic pore spaces computers fluids 193 104294 10 1016 j compfluid 2019 104294 rumpf gupte 1971 h rumpf a gupte influences the porosity at and grain size ö ss distribution in the law of resistance of the pore chem eng technol 43 6 1971 367 375 rumpf h gupte a 1971 influences the porosity at and grain size ö ss distribution in the law of resistance of the pore chemical engineering technology 43 6 367 375 saxena saxena n 2017 data for references and benchmarks for pore scale flow simulated using micro ct images of porous media and digital rocks 10 17632 4g723tr5v3 2 saxena hofmann alpak berg dietderich agarwal tandon hunter freeman wilson 2017 n saxena r hofmann f o alpak s berg j dietderich u agarwal k tandon s hunter j freeman o b wilson and benchmarks for pore scale flow simulated using micro ct images of porous media and digital rocks adv water resour 109 2017 211 235 saxena n hofmann r alpak f o berg s dietderich j agarwal u tandon k hunter s freeman j wilson o b 2017a 
443,the lattice boltzmann method lbm is a widely used numerical technique for simulation of single and two phase flow in geometries that are obtained using tomographic imaging of natural porous media due to ease of implementation and numerical robustness a vast majority of lbm based pore scale simulations employ the so called bounceback scheme to enforce no slip velocity boundary condition bounceback however requires an implicit and tight coupling between the numerical computational and image voxel grid this coupling results in large discretization errors since the pore matrix interface within the 3d image is rough this leads to overestimation of the interfacial area and thereby inaccurate permeability predictions the use of the bounceback scheme also causes other numerical artifacts such as viscosity dependent permeability results in order to address these deficiencies in this work the classical marching cubes algorithm is used to reconstruct a surface mesh from the 3d voxel grid this mesh approximates the pore matrix surface with higher accuracy compared to the inherent stair stepped representation in addition nominally second order accurate curved boundary schemes are used to enforce no slip velocity conditions at the reconstructed pore matrix interface the various pre processing steps such as surface mesh generation and voxelization that are necessary to use curved boundary schemes are described in detail the proposed approach of using curved surfaces and boundary schemes is tested and validated on benchmark pore geometries including a random packing of monodisperse spheres we conclude that compared to current methods curved boundary schemes provide a viable option for obtaining more accurate transport properties for digital rock physics based applications keywords lattice boltzmann method digital rock physics permeability pore scale flow simulations boundary conditions 1 introduction and motivation digital rock physics drp is an approach in which high resolution 3d images along with sophisticated modeling and simulation methods are used to numerically compute petrophysical properties of geologic porous media such as reservoir rocks properties that can be computed include absolute intrinsic permeability relative permeability capillary pressure electrical properties elastic moduli and formation factors berg et al 2017 knackstedt et al 2004 mavko et al 2009 dvorkin et al 2012 saxena et al 2017a kainourgiakis et al 2005 fredrich et al 2014 the 3d images can be obtained from microtomography mct scanning electron microscopy sem or synthetically using statistical reconstruction procedures with lower cost computing and imaging equipment and better numerical methods drp technology has the potential to provide a cheaper faster and accurate alternative to services provided by conventional laboratory techniques permeability is one of the fundamental properties of a porous medium and is needed for investigating a variety of processes such as multi phase oil and gas flow groundwater flow and in general any processes modeled using darcy s law in this study the focus is on numerical computation of permeability of a porous medium with single phase flow under darcian continuum theory the lattice boltzmann method lbm is a widely used numerical method for computation of intrinsic permeability in pores spaces obtained using direct imaging ferréol and rothman 1995 fredrich et al 2006 2014 knackstedt et al 2004 manwart et al 2002 saxena et al 2017b after tomographic imaging of a sample a cubic voxel of the 3d image is segmented such that each voxel is labeled as either a pore or a matrix the resulting pore matrix interface henceforth called the solid boundary is inherently rough and stair step patterned and represents the surface roughness of the sample at a length scale comparable to the resolution of the image since the pore space is already spatially discretized in terms of the image voxels the segmented binary image lends itself immediately to simulations via the lbm resulting in a tight coupling of the voxel and the numerical grids the additional pre processing tasks such as surface mesh extraction and volume meshing that are required in traditional finite element finite volume based approaches to drp are not required in lbm pre processing of complex geologic porous geometries can be tedious and difficult to scale and automate the coupling of voxel and numerical grids leads to an ease of programming of the solver this feature along with the localized nature of the algorithm that enables good parallel scalability and explicit time stepping etc makes the lbm a suitable numerical solver for rapid and routine analysis of industrial scale 5123 samples with minimal user interface one of the main challenges however is the accuracy of the numerical simulations the scheme used to enforce a no slip velocity dirichlet condition on the solid boundary the so called bounceback scheme is major source of the overall error the bounceback scheme follows a simple heuristic rule a distribution reverses its momentum when colliding with a solid boundary at rest the simplicity of implementation of the bounceback boundary scheme has been one of the major contributors in the popularity of the lbm the simplicity of the approach is that one simply needs to label a voxel as a solid or fluid and no additional numerical procedure is required although it is numerically robust the use of bounceback for complex and curved solid boundaries leads to errors from two sources the first source is the modeling error due to approximation of a curved boundary surface by a stair case shape geometrical discretization error this error leads to first order spatial accuracy for boundaries that are not aligned with the lattice vectors a simple approach to reduce the discretization error is to increase the resolution of the image however in many cases this approach may not be feasible due to practical imaging equipment constraints the second source of error is more subtle but well documented in the lbm literature chen et al 1996 ginzbourg and adler 1994 skordos 1993 when the bounceback scheme is used in conjunction with the single relaxation time or the bhatnagar gross krook bgk collision model the exact physical location of the solid boundary i e the location where the flow velocity is exactly equal to 0 depends on the relaxation time τ the relaxation time is a parameter in the bgk collision operator that numerically sets the kinematic viscosity of the fluid via the relation ν τ 0 5 3 with the bounceback bgk combination the exact location of the solid boundary can be derived analytically only for very simple cases for instance the solid boundary lies exactly one half grid distance beyond the fluid voxel if τ 1 and the solid boundary and lattice links are parallel luo et al 2010 in general the exact location of the solid boundary where flow velocity is exactly zero is a complex function of the collision operators relaxation parameters and implementation details in the porous media context it follows that the effective pore volume that is available for flow is a function of viscosity making permeability a function of viscosity a violation of physical behavior since τ controls both the kinematic viscosity and solution accuracy the computed permeability is said to be viscosity dependent the use of the multiple relaxation time mrt collision kernel can reduce the nonphysical dependence of permeability on viscosity via an optimal choice of relaxation parameters rao and schaefer 2019 however geometrical discretization errors due to the stair step nature of the solid boundary still remain accurate treatment of the pore matrix interface or solid boundary is essential due to the high surface to volume ratios typical of a geologic porous medium even small variations in the pore volume or surface can cause large changes in the computed permeability in contrast to the bounceback scheme curved boundary schemes with second order nominal accuracy offer enhanced accuracy at a small computational and user effort while broadly maintaining the ease of use of the lbm maier and bernard 2010 pan et al 2006 in general curved boundary schemes involve interpolations or extrapolations to obtain unknown distributions at the boundary voxels they also require computation of the distance from the boundary voxel to the solid boundary along each lattice vector sub grid distance to account for the complex shape of the solid boundary these schemes have been used within the lbm community to study aerodynamics krüger et al 2017 guo and shu 2013 mussa et al 2009 hemodynamics mazzeo and coveney 2008 and to a much smaller extent pore scale flow in porous media maier and bernard 2010 pan et al 2006 yang et al 2016 van der hoef et al 2005 the pore scale flow studies conducted so far employ solid boundaries that are smooth surfaces and mathematically precise and which are obtained either using 3d cad or using sphere filling packing algorithms e g random packing of spheres jia and williams 2001 jodrey and tory 1985 powell 1980 visscher and bolsterli 1972 in addition to approximating a porous medium as a collection of smooth spheres these studies focused mainly on the fundamental fluid mechanics and the associated drag coefficients in prototype porous media eshghinejadfard et al 2016 fattahi et al 2016 khirevich et al 2015 maier et al 1998 talon et al 2012 van der hoef et al 2005 however the situation in the drp context is rather different the simulation geometry for a realistic geologic porous medium cannot be generated using cad or sphere packing algorithms therefore the extension of curved boundary schemes and the associated workflow to the more practical and challenging cases of voxel based pore geometries remains unaddressed therefore the main aim of this work is to apply second order accurate curved boundary schemes instead of the first order bounceback scheme to estimate the permeability of a complex and realistic porous medium represented via its binary 3d image the proposed methodology involves additional pre processing steps such as generation of surface and voxel meshes and sub grid distance estimations which are required to convert the tomographic images into a format amenable for lbm computations using curved boundaries schemes the rest of the paper is organized as follows in section 2 the essential details of the lb method are described along with a description of the two major categories of curved boundary conditions in section 3 the various steps involved in converting a 3d binary tomographic image into a format that is amenable to lbm calculations with curved boundary schemes are detailed in section 4 the results obtained from the numerical experimentation on two representative porous structures are discussed and in section 5 the resulting conclusions are presented 2 numerical methodology 2 1 overview of mrt lbe compared to the classical approach of directly solving the navier stokes equations to model isothermal incompressible flow the lattice boltzmann equation lbe is based on kinetic theory and the boltzmann equation krüger et al 2017 the lbe tracks the evolution of the discrete velocity distribution function fi x t at position x time t and discrete velocity c i 1 f i x c i δ t t δ t f i x t ω i f i 0 1 q 1 in the above equation ω i f is the discrete collision model δt is the temporal discretization step and q is the total number of discrete velocities in the chosen lattice in this work the lbe with the multiple relaxation time mrt collision model is used the mrt collision model is based on the generalized lattice boltzmann equation glbe method where the streaming of the populations occurs in the velocity space and the collision occurs in the moment space which is spanned by the orthogonal eigenvectors basis of the collision operator dhumières 2002 luo et al 2010 the mrt collision operator is expressed as in vector form 2 ω m 1 s m f f eq m 1 s m m eq where m is a q q matrix that linearly transforms the q dimensional vector of distribution function f from the velocity space to a q dimensional vector m in the moment space 3 m m f f m 1 m the lbe mrt equation is therefore given as 4 f x c i δ t t δ t f x t m 1 s m m eq δ t the rows of the transformation matrix m for the d3q19 lattice which consists of 19 orthogonal basis vectors in three dimensions and the functional form of the equilibrium moments m eq employed in this study can be found in rao and schaefer 2019 the relaxation rate matrix s is a q q diagonal matrix which consists of the relaxation rate for each corresponding moment and which are the eigenvalues of the collision operator m 1 s m 5 s diag 0 s e s ϵ 0 s q 0 s q 0 s q s ν s π s ν s π s ν s ν s ν s m s m s m the relaxation rates si determine the transport coefficients in the system the relaxation rate s ν 1 τ is related to the kinematic viscosity ν via ν c s 2 1 s ν 0 5 δ t for isothermal hydrodynamics c s 2 c 2 3 where c δx δt and τ is the relaxation time parameter the remaining relaxation rates se s ϵ sq sπ and sm can be set in the range 0 si 2 in order to improve the accuracy and stability rao and schaefer 2019 the lbe usually employs a uniform cartesian volumetric grid lattice such that if x is a node of the grid x c i δ t is also a grid node space and time steps are generally set as δ x δ t 1 in the drp context such a lattice coincides with a discretization of the voxel grid computationally the lbe mrt is solved in two steps 6 c o l l i s i o n f x t f x t m 1 s m m eq δ t streaming f x c i δ t t δ t f x t the macroscopic fluid density ρ and velocity u are the zeroth and first order moments of fi respectively 7 ρ x t i f i x t ρ u x t i c i f i x t flow in the simulation domain can be initiated either by applying pressure boundary conditions at the simulation domain boundaries or using volumetric body forcing a detailed discussion of both these methods along can be found in krüger et al 2017 and guo and shu 2013 2 2 curved boundary schemes the central idea behind curved boundary schemes is to take into account the position of a reconstructed solid boundary with respect to the underlying voxel grid in this way these schemes approximate the body fitted mesh technique used in fe fv based approaches consider an idealized situation in 2d where a smooth curve a surface in 3d is overlaid on a regular cartesian mesh lattice as shown in fig 1 a in the drp context the solid boundary is approximated by a discrete triangulated surface which is overlaid on a 3d lattice the procedure to obtain a triangulated surfaces from mct images will be described in section 3 as shown in fig 1 c consider a solid boundary located at an arbitrary position x w on a lattice link connecting a node in the non fluid solid zone x s and a node in the fluid zone x b the nodes in the fluid zone which lie adjacent to the solid boundary are designated as boundary nodes x b they have links connecting interior fluid nodes x f x b c i δ t on one side of the link and nodes in the solid region x s x b c i δ t on the other side suppose the population fi is streaming from x b toward the solid boundary with momentum c i the reversed momentum from x w to x b is c i c i after collision at time t populations f i x b t are known however to finish the streaming process at x b at time t δ t an estimate for f i x b t δ t is needed thus the central task for curved boundary schemes is to devise methods to approximate f i x b t δ t various curved boundary schemes have been proposed which differ in their methods to estimate f i x b t δ t these can be classified into two broad categories interpolation based and extrapolation based schemes in the interpolated boundary schemes f i x b t δ t is constructed from information post collision populations located within the fluid zone while in the extrapolated schemes information constructed at the nodes in the solid zone is utilized the basic approaches for these two categories are outlined below 2 2 1 interpolation based schemes the most widely used curved boundary scheme is the bfl scheme named after the authors which is a combination of 1d spatial interpolation and the bounceback rule bouzidi et al 2001 the basic idea is as follows define a parameter q x b x w x b x s as the fraction of an intersected lattice vector that lies in the fluid region thus x w x b q c i δ t since x x w c i δ t as shown in fig 1 c it is clear that 0 q 1 intuitively q captures the location of the solid boundary in reference to the underlying voxel grid as per the standard lbe each population fi travels at distance of c i δt during the steaming process if a solid boundary is located exactly halfway q 1 2 between x b and x s as is modeled by the halfway bounceback rule then it follows that the populations travel a distance of c i δt 2 from x b to x w and an additional distance of c i δt 2 from x w back to the x b after the bounceback however when the solid boundary is not located halfway between x b and x s q 1 2 a particle streaming from x b towards the solid boundary cannot be reflected back exactly to x b within a time span δt in fact as shown in fig 1 c depending upon the value of q the reflected population would end up at a fictitious location x d because x d is not a lattice node populations need to be constructed depending upon the value of q using interpolations of known post collision populations at x b and x f thus if linear interpolation is used f i x b t δ t is constructed as bouzidi et al 2001 8 f i x b t δ t 2 q i f i x b t 1 2 q i f i x f t q 1 2 1 2 q i f i x b t 2 q i 1 q i f i x b t q 1 2 the bfl scheme has second order spatial accurate for arbitrarily shaped solid boundaries and can be used with any collision operator from an implementation point of view eq 8 requires only a two point stencil of nodes all of which lie within the fluid zone more details can be found in guo and shu 2013 and bouzidi et al 2001 due to the use of interpolation the bfl scheme leads to errors in mass conservation near the boundaries in the drp context though this error is negligible due to very low mass flow rates within the porous medium several improvements to the original bfl schemes have been proposed to address its shortcomings these include schemes that conserve mass schemes such as the interpolation free scheme kao and yang 2008 ginzburg and dhumieres 2003 schemes with a smaller computational stencil chun and ladd 2007 tao et al 2018 etc however most of these schemes involve additional computational complexities for implementation especially when considering the tortuous nature of the solid boundaries and very large computations domains it should be noted that while the geometric discretization error is reduced using the bfl scheme when it used in conjunction with the bgk operator the slip errors still persist i e the wall location depends on the relaxation parameter τ this can be remedied to a large extent using the bfl scheme with the multi relaxation time mrt collision operator lallemand and luo 2003 along with carefully chosen relaxation parameters hence in the current work the bfl scheme is implemented as described by eq 8 along with the mrt collision operator 2 2 2 extrapolation based schemes in the extrapolation based approach distributions are reconstructed on nodes which lie outside the fluid domain i e on nodes that lie in the solid zone but which are connected to boundary nodes in the fluid zone x b by a lattice vector a widely used extrapolation based scheme was proposed by guo et al 2002 according to this scheme populations are constructed on solid nodes x s instead of on x b as in the bfl scheme 9 f i x s t f i e q x s t f i n e q x s t where f i e q and f i n e q are the equilibrium and non equilibrium parts of distributions respectively the equilibrium distributions are constructed according to the standard isothermal equilibrium distributions f i e q x s t f i e q ρ s u s the density ρs ρ x s t and the velocity u s u x s t that are required to calculate the equilibrium distributions at the solid nodes are extrapolated from nodes within the fluid zone for density it is proposed to use ρ x s t ρ x b t and for velocity guo et al 2002 10 u x s t q u 1 1 q u 2 q 3 4 u 1 q 3 4 where u 1 and u 2 are obtained using velocity values at the fluid nodes x b and x f thus making this a three point stencil scheme 11 u 1 u x w t q 1 u x b t q 12 u 2 2 u x w t q 1 u x f t q 1 note that for the usual no slip velocity condition u w u x w 0 in the gzs scheme in addition to equilibrium distributions the non equilibrium distributions are calculated as 13 f i n e q x s t q f i n e q x b t 1 q f i n e q x f t q 3 4 q f i n e q x b t q 3 4 once f i x s t are constructed regular streaming and collision is performed on all nodes including the solid nodes x s once streaming is performed at x s at time t f i x b t δ t is obtained which is the goal for all curved boundary schemes whether interpolation or extrapolation based several other schemes based on idea of extrapolation reconstructing f i x s t have been proposed they differ mainly in the way the velocity is extrapolated xu et al 2016 filippova and hänel 1998 mei et al 1999 tiwari and vanka 2012 3 preprossessing workflow in order to implement curved boundary schemes in drp context a series of steps are required to convert a 3d mct image of a sample into a format suitable for a lbm solver that implements a curved boundary scheme the tomographic images are assumed to be already segmented so that each voxel is classified either a solid or fluid the steps required to convert raw tomographic images into a binary one consists of image processing steps such as denoising filtering thresholding etc image processing in itself is a wide and active area of research within the drp community more details of recent developments in this field can be found in bultreys et al 2016 verri et al 2017 schlüter et al 2014 and saxena et al 2017b in the following sub sections the preprocessing steps are first described using an example of a 3d image of a random packing of spheres the entire simulation workflow for computing permeability is summarized in fig 2 the dataset consists of 793 images in bmp file format each of size 788x791 the image resolution is 7 μm and the reported porosity of the sample is ϕ 0 34 fig 3 a and b show a cross sectional view in the direction of applied forcing of the sphere pack and its 3d rendering respectively these image data were obtained from the supplementary data published in saxena et al 2017a which is also available online at saxena 2017 3 1 surface meshing image to surface mesh after the two regions of interest pore and matrix are obtained using image segmentation the corresponding pore matrix interface which represents the solid boundary surface must be extracted or reconstructed in the workflow for this study the first step consists of converting the 3d image which is available in the bmp file format into the ascii dat txt file format this is done using a python script that assigns values of 0 1 2 for fluid bounceback and solid voxels respectively each voxel is categorized according to the following rule a fluid voxel is one whose neighbors are fluid voxels in all eighteen lattice vector directions similarly for solid voxels a bounceback voxel on the other hand has at least one neighbor in the eighteen lattice direction that is a fluid voxel fig 3 b shows the pictorial representation of the voxel categorization process the resulting dat file forms the input to permeability calculation using bounceback boundary conditions rao and schaefer 2019 in bounceback based simulations regular lbm operations streaming and collision are performed on fluid voxels bounceback operations are performed on bounceback voxels and no computations are performed on solid voxels the second step in the workflow is to extract an isosurface using themarching cubes mc algorithm lorensen and cline 1987 wenger 2013 an isosurface is defined as follows given a 3d scalar field f x a surface that satisfies f x σ is called an isosurface and σ is called the isovalue the core idea of the marching cubes algorithm is that a voxel cube can be defined by the pixel values at the eight corners of the cube if one or more pixels of a cube have values less than the user specified isovalue and one or more have values greater than this value it can be inferred that the voxel contributes a fraction of the isosurface by determining which edges of the cube are intersected by the isosurface triangular patches can be created which divide the voxel between regions inside and outside the isosurface by connecting the triangular patches from all cubes on the isosurface boundary the overall isosurface mesh is obtained which is described in terms of its constituent triangles the mesh data is generally stored in a ascii or binary stl file format for drp by applying the mc algorithm to a 3d image which is essentially a 3d scalar field a surface is obtained that approximates the solid boundary and which forms the input for subsequent lbm computations fig 4 a shows a 3d view of the isosurface mesh of the solid boundary of the random packing of spheres and fig 4 b shows a closeup of a section in this work an implementation of the classical marching cubes algorithm available within the palabos framework team 2009 2017 is used alternatives include commercial software such as mimics and avizo and free software such as imagej and cgal it should be noted that in many cases the classical marching cubes algorithms results in non manifold surface meshes which can lead to meshing related errors since manifold or water tight meshes are required for the lbm simulations in cases where non manifold surface meshes are generated the meshmixer tool can be used to repair the mesh or more sophisticated isosurfacing algorithms can be used that guarantee topological properties i e produce isosurfaces without cracks holes and other discontinuities lewiner et al 2003 3 1 1 choice of isovalue the isovalue is an important user specified parameter value that determines whether a voxel is either inside or outside the surface in the drp context the isovalue dictates the exact location of the solid boundary within the voxel grid artificial smoothing of the pore spaces especially in throat region can change the overall pore volume available for fluid flow and therefore the computed permeability jones and feng 2016 saxena et al 2017b for binary tomographic images i e if a black fluid 0 and white solid 1image classification scheme is followed the isovalue should be chosen such that 0 σ 1 as observed in fig 5 a larger isovalue within the range leads to a larger pore volume thus making the computed permeability weakly dependent on the choice of the isovalue in this work we set isovalue to a default value of σ 0 5 finally it should be noted that a 3d binary image can be directly converted into a surface mesh bmp stl without the intermediate step of generating a dat file bmp dat stl however this intermediate step is included in any event since dat files are required as input to permeability computations using the bounceback boundary conditions 3 2 volume meshing surface mesh to volume mesh the surface mesh generated using the mc algorithm contains only the solid boundary information for 3d simulations a numerical grid is needed which in the lbm is a 3d uniform cartesian voxel grid therefore for a given isosurface and a 3d voxel grid of a particular resolution size of the smallest voxel the next task is to place the isosurface inside the 3d domain and then decide which voxels are inside the domain bounded the isosurface and which are not this process is called voxelization patil and ravi 2005 möller and trumbore 2005 in the lbm with the curved boundary approach voxelization consists of two major tasks i determine voxels that lie inside or outside of the domain bounded by the isosurface but within the overall 3d voxel grid ii for voxels that lie partially inside or outside determine the distance between the isosurface and the boundary voxels along the eighteen lattice vectors the distance between the points of intersection and boundary voxels along the eighteen directions gives the sub grid distance qi which was discussed in section 2 2 note that qi take non zero values only on boundary voxels for all interior voxels q i 0 the voxelization and sub grid distance calculation is done using the ray triangle intersection algorithm which were originally developed in computer graphics field marschner and shirley 2015 similar to the marching cubes algorithm an implementation of the ray tracing algorithm available within palabos environment is used a major difference between classical ray tracing and its lbm implementation is that in lbm the ray tracing procedure is done along eighteen lattice directions instead of along three co ordinate axes aligned directions fig 6 shows the result of the voxelization process finally computational aspects of the entire pre processing workflow including time to mesh and voxelise memory requirements etc are discussed in section 4 4 4 numerical implementation the application of the workflow and the results of the simulations performed with the two curved boundary schemes are now discussed three prototype porous media are considered for which tomographic images and numerical results are available from the literature i a circular pipe ii a 3d square block with a six pointed star shaped channel fig 9 and ii a 3d random packing of monodisperse spheres figs 3 and 4 the 3d images for star shaped channel and sphere pack were obtained from the supplementary material provided by saxena et al 2017a step 1 of the workflow bmp to dat conversion was performed using a python script the resulting dat file serves as an input to the lbm simulations with bounceback boundary condition all subsequent steps listed in fig 2 were done within the palabos simulation framework palabos is a c based open source parallel general purpose lbm library team 2009 2017 obtaining permeability from a simulated velocity field using darcy s equation the main output of the palabos solver is the local velocity field u x which is the steady state solution of the navier stokes equations as recovered by eq 4 based on darcy s law isotropic permeability k is computed as gerke et al 2018 talon et al 2012 14 k μ l q δ p s where q is flowrate through a cross sectional area s δ p p i n p o u t where pin and pout are the prescribed pressures at the inlet and outlet boundaries respectively and l is the distance over which the pressure difference is applied the flowrate can be determined according to q u s e f f where u is the velocity averaged over the entire cross sectional area s and seff is the effective area which is equal to the cross sectional area of only the pores a fraction of the total cross section area s for faster convergence and to smooth out numerical fluctuations it is convenient to perform averaging over the entire volume v and effective pore volume vpore instead of over the cross sectional areas 15 k μ l u v p o r e δ p v ϕ μ l u δ p here ϕ v p o r e v is the porosity as a convergence criterion a steady state solution is assumed when the normalized difference between permeability values between time n and n 1 is less than 10 4 16 k n k n 1 k n 10 4 for the three geometries tested here the flow is initiated by prescribing dirichlet boundary conditions for density pressure at the inlet and outlet using the zou he boundary scheme the density pressure difference is kept low enough that the stokes flow condition re 1 is maintained and lbm compressibility errors are negligible the relaxation parameter was chosen as τ 1 2 and the rest of the mrt relaxation parameters were fixed according to the guidelines developed in rao and schaefer 2019 4 1 circular channel a pipe with a circular cross section provides a simple non trivial benchmark geometry for validation of the entire workflow and the flow solver for a circular pipe of radius r the permeability is given analytically k r e f p π r 4 8 a where a is the cross sectional area of the square channel into which the circular pipe is bored the circular cross section geometry used in the simulation was created using a raster graphics editor paint net and multiple 2d images were stacked in the stream wise direction to create a 3d voxel grid of the pipe fig 7 a show a stair stepped cross sectional area of a 3d pipe while 7 b shows the triangulated surface representation of the pipe as obtained from the steps described in section 3 two series of tests were conducted on the circular pipe geometry first to check the dependency of permeability on orientation of the pipe with respect to the underlying voxel lattice simulations were performed on two different diameter pipes with d 8 16 and l 64 that are rotated at three different angles θ 30 45 60 second to test the effect of voxel refinement three different voxel grids 643 1283 2563 were tested for the d 8 pipe fig 8 shows that the permeability calculated using the bounceback scheme depends strongly on the inclination of the circular pipe relative to the voxel grid lattice since a stair step representation is only a first order approximation of the actual circular cross section the discretization errors are much larger when the channel walls are not aligned with the lattice this additional discretization error is generally reduced by aligning the channel with the lattice however this approach is not feasible for complex porous medium also note that the error in the bounceback based permeability at θ 45 is smaller that the errors at θ 30 and θ 60 this is because at θ 45 the channel is aligned with some of the 19 lattice vectors on the other hand it can be observed that the permeability estimated using bfl curved boundary scheme remains largely constant with an increase in θ moreover due to the second order curved representation of the circular cross section errors in permeability calculated with the bfl scheme are smaller that those with bounceback schemes it is also evident that from fig 8 that a refinement in the voxel grid resolution leads to more accurate estimates of permeability these observations provide evidence of the advantages of using curved surfaces for representing the pore matrix boundary and curved boundary schemes for implementing the no slip velocity boundary condition it should be noted that in general both the curved and bounceback schemes underestimate the permeability of the circular channel 4 2 star hexagram cross sectional channel the pre processing workflow and the solver was next validated on a channel with a star shaped cross section fig 9 a shows the binary segmented image of the cross section the hexagram has a length of 200 3 2 in image units and the size of the image dataset is 10243 with a resolution of 1µm this high resolution image dataset was obtained from saxena 2017 fig 9 b shows the surface mesh obtained from the 3d image using the marching cubes algorithm and fig 9 c shows a cross section after the voxelization process the porosity of the geometry is 0 02 which closely matches the porosity of 0 0204 that is obtained after pre processing the surface mesh consists of around 840 000 triangles it should be noted that although the original image dataset is 10243 only 512 images were used in the streamwise x direction since the medium is homogeneous along this direction i e the simulation domain for lbm simulations is 512 1024 1024 although a closed form analytic solution does not exist for this pore geometry numerical estimates of its permeability were computed using different numerical methods such as lbm fem cfd and voxel based direct navier stokes solvers vbs in saxena et al 2017a based on the different flow solvers saxena et al reported a mean permeability of 7584 millidarcy and a median density of 7485 millidarcy with 225 millidarcy as the standard deviation in the subsequent discussions the reference permeability for the star shaped pore geometry is taken to be k r e f h 7584 millidarcy fig 10 shows the results of permeability estimated using the bounceback bfl interpolated and gzs extrapolated curved boundary schemes it can be observed that the permeability predicted by bounceback and the two curved boundary schemes are relatively close to each other in magnitude this is because the input geometry used in all cases is of a very high resolution 1µm however this may not be the case if the input image is of coarse resolution and where the second order accurate curved boundary schemes would yield more accurate predictions than bounceback the bounceback permeability is also smaller than those predicted by the curved boundary schemes a possible explanation is provided in the following section 4 2 1 effect of surface mesh refinement for an image of a given resolution the solid boundary mesh obtained using the marching cubes algorithm can be further refined to provide a higher fidelity representation of the pore matrix surface for instance as mentioned above at the base resolution around 840 000 triangles represent the solid surface whereas with mesh refinement 1 22 8000 triangles represent the same surface theoretically increasing the number of triangles leads to a smoother surface description and more accurate estimate of the sub grid distance qi for the base resolution surface mesh and the bfl curved boundary scheme a permeability value of k 7406 md was observed while with the refined surface mesh a permeability value of k 7388 md was observed as mentioned before the difference between the permeability obtained using the base and refined meshes is not significant since the base resolution mesh is already of sufficiently high resolution it should also be noted that since the image and numerical grid are uncoupled the numerical lattice grid can be further refined volumetric grid refinement to obtain more accurate estimates of permeability 4 2 2 effect of relaxation time it was shown in our previous work that the single relaxation time bgk collision model and a sub optimal choice of the mrt collision parameters can both lead to permeability predictions that depend on the relaxation parameter τ this parametric dependence is nonphysical for stokes flow in porous media and moreover it also leads to much larger number of iterations required for convergence in order to investigate the dependence on permeability on the relaxation parameter in the context of curved boundary schemes we calculated permeability for the star cross section geometry with different values of τ and using the mrt relaxation parameters as described in rao and schaefer 2019 fig 10 shows the results of this numerical investigation it can be seen that the computed permeability shows a much smaller variance over a wide range of τ indicating that curved boundary schemes with mrt collision model can result in relatively parameter independent permeability 4 3 random packing of spheres random dense packing of identical monodisperse spheres beads is a synthetic porous geometry which serves as a useful canonical geometry for studying its fluid mechanics and also as a benchmark case for numerical validation of flow solvers the permeability of the random sphere packing has been widely investigated by many fluid solvers including lbm using bounceback and the fe fd and fv methods van der hoef et al 2005 talon et al 2012 maier et al 1998 ferréol and rothman 1995 fredrich et al 2006 saxena et al 2017a yang et al 2016 gerke et al 2018 the voxel grid of the sphere pack that was used in this study measures 793 788 791 corresponding to a cubic volume of 5 53mm 3 the pre processing steps involved in conversion of the 3d binary segmented image to the corresponding surface mesh and its voxelization were described in detail in section 3 note that unlike previous numerical experiments with sphere packs where the size number and resolution of the spheres can be parametrically changed in this case the size and the resolution were kept fixed this mirrors the case in a drp context where for a given geological sample the resolution and physical parameters of the sample cannot be changed arbitrarily a simple counting of voxels after generation of the isosurface indicates that the numerical porosity of the sample is 35 66 this compares well with the reported porosity of 36 saxena et al 2017b which indicates that the underlying pore structure is maintained even after the pre processing steps the small difference in porosity may attributed to the fact that very small sub micron pore spaces cannot be fully captured due to resolution limitations similar to our previous work with sphere packs the symmetry boundary condition was applied on domain boundaries that are normal to the flow directions along the flow direction a 10 layer padding is applied at both the inlet and outlet domain to minimize numerical artifacts due to entry and exit effects ferréol and rothman 1995 the flow is driven by applying a uniform pressure difference across the inlet and outlet boundaries using the zou he boundary scheme for the no slip velocity boundary condition bounceback and the bfl and gzs curved boundary conditions as described in section 2 2 are investigated the relaxation parameter is set at τ 1 2 and the rest of the mrt collision parameters follow the rules followed in rao and schaefer 2019 to obtain viscosity independent permeability solutions although the whole domain 7903 is simulated the permeability reported below is based on a slightly smaller sample volume 7503 to remove the artifacts associated with the hanging triangles at the edges of the simulation domain the analyzed sample 7503 is assumed to be of representative elementary volume rev scale this assumption is consistent with previous numerical investigations that suggest that a sample must be of a minimum of 200 3 300 3 volume for darcy s law to be applicable for sandstone and ceramic samples mostaghimi et al 2013 saxena et al 2017b pan et al 2006 therefore given the large size of the computational domain it can be assumed that permeability is independent of the sample volume from the steady state lbm velocity solution the permeability is computed using eqn 15 for example fig 11 shows a snapshot of the velocity field with the sphere pack after 2000 lbm iterations various empirical correlations have been proposed to relate the permeability of the sphere pack to its porosity and diameter of the constituent spheres for example rumpf and gupte proposed the correlation k ϕ 5 5 d 2 5 6 rumpf and gupte 1971 where d is the diameter of the sphere however for reference permeability a value of k r e f s p 280 151 millidarcy was used which is the median value of permeability that was obtained using different numerical fluid solvers lbm and non lbm based on the same 3d image of the sphere pack used in this study saxena et al 2017a table 1 shows the permeability of the sphere pack calculated using the bounceback and the two curved boundary schemes the computed permeability is in broad agreement with the results from other permeability solvers this broad agreement provides evidence of the validation of the code and also of the overall approach of using curved boundary conditions for drp related studies also consistent with other published works the bounceback based permeability values are smaller than those computed with curved boundary schemes fattahi et al 2016 pan et al 2006 saxena et al 2017b this observation may be explained as a result of the stair stepped nature of the pore matrix surface involved in the bounceback simulations where the effective hydraulic diameter of a characteristic pore throat would be slightly smaller than if the surface is represented by a smooth isosurface since a smaller pore volume is available for flow the bounceback based permeability is observed to be smaller a significant difference was not observed between the permeability predicted by the interpolated and extrapolated curved boundary schemes however this observation should be investigated on other pore geometries 4 4 computational aspects given a 3d binary image of arbitrary resolution e g 5003 of 10µm resolution the wall time required to generate a surface mesh of the solid boundary using the marching cubes algorithm is comparatively negligible typical wall times for surface mesh generation for various voxel grid sizes are reported in table 2 and graphically in fig 12 wall times are based on a palabos based custom code running on a single node of rice university s davinci high performance computing cluster each node consists of 12 intel westmere processor cores of 2 83 ghz with 48 gb of ram per node note however that for baseline performance purposes the wall times reported in table 2 are based on running the pre processing operations in serial mode even if the code allows mpi based parallelization for the actual lbm flow simulations four to six nodes of the westmere cluster were used in parallel mode depending upon the queue availability it is evident from fig 12 that it takes less than one minute to obtain a surface mesh from a 5003 image of packed spheres on the other hand the voxelization operation which includes time to compute sub grid distances allocate large blocks of memory for the 3d lattice and initialize flow takes substantially more compute time compared to the time required to obtain a surface mesh specifically it was observed that the time required to compute the sub grid distances requires up to 80 the total time to voxelise issues regarding the relative cost of pre processing over that of the actual flow solver are discussed in the following section 5 discussion and conclusions the question of whether the computed permeability is accurate is multifaceted it is obvious that most natural and synthetic porous media do not have closed form solutions for finding permeability from the numerical solution of the navier stokes equations hence characterizing and quantifying the sources of errors is challenging this is especially true in the drp context since each step in the overall workflow introduces errors and uncertainties dvorkin et al 2011 deviation in computed permeability from experimental values may arise from imaging resolution limitations segmentation and thresholding errors size rev effects boundary and initial conditions errors and numerical artifacts of the flow solver while some of these errors can be rigorously quantified such as errors due to boundary schemes or discretization errors others are human dependent such as errors due to segmentation leu et al 2014 schlüter et al 2014 chhatre et al 2018 wildenschild and sheppard 2013 soulaine et al 2016 the relative contribution of each of the factors to the overall error uncertainty is also challenging to quantify in light of the above constraints the following question arises for a 3d image of fixed resolution does using curved boundary schemes guarantee more accurate permeability solutions compared to those obtained using bounceback the answer mainly depends upon the resolution of the available 3d image if the resolution of the image is of the same order as a characteristic pore throat it is unlikely that the curved boundary schemes would provide any more accurate solutions than bounceback in such cases bounceback may be a better option however if high resolution images are available in which a characteristic pore is resolved by 3 5 voxels curved boundary schemes and the pre processing steps developed in this paper theoretically will provide more accurate solutions moreover for rocks with very low permeability for e g 100 millidarcy very high resolution images are required to capture the sub micron level pore spaces for the permeability calculations to be meaningful saxena et al 2017b nishiyama and yokoyama 2017 hence it is recommended that curved boundary schemes be used only if high resolution tomographic images are available there are of course additional computational costs and complexity involved in using curved boundary schemes as compared to bounceback based simulations clearly the additional steps of generating a surface mesh voxelization and computations of sub grid distance qi at the boundary voxels add to the overall computational costs one could argue that instead of adopting the curved boundary approach to reduce the stairstep effect one could just double the resolution of the original 3d image and then use the simpler bounceback scheme to obtain more accurate estimates of permeability while in theory this approach is reasonable further investigations are required to determine whether the 8x increase in the size of the computational domain resulting from doubling the resolution results in the same order of accuracy as using curved surfaces and at approximately the same computational cost an important yet sometimes underestimated cost is that associated with human intervention due to the tight coupling between the numerical and 3d image discretization a bounceback based solver can be easily integrated and even automated to a large extent within the overall software of the imaging equipment manufacturer fredrich et al 2014 however the use of curved boundary schemes requires solid boundary extraction and mesh cleanup which can be tedious for heterogeneous samples these manual tasks can make automation of the workflow difficult additional memory storage is required for handling and storing large gb sized stl files and for storing sub grid distances in all eighteen directions for all of the boundary voxels sparse memory implementation such as that in palabos along with standardization of image processing and pre processing for certain classes of rocks can mitigate some of these costs and aid automation of the workflow finally perhaps the biggest hurdle that limits the wider adoption of curved boundary schemes is the algorithmic complexity of locating the solid boundary surface within the 3d voxel grid and finding the distance of the surface from the boundary voxel maier and bernard 2010 location of the boundary surface is relatively easier if the surface has an analytic or smooth description such as for spheres or cylinders for example a sphere filling algorithm generates the center locations and radii of the spheres the exact boundary surface is then located with respect to the background lattice using ray sphere or ray cylinder intersection algorithms marschner and shirley 2015 however quickly and efficiently locating arbitrarily shaped triangulated surfaces such as ones obtained via the marching cubes algorithm on mct images of rocks is challenging some of the challenges include the various orientation shape and size of the triangles that must accounted for in a ray triangle intersection algorithm möller and trumbore 2005 this also involves software engineering challenges of producing a code that is robust scalable and efficient for large 3d domains the workflow and the palabos based code developed in this work address some of these challenges future tasks include comparison of the accuracy of each of the curved boundary schemes scaling tests and rigorous validation on a larger and more complex set of reservoir rock images credit authorship contribution statement parthib rao conceptualization methodology software validation investigation data curation writing original draft visualization laura schaefer conceptualization methodology validation resources writing review editing supervision declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments financial support from the energy and environment institute eei at rice university is gratefully acknowledged this work was supported in part by the data analysis and visualization cyber infrastructure funded by the national science foundation nsf under grant oci 0959097 and rice university we also thank the developers of palabos for their technical assistance berg lopez berland 2017 c f berg o lopez h berland industrial applications of digital rock technology j petrol sci eng 157 2017 131 147 berg c f lopez o berland h 2017 industrial applications of digital rock technology journal of petroleum science and engineering 157 131 147 bouzidi firdaouss lallemand 2001 m bouzidi m firdaouss p lallemand momentum transfer of a boltzmann lattice fluid with boundaries phys fluids 13 11 2001 3452 3459 bouzidi m firdaouss m lallemand p 2001 momentum transfer of a boltzmann lattice fluid with boundaries physics of fluids 13 11 3452 3459 bultreys de boever cnudde 2016 t bultreys w de boever v cnudde imaging and image based fluid transport modeling at the pore scale in geological materials a practical introduction to the current state of the art earth sci rev 155 2016 93 128 bultreys t de boever w cnudde v 2016 imaging and image based fluid transport modeling at the pore scale in geological materials a practical introduction to the current state of the art earth science reviews 155 93 128 chen martínez mei 1996 s chen d martínez r mei on boundary conditions in lattice boltzmann methods phys fluids 8 9 1996 2527 2536 10 1063 1 869035 chen s martínez d mei r 1996 on boundary conditions in lattice boltzmann methods phys fluids 8 9 2527 2536 10 1063 1 869035 chhatre sahoo leonardi vidal rainey braun patel et al 2018 s s chhatre h sahoo s leonardi k vidal j rainey e m braun p patel a blind study of four digital rock physics vendor laboratories on porosity absolute permeability and primary drainage capillary pressure data on tight outcrops petrophysics 59 01 2018 15 24 chhatre s s sahoo h leonardi s vidal k rainey j braun e m patel p et al 2018 a blind study of four digital rock physics vendor laboratories on porosity absolute permeability and primary drainage capillary pressure data on tight outcrops petrophysics 59 01 15 24 chun ladd 2007 b chun a ladd interpolated boundary condition for lattice boltzmannsimulations of flows in narrow gaps phys rev e 75 6 2007 066705 chun b ladd a 2007 interpolated boundary condition for lattice boltzmann simulations of flows in narrow gaps physical review e 75 6 066705 dhumières 2002 d dhumières multiple relaxation time lattice boltzmann models in three dimensions philos trans r soc lond a 360 1792 2002 437 451 dhumières d 2002 multiple relaxation time lattice boltzmann models in three dimensions philosophical transactions of the royal society of london a mathematical physical and engineering sciences 360 1792 437 451 dvorkin derzhi diaz fang 2011 j dvorkin n derzhi e diaz q fang relevance of computational rock physics geophysics 76 5 2011 e141 e153 dvorkin j derzhi n diaz e fang q 2011 relevance of computational rock physics geophysics 76 5 e141 e153 dvorkin fang derzhi 2012 j dvorkin q fang n derzhi etudes in computational rock physics alterations and benchmarkingetudes in computational rock physics geophysics 77 3 2012 d45 d52 dvorkin j fang q derzhi n 2012 etudes in computational rock physics alterations and benchmarkingetudes in computational rock physics geophysics 77 3 d45 d52 eshghinejadfard daróczy janiga thévenin 2016 a eshghinejadfard l daróczy g janiga d thévenin calculation of the permeability in porous media using the lattice boltzmann method int j heat fluid flow 62 2016 93 103 eshghinejadfard a daróczy l janiga g thévenin d 2016 calculation of the permeability in porous media using the lattice boltzmann method international journal of heat and fluid flow 62 93 103 fattahi waluga wohlmuth rüde manhart helmig 2016 e fattahi c waluga b wohlmuth u rüde m manhart r helmig lattice boltzmann methods in porous media simulations from laminar to turbulent flow comput fluids 140 2016 247 259 fattahi e waluga c wohlmuth b rüde u manhart m helmig r 2016 lattice boltzmann methods in porous media simulations from laminar to turbulent flow computers fluids 140 247 259 ferréol rothman 1995 b ferréol d h rothman lattice boltzmann simulations of flow through fontainebleau sandstone transp porous media 20 1 1995 3 20 10 1007 bf00616923 ferréol b rothman d h 1995 lattice boltzmann simulations of flow through fontainebleau sandstone transport in porous media 20 1 3 20 10 1007 bf00616923 filippova hänel 1998 o filippova d hänel grid refinement for lattice bgk models j comput phys 147 1 1998 219 228 filippova o hänel d 1998 grid refinement for lattice bgk models journal of computational physics 147 1 219 228 fredrich digiovanni noble 2006 j fredrich a digiovanni d noble predicting macroscopic transport properties using microscopic image data j geophys res 111 b3 2006 fredrich j digiovanni a noble d 2006 predicting macroscopic transport properties using microscopic image data journal of geophysical research solid earth 111 b3 fredrich lakshtanov lane liu natarajan ni toms et al 2014 j t fredrich d lakshtanov n lane e b liu c natarajan d m ni j toms digital rocks developing an emerging technology through to a proven capability deployed in the business spe annual technical conference and exhibition 2014 society of petroleum engineers fredrich j t lakshtanov d lane n liu e b natarajan c ni d m toms j et al 2014 digital rocks developing an emerging technology through to a proven capability deployed in the business in spe annual technical conference and exhibition society of petroleum engineers gerke vasilyev khirevich collins karsanina sizonenko korost lamontagne mallants 2018 k m gerke r v vasilyev s khirevich d collins m v karsanina t o sizonenko d v korost s lamontagne d mallants finite difference method stokes solver fdmss for 3d pore geometries software development validation and case studies comput geosci 114 2018 41 58 gerke k m vasilyev r v khirevich s collins d karsanina m v sizonenko t o korost d v lamontagne s mallants d 2018 finite difference method stokes solver fdmss for 3d pore geometries software development validation and case studies computers geosciences 114 41 58 ginzbourg adler 1994 i ginzbourg p adler boundary flow condition analysis for the three dimensional lattice boltzmann model j phys ii 4 2 1994 191 214 ginzbourg i adler p 1994 boundary flow condition analysis for the three dimensional lattice boltzmann model journal de physique ii 4 2 191 214 ginzburg dhumieres 2003 i ginzburg d dhumieres multireflection boundary conditions for lattice boltzmann models phys rev e 68 6 2003 066614 ginzburg i dhumieres d 2003 multireflection boundary conditions for lattice boltzmann models physical review e 68 6 066614 guo shu 2013 z guo c shu lattice boltzmann method and its applications in engineering 3 2013 world scientific guo z shu c 2013 lattice boltzmann method and its applications in engineering vol 3 world scientific guo zheng shi 2002 z guo c zheng b shi an extrapolation method for boundary conditions in lattice boltzmann method phys fluids 14 6 2002 2007 2010 guo z zheng c shi b 2002 an extrapolation method for boundary conditions in lattice boltzmann method physics of fluids 14 6 2007 2010 van der hoef beetstra kuipers 2005 m a van der hoef r beetstra j kuipers lattice boltzmann simulations of low reynolds number flow past mono and bidisperse arrays of spheres results for the permeability and drag force j fluid mech 528 2005 233 254 van der hoef m a beetstra r kuipers j 2005 lattice boltzmann simulations of low reynolds number flow past mono and bidisperse arrays of spheres results for the permeability and drag force journal of fluid mechanics 528 233 254 jia williams 2001 x jia r a williams a packing algorithm for particles of arbitrary shapes powder technol 120 3 2001 175 186 jia x williams r a 2001 a packing algorithm for particles of arbitrary shapes powder technology 120 3 175 186 jodrey tory 1985 w jodrey e tory computer simulation of close random packing of equal spheres phys rev a 32 4 1985 2347 jodrey w tory e 1985 computer simulation of close random packing of equal spheres physical review a 32 4 2347 jones feng 2016 b jones y feng effect of image scaling and segmentation in digital rock characterisation comput part mech 3 2 2016 201 213 jones b feng y 2016 effect of image scaling and segmentation in digital rock characterisation computational particle mechanics 3 2 201 213 kainourgiakis kikkinides galani charalambopoulou stubos 2005 m kainourgiakis e kikkinides a galani g c charalambopoulou a stubos digitally reconstructed porous media transport and sorption properties transp porous media 58 1 2 2005 43 62 kainourgiakis m kikkinides e galani a charalambopoulou g c stubos a 2005 digitally reconstructed porous media transport and sorption properties transport in porous media 58 1 2 43 62 kao yang 2008 p h kao r j yang an investigation into curved and moving boundary treatments in the lattice boltzmann method j comput phys 227 11 2008 5671 5690 kao p h yang r j 2008 an investigation into curved and moving boundary treatments in the lattice boltzmann method journal of computational physics 227 11 5671 5690 khirevich ginzburg tallarek 2015 s khirevich i ginzburg u tallarek coarse and fine grid numerical behavior of mrt trt lattice boltzmann schemes in regular and random sphere packings j comput phys 281 2015 708 742 khirevich s ginzburg i tallarek u 2015 coarse and fine grid numerical behavior of mrt trt lattice boltzmann schemes in regular and random sphere packings journal of computational physics 281 708 742 knackstedt arns limaye sakellariou senden sheppard sok pinczewski bunn et al 2004 m knackstedt c arns a limaye a sakellariou t senden a sheppard r sok w v pinczewski g bunn digital core laboratory properties of reservoir core derived from 3d images spe asia pacific conference on integrated modelling for asset management 2004 society of petroleum engineers knackstedt m arns c limaye a sakellariou a senden t sheppard a sok r pinczewski w v bunn g et al 2004 digital core laboratory properties of reservoir core derived from 3d images in spe asia pacific conference on integrated modelling for asset management society of petroleum engineers krüger kusumaatmaja kuzmin shardt silva viggen 2017 t krüger h kusumaatmaja a kuzmin o shardt g silva e m viggen the lattice boltzmann method 2017 krüger t kusumaatmaja h kuzmin a shardt o silva g viggen e m 2017 the lattice boltzmann method lallemand luo 2003 p lallemand l s luo lattice boltzmann method for moving boundaries j comput phys 184 2 2003 406 421 lallemand p luo l s 2003 lattice boltzmann method for moving boundaries journal of computational physics 184 2 406 421 leu berg enzmann armstrong kersten 2014 l leu s berg f enzmann r t armstrong m kersten fast x ray micro tomography of multiphase flow in berea sandstone a sensitivity study on image processing transp porous media 105 2 2014 451 469 leu l berg s enzmann f armstrong r t kersten m 2014 fast x ray micro tomography of multiphase flow in berea sandstone a sensitivity study on image processing transport in porous media 105 2 451 469 lewiner lopes vieira tavares 2003 t lewiner h lopes a w vieira g tavares efficient implementation of marching cubes cases with topological guarantees j graph tools 8 2 2003 1 15 lewiner t lopes h vieira a w tavares g 2003 efficient implementation of marching cubes cases with topological guarantees journal of graphics tools 8 2 1 15 lorensen cline 1987 w e lorensen h e cline marching cubes a high resolution 3d surface construction algorithm siggraph comput graph 21 4 1987 163 169 10 1145 37402 37422 lorensen w e cline h e 1987 marching cubes a high resolution 3d surface construction algorithm siggraph comput graph 21 4 163 169 10 1145 37402 37422 luo krafczyk shyy 2010 l s luo m krafczyk w shyy lattice boltzmann method for computational fluid dynamics encyclopedia of aerospace engineering 2010 651 660 luo l s krafczyk m shyy w 2010 lattice boltzmann method for computational fluid dynamics encyclopedia of aerospace engineering 651 660 maier bernard 2010 r maier r bernard lattice boltzmann accuracy in pore scale flow simulation j comput phys 229 2 2010 233 255 maier r bernard r 2010 lattice boltzmann accuracy in pore scale flow simulation journal of computational physics 229 2 233 255 maier kroll kutsovsky davis bernard 1998 r s maier d kroll y kutsovsky h davis r s bernard simulation of flow through bead packs using the lattice boltzmann method phys fluids 10 1 1998 60 74 maier r s kroll d kutsovsky y davis h bernard r s 1998 simulation of flow through bead packs using the lattice boltzmann method physics of fluids 10 1 60 74 manwart aaltosalmi koponen hilfer timonen 2002 c manwart u aaltosalmi a koponen r hilfer j timonen lattice boltzmann and finite difference simulations for the permeability for three dimensional porous media phys rev e 66 1 2002 016702 manwart c aaltosalmi u koponen a hilfer r timonen j 2002 lattice boltzmann and finite difference simulations for the permeability for three dimensional porous media physical review e 66 1 016702 marschner shirley 2015 s marschner p shirley fundamentals of computer graphics 2015 crc press marschner s shirley p 2015 fundamentals of computer graphics crc press mavko mukerji dvorkin 2009 g mavko t mukerji j dvorkin the rock physics handbook tools for seismic analysis of porous media 2009 cambridge university press mavko g mukerji t dvorkin j 2009 the rock physics handbook tools for seismic analysis of porous media cambridge university press mazzeo coveney 2008 m d mazzeo p v coveney hemelb a high performance parallel lattice boltzmanncode for large scale fluid flow in complex geometries comput phys commun 178 12 2008 894 914 mazzeo m d coveney p v 2008 hemelb a high performance parallel lattice boltzmann code for large scale fluid flow in complex geometries computer physics communications 178 12 894 914 mei luo shyy 1999 r mei l s luo w shyy an accurate curved boundary treatment in the lattice boltzmann method j comput phys 155 2 1999 307 330 mei r luo l s shyy w 1999 an accurate curved boundary treatment in the lattice boltzmann method journal of computational physics 155 2 307 330 möller trumbore 2005 t möller b trumbore fast minimum storage ray triangle intersection acm siggraph 2005 courses 2005 acm 7 möller t trumbore b 2005 fast minimum storage ray triangle intersection in acm siggraph 2005 courses acm p 7 mostaghimi blunt bijeljic 2013 p mostaghimi m j blunt b bijeljic computations of absolute permeability on micro ct images math geosci 45 1 2013 103 125 mostaghimi p blunt m j bijeljic b 2013 computations of absolute permeability on micro ct images mathematical geosciences 45 1 103 125 mussa asinari luo 2009 a mussa p asinari l s luo lattice boltzmann simulations of 2d laminar flows past two tandem cylinders j comput phys 228 4 2009 983 999 mussa a asinari p luo l s 2009 lattice boltzmann simulations of 2d laminar flows past two tandem cylinders journal of computational physics 228 4 983 999 nishiyama yokoyama 2017 n nishiyama t yokoyama permeability of porous media role of the critical pore size j geophys res 122 9 2017 6955 6971 nishiyama n yokoyama t 2017 permeability of porous media role of the critical pore size journal of geophysical research solid earth 122 9 6955 6971 pan luo miller 2006 c pan l s luo c t miller an evaluation of lattice boltzmann schemes for porous medium flow simulation comput fluids 35 8 9 2006 898 909 pan c luo l s miller c t 2006 an evaluation of lattice boltzmann schemes for porous medium flow simulation computers fluids 35 8 9 898 909 patil ravi 2005 s patil b ravi voxel based representation display and thickness analysis of intricate shapes ninth international conference on computer aided design and computer graphics cad cg 05 2005 ieee 6 pp patil s ravi b 2005 voxel based representation display and thickness analysis of intricate shapes in ninth international conference on computer aided design and computer graphics cad cg 05 ieee pp 6 pp powell 1980 m powell computer simulated random packing of spheres powder technol 25 1 1980 45 52 powell m 1980 computer simulated random packing of spheres powder technology 25 1 45 52 rao schaefer 2019 p rao l schaefer lattice boltzmann models for micro tomographic pore spaces comput fluids 193 2019 104294 10 1016 j compfluid 2019 104294 rao p schaefer l 2019 lattice boltzmann models for micro tomographic pore spaces computers fluids 193 104294 10 1016 j compfluid 2019 104294 rumpf gupte 1971 h rumpf a gupte influences the porosity at and grain size ö ss distribution in the law of resistance of the pore chem eng technol 43 6 1971 367 375 rumpf h gupte a 1971 influences the porosity at and grain size ö ss distribution in the law of resistance of the pore chemical engineering technology 43 6 367 375 saxena saxena n 2017 data for references and benchmarks for pore scale flow simulated using micro ct images of porous media and digital rocks 10 17632 4g723tr5v3 2 saxena hofmann alpak berg dietderich agarwal tandon hunter freeman wilson 2017 n saxena r hofmann f o alpak s berg j dietderich u agarwal k tandon s hunter j freeman o b wilson and benchmarks for pore scale flow simulated using micro ct images of porous media and digital rocks adv water resour 109 2017 211 235 saxena n hofmann r alpak f o berg s dietderich j agarwal u tandon k hunter s freeman j wilson o b 2017a 
444,literature shows the application of the entropy concept in open channels flow no existing research has been addressed to the application of the entropy concept for evaluating the effect of secondary flow which especially develops in curved channels the purpose of this paper is to explore the possibility to evaluate the effect of the secondary flow on the stream wise velocity distribution starting only from the knowledge of the surface velocity and the entropic concept application the analysis is conducted with the aid of data collected in a large amplitude meandering laboratory flume for two different values of the width to depth ratio results show that the location of the maximum velocity varies not only along the bend but also along the water depth depending on the relative entity of the cross circulation and the convective flow acceleration it has been also verified that the entropic parameter varies along the bend as a function of the width to depth ratio the application of the entropic model to the examined cases has allowed the verification that not only the shape of the velocity profile but also the bed shear stress evolution along the bend could be estimated by the entropic model starting from the knowledge of the surface velocity only 1 introduction as it is well known in a river bend secondary flow develops by the combination of the longitudinal flow with the cross sectional motion which is induced by the channel s curvature yalin 1992 and is due to the interaction of the forces associated with centrifugal acceleration transverse water surface slope and bed shear stress secondary flow exerts an important role in several processes involving in a natural stream such as the dispersion of nutrients and or of chemical substances as well as the trapping or transport of sediments in particular the cross sectional motion contributes both to shift the core of the maximum velocity among others leschziner and rodi 1979 johannesson and parker 1989 wilson et al 2003 and of the boundary shear stress along the bend thus modifying and reshaping the channel s bed and platform see as an example de vriend and gendolf 1983 whiting and dietrich 1993 knaapen et al 2001 blanckaert and graf 2004 roca et al 2009 termini and piraino 2011 and to enhance the mass mixing and the energy losses thus affecting the channel s conveying capacity camporeale et al 2005 nepf 2012 gurnell 2014 de serio et al 2018 the estimation of the rate of mass and momentum transport requires the knowledge of the velocity distribution along the channel thus the identification of the feedback between the cross sectional motion and the vertical profiles of the longitudinal velocity along the bend is fundamental in simulating dispersion and mixing processes in meandering bends which are characterized by a continuously changing curvature the cross sectional motion varies from section to section thus unlike straight channels the identification of the evolution of the cross sectional motion along the bend is especially important to estimate the variation of the turbulent activity of flow and the distribution of the downstream flow velocity along the bend itself according to yalin 1992 in meandering bends the cross sectional motion can be considered as composed by the curvature induced cross circulation which is characterized by zero depth average and the convective component which is due to the changing channel s curvature and produces a net flux of mass in the transversal direction see fig 1 literature among others johannesson and parker 1989 whiting and dietrich 1993 da silva et al 2006 termini 2009 termini and piraino 2011 indicates that the role of the aforementioned components cannot be analyzed independently of the width to depth ratio and the channel s sinuosity da silva et al 2006 focused on the case of large width to depth ratio and analysed the influence of channel s sinuosity on the flow pattern in flat bed sine generated laboratory flumes characterized by different values of the deflection angle at the crossover θo i e θ30 50 70 90 110 as a result they verified that the channel s sinuosity especially affects the location of the convectively accelerated decelerated flow along the channel for a given channel s sinuosity the width to depth ratio is the most important parameter affecting the entity of the two aforementioned cross sectional motion components being the cross circulation more significant for small width to depth ratios than for large width to depth ratios see also in whiting and dietrich 1993 lanzoni et al 2006 blackheart et al 2008 termini 2015 it should be also considered that several studies conducted in straight channels among others steffler et al 1985 cardoso et al 1989 nezu and nakagawa 1993 yang et al 2004 troiani et al 2004 yang and lee 2007 najafabadi et al 2018 have related the transport of momentum due to the secondary flow to the so called dip phenomenon for which the position of the maximum longitudinal velocity occurs below the water surface as schematized in fig 1 moramarco et al 2017 investigated the spatial distribution of the velocity dip in sites along straight natural channels by leveraging the entropy theory they identified the distance of the maximum longitudinal velocity from the free surface velocity dip δ in fig 1 and showed how turn the surface velocity into depth averaged velocity termini and moramarco 2018 analyzed the u profiles measured only at the apex and inflection sections of a large amplitude meander wave from their analysis it appeared clear that the dip phenomenon occurs in all the considered sections but with different entity this result suggested that the variation of the velocity dip along the channel could be strongly related to the evolution of the cross sectional motion along the bend termini and moramarco 2018 also verified that the velocity dip δ varies as a function of the width to depth ratio w h and assumes in average a value of around 53 of the local flow depth for small width to depth ratio and of around 34 for large width to depth ratio this suggests that the velocity dip is evident for small width to depth ratios but it is also present for large width to depth ratio this is consistent with previous literature findings obtained in straight channels among others sarma et al 1983 tachie et al 2003 successively termini 2019 identified an equation which relates the main controlling parameters of the flow processes i e the local channel s curvature and the width to depth ratio to the local velocity dip specifically she demonstrated that for a given value of the width to depth ratio the velocity dip δ varies along the meander wave as a function both of the normalized distance from the outer bank ξ w with ξ coordinate in the transversal direction see fig 2 and of the local channel s curvature which could be parameterized by the local deflection angle θ she also proposed a relation which directly relates the velocity dip δ to the parameters θ and w h from the aforementioned considerations it is clear that although literature researches have allowed significant progress in understanding meander flow dynamics the mechanism of the velocity dip formation and the relation with secondary motion is still poorly understood in this context the main aim of the present work is to explore the link between the velocity dip and the secondary motion and the possibility to explain it by leveraging the entropy theory starting from the monitoring of surface velocity this allows us to answer to the question if it is possible to evaluate the feedback effect of cross sectional flow on the longitudinal velocity and shear stress distributions in curved channels starting from the monitoring of surface velocities only such a possibility could be of great interest for hydrological practices considering that some fundamental insights could be inferred along natural channels in terms of flow erosion and shear stress distribution just sampling the surface velocity this study has been inspired by the recent findings obtained by moramarco et al 2017 and termini and moramarco 2018 and is motivated by the fact that although considerable attention has been given to the application of entropy concept to estimate either the velocity distribution in open channels moramarco and singh 2010 termini and moramarco 2017 or other specific parameters sterling and knight 2002 atieh et al 2015a 2015b atieh et al 2017 sheikh and bonakdari 2015 kumbhakar and ghoshal 2016a 2016b kumbhakar et al 2016 atieh et al 2017 kumbhakar et al 2017 kumbhakar and ghoshal 2016 kundu 2017 singh et al al 2017 ebtehaj et al 2018 khozani and bonakdari 2018 kazemian kale kale et al 2018 no existing research addresses the application of the entropy concept to estimate secondary flow effect especially in curved open channels thus the present work is part of a broader research project aimed at examining the meander dynamics and the applicability of the entropic concept to predict the effect of secondary currents on the primary velocity distribution and the flow discharge just using surface velocity observations specifically the present study complements previous studies conducted by termini and moramarco 2018 restricting the attention to a high amplitude meander bend for which the role of curvature and of its downstream variation on the velocity pattern are especially important the aforementioned general goal is achieved by three specific objectives 1 to investigate for large and small width to depth ratios if the velocity dip and its variation of along the bend could be related to the effect of the cross sectional flow evolution along the bend 2 to verify how such an effect could be identified by applying the entropy concept by the spatial distribution of entropic parameter m characterizing the velocity profile shape 3 to analyze if the entropy theory is able to provide useful insights in terms of velocity dip distribution along straight and bended channels just starting from the monitoring of surface velocity across the site the paper is organized as follows section 2 describes the experimental data used and the experimental results are discussed in section 3 the application of the entropic parameter are presented in section 4 discussion is reported in section 5 and finally conclusion are summarized in section 6 2 materials and methods 2 1 experimental data the data used in the present work were collected in the ambit of a broader research program aimed to analyze the flow pattern in a high amplitude meandering channel in particular data taken from termini 2009 have been used the data were collected in a meandering channel 25 12 m long following the sine generated curve with a deflection angle at the inflection section θo 110 the channel cross section is rectangular with width w 0 50 m the fixed vertical sidewalls are of plexiglass and the bed is of quartz sand d50 medium sediment diameter 0 65 mm in order to isolate the effect of channel s curvature in the present work only the experimental runs conducted over the rigid and flat bed runs called as rb 1 and rb 2 in termini 2009 have been considered in particular rb 1 run hereon indicated as run1 was conducted with a flow discharge of q 0 019 m3 s channel averaged flow depth h 5 5 cm w h 9 09 10 rb 2 run hereon indicated as run2 was conducted with a flow discharge q 0 007 m3 s channel averaged flow depth h 3 0 cm w h 16 67 10 herein in accordance with previous researches among others nezu and rodi 1985 yalin 1992 da silva et al 2006 termini and piraino 2011 w h 10 indicates small width to depth ratio and w h 10 indicates large width to depth ratio during each run the water surface was measured using a profiler indicator pv09 delft hydraulics with a precision of 0 1 mm the instantaneous local longitudinal u t and transversal v t velocity components were measured in sections spaced about 50 cm or so apart in points spaced of 1 1 5 mm along the verticals of nine transverse abscissas the flow velocity measurements were carried out by using a 2d side looking acoustic doppler velocimeter adv by sontek inc identified symmetrically to the channel axis see details in termini 2009 bearing in mind the specific aim of the present work our attention is focused only on the longitudinal velocity component u t measured in the central bend between the two consecutive inflection sections a and i indicated in fig 2 by using the time series of the measured longitudinal flow velocity component u t the corresponding time averaged longitudinal velocity u was estimated along each measurement vertical of the considered sections the analyses reported in the present work have been performed by considering the local reference system reported in fig 2 s coordinate in the longitudinal direction ξ coordinate in the transversal direction 3 experimental results 3 1 variation of the u profile shape along the bend and relation with the velocity dip as indicated in the introduction the results obtained in the previous works termini and moramarco 2018 have suggested that the formation of the velocity dip and its variation along the bend could be related to the evolution of the cross sectional motion whose entity also varies as a function of the width to depth ratio among others whiting and dietrich 1993 termini 2015 this also suggests that the knowledge of the variation of the u profile shape along the bend could be important in order to identify the evolution of secondary motion along the bend itself for this reason in the present work the measured u values have been first used in order to analyze how the shape of the u profiles varies along the bend for both the considered width to depth ratios the u profile shape has been examined for each measurement vertical v by estimating not only the velocity dip i e the distance δ of the local maximum velocity umax v from the free surface but also the difference du between the local maximum value of the velocity umax v and the local free surface velocity us v see the scheme of fig 1 figs 3 and 4 report respectively the distributions along the bend of the difference du umax v us v and of the velocity dip δ normalized by the channel averaged flow depth h obtained for both the width to depth ratios it can be observed that generally du assumes for w h 10 values lower than those for w h 10 the normalized velocity dip δ assumes for w h 10 values greater than those obtained for w h 10 in particular fig 3 indicates that for both the width to depth ratios du increases along the inner right bank i e passing from section a to section i along the outer left bank a different behavior can be observed between the case of w h 10 and the case of w h 10 in the case of w h 10 the lower values of du which are found close to the inner bank of the inflection section a gradually cross the channel reaching the outer side of section d bend entrance at a certain distance from the outer bank itself it should be noted that section d is slightly downstream of the section where the tangent to the inflection section intersects the outer bank then the lower values of du are maintained close to the outer left bank until to reach the inflection section downstream section i in the case of w h 10 the lower values of du are also found close to the inner right bank of section a but they cross the channel and reach the outer side at section c which is slightly upstream of the section where the tangent to the inflection section intersects the outer bank passing from section c to section d they are maintained close to the outer left bank then the difference du increases in value and the lower values are obtained not too close to the outer bank until to reach section f from this section to the inflection section downstream section i the lower values of du are found close to the outer bank the comparison between figs 3 and 4 highlights that generally the lower values of δ are found where the lower values of du are obtained a different behavior between the case of w h 10 and the case of w h 10 can be observed also for δ along the outer left bank in particular for w h 10 the normalized velocity dip δ assumes the higher values close to the outer bank of the section d bend entrance and between sections g and h i e close to the bend exit while low values of the velocity dip are found close to the apex section thus in this case δ increases close to the outer left bank passing from section a where almost constant values of the velocity dip occur to section d then it slightly decreases until to reach the apex section passing from the apex section to the bend exit between sections g and h it slightly increases and then it decreases until to reach the inflection section downstream i where it assumes almost constant low values for w h 10 upstream of the apex section the normalized velocity dip δ assumes a behavior similar but less accentuated than that for w h 10 at downstream of the apex section δ assumes high values with a peak close to the outer bank of section f bend exit until to reach the inflection section downstream i the different behavior observed between w h 10 and w h 10 could be related to the fact that the two components of the transversal velocity i e the cross circulation and the convective acceleration assume a different relative importance in the two considered cases as verified by termini 2009 by using the same data of the present work and by termini and piraino 2011 in particular their results indicated that for w h 10 the convective acceleration component is more significant than w h 10 in this last case the cross circulation component attenuates the contribution of the convective acceleration component furthermore comparing figs 3 and 4 it s evident that the maximum du occurs at the outer bank of sections d and e where the maximum velocity dip occurs while at the inner bank the phenomenon is the opposite in other words the cross circulation component increases its effect moving from the inner to the outer bank as the channel s curvature increases driving the location of the maximum velocity towards the bed near the outer side of section d in summary figs 3 and 4 show that the difference du assumes low values where also the normalized velocity dip assumes low values and thus where the maximum velocity is closer to the free surface the difference in the shape of the u profiles between w h 10 and w h 10 occurs especially in the region close to the outer bank downstream of section d where for w h 10 du assumes values higher than those obtained for w h 10 this means that for w h 10 the u profiles are strongly concavely curved near the free surface the results also suggest that the u profile assumes a more concave shape near the free surface for lower water depths as consequence of the aforementioned behavior the location of the maximum velocity umax v varies along the bend for both w h moving from the inner right bank to the outer left one as one passes from section a to section e as fig 5 shows at the bend entrance section d while for w h 10 the higher value of the maximum of velocity is found close to the outer bank for w h 10 it is still maintained far from the outer bank itself such a different behavior can be explained by the fact that a counter rotating circulation cell see fig 1 initiates in the outer bank region of the bend entrance i e close to section d as demonstrated by termini and piraino 2011 thus especially along the channel reach between sections d and f the action of the central region circulation cell is limited by the presence of the counter rotating circulation cell figs 3 and 4 give also an indication on the redistribution of the maximum velocity not only in the stream wise direction as fig 5 shows but also in the vertical one it is clear that the higher values of umax v cross the bend passing from the inner bank of the inflection section a to outer bank of the inflection section i as well as the lower values of the normalized velocity dip δ this suggests that the higher values of the maximum velocity umax v are close to the free surface in the case of w h 10 downstream of the apex section where high velocity dip values occur such a behavior is less evident thus indicating that the maximum velocity can be also found far from the free surface along the bend exit reach this could be related to the fact that in the case of w h 10 the effect due to the cross circulation on the longitudinal velocity is not significant and decreases especially along the bend exit reach yalin 1992 da silva et al 2006 termini 2009 furthermore focusing the attention to the region close to the outer bank it can be observed that for both the width to depth ratios passing from the inflection section upstream section a to the bend entrance section d the normalized velocity dip assumes high increasing values with a peak around the outer bank of section d meaning that there the maximum velocity is localized near the bed the observed behavior also suggests that the pattern of the velocity dip reflects the effect of circulation cells due to the cross sectional motion indeed where the velocity dip is minimum sections b and c of fig 4 only the effect of a central region circulation cell moving from the inner to outer bank occurs as the channel s curvature increases i e at the bend entrance section d especially for w h 10 an outer bank circulation cell initiates close to the free surface as shown by termini and piraino 2011 analyzing the evolution of cross sectional flow along the same meandering bend and the central region circulation cell seems to split into two weak counter rotating circulation cells this effect could drive the location of the maximum velocity close to the bed near the outer side of section d determining high values of the velocity dip this result is particularly interesting for analysing the erosion action of flow to the bed in particular the fact that close to the outer bank of the bend entrance the velocity dip is significant and the maximum velocity is localized just close to the bed could explain why at such a location the maximum bed erosion was observed in previous works whiting and dietrich 1993 termini 2009 in particular termini 2009 measured the equilibrium bed deformation obtained at the end of mobile bed runs with hydraulic conditions corresponding to run1 and run2 she verified that in both cases the maximum bed scour occurs approximately where the tangent to the inner bank at the upstream inflection section a intersects the outer bank see fig 3 and thus close to the outer bank of section d this behavior is also consistent with previous results obtained by blanckaert and graf 2004 indicating that the momentum transport by cross circulation contributes to redistribute the maximum velocity along the bend affecting the consequent erosion processes to better understand this phenomenon the role of the water depth on the shape of the velocity profile is also analyzed by the value of the ratio um v umax v where um v and umax v are respectively the depth averaged velocity and the maximum velocity referring to the vertical profile v specifically um v is estimated on the basis of velocity profile measured by adv fig 6 reports the value of the ratio um v umax v against the ratio w hv where hv indicates the local water depth from this figure it appears clear that with exception of few points for run1 w h 10 the values of the ratio um v umax v vary in the range 0 7 0 9 with a variation of the ratio w hv in the range 8 12 for run2 w h 10 the values of the ratio um v umax v are generally lower than those observed for run1 and vary in the range 0 4 0 75 while the values of the ratio w hv vary in the range 12 20 the different values of the ratio um v umax v between w h 10 and w h 10 further indicates how the different magnitude of the momentum transport by the cross circulation which is more significant for w h 10 could affect the distribution of the longitudinal velocity 3 2 experimental distribution of the bed shear stress it is important to estimate the bed shear stress along the bend which reshapes the bed topography in the present work according to other authors see as an example blanckaert et al 2008 termini 2016 in a first approximation the experimental bed shear stress has been estimated by using the depth averaged velocity for vertical profile v as τbs ρ cf um v 2 with c f χ g chèzy type dimensionless friction coefficient fig 7 which reports the contour maps of the term τbs cf ρum v 2 estimated for both runs highlights that for both runs the higher bed shear stress lies near the inner right bank at the inflection section a along the bend it crosses gradually the channel and at the inflection section downstream it is found near the outer left bank this behavior is especially evident in the case of w h 10 where along the bend the higher values of τbs cf gradually shift from the inner bank to the outer bank in the case of w h 10 the higher values of τbs cf shift towards the outer bank passing from section a to section e then values of τbs cf decrease until to reach section f increasing again until to reach the bend exit between sections f and g passing from section g to the inflection section downstream i the values of τbs cf slightly decrease it is important to note that this pattern of bed shear stress is consistent with that obtained by termini 2009 by using the law of the wall according with termini 2009 the different behavior observed for w h 10 and w h 10 might be caused by the fact that the cross circulation which is more significant for w h 10 than for w h 10 attenuates the effect of the convective acceleration at the outer bank this entails the shift of the high values of τbs cf from the inner bank to the outer bank more gradual along the bend in the case of w h 10 4 entropic model application 4 1 entropic parameter distribution along the bend in this section a short description of entropic model and its application has given along with the relation between the entropic parameter m or the entropic function ϕ m and the kinematic characteristics of the flow the entropic model chiu 1988 1991 chiu and murray 1992 ciu and hsu 2006 correlates the cross sectional mean velocity um to the cross sectional maximum velocity umax using the linear relationship 1 u m e m e m 1 1 m u max φ m u max with m the entropic parameter umax is considered as the maximum value of all velocity points sampled in the cross sectional flow area during a measurement moramarco et al 2004 um is obtained by applying the velocity area method to the measured velocity profiles therefore for a gage site in which a velocity dataset is available φ m and hence m can be estimated on the basis of pairs um umax as regards the theoretical ground of eq 1 this comes from the expression of mean flow velocity 2 u m 0 u m a x u x y p u d u where u x y is the velocity in the cross sectional flow area x y represent the distance from the left side of bank and from the bed respectively p u is the probability density function obtained by assuming an a priori cumulative probability distribution function f u y d chiu 1988 3 p u d f u d u d f u d y d y d u 1 d d y d u this hypothesis i e the relation between the cumulative probability f u and the ratio y d was tested for a number of natural rivers and was found to be approximately true singh 2011 the a posteriori p u is obtained by maximizing the entropy chiu 1988 jaynes 1957 yielding 4 p u e λ 1 1 e λ 2 u with λ1 λ2 are the lagrange multipliers for more details we refer the reader to chiu 1988 by replacing eq 4 in 3 and integrating after some algebraic manipulation one has 5 u m u max e λ 2 u max e λ 2 u max 1 1 λ 2 e λ 2 u assuming m λ2umax and replacing λ2 in 4 eq 1 is thus inferred chiu 1988 termini and moramarco 2017 by using only data from run1 w h 10 verified that the function φ m of eq 1 varies along the meandering bend however fig 6 suggests that the relation between um and umax could vary also as a function of the width to depth ratio in order to verify this behavior the cross sectional maximum value of velocity umax and the cross sectional mean velocity um have been also estimated for each examined section and for both runs in particular the mean velocity um has been obtained by integrating the measured u profiles on the cross section fig 8 reports the values of the normalized difference umax um umax 1 φ m estimated along the bend for both runs from this figure it can be observed that for both the width to depth ratios the normalized difference umax um umax increases i e φ m decreases as the radius of curvature decreases in particular umax um umax increases passing from the inflection section upstream a to section c for w h 10 and to section b for w h 10 then it decreases until to reach the apex section e for w h 10 and the section d for w h 10 then in both cases umax um umax increases again until to reach the bend exit section h after which it decreases towards the inflection section downstream in the case of w h 10 the normalized difference umax um umax assumes generally values higher than those obtained for w h 10 this suggests that for w h 10 the entropic function φ m um umax assumes values lower than those obtained in the case of w h 10 this can be also observed from fig 9 where the values of the ratio um umax φ m estimated for each section have been reported for both runs literature studies see as an example moramarco and singh 2010 greco and mirauda 2015 based on data measured in steady flow conditions either in gauged sections along natural channels or in laboratory flumes verified that m is constant in the same section for different flow rate ranges for the examined case the value of the entropic parameter m in each section can be estimated from eq 1 by knowing the corresponding value of the ratio um umax as reported in fig 10 by comparing fig 10 with fig 9 it is clear that the value of the parameter m follows that of the entropic function φ m um umax i e m decreases as the ratio um umax decreases in accordance with previous works see as an example in kumbhakar et al 2016 the lower value of m is reached at section c for w h 10 and at section b for w h 10 then the values of m increase until to reach section e for w h 10 and section d for w h 10 downstream of section d while for w h 10 m reaches a second minimum value at section h for w h 10 m decreases until to reach section i the observed behavior suggests that as the flow enters the bend the entropic parameter m reduces adjusting the magnitude of um and both the magnitude and the location of umax this is coherent with the structure of the secondary currents that influence the magnitude of um and umax and for the latter the location in the cross sectional flow area to better investigate this aspect following moramarco et al 2004 the formulation of eq 1 is also written for the generic vertical v as 6 u m v e m v e m v 1 1 m v u max v φ v m v u max v where mv indicates the so called local entropy parameter which is constant along the vertical v it is worth noting that eq 6 is inferred by assuming eq 1 holds also locally such as proposed by moramarco et al 2004 who showed the parameter mv can be considered a signal of the boundary effects on the velocity distribution thus the values of the local parameter mv have been estimated for both runs by using eq 6 from fig 11 which reports the contour maps of the estimated values of mv it can be observed that in the case of w h 10 the values of mv are generally higher than those obtained for w h 10 for w h 10 the higher values of mv are found close to the inner right bank at the inflection section a then they gradually cross the channel until that the higher values of mv are found close to the outer left bank at the apex section then the higher values of mv are maintained close to outer bank until to reach the inflection section downstream i for w h 10 mv assumes high values close to the inner bank of section a passing from this section to section b it crosses the channel increasing in value it slightly decreases passing from section c to section e then the higher values of mv maintain at the outer side of the cross section reaching the outer bank at the apex section e passing from the apex section e to section i the values of mv decrease close to the outer left bank and increase along the inner right bank thus fig 11 suggests that especially for w h 10 the pattern of the entropic parameter mv is similar to that of the term τbs cf which is in turn affected by the momentum transport by cross circulation termini 2015 inspecting fig 11 for both values of w h one can also infer that the minimum values of mv are located close the outer bank of section d where the maximum value of the velocity dip occurs and the maximum velocity is near the bed moreover comparing fig 11 with figs 4 and 5 it can be observed that along the bend the local entropic parameter mv assumes the higher values where the lower values of the velocity dip and the higher values of the maximum velocity umax v occur this could be due to the fact that the system responds to the changing curvature by varying the value of the entropic parameter mv and adjusting the magnitude and the location of umax v fig 11 also shows that in the case of w h 10 at the bend entrance the higher values of mv are found at a certain distance from the outer bank as well as it was observed for the values umax v this could be related to the presence of the aforementioned counter rotating cell in the outer bank region which limits the action of the central region circulation cell as verified by termini and piraino 2011 in the same meandering channel as that used in the present work 4 2 entropic model application to estimate velocity dip and bed shear stress distribution the results presented in the previous subsection suggest that the entropy model could be used to simulate the u profiles and the effect of secondary circulation on the bed shear stress distribution along the bend the 2d velocity distribution can be estimated by applying the entropy profile such as proposed by moramarco et al 2004 see also in termini and moramarco 2018 7 u ξ z u max v m ln 1 e m 1 z h v δ exp 1 z h v δ with 8 u max v u s v 1 m ln 1 e m 1 δ e 1 δ with ξ the horizontal distance of vertical v from the outer left bank and z the distance of velocity along v from the bottom hv and us v represent the flow depth of vertical v and the surface flow velocity respectively eq 7 is a simplification of entropy based 2d model developed by chiu 1988 who by exploiting principle of maximum entropy pome established a bridge between the probability domain wherein a probability distribution of the velocity is surmised and the physical space in particular chiu obtained the velocity distribution as 9 u u max m ln 1 e m 1 f u where f u γ γ 0 γ m a x γ 0 represents the cumulative probability distribution function and γ is a function of the spatial coordinates in the physical space γ max at the point where umax occurs γ0 at the channel bed where u 0 as eq 9 involves many parameters moramarco et al 2004 simplified the entropy based 2d velocity distribution assuming that the entropy velocity distribution written for the flow depth where umax occurs named y axis can be applied everywhere in flow area thus obtaining eq 7 therefore for a gage site for which m is given by historical velocity dataset once umax v is measured across the river and the cross section geometry is known the 2d velocity distribution can be easily estimated by using eq 7 in this way all information are available included the velocity dip δ to get the 2d velocity distribution in the case of high floods when only surface velocities are sampled u s v the value of umax v to be used in eq 7 can be estimated by eq 8 in this context the velocity dip δ is determined for each u profile through an iterative procedure by minimizing an objective function in estimating the error between observed values of m and computed ones mcom such as proposed by moramarco et al 2017 shortly for a gauged site for which m is known the velocity dip is estimated by an iterative procedure assigning an initial value of δ at z axis then an experimental distribution law δ developed by yang et al 2004 is applied across the river starting from the assigned initial value at z axis once δ is estimated in the cross sectional flow area and u s v is measured through eq 8 umax v is assessed and the 2d velocity can be evaluated by eq 7 from which the computed mean flow velocity um com is assessed considering that umax com max umax v is known mcom can be inferred using eq 1 as the ratio um com umax com the velocity dip δ is updated until the error between m and mcom is lower than a threshold for more details we refer the reader to moramarco et al 2017 fig 12 reports the contour maps of the computed entropy based velocity dip δcom normalized by the channel averaged water depth h along the bend for both runs the comparison between figs 12 and 4 indicates that the entropic model well estimates the pattern of the velocity dip along the bend for both w h moreover even in this case it s evident that just by sampling the surface velocity the entropy based 2d velocity model is able to simulate the effect both of the central region circulation cell and the counter rotating cell after having integrated along the u profiles computed by the entropic model and applied eq 7 the corresponding values of the depth averaged velocity um v com have been also determined thus in order to verify the applicability of the entropic model for determining the bed shear stress distribution the values of computed depth averaged velocity um v com have been used to evaluate the computed bed shear stress τbs com fig 13 reports the contour maps of the term τbs com cf ρu2 m v com for both runs fig 13 highlights that for both runs the distribution of the bed shear stress estimated by applying the entropic model compares well with that evaluated by using the experimental data shown in fig 7 even in this case one can figure out the coherence of computed τbs com and the presence of central region circulation cells and counter rotating cells it s worth noting that this results came out from the sampling of us v only and applying eqs 7 and 8 in summary the present application have allowed us to verify the existence of a relation between the entropic parameter m or of the entropic function ϕ m and the kinematic characteristics of the flow i e the feedback effect of secondary flow on the primary flow and bed shear stress distributions and thus the localization of the maximum velocity along the bend this is particularly interesting in a high curved channel where the effects of secondary flow is especially important 5 validation and comparison the applicability of the entropic model has been assessed by using data from fcf uk collected in a compound straight large scale flume of the university of birmingham http www birmingham ac uk the flume was 56 m long with the main section trapezoidal with depth h 0 15 m width equal to 1 5 m and 45 bank slope the width of flood plain was equal to b 10 m for the present work runs 1 2 3 from series a 01 reported in mohanty and khatua 2018 see also in devi and khatua 2016 and are used the manning s coefficient was equal to 0 01 table 1 reports for these runs the values of flow discharge q first column of the flow depth h in the main channel second column and of the ratio β third column between the depth of flow on flood plain and the depth of flow in the main channel h by using the experimental values of the ratios ud e umax ud e experimental depth averaged longitudinal velocity reported for the considered runs in mohanty and khatua 2018 in order to determine the values of the entropic function verifying eq 1 for each run an iterative procedure has been applied the mean velocity has been determined as the ratio between the flow discharge q and the cross sectional area a um q a thus assuming a first value of the entropic function φ m 0 6 according to previous literature findings see as an example in moramarco et al 2017 the maximum cross sectional velocity has been evaluated as umax φ m um then for each run this value of the maximum cross sectional velocity umax has been used to calculate by using the experimental values of the ratios ud e umax the depth averaged velocity ud c for each measurement vertical once that the horizontal distribution of ud c has been integrated in order to determine the mean velocity um c using the velocity area method for each run the final value of the entropic function φ m c has been calculated by minimizing the difference δ um um c the obtained values of the entropic function φ m c are reported in the fourth column of table 1 as it can be observed an almost constant value of φ m c 0 3 has been obtained to such a value of φ m c a value of the parameter m 2 49 corresponds it should be noted that this value of φ m c is different from that obtained in previous works moramarco and dingmann 2017 moramarco et al singh 2010 especially in straight flat bed channels but it is very close to those obtained in laboratory channels characterized by significant bed roughness i e in curved deformed bed and in straight vegetated bed channels see moramarco and termini 2015 termini and moramarco 2017 this suggests that the value of φ m c 0 3 obtained for the present application could be related to the roughness conditions of the channel considered for the application finally by using the obtained φ m c the corrected values of the maximum cross sectional velocity have been also determined as umax c um c φ m c fig 14 reports for each run the comparison between the horizontal distribution of the calculated ratios ud c umax c normalized calculated depth averaged velocity and that of the experimental ones ud e umax normalized experimental depth averaged velocity then by using the calculated ud c the values of the boundary shear stress have been also estimated as described in the sub section 3 2 fig 15 reports for each considered run the comparison between the calculated ratio τc τ max c normalized calculated boundary shear stress and the experimental one τe τ max e normalized experimental boundary shear stress figs 14 and 15 show the good agreement between the experimental and the estimated values of the normalized depth averaged velocity and of normalized boundary shear stress confirming the applicability of eq 1 to identify not only the velocity distribution but also the bed shear stress distribution 6 discussion the results presented in the previous sections have substantially demonstrated that the shape of the u profile varies along the bend and such a variation is strongly related to the variation of the cross sectional motion whose entity depends on the width to depth ratio w h this is consistent with the fact that as literature demonstrates among others yalin 1992 whiting and dietrich 1993 da silva et al 2006 termini 2015 the width to depth ratio is one the most important parameters affecting the entity of the cross sectional flow motion in particular for both the examined width to depth ratios w h 10 and w h 10 the maximum value of the longitudinal velocity umax v has been found below the free surface indicating that the u profiles present the velocity dip generally the velocity dip assumes for w h 10 values greater than those obtained for w h 10 and the local difference between the local maximum value of the longitudinal velocity umax v and the local free surface velocity us v assumes for w h 10 values lower than those obtained for w h 10 this suggests that passing from the free surface to the location of the maximum velocity the u profiles present a concave shape that is more pronounced near the free surface for lower values of the water depth w h 10 for both the width to depth ratios the entity of the velocity dip varies along the bend thus suggesting that the location of the maximum velocity umax v also varies along the bend the variation of the shape of the velocity profiles along the bend has been analyzed through the variation of the velocity dip i e the vertical distance of the maximum longitudinal velocity from the free surface and of the difference du between the maximum velocity and that at the free surface this analysis has allowed us to have an indication on the redistribution of the maximum velocity not only on the plane but also along the vertical in particular it has been verified that the higher values of the maximum velocity cross the bend passing from the inner bank of the inflection section upstream a to outer bank of the inflection section downstream i the lower values of the velocity dip have a pattern similar to that of the higher values of the maximum velocity this suggests that the higher values of the maximum velocity umax v are localized close to the free surface such a behavior is less evident for w h 10 especially downstream of the apex section where high values of the velocity dip occur the different behavior between w h 10 and w h 10 seems to be related to the fact that in a meandering bend the two components of the cross sectional motion i e the cross circulation and the convective component according to yalin 1992 assume a different relative importance in the two cases as demonstrated by termini 2009 using the same data of this study and by termini and piraino 2011 in particular their results indicated that the convective acceleration component is more significant for w h 10 than for w h 10 on the contrary in this last case the cross circulation component is more important attenuating the contribution of the convective acceleration component as consequence while in the case of w h 10 the shifting of the maximum velocity towards the outer bank occurs along the channel reach between the inflection section upstream to the apex section in the case of w h 10 the aforementioned shifting occurs gradually passing from the inflection section upstream to the inflection section downstream maintaining the maximum velocity not too far from the free surface results also show that at the bend entrance section d while for w h 10 the higher maximum of velocity is found close to the outer bank for w h 10 it is still maintained far from the outer bank itself this could due to the fact that as highlighted by termini and piraino 2011 in the same meandering bend as that considered in the present work at the bend entrance a counter rotating circulation cell initiates in the outer bank region so that especially in the case of w h 10 the central region circulation cell seems to split into two weak counter rotating circulation cells the counter rotating cell avoids the reaching of the higher velocity to the outer bank thus limiting the action of the central region circulation motion the analysis of the velocity dip and the maximum velocity distributions has also confirmed that the pattern of the velocity dip reflects the aforementioned effects of the cross sectional motion and of the corresponding circulation cells indeed the velocity dip is minimum where only the effect of a central region circulation cell moving from the inner to outer bank occurs driving the maximum velocity not too far from the free surface at the bend entrance especially for w h 10 because of the presence of outer bank circulation cell the maximum velocity is driven close to the bed near the outer bank determining high values of the velocity dip this result is particularly interesting for analysing the erosion action of flow in fact such a location coincides with the location where termini 2009 measured in the same meandering flume the maximum value of the bed erosion this behavior further confirms that the momentum transport by cross circulation contributing to redistribute the maximum velocity along the bend also affects the consequent erosion processes literature indicates among others chang 1988 whiting and dietrich 1993 that the convective acceleration of flow is associated with an imbalance between the transverse pressure gradient and the centrifugal acceleration and in a meander wave such an imbalance is continuously modified by the downstream changing channel curvature for w h 10 small width to depth ratios such an unbalance is attenuated by the momentum transport by the cross circulation developing in each cross section of the bend determining that the shifting of the maximum velocity along the bend is more gradual in the case of w h 10 than in the case of w h 10 as consequence also the distribution of the bed shear stress τbs cf shows the shifting of the higher values of τbs cf from the inner bank to the outer bank along the bend for w h 10 the higher values of the bed shear stress τbs cf gradually shift towards the outer bank from the inflection section upstream section a to the inflection section downstream section i for w h 10 the higher values of the bed shear stress τbs cf cross the channel passing from the inner bank of the inflection section upstream section a to the outer bank of the apex section section e then the bed shear stress τbs cf slightly decreases in value but maintaining the higher values close to the outer bank until to reach the inflection section downstream the aforementioned considerations indicate that the difference in the entity of the cross circulation between the case of w h 10 and the case of w h 10 affects the shape of the u profiles and consequently the local ratio between the local vertical mean velocity and the local maximum velocity um v umax v in particular it has been found that while the case of w h 10 the ratio um v umax v vary in the range 0 7 0 9 in the case of w h 10 the values of the ratio um v umax v assume lower values and vary in the range 0 4 0 75 by knowing the values of the local ratio um v umax v the application to the generic vertical v of the chiu s 1991 entropic model relating the flow velocity to the entropy function has allowed us to estimate the value of a local entropic parameter mv the analysis of the contour maps of the estimated mv values has shown that especially for w h 10 mv increases where flow accelerates and decreases where flow decelerates furthermore the entropic parameter mv generally follows a trend similar to that of τbs cf this suggests that the local entropic parameter could reflect the unbalance between the transverse pressure gradient and the centrifugal acceleration and its variation along the bend depends on the variation of the cross sectional motion according with the chiu s 1991 entropic model the ratio between the cross sectional mean velocity and the maximum cross sectional velocity um umax gives the entropic function φ m um umax the analysis of the variation of φ m and of the entropic parameter m along the bend has highlighted that for both the width to depth ratios they follows the same pattern in accordance with previous works see as an example in kumbhakar et al 2016 for w h 10 the lower values of m are found close to the bend entrance and close to the bend exit and the higher values close to the apex section e for w h 10 the lower and higher values are found slightly upstream of those for w h 10 the observed behavior of the entropic parameter m suggests that as the flow enters a bend it reduces adjusting the magnitude of um and both the magnitude and the location of umax thus the application of the entropy based 2d velocity distribution proposed by moramarco et al 2004 has allowed us also to estimate the values of the bed shear stress and the velocity dip just by sampling the surface velocity the comparison between the estimated values of both the bed shear stress and the velocity dip with the experimental ones has demonstrated that the entropic model well approximates the experimental distributions this means that the shape of the u profile which is affected by the entity of the cross sectional flow and the bed shear stress distribution could be directly estimated from the entropic model starting from acknowledgement of the surface velocity only 7 conclusion based on the obtained results with respect to the three specific objectives of the present work the following findings can be drawn with respect to the objective 1 the results indicate that the shape of the u profile varies along the bend as a function of the width to depth ratio in particular it has been verified that for low water depths and large width to depth ratios the u profile is more concave near the free surface and the dip δ assumes low values for small values of the width to depth ratio w h 10 the values of the local ratio between the mean velocity and the maximum velocity um v umax v vary in the range 0 7 0 9 for large values of the width to depth ratio w h 10 this ratio um v umax v assumes lower values varying in the range 0 4 0 75 this suggests that the higher values of the maximum velocity umax v are localized close to the free surface such a behavior is less evident downstream of the apex section for w h 10 where high dip values occur indicating that in such a channel the maximum velocity can be also found far from the free surface along the exit reach of the bend thus it can be concluded that the pattern of the velocity dip reflects the effect of cross sectional motion and of the related circulation cells with respect to the objective 2 the results indicate that the ratio between the cross sectional mean and maximum velocity um umax which is related to the entropic parameter m by the relation um umax φ m varies along the bend by having for w h 10 values lower than those obtained in the case of w h 10 by assuming that the relation between the mean velocity and the maximum one through the entropic parameter can be considered valid for each vertical v as um v umax v φv mv the map of the variation of the local entropic parameter mv along the bend has been analyzed results have shown that the local entropic parameter mv is slightly different between the case of w h 10 and the case of w h 10 and generally follows the pattern of the bed shear stress τbs cf the bed shear stress τbs cf in turn assumes a different behavior for w h 10 and w h 10 due to the fact that the cross circulation which is more significant for w h 10 than for w h 10 attenuates the effect of the convective acceleration at the outer bank this determines the shift of the higher values of τbs cf from the inner bank to the outer bank along the bend to be more gradual in the case of w h 10 than in the case of w h 10 especially for w h 10 mv increases where flow accelerates and decreases where flow decelerates this suggests that the local entropic parameter could reflect the unbalance between the transverse pressure gradient and the centrifugal acceleration thus it can be concluded that the feedback effect of cross sectional flow on the longitudinal velocity distribution could be qualitatively identified by applying the entropy concept and by analyzing the spatial distribution of entropic parameter m with respect to the objective 3 the results indicate that the plane distributions of the velocity dip and the bed shear stress estimated by applying the entropic model moramarco et al 2004 to the investigated cases are in good agreement with the experimental ones thus it can be concluded that the entropy theory is able to provide useful insights in terms of velocity dip just starting from the monitoring of surface velocity across the site in summary the results have shown that the pattern of the entropic parameter is similar to that of the term τbs cf which is in turn affected by the advective transport by cross circulation in accordance to termini 2015 the shape of u profile and the effect of the variation of the transversal motion along the bend could be directly estimated by the entropic model starting from the acknowledgement of the surface velocity only this is especially important for its practical relevance allowing us to estimate not only the shape of the velocity profile but also the evolution of the primary velocity and of the bed shear stress distribution along the bend starting from the knowledge of the surface velocity only it should be noted that this paper investigated on the possibility to analyze the variation of velocity dip and the variation of the transversal motion effect through the entropy profile restricting the attention to a high amplitude meander bend for which the role of curvature and of its downstream variation on the velocity pattern are especially important on the basis of the results obtained in previous works see as an example in moramarco et al 2004 moramarco and termini 2015 termini and moramarco 2017 we can assume that the methodology can be applied for different sinuosity values and as extreme case in straight channels however future research will be addressed to verify the effect of the two components of the transversal motion i e the cross circulation and the convective acceleration and the velocity dip also varying the planimetric configuration of the bend credit authorship contribution statement donatella termini conceptualization data curation formal analysis funding acquisition investigation methodology supervision validation writing original draft writing review editing tommaso moramarco conceptualization formal analysis funding acquisition investigation methodology software supervision validation writing review editing declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments this work has been supported by italian national research programme prin 2017 with the project interactions between hydrodynamics flows and biotic communities in fluvial ecosystems advancement in discharge monitoring and understanding of processes relevant for ecosystem sustainability by the development of novel technologies with field observations and laboratory testing enterprising 
444,literature shows the application of the entropy concept in open channels flow no existing research has been addressed to the application of the entropy concept for evaluating the effect of secondary flow which especially develops in curved channels the purpose of this paper is to explore the possibility to evaluate the effect of the secondary flow on the stream wise velocity distribution starting only from the knowledge of the surface velocity and the entropic concept application the analysis is conducted with the aid of data collected in a large amplitude meandering laboratory flume for two different values of the width to depth ratio results show that the location of the maximum velocity varies not only along the bend but also along the water depth depending on the relative entity of the cross circulation and the convective flow acceleration it has been also verified that the entropic parameter varies along the bend as a function of the width to depth ratio the application of the entropic model to the examined cases has allowed the verification that not only the shape of the velocity profile but also the bed shear stress evolution along the bend could be estimated by the entropic model starting from the knowledge of the surface velocity only 1 introduction as it is well known in a river bend secondary flow develops by the combination of the longitudinal flow with the cross sectional motion which is induced by the channel s curvature yalin 1992 and is due to the interaction of the forces associated with centrifugal acceleration transverse water surface slope and bed shear stress secondary flow exerts an important role in several processes involving in a natural stream such as the dispersion of nutrients and or of chemical substances as well as the trapping or transport of sediments in particular the cross sectional motion contributes both to shift the core of the maximum velocity among others leschziner and rodi 1979 johannesson and parker 1989 wilson et al 2003 and of the boundary shear stress along the bend thus modifying and reshaping the channel s bed and platform see as an example de vriend and gendolf 1983 whiting and dietrich 1993 knaapen et al 2001 blanckaert and graf 2004 roca et al 2009 termini and piraino 2011 and to enhance the mass mixing and the energy losses thus affecting the channel s conveying capacity camporeale et al 2005 nepf 2012 gurnell 2014 de serio et al 2018 the estimation of the rate of mass and momentum transport requires the knowledge of the velocity distribution along the channel thus the identification of the feedback between the cross sectional motion and the vertical profiles of the longitudinal velocity along the bend is fundamental in simulating dispersion and mixing processes in meandering bends which are characterized by a continuously changing curvature the cross sectional motion varies from section to section thus unlike straight channels the identification of the evolution of the cross sectional motion along the bend is especially important to estimate the variation of the turbulent activity of flow and the distribution of the downstream flow velocity along the bend itself according to yalin 1992 in meandering bends the cross sectional motion can be considered as composed by the curvature induced cross circulation which is characterized by zero depth average and the convective component which is due to the changing channel s curvature and produces a net flux of mass in the transversal direction see fig 1 literature among others johannesson and parker 1989 whiting and dietrich 1993 da silva et al 2006 termini 2009 termini and piraino 2011 indicates that the role of the aforementioned components cannot be analyzed independently of the width to depth ratio and the channel s sinuosity da silva et al 2006 focused on the case of large width to depth ratio and analysed the influence of channel s sinuosity on the flow pattern in flat bed sine generated laboratory flumes characterized by different values of the deflection angle at the crossover θo i e θ30 50 70 90 110 as a result they verified that the channel s sinuosity especially affects the location of the convectively accelerated decelerated flow along the channel for a given channel s sinuosity the width to depth ratio is the most important parameter affecting the entity of the two aforementioned cross sectional motion components being the cross circulation more significant for small width to depth ratios than for large width to depth ratios see also in whiting and dietrich 1993 lanzoni et al 2006 blackheart et al 2008 termini 2015 it should be also considered that several studies conducted in straight channels among others steffler et al 1985 cardoso et al 1989 nezu and nakagawa 1993 yang et al 2004 troiani et al 2004 yang and lee 2007 najafabadi et al 2018 have related the transport of momentum due to the secondary flow to the so called dip phenomenon for which the position of the maximum longitudinal velocity occurs below the water surface as schematized in fig 1 moramarco et al 2017 investigated the spatial distribution of the velocity dip in sites along straight natural channels by leveraging the entropy theory they identified the distance of the maximum longitudinal velocity from the free surface velocity dip δ in fig 1 and showed how turn the surface velocity into depth averaged velocity termini and moramarco 2018 analyzed the u profiles measured only at the apex and inflection sections of a large amplitude meander wave from their analysis it appeared clear that the dip phenomenon occurs in all the considered sections but with different entity this result suggested that the variation of the velocity dip along the channel could be strongly related to the evolution of the cross sectional motion along the bend termini and moramarco 2018 also verified that the velocity dip δ varies as a function of the width to depth ratio w h and assumes in average a value of around 53 of the local flow depth for small width to depth ratio and of around 34 for large width to depth ratio this suggests that the velocity dip is evident for small width to depth ratios but it is also present for large width to depth ratio this is consistent with previous literature findings obtained in straight channels among others sarma et al 1983 tachie et al 2003 successively termini 2019 identified an equation which relates the main controlling parameters of the flow processes i e the local channel s curvature and the width to depth ratio to the local velocity dip specifically she demonstrated that for a given value of the width to depth ratio the velocity dip δ varies along the meander wave as a function both of the normalized distance from the outer bank ξ w with ξ coordinate in the transversal direction see fig 2 and of the local channel s curvature which could be parameterized by the local deflection angle θ she also proposed a relation which directly relates the velocity dip δ to the parameters θ and w h from the aforementioned considerations it is clear that although literature researches have allowed significant progress in understanding meander flow dynamics the mechanism of the velocity dip formation and the relation with secondary motion is still poorly understood in this context the main aim of the present work is to explore the link between the velocity dip and the secondary motion and the possibility to explain it by leveraging the entropy theory starting from the monitoring of surface velocity this allows us to answer to the question if it is possible to evaluate the feedback effect of cross sectional flow on the longitudinal velocity and shear stress distributions in curved channels starting from the monitoring of surface velocities only such a possibility could be of great interest for hydrological practices considering that some fundamental insights could be inferred along natural channels in terms of flow erosion and shear stress distribution just sampling the surface velocity this study has been inspired by the recent findings obtained by moramarco et al 2017 and termini and moramarco 2018 and is motivated by the fact that although considerable attention has been given to the application of entropy concept to estimate either the velocity distribution in open channels moramarco and singh 2010 termini and moramarco 2017 or other specific parameters sterling and knight 2002 atieh et al 2015a 2015b atieh et al 2017 sheikh and bonakdari 2015 kumbhakar and ghoshal 2016a 2016b kumbhakar et al 2016 atieh et al 2017 kumbhakar et al 2017 kumbhakar and ghoshal 2016 kundu 2017 singh et al al 2017 ebtehaj et al 2018 khozani and bonakdari 2018 kazemian kale kale et al 2018 no existing research addresses the application of the entropy concept to estimate secondary flow effect especially in curved open channels thus the present work is part of a broader research project aimed at examining the meander dynamics and the applicability of the entropic concept to predict the effect of secondary currents on the primary velocity distribution and the flow discharge just using surface velocity observations specifically the present study complements previous studies conducted by termini and moramarco 2018 restricting the attention to a high amplitude meander bend for which the role of curvature and of its downstream variation on the velocity pattern are especially important the aforementioned general goal is achieved by three specific objectives 1 to investigate for large and small width to depth ratios if the velocity dip and its variation of along the bend could be related to the effect of the cross sectional flow evolution along the bend 2 to verify how such an effect could be identified by applying the entropy concept by the spatial distribution of entropic parameter m characterizing the velocity profile shape 3 to analyze if the entropy theory is able to provide useful insights in terms of velocity dip distribution along straight and bended channels just starting from the monitoring of surface velocity across the site the paper is organized as follows section 2 describes the experimental data used and the experimental results are discussed in section 3 the application of the entropic parameter are presented in section 4 discussion is reported in section 5 and finally conclusion are summarized in section 6 2 materials and methods 2 1 experimental data the data used in the present work were collected in the ambit of a broader research program aimed to analyze the flow pattern in a high amplitude meandering channel in particular data taken from termini 2009 have been used the data were collected in a meandering channel 25 12 m long following the sine generated curve with a deflection angle at the inflection section θo 110 the channel cross section is rectangular with width w 0 50 m the fixed vertical sidewalls are of plexiglass and the bed is of quartz sand d50 medium sediment diameter 0 65 mm in order to isolate the effect of channel s curvature in the present work only the experimental runs conducted over the rigid and flat bed runs called as rb 1 and rb 2 in termini 2009 have been considered in particular rb 1 run hereon indicated as run1 was conducted with a flow discharge of q 0 019 m3 s channel averaged flow depth h 5 5 cm w h 9 09 10 rb 2 run hereon indicated as run2 was conducted with a flow discharge q 0 007 m3 s channel averaged flow depth h 3 0 cm w h 16 67 10 herein in accordance with previous researches among others nezu and rodi 1985 yalin 1992 da silva et al 2006 termini and piraino 2011 w h 10 indicates small width to depth ratio and w h 10 indicates large width to depth ratio during each run the water surface was measured using a profiler indicator pv09 delft hydraulics with a precision of 0 1 mm the instantaneous local longitudinal u t and transversal v t velocity components were measured in sections spaced about 50 cm or so apart in points spaced of 1 1 5 mm along the verticals of nine transverse abscissas the flow velocity measurements were carried out by using a 2d side looking acoustic doppler velocimeter adv by sontek inc identified symmetrically to the channel axis see details in termini 2009 bearing in mind the specific aim of the present work our attention is focused only on the longitudinal velocity component u t measured in the central bend between the two consecutive inflection sections a and i indicated in fig 2 by using the time series of the measured longitudinal flow velocity component u t the corresponding time averaged longitudinal velocity u was estimated along each measurement vertical of the considered sections the analyses reported in the present work have been performed by considering the local reference system reported in fig 2 s coordinate in the longitudinal direction ξ coordinate in the transversal direction 3 experimental results 3 1 variation of the u profile shape along the bend and relation with the velocity dip as indicated in the introduction the results obtained in the previous works termini and moramarco 2018 have suggested that the formation of the velocity dip and its variation along the bend could be related to the evolution of the cross sectional motion whose entity also varies as a function of the width to depth ratio among others whiting and dietrich 1993 termini 2015 this also suggests that the knowledge of the variation of the u profile shape along the bend could be important in order to identify the evolution of secondary motion along the bend itself for this reason in the present work the measured u values have been first used in order to analyze how the shape of the u profiles varies along the bend for both the considered width to depth ratios the u profile shape has been examined for each measurement vertical v by estimating not only the velocity dip i e the distance δ of the local maximum velocity umax v from the free surface but also the difference du between the local maximum value of the velocity umax v and the local free surface velocity us v see the scheme of fig 1 figs 3 and 4 report respectively the distributions along the bend of the difference du umax v us v and of the velocity dip δ normalized by the channel averaged flow depth h obtained for both the width to depth ratios it can be observed that generally du assumes for w h 10 values lower than those for w h 10 the normalized velocity dip δ assumes for w h 10 values greater than those obtained for w h 10 in particular fig 3 indicates that for both the width to depth ratios du increases along the inner right bank i e passing from section a to section i along the outer left bank a different behavior can be observed between the case of w h 10 and the case of w h 10 in the case of w h 10 the lower values of du which are found close to the inner bank of the inflection section a gradually cross the channel reaching the outer side of section d bend entrance at a certain distance from the outer bank itself it should be noted that section d is slightly downstream of the section where the tangent to the inflection section intersects the outer bank then the lower values of du are maintained close to the outer left bank until to reach the inflection section downstream section i in the case of w h 10 the lower values of du are also found close to the inner right bank of section a but they cross the channel and reach the outer side at section c which is slightly upstream of the section where the tangent to the inflection section intersects the outer bank passing from section c to section d they are maintained close to the outer left bank then the difference du increases in value and the lower values are obtained not too close to the outer bank until to reach section f from this section to the inflection section downstream section i the lower values of du are found close to the outer bank the comparison between figs 3 and 4 highlights that generally the lower values of δ are found where the lower values of du are obtained a different behavior between the case of w h 10 and the case of w h 10 can be observed also for δ along the outer left bank in particular for w h 10 the normalized velocity dip δ assumes the higher values close to the outer bank of the section d bend entrance and between sections g and h i e close to the bend exit while low values of the velocity dip are found close to the apex section thus in this case δ increases close to the outer left bank passing from section a where almost constant values of the velocity dip occur to section d then it slightly decreases until to reach the apex section passing from the apex section to the bend exit between sections g and h it slightly increases and then it decreases until to reach the inflection section downstream i where it assumes almost constant low values for w h 10 upstream of the apex section the normalized velocity dip δ assumes a behavior similar but less accentuated than that for w h 10 at downstream of the apex section δ assumes high values with a peak close to the outer bank of section f bend exit until to reach the inflection section downstream i the different behavior observed between w h 10 and w h 10 could be related to the fact that the two components of the transversal velocity i e the cross circulation and the convective acceleration assume a different relative importance in the two considered cases as verified by termini 2009 by using the same data of the present work and by termini and piraino 2011 in particular their results indicated that for w h 10 the convective acceleration component is more significant than w h 10 in this last case the cross circulation component attenuates the contribution of the convective acceleration component furthermore comparing figs 3 and 4 it s evident that the maximum du occurs at the outer bank of sections d and e where the maximum velocity dip occurs while at the inner bank the phenomenon is the opposite in other words the cross circulation component increases its effect moving from the inner to the outer bank as the channel s curvature increases driving the location of the maximum velocity towards the bed near the outer side of section d in summary figs 3 and 4 show that the difference du assumes low values where also the normalized velocity dip assumes low values and thus where the maximum velocity is closer to the free surface the difference in the shape of the u profiles between w h 10 and w h 10 occurs especially in the region close to the outer bank downstream of section d where for w h 10 du assumes values higher than those obtained for w h 10 this means that for w h 10 the u profiles are strongly concavely curved near the free surface the results also suggest that the u profile assumes a more concave shape near the free surface for lower water depths as consequence of the aforementioned behavior the location of the maximum velocity umax v varies along the bend for both w h moving from the inner right bank to the outer left one as one passes from section a to section e as fig 5 shows at the bend entrance section d while for w h 10 the higher value of the maximum of velocity is found close to the outer bank for w h 10 it is still maintained far from the outer bank itself such a different behavior can be explained by the fact that a counter rotating circulation cell see fig 1 initiates in the outer bank region of the bend entrance i e close to section d as demonstrated by termini and piraino 2011 thus especially along the channel reach between sections d and f the action of the central region circulation cell is limited by the presence of the counter rotating circulation cell figs 3 and 4 give also an indication on the redistribution of the maximum velocity not only in the stream wise direction as fig 5 shows but also in the vertical one it is clear that the higher values of umax v cross the bend passing from the inner bank of the inflection section a to outer bank of the inflection section i as well as the lower values of the normalized velocity dip δ this suggests that the higher values of the maximum velocity umax v are close to the free surface in the case of w h 10 downstream of the apex section where high velocity dip values occur such a behavior is less evident thus indicating that the maximum velocity can be also found far from the free surface along the bend exit reach this could be related to the fact that in the case of w h 10 the effect due to the cross circulation on the longitudinal velocity is not significant and decreases especially along the bend exit reach yalin 1992 da silva et al 2006 termini 2009 furthermore focusing the attention to the region close to the outer bank it can be observed that for both the width to depth ratios passing from the inflection section upstream section a to the bend entrance section d the normalized velocity dip assumes high increasing values with a peak around the outer bank of section d meaning that there the maximum velocity is localized near the bed the observed behavior also suggests that the pattern of the velocity dip reflects the effect of circulation cells due to the cross sectional motion indeed where the velocity dip is minimum sections b and c of fig 4 only the effect of a central region circulation cell moving from the inner to outer bank occurs as the channel s curvature increases i e at the bend entrance section d especially for w h 10 an outer bank circulation cell initiates close to the free surface as shown by termini and piraino 2011 analyzing the evolution of cross sectional flow along the same meandering bend and the central region circulation cell seems to split into two weak counter rotating circulation cells this effect could drive the location of the maximum velocity close to the bed near the outer side of section d determining high values of the velocity dip this result is particularly interesting for analysing the erosion action of flow to the bed in particular the fact that close to the outer bank of the bend entrance the velocity dip is significant and the maximum velocity is localized just close to the bed could explain why at such a location the maximum bed erosion was observed in previous works whiting and dietrich 1993 termini 2009 in particular termini 2009 measured the equilibrium bed deformation obtained at the end of mobile bed runs with hydraulic conditions corresponding to run1 and run2 she verified that in both cases the maximum bed scour occurs approximately where the tangent to the inner bank at the upstream inflection section a intersects the outer bank see fig 3 and thus close to the outer bank of section d this behavior is also consistent with previous results obtained by blanckaert and graf 2004 indicating that the momentum transport by cross circulation contributes to redistribute the maximum velocity along the bend affecting the consequent erosion processes to better understand this phenomenon the role of the water depth on the shape of the velocity profile is also analyzed by the value of the ratio um v umax v where um v and umax v are respectively the depth averaged velocity and the maximum velocity referring to the vertical profile v specifically um v is estimated on the basis of velocity profile measured by adv fig 6 reports the value of the ratio um v umax v against the ratio w hv where hv indicates the local water depth from this figure it appears clear that with exception of few points for run1 w h 10 the values of the ratio um v umax v vary in the range 0 7 0 9 with a variation of the ratio w hv in the range 8 12 for run2 w h 10 the values of the ratio um v umax v are generally lower than those observed for run1 and vary in the range 0 4 0 75 while the values of the ratio w hv vary in the range 12 20 the different values of the ratio um v umax v between w h 10 and w h 10 further indicates how the different magnitude of the momentum transport by the cross circulation which is more significant for w h 10 could affect the distribution of the longitudinal velocity 3 2 experimental distribution of the bed shear stress it is important to estimate the bed shear stress along the bend which reshapes the bed topography in the present work according to other authors see as an example blanckaert et al 2008 termini 2016 in a first approximation the experimental bed shear stress has been estimated by using the depth averaged velocity for vertical profile v as τbs ρ cf um v 2 with c f χ g chèzy type dimensionless friction coefficient fig 7 which reports the contour maps of the term τbs cf ρum v 2 estimated for both runs highlights that for both runs the higher bed shear stress lies near the inner right bank at the inflection section a along the bend it crosses gradually the channel and at the inflection section downstream it is found near the outer left bank this behavior is especially evident in the case of w h 10 where along the bend the higher values of τbs cf gradually shift from the inner bank to the outer bank in the case of w h 10 the higher values of τbs cf shift towards the outer bank passing from section a to section e then values of τbs cf decrease until to reach section f increasing again until to reach the bend exit between sections f and g passing from section g to the inflection section downstream i the values of τbs cf slightly decrease it is important to note that this pattern of bed shear stress is consistent with that obtained by termini 2009 by using the law of the wall according with termini 2009 the different behavior observed for w h 10 and w h 10 might be caused by the fact that the cross circulation which is more significant for w h 10 than for w h 10 attenuates the effect of the convective acceleration at the outer bank this entails the shift of the high values of τbs cf from the inner bank to the outer bank more gradual along the bend in the case of w h 10 4 entropic model application 4 1 entropic parameter distribution along the bend in this section a short description of entropic model and its application has given along with the relation between the entropic parameter m or the entropic function ϕ m and the kinematic characteristics of the flow the entropic model chiu 1988 1991 chiu and murray 1992 ciu and hsu 2006 correlates the cross sectional mean velocity um to the cross sectional maximum velocity umax using the linear relationship 1 u m e m e m 1 1 m u max φ m u max with m the entropic parameter umax is considered as the maximum value of all velocity points sampled in the cross sectional flow area during a measurement moramarco et al 2004 um is obtained by applying the velocity area method to the measured velocity profiles therefore for a gage site in which a velocity dataset is available φ m and hence m can be estimated on the basis of pairs um umax as regards the theoretical ground of eq 1 this comes from the expression of mean flow velocity 2 u m 0 u m a x u x y p u d u where u x y is the velocity in the cross sectional flow area x y represent the distance from the left side of bank and from the bed respectively p u is the probability density function obtained by assuming an a priori cumulative probability distribution function f u y d chiu 1988 3 p u d f u d u d f u d y d y d u 1 d d y d u this hypothesis i e the relation between the cumulative probability f u and the ratio y d was tested for a number of natural rivers and was found to be approximately true singh 2011 the a posteriori p u is obtained by maximizing the entropy chiu 1988 jaynes 1957 yielding 4 p u e λ 1 1 e λ 2 u with λ1 λ2 are the lagrange multipliers for more details we refer the reader to chiu 1988 by replacing eq 4 in 3 and integrating after some algebraic manipulation one has 5 u m u max e λ 2 u max e λ 2 u max 1 1 λ 2 e λ 2 u assuming m λ2umax and replacing λ2 in 4 eq 1 is thus inferred chiu 1988 termini and moramarco 2017 by using only data from run1 w h 10 verified that the function φ m of eq 1 varies along the meandering bend however fig 6 suggests that the relation between um and umax could vary also as a function of the width to depth ratio in order to verify this behavior the cross sectional maximum value of velocity umax and the cross sectional mean velocity um have been also estimated for each examined section and for both runs in particular the mean velocity um has been obtained by integrating the measured u profiles on the cross section fig 8 reports the values of the normalized difference umax um umax 1 φ m estimated along the bend for both runs from this figure it can be observed that for both the width to depth ratios the normalized difference umax um umax increases i e φ m decreases as the radius of curvature decreases in particular umax um umax increases passing from the inflection section upstream a to section c for w h 10 and to section b for w h 10 then it decreases until to reach the apex section e for w h 10 and the section d for w h 10 then in both cases umax um umax increases again until to reach the bend exit section h after which it decreases towards the inflection section downstream in the case of w h 10 the normalized difference umax um umax assumes generally values higher than those obtained for w h 10 this suggests that for w h 10 the entropic function φ m um umax assumes values lower than those obtained in the case of w h 10 this can be also observed from fig 9 where the values of the ratio um umax φ m estimated for each section have been reported for both runs literature studies see as an example moramarco and singh 2010 greco and mirauda 2015 based on data measured in steady flow conditions either in gauged sections along natural channels or in laboratory flumes verified that m is constant in the same section for different flow rate ranges for the examined case the value of the entropic parameter m in each section can be estimated from eq 1 by knowing the corresponding value of the ratio um umax as reported in fig 10 by comparing fig 10 with fig 9 it is clear that the value of the parameter m follows that of the entropic function φ m um umax i e m decreases as the ratio um umax decreases in accordance with previous works see as an example in kumbhakar et al 2016 the lower value of m is reached at section c for w h 10 and at section b for w h 10 then the values of m increase until to reach section e for w h 10 and section d for w h 10 downstream of section d while for w h 10 m reaches a second minimum value at section h for w h 10 m decreases until to reach section i the observed behavior suggests that as the flow enters the bend the entropic parameter m reduces adjusting the magnitude of um and both the magnitude and the location of umax this is coherent with the structure of the secondary currents that influence the magnitude of um and umax and for the latter the location in the cross sectional flow area to better investigate this aspect following moramarco et al 2004 the formulation of eq 1 is also written for the generic vertical v as 6 u m v e m v e m v 1 1 m v u max v φ v m v u max v where mv indicates the so called local entropy parameter which is constant along the vertical v it is worth noting that eq 6 is inferred by assuming eq 1 holds also locally such as proposed by moramarco et al 2004 who showed the parameter mv can be considered a signal of the boundary effects on the velocity distribution thus the values of the local parameter mv have been estimated for both runs by using eq 6 from fig 11 which reports the contour maps of the estimated values of mv it can be observed that in the case of w h 10 the values of mv are generally higher than those obtained for w h 10 for w h 10 the higher values of mv are found close to the inner right bank at the inflection section a then they gradually cross the channel until that the higher values of mv are found close to the outer left bank at the apex section then the higher values of mv are maintained close to outer bank until to reach the inflection section downstream i for w h 10 mv assumes high values close to the inner bank of section a passing from this section to section b it crosses the channel increasing in value it slightly decreases passing from section c to section e then the higher values of mv maintain at the outer side of the cross section reaching the outer bank at the apex section e passing from the apex section e to section i the values of mv decrease close to the outer left bank and increase along the inner right bank thus fig 11 suggests that especially for w h 10 the pattern of the entropic parameter mv is similar to that of the term τbs cf which is in turn affected by the momentum transport by cross circulation termini 2015 inspecting fig 11 for both values of w h one can also infer that the minimum values of mv are located close the outer bank of section d where the maximum value of the velocity dip occurs and the maximum velocity is near the bed moreover comparing fig 11 with figs 4 and 5 it can be observed that along the bend the local entropic parameter mv assumes the higher values where the lower values of the velocity dip and the higher values of the maximum velocity umax v occur this could be due to the fact that the system responds to the changing curvature by varying the value of the entropic parameter mv and adjusting the magnitude and the location of umax v fig 11 also shows that in the case of w h 10 at the bend entrance the higher values of mv are found at a certain distance from the outer bank as well as it was observed for the values umax v this could be related to the presence of the aforementioned counter rotating cell in the outer bank region which limits the action of the central region circulation cell as verified by termini and piraino 2011 in the same meandering channel as that used in the present work 4 2 entropic model application to estimate velocity dip and bed shear stress distribution the results presented in the previous subsection suggest that the entropy model could be used to simulate the u profiles and the effect of secondary circulation on the bed shear stress distribution along the bend the 2d velocity distribution can be estimated by applying the entropy profile such as proposed by moramarco et al 2004 see also in termini and moramarco 2018 7 u ξ z u max v m ln 1 e m 1 z h v δ exp 1 z h v δ with 8 u max v u s v 1 m ln 1 e m 1 δ e 1 δ with ξ the horizontal distance of vertical v from the outer left bank and z the distance of velocity along v from the bottom hv and us v represent the flow depth of vertical v and the surface flow velocity respectively eq 7 is a simplification of entropy based 2d model developed by chiu 1988 who by exploiting principle of maximum entropy pome established a bridge between the probability domain wherein a probability distribution of the velocity is surmised and the physical space in particular chiu obtained the velocity distribution as 9 u u max m ln 1 e m 1 f u where f u γ γ 0 γ m a x γ 0 represents the cumulative probability distribution function and γ is a function of the spatial coordinates in the physical space γ max at the point where umax occurs γ0 at the channel bed where u 0 as eq 9 involves many parameters moramarco et al 2004 simplified the entropy based 2d velocity distribution assuming that the entropy velocity distribution written for the flow depth where umax occurs named y axis can be applied everywhere in flow area thus obtaining eq 7 therefore for a gage site for which m is given by historical velocity dataset once umax v is measured across the river and the cross section geometry is known the 2d velocity distribution can be easily estimated by using eq 7 in this way all information are available included the velocity dip δ to get the 2d velocity distribution in the case of high floods when only surface velocities are sampled u s v the value of umax v to be used in eq 7 can be estimated by eq 8 in this context the velocity dip δ is determined for each u profile through an iterative procedure by minimizing an objective function in estimating the error between observed values of m and computed ones mcom such as proposed by moramarco et al 2017 shortly for a gauged site for which m is known the velocity dip is estimated by an iterative procedure assigning an initial value of δ at z axis then an experimental distribution law δ developed by yang et al 2004 is applied across the river starting from the assigned initial value at z axis once δ is estimated in the cross sectional flow area and u s v is measured through eq 8 umax v is assessed and the 2d velocity can be evaluated by eq 7 from which the computed mean flow velocity um com is assessed considering that umax com max umax v is known mcom can be inferred using eq 1 as the ratio um com umax com the velocity dip δ is updated until the error between m and mcom is lower than a threshold for more details we refer the reader to moramarco et al 2017 fig 12 reports the contour maps of the computed entropy based velocity dip δcom normalized by the channel averaged water depth h along the bend for both runs the comparison between figs 12 and 4 indicates that the entropic model well estimates the pattern of the velocity dip along the bend for both w h moreover even in this case it s evident that just by sampling the surface velocity the entropy based 2d velocity model is able to simulate the effect both of the central region circulation cell and the counter rotating cell after having integrated along the u profiles computed by the entropic model and applied eq 7 the corresponding values of the depth averaged velocity um v com have been also determined thus in order to verify the applicability of the entropic model for determining the bed shear stress distribution the values of computed depth averaged velocity um v com have been used to evaluate the computed bed shear stress τbs com fig 13 reports the contour maps of the term τbs com cf ρu2 m v com for both runs fig 13 highlights that for both runs the distribution of the bed shear stress estimated by applying the entropic model compares well with that evaluated by using the experimental data shown in fig 7 even in this case one can figure out the coherence of computed τbs com and the presence of central region circulation cells and counter rotating cells it s worth noting that this results came out from the sampling of us v only and applying eqs 7 and 8 in summary the present application have allowed us to verify the existence of a relation between the entropic parameter m or of the entropic function ϕ m and the kinematic characteristics of the flow i e the feedback effect of secondary flow on the primary flow and bed shear stress distributions and thus the localization of the maximum velocity along the bend this is particularly interesting in a high curved channel where the effects of secondary flow is especially important 5 validation and comparison the applicability of the entropic model has been assessed by using data from fcf uk collected in a compound straight large scale flume of the university of birmingham http www birmingham ac uk the flume was 56 m long with the main section trapezoidal with depth h 0 15 m width equal to 1 5 m and 45 bank slope the width of flood plain was equal to b 10 m for the present work runs 1 2 3 from series a 01 reported in mohanty and khatua 2018 see also in devi and khatua 2016 and are used the manning s coefficient was equal to 0 01 table 1 reports for these runs the values of flow discharge q first column of the flow depth h in the main channel second column and of the ratio β third column between the depth of flow on flood plain and the depth of flow in the main channel h by using the experimental values of the ratios ud e umax ud e experimental depth averaged longitudinal velocity reported for the considered runs in mohanty and khatua 2018 in order to determine the values of the entropic function verifying eq 1 for each run an iterative procedure has been applied the mean velocity has been determined as the ratio between the flow discharge q and the cross sectional area a um q a thus assuming a first value of the entropic function φ m 0 6 according to previous literature findings see as an example in moramarco et al 2017 the maximum cross sectional velocity has been evaluated as umax φ m um then for each run this value of the maximum cross sectional velocity umax has been used to calculate by using the experimental values of the ratios ud e umax the depth averaged velocity ud c for each measurement vertical once that the horizontal distribution of ud c has been integrated in order to determine the mean velocity um c using the velocity area method for each run the final value of the entropic function φ m c has been calculated by minimizing the difference δ um um c the obtained values of the entropic function φ m c are reported in the fourth column of table 1 as it can be observed an almost constant value of φ m c 0 3 has been obtained to such a value of φ m c a value of the parameter m 2 49 corresponds it should be noted that this value of φ m c is different from that obtained in previous works moramarco and dingmann 2017 moramarco et al singh 2010 especially in straight flat bed channels but it is very close to those obtained in laboratory channels characterized by significant bed roughness i e in curved deformed bed and in straight vegetated bed channels see moramarco and termini 2015 termini and moramarco 2017 this suggests that the value of φ m c 0 3 obtained for the present application could be related to the roughness conditions of the channel considered for the application finally by using the obtained φ m c the corrected values of the maximum cross sectional velocity have been also determined as umax c um c φ m c fig 14 reports for each run the comparison between the horizontal distribution of the calculated ratios ud c umax c normalized calculated depth averaged velocity and that of the experimental ones ud e umax normalized experimental depth averaged velocity then by using the calculated ud c the values of the boundary shear stress have been also estimated as described in the sub section 3 2 fig 15 reports for each considered run the comparison between the calculated ratio τc τ max c normalized calculated boundary shear stress and the experimental one τe τ max e normalized experimental boundary shear stress figs 14 and 15 show the good agreement between the experimental and the estimated values of the normalized depth averaged velocity and of normalized boundary shear stress confirming the applicability of eq 1 to identify not only the velocity distribution but also the bed shear stress distribution 6 discussion the results presented in the previous sections have substantially demonstrated that the shape of the u profile varies along the bend and such a variation is strongly related to the variation of the cross sectional motion whose entity depends on the width to depth ratio w h this is consistent with the fact that as literature demonstrates among others yalin 1992 whiting and dietrich 1993 da silva et al 2006 termini 2015 the width to depth ratio is one the most important parameters affecting the entity of the cross sectional flow motion in particular for both the examined width to depth ratios w h 10 and w h 10 the maximum value of the longitudinal velocity umax v has been found below the free surface indicating that the u profiles present the velocity dip generally the velocity dip assumes for w h 10 values greater than those obtained for w h 10 and the local difference between the local maximum value of the longitudinal velocity umax v and the local free surface velocity us v assumes for w h 10 values lower than those obtained for w h 10 this suggests that passing from the free surface to the location of the maximum velocity the u profiles present a concave shape that is more pronounced near the free surface for lower values of the water depth w h 10 for both the width to depth ratios the entity of the velocity dip varies along the bend thus suggesting that the location of the maximum velocity umax v also varies along the bend the variation of the shape of the velocity profiles along the bend has been analyzed through the variation of the velocity dip i e the vertical distance of the maximum longitudinal velocity from the free surface and of the difference du between the maximum velocity and that at the free surface this analysis has allowed us to have an indication on the redistribution of the maximum velocity not only on the plane but also along the vertical in particular it has been verified that the higher values of the maximum velocity cross the bend passing from the inner bank of the inflection section upstream a to outer bank of the inflection section downstream i the lower values of the velocity dip have a pattern similar to that of the higher values of the maximum velocity this suggests that the higher values of the maximum velocity umax v are localized close to the free surface such a behavior is less evident for w h 10 especially downstream of the apex section where high values of the velocity dip occur the different behavior between w h 10 and w h 10 seems to be related to the fact that in a meandering bend the two components of the cross sectional motion i e the cross circulation and the convective component according to yalin 1992 assume a different relative importance in the two cases as demonstrated by termini 2009 using the same data of this study and by termini and piraino 2011 in particular their results indicated that the convective acceleration component is more significant for w h 10 than for w h 10 on the contrary in this last case the cross circulation component is more important attenuating the contribution of the convective acceleration component as consequence while in the case of w h 10 the shifting of the maximum velocity towards the outer bank occurs along the channel reach between the inflection section upstream to the apex section in the case of w h 10 the aforementioned shifting occurs gradually passing from the inflection section upstream to the inflection section downstream maintaining the maximum velocity not too far from the free surface results also show that at the bend entrance section d while for w h 10 the higher maximum of velocity is found close to the outer bank for w h 10 it is still maintained far from the outer bank itself this could due to the fact that as highlighted by termini and piraino 2011 in the same meandering bend as that considered in the present work at the bend entrance a counter rotating circulation cell initiates in the outer bank region so that especially in the case of w h 10 the central region circulation cell seems to split into two weak counter rotating circulation cells the counter rotating cell avoids the reaching of the higher velocity to the outer bank thus limiting the action of the central region circulation motion the analysis of the velocity dip and the maximum velocity distributions has also confirmed that the pattern of the velocity dip reflects the aforementioned effects of the cross sectional motion and of the corresponding circulation cells indeed the velocity dip is minimum where only the effect of a central region circulation cell moving from the inner to outer bank occurs driving the maximum velocity not too far from the free surface at the bend entrance especially for w h 10 because of the presence of outer bank circulation cell the maximum velocity is driven close to the bed near the outer bank determining high values of the velocity dip this result is particularly interesting for analysing the erosion action of flow in fact such a location coincides with the location where termini 2009 measured in the same meandering flume the maximum value of the bed erosion this behavior further confirms that the momentum transport by cross circulation contributing to redistribute the maximum velocity along the bend also affects the consequent erosion processes literature indicates among others chang 1988 whiting and dietrich 1993 that the convective acceleration of flow is associated with an imbalance between the transverse pressure gradient and the centrifugal acceleration and in a meander wave such an imbalance is continuously modified by the downstream changing channel curvature for w h 10 small width to depth ratios such an unbalance is attenuated by the momentum transport by the cross circulation developing in each cross section of the bend determining that the shifting of the maximum velocity along the bend is more gradual in the case of w h 10 than in the case of w h 10 as consequence also the distribution of the bed shear stress τbs cf shows the shifting of the higher values of τbs cf from the inner bank to the outer bank along the bend for w h 10 the higher values of the bed shear stress τbs cf gradually shift towards the outer bank from the inflection section upstream section a to the inflection section downstream section i for w h 10 the higher values of the bed shear stress τbs cf cross the channel passing from the inner bank of the inflection section upstream section a to the outer bank of the apex section section e then the bed shear stress τbs cf slightly decreases in value but maintaining the higher values close to the outer bank until to reach the inflection section downstream the aforementioned considerations indicate that the difference in the entity of the cross circulation between the case of w h 10 and the case of w h 10 affects the shape of the u profiles and consequently the local ratio between the local vertical mean velocity and the local maximum velocity um v umax v in particular it has been found that while the case of w h 10 the ratio um v umax v vary in the range 0 7 0 9 in the case of w h 10 the values of the ratio um v umax v assume lower values and vary in the range 0 4 0 75 by knowing the values of the local ratio um v umax v the application to the generic vertical v of the chiu s 1991 entropic model relating the flow velocity to the entropy function has allowed us to estimate the value of a local entropic parameter mv the analysis of the contour maps of the estimated mv values has shown that especially for w h 10 mv increases where flow accelerates and decreases where flow decelerates furthermore the entropic parameter mv generally follows a trend similar to that of τbs cf this suggests that the local entropic parameter could reflect the unbalance between the transverse pressure gradient and the centrifugal acceleration and its variation along the bend depends on the variation of the cross sectional motion according with the chiu s 1991 entropic model the ratio between the cross sectional mean velocity and the maximum cross sectional velocity um umax gives the entropic function φ m um umax the analysis of the variation of φ m and of the entropic parameter m along the bend has highlighted that for both the width to depth ratios they follows the same pattern in accordance with previous works see as an example in kumbhakar et al 2016 for w h 10 the lower values of m are found close to the bend entrance and close to the bend exit and the higher values close to the apex section e for w h 10 the lower and higher values are found slightly upstream of those for w h 10 the observed behavior of the entropic parameter m suggests that as the flow enters a bend it reduces adjusting the magnitude of um and both the magnitude and the location of umax thus the application of the entropy based 2d velocity distribution proposed by moramarco et al 2004 has allowed us also to estimate the values of the bed shear stress and the velocity dip just by sampling the surface velocity the comparison between the estimated values of both the bed shear stress and the velocity dip with the experimental ones has demonstrated that the entropic model well approximates the experimental distributions this means that the shape of the u profile which is affected by the entity of the cross sectional flow and the bed shear stress distribution could be directly estimated from the entropic model starting from acknowledgement of the surface velocity only 7 conclusion based on the obtained results with respect to the three specific objectives of the present work the following findings can be drawn with respect to the objective 1 the results indicate that the shape of the u profile varies along the bend as a function of the width to depth ratio in particular it has been verified that for low water depths and large width to depth ratios the u profile is more concave near the free surface and the dip δ assumes low values for small values of the width to depth ratio w h 10 the values of the local ratio between the mean velocity and the maximum velocity um v umax v vary in the range 0 7 0 9 for large values of the width to depth ratio w h 10 this ratio um v umax v assumes lower values varying in the range 0 4 0 75 this suggests that the higher values of the maximum velocity umax v are localized close to the free surface such a behavior is less evident downstream of the apex section for w h 10 where high dip values occur indicating that in such a channel the maximum velocity can be also found far from the free surface along the exit reach of the bend thus it can be concluded that the pattern of the velocity dip reflects the effect of cross sectional motion and of the related circulation cells with respect to the objective 2 the results indicate that the ratio between the cross sectional mean and maximum velocity um umax which is related to the entropic parameter m by the relation um umax φ m varies along the bend by having for w h 10 values lower than those obtained in the case of w h 10 by assuming that the relation between the mean velocity and the maximum one through the entropic parameter can be considered valid for each vertical v as um v umax v φv mv the map of the variation of the local entropic parameter mv along the bend has been analyzed results have shown that the local entropic parameter mv is slightly different between the case of w h 10 and the case of w h 10 and generally follows the pattern of the bed shear stress τbs cf the bed shear stress τbs cf in turn assumes a different behavior for w h 10 and w h 10 due to the fact that the cross circulation which is more significant for w h 10 than for w h 10 attenuates the effect of the convective acceleration at the outer bank this determines the shift of the higher values of τbs cf from the inner bank to the outer bank along the bend to be more gradual in the case of w h 10 than in the case of w h 10 especially for w h 10 mv increases where flow accelerates and decreases where flow decelerates this suggests that the local entropic parameter could reflect the unbalance between the transverse pressure gradient and the centrifugal acceleration thus it can be concluded that the feedback effect of cross sectional flow on the longitudinal velocity distribution could be qualitatively identified by applying the entropy concept and by analyzing the spatial distribution of entropic parameter m with respect to the objective 3 the results indicate that the plane distributions of the velocity dip and the bed shear stress estimated by applying the entropic model moramarco et al 2004 to the investigated cases are in good agreement with the experimental ones thus it can be concluded that the entropy theory is able to provide useful insights in terms of velocity dip just starting from the monitoring of surface velocity across the site in summary the results have shown that the pattern of the entropic parameter is similar to that of the term τbs cf which is in turn affected by the advective transport by cross circulation in accordance to termini 2015 the shape of u profile and the effect of the variation of the transversal motion along the bend could be directly estimated by the entropic model starting from the acknowledgement of the surface velocity only this is especially important for its practical relevance allowing us to estimate not only the shape of the velocity profile but also the evolution of the primary velocity and of the bed shear stress distribution along the bend starting from the knowledge of the surface velocity only it should be noted that this paper investigated on the possibility to analyze the variation of velocity dip and the variation of the transversal motion effect through the entropy profile restricting the attention to a high amplitude meander bend for which the role of curvature and of its downstream variation on the velocity pattern are especially important on the basis of the results obtained in previous works see as an example in moramarco et al 2004 moramarco and termini 2015 termini and moramarco 2017 we can assume that the methodology can be applied for different sinuosity values and as extreme case in straight channels however future research will be addressed to verify the effect of the two components of the transversal motion i e the cross circulation and the convective acceleration and the velocity dip also varying the planimetric configuration of the bend credit authorship contribution statement donatella termini conceptualization data curation formal analysis funding acquisition investigation methodology supervision validation writing original draft writing review editing tommaso moramarco conceptualization formal analysis funding acquisition investigation methodology software supervision validation writing review editing declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments this work has been supported by italian national research programme prin 2017 with the project interactions between hydrodynamics flows and biotic communities in fluvial ecosystems advancement in discharge monitoring and understanding of processes relevant for ecosystem sustainability by the development of novel technologies with field observations and laboratory testing enterprising 
