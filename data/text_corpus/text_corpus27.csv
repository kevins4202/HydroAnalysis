index,text
135,smoothed particle hydrodynamics sph has successfully been employed in the last decade for macroscopic simulation of fluid flow in porous media however there are still certain inconsistencies in the existing models with regard to both the definition of the governing equations and the adopted numerical treatments in this study thus in order for a comparative investigation of the existing practices the method of spatial averaging is employed to derive two types of macroscopic conservation equations of mass and momentum through phase averaging and intrinsic phase averaging of fluid density consistent discretisation methods are adopted for the determination of particle s volume in the weakly compressible sph form and velocity by which particles move and they are used to construct three numerical models the models are then employed to solve two different types of problems i a fully saturated soil medium under the closed channel flow condition and ii a porous medium under a free surface flow condition with varying saturation the results of the models are compared with analytical and experimental data and particle distribution water surface elevation conservation of fluid volume and pressure distribution are investigated it is shown that only the latter type of modelling i e intrinsic phase averaging of fluid density leads to the conservation of fluid volume for both types of the problems while the former type of formulation i e based on phased averaged density also known as apparent density is suitable for closed porous media flow conditions only comparisons with other numerical models and the author s previous study indicate that the adopted numerical treatments especially the δ sph formulation have led to an improvement in the smoothness of particles distribution and pressure field a few recommendations are finally made about potential further improvements of the developed models and extensions of their applicability keywords particle method porous media free surface flow macroscopic modelling spatial averaging volume conservation 1 introduction studying the interaction of fluid flow with porous media is of great importance for researchers and engineers in several areas of engineering including chemical petroleum mechanical and water engineering the latter of which often concerns problems in rivers and coasts in rivers the bed is often composed of solid grains such as sand and gravel thus water penetrates into the bed although flow inside the porous bed has a substantially lower velocity than the overlying flow it plays a key role in the transfer of momentum at the bed boundary which in turn affects the structure of turbulence and the overlying flow this mechanism is especially important when engineers study the transport of sediment or pollutants in coastal areas the majority of natural or man made protective structures such as breakwaters soil embankments and dikes are porous these structures interact with waves and currents and experience a variety of flow incidents such as wave breaking on the slope of structure run up overtopping etc in order to design stable coastal protective structures which are efficient in mitigating the effect of flow incidents it is essential to understand the mechanisms formed while water flows through the porous media due to the difficulties with laboratory and field experimentations engineers usually use numerical modelling as a complementary tool for studying fluid flow in porous media one of the approaches which has recently been more attractive especially in the field of coastal engineering is the application of particle methods such as smoothed particle hydrodynamics sph this is particularly because of the strengths of the sph method in treating free surface and large deforming boundaries for a few key examples and the current situation and challenges of the sph method see kazemi et al 2017 khayyer et al 2017 gotoh and khayyer 2018 verbrugghe et al 2018 liu and zhang 2019 lind et al 2020 gotoh et al 2021 sriram and ma 2021 vacondio et al 2021 and for a comprehensive review see luo et al 2021 although there has been a continuous and increasing use of sph in the last three decades for wave and current simulations the application of this method for modelling fluid flow in porous media has still been limited since the first study in 2010 by shao 2010 after that akbari 2014 ren et al 2016 pahar and dhar 2016 losada et al 2016 peng et al 2017 khayyer et al 2018 wen et al 2018 kazemi et al 2020a akbari and torabbeigi 2021 tsurudome et al 2021 and shimizu et al 2022 are some of the key studies in this area all these studies simulated flow through porous media macroscopically the popularity of macroscopic modelling has been mainly due to the fact that the feasibility of microscopic modelling which is preferable in an ideal world is questionable for practical applications this is because it will need a fine resolution of the solid fluid interface boundaries and the small flow scales using computational discretisation close to direct numerical simulation dns in spite of the great achievements there is still an immaturity in the modelling treatments when sph is used for macroscopic simulation of fluid flow in porous media for example there is still a question about the definition of governing equations whether based on phase average or intrinsic phase average of fluid quantities phase average refers to the spatial average of a phase quantity e g fluid velocity over a volume that contains both phases fluid and solid while intrinsic phase average denotes the average of the quantity over the volume occupied by that specific phase only for fluid velocity for example phase average represents discharge darcy velocity and intrinsic phase average is equivalent to discharge velocity divided by the porosity of the medium for more details of the definitions see section 2 another question is regarding the discretisation of the computational domain do computational elements i e particles need to be defined as the space occupied by fluid only or should it represent both a mixture of fluid and solid phases following this two other questions arise as follows should particles move with the velocity of the fluid phase or the velocity of the fluid solid mixture and does saturation of porous media e g whether it is dry before water flows into it matter when one determines the form of the governing equations and chooses the discretisation method these questions can relatively straightforwardly be addressed when eulerian grid based methods are employed this is because in those methods computational elements i e grids are fixed in space but in the case of lagrangian particle methods such as sph computational elements move in space and carry fluid properties therefore the above points should be addressed carefully for rigorous development of sph formulation for fluid flow in porous media as summarised in table 1 the sph studies have formulated the equation of mass continuity based on either intrinsic phase averaged density akbari 2014 akbari and namin 2013 akbari and torabbeigi 2021 kazemi et al 2020a kazemi et al 2020b wen et al 2020 shimizu et al 2022 or phase averaged density also known as apparent density gui et al 2015 khayyer et al 2018 peng et al 2017 ren et al 2016 shao 2010 wen et al 2018 in the former thus solution describes the temporal rate of the fluid s density volume while the latter models the temporal change of the sph particle s density volume temporal change of density volume is restricted to be less than about 1 in the weakly compressible version of sph wcsph while it is enforced to be zero in the incompressible sph isph method so that the divergence free condition is satisfied in the latter the effect of density averaging choice of phase average or intrinsic phase average is reflected in the formulation of pressure poisson s equation for example by incorporating temporal change of porosity for instance see khayyer et al 2018 in sph the volume of a fluid particle is often defined as the mass fraction of fluid divided by the particle s apparent density in the case of formulating the equation of mass based on phase averaged density when a particle moves to a region with different porosity its volume remains unchanged but the fractions of fluid and solid inside the volume may change but for the case of defining the equation of mass based on intrinsic averaged density a particle always carries the same amount of fluid mass resulting in a change in its volume when it moves from one to another region with different porosities this issue is taken into account only in the studies of akbari and namin 2013 akbari 2014 pahar and dhar 2016 kazemi et al 2020a kazemi et al 2020b and shimizu et al 2022 equation of momentum also can describe the rate of temporal change of either phase averaged velocity or intrinsic phase averaged velocity the former is equivalent to darcy s velocity also known as discharge velocity superficial velocity or apparent velocity representing flow per unit volume of the porous media while the latter which represents fluid velocity describes fluid flow through the volume occupied by fluid only according to table 1 most of the studies used phase averaged discharge velocity to formulate the navier stokes equations and only a few of them kazemi et al 2020a khayyer et al 2018 peng et al 2017 wen et al 2020 used intrinsic averaged velocity but this is not an important issue for the present application only in the case of movable porous media according to wang et al 2015 the use of phase averaged velocity can break the galilean invariance when porous media is fixed on the other hand using either phase averaged or intrinsic averaged velocities will lead to the same system of momentum conservation the output quantity is different but it is convertible intrinsic averaged velocity can be converted to phase averaged velocity by multiplying it by the porosity of media however the velocity by which particles are moved is important if the equation of mass is defined to impose the continuity of fluid s density i e intrinsic averaged density particles should move with fluid s velocity i e intrinsic averaged velocity on the other hand if the equation of mass is defined based on sph particle s density apparent density then particles should move according to their phase averaged velocity this indicates a requirement of consistency between the conservation of mass volume and the motion of sph particles an issue that is not present in the eulerian grid based flow simulations where computational nodes are fixed most of the sph studies have adopted this consistency in their models except ren et al 2016 and perhaps some other studies as not all of them have presented the detail of the computation of particle motion see table 1 with regard to the range of problems that a sph model can solve for fluid flow in porous media two important factors are the type of flow and the saturation condition of the media amongst the sph studies gui et al 2015 and wen et al 2020 simulated fully saturation conditions only i e the cases where porous media was always saturated and taking flow incompressibility into account mass flux flowing in and out of the media was equal the other studies simulated both types of flows with and without fully saturation conditions see table 1 the present study aims at investigating the issues discussed above and more specifically to show that when the continuity equation is formulated based on intrinsic phase averaged density volume of fluid is conserved while by defining the equation based on phase averaged apparent density sph particle s volume is preserved but fluid s volume conservation is not necessarily satisfied then the following points will be addressed for each case i the definition of particle s volume in the discretised form ii the velocity by which particle s motion is simulated iii the implications this will have on the derivation of material derivatives and iv the types of problems which can be solved in each case the novelty of this study lies in providing a rigorous description of the sph underlying theoretical framework for simulating fluid flow interaction with porous media so that it can pave the way towards a more mathematical consistent and less empirical guidance for practical applications of sph in water engineering for this purpose firstly a mathematical scheme based on the method of volume averaging and sph discretisation is introduced in section 2 then three models are developed in section 3 one based on intrinsic averaged density and the other two based on phase averaged apparent density these models are then compared in section 4 by applying them to simulate two free surface flow problems in one test u tube the porous medium is under closed flow and fixed saturation conditions and in the other test dam break it is under free surface flow and unequal inflow outflow mass flux conditions these test cases are chosen in order to investigate the applicability of the developed models for the two different types of problems the models are compared in terms of free surface elevation velocity volume conservation and pressure distribution finally in section 5 a summary of the findings applicability of the models and their potential future improvements are highlighted 2 mathematical scheme and definitions microscopic modelling of fluid flow through porous media is not straightforward it needs capturing solid fluid interfaces as rigid wall boundaries hence requires a very fine discretisation of the computational domain in order to resolve all the necessary flow motions therefore the concept of macroscopic modelling is often used instead in many engineering applications in this approach the porous region is described as a continuum without a need for modelling fluid solid interfaces thus fluid motion is averaged over a local averaging volume containing both fluid and solid a well known approach for this is the method of volume averaging formulated by whitaker 1999 where each point in the domain with position vector r is associated with a small volume namely a representative elementary volume rev the size of the volume should satisfy the condition l ψ rrev l ψ where r rev is the characteristic size of the volume radius of a circle or sphere in 2d or 3d if a sph kernel function is used to define the volume and l ψ and l ψ are the characteristic micro and macro sizes of the porous media respectively fig 1 shows a schematic rev in 2d the volumes occupied by fluid dvf and solid dvs constitute the total volume of the rev as dv dvf dvs 2 1 spatial averaging according to whitaker 1999 for a fluid quantity ψ two averages are defined at the averaging volume namely phase average ψ and intrinsic phase average ψ f these averages are formulated in eqs 1 a and 1 b respectively and have a relationship based on fluid phase fraction α f also called porosity as defined in eq 1 c 1 a ψ 1 d v v f ψ d v 1 b ψ f 1 d v f v f ψ d v 1 c ψ α f ψ f phase average ψ represents the spatial average of fluid quantity ψ over the total volume of rev i e the volume containing both fluid and solid while intrinsic phase average ψ f represents the average of fluid quantity ψ over only the volume occupied by fluid dvf this definition implies that α f dvf dv in the sph form phase and intrinsic phase averages are defined as below 2 a ψ v w r r h ψ d r 2 b ψ f v f w r r h ψ d r f where r and r are the position vector of the centroid and other points than the centroid of the averaging volume w is the kernel function and h is the smoothing length dr and d r f denote all the points and the points occupied only by fluid in the averaging volume respectively in order to derive the spatially averaged macroscopic governing equations which are the conservation equations of mass and momentum it is necessary to define the relationships between phase average of derivatives of a fluid quantity and phase average of the quantity itself the spatial averaging theorem whitaker 1999 expressed in the sph form as below provides such definitions 3 a ψ ψ a f s w ψ n f s d a 3 b ψ ψ a f s w ψ n f s d a where ψ and ψ are phase averages of gradient and divergence of scalar ψ and vector ψ respectively afs denotes the fluid solid interfaces within the averaging volume and n fs is the unit normal vector directed from fluid to solid the phase average of local time derivative of ψ is defined as the following kazemi et al 2020a 4 ψ t ψ t besides it is possible to show that the phase and intrinsic phase averages of product of two fluid quantities ψ and φ can be defined as follows jarauta et al 2020 5 a ϕ ψ 1 α f ϕ ψ 5 b ϕ ψ f ϕ f ψ f all these definitions in eqs 1 to 5 will be used in section 3 for the derivation of the macroscopic equations before that the discretised forms of the relationships are introduced in the following 2 2 discretised form of spatial averaging discretised forms of phase and intrinsic phase averages of a fluid quantity ψ eq 2 are expressed as 6 a ψ a b w r a r b h ψ b d v b 6 b ψ a f b w r a r b h ψ b f d v b and their spatial derivatives are written as 7 a ψ a x j b w r a r b h x j ψ b d v b 7 b ψ a f x j b w r a r b h x j ψ b f d v b where a and b denote central particle at which averaging is performed and its neighbouring particles within the volume respectively and dv is the particle s volume according to kazemi et al 2020a porosity at particle a can be approximated at a fixed background mesh as 8 α a f b w r a r c h φ γ c d v c where c denote nodes of the background mesh and γ c is the value of a distribution function at mesh point c the distribution function is set to one or zero if the mesh point is located in the fluid or solid phases respectively the average in eq 8 is performed using smoothing length h ϕ this parameter should be set to a value which adequately represents the physical condition of the porous media especially the length scales at the interface of the media with an overlaying clear water flow kazemi et al 2020a dvc is the volume of the mesh element associated with point c it is equal to lc 2 and lc 3 in two and three dimensional simulations respectively if a regular mesh with spacing lc is used lc should be sufficiently small to ensure the average in eq 8 is smooth it is thus chosen to be less than h ϕ 2 3 particle s volume volume of a generic particle a is defined as the mass of fluid carried by the particle m 0 f divided by the apparent density of the particle apparent density is the phase averaged density of particle ρ a which is equivalent to the intrinsic phase averaged density ρ a f multiplied by fluid s phase fraction or porosity at the particle s position α a f for fluid s mass a constant quantity m 0 f is considered it is the mass of fluid carried by the particle when it is in the clear water region where the entire volume of the particle is occupied by fluid only by this definition particle s volume is equal to m 0 f ρ a f in the clear water region but a more general form is required to represent particles volume in all the regions in the domain including the porous media in the case of imposing continuity equation of mass based on the time derivative of intrinsic phase averaged density i e d ρ f dt in fact the weakly compressibility wcsph or the incompressibility isph of the fluid s volume is formulated therefore particle s volume is defined in a way that fluid s volume inside the particle remains unchanged for isph or slightly changing for wcsph due to the small changes in the density i e d v a m 0 f α a f ρ a f this definition is presented as discretisation a in fig 2 in the case of defining equation of mass based on temporal derivative of phased averaged density i e d ρ dt the weakly compressibility wcsph or the incompressibility isph of flow is imposed through restricting variations of sph particle s volume rather than its fluid volume this requires the mass of fluid carried by the particle to be changeable when the particle moves between regions with different porosities so that the particle s volume remains unchanged therefore in this case particle s volume is defined as d v a α a f m 0 f ρ a which is introduced as discretisation b in fig 2 3 governing equations and numerical models in this section firstly derivation of macroscopic equations of mass and momentum in the sph form using the definitions in section 2 is presented then three models are introduced for discretisation of the equations followed by the numerical schemes employed for approximation of the closure models numerical diffusive terms and boundary conditions 3 1 derivation of macroscopic equations microscopic conservation equations of mass and momentum for the fluid phase are written in the following eulerian form 9 ρ t ρ u 0 10 ρ u t ρ u u p i σ ρ g where ρ is fluid density u is point value of fluid velocity p is fluid pore pressure σ is fluid newtonian shear stress tensor g is the gravitational acceleration and i is the identity tensor to obtain the macroscopic governing equations the above two equations are spatially averaged using the definitions presented in eqs 3 to 5 this is performed for two types of continuity i conservation of phase averaged density ρ and ii conservation of intrinsic phase averaged density ρ f for details of the averaging process which leads to the lagrangian form of the equations for these two types see appendix then two models namely models i and ii are developed by discretising the macroscopic equations for each type based on the sph formalism model i presents the discretised form of the macroscopic governing equations when the equation of mass is defined based on ρ f and model ii is developed for presenting the equations based on the phase averaged density ρ in the derivation of the macroscopic equations in model i the particle s motion is formulated based on the intrinsic phase averaged velocity u f for this purpose in the transformation of the eulerian form of the equations to the lagrangian form i e converting local time derivatives of density and velocity into their material derivatives eq 11 a is applied where a denotes density or velocity for model ii this is performed using eq 11 b i e particles are moved with their phase averaged velocity u this is because in the case of continuity of the phase average density ρ discretisation b a particle s volume represents not only fluid but also a part of it is occupied by solid an issue which is often neglected in order to show how the disregard of this issue may affect the results of an sph simulation a third model namely model iii is developed the governing equations of model iii are similar to model ii with the difference that the extra terms in the latter which are added to the equations due to the use of definition 11 b are disregarded in other words it is supposed in model iii that the transformation of the local time derivatives to material derivatives is performed using intrinsic phase average velocity u f instead of phase averaged velocity u 11 a a t u f a 11 b a t u a 3 2 discretised forms of equations and numerical models this section presents the details of the three models in eqs 12 13 and 14 parts a and b of the equations show the lagrangian forms of the macroscopic governing equations developed for models i ii and iii respectively then in parts c and d the discretised forms of the equations are presented and the rest of the equations show the definitions of the volume of particles their motion and the relationship between density and pressure in this study a wcsph scheme is adopted for pressure calculation where compressibility of flow is restricted to be less than 1 by setting the speed of sound c 0 to 10 g h 0 with g 9 81 and h 0 initial water depth in the momentum equations f v and f d are the viscous and drag terms f v represents α f σ f see appendix and is approximated as an artificial viscous term as proposed by marrone et al 2011 f d is approximated by the ergun s equation in the discretised forms a and b denote the central particle in the averaging volume and its neighbouring particles within the volume note that the particle s fluid mass m 0 f is fixed and set initially to ρ 0 f l 0 2 in 2d where ρ 0 f is the reference density of the fluid and l 0 is the initial particle spacing in the clear water region where the porosity is unity da in the discretised equations of mass presents an additional diffusive term to suppress the unphysical pressure oscillations as proposed in the δ sph formulation of marrone et al 2011 details of the drag closure term and the δ sph diffusive terms are presented in section 3 3 for the sake of simplicity no additional closure models are used for flow turbulence shear stresses in the test cases simulated in this study section 4 are not significant and hence this assumption will not produce appreciable errors 3 2 1 model i macroscopic equations of mass and momentum eqs 12 a and 12 b are derived in terms of intrinsic phase averages of fluid quantities ρ f and u f see appendix a i the equations are then discretised as presented in eqs 12 c 12 d for a generic particle a the volume of neighbouring particles of particle a is set to m 0 f α b f ρ b f as described in discretisation a in section 2 3 see fig 2 particles move with their intrinsic averaged velocity u f as shown in eq 12 f and the intrinsic average of pressure p f representing fluid s pressure is linked to the intrinsic averaged density ρ f using eq 12 g 12 a d ρ f d t ρ f α f α f u f 12 b d u f d t p f ρ f f v α f ρ f f d α f ρ f g 12 c d ρ a f d t ρ a f α a f b α b f u b f α a f u a f a w a b d v b d a 12 d d u a f dt 1 ρ a f b p a f p b f a w ab d v b f v a α a f ρ a f f d a α a f ρ a f g 12 e d v a m 0 f α a f ρ a f 12 f d r a d t u a f 12 g p a f c 0 2 ρ a f ρ 0 f 3 2 2 model ii the macroscopic equation of mass eq 13 a is derived in terms of phase averaged density ρ see appendix a ii the momentum equation represents material derivative of the intrinsic velocity u a f as in model i once velocity is calculated it can simply be transformed to u using eq 13 f on the right hand side of the equations extra terms α f 1 u f ρ in the equation of mass and α f 1 u f u f in the equation of momentum emerged due to the use of the phase averaged velocity u in the transformation of the local time derivatives to the material derivatives see eq 11 and appendix a ii the discretised forms of the equations are presented in eqs 13 c and 13 d for a generic particle a the volume of neighbouring particles b is set to α b f m 0 f ρ b as described in discretisation b in section 2 3 see fig 2 the velocity divergence in the conservation equation of mass first term on the right hand side of eq 13 a is written in terms of intrinsic averaged velocity u f which is usually discretised as ρ a b u b f u a f a w a b d v b while particles move based on their phase averaged velocity u therefore numerical noises may occur near the interface between clear water and porous media where variation of the porosity is rapid to guarantee a more stable solution near the interface boundary the divergence term is discretised as shown in the first term on the right hand side of eq 13 c particles move with their phase average velocity u as described in eq 13 g and the intrinsic average of pressure p f is linked to the phase averaged density ρ using eq 13 h 13 a d ρ d t ρ u f 1 α f u f ρ 13 b d u f d t α f p f ρ f v ρ f d ρ g 1 α f u f u f 13 c d ρ a d t 1 2 ρ a b u b f u a f a w a b d v b 1 α a f b u b u a a w a b d v b 1 α a f u a f ρ a α a f d a 13 d d u a f d t α a f ρ a b p b f p a f a w a b d v b f v a ρ a f d a ρ a g 1 α a f u a f u f a 13 e d v a α a f m 0 f ρ a 13 f u a α a f u a f 13 g d r a d t u a 13 h p a f c 0 2 ρ a α a f ρ 0 f 3 2 3 model iii the macroscopic equations for model iii are the same as model ii excluding the extra terms α f 1 u f ρ and α f 1 u f u f from the equations of mass and momentum respectively this model is to show that in the case of writing equations in terms of phase averaged density ρ if these two terms are neglected i e if the transformation of local time derivatives of density and velocity to their material derivatives is performed based on u f instead of u how the results of an sph simulation will be affected note that in this model particles still move with u as in model ii but only the extra terms are disregarded this is the practice adopted in the sph studies such as shao 2010 and gui et al 2015 and possibly in some other studies in which details of the particle s motion are not presented 14 a d ρ d t ρ u f 14 b d u f d t α f p f ρ f v ρ f d ρ g 14 c d ρ a d t 1 2 ρ a b u b f u a f a w a b d v b 1 α a f b u b u a a w a b d v b α a f d a 14 d d u a f d t α a f ρ a b p b f p a f a w a b d v b f v a ρ a f d a ρ a g 14 e d v a α a f m 0 f ρ a 14 f u a α a f u a f 14 g d r a d t u a 14 h p a f c 0 2 ρ a α a f ρ 0 f 3 3 closure models and extra terms the density diffusive term for a generic particle a i e da is approximated according to the δ sph formulation proposed by marrone et al 2011 as follows 15 a d a χ h c 0 b ω a b a w a b d v b 15 b ω a b 2 ρ b f ρ a f r b r a r b r a 2 ρ b l ρ a l 15 c ρ a l b ρ b f ρ a f l a a w a b d v b 15 d l a b r b r a a w a b d v b 1 where ρ a l is the renormalized density gradient l a is the renormalization matrix and χ is the diffusive parameter set to 0 1 for all the simulations in this study the artificial viscous term for a generic particle a i e f va is approximated according to marrone et al 2011 as follows 16 a f v a ϵ v h c 0 ρ 0 f b π a b a w a b d v b 16 b π a b u b f u a f r b r a r b r a 2 where ε v is a constant which controls the intensity of the velocity diffusion and is set to 0 1 in all the simulations in this study to estimate the drag effects at a generic particle a i e f da the permeability and forchheimer tensors in eqs a 10 are defined as whitaker 1996 17 a k a d s 2 α a f 3 c 1 1 α a f 2 i 17 b β f a f u a f i f c 2 α a f c 1 1 α a f ρ 0 f d s μ where ds is the mean size of solid grains in the porous media and c 1 and c 2 are model constants substituting eqs 17 a and 17 b in eqs a 10 yields 18 f d a c 1 1 α a f 2 α a f μ d s 2 u a f c 2 1 α a f ρ 0 f d s u a f u a f which is equivalent to ergun s equation for calculation of the drag stresses c 1 and c 2 are set to 150 and 1 75 respectively according to ergun s model the sets of the governing equations for all the three models are defined in unified frameworks more specifically they describe the fluid motion over the entire computational domain including both the clear water and porous regions while the difference between the regions is characterised by the change in the porosity the advantage of this treatment is that no discontinuity is introduced at the interface between the two regions avoiding ad hoc numerical treatments to match the conditions at the interfacial boundary 3 4 boundary conditions and time marching scheme in the wcsph scheme the free surface boundary is tracked without any special treatment thus no boundary condition is defined here for the free surface for rigid wall boundaries fixed ghost particles of marrone et al 2011 are applied in this method a few layers of fixed ghost particles are set to represent wall boundaries the number of layers is determined according to the requirement of a complete support domain of the kernel function of fluid particles and an interpolation point is associated to each ghost particle by mirroring its position into the fluid domain then at every time step the fluid quantities are averaged at the interpolation points using a moving least square kernel in the present simulations since the wall boundaries are fixed the velocities of ghost particles are set to zero and to apply the neumann condition for pressure the formulation proposed in marrone et al 2011 is employed for time marching a predictor corrector scheme is adopted and the time step size dt is chosen according to the cfl condition as dt αcfl h c 0 with αcfl 0 5 table 2 presents the solution procedure the numerical schemes are implemented in an in house fortran 90 program developed by the authors 3 5 constraints of particle based discretisation there are certain constraints with the sph discretisation of the computational domain kazemi et al 2020a showed that the support radius of the kernel function used for the calculation of porosity twice of h ϕ in eq 8 should be constrained by the characteristic length scale of the solid matrix at the interfacial boundary between porous and clear water regions i e 2h ϕ l d i no constraint is introduced for h ϕ in the porous region due to the fact that in the macroscopic simulations the porous media is assumed to be homogeneous and continuous with a constant porosity there is also no constraint for h ϕ in the clear water region since porosity is constant 1 0 in this region besides the size of the support of the kernel function w used for the discretisation of the governing equations h in eqs 6 and 7 should always be constrained by the characteristic length scale of the average flow field particularly with regard to flow velocity and set equally over space and remain unchanged with time 4 models applications to test the models developed in section 3 and assess their accuracy and conservation properties two test cases namely u tube and dam break are simulated and the results are compared with analytical or experimental data the simulations are all in two dimensional 2d based on the wcsph method with numerical schemes elaborated in the previous section 4 1 test cases the sketches of the domain of the two test cases u tube and dam break are depicted in fig 3 the u tube test is about a linear seepage flow in a u tube containing a porous soil medium and the dam break test examines the collapse of a water column through a porous dam made up of crushed rocks these two tests are chosen due to the following reasons i they can be simulated in 2d ii there are analytical solutions and or experimental data available for them so that it is possible to examine the accuracy of the models iii porous media in one test u tube is under closed channel flow condition and it is always fully saturated during the simulation while in the other test dam break flow in the media has a varying free surface boundary it is initially dry and then water flows into it therefore the fluid mass inside the porous media is constant in the former and variable in the latter this issue is important when the conservation properties of the models are examined iv the effect of turbulence is negligible in both cases thus the lack of a turbulence model will not cause significant errors in the u tube test the water level in the left and right vertical sections is initially different so that flow occurs through porous media until the water surface reaches the same level in both sections the application set up is the same as in peng et al 2017 and kazemi et al 2020a water flows under gravity due to the difference in water level seeping through the porous medium which is placed in the centre of the horizontal section if the non linear friction in the porous medium is neglected the analytical solutions for the water level difference δh and the darcy velocity in the porous medium u equivalent to the phase average velocity u in the horizontal direction are expressed as follows 19 a δ h δ h 0 e x p 2 k h t l 19 b u δ h 0 k h e x p 2 k h t l l where t is the time δh 0 is the initial water level difference 1 35 m l is the seepage path length 1 0 m and kh denotes the hydraulic conductivity 0 005 for the dam break test the experimental data of liu et al 1999 is used for validation of the models in liu s experiment the water tank was 0 892 m long 0 44 m wide and 0 58 m high the porous dam was 0 29 m long 0 44 m wide and 0 37 m high and located at the centre of the tank it was built by crushed rocks with a mean diameter of 0 0159 m and a mean porosity of 0 49 a gate was placed 0 02 m away from the front side of the dam and opened manually at the beginning of the experiment within 0 1 s the initial water depth behind the dam was 0 25 m and the tailwater depth was 0 025 m 4 2 computational specifications the initial spacing of a generic particle a is set to l 0 α 0 a f n in model i see kazemi et al 2020a and l 0 in models ii and iii where α 0 a f is the initial porosity of the particle l 0 the initial particle spacing in the clear water region with a porosity of 1 0 and n the number of dimensions 2 in the present study the initial spacing l 0 is set to 25 mm and 2 mm in the simulations of the u tube and dam break tests leading to a total number of about 14 000 and 23 000 particles respectively in all the simulations a fifth order wendland c2 kernel function wendland 1995 is employed and three layers of ghost particles are used to model the wall boundaries in the present simulations following kazemi et al 2020a h is set to 1 2l 0 therefore the size of the support of the kernel function 2h seems to reasonably capture the variations in the average flow field in the present simulations this is because the flow is not highly sheared and the flow discharge especially in the u tube test is very slow see the numerical results in the following sections sufficiency of the resolution of the computational domain can also be inferred from the fact that these sizes are equal to or smaller than the ones used in similar tests in kazemi et al 2020a where the interfacial boundary flow was adequately simulated the same values are used for h ϕ this variable determines the size of the layer over which porosity changes from 1 0 in the clear water region to the mean porosity value in the porous region it is not possible to check the satisfaction of the constraint 2h ϕ l d i since the size and or configuration of the solid grains in the interfacial layer is not known however due to the fact that the flow is slow and gradual and the effect of turbulence is negligible in both cases the adopted values should satisfactorily model the flow transition at the interfacial boundary the initial porosity α 0 a f is calculated according to eq 8 where γ c is set to the mean porosity of the media in the porous region and one in the clear water region kazemi et al 2020a the mean porosity of the porous media according to the experimental data is set to 0 4 and 0 49 for the u tube and dam break tests respectively fluid s dynamic viscosity μ and reference density ρ 0 f are set to 10 3 kg m 1 s 1 and 1000 kg m3 respectively for the u tube test in peng et al 2017 the drag stress term is formulated based on soil permeability k which is related to the hydraulic conductivity as kh ρgk μ and no value is reported for the soil grain diameter ds therefore ds is estimated by kozeny carman equation for a hydraulic conductivity value of 0 005 to be then used in eq 18 for the estimation of the drag stress term 4 3 particle distribution and water surface elevation the particle distributions and water surface elevations computed by the models are presented and compared with the analytical or existing experimental data as well as some other numerical studies fig 4 shows the time series of the computed water level difference δh and discharge velocity in the porous medium u in comparison with the analytical solutions in eq 19 for t 0 to 200 s the best match with the analytical profiles belongs to model i while the errors of the other two models are not significant either fig 5 presents comparisons between model i and three other sph studies kazemi et al 2020a khayyer et al 2018 peng et al 2017 with regard to δh and u table 3 quantifies this comparison in terms of mean absolute error mae and root mean square deviation rmsd the model of khayyer et al 2018 shows the best performance in the calculation of both δh and u this is due to the isph scheme adopted in their study which yields accurate estimations of the pressure field by solving poisson s equation all the other models compared here are developed based on wcsph which allows noise in the density for the sake of an explicit pressure calculation amongst peng et al 2017 kazemi et al 2020a and the three models developed in this study model i gives the most accurate results for δh and u fig 6 compares the particles position at t 50 s predicted by models i and ii the particle distribution is quite regular for both models particle spacing in the porous medium in model i is larger than the one in the clear water region while in model ii it is the same all over the domain which is nearly equal to the initial particle spacing l 0 this is because in the former the equation of mass eq 12 represents the conservation of fluid s volume while in the latter it describes the conservation of sph particle s volume eq 13 fig 6 also provides a comparison between model i and kazemi et al 2020a regarding the free surface boundary in the left vertical section of the u tube at t 50 s in the result of kazemi et al 2020a particles near the free surface show larger spacing than those inside the fluid domain this is because of the shepard density filter they used at every 30 computational time steps in their simulations it was used to smooth the sph calculated density in order to limit the pressure noise inside the fluid domain however this filter causes discrepancies e g larger particle spacing near the free surface boundaries especially when the variation or motion of the free surface boundary is gradual as seen in the present u tube test which is due to the small hydraulic conductivity of the soil in the present model no density filter is applied but the unphysical oscillations in the pressure field are suppressed by employing the δ sph scheme of marrone et al 2011 this has greatly improved the efficiency of the model in producing smooth pressure discussed in section 4 5 and uniform particle spacing it is clearly seen from fig 6 that the model yields a completely regular distribution of particles inside the fluid domain there are some discrepancies near the free surface boundary but this boundary is still well captured fig 7 compares particles position and distribution obtained from models i and ii at t 100 s inside and near the soil medium particle distribution is regular and uniform in the simulations of both models and the transition from clear water to porous zone and vice versa is smooth as discussed earlier the larger spacing in the porous region of model i is due to the type of definition and discretisation of the continuity equation in this model continuity is imposed for the intrinsic averaged density ρ f therefore particle spacing in the media is proportional to its porosity when porosity becomes smaller particle spacing and volume become larger in order to carry the same amount of fluid mass as before setting particle spacing to l 0 α 0 a f n in the initial time step is to ensure that the correct amount of fluid mass is located in the porous medium at the beginning of the simulation it seems in akbari and namin 2013 and akbari 2014 where a similar approach was employed for the discretisation of the continuity equation this issue has been neglected and particle spacing inside and outside porous media has initially been set equally it has in their dam break tests for example led to some discrepancies in the particle distribution as it must have taken some while for the particles with smaller spacing in the porous dam to be replaced with the particles with larger spacing in the upstream clear water region as fluid flowed into the medium figs 8 to 10 present the results of models i ii and iii for the particle position in the dam break test from t 0 to 2 2 s blue areas these figures also compare the water level elevations free surface profiles with the experiments of liu et al 1999 the results of model i show a good agreement with the experimental data except at t 0 2 and 0 4 s in the frontal side of the wave in the porous dam kazemi et al 2020a stated that this mismatch which is present in most of the sph studies where this test case has been simulated might be because the porous dam was not saturated in the beginning of the experiment up to t 0 4 0 6 s a condition under which the drag stress term estimated by the ergun s equations may not be precise however after t 0 4 s a superior match is achieved between numerical and experimental profiles in fig 8 models ii and iii do not show a good match with the experimental data as seen in figs 9 and 10 but large underestimations of water level elevations are observed the dimensions of the water column in the left and the tailing water in the right sides of the tank are the same as the ones in model i i e water surface profiles in all the three models at t 0 are set equally however after the collapse of the water column when the wave develops through the dam models ii and iii underestimate water surface elevation this indicates a reduction in the total volume of water to better illustrate the issue water surface profiles at t 1 6 s obtained from models i ii and iii are compared in fig 11 left looking at the downstream side of the dam x 0 6 m water level elevation in models ii and iii is at z 0 025 m meaning that free surface profile in this section has not changed since t 0 this shows that the water has not yet flowed out of the dam at t 1 6 s while the water level estimated by model i has already reached the experimental level at z 0 06 m in the downstream section fig 11 right compares model i with two other sph studies regarding the water surface elevation at t 1 6 s the result of peng et al 2017 shows very similar profiles in the downstream section of the dam to the present models ii and iii i e water level remained at z 0 025 m until t 1 6 s also in the left side of the tank x 0 4 m their result shows an underestimation of the water surface elevation these underestimations are most likely becuase their continuity equation was defined very similarly to the present models ii and iii although they formulated equation of mass based on the time rate of intrinsic averaged density d ρ f dt the material derivative of porosity on the right hand side of their equation implies that conservation of ρ is satisfied rather than ρ f see eq 5 in peng et al 2017 on the other hand akbari 2014 s profile in the downstream section of the tank although showing minor underestimation of the experimental data indicates that the water level has already gone up at t 1 6 s the reason is that their model formulated the continuity equation based on intrinsic averaged density and used the particle s volume definition of discretisation a see fig 2 similar to the present model i however there are still discrepancies in their calculated water surface profiles at both the upstream and the downstream sides of the tank while the result of our model i shows a better agreement with liu s experiment these could be related to the different numerical treatment processes adopted in these models fig 12 compares models i and ii with respect to particle position near the upstream wall of the dam at t 1 6 s both models provide regular distributions of particles as well as smooth transitions from clear water to porous region in the dam break test except for some minor discrepancies in the result of model ii near the free surface boundary inside the dam it is shown that there are no significant differences between models i ii and iii when they are used to simulate the u tube test but in the simulations of the dam break test there are large discrepancies in the results of models ii and iii to further investigate the issue volume conservation for each model is quantified in the next section 4 4 volume conservation for each test two particles are selected and their trajectories time series of their porosity volume and fluid volume carried by them are computed and compared for models i ii and iii to investigate the conservative properties of the models fig 13 presents the result for the u tube test from t 0 to 150 s s 1 is initially located in the clear water region upstream of the porous medium and then move into the medium during the simulation s 2 at t 0 is in the porous region and then move downstream of the medium the trajectories in fig 13 indicate that both s 1 and s 2 move faster in model i as they travel a longer distance this can also be seen in figs 13 a and d where time series of porosity are presented porosity at s 1 in model i has dropped to 0 4 faster and sooner than in models ii and iii at s 2 it shows a similar behaviour porosity has risen to 1 0 sooner and faster in model i the reason is that particles move with their intrinsic phase averaged velocity u f in model i see eq 12 f while their motion in models ii and iii takes place based on phase averaged velocity u see eqs 13 g and 14 g this is consistent with the formulation of the continuity equation and the definition of the particle s volume as shown in section 4 3 and fig 7 when continuity is formulated for ρ f and particle s volume is defined as in discretisation a i e model i particle spacing becomes larger when a particle goes into the porous medium therefore it should travel with a higher velocity through the medium compared with models ii and iii discretisation b so that the flow will occur at the same discharge and the rate of mass and momentum in the medium will be similarly captured figs 13 b c e and f provide a clear illustration of the conservation of the fluid volume associated with ρ f carried by particles s 1 and s 2 in model i and the conservation of particle s volume associated with ρ in models ii and iii fig 14 shows the trajectory porosity fluid volume and particle s volume of two particles s 1 and s 2 in the dam break test computed by models i ii and iii s 1 is initially located in the clear water and then moves into the porous dam and s 2 is initially located in the porous dam and then moves to the downstream section of the tank here in contrast to the u tube test fig 13 particles s 1 and s 2 travel almost the same distances in models i ii and iii for example particle s 1 in model i does not necessarily go into the porous dam sooner and faster than in models ii and iii as shown in section 4 3 for the u tube test models ii and iii estimate water surface elevation and discharge velocity in the soil with accuracies very close to model i see figs 4 and 5 but in the dam break test simulations these two models significantly underestimate the water surface elevations see figs 8 to 11 the question is thus what characteristic makes the dam break test different from the u tube test so that particle s volume conservation leads to accurate estimations of water surface elevation in the latter but inaccurate ones in the former to examine this conservation of the total volume of fluid is computed by the three models and presented in fig 15 the total fluid volume is calculated as the summation of the volume of fluid carried by all the particles in the domain during 200 s of simulation for the u tube test and 5 s for the dam break test it is clearly seen that the total fluid volume is preserved by all the three models for the u tube test though a less than 1 drop is seen in models ii and iii while in the dam break test only model i conserves it models ii and iii show a considerable decrease about 10 15 of the total volume of fluid which is slightly higher in model iii it means that these two models do not provide conservative forms of the governing equations for fluid flow in porous media in general however they still correctly simulate a special type of flow that is a closed porous media flow condition where mass flux flowing in and out of the media is balanced therefore it can be concluded that if models ii and iii which are formulated based on phase averaged apparent density work well for the u tube test it is because the porous medium is fully saturated and there is no varying free surface open boundary in the medium to cause an imbalance in the inflow and outflow fluxes of mass and momentum 4 5 pressure distribution figs 16 and 17 present pressure distributions calculated by models i ii and iii for the u tube test at t 40 and 120 s and the dam break test at t 1 and 1 6 s respectively the distributions obtained from models i and ii are smooth and continuous but the ones from model iii show large discontinuities near the interface boundaries between clear water and porous media the discontinuity is sharper in the dam break test because of the higher flow velocities on the other hand in the u tube test where flow discharge is low in the soil medium it affects a larger area near the interface layer and occurs very gradually in time it appears as a drop in the pressure in the upstream side and a rise in the downstream side of the medium this is due to the disregard of the extra terms which are added to the governing equations of model ii in the process of translating the local time derivatives to the material derivatives based on phased averaged velocity u see sections 3 1 and 3 2 for details fig 18 compares the pressure distribution at t 1 6 for different models near the upstream side of the dam it shows the pressure drop at the interface in model iii resulted in a drop in the water surface profile too hence the deficiency of model iii compared to model ii has led to further underestimations of total fluid volume as already shown in figs 15 right and figs 11 left fig 18 also shows that model ii has produced the most continuous and smooth pressure field amongst all the three models the minor pressure noise in the result of model i particularly in the porous zone is probably due to the change of particle spacing which occurs as a result of the change of porosity when particles travel over the interface layer such noise is not seen in the result of model i in the u tube test where the flow velocity is small and the change in the particle spacing over the interface layer occurs very gradually over a relatively long time this can be seen in fig 19 middle the figure compares pressure snapshots at t 40 s computed by the present models i and ii and the model developed in the author s previous study kazemi et al 2020a for the u tube test the dashed dotted lines depict the pressure contour lines at 2 104 pa they show that models i and ii are capable of reproducing the linear distribution of pressure in the porous region and this suggests that the application of the δ sph formulation has improved the accuracy of the present models compared to kazemi et al 2020a 5 conclusions and perspectives a thorough investigation is performed on the mathematical basis of the sph method aiming for providing a more systematic modelling approach for fluid flows in porous media three models are developed and tested for two different types of problems with regard to the estimation of water surface elevation pressure field and the conservation of volume the major findings of the study concerning both the mathematical development of the governing equations and the solution of them for two flow types in porous media are summarised as follows two types of particle discretisation can be have been employed in the simulation of fluid flow in porous media using sph they are fulfilled by the solution of continuity equation based on either intrinsic averaged density ρ f representing fluid s density or phase averaged density ρ namely apparent density consistency is required between the discretisation of the continuity equation the definition of the particle s volume and the velocity by which particles are moved in discretising the continuity equation based on ρ f particle s volume is defined as d v a m 0 f α a f ρ a f and it is moved according to its intrinsic averaged velocity u f while in the discretisation of the continuity equation based on ρ particle s volume is defined as d v a α a f m 0 f ρ a and particle s motion is set based on its phase averaged velocity u in the former when the lagrangian form of macroscopic equations is developed the transformation of local time derivatives to material derivatives is performed using eq 11 a while in the latter eq 11 b should be used using the definition in eq 11 b leads to extra terms in the final equations if these extra terms are disregarded as in model iii discontinuity may arise in the model results particularly in the pressure field near the interface boundary between porous media and clear water both types of models conserve fluid volume for the problems in which porous media is under a closed channel flow condition where the saturation of the media is not varying in time and the inflow and outflow mass fluxes are balanced but model type ii continuity of ρ violates the conservation of fluid volume for the cases where there is a varying free surface boundary in the porous media and the fluid mass inside it saturation is not constant the most continuous and smooth pressure field is obtained from model type ii i e continuity of ρ if the proposed extra terms in the mass and momentum equations are included and the model is applied to solve closed porous media flow conditions therefore model i is recommended to be used for the problems where there is a free surface boundary in the porous media and its saturation is varying while model ii is recommended for fully saturated media which is under closed flow conditions the results also suggest that employing the δ sph formulation with a diffusive term in the mass equation and an artificial viscous term in the momentum equation leads to more regular particle distributions and smoother pressure fields compared to the authors previous study that did not incorporate these schemes kazemi et al 2020a the developed models are tested under simplified conditions i e mild flow velocities insignificance of turbulence small scale 2d domains and simple boundary conditions this is to ensure that the modelling approach is appropriately tested for important issues such as volume conservation for extending the application of the models to more complex engineering problems e g large scale wave current interactions with porous structures like breakwaters and dikes the influencing factors including flow turbulence complexity of flows in the interfacial layer complexity of rigid boundaries free surface deformations computational cost etc would be taken into account therefore to further enhance the modelling process and applicability of the developed models it is recommended to incorporate the effect of flow turbulence using an appropriate model improve particle regularity near the free surface boundary robust particle shifting technologies such as the ones introduced in khayyer et al 2017 or sun et al 2019 can be extended for this purpose it can also improve the transition of particles between regions with different porosities particularly for model i type of simulation where particle spacing changes based on porosity as well as the pressure field inside porous media however the issue of change of particle size at the interface seems challenging and needs careful attention extend the present models into 3d for more complex real world problems employ the present modelling approach for formulating conservation of fluid volume in deformable or movable porous media such applications may include sph modelling of sediment transport based on mixture theory shi et al 2019 geomechanics applications of sph in simulating failure of porous structures bui and nguyen 2021 or coupling sph with discrete particle methods for industrial particle fluid flow applications he et al 2018 credit authorship contribution statement ehsan kazemi conceptualization formal analysis investigation data curation writing original draft writing review editing visualization project administration min luo conceptualization formal analysis investigation writing review editing project administration funding acquisition declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgement the second author acknowledges the start up funding provided by zhejiang university and the fundamental research funds for the central universities no 2021qna4036 appendix the spatial averaging theorem whitaker 1999 is applied to the eulerian form of the conservation equations of mass and momentum as shown in eqs a 1 and eqs a 2 where denotes the phase averages of the terms then the definitions in section 2 specifically eqs 3 to 5 are employed to derive the spatially averaged equations of mass and momentum for the purpose of macroscopic modelling of fluid flow through fixed porous media in the following this process is carried out for obtaining macroscopic equations in terms of intrinsic phase averaged density ρ f in section a i and phase averaged density ρ in appendix a ii the equations are presented in the lagrangian form and used for the development of the three sph models in section 3 a 1 ρ t ρ u 0 a 2 ρ u t ρ u u p i σ ρ g a i macroscopic equations in terms of intrinsic averaged density ρ f according to eqs 3 and 4 phase averages of the two terms in eq a 1 are written as a 3 ρ t α f ρ f t a 4 ρ u ρ u a f s w ρ u n f s d a α f ρ f u f therefore eq a 1 can be written as follows the surface integral in eq a 4 is omitted owing to the no slip condition at the fluid solid interfaces i e u n fs 0 a 5 α f ρ f t u f ρ f ρ f α f u f 0 where according to eq 11 a ρ f t u f ρ f represents material derivative of the intrinsic phase averaged density in this definition sph particles are supposed to move with their intrinsic phase averaged velocity u f finally the spatially averaged macroscopic equation of mass in terms of intrinsic phase averaged density ρ f and in the lagrangian form is written as below a 6 d ρ f d t ρ f α f α f u f similarly applying the definitions in section 2 the two terms on the left hand side of the equation of momentum eq a 2 are expressed as follows a 7 ρ u t ρ u t t α f ρ f u f a 8 ρ u u ρ u u a f s w ρ u u n f s d a α f ρ f u f u f to approximate the terms on the right hand side of eq a 2 point values of pressure and shear stress p and σ are firstly decomposed into their averages and spatial deviations and then the terms are averaged the final form is presented in eq a 9 where p and σ in the surface integral term denote the spatial deviations of pressure and shear stress in respect to their averages respectively for details of the derivation see whitaker 1996 a 9 p i σ ρ g α f p f α f σ f a f s w p i σ n f s d a α f ρ f g the surface integral term in eq a 9 represents the effect of the solid skeleton on the average flow field it is equivalent to the surface integral term over the local averaging volume dv in the study of whitaker 1996 thus can be approximated as follows a 10 f d a f s w p i σ n f s d a 1 d v a f s p i σ n f s d a α f 1 d v f a f s p i σ n f s d a α f μ k 1 1 β f u where k and β f are the permeability and forchheimer tensors respectively using eqs a 7 to a 10 the spatial average of the momentum equation can be written as below a 11 α f ρ f u f t u f u f u f t α f ρ f α f ρ f u f α f p f α f σ f f d α f ρ f g where the term in the first bracket represents material derivative of u f with the definition that particles will move based on u f and the term in the second bracket is equal to zero according to the conservation of mass eq a 1 thus in the final lagrangian form the spatially averaged macroscopic equation of momentum is written as follows a 12 d u f d t p f ρ f α f σ f α f ρ f f d α f ρ f g a ii macroscopic equations in terms of phase averaged density ρ using the definitions in eqs 3 to 5 the time derivative and divergence terms in eq a 1 are expressed in terms of phase averaged density as follows a 13 ρ t ρ t a 14 ρ u ρ u a f s w ρ u n f s d a ρ u f therefore eq a 1 can be written as a 15 ρ t u f ρ ρ u f 0 the term in the parenthesis denotes the material derivative of ρ if a fluid particle moves based on u f in this case the macroscopic equation of mass will be written in terms of ρ as below a 16 d ρ d t ρ u f however when macroscopic equation of mass is formulated to describe time evolution of ρ its discretised form will represent conservation of volume of the sph particles rather than fluid s volume therefore particles should move based on u in other words eq 11 b should be used to formulate material derivatives thus eq a 1 is expressed as follows a 17 d ρ d t ρ u f 1 α f u f ρ momentum equation is developed similar to section a i as presented in eq a 12 but using eq 11 b to transform eulerian form to the lagrangian form to apply motion of particles based on u note that this equation is written in terms of u f which is convertible to u using eq 1 c a 18 d u f d t α f p f ρ α f σ f ρ f d ρ g 1 α f u f u f 
135,smoothed particle hydrodynamics sph has successfully been employed in the last decade for macroscopic simulation of fluid flow in porous media however there are still certain inconsistencies in the existing models with regard to both the definition of the governing equations and the adopted numerical treatments in this study thus in order for a comparative investigation of the existing practices the method of spatial averaging is employed to derive two types of macroscopic conservation equations of mass and momentum through phase averaging and intrinsic phase averaging of fluid density consistent discretisation methods are adopted for the determination of particle s volume in the weakly compressible sph form and velocity by which particles move and they are used to construct three numerical models the models are then employed to solve two different types of problems i a fully saturated soil medium under the closed channel flow condition and ii a porous medium under a free surface flow condition with varying saturation the results of the models are compared with analytical and experimental data and particle distribution water surface elevation conservation of fluid volume and pressure distribution are investigated it is shown that only the latter type of modelling i e intrinsic phase averaging of fluid density leads to the conservation of fluid volume for both types of the problems while the former type of formulation i e based on phased averaged density also known as apparent density is suitable for closed porous media flow conditions only comparisons with other numerical models and the author s previous study indicate that the adopted numerical treatments especially the δ sph formulation have led to an improvement in the smoothness of particles distribution and pressure field a few recommendations are finally made about potential further improvements of the developed models and extensions of their applicability keywords particle method porous media free surface flow macroscopic modelling spatial averaging volume conservation 1 introduction studying the interaction of fluid flow with porous media is of great importance for researchers and engineers in several areas of engineering including chemical petroleum mechanical and water engineering the latter of which often concerns problems in rivers and coasts in rivers the bed is often composed of solid grains such as sand and gravel thus water penetrates into the bed although flow inside the porous bed has a substantially lower velocity than the overlying flow it plays a key role in the transfer of momentum at the bed boundary which in turn affects the structure of turbulence and the overlying flow this mechanism is especially important when engineers study the transport of sediment or pollutants in coastal areas the majority of natural or man made protective structures such as breakwaters soil embankments and dikes are porous these structures interact with waves and currents and experience a variety of flow incidents such as wave breaking on the slope of structure run up overtopping etc in order to design stable coastal protective structures which are efficient in mitigating the effect of flow incidents it is essential to understand the mechanisms formed while water flows through the porous media due to the difficulties with laboratory and field experimentations engineers usually use numerical modelling as a complementary tool for studying fluid flow in porous media one of the approaches which has recently been more attractive especially in the field of coastal engineering is the application of particle methods such as smoothed particle hydrodynamics sph this is particularly because of the strengths of the sph method in treating free surface and large deforming boundaries for a few key examples and the current situation and challenges of the sph method see kazemi et al 2017 khayyer et al 2017 gotoh and khayyer 2018 verbrugghe et al 2018 liu and zhang 2019 lind et al 2020 gotoh et al 2021 sriram and ma 2021 vacondio et al 2021 and for a comprehensive review see luo et al 2021 although there has been a continuous and increasing use of sph in the last three decades for wave and current simulations the application of this method for modelling fluid flow in porous media has still been limited since the first study in 2010 by shao 2010 after that akbari 2014 ren et al 2016 pahar and dhar 2016 losada et al 2016 peng et al 2017 khayyer et al 2018 wen et al 2018 kazemi et al 2020a akbari and torabbeigi 2021 tsurudome et al 2021 and shimizu et al 2022 are some of the key studies in this area all these studies simulated flow through porous media macroscopically the popularity of macroscopic modelling has been mainly due to the fact that the feasibility of microscopic modelling which is preferable in an ideal world is questionable for practical applications this is because it will need a fine resolution of the solid fluid interface boundaries and the small flow scales using computational discretisation close to direct numerical simulation dns in spite of the great achievements there is still an immaturity in the modelling treatments when sph is used for macroscopic simulation of fluid flow in porous media for example there is still a question about the definition of governing equations whether based on phase average or intrinsic phase average of fluid quantities phase average refers to the spatial average of a phase quantity e g fluid velocity over a volume that contains both phases fluid and solid while intrinsic phase average denotes the average of the quantity over the volume occupied by that specific phase only for fluid velocity for example phase average represents discharge darcy velocity and intrinsic phase average is equivalent to discharge velocity divided by the porosity of the medium for more details of the definitions see section 2 another question is regarding the discretisation of the computational domain do computational elements i e particles need to be defined as the space occupied by fluid only or should it represent both a mixture of fluid and solid phases following this two other questions arise as follows should particles move with the velocity of the fluid phase or the velocity of the fluid solid mixture and does saturation of porous media e g whether it is dry before water flows into it matter when one determines the form of the governing equations and chooses the discretisation method these questions can relatively straightforwardly be addressed when eulerian grid based methods are employed this is because in those methods computational elements i e grids are fixed in space but in the case of lagrangian particle methods such as sph computational elements move in space and carry fluid properties therefore the above points should be addressed carefully for rigorous development of sph formulation for fluid flow in porous media as summarised in table 1 the sph studies have formulated the equation of mass continuity based on either intrinsic phase averaged density akbari 2014 akbari and namin 2013 akbari and torabbeigi 2021 kazemi et al 2020a kazemi et al 2020b wen et al 2020 shimizu et al 2022 or phase averaged density also known as apparent density gui et al 2015 khayyer et al 2018 peng et al 2017 ren et al 2016 shao 2010 wen et al 2018 in the former thus solution describes the temporal rate of the fluid s density volume while the latter models the temporal change of the sph particle s density volume temporal change of density volume is restricted to be less than about 1 in the weakly compressible version of sph wcsph while it is enforced to be zero in the incompressible sph isph method so that the divergence free condition is satisfied in the latter the effect of density averaging choice of phase average or intrinsic phase average is reflected in the formulation of pressure poisson s equation for example by incorporating temporal change of porosity for instance see khayyer et al 2018 in sph the volume of a fluid particle is often defined as the mass fraction of fluid divided by the particle s apparent density in the case of formulating the equation of mass based on phase averaged density when a particle moves to a region with different porosity its volume remains unchanged but the fractions of fluid and solid inside the volume may change but for the case of defining the equation of mass based on intrinsic averaged density a particle always carries the same amount of fluid mass resulting in a change in its volume when it moves from one to another region with different porosities this issue is taken into account only in the studies of akbari and namin 2013 akbari 2014 pahar and dhar 2016 kazemi et al 2020a kazemi et al 2020b and shimizu et al 2022 equation of momentum also can describe the rate of temporal change of either phase averaged velocity or intrinsic phase averaged velocity the former is equivalent to darcy s velocity also known as discharge velocity superficial velocity or apparent velocity representing flow per unit volume of the porous media while the latter which represents fluid velocity describes fluid flow through the volume occupied by fluid only according to table 1 most of the studies used phase averaged discharge velocity to formulate the navier stokes equations and only a few of them kazemi et al 2020a khayyer et al 2018 peng et al 2017 wen et al 2020 used intrinsic averaged velocity but this is not an important issue for the present application only in the case of movable porous media according to wang et al 2015 the use of phase averaged velocity can break the galilean invariance when porous media is fixed on the other hand using either phase averaged or intrinsic averaged velocities will lead to the same system of momentum conservation the output quantity is different but it is convertible intrinsic averaged velocity can be converted to phase averaged velocity by multiplying it by the porosity of media however the velocity by which particles are moved is important if the equation of mass is defined to impose the continuity of fluid s density i e intrinsic averaged density particles should move with fluid s velocity i e intrinsic averaged velocity on the other hand if the equation of mass is defined based on sph particle s density apparent density then particles should move according to their phase averaged velocity this indicates a requirement of consistency between the conservation of mass volume and the motion of sph particles an issue that is not present in the eulerian grid based flow simulations where computational nodes are fixed most of the sph studies have adopted this consistency in their models except ren et al 2016 and perhaps some other studies as not all of them have presented the detail of the computation of particle motion see table 1 with regard to the range of problems that a sph model can solve for fluid flow in porous media two important factors are the type of flow and the saturation condition of the media amongst the sph studies gui et al 2015 and wen et al 2020 simulated fully saturation conditions only i e the cases where porous media was always saturated and taking flow incompressibility into account mass flux flowing in and out of the media was equal the other studies simulated both types of flows with and without fully saturation conditions see table 1 the present study aims at investigating the issues discussed above and more specifically to show that when the continuity equation is formulated based on intrinsic phase averaged density volume of fluid is conserved while by defining the equation based on phase averaged apparent density sph particle s volume is preserved but fluid s volume conservation is not necessarily satisfied then the following points will be addressed for each case i the definition of particle s volume in the discretised form ii the velocity by which particle s motion is simulated iii the implications this will have on the derivation of material derivatives and iv the types of problems which can be solved in each case the novelty of this study lies in providing a rigorous description of the sph underlying theoretical framework for simulating fluid flow interaction with porous media so that it can pave the way towards a more mathematical consistent and less empirical guidance for practical applications of sph in water engineering for this purpose firstly a mathematical scheme based on the method of volume averaging and sph discretisation is introduced in section 2 then three models are developed in section 3 one based on intrinsic averaged density and the other two based on phase averaged apparent density these models are then compared in section 4 by applying them to simulate two free surface flow problems in one test u tube the porous medium is under closed flow and fixed saturation conditions and in the other test dam break it is under free surface flow and unequal inflow outflow mass flux conditions these test cases are chosen in order to investigate the applicability of the developed models for the two different types of problems the models are compared in terms of free surface elevation velocity volume conservation and pressure distribution finally in section 5 a summary of the findings applicability of the models and their potential future improvements are highlighted 2 mathematical scheme and definitions microscopic modelling of fluid flow through porous media is not straightforward it needs capturing solid fluid interfaces as rigid wall boundaries hence requires a very fine discretisation of the computational domain in order to resolve all the necessary flow motions therefore the concept of macroscopic modelling is often used instead in many engineering applications in this approach the porous region is described as a continuum without a need for modelling fluid solid interfaces thus fluid motion is averaged over a local averaging volume containing both fluid and solid a well known approach for this is the method of volume averaging formulated by whitaker 1999 where each point in the domain with position vector r is associated with a small volume namely a representative elementary volume rev the size of the volume should satisfy the condition l ψ rrev l ψ where r rev is the characteristic size of the volume radius of a circle or sphere in 2d or 3d if a sph kernel function is used to define the volume and l ψ and l ψ are the characteristic micro and macro sizes of the porous media respectively fig 1 shows a schematic rev in 2d the volumes occupied by fluid dvf and solid dvs constitute the total volume of the rev as dv dvf dvs 2 1 spatial averaging according to whitaker 1999 for a fluid quantity ψ two averages are defined at the averaging volume namely phase average ψ and intrinsic phase average ψ f these averages are formulated in eqs 1 a and 1 b respectively and have a relationship based on fluid phase fraction α f also called porosity as defined in eq 1 c 1 a ψ 1 d v v f ψ d v 1 b ψ f 1 d v f v f ψ d v 1 c ψ α f ψ f phase average ψ represents the spatial average of fluid quantity ψ over the total volume of rev i e the volume containing both fluid and solid while intrinsic phase average ψ f represents the average of fluid quantity ψ over only the volume occupied by fluid dvf this definition implies that α f dvf dv in the sph form phase and intrinsic phase averages are defined as below 2 a ψ v w r r h ψ d r 2 b ψ f v f w r r h ψ d r f where r and r are the position vector of the centroid and other points than the centroid of the averaging volume w is the kernel function and h is the smoothing length dr and d r f denote all the points and the points occupied only by fluid in the averaging volume respectively in order to derive the spatially averaged macroscopic governing equations which are the conservation equations of mass and momentum it is necessary to define the relationships between phase average of derivatives of a fluid quantity and phase average of the quantity itself the spatial averaging theorem whitaker 1999 expressed in the sph form as below provides such definitions 3 a ψ ψ a f s w ψ n f s d a 3 b ψ ψ a f s w ψ n f s d a where ψ and ψ are phase averages of gradient and divergence of scalar ψ and vector ψ respectively afs denotes the fluid solid interfaces within the averaging volume and n fs is the unit normal vector directed from fluid to solid the phase average of local time derivative of ψ is defined as the following kazemi et al 2020a 4 ψ t ψ t besides it is possible to show that the phase and intrinsic phase averages of product of two fluid quantities ψ and φ can be defined as follows jarauta et al 2020 5 a ϕ ψ 1 α f ϕ ψ 5 b ϕ ψ f ϕ f ψ f all these definitions in eqs 1 to 5 will be used in section 3 for the derivation of the macroscopic equations before that the discretised forms of the relationships are introduced in the following 2 2 discretised form of spatial averaging discretised forms of phase and intrinsic phase averages of a fluid quantity ψ eq 2 are expressed as 6 a ψ a b w r a r b h ψ b d v b 6 b ψ a f b w r a r b h ψ b f d v b and their spatial derivatives are written as 7 a ψ a x j b w r a r b h x j ψ b d v b 7 b ψ a f x j b w r a r b h x j ψ b f d v b where a and b denote central particle at which averaging is performed and its neighbouring particles within the volume respectively and dv is the particle s volume according to kazemi et al 2020a porosity at particle a can be approximated at a fixed background mesh as 8 α a f b w r a r c h φ γ c d v c where c denote nodes of the background mesh and γ c is the value of a distribution function at mesh point c the distribution function is set to one or zero if the mesh point is located in the fluid or solid phases respectively the average in eq 8 is performed using smoothing length h ϕ this parameter should be set to a value which adequately represents the physical condition of the porous media especially the length scales at the interface of the media with an overlaying clear water flow kazemi et al 2020a dvc is the volume of the mesh element associated with point c it is equal to lc 2 and lc 3 in two and three dimensional simulations respectively if a regular mesh with spacing lc is used lc should be sufficiently small to ensure the average in eq 8 is smooth it is thus chosen to be less than h ϕ 2 3 particle s volume volume of a generic particle a is defined as the mass of fluid carried by the particle m 0 f divided by the apparent density of the particle apparent density is the phase averaged density of particle ρ a which is equivalent to the intrinsic phase averaged density ρ a f multiplied by fluid s phase fraction or porosity at the particle s position α a f for fluid s mass a constant quantity m 0 f is considered it is the mass of fluid carried by the particle when it is in the clear water region where the entire volume of the particle is occupied by fluid only by this definition particle s volume is equal to m 0 f ρ a f in the clear water region but a more general form is required to represent particles volume in all the regions in the domain including the porous media in the case of imposing continuity equation of mass based on the time derivative of intrinsic phase averaged density i e d ρ f dt in fact the weakly compressibility wcsph or the incompressibility isph of the fluid s volume is formulated therefore particle s volume is defined in a way that fluid s volume inside the particle remains unchanged for isph or slightly changing for wcsph due to the small changes in the density i e d v a m 0 f α a f ρ a f this definition is presented as discretisation a in fig 2 in the case of defining equation of mass based on temporal derivative of phased averaged density i e d ρ dt the weakly compressibility wcsph or the incompressibility isph of flow is imposed through restricting variations of sph particle s volume rather than its fluid volume this requires the mass of fluid carried by the particle to be changeable when the particle moves between regions with different porosities so that the particle s volume remains unchanged therefore in this case particle s volume is defined as d v a α a f m 0 f ρ a which is introduced as discretisation b in fig 2 3 governing equations and numerical models in this section firstly derivation of macroscopic equations of mass and momentum in the sph form using the definitions in section 2 is presented then three models are introduced for discretisation of the equations followed by the numerical schemes employed for approximation of the closure models numerical diffusive terms and boundary conditions 3 1 derivation of macroscopic equations microscopic conservation equations of mass and momentum for the fluid phase are written in the following eulerian form 9 ρ t ρ u 0 10 ρ u t ρ u u p i σ ρ g where ρ is fluid density u is point value of fluid velocity p is fluid pore pressure σ is fluid newtonian shear stress tensor g is the gravitational acceleration and i is the identity tensor to obtain the macroscopic governing equations the above two equations are spatially averaged using the definitions presented in eqs 3 to 5 this is performed for two types of continuity i conservation of phase averaged density ρ and ii conservation of intrinsic phase averaged density ρ f for details of the averaging process which leads to the lagrangian form of the equations for these two types see appendix then two models namely models i and ii are developed by discretising the macroscopic equations for each type based on the sph formalism model i presents the discretised form of the macroscopic governing equations when the equation of mass is defined based on ρ f and model ii is developed for presenting the equations based on the phase averaged density ρ in the derivation of the macroscopic equations in model i the particle s motion is formulated based on the intrinsic phase averaged velocity u f for this purpose in the transformation of the eulerian form of the equations to the lagrangian form i e converting local time derivatives of density and velocity into their material derivatives eq 11 a is applied where a denotes density or velocity for model ii this is performed using eq 11 b i e particles are moved with their phase averaged velocity u this is because in the case of continuity of the phase average density ρ discretisation b a particle s volume represents not only fluid but also a part of it is occupied by solid an issue which is often neglected in order to show how the disregard of this issue may affect the results of an sph simulation a third model namely model iii is developed the governing equations of model iii are similar to model ii with the difference that the extra terms in the latter which are added to the equations due to the use of definition 11 b are disregarded in other words it is supposed in model iii that the transformation of the local time derivatives to material derivatives is performed using intrinsic phase average velocity u f instead of phase averaged velocity u 11 a a t u f a 11 b a t u a 3 2 discretised forms of equations and numerical models this section presents the details of the three models in eqs 12 13 and 14 parts a and b of the equations show the lagrangian forms of the macroscopic governing equations developed for models i ii and iii respectively then in parts c and d the discretised forms of the equations are presented and the rest of the equations show the definitions of the volume of particles their motion and the relationship between density and pressure in this study a wcsph scheme is adopted for pressure calculation where compressibility of flow is restricted to be less than 1 by setting the speed of sound c 0 to 10 g h 0 with g 9 81 and h 0 initial water depth in the momentum equations f v and f d are the viscous and drag terms f v represents α f σ f see appendix and is approximated as an artificial viscous term as proposed by marrone et al 2011 f d is approximated by the ergun s equation in the discretised forms a and b denote the central particle in the averaging volume and its neighbouring particles within the volume note that the particle s fluid mass m 0 f is fixed and set initially to ρ 0 f l 0 2 in 2d where ρ 0 f is the reference density of the fluid and l 0 is the initial particle spacing in the clear water region where the porosity is unity da in the discretised equations of mass presents an additional diffusive term to suppress the unphysical pressure oscillations as proposed in the δ sph formulation of marrone et al 2011 details of the drag closure term and the δ sph diffusive terms are presented in section 3 3 for the sake of simplicity no additional closure models are used for flow turbulence shear stresses in the test cases simulated in this study section 4 are not significant and hence this assumption will not produce appreciable errors 3 2 1 model i macroscopic equations of mass and momentum eqs 12 a and 12 b are derived in terms of intrinsic phase averages of fluid quantities ρ f and u f see appendix a i the equations are then discretised as presented in eqs 12 c 12 d for a generic particle a the volume of neighbouring particles of particle a is set to m 0 f α b f ρ b f as described in discretisation a in section 2 3 see fig 2 particles move with their intrinsic averaged velocity u f as shown in eq 12 f and the intrinsic average of pressure p f representing fluid s pressure is linked to the intrinsic averaged density ρ f using eq 12 g 12 a d ρ f d t ρ f α f α f u f 12 b d u f d t p f ρ f f v α f ρ f f d α f ρ f g 12 c d ρ a f d t ρ a f α a f b α b f u b f α a f u a f a w a b d v b d a 12 d d u a f dt 1 ρ a f b p a f p b f a w ab d v b f v a α a f ρ a f f d a α a f ρ a f g 12 e d v a m 0 f α a f ρ a f 12 f d r a d t u a f 12 g p a f c 0 2 ρ a f ρ 0 f 3 2 2 model ii the macroscopic equation of mass eq 13 a is derived in terms of phase averaged density ρ see appendix a ii the momentum equation represents material derivative of the intrinsic velocity u a f as in model i once velocity is calculated it can simply be transformed to u using eq 13 f on the right hand side of the equations extra terms α f 1 u f ρ in the equation of mass and α f 1 u f u f in the equation of momentum emerged due to the use of the phase averaged velocity u in the transformation of the local time derivatives to the material derivatives see eq 11 and appendix a ii the discretised forms of the equations are presented in eqs 13 c and 13 d for a generic particle a the volume of neighbouring particles b is set to α b f m 0 f ρ b as described in discretisation b in section 2 3 see fig 2 the velocity divergence in the conservation equation of mass first term on the right hand side of eq 13 a is written in terms of intrinsic averaged velocity u f which is usually discretised as ρ a b u b f u a f a w a b d v b while particles move based on their phase averaged velocity u therefore numerical noises may occur near the interface between clear water and porous media where variation of the porosity is rapid to guarantee a more stable solution near the interface boundary the divergence term is discretised as shown in the first term on the right hand side of eq 13 c particles move with their phase average velocity u as described in eq 13 g and the intrinsic average of pressure p f is linked to the phase averaged density ρ using eq 13 h 13 a d ρ d t ρ u f 1 α f u f ρ 13 b d u f d t α f p f ρ f v ρ f d ρ g 1 α f u f u f 13 c d ρ a d t 1 2 ρ a b u b f u a f a w a b d v b 1 α a f b u b u a a w a b d v b 1 α a f u a f ρ a α a f d a 13 d d u a f d t α a f ρ a b p b f p a f a w a b d v b f v a ρ a f d a ρ a g 1 α a f u a f u f a 13 e d v a α a f m 0 f ρ a 13 f u a α a f u a f 13 g d r a d t u a 13 h p a f c 0 2 ρ a α a f ρ 0 f 3 2 3 model iii the macroscopic equations for model iii are the same as model ii excluding the extra terms α f 1 u f ρ and α f 1 u f u f from the equations of mass and momentum respectively this model is to show that in the case of writing equations in terms of phase averaged density ρ if these two terms are neglected i e if the transformation of local time derivatives of density and velocity to their material derivatives is performed based on u f instead of u how the results of an sph simulation will be affected note that in this model particles still move with u as in model ii but only the extra terms are disregarded this is the practice adopted in the sph studies such as shao 2010 and gui et al 2015 and possibly in some other studies in which details of the particle s motion are not presented 14 a d ρ d t ρ u f 14 b d u f d t α f p f ρ f v ρ f d ρ g 14 c d ρ a d t 1 2 ρ a b u b f u a f a w a b d v b 1 α a f b u b u a a w a b d v b α a f d a 14 d d u a f d t α a f ρ a b p b f p a f a w a b d v b f v a ρ a f d a ρ a g 14 e d v a α a f m 0 f ρ a 14 f u a α a f u a f 14 g d r a d t u a 14 h p a f c 0 2 ρ a α a f ρ 0 f 3 3 closure models and extra terms the density diffusive term for a generic particle a i e da is approximated according to the δ sph formulation proposed by marrone et al 2011 as follows 15 a d a χ h c 0 b ω a b a w a b d v b 15 b ω a b 2 ρ b f ρ a f r b r a r b r a 2 ρ b l ρ a l 15 c ρ a l b ρ b f ρ a f l a a w a b d v b 15 d l a b r b r a a w a b d v b 1 where ρ a l is the renormalized density gradient l a is the renormalization matrix and χ is the diffusive parameter set to 0 1 for all the simulations in this study the artificial viscous term for a generic particle a i e f va is approximated according to marrone et al 2011 as follows 16 a f v a ϵ v h c 0 ρ 0 f b π a b a w a b d v b 16 b π a b u b f u a f r b r a r b r a 2 where ε v is a constant which controls the intensity of the velocity diffusion and is set to 0 1 in all the simulations in this study to estimate the drag effects at a generic particle a i e f da the permeability and forchheimer tensors in eqs a 10 are defined as whitaker 1996 17 a k a d s 2 α a f 3 c 1 1 α a f 2 i 17 b β f a f u a f i f c 2 α a f c 1 1 α a f ρ 0 f d s μ where ds is the mean size of solid grains in the porous media and c 1 and c 2 are model constants substituting eqs 17 a and 17 b in eqs a 10 yields 18 f d a c 1 1 α a f 2 α a f μ d s 2 u a f c 2 1 α a f ρ 0 f d s u a f u a f which is equivalent to ergun s equation for calculation of the drag stresses c 1 and c 2 are set to 150 and 1 75 respectively according to ergun s model the sets of the governing equations for all the three models are defined in unified frameworks more specifically they describe the fluid motion over the entire computational domain including both the clear water and porous regions while the difference between the regions is characterised by the change in the porosity the advantage of this treatment is that no discontinuity is introduced at the interface between the two regions avoiding ad hoc numerical treatments to match the conditions at the interfacial boundary 3 4 boundary conditions and time marching scheme in the wcsph scheme the free surface boundary is tracked without any special treatment thus no boundary condition is defined here for the free surface for rigid wall boundaries fixed ghost particles of marrone et al 2011 are applied in this method a few layers of fixed ghost particles are set to represent wall boundaries the number of layers is determined according to the requirement of a complete support domain of the kernel function of fluid particles and an interpolation point is associated to each ghost particle by mirroring its position into the fluid domain then at every time step the fluid quantities are averaged at the interpolation points using a moving least square kernel in the present simulations since the wall boundaries are fixed the velocities of ghost particles are set to zero and to apply the neumann condition for pressure the formulation proposed in marrone et al 2011 is employed for time marching a predictor corrector scheme is adopted and the time step size dt is chosen according to the cfl condition as dt αcfl h c 0 with αcfl 0 5 table 2 presents the solution procedure the numerical schemes are implemented in an in house fortran 90 program developed by the authors 3 5 constraints of particle based discretisation there are certain constraints with the sph discretisation of the computational domain kazemi et al 2020a showed that the support radius of the kernel function used for the calculation of porosity twice of h ϕ in eq 8 should be constrained by the characteristic length scale of the solid matrix at the interfacial boundary between porous and clear water regions i e 2h ϕ l d i no constraint is introduced for h ϕ in the porous region due to the fact that in the macroscopic simulations the porous media is assumed to be homogeneous and continuous with a constant porosity there is also no constraint for h ϕ in the clear water region since porosity is constant 1 0 in this region besides the size of the support of the kernel function w used for the discretisation of the governing equations h in eqs 6 and 7 should always be constrained by the characteristic length scale of the average flow field particularly with regard to flow velocity and set equally over space and remain unchanged with time 4 models applications to test the models developed in section 3 and assess their accuracy and conservation properties two test cases namely u tube and dam break are simulated and the results are compared with analytical or experimental data the simulations are all in two dimensional 2d based on the wcsph method with numerical schemes elaborated in the previous section 4 1 test cases the sketches of the domain of the two test cases u tube and dam break are depicted in fig 3 the u tube test is about a linear seepage flow in a u tube containing a porous soil medium and the dam break test examines the collapse of a water column through a porous dam made up of crushed rocks these two tests are chosen due to the following reasons i they can be simulated in 2d ii there are analytical solutions and or experimental data available for them so that it is possible to examine the accuracy of the models iii porous media in one test u tube is under closed channel flow condition and it is always fully saturated during the simulation while in the other test dam break flow in the media has a varying free surface boundary it is initially dry and then water flows into it therefore the fluid mass inside the porous media is constant in the former and variable in the latter this issue is important when the conservation properties of the models are examined iv the effect of turbulence is negligible in both cases thus the lack of a turbulence model will not cause significant errors in the u tube test the water level in the left and right vertical sections is initially different so that flow occurs through porous media until the water surface reaches the same level in both sections the application set up is the same as in peng et al 2017 and kazemi et al 2020a water flows under gravity due to the difference in water level seeping through the porous medium which is placed in the centre of the horizontal section if the non linear friction in the porous medium is neglected the analytical solutions for the water level difference δh and the darcy velocity in the porous medium u equivalent to the phase average velocity u in the horizontal direction are expressed as follows 19 a δ h δ h 0 e x p 2 k h t l 19 b u δ h 0 k h e x p 2 k h t l l where t is the time δh 0 is the initial water level difference 1 35 m l is the seepage path length 1 0 m and kh denotes the hydraulic conductivity 0 005 for the dam break test the experimental data of liu et al 1999 is used for validation of the models in liu s experiment the water tank was 0 892 m long 0 44 m wide and 0 58 m high the porous dam was 0 29 m long 0 44 m wide and 0 37 m high and located at the centre of the tank it was built by crushed rocks with a mean diameter of 0 0159 m and a mean porosity of 0 49 a gate was placed 0 02 m away from the front side of the dam and opened manually at the beginning of the experiment within 0 1 s the initial water depth behind the dam was 0 25 m and the tailwater depth was 0 025 m 4 2 computational specifications the initial spacing of a generic particle a is set to l 0 α 0 a f n in model i see kazemi et al 2020a and l 0 in models ii and iii where α 0 a f is the initial porosity of the particle l 0 the initial particle spacing in the clear water region with a porosity of 1 0 and n the number of dimensions 2 in the present study the initial spacing l 0 is set to 25 mm and 2 mm in the simulations of the u tube and dam break tests leading to a total number of about 14 000 and 23 000 particles respectively in all the simulations a fifth order wendland c2 kernel function wendland 1995 is employed and three layers of ghost particles are used to model the wall boundaries in the present simulations following kazemi et al 2020a h is set to 1 2l 0 therefore the size of the support of the kernel function 2h seems to reasonably capture the variations in the average flow field in the present simulations this is because the flow is not highly sheared and the flow discharge especially in the u tube test is very slow see the numerical results in the following sections sufficiency of the resolution of the computational domain can also be inferred from the fact that these sizes are equal to or smaller than the ones used in similar tests in kazemi et al 2020a where the interfacial boundary flow was adequately simulated the same values are used for h ϕ this variable determines the size of the layer over which porosity changes from 1 0 in the clear water region to the mean porosity value in the porous region it is not possible to check the satisfaction of the constraint 2h ϕ l d i since the size and or configuration of the solid grains in the interfacial layer is not known however due to the fact that the flow is slow and gradual and the effect of turbulence is negligible in both cases the adopted values should satisfactorily model the flow transition at the interfacial boundary the initial porosity α 0 a f is calculated according to eq 8 where γ c is set to the mean porosity of the media in the porous region and one in the clear water region kazemi et al 2020a the mean porosity of the porous media according to the experimental data is set to 0 4 and 0 49 for the u tube and dam break tests respectively fluid s dynamic viscosity μ and reference density ρ 0 f are set to 10 3 kg m 1 s 1 and 1000 kg m3 respectively for the u tube test in peng et al 2017 the drag stress term is formulated based on soil permeability k which is related to the hydraulic conductivity as kh ρgk μ and no value is reported for the soil grain diameter ds therefore ds is estimated by kozeny carman equation for a hydraulic conductivity value of 0 005 to be then used in eq 18 for the estimation of the drag stress term 4 3 particle distribution and water surface elevation the particle distributions and water surface elevations computed by the models are presented and compared with the analytical or existing experimental data as well as some other numerical studies fig 4 shows the time series of the computed water level difference δh and discharge velocity in the porous medium u in comparison with the analytical solutions in eq 19 for t 0 to 200 s the best match with the analytical profiles belongs to model i while the errors of the other two models are not significant either fig 5 presents comparisons between model i and three other sph studies kazemi et al 2020a khayyer et al 2018 peng et al 2017 with regard to δh and u table 3 quantifies this comparison in terms of mean absolute error mae and root mean square deviation rmsd the model of khayyer et al 2018 shows the best performance in the calculation of both δh and u this is due to the isph scheme adopted in their study which yields accurate estimations of the pressure field by solving poisson s equation all the other models compared here are developed based on wcsph which allows noise in the density for the sake of an explicit pressure calculation amongst peng et al 2017 kazemi et al 2020a and the three models developed in this study model i gives the most accurate results for δh and u fig 6 compares the particles position at t 50 s predicted by models i and ii the particle distribution is quite regular for both models particle spacing in the porous medium in model i is larger than the one in the clear water region while in model ii it is the same all over the domain which is nearly equal to the initial particle spacing l 0 this is because in the former the equation of mass eq 12 represents the conservation of fluid s volume while in the latter it describes the conservation of sph particle s volume eq 13 fig 6 also provides a comparison between model i and kazemi et al 2020a regarding the free surface boundary in the left vertical section of the u tube at t 50 s in the result of kazemi et al 2020a particles near the free surface show larger spacing than those inside the fluid domain this is because of the shepard density filter they used at every 30 computational time steps in their simulations it was used to smooth the sph calculated density in order to limit the pressure noise inside the fluid domain however this filter causes discrepancies e g larger particle spacing near the free surface boundaries especially when the variation or motion of the free surface boundary is gradual as seen in the present u tube test which is due to the small hydraulic conductivity of the soil in the present model no density filter is applied but the unphysical oscillations in the pressure field are suppressed by employing the δ sph scheme of marrone et al 2011 this has greatly improved the efficiency of the model in producing smooth pressure discussed in section 4 5 and uniform particle spacing it is clearly seen from fig 6 that the model yields a completely regular distribution of particles inside the fluid domain there are some discrepancies near the free surface boundary but this boundary is still well captured fig 7 compares particles position and distribution obtained from models i and ii at t 100 s inside and near the soil medium particle distribution is regular and uniform in the simulations of both models and the transition from clear water to porous zone and vice versa is smooth as discussed earlier the larger spacing in the porous region of model i is due to the type of definition and discretisation of the continuity equation in this model continuity is imposed for the intrinsic averaged density ρ f therefore particle spacing in the media is proportional to its porosity when porosity becomes smaller particle spacing and volume become larger in order to carry the same amount of fluid mass as before setting particle spacing to l 0 α 0 a f n in the initial time step is to ensure that the correct amount of fluid mass is located in the porous medium at the beginning of the simulation it seems in akbari and namin 2013 and akbari 2014 where a similar approach was employed for the discretisation of the continuity equation this issue has been neglected and particle spacing inside and outside porous media has initially been set equally it has in their dam break tests for example led to some discrepancies in the particle distribution as it must have taken some while for the particles with smaller spacing in the porous dam to be replaced with the particles with larger spacing in the upstream clear water region as fluid flowed into the medium figs 8 to 10 present the results of models i ii and iii for the particle position in the dam break test from t 0 to 2 2 s blue areas these figures also compare the water level elevations free surface profiles with the experiments of liu et al 1999 the results of model i show a good agreement with the experimental data except at t 0 2 and 0 4 s in the frontal side of the wave in the porous dam kazemi et al 2020a stated that this mismatch which is present in most of the sph studies where this test case has been simulated might be because the porous dam was not saturated in the beginning of the experiment up to t 0 4 0 6 s a condition under which the drag stress term estimated by the ergun s equations may not be precise however after t 0 4 s a superior match is achieved between numerical and experimental profiles in fig 8 models ii and iii do not show a good match with the experimental data as seen in figs 9 and 10 but large underestimations of water level elevations are observed the dimensions of the water column in the left and the tailing water in the right sides of the tank are the same as the ones in model i i e water surface profiles in all the three models at t 0 are set equally however after the collapse of the water column when the wave develops through the dam models ii and iii underestimate water surface elevation this indicates a reduction in the total volume of water to better illustrate the issue water surface profiles at t 1 6 s obtained from models i ii and iii are compared in fig 11 left looking at the downstream side of the dam x 0 6 m water level elevation in models ii and iii is at z 0 025 m meaning that free surface profile in this section has not changed since t 0 this shows that the water has not yet flowed out of the dam at t 1 6 s while the water level estimated by model i has already reached the experimental level at z 0 06 m in the downstream section fig 11 right compares model i with two other sph studies regarding the water surface elevation at t 1 6 s the result of peng et al 2017 shows very similar profiles in the downstream section of the dam to the present models ii and iii i e water level remained at z 0 025 m until t 1 6 s also in the left side of the tank x 0 4 m their result shows an underestimation of the water surface elevation these underestimations are most likely becuase their continuity equation was defined very similarly to the present models ii and iii although they formulated equation of mass based on the time rate of intrinsic averaged density d ρ f dt the material derivative of porosity on the right hand side of their equation implies that conservation of ρ is satisfied rather than ρ f see eq 5 in peng et al 2017 on the other hand akbari 2014 s profile in the downstream section of the tank although showing minor underestimation of the experimental data indicates that the water level has already gone up at t 1 6 s the reason is that their model formulated the continuity equation based on intrinsic averaged density and used the particle s volume definition of discretisation a see fig 2 similar to the present model i however there are still discrepancies in their calculated water surface profiles at both the upstream and the downstream sides of the tank while the result of our model i shows a better agreement with liu s experiment these could be related to the different numerical treatment processes adopted in these models fig 12 compares models i and ii with respect to particle position near the upstream wall of the dam at t 1 6 s both models provide regular distributions of particles as well as smooth transitions from clear water to porous region in the dam break test except for some minor discrepancies in the result of model ii near the free surface boundary inside the dam it is shown that there are no significant differences between models i ii and iii when they are used to simulate the u tube test but in the simulations of the dam break test there are large discrepancies in the results of models ii and iii to further investigate the issue volume conservation for each model is quantified in the next section 4 4 volume conservation for each test two particles are selected and their trajectories time series of their porosity volume and fluid volume carried by them are computed and compared for models i ii and iii to investigate the conservative properties of the models fig 13 presents the result for the u tube test from t 0 to 150 s s 1 is initially located in the clear water region upstream of the porous medium and then move into the medium during the simulation s 2 at t 0 is in the porous region and then move downstream of the medium the trajectories in fig 13 indicate that both s 1 and s 2 move faster in model i as they travel a longer distance this can also be seen in figs 13 a and d where time series of porosity are presented porosity at s 1 in model i has dropped to 0 4 faster and sooner than in models ii and iii at s 2 it shows a similar behaviour porosity has risen to 1 0 sooner and faster in model i the reason is that particles move with their intrinsic phase averaged velocity u f in model i see eq 12 f while their motion in models ii and iii takes place based on phase averaged velocity u see eqs 13 g and 14 g this is consistent with the formulation of the continuity equation and the definition of the particle s volume as shown in section 4 3 and fig 7 when continuity is formulated for ρ f and particle s volume is defined as in discretisation a i e model i particle spacing becomes larger when a particle goes into the porous medium therefore it should travel with a higher velocity through the medium compared with models ii and iii discretisation b so that the flow will occur at the same discharge and the rate of mass and momentum in the medium will be similarly captured figs 13 b c e and f provide a clear illustration of the conservation of the fluid volume associated with ρ f carried by particles s 1 and s 2 in model i and the conservation of particle s volume associated with ρ in models ii and iii fig 14 shows the trajectory porosity fluid volume and particle s volume of two particles s 1 and s 2 in the dam break test computed by models i ii and iii s 1 is initially located in the clear water and then moves into the porous dam and s 2 is initially located in the porous dam and then moves to the downstream section of the tank here in contrast to the u tube test fig 13 particles s 1 and s 2 travel almost the same distances in models i ii and iii for example particle s 1 in model i does not necessarily go into the porous dam sooner and faster than in models ii and iii as shown in section 4 3 for the u tube test models ii and iii estimate water surface elevation and discharge velocity in the soil with accuracies very close to model i see figs 4 and 5 but in the dam break test simulations these two models significantly underestimate the water surface elevations see figs 8 to 11 the question is thus what characteristic makes the dam break test different from the u tube test so that particle s volume conservation leads to accurate estimations of water surface elevation in the latter but inaccurate ones in the former to examine this conservation of the total volume of fluid is computed by the three models and presented in fig 15 the total fluid volume is calculated as the summation of the volume of fluid carried by all the particles in the domain during 200 s of simulation for the u tube test and 5 s for the dam break test it is clearly seen that the total fluid volume is preserved by all the three models for the u tube test though a less than 1 drop is seen in models ii and iii while in the dam break test only model i conserves it models ii and iii show a considerable decrease about 10 15 of the total volume of fluid which is slightly higher in model iii it means that these two models do not provide conservative forms of the governing equations for fluid flow in porous media in general however they still correctly simulate a special type of flow that is a closed porous media flow condition where mass flux flowing in and out of the media is balanced therefore it can be concluded that if models ii and iii which are formulated based on phase averaged apparent density work well for the u tube test it is because the porous medium is fully saturated and there is no varying free surface open boundary in the medium to cause an imbalance in the inflow and outflow fluxes of mass and momentum 4 5 pressure distribution figs 16 and 17 present pressure distributions calculated by models i ii and iii for the u tube test at t 40 and 120 s and the dam break test at t 1 and 1 6 s respectively the distributions obtained from models i and ii are smooth and continuous but the ones from model iii show large discontinuities near the interface boundaries between clear water and porous media the discontinuity is sharper in the dam break test because of the higher flow velocities on the other hand in the u tube test where flow discharge is low in the soil medium it affects a larger area near the interface layer and occurs very gradually in time it appears as a drop in the pressure in the upstream side and a rise in the downstream side of the medium this is due to the disregard of the extra terms which are added to the governing equations of model ii in the process of translating the local time derivatives to the material derivatives based on phased averaged velocity u see sections 3 1 and 3 2 for details fig 18 compares the pressure distribution at t 1 6 for different models near the upstream side of the dam it shows the pressure drop at the interface in model iii resulted in a drop in the water surface profile too hence the deficiency of model iii compared to model ii has led to further underestimations of total fluid volume as already shown in figs 15 right and figs 11 left fig 18 also shows that model ii has produced the most continuous and smooth pressure field amongst all the three models the minor pressure noise in the result of model i particularly in the porous zone is probably due to the change of particle spacing which occurs as a result of the change of porosity when particles travel over the interface layer such noise is not seen in the result of model i in the u tube test where the flow velocity is small and the change in the particle spacing over the interface layer occurs very gradually over a relatively long time this can be seen in fig 19 middle the figure compares pressure snapshots at t 40 s computed by the present models i and ii and the model developed in the author s previous study kazemi et al 2020a for the u tube test the dashed dotted lines depict the pressure contour lines at 2 104 pa they show that models i and ii are capable of reproducing the linear distribution of pressure in the porous region and this suggests that the application of the δ sph formulation has improved the accuracy of the present models compared to kazemi et al 2020a 5 conclusions and perspectives a thorough investigation is performed on the mathematical basis of the sph method aiming for providing a more systematic modelling approach for fluid flows in porous media three models are developed and tested for two different types of problems with regard to the estimation of water surface elevation pressure field and the conservation of volume the major findings of the study concerning both the mathematical development of the governing equations and the solution of them for two flow types in porous media are summarised as follows two types of particle discretisation can be have been employed in the simulation of fluid flow in porous media using sph they are fulfilled by the solution of continuity equation based on either intrinsic averaged density ρ f representing fluid s density or phase averaged density ρ namely apparent density consistency is required between the discretisation of the continuity equation the definition of the particle s volume and the velocity by which particles are moved in discretising the continuity equation based on ρ f particle s volume is defined as d v a m 0 f α a f ρ a f and it is moved according to its intrinsic averaged velocity u f while in the discretisation of the continuity equation based on ρ particle s volume is defined as d v a α a f m 0 f ρ a and particle s motion is set based on its phase averaged velocity u in the former when the lagrangian form of macroscopic equations is developed the transformation of local time derivatives to material derivatives is performed using eq 11 a while in the latter eq 11 b should be used using the definition in eq 11 b leads to extra terms in the final equations if these extra terms are disregarded as in model iii discontinuity may arise in the model results particularly in the pressure field near the interface boundary between porous media and clear water both types of models conserve fluid volume for the problems in which porous media is under a closed channel flow condition where the saturation of the media is not varying in time and the inflow and outflow mass fluxes are balanced but model type ii continuity of ρ violates the conservation of fluid volume for the cases where there is a varying free surface boundary in the porous media and the fluid mass inside it saturation is not constant the most continuous and smooth pressure field is obtained from model type ii i e continuity of ρ if the proposed extra terms in the mass and momentum equations are included and the model is applied to solve closed porous media flow conditions therefore model i is recommended to be used for the problems where there is a free surface boundary in the porous media and its saturation is varying while model ii is recommended for fully saturated media which is under closed flow conditions the results also suggest that employing the δ sph formulation with a diffusive term in the mass equation and an artificial viscous term in the momentum equation leads to more regular particle distributions and smoother pressure fields compared to the authors previous study that did not incorporate these schemes kazemi et al 2020a the developed models are tested under simplified conditions i e mild flow velocities insignificance of turbulence small scale 2d domains and simple boundary conditions this is to ensure that the modelling approach is appropriately tested for important issues such as volume conservation for extending the application of the models to more complex engineering problems e g large scale wave current interactions with porous structures like breakwaters and dikes the influencing factors including flow turbulence complexity of flows in the interfacial layer complexity of rigid boundaries free surface deformations computational cost etc would be taken into account therefore to further enhance the modelling process and applicability of the developed models it is recommended to incorporate the effect of flow turbulence using an appropriate model improve particle regularity near the free surface boundary robust particle shifting technologies such as the ones introduced in khayyer et al 2017 or sun et al 2019 can be extended for this purpose it can also improve the transition of particles between regions with different porosities particularly for model i type of simulation where particle spacing changes based on porosity as well as the pressure field inside porous media however the issue of change of particle size at the interface seems challenging and needs careful attention extend the present models into 3d for more complex real world problems employ the present modelling approach for formulating conservation of fluid volume in deformable or movable porous media such applications may include sph modelling of sediment transport based on mixture theory shi et al 2019 geomechanics applications of sph in simulating failure of porous structures bui and nguyen 2021 or coupling sph with discrete particle methods for industrial particle fluid flow applications he et al 2018 credit authorship contribution statement ehsan kazemi conceptualization formal analysis investigation data curation writing original draft writing review editing visualization project administration min luo conceptualization formal analysis investigation writing review editing project administration funding acquisition declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgement the second author acknowledges the start up funding provided by zhejiang university and the fundamental research funds for the central universities no 2021qna4036 appendix the spatial averaging theorem whitaker 1999 is applied to the eulerian form of the conservation equations of mass and momentum as shown in eqs a 1 and eqs a 2 where denotes the phase averages of the terms then the definitions in section 2 specifically eqs 3 to 5 are employed to derive the spatially averaged equations of mass and momentum for the purpose of macroscopic modelling of fluid flow through fixed porous media in the following this process is carried out for obtaining macroscopic equations in terms of intrinsic phase averaged density ρ f in section a i and phase averaged density ρ in appendix a ii the equations are presented in the lagrangian form and used for the development of the three sph models in section 3 a 1 ρ t ρ u 0 a 2 ρ u t ρ u u p i σ ρ g a i macroscopic equations in terms of intrinsic averaged density ρ f according to eqs 3 and 4 phase averages of the two terms in eq a 1 are written as a 3 ρ t α f ρ f t a 4 ρ u ρ u a f s w ρ u n f s d a α f ρ f u f therefore eq a 1 can be written as follows the surface integral in eq a 4 is omitted owing to the no slip condition at the fluid solid interfaces i e u n fs 0 a 5 α f ρ f t u f ρ f ρ f α f u f 0 where according to eq 11 a ρ f t u f ρ f represents material derivative of the intrinsic phase averaged density in this definition sph particles are supposed to move with their intrinsic phase averaged velocity u f finally the spatially averaged macroscopic equation of mass in terms of intrinsic phase averaged density ρ f and in the lagrangian form is written as below a 6 d ρ f d t ρ f α f α f u f similarly applying the definitions in section 2 the two terms on the left hand side of the equation of momentum eq a 2 are expressed as follows a 7 ρ u t ρ u t t α f ρ f u f a 8 ρ u u ρ u u a f s w ρ u u n f s d a α f ρ f u f u f to approximate the terms on the right hand side of eq a 2 point values of pressure and shear stress p and σ are firstly decomposed into their averages and spatial deviations and then the terms are averaged the final form is presented in eq a 9 where p and σ in the surface integral term denote the spatial deviations of pressure and shear stress in respect to their averages respectively for details of the derivation see whitaker 1996 a 9 p i σ ρ g α f p f α f σ f a f s w p i σ n f s d a α f ρ f g the surface integral term in eq a 9 represents the effect of the solid skeleton on the average flow field it is equivalent to the surface integral term over the local averaging volume dv in the study of whitaker 1996 thus can be approximated as follows a 10 f d a f s w p i σ n f s d a 1 d v a f s p i σ n f s d a α f 1 d v f a f s p i σ n f s d a α f μ k 1 1 β f u where k and β f are the permeability and forchheimer tensors respectively using eqs a 7 to a 10 the spatial average of the momentum equation can be written as below a 11 α f ρ f u f t u f u f u f t α f ρ f α f ρ f u f α f p f α f σ f f d α f ρ f g where the term in the first bracket represents material derivative of u f with the definition that particles will move based on u f and the term in the second bracket is equal to zero according to the conservation of mass eq a 1 thus in the final lagrangian form the spatially averaged macroscopic equation of momentum is written as follows a 12 d u f d t p f ρ f α f σ f α f ρ f f d α f ρ f g a ii macroscopic equations in terms of phase averaged density ρ using the definitions in eqs 3 to 5 the time derivative and divergence terms in eq a 1 are expressed in terms of phase averaged density as follows a 13 ρ t ρ t a 14 ρ u ρ u a f s w ρ u n f s d a ρ u f therefore eq a 1 can be written as a 15 ρ t u f ρ ρ u f 0 the term in the parenthesis denotes the material derivative of ρ if a fluid particle moves based on u f in this case the macroscopic equation of mass will be written in terms of ρ as below a 16 d ρ d t ρ u f however when macroscopic equation of mass is formulated to describe time evolution of ρ its discretised form will represent conservation of volume of the sph particles rather than fluid s volume therefore particles should move based on u in other words eq 11 b should be used to formulate material derivatives thus eq a 1 is expressed as follows a 17 d ρ d t ρ u f 1 α f u f ρ momentum equation is developed similar to section a i as presented in eq a 12 but using eq 11 b to transform eulerian form to the lagrangian form to apply motion of particles based on u note that this equation is written in terms of u f which is convertible to u using eq 1 c a 18 d u f d t α f p f ρ α f σ f ρ f d ρ g 1 α f u f u f 
136,in this study we have developed a two way fully coupled hydrodynamic vegetation model that includes a spatially and temporally variable drag coefficient of flexible submerged aquatic vegetation sav the developed model consists of a nonhydrostatic wave model nhwave that solves the navier stokes equations and a numerical model for vegetation stem dynamics that solves the instantaneous forces applied by flow on vegetation stems the results of the developed model are validated against a number of laboratory scale experiments on wave attenuation stem orientation and stem base forces and then applied to an idealized configuration to further investigate the effects of vegetation induced drag coefficient on waves velocity field wave attenuation and vegetation dynamics along a numerical flume the model was able to reproduce experimental results without parameter tuning by adopting the n pendula approach the stem dynamics model solves the instantaneous orientation of segments along each stem and uses this information to compute a spatially and temporally varying vegetative drag coefficient within the meadow when compared with laboratory experiments incorporating this new mechanism for flexible vegetation in the wave model resulted in improvement over results with rigid vegetation through highly detailed representation of vegetation the model can reliably predict wave attenuation over marshes and seagrass meadows evaluate potential storm damages to these features and calculate instantaneous orientation of plant stems or shoots which has implications for their photosynthesis keywords flexible vegetation navier stokes equations drag coefficient wave dissipation vegetation stem forces key points a coupled numerical model is developed to simulate two way interactions between waves and highly flexible vegetation wave attenuation wave induced stem motion and forces at stem bases are validated against experimental results the model enables understanding of wave attenuation over vegetation and wave impacts on vegetation meadows without applying limitation on waves or vegetation dynamics plain language summary submerged aquatic vegetation sav in estuaries and coastal areas can attenuate storm surge and waves vegetation effects on waves and currents are generally modeled as a constant drag coefficient across the meadow this is an oversimplification of vegetation effects as it neglects vegetation stem behavior under hydrodynamic forcing which can affect drag this study provides a better understanding of how savs alter wave amplitude and velocity by developing a coupled wave vegetation interaction model which consists of a nonhydrostatic wave model and a numerical model for vegetation stem dynamics the two models are dynamically coupled meaning that the wave model solves the free surface elevation and depth varying velocity and feeds it to the vegetation model the vegetation model then calculates a vertically variable drag coefficient for a stem and feeds it back to the wave model the vegetation model also calculates stem orientation which are dependent on the forces applied over the stem model results for stem orientation flow forces on stems and wave attenuation compare well with the data simulations suggest that considering a rigid vegetation with simplified drag coefficient would result in substantially larger vegetation induced damping compared to flexible vegetation condition 1 introduction a large percentage of the u s major cities lie close or within estuarine areas that are vulnerable to flooding caused by global environmental changes such as sea level rise e g oppenheimer et al 2019 and increasing strength and frequencies of extreme weather events e g holland and webster 2007 local anthropogenic alterations such as channel deepening and dredging e g familkhalili et al 2020 talke et al 2021 wetland land cover reduction e g sleeter et al 2018 are also impacting people that have settled along estuaries and floodplains aquatic vegetation has increasingly been considered as a natural buffer to reduce wave energy and therefore decrease storm surge and flood damages in estuaries and coastal areas e g john et al 2016 narayan et al 2016 sheng et al 2012 recently more sustainable flood risk management have been proposed that highlight the benefits of aquatic vegetation for flood protection natural habitats such as submerged aquatic vegetation sav in estuaries and coastal areas provide a wide range of ecosystem services such as enhancing water quality e g schulz et al 2003 by absorbing nutrients from water sustaining food and habitat for aquatic life e g nepf 2011 stabilizing seabed sediment and reducing coastal erosion e g möller 2006 nepf 2011 nepf and ghisalberti 2008 and attenuating wave energy e g augustin et al 2009 suzuki et al 2012 maza et al 2013 jadhav et al 2013 generated by storm surges and cyclones e g loder et al 2009 wamsley et al 2010 which helps to minimize flood risk in addition savs can mitigate ocean warming and acidification due to climate change effects e g bergstrom et al 2019 previous studies have investigated the attenuation of waves due to vegetation based on linear wave theory e g dalrymple et al 1984 kobayashi et al 1993 mendez and losada 2004 experimentally e g stratigaki et al 2011 anderson and smith 2014 hu et al 2014 john et al 2016 and numerically e g maza et al 2013 zhu and chen 2015 however there are limitations in predicting wave attenuation over vegetation some of which stem from inadequate representation of vegetation flexibility and motion in numerical models therefore it is important to improve models that simulate sav dynamics in wave models to better predict flow dynamics over meadows vegetation effect on storm surge and wave reduction is generally parameterized in hydrodynamic models as a constant darcy weisbach friction factor the manning n value or the chezy coefficient that is typically larger than that for mud and or fine sand n 0 02 s m 1 3 e g wamsley et al 2010 orton et al 2015 this coefficient is typically averaged over time and assumed to be constant across the meadow and over meadow height e g rooijen et al 2020 however vegetation motion is spatially variable over a meadow as a function of hydrodynamics and also affects the flow field for example the complex structure and motion of savs can significantly reduce the mean flow and alter turbulent mixing e g järvelä 2005 nepf 2011 nepf and vivoni 2000 in turn changes in hydrodynamics affect forces on vegetation stems and their motion the sav dynamic motion causes drag reduction e g maza et al 2015 abdolahpour et al 2017 as relative velocity of vegetation and flow and active vegetation frontal area decrease when vegetation stems reconfigure under wave fluctuations thus considering vegetation as additional bottom roughness cannot realistically represent its effect on flow through vegetation as it neglects the interactions between vegetation stem structure and flow which is inherently a two way process moreover treating vegetation as bottom roughness typically requires calibrating the friction coefficient based on observations to obtain a reasonable prediction of the variable of interest e g wave height due to motion of vegetation stems which affects its resistance against the flow a constant drag coefficient cannot rigorously represent the true vegetative drag force that causes wave attenuation some recent studies have developed models to solve the dynamics of stem structure under hydrodynamic forces abdelrhman 2007 modeled a seagrass blade as a series of interconnected rectangular segments in a steady flow and solved the force balance equation to determine the steady state position of the blade the rigidity of a blade was not considered in the study zeller et al 2014 used the same equations for lift drag and skin friction forces as abdelrhman 2007 but assumed that joints between segments were equipped with torsion springs that represented blade rigidity luhar and nepf 2016 also developed a numerical model for motion of highly flexible vegetation but used the well known morison force formulation numerical models have recently been developed to investigate wave vegetation interactions by analyzing nonlinear wave transformation velocity field changes and vegetation interactions with currents e g ma et al 2013 maza et al 2013 generally numerical studies of sav have modeled vegetation as rigid e g neary 2003 cui and neary 2008 or semi flexible elements e g maza et al 2013 zhu and chen 2015 which apply some simplifications on vegetation motion for example maza et al 2013 assume that vegetation stems deform linearly under flow action or zhu and chen 2015 model is applicable to small stem deflection where vertical motion of stem is negligible thus these models are not valid for highly flexible vegetation that can undergo large deflections under realistic wave and current forcing a few recent studies have developed models for flexible vegetation using cantilever beams capable of large deflections e g mattis et al 2019 chen and zou 2019 tahvildari 2017 zeller et al 2014 in this study we investigate the effects of highly flexible vegetation on wave attenuation along the meadow by developing a two way coupled hydrodynamic vegetation model the vegetation model is based on zeller et al 2014 and thus is capable of solving stem dynamics under large deflections the flow model is the reynolds averaged navier stokes rans model nhwave ma et al 2012 2013 the developed model enables quantifying wave attenuation and flow field over highly flexible vegetation meadows predicting instantaneous vegetation motion and calculating forces within stems the stem dynamics model derives horizontally and vertically varying drag coefficients that is used in the nhwave model the coupled model is verified with the data on wave attenuation stratigaki et al 2011 stem orientation maza et al 2013 and forces within stems jacobsen et al 2019 to our knowledge this is the first comparison between computational forces within vegetation elements and experimental values this study improves our understanding of two way interactions between flow and vegetation as no limitation is applied on waves or vegetation dynamics the model presented in this study can inform coastal engineers and scientists on how vegetation protects the upland infrastructure from storm wave action and how storms can potentially damage vegetation meadows thus improve wetland or sav restoration efforts 2 model development 2 1 seagrass meadow geometry a flexible seagrass submerged meadow is assumed to be 10 m long lm with population density ns of 400 stems m2 representing a medium density meadow the model domain length l and depth h are set to 400 m and 0 8 m respectively with horizontally uniform computational grid of 0 05 m and 16 equal vertical layers the seagrass meadow length is much larger than water depth h 0 8 m and thus ensure fully developed meadow flow conditions see fig 1 the meadow starts at x 60 m normalized length of l 0 that provides enough length before the meadow for surface waves stabilization such that the wave field is fully developed and reaches the steady state condition the frontal width bs of an individual seagrass stem is assumed to be 0 01 m with thickness of 1 mm we model 4 stem lengths hs of 0 3 0 4 0 5 and 0 6 m the simulation period is 60 s with 30 s startup to allow stability i e total of 90 s the computational time step is adjusted during the simulation with the courant number of 0 5 2 2 wave model the nonhydrostatic wave model nhwave ma et al 2013 which solves the three dimensional current and wave field is modified to include the effect of spatially variable and time dependent vegetation drag coefficient cd the nhwave model solves the rans equations 1 u i x i 0 2 u i t u j u i x j 1 ρ w p x i g i τ i j x j f v i where xi is the cartesian coordinate ui u v w that are the velocity components in x y z coordinates respectively ρ w is water density p is total pressure τ ij is the stress tensor that includes viscosity and turbulence effects g is the gravitational force and f v i is a drag term that accounts for the interaction between flow and flexible vegetation elements and is defined in eq 5 within the meadow a volume averaging scheme ma et al 2013 and an ad hoc drag term are used to consider the void fraction which is required to account for the spatial heterogeneity of velocity field at the stem scale ma et al 2013 nepf and ghisalberti 2008 the turbulence effects represented by τ ij are calculated using the nonlinear k ε equations implemented in nhwave with a practical kinematic eddy viscosity of υ t c μ k 2 ε where k is the turbulent energy ε is the turbulent dissipation rate and c μ 0 09 is the empirical turbulence model constant the conservation form of the nonlinear k ε equations which considers the effects of vegetation are 3 dk t duk d υ υ t σ k k d p s c fk p v ε 4 d ε t du ε d υ υ t σ ε ε ε k d c 1 ε p s c f ε p v c 2 ε ε with empirical coefficients of σ k 1 0 σε 1 3 c 1ε 1 44 c 2ε 1 92 see ma et al 2013 and calibrated coefficients of c f 0 16 and cfk 0 07 based on shimizu and tsujimoto 1994 experimental turbulence measurements in which they found that these values would produce a good agreement between the measured and calculated mean velocity profiles ps and pv are the shear production and turbulence production due to vegetation respectively these coefficients are not modified in our study however we do not claim that there are optimal values recommended for all studies users of the model should conduct studies to select the most appropriate values for their applications it is noted that nhwave does not consider the contribution of dispersive stresses this was assumed by the original authors of nhwave based on a remark by ayotte et al 1999 that dispersive stresses would be negligible compared with reynolds stresses however ayotte et al 1999 did not back their assumption with actual data more recent laboratory data e g poggi and katul 2008 ricardo et al 2016 maji et al 2020 and large eddy numerical simulations ricardo et al 2018 have shown for rigid cylinders that dispersive stresses can be of the order of magnitude of reynolds stresses including dispersive stresses in nhwave is out of the scope of this work and can be the subject of future studies the governing equations are discretized using combined finite volume and finite difference approach with a second order godunov scheme see ma et al 2013 for details and are solved with boundary conditions of zero pressure at the free surface at z h bottom friction at z 0 influx of incoming wave at x 0 and free slip impermeable walls as lateral boundary conditions which impose zero normal velocity and tangential stress in y direction at these boundaries fig 1 the new drag term f v i is defined as 5 f v i 1 2 c d i b s n c u i u i where bs is vegetation frontal stem width m nc is vegetation population density stems m2 and u i is relative velocity between vegetation stem and the fluid c d i is the spatially and temporally varying dimensionless drag coefficient and is given by 6 c d i 2 ψ i ρ w d v b s n c where dv is segment volume i e dv dx dy dz and ψ i is a term calculated for each segment of each stem and thus varies as a function of velocity along the meadow as well as in vertical direction ψ i is given by 7 ψ i f t i u i u i where f t i is the drag force per unit volume it is noted that this drag force is the summation of form drag and skin friction see table 1 2 3 vegetation stem dynamics model the aim of simulating dynamics of vegetation stems is to compute c d i as a function of space both horizontal and vertical and time by solving the flow forces applied on each vegetation stem flexible stems present a complex behavior under wave action as they reorganize in response to velocity changes thus unlike rigid elements flexible vegetation applies an altered drag force on the flow at each time step in addition there is a competing effect between the flow velocity u and vegetation frontal area av that alters the drag force as flexible stems have less flow resistance when fluid velocity increases larger u that leads to smaller av and thus may increase or decrease drag force values see eqs 5 7 the developed vegetation model considers the instantaneous orientation of a flexible stem and is developed following zeller et al 2014 in which a stem is modeled as a series of rectangular segments n pendula which are connected at joints by torsion springs and rotary dashpots dividing up each blade into an arbitrary number of segments n allows us to simulate strong deflection of blades under combined wave conditions this model accounts for vertical variability of flow velocity and seagrass stem motion by assuming a spring mass model which incorporates a comprehensive set of forces applied on a stem gravity buoyancy friction lift inertial and most importantly drag at each time step the model takes velocity values for each blade segment and computes the local curvature of stem segments θ and finally calculates the forces that act on that segment i e drag lift skin friction and inertia see table 2 table 1 subscript n refers to the nth blade segment e x and e z are unit vectors wn bn and ln are the width thickness and length of the blade segment respectively c d n c l n cf and c a n are the drag lift friction and added mass coefficients of each blade segment un and u n are the fluid velocity and acceleration at the segment center while x n and x n are the velocity and acceleration of the center of blade segment θ a n is the angle of attack i e the angle between un and x n and θ n is the angle between segment n and the vertical direction in this approach the full force balance equations namely equations for conservation of momentum and conservation of angular momentum are written and rearranged as follows 8 d θ n d t a n j s j 9 d θ n d t θ n where n 1 2 n and subscript j is the counter for time steps anj and sj are nonlinear functions of θ this system of implicit equations is solved using matlab s ode45 and ode1s functions zeller et al 2014 once the angle θ is solved the total drag ft which is the summation of skin friction fs caused by shear stress due to the viscous interaction between the fluid and stem surface and pressure drag fd are calculated and incorporated in eqs 6 7 to solve for c d i 2 4 coupled wave vegetation model the coupling between hydrodynamic and vegetation models is achieved through a stepwise exchange of velocity fields of waves and current from nhwave to the vegetation model and vegetation drag coefficient calculated by vegetation model to nhwave in this section we describe the steps towards a fully two way coupled modeling system composed of these two models our work focuses on wave and current alterations due to vegetation induced drag which is temporally and spatially variable in each step ti of the coupling approach velocity field computed by the hydrodynamic model is extracted and analyzed to find the velocity corresponding to each segment of vegetation stems the model considers σ coordinate system i e variable layer thicknesses so that the velocity values fed to the vegetation model reflect stem motion and σ coordinate system at each time step the model uses a special type of staggered grid where velocities are defined at cell centers while pressures are defined at the vertically facing cell boundaries fig 2 shows the coupled modeling framework used in this study 2 5 numerical model validation in this section the sensitivity of the developed coupled wave vegetation model to grid size is studied and then the model is validated against available experimental results on wave height attenuation by stratigaki et al 2011 an important capability of the presented model is detailed calculation of vegetation stem excursion as well as forces applied on vegetation stems these two aspects of the model are validated by comparing simulated vegetation stem excursion with results from laboratory experiments of maza et al 2013 and simulated forces with those measured at the base of a vegetation stem in laboratory experiment of jacobsen et al 2019 2 5 1 model convergence generally the numerical model results should converge to a certain value and thus further reductions in grid size should not change the model results the model convergence associated with the vertical discretization in the σ coordinate system has previously been studied by ma et al 2012 in this section we examine the convergence of the coupled wave vegetation interaction model with respect to the grid size in horizontal direction we consider different grid spacing of δ x n where δx 0 10 m and n 1 2 4 and 8 for a case with constant depth of 0 8 m and length of 400 m vegetation height of 0 3 m and linear wave with amplitude of 0 2 m and period of 4 s the computational time step is adjusted automatically during the simulation such that the courant number is 0 5 in all the cases fig 3 shows the convergence with grid refinement as demonstrated by the root mean square rms of the differences in surface wave height over the entire domain between runs with different resolutions and the base case of δx 0 0125 m as seen the rms of wave heights is only 1 9 mm less than 1 over the meadow for the coarsest grid and decreases with grid size following eça and hoekstra 2014 we calculated the grid convergence ratio to be 0 22 which corresponds to monotonic convergence type 2 5 2 wave height attenuation in what concerns wave height attenuation we validate our wave vegetation modeling system against several idealized experimental results performed by stratigaki et al 2011 the experiments were carried out in a 100 m by 3 m flume with artificial vegetation from l 38 36 m to 49 06 m lm 10 7 m long vegetation meadow that provides enough length for waves to fully develop and stabilize before reaching the meadow the vegetation stems made from four pvc strips two 45 cm and two 27 5 cm long we simplify model simulation by considering a single stem vegetation this assumption is justified as there is no binding between the four stems in the experiments enabling them to move independently fig 4 shows the modeled and experimental measurements of spatial wave height h 0 evolution along the meadow for three different configurations as shown there is a good agreement between the modeled and measured values in all cases with root mean square error rmse of 0 02 0 02 and 0 04 m the scatter in experiment increases for higher wave and larger depth resulting in a slightly higher rmse fig 4c the simulated wave height for cases without vegetation are presented by black dashed lines showing negligible changes 2 5 3 flexible vegetation stem excursion understanding vegetation motion under fluid forces is important for quantifying drag forces and predicting seagrass light absorption and growth e g zimmerman 2003 here we validate model performance by comparing the modeled vegetation stem excursion with experimental results reported by maza et al 2013 in these simulations b s 0 01 m stem width hs 0 45 m stem length lm 0 2 m meadow length h 0 0 2 m wave height t 4 s wave period and h 0 8 m water depth to be consistent with the parameters used in the experiments we set up the simulations following the experimental set up where five vegetation clusters at 5 cm spacing were placed in the flume to capture the plant shadowing effect fig 5 presents the maximum plant excursion for a regular wave height with the above specifications each gray curve corresponds to maximum onshore and offshore movement of the five stems along the meadow and the black dash lines show the observed maximum displacements by maza et al 2013 larger excursion of vegetation stems under wave crest 0 6x where x is the horizontal normalized by the stem length hs than under trough 0 35x implies that the vegetation motion is not symmetric relative to the vertical axis that is relative to the regular wave condition 2 5 4 force distribution along a flexible stem the model result for instantaneous forces along stems is compared with the data from jacobsen et al 2019 experiments table 2 and table 3 jacobsen et al 2019 studied the forces and the motion of a single flexible stem with lengths of 0 15 m and 0 30 m and rectangular cross section under waves to determine non dimensional parameters and predict the stem motion and shape and forces along a stem forces at the base of stems were measured in laboratory experiments which was the bases for estimation of external loading along the stem to reproduce jacobsen et al 2019 experimental results we study the forces along three types of vegetation table 2 under three wave conditions table 3 table 2 represents the vegetation stems properties where bs δ and hs are stem width thickness and height respectively ρ s is density and e represents the young s modulus a total of three wave conditions are chosen table 3 where h 0 is the regular wave height at the paddle in the wave flume and t is the wave period the water depth at the paddle is set to 0 65 m and the wave flume depth is 0 45 m table 3 shows the target wave conditions h 0 and t and the observed wave conditions h 0 η t η c in jacobsen et al 2019 and the simulated conditions h m η m t η m c in this study the subscript m represents the modeled values and η c and η t are the average crest and trough elevations respectively fig 6 shows modeled and measured force values at the base of vegetation stems for stem lengths hs of 0 15 m and 0 30 m considering wave boundary conditions to be identical to the experiments see table 3 the modeled forces for type i fig 6a and iii fig 6c vegetation follow the 1 1 and 1 2 lines consistent with experimental values the modeled forces scale linearly with hs for type ii while the measured values show a transition from 1 1 to 1 2 fig 6b as suggested by jacobsen et al 2019 this transition could be explained by changes in exposed length of the deflected stem that might be due to small rigidity of type ii compared to type i and iii by o 10 2 and is a process that could not be simulated with the model 3 results the developed model enables studying wave vegetation interaction over a wide range of parameters formed by vegetation characteristics e g stem length density rigidity wave properties frequency amplitude and water depth we employ the validated model to study the effects of vegetation characteristics namely stem length 0 3 0 6 m on vegetation stems motion force wave height attenuation and velocity profile over a meadow as an example first the effect of flexible vegetation induced drag coefficient on wave velocity field and stem orientation are examined then the special patterns of stem force along the stem and meadow are presented and finally wave height attenuation due to flexible vegetation is investigated 3 1 vegetation effects on wave velocity profile the vegetation drag applied to the flow reduces the flow within the meadow and therefore increases residence time within the meadow compared to the overlying water furthermore the vertical variability in the flow affects the bending angle of seagrass which in result can alter the drag coefficient the effect of meadow presence through constant bulk drag coefficient for rigid vegetation cdb and variable drag coefficient for flexible vegetation cd x z t on wave averaged velocity are presented in fig 7 l represents the normalized coordinate system l l m where l 0 is the leading edge of the meadow and h is normalized water depth z h s mean flow velocities offshore of meadow l 0 are nearly zero to slightly negative magnitudes at surface h 1 5 that indicates offshore directed flow similarly onshore of the meadow i e landward l 1 mean flow velocities are near zero and present throughout the water column except near the surface h 1 5 see fig 7a within the rigid meadow l 0 1 fig 7a mean flow velocity is relatively high near the top of the meadow i e h 1 in landward direction while the values above the meadow h 1 are negative implying offshore directed flows this observation is consistent with previous studies e g rooijen et al 2020 fig 7 also illustrates the difference in distribution of wave averaged velocity around and mostly above the meadow the velocity within the rigid meadow is distinctively reduced compared to the flow outside the meadow and the maximum velocity is concentrated at the intersection of the meadow and the overlying water in contrast the flow within the flexible meadow is comparable to that outside of the meadow and the maximum value around the interface of the meadow and the unblocked flow is smaller than the velocity observed at the same elevation over the rigid meadow over the meadow l 0 1 the wave averaged velocity is higher for flexible vegetation fig 7b than that of rigid vegetation fig 7a the maximum stem excursion occurs at the point of highest velocity furthermore due to stem reconfiguration high velocities penetrate further down into the meadow compared to the rigid meadow this observation is consistent with earlier studies e g rooijen et al 2020 to have a closer look at wave averaged velocity values fig 8 shows the profile of wave averaged streamwise velocity u at five different locations along the numerical flume specifically l 1 0 0 5 1 and 2 for three configurations in the absence of a meadow a meadow with rigid vegetation and one with flexible vegetation along the normalized depth h the horizontal black dash line in fig 8 shows the height of vegetation hs 0 5 m or h 1 clearly the vegetation meadow changes the vertical distribution of wave velocities as there is not much of change before l 1 fig 8a and after l 2 fig 8e the meadow between the model runs which confirms that changes mostly happen in the meadow due to the effects of vegetation drag there is a localized peak in velocity profile u near above the meadow in flexible vegetation condition light gray line which is consistent along the meadow see fig 8 while it is larger for the rigid vegetation condition see gray lines in fig 8 spatial distributions of the root mean square of the simulated velocity i e u r m s 1 n i 1 n u i 2 around a rigid and flexible meadow are presented in fig 9 averaging the values within the meadow implies 20 increase for flexible condition the peak values occur near the top of meadow h 1 shown by horizontal black dash line the difference between the values of urms for rigid and flexible vegetation configurations increases along the meadow confirming that larger velocity values are applied over the stem in a flexible meadow see fig 10 fig 10 illustrates wave averaged urms profile for five sections along the modeled flume for all sections along the meadow in meadow root mean square and wave averaged velocity are larger for flexible vegetation compared to rigid vegetation larger u occurs near the top of flexible meadow that is in accordance with the range of stem heights at maximum deflection where the shear is strongest see also fig 11 a 3 2 flexible stem motion the vegetation stem motion influences the flow structure thus determining accurate instantaneous configuration of stems is necessary to resolve flow vegetation interactions model results suggest that as expected there is a strong dependency between the deflection of vegetation stems and wave amplitude see fig 11 since our model can obtain the instantaneous position of stem segments under a wave we calculate vegetation induced drag for each configuration of each stem segment and thus input corresponding drag into the wave model for the maximum deflection toward wave direction the vegetation stem frontal area decreases and therefore the drag coefficient decreases on the other hand the vegetation stem fluctuates under the wave motion and as it reaches the maximum deflection the relative velocities significantly increase and that in result would produce large vegetation drag coefficient and turbulence therefore vegetative drag is a result of these competing effects the influence of stem height hs on stem orientation along the x and z direction is tested by modeling a set of vegetation meadows with heights ranging from 0 3 m to 0 6 m increasing the stem height produces a larger horizontal stem tip displacement under the wave crest x c and trough x t fig 12 a and b than in vertical direction z c and z t fig 12c and d note that the displacements plotted in fig 12 are absolute values of maximum stem tip positions x and z and are made non dimensional by dividing to the length of stem hs 0 3 0 4 0 5 0 6 m physically the longer stem produces larger frontal area which attenuates more fluid forces resulting in stronger shadowing effect this reduces stem deflection further into the meadow the velocity reduction within the meadow causes a decrease in the forces on vegetation stems the maximum tip displacement under the crest fig 12a changes from 0 5 to 0 3 of the stem length at the leading edge of the meadow l 0 for hs of 0 6 m to 0 3 m while at the tailing edge of the meadow l 1 the maximum tip displacement changes from 0 35 to 0 20 of the stem length fig 12a the slope of the stem tip displacement decay d x d l increases for larger stem lengths which means that stem deflection decreases along the meadow for larger stems with higher rate than shorter stems for example maximum stem tip displacement along the meadow for hs 0 6 m changes from x c 0 5 corresponding to 0 3 m to x c 0 35 0 2 m while tip displacement changes from x c 0 3 0 1 m to 0 2 0 06 m for hs 0 3 m fig 12a the horizontal and vertical stem tip displacement under the trough x t and z t fig 12b d closely follow the pattern of x c fig 12a c but with smaller values physically the larger velocity under the crest of a regular wave induces more stem displacement generally model results imply that there is less vertical and horizontal displacement relative to stem length for shorter stems as an example fig 12b shows that a 0 3 m high stem tip moves horizontally from x c 0 16 0 05 m at meadow leading edge l 0 to x c 0 1 0 03 m at the tailing edge of the meadow l 1 that is corresponding to 60 reduction in horizontal displacement since the tip displacements occur under a wave cycle 4 s see fig 12 the stem tip motion acceleration is larger for larger stems hs to cover a larger displacement over a wave cycle which can increase the risk of uprooting of seagrass 3 3 forces and drag coefficient along a flexible stem wave effects on stem orientation described in section 3 2 is associated with hydrodynamic forces applied on a stem the parameter set described in section 2 1 is used to investigate the spatial pattern of stem force along the meadow for different stem heights stem displacement and force are a function of fluid velocity within the coupled model the vegetation stem model receives the velocity values from the wave model and calculates the forces that act on each stem segment fig 13 a and b show the forces and fluid velocity along a stem respectively at the point of maximum displacement under wave crest at the leading edge of the meadow l 0 as discussed in section 2 2 the force along a stem is influenced by the competing effect between frontal area and fluid velocity by comparison upper segment velocities of longer stems matter less than of those in lower segments because they hold smaller force values in stem segments as an example for a similar total force applied on a 0 3 m and 0 6 m stem the 0 3 m stem experiences small displacements 0 1 m or x c 0 3 fig 12a and a large force while the 0 6 m stem maximum tip displacement is 0 3 m and a small force the flow velocity throughout the meadow is spatially non uniform see section 3 1 the velocity alteration is due to fluctuations in the vegetation frontal area one of the main strengths of the present model is that it can capture fluctuations in vegetation frontal area and calculate a varying representative cd along the stem fig 13c the bending of the stem under higher fluid velocity at upper segments of each stem causes reduction in the frontal area and therefore produces smaller base forces as can be seen in fig 13b largest velocity is applied on tip portion of 0 5 m stem larger energy dissipation is caused due to vegetation resistance to the motion of the fluid as stem deflection under the wave crest increases the angle of attack increases thereby producing smaller drag coefficient see fig 13c this effect is stronger for long stems model results indicate as intuition suggests that the velocity and the maximum stem base force applied on a stem decay along the meadow fig 14 as seen in fig 14 the spatial pattern of base force along the meadow depends on the length of the stem such that there is a peak in base force roughly at hs 0 4 m 3 4 wave height attenuation we investigate the effect of vegetation stem height hs on wave height attenuation along the meadow fig 15 shows the rate of wave height attenuation defined as δ w a v e h e i g h t h 0 along a meadow for constant and spatially variable vegetation drag coefficient cd and δ 1 at the wave maker to calculate the constant bulk drag cdb gray dotted line in fig 15 we time average the computed drag coefficient over the entire meadow this approach gives a cdb of 1 58 which is consistent with previous studies e g hu et al 2014 lou et al 2018 as expected model results show waves undergo smaller attenuation over the flexible meadow compared to the rigid one compare black and gray dotted lines in fig 15 considering rigid vegetation with constant cdb would result in overestimation of damping by 25 over a 10 m meadow it is noted that the case without vegetation shown with blue dash line in fig 15 shows a small rate of wave decay which is attributable to bed friction model runs suggest that the wave height decays less over shorter stems as it moves onshore fig 15 wave height damping increases over longer stems for the same wave conditions this reduction is nonlinear such that the reduction at the end of the flexible meadow reaches 30 for the longest stems hs 0 6 m while it equals 20 for the shortest stems hs 0 3 m 4 discussion and conclusions this study introduces a new computational wave vegetation interaction model in which a nonhydrostatic wave model based on rans is dynamically coupled with a numerical model that solves the motion of flexible aquatic vegetation stems the vegetation motion is simulated using a model for motion of interconnected pendula representing stem segments or a n pendula model the novelty of the coupled model is in simulating the dynamics of arbitrarily flexible vegetation like seagrasses quantifying forces applied by waves on plants and understanding how high vegetation flexibility affects flow and wave dynamics furthermore the n pendula model readily allows for defining vegetation properties like geometry and stiffness as variables parameters along a stem local definition of these properties is not as straightforward as using euler bernoulli beams e g chen and zou 2019 mattis et al 2019 and thus these properties are generally assumed to be constant along a stem marjoribanks et al 2014 this advantage of the n pendula model enables a more realistic representation of stems in a hydrodynamic model this model computes the vegetative drag coefficient as a spatially and temporally varying term that depends on instantaneous dynamics of stems this drag coefficient is then used in the rans model the coupled model is used to examine the alterations of waves and oscillatory flow field over highly flexible submerged aquatic vegetation and the dynamic response of flexible stems to hydrodynamic forcing the model compares well against experiments of stratigaki et al 2011 for wave height attenuation and measurements of maza et al 2013 for stem orientation the model is also compared with measurements of jacobsen et al 2019 for forces under wave crest and trough for different vegetation mimics to the best of our knowledge this is the first comparison between computational hydrodynamic forces on a stem and laboratory observations without tuning of the vegetation drag coefficient or any other parameter the model compared well with the laboratory data from the ecosystem perspective the flow pattern around a seagrass meadow is important for predicting residence time and transport of sediments larva and nutrients along a meadow the meadow substantially changes the wave averaged velocity profile numerical simulation consistent with earlier observations luhar et al 2010 and numerical studies e g chen and zou 2019 show that a strong current forms at the interface of the meadow and the overlying water the simulations show that this current is weaker more dispersed and penetrates deeper into the meadow vertically in the flexible meadow compared to the rigid one for both flexible and rigid meadows the formation of this current is accompanied by a circulation pattern above the meadow the detailed representation of vegetation dynamics in the coupled model enables examining orientation of stems and the hydrodynamic forces applied on them over a broad range of parameter space formed of water depth wave flow and meadow characteristics here we examined the effect of stem length on its orientation and forces applied on it simulations show that stem deflection increases with its length and that stem deflection regardless of its length consistently decreases along a meadow due to wave damping accurate prediction of stem orientation across a seagrass meadow is critical for estimating light absorption by the plant which is the determining factor in its photosynthesis e g zimmerman 2003 drag force increases as fluid velocity increases which results in an increase in stem deflection and reduction of frontal area in turn the decrease in frontal area reduces the drag force thus the forces applied on a stem and its orientation are determined by the competing effects of fluid velocity and vegetation frontal area simulations showed that with the present parameter range stems lengths of 0 3 0 6 m the largest forces are applied on a stem that is roughly half the water depth 0 4 m the presented computational model can help coastal engineers quantify the role of aquatic vegetation in reducing storm wave energy and mitigating damage to coastal infrastructure without imposing simplifications on wave conditions or flexibility and motion of vegetation stems on the other hand the fluid forces applied on a stem obtained directly from the model can be used to assess the possibility stem breakage vuik et al 2018 or uprooting under energetic storm waves furthermore model outputs on flow and stem orientation can be used as input in biological models for seagrass growth e g zimmerman 2003 to better predict seagrass survival under different flow conditions consequently this model can be a useful tool for restoration of aquatic vegetation meadows as natural or nature based coastal protection credit authorship contribution statement r familkhalili methodology software validation formal analysis investigation data curation writing original draft writing review editing visualization n tahvildari conceptualization methodology software validation formal analysis resources writing original draft writing review editing supervision project administration funding acquisition declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgement this study was supported by the jeffress trust awards program in interdisciplinary research simulations were carried out on the research computing clusters at old dominion university we would like to thank dr niels jacobsen for sharing their experimental results nt also acknowledges support from old dominion university summer faculty fellowship program and batten college of engineering multidisciplinary research seed grant mrsg 
136,in this study we have developed a two way fully coupled hydrodynamic vegetation model that includes a spatially and temporally variable drag coefficient of flexible submerged aquatic vegetation sav the developed model consists of a nonhydrostatic wave model nhwave that solves the navier stokes equations and a numerical model for vegetation stem dynamics that solves the instantaneous forces applied by flow on vegetation stems the results of the developed model are validated against a number of laboratory scale experiments on wave attenuation stem orientation and stem base forces and then applied to an idealized configuration to further investigate the effects of vegetation induced drag coefficient on waves velocity field wave attenuation and vegetation dynamics along a numerical flume the model was able to reproduce experimental results without parameter tuning by adopting the n pendula approach the stem dynamics model solves the instantaneous orientation of segments along each stem and uses this information to compute a spatially and temporally varying vegetative drag coefficient within the meadow when compared with laboratory experiments incorporating this new mechanism for flexible vegetation in the wave model resulted in improvement over results with rigid vegetation through highly detailed representation of vegetation the model can reliably predict wave attenuation over marshes and seagrass meadows evaluate potential storm damages to these features and calculate instantaneous orientation of plant stems or shoots which has implications for their photosynthesis keywords flexible vegetation navier stokes equations drag coefficient wave dissipation vegetation stem forces key points a coupled numerical model is developed to simulate two way interactions between waves and highly flexible vegetation wave attenuation wave induced stem motion and forces at stem bases are validated against experimental results the model enables understanding of wave attenuation over vegetation and wave impacts on vegetation meadows without applying limitation on waves or vegetation dynamics plain language summary submerged aquatic vegetation sav in estuaries and coastal areas can attenuate storm surge and waves vegetation effects on waves and currents are generally modeled as a constant drag coefficient across the meadow this is an oversimplification of vegetation effects as it neglects vegetation stem behavior under hydrodynamic forcing which can affect drag this study provides a better understanding of how savs alter wave amplitude and velocity by developing a coupled wave vegetation interaction model which consists of a nonhydrostatic wave model and a numerical model for vegetation stem dynamics the two models are dynamically coupled meaning that the wave model solves the free surface elevation and depth varying velocity and feeds it to the vegetation model the vegetation model then calculates a vertically variable drag coefficient for a stem and feeds it back to the wave model the vegetation model also calculates stem orientation which are dependent on the forces applied over the stem model results for stem orientation flow forces on stems and wave attenuation compare well with the data simulations suggest that considering a rigid vegetation with simplified drag coefficient would result in substantially larger vegetation induced damping compared to flexible vegetation condition 1 introduction a large percentage of the u s major cities lie close or within estuarine areas that are vulnerable to flooding caused by global environmental changes such as sea level rise e g oppenheimer et al 2019 and increasing strength and frequencies of extreme weather events e g holland and webster 2007 local anthropogenic alterations such as channel deepening and dredging e g familkhalili et al 2020 talke et al 2021 wetland land cover reduction e g sleeter et al 2018 are also impacting people that have settled along estuaries and floodplains aquatic vegetation has increasingly been considered as a natural buffer to reduce wave energy and therefore decrease storm surge and flood damages in estuaries and coastal areas e g john et al 2016 narayan et al 2016 sheng et al 2012 recently more sustainable flood risk management have been proposed that highlight the benefits of aquatic vegetation for flood protection natural habitats such as submerged aquatic vegetation sav in estuaries and coastal areas provide a wide range of ecosystem services such as enhancing water quality e g schulz et al 2003 by absorbing nutrients from water sustaining food and habitat for aquatic life e g nepf 2011 stabilizing seabed sediment and reducing coastal erosion e g möller 2006 nepf 2011 nepf and ghisalberti 2008 and attenuating wave energy e g augustin et al 2009 suzuki et al 2012 maza et al 2013 jadhav et al 2013 generated by storm surges and cyclones e g loder et al 2009 wamsley et al 2010 which helps to minimize flood risk in addition savs can mitigate ocean warming and acidification due to climate change effects e g bergstrom et al 2019 previous studies have investigated the attenuation of waves due to vegetation based on linear wave theory e g dalrymple et al 1984 kobayashi et al 1993 mendez and losada 2004 experimentally e g stratigaki et al 2011 anderson and smith 2014 hu et al 2014 john et al 2016 and numerically e g maza et al 2013 zhu and chen 2015 however there are limitations in predicting wave attenuation over vegetation some of which stem from inadequate representation of vegetation flexibility and motion in numerical models therefore it is important to improve models that simulate sav dynamics in wave models to better predict flow dynamics over meadows vegetation effect on storm surge and wave reduction is generally parameterized in hydrodynamic models as a constant darcy weisbach friction factor the manning n value or the chezy coefficient that is typically larger than that for mud and or fine sand n 0 02 s m 1 3 e g wamsley et al 2010 orton et al 2015 this coefficient is typically averaged over time and assumed to be constant across the meadow and over meadow height e g rooijen et al 2020 however vegetation motion is spatially variable over a meadow as a function of hydrodynamics and also affects the flow field for example the complex structure and motion of savs can significantly reduce the mean flow and alter turbulent mixing e g järvelä 2005 nepf 2011 nepf and vivoni 2000 in turn changes in hydrodynamics affect forces on vegetation stems and their motion the sav dynamic motion causes drag reduction e g maza et al 2015 abdolahpour et al 2017 as relative velocity of vegetation and flow and active vegetation frontal area decrease when vegetation stems reconfigure under wave fluctuations thus considering vegetation as additional bottom roughness cannot realistically represent its effect on flow through vegetation as it neglects the interactions between vegetation stem structure and flow which is inherently a two way process moreover treating vegetation as bottom roughness typically requires calibrating the friction coefficient based on observations to obtain a reasonable prediction of the variable of interest e g wave height due to motion of vegetation stems which affects its resistance against the flow a constant drag coefficient cannot rigorously represent the true vegetative drag force that causes wave attenuation some recent studies have developed models to solve the dynamics of stem structure under hydrodynamic forces abdelrhman 2007 modeled a seagrass blade as a series of interconnected rectangular segments in a steady flow and solved the force balance equation to determine the steady state position of the blade the rigidity of a blade was not considered in the study zeller et al 2014 used the same equations for lift drag and skin friction forces as abdelrhman 2007 but assumed that joints between segments were equipped with torsion springs that represented blade rigidity luhar and nepf 2016 also developed a numerical model for motion of highly flexible vegetation but used the well known morison force formulation numerical models have recently been developed to investigate wave vegetation interactions by analyzing nonlinear wave transformation velocity field changes and vegetation interactions with currents e g ma et al 2013 maza et al 2013 generally numerical studies of sav have modeled vegetation as rigid e g neary 2003 cui and neary 2008 or semi flexible elements e g maza et al 2013 zhu and chen 2015 which apply some simplifications on vegetation motion for example maza et al 2013 assume that vegetation stems deform linearly under flow action or zhu and chen 2015 model is applicable to small stem deflection where vertical motion of stem is negligible thus these models are not valid for highly flexible vegetation that can undergo large deflections under realistic wave and current forcing a few recent studies have developed models for flexible vegetation using cantilever beams capable of large deflections e g mattis et al 2019 chen and zou 2019 tahvildari 2017 zeller et al 2014 in this study we investigate the effects of highly flexible vegetation on wave attenuation along the meadow by developing a two way coupled hydrodynamic vegetation model the vegetation model is based on zeller et al 2014 and thus is capable of solving stem dynamics under large deflections the flow model is the reynolds averaged navier stokes rans model nhwave ma et al 2012 2013 the developed model enables quantifying wave attenuation and flow field over highly flexible vegetation meadows predicting instantaneous vegetation motion and calculating forces within stems the stem dynamics model derives horizontally and vertically varying drag coefficients that is used in the nhwave model the coupled model is verified with the data on wave attenuation stratigaki et al 2011 stem orientation maza et al 2013 and forces within stems jacobsen et al 2019 to our knowledge this is the first comparison between computational forces within vegetation elements and experimental values this study improves our understanding of two way interactions between flow and vegetation as no limitation is applied on waves or vegetation dynamics the model presented in this study can inform coastal engineers and scientists on how vegetation protects the upland infrastructure from storm wave action and how storms can potentially damage vegetation meadows thus improve wetland or sav restoration efforts 2 model development 2 1 seagrass meadow geometry a flexible seagrass submerged meadow is assumed to be 10 m long lm with population density ns of 400 stems m2 representing a medium density meadow the model domain length l and depth h are set to 400 m and 0 8 m respectively with horizontally uniform computational grid of 0 05 m and 16 equal vertical layers the seagrass meadow length is much larger than water depth h 0 8 m and thus ensure fully developed meadow flow conditions see fig 1 the meadow starts at x 60 m normalized length of l 0 that provides enough length before the meadow for surface waves stabilization such that the wave field is fully developed and reaches the steady state condition the frontal width bs of an individual seagrass stem is assumed to be 0 01 m with thickness of 1 mm we model 4 stem lengths hs of 0 3 0 4 0 5 and 0 6 m the simulation period is 60 s with 30 s startup to allow stability i e total of 90 s the computational time step is adjusted during the simulation with the courant number of 0 5 2 2 wave model the nonhydrostatic wave model nhwave ma et al 2013 which solves the three dimensional current and wave field is modified to include the effect of spatially variable and time dependent vegetation drag coefficient cd the nhwave model solves the rans equations 1 u i x i 0 2 u i t u j u i x j 1 ρ w p x i g i τ i j x j f v i where xi is the cartesian coordinate ui u v w that are the velocity components in x y z coordinates respectively ρ w is water density p is total pressure τ ij is the stress tensor that includes viscosity and turbulence effects g is the gravitational force and f v i is a drag term that accounts for the interaction between flow and flexible vegetation elements and is defined in eq 5 within the meadow a volume averaging scheme ma et al 2013 and an ad hoc drag term are used to consider the void fraction which is required to account for the spatial heterogeneity of velocity field at the stem scale ma et al 2013 nepf and ghisalberti 2008 the turbulence effects represented by τ ij are calculated using the nonlinear k ε equations implemented in nhwave with a practical kinematic eddy viscosity of υ t c μ k 2 ε where k is the turbulent energy ε is the turbulent dissipation rate and c μ 0 09 is the empirical turbulence model constant the conservation form of the nonlinear k ε equations which considers the effects of vegetation are 3 dk t duk d υ υ t σ k k d p s c fk p v ε 4 d ε t du ε d υ υ t σ ε ε ε k d c 1 ε p s c f ε p v c 2 ε ε with empirical coefficients of σ k 1 0 σε 1 3 c 1ε 1 44 c 2ε 1 92 see ma et al 2013 and calibrated coefficients of c f 0 16 and cfk 0 07 based on shimizu and tsujimoto 1994 experimental turbulence measurements in which they found that these values would produce a good agreement between the measured and calculated mean velocity profiles ps and pv are the shear production and turbulence production due to vegetation respectively these coefficients are not modified in our study however we do not claim that there are optimal values recommended for all studies users of the model should conduct studies to select the most appropriate values for their applications it is noted that nhwave does not consider the contribution of dispersive stresses this was assumed by the original authors of nhwave based on a remark by ayotte et al 1999 that dispersive stresses would be negligible compared with reynolds stresses however ayotte et al 1999 did not back their assumption with actual data more recent laboratory data e g poggi and katul 2008 ricardo et al 2016 maji et al 2020 and large eddy numerical simulations ricardo et al 2018 have shown for rigid cylinders that dispersive stresses can be of the order of magnitude of reynolds stresses including dispersive stresses in nhwave is out of the scope of this work and can be the subject of future studies the governing equations are discretized using combined finite volume and finite difference approach with a second order godunov scheme see ma et al 2013 for details and are solved with boundary conditions of zero pressure at the free surface at z h bottom friction at z 0 influx of incoming wave at x 0 and free slip impermeable walls as lateral boundary conditions which impose zero normal velocity and tangential stress in y direction at these boundaries fig 1 the new drag term f v i is defined as 5 f v i 1 2 c d i b s n c u i u i where bs is vegetation frontal stem width m nc is vegetation population density stems m2 and u i is relative velocity between vegetation stem and the fluid c d i is the spatially and temporally varying dimensionless drag coefficient and is given by 6 c d i 2 ψ i ρ w d v b s n c where dv is segment volume i e dv dx dy dz and ψ i is a term calculated for each segment of each stem and thus varies as a function of velocity along the meadow as well as in vertical direction ψ i is given by 7 ψ i f t i u i u i where f t i is the drag force per unit volume it is noted that this drag force is the summation of form drag and skin friction see table 1 2 3 vegetation stem dynamics model the aim of simulating dynamics of vegetation stems is to compute c d i as a function of space both horizontal and vertical and time by solving the flow forces applied on each vegetation stem flexible stems present a complex behavior under wave action as they reorganize in response to velocity changes thus unlike rigid elements flexible vegetation applies an altered drag force on the flow at each time step in addition there is a competing effect between the flow velocity u and vegetation frontal area av that alters the drag force as flexible stems have less flow resistance when fluid velocity increases larger u that leads to smaller av and thus may increase or decrease drag force values see eqs 5 7 the developed vegetation model considers the instantaneous orientation of a flexible stem and is developed following zeller et al 2014 in which a stem is modeled as a series of rectangular segments n pendula which are connected at joints by torsion springs and rotary dashpots dividing up each blade into an arbitrary number of segments n allows us to simulate strong deflection of blades under combined wave conditions this model accounts for vertical variability of flow velocity and seagrass stem motion by assuming a spring mass model which incorporates a comprehensive set of forces applied on a stem gravity buoyancy friction lift inertial and most importantly drag at each time step the model takes velocity values for each blade segment and computes the local curvature of stem segments θ and finally calculates the forces that act on that segment i e drag lift skin friction and inertia see table 2 table 1 subscript n refers to the nth blade segment e x and e z are unit vectors wn bn and ln are the width thickness and length of the blade segment respectively c d n c l n cf and c a n are the drag lift friction and added mass coefficients of each blade segment un and u n are the fluid velocity and acceleration at the segment center while x n and x n are the velocity and acceleration of the center of blade segment θ a n is the angle of attack i e the angle between un and x n and θ n is the angle between segment n and the vertical direction in this approach the full force balance equations namely equations for conservation of momentum and conservation of angular momentum are written and rearranged as follows 8 d θ n d t a n j s j 9 d θ n d t θ n where n 1 2 n and subscript j is the counter for time steps anj and sj are nonlinear functions of θ this system of implicit equations is solved using matlab s ode45 and ode1s functions zeller et al 2014 once the angle θ is solved the total drag ft which is the summation of skin friction fs caused by shear stress due to the viscous interaction between the fluid and stem surface and pressure drag fd are calculated and incorporated in eqs 6 7 to solve for c d i 2 4 coupled wave vegetation model the coupling between hydrodynamic and vegetation models is achieved through a stepwise exchange of velocity fields of waves and current from nhwave to the vegetation model and vegetation drag coefficient calculated by vegetation model to nhwave in this section we describe the steps towards a fully two way coupled modeling system composed of these two models our work focuses on wave and current alterations due to vegetation induced drag which is temporally and spatially variable in each step ti of the coupling approach velocity field computed by the hydrodynamic model is extracted and analyzed to find the velocity corresponding to each segment of vegetation stems the model considers σ coordinate system i e variable layer thicknesses so that the velocity values fed to the vegetation model reflect stem motion and σ coordinate system at each time step the model uses a special type of staggered grid where velocities are defined at cell centers while pressures are defined at the vertically facing cell boundaries fig 2 shows the coupled modeling framework used in this study 2 5 numerical model validation in this section the sensitivity of the developed coupled wave vegetation model to grid size is studied and then the model is validated against available experimental results on wave height attenuation by stratigaki et al 2011 an important capability of the presented model is detailed calculation of vegetation stem excursion as well as forces applied on vegetation stems these two aspects of the model are validated by comparing simulated vegetation stem excursion with results from laboratory experiments of maza et al 2013 and simulated forces with those measured at the base of a vegetation stem in laboratory experiment of jacobsen et al 2019 2 5 1 model convergence generally the numerical model results should converge to a certain value and thus further reductions in grid size should not change the model results the model convergence associated with the vertical discretization in the σ coordinate system has previously been studied by ma et al 2012 in this section we examine the convergence of the coupled wave vegetation interaction model with respect to the grid size in horizontal direction we consider different grid spacing of δ x n where δx 0 10 m and n 1 2 4 and 8 for a case with constant depth of 0 8 m and length of 400 m vegetation height of 0 3 m and linear wave with amplitude of 0 2 m and period of 4 s the computational time step is adjusted automatically during the simulation such that the courant number is 0 5 in all the cases fig 3 shows the convergence with grid refinement as demonstrated by the root mean square rms of the differences in surface wave height over the entire domain between runs with different resolutions and the base case of δx 0 0125 m as seen the rms of wave heights is only 1 9 mm less than 1 over the meadow for the coarsest grid and decreases with grid size following eça and hoekstra 2014 we calculated the grid convergence ratio to be 0 22 which corresponds to monotonic convergence type 2 5 2 wave height attenuation in what concerns wave height attenuation we validate our wave vegetation modeling system against several idealized experimental results performed by stratigaki et al 2011 the experiments were carried out in a 100 m by 3 m flume with artificial vegetation from l 38 36 m to 49 06 m lm 10 7 m long vegetation meadow that provides enough length for waves to fully develop and stabilize before reaching the meadow the vegetation stems made from four pvc strips two 45 cm and two 27 5 cm long we simplify model simulation by considering a single stem vegetation this assumption is justified as there is no binding between the four stems in the experiments enabling them to move independently fig 4 shows the modeled and experimental measurements of spatial wave height h 0 evolution along the meadow for three different configurations as shown there is a good agreement between the modeled and measured values in all cases with root mean square error rmse of 0 02 0 02 and 0 04 m the scatter in experiment increases for higher wave and larger depth resulting in a slightly higher rmse fig 4c the simulated wave height for cases without vegetation are presented by black dashed lines showing negligible changes 2 5 3 flexible vegetation stem excursion understanding vegetation motion under fluid forces is important for quantifying drag forces and predicting seagrass light absorption and growth e g zimmerman 2003 here we validate model performance by comparing the modeled vegetation stem excursion with experimental results reported by maza et al 2013 in these simulations b s 0 01 m stem width hs 0 45 m stem length lm 0 2 m meadow length h 0 0 2 m wave height t 4 s wave period and h 0 8 m water depth to be consistent with the parameters used in the experiments we set up the simulations following the experimental set up where five vegetation clusters at 5 cm spacing were placed in the flume to capture the plant shadowing effect fig 5 presents the maximum plant excursion for a regular wave height with the above specifications each gray curve corresponds to maximum onshore and offshore movement of the five stems along the meadow and the black dash lines show the observed maximum displacements by maza et al 2013 larger excursion of vegetation stems under wave crest 0 6x where x is the horizontal normalized by the stem length hs than under trough 0 35x implies that the vegetation motion is not symmetric relative to the vertical axis that is relative to the regular wave condition 2 5 4 force distribution along a flexible stem the model result for instantaneous forces along stems is compared with the data from jacobsen et al 2019 experiments table 2 and table 3 jacobsen et al 2019 studied the forces and the motion of a single flexible stem with lengths of 0 15 m and 0 30 m and rectangular cross section under waves to determine non dimensional parameters and predict the stem motion and shape and forces along a stem forces at the base of stems were measured in laboratory experiments which was the bases for estimation of external loading along the stem to reproduce jacobsen et al 2019 experimental results we study the forces along three types of vegetation table 2 under three wave conditions table 3 table 2 represents the vegetation stems properties where bs δ and hs are stem width thickness and height respectively ρ s is density and e represents the young s modulus a total of three wave conditions are chosen table 3 where h 0 is the regular wave height at the paddle in the wave flume and t is the wave period the water depth at the paddle is set to 0 65 m and the wave flume depth is 0 45 m table 3 shows the target wave conditions h 0 and t and the observed wave conditions h 0 η t η c in jacobsen et al 2019 and the simulated conditions h m η m t η m c in this study the subscript m represents the modeled values and η c and η t are the average crest and trough elevations respectively fig 6 shows modeled and measured force values at the base of vegetation stems for stem lengths hs of 0 15 m and 0 30 m considering wave boundary conditions to be identical to the experiments see table 3 the modeled forces for type i fig 6a and iii fig 6c vegetation follow the 1 1 and 1 2 lines consistent with experimental values the modeled forces scale linearly with hs for type ii while the measured values show a transition from 1 1 to 1 2 fig 6b as suggested by jacobsen et al 2019 this transition could be explained by changes in exposed length of the deflected stem that might be due to small rigidity of type ii compared to type i and iii by o 10 2 and is a process that could not be simulated with the model 3 results the developed model enables studying wave vegetation interaction over a wide range of parameters formed by vegetation characteristics e g stem length density rigidity wave properties frequency amplitude and water depth we employ the validated model to study the effects of vegetation characteristics namely stem length 0 3 0 6 m on vegetation stems motion force wave height attenuation and velocity profile over a meadow as an example first the effect of flexible vegetation induced drag coefficient on wave velocity field and stem orientation are examined then the special patterns of stem force along the stem and meadow are presented and finally wave height attenuation due to flexible vegetation is investigated 3 1 vegetation effects on wave velocity profile the vegetation drag applied to the flow reduces the flow within the meadow and therefore increases residence time within the meadow compared to the overlying water furthermore the vertical variability in the flow affects the bending angle of seagrass which in result can alter the drag coefficient the effect of meadow presence through constant bulk drag coefficient for rigid vegetation cdb and variable drag coefficient for flexible vegetation cd x z t on wave averaged velocity are presented in fig 7 l represents the normalized coordinate system l l m where l 0 is the leading edge of the meadow and h is normalized water depth z h s mean flow velocities offshore of meadow l 0 are nearly zero to slightly negative magnitudes at surface h 1 5 that indicates offshore directed flow similarly onshore of the meadow i e landward l 1 mean flow velocities are near zero and present throughout the water column except near the surface h 1 5 see fig 7a within the rigid meadow l 0 1 fig 7a mean flow velocity is relatively high near the top of the meadow i e h 1 in landward direction while the values above the meadow h 1 are negative implying offshore directed flows this observation is consistent with previous studies e g rooijen et al 2020 fig 7 also illustrates the difference in distribution of wave averaged velocity around and mostly above the meadow the velocity within the rigid meadow is distinctively reduced compared to the flow outside the meadow and the maximum velocity is concentrated at the intersection of the meadow and the overlying water in contrast the flow within the flexible meadow is comparable to that outside of the meadow and the maximum value around the interface of the meadow and the unblocked flow is smaller than the velocity observed at the same elevation over the rigid meadow over the meadow l 0 1 the wave averaged velocity is higher for flexible vegetation fig 7b than that of rigid vegetation fig 7a the maximum stem excursion occurs at the point of highest velocity furthermore due to stem reconfiguration high velocities penetrate further down into the meadow compared to the rigid meadow this observation is consistent with earlier studies e g rooijen et al 2020 to have a closer look at wave averaged velocity values fig 8 shows the profile of wave averaged streamwise velocity u at five different locations along the numerical flume specifically l 1 0 0 5 1 and 2 for three configurations in the absence of a meadow a meadow with rigid vegetation and one with flexible vegetation along the normalized depth h the horizontal black dash line in fig 8 shows the height of vegetation hs 0 5 m or h 1 clearly the vegetation meadow changes the vertical distribution of wave velocities as there is not much of change before l 1 fig 8a and after l 2 fig 8e the meadow between the model runs which confirms that changes mostly happen in the meadow due to the effects of vegetation drag there is a localized peak in velocity profile u near above the meadow in flexible vegetation condition light gray line which is consistent along the meadow see fig 8 while it is larger for the rigid vegetation condition see gray lines in fig 8 spatial distributions of the root mean square of the simulated velocity i e u r m s 1 n i 1 n u i 2 around a rigid and flexible meadow are presented in fig 9 averaging the values within the meadow implies 20 increase for flexible condition the peak values occur near the top of meadow h 1 shown by horizontal black dash line the difference between the values of urms for rigid and flexible vegetation configurations increases along the meadow confirming that larger velocity values are applied over the stem in a flexible meadow see fig 10 fig 10 illustrates wave averaged urms profile for five sections along the modeled flume for all sections along the meadow in meadow root mean square and wave averaged velocity are larger for flexible vegetation compared to rigid vegetation larger u occurs near the top of flexible meadow that is in accordance with the range of stem heights at maximum deflection where the shear is strongest see also fig 11 a 3 2 flexible stem motion the vegetation stem motion influences the flow structure thus determining accurate instantaneous configuration of stems is necessary to resolve flow vegetation interactions model results suggest that as expected there is a strong dependency between the deflection of vegetation stems and wave amplitude see fig 11 since our model can obtain the instantaneous position of stem segments under a wave we calculate vegetation induced drag for each configuration of each stem segment and thus input corresponding drag into the wave model for the maximum deflection toward wave direction the vegetation stem frontal area decreases and therefore the drag coefficient decreases on the other hand the vegetation stem fluctuates under the wave motion and as it reaches the maximum deflection the relative velocities significantly increase and that in result would produce large vegetation drag coefficient and turbulence therefore vegetative drag is a result of these competing effects the influence of stem height hs on stem orientation along the x and z direction is tested by modeling a set of vegetation meadows with heights ranging from 0 3 m to 0 6 m increasing the stem height produces a larger horizontal stem tip displacement under the wave crest x c and trough x t fig 12 a and b than in vertical direction z c and z t fig 12c and d note that the displacements plotted in fig 12 are absolute values of maximum stem tip positions x and z and are made non dimensional by dividing to the length of stem hs 0 3 0 4 0 5 0 6 m physically the longer stem produces larger frontal area which attenuates more fluid forces resulting in stronger shadowing effect this reduces stem deflection further into the meadow the velocity reduction within the meadow causes a decrease in the forces on vegetation stems the maximum tip displacement under the crest fig 12a changes from 0 5 to 0 3 of the stem length at the leading edge of the meadow l 0 for hs of 0 6 m to 0 3 m while at the tailing edge of the meadow l 1 the maximum tip displacement changes from 0 35 to 0 20 of the stem length fig 12a the slope of the stem tip displacement decay d x d l increases for larger stem lengths which means that stem deflection decreases along the meadow for larger stems with higher rate than shorter stems for example maximum stem tip displacement along the meadow for hs 0 6 m changes from x c 0 5 corresponding to 0 3 m to x c 0 35 0 2 m while tip displacement changes from x c 0 3 0 1 m to 0 2 0 06 m for hs 0 3 m fig 12a the horizontal and vertical stem tip displacement under the trough x t and z t fig 12b d closely follow the pattern of x c fig 12a c but with smaller values physically the larger velocity under the crest of a regular wave induces more stem displacement generally model results imply that there is less vertical and horizontal displacement relative to stem length for shorter stems as an example fig 12b shows that a 0 3 m high stem tip moves horizontally from x c 0 16 0 05 m at meadow leading edge l 0 to x c 0 1 0 03 m at the tailing edge of the meadow l 1 that is corresponding to 60 reduction in horizontal displacement since the tip displacements occur under a wave cycle 4 s see fig 12 the stem tip motion acceleration is larger for larger stems hs to cover a larger displacement over a wave cycle which can increase the risk of uprooting of seagrass 3 3 forces and drag coefficient along a flexible stem wave effects on stem orientation described in section 3 2 is associated with hydrodynamic forces applied on a stem the parameter set described in section 2 1 is used to investigate the spatial pattern of stem force along the meadow for different stem heights stem displacement and force are a function of fluid velocity within the coupled model the vegetation stem model receives the velocity values from the wave model and calculates the forces that act on each stem segment fig 13 a and b show the forces and fluid velocity along a stem respectively at the point of maximum displacement under wave crest at the leading edge of the meadow l 0 as discussed in section 2 2 the force along a stem is influenced by the competing effect between frontal area and fluid velocity by comparison upper segment velocities of longer stems matter less than of those in lower segments because they hold smaller force values in stem segments as an example for a similar total force applied on a 0 3 m and 0 6 m stem the 0 3 m stem experiences small displacements 0 1 m or x c 0 3 fig 12a and a large force while the 0 6 m stem maximum tip displacement is 0 3 m and a small force the flow velocity throughout the meadow is spatially non uniform see section 3 1 the velocity alteration is due to fluctuations in the vegetation frontal area one of the main strengths of the present model is that it can capture fluctuations in vegetation frontal area and calculate a varying representative cd along the stem fig 13c the bending of the stem under higher fluid velocity at upper segments of each stem causes reduction in the frontal area and therefore produces smaller base forces as can be seen in fig 13b largest velocity is applied on tip portion of 0 5 m stem larger energy dissipation is caused due to vegetation resistance to the motion of the fluid as stem deflection under the wave crest increases the angle of attack increases thereby producing smaller drag coefficient see fig 13c this effect is stronger for long stems model results indicate as intuition suggests that the velocity and the maximum stem base force applied on a stem decay along the meadow fig 14 as seen in fig 14 the spatial pattern of base force along the meadow depends on the length of the stem such that there is a peak in base force roughly at hs 0 4 m 3 4 wave height attenuation we investigate the effect of vegetation stem height hs on wave height attenuation along the meadow fig 15 shows the rate of wave height attenuation defined as δ w a v e h e i g h t h 0 along a meadow for constant and spatially variable vegetation drag coefficient cd and δ 1 at the wave maker to calculate the constant bulk drag cdb gray dotted line in fig 15 we time average the computed drag coefficient over the entire meadow this approach gives a cdb of 1 58 which is consistent with previous studies e g hu et al 2014 lou et al 2018 as expected model results show waves undergo smaller attenuation over the flexible meadow compared to the rigid one compare black and gray dotted lines in fig 15 considering rigid vegetation with constant cdb would result in overestimation of damping by 25 over a 10 m meadow it is noted that the case without vegetation shown with blue dash line in fig 15 shows a small rate of wave decay which is attributable to bed friction model runs suggest that the wave height decays less over shorter stems as it moves onshore fig 15 wave height damping increases over longer stems for the same wave conditions this reduction is nonlinear such that the reduction at the end of the flexible meadow reaches 30 for the longest stems hs 0 6 m while it equals 20 for the shortest stems hs 0 3 m 4 discussion and conclusions this study introduces a new computational wave vegetation interaction model in which a nonhydrostatic wave model based on rans is dynamically coupled with a numerical model that solves the motion of flexible aquatic vegetation stems the vegetation motion is simulated using a model for motion of interconnected pendula representing stem segments or a n pendula model the novelty of the coupled model is in simulating the dynamics of arbitrarily flexible vegetation like seagrasses quantifying forces applied by waves on plants and understanding how high vegetation flexibility affects flow and wave dynamics furthermore the n pendula model readily allows for defining vegetation properties like geometry and stiffness as variables parameters along a stem local definition of these properties is not as straightforward as using euler bernoulli beams e g chen and zou 2019 mattis et al 2019 and thus these properties are generally assumed to be constant along a stem marjoribanks et al 2014 this advantage of the n pendula model enables a more realistic representation of stems in a hydrodynamic model this model computes the vegetative drag coefficient as a spatially and temporally varying term that depends on instantaneous dynamics of stems this drag coefficient is then used in the rans model the coupled model is used to examine the alterations of waves and oscillatory flow field over highly flexible submerged aquatic vegetation and the dynamic response of flexible stems to hydrodynamic forcing the model compares well against experiments of stratigaki et al 2011 for wave height attenuation and measurements of maza et al 2013 for stem orientation the model is also compared with measurements of jacobsen et al 2019 for forces under wave crest and trough for different vegetation mimics to the best of our knowledge this is the first comparison between computational hydrodynamic forces on a stem and laboratory observations without tuning of the vegetation drag coefficient or any other parameter the model compared well with the laboratory data from the ecosystem perspective the flow pattern around a seagrass meadow is important for predicting residence time and transport of sediments larva and nutrients along a meadow the meadow substantially changes the wave averaged velocity profile numerical simulation consistent with earlier observations luhar et al 2010 and numerical studies e g chen and zou 2019 show that a strong current forms at the interface of the meadow and the overlying water the simulations show that this current is weaker more dispersed and penetrates deeper into the meadow vertically in the flexible meadow compared to the rigid one for both flexible and rigid meadows the formation of this current is accompanied by a circulation pattern above the meadow the detailed representation of vegetation dynamics in the coupled model enables examining orientation of stems and the hydrodynamic forces applied on them over a broad range of parameter space formed of water depth wave flow and meadow characteristics here we examined the effect of stem length on its orientation and forces applied on it simulations show that stem deflection increases with its length and that stem deflection regardless of its length consistently decreases along a meadow due to wave damping accurate prediction of stem orientation across a seagrass meadow is critical for estimating light absorption by the plant which is the determining factor in its photosynthesis e g zimmerman 2003 drag force increases as fluid velocity increases which results in an increase in stem deflection and reduction of frontal area in turn the decrease in frontal area reduces the drag force thus the forces applied on a stem and its orientation are determined by the competing effects of fluid velocity and vegetation frontal area simulations showed that with the present parameter range stems lengths of 0 3 0 6 m the largest forces are applied on a stem that is roughly half the water depth 0 4 m the presented computational model can help coastal engineers quantify the role of aquatic vegetation in reducing storm wave energy and mitigating damage to coastal infrastructure without imposing simplifications on wave conditions or flexibility and motion of vegetation stems on the other hand the fluid forces applied on a stem obtained directly from the model can be used to assess the possibility stem breakage vuik et al 2018 or uprooting under energetic storm waves furthermore model outputs on flow and stem orientation can be used as input in biological models for seagrass growth e g zimmerman 2003 to better predict seagrass survival under different flow conditions consequently this model can be a useful tool for restoration of aquatic vegetation meadows as natural or nature based coastal protection credit authorship contribution statement r familkhalili methodology software validation formal analysis investigation data curation writing original draft writing review editing visualization n tahvildari conceptualization methodology software validation formal analysis resources writing original draft writing review editing supervision project administration funding acquisition declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgement this study was supported by the jeffress trust awards program in interdisciplinary research simulations were carried out on the research computing clusters at old dominion university we would like to thank dr niels jacobsen for sharing their experimental results nt also acknowledges support from old dominion university summer faculty fellowship program and batten college of engineering multidisciplinary research seed grant mrsg 
137,surface wettability is one of the major factors that regulate immiscible fluid displacement in porous media however the role of pore scale wettability heterogeneity on dynamic immiscible displacement is rarely investigated this study investigated the impact of pore scale wettability heterogeneity on immiscible two fluid displacement and the resulting macroscopic constitutive relations including the capillary pressure water saturation p c s w and relative permeability curves a digital bentheimer sandstone model was obtained from x ray micro computed tomography micro ct scanning and the rock surface wettability fields were generated based on in situ measurements of contact angles a graphics processing unit accelerated lattice boltzmann model was employed to simulate the immiscible displacement processes through the primary drainage imbibition and second drainage stages in a co2 water rock system we found that pore scale surface wettability heterogeneity caused noticeable local supercritical co2 scco2 and water redistribution under less water wet conditions at the continuum scale the p c s w curves under the heterogeneous wetting condition were overall similar to those under the homogeneous wetting condition this is because the impact of local wettability heterogeneity on the large scale pc sw curve was statistically averaged out at the entire sample scale the only difference was that heterogeneous wettability led to a negative entry pressure at the primary drainage stage under the intermediate wet condition which was caused by local scco2 wet surfaces the impact of pore scale wettability heterogeneity was more noticeable on the relative permeability curves particularly the variation of the scco2 relative permeability curve in the heterogeneous wettability scenario was more significant than that in the homogenous wettability scenario this suggests that pore scale wettability heterogeneity enhances the coalescence and snap off behaviors of scco2 blobs this is the first study that systematically investigated the role of pore scale wettability heterogeneity on dynamic immiscible displacement and associated p c s w curves in complicated three dimensional porous media key words geological co2 sequestration immiscible displacement wettability heterogeneity pc sw curve relative permeability nomenclature c color gradient c lattice speed cy correlation function e q lattice velocity vector in the q direction f particle distribution function fq particle distribution function in the q direction g mass distributions for the wetting fluid or non wetting fluid ji fluid momentum in the i direction krg scco2 relative permeability k r g o end point relative permeability of scco2 krw water relative permeability k r w o end point relative permeability of water li correlation lengths in the i direction m moments of particle distribution functions mi moments in the i direction m i e q equilibrium moments in the i direction m transform matrix m 1 inverse of transform matrixm n unit normal vector of the color gradient ni component of unit normal vector of the color gradient in the i direction ng non wetting phase exponent in the corey model nw wetting phase exponent in the corey model q directions in the d3q9 lattice space sgrw residual saturation of non wetting phase sw wetting phase saturation s w normalized wetting phase saturation swir irreducible saturation of wetting phase t time δt time step u fluid velocity wq weights for the d3q7 lattice model x location xi coordinate of location x in the i direction y field of logarithm of ca y location yi coordinate of location y in the i direction α parameter linearly related to the interfacial tension β parameter that controls the width of the interface λ relaxation coefficient λ eigenvalue of correlation function μ y mean of logarithm of contact angle μθ mean of contact angle θ contact angle ρ nw fluid density of non wetting phase ρ w fluid density of wetting phase σ y standard deviation of logarithm of contact angle σθ standard deviation of contact angle ξ n independent zero meaned gaussian random variables with unit variance ψ eigenfunction of correlation function 1 introduction mitigation of the global climate change has become an urgent and pressing challenge of our time the 2015 paris agreement aimed to keep the global average temperature increase within 2 c compared to pre industrial period and to achieve net zero emissions ultimately ipcc 2018 hassanpouryouzband et al 2021 geological carbon sequestration gcs has proven a viable solution to mitigating co2 emissions while allowing continued large scale consumptions of fossil fuel energy michael et al 2010 y q tang et al 2019 subsurface saline aquifers have been considered ideal geological formations for gcs due to their extensive distribution and vast storage capacity which was estimated to be 320 10 000 gigatons of co2 across the world bachu 2002 after the emplacement of co2 in a deep saline aquifer the co2 exists in the supercritical phase if the temperature is higher than 31 c and pressure is higher than 1000 psi chen et al 2013 the supercritical co2 scco2 migrates upward due to buoyancy and then spreads horizontally when it reaches the impermeable cap rock sathaye et al 2014 emami meybodi et al 2015 guo et al 2021 it is critical to understand and predict the migration of scco2 in saline aquifers to ensure the long term security of gcs chang et al 2020 the migration of injected scco2 in saline aquifers can be modeled as an immiscible displacement process which is regulated by the pore geometry fluid properties and rock surface wettability tanino and blunt 2013 the surface wettability of a porous medium is usually characterized as the static contact angle ca the distribution of which on rock surfaces can be homogeneous or heterogeneous in general water is referred to as the wetting phase fluid because its ca is usually smaller than 90 whereas another fluid e g scco2 or oil is referred to as the nonwetting phase fluid fan et al 2019 the impact of homogeneous wettability on multiphase flow in porous media has been intensively studied pan et al 2004 li et al 2005 boek et al 2017 leclaire et al 2017 y q tang et al 2019 bakhshian et al 2021 however studies on rock samples strongly suggested that the surface wettability in a natural rock is heterogeneous morrow 1975 bradford and leij 1995 hwang et al 2006 rucker et al 2019 arshadi et al 2020 guo et al 2020 previous studies usually modeled heterogeneous surface wettability as a mixture of two types of surfaces with one being water wet and the other being oil wet the heterogeneous surface wettability model can be further classified as fractional wettability and mixed wettability depending on whether the distribution of surface wettability is a function of pore size a fractional wettability model assumes that the distribution of wetting surfaces is independent of the pore size whereas a mixed wettability model assumes that rock surfaces in small pores are water wet and rock surfaces in large pores are oil wet valvatne and blunt 2004 skauge et al 2007 the overall wettability of a porous medium is usually modified by changing the ratio between the wetting and non wetting surfaces for a fractional wettability model and the extent of surface property alteration for a mixed wettability model zhao et al 2018 chang et al 2020 recently published studies on in situ measurements of surface wettability suggested that the surface wettability of a natural rock can cover a wide range of cas rather than only two cas saraji et al 2013 andrew et al 2014 alhammadi et al 2017 mutailipu et al 2017 alratrout et al 2018 arshadi et al 2020 guo et al 2020 liu et al 2020 our previous work guo et al 2020 modeled the heterogeneous surface wettability in a sandstone sample as a gaussian random field with a spatial correlation length based on in situ ca measurements using x ray micro computed tomography micro ct to adequately leverage the power of pore scale numerical simulation of multiphase flow in porous media it is critical to accurately describe and incorporate the detailed surface wettability information into the model akai et al 2019 constitutive relations such as the capillary pressure water saturation pc sw relationship and relative permeability are critical inputs for continuum scale simulations of multiphase flow in porous media the role of pore scale wettability heterogeneity on the macroscopic constitutive relations has attracted significant attention previous studies have intensively investigated the displacement mechanisms under different wetting conditions zhao et al 2016 hu et al 2017 and the effect of surface wettability on capillary pressure and relative permeability hwang et al 2006 landry et al 2014 zhao et al 2018 bakhshian and hosseini 2019 chang et al 2020 nemer et al 2020 in the studies on fractional wettability the physical model for fractional wet porous media were constructed by mixing sands having different wettability bradford and leij 1995 hwang et al 2006 mixing beads having designed wettability murison et al 2014 hiller et al 2019 and mapping surface wettability fields to digital rock models bakhshian and hosseini 2019 it was observed that an increasing fraction of non wetting surface led to increasing wetting phase relative permeability and decreasing non wetting phase relative permeability bradford and leij 1995 hwang et al 2006 however the impact of fractional wettability on capillary pressure is more complicated in an oil water or co2 water system it was observed that increased fraction of non wetting sand reduces the capillary pressure in both the primary drainage and imbibition curves bradford and leij 1995 hwang et al 2006 in an air water system hwang s results showed that there was no noticeable relationship between the fraction of non wetting surface and capillary pressure hwang et al 2006 studies using beads with designed wettability patterns showed that the spatial correlation length also had an impact on capillary pressure particularly a smaller spatial correlation length enhanced the hysteresis in the pc sw curves murison et al 2014 hiller et al 2019 a mixed wettability model assumes that the oil wet surfaces were caused by the contact with oil mixed wet porous media were typically constructed using the surface aging method which altered water wet surfaces using non wetting fluids masalmeh 2002 tanino and blunt 2013 chang et al 2020 qin et al 2020 the impact of mixed wettability on relative permeability varied which depended on the extent of surface property alteration it was observed that mixed wettability decreased oil relative permeability and increased water relative permeability zou and armstrong 2019 nemer et al 2020 the influence of mixed wettability on oil relative permeability was more significant than on water relative permeability the impact on water relative permeability was small and sometimes negligible landry et al 2014 in the imbibition stage under the mixed wet condition a non monotonic relation between the initial oil saturation and remaining oil saturation was observed tanino and blunt 2013 mixed wettability can also cause preferential non wetting flow paths chang et al 2020 in the laboratory it is challenging to construct a rock sample having desired heterogeneous surface wettability and to investigate displacement dynamics at the pore scale therefore pore scale simulation such as the lattice boltzmann lb method has become a powerful tool to unravel the role of pore scale wettability heterogeneity on large scale displacement dynamics berg et al 2013 andrew et al 2015 nemer et al 2020 the lb method also has advantages in incorporating complex physicochemical properties such as surface wettability solubility and phase separation compared to traditional computational fluid dynamics models shi and tang 2018 zhao et al 2018 guo et al 2020 mcclure et al 2021 in addition the rapid development of graphics processing unit gpu based parallel computing technologies makes the lb method an efficient numerical scheme in simulating large scale multiphase flow in porous media mcclure et al 2010 mcclure et al 2014 xue and roy 2021 although many studies have been conducted to investigate immiscible two fluid displacements in porous media there is still a lack of fundamental understanding of immiscible displacements under heterogeneous wettability conditions this study investigated the impact of pore scale surface wettability heterogeneity which has a wide range of ca distribution on the dynamic immiscible displacement process in a bentheimer sandstone the heterogeneous wettability fields were generated based on the ca variance and spatial correlation length measured from x ray micro ct images of a bentheimer sandstone which were then imported into a lb multiphase flow model as rock surface properties compared to one of our recent publications guo et al 2020 which focused on steady state two phase flow in porous media this work focuses on transient immiscible two fluid displacement in porous media particularly the goal of this study is to investigate the role of pore scale surface wettability heterogeneity on large scale immiscible displacement dynamics and the associated pc sw curves which has extensive applications in many geo energy and hydrogeological systems associated with multiphase flow in complicated porous media chen and ewing 1997 hewitt 2008 feng et al 2021 li et al 2022 2 materials and methods 2 1 lb method for multiphase flow modeling the color gradient lb multiphase flow model was used in this study for numerical simulation of immiscible two phase displacement in the sandstone and calculations of the pc sw curves and relative permeability the lb method has proven an efficient tool to simulating multiphase flow in complex 3d porous media mcclure et al 2014 guo et al 2020 and the lb model used in this study has been validated and published in our previous studies fan et al 2019 fan et al 2020 guo et al 2020 in our lb model the momentum equation is simulated using the d3q19 lattice structure which means there are 19 velocity directions in the 3d space the discrete velocity vectors in d3q19 are 1 0 0 0 for q 0 1 0 0 for q 1 2 0 1 0 for q 3 4 0 0 1 for q 5 6 1 1 0 for q 7 8 9 10 1 0 1 for q 11 12 13 14 0 1 1 for q 15 16 17 18 in order to reduce the computing costs the mass transfer equation was simulated using a d3q7 lattice structure mcclure et al 2014 the corresponding velocity vectors in d3q7 are the first seven vectors in eq 1 the mass distributions for the wetting fluid and non wetting fluid are constructed using their densities ρ w and ρ n and the velocity u 2 g q w w q ρ w 1 e q u β e q n ρ n ρ w ρ n ρ w q 0 1 2 6 g q w w q ρ n 1 e q u β e q n ρ n ρ w ρ n ρ w q 0 1 2 6 where weights wq are 1 3 for q 0 and 1 9 for q 1 2 6 and n is the unit vector normal to the fluid fluid interface the superscripts w and n refer to the wetting fluid and nonwetting fluid respectively the fluid densities are then calculated as 3 ρ i x t δ t q 0 6 g q i x e q δ t t i w n in the multi relaxation time approach the collision process is simulated in the moment space the transformation between moments m and the distribution function f are written as 4 m m f f m 1 m where m is the transformation matrix and m 1 is the inverse of m the particle distribution evolution equation is written as 5 f q x e q δ t t δ t f q x t i 0 q 1 m q i 1 λ i m i e q m i q 0 1 2 18 where fq x t is the particle distribution function at location x and time t travelling in the qth direction fq x e q δt t δt is the particle distribution function at the adjacent lattice node after each streaming step in the qth direction λ i is the ith relaxation rate of moment mi toward its corresponding equilibrium value m i e q to simulate the interfacial tension additional terms are incorporated into the non zero equilibrium moments 6 m 1 e q j x 2 j y 2 j z 2 α c m 9 e q 2 j x 2 j y 2 j z 2 α c 2 2 n x 2 n y 2 n z 2 m 11 e q j y 2 j z 2 α c 2 n y 2 n z 2 m 13 e q j x j y α c 2 n x n y m 14 e q j y j z α c 2 n y n z m 15 e q j x j z α c 2 n x n z where ji jy and jz are fluid momentums in the x y and z directions respectively α is the parameter to adjust the interfacial tension c is the color gradient nx ny and nz are the components of the unit norm vector n in the x y and z directions respectively in the lb simulation of immiscible two fluid displacement a buffer layer with a thickness of six lattice units lus was placed at both ends of the rock in the main flow direction the buffer layer at the inlet was set as scco2 whereas the buffer layer at the outlet was set as water the kinematic viscosity of scco2 is 0 1 0 25 of water therefore in this work the viscosity ratio of water to scco2 was set as 4 1 fan et al 2019 the pressure boundary condition was applied at the inlet and outlet and the no slip boundary condition was applied at rock surfaces in this work the coefficient α in eq 6 was set as 0 005 we matched the capillary number ca between the lb model system and the real system to recover the correct ratio of viscous force to interfacial force because the ca number was low which indicates that the flow velocity is slow and the interfacial tension dominates over the viscous force the impact of density ratio was negligible therefore in this study the density ratio between scco2 and water was set as one the rock was initially saturated with water we gradually changed the pressure difference between the two ends of the rock sample to let the system go through the primary drainage pd imbibition im and secondary drainage sd stages the capillary pressure i e pressure difference between the non wetting fluid and wetting fluid and water saturation in the sample were recorded when the flow reached a steady state at each pressure difference at each water saturation scco2 and water distribution in the three dimensional 3d pore space was extracted and then used as the initial condition to simulate the steady state relative permeability curves in the simulation of relative permeability fluid flow was driven by applying a constant external body force with a periodic boundary condition in the main flow direction which aimed to maintain a constant water saturation in the domain and to mimic fractional flow experiments typically used to measure relative permeability in the laboratory fan et al 2019 to address the high demand of computing costs associated with the lb method a hybrid multicore central processing unit cpu gpu parallel computing acceleration algorithm was employed in the implementation of the lb modeling mcclure et al 2014 chen et al 2016 2 2 generation of heterogeneous surface wettability the wettability of a rock surface can be characterized using the static ca measured on the sandstone surface in our previous study guo et al 2020 we conducted in situ measurements of static cas on the rock surfaces in a bentheimer sandstone based on high resolution x ray micro ct scanning wang et al 2022 the measurements showed that the surface ca distribution follows a lognormal distribution and can be modeled as a gaussian random field with a spatial correlation length the log wettability field y is defined as y log θ where θ is the ca random field the mean and variance of θ are related to the mean and variance of y by μ θ e μ y σ y 2 2 and σ θ 2 e σ y 2 1 e 2 μ y σ y 2 respectively chen and zeng 2015 the correlation function of the log wettability field between points x and y in the 3d space cy x y is calculated as c y x y σ y 2 exp x 1 y 1 l 1 x 2 y 2 l 2 x 3 y 3 l 3 where l1 l2 and l3 are the correlation lengths in the three principal directions guo et al 2020 we used the karhunen loève expansion kle method to efficiently generate the heterogeneous wettability field on rock surfaces which reduces the time and computer memories required compared to other methods that directly generate 3d random fields zhang and lu 2004 in the kle method the correlation function of the log wettability field cy x y is decomposed in the form of eigenvalues and eigenfunctions 7 c y x y n 1 λ n ψ n x ψ n y where λ n and ψ n x are the n th eigenvalue and eigenfunction respectively the wettability fields are then generated using the kle method 8 y x y x n 1 ξ n λ n ψ n x where ξ n are independent zero mean gaussian random variables having a unit variance in practice finite terms in the kle method are employed to approximate the desired random fields chen et al 2013 the details of this method were given in zhang and lu 2004 guo et al 2020 in the next step the surface wettability of the sandstone is constructed by mapping the generated wettability field onto the surface of the bentheimer sandstone 2 3 rock models with heterogeneous surface wettability the 3d digital rock model in this study has dimensions of 240 240 240 voxels with a micro ct resolution of 6 67 μm per pixel length the porosity of the rock is 26 iglauer et al 2015 classified the rock surface wettability in a co2 water rock system into 7 types based on the value of the static surface ca completely water wet i e a ca of 0 strongly water wet 0 50 weakly water wet 50 70 intermediate wet 70 110 weakly co2 wet 110 130 strongly co2 wet 130 180 and completely co2 wet 180 in this study we used this classification to characterize the wetting conditions of rocks in a saline aquifer the sandstone is usually water wet or intermediate wet therefore we only generated heterogeneous strongly water wet sww weakly water wet www and intermediate wet iw fields having mean cas of 25 60 and 90 respectively the standard deviation and spatial correlation length of the ca distributions were 9 and 118 6 μm respectively which were measured in the beithermer sandstone core after two drainage imbibition cycles of core flooding experiments using in situ x ray micro ct guo et al 2020 note that the dimension of the computational domain 240 pixel lengths was 13 5 times larger than the spatial correlation length 17 8 pixel lengths which suggests that sufficient statistical information was included in the generated gaussian random fields and thereby the ergodicity requirement was satisfied the generated heterogeneous wettability fields were then projected onto the rock surfaces on the bentheimer rock as shown in fig 1 we then conducted lb multiphase flow modeling in all of the three rock models to simulate the immiscible two phase displacement processes that included the pd im and sd stages 2 4 corey model for fitting relative permeability curves the corey model was used to fit the lb simulated water and scco2 relative permeabilities which assumes that the relationship between relative permeabilities and normalized water saturations follows a power law 9 k r w k r w o s w n w 10 k r g k r g o 1 s w n g where krw and k r w o are water relative permeability and end point water relative permeability respectively krg and k r g o are scco2 relative permeability and end point scco2 relative permeability respetively nw and ng are the power law exponents for water and scco2 relative permeability curves respectively s w is the normalized water saturation defined as s w s w s w i r 1 s w i r s g r w where sw is water saturation swir is irreducible water saturation and sgrw is residual scco2 saturation 3 results and discussion 3 1 pore scale scco2 and water distribution the pore geometry rock surface wettability and saturation history determine the scco2 and water distribution at the pore scale wettability is the competition between scco2 and water to adhere to rock surfaces nemer et al 2020 pore scale heterogeneity of rock surface wettability can cause redistribution of scco2 and water in the pore space figs 2 4 demonstrate the pore scale scco2 and water distribution under different wetting conditions in the pd im and sd stages to better demonstrate the surface wettability heterogeneity pore scale surface wettability distributions were illustrated in figs 2 4 using colors that indicated the distribution of surface cas under the sww and www conditions the shape and distribution of scco2 blobs were determined primarily by the pore geometry the scco2 blobs were more likely to reside on the less water wet surfaces we extracted pore scale distribution maps of scco2 and water during the transient displacement process in the pi im and sd stages as shown in fig 2 it can be observed that the distributions of scco2 under the sww condition in the pd im and sd stages were almost identical in the sww heterogeneous wettability scenario all cas were less than 90 with an average ca of 25 this indicated that in this scenario the scco2 always had lower affinity to rock surfaces compared to water therefore scco2 blobs had lower mobility because they were trapped in relatively large pores due to the capillary pressure barrier leading to similar pore scale fluid distribution maps among the pd im and sd stages as shown in fig 2 fig 3 demonstrates the distribution of scco2 under the www condition with an average ca of 60 larger cas led to lower affinity of water to rock surfaces compared to the sww condition which resulted in enhanced co2 mobility this was confirmed by the noticeable co2 saturation changes in intermediate and large sized pores among the pd im and sd stages which suggested that the scco2 blobs were able to move through small pore throats and thus were not trapped in intermediate and large sized pores this was further confirmed by fig 4 where rock surfaces were under the iw condition it was noticeable that in this scenario the scco2 saturation variations in intermediate and large sized pores were significant which suggested that the rock surfaces were neutral wet leading to reduced capillary pressure barriers and consequently enhanced mobility for both fluids slice averaged water saturation against the dimensionless distance x were plotted to elucidate the impact of rock surface wettability on the scco2 distribution in the longitudinal i e main flow direction fig 5 illustrates the water saturation profiles under the sww www and iw scenarios and the overall water saturation was 0 5 for all these scenarios it is noticeable that the water saturation profiles were similar between the pd im and sp stages under the sww and www conditions which suggested that scco2 the non wetting fluid was trapped in large and intermediate sized pores under the sww and www conditions due to the capillary barrier pressures in small pores and throats leading to reduced mobility of scco2 and consequently small variations of local fluid saturations conversely under the iw condition the capillary barrier pressures associated with small pores and throats were mitigated due to the neutral cas on rock surfaces resulting in enhanced scco2 mobility throughout the entire sample and consequently different water saturation profiles between the pd im and sd stages this suggested that surface wettability played a more noticeable role on pore and large scale fluid distributions under the iw condition compared to the sww and www conditions these observations were consistent with the pore scale fluid distributions shown in figs 2 4 note that during the pd im and sd stages the left end of the core i e x 0 was connected to a scco2 reservoir whereas the right end i e x 1 was connected to a water reservoir which explains why the water saturation was equal to zero at the left end and equal to one at the right end 3 2 capillary pressure the relation between capillary pressure and water saturation commonly characterized as the pc sw curve is a fundamental constitutive equation for predicting co2 migration and capillary trapping tokunaga et al 2013 the factors regulating the pc sw curve including pore structure rock surface wettability and saturation history bakhshian and hosseini 2019 in this work the pc sw curve under the sww www and iw conditions were numerically simulated using the lb multiphase flow model during the two phase displacement the pressure difference between the inlet and outlet was gradually increased or decreased leading to a varying capillary pressure in the drainage imbibition drainage process the simulation time at each pressure difference was adequately long to allow the scco2 water rock system to reach a steady state toward the end of the pd stage when the absolute value of the first order derivative of the pc sw curve i e ratio of capillary pressure change to water saturation change was higher than a particular threshold the drainage displacement simulation was terminated this indicates a moment when an adequately large capillary pressure was applied but no noticeable water saturation change was observed leading to the end point of the pd stage similar method was used to determine the end points of the im and sd stages through these dynamic displacement processes the ca number ranged from 10 7 to 10 3 fig 6 illustrates the pc sw curves for both homogeneous and heterogeneous surface wettability under the sww www and iw conditions under the homogeneous sww www and iw conditions the cas were homogeneous over the entire rock surface and set as 25 60 and 90 respectively which were the mean cas for the corresponding heterogeneous wetting conditions fig 6a 6c show that the pc sw curves for homogeneous and heterogeneous surface wettability were almost identical this suggests although pore scale heterogeneity induced local redistribution of scco2 and water blobs it had almost no effect on the large scale pc sw curve which was an average property of the entire sample in other words the local variations of scco2 and water distribution caused by surface wettability heterogeneity were statistically averaged out at the entire sample scale one noticeable difference between the homogeneous and heterogeneous scenarios can be found under the iw condition as shown in fig 6c where the entry capillary pressure of the pd section was zero for the homogeneous scenario whereas it was negative for the heterogeneous scenario this was because under the iw condition and heterogeneous surface wettability a large fraction of rock surfaces had cas larger than 90 leading to local co2 wet surfaces at these areas consequently scco2 can migrate into the rock spontaneously leading to a negative entry capillary pressure in practice a negative entry capillary pressure has significant influences on field scale co2 migration and distribution in a saline aquifer singh et al 2021 fig 6d demonstrates the comparison of the pc sw curves between the sww www and iw conditions in rock samples having heterogeneous surface wettability when surface wettability changed from sww to iw sequentially the pc sw curves shifted in the left and downward directions leading to a lower capillary pressure at the same water saturation a lower irreducible water saturation at the end of the pd stage and a higher residual co2 saturation at the end of the im stage 3 3 relative permeability the relative permeabilities under homogeneous and heterogeneous wetting conditions were also simulated the ca number in these simulations was 10 5 which was in the range of the ca number between 3 10 9 and 3 10 5 encountered in real co2 aquifer storage projects wei et al 2014 the relatively low ca number suggested that the interfacial force dominated the transport of the two fluids fan et al 2019 fig 7 illustrates the relative permeability curves under heterogeneous rock surface wettability and the sww www and iw conditions when the system moved from the pd stage into the im stage the relative permeability of scco2 decreased whereas the relative permeability of water increased in other words the relative permeability curves rotated in the counterclockwise direction this was because in the pd stage scco2 was injected into the rock leading to enhanced connectivity of scco2 in the pore space especially through small pore throats which was favorable for the relative permeability of scco2 and unfavorable for the relative permeability of water in the im stage water returned into the rock leading to enhanced connectivity of water and disconnected scco2 blobs trapped in big pores which enhanced the relative permeability of water and decreased the relative permeability of scco2 based on the same mechanism when the system moved from the im stage into the sd stage the relative permeability of water decreased whereas the relative permeability of scco2 increased i e the relative permeability curves rotated in the clockwise direction these phenomena can be clearly observed under the iw condition i e fig 7c because the average rock surface ca in this case was 90 leading to enhanced mobility for both fluids conversely under the sww i e fig 7a and www i e fig 7b conditions these variations were not as noticeable as under the iw condition because the water wet rock surfaces limited the mobility of both fluids which was confirmed in figs 2 3 these findings showed that the relative permeability can be influenced by the saturation history in addition it was observed that in all of these wettability conditions i e figs 7a 7c the variation of the scco2 relative permeability curves between the pd im and sd stages was more significant than that of the water relative permeability curves this was because the viscosity of scco2 was 25 of water viscosity chen and zhang 2009 during the pd and sd stages a low viscosity fluid i e scco2 was forced to displace a high viscosity fluid i e water leading to scco2 coalescence and finger shaped displacement fronts thereby noticeably enhancing the connectivity and consequently the relative permeability of scco2 during the im stage scco2 was subject to snap off due to its lower viscosity compared to water leading to isolated scco2 blobs trapped in large pores which significantly reduced the connectivity and consequently the relative permeability of scco2 therefore the variation of the scco2 relative permeability curves was more noticeable than water when the system went through the pd im and sd stages fig 8 illustrates the relative permeability curves under homogeneous sww www and iw conditions the overall evolution pattern of the relative permeability curves was similar to that in the heterogeneous wettability scenario when the system went through the pd im and sd stages however it can be observed that the variation of the scco2 relative permeability curves between the pd im and sd stages was less than that in the heterogeneous wettability scenario especially under the www and iw conditions this suggests that pore scale ca heterogeneity enhances the coalescence and snap off behaviors of scco2 blobs as described before which consequently leads to more significant variations of scco2 relative permeability at the larger scale to quantify the role of surface wettability heterogeneity on relative permeability the standard deviations among the corey model fitted relative permeabilities were calculated specifically the relative permeabilities in the water saturation range between 0 2 and 0 8 were used at each water saturation the relative permeability values from the pd im and sd relative permeability curves were extracted and then the standard deviation of these three values was calculated the average standard deviation over the entire water saturation domain was calculated which indicates the variation between the pd im and sd relative permeability curves fig 9 illustrates the average standard deviations for the water and scco2 relative permeability curves under the three surface wettability conditions it is clear that under the www and iw conditions the average standard deviations of the scco2 relative permeability curves between the pd im and sd stages in the heterogeneous wettability scenario were noticeably higher than those in the homogeneous wettability scenario which confirms the observations in figs 8 9 in addition it is clear that the average standard deviations of the scco2 relative permeability curves between the pd im and sd stages were always higher than those for water in both the homogeneous and heterogeneous wettability scenarios which is also consistent with the observations in figs 8 9 4 summary and conclusion surface wettability is one of the major factors that regulate immiscible two phase displacements in porous media this study modeled heterogeneous surface wettability in a bentheimer sandstone sample of which the 3d pore structure information was obtained using x ray micro ct scanning the pore scale heterogeneous surface wettability fields were generated using gaussian random fields based on the mean standard deviation and spatial correlation length obtained from in situ measurements of cas in the micro ct images the immiscible two phase displacements were simulated using a lb multiphase flow simulator which was accelerated with a hybrid multicore cpu gpu parallel computing algorithm the simulation results indicated that pore scale heterogeneity of rock surface wettability caused noticeable redistribution of fluids at the pore scale previous investigations suggested that the fraction of the non wetting fluid occupying small pores increased as the wettability switched from homogeneous sww to homogeneous iw conditions bakhshian et al 2021 this is consistent with the results in this study particularly when the co2 water rock system switched from the heterogeneous sww condition to heterogeneous iw condition scco2 blobs tended to reside in regions having relatively large cas at the sub pore scale the wettability heterogeneity coupled with different saturation histories i e pd im and sd stages enhanced the variations in pore scale scco2 and water distribution especially under the iw condition pore scale surface wettability heterogeneity influences the pc sw curves which characterize the macroscopic properties in immiscible two phase displacements under the heterogeneous iw condition the entry pressure of the pd stage was negative whereas it was zero under the homogeneous iw condition the negative entry pressure under the heterogeneous iw condition was caused by local co2 wet rock surfaces which has critical implications to large scale geological co2 sequestration in other stages i e im and sd the pc sw curves were almost identical between the homogeneous and heterogeneous wetting conditions the finding suggested that the local effects of surface wettability heterogeneity on the pc sw curve were averaged out at the entire sample scale the relative permeability curves were affected by the saturation history under both homogeneous and heterogeneous wetting conditions the imbibition process increased the relative permeability of water and decreased the relative permeability of scco2 compared to the drainage process under the sww condition the effects of pore scale wettability heterogeneity on the relative permeability curves were not noticeable under heterogeneous www and iw conditions the variation of the scco2 relative permeability curve was more significant than that in the homogenous wettability scenario this is because pore scale wettability heterogeneity enhances the coalescence and snap off behaviors of scco2 blobs when the system goes through the pd im and sd stages thereby leading to more significant variations of scco2 relative permeability curves at the larger scale this study demonstrated the effects of pore scale surface wettability heterogeneity on microscopic fluid distribution macroscopic pc sw relation and relative permeability the findings advanced our understanding of the role of pore scale wettability heterogeneity on immiscible two phase displacement in complicated 3d porous media which has a wide range of applications in many natural and engineered processes such as geological carbon storage contaminated soil remediation flow control in micro chips and advanced manufacturing declaration of competing interest there is no conflict of interest associated with this manuscript acknowledgements the authors are thankful to the financial support provided by the university coalition for fossil energy research ucfer program under the u s department of energy doe s national energy technology laboratory netl through the award number de fe0026825 and subaward number s000038 usdoe as well as the support from netl s research participation program sponsored by the u s doe and administered by the oak ridge institute for science and education orise the authors also acknowledge the support of supercomputers from virginia tech s advanced research computing for the high performance parallel computing in lb multiphase flow modeling 
137,surface wettability is one of the major factors that regulate immiscible fluid displacement in porous media however the role of pore scale wettability heterogeneity on dynamic immiscible displacement is rarely investigated this study investigated the impact of pore scale wettability heterogeneity on immiscible two fluid displacement and the resulting macroscopic constitutive relations including the capillary pressure water saturation p c s w and relative permeability curves a digital bentheimer sandstone model was obtained from x ray micro computed tomography micro ct scanning and the rock surface wettability fields were generated based on in situ measurements of contact angles a graphics processing unit accelerated lattice boltzmann model was employed to simulate the immiscible displacement processes through the primary drainage imbibition and second drainage stages in a co2 water rock system we found that pore scale surface wettability heterogeneity caused noticeable local supercritical co2 scco2 and water redistribution under less water wet conditions at the continuum scale the p c s w curves under the heterogeneous wetting condition were overall similar to those under the homogeneous wetting condition this is because the impact of local wettability heterogeneity on the large scale pc sw curve was statistically averaged out at the entire sample scale the only difference was that heterogeneous wettability led to a negative entry pressure at the primary drainage stage under the intermediate wet condition which was caused by local scco2 wet surfaces the impact of pore scale wettability heterogeneity was more noticeable on the relative permeability curves particularly the variation of the scco2 relative permeability curve in the heterogeneous wettability scenario was more significant than that in the homogenous wettability scenario this suggests that pore scale wettability heterogeneity enhances the coalescence and snap off behaviors of scco2 blobs this is the first study that systematically investigated the role of pore scale wettability heterogeneity on dynamic immiscible displacement and associated p c s w curves in complicated three dimensional porous media key words geological co2 sequestration immiscible displacement wettability heterogeneity pc sw curve relative permeability nomenclature c color gradient c lattice speed cy correlation function e q lattice velocity vector in the q direction f particle distribution function fq particle distribution function in the q direction g mass distributions for the wetting fluid or non wetting fluid ji fluid momentum in the i direction krg scco2 relative permeability k r g o end point relative permeability of scco2 krw water relative permeability k r w o end point relative permeability of water li correlation lengths in the i direction m moments of particle distribution functions mi moments in the i direction m i e q equilibrium moments in the i direction m transform matrix m 1 inverse of transform matrixm n unit normal vector of the color gradient ni component of unit normal vector of the color gradient in the i direction ng non wetting phase exponent in the corey model nw wetting phase exponent in the corey model q directions in the d3q9 lattice space sgrw residual saturation of non wetting phase sw wetting phase saturation s w normalized wetting phase saturation swir irreducible saturation of wetting phase t time δt time step u fluid velocity wq weights for the d3q7 lattice model x location xi coordinate of location x in the i direction y field of logarithm of ca y location yi coordinate of location y in the i direction α parameter linearly related to the interfacial tension β parameter that controls the width of the interface λ relaxation coefficient λ eigenvalue of correlation function μ y mean of logarithm of contact angle μθ mean of contact angle θ contact angle ρ nw fluid density of non wetting phase ρ w fluid density of wetting phase σ y standard deviation of logarithm of contact angle σθ standard deviation of contact angle ξ n independent zero meaned gaussian random variables with unit variance ψ eigenfunction of correlation function 1 introduction mitigation of the global climate change has become an urgent and pressing challenge of our time the 2015 paris agreement aimed to keep the global average temperature increase within 2 c compared to pre industrial period and to achieve net zero emissions ultimately ipcc 2018 hassanpouryouzband et al 2021 geological carbon sequestration gcs has proven a viable solution to mitigating co2 emissions while allowing continued large scale consumptions of fossil fuel energy michael et al 2010 y q tang et al 2019 subsurface saline aquifers have been considered ideal geological formations for gcs due to their extensive distribution and vast storage capacity which was estimated to be 320 10 000 gigatons of co2 across the world bachu 2002 after the emplacement of co2 in a deep saline aquifer the co2 exists in the supercritical phase if the temperature is higher than 31 c and pressure is higher than 1000 psi chen et al 2013 the supercritical co2 scco2 migrates upward due to buoyancy and then spreads horizontally when it reaches the impermeable cap rock sathaye et al 2014 emami meybodi et al 2015 guo et al 2021 it is critical to understand and predict the migration of scco2 in saline aquifers to ensure the long term security of gcs chang et al 2020 the migration of injected scco2 in saline aquifers can be modeled as an immiscible displacement process which is regulated by the pore geometry fluid properties and rock surface wettability tanino and blunt 2013 the surface wettability of a porous medium is usually characterized as the static contact angle ca the distribution of which on rock surfaces can be homogeneous or heterogeneous in general water is referred to as the wetting phase fluid because its ca is usually smaller than 90 whereas another fluid e g scco2 or oil is referred to as the nonwetting phase fluid fan et al 2019 the impact of homogeneous wettability on multiphase flow in porous media has been intensively studied pan et al 2004 li et al 2005 boek et al 2017 leclaire et al 2017 y q tang et al 2019 bakhshian et al 2021 however studies on rock samples strongly suggested that the surface wettability in a natural rock is heterogeneous morrow 1975 bradford and leij 1995 hwang et al 2006 rucker et al 2019 arshadi et al 2020 guo et al 2020 previous studies usually modeled heterogeneous surface wettability as a mixture of two types of surfaces with one being water wet and the other being oil wet the heterogeneous surface wettability model can be further classified as fractional wettability and mixed wettability depending on whether the distribution of surface wettability is a function of pore size a fractional wettability model assumes that the distribution of wetting surfaces is independent of the pore size whereas a mixed wettability model assumes that rock surfaces in small pores are water wet and rock surfaces in large pores are oil wet valvatne and blunt 2004 skauge et al 2007 the overall wettability of a porous medium is usually modified by changing the ratio between the wetting and non wetting surfaces for a fractional wettability model and the extent of surface property alteration for a mixed wettability model zhao et al 2018 chang et al 2020 recently published studies on in situ measurements of surface wettability suggested that the surface wettability of a natural rock can cover a wide range of cas rather than only two cas saraji et al 2013 andrew et al 2014 alhammadi et al 2017 mutailipu et al 2017 alratrout et al 2018 arshadi et al 2020 guo et al 2020 liu et al 2020 our previous work guo et al 2020 modeled the heterogeneous surface wettability in a sandstone sample as a gaussian random field with a spatial correlation length based on in situ ca measurements using x ray micro computed tomography micro ct to adequately leverage the power of pore scale numerical simulation of multiphase flow in porous media it is critical to accurately describe and incorporate the detailed surface wettability information into the model akai et al 2019 constitutive relations such as the capillary pressure water saturation pc sw relationship and relative permeability are critical inputs for continuum scale simulations of multiphase flow in porous media the role of pore scale wettability heterogeneity on the macroscopic constitutive relations has attracted significant attention previous studies have intensively investigated the displacement mechanisms under different wetting conditions zhao et al 2016 hu et al 2017 and the effect of surface wettability on capillary pressure and relative permeability hwang et al 2006 landry et al 2014 zhao et al 2018 bakhshian and hosseini 2019 chang et al 2020 nemer et al 2020 in the studies on fractional wettability the physical model for fractional wet porous media were constructed by mixing sands having different wettability bradford and leij 1995 hwang et al 2006 mixing beads having designed wettability murison et al 2014 hiller et al 2019 and mapping surface wettability fields to digital rock models bakhshian and hosseini 2019 it was observed that an increasing fraction of non wetting surface led to increasing wetting phase relative permeability and decreasing non wetting phase relative permeability bradford and leij 1995 hwang et al 2006 however the impact of fractional wettability on capillary pressure is more complicated in an oil water or co2 water system it was observed that increased fraction of non wetting sand reduces the capillary pressure in both the primary drainage and imbibition curves bradford and leij 1995 hwang et al 2006 in an air water system hwang s results showed that there was no noticeable relationship between the fraction of non wetting surface and capillary pressure hwang et al 2006 studies using beads with designed wettability patterns showed that the spatial correlation length also had an impact on capillary pressure particularly a smaller spatial correlation length enhanced the hysteresis in the pc sw curves murison et al 2014 hiller et al 2019 a mixed wettability model assumes that the oil wet surfaces were caused by the contact with oil mixed wet porous media were typically constructed using the surface aging method which altered water wet surfaces using non wetting fluids masalmeh 2002 tanino and blunt 2013 chang et al 2020 qin et al 2020 the impact of mixed wettability on relative permeability varied which depended on the extent of surface property alteration it was observed that mixed wettability decreased oil relative permeability and increased water relative permeability zou and armstrong 2019 nemer et al 2020 the influence of mixed wettability on oil relative permeability was more significant than on water relative permeability the impact on water relative permeability was small and sometimes negligible landry et al 2014 in the imbibition stage under the mixed wet condition a non monotonic relation between the initial oil saturation and remaining oil saturation was observed tanino and blunt 2013 mixed wettability can also cause preferential non wetting flow paths chang et al 2020 in the laboratory it is challenging to construct a rock sample having desired heterogeneous surface wettability and to investigate displacement dynamics at the pore scale therefore pore scale simulation such as the lattice boltzmann lb method has become a powerful tool to unravel the role of pore scale wettability heterogeneity on large scale displacement dynamics berg et al 2013 andrew et al 2015 nemer et al 2020 the lb method also has advantages in incorporating complex physicochemical properties such as surface wettability solubility and phase separation compared to traditional computational fluid dynamics models shi and tang 2018 zhao et al 2018 guo et al 2020 mcclure et al 2021 in addition the rapid development of graphics processing unit gpu based parallel computing technologies makes the lb method an efficient numerical scheme in simulating large scale multiphase flow in porous media mcclure et al 2010 mcclure et al 2014 xue and roy 2021 although many studies have been conducted to investigate immiscible two fluid displacements in porous media there is still a lack of fundamental understanding of immiscible displacements under heterogeneous wettability conditions this study investigated the impact of pore scale surface wettability heterogeneity which has a wide range of ca distribution on the dynamic immiscible displacement process in a bentheimer sandstone the heterogeneous wettability fields were generated based on the ca variance and spatial correlation length measured from x ray micro ct images of a bentheimer sandstone which were then imported into a lb multiphase flow model as rock surface properties compared to one of our recent publications guo et al 2020 which focused on steady state two phase flow in porous media this work focuses on transient immiscible two fluid displacement in porous media particularly the goal of this study is to investigate the role of pore scale surface wettability heterogeneity on large scale immiscible displacement dynamics and the associated pc sw curves which has extensive applications in many geo energy and hydrogeological systems associated with multiphase flow in complicated porous media chen and ewing 1997 hewitt 2008 feng et al 2021 li et al 2022 2 materials and methods 2 1 lb method for multiphase flow modeling the color gradient lb multiphase flow model was used in this study for numerical simulation of immiscible two phase displacement in the sandstone and calculations of the pc sw curves and relative permeability the lb method has proven an efficient tool to simulating multiphase flow in complex 3d porous media mcclure et al 2014 guo et al 2020 and the lb model used in this study has been validated and published in our previous studies fan et al 2019 fan et al 2020 guo et al 2020 in our lb model the momentum equation is simulated using the d3q19 lattice structure which means there are 19 velocity directions in the 3d space the discrete velocity vectors in d3q19 are 1 0 0 0 for q 0 1 0 0 for q 1 2 0 1 0 for q 3 4 0 0 1 for q 5 6 1 1 0 for q 7 8 9 10 1 0 1 for q 11 12 13 14 0 1 1 for q 15 16 17 18 in order to reduce the computing costs the mass transfer equation was simulated using a d3q7 lattice structure mcclure et al 2014 the corresponding velocity vectors in d3q7 are the first seven vectors in eq 1 the mass distributions for the wetting fluid and non wetting fluid are constructed using their densities ρ w and ρ n and the velocity u 2 g q w w q ρ w 1 e q u β e q n ρ n ρ w ρ n ρ w q 0 1 2 6 g q w w q ρ n 1 e q u β e q n ρ n ρ w ρ n ρ w q 0 1 2 6 where weights wq are 1 3 for q 0 and 1 9 for q 1 2 6 and n is the unit vector normal to the fluid fluid interface the superscripts w and n refer to the wetting fluid and nonwetting fluid respectively the fluid densities are then calculated as 3 ρ i x t δ t q 0 6 g q i x e q δ t t i w n in the multi relaxation time approach the collision process is simulated in the moment space the transformation between moments m and the distribution function f are written as 4 m m f f m 1 m where m is the transformation matrix and m 1 is the inverse of m the particle distribution evolution equation is written as 5 f q x e q δ t t δ t f q x t i 0 q 1 m q i 1 λ i m i e q m i q 0 1 2 18 where fq x t is the particle distribution function at location x and time t travelling in the qth direction fq x e q δt t δt is the particle distribution function at the adjacent lattice node after each streaming step in the qth direction λ i is the ith relaxation rate of moment mi toward its corresponding equilibrium value m i e q to simulate the interfacial tension additional terms are incorporated into the non zero equilibrium moments 6 m 1 e q j x 2 j y 2 j z 2 α c m 9 e q 2 j x 2 j y 2 j z 2 α c 2 2 n x 2 n y 2 n z 2 m 11 e q j y 2 j z 2 α c 2 n y 2 n z 2 m 13 e q j x j y α c 2 n x n y m 14 e q j y j z α c 2 n y n z m 15 e q j x j z α c 2 n x n z where ji jy and jz are fluid momentums in the x y and z directions respectively α is the parameter to adjust the interfacial tension c is the color gradient nx ny and nz are the components of the unit norm vector n in the x y and z directions respectively in the lb simulation of immiscible two fluid displacement a buffer layer with a thickness of six lattice units lus was placed at both ends of the rock in the main flow direction the buffer layer at the inlet was set as scco2 whereas the buffer layer at the outlet was set as water the kinematic viscosity of scco2 is 0 1 0 25 of water therefore in this work the viscosity ratio of water to scco2 was set as 4 1 fan et al 2019 the pressure boundary condition was applied at the inlet and outlet and the no slip boundary condition was applied at rock surfaces in this work the coefficient α in eq 6 was set as 0 005 we matched the capillary number ca between the lb model system and the real system to recover the correct ratio of viscous force to interfacial force because the ca number was low which indicates that the flow velocity is slow and the interfacial tension dominates over the viscous force the impact of density ratio was negligible therefore in this study the density ratio between scco2 and water was set as one the rock was initially saturated with water we gradually changed the pressure difference between the two ends of the rock sample to let the system go through the primary drainage pd imbibition im and secondary drainage sd stages the capillary pressure i e pressure difference between the non wetting fluid and wetting fluid and water saturation in the sample were recorded when the flow reached a steady state at each pressure difference at each water saturation scco2 and water distribution in the three dimensional 3d pore space was extracted and then used as the initial condition to simulate the steady state relative permeability curves in the simulation of relative permeability fluid flow was driven by applying a constant external body force with a periodic boundary condition in the main flow direction which aimed to maintain a constant water saturation in the domain and to mimic fractional flow experiments typically used to measure relative permeability in the laboratory fan et al 2019 to address the high demand of computing costs associated with the lb method a hybrid multicore central processing unit cpu gpu parallel computing acceleration algorithm was employed in the implementation of the lb modeling mcclure et al 2014 chen et al 2016 2 2 generation of heterogeneous surface wettability the wettability of a rock surface can be characterized using the static ca measured on the sandstone surface in our previous study guo et al 2020 we conducted in situ measurements of static cas on the rock surfaces in a bentheimer sandstone based on high resolution x ray micro ct scanning wang et al 2022 the measurements showed that the surface ca distribution follows a lognormal distribution and can be modeled as a gaussian random field with a spatial correlation length the log wettability field y is defined as y log θ where θ is the ca random field the mean and variance of θ are related to the mean and variance of y by μ θ e μ y σ y 2 2 and σ θ 2 e σ y 2 1 e 2 μ y σ y 2 respectively chen and zeng 2015 the correlation function of the log wettability field between points x and y in the 3d space cy x y is calculated as c y x y σ y 2 exp x 1 y 1 l 1 x 2 y 2 l 2 x 3 y 3 l 3 where l1 l2 and l3 are the correlation lengths in the three principal directions guo et al 2020 we used the karhunen loève expansion kle method to efficiently generate the heterogeneous wettability field on rock surfaces which reduces the time and computer memories required compared to other methods that directly generate 3d random fields zhang and lu 2004 in the kle method the correlation function of the log wettability field cy x y is decomposed in the form of eigenvalues and eigenfunctions 7 c y x y n 1 λ n ψ n x ψ n y where λ n and ψ n x are the n th eigenvalue and eigenfunction respectively the wettability fields are then generated using the kle method 8 y x y x n 1 ξ n λ n ψ n x where ξ n are independent zero mean gaussian random variables having a unit variance in practice finite terms in the kle method are employed to approximate the desired random fields chen et al 2013 the details of this method were given in zhang and lu 2004 guo et al 2020 in the next step the surface wettability of the sandstone is constructed by mapping the generated wettability field onto the surface of the bentheimer sandstone 2 3 rock models with heterogeneous surface wettability the 3d digital rock model in this study has dimensions of 240 240 240 voxels with a micro ct resolution of 6 67 μm per pixel length the porosity of the rock is 26 iglauer et al 2015 classified the rock surface wettability in a co2 water rock system into 7 types based on the value of the static surface ca completely water wet i e a ca of 0 strongly water wet 0 50 weakly water wet 50 70 intermediate wet 70 110 weakly co2 wet 110 130 strongly co2 wet 130 180 and completely co2 wet 180 in this study we used this classification to characterize the wetting conditions of rocks in a saline aquifer the sandstone is usually water wet or intermediate wet therefore we only generated heterogeneous strongly water wet sww weakly water wet www and intermediate wet iw fields having mean cas of 25 60 and 90 respectively the standard deviation and spatial correlation length of the ca distributions were 9 and 118 6 μm respectively which were measured in the beithermer sandstone core after two drainage imbibition cycles of core flooding experiments using in situ x ray micro ct guo et al 2020 note that the dimension of the computational domain 240 pixel lengths was 13 5 times larger than the spatial correlation length 17 8 pixel lengths which suggests that sufficient statistical information was included in the generated gaussian random fields and thereby the ergodicity requirement was satisfied the generated heterogeneous wettability fields were then projected onto the rock surfaces on the bentheimer rock as shown in fig 1 we then conducted lb multiphase flow modeling in all of the three rock models to simulate the immiscible two phase displacement processes that included the pd im and sd stages 2 4 corey model for fitting relative permeability curves the corey model was used to fit the lb simulated water and scco2 relative permeabilities which assumes that the relationship between relative permeabilities and normalized water saturations follows a power law 9 k r w k r w o s w n w 10 k r g k r g o 1 s w n g where krw and k r w o are water relative permeability and end point water relative permeability respectively krg and k r g o are scco2 relative permeability and end point scco2 relative permeability respetively nw and ng are the power law exponents for water and scco2 relative permeability curves respectively s w is the normalized water saturation defined as s w s w s w i r 1 s w i r s g r w where sw is water saturation swir is irreducible water saturation and sgrw is residual scco2 saturation 3 results and discussion 3 1 pore scale scco2 and water distribution the pore geometry rock surface wettability and saturation history determine the scco2 and water distribution at the pore scale wettability is the competition between scco2 and water to adhere to rock surfaces nemer et al 2020 pore scale heterogeneity of rock surface wettability can cause redistribution of scco2 and water in the pore space figs 2 4 demonstrate the pore scale scco2 and water distribution under different wetting conditions in the pd im and sd stages to better demonstrate the surface wettability heterogeneity pore scale surface wettability distributions were illustrated in figs 2 4 using colors that indicated the distribution of surface cas under the sww and www conditions the shape and distribution of scco2 blobs were determined primarily by the pore geometry the scco2 blobs were more likely to reside on the less water wet surfaces we extracted pore scale distribution maps of scco2 and water during the transient displacement process in the pi im and sd stages as shown in fig 2 it can be observed that the distributions of scco2 under the sww condition in the pd im and sd stages were almost identical in the sww heterogeneous wettability scenario all cas were less than 90 with an average ca of 25 this indicated that in this scenario the scco2 always had lower affinity to rock surfaces compared to water therefore scco2 blobs had lower mobility because they were trapped in relatively large pores due to the capillary pressure barrier leading to similar pore scale fluid distribution maps among the pd im and sd stages as shown in fig 2 fig 3 demonstrates the distribution of scco2 under the www condition with an average ca of 60 larger cas led to lower affinity of water to rock surfaces compared to the sww condition which resulted in enhanced co2 mobility this was confirmed by the noticeable co2 saturation changes in intermediate and large sized pores among the pd im and sd stages which suggested that the scco2 blobs were able to move through small pore throats and thus were not trapped in intermediate and large sized pores this was further confirmed by fig 4 where rock surfaces were under the iw condition it was noticeable that in this scenario the scco2 saturation variations in intermediate and large sized pores were significant which suggested that the rock surfaces were neutral wet leading to reduced capillary pressure barriers and consequently enhanced mobility for both fluids slice averaged water saturation against the dimensionless distance x were plotted to elucidate the impact of rock surface wettability on the scco2 distribution in the longitudinal i e main flow direction fig 5 illustrates the water saturation profiles under the sww www and iw scenarios and the overall water saturation was 0 5 for all these scenarios it is noticeable that the water saturation profiles were similar between the pd im and sp stages under the sww and www conditions which suggested that scco2 the non wetting fluid was trapped in large and intermediate sized pores under the sww and www conditions due to the capillary barrier pressures in small pores and throats leading to reduced mobility of scco2 and consequently small variations of local fluid saturations conversely under the iw condition the capillary barrier pressures associated with small pores and throats were mitigated due to the neutral cas on rock surfaces resulting in enhanced scco2 mobility throughout the entire sample and consequently different water saturation profiles between the pd im and sd stages this suggested that surface wettability played a more noticeable role on pore and large scale fluid distributions under the iw condition compared to the sww and www conditions these observations were consistent with the pore scale fluid distributions shown in figs 2 4 note that during the pd im and sd stages the left end of the core i e x 0 was connected to a scco2 reservoir whereas the right end i e x 1 was connected to a water reservoir which explains why the water saturation was equal to zero at the left end and equal to one at the right end 3 2 capillary pressure the relation between capillary pressure and water saturation commonly characterized as the pc sw curve is a fundamental constitutive equation for predicting co2 migration and capillary trapping tokunaga et al 2013 the factors regulating the pc sw curve including pore structure rock surface wettability and saturation history bakhshian and hosseini 2019 in this work the pc sw curve under the sww www and iw conditions were numerically simulated using the lb multiphase flow model during the two phase displacement the pressure difference between the inlet and outlet was gradually increased or decreased leading to a varying capillary pressure in the drainage imbibition drainage process the simulation time at each pressure difference was adequately long to allow the scco2 water rock system to reach a steady state toward the end of the pd stage when the absolute value of the first order derivative of the pc sw curve i e ratio of capillary pressure change to water saturation change was higher than a particular threshold the drainage displacement simulation was terminated this indicates a moment when an adequately large capillary pressure was applied but no noticeable water saturation change was observed leading to the end point of the pd stage similar method was used to determine the end points of the im and sd stages through these dynamic displacement processes the ca number ranged from 10 7 to 10 3 fig 6 illustrates the pc sw curves for both homogeneous and heterogeneous surface wettability under the sww www and iw conditions under the homogeneous sww www and iw conditions the cas were homogeneous over the entire rock surface and set as 25 60 and 90 respectively which were the mean cas for the corresponding heterogeneous wetting conditions fig 6a 6c show that the pc sw curves for homogeneous and heterogeneous surface wettability were almost identical this suggests although pore scale heterogeneity induced local redistribution of scco2 and water blobs it had almost no effect on the large scale pc sw curve which was an average property of the entire sample in other words the local variations of scco2 and water distribution caused by surface wettability heterogeneity were statistically averaged out at the entire sample scale one noticeable difference between the homogeneous and heterogeneous scenarios can be found under the iw condition as shown in fig 6c where the entry capillary pressure of the pd section was zero for the homogeneous scenario whereas it was negative for the heterogeneous scenario this was because under the iw condition and heterogeneous surface wettability a large fraction of rock surfaces had cas larger than 90 leading to local co2 wet surfaces at these areas consequently scco2 can migrate into the rock spontaneously leading to a negative entry capillary pressure in practice a negative entry capillary pressure has significant influences on field scale co2 migration and distribution in a saline aquifer singh et al 2021 fig 6d demonstrates the comparison of the pc sw curves between the sww www and iw conditions in rock samples having heterogeneous surface wettability when surface wettability changed from sww to iw sequentially the pc sw curves shifted in the left and downward directions leading to a lower capillary pressure at the same water saturation a lower irreducible water saturation at the end of the pd stage and a higher residual co2 saturation at the end of the im stage 3 3 relative permeability the relative permeabilities under homogeneous and heterogeneous wetting conditions were also simulated the ca number in these simulations was 10 5 which was in the range of the ca number between 3 10 9 and 3 10 5 encountered in real co2 aquifer storage projects wei et al 2014 the relatively low ca number suggested that the interfacial force dominated the transport of the two fluids fan et al 2019 fig 7 illustrates the relative permeability curves under heterogeneous rock surface wettability and the sww www and iw conditions when the system moved from the pd stage into the im stage the relative permeability of scco2 decreased whereas the relative permeability of water increased in other words the relative permeability curves rotated in the counterclockwise direction this was because in the pd stage scco2 was injected into the rock leading to enhanced connectivity of scco2 in the pore space especially through small pore throats which was favorable for the relative permeability of scco2 and unfavorable for the relative permeability of water in the im stage water returned into the rock leading to enhanced connectivity of water and disconnected scco2 blobs trapped in big pores which enhanced the relative permeability of water and decreased the relative permeability of scco2 based on the same mechanism when the system moved from the im stage into the sd stage the relative permeability of water decreased whereas the relative permeability of scco2 increased i e the relative permeability curves rotated in the clockwise direction these phenomena can be clearly observed under the iw condition i e fig 7c because the average rock surface ca in this case was 90 leading to enhanced mobility for both fluids conversely under the sww i e fig 7a and www i e fig 7b conditions these variations were not as noticeable as under the iw condition because the water wet rock surfaces limited the mobility of both fluids which was confirmed in figs 2 3 these findings showed that the relative permeability can be influenced by the saturation history in addition it was observed that in all of these wettability conditions i e figs 7a 7c the variation of the scco2 relative permeability curves between the pd im and sd stages was more significant than that of the water relative permeability curves this was because the viscosity of scco2 was 25 of water viscosity chen and zhang 2009 during the pd and sd stages a low viscosity fluid i e scco2 was forced to displace a high viscosity fluid i e water leading to scco2 coalescence and finger shaped displacement fronts thereby noticeably enhancing the connectivity and consequently the relative permeability of scco2 during the im stage scco2 was subject to snap off due to its lower viscosity compared to water leading to isolated scco2 blobs trapped in large pores which significantly reduced the connectivity and consequently the relative permeability of scco2 therefore the variation of the scco2 relative permeability curves was more noticeable than water when the system went through the pd im and sd stages fig 8 illustrates the relative permeability curves under homogeneous sww www and iw conditions the overall evolution pattern of the relative permeability curves was similar to that in the heterogeneous wettability scenario when the system went through the pd im and sd stages however it can be observed that the variation of the scco2 relative permeability curves between the pd im and sd stages was less than that in the heterogeneous wettability scenario especially under the www and iw conditions this suggests that pore scale ca heterogeneity enhances the coalescence and snap off behaviors of scco2 blobs as described before which consequently leads to more significant variations of scco2 relative permeability at the larger scale to quantify the role of surface wettability heterogeneity on relative permeability the standard deviations among the corey model fitted relative permeabilities were calculated specifically the relative permeabilities in the water saturation range between 0 2 and 0 8 were used at each water saturation the relative permeability values from the pd im and sd relative permeability curves were extracted and then the standard deviation of these three values was calculated the average standard deviation over the entire water saturation domain was calculated which indicates the variation between the pd im and sd relative permeability curves fig 9 illustrates the average standard deviations for the water and scco2 relative permeability curves under the three surface wettability conditions it is clear that under the www and iw conditions the average standard deviations of the scco2 relative permeability curves between the pd im and sd stages in the heterogeneous wettability scenario were noticeably higher than those in the homogeneous wettability scenario which confirms the observations in figs 8 9 in addition it is clear that the average standard deviations of the scco2 relative permeability curves between the pd im and sd stages were always higher than those for water in both the homogeneous and heterogeneous wettability scenarios which is also consistent with the observations in figs 8 9 4 summary and conclusion surface wettability is one of the major factors that regulate immiscible two phase displacements in porous media this study modeled heterogeneous surface wettability in a bentheimer sandstone sample of which the 3d pore structure information was obtained using x ray micro ct scanning the pore scale heterogeneous surface wettability fields were generated using gaussian random fields based on the mean standard deviation and spatial correlation length obtained from in situ measurements of cas in the micro ct images the immiscible two phase displacements were simulated using a lb multiphase flow simulator which was accelerated with a hybrid multicore cpu gpu parallel computing algorithm the simulation results indicated that pore scale heterogeneity of rock surface wettability caused noticeable redistribution of fluids at the pore scale previous investigations suggested that the fraction of the non wetting fluid occupying small pores increased as the wettability switched from homogeneous sww to homogeneous iw conditions bakhshian et al 2021 this is consistent with the results in this study particularly when the co2 water rock system switched from the heterogeneous sww condition to heterogeneous iw condition scco2 blobs tended to reside in regions having relatively large cas at the sub pore scale the wettability heterogeneity coupled with different saturation histories i e pd im and sd stages enhanced the variations in pore scale scco2 and water distribution especially under the iw condition pore scale surface wettability heterogeneity influences the pc sw curves which characterize the macroscopic properties in immiscible two phase displacements under the heterogeneous iw condition the entry pressure of the pd stage was negative whereas it was zero under the homogeneous iw condition the negative entry pressure under the heterogeneous iw condition was caused by local co2 wet rock surfaces which has critical implications to large scale geological co2 sequestration in other stages i e im and sd the pc sw curves were almost identical between the homogeneous and heterogeneous wetting conditions the finding suggested that the local effects of surface wettability heterogeneity on the pc sw curve were averaged out at the entire sample scale the relative permeability curves were affected by the saturation history under both homogeneous and heterogeneous wetting conditions the imbibition process increased the relative permeability of water and decreased the relative permeability of scco2 compared to the drainage process under the sww condition the effects of pore scale wettability heterogeneity on the relative permeability curves were not noticeable under heterogeneous www and iw conditions the variation of the scco2 relative permeability curve was more significant than that in the homogenous wettability scenario this is because pore scale wettability heterogeneity enhances the coalescence and snap off behaviors of scco2 blobs when the system goes through the pd im and sd stages thereby leading to more significant variations of scco2 relative permeability curves at the larger scale this study demonstrated the effects of pore scale surface wettability heterogeneity on microscopic fluid distribution macroscopic pc sw relation and relative permeability the findings advanced our understanding of the role of pore scale wettability heterogeneity on immiscible two phase displacement in complicated 3d porous media which has a wide range of applications in many natural and engineered processes such as geological carbon storage contaminated soil remediation flow control in micro chips and advanced manufacturing declaration of competing interest there is no conflict of interest associated with this manuscript acknowledgements the authors are thankful to the financial support provided by the university coalition for fossil energy research ucfer program under the u s department of energy doe s national energy technology laboratory netl through the award number de fe0026825 and subaward number s000038 usdoe as well as the support from netl s research participation program sponsored by the u s doe and administered by the oak ridge institute for science and education orise the authors also acknowledge the support of supercomputers from virginia tech s advanced research computing for the high performance parallel computing in lb multiphase flow modeling 
138,understanding the mechanisms of nanoconfined liquid flow in nanoporous media is crucial for many scientific and engineering applications such as enhanced shale oil recovery and water purification however due to molecular interactions which cause slip boundary and heterogeneous viscosity density in nanoscale space the conventional continuity equations are no longer applicable besides the pore size in popular molecular dynamics simulation mds is too small to meet the engineering application and the pore scale lattice boltzmann method lbm is difficult to accurately consider molecular interactions in complicated nanoporous media in this work we summarize and establish four theoretical models for liquid flow in nanopores which are region separation model effective viscosity model apparent viscosity model and apparent slip length model then through comparative analysis we indicate that the apparent viscosity model is most suitable for coupling lbm based on apparent viscosity model which comprehensively considers slip boundary and heterogeneous viscosity density we present a local apparent viscosity lbm lav lbm to simulate liquid flow in nanoporous media according to lav lbm simulations the effects of molecular interactions porous media geometry and wall wettability on apparent permeability of water flow in nanoporous media are discussed finally we couple mds results with the proposed model to calculate apparent permeability of shale oil flow in inorganic and organic media which provides a basic model for the upscaling method from molecule scale to pore scale simulations keywords nanoporous media molecular interactions slip boundary heterogeneous viscosity density local apparent viscosity lbm permeability nomenclature physical units abulk bulk region area nm2 f ads liquid solid interaction force awall near wall region area nm2 f int phase interaction force at cross sectional area of pore nm2 f b external body force c fitting parameter dimensionless gw phase interaction strength parameter c 1 parameter related to slip boundary nm s gws liquid solid interaction force parameter c 2 parameter related to slip boundary nm s l α distance from pore wall from α direction k permeability μd n number of velocity directions ls slip length nm r σ combination parameter lsapp apparent slip length nm r α pore radius in porous media δp l pressure gradient mpa nm s switch function q volume flux nm3 s t time r pore radius nm u macroscopic velocity r distance from pore center nm v lattice viscosity u velocity nm s vapp local apparent viscosity uslip slip velocity nm s v α eff local effective viscosity μ app apparent viscosity mpa s x position μ bulk bulk viscosity mpa s x ads vector perpendicular to pore wall μ wall near wall viscosity mpa s α discrete direction μ eff effective viscosity mpa s δ x space step θ contact angle o δ t time step δ thickness of near wall region nm λ typical length of water lattice units w α weight factor cs sound speed τ relaxation time c lattice speed τ wall relaxation time of near wall region e i lattice velocity vector τ bulk relaxation time of bulk region f function of density distribution ψ pseudopotential f α e q equilibrium density distribution ρ density 1 introduction the liquid flow in nanoscale space is of great significance for many scientific and engineering applications such as water desalination and filter gravelle et al 2013 das et al 2014 drug delivery geng et al 2014 energy storage and conversion siria et al 2013 and unconventional oil gas recovery sun et al 2020 in nanoscale space the liquid solid molecular interactions cause the nanoscale effects of slip boundary secchi et al 2016 heterogeneous viscosity and density s wang et al 2016 kelly et al 2015 then the conventional continuity macroscopic method based on navier stokes equations cannot be used to characterize liquid flow behaviors accurately t zhang et al 2020 compared with a single nanopore the shale nanoporous media has complex wall wettability pore size distributions and pore geometries therefore the shale oil or water flow behaviors will be more complicated zolfaghari et al 2017 however the modeling of liquid in complicated nanoporous media remains out of research because of molecular interaction effects the slip velocity on the solid wall can be observed from mds s wang et al 2016 zhan et al 2020 sam et al 2018 he et al 2019 the slip velocity can be calculated by slip length and velocity gradient the slip length mainly depends on molecular interactions and the wall wettability is usually used to define strength of molecular interactions wu et al 2017 according to the generalized relationship between the slip length and contact angle huang et al 2008 wu et al wu et al 2017 obtained a formula of water slip length and contact angle by fitting data from molecular simulations and experiments the slip length generally ranges from nanometer to micron level jason and holt 2006 qin et al 2011 kannam et al 2012 kannam et al 2013 majumder et al majumder et al 2005 indicated a 39 68 μm slip length for a 7 nm carbon nanotube cnt the flow enhancement factor is usually used to measure the slip effects on liquid flow capacity which is defined by the ratio of volume flux of slip flow to the classical no slip flow predictions the flow enhancement factor can usually be up to 107 times on an ideal smooth solid wall wu et al 2017 for heterogeneous viscosity and density according to density distributions from mds there are about two molecular layers strongly affected by solid molecular force and the region of these two molecular layers is defined by near wall region while the other region is far away from the wall is bulk region s wang et al 2016 neek amal et al 2016 the viscosity and density of the near wall region are different from that of the bulk region and that depend on the wettability from mds and experimental results wu et al wu et al 2017 obtained the relationship between the near wall viscosity bulk viscosity and contact angle zhang et al t zhang et al 2020 corrected the near wall density bulk density and contact angle as a simple linear relationship by mds results d feng et al 2018 under the effects of varying near wall viscosity and density the flow enhancement factor is affected in the range 0 1 10 times several modified theoretical models can be used to characterize nanoscale flow mattia et al mattia and calabrò 2012 and zhang et al q zhang et al 2017 applied hagen poiseuille hp equations to express the liquid velocities in near wall region and bulk region respectively and that is called the region separation model in our paper thomas et al thomas and mcgaughey 2008 applied an effective viscosity to characterize the heterogeneous viscosity then wu et al wu et al 2017 modified the conventional hp equations by the effective viscosity and slip velocity in our previous work h wang et al 2019 we used an apparent viscosity to comprehensively characterize the slip boundary and heterogeneous viscosity and then studied the enhanced water flow behaviors in elliptic pores however the current researches on the flow behaviors in nanoscale spaces are mostly based on single nanopores wu et al 2019 w zhao et al 2020 which are failing to reflect the flow behaviors in complicated porous media although wang et al h wang et al 2019 and zhang et al t zhang et al 2017 used capillary bundle model to study liquid flow in nanoporous media the capillary bundle model is also based on the theory in single nanopores which could not reflect the properties of complex pore connectivity and geometric structure in real porous media in addition to theoretical models several simulation methods of mds lbm and pore network model pnm are widely used to model liquid flow in nanoscale space sun et al 2020 w song et al 2020 song et al 2018 mds is often used to simulate the flow behaviors chemical reactions and other problems in nanoscale space based on the real molecular interaction force and to clarify the internal micro mechanisms from molecular scale the results are generally reliable recently zhan et al zhan et al 2020 used non equilibrium mds to study the water oil two phase flow in nanopores and based on the mds results the theoretical equation based on hp equation is modified lynch et al lynch et al 2020 explored the dynamic behaviors of water within nanopores and biological channels in lipid bilayer membranes from a molecular simulation perspective wang et al wang et al 2020 applied mds to study the pressure driven flow behaviors of methane through different nanoscale spaces and based on the simulation results the slip corrected poiseuille equation is obtained although mds can capture the molecular interactions at the micro level it cannot meet the macroscopic scale required by engineering applications due to it s small size and the excessive resource consumption pnm is also a popular pore scale simulation method at present because of the fast computational framework and permit simulations on large volumes of pores and scholars have carried out a lot of studies on liquid flow based on pnm golparvar et al 2018 wang et al 2017 yi et al 2017 however pnm reduces the complex pore geometry to a simple spherical and cylindrical model then it results in inaccurate prediction of flow behaviors to overcome these shortcomings in recent years mesoscopic lbm has been evaluated as an effective tool to study liquid flow in nanoporous media zhang et al 2021 which has the advantages of easy handling of complex boundary conditions reducing computational resources through parallel computation and simple algorithm yu et al 2019 zhang et al 2015 landry et al 2016 h wang et al 2021 j zhao et al 2018 zhang and crawford 2016 through considering the slip boundary and effective viscosity zhao et al j zhao et al 2018 studied the flow behaviors of liquid in nanoporous media however the solid matrix used in their simulation model is regular and the slip boundary condition is no longer applicable to real solid geometry zhang et al t zhang et al 2020 proposed a novel mesoscopic lbm to capture the density distribution and non parabolic velocity profile of water through nanochannels some scholars have combined the advantages of pnm and lbm to predict liquid flow behaviors j zhao et al 2020 miao et al miao et al 2017 predict the hydraulic conductance of the 3292 pore element with different cross sections by training neural networks then they proposed a new pnm without pore shape simplifications song et al w song et al 2020 ran a large number of simulations of liquid flow in high resolution geometries with simple cross sections and surface roughness based on a local effective viscosity lattice boltzmann method and established gas flux corrections depending on shape knudsen number and surface roughness then they took the corrections into pnm to account for all of those properties zhao et al j zhao et al 2020 extracted the real pore throat geometry without simplification and used lattice boltzmann lb simulations to modify liquid flow properties in these pores however the slip boundary conditions in their lbm has the limitation for irregular surface in lb simulations the correct slip boundary conditions are the key to ensuring the accuracy of prediction of liquid flow characteristics in recent years researchers have conducted a large number of studies on slip boundary of lbm slip boundary conditions include bounce back bb specular reflection sr and diffused maxwell reflection dm wang et al 2018 however these boundary conditions have some shortcomings such as numerical error failure to fit analytical results and overestimation of slip velocity in order to overcome the above limitations the coupling boundary conditions of bb sr bsr dm sr and dm bb were proposed guo et al 2011 szalmás 2006 these coupling boundary conditions can be accurately applied to smooth boundary straight wall but cannot be perfectly applied to the complex curved boundary in natural porous media especially considering both slip condition and viscosity heterogeneity we recently applied bgk lbm with half way bounce back and diffusive maxwell s reflection hbb dm to simulate the water flow in complex nanoporous media although this boundary condition can achieve small slip velocity on curved walls the numerical instability will occur for large slip velocity w wang et al 2021 in this paper we summarize and establish four theoretical models to characterize the liquid flow in nanopores then it is concluded that the apparent viscosity model is more suitable as a basic theoretical model coupling lbm then we propose a local apparent viscosity lbm lav lbm to degenerate slip flow in nanoporous media with complicated pore structures into the conventional no slip flow which can overcome the difficulty of slip boundary treatment in lbm in addition the density distribution in nanoporous media is also considered the proposed model is verified by comparisons of four theoretical models mds lbm density distributions and theory lbm velocity distributions finally we discuss the effects of molecular interactions slip boundary and heterogeneous viscosity density porous media geometry and surface wettability on apparent permeability and introduce an upscaling method of how to extend mds results to simulate liquid flow in nanoporous media flow through practical application 2 analysis model the stokes flow behaviors of liquid in circular pore can be defined by hp equation which is a classical physical law in describing incompressible newtonian liquid flow in the laminar flow state in eq 1 the velocity equation u r is expressed by hp type 1 u r r 2 r 2 4 μ b u l k δ p l where r is pore radius and r is distance from pore center μ bulk is bulk viscosity which is not affected by the wall force δ p l is pressure gradient then based on eq 1 the volume flux qhp can be calculated by velocity integration 2 q h p 0 r u r 2 π r d r π r 4 8 μ b u l k δ p l in nanopore the water flow behaviors are strongly affected by complicated molecular interactions which caused nanoscale effects of heterogeneous viscosity density and slip boundary heterogeneous viscosity density as shown in fig 1 a the water in nanopore is divided into near wall and bulk water and the viscosity and density between them are different the reason is that the near wall region is strongly affected by wall force as shown in table 1 according to the studies from mds the thickness of near wall water region can be assumed as about 0 7 nm for oil phase the thickness of near wall region is around 0 98 nm s wang et al 2016 slip boundary from fig 1b e the slip velocity increases with the decrease of solid water molecular attractions wettability is usually used to characterize water solid molecular interactions the stronger the molecular attractions the stronger the wettability of water and wettability can be quantitatively characterized by contact angle therefore the slip velocity can be related to the water solid molecular interactions through the contact angle the relationships can be summed up as slip velocity determined by water solid molecular interactions can be expressed by wettability can be characterized by contact angle because of nanoscale effects the conventional hp equation is not enough to characterize accurate flow behaviors and that needs to be modified by these nanoscale effects for liquid flow in a single nanopore we summarize and propose four models to characterize accurate flow behaviors which are region separation effective viscosity apparent viscosity and apparent slip length models the details of effective viscosity and apparent viscosity model are shown below and that of the region separation and apparent slip length models can be found in appendix a 2 1 effective viscosity model the heterogeneous viscosity in nanopores is usually expressed by area weighted effective viscosity thomas and mcgaughey 2008 then eq 1 can be modified as follows considering the effective viscosity and slip velocity 3 u eff r r 2 r 2 4 μ eff δ p l u slip where ueff is liquid velocity μ eff is effective viscosity and μ e f f μ w a l l a w a l l a t μ b u l k a b u l k a t awall abulk and awall are areas of the near wall region bulk region and total region of pore cross section μ wall is near wall viscosity which depends on wall force uslip is boundary slip velocity and that can be calculated by slip length ls and boundary velocity gradient for water phase l s c 1 cos θ 2 c is fitting parameter and c 0 41 in this paper wu et al 2017 θ is contact angle note the contact angle mentioned in this paper is only used to describe the wall wettability 4 u s l i p l s u w a l l r r r l s r 2 μ w a l l δ p l where uwall is near wall velocity based on the near wall viscosity μ wall from eqs 3 and 4 the velocity equation based on effective viscosity method is shown below 5 u e f f r r 2 r 2 4 μ e f f l s r 2 μ w a l l δ p l as calculated in eq 2 the volume flux qeff based on effective viscosity method can be calculated as 6 q e f f 0 r u e f f 2 π r d r π r 4 8 μ e f f π l s r 3 2 μ w a l l δ p l according to darcy s law u q e f f π r 2 k a p p e f f μ b u l k δ p l the apparent permeability is 7 k a p p e f f r 2 8 μ b u l k μ e f f l s r 2 μ b u l k μ w a l l 2 2 apparent viscosity model in our previous studies h wang et al 2019 the apparent viscosity was used to comprehensively consider the nanoscale effects in elliptic nanopores therefore based on apparent viscosity the hp flow equation considering nanoscale effects in circular nanopores is redefined 8 u a p p r r 2 r 2 4 μ a p p δ p l where uapp is liquid velocity μ app is apparent viscosity according to eq 8 the volume flux qapp can be calculated by velocity integration 9 q a p p 0 r u a p p 2 π r d r π r 4 8 μ a p p δ p l then based on the principle of equaling volume flux obtained by effective viscosity model and apparent viscosity model qeff qapp the apparent viscosity can be derived as 10 μ a p p r μ e f f μ w a l l r μ w a l l 4 μ e f f l s from darcy s law the apparent permeability k a p p a p p of apparent viscosity method can be calculated 11 k a p p a p p r 2 8 μ b u l k μ a p p 3 local apparent viscosity lattice boltzmann model in recent years how to realize the nanoscale effects in lbm has been of great interest t zhang et al 2020 w zhao et al 2020 j zhao et al 2018 t zhang et al 2020 based on the four theoretical models we can easily simulate the liquid flow in a single nanopore by lbm however in complex porous media the lbm based on region separation effective viscosity and apparent slip length models are difficult to accurately simulate the liquid slip flow behaviors and the detailed analysis has been given in the 4 1 model validation and appendix b section we then propose a nanoscale lbm to simulate the liquid flow in nanoporous media coupling apparent viscosity model the evolution equation of single component shan chen lbm used in this paper is given below 12 f α x e α δ t t δ t f α x t 1 τ f α x t f α e q x t where f α x t is function of density distribution at α direction x position and time t and α 0 1 2 18 represents nineteen directions of d3q19 model which is shown in fig 2 a e α is lattice velocity at α direction δ t is time step τ is relaxation time f α e q is equilibrium density distribution at α direction and that is determined by 13 f α e q w α ρ 1 e α u t c s 2 e α u t 2 2 c s 4 u t 2 2 c s 2 where w α is weight factors at α direction ρ is water density and ρ α f α c s c 3 is sound speed c δ x δ t is lattice speed δ x is space step δ t is time step and δ x δ t 1 the u t is given by 14 u t u τ f int f ads f b ρ where u is a composite macroscopic velocity u α e α f α τ ρ τ f int is interaction force between different phases f b is external body force they can be expressed as shan and chen 1993 15 f int x t ψ x t g w α w α ψ x e i δ t e i 16 f b f b x f b y f b z where gw is interaction strength ψ x t is pseudopotential the pseudopotential ψ is taken as ψ x t 1 exp ρ in our work f ads is the interaction force between liquid and solid wall and that can be assumed as decreasing exponentially with the distance from the pore walls benzi et al 2006 17 f ads x t g w s ψ x t α e x x a d s λ e i where gws is a parameter controlling the strength of liquid solid force x ads is vector perpendicular to pore wall λ is typical length scale controlling water solid interactions 0 3 nm d feng et al 2018 here the velocity and weight factors at nineteen directions are 18 e i 0 1 1 0 0 0 0 1 1 1 1 1 1 1 1 0 0 0 0 0 0 0 0 0 1 1 0 0 0 0 1 1 1 1 1 1 1 1 0 0 0 1 1 0 0 1 1 1 1 0 0 0 0 1 1 1 1 19 w α 1 3 1 18 1 36 α 0 α 1 2 3 4 5 6 α 7 8 9 10 11 12 13 14 15 16 17 18 the relaxation time τ is determined by liquid viscosity in lb model which is given by 20 τ x v c s 2 δ t 0 5 when the apparent liquid viscosity is used in lbm the relaxation time can be rewritten as 21 τ x v a p p x c s 2 δ t 0 5 in porous media the distance of a liquid point from pore wall is different for d3q19 model the distances of 19 directions from pore wall are different therefore the heterogeneous viscosity under influence of wall force is complicated in this paper we use local pore size r α x at α direction to calculate the local apparent viscosity of α direction 22 v a p p x r α x v α e f f x v w a l l r α x v w a l l 4 v α e f f x l s where r α x is half of the sum distance of α direction from the pore wall l α x and α direction from the pore wall l α x namely the local pore radius and r α x r α x 0 5 l α x l α x α is inverse direction of α v α eff x is local effective viscosity to obtain accurate local apparent viscosity the number of velocity directions is expanded from 19 to 75 which is closer to the isotropy of the lattice structure the d3q75 model is shown in fig 2b and it should be noted that d3q75 is only used to calculate local apparent viscosity and does not participate in liquid migration collision steps by weighting the apparent viscosity for 75 velocity directions the local apparent viscosity used in our simulation can be expressed as 23 v a p p x 1 n α 0 n r α x v α e f f x v w a l l r α x v w a l l 4 v α e f f x l s where n is number of velocity directions some velocity directions have no walls so the generalized n can be defined by n α 0 74 s x l α e α δ t s x l α e αδ t is a switch function that equals 0 for liquid phase and 1 for solid phase 4 model validation 4 1 analysis models comparison according to velocity equations of region separation effective viscosity apparent viscosity and apparent slip length models the velocity profiles in circular nanopores with contact angle equaling to 60 and 120 are shown in fig 3 a and b as shown in fig 3 the velocity profile characteristics of each model can be clearly observed fig 4 shows the relationship between the apparent permeability and contact angle with pore radius equaling to 2 5 nm and 5 nm the results indicate that the four models can accurately characterize the capacity of liquid flowing through nanoscale space for region separation model the velocity profile is divided into two regions that are near wall and bulk region respectively the velocity of near wall region strongly depends on liquid solid molecular interactions for effective viscosity apparent viscosity and apparent slip length models the heterogeneous viscosity is characterized by a constant viscosity then the velocity profiles are typically parabolic there are non zero boundary velocities in region separation effective viscosity and apparent slip length models which means if these three methods are applied to lbm the complicated slip boundary conditions need to be dealt with accurately however the slip boundary in complex porous media is difficult to obtain the velocity profile of apparent viscosity model has a zero boundary velocity and a constant viscosity which is easily realized in lbm therefore the apparent viscosity model can degenerate complex nanoscale flows into conventional hp flows with zero boundary slip and a constant viscosity 4 2 density distribution validation with mds first we use mds to calculate density distribution of hydrocarbon molecules in triangular nanopores and the water molecules in circular nanopores from borg s research borg et al 2018 then based on equal area rule the density area obtained by mds equals to that from lbm and molecular simulation density distribution the liquid solid interaction parameters in lbm are modified to fit the density distribution of mds the fitting results are shown in fig 5 then we can assume that the density distributions in mds have been successfully simulated by lbm there is a certain relationship between the density distribution and the wall contact angle in the nanopores as shown in eq 24 t zhang et al 2020 in lbm different density distributions can be obtained by modifying the liquid solid force parameters and then different contact angles can be obtained based on eq 24 at this point the density distribution liquid solid force parameters and contact angle can be transformed into each other in lbm as shown in fig 6 with different length scales in lbm physical length lphy length scale l 0 lattice length llattice and lattice length is the number of lattices in a calculating direction the contact angle increases with increase of liquid solid force parameter 24 ρ 1 ρ b 3 808 0 02 θ where ρ1 is the peak density ρ b is the bulk density the density distributions in pores with different pore shapes and the same cross sectional area are shown in fig 7 a then by selecting a critical density between near wall and bulk water regions the near wall region can be determined the near wall region in circular elliptic square and triangular pores are shown in fig 7b we can obviously see that the near wall areas at corners are significantly larger than that at the flat wall areas 4 3 velocity distribution validation with theory to validate the proposed model of lav lbm we performed water flow in 5 nm diameter nanopore simulations and compared the results to theoretical model a 50 lu lu is lattice length unit diameter circular nanopore is carried to simulate water flow under periodic boundary conditions and a pressure gradient is imposed by applying a body force which is chosen to ensure stokes flow the error for the velocity comparisons between lav lbm and theoretical model is defined error 100 qlbm qtheory qtheory and the volume flux qlbm and qtheory can be calculated by velocity integration fig 8 shows the velocity profile of lb simulations and theoretical calculations with water contact angles equaling to 60 and 120 compared with the theoretical model the errors simulated by lbm with contact angles equaling to 60 and 120 are 1 38 and 2 87 respectively with an acceptable error the velocity results obtained by lb simulations match well with the theoretical calculation results indicating that the lav lbm can accurately simulate liquid flow in nanopores 5 discussion 5 1 nanoscale effects and pore geometry in this section the effects of slip boundary heterogeneous viscosity density and surface wettability on apparent permeability are discussed based on the proposed lav lbm model and the results in pores with different radii are shown in fig 9 when the slip boundary and heterogeneous viscosity density are not taken into account the boundary velocity is 0 and the water viscosity and density do not change with the contact angle therefore the apparent permeability is constant with the increase of contact angle when the slip boundary and heterogeneous viscosity are considered the apparent permeability increases with the increase of contact angle when the contact angle is small less than about 90 the apparent permeability considering slip boundary and heterogeneous viscosity is smaller than that without considering nanoscale effects the reason is that the great near wall viscosity results in a decrease of apparent permeability on the contrary when the contact angle is greater than about 90 the apparent permeability is great because of the small near wall viscosity and great slip velocity as the heterogeneous density is considered compared to that only consider slip boundary and heterogeneous viscosity the apparent permeability slightly increases with the contact angle less than about 140 the reason is that at the same time the density of near wall region is larger than bulk density the volume flux will increase from darcy s law u q π r 2 k app μ bulk δ p l the apparent permeability increases when the contact angle is greater than about 140 the density of near wall region is less than that of bulk region therefore the volume flux decreases which results in the decrease of apparent permeability the critical contact angle of 90 140 is only for circular nanopores with pore radius equaling to 2 5 nm and 5 nm for the nanopores with different cross sectional shapes or porous media the critical contact angle may change however this critical contact angle is not important here just to show the heterogeneous viscosity density effects on apparent permeability we then carried out the simulations of water flow in nanopores with different cross sectional shapes and the same cross sectional area which are circle ellipse square and triangle the shape factor can be calculated by ξ a c 2 that equals 0 08 0 015 0 049 and 0 061 for circle ellipse square and triangle respectively the distributions of the local effective viscosity local apparent viscosity and velocity in these nanopores are shown in fig 10 fig 11 shows the effects of pore shapes and contact angle on apparent permeability under different cross sectional areas with a decrease of the shape factor and the contact angle the apparent permeability decreases 5 2 water flow in complex nanoporous media we construct three 3d nanoporous media with sizes equaling 17 5 17 5 17 5 nm3 17 5 17 5 17 5 nm3 and 21 21 21 nm3 respectively the nanoporous media models and the corresponding pore size distribution are shown in fig 12 a c and fig 13 a based on the proposed model the velocity of water flow in porous media can be obtained as shown in fig 12d f by integrating the velocity the apparent permeability can be calculated fig 13b shows the variation of apparent permeability with the contact angle with the increase of contact angle the slip boundary velocity increases gradually and the viscosity of near wall water decreases gradually then the apparent permeability increases results presented in fig 9 show that the apparent permeability values for the pore with r 5 nm are much larger than those for the pore with r 2 5 nm for contact angles in the range of 20 to about 140 matrix1 pore size distribution is much larger than those from matrix2 and matrix3 hence the apparent permeability values are expected to be much larger than those from matrix2 and matrix3 however the apparent permeability of matrix1 is smaller than that of matrix3 in addition to this matrix2 and matrix3 have comparable pore size distribution but the apparent permeability values from matrix3 are much larger than matrix2 the analysis reason is the influence of pore connectivity 5 3 shale oil flow in inorganic and organic nanoporous media based on the density and velocity distribution in inorganic and organic nanopores from mds s wang et al 2016 first we modify the liquid solid interaction parameter to obtain the same density distribution in lbm by the equal area rule the fitting results are shown in fig 14 then with external body force f b z equaling 1e 7 mu lu lt 2 and 1e 7 7 5 mu lu lt 2 in inorganic and organic nanopores respectively mu is lattice mass unit the oil c8h18 flow in inorganic and organic nanopores is simulated according to the volume flux calculated by integrating through velocity we obtain the desired velocity distribution which has the same volume flux as that of mds then the desired velocity distribution can be used to characterize the flow behaviors the oil flow behaviors in inorganic and organic nanopores have been successfully transferred from mds to lav lbm then based on lav lbm the oil flow in nanoporous media can be simulated the pore size in inorganic porous media is usually larger than that in organic porous media then we establish inorganic and organic porous media models with sizes equaling 35 35 35 nm2 respectively and the physical model and pore size distribution are shown in fig 15 a c the velocity distributions in porous media is also shown in fig 15d and e according to the molecular simulation results the slip length of 132 nm in organic pores is much larger than that of 1 nm in inorganic media the velocity distribution in organic porous media calculated by lav lbm is significantly larger than that in inorganic porous media based on velocity distribution integral and darcy s law the apparent permeabilities in inorganic and organic porous media can be calculated which are 1 648 μd and 31 663 μd respectively although there are complex chemical interactions between different liquids and the solid surface these in the end down to very simple macroscopic parameters such as the apparent viscosity slip boundary and other parameters which directly affect the velocity and density therefore based on the real velocity profile and density distribution obtained by mds any liquid on any surface the proposed lav lbm model in this paper can extend the single pore nanoscale flow to simulating liquid flow in nanoporous media which provides a research idea and an upscaling method to extend molecular simulation study based on a single pore scale to the study of lbm based on porous media scale simulation 6 conclusions the nanoscale effects slip boundary heterogeneous viscosity and density caused by molecular interactions in nanopores cannot be ignored and the slip velocity on complicated pore surfaces is difficult to be accurately treated by lb simulations in this paper based on the coupling method of theoretical model mds and lbm we put forward lav lbm to simulate the liquid flow in nanoporous media the proposed model considers nanoscale effects through apparent viscosity model then the complicated nanoscale flow behaviors can be reduced into the simple no slip flow through the validation of four theoretical models comparisons mds lbm density distributions and velocity distributions of theoretical model and lbm the results show that the proposed lav lbm model can effectively simulate the liquid flow behaviors in nanoscale space based on lav lbm simulation we discuss the effects of molecular interactions porous media size and wall wettability on apparent permeability by carrying out water flow in nanopores and nanoporous media the results show that when the contact angle is small the apparent permeability considering slip boundary and heterogeneous viscosity is smaller than that without considering the reason is that the near wall viscosity is higher than the bulk viscosity when the contact angle is great the apparent permeability increases because of the great slip length and small near wall viscosity the heterogeneous density has a influence on apparent permeability the reason is that the density of near wall liquid is different from that of bulk liquid then the volume flux changes with different contact angles according to darcy s law u q π r 2 k app μ bulk δ p l the apparent permeability changes then we introduce an upscaling method to extend single pore nanoscale flow into nanoporous media flow based on mds and lbm based on the velocity profile and density distribution in single pore obtained from mds the basic parameters in lav lbm model can be fitted then the lav lbm is used to simulate the liquid flow in nanoporous media and calculate the apparent permeability our works can extend the single pore flow into the nanoporous media flow which provides a research idea and basic model for the upscaling techniques from the molecular simulations physical model single pore to pore scale simulations physical model complicated nanoporous media based on real digital cores the permeability of oil water flow in shale porous media can be calculated which is beneficial for shale oil development in this paper although we have calculated the heterogeneous density distribution in porous media the near wall water is assumed as a whole with a constant viscosity different from bulk viscosity however the interaction force between solid and liquid molecules varies with the distance from the solid surface then the liquid viscosity will not be constant and has a certain relationship with the density distribution morciano et al morciano et al 2017 studied the hydrodynamic properties of liquid confined to a nanopore using mds and proposed a linear relationship between the density and viscosity in confined nanofluidic flows which will be used to improve the proposed model to ensure more accurate flow behaviors in porous media in our future work appendix a region separation model the liquid in nanopores is divided into near wall region and bulk region then the velocity of two regions can be expressed respectively velocity of near wall region a1 u w a l l y r 2 r 2 4 μ w a l l δ p l c 1 r δ r r velocity of bulk region a2 u bulk y r 2 r 2 4 μ bulk δ p l c 2 0 r r δ where uwall and ubulk are velocity of near wall and bulk regions c 1 and c 2 are parameters related to the slip boundary the boundary conditions are given by a3 l s u wall r r r u wall r r a4 u w a l l r r δ u b u l k r r δ accordingly the velocity of near wall and bulk regions can be expressed respectively a5 u w a l l y r 2 r 2 4 μ w a l l l s r 2 μ w a l l δ p l r δ r r a6 u b u l k r 2 r 2 4 μ b u l k r 2 r δ 2 4 μ w a l l r 2 r δ 2 4 μ b u l k l s r 2 μ w a l l δ p l 0 r r δ based on the velocity integral the total volume flux qrs can be calculated by a7 q r s 0 r δ u b u l k 2 π r d r r δ r u w a l l 2 π r d r π 8 μ b u l k r σ 2 r δ 2 μ b u l k μ w a l l 4 r δ 2 δ 2 4 μ b u l k l s r μ w a l l δ p l π 8 μ w a l l 2 r δ δ 2 2 r δ δ 2 4 l s r δ p l from darcy law u q rs π r 2 k app rs μ bulk δ p l the apparent permeability k a p p r s of region separation model can be calculated as a8 k a p p r s 1 8 r 2 r σ 2 r δ 2 μ b u l k μ w a l l 4 r δ 2 δ 2 4 μ b u l k l s r μ w a l l 1 8 r 2 μ b u l k μ w a l l 2 r δ δ 2 2 r δ δ 2 4 l s r apparent slip length model similar to apparent viscosity model the apparent slip length can be used to consider both slip boundary and heterogeneous viscosity then the conventional hp equation can be modified by a9 u a p p s l i p y r 2 r 2 4 μ b u l k l s a p p r 2 μ b u l k δ p l where u a p p s l i p is liquid velocity lsapp is the apparent slip length the volume flux q a p p s l i p can be calculated as a10 q a p p s l i p π r 4 8 μ b u l k π l s a p p r 3 2 μ b u l k δ p l according to the equal volume flux calculated by effective viscosity and apparent slip length models q a p p s l i p q e f f the apparent slip length can be expressed as a13 l s a p p r 4 μ b u l k μ e f f 1 l s μ b u l k μ w a l l then the apparent permeability k a p p s l i p of apparent slip length model can be defined by a14 k a p p s l i p r 2 4 l s a p p r 8 appendix b region separation lattice boltzmann model for water phase the difference of viscosities between bulk water and near wall water can be linked by the contact angle that is a15 τ w a l l τ b u l k 0 5 0 018 θ 3 25 0 5 through our previous research w wang et al 2021 the coupled boundary condition bounce back and diffusive maxwell s reflection dbb is most suitable for simulating slip flow in porous media with zigzag walls a16 f α 1 r σ f α r σ f α e q u w a l l where f α is the post collision density distribution function in the α direction and α is the inverse direction of α u wall is the wall velocity r σ is a combination parameter to characterize the degree of the slip based on eqs a15 and a16 the slip boundary and the viscosity of near wall water can be incorporated into lbm we then use the theoretical region separation model to verify lb simulations velocity profiles with contact angles equaling 30 and 140 are shown in fig a1 the velocity obtained by lb simulation fits well with that calculated by theoretical region separation model therefore the proposed model can obtain the true velocity profile although dbb is most suitable for simulating slip flow in porous media with zigzag walls the slip length at the zigzag walls cannot be accurately characterized by dbb boundary conditions as shown in fig a2 a and b we establish two porous media models with the same porosity one with regular cube solid matrix and the other with complex pore structure the porous media size is 18 2 18 2 18 2 nm3 then we simulate water flow in these two porous media when combination parameter r σ 1 9921 the corresponding slip length is 78 nm and the corresponding velocity distributions are shown in fig a2 c and d as shown in fig a3 for water flows in porous media with complex pore structure zigzag walls the apparent permeability calculated by this method will be greatly underestimated declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments the authors acknowledge china scholarship council csc for the financial support provided to han wang this study was supported by the national natural science foundation of china 51974348 51804328 the national science and technology major project of china zd2019 183 007 all data presented in this paper are available from the authors upon request wanghan petro gmail com suyuliang upc edu cn and wwdong upc edu cn credit authorship contribution statement han wang conceptualization formal analysis investigation methodology software writing original draft writing review editing yuliang su conceptualization methodology writing review editing wendong wang validation writing review editing 
138,understanding the mechanisms of nanoconfined liquid flow in nanoporous media is crucial for many scientific and engineering applications such as enhanced shale oil recovery and water purification however due to molecular interactions which cause slip boundary and heterogeneous viscosity density in nanoscale space the conventional continuity equations are no longer applicable besides the pore size in popular molecular dynamics simulation mds is too small to meet the engineering application and the pore scale lattice boltzmann method lbm is difficult to accurately consider molecular interactions in complicated nanoporous media in this work we summarize and establish four theoretical models for liquid flow in nanopores which are region separation model effective viscosity model apparent viscosity model and apparent slip length model then through comparative analysis we indicate that the apparent viscosity model is most suitable for coupling lbm based on apparent viscosity model which comprehensively considers slip boundary and heterogeneous viscosity density we present a local apparent viscosity lbm lav lbm to simulate liquid flow in nanoporous media according to lav lbm simulations the effects of molecular interactions porous media geometry and wall wettability on apparent permeability of water flow in nanoporous media are discussed finally we couple mds results with the proposed model to calculate apparent permeability of shale oil flow in inorganic and organic media which provides a basic model for the upscaling method from molecule scale to pore scale simulations keywords nanoporous media molecular interactions slip boundary heterogeneous viscosity density local apparent viscosity lbm permeability nomenclature physical units abulk bulk region area nm2 f ads liquid solid interaction force awall near wall region area nm2 f int phase interaction force at cross sectional area of pore nm2 f b external body force c fitting parameter dimensionless gw phase interaction strength parameter c 1 parameter related to slip boundary nm s gws liquid solid interaction force parameter c 2 parameter related to slip boundary nm s l α distance from pore wall from α direction k permeability μd n number of velocity directions ls slip length nm r σ combination parameter lsapp apparent slip length nm r α pore radius in porous media δp l pressure gradient mpa nm s switch function q volume flux nm3 s t time r pore radius nm u macroscopic velocity r distance from pore center nm v lattice viscosity u velocity nm s vapp local apparent viscosity uslip slip velocity nm s v α eff local effective viscosity μ app apparent viscosity mpa s x position μ bulk bulk viscosity mpa s x ads vector perpendicular to pore wall μ wall near wall viscosity mpa s α discrete direction μ eff effective viscosity mpa s δ x space step θ contact angle o δ t time step δ thickness of near wall region nm λ typical length of water lattice units w α weight factor cs sound speed τ relaxation time c lattice speed τ wall relaxation time of near wall region e i lattice velocity vector τ bulk relaxation time of bulk region f function of density distribution ψ pseudopotential f α e q equilibrium density distribution ρ density 1 introduction the liquid flow in nanoscale space is of great significance for many scientific and engineering applications such as water desalination and filter gravelle et al 2013 das et al 2014 drug delivery geng et al 2014 energy storage and conversion siria et al 2013 and unconventional oil gas recovery sun et al 2020 in nanoscale space the liquid solid molecular interactions cause the nanoscale effects of slip boundary secchi et al 2016 heterogeneous viscosity and density s wang et al 2016 kelly et al 2015 then the conventional continuity macroscopic method based on navier stokes equations cannot be used to characterize liquid flow behaviors accurately t zhang et al 2020 compared with a single nanopore the shale nanoporous media has complex wall wettability pore size distributions and pore geometries therefore the shale oil or water flow behaviors will be more complicated zolfaghari et al 2017 however the modeling of liquid in complicated nanoporous media remains out of research because of molecular interaction effects the slip velocity on the solid wall can be observed from mds s wang et al 2016 zhan et al 2020 sam et al 2018 he et al 2019 the slip velocity can be calculated by slip length and velocity gradient the slip length mainly depends on molecular interactions and the wall wettability is usually used to define strength of molecular interactions wu et al 2017 according to the generalized relationship between the slip length and contact angle huang et al 2008 wu et al wu et al 2017 obtained a formula of water slip length and contact angle by fitting data from molecular simulations and experiments the slip length generally ranges from nanometer to micron level jason and holt 2006 qin et al 2011 kannam et al 2012 kannam et al 2013 majumder et al majumder et al 2005 indicated a 39 68 μm slip length for a 7 nm carbon nanotube cnt the flow enhancement factor is usually used to measure the slip effects on liquid flow capacity which is defined by the ratio of volume flux of slip flow to the classical no slip flow predictions the flow enhancement factor can usually be up to 107 times on an ideal smooth solid wall wu et al 2017 for heterogeneous viscosity and density according to density distributions from mds there are about two molecular layers strongly affected by solid molecular force and the region of these two molecular layers is defined by near wall region while the other region is far away from the wall is bulk region s wang et al 2016 neek amal et al 2016 the viscosity and density of the near wall region are different from that of the bulk region and that depend on the wettability from mds and experimental results wu et al wu et al 2017 obtained the relationship between the near wall viscosity bulk viscosity and contact angle zhang et al t zhang et al 2020 corrected the near wall density bulk density and contact angle as a simple linear relationship by mds results d feng et al 2018 under the effects of varying near wall viscosity and density the flow enhancement factor is affected in the range 0 1 10 times several modified theoretical models can be used to characterize nanoscale flow mattia et al mattia and calabrò 2012 and zhang et al q zhang et al 2017 applied hagen poiseuille hp equations to express the liquid velocities in near wall region and bulk region respectively and that is called the region separation model in our paper thomas et al thomas and mcgaughey 2008 applied an effective viscosity to characterize the heterogeneous viscosity then wu et al wu et al 2017 modified the conventional hp equations by the effective viscosity and slip velocity in our previous work h wang et al 2019 we used an apparent viscosity to comprehensively characterize the slip boundary and heterogeneous viscosity and then studied the enhanced water flow behaviors in elliptic pores however the current researches on the flow behaviors in nanoscale spaces are mostly based on single nanopores wu et al 2019 w zhao et al 2020 which are failing to reflect the flow behaviors in complicated porous media although wang et al h wang et al 2019 and zhang et al t zhang et al 2017 used capillary bundle model to study liquid flow in nanoporous media the capillary bundle model is also based on the theory in single nanopores which could not reflect the properties of complex pore connectivity and geometric structure in real porous media in addition to theoretical models several simulation methods of mds lbm and pore network model pnm are widely used to model liquid flow in nanoscale space sun et al 2020 w song et al 2020 song et al 2018 mds is often used to simulate the flow behaviors chemical reactions and other problems in nanoscale space based on the real molecular interaction force and to clarify the internal micro mechanisms from molecular scale the results are generally reliable recently zhan et al zhan et al 2020 used non equilibrium mds to study the water oil two phase flow in nanopores and based on the mds results the theoretical equation based on hp equation is modified lynch et al lynch et al 2020 explored the dynamic behaviors of water within nanopores and biological channels in lipid bilayer membranes from a molecular simulation perspective wang et al wang et al 2020 applied mds to study the pressure driven flow behaviors of methane through different nanoscale spaces and based on the simulation results the slip corrected poiseuille equation is obtained although mds can capture the molecular interactions at the micro level it cannot meet the macroscopic scale required by engineering applications due to it s small size and the excessive resource consumption pnm is also a popular pore scale simulation method at present because of the fast computational framework and permit simulations on large volumes of pores and scholars have carried out a lot of studies on liquid flow based on pnm golparvar et al 2018 wang et al 2017 yi et al 2017 however pnm reduces the complex pore geometry to a simple spherical and cylindrical model then it results in inaccurate prediction of flow behaviors to overcome these shortcomings in recent years mesoscopic lbm has been evaluated as an effective tool to study liquid flow in nanoporous media zhang et al 2021 which has the advantages of easy handling of complex boundary conditions reducing computational resources through parallel computation and simple algorithm yu et al 2019 zhang et al 2015 landry et al 2016 h wang et al 2021 j zhao et al 2018 zhang and crawford 2016 through considering the slip boundary and effective viscosity zhao et al j zhao et al 2018 studied the flow behaviors of liquid in nanoporous media however the solid matrix used in their simulation model is regular and the slip boundary condition is no longer applicable to real solid geometry zhang et al t zhang et al 2020 proposed a novel mesoscopic lbm to capture the density distribution and non parabolic velocity profile of water through nanochannels some scholars have combined the advantages of pnm and lbm to predict liquid flow behaviors j zhao et al 2020 miao et al miao et al 2017 predict the hydraulic conductance of the 3292 pore element with different cross sections by training neural networks then they proposed a new pnm without pore shape simplifications song et al w song et al 2020 ran a large number of simulations of liquid flow in high resolution geometries with simple cross sections and surface roughness based on a local effective viscosity lattice boltzmann method and established gas flux corrections depending on shape knudsen number and surface roughness then they took the corrections into pnm to account for all of those properties zhao et al j zhao et al 2020 extracted the real pore throat geometry without simplification and used lattice boltzmann lb simulations to modify liquid flow properties in these pores however the slip boundary conditions in their lbm has the limitation for irregular surface in lb simulations the correct slip boundary conditions are the key to ensuring the accuracy of prediction of liquid flow characteristics in recent years researchers have conducted a large number of studies on slip boundary of lbm slip boundary conditions include bounce back bb specular reflection sr and diffused maxwell reflection dm wang et al 2018 however these boundary conditions have some shortcomings such as numerical error failure to fit analytical results and overestimation of slip velocity in order to overcome the above limitations the coupling boundary conditions of bb sr bsr dm sr and dm bb were proposed guo et al 2011 szalmás 2006 these coupling boundary conditions can be accurately applied to smooth boundary straight wall but cannot be perfectly applied to the complex curved boundary in natural porous media especially considering both slip condition and viscosity heterogeneity we recently applied bgk lbm with half way bounce back and diffusive maxwell s reflection hbb dm to simulate the water flow in complex nanoporous media although this boundary condition can achieve small slip velocity on curved walls the numerical instability will occur for large slip velocity w wang et al 2021 in this paper we summarize and establish four theoretical models to characterize the liquid flow in nanopores then it is concluded that the apparent viscosity model is more suitable as a basic theoretical model coupling lbm then we propose a local apparent viscosity lbm lav lbm to degenerate slip flow in nanoporous media with complicated pore structures into the conventional no slip flow which can overcome the difficulty of slip boundary treatment in lbm in addition the density distribution in nanoporous media is also considered the proposed model is verified by comparisons of four theoretical models mds lbm density distributions and theory lbm velocity distributions finally we discuss the effects of molecular interactions slip boundary and heterogeneous viscosity density porous media geometry and surface wettability on apparent permeability and introduce an upscaling method of how to extend mds results to simulate liquid flow in nanoporous media flow through practical application 2 analysis model the stokes flow behaviors of liquid in circular pore can be defined by hp equation which is a classical physical law in describing incompressible newtonian liquid flow in the laminar flow state in eq 1 the velocity equation u r is expressed by hp type 1 u r r 2 r 2 4 μ b u l k δ p l where r is pore radius and r is distance from pore center μ bulk is bulk viscosity which is not affected by the wall force δ p l is pressure gradient then based on eq 1 the volume flux qhp can be calculated by velocity integration 2 q h p 0 r u r 2 π r d r π r 4 8 μ b u l k δ p l in nanopore the water flow behaviors are strongly affected by complicated molecular interactions which caused nanoscale effects of heterogeneous viscosity density and slip boundary heterogeneous viscosity density as shown in fig 1 a the water in nanopore is divided into near wall and bulk water and the viscosity and density between them are different the reason is that the near wall region is strongly affected by wall force as shown in table 1 according to the studies from mds the thickness of near wall water region can be assumed as about 0 7 nm for oil phase the thickness of near wall region is around 0 98 nm s wang et al 2016 slip boundary from fig 1b e the slip velocity increases with the decrease of solid water molecular attractions wettability is usually used to characterize water solid molecular interactions the stronger the molecular attractions the stronger the wettability of water and wettability can be quantitatively characterized by contact angle therefore the slip velocity can be related to the water solid molecular interactions through the contact angle the relationships can be summed up as slip velocity determined by water solid molecular interactions can be expressed by wettability can be characterized by contact angle because of nanoscale effects the conventional hp equation is not enough to characterize accurate flow behaviors and that needs to be modified by these nanoscale effects for liquid flow in a single nanopore we summarize and propose four models to characterize accurate flow behaviors which are region separation effective viscosity apparent viscosity and apparent slip length models the details of effective viscosity and apparent viscosity model are shown below and that of the region separation and apparent slip length models can be found in appendix a 2 1 effective viscosity model the heterogeneous viscosity in nanopores is usually expressed by area weighted effective viscosity thomas and mcgaughey 2008 then eq 1 can be modified as follows considering the effective viscosity and slip velocity 3 u eff r r 2 r 2 4 μ eff δ p l u slip where ueff is liquid velocity μ eff is effective viscosity and μ e f f μ w a l l a w a l l a t μ b u l k a b u l k a t awall abulk and awall are areas of the near wall region bulk region and total region of pore cross section μ wall is near wall viscosity which depends on wall force uslip is boundary slip velocity and that can be calculated by slip length ls and boundary velocity gradient for water phase l s c 1 cos θ 2 c is fitting parameter and c 0 41 in this paper wu et al 2017 θ is contact angle note the contact angle mentioned in this paper is only used to describe the wall wettability 4 u s l i p l s u w a l l r r r l s r 2 μ w a l l δ p l where uwall is near wall velocity based on the near wall viscosity μ wall from eqs 3 and 4 the velocity equation based on effective viscosity method is shown below 5 u e f f r r 2 r 2 4 μ e f f l s r 2 μ w a l l δ p l as calculated in eq 2 the volume flux qeff based on effective viscosity method can be calculated as 6 q e f f 0 r u e f f 2 π r d r π r 4 8 μ e f f π l s r 3 2 μ w a l l δ p l according to darcy s law u q e f f π r 2 k a p p e f f μ b u l k δ p l the apparent permeability is 7 k a p p e f f r 2 8 μ b u l k μ e f f l s r 2 μ b u l k μ w a l l 2 2 apparent viscosity model in our previous studies h wang et al 2019 the apparent viscosity was used to comprehensively consider the nanoscale effects in elliptic nanopores therefore based on apparent viscosity the hp flow equation considering nanoscale effects in circular nanopores is redefined 8 u a p p r r 2 r 2 4 μ a p p δ p l where uapp is liquid velocity μ app is apparent viscosity according to eq 8 the volume flux qapp can be calculated by velocity integration 9 q a p p 0 r u a p p 2 π r d r π r 4 8 μ a p p δ p l then based on the principle of equaling volume flux obtained by effective viscosity model and apparent viscosity model qeff qapp the apparent viscosity can be derived as 10 μ a p p r μ e f f μ w a l l r μ w a l l 4 μ e f f l s from darcy s law the apparent permeability k a p p a p p of apparent viscosity method can be calculated 11 k a p p a p p r 2 8 μ b u l k μ a p p 3 local apparent viscosity lattice boltzmann model in recent years how to realize the nanoscale effects in lbm has been of great interest t zhang et al 2020 w zhao et al 2020 j zhao et al 2018 t zhang et al 2020 based on the four theoretical models we can easily simulate the liquid flow in a single nanopore by lbm however in complex porous media the lbm based on region separation effective viscosity and apparent slip length models are difficult to accurately simulate the liquid slip flow behaviors and the detailed analysis has been given in the 4 1 model validation and appendix b section we then propose a nanoscale lbm to simulate the liquid flow in nanoporous media coupling apparent viscosity model the evolution equation of single component shan chen lbm used in this paper is given below 12 f α x e α δ t t δ t f α x t 1 τ f α x t f α e q x t where f α x t is function of density distribution at α direction x position and time t and α 0 1 2 18 represents nineteen directions of d3q19 model which is shown in fig 2 a e α is lattice velocity at α direction δ t is time step τ is relaxation time f α e q is equilibrium density distribution at α direction and that is determined by 13 f α e q w α ρ 1 e α u t c s 2 e α u t 2 2 c s 4 u t 2 2 c s 2 where w α is weight factors at α direction ρ is water density and ρ α f α c s c 3 is sound speed c δ x δ t is lattice speed δ x is space step δ t is time step and δ x δ t 1 the u t is given by 14 u t u τ f int f ads f b ρ where u is a composite macroscopic velocity u α e α f α τ ρ τ f int is interaction force between different phases f b is external body force they can be expressed as shan and chen 1993 15 f int x t ψ x t g w α w α ψ x e i δ t e i 16 f b f b x f b y f b z where gw is interaction strength ψ x t is pseudopotential the pseudopotential ψ is taken as ψ x t 1 exp ρ in our work f ads is the interaction force between liquid and solid wall and that can be assumed as decreasing exponentially with the distance from the pore walls benzi et al 2006 17 f ads x t g w s ψ x t α e x x a d s λ e i where gws is a parameter controlling the strength of liquid solid force x ads is vector perpendicular to pore wall λ is typical length scale controlling water solid interactions 0 3 nm d feng et al 2018 here the velocity and weight factors at nineteen directions are 18 e i 0 1 1 0 0 0 0 1 1 1 1 1 1 1 1 0 0 0 0 0 0 0 0 0 1 1 0 0 0 0 1 1 1 1 1 1 1 1 0 0 0 1 1 0 0 1 1 1 1 0 0 0 0 1 1 1 1 19 w α 1 3 1 18 1 36 α 0 α 1 2 3 4 5 6 α 7 8 9 10 11 12 13 14 15 16 17 18 the relaxation time τ is determined by liquid viscosity in lb model which is given by 20 τ x v c s 2 δ t 0 5 when the apparent liquid viscosity is used in lbm the relaxation time can be rewritten as 21 τ x v a p p x c s 2 δ t 0 5 in porous media the distance of a liquid point from pore wall is different for d3q19 model the distances of 19 directions from pore wall are different therefore the heterogeneous viscosity under influence of wall force is complicated in this paper we use local pore size r α x at α direction to calculate the local apparent viscosity of α direction 22 v a p p x r α x v α e f f x v w a l l r α x v w a l l 4 v α e f f x l s where r α x is half of the sum distance of α direction from the pore wall l α x and α direction from the pore wall l α x namely the local pore radius and r α x r α x 0 5 l α x l α x α is inverse direction of α v α eff x is local effective viscosity to obtain accurate local apparent viscosity the number of velocity directions is expanded from 19 to 75 which is closer to the isotropy of the lattice structure the d3q75 model is shown in fig 2b and it should be noted that d3q75 is only used to calculate local apparent viscosity and does not participate in liquid migration collision steps by weighting the apparent viscosity for 75 velocity directions the local apparent viscosity used in our simulation can be expressed as 23 v a p p x 1 n α 0 n r α x v α e f f x v w a l l r α x v w a l l 4 v α e f f x l s where n is number of velocity directions some velocity directions have no walls so the generalized n can be defined by n α 0 74 s x l α e α δ t s x l α e αδ t is a switch function that equals 0 for liquid phase and 1 for solid phase 4 model validation 4 1 analysis models comparison according to velocity equations of region separation effective viscosity apparent viscosity and apparent slip length models the velocity profiles in circular nanopores with contact angle equaling to 60 and 120 are shown in fig 3 a and b as shown in fig 3 the velocity profile characteristics of each model can be clearly observed fig 4 shows the relationship between the apparent permeability and contact angle with pore radius equaling to 2 5 nm and 5 nm the results indicate that the four models can accurately characterize the capacity of liquid flowing through nanoscale space for region separation model the velocity profile is divided into two regions that are near wall and bulk region respectively the velocity of near wall region strongly depends on liquid solid molecular interactions for effective viscosity apparent viscosity and apparent slip length models the heterogeneous viscosity is characterized by a constant viscosity then the velocity profiles are typically parabolic there are non zero boundary velocities in region separation effective viscosity and apparent slip length models which means if these three methods are applied to lbm the complicated slip boundary conditions need to be dealt with accurately however the slip boundary in complex porous media is difficult to obtain the velocity profile of apparent viscosity model has a zero boundary velocity and a constant viscosity which is easily realized in lbm therefore the apparent viscosity model can degenerate complex nanoscale flows into conventional hp flows with zero boundary slip and a constant viscosity 4 2 density distribution validation with mds first we use mds to calculate density distribution of hydrocarbon molecules in triangular nanopores and the water molecules in circular nanopores from borg s research borg et al 2018 then based on equal area rule the density area obtained by mds equals to that from lbm and molecular simulation density distribution the liquid solid interaction parameters in lbm are modified to fit the density distribution of mds the fitting results are shown in fig 5 then we can assume that the density distributions in mds have been successfully simulated by lbm there is a certain relationship between the density distribution and the wall contact angle in the nanopores as shown in eq 24 t zhang et al 2020 in lbm different density distributions can be obtained by modifying the liquid solid force parameters and then different contact angles can be obtained based on eq 24 at this point the density distribution liquid solid force parameters and contact angle can be transformed into each other in lbm as shown in fig 6 with different length scales in lbm physical length lphy length scale l 0 lattice length llattice and lattice length is the number of lattices in a calculating direction the contact angle increases with increase of liquid solid force parameter 24 ρ 1 ρ b 3 808 0 02 θ where ρ1 is the peak density ρ b is the bulk density the density distributions in pores with different pore shapes and the same cross sectional area are shown in fig 7 a then by selecting a critical density between near wall and bulk water regions the near wall region can be determined the near wall region in circular elliptic square and triangular pores are shown in fig 7b we can obviously see that the near wall areas at corners are significantly larger than that at the flat wall areas 4 3 velocity distribution validation with theory to validate the proposed model of lav lbm we performed water flow in 5 nm diameter nanopore simulations and compared the results to theoretical model a 50 lu lu is lattice length unit diameter circular nanopore is carried to simulate water flow under periodic boundary conditions and a pressure gradient is imposed by applying a body force which is chosen to ensure stokes flow the error for the velocity comparisons between lav lbm and theoretical model is defined error 100 qlbm qtheory qtheory and the volume flux qlbm and qtheory can be calculated by velocity integration fig 8 shows the velocity profile of lb simulations and theoretical calculations with water contact angles equaling to 60 and 120 compared with the theoretical model the errors simulated by lbm with contact angles equaling to 60 and 120 are 1 38 and 2 87 respectively with an acceptable error the velocity results obtained by lb simulations match well with the theoretical calculation results indicating that the lav lbm can accurately simulate liquid flow in nanopores 5 discussion 5 1 nanoscale effects and pore geometry in this section the effects of slip boundary heterogeneous viscosity density and surface wettability on apparent permeability are discussed based on the proposed lav lbm model and the results in pores with different radii are shown in fig 9 when the slip boundary and heterogeneous viscosity density are not taken into account the boundary velocity is 0 and the water viscosity and density do not change with the contact angle therefore the apparent permeability is constant with the increase of contact angle when the slip boundary and heterogeneous viscosity are considered the apparent permeability increases with the increase of contact angle when the contact angle is small less than about 90 the apparent permeability considering slip boundary and heterogeneous viscosity is smaller than that without considering nanoscale effects the reason is that the great near wall viscosity results in a decrease of apparent permeability on the contrary when the contact angle is greater than about 90 the apparent permeability is great because of the small near wall viscosity and great slip velocity as the heterogeneous density is considered compared to that only consider slip boundary and heterogeneous viscosity the apparent permeability slightly increases with the contact angle less than about 140 the reason is that at the same time the density of near wall region is larger than bulk density the volume flux will increase from darcy s law u q π r 2 k app μ bulk δ p l the apparent permeability increases when the contact angle is greater than about 140 the density of near wall region is less than that of bulk region therefore the volume flux decreases which results in the decrease of apparent permeability the critical contact angle of 90 140 is only for circular nanopores with pore radius equaling to 2 5 nm and 5 nm for the nanopores with different cross sectional shapes or porous media the critical contact angle may change however this critical contact angle is not important here just to show the heterogeneous viscosity density effects on apparent permeability we then carried out the simulations of water flow in nanopores with different cross sectional shapes and the same cross sectional area which are circle ellipse square and triangle the shape factor can be calculated by ξ a c 2 that equals 0 08 0 015 0 049 and 0 061 for circle ellipse square and triangle respectively the distributions of the local effective viscosity local apparent viscosity and velocity in these nanopores are shown in fig 10 fig 11 shows the effects of pore shapes and contact angle on apparent permeability under different cross sectional areas with a decrease of the shape factor and the contact angle the apparent permeability decreases 5 2 water flow in complex nanoporous media we construct three 3d nanoporous media with sizes equaling 17 5 17 5 17 5 nm3 17 5 17 5 17 5 nm3 and 21 21 21 nm3 respectively the nanoporous media models and the corresponding pore size distribution are shown in fig 12 a c and fig 13 a based on the proposed model the velocity of water flow in porous media can be obtained as shown in fig 12d f by integrating the velocity the apparent permeability can be calculated fig 13b shows the variation of apparent permeability with the contact angle with the increase of contact angle the slip boundary velocity increases gradually and the viscosity of near wall water decreases gradually then the apparent permeability increases results presented in fig 9 show that the apparent permeability values for the pore with r 5 nm are much larger than those for the pore with r 2 5 nm for contact angles in the range of 20 to about 140 matrix1 pore size distribution is much larger than those from matrix2 and matrix3 hence the apparent permeability values are expected to be much larger than those from matrix2 and matrix3 however the apparent permeability of matrix1 is smaller than that of matrix3 in addition to this matrix2 and matrix3 have comparable pore size distribution but the apparent permeability values from matrix3 are much larger than matrix2 the analysis reason is the influence of pore connectivity 5 3 shale oil flow in inorganic and organic nanoporous media based on the density and velocity distribution in inorganic and organic nanopores from mds s wang et al 2016 first we modify the liquid solid interaction parameter to obtain the same density distribution in lbm by the equal area rule the fitting results are shown in fig 14 then with external body force f b z equaling 1e 7 mu lu lt 2 and 1e 7 7 5 mu lu lt 2 in inorganic and organic nanopores respectively mu is lattice mass unit the oil c8h18 flow in inorganic and organic nanopores is simulated according to the volume flux calculated by integrating through velocity we obtain the desired velocity distribution which has the same volume flux as that of mds then the desired velocity distribution can be used to characterize the flow behaviors the oil flow behaviors in inorganic and organic nanopores have been successfully transferred from mds to lav lbm then based on lav lbm the oil flow in nanoporous media can be simulated the pore size in inorganic porous media is usually larger than that in organic porous media then we establish inorganic and organic porous media models with sizes equaling 35 35 35 nm2 respectively and the physical model and pore size distribution are shown in fig 15 a c the velocity distributions in porous media is also shown in fig 15d and e according to the molecular simulation results the slip length of 132 nm in organic pores is much larger than that of 1 nm in inorganic media the velocity distribution in organic porous media calculated by lav lbm is significantly larger than that in inorganic porous media based on velocity distribution integral and darcy s law the apparent permeabilities in inorganic and organic porous media can be calculated which are 1 648 μd and 31 663 μd respectively although there are complex chemical interactions between different liquids and the solid surface these in the end down to very simple macroscopic parameters such as the apparent viscosity slip boundary and other parameters which directly affect the velocity and density therefore based on the real velocity profile and density distribution obtained by mds any liquid on any surface the proposed lav lbm model in this paper can extend the single pore nanoscale flow to simulating liquid flow in nanoporous media which provides a research idea and an upscaling method to extend molecular simulation study based on a single pore scale to the study of lbm based on porous media scale simulation 6 conclusions the nanoscale effects slip boundary heterogeneous viscosity and density caused by molecular interactions in nanopores cannot be ignored and the slip velocity on complicated pore surfaces is difficult to be accurately treated by lb simulations in this paper based on the coupling method of theoretical model mds and lbm we put forward lav lbm to simulate the liquid flow in nanoporous media the proposed model considers nanoscale effects through apparent viscosity model then the complicated nanoscale flow behaviors can be reduced into the simple no slip flow through the validation of four theoretical models comparisons mds lbm density distributions and velocity distributions of theoretical model and lbm the results show that the proposed lav lbm model can effectively simulate the liquid flow behaviors in nanoscale space based on lav lbm simulation we discuss the effects of molecular interactions porous media size and wall wettability on apparent permeability by carrying out water flow in nanopores and nanoporous media the results show that when the contact angle is small the apparent permeability considering slip boundary and heterogeneous viscosity is smaller than that without considering the reason is that the near wall viscosity is higher than the bulk viscosity when the contact angle is great the apparent permeability increases because of the great slip length and small near wall viscosity the heterogeneous density has a influence on apparent permeability the reason is that the density of near wall liquid is different from that of bulk liquid then the volume flux changes with different contact angles according to darcy s law u q π r 2 k app μ bulk δ p l the apparent permeability changes then we introduce an upscaling method to extend single pore nanoscale flow into nanoporous media flow based on mds and lbm based on the velocity profile and density distribution in single pore obtained from mds the basic parameters in lav lbm model can be fitted then the lav lbm is used to simulate the liquid flow in nanoporous media and calculate the apparent permeability our works can extend the single pore flow into the nanoporous media flow which provides a research idea and basic model for the upscaling techniques from the molecular simulations physical model single pore to pore scale simulations physical model complicated nanoporous media based on real digital cores the permeability of oil water flow in shale porous media can be calculated which is beneficial for shale oil development in this paper although we have calculated the heterogeneous density distribution in porous media the near wall water is assumed as a whole with a constant viscosity different from bulk viscosity however the interaction force between solid and liquid molecules varies with the distance from the solid surface then the liquid viscosity will not be constant and has a certain relationship with the density distribution morciano et al morciano et al 2017 studied the hydrodynamic properties of liquid confined to a nanopore using mds and proposed a linear relationship between the density and viscosity in confined nanofluidic flows which will be used to improve the proposed model to ensure more accurate flow behaviors in porous media in our future work appendix a region separation model the liquid in nanopores is divided into near wall region and bulk region then the velocity of two regions can be expressed respectively velocity of near wall region a1 u w a l l y r 2 r 2 4 μ w a l l δ p l c 1 r δ r r velocity of bulk region a2 u bulk y r 2 r 2 4 μ bulk δ p l c 2 0 r r δ where uwall and ubulk are velocity of near wall and bulk regions c 1 and c 2 are parameters related to the slip boundary the boundary conditions are given by a3 l s u wall r r r u wall r r a4 u w a l l r r δ u b u l k r r δ accordingly the velocity of near wall and bulk regions can be expressed respectively a5 u w a l l y r 2 r 2 4 μ w a l l l s r 2 μ w a l l δ p l r δ r r a6 u b u l k r 2 r 2 4 μ b u l k r 2 r δ 2 4 μ w a l l r 2 r δ 2 4 μ b u l k l s r 2 μ w a l l δ p l 0 r r δ based on the velocity integral the total volume flux qrs can be calculated by a7 q r s 0 r δ u b u l k 2 π r d r r δ r u w a l l 2 π r d r π 8 μ b u l k r σ 2 r δ 2 μ b u l k μ w a l l 4 r δ 2 δ 2 4 μ b u l k l s r μ w a l l δ p l π 8 μ w a l l 2 r δ δ 2 2 r δ δ 2 4 l s r δ p l from darcy law u q rs π r 2 k app rs μ bulk δ p l the apparent permeability k a p p r s of region separation model can be calculated as a8 k a p p r s 1 8 r 2 r σ 2 r δ 2 μ b u l k μ w a l l 4 r δ 2 δ 2 4 μ b u l k l s r μ w a l l 1 8 r 2 μ b u l k μ w a l l 2 r δ δ 2 2 r δ δ 2 4 l s r apparent slip length model similar to apparent viscosity model the apparent slip length can be used to consider both slip boundary and heterogeneous viscosity then the conventional hp equation can be modified by a9 u a p p s l i p y r 2 r 2 4 μ b u l k l s a p p r 2 μ b u l k δ p l where u a p p s l i p is liquid velocity lsapp is the apparent slip length the volume flux q a p p s l i p can be calculated as a10 q a p p s l i p π r 4 8 μ b u l k π l s a p p r 3 2 μ b u l k δ p l according to the equal volume flux calculated by effective viscosity and apparent slip length models q a p p s l i p q e f f the apparent slip length can be expressed as a13 l s a p p r 4 μ b u l k μ e f f 1 l s μ b u l k μ w a l l then the apparent permeability k a p p s l i p of apparent slip length model can be defined by a14 k a p p s l i p r 2 4 l s a p p r 8 appendix b region separation lattice boltzmann model for water phase the difference of viscosities between bulk water and near wall water can be linked by the contact angle that is a15 τ w a l l τ b u l k 0 5 0 018 θ 3 25 0 5 through our previous research w wang et al 2021 the coupled boundary condition bounce back and diffusive maxwell s reflection dbb is most suitable for simulating slip flow in porous media with zigzag walls a16 f α 1 r σ f α r σ f α e q u w a l l where f α is the post collision density distribution function in the α direction and α is the inverse direction of α u wall is the wall velocity r σ is a combination parameter to characterize the degree of the slip based on eqs a15 and a16 the slip boundary and the viscosity of near wall water can be incorporated into lbm we then use the theoretical region separation model to verify lb simulations velocity profiles with contact angles equaling 30 and 140 are shown in fig a1 the velocity obtained by lb simulation fits well with that calculated by theoretical region separation model therefore the proposed model can obtain the true velocity profile although dbb is most suitable for simulating slip flow in porous media with zigzag walls the slip length at the zigzag walls cannot be accurately characterized by dbb boundary conditions as shown in fig a2 a and b we establish two porous media models with the same porosity one with regular cube solid matrix and the other with complex pore structure the porous media size is 18 2 18 2 18 2 nm3 then we simulate water flow in these two porous media when combination parameter r σ 1 9921 the corresponding slip length is 78 nm and the corresponding velocity distributions are shown in fig a2 c and d as shown in fig a3 for water flows in porous media with complex pore structure zigzag walls the apparent permeability calculated by this method will be greatly underestimated declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments the authors acknowledge china scholarship council csc for the financial support provided to han wang this study was supported by the national natural science foundation of china 51974348 51804328 the national science and technology major project of china zd2019 183 007 all data presented in this paper are available from the authors upon request wanghan petro gmail com suyuliang upc edu cn and wwdong upc edu cn credit authorship contribution statement han wang conceptualization formal analysis investigation methodology software writing original draft writing review editing yuliang su conceptualization methodology writing review editing wendong wang validation writing review editing 
139,climate change is expected to have a significant impact on water security with higher temperatures causing both enhanced droughts and flood extremes here using global flow data from non urban catchments we investigate the sensitivity of flood volume to changes in concurrent surface air temperature we find most of the world shows decreases in flood volumes with increasing temperature to understand why this correlation exists we assess the sensitivity of the above result to mean daily temperatures climate region catchment size and severity of the flood event our results indicate that most of the world shows decreases in flood volume with rising temperature for frequent events 50th percentile in this study and a lesser decrease for rarer events changes in the flood volume in tropical regions show the greatest sensitivity to flood percentiles and catchment size large catchments in the tropics 1000 km2 have considerable sensitivities of flood volume with temperature at rates of 10 to 5 c for frequent events 90th percentile whereas small catchments 1000 km2 have sensitivities that only 5 c or greater i e less magnitude on the other hand when temperature increases smaller catchments in the regions are likely to be exposed to more severe flooding at rates up to 15 c for the most severe floods 99 99 percentile in this study while the rate for large catchments approach zero although this study does not seek to find a causality between air temperature and flood runoff the results suggest a possible decrease in water security with climate change particularly in large tropical catchments keywords scaling flood volume temperature climate change clausius clapeyron cc relationship 1 introduction the impact of climate change on the water cycle continues to be a topic of debate donat et al 2016 koutsoyiannis 2020 it is generally expected that precipitation extremes will increase fowler et al 2021 but across large parts of the world flood magnitudes have declined do et al 2017 meanwhile on average mean rainfalls are predicted to increase but so is the occurrence of drought and hence water scarcity most increases in rainfalls have been observed over the tropics beck et al 2019 with decreases elsewhere while most warming is occurring over the land relative to the oceans leading to climate change affecting different parts of the world disproportionally rising temperatures will intensify heavy rainfall events fowler et al 2021 craig 2010 trenberth et al 2003 kim et al 2022 as the atmospheric moisture holding capacity increases as per the clausius clapeyron c c relation westra et al 2014 magan et al 2020 due to the cc relationship there is a 6 7 c increase in the saturation vapor pressure creating a corresponding increase in the maximum amount of low level moisture in the atmosphere held and soden 2006 assuming constant relative humidity lenderink and attema 2015 this can be translated to a similar increase in extreme precipitation with higher temperatures sun et al 2021 a measure that has been termed scaling or sensitivity expressed in c units in the literature trenberth et al 2003 as long lasting or intense precipitation is often the main cause of pluvial flooding smith and ward 1998 such positive scaling estimates along with precipitation trends have been used to suggest future increases in flooding ivancic and shaw 2015 seneviratne et al 2012 kundzewicz et al 2014 field et al 2012a this is despite the considerable uncertainty associated with future precipitation projections kim et al 2020 hosseinzadehtalaei et al 2017 and little observational evidence to suggest that flood magnitudes have increased field et al 2012b hirabayashi et al 2013 in fact observational records often present more evidence for a decrease in annual flood maxima do et al 2017 wasko and nathan 2019 gudmundsson et al 2019 despite increases in precipitation with climate change being well documented westra et al 2014 sun et al 2021 alexander et al 2006 for example shen and chui 2021a found that both scaling in extreme precipitation and streamflow across the continental united states conus are not always on the same direction depending on whether the extreme streamflow is more correspondent to extreme precipitation or other factors processes like soil moisture and snowmelt the inconsistency in both precipitation and streamflow scaling was also identified in south and central asia ghausi and ghosh 2020 where daily scaling of extreme precipitation becomes negative at high temperature while extreme streamflow scaling against temperature remains strongly positive however shen and chui 2021b found that flood temperature scaling is often similar to that of extreme precipitation temperature from an analysis for three different hydroclimatic regions in the united states for short durations and impervious surfaces indeed an evaluation of historical trends across australia where smaller floods have been decreasing and larger floods increasing found good agreement with peak flow temperature sensitivities wasko 2021 in addition to flood control milly et al 2008 water resource management has been argued to be under threat as temperatures rise worldwide karr 1991 lenzen and foran 2001 while some studies have found increases in streamflow globally labat et al 2004 probst and tardy 1987 an overall drying trend was found using the largest 925 rivers around the world accounting for 73 of global runoff by dai et al 2009 consistent with milliman et al 2008 who used a sample representing approximately half of the world s discharge indeed higher annual temperatures have been linked to lower annual streamflows milly et al 2018 and higher seasonal temperatures to greater water insecurity hettiarachchi et al 2022 although wasko and sharma 2017 found negative peak flood scaling with temperature for frequent flood events whether this translates into a reduction of water availability and water supply reliability remains an open question given the importance of flood volume in ensuring water supply reliability in reservoir systems worldwide this study builds off the above mentioned negative flood scaling results to focus on flood volume and address the following questions 1 does there exist consistency in the scaling relationship for flood peak and flood volume 2 if inconsistent what factors can be correlated to the different pattern of change for flood volumes compared to peaks and 3 what implications do these scaling relationships have on water security both in the context of flood insecurity and more importantly given the focus on flood volumes on water supply insecurity worldwide 2 data streamflow data from anthropogenically unaffected catchments from across the world sourced from the global runoff data centre grdc dataset grdc 2015 are used in this study the grdc dataset provides daily streamflow for 6946 stations worldwide and has been successfully used in multiple global studies do et al 2017 lee et al 2015 milly et al 2018 wasko et al 2020 the global historical climatology network ghcn dataset is used to provide daily air temperature and daily rainfall to the corresponding station in the grdc dataset menne et al 2012a 2012b although the temperature data used for this study is at the point scale wasko and sharma 2017 and wasko et al 2021 have showed that a scaling analysis using point based data produces consistency in results when compared to catchment based estimates for the grdc dataset we applied the following processing before the analyses first to minimize anthropogenic effects we only considered catchments in which less than 10 of the surface area has been modified and total extractions or regulations do not exceed 5 of the mean annual flow wasko and sharma 2017 second since the temperature streamflow behaviour is affected by snowmelt we focused our analysis to reduce the impact snowmelt may have on the results consequently only flood events for which the average daily temperature was greater than 5 c were used to assess the sensitivity of this choice a 10 c threshold was also considered and found to produce a similar distribution of scaling lastly we only used grdc stations with more than 100 flood events as separated by the algorithm described in section 3 given these requirements a total of 4665 streamflow stations were used in formulating the results presented in later sections as depicted in fig 1 3 methods we applied a three step approach in sequence for calculating the flood peak and volume scaling for each catchment 1 baseflow separation from an observed entire hydrograph 2 identification of flood events from the remaining quickflow 3 quantile regression of flood events with their corresponding observed temperature each step is detailed below 3 1 baseflow separation the baseflow represents the part of the observed streamflow arising from groundwater storage that is independent of the immediate precipitation event as the intent here is to assess the flood volume resulting due to the precipitation event itself that is the quickflow a baseflow separation algorithm is applied a conceptual diagram of this algorithm is presented in fig 2 a to separate the baseflow from the streamflow hydrographs we adopted a one parameter low pass filter chapman and maxwell 1996 where the baseflow is expressed recursively as 1 b k a 2 a b k 1 1 a 2 a y k where yk is the original streamflow for the kth sampling instant bk is the filtered baseflow response for the kth sampling instant b k 1 is the filtered baseflow response for the previously filtered baseflow for the kth sampling instant and a is the filter parameter given by the recession constant the parameter a controls the smoothness of the filter that is the higher a is the smoother the baseflow is we selected a as 0 925 nathan and mcmahon 1990 and the initial bk as the minimal value in each hydrograph furey and gupta 2001 sensitivity analyses of the baseflow separation parameters described above did not make considerable differences in the results not shown although the single parameter recursive filter is simple compared to multi parameter approaches it has shown comparable performance in many existing studies chapman 1999 eckhardt 2005 indeed partington et al 2012 found through a comprehensive evaluation of various methods that no separation method was clearly superior 3 2 flood identification the concept of flood event identification is illustrated in fig 2a to define the start and end time of flood events we first identified all three point convexities shaped like a v in the quickflow hydrograph as candidates for the start time of flood events tang and carey 2017 wasko and guo 2022 here the three point convex represents a point that exhibits a decrease followed by an increase for the first two identified convex points p1 and p2 if the maximum flow between the two points is greater than twice of the flow values at both p1 and p2 i e 50 threshold then p1 and p2 are regarded as the start and end time of the event respectively and the maximum flow in between becomes the peak for the flood event when the criterion is not met points are sequentially considered until an end time is identified an example of baseflow separation from a real hydrograph of a grdc station is presented in fig s4 in the supporting information hereafter the prefix s for a figure or table caption represents materials in supporting information once an end time is identified the next search starts using a convex point at least 10 days after the previously identified end time the 10 day threshold ensures independence between two flood events otherwise the two events are regarded as a single event wasko and sharma 2017 in the case an end time for the start time p1 is not identified p1 is discarded and a new search is performed using p2 as the start time we carried out additional tests with two different thresholds 5 and 15 days and found that the results were not considerably different to change the conclusion made throughout this study results for both thresholds are presented as figs s5 s8 in the supporting information along with descriptions in the captions of figs 4 and 5 we used three point convexities as start and endpoints of flood events in general a flood event ends at the inflection point in the recession of hydrograph nathan and mcmahon 1990 but the flood separation algorithm does not guarantee a flood end at such inflection points and occasionally the flood ends at a point further in time which may result in extra water volume in the flood event however as we subtracted the baseflow this extra volume is minimal a visual inspection found that the 50 threshold used for identifying the starting and ending points with relation to the flood peaks properly captured most flood events fig 2b presents the proportion of annual inflow that is composed of the annual flood volume for the catchments we subdivide the world based on the mean daily climatic temperature t region 1 t 16 c region 2 16 t 24 c and region 3 t 24 c see section 4 2 for the details of separating the three regions for most parts of the world flood volumes make up a significant proportion of annual flow 20 50 and by extension water supply security lal 2015 the proportion of annual flood volume is lowest in the cold region region 1 indicating a more dominant contribution by the baseflow a relatively high flood volume to inflow ratio exists for regions 2 and 3 which represent warmer tropical sub tropical climates fig 2b notably as detailed in section 4 region 3 has a considerably negative temperature flood volume scaling indicating that flood volumes are most important to water supply security in those parts of the world which are the warmest 3 3 quantile regression the scaling α represents the rate of change of a response variable with respect to a warming surrogate such as surface air temperature roderick et al 2020 here scaling was calculated using quantile regression on log transformed volume and peak data with surface air temperature as the warming surrogate in the absence of snowmelt linearity was confirmed enabling quantile regression to be used wasko et al 2019 the scaling coefficient hence represents the temperature flood volume or peak sensitivity which can be interpreted as how the variable of interest at a specific percentile is sensitive to the temperature in terms of its magnitude and sign consider a set of data pairs xi y for i 1 n where xi represents surface temperature observations and yi the flood volume or flood peak following the procedures adopted for robust sample estimates of the scaling coefficient magan et al 2020 hao et al 2007 wasko and sharma 2014 scaling is estimated using quantile regression quantile regression enables formulation of a regression relationship for a specified quantile 2 y i β 0 p β 1 p x i ε i p where yi and xi represents a data pair relating the response and the temperature surrogate used p is the percentile in the range between 0 and 1 and ε i p is an error term with zero expectation the parameter β 0 p a n d β 1 p are chosen to minimise the value d 3 d β 0 p β 1 p p y i β 0 p β 1 p y i β 0 p β 1 p x i 1 p y i β 0 p β 1 p y i β 0 p β 1 p x i the slope of the scaling relationship is given by β 1 p following wasko and sharma 2014 the scaling coefficient can be ascertained as α 10 β 1 p 1 and expressed as percent increase decrease of flood peak volume per degree celsius here we used the daily air temperature concurrent with the flood peak we obtained scaling values for each station for varying percentiles the higher a percentile is the more extreme a flood event is in general we primarily focus on the scaling for the 50th percentile as that represents frequent floods that contribute most to water supply security sharma et al 2018 4 results and discussion 4 1 flood volume and flood peak scaling we begin by presenting the 50th percentile volume and peak scaling at each station as the 50th percentile represents frequent flood events that are of interest here fig 3 to aid visualisation point estimates were spatially interpolated over the two dimensional space using bilinear interpolation with the original point estimates and the spatially interpolated maps of scaling presented in figs s1 s3 in supporting information mostly negative volume scaling is present when results are assessed at a global scale fig 3a the exception to this is for mexico south africa china and northern australia which are predominately located in tropical and sub tropical regions hence flood volumes and water supply storage that is largely a function of frequent flood events is less with higher temperatures the global map of flood peak scaling fig 3b has a very similar distribution to the volume scaling in both magnitude and spatial distribution this suggests that flood volume and flood peaks broadly scale with the same sign consistent with previous studies gudmundsson et al 2019 wasko et al 2020 which found temporal trends in various streamflow indices shifting in the same direction albeit with different magnitude moreover the scaling presented here matches the recent historical declines in mean streamflow observed in southern australia southern europe and large parts of the u s gudmundsson et al 2019 fig 3c presents the difference between volume and peak scaling i e volume minus peak the volume scaling is generally more negative negative scaling and higher magnitude or less positive positive scaling but lower magnitude than peak scaling over the regions including middle america south eastern africa and north eastern australia in contrast the volume scaling is more positive or less negative red than peak scaling over the south of amazon and parts of indonesia the above results suggest that firstly the volume of frequent floods generally decreases with a rise in temperature and secondly that the rate of decrease is broadly consistent with that of the peak within the flood hydrograph this suggests that there is a uniform proportional decrease in the entire flood hydrograph instead of just the flood peak consistent with previous studies gudmundsson et al 2019 implying a reduction of water supply security with higher temperatures however there are also many regions where this is not the case and higher temperatures are associated with increased flood volumes fig 3c a more detailed investigation of these differences is now presented 4 2 sensitivity of volume and peak scaling the earlier result confirmed the correspondence between changes in flood peaks with those in flood volumes as a function of surface air temperatures worldwide a further assessment of the similarities and differences in the two sets of scaling results as a function of catchment characteristics is presented in fig 4 since we focus on the impact of higher temperatures on water resources we continue to investigate the 50th percentiles of volume and peak scaling except for fig 4d where the scaling trends with percentiles are shown the volume scaling is generally more negative than the peak scaling regardless of the catchment characteristics fig 4a d consistent with the results presented in fig 3 fig 4a shows that the scaling rate varies greatly with the mean daily temperature for each location which is used here to demarcate climatic regions as depicted in fig 4a two mean daily temperature t thresholds 16 and 24 c enable grouping the stations into three regions region 1 represents colder climates region 2 moderate and region 3 a warm tropical climate there are 3062 991 and 612 stations in the regions respectively the most notable changes in both peak and volume scaling are in regions 2 and 3 there is a large decrease in the scaling in region 3 where climatic temperatures are above 24 c representing the major tropical catchments of the world fig 1 however the scaling does not necessarily exhibit much variability with mean daily rainfall fig 4b catchment area fig 4c and event rarity fig 4d this suggests the primary driver of differences in volume and peak scaling is temperature variability with catchment area a secondary factor both flood peak and volume scaling tend to be closer to zero less negative with larger catchments fig 4c and more rare flood events fig 4d this implies that flood peaks and volumes associated with extreme flood events and larger catchments are less likely to be impacted by temperature changes given the relationships observed in the present study do et al 2017 showed that flood peaks tend to decrease for larger catchments this however is not necessarily of use from a water supply security perspective as such extreme floods are often spilled or conveyed downstream of a reservoir to reduce the risk of failure furthermore the volume of more frequent floods constituting the annual water storage in a reservoir is reducing at a greater rate than the flood peak this is to be expected if the reduction in both the peak and volume is a result of drying soil conditions preceding the causative precipitation event the scaling presented for flood volumes matches the dynamic trends of streamflow that recent and past studies have reported all over the world zhang et al 2001 showed that the annual mean streamflow from hundreds of catchments in canada region 1 i e mean daily temperature 16 c has generally decreased during the periods from the 1960s to 1990s milly et al 2005 presented clear differences in global streamflow changes for the late 20th century along the latitude where the trends over the tropics are slightly negative or close to zero and the high latitude areas generally present positive trends gudmundsson et al 2019 reported decreases in mean streamflow over southern australia southern europe and large parts of the u s mostly region 1 and partly region 2 fig 5 presents the volume scaling estimates as a function of the rarity of the flood events separately for the global a and regions 1 2 and 3 b to d to generate these results all volume scaling values were standardised by the mean and aggregated for the stations in selected regions to form a single dataset the dataset was then grouped by small 1000 km2 large 1000 km2 and all catchments quantile regressions were fitted to the datasets for small large and all catchments from the 10th to 99 99th percentiles and the standard error was set as the confidence interval fig 5a shows that the overall volume scaling is negative at low percentiles and approaches zero with higher 99 99th percentiles although with wider confidence intervals the volume scaling of small catchments is more negative at lower percentiles compared to large catchments and goes to zero or slightly positive at or higher than the 99 99th percentile in agreement with wasko and sharma 2017 where positive scaling was found for the peak flows only for the most extreme percentiles however this overall tendency to greater scaling for smaller catchments is quite different in each of the three regions in region 1 fig 5b the pattern is similar to that in fig 5a but the scaling is below zero in region 2 fig 5c which is the sub tropical region both groups of small and large catchments have near zero scaling and tend to be more uncertain at higher percentiles in region 3 fig 5d which is largely tropical the volume scaling of smaller catchments is less negative than that of large catchments at percentiles lower than the 99 9th percentile and then has larger positive scaling greater than that of large catchments at percentiles greater than the 99 9th percentile these results imply that large catchments in region 3 may face considerably decreased volumes of frequent flooding and hence face greater water insecurity at higher temperatures while smaller catchments are exposed to more extreme floods with increasing temperatures ivancic and shaw 2015 sharma et al 2018 the differing scaling with catchment size in different regions may be due to the loss with initial soil moisture condition ivancic and shaw 2015 showed that flooding is closely related to the antecedent soil moisture condition of catchments a finding that has implications for water security in the future fitsum and ashish 2016 maity et al 2013 and dorigo et al 2012 showed drying trends of satellite soil moisture data over 20 years across more than 70 of the earth as there is enough initial soil moisture in the temperate region the loss is small on the contrary in the tropical region the loss due to catchment size is significant because initial soil moisture is small ivancic and shaw 2015 which may result in smaller catchments having less negative volume scaling compared to large catchments this tendency is well presented in fig 5a showing the overall negative volume scaling at 99 and below percentiles a distinct exception is observed in the high percentile cases for small catchments located in region 3 fig 5d here the initial soil moisture condition contributes less to the extreme floods for small catchments ivancic and shaw 2015 but the rainfall tends to be more intense than other regions adler et al 2018 5 conclusions in this study we did not seek to find a causality between air temperature and flood runoff rather based on the assumption that flood volume is representative of water resources augmentation in supply systems this study investigated the flood volume temperature sensitivity represented by scaling α at a global scale as a measure of water supply security we identified three key findings in the framework of the flood volume temperature sensitivity as follows first in most regions except for some tropical and sub tropical regions including mexico south africa china and northern australia the volume of flood events decreases as temperature increases with a similar global spatial distribution to the peak scaling this reinforces the findings in gudmundsson et al 2019 and wasko et al 2020 who found similar historical trends in a range of streamflow indices suggesting the entire flow distribution is either increasing or decreasing the results here correspond to milly et al 2018 who found decreases in annual streamflow with higher annual temperatures second the volume scaling tends to be closer to zero with larger catchment sizes and higher flood percentiles which means that flood volumes associated with extreme floods or larger catchments are less sensitive to increasing temperature when considering the sign positive negative of both peak and volume scaling are generally concurrent this pattern conforms to the tendency of streamflow peak scaling reported in wasko and sharma 2017 where the peak scaling approaches to zero with higher percentiles and larger catchments shows less negative scaling at the 50th percentile one of the reasons for the different scaling with catchment size in different regions is due to the volume loss with initial soil moisture condition ivancic and shaw 2015 third the volume scaling behaviour varies with region as defined by the mean daily climatic temperature t here the globe was divided into three regions thresholding by t region 1 t 16 c region 2 16 t 24 c and region 3 t 24 c notably in region 3 generally considered tropical the volume of frequent floods the 90th percentile for large catchments 1000 km2 decreases more than that of small catchments with increasing temperature however for rare floods the 90th percentile the flood volume for the large catchments is less sensitive to the increasing temperature i e α close to zero while the small catchments present considerably increasing flood volume α approximately 10 c the effect of the hydrologic loss for large catchments is greater due to drier soils ivancic and shaw 2015 sharma et al 2018 dorigo et al 2012 these results suggest that large catchments in region 3 are more likely to face water scarcity while small catchments are more vulnerable to extreme flooding the results of this study have implications for water resources management it was demonstrated that the volume of inflow associated with typical flood events is decreasing as temperature increases around the world translated to a yearly time scale this implies reservoirs are receiving lower inflow than before and that the reduction in the flood peak is generally a good surrogate to the change in reservoir inflow when coupled with the increase in demand for water from agriculture and the environment expected to compensate for the effect of drier soils one is left with a water supply system that has reduced inputs and increased outputs nguyen et al 2020 demonstrated that reservoir systems will become markedly insecure based on climate model projections of the future even if water demand remains unchanged the findings reported here point in the same direction but using observed flow records alone and relating change to the change in temperature this offers a different means of assessing changes in water supply security due to temperature rise than the traditional alternatives currently in place that require reservoir storage to be quantified usually on an annual time scale reducing the number of observations available to detect changes in reservoir volume with time credit authorship contribution statement wei he validation formal analysis investigation data curation writing original draft visualization seokhyeon kim conceptualization methodology writing review editing project administration supervision conrad wasko conceptualization methodology writing review editing funding acquisition ashish sharma conceptualization methodology writing review editing supervision funding acquisition supervision declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments conrad wasko receives funding from the university of melbourne mckenzie postdoctoral fellowships program and arc project de210100479 this research was partially supported by a discovery project dp200101326 assessing water supply security in a nonstationary environment funded by the australian research council ghcn and grdc data are freely available from http dx doi org 10 7289 v5d21vhz and https www bafg de grdc respectively supplementary materials supplementary material associated with this article can be found in the online version at doi 10 1016 j advwatres 2022 104241 appendix supplementary materials image application 1 
139,climate change is expected to have a significant impact on water security with higher temperatures causing both enhanced droughts and flood extremes here using global flow data from non urban catchments we investigate the sensitivity of flood volume to changes in concurrent surface air temperature we find most of the world shows decreases in flood volumes with increasing temperature to understand why this correlation exists we assess the sensitivity of the above result to mean daily temperatures climate region catchment size and severity of the flood event our results indicate that most of the world shows decreases in flood volume with rising temperature for frequent events 50th percentile in this study and a lesser decrease for rarer events changes in the flood volume in tropical regions show the greatest sensitivity to flood percentiles and catchment size large catchments in the tropics 1000 km2 have considerable sensitivities of flood volume with temperature at rates of 10 to 5 c for frequent events 90th percentile whereas small catchments 1000 km2 have sensitivities that only 5 c or greater i e less magnitude on the other hand when temperature increases smaller catchments in the regions are likely to be exposed to more severe flooding at rates up to 15 c for the most severe floods 99 99 percentile in this study while the rate for large catchments approach zero although this study does not seek to find a causality between air temperature and flood runoff the results suggest a possible decrease in water security with climate change particularly in large tropical catchments keywords scaling flood volume temperature climate change clausius clapeyron cc relationship 1 introduction the impact of climate change on the water cycle continues to be a topic of debate donat et al 2016 koutsoyiannis 2020 it is generally expected that precipitation extremes will increase fowler et al 2021 but across large parts of the world flood magnitudes have declined do et al 2017 meanwhile on average mean rainfalls are predicted to increase but so is the occurrence of drought and hence water scarcity most increases in rainfalls have been observed over the tropics beck et al 2019 with decreases elsewhere while most warming is occurring over the land relative to the oceans leading to climate change affecting different parts of the world disproportionally rising temperatures will intensify heavy rainfall events fowler et al 2021 craig 2010 trenberth et al 2003 kim et al 2022 as the atmospheric moisture holding capacity increases as per the clausius clapeyron c c relation westra et al 2014 magan et al 2020 due to the cc relationship there is a 6 7 c increase in the saturation vapor pressure creating a corresponding increase in the maximum amount of low level moisture in the atmosphere held and soden 2006 assuming constant relative humidity lenderink and attema 2015 this can be translated to a similar increase in extreme precipitation with higher temperatures sun et al 2021 a measure that has been termed scaling or sensitivity expressed in c units in the literature trenberth et al 2003 as long lasting or intense precipitation is often the main cause of pluvial flooding smith and ward 1998 such positive scaling estimates along with precipitation trends have been used to suggest future increases in flooding ivancic and shaw 2015 seneviratne et al 2012 kundzewicz et al 2014 field et al 2012a this is despite the considerable uncertainty associated with future precipitation projections kim et al 2020 hosseinzadehtalaei et al 2017 and little observational evidence to suggest that flood magnitudes have increased field et al 2012b hirabayashi et al 2013 in fact observational records often present more evidence for a decrease in annual flood maxima do et al 2017 wasko and nathan 2019 gudmundsson et al 2019 despite increases in precipitation with climate change being well documented westra et al 2014 sun et al 2021 alexander et al 2006 for example shen and chui 2021a found that both scaling in extreme precipitation and streamflow across the continental united states conus are not always on the same direction depending on whether the extreme streamflow is more correspondent to extreme precipitation or other factors processes like soil moisture and snowmelt the inconsistency in both precipitation and streamflow scaling was also identified in south and central asia ghausi and ghosh 2020 where daily scaling of extreme precipitation becomes negative at high temperature while extreme streamflow scaling against temperature remains strongly positive however shen and chui 2021b found that flood temperature scaling is often similar to that of extreme precipitation temperature from an analysis for three different hydroclimatic regions in the united states for short durations and impervious surfaces indeed an evaluation of historical trends across australia where smaller floods have been decreasing and larger floods increasing found good agreement with peak flow temperature sensitivities wasko 2021 in addition to flood control milly et al 2008 water resource management has been argued to be under threat as temperatures rise worldwide karr 1991 lenzen and foran 2001 while some studies have found increases in streamflow globally labat et al 2004 probst and tardy 1987 an overall drying trend was found using the largest 925 rivers around the world accounting for 73 of global runoff by dai et al 2009 consistent with milliman et al 2008 who used a sample representing approximately half of the world s discharge indeed higher annual temperatures have been linked to lower annual streamflows milly et al 2018 and higher seasonal temperatures to greater water insecurity hettiarachchi et al 2022 although wasko and sharma 2017 found negative peak flood scaling with temperature for frequent flood events whether this translates into a reduction of water availability and water supply reliability remains an open question given the importance of flood volume in ensuring water supply reliability in reservoir systems worldwide this study builds off the above mentioned negative flood scaling results to focus on flood volume and address the following questions 1 does there exist consistency in the scaling relationship for flood peak and flood volume 2 if inconsistent what factors can be correlated to the different pattern of change for flood volumes compared to peaks and 3 what implications do these scaling relationships have on water security both in the context of flood insecurity and more importantly given the focus on flood volumes on water supply insecurity worldwide 2 data streamflow data from anthropogenically unaffected catchments from across the world sourced from the global runoff data centre grdc dataset grdc 2015 are used in this study the grdc dataset provides daily streamflow for 6946 stations worldwide and has been successfully used in multiple global studies do et al 2017 lee et al 2015 milly et al 2018 wasko et al 2020 the global historical climatology network ghcn dataset is used to provide daily air temperature and daily rainfall to the corresponding station in the grdc dataset menne et al 2012a 2012b although the temperature data used for this study is at the point scale wasko and sharma 2017 and wasko et al 2021 have showed that a scaling analysis using point based data produces consistency in results when compared to catchment based estimates for the grdc dataset we applied the following processing before the analyses first to minimize anthropogenic effects we only considered catchments in which less than 10 of the surface area has been modified and total extractions or regulations do not exceed 5 of the mean annual flow wasko and sharma 2017 second since the temperature streamflow behaviour is affected by snowmelt we focused our analysis to reduce the impact snowmelt may have on the results consequently only flood events for which the average daily temperature was greater than 5 c were used to assess the sensitivity of this choice a 10 c threshold was also considered and found to produce a similar distribution of scaling lastly we only used grdc stations with more than 100 flood events as separated by the algorithm described in section 3 given these requirements a total of 4665 streamflow stations were used in formulating the results presented in later sections as depicted in fig 1 3 methods we applied a three step approach in sequence for calculating the flood peak and volume scaling for each catchment 1 baseflow separation from an observed entire hydrograph 2 identification of flood events from the remaining quickflow 3 quantile regression of flood events with their corresponding observed temperature each step is detailed below 3 1 baseflow separation the baseflow represents the part of the observed streamflow arising from groundwater storage that is independent of the immediate precipitation event as the intent here is to assess the flood volume resulting due to the precipitation event itself that is the quickflow a baseflow separation algorithm is applied a conceptual diagram of this algorithm is presented in fig 2 a to separate the baseflow from the streamflow hydrographs we adopted a one parameter low pass filter chapman and maxwell 1996 where the baseflow is expressed recursively as 1 b k a 2 a b k 1 1 a 2 a y k where yk is the original streamflow for the kth sampling instant bk is the filtered baseflow response for the kth sampling instant b k 1 is the filtered baseflow response for the previously filtered baseflow for the kth sampling instant and a is the filter parameter given by the recession constant the parameter a controls the smoothness of the filter that is the higher a is the smoother the baseflow is we selected a as 0 925 nathan and mcmahon 1990 and the initial bk as the minimal value in each hydrograph furey and gupta 2001 sensitivity analyses of the baseflow separation parameters described above did not make considerable differences in the results not shown although the single parameter recursive filter is simple compared to multi parameter approaches it has shown comparable performance in many existing studies chapman 1999 eckhardt 2005 indeed partington et al 2012 found through a comprehensive evaluation of various methods that no separation method was clearly superior 3 2 flood identification the concept of flood event identification is illustrated in fig 2a to define the start and end time of flood events we first identified all three point convexities shaped like a v in the quickflow hydrograph as candidates for the start time of flood events tang and carey 2017 wasko and guo 2022 here the three point convex represents a point that exhibits a decrease followed by an increase for the first two identified convex points p1 and p2 if the maximum flow between the two points is greater than twice of the flow values at both p1 and p2 i e 50 threshold then p1 and p2 are regarded as the start and end time of the event respectively and the maximum flow in between becomes the peak for the flood event when the criterion is not met points are sequentially considered until an end time is identified an example of baseflow separation from a real hydrograph of a grdc station is presented in fig s4 in the supporting information hereafter the prefix s for a figure or table caption represents materials in supporting information once an end time is identified the next search starts using a convex point at least 10 days after the previously identified end time the 10 day threshold ensures independence between two flood events otherwise the two events are regarded as a single event wasko and sharma 2017 in the case an end time for the start time p1 is not identified p1 is discarded and a new search is performed using p2 as the start time we carried out additional tests with two different thresholds 5 and 15 days and found that the results were not considerably different to change the conclusion made throughout this study results for both thresholds are presented as figs s5 s8 in the supporting information along with descriptions in the captions of figs 4 and 5 we used three point convexities as start and endpoints of flood events in general a flood event ends at the inflection point in the recession of hydrograph nathan and mcmahon 1990 but the flood separation algorithm does not guarantee a flood end at such inflection points and occasionally the flood ends at a point further in time which may result in extra water volume in the flood event however as we subtracted the baseflow this extra volume is minimal a visual inspection found that the 50 threshold used for identifying the starting and ending points with relation to the flood peaks properly captured most flood events fig 2b presents the proportion of annual inflow that is composed of the annual flood volume for the catchments we subdivide the world based on the mean daily climatic temperature t region 1 t 16 c region 2 16 t 24 c and region 3 t 24 c see section 4 2 for the details of separating the three regions for most parts of the world flood volumes make up a significant proportion of annual flow 20 50 and by extension water supply security lal 2015 the proportion of annual flood volume is lowest in the cold region region 1 indicating a more dominant contribution by the baseflow a relatively high flood volume to inflow ratio exists for regions 2 and 3 which represent warmer tropical sub tropical climates fig 2b notably as detailed in section 4 region 3 has a considerably negative temperature flood volume scaling indicating that flood volumes are most important to water supply security in those parts of the world which are the warmest 3 3 quantile regression the scaling α represents the rate of change of a response variable with respect to a warming surrogate such as surface air temperature roderick et al 2020 here scaling was calculated using quantile regression on log transformed volume and peak data with surface air temperature as the warming surrogate in the absence of snowmelt linearity was confirmed enabling quantile regression to be used wasko et al 2019 the scaling coefficient hence represents the temperature flood volume or peak sensitivity which can be interpreted as how the variable of interest at a specific percentile is sensitive to the temperature in terms of its magnitude and sign consider a set of data pairs xi y for i 1 n where xi represents surface temperature observations and yi the flood volume or flood peak following the procedures adopted for robust sample estimates of the scaling coefficient magan et al 2020 hao et al 2007 wasko and sharma 2014 scaling is estimated using quantile regression quantile regression enables formulation of a regression relationship for a specified quantile 2 y i β 0 p β 1 p x i ε i p where yi and xi represents a data pair relating the response and the temperature surrogate used p is the percentile in the range between 0 and 1 and ε i p is an error term with zero expectation the parameter β 0 p a n d β 1 p are chosen to minimise the value d 3 d β 0 p β 1 p p y i β 0 p β 1 p y i β 0 p β 1 p x i 1 p y i β 0 p β 1 p y i β 0 p β 1 p x i the slope of the scaling relationship is given by β 1 p following wasko and sharma 2014 the scaling coefficient can be ascertained as α 10 β 1 p 1 and expressed as percent increase decrease of flood peak volume per degree celsius here we used the daily air temperature concurrent with the flood peak we obtained scaling values for each station for varying percentiles the higher a percentile is the more extreme a flood event is in general we primarily focus on the scaling for the 50th percentile as that represents frequent floods that contribute most to water supply security sharma et al 2018 4 results and discussion 4 1 flood volume and flood peak scaling we begin by presenting the 50th percentile volume and peak scaling at each station as the 50th percentile represents frequent flood events that are of interest here fig 3 to aid visualisation point estimates were spatially interpolated over the two dimensional space using bilinear interpolation with the original point estimates and the spatially interpolated maps of scaling presented in figs s1 s3 in supporting information mostly negative volume scaling is present when results are assessed at a global scale fig 3a the exception to this is for mexico south africa china and northern australia which are predominately located in tropical and sub tropical regions hence flood volumes and water supply storage that is largely a function of frequent flood events is less with higher temperatures the global map of flood peak scaling fig 3b has a very similar distribution to the volume scaling in both magnitude and spatial distribution this suggests that flood volume and flood peaks broadly scale with the same sign consistent with previous studies gudmundsson et al 2019 wasko et al 2020 which found temporal trends in various streamflow indices shifting in the same direction albeit with different magnitude moreover the scaling presented here matches the recent historical declines in mean streamflow observed in southern australia southern europe and large parts of the u s gudmundsson et al 2019 fig 3c presents the difference between volume and peak scaling i e volume minus peak the volume scaling is generally more negative negative scaling and higher magnitude or less positive positive scaling but lower magnitude than peak scaling over the regions including middle america south eastern africa and north eastern australia in contrast the volume scaling is more positive or less negative red than peak scaling over the south of amazon and parts of indonesia the above results suggest that firstly the volume of frequent floods generally decreases with a rise in temperature and secondly that the rate of decrease is broadly consistent with that of the peak within the flood hydrograph this suggests that there is a uniform proportional decrease in the entire flood hydrograph instead of just the flood peak consistent with previous studies gudmundsson et al 2019 implying a reduction of water supply security with higher temperatures however there are also many regions where this is not the case and higher temperatures are associated with increased flood volumes fig 3c a more detailed investigation of these differences is now presented 4 2 sensitivity of volume and peak scaling the earlier result confirmed the correspondence between changes in flood peaks with those in flood volumes as a function of surface air temperatures worldwide a further assessment of the similarities and differences in the two sets of scaling results as a function of catchment characteristics is presented in fig 4 since we focus on the impact of higher temperatures on water resources we continue to investigate the 50th percentiles of volume and peak scaling except for fig 4d where the scaling trends with percentiles are shown the volume scaling is generally more negative than the peak scaling regardless of the catchment characteristics fig 4a d consistent with the results presented in fig 3 fig 4a shows that the scaling rate varies greatly with the mean daily temperature for each location which is used here to demarcate climatic regions as depicted in fig 4a two mean daily temperature t thresholds 16 and 24 c enable grouping the stations into three regions region 1 represents colder climates region 2 moderate and region 3 a warm tropical climate there are 3062 991 and 612 stations in the regions respectively the most notable changes in both peak and volume scaling are in regions 2 and 3 there is a large decrease in the scaling in region 3 where climatic temperatures are above 24 c representing the major tropical catchments of the world fig 1 however the scaling does not necessarily exhibit much variability with mean daily rainfall fig 4b catchment area fig 4c and event rarity fig 4d this suggests the primary driver of differences in volume and peak scaling is temperature variability with catchment area a secondary factor both flood peak and volume scaling tend to be closer to zero less negative with larger catchments fig 4c and more rare flood events fig 4d this implies that flood peaks and volumes associated with extreme flood events and larger catchments are less likely to be impacted by temperature changes given the relationships observed in the present study do et al 2017 showed that flood peaks tend to decrease for larger catchments this however is not necessarily of use from a water supply security perspective as such extreme floods are often spilled or conveyed downstream of a reservoir to reduce the risk of failure furthermore the volume of more frequent floods constituting the annual water storage in a reservoir is reducing at a greater rate than the flood peak this is to be expected if the reduction in both the peak and volume is a result of drying soil conditions preceding the causative precipitation event the scaling presented for flood volumes matches the dynamic trends of streamflow that recent and past studies have reported all over the world zhang et al 2001 showed that the annual mean streamflow from hundreds of catchments in canada region 1 i e mean daily temperature 16 c has generally decreased during the periods from the 1960s to 1990s milly et al 2005 presented clear differences in global streamflow changes for the late 20th century along the latitude where the trends over the tropics are slightly negative or close to zero and the high latitude areas generally present positive trends gudmundsson et al 2019 reported decreases in mean streamflow over southern australia southern europe and large parts of the u s mostly region 1 and partly region 2 fig 5 presents the volume scaling estimates as a function of the rarity of the flood events separately for the global a and regions 1 2 and 3 b to d to generate these results all volume scaling values were standardised by the mean and aggregated for the stations in selected regions to form a single dataset the dataset was then grouped by small 1000 km2 large 1000 km2 and all catchments quantile regressions were fitted to the datasets for small large and all catchments from the 10th to 99 99th percentiles and the standard error was set as the confidence interval fig 5a shows that the overall volume scaling is negative at low percentiles and approaches zero with higher 99 99th percentiles although with wider confidence intervals the volume scaling of small catchments is more negative at lower percentiles compared to large catchments and goes to zero or slightly positive at or higher than the 99 99th percentile in agreement with wasko and sharma 2017 where positive scaling was found for the peak flows only for the most extreme percentiles however this overall tendency to greater scaling for smaller catchments is quite different in each of the three regions in region 1 fig 5b the pattern is similar to that in fig 5a but the scaling is below zero in region 2 fig 5c which is the sub tropical region both groups of small and large catchments have near zero scaling and tend to be more uncertain at higher percentiles in region 3 fig 5d which is largely tropical the volume scaling of smaller catchments is less negative than that of large catchments at percentiles lower than the 99 9th percentile and then has larger positive scaling greater than that of large catchments at percentiles greater than the 99 9th percentile these results imply that large catchments in region 3 may face considerably decreased volumes of frequent flooding and hence face greater water insecurity at higher temperatures while smaller catchments are exposed to more extreme floods with increasing temperatures ivancic and shaw 2015 sharma et al 2018 the differing scaling with catchment size in different regions may be due to the loss with initial soil moisture condition ivancic and shaw 2015 showed that flooding is closely related to the antecedent soil moisture condition of catchments a finding that has implications for water security in the future fitsum and ashish 2016 maity et al 2013 and dorigo et al 2012 showed drying trends of satellite soil moisture data over 20 years across more than 70 of the earth as there is enough initial soil moisture in the temperate region the loss is small on the contrary in the tropical region the loss due to catchment size is significant because initial soil moisture is small ivancic and shaw 2015 which may result in smaller catchments having less negative volume scaling compared to large catchments this tendency is well presented in fig 5a showing the overall negative volume scaling at 99 and below percentiles a distinct exception is observed in the high percentile cases for small catchments located in region 3 fig 5d here the initial soil moisture condition contributes less to the extreme floods for small catchments ivancic and shaw 2015 but the rainfall tends to be more intense than other regions adler et al 2018 5 conclusions in this study we did not seek to find a causality between air temperature and flood runoff rather based on the assumption that flood volume is representative of water resources augmentation in supply systems this study investigated the flood volume temperature sensitivity represented by scaling α at a global scale as a measure of water supply security we identified three key findings in the framework of the flood volume temperature sensitivity as follows first in most regions except for some tropical and sub tropical regions including mexico south africa china and northern australia the volume of flood events decreases as temperature increases with a similar global spatial distribution to the peak scaling this reinforces the findings in gudmundsson et al 2019 and wasko et al 2020 who found similar historical trends in a range of streamflow indices suggesting the entire flow distribution is either increasing or decreasing the results here correspond to milly et al 2018 who found decreases in annual streamflow with higher annual temperatures second the volume scaling tends to be closer to zero with larger catchment sizes and higher flood percentiles which means that flood volumes associated with extreme floods or larger catchments are less sensitive to increasing temperature when considering the sign positive negative of both peak and volume scaling are generally concurrent this pattern conforms to the tendency of streamflow peak scaling reported in wasko and sharma 2017 where the peak scaling approaches to zero with higher percentiles and larger catchments shows less negative scaling at the 50th percentile one of the reasons for the different scaling with catchment size in different regions is due to the volume loss with initial soil moisture condition ivancic and shaw 2015 third the volume scaling behaviour varies with region as defined by the mean daily climatic temperature t here the globe was divided into three regions thresholding by t region 1 t 16 c region 2 16 t 24 c and region 3 t 24 c notably in region 3 generally considered tropical the volume of frequent floods the 90th percentile for large catchments 1000 km2 decreases more than that of small catchments with increasing temperature however for rare floods the 90th percentile the flood volume for the large catchments is less sensitive to the increasing temperature i e α close to zero while the small catchments present considerably increasing flood volume α approximately 10 c the effect of the hydrologic loss for large catchments is greater due to drier soils ivancic and shaw 2015 sharma et al 2018 dorigo et al 2012 these results suggest that large catchments in region 3 are more likely to face water scarcity while small catchments are more vulnerable to extreme flooding the results of this study have implications for water resources management it was demonstrated that the volume of inflow associated with typical flood events is decreasing as temperature increases around the world translated to a yearly time scale this implies reservoirs are receiving lower inflow than before and that the reduction in the flood peak is generally a good surrogate to the change in reservoir inflow when coupled with the increase in demand for water from agriculture and the environment expected to compensate for the effect of drier soils one is left with a water supply system that has reduced inputs and increased outputs nguyen et al 2020 demonstrated that reservoir systems will become markedly insecure based on climate model projections of the future even if water demand remains unchanged the findings reported here point in the same direction but using observed flow records alone and relating change to the change in temperature this offers a different means of assessing changes in water supply security due to temperature rise than the traditional alternatives currently in place that require reservoir storage to be quantified usually on an annual time scale reducing the number of observations available to detect changes in reservoir volume with time credit authorship contribution statement wei he validation formal analysis investigation data curation writing original draft visualization seokhyeon kim conceptualization methodology writing review editing project administration supervision conrad wasko conceptualization methodology writing review editing funding acquisition ashish sharma conceptualization methodology writing review editing supervision funding acquisition supervision declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments conrad wasko receives funding from the university of melbourne mckenzie postdoctoral fellowships program and arc project de210100479 this research was partially supported by a discovery project dp200101326 assessing water supply security in a nonstationary environment funded by the australian research council ghcn and grdc data are freely available from http dx doi org 10 7289 v5d21vhz and https www bafg de grdc respectively supplementary materials supplementary material associated with this article can be found in the online version at doi 10 1016 j advwatres 2022 104241 appendix supplementary materials image application 1 
