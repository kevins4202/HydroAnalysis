index,text
5255,runoff forecasting is an important approach for flood mitigation many machine learning models have been proposed for runoff forecasting in recent years to reconstruct the time series of runoff data into a standard machine learning dataset a sliding window method is usually used to pre process the data with the size of the window as a variable parameter which is commonly referred to as the time step conventional machine learning methods such as artificial neural network models ann require optimization of the time step because both too small and too large time steps reduce prediction accuracy in this work two popular variants of recurrent neural network rnn named long short term memory lstm and gated recurrent unit gru networks were employed to develop new data driven flood forecasting models gru and lstm models are in theory able to filter redundant information automatically and therefore a large time step is expected to not reduce prediction accuracy the three models lstm gru and ann were applied to simulate runoff in the yutan station control catchment fujian province southeast china using hourly discharge measurements of one runoff station and hourly rainfall of four rainfall stations from 2000 to 2014 results show that the prediction accuracy of lstm and gru models increases with increasing time step and eventually stabilizes this allows selection of a relatively large time step in practical runoff prediction without first evaluating and optimizing the time step required by conventional machine learning models we also show that lstm and gru models perform better than ann models when the time step is optimized gru models have fewer parameters and less complicated structures compared to lstm models and our results show that gru models perform equally well as lstm models gru may be the preferred method in short term runoff predictions since it requires less time for model training keywords rnn gru lstm ann runoff forecasting time step 1 introduction accurate simulation of rainfall runoff processes is extremely important for efficient water resource management and effective flood warning young and liu 2014 in the last few decades many approaches have been developed for simulating the rainfall runoff relationship these methods can be classified into two main groups physics based models and empirical models young and liu 2014 although physics based models can help understand the underlying physics of hydrological processes they usually require a large amount of input such as hydrological data meteorological data topographic data soil characteristics and vegetation coverage in addition to sophisticated mathematical tools and significant user expertise duan et al 1992 empirical models which are mainly represented by data driven models establish a direct mapping between input rainfall and output runoff without requiring knowledge of the physical processes young and liu 2014 machine learning models belong to the latter group over the past few decades several machine learning models have been proposed for short term runoff prediction mainly including artificial neural network models ann chen et al 2010 chua et al 2008 kan et al 2015 kumar et al 2016 tayfur and singh 2006 neuro fuzzy models mukerji et al 2009 nayak et al 2005 talei et al 2010 tayfur and singh 2006 and support vector machine models svm bray and han 2004 chen and pao shan 2007 lin et al 2009 yu et al 2006 one advantage of such models is that they can effectively capture the nonlinearity of rainfall runoff relationships based on historical hydro meteorological data mosavi et al 2018 in most studies rainfall and flow discharge measurements are used for future runoff prediction chang et al 2017 machine learning models are in general mappings between several input features and output targets for time series forecasting the data needs to be reframed to access the suite of standard linear and nonlinear machine learning algorithms this is usually achieved using the sliding window method given a sequence of time series data one uses the previous time step as input variables and the next time step as the output variable the time series forecasting is therefore restructured into a machine learning problem by using the value at the previous time step to predict the value at the next time step for instance if a rainfall runoff dataset of 60 h is used for model training and one aims to predict the future runoff in the next 6 h which is referred to as the lead time he first needs to determine the time step for sample generation take 30 h as the time step for example the rainfall runoff data from the hour 1 to 30 will be used as input and the runoff data from hour 7 to 36 will be used as output fig 1 this constitutes the first sample in the model training the next sample has rainfall runoff data from hour 2 to 31 as input and runoff data from hour 8 to 37 as output multiple samples are generated until the end time of the last output reaches the last hour of the dataset which is hour 60 the lead time which is 6 h in this example is usually determined by practical needs in flood management the tunable parameter is the time step chosen to generate the samples which will affect the model training afterwards it is difficult to determine the optimal time step without any prior knowledge therefore to use machine learning algorithms for runoff prediction one needs to first evaluate the effect of time step selection in runoff prediction to achieve the best prediction accuracy the booming development of deep learning technology in these years has brought light to simplifying this problem currently deep learning has achieved great success in many fields especially in the domain of computer vision and natural language processing kim 2014 zhang et al 2016 most deep learning methods have the capability to process long sequence data such as the recurrent neural networks rnn which is one of the most popular neural networks in the field of deep learning rnn has been shown to be an effective tool in dealing with sequence data for time series prediction rangapuram et al 2018 salinas et al 2017 it should be mentioned that the performance of the traditional version of rnn is not significantly improved in sequence prediction due to its inherent problem of vanishing or exploding gradients an improved version of rnn named long short term memory lstm networks can solve the problem hochreiter and schmidhuber 1997 lstm networks for many cases perform much better than the traditional version of rnn in recent years a variant of lstm named gated recurrent unit gru cho et al 2014 has demonstrated comparable performance in many tasks in the field of natural language processing but with simpler structure and higher operation speed greff et al 2017 fu et al 2016 although lstm and gru networks have been successfully applied in many fields few applications have been found in the hydrological field liang et al 2018 developed a model based on lstm to predict the daily water levels of dongting lake the results showed that the lstm model provided more accurate predictions compared to those by svm models zhang et al 2018 developed a model based on lstm networks to predict water table depth at hetao irrigation district their results showed that the proposed model had higher metric scores for prediction of water table depth when compared with traditional feed forward neural networks in these examples all of the developed models based on lstm networks had better prediction accuracy than the traditional machine learning models recently hu et al 2018 compared ann and lstm network models in simulating rainfall runoff processes during rainfall runoff events and evaluated their performance with lead time from 1 h to 6 h they used a time step of 1 h in their models and concluded that lstm models outperform ann models in this paper we evaluate the performance of lstm gru and ann models in short term runoff prediction we further explore the following questions by extending the lead time to 12 h and varying the time step from 1 h to 30 h 1 how does the prediction accuracy of lstm models change with the time step used in sample generation can lstm models eliminate the need to optimize time step before model training for runoff prediction with its inherent capability to filter out redundant information 2 do lstm models out perform traditional ann models when the time step is optimized for both types of models 3 can gru models achieve the same accuracy in runoff prediction compared to lstm models but with less parameters and simpler structures we select 55 rainfall runoff events with hourly flow discharge and precipitation data from 2000 to 2014 at the yutan hydrology gauge station in the shaxi river basin for short term runoff prediction with the three neural network models namely lstm gru and ann models the ann model is used for comparison the remainder of this paper is organized as follows in section 2 an overview of the study area is given and the steps of data pre processing and sample generation are described section 3 explains the rnn lstm and gru methods the model structures followed by model evaluation criteria section 4 presents the modeling results and discussions finally section 5 concludes the paper 2 overview of the study area and data pre processing steps 2 1 study area the shaxi river basin is located in fujian province southeast china as shown in fig 2 shaxi river is the southern tributary of the upper minjiang river joining the minjiang river in the city of nanping located on the southeast coast of china the climate type in the shaxi river basin is subtropical monsoon which is featured with high temperature and high frequency of rain in summer with a mean annual precipitation of around 1650 mm the studied region the yutan sub catchment is one of the main upstream sub basins of the shaxi river basin the total area of the yutan sub catchment is around 789 km2 there are four rain gauging stations within the yutan sub catchment including shuixi yutan hucun and quanshang gauge stations the yutan gauge station is located at the outlet of the yutan sub catchment 2 2 data pre processing this study collects hourly flow discharge data from the yutan gauge station and hourly precipitation data from three upstream gauge stations and the yutan gauge station itself from 2000 to 2014 the flow discharge data and precipitation data are provided by the bureau of hydrology in sanming city fujian province the flow discharge data are linearly interpolated into hourly records and the precipitation data are averaged to hourly records when the observed flow discharge data and precipitation data are not strictly hourly note that the interpolation between data points in data pre processing will underestimate the peaks in the hydrograph we choose the rainfall runoff data with peak flow greater than 100 m3 s the rainfall runoff events with too many runoff interpolation points are discarded in total 8022 hourly rainfall and runoff records relevant to 55 rainfall runoff events are selected the 55 rainfall runoff events are divided equally into 5 groups with 11 rainfall runoff events in each group the third group with 1639 hourly rainfall and runoff records are used for model testing and the remaining 4 groups with 6383 hourly rainfall and runoff records are used for model training details of the 55 rainfall runoff events and their hygrographs are provided in the supplementary material table s1 and fig s1 rainfall and runoff data are normalized using eq 1 the normalized data fall in the range of 0 1 1 x norm x i x min x max x min x norm x i x min and x max are the normalized observed minimum and maximum values of rainfall or runoff 2 3 sample generation for the purpose of studying the influence of time step on the performance of the three models and to determine the optimal time step different time steps are tested for the three models in this study we aim to predict runoff to a maximum of 12 h in the future and to evaluate the performance of the three machine learning models at different lead times the value of lead time is set to 2 4 6 8 10 and 12 h the time step value ranges from 1 to 30 specific values are 1 3 5 7 9 12 15 18 21 24 27 and 30 a total of 12 numbers model training and testing are performed for each combination of lead time and time step so a total of 72 models are developed for each of the lstm gru and ann networks we use the sliding windows method to generate the training and testing samples for different time steps as shown in fig 1 in total 4579 samples are generated for training and 1188 samples are generated for testing for each combination of lead time and time step 3 deep learning methodology for short term runoff prediction 3 1 rnn lstm and gru 3 1 1 recurrent neural network rnn before introducing lstm and gru networks we first describe the structure of the rnn model since both lstm and gru networks are updated versions of rnn with the same fundamental framework rnn consists of a series of modules with the same basic structure fig 3 shows the basic structure of traditional rnn x t is the input vector at time step t h t is the final output of rnn cell at time step t the term h t in rnn is to refer a hidden state a hidden state h t is computed based on the hidden state h t 1 at the previous time step t 1 and the input vector x t at the current time step t the specific update equation for a hidden state h t is explained as follows 2 h t t a n h u x t w h t 1 b where tanh is an activation function named the hyperbolic tangent b is a bias vector the weight matrices u and w are parameters for the hidden state h and the input x respectively zhang et al 2018 for each time step the corresponding basic structures have the same parameters namely b u and w the final output of rnn depends on not only the input of the current time step but also the calculated information of the hidden layer in the previous time step zhao et al 2017 theoretically rnn can take advantage of all information no matter how long the sequences are however due to the vanishing and exploding gradient problems the accuracy of rnn models decreases when the length of the time sequence becomes too long the lstm and gru networks were proposed to solve these problems sak et al 2014 3 1 2 long short term memory lstm cell structure lstm neural networks have a similar chain form structure with that of traditional rnn but the internal operations in the lstm cells are more complex which enables lstm to learn long short term dependencies in comparison with traditional rnn lstm networks have an additional cell state in which information can be stored the basic structure of an lstm cell is illustrated in fig 4 in which xt is the input vector h t h t 1 is the hidden state of the lstm cell in time step t t 1 c t c t 1 is the cell state of the lstm cell in time step t t 1 the structure of the lstm cell shows that both its cell state c t and hidden state h t are transferred to the next time step duan et al 2016 the lstm cell has three gates maintaining and adjusting its cell state c t and hidden state h t including a forget gate ft an input gate it and an output gate ot these three gates act as filters serving different purposes fischer and krauss 2018 the forget gate ft determines what information will be moved away from the cell state c t the input gate it determines what new information is going to be stored in the cell state c t the output gate ot specifies what information from the cell state is used as output ot via the functions of the three gates lstm cells can capture the complex correlations in both short and long term time series which is a significant improvement compared to traditional rnn zhao et al 2017 in fig 4 the cell state c t and hidden state h t of the lstm cell are calculated as follows 3 f t σ w xf x t w hf h t 1 b f 4 i t σ w xi x t w hi h t 1 b i 5 c t t a n h w xc x t w hc h t 1 b c 6 c t f t c t 1 i t c t 7 o t σ w xo x t w ho h t 1 b o 8 h t o t t a n h c t where σ is the logistic sigmoidal function is element wise multiplication of two vectors and w xi w hi w xf w hf w xo w ho w xc and w hc are the network weights matrices similarly b i b f b o and b c are bias vectors f t i t and o t are vectors for the activation values of the forget gate the input gate and the output gate 3 1 3 gated recurrent unit gru cell structure lstm networks were initially proposed in 1997 for language processing and were well known for their excellent capability to memorize long short term dependencies hochreiter and schmidhuber 1997 however due to its complex structure the training process for developing lstm neural networks usually takes a long time to speed up the training process gru networks were proposed as a modification of lstm networks with a simpler structure cho et al 2014 the specific structure of the gru cell is shown in fig 5 the hidden state h t and cell state c t merge into one in the gru in the gru cell there are two control gates the update gate z t and the reset gate r t the update gate z t is used to control the degree to which the state information h t 1 c t 1 at the previous time step t 1 will be brought into the current time step t the larger the value of the update gate is the more the state information at the previous time step is brought in reset gate r t controls how much information from the previous state is written into the current candidate set c t the smaller the reset gate r t the less information from the previous state is written in the structure of the gru cell as shown in fig 5 update equations are calculated as follows 9 r t σ w xr x t w hr h t 1 b r 10 z t σ w xz x t w hz h t 1 b z 11 c t t a n h w xc x t w hc r t h t 1 b c 12 c t 1 z t c t 1 z t c t 13 h t c t where w xr w hr w xz and w hz are the network weights matrices b r and b z are bias vectors and r t and z t are vectors for the activation values of the update gate and reset gate 3 2 model development 3 2 1 the architecture and super parameters of lstm and gru models due to the great similarity between lstm and gru networks we designed the same network architecture for these two models as depicted in fig 6 in fig 6 the variable m refers to the time step which is also the length of the input sequence in lstm and gru models the variable n represents the lead time which is the future hour of runoff prediction for the tuning of the hyper parameters in gru and lstm networks the trial and error method is adopted liang et al 2018 after a large number of experiments we found that using lstm and gru networks with only one layer to simulate rainfall runoff relationships is better than using a multi layer network in the studied area we also found that 20 neurons in the layer of lstm and gru networks is suitable for this study the proposed gru and lstm networks consist of an input layer with 5 neurons a hidden layer with 20 neurons and an output layer with one neuron at each time step at each time step t m 1 the input layer includes five features one is river flow discharge q t m 1 and the other four are rainfall values at four rainfall stations r t m 1 the output layer includes predicted river flow discharge q t m n 1 the output q t n from the last time step is the final predicted river flow discharge for the loss function mean squared error mse is used which is defined below 14 m s e i 1 n q i q i 2 where q i is the observed value at time step i and q i is the predicted value at time step i the batch size and epoch size are set to 64 and 500 respectively an epoch refers to the process by which all data is sent into the network to complete an iterative calculation in our model all the data needs to be iterated in the model 500 times since an epoch often contains too many data samples for the computer to load we divide them into several smaller batches the batch size refers to the number of samples contained in each batch the activation function is set to relu we make use of rmsprop tieleman and hinton 2012 as the optimizer note that our models with different time steps and lead times use the same hyper parameters 3 2 2 the ann model for performance comparison for performance comparison with both gru and lstm networks we choose a fully connected artificial neural network which is usually called ann with one hidden layer the architecture of ann is depicted in fig 7 compared with the rnn models all input information is the same and qt n is the output of ann however there is no sequential order among all inputs when training ann models we find that some training methods and optimization algorithms often used in training lstm and gru network models for determining weight matrix are also useful for example the method of batch by batch updating weighting provides more accurate simulation results than the methods of all data updating weighting and the rmsprop optimization algorithm is better than the levenberg marquardt optimization algorithm widely used in ann models before hu et al 2018 dawson et al 1998 therefore in this study the method of batch by batch updating weighting and the rmsprop optimization algorithm are adopted for ann model training in order to compare with the performance of gru and lstm models in runoff prediction ann models with different lead times of runoff prediction were trained using the same hyper parameters as those in the lstm and gru models 3 2 3 software our research relies heavily on python 3 6 all of the data processing in this study is conducted with the numpy van der walt et al 2011 pandas mckinney 2010 and scikit learn pedregosa et al 2011 packages of the python software our lstm gru and ann networks are developed with keras on top of google tensorflow abadi et al 2016 3 3 performance evaluation methods the performance of the three developed models is evaluated with nash sutcliffe coefficient of efficiency nse mean absolute error mae and the error of peak discharge eq represented as follows 15 n s e 1 i 1 n q i q i 2 i 1 n q i q i 2 16 m a e i 1 n q i q i n 17 e q q p q p q p 100 q i and q i are the observed and simulated river flow discharge at the time step i q p and q p are the observed and simulated peak river flow discharge q is the average value of observed discharge and n is the total number of observations nse is one of the most widely used criteria for the assessment of rainfall runoff simulation kumar et al 2016 which ranges from to 1 values of nse less than zero mean that simulated result is worse than just using the observed mean value for prediction the closer nse is to 1 the better the simulated flow result is mae evaluates how predictions match the observations value of mae may range from 0 perfect fit to no fit the error of peak discharge eq measures the model accuracy for peak discharge prediction eq values close to zero represent accurate predictions of peak discharge and small errors 4 results and discussions 4 1 performance comparison among the gru lstm and ann models with different time steps fig 8 shows the nse variations of simulation results from the lstm gru and ann models with different time steps and prediction lead times each model was run five times for a given combination of time step and prediction lead time due to the random setting of initial variables the results of the five repeated simulations are different in fig 8 the solid lines represent the average value of five simulations and the upper and lower boundaries of the band represent the maximum and minimum nse values we find that when the time step is fixed nse decreases with the increase of prediction lead time for all three models this is expected because the prediction of runoff becomes more challenging when the prediction is required in the further future fig 8c shows that the nse of ann models for a fixed lead time first increases with increasing time step then decreases this is especially prominent when the lead time is large e g at 6 8 10 and 12 h the value of the time step is essentially the length of input sequence in fig 1 during sample generation for accurate prediction of future runoff the input time series needs to include enough information of a complete precipitation runoff event for the ann models with a lead time of 6 8 10 and 12 h the accuracy of runoff prediction increases as the time step increases from 1 to 7 h one exception when lead time is equal to 10 the optimal time step is 5 h however when the time step is larger than 7 h longer input of time series brings in redundant information and the prediction of runoff becomes less accurate therefore when the ann model is applied to practical runoff prediction the optimal time step needs to be first identified for the target basin the optimized value is likely to change in different basins for lstm and gru models our results suggest that optimization of the time step is not necessary in fig 8a and 8b it is observed that the nse value increases with increasing time step for lstm and gru models and remains almost constant for larger time steps this is consistent with our hypothesis that gru and lstm models are not as sensitive to redundant information as ann models in practical applications one can select a relatively large time step which introduces long enough time series in the training dataset and does not reduce prediction accuracy by introducing unnecessary information another observation in fig 8 is that when the lead time is large e g 10 or 12 h the uncertainty of the predicted results of ann models is greater than that of lstm and gru models suggested by the wider bands in ann nse values this observation suggests that predictions by lstm and gru models are subject to smaller uncertainty in practical flood forecasting with repeated simulations likely to give more consistent predictions 4 2 performance comparison among gru lstm and ann models with the selected optimal time step in this section we compare the performance of lstm gru and ann models when the time step is optimized in fig 8 it is observed that 7 h is the optimal time step for most of the combinations of time step and prediction lead time for the three models table 1 shows the statistics of simulation results of the lstm gru and ann models for the training and testing dataset when the time step is 7 h for the training step five of six nse values of ann models are larger than those of lstm and gru models only when lead time is equal to 2 h the nse value of ann model is less than that of gru model and equal to that of lstm model four out of six mae values of ann models are less than those of lstm and gru models both nse and mae values suggest that ann models perform better in the training step for the testing step the order is reversed the six nse values of ann models are all less than those of lstm and gru models and the six mae values of ann models are all larger than those of lstm and gru models for a given lead time the performance of ann models on testing data is worse than that on training data suggested by lower nse and higher mae values in the testing step this indicates overfitting of the data in the training step by ann models lstm and gru models are subject to similar issues but to a much smaller extent which explains the observation that although lstm and gru models underperform in the training step they outperform ann models in the testing step 4 3 prediction of individual rainfall runoff events in this section we discuss the prediction of the 11 individual rainfall runoff events in the testing dataset with the optimal time step of 7 h the mean nse and eq values of prediction results of the 11 individual rainfall runoff events are shown in fig 9 in fig 9 it is shown that the mean nse values of lstm and gru models are greater than those of the ann models except when prediction lead time is equal to 8 h the mean eq values of lstm and gru models are smaller and closer to 0 than those of ann models for all lead times this demonstrates that lstm and gru models have better performance than ann models not only in fitting the overall rainfall runoff processes but also in fitting the peak values in individual rainfall runoff event observed and modeled hydrographs of the lstm gru and ann models in the testing step in the 23rd rainfall runoff event with 2 h 6 h and 10 h prediction lead times are shown in fig 10 the remaining 10 rainfall runoff events are presented in fig s2 in the supplementary material it is observed that the hydrographs predicted by the ann models have more abnormal fluctuations compared with those by lstm and gru models 4 4 impacts of testing data selection the results of data driven models are highly data dependent in order to explore whether lstm and gru models are effective in runoff prediction when different data are selected for testing the following supplementary experiments are conducted in this paper in our base case there are five groups of data and the third group is selected for testing in the supplementary experiments we evaluate whether selection of any of the other four groups of data as the testing data will affect our conclusions fig 11 shows the results using the fifth group data as testing data and the results of the other three supplementary experiments using the first second and fourth group as testing data are shown in fig s3 in the supplementary materials results show that independent of testing data selection lstm and gru models outperform ann models and the nse values in lstm and gru models remain constant with large time steps which eliminates the necessity of time step optimization 5 conclusions in this paper two popular variants of the rnn networks named gru and lstm networks are evaluated we apply the gru lstm and ann models to event based short term rainfall runoff simulations in the yutan station control catchment the following can be concluded from this study 1 gru and lstm models are able to simulate rainfall runoff processes accurately by employing time sequences input the results show that gru and lstm networks have the capability to filter out redundant information in modeling rainfall runoff relationships they are less sensitive to redundant information introduced by larger time steps in contrast the traditional ann models show obvious decline of prediction accuracy when the prediction lead time is larger than its optimal value this significantly simplifies the workflow when using lstm and gru models in runoff prediction because optimization of the time step is not necessary with lstm and gru models one can select a relatively large time step to ensure the prediction accuracy 2 predictions by lstm and gru models are less uncertain compared to those by ann models suggested by the narrower bands in nse values fig 2 results are less likely to vary when simulations are repeated multiple times in lstm and gru models simulations of individual runoff events show that lstm and gru models predict runoff curves with less abnormal fluctuations than ann models fig 10 3 gru and lstm models show better prediction accuracy than ann models even with optimal time step especially when predictions with large lead times are required in practical applications the earlier the flood is predicted in advance the more effective the flood control methods will be gru and lstm models are especially useful in such situations 4 gru and lstm models predict runoff with almost identical accuracy given that gru has simpler structures and less parameters and requires less time for model training it may be the preferred method for short term runoff prediction credit authorship contribution statement shuai gao methodology software formal analysis writing original draft writing review editing yuefei huang methodology writing review editing shuo zhang methodology writing review editing jingcheng han data curation guangqian wang methodology writing review editing meixin zhang data curation qingsheng lin data curation declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgements we thank four anonymous reviewers for their constructive comments and suggestions this work was financially supported by the national natural science foundation of china no 91647212 no 51809007 major basic research development program of the science and technology agent qinghai province 2019 sf 146 and the innovation foundation for water development of shenzhen 0832 sfcx18szc025 appendix a supplementary data supplementary data to this article can be found online at https doi org 10 1016 j jhydrol 2020 125188 appendix a supplementary data the following are the supplementary data to this article supplementary data 1 
5255,runoff forecasting is an important approach for flood mitigation many machine learning models have been proposed for runoff forecasting in recent years to reconstruct the time series of runoff data into a standard machine learning dataset a sliding window method is usually used to pre process the data with the size of the window as a variable parameter which is commonly referred to as the time step conventional machine learning methods such as artificial neural network models ann require optimization of the time step because both too small and too large time steps reduce prediction accuracy in this work two popular variants of recurrent neural network rnn named long short term memory lstm and gated recurrent unit gru networks were employed to develop new data driven flood forecasting models gru and lstm models are in theory able to filter redundant information automatically and therefore a large time step is expected to not reduce prediction accuracy the three models lstm gru and ann were applied to simulate runoff in the yutan station control catchment fujian province southeast china using hourly discharge measurements of one runoff station and hourly rainfall of four rainfall stations from 2000 to 2014 results show that the prediction accuracy of lstm and gru models increases with increasing time step and eventually stabilizes this allows selection of a relatively large time step in practical runoff prediction without first evaluating and optimizing the time step required by conventional machine learning models we also show that lstm and gru models perform better than ann models when the time step is optimized gru models have fewer parameters and less complicated structures compared to lstm models and our results show that gru models perform equally well as lstm models gru may be the preferred method in short term runoff predictions since it requires less time for model training keywords rnn gru lstm ann runoff forecasting time step 1 introduction accurate simulation of rainfall runoff processes is extremely important for efficient water resource management and effective flood warning young and liu 2014 in the last few decades many approaches have been developed for simulating the rainfall runoff relationship these methods can be classified into two main groups physics based models and empirical models young and liu 2014 although physics based models can help understand the underlying physics of hydrological processes they usually require a large amount of input such as hydrological data meteorological data topographic data soil characteristics and vegetation coverage in addition to sophisticated mathematical tools and significant user expertise duan et al 1992 empirical models which are mainly represented by data driven models establish a direct mapping between input rainfall and output runoff without requiring knowledge of the physical processes young and liu 2014 machine learning models belong to the latter group over the past few decades several machine learning models have been proposed for short term runoff prediction mainly including artificial neural network models ann chen et al 2010 chua et al 2008 kan et al 2015 kumar et al 2016 tayfur and singh 2006 neuro fuzzy models mukerji et al 2009 nayak et al 2005 talei et al 2010 tayfur and singh 2006 and support vector machine models svm bray and han 2004 chen and pao shan 2007 lin et al 2009 yu et al 2006 one advantage of such models is that they can effectively capture the nonlinearity of rainfall runoff relationships based on historical hydro meteorological data mosavi et al 2018 in most studies rainfall and flow discharge measurements are used for future runoff prediction chang et al 2017 machine learning models are in general mappings between several input features and output targets for time series forecasting the data needs to be reframed to access the suite of standard linear and nonlinear machine learning algorithms this is usually achieved using the sliding window method given a sequence of time series data one uses the previous time step as input variables and the next time step as the output variable the time series forecasting is therefore restructured into a machine learning problem by using the value at the previous time step to predict the value at the next time step for instance if a rainfall runoff dataset of 60 h is used for model training and one aims to predict the future runoff in the next 6 h which is referred to as the lead time he first needs to determine the time step for sample generation take 30 h as the time step for example the rainfall runoff data from the hour 1 to 30 will be used as input and the runoff data from hour 7 to 36 will be used as output fig 1 this constitutes the first sample in the model training the next sample has rainfall runoff data from hour 2 to 31 as input and runoff data from hour 8 to 37 as output multiple samples are generated until the end time of the last output reaches the last hour of the dataset which is hour 60 the lead time which is 6 h in this example is usually determined by practical needs in flood management the tunable parameter is the time step chosen to generate the samples which will affect the model training afterwards it is difficult to determine the optimal time step without any prior knowledge therefore to use machine learning algorithms for runoff prediction one needs to first evaluate the effect of time step selection in runoff prediction to achieve the best prediction accuracy the booming development of deep learning technology in these years has brought light to simplifying this problem currently deep learning has achieved great success in many fields especially in the domain of computer vision and natural language processing kim 2014 zhang et al 2016 most deep learning methods have the capability to process long sequence data such as the recurrent neural networks rnn which is one of the most popular neural networks in the field of deep learning rnn has been shown to be an effective tool in dealing with sequence data for time series prediction rangapuram et al 2018 salinas et al 2017 it should be mentioned that the performance of the traditional version of rnn is not significantly improved in sequence prediction due to its inherent problem of vanishing or exploding gradients an improved version of rnn named long short term memory lstm networks can solve the problem hochreiter and schmidhuber 1997 lstm networks for many cases perform much better than the traditional version of rnn in recent years a variant of lstm named gated recurrent unit gru cho et al 2014 has demonstrated comparable performance in many tasks in the field of natural language processing but with simpler structure and higher operation speed greff et al 2017 fu et al 2016 although lstm and gru networks have been successfully applied in many fields few applications have been found in the hydrological field liang et al 2018 developed a model based on lstm to predict the daily water levels of dongting lake the results showed that the lstm model provided more accurate predictions compared to those by svm models zhang et al 2018 developed a model based on lstm networks to predict water table depth at hetao irrigation district their results showed that the proposed model had higher metric scores for prediction of water table depth when compared with traditional feed forward neural networks in these examples all of the developed models based on lstm networks had better prediction accuracy than the traditional machine learning models recently hu et al 2018 compared ann and lstm network models in simulating rainfall runoff processes during rainfall runoff events and evaluated their performance with lead time from 1 h to 6 h they used a time step of 1 h in their models and concluded that lstm models outperform ann models in this paper we evaluate the performance of lstm gru and ann models in short term runoff prediction we further explore the following questions by extending the lead time to 12 h and varying the time step from 1 h to 30 h 1 how does the prediction accuracy of lstm models change with the time step used in sample generation can lstm models eliminate the need to optimize time step before model training for runoff prediction with its inherent capability to filter out redundant information 2 do lstm models out perform traditional ann models when the time step is optimized for both types of models 3 can gru models achieve the same accuracy in runoff prediction compared to lstm models but with less parameters and simpler structures we select 55 rainfall runoff events with hourly flow discharge and precipitation data from 2000 to 2014 at the yutan hydrology gauge station in the shaxi river basin for short term runoff prediction with the three neural network models namely lstm gru and ann models the ann model is used for comparison the remainder of this paper is organized as follows in section 2 an overview of the study area is given and the steps of data pre processing and sample generation are described section 3 explains the rnn lstm and gru methods the model structures followed by model evaluation criteria section 4 presents the modeling results and discussions finally section 5 concludes the paper 2 overview of the study area and data pre processing steps 2 1 study area the shaxi river basin is located in fujian province southeast china as shown in fig 2 shaxi river is the southern tributary of the upper minjiang river joining the minjiang river in the city of nanping located on the southeast coast of china the climate type in the shaxi river basin is subtropical monsoon which is featured with high temperature and high frequency of rain in summer with a mean annual precipitation of around 1650 mm the studied region the yutan sub catchment is one of the main upstream sub basins of the shaxi river basin the total area of the yutan sub catchment is around 789 km2 there are four rain gauging stations within the yutan sub catchment including shuixi yutan hucun and quanshang gauge stations the yutan gauge station is located at the outlet of the yutan sub catchment 2 2 data pre processing this study collects hourly flow discharge data from the yutan gauge station and hourly precipitation data from three upstream gauge stations and the yutan gauge station itself from 2000 to 2014 the flow discharge data and precipitation data are provided by the bureau of hydrology in sanming city fujian province the flow discharge data are linearly interpolated into hourly records and the precipitation data are averaged to hourly records when the observed flow discharge data and precipitation data are not strictly hourly note that the interpolation between data points in data pre processing will underestimate the peaks in the hydrograph we choose the rainfall runoff data with peak flow greater than 100 m3 s the rainfall runoff events with too many runoff interpolation points are discarded in total 8022 hourly rainfall and runoff records relevant to 55 rainfall runoff events are selected the 55 rainfall runoff events are divided equally into 5 groups with 11 rainfall runoff events in each group the third group with 1639 hourly rainfall and runoff records are used for model testing and the remaining 4 groups with 6383 hourly rainfall and runoff records are used for model training details of the 55 rainfall runoff events and their hygrographs are provided in the supplementary material table s1 and fig s1 rainfall and runoff data are normalized using eq 1 the normalized data fall in the range of 0 1 1 x norm x i x min x max x min x norm x i x min and x max are the normalized observed minimum and maximum values of rainfall or runoff 2 3 sample generation for the purpose of studying the influence of time step on the performance of the three models and to determine the optimal time step different time steps are tested for the three models in this study we aim to predict runoff to a maximum of 12 h in the future and to evaluate the performance of the three machine learning models at different lead times the value of lead time is set to 2 4 6 8 10 and 12 h the time step value ranges from 1 to 30 specific values are 1 3 5 7 9 12 15 18 21 24 27 and 30 a total of 12 numbers model training and testing are performed for each combination of lead time and time step so a total of 72 models are developed for each of the lstm gru and ann networks we use the sliding windows method to generate the training and testing samples for different time steps as shown in fig 1 in total 4579 samples are generated for training and 1188 samples are generated for testing for each combination of lead time and time step 3 deep learning methodology for short term runoff prediction 3 1 rnn lstm and gru 3 1 1 recurrent neural network rnn before introducing lstm and gru networks we first describe the structure of the rnn model since both lstm and gru networks are updated versions of rnn with the same fundamental framework rnn consists of a series of modules with the same basic structure fig 3 shows the basic structure of traditional rnn x t is the input vector at time step t h t is the final output of rnn cell at time step t the term h t in rnn is to refer a hidden state a hidden state h t is computed based on the hidden state h t 1 at the previous time step t 1 and the input vector x t at the current time step t the specific update equation for a hidden state h t is explained as follows 2 h t t a n h u x t w h t 1 b where tanh is an activation function named the hyperbolic tangent b is a bias vector the weight matrices u and w are parameters for the hidden state h and the input x respectively zhang et al 2018 for each time step the corresponding basic structures have the same parameters namely b u and w the final output of rnn depends on not only the input of the current time step but also the calculated information of the hidden layer in the previous time step zhao et al 2017 theoretically rnn can take advantage of all information no matter how long the sequences are however due to the vanishing and exploding gradient problems the accuracy of rnn models decreases when the length of the time sequence becomes too long the lstm and gru networks were proposed to solve these problems sak et al 2014 3 1 2 long short term memory lstm cell structure lstm neural networks have a similar chain form structure with that of traditional rnn but the internal operations in the lstm cells are more complex which enables lstm to learn long short term dependencies in comparison with traditional rnn lstm networks have an additional cell state in which information can be stored the basic structure of an lstm cell is illustrated in fig 4 in which xt is the input vector h t h t 1 is the hidden state of the lstm cell in time step t t 1 c t c t 1 is the cell state of the lstm cell in time step t t 1 the structure of the lstm cell shows that both its cell state c t and hidden state h t are transferred to the next time step duan et al 2016 the lstm cell has three gates maintaining and adjusting its cell state c t and hidden state h t including a forget gate ft an input gate it and an output gate ot these three gates act as filters serving different purposes fischer and krauss 2018 the forget gate ft determines what information will be moved away from the cell state c t the input gate it determines what new information is going to be stored in the cell state c t the output gate ot specifies what information from the cell state is used as output ot via the functions of the three gates lstm cells can capture the complex correlations in both short and long term time series which is a significant improvement compared to traditional rnn zhao et al 2017 in fig 4 the cell state c t and hidden state h t of the lstm cell are calculated as follows 3 f t σ w xf x t w hf h t 1 b f 4 i t σ w xi x t w hi h t 1 b i 5 c t t a n h w xc x t w hc h t 1 b c 6 c t f t c t 1 i t c t 7 o t σ w xo x t w ho h t 1 b o 8 h t o t t a n h c t where σ is the logistic sigmoidal function is element wise multiplication of two vectors and w xi w hi w xf w hf w xo w ho w xc and w hc are the network weights matrices similarly b i b f b o and b c are bias vectors f t i t and o t are vectors for the activation values of the forget gate the input gate and the output gate 3 1 3 gated recurrent unit gru cell structure lstm networks were initially proposed in 1997 for language processing and were well known for their excellent capability to memorize long short term dependencies hochreiter and schmidhuber 1997 however due to its complex structure the training process for developing lstm neural networks usually takes a long time to speed up the training process gru networks were proposed as a modification of lstm networks with a simpler structure cho et al 2014 the specific structure of the gru cell is shown in fig 5 the hidden state h t and cell state c t merge into one in the gru in the gru cell there are two control gates the update gate z t and the reset gate r t the update gate z t is used to control the degree to which the state information h t 1 c t 1 at the previous time step t 1 will be brought into the current time step t the larger the value of the update gate is the more the state information at the previous time step is brought in reset gate r t controls how much information from the previous state is written into the current candidate set c t the smaller the reset gate r t the less information from the previous state is written in the structure of the gru cell as shown in fig 5 update equations are calculated as follows 9 r t σ w xr x t w hr h t 1 b r 10 z t σ w xz x t w hz h t 1 b z 11 c t t a n h w xc x t w hc r t h t 1 b c 12 c t 1 z t c t 1 z t c t 13 h t c t where w xr w hr w xz and w hz are the network weights matrices b r and b z are bias vectors and r t and z t are vectors for the activation values of the update gate and reset gate 3 2 model development 3 2 1 the architecture and super parameters of lstm and gru models due to the great similarity between lstm and gru networks we designed the same network architecture for these two models as depicted in fig 6 in fig 6 the variable m refers to the time step which is also the length of the input sequence in lstm and gru models the variable n represents the lead time which is the future hour of runoff prediction for the tuning of the hyper parameters in gru and lstm networks the trial and error method is adopted liang et al 2018 after a large number of experiments we found that using lstm and gru networks with only one layer to simulate rainfall runoff relationships is better than using a multi layer network in the studied area we also found that 20 neurons in the layer of lstm and gru networks is suitable for this study the proposed gru and lstm networks consist of an input layer with 5 neurons a hidden layer with 20 neurons and an output layer with one neuron at each time step at each time step t m 1 the input layer includes five features one is river flow discharge q t m 1 and the other four are rainfall values at four rainfall stations r t m 1 the output layer includes predicted river flow discharge q t m n 1 the output q t n from the last time step is the final predicted river flow discharge for the loss function mean squared error mse is used which is defined below 14 m s e i 1 n q i q i 2 where q i is the observed value at time step i and q i is the predicted value at time step i the batch size and epoch size are set to 64 and 500 respectively an epoch refers to the process by which all data is sent into the network to complete an iterative calculation in our model all the data needs to be iterated in the model 500 times since an epoch often contains too many data samples for the computer to load we divide them into several smaller batches the batch size refers to the number of samples contained in each batch the activation function is set to relu we make use of rmsprop tieleman and hinton 2012 as the optimizer note that our models with different time steps and lead times use the same hyper parameters 3 2 2 the ann model for performance comparison for performance comparison with both gru and lstm networks we choose a fully connected artificial neural network which is usually called ann with one hidden layer the architecture of ann is depicted in fig 7 compared with the rnn models all input information is the same and qt n is the output of ann however there is no sequential order among all inputs when training ann models we find that some training methods and optimization algorithms often used in training lstm and gru network models for determining weight matrix are also useful for example the method of batch by batch updating weighting provides more accurate simulation results than the methods of all data updating weighting and the rmsprop optimization algorithm is better than the levenberg marquardt optimization algorithm widely used in ann models before hu et al 2018 dawson et al 1998 therefore in this study the method of batch by batch updating weighting and the rmsprop optimization algorithm are adopted for ann model training in order to compare with the performance of gru and lstm models in runoff prediction ann models with different lead times of runoff prediction were trained using the same hyper parameters as those in the lstm and gru models 3 2 3 software our research relies heavily on python 3 6 all of the data processing in this study is conducted with the numpy van der walt et al 2011 pandas mckinney 2010 and scikit learn pedregosa et al 2011 packages of the python software our lstm gru and ann networks are developed with keras on top of google tensorflow abadi et al 2016 3 3 performance evaluation methods the performance of the three developed models is evaluated with nash sutcliffe coefficient of efficiency nse mean absolute error mae and the error of peak discharge eq represented as follows 15 n s e 1 i 1 n q i q i 2 i 1 n q i q i 2 16 m a e i 1 n q i q i n 17 e q q p q p q p 100 q i and q i are the observed and simulated river flow discharge at the time step i q p and q p are the observed and simulated peak river flow discharge q is the average value of observed discharge and n is the total number of observations nse is one of the most widely used criteria for the assessment of rainfall runoff simulation kumar et al 2016 which ranges from to 1 values of nse less than zero mean that simulated result is worse than just using the observed mean value for prediction the closer nse is to 1 the better the simulated flow result is mae evaluates how predictions match the observations value of mae may range from 0 perfect fit to no fit the error of peak discharge eq measures the model accuracy for peak discharge prediction eq values close to zero represent accurate predictions of peak discharge and small errors 4 results and discussions 4 1 performance comparison among the gru lstm and ann models with different time steps fig 8 shows the nse variations of simulation results from the lstm gru and ann models with different time steps and prediction lead times each model was run five times for a given combination of time step and prediction lead time due to the random setting of initial variables the results of the five repeated simulations are different in fig 8 the solid lines represent the average value of five simulations and the upper and lower boundaries of the band represent the maximum and minimum nse values we find that when the time step is fixed nse decreases with the increase of prediction lead time for all three models this is expected because the prediction of runoff becomes more challenging when the prediction is required in the further future fig 8c shows that the nse of ann models for a fixed lead time first increases with increasing time step then decreases this is especially prominent when the lead time is large e g at 6 8 10 and 12 h the value of the time step is essentially the length of input sequence in fig 1 during sample generation for accurate prediction of future runoff the input time series needs to include enough information of a complete precipitation runoff event for the ann models with a lead time of 6 8 10 and 12 h the accuracy of runoff prediction increases as the time step increases from 1 to 7 h one exception when lead time is equal to 10 the optimal time step is 5 h however when the time step is larger than 7 h longer input of time series brings in redundant information and the prediction of runoff becomes less accurate therefore when the ann model is applied to practical runoff prediction the optimal time step needs to be first identified for the target basin the optimized value is likely to change in different basins for lstm and gru models our results suggest that optimization of the time step is not necessary in fig 8a and 8b it is observed that the nse value increases with increasing time step for lstm and gru models and remains almost constant for larger time steps this is consistent with our hypothesis that gru and lstm models are not as sensitive to redundant information as ann models in practical applications one can select a relatively large time step which introduces long enough time series in the training dataset and does not reduce prediction accuracy by introducing unnecessary information another observation in fig 8 is that when the lead time is large e g 10 or 12 h the uncertainty of the predicted results of ann models is greater than that of lstm and gru models suggested by the wider bands in ann nse values this observation suggests that predictions by lstm and gru models are subject to smaller uncertainty in practical flood forecasting with repeated simulations likely to give more consistent predictions 4 2 performance comparison among gru lstm and ann models with the selected optimal time step in this section we compare the performance of lstm gru and ann models when the time step is optimized in fig 8 it is observed that 7 h is the optimal time step for most of the combinations of time step and prediction lead time for the three models table 1 shows the statistics of simulation results of the lstm gru and ann models for the training and testing dataset when the time step is 7 h for the training step five of six nse values of ann models are larger than those of lstm and gru models only when lead time is equal to 2 h the nse value of ann model is less than that of gru model and equal to that of lstm model four out of six mae values of ann models are less than those of lstm and gru models both nse and mae values suggest that ann models perform better in the training step for the testing step the order is reversed the six nse values of ann models are all less than those of lstm and gru models and the six mae values of ann models are all larger than those of lstm and gru models for a given lead time the performance of ann models on testing data is worse than that on training data suggested by lower nse and higher mae values in the testing step this indicates overfitting of the data in the training step by ann models lstm and gru models are subject to similar issues but to a much smaller extent which explains the observation that although lstm and gru models underperform in the training step they outperform ann models in the testing step 4 3 prediction of individual rainfall runoff events in this section we discuss the prediction of the 11 individual rainfall runoff events in the testing dataset with the optimal time step of 7 h the mean nse and eq values of prediction results of the 11 individual rainfall runoff events are shown in fig 9 in fig 9 it is shown that the mean nse values of lstm and gru models are greater than those of the ann models except when prediction lead time is equal to 8 h the mean eq values of lstm and gru models are smaller and closer to 0 than those of ann models for all lead times this demonstrates that lstm and gru models have better performance than ann models not only in fitting the overall rainfall runoff processes but also in fitting the peak values in individual rainfall runoff event observed and modeled hydrographs of the lstm gru and ann models in the testing step in the 23rd rainfall runoff event with 2 h 6 h and 10 h prediction lead times are shown in fig 10 the remaining 10 rainfall runoff events are presented in fig s2 in the supplementary material it is observed that the hydrographs predicted by the ann models have more abnormal fluctuations compared with those by lstm and gru models 4 4 impacts of testing data selection the results of data driven models are highly data dependent in order to explore whether lstm and gru models are effective in runoff prediction when different data are selected for testing the following supplementary experiments are conducted in this paper in our base case there are five groups of data and the third group is selected for testing in the supplementary experiments we evaluate whether selection of any of the other four groups of data as the testing data will affect our conclusions fig 11 shows the results using the fifth group data as testing data and the results of the other three supplementary experiments using the first second and fourth group as testing data are shown in fig s3 in the supplementary materials results show that independent of testing data selection lstm and gru models outperform ann models and the nse values in lstm and gru models remain constant with large time steps which eliminates the necessity of time step optimization 5 conclusions in this paper two popular variants of the rnn networks named gru and lstm networks are evaluated we apply the gru lstm and ann models to event based short term rainfall runoff simulations in the yutan station control catchment the following can be concluded from this study 1 gru and lstm models are able to simulate rainfall runoff processes accurately by employing time sequences input the results show that gru and lstm networks have the capability to filter out redundant information in modeling rainfall runoff relationships they are less sensitive to redundant information introduced by larger time steps in contrast the traditional ann models show obvious decline of prediction accuracy when the prediction lead time is larger than its optimal value this significantly simplifies the workflow when using lstm and gru models in runoff prediction because optimization of the time step is not necessary with lstm and gru models one can select a relatively large time step to ensure the prediction accuracy 2 predictions by lstm and gru models are less uncertain compared to those by ann models suggested by the narrower bands in nse values fig 2 results are less likely to vary when simulations are repeated multiple times in lstm and gru models simulations of individual runoff events show that lstm and gru models predict runoff curves with less abnormal fluctuations than ann models fig 10 3 gru and lstm models show better prediction accuracy than ann models even with optimal time step especially when predictions with large lead times are required in practical applications the earlier the flood is predicted in advance the more effective the flood control methods will be gru and lstm models are especially useful in such situations 4 gru and lstm models predict runoff with almost identical accuracy given that gru has simpler structures and less parameters and requires less time for model training it may be the preferred method for short term runoff prediction credit authorship contribution statement shuai gao methodology software formal analysis writing original draft writing review editing yuefei huang methodology writing review editing shuo zhang methodology writing review editing jingcheng han data curation guangqian wang methodology writing review editing meixin zhang data curation qingsheng lin data curation declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgements we thank four anonymous reviewers for their constructive comments and suggestions this work was financially supported by the national natural science foundation of china no 91647212 no 51809007 major basic research development program of the science and technology agent qinghai province 2019 sf 146 and the innovation foundation for water development of shenzhen 0832 sfcx18szc025 appendix a supplementary data supplementary data to this article can be found online at https doi org 10 1016 j jhydrol 2020 125188 appendix a supplementary data the following are the supplementary data to this article supplementary data 1 
5256,satellite remote sensing has been extensively used for estimating the suspended sediment concentration ssc in coastal and inland waters the application of this method to smaller waterbodies however encounters several limitations such as the coarse temporal and spatial resolution of satellite images cloud coverage intercession and inaccessibility during emergency periods conventional digital cameras are used for monitoring the water quality parameters in inland waters but their application for remote sensing of ssc in inland waters is still under development the empirical models developed to estimate ssc from digital imagery are usually site specific and do not consider the effect of the sediment properties such as grain size and shape sediment color and types of minerals the performance of digital cameras for estimating ssc is assessed in this study and the effect of sediment color on the accuracy of this method is investigated a series of laboratory experiments were conducted using four different colors of sediment light gray dark gray light brown and dark brown the results showed that the red waveband reflectance of digital imagery was more sensitive to the variation of ssc than that of blue and green waveband the sediment color evidently affected the correlation between the measured ssc and waveband reflectance even with the same particle size distribution sediment with darker color showed the lowest reflectance values whereas lighter color sediment has the highest reflectance values the performance of the developed ssc reflectance regression models for all sediment colors was assessed at two river sites i e village creek and the west fork trinity river the correlation between measured and predicted ssc for village creek that had the same sediment size and color as the light gray soil was high r 2 0 98 the correlation was relatively low r 2 0 55 for the west fork trinity river and dark gray soil water samples which had a similar color and different sediment sizes the difference in sediment sizes could explain why the ssc reflectance model derived from the dark gray soil exhibited poor performance in predicting the ssc for this site this study demonstrated that consideration of sediment color effect in developing a remote sensing algorithm from digital imagery would result in more accurate estimations of ssc in riverine environments keywords remote sensing reflectance suspended sediment concentration sediment color sediment monitoring digital imagery river water 1 introduction suspended sediments may pose a major threat to riverine environments as they carry chemicals and contaminants that affect aquatic ecosystems castro and reckendorf 1995 river sedimentation also impacts the geomorphology of streams that could result in channel degradation and aggradation and catastrophic events such as floods and droughts liew et al 2003 amsalu et al 2007 pereira et al 2018 accurate measurement of the ssc is required for monitoring water quality and river morphodynamics islam et al 2001 tripathy et al 2018 traditionally ssc is estimated by in situ sampling and lab analysis of the collected samples ssc data collected by this method is found accurate and has used in several model validation studies e g gholizadeh et al 2016 pereira et al 2018 however these conventional ssc measuring techniques suffer from various limitations that are identified by several studies qu 2014 pointed out that in situ and laboratory analysis of ssc are time consuming and labor intensive and it provides only point data at gauging stations gebreslassie et al 2020 also discussed that the traditional ssc sampling stations are very scarce and it is challenging to get adequate and continuous sediment data for most rivers moreover more than 75 of the countries in the world do not have comprehensive water quality monitoring infrastructures and will not have them in the near future davis and hirji 2003 therefore developing a reliable and cost effective technique for estimating ssc in riverine environments has been the focus of several studies several methods have been developed including empirical sediment rating curves moges et al 2016 physically based models defersha et al 2012 maalim et al 2013 semi distributed models and time continuous hydrologic models yesuf et al 2015 but the application of these hydrologic models is limited to areas with a large amount of gauged data and they are usually site specific satellite remote sensing is widely used for the temporal and spatial monitoring of suspended sediment concentration within coastal waters tassan 1994 river deltas long and pavelsky 2013 lakes li et al 2019 reservoirs ritchie et al 1976 and large rivers islam et al 2001 villar et al 2012 park and latrubesse 2014 the remote sensing technique is based on the principle that suspended sediment in the water is a highly active optical constituent that can increase the emitted energy from water surfaces remote sensing techniques for water quality monitoring were developed primarily for marine environments ritchie et al 1976 lee et al 1998 islam et al 2003 wang et al 2009 the promising results from these investigations of coastal waters inspired researchers to explore the possibility of utilizing remote sensing for water quality monitoring in inland waters such as lakes and reservoirs ritchie and cooper 1991 ma and dai 2005 ayana et al 2015 the applicability of the remote sensing models for water quality monitoring also has been explored to estimate ssc in large river systems villar et al 2012 kilham et al 2012 umar et al 2018 satellite remote sensing has been used successfully for predicting and monitoring suspended sediment in rivers but it encounters several limitations especially in smaller water bodies these limitations include coarse temporal spatial spectral and radiometric resolutions of the sensors long revisit periods cloud coverage intercession and inaccessibility during emergency periods miller and mckee 2004 gebreslassie et al 2020 although manned aircraft or lidar can provide higher flexibility and finer spatiotemporal resolution they are associated with expensive operation costs and extensive post processing liu 2008 gholizadeh et al 2016 mcqueen and suedel 2018 digital cameras deployed on aircraft or unmanned aerial vehicle uav systems could provide much more flexibility in field campaigns and in the collection of finer resolution data that is required for mapping ssc in narrow river settings therefore digital cameras could be used as a remote sensing instrument for monitoring water quality because of its affordability and high quality images developing a model that infers ssc from satellite imagery is a crucial part of using remote sensing method for estimating suspended sediment sediment concentrations can be retrieved from remotely sensed data by developing a relationship between in situ suspended sediment values and ground based reflected water radiance ritchie et al 1987 multi band spectro radiometers are used for collecting water leaving radiance to develop such a relationship and the recorded radiance is then integrated with satellite wavebands bhargava and mariam 1990 choubey 1998 instead of traditional radiometers digital cameras have been used as a three band radiometer for collecting reflected radiance and remote sensing estimation of water quality parameters crop reflectance urban settlements and construction quality management goddijn murphy et al 2009 mcqueen and suedel 2018 congress and puppala 2019 the use of conventional digital cameras for monitoring water quality parameters in natural inland waters has been explored recently but the monitoring system based on digital cameras is usually site specific and based on local conditions mcqueen and suedel 2018 the use of digital cameras for remote sensing of ssc in natural inland waters is still under development for global application to the authors knowledge no universal algorithm has been developed to estimate suspended sediments using digital camera sensors the water surface reflectance measured from remotely sensed images exhibits a strong positive relationship with sediment concentrations because of the light scattering by the suspended sediment kirk 1994 mobley 1999 suspended sediment in water increases the reflected light from the water surface in the visible and near infrared part of the electromagnetic spectrum which makes the satellite images essential information for studying the variability of suspended sediment in riverine environments ritchie and schiebe 2000 empirical algorithms have been established to analyze the relationship between the ssc and reflected signals doxaran et al 2002 song 2011 wu et al 2014 but in most instances they do not account for the contribution of the optical property of sediments i e grain size and shape sediment color and mineral characteristics of the sediment particles even though the strength of the ssc reflectance relationship depends on these properties novo et al 1989a b bhargava and mariam 1990 choubey 1998 volpe et al 2011 in addition the empirical models developed from remotely sensed or field derived reflectance are less reliable for global application in different geographic areas ruhl et al 2001 kilham et al 2012 physically based spectral mixing analysis sma methods have been developed to account for the sediment mineralogy and particle size distribution villar et al 2012 qu 2014 gebreslassie et al 2020 these methods attribute both inherent and apparent optical properties of the sediment types sma determines the contribution of water components to signals received by images however the sma algorithms usually work best for waterbodies with a high concentration of sediment and they become very complicated if more than one constituent is present in the water although the sma approach was developed to account for sediment grain size distribution and mineralogy the effects of sediment color have not been investigated yet and a more reliable ssc reflectance algorithm needs to be developed it can be concluded from the literature that the application of remote sensing technology to river waters is still under development before employing the remote sensing technique in riverine systems the sediment type and its effect on the reflectance need to be addressed the overall focus of this research is to investigate the effect of sediment color on the estimation of ssc in inland waters so that an empirical model with improved predictability can be developed an attempt was made in this research to investigate the response of digital imagery to different suspended materials and their effects on the reflectance values the specific objectives of this study are to i determine the capability of digital image sensors as remote sensing platforms for estimating ssc ii identify the effect of sediment color on the reflectance retrieved from digital imagery and iii compare and validate the developed ssc reflectance algorithm with field data 2 materials and methods suspended sediments composed of very fine sand silt and clay are responsible for changing the color and turbidity of river water walling and moorehead 1989 the change in the color of the water due to sediment can be temporary after a storm or permanent if the river continuously carries a significant amount of sediment in this study four different soils collected from several sites in texas u s were added to water to mimic the sediment color in natural rivers the soils were dark gray light gray dark brown and light brown and had similar grain size distributions the experiments were conducted in the hydraulics laboratory of the university of texas at arlington sediment preparation consisted of the following four steps 1 drying soil in the oven for 24 hr and pulverization 2 sieving pulverized materials through 200 0 075 mm sieve to collect fine sand silt and clay particles 3 mixing soil particles with water in a container using a mechanical mixer and 4 adding the soil mixture into the experimentation tank as all of the experiments were conducted with fine sediment sizes the hydrometer method was used to prepare the particle distribution curves the grain size distribution curves of the soils used in the experiments are plotted in fig 1 and presented in table 1 as can be seen the grain size distributions of all soil types were very similar but the color variations among them were easily seen the experiments were performed in a circular water tank that was placed in a dark room to avoid the influence of illumination from the surrounding lights the inside of the 122 cm diameter and 25 cm deep circular tank was painted black to prevent any reflectance from the side and bottom of the tank tolk et al 2000 the soil was mixed with water in a 20 liter container using a mechanical mixer for at least one minute to ensure a homogeneous sediment water mixture the mixture was then added to the water tank the total depth and volume of the water and sediment mixture in the tank were 23 cm and 300 liter respectively a pump pipe system was designed and installed to keep the sediment in suspension during the experiments this system included a pedestal sump pump and pvc polyvinyl chloride perforated pipes the pump drew water from the tank and forced it through 3 2 mm diameter orifices drilled every 13 cm along the pipes the pump and pipe system were also painted black to avoid any light reflection the experimental setup is shown schematically in fig 2 since illumination affects the reflectance signals received from water and limits the accuracy of the ssc estimation bhargava and mariam 1990 doxaran et al 2003 a constant illumination was provided by two 500 watt halogen bulbs a zenith angle of 45 or nadir angle of 135 was used as the viewing angle for the halogen bulb to provide a spatially uniform beam of light and to avoid a shadow effect from the instruments qu 2014 leeuw and boss 2018 the water surface radiance was measured with a canon 600d digital camera that was mounted on a tripod for stability digital cameras use ccd charged coupled device sensors to record electromagnetic energy into three visible wavebands red green and blue for the uniformity of image collection the aperture value and white balance were held constant while taking images the other settings such as exposure time and iso were allowed to vary and later used for the calculation of radiance and reflectance the camera was set at a 40 nadir angle to record images vertically 1 m above the tank s water surface leeuw 2014 this setup ensured a target area of 20 cm 5 cm the experimental tank and position of the halogen bulbs and camera are shown in fig 2 the remote sensing reflectance from the field data can be calculated from eq 1 which was developed by mobley 1994 and is widely used by researchers around the world the remote sensing reflectance signal r λ for a specific wavelength is defined by 1 r λ l w λ e d λ where l w is the average water leaving radiance and e d is the downwelling irradiance the water leaving radiance is not directly measurable in field conditions however it can be obtained by measuring the sky radiance and wave state radiance l r which can be replaced by ρ l s here l s is the average reflectivity measured from the sky and ρ is the proportionality factor that relates the radiance measured when the camera views the reflected sky on the water surface the ρ value varies depending on the sky conditions and observation angle to minimize the amount of surface reflection and thus ρ the water surface radiance is measured at an azimuth angle 135 from the sun and 40 from the nadir leeuw and boss 2018 under these conditions the value of ρ is taken as approximately 0 028 mobley 1999 2015 the above mentioned spectral radiances and their measurement configurations for field water samples are schematically depicted in fig 3 the water leaving radiance l w can be rewritten as l w l t l r where l t is the total radiance reaching the camera sensor fig 3 and is directly measurable note that the denominator in eq 1 is equal to the downwelling irradiance e d the downwelling irradiance can be determined by measuring the radiance of a reflectance standard assuming that the standard is a lambertian reflector when an irradiance falls onto a lambertian surface the downwelling irradiance e d can be expressed as mobley 1999 2 e d π l c λ r ref from the above consideration eq 1 can be rewritten as 3 r λ l t λ ρ l s λ π l c λ r ref 100 where l c λ is defined as the calibration panel or gray card radiance and r ref is the calibration factor 0 18 for the gray card reference panel a photographer s 18 reflectance gray card 400 λ 700 n m can be used as a lambertian reflector of a known reflectance surface panel carder and steward 1985 tolk et al 2000 leeuw and boss 2018 the gray card also serves as the calibration standard for converting radiance into reflectance eq 3 is modified by discarding the effect of the sky ρ l s λ to calculate the spectral reflectance inside the laboratory for the images taken in the laboratory the r λ values were calculated using the following equation 4 r λ l t λ π l c λ r ref 100 in this study eqs 3 and 4 were used for calculating remote sensing reflectance from the water surface in the field and the experimental water tank respectively a total of 56 samples were prepared and tested throughout this study except for the sediment color the variables and experimental procedures were identical for each of the samples for each sediment color 14 suspended sediment concentrations were developed in the water tank ranging from 25 to 500 mg l 25 mg l increment for 0 200 mg l mixtures and 50 mg l increment for 200 500 mg l mixtures water samples were collected from each experiment in 1 liter bottles for laboratory testing to verify whether the pump pipe system and sediment mixing were effective at keeping the sediment in suspension throughout the experiment the collected water samples were analyzed in the water quality laboratory for the suspended sediment concentration a volumetric filtration method was used for measuring the ssc which entailed preparing the filter drying the filter weighing the filter filtering the collected suspended sediment sample oven drying the sample overnight and finally re weighing the sample the concentration of suspended sediments was calculated using the following formula 5 s s c w s w o v where w s is the oven dried weight of the sample and filter mg w o is the oven dried weight of the blank filter paper mg and v is the volume of the sample used during filtration liter eq 5 was used to calculate the ssc mg l of the collected samples from the laboratory experiments as well as from the field the results from the laboratory measurement of ssc from the collected samples showed that a mixing time of one minute and using the pump pipe circulation system resulted in 96 98 recovery of sediment concentration this means that if the ssc were targeted to be for example 100 mg l in the water tank the actual concentration would be between 96 and 98 mg l the reason for not fully reaching the target concentrations and losing a small fraction 2 4 of sediment in suspension was because of the finer sediment particle stuck to the circulation pipes and water sample bottle 3 results and discussion 3 1 calculating reflectance values spectral properties of the sediment laden water surface were extracted from the digital imagery to estimate the spectral reflectance of the suspended sediment sample images taken from the surface of the water in the experimental tank with ssc 100 mg l for each soil color are presented in fig 4 an image processing algorithm is developed in matlab environment to calculate the spectral responses from digital imagery the average spectral reflectance was calculated from a square box of 200 200 pixels corresponding to a spatial resolution of 0 35 mm px to remove random noise in this experiment the spectral response of the different levels of suspended sediment concentration of all four sediment types light gray dark gray light brown and dark brown was measured in terms of percentage of reflectance using eq 4 fig 5 a d shows the results of the spectral reflectance of water with ssc from 0 to 500 mg l for all soil types in each experiment and prior to the addition of sediment to the water tank images were collected from the clear water sediment free spectral reflectance increased at all wavebands red green and blue as a result of increasing the ssc for all sediment types it was also observed that the maximum reflectance occurred for the red waveband followed by the green and blue wavebands previous studies also found that red and near infrared nir wavebands are more sensitive to ssc up to 1000 mg l doxaran et al 2002 karabulut and ceylan 2005 the spectral characteristics observed in this experiment indicating the highest reflectance values for the red waveband among the three wavebands in the digital imagery are fully supported by the literature in the absence of suspended sediments the spectral reflectance of the clear water ranged from 0 46 to about 1 05 fig 5 which was due to the black color of the wall and bottom of the tank from these graphs it can be observed that the blue waveband showed the maximum reflectance 1 05 for clear water while the red waveband exhibited the maximum reflectance 5 6 to 12 93 for experiments with sediment concentrations from 25 to 500 mg l from the images collected from experiments over a wide range of ssc 25 500 mg l it was observed that the reflectance values varied within a narrow range for green and blue wavebands indicating that these wavebands were not good candidates for ssc estimation fig 6 a d shows the calculated reflectance from digital images of red green and blue wavebands with the ssc increasing from 0 to 500 mg l this figure reveals that the reflectance response to variations in the ssc of these wavebands can be divided into two distinct ranges of sediment concentration for the ssc smaller than 200 mg l a positive linear increasing trend was detected between reflectance and ssc values in visible wavebands for all types of sediment for the ssc greater than 200 mg l the reflectance of the green and blue wavebands tended to be asymptotic the reflectance of the red waveband increased but with a smaller gradient than that of the ssc smaller than 200 mg l this behavior of the reflectance ssc relationship known as model saturation has been investigated by many researchers and is due to the fact that visible bands are subject to saturation as suspended sediment concentration increases and the reflectance factor becomes less sensitive to highly turbid waters sterckx et al 2007 smith et al 2009 ritchie et al 2013 umar et al 2018 li et al 2019 saturation can occur in any reflectance waveband ranging from visible to nir bands and usually occurs because of instrument limitations and the complex behavior of highly turbid gilvear et al 2007 pereira et al 2018 the results from this study also indicate that red waveband reflectance is more sensitive to suspended sediment of medium to high concentrations than are blue and green wavebands several previous studies have established that empirical models that are developed based on local data may not be effective in global settings since reflectance ssc relationships are affected by particle size distribution and sediment mineralogy ritchie and cooper 1991 doxaran et al 2003 long and pavelsky 2013 conversely the results from this study show that the spectral reflectance varies significantly for water with low to medium ssc values as shown in fig 6 even though the particle size distribution for the four sediment samples is similar to fully capture the effects of the sediment color only the red waveband reflectance ssc values were plotted as shown in fig 7 from this figure it can be observed that the light brown soil had the highest reflectance value 12 93 and the dark gray soil had the lowest reflectance value 5 6 reflectance varies with sediment color because the lighter colored particles reflect more light than darker colored particles it is also noteworthy that the impact of the sediment color on reflectance features emerged at the visible wavebands which could be related to the pixel value variation in a remotely sensed image for example the pixel values of a digital image range from 0 to 255 with 0 indicating black and 255 indicating white and the pixel values of lighter colored sediment are higher than those of darker sediment which causes a higher reflectance value consequently light shades of gray and brown soil display higher reflectance than dark gray and brown soils from this observation it can be concluded that sediment color influences the reflectance values and reflectance is higher for lighter shades of sediment particles 3 2 developing ssc reflectance relationships in this study 56 experiments were performed in the circular tank 14 samples for each soil type by changing the sediment concentration from 25 to 500 mg l water samples and images were collected from each experiment to develop ssc reflectance relationships previous studies suggest that the relationship between the ssc and spectral responses can be linear log linear exponential or logarithmic wang et al 2009 smith et al 2009 pavelsky and smith 2009 tian et al 2014 for the soils tested in this study a linear relationship was observed between the ssc and red waveband reflectance for sediment concentrations between 0 and 200 mg l the relationship for higher sediment concentrations was non linear as shown in fig 7 because of the non linear response of reflectance with the entire range of ssc the ssc values were natural log transformed to develop linear relationships with the reflectance of visible wavebands chu et al 2009 ramakrishnan et al 2013 zhang et al 2014 the measured ssc data from the lab were regressed log linearly against the red waveband r3 maximum reflectance the band ratio of the red to blue waveband r3 r1 maximum reflectance maximum absorbance and a combination of the two r3 r3 r1 the statistical parameters including correlation coefficient r 2 p values and f statistic for all soil types are presented in table 2 although the red waveband waveband ratios and combination of wavebands reflectance produced similar correlation coefficients the red waveband provided the best statistical parameters such as smaller p value and higher f statistic for this reason the red waveband was selected as the independent variable for developing the ssc reflectance regression models the developed regression models for all sediment types are depicted in fig 8 which shows that the spectral reflectance has a linear relationship with log transformed ssc regardless of the sediment color however the regression coefficient varies depending on the sediment color and its effect on the reflectance property the highest r 2 values calculated from the analyzed reflectance ssc relationships were found for the dark brown soil 0 98 and the lowest r 2 value was observed for the dark gray soil 0 96 reflectance ssc relationships are presented in table 3 3 3 comparison with the field observations the field data were collected from the west fork trinity wft river and village creek in texas u s in 2018 the same instrumentation and camera setup were used to capture images from the field the instrument setup in the lab and field conditions is illustrated in fig 2 and fig 3 the images from the water surface were captured at 40 from the nadir and 135 zenith angle from the light source for both laboratory and field sites sample images collected from the surface of the water at two river sites are represented in fig 9 ssc samples and images from the field were collected in june dec 2018 during this period the minimum and maximum flows in the wft river were 10 and 415 m3 s respectively the flow record at this site for the 2015 2019 period shows the mean and maximum values of 35 3 and 510 m3 s respectively during the same timeframe june dec 2018 the minimum and maximum flows in village creek were 0 05 to 28 m3 s the historical data 2014 2019 at this site shows the mean and maximum flows of 1 06 and 453 m3 s the sediment concentrations in the wft river and village creek varied from 15 to 475 mg l and 7 to 387 mg l respectively during the sampling period for each of the river sites the reflectance values for red waveband are compared with the reflectance values collected from laboratory experiments fig 10 a and 10b this comparison showed that the wft river reflectance values were more consistent with the dark gray soil reflectance values and the village creek water reflectance showed better agreement with the light gray soil reflectance values the performance of the developed ssc reflectance models for all sediment colors was assessed by plotting the field ssc data from two river sites and the lab data shown in fig 11 the in situ ssc and red waveband reflectance r3 of the images collected from the wft river were plotted with the ssc reflectance model developed dark gray soil fig 11a because of their similar reflectance values the village creek water sample reflectance values were however comparable to the water mixture prepared in the lab using the light gray soil fig 11b predictions from the model for the light gray soil from village creek produced an r 2 value of 0 98 while the model for the wft river from the dark gray soil produced an r 2 value of 0 55 the particle size distributions of the water sample from the wft river and village creek are plotted in fig 12 along with those for the dark gray and light gray soil respectively from fig 12a it is evident that the dark gray sediment size is different from the particle size in the wft river water sample the percentage of clay and silt in the wft river is much higher than the dark gray soil sample fig 12a it can be observed that even though these two samples have similar reflectance values their particle size distribution is different which could considerably impair the color based ssc reflectance model this difference in sediment sizes could explain why the ssc reflectance model derived from dark gray soil exhibited poor performance in predicting the ssc for the wft river the correlation between measured and predicted ssc for the wft river is relatively low r 2 0 55 on the contrary the village creek particle size is similar to the light gray sediment size fig 12b therefore the ssc reflectance model developed for light gray soil predicts the ssc for village creek with more accurately and with a higher correlation between measured and estimated ssc values r 2 0 98 the observed versus predicted ssc values for both streams are shown in fig 13 and a summary of the number of data points the correlation coefficient r 2 value root mean square error rmse and mean absolute error mae for each site are provided in table 4 the model for the dark gray soil produced an rmse value of 105 mg l and mae of 88 mg l for the wft river the model for the light gray soil produced an rmse of 22 mg l and mae of 18 mg l the coefficients of determination rmse and mae for these two sites were consistent with the values of the previously developed reflectance ssc models fraser 1998 smith et al 2009 song 2011 4 conclusion remote sensing has been established as the most effective way to monitor and assess water quality in coastal environments however spatial and temporal limitations of the current satellite sensors impede the application of satellite remote sensing to riverine environments consumer grade digital camera sensors may provide improved spatial and temporal resolutions required to monitor water quality parameters in rivers and streams but this approach has not been fully explored this study aimed at investigating relationships between ssc and spectral reflectance of turbid water by utilizing digital cameras and identifying the effect of sediment color on the relationships images captured by digital cameras in this study had finer spatial resolution 0 35 mm px than satellite images which is required for estimating ssc in riverine settings digital images provided spectral reflectance values in three visible wavebands namely red green and blue it was found that spectral reflectance of visible wavebands and ssc were positively correlated in addition red waveband reflectance was found to be more sensitive to ssc variations than that of blue and green wavebands reflectance the laboratory results showed that sediment color played a significant role in estimating ssc from spectral reflectance values spectral reflectance varied significantly with sediment color in experiments with medium to high ssc values for water samples with the same particle size distribution visible waveband reflectance indicated that lighter color sediments reflected more energy than the darker color sediments in all experiments with four different sediment colors as the ssc increased reflectance values for highly turbid water tend to be saturated reaching a plateau log linear relationships between ssc and reflectance were developed to be utilized in estimating ssc from regressed models based on the coefficient of determination and other statistical parameters it was concluded that the regression models developed based on the red waveband reflectance performed better in estimating ssc for all sediment colors the performance of the regression models was assessed in village creek and the wft river the spectral reflectance of the images taken from the wft river and village creek were consistent with the dark gray and the light gray sediments reflectance values respectively however the ssc reflectance model performed better for village creek than for the wft river further investigation showed that the village creek water samples had the same sediment size as the light gray soil sample but water samples from the wft river and dark gray soil sample were different in sediment size the effect of grain size distribution in this river evidently affected the performance of the ssc reflectance model the finding of this study provides valuable information while developing a regional or global algorithm for estimating ssc from digital imagery in this study only the effect of sediment color on ssc reflectance properties was investigated more studies are needed to demonstrate and quantify the effect of sediment size form and type of minerals that may affect the estimation of sediment concentration from digital imagery credit authorship contribution statement shah md imran kabir conceptualization visualization methodology resources data curation formal analysis investigation software writing original draft habib ahmari conceptualization resources visualization supervision validation writing review editing project administration declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments this research did not receive any specific grant from funding agencies in the public commercial or not for profit sectors 
5256,satellite remote sensing has been extensively used for estimating the suspended sediment concentration ssc in coastal and inland waters the application of this method to smaller waterbodies however encounters several limitations such as the coarse temporal and spatial resolution of satellite images cloud coverage intercession and inaccessibility during emergency periods conventional digital cameras are used for monitoring the water quality parameters in inland waters but their application for remote sensing of ssc in inland waters is still under development the empirical models developed to estimate ssc from digital imagery are usually site specific and do not consider the effect of the sediment properties such as grain size and shape sediment color and types of minerals the performance of digital cameras for estimating ssc is assessed in this study and the effect of sediment color on the accuracy of this method is investigated a series of laboratory experiments were conducted using four different colors of sediment light gray dark gray light brown and dark brown the results showed that the red waveband reflectance of digital imagery was more sensitive to the variation of ssc than that of blue and green waveband the sediment color evidently affected the correlation between the measured ssc and waveband reflectance even with the same particle size distribution sediment with darker color showed the lowest reflectance values whereas lighter color sediment has the highest reflectance values the performance of the developed ssc reflectance regression models for all sediment colors was assessed at two river sites i e village creek and the west fork trinity river the correlation between measured and predicted ssc for village creek that had the same sediment size and color as the light gray soil was high r 2 0 98 the correlation was relatively low r 2 0 55 for the west fork trinity river and dark gray soil water samples which had a similar color and different sediment sizes the difference in sediment sizes could explain why the ssc reflectance model derived from the dark gray soil exhibited poor performance in predicting the ssc for this site this study demonstrated that consideration of sediment color effect in developing a remote sensing algorithm from digital imagery would result in more accurate estimations of ssc in riverine environments keywords remote sensing reflectance suspended sediment concentration sediment color sediment monitoring digital imagery river water 1 introduction suspended sediments may pose a major threat to riverine environments as they carry chemicals and contaminants that affect aquatic ecosystems castro and reckendorf 1995 river sedimentation also impacts the geomorphology of streams that could result in channel degradation and aggradation and catastrophic events such as floods and droughts liew et al 2003 amsalu et al 2007 pereira et al 2018 accurate measurement of the ssc is required for monitoring water quality and river morphodynamics islam et al 2001 tripathy et al 2018 traditionally ssc is estimated by in situ sampling and lab analysis of the collected samples ssc data collected by this method is found accurate and has used in several model validation studies e g gholizadeh et al 2016 pereira et al 2018 however these conventional ssc measuring techniques suffer from various limitations that are identified by several studies qu 2014 pointed out that in situ and laboratory analysis of ssc are time consuming and labor intensive and it provides only point data at gauging stations gebreslassie et al 2020 also discussed that the traditional ssc sampling stations are very scarce and it is challenging to get adequate and continuous sediment data for most rivers moreover more than 75 of the countries in the world do not have comprehensive water quality monitoring infrastructures and will not have them in the near future davis and hirji 2003 therefore developing a reliable and cost effective technique for estimating ssc in riverine environments has been the focus of several studies several methods have been developed including empirical sediment rating curves moges et al 2016 physically based models defersha et al 2012 maalim et al 2013 semi distributed models and time continuous hydrologic models yesuf et al 2015 but the application of these hydrologic models is limited to areas with a large amount of gauged data and they are usually site specific satellite remote sensing is widely used for the temporal and spatial monitoring of suspended sediment concentration within coastal waters tassan 1994 river deltas long and pavelsky 2013 lakes li et al 2019 reservoirs ritchie et al 1976 and large rivers islam et al 2001 villar et al 2012 park and latrubesse 2014 the remote sensing technique is based on the principle that suspended sediment in the water is a highly active optical constituent that can increase the emitted energy from water surfaces remote sensing techniques for water quality monitoring were developed primarily for marine environments ritchie et al 1976 lee et al 1998 islam et al 2003 wang et al 2009 the promising results from these investigations of coastal waters inspired researchers to explore the possibility of utilizing remote sensing for water quality monitoring in inland waters such as lakes and reservoirs ritchie and cooper 1991 ma and dai 2005 ayana et al 2015 the applicability of the remote sensing models for water quality monitoring also has been explored to estimate ssc in large river systems villar et al 2012 kilham et al 2012 umar et al 2018 satellite remote sensing has been used successfully for predicting and monitoring suspended sediment in rivers but it encounters several limitations especially in smaller water bodies these limitations include coarse temporal spatial spectral and radiometric resolutions of the sensors long revisit periods cloud coverage intercession and inaccessibility during emergency periods miller and mckee 2004 gebreslassie et al 2020 although manned aircraft or lidar can provide higher flexibility and finer spatiotemporal resolution they are associated with expensive operation costs and extensive post processing liu 2008 gholizadeh et al 2016 mcqueen and suedel 2018 digital cameras deployed on aircraft or unmanned aerial vehicle uav systems could provide much more flexibility in field campaigns and in the collection of finer resolution data that is required for mapping ssc in narrow river settings therefore digital cameras could be used as a remote sensing instrument for monitoring water quality because of its affordability and high quality images developing a model that infers ssc from satellite imagery is a crucial part of using remote sensing method for estimating suspended sediment sediment concentrations can be retrieved from remotely sensed data by developing a relationship between in situ suspended sediment values and ground based reflected water radiance ritchie et al 1987 multi band spectro radiometers are used for collecting water leaving radiance to develop such a relationship and the recorded radiance is then integrated with satellite wavebands bhargava and mariam 1990 choubey 1998 instead of traditional radiometers digital cameras have been used as a three band radiometer for collecting reflected radiance and remote sensing estimation of water quality parameters crop reflectance urban settlements and construction quality management goddijn murphy et al 2009 mcqueen and suedel 2018 congress and puppala 2019 the use of conventional digital cameras for monitoring water quality parameters in natural inland waters has been explored recently but the monitoring system based on digital cameras is usually site specific and based on local conditions mcqueen and suedel 2018 the use of digital cameras for remote sensing of ssc in natural inland waters is still under development for global application to the authors knowledge no universal algorithm has been developed to estimate suspended sediments using digital camera sensors the water surface reflectance measured from remotely sensed images exhibits a strong positive relationship with sediment concentrations because of the light scattering by the suspended sediment kirk 1994 mobley 1999 suspended sediment in water increases the reflected light from the water surface in the visible and near infrared part of the electromagnetic spectrum which makes the satellite images essential information for studying the variability of suspended sediment in riverine environments ritchie and schiebe 2000 empirical algorithms have been established to analyze the relationship between the ssc and reflected signals doxaran et al 2002 song 2011 wu et al 2014 but in most instances they do not account for the contribution of the optical property of sediments i e grain size and shape sediment color and mineral characteristics of the sediment particles even though the strength of the ssc reflectance relationship depends on these properties novo et al 1989a b bhargava and mariam 1990 choubey 1998 volpe et al 2011 in addition the empirical models developed from remotely sensed or field derived reflectance are less reliable for global application in different geographic areas ruhl et al 2001 kilham et al 2012 physically based spectral mixing analysis sma methods have been developed to account for the sediment mineralogy and particle size distribution villar et al 2012 qu 2014 gebreslassie et al 2020 these methods attribute both inherent and apparent optical properties of the sediment types sma determines the contribution of water components to signals received by images however the sma algorithms usually work best for waterbodies with a high concentration of sediment and they become very complicated if more than one constituent is present in the water although the sma approach was developed to account for sediment grain size distribution and mineralogy the effects of sediment color have not been investigated yet and a more reliable ssc reflectance algorithm needs to be developed it can be concluded from the literature that the application of remote sensing technology to river waters is still under development before employing the remote sensing technique in riverine systems the sediment type and its effect on the reflectance need to be addressed the overall focus of this research is to investigate the effect of sediment color on the estimation of ssc in inland waters so that an empirical model with improved predictability can be developed an attempt was made in this research to investigate the response of digital imagery to different suspended materials and their effects on the reflectance values the specific objectives of this study are to i determine the capability of digital image sensors as remote sensing platforms for estimating ssc ii identify the effect of sediment color on the reflectance retrieved from digital imagery and iii compare and validate the developed ssc reflectance algorithm with field data 2 materials and methods suspended sediments composed of very fine sand silt and clay are responsible for changing the color and turbidity of river water walling and moorehead 1989 the change in the color of the water due to sediment can be temporary after a storm or permanent if the river continuously carries a significant amount of sediment in this study four different soils collected from several sites in texas u s were added to water to mimic the sediment color in natural rivers the soils were dark gray light gray dark brown and light brown and had similar grain size distributions the experiments were conducted in the hydraulics laboratory of the university of texas at arlington sediment preparation consisted of the following four steps 1 drying soil in the oven for 24 hr and pulverization 2 sieving pulverized materials through 200 0 075 mm sieve to collect fine sand silt and clay particles 3 mixing soil particles with water in a container using a mechanical mixer and 4 adding the soil mixture into the experimentation tank as all of the experiments were conducted with fine sediment sizes the hydrometer method was used to prepare the particle distribution curves the grain size distribution curves of the soils used in the experiments are plotted in fig 1 and presented in table 1 as can be seen the grain size distributions of all soil types were very similar but the color variations among them were easily seen the experiments were performed in a circular water tank that was placed in a dark room to avoid the influence of illumination from the surrounding lights the inside of the 122 cm diameter and 25 cm deep circular tank was painted black to prevent any reflectance from the side and bottom of the tank tolk et al 2000 the soil was mixed with water in a 20 liter container using a mechanical mixer for at least one minute to ensure a homogeneous sediment water mixture the mixture was then added to the water tank the total depth and volume of the water and sediment mixture in the tank were 23 cm and 300 liter respectively a pump pipe system was designed and installed to keep the sediment in suspension during the experiments this system included a pedestal sump pump and pvc polyvinyl chloride perforated pipes the pump drew water from the tank and forced it through 3 2 mm diameter orifices drilled every 13 cm along the pipes the pump and pipe system were also painted black to avoid any light reflection the experimental setup is shown schematically in fig 2 since illumination affects the reflectance signals received from water and limits the accuracy of the ssc estimation bhargava and mariam 1990 doxaran et al 2003 a constant illumination was provided by two 500 watt halogen bulbs a zenith angle of 45 or nadir angle of 135 was used as the viewing angle for the halogen bulb to provide a spatially uniform beam of light and to avoid a shadow effect from the instruments qu 2014 leeuw and boss 2018 the water surface radiance was measured with a canon 600d digital camera that was mounted on a tripod for stability digital cameras use ccd charged coupled device sensors to record electromagnetic energy into three visible wavebands red green and blue for the uniformity of image collection the aperture value and white balance were held constant while taking images the other settings such as exposure time and iso were allowed to vary and later used for the calculation of radiance and reflectance the camera was set at a 40 nadir angle to record images vertically 1 m above the tank s water surface leeuw 2014 this setup ensured a target area of 20 cm 5 cm the experimental tank and position of the halogen bulbs and camera are shown in fig 2 the remote sensing reflectance from the field data can be calculated from eq 1 which was developed by mobley 1994 and is widely used by researchers around the world the remote sensing reflectance signal r λ for a specific wavelength is defined by 1 r λ l w λ e d λ where l w is the average water leaving radiance and e d is the downwelling irradiance the water leaving radiance is not directly measurable in field conditions however it can be obtained by measuring the sky radiance and wave state radiance l r which can be replaced by ρ l s here l s is the average reflectivity measured from the sky and ρ is the proportionality factor that relates the radiance measured when the camera views the reflected sky on the water surface the ρ value varies depending on the sky conditions and observation angle to minimize the amount of surface reflection and thus ρ the water surface radiance is measured at an azimuth angle 135 from the sun and 40 from the nadir leeuw and boss 2018 under these conditions the value of ρ is taken as approximately 0 028 mobley 1999 2015 the above mentioned spectral radiances and their measurement configurations for field water samples are schematically depicted in fig 3 the water leaving radiance l w can be rewritten as l w l t l r where l t is the total radiance reaching the camera sensor fig 3 and is directly measurable note that the denominator in eq 1 is equal to the downwelling irradiance e d the downwelling irradiance can be determined by measuring the radiance of a reflectance standard assuming that the standard is a lambertian reflector when an irradiance falls onto a lambertian surface the downwelling irradiance e d can be expressed as mobley 1999 2 e d π l c λ r ref from the above consideration eq 1 can be rewritten as 3 r λ l t λ ρ l s λ π l c λ r ref 100 where l c λ is defined as the calibration panel or gray card radiance and r ref is the calibration factor 0 18 for the gray card reference panel a photographer s 18 reflectance gray card 400 λ 700 n m can be used as a lambertian reflector of a known reflectance surface panel carder and steward 1985 tolk et al 2000 leeuw and boss 2018 the gray card also serves as the calibration standard for converting radiance into reflectance eq 3 is modified by discarding the effect of the sky ρ l s λ to calculate the spectral reflectance inside the laboratory for the images taken in the laboratory the r λ values were calculated using the following equation 4 r λ l t λ π l c λ r ref 100 in this study eqs 3 and 4 were used for calculating remote sensing reflectance from the water surface in the field and the experimental water tank respectively a total of 56 samples were prepared and tested throughout this study except for the sediment color the variables and experimental procedures were identical for each of the samples for each sediment color 14 suspended sediment concentrations were developed in the water tank ranging from 25 to 500 mg l 25 mg l increment for 0 200 mg l mixtures and 50 mg l increment for 200 500 mg l mixtures water samples were collected from each experiment in 1 liter bottles for laboratory testing to verify whether the pump pipe system and sediment mixing were effective at keeping the sediment in suspension throughout the experiment the collected water samples were analyzed in the water quality laboratory for the suspended sediment concentration a volumetric filtration method was used for measuring the ssc which entailed preparing the filter drying the filter weighing the filter filtering the collected suspended sediment sample oven drying the sample overnight and finally re weighing the sample the concentration of suspended sediments was calculated using the following formula 5 s s c w s w o v where w s is the oven dried weight of the sample and filter mg w o is the oven dried weight of the blank filter paper mg and v is the volume of the sample used during filtration liter eq 5 was used to calculate the ssc mg l of the collected samples from the laboratory experiments as well as from the field the results from the laboratory measurement of ssc from the collected samples showed that a mixing time of one minute and using the pump pipe circulation system resulted in 96 98 recovery of sediment concentration this means that if the ssc were targeted to be for example 100 mg l in the water tank the actual concentration would be between 96 and 98 mg l the reason for not fully reaching the target concentrations and losing a small fraction 2 4 of sediment in suspension was because of the finer sediment particle stuck to the circulation pipes and water sample bottle 3 results and discussion 3 1 calculating reflectance values spectral properties of the sediment laden water surface were extracted from the digital imagery to estimate the spectral reflectance of the suspended sediment sample images taken from the surface of the water in the experimental tank with ssc 100 mg l for each soil color are presented in fig 4 an image processing algorithm is developed in matlab environment to calculate the spectral responses from digital imagery the average spectral reflectance was calculated from a square box of 200 200 pixels corresponding to a spatial resolution of 0 35 mm px to remove random noise in this experiment the spectral response of the different levels of suspended sediment concentration of all four sediment types light gray dark gray light brown and dark brown was measured in terms of percentage of reflectance using eq 4 fig 5 a d shows the results of the spectral reflectance of water with ssc from 0 to 500 mg l for all soil types in each experiment and prior to the addition of sediment to the water tank images were collected from the clear water sediment free spectral reflectance increased at all wavebands red green and blue as a result of increasing the ssc for all sediment types it was also observed that the maximum reflectance occurred for the red waveband followed by the green and blue wavebands previous studies also found that red and near infrared nir wavebands are more sensitive to ssc up to 1000 mg l doxaran et al 2002 karabulut and ceylan 2005 the spectral characteristics observed in this experiment indicating the highest reflectance values for the red waveband among the three wavebands in the digital imagery are fully supported by the literature in the absence of suspended sediments the spectral reflectance of the clear water ranged from 0 46 to about 1 05 fig 5 which was due to the black color of the wall and bottom of the tank from these graphs it can be observed that the blue waveband showed the maximum reflectance 1 05 for clear water while the red waveband exhibited the maximum reflectance 5 6 to 12 93 for experiments with sediment concentrations from 25 to 500 mg l from the images collected from experiments over a wide range of ssc 25 500 mg l it was observed that the reflectance values varied within a narrow range for green and blue wavebands indicating that these wavebands were not good candidates for ssc estimation fig 6 a d shows the calculated reflectance from digital images of red green and blue wavebands with the ssc increasing from 0 to 500 mg l this figure reveals that the reflectance response to variations in the ssc of these wavebands can be divided into two distinct ranges of sediment concentration for the ssc smaller than 200 mg l a positive linear increasing trend was detected between reflectance and ssc values in visible wavebands for all types of sediment for the ssc greater than 200 mg l the reflectance of the green and blue wavebands tended to be asymptotic the reflectance of the red waveband increased but with a smaller gradient than that of the ssc smaller than 200 mg l this behavior of the reflectance ssc relationship known as model saturation has been investigated by many researchers and is due to the fact that visible bands are subject to saturation as suspended sediment concentration increases and the reflectance factor becomes less sensitive to highly turbid waters sterckx et al 2007 smith et al 2009 ritchie et al 2013 umar et al 2018 li et al 2019 saturation can occur in any reflectance waveband ranging from visible to nir bands and usually occurs because of instrument limitations and the complex behavior of highly turbid gilvear et al 2007 pereira et al 2018 the results from this study also indicate that red waveband reflectance is more sensitive to suspended sediment of medium to high concentrations than are blue and green wavebands several previous studies have established that empirical models that are developed based on local data may not be effective in global settings since reflectance ssc relationships are affected by particle size distribution and sediment mineralogy ritchie and cooper 1991 doxaran et al 2003 long and pavelsky 2013 conversely the results from this study show that the spectral reflectance varies significantly for water with low to medium ssc values as shown in fig 6 even though the particle size distribution for the four sediment samples is similar to fully capture the effects of the sediment color only the red waveband reflectance ssc values were plotted as shown in fig 7 from this figure it can be observed that the light brown soil had the highest reflectance value 12 93 and the dark gray soil had the lowest reflectance value 5 6 reflectance varies with sediment color because the lighter colored particles reflect more light than darker colored particles it is also noteworthy that the impact of the sediment color on reflectance features emerged at the visible wavebands which could be related to the pixel value variation in a remotely sensed image for example the pixel values of a digital image range from 0 to 255 with 0 indicating black and 255 indicating white and the pixel values of lighter colored sediment are higher than those of darker sediment which causes a higher reflectance value consequently light shades of gray and brown soil display higher reflectance than dark gray and brown soils from this observation it can be concluded that sediment color influences the reflectance values and reflectance is higher for lighter shades of sediment particles 3 2 developing ssc reflectance relationships in this study 56 experiments were performed in the circular tank 14 samples for each soil type by changing the sediment concentration from 25 to 500 mg l water samples and images were collected from each experiment to develop ssc reflectance relationships previous studies suggest that the relationship between the ssc and spectral responses can be linear log linear exponential or logarithmic wang et al 2009 smith et al 2009 pavelsky and smith 2009 tian et al 2014 for the soils tested in this study a linear relationship was observed between the ssc and red waveband reflectance for sediment concentrations between 0 and 200 mg l the relationship for higher sediment concentrations was non linear as shown in fig 7 because of the non linear response of reflectance with the entire range of ssc the ssc values were natural log transformed to develop linear relationships with the reflectance of visible wavebands chu et al 2009 ramakrishnan et al 2013 zhang et al 2014 the measured ssc data from the lab were regressed log linearly against the red waveband r3 maximum reflectance the band ratio of the red to blue waveband r3 r1 maximum reflectance maximum absorbance and a combination of the two r3 r3 r1 the statistical parameters including correlation coefficient r 2 p values and f statistic for all soil types are presented in table 2 although the red waveband waveband ratios and combination of wavebands reflectance produced similar correlation coefficients the red waveband provided the best statistical parameters such as smaller p value and higher f statistic for this reason the red waveband was selected as the independent variable for developing the ssc reflectance regression models the developed regression models for all sediment types are depicted in fig 8 which shows that the spectral reflectance has a linear relationship with log transformed ssc regardless of the sediment color however the regression coefficient varies depending on the sediment color and its effect on the reflectance property the highest r 2 values calculated from the analyzed reflectance ssc relationships were found for the dark brown soil 0 98 and the lowest r 2 value was observed for the dark gray soil 0 96 reflectance ssc relationships are presented in table 3 3 3 comparison with the field observations the field data were collected from the west fork trinity wft river and village creek in texas u s in 2018 the same instrumentation and camera setup were used to capture images from the field the instrument setup in the lab and field conditions is illustrated in fig 2 and fig 3 the images from the water surface were captured at 40 from the nadir and 135 zenith angle from the light source for both laboratory and field sites sample images collected from the surface of the water at two river sites are represented in fig 9 ssc samples and images from the field were collected in june dec 2018 during this period the minimum and maximum flows in the wft river were 10 and 415 m3 s respectively the flow record at this site for the 2015 2019 period shows the mean and maximum values of 35 3 and 510 m3 s respectively during the same timeframe june dec 2018 the minimum and maximum flows in village creek were 0 05 to 28 m3 s the historical data 2014 2019 at this site shows the mean and maximum flows of 1 06 and 453 m3 s the sediment concentrations in the wft river and village creek varied from 15 to 475 mg l and 7 to 387 mg l respectively during the sampling period for each of the river sites the reflectance values for red waveband are compared with the reflectance values collected from laboratory experiments fig 10 a and 10b this comparison showed that the wft river reflectance values were more consistent with the dark gray soil reflectance values and the village creek water reflectance showed better agreement with the light gray soil reflectance values the performance of the developed ssc reflectance models for all sediment colors was assessed by plotting the field ssc data from two river sites and the lab data shown in fig 11 the in situ ssc and red waveband reflectance r3 of the images collected from the wft river were plotted with the ssc reflectance model developed dark gray soil fig 11a because of their similar reflectance values the village creek water sample reflectance values were however comparable to the water mixture prepared in the lab using the light gray soil fig 11b predictions from the model for the light gray soil from village creek produced an r 2 value of 0 98 while the model for the wft river from the dark gray soil produced an r 2 value of 0 55 the particle size distributions of the water sample from the wft river and village creek are plotted in fig 12 along with those for the dark gray and light gray soil respectively from fig 12a it is evident that the dark gray sediment size is different from the particle size in the wft river water sample the percentage of clay and silt in the wft river is much higher than the dark gray soil sample fig 12a it can be observed that even though these two samples have similar reflectance values their particle size distribution is different which could considerably impair the color based ssc reflectance model this difference in sediment sizes could explain why the ssc reflectance model derived from dark gray soil exhibited poor performance in predicting the ssc for the wft river the correlation between measured and predicted ssc for the wft river is relatively low r 2 0 55 on the contrary the village creek particle size is similar to the light gray sediment size fig 12b therefore the ssc reflectance model developed for light gray soil predicts the ssc for village creek with more accurately and with a higher correlation between measured and estimated ssc values r 2 0 98 the observed versus predicted ssc values for both streams are shown in fig 13 and a summary of the number of data points the correlation coefficient r 2 value root mean square error rmse and mean absolute error mae for each site are provided in table 4 the model for the dark gray soil produced an rmse value of 105 mg l and mae of 88 mg l for the wft river the model for the light gray soil produced an rmse of 22 mg l and mae of 18 mg l the coefficients of determination rmse and mae for these two sites were consistent with the values of the previously developed reflectance ssc models fraser 1998 smith et al 2009 song 2011 4 conclusion remote sensing has been established as the most effective way to monitor and assess water quality in coastal environments however spatial and temporal limitations of the current satellite sensors impede the application of satellite remote sensing to riverine environments consumer grade digital camera sensors may provide improved spatial and temporal resolutions required to monitor water quality parameters in rivers and streams but this approach has not been fully explored this study aimed at investigating relationships between ssc and spectral reflectance of turbid water by utilizing digital cameras and identifying the effect of sediment color on the relationships images captured by digital cameras in this study had finer spatial resolution 0 35 mm px than satellite images which is required for estimating ssc in riverine settings digital images provided spectral reflectance values in three visible wavebands namely red green and blue it was found that spectral reflectance of visible wavebands and ssc were positively correlated in addition red waveband reflectance was found to be more sensitive to ssc variations than that of blue and green wavebands reflectance the laboratory results showed that sediment color played a significant role in estimating ssc from spectral reflectance values spectral reflectance varied significantly with sediment color in experiments with medium to high ssc values for water samples with the same particle size distribution visible waveband reflectance indicated that lighter color sediments reflected more energy than the darker color sediments in all experiments with four different sediment colors as the ssc increased reflectance values for highly turbid water tend to be saturated reaching a plateau log linear relationships between ssc and reflectance were developed to be utilized in estimating ssc from regressed models based on the coefficient of determination and other statistical parameters it was concluded that the regression models developed based on the red waveband reflectance performed better in estimating ssc for all sediment colors the performance of the regression models was assessed in village creek and the wft river the spectral reflectance of the images taken from the wft river and village creek were consistent with the dark gray and the light gray sediments reflectance values respectively however the ssc reflectance model performed better for village creek than for the wft river further investigation showed that the village creek water samples had the same sediment size as the light gray soil sample but water samples from the wft river and dark gray soil sample were different in sediment size the effect of grain size distribution in this river evidently affected the performance of the ssc reflectance model the finding of this study provides valuable information while developing a regional or global algorithm for estimating ssc from digital imagery in this study only the effect of sediment color on ssc reflectance properties was investigated more studies are needed to demonstrate and quantify the effect of sediment size form and type of minerals that may affect the estimation of sediment concentration from digital imagery credit authorship contribution statement shah md imran kabir conceptualization visualization methodology resources data curation formal analysis investigation software writing original draft habib ahmari conceptualization resources visualization supervision validation writing review editing project administration declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments this research did not receive any specific grant from funding agencies in the public commercial or not for profit sectors 
5257,the purpose of the work was to analyse the possibility of using the conceptual eba4sub rainfall runoff model to determine the design peak flows with a specified probability of exceeding in the catchments of the upper vistula river basin the basis for the study were observed series of maximum annual flows and daily rainfall for the years 1981 2014 an innovative aspect of the study was the use of a two stage modelling process we determined the flow hydrographs with the eba4sub model for various rainfall events in the first stage and then we calculated the flow quantiles based on the modeled peak flows using selected density function of probability distributions based on the calculations it was found that the eba4sub model represents an alternative to more consolidated methods for calculating flood flows in ungauged catchments indeed the model gives relatively similar values to the observed flows with percentage differences usually limited and in average for all the investigated case studies in the range 15 25 keywords eba4sub rainfall runoff model annual maximum flood t year return period 1 introduction flood protection in the european union is regulated by the provisions of the floods directive which imposes to member states to draw up flood risk maps młyński et al 2018a ozga zielinski et al 2018 from a practical point of view flood risk maps are derived routing on the topography a design flow with a specified probability of exceeding qt and determining the resulting flow depths and flow velocities obviously inherent uncertainties are present in multiple aspects of the modeling approaches involving the model structure model parameters boundary conditions or input data and such uncertainties may be surprisingly large even in small basins nardi et al 2018b usually three main issues characterize the current modeling procedure for flood mapping 1 availability of detailed topographic information dem annis et al 2019 2 impact of the hydrologic modeling de paola et al 2018 3 impact of the hydraulic model peña and nardi 2018 in the last years the attention on the flood phenomenon both at large both at small scale and on the related impacts on human activites is increasing in order to guarantee sustainable ecosystem development ignacio et al 2015 convertino et al 2019 in the present manuscript we focus on hydrological practice and in particular on the estimation of qt that can be calculated using direct statistical methods when dealing with gauged catchments although direct estimations carry many issues related for instance to the lack of high discharge records or to the validity of the stage discharge relationship that is questionable if not subject to periodical maintenance they are preferred from a theoretic point of view because they are based on occurred events that represent the truth in such circumstances qt are usually calculated in relation to the series of observed maximum annual flows qmax based on the probability distributions of the random variable among the commonly used probability distribution functions we can find pearson type iii weibull log normal generalized extreme values gev and gumbel ozga zielinska et al 2005 kochanek et al 2014 chen and singh 2017 it should be emphasized that runoff observations covering an appropriate series of qmax values are not always available for many catchments ungauged catchments making statistical methods impossible to apply in such circumstances alternative methods may be used such as the rainfall runoff models młyński et al 2019a among the numerous rainfall runoff models that can be used conceptual models based on the nash cascade of linear reservoirs double reservoir cascade the wackermann model or synthetic unit hydrographs uh snyder scs uh clark uh and others karabová et al 2012 wałęga 2016 are commonly used many rainfall runoff models use the soil conservation service curve number cn method to determine the excess rainfall however this approach has some disadvantages the amount of excess rainfall is basically determined by the cn parameter reflecting the catchment characteristics soil type land use and antecedent moisture condition one limitation of the method is the adoption of three levels of soil moisture which leads to rapid changes in the value of the cn parameter in addition the original cn parameter values that were originally developed for small agricultural catchments are usually used wałęga et al 2017a many experiences on rainfall runoff models showed some problems mainly related to the following issues lack of recommended design hyetographs high sensitivity of synthetic uh to distribution of rainfall gauge stations and mistakes in rainfall datasets wałęga and książek 2016 over or underestimation of direct runoff from the scs cn method wałęga et al 2017b uncertainty in scs uh input parameters mainly on cn blair et al 2012 therefore solutions are sought that would provide detailed information on the pattern of rainfall and infiltration processes and that would enable a more accurate estimation of excess rainfall grimaldi et al 2013a indeed recent contributions highlight the issues of uncertainties linked to different components of hydrologic modelling e g annis et al 2020 one possible method is the event based approach for small and ungauged basins eba4sub model piscopia et al 2015 this model has been fully adapted to determine the design hydrograph in ungauged catchments it is based on geographic information systems and it optimizes the topographic information present in the digital elevation model dem using the same input data that are necessary to apply the commonly used rational formula considering what aforementioned the aim of this study was to analyse the possibility of using the eba4sub model to estimate flood flows in mountain catchments the novelty in the conducted study is the proposed procedure for calculating qt in ungauged catchments the proposed method is a hybrid solution based on the use of the eba4sub model to reconstruct the flood for a given rainfall and the use of statistical distributions to determine qt the analyses carried out could allow the formulation of guidelines related to the calculation of annual maximum flows with a specified probability of exceeding in ungauged mountain catchments 2 study area characteristics the study was carried out for three mountains catchments in the upper vistula basin poland skawica ochotnica and kamienica nawojowska the location of the studied catchments and the land use is shown in fig 1 while fig 2 presents the slope map for studied catchments table 1 summarizes the values of main physiographic and meteorological characteristics of the studied catchments the choice of such catchments for the analysis was determined by their mountainous nature which determines floods caused by heavy rainfall by the presence of water gauge cross sections allowing obtaining measurement data for model verification and by the lack of significant anthropogenic impacts affecting the hydrological regime such as retention reservoirs 3 methods the basis for achieving the purpose of this work was the qmax observed series for the analysed river basins and the observed series of daily rainfall recorded at raingauge stations located in proximity of the studied catchments the observed series of hydro meteorological data covered the period 1981 2014 daily rainfall data in the selected basins were retrieved and averaged with the inverse distance method chen and liu 2012 based on the hydrometric data the corresponding daily rainfall causing floods were determined the study was divided into two stages the elaborations with the eba4sub model and the statistical analyses the calculations were conducted in the following steps i eba4sub analysis determination of concentration time determination of rainfall hyetographs determination of runoff hydrographs and their related peak discharge with the eba4sub model evaluation of the performance metrics of model work determination of the pattern of the empirical maximum flow distribution curves ii statistical analysis selecting theoretical probability distributions for observed and modeled annual maxima flows verification of the most credible annual maximum flow distributions for observed and modeled values 3 1 determining concentration time the concentration time for the studied catchments was estimated using the giandotti formula 1 tc 4 a 1 5 l 0 8 h where tc concentration time h a catchment area km2 l main watercourse length km h difference between the average elevation of the basin and the outlet elevation m 3 2 determination of rainfall hyetographs daily rainfall episodes determining the largest flows in each year of the analysed time series were selected and the corresponding depths for a rainfall duration equal to the assumed concentration time were calculated reducing the observed values that were characterized by a rainfall duration equal to 24 h in doing so we follow the common assumption that a rainfall duration equal to the catchment concentration time causes the maximum peak runoff at the outlet compared to shorter or longer rainfall durations nothwithstanding we recognize that such hypothesis is debated in literature indeed in many practical applications rainfall durations 2 3 times larger than concentration time are used in order to maximize the peak discharge sikorska et al 2017 lambor reduction coefficients were used to reduce the rainfall height of 24 h duration time to the rainfall height for a duration equal the concentration time 2 ψ t 0 127 t 0 67 for t from 5 to 120 min 3 ψ t 0 243 t 0 67 for t from 120 to 1440 min 4 p t c p 24 h ψ t t c where ψ t rainfall reduction factor t rainfall duration min p t c rainfall height for duration equal the concentration time mm p24 h the rainfall height of 24 h duration time after determining each year the amount of rainfall for a given concentration time the hyetograph was determined assuming the dvwk distribution wałęga et al 2012 3 3 determination of peak flow with the eba4sub model the excess rainfall pattern in eba4sub model was then calculated based on the curve number for green ampt cn4ga procedure proposed by grimaldi et al 2013a cn4ga consists in two steps the first is the estimation of the culative value for the excess rainfall using the scs cn formula 5 pe p 0 2 s 2 p 0 8 s w h e n p 0 2 s 0 w h e n p 0 2 s where pe cumulative excess rainfall mm p cumulative gross rainfall mm s maximum potential retention of the catchment area mm the second step determines the distribution of the excess rainfall using the green ampt equation 6 q 0 t i t f o r t t p k s 1 δ θ δ h i t f o r t t p where q0 infiltration rate mm h tp ponding time h ks saturated hydraulic conductivity mm h i cumulative infiltration mm δθ change in soil water content between the initial value and the field saturated soil water content δh difference between the pressure head at the soil surface and the matric pressure head at the moving wetting front mm the eq 6 is implemented by assuming that ponding time is reached when the cumulative rainfall since the start of the event equals the value of 0 2 s calibration of parameters in eq 6 is done automatically by matching the cumulative excess rainfall determined with the eqs 6 and 5 in practice cn4ga requires the assessment of only the cn parameter this parameter was determined according to the guidelines given in walega and salata 2019 the runoff hydrograph is finally determined using the dem and the width function based instantaneous unit hydrograph wfiuh concept according to grimaldi et al 2010 wfiuh is a kinematic based model that estimates the probability distribution function of the so called flow time ft i e the distribution of the time required for rainfall drops not infiltrated or intercepted to reach the basin outlet ft is expressed calculating for any dem cell the surface flow velocity both in river network cells both in hillslope cells according the following 7 ft x i 1 x l c i v c i l h i v h i where lc lh channel and hillslope length for the generic dem cell i vc vh surface runoff velocity for channel and hillslope dem cell the parameters lc and lh are determined on the basis of the flow direction the values of vc and vh represent the parameters affecting the wfiuh shape first the threshold area criterion is employed here a threshold value of 1 km2 for contributing area has been assumed to extract the drainage network then vh values are estimated cell by cell in a distributed manner using an empirical formula related to the slope and soil use grimaldi et al 2010 consequently the only parameter to be assigned is vc which is automatically calibrated by the model assuring that the centre of the wfiuh mass is equal to the basin lag time that is estimated as the 60 of the concentration time tc after defining the wfiuh the runoff hydrograph q t is obtained using the convolution integral 8 q t a 0 t w f i u h t τ p n τ d τ where a catchment area km2 t rainfall duration h pn t excess rainfall determined by the cn4ga method mm it is noteworthy that eba4sub results are sensitive to tc that affects both the rainfall duration both the shape of wfiuh grimaldi et al 2012a vojtek et al 2019 however two aspects should be considered first a change in tc value when using a design hyetograph characterized by a rainfall peak in the central part of the distribution like in case of chicago or dvwk approaches does not affect the main rainfall peak but it affects only the small lateral parts of the rainfall hyetograph that are commonly lost by infiltration in case of dvwk distribution the main part of rainfall occurs in the middle of the event and in consequence lesser loss of rainfall and higher peak discharges in comparison to other type of hyetograph are observed wachulec et al 2016 second the centroid of wfiuh is calibrated on the lag time the hypothesis is that by adopting the centroid as a term of reference and not the wfiuh basetime that is linked to tc the variability of the results with respect to tc would be reduced a final consideration is related to the choice of the giandotti formula for estimating tc indeed in poland the most used approaches for calculating tc are kirpich and kerby formula and recently by nrcs method according to tr 55 release wachulec et al 2016 such approaches have been tested and the results are similar to the value obtained with the giandotti formula that is implemented by default inside eba4sub hence we decided to maintain such approach also mainly in urban catchments the time of concentration is interpreted as critical storm duration wałęga et al 2019 3 4 evaluation of the performance metrics of model work the performances of the eba4sub model were evaluated using the following measures correlation coefficient r mean absolute percentage error mape and peak weight root mean square error pwrmse they are described by the following relationships młyński et al 2019b 9 r i 1 n q o max q m o â q s max q m s i 1 n q o max q m o 2 â i 1 n q s max q m s 2 10 mape 100 n â t 1 n q o max q s max q o max 11 pwrmse t 1 n q o max q s max 2 â q o max q m 2 q m n m 3 â s 1 where n number of observed and simulated annual maximum flows i index varying from 1 to n qm o mean of the observed annual maximum flow m3 s 1 qm s mean of the simulated annual maximum flow m3 s 1 qs max simulated annual maxima flow m3 s 1 qo max observed annual maxima flow m3 s 1 3 5 determination of the pattern of the empirical maximum flow distribution curves in order to determine the pattern of the curves of the empirical distribution of maximum flows the series of observed and modeled values were ordered in a distribution sequence and then the frequency was determined for each quantity using the formula kamal et al 2017 12 t n 1 m where n series size m position of the given value in the distribution series the obtained coordinates ti qmax i for the distribution sequences were plotted on a scale on a semi logarithmic scale obtaining a curve of the empirical distribution of the studied variables 3 6 mathematical models of the properties of random variables qobs and qmod on the basis of authors experience and taking into account physical properties of random variable that is maximum flow in this case it was assumed that the following asymmetrical left side bounded probability distributions might be applied to theoretical models of maximum annual flows i gamma ga ii weibull we iii log gamma lga iv log normal ln v gumbel g the first four distributions can be described by 3 parameters i e α where α 0 λ where λ 0 or μ where μ 0 and ε where ε x respectively representing the scale parameter shape and location of the so called lower left side bound of probability distribution where is a observed implementation of random variable x gupta and kundu 2001 bailey et al 2007 hogg and craig 1978 however in the gumbel distribution g willemse and kaas 2007 there are only two parameters α for scale and μ for shape 3 7 the method of selecting theoretical probability distributions for qobs and qmod variables the estimation of the parameters of the density function of probability distributions was done using the maximum likelihood method using specialized software ciupak et al 2012 in accordance with the following procedure ozga zielinska et al 2005 1 estimation of parameters of 4 types of functions belonging to the family of probability distributions ga we lga and ln for a specific value and the range of variation of the lower bound of the probability distribution εi for the ith function belonging to the family of the selected probability distribution in the ga distribution the parameters are estimated for a single function no lower limit of the ε distribution 2 obtaining i sets of estimated parameter values for each selected function of probability distributions as a result of solving systems of equations according to explicit formulas or determining a set of parameter values using numerical methods of brent or newton 3 testing the hypothesis about the compatibility of the theoretical probability distribution function with the empirical distribution of the x variable by using the χ 2 pearson goodness of fit test neyman 1949 at the significance level α 0 05 4 creating a set of non contradictory probability distribution functions from all probability distribution functions for which the hypothesis of compliance was not rejected sets of non contradictory functions are created separately for each selected type of probability distribution function i e ga we lga and ln 5 selection of the best fitted functions within individual distribution types the criterion was used to select the best fitted function in the form of a minimum distance from kolmogorov pratt and gibbons 2012 i e min d max the probability distribution function for which the kolmogorov distance d max reaches the minimum value within a particular distribution type is called the best fitted function in the sense of the kolmogorov distance criterion such individual functions determined for each type of used distributions form a set of best fitted functions 6 the selection of the most credible probability distribution function from a set of best fitted functions of different types ie ga we lga ln and g is done by calculating for each function of a given type the value of the information criterion akaike aic akaike 1974 3 8 verification of the most credible annual maximum flow distributions for q obs and for q mod to verify the distribution of the most credible maximum annual flows for observed data q obs and for the modeled data q mod nonparametric compliance tests were used to test the goodness of matching the most credible theoretical mathematical model with the empirical model the verification of the distribution was focused on their tail part accordingly 1 dimensional statistical tests namely kolmogorov smirnov dk s genest et al 2009 anderson darling da d anderson and darling 1954 liao shimokawa dl s liao and shimokawa 1999 and kuiper dk koziol 2008 the last verification procedure was a comparison of the estimated quantile error resulting from the randomness of the sample of the maximum annual observed q obs and modeled q mod 4 results and discussion 4 1 analyses using the eba4sub model fig 3 presents the values of rainfall episodes for given tc together with the excess rainfall the results of calculation allow for the statement that concentration times for the studied catchments differ by one hour tc is equal 6 h 7 h and 8 h for skawica ochotnica nad kamienica nawojowska river respectively which results from their physiographic characteristics one essential problem that arises using rainfall runoff models is the assessment of time of concentration grimaldi et al 2012b often there is the risk to accept too short values for tc without considering the actual conditions of runoff hydrograph shape consequently leading to overestimation of the maximum flows ockert et al 2014 on the other hand the cn parameter values determined for the third moisture level are similar the studied catchments adopted for analysis are natural with similar land use and similar soil properties hence similar parameters of cn parameters were determined in turn the assumption of the third level of moisture is due not only to atmospheric rainfall but also to the high level of the groundwater table and the occurrence of poorly permeable soils hindering infiltration these factors lead to a decrease in the infiltration capacity of the catchment this is especially visible in mountain areas wałęga and rutkowska 2015 based on the results compiled in fig 3 it may be stated that for the skawica river in the studied period the average excess rainfall was 18 of the total rainfall in the case of the ochotnica catchment it was 15 for kamienica nawojowska it was 25 studies related to the possibility of using the cn4ga procedure to estimate excess rainfall in small mountain catchments were also carried out by grimaldi et al 2013b the authors concluded that the commonly used scs cn method tends to underestimate excess rainfall at the beginning of a rainfall episode and to overestimate its magnitude in the final part of the rainfall this is due to the assumption of a constant amount of initial rainfall losses the cn4ga method takes into account the variable infiltration properties of the soil during rainfall making the estimated excess rainfall closer to the actual one as respect to the scs cn method based on specific excess rainfall values the corresponding peak flows were calculated using the eba4sub model the results of the calculations are presented in fig 4 table 2 presents the values of the model s performance indicators based on the values summarized in fig 4 and table 2 it was found that the best results using the eba4sub model were obtained for the kamienica nawojowska catchment fig 4c the smallest difference in peak flows was obtained in this catchment for 1983 observed and modeled flow were identical and the largest in 2009 difference of 39 in turn the mape value indicated a 15 average error in the estimation of the maximum flow in this catchment over the entire period of many years the weakest results were obtained for the ochotnica catchment fig 4b the smallest difference between the observed and simulated peak flows was found for 1981 difference smaller than 3 and the largest for 2014 the modeled value was almost 4 times higher than the observed one however mape indicated 78 of the average error in estimating the peak flows for the analysed catchment in the years 1981 2014 such disproportions may be caused by the quality of rainfall information that is one input of eba4sub in the case of the ochotnica catchment due to availability data from only one station was adopted for the calculations which were averaged using rainfall reduction curves the used rainfall data may not fully reflect the meteorological conditions prevailing in the entire basin in the skawica drainage basin fig 4a the smallest difference between simulated and observed peak flow occurred in 1989 identical values between variables and the largest in 1982 98 difference however the average error the mape coefficient in the calculation of the peak flow with the eba4sub model in the studied period is 24 analysing the values of the correlation coefficient determined for modeled and observed peak flows in the studied catchments it was found that according to the classification of schober et al 2018 for the ochotnica river it remained at the level of the average relationship between variables for skawica and kamienica nawojowska this ratio reached a level of very strong dependence in addition the correlation coefficient for each of the catchments turned out to be statistically significant for the significance level α 5 on the basis of the data obtained the course of the empirical distribution of maximum annual flows observed and determined with the eba4sub model was determined the results are summarized in fig 5 based on the results compiled in fig 5 it was found that for the skawica river fig 5a the maximum observed flows characterized by a high return period are higher as respect to variables determined by the eba4sub model an opposite situation can be seen for ochotnica fig 5b and kamienica nawojowska fig 5c in these cases the values of peak flows with a high return period determined by the eba4sub model are higher than the observed values in turn for low return periods eba4sub model yealds lower peak flow values as respect to observed values similar results were obtained by młyński et al 2018b nardi et al 2018a and petroselli and grimaldi 2018 such behavior may be caused by the shape of the theoretical adopted hyetograph for calculations and the assumed initial losses in the scs cn approach it decreases the amount of excess rainfall especially for low rainfall episodes causing flows characterized by low return periods petroselli et al 2018 4 2 statistical analysis the most credible distribution from the set of five a priori accepted probability distributions ie ga we lga ln and g was selected for the random variable under study assuming the minimum of the criterion value akaike aic akaike 1974 calculations were made for 3 parameter α λ or μ ε probability distributions ga we lga and ln and for 2 parameter α μ of the g distribution the results obtained at each stage of the procedure are presented in table 3 the ga distribution for q o b s s k a q o b s o c h q m o d o c h and q m o d k a m and the we distribution for q m o d s k a and q o b s k a m figs 6 8 compare the graphs of the most credible functions of the probability of exceeding the maximum annual flows for the observation sequence blue solid line and for the peak flow series obtained with the eba4sub model yellow solid line and the upper limits of the confidence interval blue and yellow dashed line respectively in the catchments of skawica ochotnica and kamienica nawojowska in the skawica catchment fig 6 the values of quantiles determined on the basis of the maximum annual flows obtained with the eba4sub q m o d s k a model yellow solid and dashed line are clearly lower compared to the values of the corresponding quantiles obtained on the basis of the maximum observed flows q o b s s k a blue solid and dashed line the differences in values clearly increase in the region of the upper tails of both theoretical distributions quantile values in the ochotnica basin fig 7 obtained on the basis of maximum annual flows obtained with the eba4sub model q m o d o c h are definitely higher yellow solid and dashed lines than values of quantiles obtained on the basis of observed flows q o b s o c h continuous blue and dashed line the differences between individual quantile values are particularly visible in the region of the upper tails of probability distributions in the case of the ochotnica catchment the eba4sub model definitely overstates the maximum annual flows the most similar results were obtained in the catchment area of kamienica nawojowska fig 8 practically in the whole range of variations of maximum annual flows the obtained theoretical probability distributions of both variables ie q o b s k a m blue solid and dashed line and q m o d k a m yellow solid and dashed line coincide and the values of the quantum maximum annual flows are similar the verification of the most credible annual maximum flow distributions obtained according to procedure presented in paragraph 3 8 adopted in ungauged catchments was carried out using non parametric compliance tests da d dk s dl s and dk the level of significance α 0 05 was arbitrarily adopted for inference this is due to the fact that the value of the level of significance of the test is closely related to the number length of the random sample on the basis of which theoretical distribution parameters are estimated the longer the sample the lower the significance level can be in the case of ungauged catchments of skawica ochotnica and kamienica nawojowska the number of lines was n 35 elements this number allows for adopting a significance level not less than α 0 05 the obtained statistical test results and critical values calculated by the bootstrap method amal 2006 are presented in table 3 the most credible theoretical probability distributions table 4 of the maximum annual flows determined for the observed data obs and the eba4sub mod model were verified i e ga for q o b s s k a we for q m o d s k a ga for q o b s o c h ga for q m o d o c h we for q o b s k a m and ga for q m o d k a m all tested tests did not reject the null hypothesis regarding the compatibility of theoretical and empirical distribution matching for the analysed variables q o b s s k a q m o d s k a q o b s o c h q m o d o c h q o b s k a m and q m o d k a m particular attention was paid to the results of the da d and dk s tests the smallest of the maximum distances between the theoretical and empirical cumulative distribution values especially in the tail part the da d test were significantly below the critical value of both tests determined at the significance level α 0 05 this means that the adopted most credible distributions are well matched in the tail part to a random sample of maximum annual flows for both observational data obs and the eba4sub model mod the last element of verification of the maximum annual flow distributions was a comparison of the estimated quantile error resulting from the randomness of the sample of the maximum observed annual flow q obs and modeled with eba4sub q mod fig 9 the smallest differences in error in quantile values in the entire range of variability of maximum annual flows were observed in the skawica catchment fig 9a the largest differences in errors of the values of low quantiles i e the values of maximum annual flows exceeded with a high probability e g 99 0 and 99 9 percent were observed in the ochotnica catchment fig 9b the highest differences in errors of high quantile values i e the maximum flow values exceeded with a low probability e g 0 01 and 0 001 percent were recorded in the kamienica nawojowska catchment fig 9c when determining the maximum annual flows with a given probability of being exceeded using rainfall runoff models it is usually assumed that the probability of rainfall is the same of the flood caused by the rainfall as pilgrim and cordery 1975 showed this assumption is a simplification the actual relationship between rainfall and flow probability is unclear because each rainfall characteristic introduces some changes in the assumed probability therefore it is also necessary to take into account other characteristics describing the rainfall duration pattern intensity research carried out by viglione and blöschl 2008 showed that equal rainfall and flow probability can be assumed provided that the rainfall episodes causing the flood were of the same duration however the floods are usually less likely to occur than rainfalls the research carried out in this work allows to state that the proposed methodology can eliminate the problem related to determining the probability of rainfall and flood the analysis is not based on rainfall with a specified probability of exceeding but on actual episodes causing observed floods commonly known hydrological models needs calibrations of parameters calibration is a critical component of model development because parameters generally cannot be determined directly from measurements but are instead inferred indirectly by calibrating the hydrological model to observed hydrological responses wright et al 2019 the eba4sub model can alternatively be used to calculate annual maximum flows with a specified probability of overflow in ungauged catchments the main advantage of the model is the simplicity of its use which consists of three modules determining the rainfall determining the excess rainfall and determining the flow hydrograph petroselli and grimaldi 2018 the simplicity of using the model in hydrological analyses means that it can be successfully used by practitioners to determine the size of credible peak flows for estimating flood hazard zones or for designing hydrotechnical constructions designers using rainfall runoff models should carefully determine the parameters of the models as they play an important role in the peak flow estimation changes in the values of input parameters may affect the determination of peak flows in eba4sub the model parameters are determined directly on the basis of physiographic characteristics of the catchment which reduces the subjectivity of their determination however it should be emphasized that further research should be carried out regarding the possibility of its use in ungauged catchments such studies should primarily focus on determining the shape of the design hyetograph for the catchment a research conducted by młyński et al 2018c has shown that even small changes in the shape of the rainfall hyetograph can cause differences in maximum flows calculated using the model of greater than 10 generally it can be stated that the proposed approach uses extensive information on rainfall and enables the determination of rainfall losses and the dynamics of runoff formation taking into account the spatial variability of the catchment which is implemented by using dem and equations for surface flow estimation thus the proposed solution has clear advantages over commonly used simplified methods for estimating maximum flows of course the proposed solution has also limitations associated primarily with the need to carefully select rainfall episodes for further analysis in this case it is more advantageous if rainfall with time resolution shorter than 1 day is available for instance hourly this can be a significant problem for many catchments 5 discussion and conclusions the purpose of the study was to analyse the possibility of using the eba4sub model to determine the value of maximum annual flows with a specified probability of exceeding in selected catchments of the upper vistula river basin considering the results obtained the eba4sub model was considered suitable for calculating the maximum annual flows with a specified probability of exceeding the model is characterized by a set of common modules of the rainfall runoff transformation and adapts them to the practical cases where it is not possible to calibrate the input parameters one main adavantage of the model particularly useful in the ungauged basin perspective is to propose a framework that provides similar results when it is applied by two analysts at different times for the same watershed and input data hence minimizing the subjectivity of the modeller this model gives relatively similar values to the observed flows therefore it may be recommended as one of the possible alternatives to the use of empirical formulas or other simple approaches to determine the maximum annual flows with a specified probability of exceeding it should be emphasized however that the decisive aspect about the accuracy of the obtained results is the quality of rainfall data which is the input of the model therefore it is recommended that the model be used in catchments with full information on rainfall in addition the analyses showed that the gamma and weibull statistical distributions allow obtaining the smallest errors in estimating the maximum flow quantiles based on the analyses carried out the validity of the assumptions regarding the new proposal for the calculation of maximum flows was positively verified namely much smaller quantile errors were obtained when the maximum flows series from the eba4sub model was used compared to the observed data series the proposed methodology has the following advantages simplicity due to the use of eba4sub the values of input parameters can be determined automatically on the basis of physiographic characteristics of the catchment which reduces the subjectivity of their determination plus elimination of the problem related to the determination of the probability of rainfall and flood therefore this methodology can be used in calculating the maximum annual flow quantiles in ungauged mountainous catchments because it allows for considering complete information on rainfall and takes into account in a simplified way the complex dynamics occurring on the catchment like infiltration and flow routing regarding future research the following investigations are already in progress a the use of synthetic rainfall timeseries circumstance that could reduce the uncertainties due to the limited time span and low resolution of observed rainfall data b an integrated approach of eba4sub with a selection of hydraulic models in order to fully investigate the flood mapping issue c a generalization of eba4sub framework in order to improve the hydrological modeling e g the implementation of specific modules able to describe subsurface flow and baseflow processes d a test of the proposed approach in a large number of catchments also with medium and low slopes and for rainfall with variable characteristics credit authorship contribution statement dariusz młyński methodology formal analysis investigation data curation writing original draft visualization andrzej wałęga conceptualization methodology writing original draft writing review editing project administration bogdan ozga zielinski methodology formal analysis writing original draft maurycy ciupak software formal analysis andrea petroselli software writing original draft writing review editing supervision declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments authors thank of institute of meteorology and water management national research institure for permitted to access to hydrolometeorological datas from analysed catchments the research was supported by the ministry of science and higher education of the republic of poland for the university of agriculture in 2019year 
5257,the purpose of the work was to analyse the possibility of using the conceptual eba4sub rainfall runoff model to determine the design peak flows with a specified probability of exceeding in the catchments of the upper vistula river basin the basis for the study were observed series of maximum annual flows and daily rainfall for the years 1981 2014 an innovative aspect of the study was the use of a two stage modelling process we determined the flow hydrographs with the eba4sub model for various rainfall events in the first stage and then we calculated the flow quantiles based on the modeled peak flows using selected density function of probability distributions based on the calculations it was found that the eba4sub model represents an alternative to more consolidated methods for calculating flood flows in ungauged catchments indeed the model gives relatively similar values to the observed flows with percentage differences usually limited and in average for all the investigated case studies in the range 15 25 keywords eba4sub rainfall runoff model annual maximum flood t year return period 1 introduction flood protection in the european union is regulated by the provisions of the floods directive which imposes to member states to draw up flood risk maps młyński et al 2018a ozga zielinski et al 2018 from a practical point of view flood risk maps are derived routing on the topography a design flow with a specified probability of exceeding qt and determining the resulting flow depths and flow velocities obviously inherent uncertainties are present in multiple aspects of the modeling approaches involving the model structure model parameters boundary conditions or input data and such uncertainties may be surprisingly large even in small basins nardi et al 2018b usually three main issues characterize the current modeling procedure for flood mapping 1 availability of detailed topographic information dem annis et al 2019 2 impact of the hydrologic modeling de paola et al 2018 3 impact of the hydraulic model peña and nardi 2018 in the last years the attention on the flood phenomenon both at large both at small scale and on the related impacts on human activites is increasing in order to guarantee sustainable ecosystem development ignacio et al 2015 convertino et al 2019 in the present manuscript we focus on hydrological practice and in particular on the estimation of qt that can be calculated using direct statistical methods when dealing with gauged catchments although direct estimations carry many issues related for instance to the lack of high discharge records or to the validity of the stage discharge relationship that is questionable if not subject to periodical maintenance they are preferred from a theoretic point of view because they are based on occurred events that represent the truth in such circumstances qt are usually calculated in relation to the series of observed maximum annual flows qmax based on the probability distributions of the random variable among the commonly used probability distribution functions we can find pearson type iii weibull log normal generalized extreme values gev and gumbel ozga zielinska et al 2005 kochanek et al 2014 chen and singh 2017 it should be emphasized that runoff observations covering an appropriate series of qmax values are not always available for many catchments ungauged catchments making statistical methods impossible to apply in such circumstances alternative methods may be used such as the rainfall runoff models młyński et al 2019a among the numerous rainfall runoff models that can be used conceptual models based on the nash cascade of linear reservoirs double reservoir cascade the wackermann model or synthetic unit hydrographs uh snyder scs uh clark uh and others karabová et al 2012 wałęga 2016 are commonly used many rainfall runoff models use the soil conservation service curve number cn method to determine the excess rainfall however this approach has some disadvantages the amount of excess rainfall is basically determined by the cn parameter reflecting the catchment characteristics soil type land use and antecedent moisture condition one limitation of the method is the adoption of three levels of soil moisture which leads to rapid changes in the value of the cn parameter in addition the original cn parameter values that were originally developed for small agricultural catchments are usually used wałęga et al 2017a many experiences on rainfall runoff models showed some problems mainly related to the following issues lack of recommended design hyetographs high sensitivity of synthetic uh to distribution of rainfall gauge stations and mistakes in rainfall datasets wałęga and książek 2016 over or underestimation of direct runoff from the scs cn method wałęga et al 2017b uncertainty in scs uh input parameters mainly on cn blair et al 2012 therefore solutions are sought that would provide detailed information on the pattern of rainfall and infiltration processes and that would enable a more accurate estimation of excess rainfall grimaldi et al 2013a indeed recent contributions highlight the issues of uncertainties linked to different components of hydrologic modelling e g annis et al 2020 one possible method is the event based approach for small and ungauged basins eba4sub model piscopia et al 2015 this model has been fully adapted to determine the design hydrograph in ungauged catchments it is based on geographic information systems and it optimizes the topographic information present in the digital elevation model dem using the same input data that are necessary to apply the commonly used rational formula considering what aforementioned the aim of this study was to analyse the possibility of using the eba4sub model to estimate flood flows in mountain catchments the novelty in the conducted study is the proposed procedure for calculating qt in ungauged catchments the proposed method is a hybrid solution based on the use of the eba4sub model to reconstruct the flood for a given rainfall and the use of statistical distributions to determine qt the analyses carried out could allow the formulation of guidelines related to the calculation of annual maximum flows with a specified probability of exceeding in ungauged mountain catchments 2 study area characteristics the study was carried out for three mountains catchments in the upper vistula basin poland skawica ochotnica and kamienica nawojowska the location of the studied catchments and the land use is shown in fig 1 while fig 2 presents the slope map for studied catchments table 1 summarizes the values of main physiographic and meteorological characteristics of the studied catchments the choice of such catchments for the analysis was determined by their mountainous nature which determines floods caused by heavy rainfall by the presence of water gauge cross sections allowing obtaining measurement data for model verification and by the lack of significant anthropogenic impacts affecting the hydrological regime such as retention reservoirs 3 methods the basis for achieving the purpose of this work was the qmax observed series for the analysed river basins and the observed series of daily rainfall recorded at raingauge stations located in proximity of the studied catchments the observed series of hydro meteorological data covered the period 1981 2014 daily rainfall data in the selected basins were retrieved and averaged with the inverse distance method chen and liu 2012 based on the hydrometric data the corresponding daily rainfall causing floods were determined the study was divided into two stages the elaborations with the eba4sub model and the statistical analyses the calculations were conducted in the following steps i eba4sub analysis determination of concentration time determination of rainfall hyetographs determination of runoff hydrographs and their related peak discharge with the eba4sub model evaluation of the performance metrics of model work determination of the pattern of the empirical maximum flow distribution curves ii statistical analysis selecting theoretical probability distributions for observed and modeled annual maxima flows verification of the most credible annual maximum flow distributions for observed and modeled values 3 1 determining concentration time the concentration time for the studied catchments was estimated using the giandotti formula 1 tc 4 a 1 5 l 0 8 h where tc concentration time h a catchment area km2 l main watercourse length km h difference between the average elevation of the basin and the outlet elevation m 3 2 determination of rainfall hyetographs daily rainfall episodes determining the largest flows in each year of the analysed time series were selected and the corresponding depths for a rainfall duration equal to the assumed concentration time were calculated reducing the observed values that were characterized by a rainfall duration equal to 24 h in doing so we follow the common assumption that a rainfall duration equal to the catchment concentration time causes the maximum peak runoff at the outlet compared to shorter or longer rainfall durations nothwithstanding we recognize that such hypothesis is debated in literature indeed in many practical applications rainfall durations 2 3 times larger than concentration time are used in order to maximize the peak discharge sikorska et al 2017 lambor reduction coefficients were used to reduce the rainfall height of 24 h duration time to the rainfall height for a duration equal the concentration time 2 ψ t 0 127 t 0 67 for t from 5 to 120 min 3 ψ t 0 243 t 0 67 for t from 120 to 1440 min 4 p t c p 24 h ψ t t c where ψ t rainfall reduction factor t rainfall duration min p t c rainfall height for duration equal the concentration time mm p24 h the rainfall height of 24 h duration time after determining each year the amount of rainfall for a given concentration time the hyetograph was determined assuming the dvwk distribution wałęga et al 2012 3 3 determination of peak flow with the eba4sub model the excess rainfall pattern in eba4sub model was then calculated based on the curve number for green ampt cn4ga procedure proposed by grimaldi et al 2013a cn4ga consists in two steps the first is the estimation of the culative value for the excess rainfall using the scs cn formula 5 pe p 0 2 s 2 p 0 8 s w h e n p 0 2 s 0 w h e n p 0 2 s where pe cumulative excess rainfall mm p cumulative gross rainfall mm s maximum potential retention of the catchment area mm the second step determines the distribution of the excess rainfall using the green ampt equation 6 q 0 t i t f o r t t p k s 1 δ θ δ h i t f o r t t p where q0 infiltration rate mm h tp ponding time h ks saturated hydraulic conductivity mm h i cumulative infiltration mm δθ change in soil water content between the initial value and the field saturated soil water content δh difference between the pressure head at the soil surface and the matric pressure head at the moving wetting front mm the eq 6 is implemented by assuming that ponding time is reached when the cumulative rainfall since the start of the event equals the value of 0 2 s calibration of parameters in eq 6 is done automatically by matching the cumulative excess rainfall determined with the eqs 6 and 5 in practice cn4ga requires the assessment of only the cn parameter this parameter was determined according to the guidelines given in walega and salata 2019 the runoff hydrograph is finally determined using the dem and the width function based instantaneous unit hydrograph wfiuh concept according to grimaldi et al 2010 wfiuh is a kinematic based model that estimates the probability distribution function of the so called flow time ft i e the distribution of the time required for rainfall drops not infiltrated or intercepted to reach the basin outlet ft is expressed calculating for any dem cell the surface flow velocity both in river network cells both in hillslope cells according the following 7 ft x i 1 x l c i v c i l h i v h i where lc lh channel and hillslope length for the generic dem cell i vc vh surface runoff velocity for channel and hillslope dem cell the parameters lc and lh are determined on the basis of the flow direction the values of vc and vh represent the parameters affecting the wfiuh shape first the threshold area criterion is employed here a threshold value of 1 km2 for contributing area has been assumed to extract the drainage network then vh values are estimated cell by cell in a distributed manner using an empirical formula related to the slope and soil use grimaldi et al 2010 consequently the only parameter to be assigned is vc which is automatically calibrated by the model assuring that the centre of the wfiuh mass is equal to the basin lag time that is estimated as the 60 of the concentration time tc after defining the wfiuh the runoff hydrograph q t is obtained using the convolution integral 8 q t a 0 t w f i u h t τ p n τ d τ where a catchment area km2 t rainfall duration h pn t excess rainfall determined by the cn4ga method mm it is noteworthy that eba4sub results are sensitive to tc that affects both the rainfall duration both the shape of wfiuh grimaldi et al 2012a vojtek et al 2019 however two aspects should be considered first a change in tc value when using a design hyetograph characterized by a rainfall peak in the central part of the distribution like in case of chicago or dvwk approaches does not affect the main rainfall peak but it affects only the small lateral parts of the rainfall hyetograph that are commonly lost by infiltration in case of dvwk distribution the main part of rainfall occurs in the middle of the event and in consequence lesser loss of rainfall and higher peak discharges in comparison to other type of hyetograph are observed wachulec et al 2016 second the centroid of wfiuh is calibrated on the lag time the hypothesis is that by adopting the centroid as a term of reference and not the wfiuh basetime that is linked to tc the variability of the results with respect to tc would be reduced a final consideration is related to the choice of the giandotti formula for estimating tc indeed in poland the most used approaches for calculating tc are kirpich and kerby formula and recently by nrcs method according to tr 55 release wachulec et al 2016 such approaches have been tested and the results are similar to the value obtained with the giandotti formula that is implemented by default inside eba4sub hence we decided to maintain such approach also mainly in urban catchments the time of concentration is interpreted as critical storm duration wałęga et al 2019 3 4 evaluation of the performance metrics of model work the performances of the eba4sub model were evaluated using the following measures correlation coefficient r mean absolute percentage error mape and peak weight root mean square error pwrmse they are described by the following relationships młyński et al 2019b 9 r i 1 n q o max q m o â q s max q m s i 1 n q o max q m o 2 â i 1 n q s max q m s 2 10 mape 100 n â t 1 n q o max q s max q o max 11 pwrmse t 1 n q o max q s max 2 â q o max q m 2 q m n m 3 â s 1 where n number of observed and simulated annual maximum flows i index varying from 1 to n qm o mean of the observed annual maximum flow m3 s 1 qm s mean of the simulated annual maximum flow m3 s 1 qs max simulated annual maxima flow m3 s 1 qo max observed annual maxima flow m3 s 1 3 5 determination of the pattern of the empirical maximum flow distribution curves in order to determine the pattern of the curves of the empirical distribution of maximum flows the series of observed and modeled values were ordered in a distribution sequence and then the frequency was determined for each quantity using the formula kamal et al 2017 12 t n 1 m where n series size m position of the given value in the distribution series the obtained coordinates ti qmax i for the distribution sequences were plotted on a scale on a semi logarithmic scale obtaining a curve of the empirical distribution of the studied variables 3 6 mathematical models of the properties of random variables qobs and qmod on the basis of authors experience and taking into account physical properties of random variable that is maximum flow in this case it was assumed that the following asymmetrical left side bounded probability distributions might be applied to theoretical models of maximum annual flows i gamma ga ii weibull we iii log gamma lga iv log normal ln v gumbel g the first four distributions can be described by 3 parameters i e α where α 0 λ where λ 0 or μ where μ 0 and ε where ε x respectively representing the scale parameter shape and location of the so called lower left side bound of probability distribution where is a observed implementation of random variable x gupta and kundu 2001 bailey et al 2007 hogg and craig 1978 however in the gumbel distribution g willemse and kaas 2007 there are only two parameters α for scale and μ for shape 3 7 the method of selecting theoretical probability distributions for qobs and qmod variables the estimation of the parameters of the density function of probability distributions was done using the maximum likelihood method using specialized software ciupak et al 2012 in accordance with the following procedure ozga zielinska et al 2005 1 estimation of parameters of 4 types of functions belonging to the family of probability distributions ga we lga and ln for a specific value and the range of variation of the lower bound of the probability distribution εi for the ith function belonging to the family of the selected probability distribution in the ga distribution the parameters are estimated for a single function no lower limit of the ε distribution 2 obtaining i sets of estimated parameter values for each selected function of probability distributions as a result of solving systems of equations according to explicit formulas or determining a set of parameter values using numerical methods of brent or newton 3 testing the hypothesis about the compatibility of the theoretical probability distribution function with the empirical distribution of the x variable by using the χ 2 pearson goodness of fit test neyman 1949 at the significance level α 0 05 4 creating a set of non contradictory probability distribution functions from all probability distribution functions for which the hypothesis of compliance was not rejected sets of non contradictory functions are created separately for each selected type of probability distribution function i e ga we lga and ln 5 selection of the best fitted functions within individual distribution types the criterion was used to select the best fitted function in the form of a minimum distance from kolmogorov pratt and gibbons 2012 i e min d max the probability distribution function for which the kolmogorov distance d max reaches the minimum value within a particular distribution type is called the best fitted function in the sense of the kolmogorov distance criterion such individual functions determined for each type of used distributions form a set of best fitted functions 6 the selection of the most credible probability distribution function from a set of best fitted functions of different types ie ga we lga ln and g is done by calculating for each function of a given type the value of the information criterion akaike aic akaike 1974 3 8 verification of the most credible annual maximum flow distributions for q obs and for q mod to verify the distribution of the most credible maximum annual flows for observed data q obs and for the modeled data q mod nonparametric compliance tests were used to test the goodness of matching the most credible theoretical mathematical model with the empirical model the verification of the distribution was focused on their tail part accordingly 1 dimensional statistical tests namely kolmogorov smirnov dk s genest et al 2009 anderson darling da d anderson and darling 1954 liao shimokawa dl s liao and shimokawa 1999 and kuiper dk koziol 2008 the last verification procedure was a comparison of the estimated quantile error resulting from the randomness of the sample of the maximum annual observed q obs and modeled q mod 4 results and discussion 4 1 analyses using the eba4sub model fig 3 presents the values of rainfall episodes for given tc together with the excess rainfall the results of calculation allow for the statement that concentration times for the studied catchments differ by one hour tc is equal 6 h 7 h and 8 h for skawica ochotnica nad kamienica nawojowska river respectively which results from their physiographic characteristics one essential problem that arises using rainfall runoff models is the assessment of time of concentration grimaldi et al 2012b often there is the risk to accept too short values for tc without considering the actual conditions of runoff hydrograph shape consequently leading to overestimation of the maximum flows ockert et al 2014 on the other hand the cn parameter values determined for the third moisture level are similar the studied catchments adopted for analysis are natural with similar land use and similar soil properties hence similar parameters of cn parameters were determined in turn the assumption of the third level of moisture is due not only to atmospheric rainfall but also to the high level of the groundwater table and the occurrence of poorly permeable soils hindering infiltration these factors lead to a decrease in the infiltration capacity of the catchment this is especially visible in mountain areas wałęga and rutkowska 2015 based on the results compiled in fig 3 it may be stated that for the skawica river in the studied period the average excess rainfall was 18 of the total rainfall in the case of the ochotnica catchment it was 15 for kamienica nawojowska it was 25 studies related to the possibility of using the cn4ga procedure to estimate excess rainfall in small mountain catchments were also carried out by grimaldi et al 2013b the authors concluded that the commonly used scs cn method tends to underestimate excess rainfall at the beginning of a rainfall episode and to overestimate its magnitude in the final part of the rainfall this is due to the assumption of a constant amount of initial rainfall losses the cn4ga method takes into account the variable infiltration properties of the soil during rainfall making the estimated excess rainfall closer to the actual one as respect to the scs cn method based on specific excess rainfall values the corresponding peak flows were calculated using the eba4sub model the results of the calculations are presented in fig 4 table 2 presents the values of the model s performance indicators based on the values summarized in fig 4 and table 2 it was found that the best results using the eba4sub model were obtained for the kamienica nawojowska catchment fig 4c the smallest difference in peak flows was obtained in this catchment for 1983 observed and modeled flow were identical and the largest in 2009 difference of 39 in turn the mape value indicated a 15 average error in the estimation of the maximum flow in this catchment over the entire period of many years the weakest results were obtained for the ochotnica catchment fig 4b the smallest difference between the observed and simulated peak flows was found for 1981 difference smaller than 3 and the largest for 2014 the modeled value was almost 4 times higher than the observed one however mape indicated 78 of the average error in estimating the peak flows for the analysed catchment in the years 1981 2014 such disproportions may be caused by the quality of rainfall information that is one input of eba4sub in the case of the ochotnica catchment due to availability data from only one station was adopted for the calculations which were averaged using rainfall reduction curves the used rainfall data may not fully reflect the meteorological conditions prevailing in the entire basin in the skawica drainage basin fig 4a the smallest difference between simulated and observed peak flow occurred in 1989 identical values between variables and the largest in 1982 98 difference however the average error the mape coefficient in the calculation of the peak flow with the eba4sub model in the studied period is 24 analysing the values of the correlation coefficient determined for modeled and observed peak flows in the studied catchments it was found that according to the classification of schober et al 2018 for the ochotnica river it remained at the level of the average relationship between variables for skawica and kamienica nawojowska this ratio reached a level of very strong dependence in addition the correlation coefficient for each of the catchments turned out to be statistically significant for the significance level α 5 on the basis of the data obtained the course of the empirical distribution of maximum annual flows observed and determined with the eba4sub model was determined the results are summarized in fig 5 based on the results compiled in fig 5 it was found that for the skawica river fig 5a the maximum observed flows characterized by a high return period are higher as respect to variables determined by the eba4sub model an opposite situation can be seen for ochotnica fig 5b and kamienica nawojowska fig 5c in these cases the values of peak flows with a high return period determined by the eba4sub model are higher than the observed values in turn for low return periods eba4sub model yealds lower peak flow values as respect to observed values similar results were obtained by młyński et al 2018b nardi et al 2018a and petroselli and grimaldi 2018 such behavior may be caused by the shape of the theoretical adopted hyetograph for calculations and the assumed initial losses in the scs cn approach it decreases the amount of excess rainfall especially for low rainfall episodes causing flows characterized by low return periods petroselli et al 2018 4 2 statistical analysis the most credible distribution from the set of five a priori accepted probability distributions ie ga we lga ln and g was selected for the random variable under study assuming the minimum of the criterion value akaike aic akaike 1974 calculations were made for 3 parameter α λ or μ ε probability distributions ga we lga and ln and for 2 parameter α μ of the g distribution the results obtained at each stage of the procedure are presented in table 3 the ga distribution for q o b s s k a q o b s o c h q m o d o c h and q m o d k a m and the we distribution for q m o d s k a and q o b s k a m figs 6 8 compare the graphs of the most credible functions of the probability of exceeding the maximum annual flows for the observation sequence blue solid line and for the peak flow series obtained with the eba4sub model yellow solid line and the upper limits of the confidence interval blue and yellow dashed line respectively in the catchments of skawica ochotnica and kamienica nawojowska in the skawica catchment fig 6 the values of quantiles determined on the basis of the maximum annual flows obtained with the eba4sub q m o d s k a model yellow solid and dashed line are clearly lower compared to the values of the corresponding quantiles obtained on the basis of the maximum observed flows q o b s s k a blue solid and dashed line the differences in values clearly increase in the region of the upper tails of both theoretical distributions quantile values in the ochotnica basin fig 7 obtained on the basis of maximum annual flows obtained with the eba4sub model q m o d o c h are definitely higher yellow solid and dashed lines than values of quantiles obtained on the basis of observed flows q o b s o c h continuous blue and dashed line the differences between individual quantile values are particularly visible in the region of the upper tails of probability distributions in the case of the ochotnica catchment the eba4sub model definitely overstates the maximum annual flows the most similar results were obtained in the catchment area of kamienica nawojowska fig 8 practically in the whole range of variations of maximum annual flows the obtained theoretical probability distributions of both variables ie q o b s k a m blue solid and dashed line and q m o d k a m yellow solid and dashed line coincide and the values of the quantum maximum annual flows are similar the verification of the most credible annual maximum flow distributions obtained according to procedure presented in paragraph 3 8 adopted in ungauged catchments was carried out using non parametric compliance tests da d dk s dl s and dk the level of significance α 0 05 was arbitrarily adopted for inference this is due to the fact that the value of the level of significance of the test is closely related to the number length of the random sample on the basis of which theoretical distribution parameters are estimated the longer the sample the lower the significance level can be in the case of ungauged catchments of skawica ochotnica and kamienica nawojowska the number of lines was n 35 elements this number allows for adopting a significance level not less than α 0 05 the obtained statistical test results and critical values calculated by the bootstrap method amal 2006 are presented in table 3 the most credible theoretical probability distributions table 4 of the maximum annual flows determined for the observed data obs and the eba4sub mod model were verified i e ga for q o b s s k a we for q m o d s k a ga for q o b s o c h ga for q m o d o c h we for q o b s k a m and ga for q m o d k a m all tested tests did not reject the null hypothesis regarding the compatibility of theoretical and empirical distribution matching for the analysed variables q o b s s k a q m o d s k a q o b s o c h q m o d o c h q o b s k a m and q m o d k a m particular attention was paid to the results of the da d and dk s tests the smallest of the maximum distances between the theoretical and empirical cumulative distribution values especially in the tail part the da d test were significantly below the critical value of both tests determined at the significance level α 0 05 this means that the adopted most credible distributions are well matched in the tail part to a random sample of maximum annual flows for both observational data obs and the eba4sub model mod the last element of verification of the maximum annual flow distributions was a comparison of the estimated quantile error resulting from the randomness of the sample of the maximum observed annual flow q obs and modeled with eba4sub q mod fig 9 the smallest differences in error in quantile values in the entire range of variability of maximum annual flows were observed in the skawica catchment fig 9a the largest differences in errors of the values of low quantiles i e the values of maximum annual flows exceeded with a high probability e g 99 0 and 99 9 percent were observed in the ochotnica catchment fig 9b the highest differences in errors of high quantile values i e the maximum flow values exceeded with a low probability e g 0 01 and 0 001 percent were recorded in the kamienica nawojowska catchment fig 9c when determining the maximum annual flows with a given probability of being exceeded using rainfall runoff models it is usually assumed that the probability of rainfall is the same of the flood caused by the rainfall as pilgrim and cordery 1975 showed this assumption is a simplification the actual relationship between rainfall and flow probability is unclear because each rainfall characteristic introduces some changes in the assumed probability therefore it is also necessary to take into account other characteristics describing the rainfall duration pattern intensity research carried out by viglione and blöschl 2008 showed that equal rainfall and flow probability can be assumed provided that the rainfall episodes causing the flood were of the same duration however the floods are usually less likely to occur than rainfalls the research carried out in this work allows to state that the proposed methodology can eliminate the problem related to determining the probability of rainfall and flood the analysis is not based on rainfall with a specified probability of exceeding but on actual episodes causing observed floods commonly known hydrological models needs calibrations of parameters calibration is a critical component of model development because parameters generally cannot be determined directly from measurements but are instead inferred indirectly by calibrating the hydrological model to observed hydrological responses wright et al 2019 the eba4sub model can alternatively be used to calculate annual maximum flows with a specified probability of overflow in ungauged catchments the main advantage of the model is the simplicity of its use which consists of three modules determining the rainfall determining the excess rainfall and determining the flow hydrograph petroselli and grimaldi 2018 the simplicity of using the model in hydrological analyses means that it can be successfully used by practitioners to determine the size of credible peak flows for estimating flood hazard zones or for designing hydrotechnical constructions designers using rainfall runoff models should carefully determine the parameters of the models as they play an important role in the peak flow estimation changes in the values of input parameters may affect the determination of peak flows in eba4sub the model parameters are determined directly on the basis of physiographic characteristics of the catchment which reduces the subjectivity of their determination however it should be emphasized that further research should be carried out regarding the possibility of its use in ungauged catchments such studies should primarily focus on determining the shape of the design hyetograph for the catchment a research conducted by młyński et al 2018c has shown that even small changes in the shape of the rainfall hyetograph can cause differences in maximum flows calculated using the model of greater than 10 generally it can be stated that the proposed approach uses extensive information on rainfall and enables the determination of rainfall losses and the dynamics of runoff formation taking into account the spatial variability of the catchment which is implemented by using dem and equations for surface flow estimation thus the proposed solution has clear advantages over commonly used simplified methods for estimating maximum flows of course the proposed solution has also limitations associated primarily with the need to carefully select rainfall episodes for further analysis in this case it is more advantageous if rainfall with time resolution shorter than 1 day is available for instance hourly this can be a significant problem for many catchments 5 discussion and conclusions the purpose of the study was to analyse the possibility of using the eba4sub model to determine the value of maximum annual flows with a specified probability of exceeding in selected catchments of the upper vistula river basin considering the results obtained the eba4sub model was considered suitable for calculating the maximum annual flows with a specified probability of exceeding the model is characterized by a set of common modules of the rainfall runoff transformation and adapts them to the practical cases where it is not possible to calibrate the input parameters one main adavantage of the model particularly useful in the ungauged basin perspective is to propose a framework that provides similar results when it is applied by two analysts at different times for the same watershed and input data hence minimizing the subjectivity of the modeller this model gives relatively similar values to the observed flows therefore it may be recommended as one of the possible alternatives to the use of empirical formulas or other simple approaches to determine the maximum annual flows with a specified probability of exceeding it should be emphasized however that the decisive aspect about the accuracy of the obtained results is the quality of rainfall data which is the input of the model therefore it is recommended that the model be used in catchments with full information on rainfall in addition the analyses showed that the gamma and weibull statistical distributions allow obtaining the smallest errors in estimating the maximum flow quantiles based on the analyses carried out the validity of the assumptions regarding the new proposal for the calculation of maximum flows was positively verified namely much smaller quantile errors were obtained when the maximum flows series from the eba4sub model was used compared to the observed data series the proposed methodology has the following advantages simplicity due to the use of eba4sub the values of input parameters can be determined automatically on the basis of physiographic characteristics of the catchment which reduces the subjectivity of their determination plus elimination of the problem related to the determination of the probability of rainfall and flood therefore this methodology can be used in calculating the maximum annual flow quantiles in ungauged mountainous catchments because it allows for considering complete information on rainfall and takes into account in a simplified way the complex dynamics occurring on the catchment like infiltration and flow routing regarding future research the following investigations are already in progress a the use of synthetic rainfall timeseries circumstance that could reduce the uncertainties due to the limited time span and low resolution of observed rainfall data b an integrated approach of eba4sub with a selection of hydraulic models in order to fully investigate the flood mapping issue c a generalization of eba4sub framework in order to improve the hydrological modeling e g the implementation of specific modules able to describe subsurface flow and baseflow processes d a test of the proposed approach in a large number of catchments also with medium and low slopes and for rainfall with variable characteristics credit authorship contribution statement dariusz młyński methodology formal analysis investigation data curation writing original draft visualization andrzej wałęga conceptualization methodology writing original draft writing review editing project administration bogdan ozga zielinski methodology formal analysis writing original draft maurycy ciupak software formal analysis andrea petroselli software writing original draft writing review editing supervision declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments authors thank of institute of meteorology and water management national research institure for permitted to access to hydrolometeorological datas from analysed catchments the research was supported by the ministry of science and higher education of the republic of poland for the university of agriculture in 2019year 
5258,global simulations of hydrology and hydraulics combine network type routing with hydrological simulations on large hydrological response units hrus in order to efficiently simulate the hydrological response of hrus empirical equations are generally applied to averaged physical parameters or empirical constants the usage of physically based equations on a spatial description of the hru could provide benefits in accuracy and scenario assessment in this research we develop a multi parameter inter variable terrain description to simulate hru hydrology and flow water is distributed over these classifications and used for application of physically based equations a mass balanced scheme is presented that uses parameter inter variability matrices to update the distributions of water furthermore the method is used to simulate processes using physically based equations that result in fluxes from and to other classes within a distribution resulting in a semi spatial process description within an hru finally physically based equations are thus applied to a dynamic semi spatial hru description using multiple inter variable physical parameters a variety of study cases on hypothetical and real events are performed to highlight the behavior and sensitivity of the model as well as comparison to existing methods un calibrated comparison with full spatial flow simulations show reasonable agreement with a nash sutcliffe coefficient of 0 47 comparison to simulations of real events on catchments in northern china and central spain show good comparability with an average nash sutcliffe coefficient of 0 56 the performance of the model indicates good applicability when considering the efficiency of the method simulation time is in the ranges from fractions of seconds on consumer hardware without dependency of the area of the catchment additionally the model uses physical parameters as input and physically based descriptions of processes this results in interactions between infiltration and flow that alter flow dynamics and hydrograph shapes in similar manners to full spatial hydrology and flow models finally the method provides the possibility of linked additional processes such as groundwater and erosion and could be applied on a global scale keywords hydrology hydrographs infiltration runoff physically based 1 introduction in solving the massive global and local challenges in the availability of clean water global or regional scale hydrological models are frequently used such models require the simulation of land surface hydrology and flow routing bierkens et al 2015 flow routing is typically approximated by simulating kinematic water flow over a fixed river network similar to a local drainage direction network between these one dimensional river sections there exists hydrological response unit hru of which the outflow feeds the channel network the simulation of a water balance within these hrus requires partitioning of rainfall and snowmelt into infiltration runoff evapotranspiration and other storages and fluxes de graaf et al 2015 based on these fluxes important variables such as the soil water content and are determined finally runoff and river flow can lead to global flood predictions yamazaki et al 2014 raise awareness and estimate the influence of climate change hirabayashi et al 2013 simulating the hydraulic response of hru s for global application is a challenging process the hru s can be divided into regular squares through rasterization or polygons using other criteria to set boundaries flügel 1995 for larger hru s direct spatial application of physically based equations demands both data accuracy computational capacity and time often beyond what is possible this leads to usage of a simplified description of the terrain within simulations arnold et al 2012 for example several existing approaches take averages for important hydrological parameters of soil or surface soil conservation service 1972 morgan 2001 however processes are non linear and therefore the application of a function to a spatial average does not have to be equal to the spatial average of the applied function other approaches reduce the need for these parameters and capture the behavior of the hru in empirical parameters that can be obtained through calibration de graaf et al 2015 several methods exist for non spatial modelling of discharge from an hru the curve number method uses an empirical relationship that estimates the fraction of water and has been developed and maintained by the soil conservation service in the u s a soil conservation service 1972 the curve number can be used to replace the cruder runoff coefficient in the rational method furthermore if unit hydrographs are available and a time of concentration is estimated a full hydrograph can be estimated e g tr 55 method the morgan morgan finey mmf model uses an empirical equation based on theoretical considerations morgan 2001 morgan and duzant 2008 the model proposes a negative exponential curve can be used to predict the quantity of infiltration out of the total rainfall during a specific time period typically a day shresta and jetten 2018 adopted this equation to a daily spatial water balance replacing the numerator with the daily soil moisture deficit of the control zone and the denominator with the daily rainfall the rational method estimates peak flow based on steady state assumptions between incoming rainfall intensity and outgoing discharge kuichling 1889 thompson 2006 hayes and young 2006 due to this assumption it is meant to be applied to small scale drainage areas such as sewer systems the effect of infiltration is then compensated by a constant runoff coefficient which distributes water over infiltration and runoff generation the arno scheme and improved arno scheme are types of bucket hydrology schemes dümenil and todini 1992 hagemann and gates 2003 here the soil water capacity of a larger area is modelled as a large collection of smaller containers or soil water capacities this distribution is generally taken as a power law in practice any non infiltrated water is released as discharge from the simulated area this type of model is frequently used in global hydrological models de graaf et al 2015 single linear reservoir models have been used in a variety of models crawford and linsley 1966 james 1970 foroud 1978 the linear reservoir method simplifies the complex flow patterns of a catchment by envisioning a sequence of linearly reacting storage reservoirs lópez et al 2005 each reservoir is located at lower elevation closer to the outlet of the area the outflow rate for a reservoir is linearly dependent on the total storage within that specific reservoir due to the linearity of the reservoirs and the linking there is in this approximation a spatial distribution of water over the catchment furthermore the outflow of this method is time dependent and resembles the typical wave shapes of hydrographs empirical formulations of a hru response often benefit from their computational simplicity and ability to run on large and low resolution datasets values for empirical parameters are frequently obtained by means of calibration and validation this method of estimating parameters can also be a downside as it does not allow for estimation of parameters for future scenarios or based on direct measurements in contrast the usage of physical parameters allows for direct assessment from measurement and estimation of parameters for alternative scenarios by inputting alternative scenarios impact and consequences from processes such as climate change land use change or urban growth can be assessed however for the benefits of physically based parameters to be used a more complex description of the terrain and subsurface of a hru this would increase computational cost beyond the limitations of current equipment current attempts in modelling that go beyond a hru averaging include the linear reservoir method crawford and linsley 1966 which has not been applied to a global scale this method describes the terrain based on distribution of a single parameter in this case elevation other approaches to this use single parameter distribution for other parameters related to the soil hagemann gates 2003 however in these cases inter parameter variability is not taken into account and the selected parameters are taken as independently varying in reality many parameters are causally connected and therefore correlated the objective of this work is the development of a method that can efficiently simulate hydrology using a physically based process description a new method is explored to simulate clumped semi spatial hydrology and flow from hrus by using multi parameter inter variable terrain descriptions the concept of semi spatial discretization for hydrology is extended to physically based equations in section 2 we develop the mathematical framework for the semi spatial discretization of multi parameter inter variable terrain afterwards we implement in this framework precipitation infiltration and surface flow based on physically based equations in section 3 we apply the developed method to real world cases and several numerical studies finally in section 4 we discuss the implications and requirements of the scheme and how these impact its possible application 2 model development 2 1 multi parameter catchment classification similar to crawford and linsley 1966 and hagemann gates 2003 a semi spatial classification of the terrain is performed in contrast with these authors the presented derivation uses a classification of multiple parameters we define the parameters x 1 x n x n with n the number of parameters for parameter one classes are notated as x 1 1 x i 1 x c 1 with c the number of classes these classes can be chosen to have an equal surface area within the hru but could be chosen in other manners such as based on existing land use classifications in this section we use three parameters as example land use slope and soil each discretized into four classes fig 1 these parameters are not direct input for the model but represent a choice of physical parameter in section 2 5 the actual implementation of the physically based equations will determine the actual physical parameters that are classified for each terrain parameter the classes represent planar surface that can store and exchange water in each of the classes the surface area is denoted a x i note that the total area for each of the parameters the sum of the area for each class is equal to the total surface area of the hru equation 1 1 i 0 c a x i n h r u a r e a where x i n is a specific discretized parameter class superscript indicates parameter subscript indicates class sampling a random point within the hru the probability of finding for example a specific land use class can be expressed probabilistically based on the relative frequency of the class equation 2 2 p x i n a x i n a hru where p x i n is the probability that for a specific parameter n land use for example at a random location class i is found for each of the parameters each class represents a surface plane that holds some volume of water defined as v x i n if the terrain experiences a homogeneous precipitation homogeneous influx of water the volumes for each of the classes increases by the rainfall volume multiplied by the probability of the specific class 3 δ v x i n r p x i n where r is the rainfall volume and δ v x i n is the fluid volume change for parameter n and class i we employ the following terminology the fluid volumes in the classes for a parameter represent the distribution of water over that parameter fig 1 by combining 1 and 3 it can be found that the total volume of water distributed over the classes of each parameter is equal equation 4 for a mass conserving simulation this must remain so for any operation performed on the fluid volumes 4 i 0 c n 0 n v x i n v total where v total is the total fluid volume on the hru terrain surface 2 2 multi parameter inter class probability while precipitation acts homogeneously on the water distributions this is not the case for other processes other processes can act in higher or lower degree for distinct classes of physical parameters for example soil types influence infiltration and specific soil classes might lose a relatively higher volume of water due to this process we define a fluid volume flux q i n with i from 0 to c which acts on a water distribution to change the volumes δ v x i n q i n since we require the water distribution for each parameter to be consistent and of identical total volume there must be a flux for the other distributions we must therefore define a manner in which we can remove water from a specific class but maintain mass conservation and consistency with the other water distributions to do so we define the inter class probability matrix p x i n x j k which indicates the probability that for an area containing class i for parameter n it has class j for parameter k fig 2 this probability is equal to the normalized fractional area of class i for parameter n and class j for parameter k equation 5 5 p x i n x j k a x i n x j k l 0 c a x i n x l k normalization is required since there must be a probability of 1 that there is some class for parameter k l 0 c p x i n x l k 1 2 3 mass conserving flux transfer using the inter class probability a flux transformation can be defined that transforms a flux from classified parameter space of one parameter to the space of a second parameter this transformed flux can then be used to alter fluid volumes in the water distribution over the second parameter we assume here that the flux transforms according to the product of its inter class probability and normalized fractional water content equation 6 6 q j k i 0 c q i n p x i n x j k v x j k l 0 c p x i n x l k v x l k in practical terms equation 6 defines the estimation of the exact distribution of water over the full terrain in a probabilistic manner it is important to verify the conservation of mass in this transformation the sum of transformed fluxes is required to be equal to the sum of the original fluxes i 0 c q i n i 0 c q i k this can be shown due to i 0 c p x i n x j k v x j k l 0 c p x i n x l k v x l k 1 and switching the double summation the proposed transformation rule provides the required properties mass conservation volume positivity and adressing inter class areas and parameter intervariable water distributions see fig 3 for examples of flux transformations for each combination of classes an area a x i n x j k is defined for each individual parameter class a surface area and flow volume area known a x i n and v x i n in order to implement processes a water volume for a combination of classes v x i n x j k is required using the same principle used above for flux transfer the water volume on a combination of parameter classes can be defined equation 7 7 v x i n x j k v x i n p x i n x j k v x j k l 0 c p x i n x l k v x l k where v x i n x j k volume of fluid present on the surface area a x i n x j k the combination of these variables defines the fluid height on the surface h x i n x j k v x i n x j k a x i n x j k 2 4 flow processes we have defined a flux transformation based on the inter class probabilities a similar approach can be taken to simulate flow processes in a semi spatial manner first this requires the surface slope as a parameter to be classified changes in the water volume within a class then depend on the probability of outflow p s equation 8 8 δ v x i slope j 0 c q out x j slope p s x j slope x i slope where q out x j slope is the outgoing discharge from the surface plane element described by slope class j and p s x j slope x i slope is the probability that a volume of water leaving an area with slope class j enters slope class i this will represent the terrain in terms of a cascade of sloping planes where water is re distributed over the slope classes by using a semi spatial probabilistic expression of the terrain in order to obtain an expression for q out and p s slope map for the hru is rasterized into regular rectangular elements of size δ x afterwards a drainage network is calculated using a local drainage direction with pit removal algorithm the spatial inter class probability p s can now be estimated by means of counting the frequency of slope classes in direct downslope neighbors equation 9 9 p s x j slope x i slope a x i slope d i r e c t l y d o w n s l o p e n e i g h b o r o f x j slope a x j slope equations 9 and 5 are analogous as they use frequency for probability estimationfor a given timestep δ t q out can similarly be expressed based on the rasterized slope of the hru equation 10 10 q out x j slope v x j slope δ δ t v x j slope δ x where v x j slope is the velocity of the fluids stored in slope class j a schematic overview of the proposed flow scheme is shown in fig 4 2 5 hru outflow besides internal flow within a hru outflow exists where fluids enter a river or channel network that acts as an outlet in one of the slope classes typically the most gentle slope an outlet may occur here a part of the estimated discharge is not re distributed among the slope classes but instead counted as outgoing discharge through the outlet similar to the semi spatial flow scheme the probability of hru outflow for each slope class p out can be defined given this probability the outflow can then be estimated equation 11 11 q outflow x j slope q out x j slope δ p out x j slope to accurately estimate fraction of discharge flowing through the outlet we utilize a probabilistic approach to catchment shapes in any catchment the distance from each location towards the outlet is distributed between zero and the furthest location fig 5 in the example give and in many characteristically tree shaped catchment there is a slow rise in outflow probability with increasing distance due to the branching tree like nature of watersheds the distribution of distances to the outlet often features asignificant peak beyond half the full length of the watershed using a geographic information system to create a drainage network both the average and the square root of the variance of the distance to outlet can be obtained using these we estimate the fraction of water that given a cumulative average travel distance is at or further then the outlet fig 6 since a full distribution of the distances to outlets are unknown this is approximated using an existing probability density function this function is parameterized using the average distance to outlet and the variance d av and d σ values in the examples provided in this research a weibull distribution is used due to its similarity to the expected characteristic distributions of catchments its flexibility in shapes limited parameters and the fact that it only assigns probability to positive values to define p out the distance travelled by the fluid volume is defined d the travelled distance for the fluid volumes on the slopes can expressed as equation 12 12 δ v x i slope δ d x i slope δ t δ t δ v x i slope j 0 c q out x j slope δ p s x j slope x i slope δ d x j slope where d x j slope is the distance travelled on average by the fluid volume in slope class j equation 12 is analogous to momentum conservation in finite difference schemes in addition to incrementing travelled distance by the velocity during a timestep travelled distance as a property of the fluids is conserved 2 6 modelling infiltration and runoff generation processes using physically based equations using the mathematical framework provided in the previous sections hydrological processes can be implemented here precipitation infiltration and runoff are implemented to describe a simple hru response precipitation results in water being added homogeneously to the water distributions after the addition of rainfall to the surface the primary process of the simulation is overland flow as estimated by mannings surface flow equation equation 13 maidment 1993 13 v 1 n s r 2 3 where n is mannings surface roughness coefficient s is the slope and r is the hydraulic radius defined for shallow flows to be approximately equal to the flow height the green and ampt infiltration model is implemented for infiltration green and ampt 1911 this model assumes a wetting front moving down into the soil due to infiltrating rainfall the resulting potential infiltration is subtracted from the available surface water equation 14 14 f pot k s ψ θ s θ i f 1 where f pot is the potential infiltration rate ms 1 f is the cumulative infiltrated water m θs is the porosity m 3 m 3 θt is the initial soil moisture content m 3 m 3 ψ is the matric pressure at the wetting front h ψ z m and ks is the saturated conductivity ms 1 the input parameters for the model can now be determined based on the required input for the equations flow requires only mannings surface roughness coefficient land use is therefore classified based on this parameter in contrast to flow infiltration requires four parameters saturated conductivity matric suction initial moisture and the saturation moisture level we choose to classify one of these saturated conductivity this maintains the simplicity and efficiency of the model the remaining parameters required for infiltration are obtained by averaging within the area of a class for saturated conductivity after parameter selection processes must be implemented there are several options to simulate a process the first option is to calculate fluxes for each combination of each parameter this increases computational costs but allows for more detailed description of behavior given different combinations of the physical parameters equation 15 15 i x i ksat j 0 c k 0 c i x i ksat x j slope x k land u s e where i x i ksat is the average infiltration for the area represented by class i of hydraulic conductivity in practice the increased computational cost coming from the double summation prevents efficient implementation of equation 14 the second option which is chosen in this work is to simulate a process only for each combination of relevant parameters for example in infiltration models slope is generally ignored since its value does not directly alter infiltration mishra et al 2003 thus infiltration can be simulated using the distribution of water over soil types and land use types equation 16 16 i x i ksat k 0 c i x i ksat x j slope x k land u s e afterwards the volume flux is known for land use and soil type classes additionally the volume flux is required for the remaining parameter the transformation rule in equation 5 can be used to obtain this an example of the implementation of infiltration is provided in fig 7 2 7 model input parameters the final model setup is shown in fig 8 the model requires a classification of slope land use and soil for land use manning s surface roughness coefficient is classified for soil the saturated conductivity is classified in addition soil classes are provided an average value for saturation soil moisture and matric suction thus the model requires spatial input for five physical parameters and a timeseries of precipitation table 1 an initial preparation step is required where a drainage network is calculated for the hru from this the d σ and d av are required as well as the inter slope probability values these calculations can be efficiently performed in a gis script as an initial calculation and do not need to be repeated for each simulation 3 model application in this section several applications of the proposed method will be shown a set of both hypothetical and real catchments are simulated and compared with results from fully spatially distributed simulations of overland flow and infiltration 3 1 numerical tests several catchments have been generated to test the proposed method generation was done using a fractal type branching tree with a variety of angles and skewness finally based on the distance from the tree network an elevation model as created using 10 m gridcells fig 9 physical parameters for the areas are homogeneous and set as k s ψ n θ i θ s 10 mm h 10 c m 0 1 0 4 0 5 for these areas we run a full spatial surface flow model openlisem using a kinematic wave flow approximation bout and jetten 2018 3 1 1 results the simulation results for the hypothetical catchments together with fully spatial kinematic wave simulations and used rainfall intensities are shown in fig 10 in general the proposed method captures outflow behavior similar to the full spatial simulations of the catchments the averaged performance of the model without calibration is r 2 0 47 while calibrated models typically reach higher values it is important to evaluate the performance in light of the relatively simple non spatial setup of the model additionally no calibration was performed the outputs thus indicate that the method can provide reasonable simulations of hydraulic response without the need for full spatial simulation additionally the shape and topography influences the outputs in a realistic manner hydrograph peak height width and shape are altered in ways similar to the full spatial flow model for several other aspects the proposed method lacks detail when compared to the fully spatial simulations in particular the sudden arrival shown by the third and fourth catchment is not captured well by the model part of the cause of this is the relatively small variance in distance to outlet which leads to a small wave where water arrives simultaneously though this type of behavior is estimated in the proposed method it is in these cases underestimated possibly due to the extreme catchment shapes for the first and second catchments the behavior difference due to the distribution of the distances to the outlet are significantly better predicted these types of catchment shapes are also more alike to naturally occurring watersheds 3 2 real study cases we apply the proposed method to two real catchments the danandou and prado areas fig 11 and fig 12 the first of these is the danandou catchment a rural area in the loess plateau in china which was previously used by hessel et al 2003 see also hessel et al 2003b hessel van asch 2003 and hessel and jetten 2007 to calibrate a previous version of the lisem model this 257 ha region is characterized by steep slopes 20 and dry non vegetated terrain for this catchment three precipitation events from 20 to 07 1999 23 08 1998 and 01 08 1998 will be used together with measured rainfall intensity discharge after these events is available for every two minutes the spatial resolution of this dataset is 10 m a second catchment in prado south eastern spain will be used this 50 km2 semi arid region is predominantly covered by dry shrubs and forest and has previously been used with lisem by baartmans et al 2013 see also baartmans et al 2012a baartmans et al 2012b both rainfall and discharge data are available for three rainfall events the spatial resolution of this dataset is 20 m calibration occurs by altering the values of the saturated conductivity and mannings surface roughness with a homogeneous multiplier the simulations were performed for a total of 100 combinations of input with the multipliers ranging between 0 5 and 1 5 model accuracy was assessed based on the nash sutcliffe model efficiency index 3 2 1 results the modelling results for three events together with measured rainfall and observed discharges are shown in fig 13 and table 2 simulation results show a reasonable capture of both the peak flow discharge and the timing of the hydrograph in several aspects the proposed method lacks detail when compared to the fully spatial simulations in particular the width of the hydrograph is not predicted accurately in each event such difficulties were similarly found with a full spatially distributed hydrological model hessel et al 2003b as proposed by these authors there are strong non linear effects induced by the abrupt initiation of runoff after saturation of the top soil layer this complicates the correct estimation of the initial flow moment additionally the terrain is rough with steep gullies and sloping farmlands this complicates accurately representing flow routing within a model as small and steep elevation patterns predominantly determine the hydrograph dynamics most notable to the found results is the accuracy which is comparable to these full spatial simulations while reducing the computational and data requirements significantly 3 3 comparison to rational method to further investigate the implications of the proposed method we apply a set of synthetic triangular rainfall events with increasing total rainfall depth to both the prado and danandau catchments the precipitation graph is constructed as a triangle with duration of one hour and peak rainfall intensity between 10 and 100 mm hour with increments of 10 mm hour this is then compared with results for peak flow from the rational method since the rational method split incoming precipitation into infiltration and runoff based on a constant runoff coefficient we employ this identical technique for the presented method for a consistent comparison we use the same runoff coefficient to simulate infiltration and storage in both methods which is set to be 0 3 typical value see thompson 2006 this value is chosen to indicate the difference between the models in typical scenarios and does not necessarily represent a calibrated parameter for the prado area the results are shown in fig 14 results from the simulations show the resulted increase in peak flow related to rainfall intensity in both models the rational method increases linearly the simplicity of this method results in an unrealistic increase in peak discharge with large rainfall values however usage of the method is common in engineering practice due to the simplicity of the method peak discharges for the presented methodology do not increase linearly instead the flow method provides a more physically based estimation of flow dynamics this includes the increase in flow velocity with increased water height because of this both the peak discharge timing of the peak and the shape of the hydrograph are altered this large observed differences can be explained by the assumption of steady state flow in the rational method steady states take significant amounts of time to occur in larger areas before this time has passed the rainfall intensity has changes or the event has passed altogether such as is the case in the simulations 3 4 sensitivity analysis finally a sensitivity analysis is performed to investigate the influence of parameter variability on outflow dynamics the first event for the prado catchment is simulated with limited parameter variability three additional simulations with averaged slope ksat and mannings n are performed respectively fig 15 the results are compared to the simulation with full parameter variability as is visible from fig 15 differences when using averaged parameter values are significant altering the peak total and timing of the discharge our semi spatial terrain description provides interactions between processes that would be seen in full spatial modelling and reality here this is exemplified by the changes in hydrograph shape resulting from altering a single parameters alterations in k sat alter flow height and therefore flow velocity and thus not only alter peak flow but timing as well we further show the behavior of the proposed methodology by performing a simple sensitivity analysis for the simulations on the danandou catchment here a triangular rainfall with an averaged intensity of 50 mm h is taken as input together with the reference infiltration capacity and manning s n values then both of these inputs are altered by a multiplier ranging between 0 15 and 1 5 the resulting hydrographs are shown in fig 16 the results from the sensitivity analysis show patterns highly similar to the results found in case of full spatial flow and infiltration modelling singh 1997 pokhrel and gupta 2011 the increase of mannings roughness coefficient decreased flow velocities and thereby delays and lowers the peak outflow value the delay is visible on the full hydrograph as resulting in a wider and lower shape for the saturated conductivity the total outflow volume is directly related to the value of the saturated conductivity of the soils while lower outflow delays flow velocities and thus delays the peak outflow time the effect is substantially less significant when compared to the delay from increased values of mannings n 4 future scope of the research the presented framework for multi parameter inter variable catchment hydrology can represent precipitation flow and infiltration in a semi spatial manner the implementation of physically based equations results in emergent behavior that captures real observations alteration of a single input parameter can have consequences for the full dynamics of the model through interactions in the equations and the distributions of water on the terrain such behavior is generally found in spatially distributed physically based models but lacks in non spatial empirical models the developed framework might with relative ease be extended with additional processes to provide a more complete description of full hydrology for ground water dynamics the flow scheme as used in surface flow can be adapted by using a depth averaged darcy approximation for a saturated ground water layer evapotranspiration could similarly be implemented for combinations of land use and soil type finally a surface storage component could be implemented to capture the storage of water in surface micro roughness several issues related to the application of the method remain to be investigated first the propagation of uncertainty in model input to model outcomes might be investigated input parameter uncertainty can complicate usage of model outcomes in decision making as results are less reliable ensemble simulations using the proposed method might be investigated to ensure uncertainties are not propagated unnaturally by either the flow scheme or the terrain description finally the multi parameter inter variable terrain description can be used to re distribute water into the original terrain while this could be used for additional modelling steps or visualization it has to be investigated to what extent this results in realistic outputs while the semi spatial terrain description describes the physical processes with good accuracy this does not necessarily guarantee the internal water distributions represent realistic behavior 5 conclusions we have proposed a new method for estimation of catchment hydrographs using non spatial physically based modelling our method utilizes a multi parameter inter variable statistical catchment description and distributes water over classified physical parameters then a semi spatial flow scheme is combined with a statistical distribution of the distance to outlet to calculate an effective probability of outflow for any water based on this and rainfall input a final hydrograph is simulated the method combines existing physically based equations for hydrology and flow with a novel semi spatial hru scheme infiltration can be included in a variety of manners such as using a runoff coefficient or the green and ampt model other processes that can theoretically be included are evapotranspiration leaf storage and erosion finally using a similar setup for semi spatial flow ground water movement could be estimated simulation and calibration results show the method performs well in predicting both uncalibrated and calibrated discharge in particular it is able to predict hydrograph peak flows and their time of occurrence with significant accuracy for both for real and hypothetical catchments the proposed method shows similar sensitivities to full spatial models and allows for calibration and validation the implementation of non averaged physical parameters add significant changes to the simulation output and allows for complex interactions in simulated physical processes the method could potentially be implemented in global hydrological simulations allowing for a full global physically based simulations of hydrology and related processes credit authorship contribution statement b bout conceptualization visualization formal analysis writing original draft v jetten conceptualization writing review editing declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper appendix a inter slope probability matrices for study areas a 1 hypothetical generated catchments their slope inter class probabilities and distance distribution a 2 study catchments their slope inter class probabilities and distance distribution 
5258,global simulations of hydrology and hydraulics combine network type routing with hydrological simulations on large hydrological response units hrus in order to efficiently simulate the hydrological response of hrus empirical equations are generally applied to averaged physical parameters or empirical constants the usage of physically based equations on a spatial description of the hru could provide benefits in accuracy and scenario assessment in this research we develop a multi parameter inter variable terrain description to simulate hru hydrology and flow water is distributed over these classifications and used for application of physically based equations a mass balanced scheme is presented that uses parameter inter variability matrices to update the distributions of water furthermore the method is used to simulate processes using physically based equations that result in fluxes from and to other classes within a distribution resulting in a semi spatial process description within an hru finally physically based equations are thus applied to a dynamic semi spatial hru description using multiple inter variable physical parameters a variety of study cases on hypothetical and real events are performed to highlight the behavior and sensitivity of the model as well as comparison to existing methods un calibrated comparison with full spatial flow simulations show reasonable agreement with a nash sutcliffe coefficient of 0 47 comparison to simulations of real events on catchments in northern china and central spain show good comparability with an average nash sutcliffe coefficient of 0 56 the performance of the model indicates good applicability when considering the efficiency of the method simulation time is in the ranges from fractions of seconds on consumer hardware without dependency of the area of the catchment additionally the model uses physical parameters as input and physically based descriptions of processes this results in interactions between infiltration and flow that alter flow dynamics and hydrograph shapes in similar manners to full spatial hydrology and flow models finally the method provides the possibility of linked additional processes such as groundwater and erosion and could be applied on a global scale keywords hydrology hydrographs infiltration runoff physically based 1 introduction in solving the massive global and local challenges in the availability of clean water global or regional scale hydrological models are frequently used such models require the simulation of land surface hydrology and flow routing bierkens et al 2015 flow routing is typically approximated by simulating kinematic water flow over a fixed river network similar to a local drainage direction network between these one dimensional river sections there exists hydrological response unit hru of which the outflow feeds the channel network the simulation of a water balance within these hrus requires partitioning of rainfall and snowmelt into infiltration runoff evapotranspiration and other storages and fluxes de graaf et al 2015 based on these fluxes important variables such as the soil water content and are determined finally runoff and river flow can lead to global flood predictions yamazaki et al 2014 raise awareness and estimate the influence of climate change hirabayashi et al 2013 simulating the hydraulic response of hru s for global application is a challenging process the hru s can be divided into regular squares through rasterization or polygons using other criteria to set boundaries flügel 1995 for larger hru s direct spatial application of physically based equations demands both data accuracy computational capacity and time often beyond what is possible this leads to usage of a simplified description of the terrain within simulations arnold et al 2012 for example several existing approaches take averages for important hydrological parameters of soil or surface soil conservation service 1972 morgan 2001 however processes are non linear and therefore the application of a function to a spatial average does not have to be equal to the spatial average of the applied function other approaches reduce the need for these parameters and capture the behavior of the hru in empirical parameters that can be obtained through calibration de graaf et al 2015 several methods exist for non spatial modelling of discharge from an hru the curve number method uses an empirical relationship that estimates the fraction of water and has been developed and maintained by the soil conservation service in the u s a soil conservation service 1972 the curve number can be used to replace the cruder runoff coefficient in the rational method furthermore if unit hydrographs are available and a time of concentration is estimated a full hydrograph can be estimated e g tr 55 method the morgan morgan finey mmf model uses an empirical equation based on theoretical considerations morgan 2001 morgan and duzant 2008 the model proposes a negative exponential curve can be used to predict the quantity of infiltration out of the total rainfall during a specific time period typically a day shresta and jetten 2018 adopted this equation to a daily spatial water balance replacing the numerator with the daily soil moisture deficit of the control zone and the denominator with the daily rainfall the rational method estimates peak flow based on steady state assumptions between incoming rainfall intensity and outgoing discharge kuichling 1889 thompson 2006 hayes and young 2006 due to this assumption it is meant to be applied to small scale drainage areas such as sewer systems the effect of infiltration is then compensated by a constant runoff coefficient which distributes water over infiltration and runoff generation the arno scheme and improved arno scheme are types of bucket hydrology schemes dümenil and todini 1992 hagemann and gates 2003 here the soil water capacity of a larger area is modelled as a large collection of smaller containers or soil water capacities this distribution is generally taken as a power law in practice any non infiltrated water is released as discharge from the simulated area this type of model is frequently used in global hydrological models de graaf et al 2015 single linear reservoir models have been used in a variety of models crawford and linsley 1966 james 1970 foroud 1978 the linear reservoir method simplifies the complex flow patterns of a catchment by envisioning a sequence of linearly reacting storage reservoirs lópez et al 2005 each reservoir is located at lower elevation closer to the outlet of the area the outflow rate for a reservoir is linearly dependent on the total storage within that specific reservoir due to the linearity of the reservoirs and the linking there is in this approximation a spatial distribution of water over the catchment furthermore the outflow of this method is time dependent and resembles the typical wave shapes of hydrographs empirical formulations of a hru response often benefit from their computational simplicity and ability to run on large and low resolution datasets values for empirical parameters are frequently obtained by means of calibration and validation this method of estimating parameters can also be a downside as it does not allow for estimation of parameters for future scenarios or based on direct measurements in contrast the usage of physical parameters allows for direct assessment from measurement and estimation of parameters for alternative scenarios by inputting alternative scenarios impact and consequences from processes such as climate change land use change or urban growth can be assessed however for the benefits of physically based parameters to be used a more complex description of the terrain and subsurface of a hru this would increase computational cost beyond the limitations of current equipment current attempts in modelling that go beyond a hru averaging include the linear reservoir method crawford and linsley 1966 which has not been applied to a global scale this method describes the terrain based on distribution of a single parameter in this case elevation other approaches to this use single parameter distribution for other parameters related to the soil hagemann gates 2003 however in these cases inter parameter variability is not taken into account and the selected parameters are taken as independently varying in reality many parameters are causally connected and therefore correlated the objective of this work is the development of a method that can efficiently simulate hydrology using a physically based process description a new method is explored to simulate clumped semi spatial hydrology and flow from hrus by using multi parameter inter variable terrain descriptions the concept of semi spatial discretization for hydrology is extended to physically based equations in section 2 we develop the mathematical framework for the semi spatial discretization of multi parameter inter variable terrain afterwards we implement in this framework precipitation infiltration and surface flow based on physically based equations in section 3 we apply the developed method to real world cases and several numerical studies finally in section 4 we discuss the implications and requirements of the scheme and how these impact its possible application 2 model development 2 1 multi parameter catchment classification similar to crawford and linsley 1966 and hagemann gates 2003 a semi spatial classification of the terrain is performed in contrast with these authors the presented derivation uses a classification of multiple parameters we define the parameters x 1 x n x n with n the number of parameters for parameter one classes are notated as x 1 1 x i 1 x c 1 with c the number of classes these classes can be chosen to have an equal surface area within the hru but could be chosen in other manners such as based on existing land use classifications in this section we use three parameters as example land use slope and soil each discretized into four classes fig 1 these parameters are not direct input for the model but represent a choice of physical parameter in section 2 5 the actual implementation of the physically based equations will determine the actual physical parameters that are classified for each terrain parameter the classes represent planar surface that can store and exchange water in each of the classes the surface area is denoted a x i note that the total area for each of the parameters the sum of the area for each class is equal to the total surface area of the hru equation 1 1 i 0 c a x i n h r u a r e a where x i n is a specific discretized parameter class superscript indicates parameter subscript indicates class sampling a random point within the hru the probability of finding for example a specific land use class can be expressed probabilistically based on the relative frequency of the class equation 2 2 p x i n a x i n a hru where p x i n is the probability that for a specific parameter n land use for example at a random location class i is found for each of the parameters each class represents a surface plane that holds some volume of water defined as v x i n if the terrain experiences a homogeneous precipitation homogeneous influx of water the volumes for each of the classes increases by the rainfall volume multiplied by the probability of the specific class 3 δ v x i n r p x i n where r is the rainfall volume and δ v x i n is the fluid volume change for parameter n and class i we employ the following terminology the fluid volumes in the classes for a parameter represent the distribution of water over that parameter fig 1 by combining 1 and 3 it can be found that the total volume of water distributed over the classes of each parameter is equal equation 4 for a mass conserving simulation this must remain so for any operation performed on the fluid volumes 4 i 0 c n 0 n v x i n v total where v total is the total fluid volume on the hru terrain surface 2 2 multi parameter inter class probability while precipitation acts homogeneously on the water distributions this is not the case for other processes other processes can act in higher or lower degree for distinct classes of physical parameters for example soil types influence infiltration and specific soil classes might lose a relatively higher volume of water due to this process we define a fluid volume flux q i n with i from 0 to c which acts on a water distribution to change the volumes δ v x i n q i n since we require the water distribution for each parameter to be consistent and of identical total volume there must be a flux for the other distributions we must therefore define a manner in which we can remove water from a specific class but maintain mass conservation and consistency with the other water distributions to do so we define the inter class probability matrix p x i n x j k which indicates the probability that for an area containing class i for parameter n it has class j for parameter k fig 2 this probability is equal to the normalized fractional area of class i for parameter n and class j for parameter k equation 5 5 p x i n x j k a x i n x j k l 0 c a x i n x l k normalization is required since there must be a probability of 1 that there is some class for parameter k l 0 c p x i n x l k 1 2 3 mass conserving flux transfer using the inter class probability a flux transformation can be defined that transforms a flux from classified parameter space of one parameter to the space of a second parameter this transformed flux can then be used to alter fluid volumes in the water distribution over the second parameter we assume here that the flux transforms according to the product of its inter class probability and normalized fractional water content equation 6 6 q j k i 0 c q i n p x i n x j k v x j k l 0 c p x i n x l k v x l k in practical terms equation 6 defines the estimation of the exact distribution of water over the full terrain in a probabilistic manner it is important to verify the conservation of mass in this transformation the sum of transformed fluxes is required to be equal to the sum of the original fluxes i 0 c q i n i 0 c q i k this can be shown due to i 0 c p x i n x j k v x j k l 0 c p x i n x l k v x l k 1 and switching the double summation the proposed transformation rule provides the required properties mass conservation volume positivity and adressing inter class areas and parameter intervariable water distributions see fig 3 for examples of flux transformations for each combination of classes an area a x i n x j k is defined for each individual parameter class a surface area and flow volume area known a x i n and v x i n in order to implement processes a water volume for a combination of classes v x i n x j k is required using the same principle used above for flux transfer the water volume on a combination of parameter classes can be defined equation 7 7 v x i n x j k v x i n p x i n x j k v x j k l 0 c p x i n x l k v x l k where v x i n x j k volume of fluid present on the surface area a x i n x j k the combination of these variables defines the fluid height on the surface h x i n x j k v x i n x j k a x i n x j k 2 4 flow processes we have defined a flux transformation based on the inter class probabilities a similar approach can be taken to simulate flow processes in a semi spatial manner first this requires the surface slope as a parameter to be classified changes in the water volume within a class then depend on the probability of outflow p s equation 8 8 δ v x i slope j 0 c q out x j slope p s x j slope x i slope where q out x j slope is the outgoing discharge from the surface plane element described by slope class j and p s x j slope x i slope is the probability that a volume of water leaving an area with slope class j enters slope class i this will represent the terrain in terms of a cascade of sloping planes where water is re distributed over the slope classes by using a semi spatial probabilistic expression of the terrain in order to obtain an expression for q out and p s slope map for the hru is rasterized into regular rectangular elements of size δ x afterwards a drainage network is calculated using a local drainage direction with pit removal algorithm the spatial inter class probability p s can now be estimated by means of counting the frequency of slope classes in direct downslope neighbors equation 9 9 p s x j slope x i slope a x i slope d i r e c t l y d o w n s l o p e n e i g h b o r o f x j slope a x j slope equations 9 and 5 are analogous as they use frequency for probability estimationfor a given timestep δ t q out can similarly be expressed based on the rasterized slope of the hru equation 10 10 q out x j slope v x j slope δ δ t v x j slope δ x where v x j slope is the velocity of the fluids stored in slope class j a schematic overview of the proposed flow scheme is shown in fig 4 2 5 hru outflow besides internal flow within a hru outflow exists where fluids enter a river or channel network that acts as an outlet in one of the slope classes typically the most gentle slope an outlet may occur here a part of the estimated discharge is not re distributed among the slope classes but instead counted as outgoing discharge through the outlet similar to the semi spatial flow scheme the probability of hru outflow for each slope class p out can be defined given this probability the outflow can then be estimated equation 11 11 q outflow x j slope q out x j slope δ p out x j slope to accurately estimate fraction of discharge flowing through the outlet we utilize a probabilistic approach to catchment shapes in any catchment the distance from each location towards the outlet is distributed between zero and the furthest location fig 5 in the example give and in many characteristically tree shaped catchment there is a slow rise in outflow probability with increasing distance due to the branching tree like nature of watersheds the distribution of distances to the outlet often features asignificant peak beyond half the full length of the watershed using a geographic information system to create a drainage network both the average and the square root of the variance of the distance to outlet can be obtained using these we estimate the fraction of water that given a cumulative average travel distance is at or further then the outlet fig 6 since a full distribution of the distances to outlets are unknown this is approximated using an existing probability density function this function is parameterized using the average distance to outlet and the variance d av and d σ values in the examples provided in this research a weibull distribution is used due to its similarity to the expected characteristic distributions of catchments its flexibility in shapes limited parameters and the fact that it only assigns probability to positive values to define p out the distance travelled by the fluid volume is defined d the travelled distance for the fluid volumes on the slopes can expressed as equation 12 12 δ v x i slope δ d x i slope δ t δ t δ v x i slope j 0 c q out x j slope δ p s x j slope x i slope δ d x j slope where d x j slope is the distance travelled on average by the fluid volume in slope class j equation 12 is analogous to momentum conservation in finite difference schemes in addition to incrementing travelled distance by the velocity during a timestep travelled distance as a property of the fluids is conserved 2 6 modelling infiltration and runoff generation processes using physically based equations using the mathematical framework provided in the previous sections hydrological processes can be implemented here precipitation infiltration and runoff are implemented to describe a simple hru response precipitation results in water being added homogeneously to the water distributions after the addition of rainfall to the surface the primary process of the simulation is overland flow as estimated by mannings surface flow equation equation 13 maidment 1993 13 v 1 n s r 2 3 where n is mannings surface roughness coefficient s is the slope and r is the hydraulic radius defined for shallow flows to be approximately equal to the flow height the green and ampt infiltration model is implemented for infiltration green and ampt 1911 this model assumes a wetting front moving down into the soil due to infiltrating rainfall the resulting potential infiltration is subtracted from the available surface water equation 14 14 f pot k s ψ θ s θ i f 1 where f pot is the potential infiltration rate ms 1 f is the cumulative infiltrated water m θs is the porosity m 3 m 3 θt is the initial soil moisture content m 3 m 3 ψ is the matric pressure at the wetting front h ψ z m and ks is the saturated conductivity ms 1 the input parameters for the model can now be determined based on the required input for the equations flow requires only mannings surface roughness coefficient land use is therefore classified based on this parameter in contrast to flow infiltration requires four parameters saturated conductivity matric suction initial moisture and the saturation moisture level we choose to classify one of these saturated conductivity this maintains the simplicity and efficiency of the model the remaining parameters required for infiltration are obtained by averaging within the area of a class for saturated conductivity after parameter selection processes must be implemented there are several options to simulate a process the first option is to calculate fluxes for each combination of each parameter this increases computational costs but allows for more detailed description of behavior given different combinations of the physical parameters equation 15 15 i x i ksat j 0 c k 0 c i x i ksat x j slope x k land u s e where i x i ksat is the average infiltration for the area represented by class i of hydraulic conductivity in practice the increased computational cost coming from the double summation prevents efficient implementation of equation 14 the second option which is chosen in this work is to simulate a process only for each combination of relevant parameters for example in infiltration models slope is generally ignored since its value does not directly alter infiltration mishra et al 2003 thus infiltration can be simulated using the distribution of water over soil types and land use types equation 16 16 i x i ksat k 0 c i x i ksat x j slope x k land u s e afterwards the volume flux is known for land use and soil type classes additionally the volume flux is required for the remaining parameter the transformation rule in equation 5 can be used to obtain this an example of the implementation of infiltration is provided in fig 7 2 7 model input parameters the final model setup is shown in fig 8 the model requires a classification of slope land use and soil for land use manning s surface roughness coefficient is classified for soil the saturated conductivity is classified in addition soil classes are provided an average value for saturation soil moisture and matric suction thus the model requires spatial input for five physical parameters and a timeseries of precipitation table 1 an initial preparation step is required where a drainage network is calculated for the hru from this the d σ and d av are required as well as the inter slope probability values these calculations can be efficiently performed in a gis script as an initial calculation and do not need to be repeated for each simulation 3 model application in this section several applications of the proposed method will be shown a set of both hypothetical and real catchments are simulated and compared with results from fully spatially distributed simulations of overland flow and infiltration 3 1 numerical tests several catchments have been generated to test the proposed method generation was done using a fractal type branching tree with a variety of angles and skewness finally based on the distance from the tree network an elevation model as created using 10 m gridcells fig 9 physical parameters for the areas are homogeneous and set as k s ψ n θ i θ s 10 mm h 10 c m 0 1 0 4 0 5 for these areas we run a full spatial surface flow model openlisem using a kinematic wave flow approximation bout and jetten 2018 3 1 1 results the simulation results for the hypothetical catchments together with fully spatial kinematic wave simulations and used rainfall intensities are shown in fig 10 in general the proposed method captures outflow behavior similar to the full spatial simulations of the catchments the averaged performance of the model without calibration is r 2 0 47 while calibrated models typically reach higher values it is important to evaluate the performance in light of the relatively simple non spatial setup of the model additionally no calibration was performed the outputs thus indicate that the method can provide reasonable simulations of hydraulic response without the need for full spatial simulation additionally the shape and topography influences the outputs in a realistic manner hydrograph peak height width and shape are altered in ways similar to the full spatial flow model for several other aspects the proposed method lacks detail when compared to the fully spatial simulations in particular the sudden arrival shown by the third and fourth catchment is not captured well by the model part of the cause of this is the relatively small variance in distance to outlet which leads to a small wave where water arrives simultaneously though this type of behavior is estimated in the proposed method it is in these cases underestimated possibly due to the extreme catchment shapes for the first and second catchments the behavior difference due to the distribution of the distances to the outlet are significantly better predicted these types of catchment shapes are also more alike to naturally occurring watersheds 3 2 real study cases we apply the proposed method to two real catchments the danandou and prado areas fig 11 and fig 12 the first of these is the danandou catchment a rural area in the loess plateau in china which was previously used by hessel et al 2003 see also hessel et al 2003b hessel van asch 2003 and hessel and jetten 2007 to calibrate a previous version of the lisem model this 257 ha region is characterized by steep slopes 20 and dry non vegetated terrain for this catchment three precipitation events from 20 to 07 1999 23 08 1998 and 01 08 1998 will be used together with measured rainfall intensity discharge after these events is available for every two minutes the spatial resolution of this dataset is 10 m a second catchment in prado south eastern spain will be used this 50 km2 semi arid region is predominantly covered by dry shrubs and forest and has previously been used with lisem by baartmans et al 2013 see also baartmans et al 2012a baartmans et al 2012b both rainfall and discharge data are available for three rainfall events the spatial resolution of this dataset is 20 m calibration occurs by altering the values of the saturated conductivity and mannings surface roughness with a homogeneous multiplier the simulations were performed for a total of 100 combinations of input with the multipliers ranging between 0 5 and 1 5 model accuracy was assessed based on the nash sutcliffe model efficiency index 3 2 1 results the modelling results for three events together with measured rainfall and observed discharges are shown in fig 13 and table 2 simulation results show a reasonable capture of both the peak flow discharge and the timing of the hydrograph in several aspects the proposed method lacks detail when compared to the fully spatial simulations in particular the width of the hydrograph is not predicted accurately in each event such difficulties were similarly found with a full spatially distributed hydrological model hessel et al 2003b as proposed by these authors there are strong non linear effects induced by the abrupt initiation of runoff after saturation of the top soil layer this complicates the correct estimation of the initial flow moment additionally the terrain is rough with steep gullies and sloping farmlands this complicates accurately representing flow routing within a model as small and steep elevation patterns predominantly determine the hydrograph dynamics most notable to the found results is the accuracy which is comparable to these full spatial simulations while reducing the computational and data requirements significantly 3 3 comparison to rational method to further investigate the implications of the proposed method we apply a set of synthetic triangular rainfall events with increasing total rainfall depth to both the prado and danandau catchments the precipitation graph is constructed as a triangle with duration of one hour and peak rainfall intensity between 10 and 100 mm hour with increments of 10 mm hour this is then compared with results for peak flow from the rational method since the rational method split incoming precipitation into infiltration and runoff based on a constant runoff coefficient we employ this identical technique for the presented method for a consistent comparison we use the same runoff coefficient to simulate infiltration and storage in both methods which is set to be 0 3 typical value see thompson 2006 this value is chosen to indicate the difference between the models in typical scenarios and does not necessarily represent a calibrated parameter for the prado area the results are shown in fig 14 results from the simulations show the resulted increase in peak flow related to rainfall intensity in both models the rational method increases linearly the simplicity of this method results in an unrealistic increase in peak discharge with large rainfall values however usage of the method is common in engineering practice due to the simplicity of the method peak discharges for the presented methodology do not increase linearly instead the flow method provides a more physically based estimation of flow dynamics this includes the increase in flow velocity with increased water height because of this both the peak discharge timing of the peak and the shape of the hydrograph are altered this large observed differences can be explained by the assumption of steady state flow in the rational method steady states take significant amounts of time to occur in larger areas before this time has passed the rainfall intensity has changes or the event has passed altogether such as is the case in the simulations 3 4 sensitivity analysis finally a sensitivity analysis is performed to investigate the influence of parameter variability on outflow dynamics the first event for the prado catchment is simulated with limited parameter variability three additional simulations with averaged slope ksat and mannings n are performed respectively fig 15 the results are compared to the simulation with full parameter variability as is visible from fig 15 differences when using averaged parameter values are significant altering the peak total and timing of the discharge our semi spatial terrain description provides interactions between processes that would be seen in full spatial modelling and reality here this is exemplified by the changes in hydrograph shape resulting from altering a single parameters alterations in k sat alter flow height and therefore flow velocity and thus not only alter peak flow but timing as well we further show the behavior of the proposed methodology by performing a simple sensitivity analysis for the simulations on the danandou catchment here a triangular rainfall with an averaged intensity of 50 mm h is taken as input together with the reference infiltration capacity and manning s n values then both of these inputs are altered by a multiplier ranging between 0 15 and 1 5 the resulting hydrographs are shown in fig 16 the results from the sensitivity analysis show patterns highly similar to the results found in case of full spatial flow and infiltration modelling singh 1997 pokhrel and gupta 2011 the increase of mannings roughness coefficient decreased flow velocities and thereby delays and lowers the peak outflow value the delay is visible on the full hydrograph as resulting in a wider and lower shape for the saturated conductivity the total outflow volume is directly related to the value of the saturated conductivity of the soils while lower outflow delays flow velocities and thus delays the peak outflow time the effect is substantially less significant when compared to the delay from increased values of mannings n 4 future scope of the research the presented framework for multi parameter inter variable catchment hydrology can represent precipitation flow and infiltration in a semi spatial manner the implementation of physically based equations results in emergent behavior that captures real observations alteration of a single input parameter can have consequences for the full dynamics of the model through interactions in the equations and the distributions of water on the terrain such behavior is generally found in spatially distributed physically based models but lacks in non spatial empirical models the developed framework might with relative ease be extended with additional processes to provide a more complete description of full hydrology for ground water dynamics the flow scheme as used in surface flow can be adapted by using a depth averaged darcy approximation for a saturated ground water layer evapotranspiration could similarly be implemented for combinations of land use and soil type finally a surface storage component could be implemented to capture the storage of water in surface micro roughness several issues related to the application of the method remain to be investigated first the propagation of uncertainty in model input to model outcomes might be investigated input parameter uncertainty can complicate usage of model outcomes in decision making as results are less reliable ensemble simulations using the proposed method might be investigated to ensure uncertainties are not propagated unnaturally by either the flow scheme or the terrain description finally the multi parameter inter variable terrain description can be used to re distribute water into the original terrain while this could be used for additional modelling steps or visualization it has to be investigated to what extent this results in realistic outputs while the semi spatial terrain description describes the physical processes with good accuracy this does not necessarily guarantee the internal water distributions represent realistic behavior 5 conclusions we have proposed a new method for estimation of catchment hydrographs using non spatial physically based modelling our method utilizes a multi parameter inter variable statistical catchment description and distributes water over classified physical parameters then a semi spatial flow scheme is combined with a statistical distribution of the distance to outlet to calculate an effective probability of outflow for any water based on this and rainfall input a final hydrograph is simulated the method combines existing physically based equations for hydrology and flow with a novel semi spatial hru scheme infiltration can be included in a variety of manners such as using a runoff coefficient or the green and ampt model other processes that can theoretically be included are evapotranspiration leaf storage and erosion finally using a similar setup for semi spatial flow ground water movement could be estimated simulation and calibration results show the method performs well in predicting both uncalibrated and calibrated discharge in particular it is able to predict hydrograph peak flows and their time of occurrence with significant accuracy for both for real and hypothetical catchments the proposed method shows similar sensitivities to full spatial models and allows for calibration and validation the implementation of non averaged physical parameters add significant changes to the simulation output and allows for complex interactions in simulated physical processes the method could potentially be implemented in global hydrological simulations allowing for a full global physically based simulations of hydrology and related processes credit authorship contribution statement b bout conceptualization visualization formal analysis writing original draft v jetten conceptualization writing review editing declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper appendix a inter slope probability matrices for study areas a 1 hypothetical generated catchments their slope inter class probabilities and distance distribution a 2 study catchments their slope inter class probabilities and distance distribution 
5259,population growth and climate change have put pressure on policy makers in southwest western australia to increase water supply to urban areas a potential contribution to solving this problem is thinning of forested catchments to increase runoff this study uses a machine learning approach random forest to relate catchment annual runoff to a range of predictors including climate variables and catchment attributes and to estimate runoff increases from forest thinning this approach identifies important predictors and enables prediction the most important predictor is forestindex calculated from calibrated satellite imagery and providing a consistent surrogate measure of forest density this approach estimates annual runoff and carefully assesses potential model predictability by three modes of cross validation our approach leads to more accurate annual runoff predictions than linear regression and the fu s model e g reducing rmse by 41 and 63 respectively we provide an example to predict the change in annual runoff in response to forest reduction under certain rainfall scenarios the predicted runoff increase varies greatly amongst catchments from zero to 60 mm per 5 unit forestindex reduction keywords annual runoff forest thinning predictive model machine learning remote sensing forest index 1 introduction climate change continues to add more water management challenges in arid and semi arid regions already suffering from water scarcity southwest western australia swwa is one of the regions in australia where rainfall has undergone the greatest decline in recent years dey et al 2019 hope et al 2006 the catchments of the darling plateau of swwa supplying about 25 of perth metropolitan drinking water have experienced up to 70 runoff decline associated with a 15 20 rainfall reduction over the past 30 years petrone et al 2010 the trend towards a drying climate is projected to continue in swwa for the rest of the 21st century charles et al 2010 the water demand in perth has increased at an average rate of approximately 4 per year cumulative since 2000 department of water 2010 additional sources of water have to be found to cope with likely future water scarcity the catchments of the darling plateau of swwa are almost entirely native dry sclerophyllous forest with mixed jarrah eucalyptus marginata and marri corymbia calophylla one possible management option for increasing runoff is to reduce forest density in the water supply catchments water use by forest is a major component of the water balance in swwa catchments and the removal of forest from a catchment reduces interception and evaporation by vegetation reductions in forest cover have resulted in runoff increases from many experimental catchments for example in the usa bosch and hewlett 1982 italy callegari et al 2003 korea yang et al 2019 japan kuraji et al 2019 and spain fernandez et al 2006 neary 2016 provided a review of worldwide forest paired catchment studies for examining water yield response to forest disturbances in swwa silvicultural thinning is being actively considered and investigated in a major trial in the wungong catchment involving multiple state agencies coporation 2005 surface water supplies have increased after forest thinning at most of experimental catchments in swwa bari et al 1996 batini et al 1980 liu et al 2019 ruprecht et al 1991 ruprecht and stoneman 1993 stoneman 1993 stoneman and schofield 1989 the variability of runoff responses to forest activities is generally high across different years and different catchments as a result of high variability of rainfall pattern and catchment conditions bosch and hewlett 1982 davie and quinn 2019 ross et al 2019 comparative experimental studies are useful for assessing the hydrological effects of forest change by separating from climate variability and other factors hou et al 2018 one could apply a generalisation from broad experimental results to forward predictions in the catchments where paired catchment experiments are not available this generalisation generally subjects to large uncertainty due to uncontrolled climate variability and other factors to supplement field measurements it requires reliable predictive models to estimate runoff change prior to forest treatment alila and beckers 2001 dunne 2013 ziemer et al 1991 process based hydrological models are widely used to estimate the effect of forest change on runoff batini et al 1980 croton et al 2005 huff et al 2002 li et al 2012 stoneman and schofield 1989 zema et al 2020 zhou et al 2013 these models are usually driven by precipitation and potential evaporation consist of components representing physical processes e g surface flow groundwater recharge and evapotranspiration and simulate runoff dynamics from which flow characteristics such as amount duration and peak can be extracted the process based hydrological models may consider vegetation water use explicitly for example by using remotely sensed leaf area index lai as model inputs zhang and chiew 2009 or implicitly for example by relating model parameters to a vegetation cover index forest change results in change in model parameters and or model inputs which can be implemented into hydrological modelling to predict hydrological consequence of forest changes the process based hydrological models can estimate runoff at fine time resolutions but generally require a wide range of catchment information as well as long term monthly or even daily observations to calibrate model parameters li et al 2012 zhou et al 2013 as a result these models are restricted to apply to trial catchments with sufficient records a few highly conceptualized water balance models brown et al 2007 zhang et al 2001 zhang and chiew 2012 have been used as predictive models with annual observations as inputs alternatively statistical models have been used to estimate runoff in response to forest change in a number of previous studies the statistical models relate runoff to a number of catchment attributes including forest cover and climate variables on a large temporal scale e g annually therefore it can directly predict forest change impact on runoff once the statistical relationship is established stoneman and schofield 1989 derived a generic relationship between canopy cover and annual runoff from six high rainfall zone catchments in swwa by linear regression sahin and hall 1996 applied the fuzzy linear regression to evaluate the catchment annual runoff resulting from forest alterations for different forest types in these previous studies linear regression often served as a statistical tool to analyse data and establish a predictive model however linear regression always rests on a few assumptions for example underlying relationship is approximately linear and model residuals are approximately gaussian these assumptions sometimes are invalid and limit its applicability to explore hydrological disturbance in relation to complex rainfall characteristics and catchment conditions an attractive approach is to use so called regression trees for example see chapter 9 2 of hastie et al 2009 the basic idea of regression trees is that rather than assuming a particular functional relationship applies globally we seek to approximate the response predictor relationship locally by partitioning the data space into smaller regions a simple regression tree is easy to implement and interpret but tends to be very sensitive to training data even a slight change in training data could result a very different tree but with a similar fitted value breiman 1996 one solution to improve stability is to generate an ensemble of trees by sampling from training data with replacement and aggregating the results the aggregation of different trees also decreases the prediction error this ensemble technique is known as random forest breiman 2001 since many trees are grown randomly since parkhurst et al 2005 was the first to apply random forest in water resource sciences for the problem of water quality random forest has been used in various hydrological applications with more than 200 papers published tyralis et al 2019 some recent works include streamflow forecasting papacharalampous and tyralis 2018 water level prediction li et al 2016 streamflow simulation shortridge et al 2016 soil water potential kupers et al 2019 reference evapotranspiration estimation shiri 2018 and hydrological model regionalization saadi et al 2019 tyralis et al 2019 provided a review of random forest in hydrological applications in this paper we present a statistical model based on random forests to predict annual runoff from a number of catchment attributes and climate variables as predictors among these predictors we calculate a surrogate measure for forest density from remotely sensed data as a machine learning method random forest avoids the assumption of a global functional relationship instead adopting a local fitting approach based on recursive partitioning the use of random forest is also flexible with the distributional assumption of model residuals as a result random forest potentially but not necessarily has better predictive skill than linear regression in general random forest is more flexible than linear regression in terms of functional form and distribution assumptions however we need to keep in mind that there is a trade off between flexibility and interpretability for example see chapter 2 1 3 of james et al 2013 linear regression is more restrictive but more interpretable than random forest consequently linear regression has clear advantages when model interpretability is the first priority instead random forest is more suitable when model statistical performance is the first priority nevertheless some results from random forest can be physically interpretable for example variable selection of random forest ranks the relative importance of catchment attributes with respect to annual runoff and partial dependence plots further explore the dependence structure of each individual attribute we test the random forest on estimating annual runoff on 40 forest catchments in swwa and compare the predictive skill with linear regression and the fu s model fu 1981 zhang and chiew 2012 the predictive model is then applied to estimate the change in annual runoff in response to forest reduction under certain rainfall scenarios this paper is organised as follows a description of data and study region is given in section 2 the method used in this study is described in section 3 the results regarding model fitting potential predictability and scenario analysis are presented in section 4 finally discussion and conclusions are given in sections 5 and 6 respectively 2 study region and data 2 1 study region the darling plateau located at the south west corner of western australia is a large archaean and featureless plateau running north south 20 km inland from the coast with an average elevation of 300 m above sea level the climate is mediterranean with wet winters and hot dry summers winter rainfall accounts for approximately 80 of annual rainfall 900 1100 mm there is a distinct spatial gradient in rainfall declining progressively inland to the east and north we selected 40 catchments table 1 that are either completely forested or with a high proportion of forested area and with at least five complete years of runoff and rainfall data fig 1 shows the catchment boundaries and the relative location to an australian map the period of interest for the study is 1989 2007 2 2 runoff and rainfall data daily runoff data were recorded for the gauged catchments and were reported to the western australian department of water dow at the start of the day at 00 00 h the gauging locations and runoff records for all the gauged catchments were sourced from dow for this study as we perform statistical analysis at an annual scale daily runoff was averaged for each calendar year to obtain annual runoff the length and continuity of runoff record vary for different catchments few catchments have an uninterrupted record over the complete period of interest as the analysis relies on information from multiple years of data we retained only those catchments with at least five complete years of runoff and rainfall data as a result there are a total of 458 observation years selected from the 40 catchments due to the breaks in runoff records the number of catchments may be different for each year in the dataset for example runoff records are available at 40 catchments for 1995 but only at 12 catchments for 2005 and 2006 we obtain daily rainfall observations for the 40 catchments from the silo patched point dataset obtained free of charge from queensland government licensed under creative commons attribution 4 0 at https legacy longpaddock qld gov au silo we characterise the catchment rainfall runoff relationship by the annual runoff coefficient rc which is defined by the ratio of total catchment runoff to total rainfall in a calendar year rc is dimensionless and allows us to convert rainfall forecasts to runoff forecasts 2 3 remotely sensed data and forest index forestindex satellite remote sensing data have been used to monitor forest cover around the world for many applications boyd and danson 2005 holmgren and thuresson 1998 of particular interest in this study is the landsat satellite imagery collected and archived at the australian centre for remote sensing acres since 1988 the landsat thematic mapper tm imagery time series are available at 30 m resolution in 6 optical bands we use a simple spectral index derived from a calibrated annual late summer time series of landsat tm imagery we refer this index as to forestindex which is defined by 1 forestindex 255 landsat band 5 value landsat b and 3 value the combination of band5 value and band3 value is commonly used to identify in different stratification zones to derive the national forest presence absence classifications in australia lehmann et al 2013 forestindex is a dimensionless variable without any physical unit for convenience this study uses unit as an ad hoc unit for forestindex forestindex is positively associated with the level of forest cover the value of forestindex immediately reduces after the action of catchment thinning and increases with forest regrowth this index was used operationally in monitoring perennial vegetation growth in australia wallace et al 2006 since it is more sensitive to forest disturbance than many alternative indices such as ndvi normalised difference vegetation index and ndmi normalised difference moisture index lehmann et al 2013 for a particular year the target period for image acquisition is the summer january march preceding the rainfall period and we use the one imagery obtained from this period to derive the typical forest cover for this year in some cases cloud conditions damage imagery quality for some catchments where additional imageries such as the one from december in the preceding calendar year were used to fill the gap table 2 summarises the dates of landsat tm imagery used in the study to create an annual time series for the 19 year period of interest 2 4 other data the relationship between annual runoff and annual rainfall can be affected by many factors other than forest coverage for this reason we consider a set of 18 predictors including forestindex to predict annual runoff table 3 provides specific definitions of these predictors which can be grouped into two categories catchment attributes 6 predictors and climate variables 12 predictors locations easting and northing are considered in the category of catchment attributes though the change of annual runoff is not an immediate consequence of locations we use locations as a surrogate for location related catchment characteristics that are not otherwise measured in the data e g the type of forest and soil easting and northing are correlated with rainfall distance to the coast and also associated with temperature differences from north to south digital elevation data were processed based on the method described in caccetta 2000 and were used to calculate average slope avslp area area and flow path length fpl for the analysis in this study in the category of climate variables we considered rainfall and potential evaporation we summarise daily rainfall amounts to some annual rainfall statistics and use them in predictive models rather than rainfall amounts of each individual day these annual rainfall statistics represent total amounts total rainfall seasonal rainfall distributions amj rainfall mjj rainfall and aso rainfall rainfall variability std rainfall rain days wet frac and the presence of wet dry events wetevent amount wetevent period dryevent amount and dryevent period for each year total annuall rainfall in the previous year p1 were used to indicate catchment dryness at a particular year we did not consider any predictor variables directly derived from daily temperature such seasonal mean and standard deviation of daily temperature instead we chose to use mean annual potential evaporation pet to surrogate the impact of temperature to runoff in particular mean annual pet for the period 1980 1999 was obtained from a dataset of calculated annual potential evaporation published by the australian bureau of agriculture and resource economics and sciences abares available at https data gov au data dataset bd21cd71 4120 4924 9387 7cbf487a9ed3 potential evaporation was calculated by the priestley taylor method priestley and taylor 1972 at each 0 05 x 0 05 grid cell across australia 3 methods 3 1 predictive model based on random forest random forest is one of the most widely used ensemble tree methods which generate a collection of de correlated decision trees and aggregate their results random forest does not require any assumptions on the distribution of data random forest has been applied to the problem of both classification and regression in this study we use random forest as a regression method to form a predictive model on a continuous variable applied in this mode regression trees are fitted for many times to bootstrap samples and the results from each individual tree are averaged as the predicted value in a standard decision tree each node is split in a way that an objective function is optimised among all variables in a random forest each node is split in a way that an objective function is optimised among a subset of all variables which is randomly selected and is independent across different nodes many classical statistical methods including decision tree methods exhibit a tendency to overfit in a situation in which a large number of predictors are presented random forest keeps the likelihood of overfitting low by using bootstrap samples rather than an entire training set a brief description of this bootstrap approach is now given given a training set z of size n and p predictors the random forest algorithm for regression is as follows bootstrap sampling draw b random samples z of size n with replacement from the entire training set random forest tree growing grow an ensemble of b random forest trees based on bootstrap samples by repeating the following sub steps for each node until the minimum node size is reached select a subset of predictors of size m out of the complete predictor set of size p pick the best split predictor together with the best split value in the sense of minimising the mean square error from the subset of predictors selected at the last sub step split the node into two branches according to the best split predictor point selected at the last sub step ensemble averaging the average of observed value at terminal nodes from the ensemble of random forest trees is taken as the final predicted value it can be seen that there are two parameters m the number of predictors randomly selected from the entire set of predictors and b the number of trees grown in the forest used in the random forest algorithm we use r 3 6 1 r core team 2019 with randomforest 4 6 14 r package breiman et al 2018 to perform random forest modelling to predict annual runoff corresponding to forest change we use a two stage predictive model 1 random forest is used to establish the statistical relationship between annual runoff coefficient rc y to a set of explanatory predictors x 1 x d comprised a range of catchment attributes and climate variables 2 y f x 1 x d ε 2 we multiply the predicted rc y by the observed annual rainfall or predicted rainfall in real applications p to estimate annual runoff 3 q y p we choose an indirect option to model annual runoff coefficient y instead of annual runoff q which is a common practice used in many other studies jourdan et al 2019 peng et al 2019 firstly this option makes our predictive model more physically interpretable the hydrological community commonly believes that our explanatory predictors such as catchment attributes have a direct impact on the rainfall runoff relationship instead of total runoff in this study we conceptualize the annual rainfall runoff relationship by an annual runoff coefficient and our model actually predicts the dynamics of annual rainfall runoff relationship secondly annual total rainfall can dominate any direct model including linear regression and random forest of total runoff and oversee the impact of other predictors the indirect option attempts to separate the effect of total rainfall in the modelling process and highlights the contribution from catchment attributes and other climate variables 3 2 relative importance and variable selection random forest can be used to quantify and rank variable relative importance by the prediction accuracy on the so called out of bag oob samples i e training data not in bootstrap samples the oob samples are predicted and the prediction errors are recorded then the values of a particular variable are randomly permuted in the oob samples and the prediction errors are recorded again the total decrease of accuracy indicated by mean squared error mse averaging over all trees is used as the relative importance score the relative importance scores do not select predictors automatically because the number of predictors in the optimal set is unknown this has to be done via variable selection in this study a backward selection approach together with the variable importance ranking based on oob criterion is applied to select the most relevant predictors and to keep the model as parsimonious as possible the goodness of fit is measured by mse with respect to an estimated rc the score of mse based on oob instead of entire training data samples is calculated at each step and the minimum of mse indicates the best set of predictors suppose that there are d variables in the full set of predictors in particular we start with the model fitted with the entire d variables test the model fitting with the deletion of each variable and identify the optimum predictors with the minimum of mse on oob samples if d 1 variables are used the removed variable is the least significant variable out of d variables we continue by successively removing the least significant variable and refitting the model with all remaining predictors such a procedure is repeated for many times until only one predictor variable is left the backward selection gives a set of embedded predictive models with predictor size from d to 1 the minimum of mse on oob samples over all predictor sizes indicates the optimum combination of predictor variables diaz uriarte and de andres 2006 applied a similar stepwise variable selection strategy for random forest model in the context of classification tyralis et al 2019 provided an explanation with respect to the variable importance and variable selection for random forest the dependence of the model on each variable is further explored by means of partial dependence plots the dependence of the model on a particular variable is often affected by the values of the other predictors and cannot be displayed in a single plot a partial dependence plot visualizes the marginal dependence of rc on a variable after accounting for the average joint effect of the other predictors in the dataset 3 3 assessing model predictability by cross validation three different types of cross validation are carefully designed in this study to assess prediction accuracy of annual runoff from three different aspects they are described as follows 3 3 1 leave one observation out cross validation we precede the leave one observation out cross validation as follows the datum from one observation is removed and the predictive model established from the rest of observations the runoff at this particular observation is then estimated from this model using the predictors for the missing observation comparison with the observed runoff provides an estimate of predictive error this procedure is repeated for every observation in the entire dataset 458 observations and a small difference between the estimated and the observed runoff indicates an overall good prediction the leave one observation out cross validation evaluates the general prediction capability regardless of site and year effects thus both the within and between catchment information is assessed in this cross validation 3 3 2 leave one catchment out cross validation this procedure assesses the ability of the model to predict runoff in unknown catchments for which no data are available all data from one catchment are removed from the dataset and the runoff values for this particular catchment are predicted from the model established from the remaining catchments this procedure is repeated over all available 40 catchments this validation procedure explores the transferability of the predictive model from known catchments to others and particularly evaluates the value of the between catchments information 3 3 3 leave one year out cross validation the leave one year out cross validation is carried out to assess the model predictability in an unknown calendar year using the model fitted from the data of other years all observations from a particular year are removed from the dataset and the annual runoff across all catchments for this year is predicted from the model fitted from the observations in the other years the procedure is repeated over every available year from 1989 to 2006 this assessment is related to the expected accuracy in forward prediction for catchments with historical data the contribution of the within catchment information to prediction is generally indicated by this type of cross validation 3 4 comparison with two predictive models for comparison we apply two alternative predictive models to predict rc and therefore annual runoff in the same cross validation analysis the first alternative predictive model is linear regression which is used to estimate f in eq 2 together with the optimal set of the predictors selected by random forest in other words we assume that 4 f x 1 x d α 1 x 1 α d x d where α 1 α d are linear regression coefficients the comparison with linear regression demonstrates the advantage of random forest being a nonparametric model the second alternative predictive model is the one parameter fu s model fu 1981 zhang and chiew 2012 the one parameter fu s model a modification of the budyko curve budyko 1958 budyko 1974 assumes that the catchment water storage change is negligible in a long period of time and rc can be estimated as a function of the aridity index ai the ratio of mean annual potential evaporation to mean annual rainfall 5 rc 1 a i α 1 α a i where α 1 is a parameter that requires to be calibrated against observations we assume α is globally invariant for all observations regardless of forest change no explicit forest change is considered in the fu s model and the comparison with the fu s model highlights the importance of including forest cover in predicting rc we use an invariant α in this study to predict annual runoff which is taken as a reference to evaluate our proposed approach it is possible to implement time dependent or catchment dependent α into the fu s model to deal with forest change after some modifications of its model framework are done currently it is hard to apply time dependent or catchment dependent α into the fu s model for comparative leave one year out or leave one catchment out cross validations nevertheless the fu s model remains attractive for the catchments where specific catchment attributes are unknown two error statistics root mean square error rmse and bias of predicted annual runoff are used to quantify model performance throughout these three types of cross validation 4 results 4 1 model fitting we fit the predictive model based on random forest to all 458 observed runoff with the full set of 18 predictors defined in table 3 fig 2 summarises the relative importance of each variable described in section 3 2 by plotting the percentage reduction in prediction error on oob samples easting and forestindex are shown the two most important predictors and the prediction error i e mse is used in this study are reduced by 50 and 35 when randomly permuting the values of easting and forestindex respectively total rainfall from august to october aso rainfall is the least important with only less than 10 prediction accuracy reduction found the predictors relating dry wet events are proven relatively unimportant amongst the 18 predictors this may be explained by the fact that the presence of dry wet has significant impacts on the shape of hydrograph i e something related to timing and distribution of runoff events but tends to have less influence in annual total runoff in this study some predictors considered in the full predictor set are highly correlated for instance the correlation between amj and mjj rainfall is almost 0 8 we apply the backward variable selection described in section 3 2 to improve the potential model robustness mse at each step of the backward selection is shown in fig 3 which shares a similar pattern with the relative importance suggested by fig 2 despite the rankings of less important predictors being slightly different the optimal set of predictors in terms of the best predictive performance as measured by mse indicated by fig 3 comprises the following 10 predictors from most to least important easting forestindex northing area mjj rain wet frac pet total rainfall p1 and avslp it is noted that there are three predictors describing rainfall characteristics among the 10 predictor variables from the abovementioned backward selection total rainfall wet frac and mjj rainfall not surprisingly total rainfall in a calendar year total rainfall is the most important variable relating to rainfall summary the swwa is winter rainfall dominant and it is understandable that winter rainfall indicated by mjj rainfall provides valuable information on the intra annual variability of rainfall all predictors describing wet dry events are not significantly important in predicting rc fig 4 shows partial dependence plots for 10 important predictors and many of these plots can be easily interpreted tickmarks on horizontal axis of fig 4 indicate relative density of observations in the full dataset rc is shown to decline remarkably with easting from west to east in fig 4 a this is caused by several factors including strong rainfall gradient from west to east the spatial distribution of forest cover and soil type fig 4 b shows that higher forest cover indicated by forestindex is generally negatively associated with rc this is in accordance with our understanding that more forest cover leads to higher water consumption and less runoff the influence of northing fig 4 c is much more complicated and rc generally increased from north to south except for a pronounced peak occurring at around northing 6350000 this spike may be caused by a couple of outlier catchments catchment area fig 4 d has an important effect on variability of rc with larger variation in small catchments compared with larger catchments though not many observations are available for large catchments we pool the catchments from a range of sizes and the distribution of catchment area is highly skewed to right for example there are 15 catchments with area less than 1 km2 50 with area than 5 km2 but 15 with area greater than 150 km2 the partial dependence plot visualizes the relationship between area and predicted runoff coefficient at equally spaced points this makes fig 4 d cannot provide a full picture for smaller catchments e g 50 catchments with area less than 5 km2 and a sharp decrease is purely influenced by higgens catchment which is a tiny and ephemeral catchment 0 6 km2 and only transfers 8 of rainfall to runoff on average fig 1 in the supplemental material shows that small catchments are not necessarily dry but the variation of rc in small catchments is much higher than large ones this is consistent with the experimental evidence of pilgrim et al 1982 and xiao et al 2019 we do not observe a clear spatial pattern in sampled catchment size see fig 2 in the supplemental material and thus do not attempt to explain the large variation of rc for small catchments from location related factors such as climatology fig 4 d shows that rc can be a slowly decreasing function of catchment size for large catchments which is also found in ben asher et al 1985 from fig 4 h the rainfall runoff relationship is shown to be apparently nonlinear otherwise rc would be a constant with respect to rainfall higher annual rainfall results in higher rc both total rainfall fig 4 h and mjj rainfall fig 4 e have positive influence on rc this is consistent with that higher rainfall amounts may be caused by higher rainfall intensity and longer rainfall duration an increase in rainfall intensity increases the peak discharge and volume of runoff at a given infiltration rate and leads more surface runoff beyond the infiltration rate a longer rainfall event would reduce evaporation and plant transpiration and generate more runoff than a shorter rainfall event the appearance of lower and upper bounds of rc in fig 4 h is due to the artefact of model fitting with very limit samples in extremely wet and dry years for example there are only 4 observations i e 1 with 1500 mm annual rainfall and 6 observations i e 1 5 with 600 mm annual rainfall in case of small samples random forest tends to use a close to average prediction to avoid overfitting considering the range of predicted rc 0 11 0 15 is relatively small we do not attempt to over interpret this partial dependence plot especially at limited coarse samplings nevertheless the central tendency of rc decrease with of annual total rainfall supports the theory of precipitation elasticity of streamflow sankarasubramanian et al 2001 tang et al 2019 which means that the percentage reduction in rainfall is amplified in the percentage change in runoff rc generally decreases as pet increases shown by fig 4 g except for where pet is between 1400 and 1500 mm this may be explained by that a drier catchment tends to have a larger pe and is more likely to produce less water under the same other conditions from fig 4 f a large value of wet frac indicates a small value of rc and this may be explained by the fact that more rainy days yield more water p1 another predictor describing the catchment dryness through the previous one year rainfall clearly has a decreasing trend with rc in fig 4 i the low rainfall from the previous year results in a low groundwater level which requires more precipitation to replenish in the current rain season rc appears to increase with higher average slope avslp in fig 4 j when avslp is less than around 7 a steep slope indicated by a large value of avslp may lead to more runoff by accelerating the flow velocity and avoiding fluid pressure there are four catchments with avslp over 7 including salmon catchment 612011 falcon road 612012 pesconeris farm 611221 and mast view 612005 these four catchments are all located in the low relief darling range of swwa a regional deep groundwater system generates substantial subsurface runoff and makes surface runoff coefficients relatively small for example at salmon catchment williamson et al 1987 estimated that surface runoff only accounted for 4 annual streamflow but subsurface runoff accounted for 90 4 2 potential predictability to assess model potential predictability we have carried out three different types of cross validation analyses described in section 3 3 fig 5 presents the scatterplot of predicted and observed annual runoff from the leave one observation out cross validation it is clear that random forest performs extremely well all predicted and observed runoff are close to each other the points from linear regression are clearly more scattered around the line of 1 1 error statistics both rmse and bias calculated from linear regression are much greater than those from random forest for example random forest reduces rmse by 41 and 63 for linear regression and the fu s model the linear regression tends to overestimate the runoff for dry observations observed runoff 100 mm but underestimate the runoff for relatively wet observations observed runoff 100 mm the raw predicted rc from linear regression and corresponding annual runoff is negative for a few observations and is not physically meaningful this is caused by the fact that linear regression does not restrict the range of predicted values in this study we force all predicted negative runoff to be zero but large errors are still observed for these predictions in contrast random forest naturally confines the predicted values into a reasonable range this outperformance of random forest in the leave one observation out cross validation indicates that random forest is able to capture the non linear relationships between rc and predictors with sufficient data linear regression restricts the relationship and shows limited potential predictability the fu s model leads to the least accuracy indicated by the greatest rmse though had no clear overall bias the fu s model nearly had no skills for relatively wet observations because no explicit forest change is considered in this study when the fu s model is applied fig 6 compares the predictive performance in the leave one catchment out cross validation random forest is the best model to predict the runoff if only the between catchment information is available compared to the leave one observation out cross validation linear regression cross validation particularly loses some skills in predicting annual runoff for some dry catchments the results from the fu s model are relatively robust to different modes of cross validation because only one parameter is required to estimate by comparing figs 5 and 6 we can see that the error statistics from the leave one catchment out cross validation are clearly larger than those from the leave one observation out cross validation this indicates the within catchment information is generally more important for predicting rc and is hardly substituted by the between catchment information it can be found that there are some large underprediction of runoff for the wettest catchments i e with the largest runoff values from a statistical point of view this underprediction is mainly caused by the issue of regression toward the mean which means that there is a statistical tendency for regression to issue a prediction closer to the mean for extreme predictors small sample size and data sampling of training dataset makes regression toward the mean even worse for the leave one catchment out cross validation than the leave one observation out cross validation and the leave one year out cross validation please see more discussion in section 5 fig 7 compares the different predictive models in the leave one year out cross validation similar to the other two cross validations the predicted annual runoff from random forest matches the observed values much better than those from linear regression and the fu s model a small overestimation mainly for dry observations is found for random forest in this mode of cross validation the loss of the within catchment information does not affect the predictive performance for linear regression which leads to similar error statistics to the leave one observation out and leave one year out cross validation 4 3 runoff predictions under thinning scenarios the predictive model based on random forest can be applied to estimate rc and further annual runoff for catchments under different scenarios of rainfall and forest density by varying the input predictors forest density is the only predictor variable which can be affected and altered by active management such as forest thinning thus scenario predictions of the effects of forest thinning on runoff are particularly relevant to policy making we have chosen the year 1995 to examine the predicted effects of forest thinning for all catchments using the 1995 historical rainfall data it should be noted that this is an example for demonstration only and that different thinning and rainfall scenarios could be examined using the model the year 1995 is chosen as all of the 40 catchments have complete rainfall and runoff records the annual rainfall in 1995 across the 40 catchments ranges from 682 mm to 1283 mm with a mean of 1040 mm we apply the predictive model estimated from the entire dataset to simulate the annual runoff in 1995 under the following four scenarios of forest thinning forestindex reduction of 5 10 15 and 20 unit from the measured values in 1995 preliminary analysis suggests a change in 20 unit is equivalent to a change of about 60 to 75 of forest cover reductions of 5 20 unit in forestindex are within the range of historic forest changes as a measure of the effect on runoff for these different levels of thinning we report the predicted change of runoff mm per 5 unit reduction in forestindex i e the difference between the predicted runoff after forestindex reduction and the observed runoff denoted by δrunoff fig 8 summarises the range and variation of predicted δrunoff under thinning scenarios by boxplots the predicted impact of forest thinning on runoff varies greatly between catchments from zero to 60 mm with the first 5 unit reduction producing the widest range and the greatest variability in δrunoff at higher levels of forestindex reduction this range reduces the average of δrunoff is about 10 mm for all four levels of forestindex reduction table 4 presents five catchments with the greatest δrunoff for different thinning scenarios there are some clear overlaps amongst the top five catchments with most δrunoff for different scenarios and these catchments can be chosen as potential catchments for forest thinning total rainfall in these top five catchments in table 4 is higher than the average across different catchment i e 1040 mm for small forest reduction e g reducing forestindex by 5 and 10 unit the top five catchments tend to be smaller catchments which are more sensitive fig 9 presents the spatial pattern of δrunoff for individual catchments to forestindex reduction levels the larger δrunoff is generally predicted for catchments in the west of the study region but there is a high variability this could be partly explained by interactions of forest thinning with higher mean annual rainfall for the catchments close to the coast fig 10 presents the relationship between mean annual rainfall and δrunoff as seen in fig 10 more runoff increases are observed in wet catchments than in dry catchments this suggests that forest thinning is better carried out at wet catchments for more water yield though more runoff increases are predicted for more forest reductions the relationship between runoff increases and forest reduction is not linear and the marginal effect of forest reductions on the runoff increase is reduced the runoff increase is more predictable at higher levels of forestindex reduction 5 discussion 5 1 forestindex with biophysical ground measured parameters the relationship of forest biophysical parameters and forestindex is of obvious interest the satellite derived index provides consistent repeated data which is measured everywhere while quantitative ground measurements of forest are rare and typically restricted in area canopy cover and leaf area index lai are frequently used forest measures while forest management prescriptions are usually based on basal area measured as square metres per hectare regression has frequently been used to examine relationships of spectral indices and ground measurements an example can be found in boer et al 2008 who measured lai for 26 sites in the northern jarrah forest and examined a range of landsat derived indices boer et al 2008 reported that the correlation of forestindex and lai is 0 85 and a change in forestindex of 10 unit can be taken as indicative of a change in lai of around 0 4 0 5 in this type of forest a further example is provided by the operational forest thinning carried out in cobiac catchment in 2007 2008 basal area measurements prior and post thinning treatment are recorded as 34 m2 ha and 18 m2 ha respectively this change of 16 m2 ha is associated with a change of approximately 25 unit in the forestindex in addition to these indicative relationships between forestindex and measured biophysical parameters further collaborative work is being done for a subsequent project to calibrate the observed forestindex variable and its changes to ground measured forest biophysical parameters and forest management actions 5 2 applicability of newly obtained water for urban use many catchments in this study are considered as water supply catchments which are connected to water supply reservoirs for perth such as canning dam wungong dam and harvey dam which provides 10 water supply for perth metropolitan area stoneman and schofield 1989 reported that of the 127 million m3 year 1 increased runoff from forest thinning in the perth water supply catchments only 48 million m3 year 1 would be harnessed for urban consumption and the utilization rate would be higher for the catchments in the high rainfall zone by generalizing their results we would estimate more than half of newly obtained runoff from forest reduction would be available for urban water consumption one of the limitations of our study is that we only estimate the impact of forest cover change on catchment runoff at an annual time scale both runoff and the demand of water supply for urban use are highly seasonal in particular water use in perth is higher in summer and lower in winter but the seasonal pattern of runoff is the opposite due to winter rainfall as a result the newly obtained water resource is often not immediately available when it is most needed in the hot months and may suffer from significant evaporation loss for months when it flows to reservoirs that is one of the factors that stoneman and schofield 1989 discounted the predicted runoff increase for water supply use further research is needed to investigate the applicability of newly obtained runoff from thinned catchments to urban use 5 3 impact of forest thinning on water cycle forest cover change actually impacts the whole water cycle where evapotranspiration is a major component in the swwa region evapotranspiration accounts for 90 of the annual rainfall sharma 1984 and about 75 80 of the annual rainfall is transpired by trees williamson et al 1987 there is substantial consensus that a reduction of forest cover reduces evapotranspiration bosch and hewlett 1982 stednick 1996 in a case study in the usa roche et al 2018 estimated the evapotranspiration change due to forest treatment and wildfire by remote sensing measurements they found that intensive thing by reducing 40 50 basal area results 21 27 reduction of forest evapotranspiration the predictive model developed in this study together with a water balance model may be served as an indirect method to estimate evapotranspiration in response to forest change it is a very interesting topic but is out of scope of this study 5 4 relevant to prediction in ungauged catchments the predictive model based on the random forest suggests that further investigation of catchment and climate attributes would be useful in developing modelling that can be applied to ungauged catchments this is the so called prediction in ungauged basins pub problem see hrachowitz et al 2013 for a comprehensive review which has been a major problem in hydrological community for decades the leave one catchment out cross validation demonstrates the potential usefulness of random forests and satellite derived index to regionalize the rainfall runoff relationship to ungauged catchments the use of location related variables i e easting and northing is primarily based on pragmatic considerations although many previous studies have used spatial information to regionalize the rainfall runoff relationship by for example geostatistical approaches farmer et al 2019 vandewiele and elias 1995 to our best knowledge location is seldom used as explicit covariates in traditional solutions for pub problem except for some very recent machine learning based study zhang et al 2018 location does not have casual effect on catchment hydrological behaviour but is correlated with some important but unavailable catchment characteristics especially for a small study region hengl et al 2018 provided a more general framework of including spatial coordinates as explanatory variables to incorporate geographical proximity in random forest prediction to further evaluate the added value from location variables to prediction skill we repeat the leave one catchment out cross validation which is most relevant to pub the exclusion of easting and northing from predictor variables lead to the increase of the rmse of predicted runoff by 28 from 52 1 mm fig 6 to 67 mm we do not intend to generalize the use of location variables for pub as many researches aim to improve our understanding of hydrological response in relation to physical attributes instead of focusing on prediction performance only fig 11 presents a variable importance plot in the absence of easting and northing we have two interesting findings 1 forestindex becomes the most important predictor followed by pet and 2 the least important seven predictors remain same regardless of order this relative importance after omitting geographical coordinates is indeed more useful for us to understand the contribution of each predictor to predicting rc 5 5 the problem of regression to mean we use random forest in the context of regression and our predictive model is inevitably imperfect regression to mean occurs fig 6 shows more significant underprediction because a smaller sample size of training data makes regression toward the mean becomes more profound for leave one observation out cross validation we have 457 observations in the training dataset i e 99 8 of the entire dataset while we can only have 440 observations in the training dataset i e 96 of the entire dataset for the leave one catchment out cross validation the difference between figs 6 and 7 is mainly related to data sampling in the training dataset the leave one catchment out cross validation removes all observations from one catchment and data sampling is less random than the leave one year out cross validation which raises more problem of regression toward the mean from a hydrological point of view the generalization of predictive models from one catchment to another assumes that the hydrological response to forest cover and climate variables are similar for different catchments in the study the transfer of our predictive model from dry average catchments to very wet catchments tends to make less wetter predictions 5 6 impact of multicollinearity the optimal set of predictors includes some highly correlated variables for example the correlation between northing and pet is 0 92 commonly known as multicollinearity in statistics the impact of such multicollinearity on regression models depends on the purpose of study if model interpretation is of interest multicollinearity poses a potential problem for example a coefficient of linear regression can be explained by the mean change of a dependent variable resulted from a unit change of a predictor in the presence of multicollinearity we cannot fix a predictor while holding other predictors constant this makes the linear regression coefficient more difficult to interpret in this case however if main purpose is model prediction multicollinearity is not an issue multicollinearity does not violate any assumptions on linear regression or random forest but only means those highly correlated variables do not have added on information to improve prediction accuracy in fact multicollinearity is sometimes beneficial to lead to simpler and more robust model in the presence of noise random forest has been used to deal with multicollinearity in many studies boulesteix et al 2012 ziegler and konig 2014 5 7 rationale behind better potential predictability of random forest model in section 4 2 we perform three modes of cross validation and find that random forest model leads to better potential predictability than two comparative models the rationale behind better potential predictability of random forest model can be explained as follows when comparing with linear regression random forest is more flexible to capture a functional form beyond linear the partial dependence plots in fig 4 clearly show that the relationship between rc and our predictors is more complex than linear therefore linear regression becomes ineffective for predicting rc and annual runoff instead random forest can fit the predictive model in a non linear form and its flexibility leads to better performance than linear regression when comparing with the fu s model random forecast takes an advantage of using information as much as possible such as forest change as mentioned in section 3 4 the fu s model used in this study does not take most of catchment attributes and climate variables including forest change into account therefore the fu s model issues predictions with only minimum information which however can be served as a reference to assess the relative merits of using big data and machine learning techniques to improve runoff prediction 6 conclusions a novel approach has been presented for estimating annual runoff in response to forest change by using random forest a predictive model is established to estimate the statistical relationship between the annual runoff coefficient and a set of predictors describing catchment and climatic conditions this method is applied to 458 historical observations from 40 forest catchments in swwa the backward variable selection identifies the satellite derived forest density variable forestindex to be one of the most important predictors in predicting annual runoff coefficient partial dependence plots are very informative for understanding the relationship between the runoff coefficient and 10 predictors considered to be significantly important by variable selection the proposed predictive model compares favourably with linear regression and the fu s model from three different types of cross validation for example random forest reduces rmse by 41 and 63 for linear regression and the fu s model in the leave one observation out cross validation we provide an example to predict the change in annual runoff in response to forest reduction under certain rainfall scenarios the predicted runoff increase varies greatly amongst catchments from zero to 60 mm per 5 unit forestindex reduction credit authorship contribution statement ming li conceptualization methodology software writing original draft writing review editing yongqiang zhang conceptualization jeremy wallace supervision data curation eddy campbell supervision project administration declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgement the authors gratefully acknowledge the western australia department of water for providing rainfall and runoff data this research was supported by a western australia water foundation grant and the csiro water for a healthy country flagship the second author acknowledges the support by the cas talents program and the national natural science foundation of china grant no 41971032 the dataset used in this study is available upon request from ming li ming li csiro au we are grateful to three anonymous reviewers and the editor for providing constructive comments and suggestions appendix a supplementary data supplementary data to this article can be found online at https doi org 10 1016 j jhydrol 2020 125168 appendix a supplementary data the following are the supplementary data to this article supplementary data 1 supplementary data 2 
5259,population growth and climate change have put pressure on policy makers in southwest western australia to increase water supply to urban areas a potential contribution to solving this problem is thinning of forested catchments to increase runoff this study uses a machine learning approach random forest to relate catchment annual runoff to a range of predictors including climate variables and catchment attributes and to estimate runoff increases from forest thinning this approach identifies important predictors and enables prediction the most important predictor is forestindex calculated from calibrated satellite imagery and providing a consistent surrogate measure of forest density this approach estimates annual runoff and carefully assesses potential model predictability by three modes of cross validation our approach leads to more accurate annual runoff predictions than linear regression and the fu s model e g reducing rmse by 41 and 63 respectively we provide an example to predict the change in annual runoff in response to forest reduction under certain rainfall scenarios the predicted runoff increase varies greatly amongst catchments from zero to 60 mm per 5 unit forestindex reduction keywords annual runoff forest thinning predictive model machine learning remote sensing forest index 1 introduction climate change continues to add more water management challenges in arid and semi arid regions already suffering from water scarcity southwest western australia swwa is one of the regions in australia where rainfall has undergone the greatest decline in recent years dey et al 2019 hope et al 2006 the catchments of the darling plateau of swwa supplying about 25 of perth metropolitan drinking water have experienced up to 70 runoff decline associated with a 15 20 rainfall reduction over the past 30 years petrone et al 2010 the trend towards a drying climate is projected to continue in swwa for the rest of the 21st century charles et al 2010 the water demand in perth has increased at an average rate of approximately 4 per year cumulative since 2000 department of water 2010 additional sources of water have to be found to cope with likely future water scarcity the catchments of the darling plateau of swwa are almost entirely native dry sclerophyllous forest with mixed jarrah eucalyptus marginata and marri corymbia calophylla one possible management option for increasing runoff is to reduce forest density in the water supply catchments water use by forest is a major component of the water balance in swwa catchments and the removal of forest from a catchment reduces interception and evaporation by vegetation reductions in forest cover have resulted in runoff increases from many experimental catchments for example in the usa bosch and hewlett 1982 italy callegari et al 2003 korea yang et al 2019 japan kuraji et al 2019 and spain fernandez et al 2006 neary 2016 provided a review of worldwide forest paired catchment studies for examining water yield response to forest disturbances in swwa silvicultural thinning is being actively considered and investigated in a major trial in the wungong catchment involving multiple state agencies coporation 2005 surface water supplies have increased after forest thinning at most of experimental catchments in swwa bari et al 1996 batini et al 1980 liu et al 2019 ruprecht et al 1991 ruprecht and stoneman 1993 stoneman 1993 stoneman and schofield 1989 the variability of runoff responses to forest activities is generally high across different years and different catchments as a result of high variability of rainfall pattern and catchment conditions bosch and hewlett 1982 davie and quinn 2019 ross et al 2019 comparative experimental studies are useful for assessing the hydrological effects of forest change by separating from climate variability and other factors hou et al 2018 one could apply a generalisation from broad experimental results to forward predictions in the catchments where paired catchment experiments are not available this generalisation generally subjects to large uncertainty due to uncontrolled climate variability and other factors to supplement field measurements it requires reliable predictive models to estimate runoff change prior to forest treatment alila and beckers 2001 dunne 2013 ziemer et al 1991 process based hydrological models are widely used to estimate the effect of forest change on runoff batini et al 1980 croton et al 2005 huff et al 2002 li et al 2012 stoneman and schofield 1989 zema et al 2020 zhou et al 2013 these models are usually driven by precipitation and potential evaporation consist of components representing physical processes e g surface flow groundwater recharge and evapotranspiration and simulate runoff dynamics from which flow characteristics such as amount duration and peak can be extracted the process based hydrological models may consider vegetation water use explicitly for example by using remotely sensed leaf area index lai as model inputs zhang and chiew 2009 or implicitly for example by relating model parameters to a vegetation cover index forest change results in change in model parameters and or model inputs which can be implemented into hydrological modelling to predict hydrological consequence of forest changes the process based hydrological models can estimate runoff at fine time resolutions but generally require a wide range of catchment information as well as long term monthly or even daily observations to calibrate model parameters li et al 2012 zhou et al 2013 as a result these models are restricted to apply to trial catchments with sufficient records a few highly conceptualized water balance models brown et al 2007 zhang et al 2001 zhang and chiew 2012 have been used as predictive models with annual observations as inputs alternatively statistical models have been used to estimate runoff in response to forest change in a number of previous studies the statistical models relate runoff to a number of catchment attributes including forest cover and climate variables on a large temporal scale e g annually therefore it can directly predict forest change impact on runoff once the statistical relationship is established stoneman and schofield 1989 derived a generic relationship between canopy cover and annual runoff from six high rainfall zone catchments in swwa by linear regression sahin and hall 1996 applied the fuzzy linear regression to evaluate the catchment annual runoff resulting from forest alterations for different forest types in these previous studies linear regression often served as a statistical tool to analyse data and establish a predictive model however linear regression always rests on a few assumptions for example underlying relationship is approximately linear and model residuals are approximately gaussian these assumptions sometimes are invalid and limit its applicability to explore hydrological disturbance in relation to complex rainfall characteristics and catchment conditions an attractive approach is to use so called regression trees for example see chapter 9 2 of hastie et al 2009 the basic idea of regression trees is that rather than assuming a particular functional relationship applies globally we seek to approximate the response predictor relationship locally by partitioning the data space into smaller regions a simple regression tree is easy to implement and interpret but tends to be very sensitive to training data even a slight change in training data could result a very different tree but with a similar fitted value breiman 1996 one solution to improve stability is to generate an ensemble of trees by sampling from training data with replacement and aggregating the results the aggregation of different trees also decreases the prediction error this ensemble technique is known as random forest breiman 2001 since many trees are grown randomly since parkhurst et al 2005 was the first to apply random forest in water resource sciences for the problem of water quality random forest has been used in various hydrological applications with more than 200 papers published tyralis et al 2019 some recent works include streamflow forecasting papacharalampous and tyralis 2018 water level prediction li et al 2016 streamflow simulation shortridge et al 2016 soil water potential kupers et al 2019 reference evapotranspiration estimation shiri 2018 and hydrological model regionalization saadi et al 2019 tyralis et al 2019 provided a review of random forest in hydrological applications in this paper we present a statistical model based on random forests to predict annual runoff from a number of catchment attributes and climate variables as predictors among these predictors we calculate a surrogate measure for forest density from remotely sensed data as a machine learning method random forest avoids the assumption of a global functional relationship instead adopting a local fitting approach based on recursive partitioning the use of random forest is also flexible with the distributional assumption of model residuals as a result random forest potentially but not necessarily has better predictive skill than linear regression in general random forest is more flexible than linear regression in terms of functional form and distribution assumptions however we need to keep in mind that there is a trade off between flexibility and interpretability for example see chapter 2 1 3 of james et al 2013 linear regression is more restrictive but more interpretable than random forest consequently linear regression has clear advantages when model interpretability is the first priority instead random forest is more suitable when model statistical performance is the first priority nevertheless some results from random forest can be physically interpretable for example variable selection of random forest ranks the relative importance of catchment attributes with respect to annual runoff and partial dependence plots further explore the dependence structure of each individual attribute we test the random forest on estimating annual runoff on 40 forest catchments in swwa and compare the predictive skill with linear regression and the fu s model fu 1981 zhang and chiew 2012 the predictive model is then applied to estimate the change in annual runoff in response to forest reduction under certain rainfall scenarios this paper is organised as follows a description of data and study region is given in section 2 the method used in this study is described in section 3 the results regarding model fitting potential predictability and scenario analysis are presented in section 4 finally discussion and conclusions are given in sections 5 and 6 respectively 2 study region and data 2 1 study region the darling plateau located at the south west corner of western australia is a large archaean and featureless plateau running north south 20 km inland from the coast with an average elevation of 300 m above sea level the climate is mediterranean with wet winters and hot dry summers winter rainfall accounts for approximately 80 of annual rainfall 900 1100 mm there is a distinct spatial gradient in rainfall declining progressively inland to the east and north we selected 40 catchments table 1 that are either completely forested or with a high proportion of forested area and with at least five complete years of runoff and rainfall data fig 1 shows the catchment boundaries and the relative location to an australian map the period of interest for the study is 1989 2007 2 2 runoff and rainfall data daily runoff data were recorded for the gauged catchments and were reported to the western australian department of water dow at the start of the day at 00 00 h the gauging locations and runoff records for all the gauged catchments were sourced from dow for this study as we perform statistical analysis at an annual scale daily runoff was averaged for each calendar year to obtain annual runoff the length and continuity of runoff record vary for different catchments few catchments have an uninterrupted record over the complete period of interest as the analysis relies on information from multiple years of data we retained only those catchments with at least five complete years of runoff and rainfall data as a result there are a total of 458 observation years selected from the 40 catchments due to the breaks in runoff records the number of catchments may be different for each year in the dataset for example runoff records are available at 40 catchments for 1995 but only at 12 catchments for 2005 and 2006 we obtain daily rainfall observations for the 40 catchments from the silo patched point dataset obtained free of charge from queensland government licensed under creative commons attribution 4 0 at https legacy longpaddock qld gov au silo we characterise the catchment rainfall runoff relationship by the annual runoff coefficient rc which is defined by the ratio of total catchment runoff to total rainfall in a calendar year rc is dimensionless and allows us to convert rainfall forecasts to runoff forecasts 2 3 remotely sensed data and forest index forestindex satellite remote sensing data have been used to monitor forest cover around the world for many applications boyd and danson 2005 holmgren and thuresson 1998 of particular interest in this study is the landsat satellite imagery collected and archived at the australian centre for remote sensing acres since 1988 the landsat thematic mapper tm imagery time series are available at 30 m resolution in 6 optical bands we use a simple spectral index derived from a calibrated annual late summer time series of landsat tm imagery we refer this index as to forestindex which is defined by 1 forestindex 255 landsat band 5 value landsat b and 3 value the combination of band5 value and band3 value is commonly used to identify in different stratification zones to derive the national forest presence absence classifications in australia lehmann et al 2013 forestindex is a dimensionless variable without any physical unit for convenience this study uses unit as an ad hoc unit for forestindex forestindex is positively associated with the level of forest cover the value of forestindex immediately reduces after the action of catchment thinning and increases with forest regrowth this index was used operationally in monitoring perennial vegetation growth in australia wallace et al 2006 since it is more sensitive to forest disturbance than many alternative indices such as ndvi normalised difference vegetation index and ndmi normalised difference moisture index lehmann et al 2013 for a particular year the target period for image acquisition is the summer january march preceding the rainfall period and we use the one imagery obtained from this period to derive the typical forest cover for this year in some cases cloud conditions damage imagery quality for some catchments where additional imageries such as the one from december in the preceding calendar year were used to fill the gap table 2 summarises the dates of landsat tm imagery used in the study to create an annual time series for the 19 year period of interest 2 4 other data the relationship between annual runoff and annual rainfall can be affected by many factors other than forest coverage for this reason we consider a set of 18 predictors including forestindex to predict annual runoff table 3 provides specific definitions of these predictors which can be grouped into two categories catchment attributes 6 predictors and climate variables 12 predictors locations easting and northing are considered in the category of catchment attributes though the change of annual runoff is not an immediate consequence of locations we use locations as a surrogate for location related catchment characteristics that are not otherwise measured in the data e g the type of forest and soil easting and northing are correlated with rainfall distance to the coast and also associated with temperature differences from north to south digital elevation data were processed based on the method described in caccetta 2000 and were used to calculate average slope avslp area area and flow path length fpl for the analysis in this study in the category of climate variables we considered rainfall and potential evaporation we summarise daily rainfall amounts to some annual rainfall statistics and use them in predictive models rather than rainfall amounts of each individual day these annual rainfall statistics represent total amounts total rainfall seasonal rainfall distributions amj rainfall mjj rainfall and aso rainfall rainfall variability std rainfall rain days wet frac and the presence of wet dry events wetevent amount wetevent period dryevent amount and dryevent period for each year total annuall rainfall in the previous year p1 were used to indicate catchment dryness at a particular year we did not consider any predictor variables directly derived from daily temperature such seasonal mean and standard deviation of daily temperature instead we chose to use mean annual potential evaporation pet to surrogate the impact of temperature to runoff in particular mean annual pet for the period 1980 1999 was obtained from a dataset of calculated annual potential evaporation published by the australian bureau of agriculture and resource economics and sciences abares available at https data gov au data dataset bd21cd71 4120 4924 9387 7cbf487a9ed3 potential evaporation was calculated by the priestley taylor method priestley and taylor 1972 at each 0 05 x 0 05 grid cell across australia 3 methods 3 1 predictive model based on random forest random forest is one of the most widely used ensemble tree methods which generate a collection of de correlated decision trees and aggregate their results random forest does not require any assumptions on the distribution of data random forest has been applied to the problem of both classification and regression in this study we use random forest as a regression method to form a predictive model on a continuous variable applied in this mode regression trees are fitted for many times to bootstrap samples and the results from each individual tree are averaged as the predicted value in a standard decision tree each node is split in a way that an objective function is optimised among all variables in a random forest each node is split in a way that an objective function is optimised among a subset of all variables which is randomly selected and is independent across different nodes many classical statistical methods including decision tree methods exhibit a tendency to overfit in a situation in which a large number of predictors are presented random forest keeps the likelihood of overfitting low by using bootstrap samples rather than an entire training set a brief description of this bootstrap approach is now given given a training set z of size n and p predictors the random forest algorithm for regression is as follows bootstrap sampling draw b random samples z of size n with replacement from the entire training set random forest tree growing grow an ensemble of b random forest trees based on bootstrap samples by repeating the following sub steps for each node until the minimum node size is reached select a subset of predictors of size m out of the complete predictor set of size p pick the best split predictor together with the best split value in the sense of minimising the mean square error from the subset of predictors selected at the last sub step split the node into two branches according to the best split predictor point selected at the last sub step ensemble averaging the average of observed value at terminal nodes from the ensemble of random forest trees is taken as the final predicted value it can be seen that there are two parameters m the number of predictors randomly selected from the entire set of predictors and b the number of trees grown in the forest used in the random forest algorithm we use r 3 6 1 r core team 2019 with randomforest 4 6 14 r package breiman et al 2018 to perform random forest modelling to predict annual runoff corresponding to forest change we use a two stage predictive model 1 random forest is used to establish the statistical relationship between annual runoff coefficient rc y to a set of explanatory predictors x 1 x d comprised a range of catchment attributes and climate variables 2 y f x 1 x d ε 2 we multiply the predicted rc y by the observed annual rainfall or predicted rainfall in real applications p to estimate annual runoff 3 q y p we choose an indirect option to model annual runoff coefficient y instead of annual runoff q which is a common practice used in many other studies jourdan et al 2019 peng et al 2019 firstly this option makes our predictive model more physically interpretable the hydrological community commonly believes that our explanatory predictors such as catchment attributes have a direct impact on the rainfall runoff relationship instead of total runoff in this study we conceptualize the annual rainfall runoff relationship by an annual runoff coefficient and our model actually predicts the dynamics of annual rainfall runoff relationship secondly annual total rainfall can dominate any direct model including linear regression and random forest of total runoff and oversee the impact of other predictors the indirect option attempts to separate the effect of total rainfall in the modelling process and highlights the contribution from catchment attributes and other climate variables 3 2 relative importance and variable selection random forest can be used to quantify and rank variable relative importance by the prediction accuracy on the so called out of bag oob samples i e training data not in bootstrap samples the oob samples are predicted and the prediction errors are recorded then the values of a particular variable are randomly permuted in the oob samples and the prediction errors are recorded again the total decrease of accuracy indicated by mean squared error mse averaging over all trees is used as the relative importance score the relative importance scores do not select predictors automatically because the number of predictors in the optimal set is unknown this has to be done via variable selection in this study a backward selection approach together with the variable importance ranking based on oob criterion is applied to select the most relevant predictors and to keep the model as parsimonious as possible the goodness of fit is measured by mse with respect to an estimated rc the score of mse based on oob instead of entire training data samples is calculated at each step and the minimum of mse indicates the best set of predictors suppose that there are d variables in the full set of predictors in particular we start with the model fitted with the entire d variables test the model fitting with the deletion of each variable and identify the optimum predictors with the minimum of mse on oob samples if d 1 variables are used the removed variable is the least significant variable out of d variables we continue by successively removing the least significant variable and refitting the model with all remaining predictors such a procedure is repeated for many times until only one predictor variable is left the backward selection gives a set of embedded predictive models with predictor size from d to 1 the minimum of mse on oob samples over all predictor sizes indicates the optimum combination of predictor variables diaz uriarte and de andres 2006 applied a similar stepwise variable selection strategy for random forest model in the context of classification tyralis et al 2019 provided an explanation with respect to the variable importance and variable selection for random forest the dependence of the model on each variable is further explored by means of partial dependence plots the dependence of the model on a particular variable is often affected by the values of the other predictors and cannot be displayed in a single plot a partial dependence plot visualizes the marginal dependence of rc on a variable after accounting for the average joint effect of the other predictors in the dataset 3 3 assessing model predictability by cross validation three different types of cross validation are carefully designed in this study to assess prediction accuracy of annual runoff from three different aspects they are described as follows 3 3 1 leave one observation out cross validation we precede the leave one observation out cross validation as follows the datum from one observation is removed and the predictive model established from the rest of observations the runoff at this particular observation is then estimated from this model using the predictors for the missing observation comparison with the observed runoff provides an estimate of predictive error this procedure is repeated for every observation in the entire dataset 458 observations and a small difference between the estimated and the observed runoff indicates an overall good prediction the leave one observation out cross validation evaluates the general prediction capability regardless of site and year effects thus both the within and between catchment information is assessed in this cross validation 3 3 2 leave one catchment out cross validation this procedure assesses the ability of the model to predict runoff in unknown catchments for which no data are available all data from one catchment are removed from the dataset and the runoff values for this particular catchment are predicted from the model established from the remaining catchments this procedure is repeated over all available 40 catchments this validation procedure explores the transferability of the predictive model from known catchments to others and particularly evaluates the value of the between catchments information 3 3 3 leave one year out cross validation the leave one year out cross validation is carried out to assess the model predictability in an unknown calendar year using the model fitted from the data of other years all observations from a particular year are removed from the dataset and the annual runoff across all catchments for this year is predicted from the model fitted from the observations in the other years the procedure is repeated over every available year from 1989 to 2006 this assessment is related to the expected accuracy in forward prediction for catchments with historical data the contribution of the within catchment information to prediction is generally indicated by this type of cross validation 3 4 comparison with two predictive models for comparison we apply two alternative predictive models to predict rc and therefore annual runoff in the same cross validation analysis the first alternative predictive model is linear regression which is used to estimate f in eq 2 together with the optimal set of the predictors selected by random forest in other words we assume that 4 f x 1 x d α 1 x 1 α d x d where α 1 α d are linear regression coefficients the comparison with linear regression demonstrates the advantage of random forest being a nonparametric model the second alternative predictive model is the one parameter fu s model fu 1981 zhang and chiew 2012 the one parameter fu s model a modification of the budyko curve budyko 1958 budyko 1974 assumes that the catchment water storage change is negligible in a long period of time and rc can be estimated as a function of the aridity index ai the ratio of mean annual potential evaporation to mean annual rainfall 5 rc 1 a i α 1 α a i where α 1 is a parameter that requires to be calibrated against observations we assume α is globally invariant for all observations regardless of forest change no explicit forest change is considered in the fu s model and the comparison with the fu s model highlights the importance of including forest cover in predicting rc we use an invariant α in this study to predict annual runoff which is taken as a reference to evaluate our proposed approach it is possible to implement time dependent or catchment dependent α into the fu s model to deal with forest change after some modifications of its model framework are done currently it is hard to apply time dependent or catchment dependent α into the fu s model for comparative leave one year out or leave one catchment out cross validations nevertheless the fu s model remains attractive for the catchments where specific catchment attributes are unknown two error statistics root mean square error rmse and bias of predicted annual runoff are used to quantify model performance throughout these three types of cross validation 4 results 4 1 model fitting we fit the predictive model based on random forest to all 458 observed runoff with the full set of 18 predictors defined in table 3 fig 2 summarises the relative importance of each variable described in section 3 2 by plotting the percentage reduction in prediction error on oob samples easting and forestindex are shown the two most important predictors and the prediction error i e mse is used in this study are reduced by 50 and 35 when randomly permuting the values of easting and forestindex respectively total rainfall from august to october aso rainfall is the least important with only less than 10 prediction accuracy reduction found the predictors relating dry wet events are proven relatively unimportant amongst the 18 predictors this may be explained by the fact that the presence of dry wet has significant impacts on the shape of hydrograph i e something related to timing and distribution of runoff events but tends to have less influence in annual total runoff in this study some predictors considered in the full predictor set are highly correlated for instance the correlation between amj and mjj rainfall is almost 0 8 we apply the backward variable selection described in section 3 2 to improve the potential model robustness mse at each step of the backward selection is shown in fig 3 which shares a similar pattern with the relative importance suggested by fig 2 despite the rankings of less important predictors being slightly different the optimal set of predictors in terms of the best predictive performance as measured by mse indicated by fig 3 comprises the following 10 predictors from most to least important easting forestindex northing area mjj rain wet frac pet total rainfall p1 and avslp it is noted that there are three predictors describing rainfall characteristics among the 10 predictor variables from the abovementioned backward selection total rainfall wet frac and mjj rainfall not surprisingly total rainfall in a calendar year total rainfall is the most important variable relating to rainfall summary the swwa is winter rainfall dominant and it is understandable that winter rainfall indicated by mjj rainfall provides valuable information on the intra annual variability of rainfall all predictors describing wet dry events are not significantly important in predicting rc fig 4 shows partial dependence plots for 10 important predictors and many of these plots can be easily interpreted tickmarks on horizontal axis of fig 4 indicate relative density of observations in the full dataset rc is shown to decline remarkably with easting from west to east in fig 4 a this is caused by several factors including strong rainfall gradient from west to east the spatial distribution of forest cover and soil type fig 4 b shows that higher forest cover indicated by forestindex is generally negatively associated with rc this is in accordance with our understanding that more forest cover leads to higher water consumption and less runoff the influence of northing fig 4 c is much more complicated and rc generally increased from north to south except for a pronounced peak occurring at around northing 6350000 this spike may be caused by a couple of outlier catchments catchment area fig 4 d has an important effect on variability of rc with larger variation in small catchments compared with larger catchments though not many observations are available for large catchments we pool the catchments from a range of sizes and the distribution of catchment area is highly skewed to right for example there are 15 catchments with area less than 1 km2 50 with area than 5 km2 but 15 with area greater than 150 km2 the partial dependence plot visualizes the relationship between area and predicted runoff coefficient at equally spaced points this makes fig 4 d cannot provide a full picture for smaller catchments e g 50 catchments with area less than 5 km2 and a sharp decrease is purely influenced by higgens catchment which is a tiny and ephemeral catchment 0 6 km2 and only transfers 8 of rainfall to runoff on average fig 1 in the supplemental material shows that small catchments are not necessarily dry but the variation of rc in small catchments is much higher than large ones this is consistent with the experimental evidence of pilgrim et al 1982 and xiao et al 2019 we do not observe a clear spatial pattern in sampled catchment size see fig 2 in the supplemental material and thus do not attempt to explain the large variation of rc for small catchments from location related factors such as climatology fig 4 d shows that rc can be a slowly decreasing function of catchment size for large catchments which is also found in ben asher et al 1985 from fig 4 h the rainfall runoff relationship is shown to be apparently nonlinear otherwise rc would be a constant with respect to rainfall higher annual rainfall results in higher rc both total rainfall fig 4 h and mjj rainfall fig 4 e have positive influence on rc this is consistent with that higher rainfall amounts may be caused by higher rainfall intensity and longer rainfall duration an increase in rainfall intensity increases the peak discharge and volume of runoff at a given infiltration rate and leads more surface runoff beyond the infiltration rate a longer rainfall event would reduce evaporation and plant transpiration and generate more runoff than a shorter rainfall event the appearance of lower and upper bounds of rc in fig 4 h is due to the artefact of model fitting with very limit samples in extremely wet and dry years for example there are only 4 observations i e 1 with 1500 mm annual rainfall and 6 observations i e 1 5 with 600 mm annual rainfall in case of small samples random forest tends to use a close to average prediction to avoid overfitting considering the range of predicted rc 0 11 0 15 is relatively small we do not attempt to over interpret this partial dependence plot especially at limited coarse samplings nevertheless the central tendency of rc decrease with of annual total rainfall supports the theory of precipitation elasticity of streamflow sankarasubramanian et al 2001 tang et al 2019 which means that the percentage reduction in rainfall is amplified in the percentage change in runoff rc generally decreases as pet increases shown by fig 4 g except for where pet is between 1400 and 1500 mm this may be explained by that a drier catchment tends to have a larger pe and is more likely to produce less water under the same other conditions from fig 4 f a large value of wet frac indicates a small value of rc and this may be explained by the fact that more rainy days yield more water p1 another predictor describing the catchment dryness through the previous one year rainfall clearly has a decreasing trend with rc in fig 4 i the low rainfall from the previous year results in a low groundwater level which requires more precipitation to replenish in the current rain season rc appears to increase with higher average slope avslp in fig 4 j when avslp is less than around 7 a steep slope indicated by a large value of avslp may lead to more runoff by accelerating the flow velocity and avoiding fluid pressure there are four catchments with avslp over 7 including salmon catchment 612011 falcon road 612012 pesconeris farm 611221 and mast view 612005 these four catchments are all located in the low relief darling range of swwa a regional deep groundwater system generates substantial subsurface runoff and makes surface runoff coefficients relatively small for example at salmon catchment williamson et al 1987 estimated that surface runoff only accounted for 4 annual streamflow but subsurface runoff accounted for 90 4 2 potential predictability to assess model potential predictability we have carried out three different types of cross validation analyses described in section 3 3 fig 5 presents the scatterplot of predicted and observed annual runoff from the leave one observation out cross validation it is clear that random forest performs extremely well all predicted and observed runoff are close to each other the points from linear regression are clearly more scattered around the line of 1 1 error statistics both rmse and bias calculated from linear regression are much greater than those from random forest for example random forest reduces rmse by 41 and 63 for linear regression and the fu s model the linear regression tends to overestimate the runoff for dry observations observed runoff 100 mm but underestimate the runoff for relatively wet observations observed runoff 100 mm the raw predicted rc from linear regression and corresponding annual runoff is negative for a few observations and is not physically meaningful this is caused by the fact that linear regression does not restrict the range of predicted values in this study we force all predicted negative runoff to be zero but large errors are still observed for these predictions in contrast random forest naturally confines the predicted values into a reasonable range this outperformance of random forest in the leave one observation out cross validation indicates that random forest is able to capture the non linear relationships between rc and predictors with sufficient data linear regression restricts the relationship and shows limited potential predictability the fu s model leads to the least accuracy indicated by the greatest rmse though had no clear overall bias the fu s model nearly had no skills for relatively wet observations because no explicit forest change is considered in this study when the fu s model is applied fig 6 compares the predictive performance in the leave one catchment out cross validation random forest is the best model to predict the runoff if only the between catchment information is available compared to the leave one observation out cross validation linear regression cross validation particularly loses some skills in predicting annual runoff for some dry catchments the results from the fu s model are relatively robust to different modes of cross validation because only one parameter is required to estimate by comparing figs 5 and 6 we can see that the error statistics from the leave one catchment out cross validation are clearly larger than those from the leave one observation out cross validation this indicates the within catchment information is generally more important for predicting rc and is hardly substituted by the between catchment information it can be found that there are some large underprediction of runoff for the wettest catchments i e with the largest runoff values from a statistical point of view this underprediction is mainly caused by the issue of regression toward the mean which means that there is a statistical tendency for regression to issue a prediction closer to the mean for extreme predictors small sample size and data sampling of training dataset makes regression toward the mean even worse for the leave one catchment out cross validation than the leave one observation out cross validation and the leave one year out cross validation please see more discussion in section 5 fig 7 compares the different predictive models in the leave one year out cross validation similar to the other two cross validations the predicted annual runoff from random forest matches the observed values much better than those from linear regression and the fu s model a small overestimation mainly for dry observations is found for random forest in this mode of cross validation the loss of the within catchment information does not affect the predictive performance for linear regression which leads to similar error statistics to the leave one observation out and leave one year out cross validation 4 3 runoff predictions under thinning scenarios the predictive model based on random forest can be applied to estimate rc and further annual runoff for catchments under different scenarios of rainfall and forest density by varying the input predictors forest density is the only predictor variable which can be affected and altered by active management such as forest thinning thus scenario predictions of the effects of forest thinning on runoff are particularly relevant to policy making we have chosen the year 1995 to examine the predicted effects of forest thinning for all catchments using the 1995 historical rainfall data it should be noted that this is an example for demonstration only and that different thinning and rainfall scenarios could be examined using the model the year 1995 is chosen as all of the 40 catchments have complete rainfall and runoff records the annual rainfall in 1995 across the 40 catchments ranges from 682 mm to 1283 mm with a mean of 1040 mm we apply the predictive model estimated from the entire dataset to simulate the annual runoff in 1995 under the following four scenarios of forest thinning forestindex reduction of 5 10 15 and 20 unit from the measured values in 1995 preliminary analysis suggests a change in 20 unit is equivalent to a change of about 60 to 75 of forest cover reductions of 5 20 unit in forestindex are within the range of historic forest changes as a measure of the effect on runoff for these different levels of thinning we report the predicted change of runoff mm per 5 unit reduction in forestindex i e the difference between the predicted runoff after forestindex reduction and the observed runoff denoted by δrunoff fig 8 summarises the range and variation of predicted δrunoff under thinning scenarios by boxplots the predicted impact of forest thinning on runoff varies greatly between catchments from zero to 60 mm with the first 5 unit reduction producing the widest range and the greatest variability in δrunoff at higher levels of forestindex reduction this range reduces the average of δrunoff is about 10 mm for all four levels of forestindex reduction table 4 presents five catchments with the greatest δrunoff for different thinning scenarios there are some clear overlaps amongst the top five catchments with most δrunoff for different scenarios and these catchments can be chosen as potential catchments for forest thinning total rainfall in these top five catchments in table 4 is higher than the average across different catchment i e 1040 mm for small forest reduction e g reducing forestindex by 5 and 10 unit the top five catchments tend to be smaller catchments which are more sensitive fig 9 presents the spatial pattern of δrunoff for individual catchments to forestindex reduction levels the larger δrunoff is generally predicted for catchments in the west of the study region but there is a high variability this could be partly explained by interactions of forest thinning with higher mean annual rainfall for the catchments close to the coast fig 10 presents the relationship between mean annual rainfall and δrunoff as seen in fig 10 more runoff increases are observed in wet catchments than in dry catchments this suggests that forest thinning is better carried out at wet catchments for more water yield though more runoff increases are predicted for more forest reductions the relationship between runoff increases and forest reduction is not linear and the marginal effect of forest reductions on the runoff increase is reduced the runoff increase is more predictable at higher levels of forestindex reduction 5 discussion 5 1 forestindex with biophysical ground measured parameters the relationship of forest biophysical parameters and forestindex is of obvious interest the satellite derived index provides consistent repeated data which is measured everywhere while quantitative ground measurements of forest are rare and typically restricted in area canopy cover and leaf area index lai are frequently used forest measures while forest management prescriptions are usually based on basal area measured as square metres per hectare regression has frequently been used to examine relationships of spectral indices and ground measurements an example can be found in boer et al 2008 who measured lai for 26 sites in the northern jarrah forest and examined a range of landsat derived indices boer et al 2008 reported that the correlation of forestindex and lai is 0 85 and a change in forestindex of 10 unit can be taken as indicative of a change in lai of around 0 4 0 5 in this type of forest a further example is provided by the operational forest thinning carried out in cobiac catchment in 2007 2008 basal area measurements prior and post thinning treatment are recorded as 34 m2 ha and 18 m2 ha respectively this change of 16 m2 ha is associated with a change of approximately 25 unit in the forestindex in addition to these indicative relationships between forestindex and measured biophysical parameters further collaborative work is being done for a subsequent project to calibrate the observed forestindex variable and its changes to ground measured forest biophysical parameters and forest management actions 5 2 applicability of newly obtained water for urban use many catchments in this study are considered as water supply catchments which are connected to water supply reservoirs for perth such as canning dam wungong dam and harvey dam which provides 10 water supply for perth metropolitan area stoneman and schofield 1989 reported that of the 127 million m3 year 1 increased runoff from forest thinning in the perth water supply catchments only 48 million m3 year 1 would be harnessed for urban consumption and the utilization rate would be higher for the catchments in the high rainfall zone by generalizing their results we would estimate more than half of newly obtained runoff from forest reduction would be available for urban water consumption one of the limitations of our study is that we only estimate the impact of forest cover change on catchment runoff at an annual time scale both runoff and the demand of water supply for urban use are highly seasonal in particular water use in perth is higher in summer and lower in winter but the seasonal pattern of runoff is the opposite due to winter rainfall as a result the newly obtained water resource is often not immediately available when it is most needed in the hot months and may suffer from significant evaporation loss for months when it flows to reservoirs that is one of the factors that stoneman and schofield 1989 discounted the predicted runoff increase for water supply use further research is needed to investigate the applicability of newly obtained runoff from thinned catchments to urban use 5 3 impact of forest thinning on water cycle forest cover change actually impacts the whole water cycle where evapotranspiration is a major component in the swwa region evapotranspiration accounts for 90 of the annual rainfall sharma 1984 and about 75 80 of the annual rainfall is transpired by trees williamson et al 1987 there is substantial consensus that a reduction of forest cover reduces evapotranspiration bosch and hewlett 1982 stednick 1996 in a case study in the usa roche et al 2018 estimated the evapotranspiration change due to forest treatment and wildfire by remote sensing measurements they found that intensive thing by reducing 40 50 basal area results 21 27 reduction of forest evapotranspiration the predictive model developed in this study together with a water balance model may be served as an indirect method to estimate evapotranspiration in response to forest change it is a very interesting topic but is out of scope of this study 5 4 relevant to prediction in ungauged catchments the predictive model based on the random forest suggests that further investigation of catchment and climate attributes would be useful in developing modelling that can be applied to ungauged catchments this is the so called prediction in ungauged basins pub problem see hrachowitz et al 2013 for a comprehensive review which has been a major problem in hydrological community for decades the leave one catchment out cross validation demonstrates the potential usefulness of random forests and satellite derived index to regionalize the rainfall runoff relationship to ungauged catchments the use of location related variables i e easting and northing is primarily based on pragmatic considerations although many previous studies have used spatial information to regionalize the rainfall runoff relationship by for example geostatistical approaches farmer et al 2019 vandewiele and elias 1995 to our best knowledge location is seldom used as explicit covariates in traditional solutions for pub problem except for some very recent machine learning based study zhang et al 2018 location does not have casual effect on catchment hydrological behaviour but is correlated with some important but unavailable catchment characteristics especially for a small study region hengl et al 2018 provided a more general framework of including spatial coordinates as explanatory variables to incorporate geographical proximity in random forest prediction to further evaluate the added value from location variables to prediction skill we repeat the leave one catchment out cross validation which is most relevant to pub the exclusion of easting and northing from predictor variables lead to the increase of the rmse of predicted runoff by 28 from 52 1 mm fig 6 to 67 mm we do not intend to generalize the use of location variables for pub as many researches aim to improve our understanding of hydrological response in relation to physical attributes instead of focusing on prediction performance only fig 11 presents a variable importance plot in the absence of easting and northing we have two interesting findings 1 forestindex becomes the most important predictor followed by pet and 2 the least important seven predictors remain same regardless of order this relative importance after omitting geographical coordinates is indeed more useful for us to understand the contribution of each predictor to predicting rc 5 5 the problem of regression to mean we use random forest in the context of regression and our predictive model is inevitably imperfect regression to mean occurs fig 6 shows more significant underprediction because a smaller sample size of training data makes regression toward the mean becomes more profound for leave one observation out cross validation we have 457 observations in the training dataset i e 99 8 of the entire dataset while we can only have 440 observations in the training dataset i e 96 of the entire dataset for the leave one catchment out cross validation the difference between figs 6 and 7 is mainly related to data sampling in the training dataset the leave one catchment out cross validation removes all observations from one catchment and data sampling is less random than the leave one year out cross validation which raises more problem of regression toward the mean from a hydrological point of view the generalization of predictive models from one catchment to another assumes that the hydrological response to forest cover and climate variables are similar for different catchments in the study the transfer of our predictive model from dry average catchments to very wet catchments tends to make less wetter predictions 5 6 impact of multicollinearity the optimal set of predictors includes some highly correlated variables for example the correlation between northing and pet is 0 92 commonly known as multicollinearity in statistics the impact of such multicollinearity on regression models depends on the purpose of study if model interpretation is of interest multicollinearity poses a potential problem for example a coefficient of linear regression can be explained by the mean change of a dependent variable resulted from a unit change of a predictor in the presence of multicollinearity we cannot fix a predictor while holding other predictors constant this makes the linear regression coefficient more difficult to interpret in this case however if main purpose is model prediction multicollinearity is not an issue multicollinearity does not violate any assumptions on linear regression or random forest but only means those highly correlated variables do not have added on information to improve prediction accuracy in fact multicollinearity is sometimes beneficial to lead to simpler and more robust model in the presence of noise random forest has been used to deal with multicollinearity in many studies boulesteix et al 2012 ziegler and konig 2014 5 7 rationale behind better potential predictability of random forest model in section 4 2 we perform three modes of cross validation and find that random forest model leads to better potential predictability than two comparative models the rationale behind better potential predictability of random forest model can be explained as follows when comparing with linear regression random forest is more flexible to capture a functional form beyond linear the partial dependence plots in fig 4 clearly show that the relationship between rc and our predictors is more complex than linear therefore linear regression becomes ineffective for predicting rc and annual runoff instead random forest can fit the predictive model in a non linear form and its flexibility leads to better performance than linear regression when comparing with the fu s model random forecast takes an advantage of using information as much as possible such as forest change as mentioned in section 3 4 the fu s model used in this study does not take most of catchment attributes and climate variables including forest change into account therefore the fu s model issues predictions with only minimum information which however can be served as a reference to assess the relative merits of using big data and machine learning techniques to improve runoff prediction 6 conclusions a novel approach has been presented for estimating annual runoff in response to forest change by using random forest a predictive model is established to estimate the statistical relationship between the annual runoff coefficient and a set of predictors describing catchment and climatic conditions this method is applied to 458 historical observations from 40 forest catchments in swwa the backward variable selection identifies the satellite derived forest density variable forestindex to be one of the most important predictors in predicting annual runoff coefficient partial dependence plots are very informative for understanding the relationship between the runoff coefficient and 10 predictors considered to be significantly important by variable selection the proposed predictive model compares favourably with linear regression and the fu s model from three different types of cross validation for example random forest reduces rmse by 41 and 63 for linear regression and the fu s model in the leave one observation out cross validation we provide an example to predict the change in annual runoff in response to forest reduction under certain rainfall scenarios the predicted runoff increase varies greatly amongst catchments from zero to 60 mm per 5 unit forestindex reduction credit authorship contribution statement ming li conceptualization methodology software writing original draft writing review editing yongqiang zhang conceptualization jeremy wallace supervision data curation eddy campbell supervision project administration declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgement the authors gratefully acknowledge the western australia department of water for providing rainfall and runoff data this research was supported by a western australia water foundation grant and the csiro water for a healthy country flagship the second author acknowledges the support by the cas talents program and the national natural science foundation of china grant no 41971032 the dataset used in this study is available upon request from ming li ming li csiro au we are grateful to three anonymous reviewers and the editor for providing constructive comments and suggestions appendix a supplementary data supplementary data to this article can be found online at https doi org 10 1016 j jhydrol 2020 125168 appendix a supplementary data the following are the supplementary data to this article supplementary data 1 supplementary data 2 
