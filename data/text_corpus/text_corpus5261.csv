index,text
26305,in flat environments groundwater is relatively shallow tightly associated with surface water and climate and can have either positive and negative impacts on natural and human systems depending on its depth a linked modelling and analysis framework that seeks to capture linkages across multiple scales at the climate water crop nexus in the argentine pampas is presented this region shows a strong coupling between climate soil water and land use due to its extremely flat topography and poorly developed drainage networks the work describes the components of the framework and subsequently presents results from simulations performed with the twin goals of i validating the framework as a whole and ii demonstrating its usefulness to explore interesting contexts such as unexperienced climate scenarios wet dry periods hypothetical policies e g differential grains export taxes and adoption of non structural technologies e g cover crops to manage water table depth keywords natural human systems mike she agent based model agriculture water table risk management abbreviations sab salado a basin wtd water table depth pm pampas model pi productivity index dssat decision support system for agrotechnology transfer lai leaf area index rd root depth srtm shuttle radar topographic mission inta national agricultural technology institute argentina smn national meteorological service argentina software availability name of software pampas model developers santiago l rovere federico schmidt guillermo p podestá guillermo a garcía pablo e garcía and federico e bert contact information santiago l rovere srovere gmail com hardware required high end computer i7 processor or similar 16 32 gb ram and virtualization capability software required repast simphony 2 4 java 7 mysql server 5 7 and mysql connector j r 3 4 and additional libraries for running pampas model mike she 2012 windows 7 8 10 openssh server is also required programming languages java 7 r 3 4 visual c license all software is open source except mike she 2012 users who want to run mike she must purchase a license https www dhigroup com 1 introduction throughout history water and agriculture have been closely linked kirsten 2010 smith et al 2010 water for food production currently exceeds all other water needs rosegrant et al 2009 most of the global food production comes from rainfed agriculture where soil water availability depends almost exclusively on precipitation de fraiture and wichelns 2010 rainfed agriculture holds the potential to increase food production and reduce irrigation needs but remains particularly vulnerable to risks associated with a shifting climate de fraiture and wichelns 2010 the region of central eastern argentina known as the pampas is one of the most important rainfed grain producing areas in the world calviño and monzon 2009 hall et al 1992 most of the pampas has an extremely flat topography with regional slopes lower than 0 1 jobbágy et al 2008 in such flat environments groundwater is tightly coupled to surface water and plays a key role on the functionality of the ecosystem low topographic gradients and poorly developed drainage networks constrain horizontal evacuation of excess water in turn leading to shallow water tables 1 1 the water table is defined as the top of the water saturated zone or phreatic zone in the soil profile fan et al 2013 shallow water tables generally less than 3 5 m deep can affect and reciprocally be affected by the annual field crops and pastures or natural grasslands that dominate land use in the pampas nosetto et al 2009 2015 agricultural production systems in the pampas and the associated use of land and water have undergone profound changes in recent decades barsky and gelman 2009 satorre 2011 these changes were propelled by complex interactions among i favorable economic contexts tied to higher global demand for animal protein and increasingly biofuels lamers et al 2008 rulli et al 2016 ii cost reducing technological innovations such as no tillage cropping and glyphosate resistant varieties of soybean caviglia and andrade 2010 qaim and traxler 2005 and iii marked inter decadal variability in precipitation berbery et al 2006 castañeda and barros 1994 with a steady increase in annual rainfall particularly in spring summer since the 1970s haylock et al 2006 rusticucci and penalba 2000 vargas et al 2002 because of interactions among all these drivers field crops have expanded throughout the pampas displacing grasslands and pastures manuel navarrete et al 2009 viglizzo et al 2011 the observed shift from mixed crop cattle systems to continuous agriculture has influenced the dynamics of surface and groundwater in the pampas as crops occupy a field only during a few months per year and often have shallower roots they consume less water than pastures or grasslands annually nosetto et al 2012 2015 moreover no tillage cropping a widely adopted practice in the pampas trigo et al 2009 leaves the soil undisturbed and covered with stubble possibly reducing soil evaporation increasing infiltration and reducing runoff sinclair et al 2007 consequently lower evapotranspiration from land use change together with increased rainfall have contributed to increase groundwater recharge favoring the rise of water tables contreras et al 2011 viglizzo et al 2009 as water table dynamics control the formation and expansion of free standing water bodies aragón et al 2011 kruse et al 2001 scarpati et al 2002 there is an active debate in argentine society about the links between land use changes and a perceived increase in the frequency and magnitude of flooding events with important social and economic impacts kuppel et al 2015 this work aims to contribute science based evidence to the ongoing debate our goal is to explore the couplings interdependencies lags and feedbacks between i surface and groundwater ii plausible climate scenarios e g wet or dry periods and iii agricultural production systems in the pampas towards that goal we have implemented a modelling and analysis framework that seeks to capture linkages across multiple scales at the climate water crop nexus in the pampas this paper describes the components of the framework and subsequently use it as a controlled experimental environment to explore the impacts of various climate and land use scenarios 1 1 the study area the study focuses on the salado a basin sab fig 1 located in the northwestern portion of the salado basin in central eastern argentina forte lay et al 2007 this region provides a unique environment to simulate and study linkages between climate water and agricultural decision making because of i the strong coupling between climate variability surface and groundwater in its flat sedimentary landscape and ii observed land use changes that together with marked climate fluctuations on multiple time scales modulate groundwater recharge water table depth wtd and flood frequency the sab encompasses approximately 6 9 million ha 69 000 km2 extending about 330 km east west and 360 km north south the sab is a sedimentary basin where soils have developed on loessic materials of loamy to sandy loam textures and are predominantly hapludolls hall et al 1992 the sab has very flat topography and poorly developed drainage networks that constrain horizontal flows of both surface and groundwater viglizzo et al 2009 the climate of the sab is characterized as temperate sub humid hall et al 1992 with mean annual rainfall decreasing westward from 1000 to 800 mm and a mean annual potential evapotranspiration of ca 1100 mm although the sab is considered to have an isohigrous regime the colder part of the year is relatively drier as two thirds of annual precipitation occur during the austral spring and summer october march mean daily air temperature ranges from 8 to 10 c during winter to 22 24 c in summer smn 2017 as with most of the pampas sab production systems moved from low input cattle crop rotations to a predominantly agricultural system with more intensive use of external inputs technology and management viglizzo et al 2001 the sab area allocated to annual grain crops increased from 40 to 50 since the 1960s viglizzo et al 2011 and wheat was replaced by full cycle soybean as the prevailing crop agroindustria 2016 since colonial times the salado basin has shown alternating floods and droughts that displace populations and disrupt productive activities and livelihoods for extended periods floods were frequent during the late 19th and early 20th centuries a relatively wet period in contrast extensive droughts were more frequent during the drier 1930s 1950s herzer 2003 seager et al 2010 partly in response to rainfall increases since the 1970s severe floods have occurred in the salado basin in 1980 1991 93 and 2000 01 herzer 2003 floods in the western half of the pampas mostly in the sab between 1997 and 2003 left more than a quarter of the landscape under water halved grain production damaged infrastructure and soil quality and transformed the few remaining natural areas viglizzo et al 2009 slow floods lasting several years are characteristic of this region they occur when the water table reaches the surface following sustained precipitation excesses kuppel et al 2015 floods in the salado basin not only affect rural land long lived flooding of urban centers has been a recurring issue in the region 2 linked modelling framework 2 1 overview we assembled a linked modelling and analysis framework to describe the reciprocal interactions and feedbacks between plausible climate scenarios individual land use decisions the dynamics of shallow water tables and the emerging impacts of these interactions on regional land use agricultural production and the risks of floods and droughts the various framework components and the flow of data and results among them are illustrated in fig 2 details on individual components are given in subsequent sections a major component of the framework is a fully distributed and physically based hydrological model used to capture the physical and biological linkages between crops and surface and groundwater however production of information relevant to the science policy dialogue also requires a thorough understanding of human choices and of the economic and social contexts in which production decisions are embedded because humans and their choices both influence and are influenced by the climate water crop nexus we augment the biophysical models with an agent based model of land use decisions and farm production another major component of the framework that includes realistic descriptions of human behavior decision making and social interactions other framework components generate necessary inputs e g multiple realizations of synthetic daily weather allow post processing and visualization of framework results and provide a computational environment to run large numbers of simulations relatively effortlessly 2 2 framework components 2 2 1 the mike she hydrological model a hydrological model of the sab was developed using mike she a widely used proprietary software refsgaard and storm 1995 refsgaard et al 2010 mike she is a deterministic spatially distributed physically based numerical model that couples surface and groundwater flows mike she simulates all major processes of the hydrological cycle including evapotranspiration overland flow unsaturated flow and groundwater flow refsgaard et al 2010 sahoo et al 2006 the main link between land use decisions and the hydrological cycle is crop evapotranspiration this process is simulated by mike she using the kristensen and jensen 1975 method both conceptual and practical reasons justify our choice of mike she to model the sab conceptually mike she integrates all major hydrological processes into a single code and provides physically based models for these processes from a practical point of view mike she has been used previously in argentina to develop a flood control master plan for the entire salado basin badano 2010 menéndez et al 2012 and recently to establish the impacts of different land uses on groundwater dynamics for the a1 sub basin garcía et al 2017 the availability of this mike she implementation reduced significantly the start up time for the research presented here for hydrological simulations a regular grid with a horizontal spacing of 5000 m i e each cell has an area of 25 000 000 m2 2500 ha was defined over the sab and surrounding areas about 2800 mike she cells encompass the basin the grid spacing was chosen as a compromise between a spatial resolution sufficient to describe the processes of interest and available computer resources a digital elevation model dem of the basin was based on the 90 m shuttle radar topographic mission srtm data farr et al 2007 altitude shifts in the srtm data were first corrected by fitting a third order polynomial function to elevation data provided by argentina s national geographic institute and altitudes were then averaged to the mike she 2500 ha resolution however the original 90 m dem was used elsewhere the sab elevation decreases from 140 m a s l at the western end to about 60 m a s l in the east a regional slope of about 0 03 the sab is widely covered by wind generated depressions where water is temporarily stored after rain events the typical area of these depressions however is much smaller than the model cell size therefore depressions were considered as initial water abstractions 2 2 mike she assumes a constant elevation within each 2500 ha cell in reality there are small scale topographic features e g micro depressions that can hold excess water the aggregated volume of all depressions in a cell is defined as the initial abstraction for that cell until the aggregated volume is filled there will be no simulated surface runoff the abstraction for each cell was estimated using a higher resolution 90 m dem from the corresponding cell two main soil types with quite different properties horizontal and vertical conductivity saturated and residual soil moisture were included in mike she simulations defined as vertical profiles from the surface to a 40 m depth each soil was associated with a different geological formation three hydrogeological layers post pampeana pampeana and puelche resting on a practically impermeable layer were represented halcrow and partners 1999 details on soil types and hydrogeological layers are given in badano 2010 and garcía et al 2017 the initial condition of the unsaturated zone is established by an equilibrium pressure profile resulting in a uniform wtd of 1 m across the entire basin this relatively shallow initial wtd should be kept in mind when analyzing subsequent simulation results alternatively wtd could be initialized to any desired value but this would require an additional input grid listing initial wtd in each modeled cell 2 2 1 1 mike she calibration in the salado a basin although the mike she model had been previously calibrated for the whole salado basin and other sub basins badano 2010 menéndez et al 2012 the model was recalibrated with specific focus on the sab during the calibration stage a set of model parameters was estimated for the unsaturated zone that minimized the root mean square error rmse of simulated and observed wtd time series to reduce computation time plausible ranges of important parameters were selected based on expert knowledge observed wtd was used both for calibration and validation purposes 126 wtd series of various lengths were available together these series included about 14 000 individual wtd measurements wtd values within the sab were observed by public agencies such as the national agricultural technology institute inta and the national meteorological service smn and by individual farmers these historical wtd observations were compiled by red mate a collaborative research network and are available online http red mate agro uba ar all mike she simulations intended for calibration used as input synthetic daily weather series produced by a weather generator described in section 3 2 3 ten realizations of synthetic weather with statistical characteristics similar to those of observed data were produced for the period 1961 2015 after calibration mike she reproduced very well the observed groundwater dynamics capturing rises and drops of the water table as an example fig 3 shows historical red points and simulated wtd values for three phreatimeters in different locations across the basin and covering different times spans the gray envelope in the three panels of time series represents the wtd range for the 10 equally likely realizations of synthetic daily weather two main results can be pointed out first observed wtds mostly lie within the envelope of simulated values suggesting that observed wtds are consistent with those simulated using the synthetic weather second because of the large size of a mike she cell 2500 ha quantitative comparisons i e rmse of differences between series of point phreatimeter to area model cell are not meaningful mike she has a single elevation for the entire grid cell whereas phreatimeter measurements are referred to the microrelief within a cell instead we focus on assessing whether the overall trends and timing of turning points are consistent in both observed and simulated series 2 2 2 agent based model of land use the pampas model large scale patterns e g land use or wtd for the sab cannot be predicted from the summation of individual behaviors as this would neglect processes such as social interactions learning and adaptation matthews et al 2007 schreinemachers and berger 2006 to address these oft neglected processes we used an agent based model gilbert 2008 grimm and railsback 2005 to upscale farm level decisions and outcomes into basin scale results verburg and overmars 2009 the pampas model pm an agent based model of land use decisions was designed to understand structural changes in agricultural systems of the pampas bert et al 2010 2011 2014 rovere et al 2016 the pm considers individual decisions e g land allocation agronomic management expansion or contraction of area cropped by a farmer influenced by personal goals e g maximization of economic utility and characteristics e g risk tolerance decisions are made in the context of physical climate economic grain prices costs and social neighbors peer networks conditions to illustrate the role of the pm within the linked framework we briefly describe the dynamics of the model one simulated cropping cycle represents the period from 1 may of a year to 30 april of the following calendar year 1 at the beginning of a cropping cycle farmers adjust their economic aspirations based on the expected status of context factors i e climate output prices input costs then farmers decide whether they can i farm additional land the only way to expand cropped area is by renting additional land ii maintain the area cropped in the previous cycle or instead iii release some or all the previously farmed area 2 subsequently farmers allocate their land among a realistic set of activities described below agents may have different land allocation strategies such as imitation or maximization of an objective function gotts and polhill 2009 gotts et al 2003 3 after land is allocated the yield of each selected activity is retrieved from lookup tables that were pre calculated using biophysical crop models section 3 2 4 2 and experienced climate section 3 2 3 a new feature introduced in the current version of the pm considers an empirical correction to grain yields based on wtd during the cycle section 3 2 5 economic returns are then calculated from wtd corrected yields and grain prices and costs specified as model inputs the end result of the economic calculations is an updated value for the farmer s working capital at the end of the production cycle 4 based on achieved economic returns farmers update their aspiration level for the following cycle cyert and march 1963 lant 1992 march 1988 the aspiration level is a special value that separates outcomes perceived as successes or failures diecidue and van de ven 2008 which is used as an input to decisions in the following cropping cycle farmers compare their economic performance to that of peers and use that information to update their subsequent aspiration level herriott et al 1985 and to imitate successful peers bala and goyal 1998 a comprehensive validation of the pm combined i validation of processes and components during model development and ii comparison of observed and simulated results bert et al 2014 the pm reproduced well observed trajectories of the number and size distribution of farms land tenure and land use in the pampas bert et al 2010 2011 as well as endogenously generated land rental prices bert et al 2015 similar validation approaches such as expert assessment of the reasonability of outcomes simulated for specific scenarios was used to validate the whole framework described here 2 2 2 1 the pampas model s spatial environment synthetic farms the pm includes a spatially explicit environment that represents the sab this environment contains multiple farms operated by owner or tenant agents the overall number and size distribution of simulated farms inside the sab environment is consistent with values reported in the 2002 argentine agricultural census which is the most recent available information on farm sizes in argentina because the pm currently includes decision rules and economic calculations only for agricultural land uses synthetic farms encompass only areas sown with annual crops unfortunately we did not have access to a cadastral map showing actual farm boundaries instead we simulated the necessary number of synthetic farms briefly the sab was first covered with multiple tiles 20 ha in size not to be confused with the previously described mike she grid each synthetic farm was then assembled by selecting spatially contiguous tiles whenever possible until the desired farm area was reached because of this approach all simulated farm sizes were multiples of the unit tile area finally the selected tiles were then merged into one if all tiles were contiguous or more polygons representing the outer boundaries of a synthetic farm because the pm includes only agricultural decisions simulated farms were placed only in areas apt for crop production i e having soil units with a productivity index pi riquier et al 1970 32 note however that the aggregated size of synthetic farms did not completely encompass the area suitable for agriculture pi 32 natural grassland or implanted pasture were assumed to cover the rest of this area soils with pi 32 were deemed appropriate only for cattle production grassland or pasture were assumed to cover these soils in all simulations a discussion of the soils used for crop modelling is presented in section 3 2 2 2 a total of 15 832 farms were simulated that encompassed 3 792 720 ha sown with annual crops about 55 of the sab individual farm sizes ranged between 20 and 5040 ha the rest of the basin 3 091 181 ha or about 45 of the sab area was assumed to be permanently covered by implanted or natural grasslands agents do not make production decisions on this land or derive profits from it yet this land influences hydrological dynamics the fact that about 45 of the sab is always covered by pasture grassland should be kept in mind when interpreting simulation results urban areas and roads represent a very small proportion of the sab and thus could be safely ignored 2 2 2 2 pampas model implementation in the salado a basin representative soils soil information is an input to crop simulation models representative soils in the sab were defined from various sources of information first from a 1 500 000 spatial resolution soil atlas inta 1990 we identified 36 soil units each containing 1 3 soil types within the sab of these 19 soil types classified at subgroup level were considered apt for crop production i e pi 32 nevertheless the atlas did not include the soil information needed for crop simulations e g textural characteristics horizon depths to retrieve detailed soil characteristics we relied on higher resolution 1 50 000 inta soil charts that had been previously processed to be included in the triguero wheat simulation software satorre et al 2005 from this source 60 soil series were chosen some soil types were associated with only one series within the sab whereas the most common soils e g typic hapludolls included up to eight different series when a soil type involved multiple series crop yields were simulated for each series and then averaged 2 2 3 a spatial stochastic weather generator the hydrological and crop models in the linked framework require as input daily values of several weather variables on a dense spatial grid because of the sparse spatial distribution of weather stations in the sab an alternative approach to the interpolation of observed data is to drive simulations with synthetic weather series having statistical characteristics similar to those of historical data we used the space time weather generator developed by verdin et al 2018 to produce synthetic weather series on a 25 25 km grid encompassing the sab i e 25 mike she grid cells which have 5 5 km resolution shared the same weather this tool allowed us to produce synthetic series at 210 points while preserving the spatial dependence in daily weather as multiple equally likely weather sequences can be easily generated this approach allows a more thorough impact assessment than use of the historical record which represents a single realization of the weather process richardson 1981 another important feature of the weather generator is that it can accept covariates that can be used to mimic either observed fluctuations or to explore plausible future climate scenarios e g a projected increase or decrease in rainfall etc the weather generator was trained with 1961 2015 daily data observed at 21 meteorological stations within or near the sab and operated by smn and inta we then produced 10 realizations of synthetic daily weather maximum and minimum temperature and precipitation each one spanning 55 years the length of the historical climate record other needed quantities were estimated from the simulated variables e g solar radiation was computed using the bristow and campbell 1984 method to ensure consistency with historical climate in the sab we used three covariates basin wide 3 month min max temperature averages and precipitation totals calculated from the 1961 2015 record we refer to these series as pseudo historical last 25 years i e 1990 2015 of the pseudo historical series were used in most simulations unless otherwise discussed 2 2 4 crop simulation models crops play two major roles in our linked modelling framework first crop yields directly influence the economic results achieved by farmers other drivers such as commodity prices and input costs are kept constant and thus have strong impact on land use decisions second crops influence the hydrological system including wtd through their consumption of soil water to simulate growth development and yield of the main crops in the sab wheat used both as harvest and cover crop maize soybean and sunflower we used models in the decision support system for agrotechnology transfer dssat package jones et al 2003 dssat models have been previously calibrated and validated for the region aramburu merlos et al 2015 bert et al 2007 grassini et al 2009 mercau et al 2007 monzon et al 2007 the information required to run the dssat models includes daily weather series soil parameters and initial conditions crop genetic coefficients and a description of selected crop management 2 2 4 1 crop simulations for mike she runs leaf area index lai the total leaf area per unit of soil area and vegetation root depth rd are inputs used by mike she to compute actual evapotranspiration kristensen and jensen 1975 the temporal evolution of these variables for a simulation cell depends on the relative proportion of land allocated to each land use within that cell and cropping cycle we followed several steps to estimate lai and rd values briefly discussed below first daily values lai and rd for soybean maize wheat and sunflower were simulated using dssat models for each crop we simulated 40 growth cycles using observed weather for junín a meteorological station inside the sab and a representative soil typic hapludoll the 40 simulated lai and rd trajectories were then averaged into a single series for each variable and crop in contrast lai and rd series for pastures grasslands these two covers were not separated were defined using field data nosetto personal communication to drive hydrological simulations weighted lai and rd were calculated for each mike she cell and cropping cycle these values resulted from weighting the average lai and rd values for each land use i e each crop in a synthetic farm or areas with pasture grassland by the proportion of cell area occupied by that activity on a given simulation cycle crops within synthetic farms within a cell had either been selected by agents during pm simulations or alternatively prescribed as part of a particular simulation experiment e g all synthetics farms were assumed to be covered by late maize pasture grassland areas remained constant throughout all simulations 2 2 4 2 crop simulations used by the pampas model the agent based pm includes multiple mechanisms through which agents can select a given land allocation for their farm on each cycle a farmer allocates land among six possible agricultural enterprises i a long or ii short duration cover crop not intended for harvest pinto et al 2017 followed by full cycle soybean iii wheat followed by short cycle soybean iv full cycle soybean without cover crop and v early or vi late sown maize sunflower 3 3 as the sunflower model in dssat oilcrop sun 3 5 98 0 was not available for the latest dssat version v4 6 compatible with psims we used an earlier version but only for mike she calibration was not among the land uses that could be selected by agents in the pm we assumed that wheat for harvest was always followed by a short cycle soybean sown immediately after wheat harvest this is a very realistic assumption for the sab representative agronomic management for each of these activities table 1 was defined in collaboration with sab technical experts from crea a collaborating farmers ngo table 1 also describes soil initial conditions and relevant crop managements used in dssat simulations to explore all combinations of synthetic weather series soils and agronomic management across the spatially dense sab grid a large number of crop simulations ca 150 000 for the whole basin were necessary running these simulations interactively would have been an extremely time consuming and error prone task instead we adapted the parallel system for integrating impact models and sectors psims developed by elliott et al 2014 the psims framework allowed us to use high performance computing infrastructure to run simulations that encompassed a large spatial grid for many cropping cycles and evaluate multiple alternative management practices elliott et al 2014 2 2 5 adjusting crop yields and profits for the effects of shallow water tables despite the fact that dssat and hydrological models have been successfully coupled ma et al 2005 2006 2008 the impacts of wtds on crop yields are still not well captured by the dssat crop models a necessary step therefore was to implement an empirical relationship to correct simulated crop yields for the effects of wtd as mentioned previously shallow water tables can have null positive or negative impacts on crops depending on their depth nosetto et al 2009 zipper et al 2015 we used field data from nosetto et al 2009 to parameterize the impacts of wtd averaged over the growth cycle of a given crop on yield the correction factor used to account for wtd impact on simulated yields is shown as a solid red line in fig 4 for each simulated land use e g full cycle soybean two separate dssat simulations were run as we needed to capture different water stress conditions the first simulation produced a water limited yield that depended on water stored in the unsaturated soil and rainfall during the crop cycle the second simulation in contrast excluded water limitations i e the crop was irrigated when soil water was insufficient and the result was a potential yield fischer et al 2014 farmers often seek a compromise between maximizing profit and minimizing risk at farm scale rather than maximizing the yield of individual crops this behavior translates into an input usage that is economically appropriate but insufficient to maximize yields to capture the effects of these moderate input levels both potential and water limited yields were multiplied by 0 8 thus obtaining attainable potential and water limited yields respectively aramburu merlos et al 2015 sadras et al 2015 four distinct wtd bands depths vary with crops with different impacts on crop yield were identified fig 4 1 at the bottom band 4 with deep water tables groundwater is not accessible to plant roots and thus it does not influence crop growth or yield in this case there is no correction for wtd effects i e for this band there is no red line indicating the yield correction factor the attainable yields in this band that represent water limited conditions can show a wide range of values lighter red band as they depend on available soil water and rainfall during the cycle these yields are simulated well by dssat and thus do not require empirical correction 2 if the water table is shallower band 3 groundwater can reach roots through capillary rise blue dots on the middle soil profile thus it can provide part but not all of the crop water requirements ayars et al 2009 this groundwater subsidy lowry and loheide 2010 mejia et al 2000 zipper et al 2017 reduces water limitations and moves yields of rainfed crops closer to the potential yield even if precipitation is insufficient jobbágy and jackson 2004 nosetto et al 2009 to capture wtd impacts for this band and shallower ones i e bands 1 2 and 3 corrected yields are estimated as the product of the attainable potential yield and the correction factor as water table is deeper along this band the yield correction factor decreases exponentially from 1 at the bottom of band 2 to a value defined as the ratio between i water limited and ii potential yields that varies for each cropping cycle the numerator of this ratio varies mostly with rainfall during the cycle see range at the bottom of fig 4 whereas the denominator responds almost exclusively to temperature and radiation 3 if the water table is at an optimal goldilocks depth band 2 the groundwater compensates any rainfall deficit and the crop is not water limited thus the attainable potential yield can be reached i e yield correction factor 1 4 if wtd is very shallow band 1 the positive effects of groundwater are replaced by a groundwater penalty the negative impacts of waterlogging that limits root activity nutrient availability and plant establishment kahlown and azam 2002 zipper et al 2015 the correction factor and therefore simulated yields decrease rapidly with shallower wtds until the factor equals zero indicating total crop loss finally a tipping point occurs as the water table reaches the surface free standing water flows much faster than within the soil thus spatial and temporal connectivity increases abruptly possibly triggering large flood events 2 2 6 economic calculations the wtd corrected yields are used to compute wtd corrected economic profits that influence farmers decisions during the following cropping cycle fig 2 details of profit calculations are given in bert et al 2015 here we discuss only those calculations that were modified for this work variable direct costs i e harvesting marketing and transportation costs are a function of crop yields transportation costs vary with distance from farmgate to export or processing facilities this item accounts for a large fraction of total production costs in the sab about 15 20 of the gross value of harvested grains in earlier versions of the pm we had assumed an average distance to the port of rosario where most grain processing and export facilities are located for each of the two regions studied instead here we computed the shortest route distance from the centroid of each synthetic farm section 3 2 2 1 to rosario using the google maps direction application programming interface developers google com maps documentation directions intro 2 2 6 1 input output prices input costs and output prices were held constant for all simulations unless indicated otherwise input costs e g seed fertilizer agrochemicals and labors corresponded to april june 2015 when inputs would have been purchased for the reference cropping cycle 2015 2016 costs were extracted from the agroseries data base https www crea org ar agroseries app maintained by crea output grain prices were obtained from the rosario board of trade http www cac bcr com ar and corresponded to those months when most of the production is traded for each crop january march april august and may june 2016 for wheat maize and soybean respectively all values were expressed in april june 2015 us dollars usd using us bureau of labor statistics all commodities series https download bls gov pub time series wp wp data 1 allcommodities exchange rates from argentine pesos ars to usd were obtained from argentina s central bank http www bcra gov ar 2 3 flow of information among framework components the various components of the linked modelling framework fig 2 must be able to exchange information and results throughout the simulations some inputs are defined during the setup and initialization stages for instance synthetic weather and crop yields water limited or not are simulated at the beginning of an experiment and results are accessed when needed as the simulations iterate over the desired number of simulated cropping cycles data flow among framework components the results of one component become inputs to another component for brevity we focus on the flows between the two main components of the framework the land use pm and the hydrological mike she model at the start of a cropping cycle pm agents select land allocation within their farms this information is then processed into inputs needed by mike she time series of weighted lai and rd for each model cell section 3 2 4 1 note that these series include the pasture grassland area within a mike she cell but not included in farmers allocation decisions once this information is passed the pm pauses while mike she simulates hydrological processes synthetic weather section 3 2 3 for the cycle being simulated is retrieved from netcdf files and converted into the dfs2 input format supported by mike she the hydrological model produces a daily time series of wtd for each cell and for the cropping cycle being simulated these series are stored in another netcdf file and passed back to the pm where an average wtd for each crop s growing cycle is computed for each farm in order to calculate wtd corrected yields and economic results note that both the empirical correction of yields for wtd effects and farm level economic calculations are discussed as individual components and shown separately in fig 2 to facilitate presentation but they are actually implemented within the pm the pm then updates the working capital for each simulated farmer and the following simulation cycle begins there are standard interfaces that allow the exchange of information between two or more model components and the intercommunication of processes running on different platforms an example is the openmi interface http www openmi org to use this interface however each component involved must be compliant with the protocol defined by openmi the mike she version to which we had access v 2012 for windows was not openmi compliant this capability became available for later versions in contrast as the pm was entirely developed by us in java it would have been possible to implement the openmi protocol as we were unable to use the openmi standard we implemented an ad hoc protocol to exchange information between framework components that was based on intermediate files in the formats needed by the component receiving each input this was an acceptable alternative in the context of the current framework because exchanges are fairly limited flow of data between the pm and mike she occurs only once in each direction during a simulated cropping cycle as more complex functionalities are added e g the ability by farmers to modify decisions in response to wtd at various times during a cropping cycle several starts and stops of hydrological and agronomic management simulations will be required with multiple exchanges of information during a cycle 2 4 validation of the entire linked modelling framework our linked framework includes components that already had been separately validated showing their capacity to reproduce important patterns of the systems each model represents the mike she hydrological model had been validated earlier for the entire salado basin badano 2010 menéndez et al 2012 and recalibrated validated for the a1 sub basin garcía et al 2017 2018 and the sab section 3 2 1 1 similarly the land use agent based model pm also had undergone a thorough previous validation that combined conceptual and empirical approaches bert et al 2014 in contrast validation of the linked framework described here i e the process of assessing the level of confidence that can be placed in the framework s overall results is more difficult the framework involves multiple models describing the dynamics of the target coupled natural and human systems such integrative frameworks almost invariably involve non linearities stochastic dynamics and micro macro feedback loops fagiolo et al 2007 the ability to replicate empirical evidence is often seen as the only truly decisive criterion for quality of a scientific model however most integrative frameworks are used to explore interesting scenarios for which there are no real world data available indeed many of the data needed both as inputs and to compare the recent historical trajectory of the target systems with simulated results were unavailable for the reasons discussed above we adopted a conceptual validation approach for the framework first we sought to ensure that all framework components involved reasonable real world mechanisms and properties this process is what rand and rust 2011 call micro face validation secondly we followed the tapas take a previous model and add something approach frenken 2006 polhill et al 2010 this incremental approach enhances the conceptual validity of new or newly linked models by building upon previously used and accepted models components and underlying assumptions finally overall framework validity can be enhanced through the pom pattern oriented modelling approach proposed by grimm et al 2005 the central idea behind pom is using patterns observed in real systems such as the recent rise in shallow water tables to guide the design of model structure and check whether the expected patterns are produced 3 climate hydrology and land use interactions in the pampas this section presents results from simulations performed with the linked modelling framework with the twin goals of i validating the framework as a whole and ii demonstrating its usefulness to explore interesting contexts such as unusual climate scenarios e g multiannual wet dry sequences hypothetical policies e g differential export taxes on agricultural commodities and adoption of non structural technologies e g cover crops to manage wtd simulated experiments are organized into three groups results for the various groups range from quite predictable a priori by experts and thus used for conceptual validation to relatively unpredictable emerging patterns used to demonstrate the usefulness of the framework simulated contexts represent both realistic and less realistic scenarios but do not necessarily correspond to any observed situation 3 1 combining land use and climate scenarios the first group of experiments was intended to provide face validation of the framework by exploring whether relatively extreme scenarios of land use and climate produced wtd patterns anticipated by regional experts in flat environments such as the sab groundwater recharge mostly depends on rainfall whereas groundwater discharge is mainly modulated by vegetation jobbágy and jackson 2004 jobbágy et al 2008 viglizzo et al 2009 to simulate the interactions between these two drivers we ran seven experiments in each one a single land use the six agricultural uses considered in the pm plus pasture were assigned to the whole agricultural area in the sab i e about 55 of the basin the remaining portion of the sab i e 45 was always assigned to pasture grassland each of these seven land uses was simulated with three different climate scenarios dry normal and wet climate these experiments did not involve the long pseudo historical climate series used in all other simulations instead we created three ad hoc sets of daily weather series two of which were fairly extreme and the third represented normal conditions the climate scenarios were created as follows first we picked the weather realization out of the 10 we had simulated with the highest range of may april precipitation values over 54 cropping cycles for this realization we sorted all may april precipitation totals in ascending order the 15 cycles with lowest totals represented the dry weather ad hoc scenario similarly the wet ad hoc scenario included those 15 cropping cycles with the highest rainfall totals the remaining 24 cropping cycles were considered as the normal ad hoc scenario cropping cycles within each scenario were randomly shuffled to avoid systematic patterns e g temporally increasing rainfall annual rainfall totals averaged over the sab for the dry normal and wet scenarios were about 700 950 and 1200 mm cycle 1 respectively all 21 combinations of weather and land use were run through the framework crop selection by individual agents was disabled and land use was externally imposed in all scenarios initial wtd was set at 1 m the combined effects of i cropping cycle rainfall in the three scenarios and ii total water consumed by crops and pastures were reflected in fairly different temporal wtd patterns fig 5 as expected the water table was deeper when the basin was covered with pasture as this use consumes water throughout the entire cropping cycle and has deeper roots than grain crops nosetto et al 2015 when the sab was fully covered with pasture the water table was at least 1 m deeper in the wet scenario than for all agricultural land uses wtd differences between crops and pasture were larger for both dry and normal climates although as expected wtds were shallower in the latter scenario among agricultural land uses double crops induced deeper water tables than single crops these differences however were only apparent under dry or normal ad hoc climates and almost negligible in the wet ad hoc climate the six agricultural land uses can be ordered by the temporal evolution of wtd that they induced from shallower to deeper wtd this order was late sowing maize early sowing maize full cycle soybean short cover crop soybean wheat soybean and long cover crop soybean shorter wtd series for some agricultural land uses observed under extreme climates e g wheat soybean in dry climate are a consequence of all farmers in the basin exiting production due to poor economic outcomes a higher consumption of available soil water over the whole cropping cycle explains the deeper water tables under long cover crop soybean in comparison with wheat soybean soybean yield and in turn water use is lower when the crop is part of a double cropping use due to its delayed sowing date i e less time to evapotranspirate and the resource depletion caused by the precedent wheat harvest crop andrade et al 2015 the wheat soybean double crop also has little water consumption during the transition between crops because of low leaf area in early summer when high atmospheric evaporative demand occurs mercau et al 2016 on the contrary when wheat is used as cover crop the land is released earlier allowing an earlier sowing and establishment of the following soybean crop by about one month table 1 in this case differences in yield potential and water consumption between single or cover following soybean are smaller or negligible caviglia and andrade 2010 rimski korsakov et al 2015 intra basin variability e g topography and soil aptitude are captured by the linked modelling framework reflecting spatial differences in the influence of climate and land use decisions on wtd as an example fig 6 shows wtd at the end of the 4th simulated cropping cycle for nine combinations of land use and climate scenarios the impacts of land use on wtd can be explored in fig 6 basin wide average wtd increases as land use goes from late sowing maize to a long cover crop soybean to pasture for each land use ad hoc climate scenarios ranging from dry top row to wet bottom row are tied to increasingly shallower wtds additionally basin flooded area i e wtd above the surface grows from almost non existent for pasture cover and dry climate fig 6 upper right to a large proportion of the sab when late sowing maize and wet climate are simulated fig 6 lower left 3 2 influence of grain price on land use decisions and water table dynamics land use allocation is influenced by both internal and external drivers grain prices are a major driver of land use decisions by farmers in the pampas calviño and monzon 2009 satorre 2011 we used the linked modelling framework to explore the implications of plausible changes in prices of agricultural commodities on i land use decisions influenced by the relative profitability of alternative land uses and in turn ii water table dynamics national market policies applied at the end of the 2000s discouraged wheat sowing in argentina and induced an increase in the area allocated to full cycle soybean the most noticeable drop of wheat sowing area occurred during 2007 2013 from ca 6 to 3 2 million ha agroindustria 2016 as wheat is most often followed by a short cycle soybean i e wheat is seldom sown as a single crop in a cropping cycle this pattern led to a smaller area allocated to double crops in the sab in turn double crops were shown to have a larger influence on wtd than single crops fig 5 for these experiments we chose to vary wheat prices to influence the area assigned to the wheat soybean double crop although based on historical events these simulations do not aim to reconstruct specific historical patterns wheat price for the 2015 16 cycle 140 usd ton 1 was reduced by 23 to mimic the export tax rate used by an earlier argentine administration and reciprocally increased by 23 these two manipulations resulted in wheat soybean price ratios of 0 37 a low ratio and 0 59 a value close to the historical ratio respectively these wheat prices as well as those of other grain crops 151 and 293 usd ton 1 for maize and soybean respectively and input prices were kept constant during the simulated period the initial allocation of agricultural land in farms within the sab was set at 1 3 of wheat soybean 1 3 of full cycle soybean 1 6 of early sowing maize and 1 6 of late sowing maize the pseudo historical climate series was used for these simulations the higher wheat price induced a large proportion of area sown with wheat soybean after 25 cropping cycles this land use expanded from 33 3 to ca 82 of the sab agricultural area fig 7 a low wheat price in contrast caused the wheat soybean area to drop from 33 3 to less than 6 after 25 simulated cycles for this scenario full cycle soybean area increased from 33 3 to about 78 for both wheat price scenarios farmers adoption of cover crops was practically negligible admittedly the ecological services provided by cover crops including flood control were not explicitly quantified within the pm thus for the model they only incurred costs as expected given the results of the previous group of simulations fig 5 the larger proportion of wheat soybean induced deeper water tables in the sab fig 8 after 25 cropping cycles the most frequent wtds were 3 5 m in the high wheat price scenario in response to an increased wheat soybean area vs 1 3 m in the low price one reduced wheat soybean area differences between price scenarios in basin wide average wtd began to be noticeable after 8 9 cropping cycles data not shown 3 3 can adoption of cover crops help maintain the water table at a safe depth drainage infrastructure channels reservoirs have a fairly localized impact in the sab due to the flat relief menéndez et al 2012 moreover although often promoted as an alternative for bio drainage alconada magliano et al 2009 forestation is infrequent in the sab because of its slower return on investment and lack of market or business structures finally as described above the area allocated to pasture with higher annual water consumption has steadily decreased viglizzo et al 2011 for all these reasons the choice and management of agricultural crops to help manage wtd dynamics deserves close attention florio et al 2015 mercau et al 2016 the use of cover crops is proposed as a non structural approach to increase soil water consumption and thus lower or prevent further rise of a shallow water table in addition cover crops provide many other useful ecosystem services pinto et al 2017 rimski korsakov et al 2015 schipanski et al 2014 and many farmers are increasingly adopting them this last group of simulations therefore aims to provide evidence to the debate on the use of cover crops to maintain the water table at a safe depth this experiment included two scenarios in which farmers either i do not consider or ii consider wtd to select their land use allocation in the first scenario farmers choose land uses through different mechanisms such as imitation or maximization of an objective function section 3 2 2 without considering the status of wtd in contrast in the second scenario farmers observe wtd in their farms on may 1st the beginning of a cropping cycle and act according to the following rules i if wtd is deeper than 2 m farmers follow their usual land allocation mechanism ii if on the other hand wtd is shallower than 2 m suggesting the potential for waterlogging and flooding farmers ignore their land allocation mechanism and instead sow a long cover crop followed by full cycle soybean constant input and output prices and pseudo historical climate series were used in both scenarios it is important to highlight that the strategy explored is only one of several plausible rules recommendation of land use decisions is not an objective of this work instead we aim to illustrate the usefulness of the linked modelling framework to explore complex problems such as this as shown above figs 5 and 6 simulated wtd for each 2500 ha grid cell in the framework domain is influenced by the type and proportion of land use in that cell section 3 2 1 fig 9 shows time series of wtd in two model cells with different covers i a mixed use zone in which only 28 of the area was apt for grain crops and the rest was assumed to be covered by pasture grassland and ii an agricultural zone in which the entire cell was covered by grain crops both cells have similar precipitation totals ca 1000 mm and annual distribution for each type of cover fig 9 displays wtds simulated with and without considering wtd as part of land use selection in a mixed use zone fig 9 left panel wtds decrease steadily throughout the simulation and thus are not expected to present significant risks in this situation cover crop adoption is not very relevant from a hydrological perspective in fact conditions leading to cover crop use occurred only once during the first year of simulation as wtd was initialized at 1 m depth in the agricultural zone in contrast simulated wtds were shallower than 2 m during a large portion of the simulation consequently farmers who based land use decisions on wtd sowed cover crops in most years cover crop use helped maintain water tables about 0 4 m deeper than without cover crops at the same time the use of cover crops lowered the probability of wtds reaching very risky levels 0 5 m from 21 to about 2 as we only consider the hydrological implications of the use of cover crops the current model does not quantify their other ecological services it seems appropriate to focus on situations in which a shallow water table creates high risks of waterlogging and flooding i e when land is covered by crops we selected all cells within the model domain that had 100 agricultural cover and calculated economic results relative to the basin s median for every farm inside those cells for both experimental scenarios that is considering wtd to allocate land fig 10 blue boxes and whiskers and not considering wtd fig 10 red boxes and whiskers in most cropping cycles the use of cover crops to maintain water table at a safe depth resulted in somewhat lower average profits but with a considerably lower dispersion i e much less variable profits than when cover crops were not used on average for the entire simulation the relative global gross margin no units obtained by farmers willing to use cover crops was 0 79 0 43 vs 0 97 0 57 for those who did not monitor wtd and thus never used cover crops in this experiment negative results i e relative global gross margin 0 were more frequent for farmers who did not consider wtd in their land use decision 7 of the cases vs 4 by farmers who adopted cover crops in response to shallow wtd the patterns of relative profitability respectively associated with use no use of cover crops could have several explanations first cover crops imply higher costs but produce no income as they are not harvested thus average profits are lower a second reason for this result could be that in dryer years cover crops lower the wtd and therefore eliminate the groundwater subsidy for the soybean that follows at the same time avoidance of extremely shallow wtds for which total losses were possible may have contributed to the higher stability of profits stability of economic results is an issue that has great relevance for small farmers as one or two consecutive years of negative profits may cause small farmers to run out of working capital and exit production bert et al 2011 4 concluding remarks soil water is a major link between climate food and energy production and other agroecosystems services jobbágy and jackson 2004 zipper et al 2015 this work described a linked modelling and analysis framework intended to capture linkages across multiple scales at the climate water crop nexus in an extremely flat environment such as the argentine pampas various groups of experiments were performed to both validate the framework as a whole individual components had been validated previously and to demonstrate the usefulness of the linked framework to address complex problems involving both natural and human dimensions first we explored the combined effects of cropping cycle rainfall under contrasting ad hoc climate scenarios e g wet normal dry and total water consumed by different land uses various crops and pasture as expected the various combinations of land use and climate resulted in fairly different temporal and spatial patterns of wtd across the sab the impact of fluctuations in relative grain prices on selected land use and in turn on water table dynamics was also captured by the linked modelling framework finally we explored the adoption of non structural approaches to manage wtd such as the use of cover crops in agricultural systems where shallow water tables create recurrent risks of waterlogging and flooding winter cover crops can be used to keep water tables at a safe depth acknowledgements this research was supported by the national science foundation nsf usa grant 1211613 dynamics of coupled natural and human systems by the inter american institute for global change research iai grant crn 3035 the iai is supported by the nsf grant geo 1128040 by the national agency for science and technology promotion anpcyt argentina grant pict 2790 14 and by the national scientific and technical research council conicet argentina grant pip 112 201501 00609 gag held a postdoctoral fellowship from conicet climate data were kindly provided by the regional climate centre for southern south america 
26305,in flat environments groundwater is relatively shallow tightly associated with surface water and climate and can have either positive and negative impacts on natural and human systems depending on its depth a linked modelling and analysis framework that seeks to capture linkages across multiple scales at the climate water crop nexus in the argentine pampas is presented this region shows a strong coupling between climate soil water and land use due to its extremely flat topography and poorly developed drainage networks the work describes the components of the framework and subsequently presents results from simulations performed with the twin goals of i validating the framework as a whole and ii demonstrating its usefulness to explore interesting contexts such as unexperienced climate scenarios wet dry periods hypothetical policies e g differential grains export taxes and adoption of non structural technologies e g cover crops to manage water table depth keywords natural human systems mike she agent based model agriculture water table risk management abbreviations sab salado a basin wtd water table depth pm pampas model pi productivity index dssat decision support system for agrotechnology transfer lai leaf area index rd root depth srtm shuttle radar topographic mission inta national agricultural technology institute argentina smn national meteorological service argentina software availability name of software pampas model developers santiago l rovere federico schmidt guillermo p podestá guillermo a garcía pablo e garcía and federico e bert contact information santiago l rovere srovere gmail com hardware required high end computer i7 processor or similar 16 32 gb ram and virtualization capability software required repast simphony 2 4 java 7 mysql server 5 7 and mysql connector j r 3 4 and additional libraries for running pampas model mike she 2012 windows 7 8 10 openssh server is also required programming languages java 7 r 3 4 visual c license all software is open source except mike she 2012 users who want to run mike she must purchase a license https www dhigroup com 1 introduction throughout history water and agriculture have been closely linked kirsten 2010 smith et al 2010 water for food production currently exceeds all other water needs rosegrant et al 2009 most of the global food production comes from rainfed agriculture where soil water availability depends almost exclusively on precipitation de fraiture and wichelns 2010 rainfed agriculture holds the potential to increase food production and reduce irrigation needs but remains particularly vulnerable to risks associated with a shifting climate de fraiture and wichelns 2010 the region of central eastern argentina known as the pampas is one of the most important rainfed grain producing areas in the world calviño and monzon 2009 hall et al 1992 most of the pampas has an extremely flat topography with regional slopes lower than 0 1 jobbágy et al 2008 in such flat environments groundwater is tightly coupled to surface water and plays a key role on the functionality of the ecosystem low topographic gradients and poorly developed drainage networks constrain horizontal evacuation of excess water in turn leading to shallow water tables 1 1 the water table is defined as the top of the water saturated zone or phreatic zone in the soil profile fan et al 2013 shallow water tables generally less than 3 5 m deep can affect and reciprocally be affected by the annual field crops and pastures or natural grasslands that dominate land use in the pampas nosetto et al 2009 2015 agricultural production systems in the pampas and the associated use of land and water have undergone profound changes in recent decades barsky and gelman 2009 satorre 2011 these changes were propelled by complex interactions among i favorable economic contexts tied to higher global demand for animal protein and increasingly biofuels lamers et al 2008 rulli et al 2016 ii cost reducing technological innovations such as no tillage cropping and glyphosate resistant varieties of soybean caviglia and andrade 2010 qaim and traxler 2005 and iii marked inter decadal variability in precipitation berbery et al 2006 castañeda and barros 1994 with a steady increase in annual rainfall particularly in spring summer since the 1970s haylock et al 2006 rusticucci and penalba 2000 vargas et al 2002 because of interactions among all these drivers field crops have expanded throughout the pampas displacing grasslands and pastures manuel navarrete et al 2009 viglizzo et al 2011 the observed shift from mixed crop cattle systems to continuous agriculture has influenced the dynamics of surface and groundwater in the pampas as crops occupy a field only during a few months per year and often have shallower roots they consume less water than pastures or grasslands annually nosetto et al 2012 2015 moreover no tillage cropping a widely adopted practice in the pampas trigo et al 2009 leaves the soil undisturbed and covered with stubble possibly reducing soil evaporation increasing infiltration and reducing runoff sinclair et al 2007 consequently lower evapotranspiration from land use change together with increased rainfall have contributed to increase groundwater recharge favoring the rise of water tables contreras et al 2011 viglizzo et al 2009 as water table dynamics control the formation and expansion of free standing water bodies aragón et al 2011 kruse et al 2001 scarpati et al 2002 there is an active debate in argentine society about the links between land use changes and a perceived increase in the frequency and magnitude of flooding events with important social and economic impacts kuppel et al 2015 this work aims to contribute science based evidence to the ongoing debate our goal is to explore the couplings interdependencies lags and feedbacks between i surface and groundwater ii plausible climate scenarios e g wet or dry periods and iii agricultural production systems in the pampas towards that goal we have implemented a modelling and analysis framework that seeks to capture linkages across multiple scales at the climate water crop nexus in the pampas this paper describes the components of the framework and subsequently use it as a controlled experimental environment to explore the impacts of various climate and land use scenarios 1 1 the study area the study focuses on the salado a basin sab fig 1 located in the northwestern portion of the salado basin in central eastern argentina forte lay et al 2007 this region provides a unique environment to simulate and study linkages between climate water and agricultural decision making because of i the strong coupling between climate variability surface and groundwater in its flat sedimentary landscape and ii observed land use changes that together with marked climate fluctuations on multiple time scales modulate groundwater recharge water table depth wtd and flood frequency the sab encompasses approximately 6 9 million ha 69 000 km2 extending about 330 km east west and 360 km north south the sab is a sedimentary basin where soils have developed on loessic materials of loamy to sandy loam textures and are predominantly hapludolls hall et al 1992 the sab has very flat topography and poorly developed drainage networks that constrain horizontal flows of both surface and groundwater viglizzo et al 2009 the climate of the sab is characterized as temperate sub humid hall et al 1992 with mean annual rainfall decreasing westward from 1000 to 800 mm and a mean annual potential evapotranspiration of ca 1100 mm although the sab is considered to have an isohigrous regime the colder part of the year is relatively drier as two thirds of annual precipitation occur during the austral spring and summer october march mean daily air temperature ranges from 8 to 10 c during winter to 22 24 c in summer smn 2017 as with most of the pampas sab production systems moved from low input cattle crop rotations to a predominantly agricultural system with more intensive use of external inputs technology and management viglizzo et al 2001 the sab area allocated to annual grain crops increased from 40 to 50 since the 1960s viglizzo et al 2011 and wheat was replaced by full cycle soybean as the prevailing crop agroindustria 2016 since colonial times the salado basin has shown alternating floods and droughts that displace populations and disrupt productive activities and livelihoods for extended periods floods were frequent during the late 19th and early 20th centuries a relatively wet period in contrast extensive droughts were more frequent during the drier 1930s 1950s herzer 2003 seager et al 2010 partly in response to rainfall increases since the 1970s severe floods have occurred in the salado basin in 1980 1991 93 and 2000 01 herzer 2003 floods in the western half of the pampas mostly in the sab between 1997 and 2003 left more than a quarter of the landscape under water halved grain production damaged infrastructure and soil quality and transformed the few remaining natural areas viglizzo et al 2009 slow floods lasting several years are characteristic of this region they occur when the water table reaches the surface following sustained precipitation excesses kuppel et al 2015 floods in the salado basin not only affect rural land long lived flooding of urban centers has been a recurring issue in the region 2 linked modelling framework 2 1 overview we assembled a linked modelling and analysis framework to describe the reciprocal interactions and feedbacks between plausible climate scenarios individual land use decisions the dynamics of shallow water tables and the emerging impacts of these interactions on regional land use agricultural production and the risks of floods and droughts the various framework components and the flow of data and results among them are illustrated in fig 2 details on individual components are given in subsequent sections a major component of the framework is a fully distributed and physically based hydrological model used to capture the physical and biological linkages between crops and surface and groundwater however production of information relevant to the science policy dialogue also requires a thorough understanding of human choices and of the economic and social contexts in which production decisions are embedded because humans and their choices both influence and are influenced by the climate water crop nexus we augment the biophysical models with an agent based model of land use decisions and farm production another major component of the framework that includes realistic descriptions of human behavior decision making and social interactions other framework components generate necessary inputs e g multiple realizations of synthetic daily weather allow post processing and visualization of framework results and provide a computational environment to run large numbers of simulations relatively effortlessly 2 2 framework components 2 2 1 the mike she hydrological model a hydrological model of the sab was developed using mike she a widely used proprietary software refsgaard and storm 1995 refsgaard et al 2010 mike she is a deterministic spatially distributed physically based numerical model that couples surface and groundwater flows mike she simulates all major processes of the hydrological cycle including evapotranspiration overland flow unsaturated flow and groundwater flow refsgaard et al 2010 sahoo et al 2006 the main link between land use decisions and the hydrological cycle is crop evapotranspiration this process is simulated by mike she using the kristensen and jensen 1975 method both conceptual and practical reasons justify our choice of mike she to model the sab conceptually mike she integrates all major hydrological processes into a single code and provides physically based models for these processes from a practical point of view mike she has been used previously in argentina to develop a flood control master plan for the entire salado basin badano 2010 menéndez et al 2012 and recently to establish the impacts of different land uses on groundwater dynamics for the a1 sub basin garcía et al 2017 the availability of this mike she implementation reduced significantly the start up time for the research presented here for hydrological simulations a regular grid with a horizontal spacing of 5000 m i e each cell has an area of 25 000 000 m2 2500 ha was defined over the sab and surrounding areas about 2800 mike she cells encompass the basin the grid spacing was chosen as a compromise between a spatial resolution sufficient to describe the processes of interest and available computer resources a digital elevation model dem of the basin was based on the 90 m shuttle radar topographic mission srtm data farr et al 2007 altitude shifts in the srtm data were first corrected by fitting a third order polynomial function to elevation data provided by argentina s national geographic institute and altitudes were then averaged to the mike she 2500 ha resolution however the original 90 m dem was used elsewhere the sab elevation decreases from 140 m a s l at the western end to about 60 m a s l in the east a regional slope of about 0 03 the sab is widely covered by wind generated depressions where water is temporarily stored after rain events the typical area of these depressions however is much smaller than the model cell size therefore depressions were considered as initial water abstractions 2 2 mike she assumes a constant elevation within each 2500 ha cell in reality there are small scale topographic features e g micro depressions that can hold excess water the aggregated volume of all depressions in a cell is defined as the initial abstraction for that cell until the aggregated volume is filled there will be no simulated surface runoff the abstraction for each cell was estimated using a higher resolution 90 m dem from the corresponding cell two main soil types with quite different properties horizontal and vertical conductivity saturated and residual soil moisture were included in mike she simulations defined as vertical profiles from the surface to a 40 m depth each soil was associated with a different geological formation three hydrogeological layers post pampeana pampeana and puelche resting on a practically impermeable layer were represented halcrow and partners 1999 details on soil types and hydrogeological layers are given in badano 2010 and garcía et al 2017 the initial condition of the unsaturated zone is established by an equilibrium pressure profile resulting in a uniform wtd of 1 m across the entire basin this relatively shallow initial wtd should be kept in mind when analyzing subsequent simulation results alternatively wtd could be initialized to any desired value but this would require an additional input grid listing initial wtd in each modeled cell 2 2 1 1 mike she calibration in the salado a basin although the mike she model had been previously calibrated for the whole salado basin and other sub basins badano 2010 menéndez et al 2012 the model was recalibrated with specific focus on the sab during the calibration stage a set of model parameters was estimated for the unsaturated zone that minimized the root mean square error rmse of simulated and observed wtd time series to reduce computation time plausible ranges of important parameters were selected based on expert knowledge observed wtd was used both for calibration and validation purposes 126 wtd series of various lengths were available together these series included about 14 000 individual wtd measurements wtd values within the sab were observed by public agencies such as the national agricultural technology institute inta and the national meteorological service smn and by individual farmers these historical wtd observations were compiled by red mate a collaborative research network and are available online http red mate agro uba ar all mike she simulations intended for calibration used as input synthetic daily weather series produced by a weather generator described in section 3 2 3 ten realizations of synthetic weather with statistical characteristics similar to those of observed data were produced for the period 1961 2015 after calibration mike she reproduced very well the observed groundwater dynamics capturing rises and drops of the water table as an example fig 3 shows historical red points and simulated wtd values for three phreatimeters in different locations across the basin and covering different times spans the gray envelope in the three panels of time series represents the wtd range for the 10 equally likely realizations of synthetic daily weather two main results can be pointed out first observed wtds mostly lie within the envelope of simulated values suggesting that observed wtds are consistent with those simulated using the synthetic weather second because of the large size of a mike she cell 2500 ha quantitative comparisons i e rmse of differences between series of point phreatimeter to area model cell are not meaningful mike she has a single elevation for the entire grid cell whereas phreatimeter measurements are referred to the microrelief within a cell instead we focus on assessing whether the overall trends and timing of turning points are consistent in both observed and simulated series 2 2 2 agent based model of land use the pampas model large scale patterns e g land use or wtd for the sab cannot be predicted from the summation of individual behaviors as this would neglect processes such as social interactions learning and adaptation matthews et al 2007 schreinemachers and berger 2006 to address these oft neglected processes we used an agent based model gilbert 2008 grimm and railsback 2005 to upscale farm level decisions and outcomes into basin scale results verburg and overmars 2009 the pampas model pm an agent based model of land use decisions was designed to understand structural changes in agricultural systems of the pampas bert et al 2010 2011 2014 rovere et al 2016 the pm considers individual decisions e g land allocation agronomic management expansion or contraction of area cropped by a farmer influenced by personal goals e g maximization of economic utility and characteristics e g risk tolerance decisions are made in the context of physical climate economic grain prices costs and social neighbors peer networks conditions to illustrate the role of the pm within the linked framework we briefly describe the dynamics of the model one simulated cropping cycle represents the period from 1 may of a year to 30 april of the following calendar year 1 at the beginning of a cropping cycle farmers adjust their economic aspirations based on the expected status of context factors i e climate output prices input costs then farmers decide whether they can i farm additional land the only way to expand cropped area is by renting additional land ii maintain the area cropped in the previous cycle or instead iii release some or all the previously farmed area 2 subsequently farmers allocate their land among a realistic set of activities described below agents may have different land allocation strategies such as imitation or maximization of an objective function gotts and polhill 2009 gotts et al 2003 3 after land is allocated the yield of each selected activity is retrieved from lookup tables that were pre calculated using biophysical crop models section 3 2 4 2 and experienced climate section 3 2 3 a new feature introduced in the current version of the pm considers an empirical correction to grain yields based on wtd during the cycle section 3 2 5 economic returns are then calculated from wtd corrected yields and grain prices and costs specified as model inputs the end result of the economic calculations is an updated value for the farmer s working capital at the end of the production cycle 4 based on achieved economic returns farmers update their aspiration level for the following cycle cyert and march 1963 lant 1992 march 1988 the aspiration level is a special value that separates outcomes perceived as successes or failures diecidue and van de ven 2008 which is used as an input to decisions in the following cropping cycle farmers compare their economic performance to that of peers and use that information to update their subsequent aspiration level herriott et al 1985 and to imitate successful peers bala and goyal 1998 a comprehensive validation of the pm combined i validation of processes and components during model development and ii comparison of observed and simulated results bert et al 2014 the pm reproduced well observed trajectories of the number and size distribution of farms land tenure and land use in the pampas bert et al 2010 2011 as well as endogenously generated land rental prices bert et al 2015 similar validation approaches such as expert assessment of the reasonability of outcomes simulated for specific scenarios was used to validate the whole framework described here 2 2 2 1 the pampas model s spatial environment synthetic farms the pm includes a spatially explicit environment that represents the sab this environment contains multiple farms operated by owner or tenant agents the overall number and size distribution of simulated farms inside the sab environment is consistent with values reported in the 2002 argentine agricultural census which is the most recent available information on farm sizes in argentina because the pm currently includes decision rules and economic calculations only for agricultural land uses synthetic farms encompass only areas sown with annual crops unfortunately we did not have access to a cadastral map showing actual farm boundaries instead we simulated the necessary number of synthetic farms briefly the sab was first covered with multiple tiles 20 ha in size not to be confused with the previously described mike she grid each synthetic farm was then assembled by selecting spatially contiguous tiles whenever possible until the desired farm area was reached because of this approach all simulated farm sizes were multiples of the unit tile area finally the selected tiles were then merged into one if all tiles were contiguous or more polygons representing the outer boundaries of a synthetic farm because the pm includes only agricultural decisions simulated farms were placed only in areas apt for crop production i e having soil units with a productivity index pi riquier et al 1970 32 note however that the aggregated size of synthetic farms did not completely encompass the area suitable for agriculture pi 32 natural grassland or implanted pasture were assumed to cover the rest of this area soils with pi 32 were deemed appropriate only for cattle production grassland or pasture were assumed to cover these soils in all simulations a discussion of the soils used for crop modelling is presented in section 3 2 2 2 a total of 15 832 farms were simulated that encompassed 3 792 720 ha sown with annual crops about 55 of the sab individual farm sizes ranged between 20 and 5040 ha the rest of the basin 3 091 181 ha or about 45 of the sab area was assumed to be permanently covered by implanted or natural grasslands agents do not make production decisions on this land or derive profits from it yet this land influences hydrological dynamics the fact that about 45 of the sab is always covered by pasture grassland should be kept in mind when interpreting simulation results urban areas and roads represent a very small proportion of the sab and thus could be safely ignored 2 2 2 2 pampas model implementation in the salado a basin representative soils soil information is an input to crop simulation models representative soils in the sab were defined from various sources of information first from a 1 500 000 spatial resolution soil atlas inta 1990 we identified 36 soil units each containing 1 3 soil types within the sab of these 19 soil types classified at subgroup level were considered apt for crop production i e pi 32 nevertheless the atlas did not include the soil information needed for crop simulations e g textural characteristics horizon depths to retrieve detailed soil characteristics we relied on higher resolution 1 50 000 inta soil charts that had been previously processed to be included in the triguero wheat simulation software satorre et al 2005 from this source 60 soil series were chosen some soil types were associated with only one series within the sab whereas the most common soils e g typic hapludolls included up to eight different series when a soil type involved multiple series crop yields were simulated for each series and then averaged 2 2 3 a spatial stochastic weather generator the hydrological and crop models in the linked framework require as input daily values of several weather variables on a dense spatial grid because of the sparse spatial distribution of weather stations in the sab an alternative approach to the interpolation of observed data is to drive simulations with synthetic weather series having statistical characteristics similar to those of historical data we used the space time weather generator developed by verdin et al 2018 to produce synthetic weather series on a 25 25 km grid encompassing the sab i e 25 mike she grid cells which have 5 5 km resolution shared the same weather this tool allowed us to produce synthetic series at 210 points while preserving the spatial dependence in daily weather as multiple equally likely weather sequences can be easily generated this approach allows a more thorough impact assessment than use of the historical record which represents a single realization of the weather process richardson 1981 another important feature of the weather generator is that it can accept covariates that can be used to mimic either observed fluctuations or to explore plausible future climate scenarios e g a projected increase or decrease in rainfall etc the weather generator was trained with 1961 2015 daily data observed at 21 meteorological stations within or near the sab and operated by smn and inta we then produced 10 realizations of synthetic daily weather maximum and minimum temperature and precipitation each one spanning 55 years the length of the historical climate record other needed quantities were estimated from the simulated variables e g solar radiation was computed using the bristow and campbell 1984 method to ensure consistency with historical climate in the sab we used three covariates basin wide 3 month min max temperature averages and precipitation totals calculated from the 1961 2015 record we refer to these series as pseudo historical last 25 years i e 1990 2015 of the pseudo historical series were used in most simulations unless otherwise discussed 2 2 4 crop simulation models crops play two major roles in our linked modelling framework first crop yields directly influence the economic results achieved by farmers other drivers such as commodity prices and input costs are kept constant and thus have strong impact on land use decisions second crops influence the hydrological system including wtd through their consumption of soil water to simulate growth development and yield of the main crops in the sab wheat used both as harvest and cover crop maize soybean and sunflower we used models in the decision support system for agrotechnology transfer dssat package jones et al 2003 dssat models have been previously calibrated and validated for the region aramburu merlos et al 2015 bert et al 2007 grassini et al 2009 mercau et al 2007 monzon et al 2007 the information required to run the dssat models includes daily weather series soil parameters and initial conditions crop genetic coefficients and a description of selected crop management 2 2 4 1 crop simulations for mike she runs leaf area index lai the total leaf area per unit of soil area and vegetation root depth rd are inputs used by mike she to compute actual evapotranspiration kristensen and jensen 1975 the temporal evolution of these variables for a simulation cell depends on the relative proportion of land allocated to each land use within that cell and cropping cycle we followed several steps to estimate lai and rd values briefly discussed below first daily values lai and rd for soybean maize wheat and sunflower were simulated using dssat models for each crop we simulated 40 growth cycles using observed weather for junín a meteorological station inside the sab and a representative soil typic hapludoll the 40 simulated lai and rd trajectories were then averaged into a single series for each variable and crop in contrast lai and rd series for pastures grasslands these two covers were not separated were defined using field data nosetto personal communication to drive hydrological simulations weighted lai and rd were calculated for each mike she cell and cropping cycle these values resulted from weighting the average lai and rd values for each land use i e each crop in a synthetic farm or areas with pasture grassland by the proportion of cell area occupied by that activity on a given simulation cycle crops within synthetic farms within a cell had either been selected by agents during pm simulations or alternatively prescribed as part of a particular simulation experiment e g all synthetics farms were assumed to be covered by late maize pasture grassland areas remained constant throughout all simulations 2 2 4 2 crop simulations used by the pampas model the agent based pm includes multiple mechanisms through which agents can select a given land allocation for their farm on each cycle a farmer allocates land among six possible agricultural enterprises i a long or ii short duration cover crop not intended for harvest pinto et al 2017 followed by full cycle soybean iii wheat followed by short cycle soybean iv full cycle soybean without cover crop and v early or vi late sown maize sunflower 3 3 as the sunflower model in dssat oilcrop sun 3 5 98 0 was not available for the latest dssat version v4 6 compatible with psims we used an earlier version but only for mike she calibration was not among the land uses that could be selected by agents in the pm we assumed that wheat for harvest was always followed by a short cycle soybean sown immediately after wheat harvest this is a very realistic assumption for the sab representative agronomic management for each of these activities table 1 was defined in collaboration with sab technical experts from crea a collaborating farmers ngo table 1 also describes soil initial conditions and relevant crop managements used in dssat simulations to explore all combinations of synthetic weather series soils and agronomic management across the spatially dense sab grid a large number of crop simulations ca 150 000 for the whole basin were necessary running these simulations interactively would have been an extremely time consuming and error prone task instead we adapted the parallel system for integrating impact models and sectors psims developed by elliott et al 2014 the psims framework allowed us to use high performance computing infrastructure to run simulations that encompassed a large spatial grid for many cropping cycles and evaluate multiple alternative management practices elliott et al 2014 2 2 5 adjusting crop yields and profits for the effects of shallow water tables despite the fact that dssat and hydrological models have been successfully coupled ma et al 2005 2006 2008 the impacts of wtds on crop yields are still not well captured by the dssat crop models a necessary step therefore was to implement an empirical relationship to correct simulated crop yields for the effects of wtd as mentioned previously shallow water tables can have null positive or negative impacts on crops depending on their depth nosetto et al 2009 zipper et al 2015 we used field data from nosetto et al 2009 to parameterize the impacts of wtd averaged over the growth cycle of a given crop on yield the correction factor used to account for wtd impact on simulated yields is shown as a solid red line in fig 4 for each simulated land use e g full cycle soybean two separate dssat simulations were run as we needed to capture different water stress conditions the first simulation produced a water limited yield that depended on water stored in the unsaturated soil and rainfall during the crop cycle the second simulation in contrast excluded water limitations i e the crop was irrigated when soil water was insufficient and the result was a potential yield fischer et al 2014 farmers often seek a compromise between maximizing profit and minimizing risk at farm scale rather than maximizing the yield of individual crops this behavior translates into an input usage that is economically appropriate but insufficient to maximize yields to capture the effects of these moderate input levels both potential and water limited yields were multiplied by 0 8 thus obtaining attainable potential and water limited yields respectively aramburu merlos et al 2015 sadras et al 2015 four distinct wtd bands depths vary with crops with different impacts on crop yield were identified fig 4 1 at the bottom band 4 with deep water tables groundwater is not accessible to plant roots and thus it does not influence crop growth or yield in this case there is no correction for wtd effects i e for this band there is no red line indicating the yield correction factor the attainable yields in this band that represent water limited conditions can show a wide range of values lighter red band as they depend on available soil water and rainfall during the cycle these yields are simulated well by dssat and thus do not require empirical correction 2 if the water table is shallower band 3 groundwater can reach roots through capillary rise blue dots on the middle soil profile thus it can provide part but not all of the crop water requirements ayars et al 2009 this groundwater subsidy lowry and loheide 2010 mejia et al 2000 zipper et al 2017 reduces water limitations and moves yields of rainfed crops closer to the potential yield even if precipitation is insufficient jobbágy and jackson 2004 nosetto et al 2009 to capture wtd impacts for this band and shallower ones i e bands 1 2 and 3 corrected yields are estimated as the product of the attainable potential yield and the correction factor as water table is deeper along this band the yield correction factor decreases exponentially from 1 at the bottom of band 2 to a value defined as the ratio between i water limited and ii potential yields that varies for each cropping cycle the numerator of this ratio varies mostly with rainfall during the cycle see range at the bottom of fig 4 whereas the denominator responds almost exclusively to temperature and radiation 3 if the water table is at an optimal goldilocks depth band 2 the groundwater compensates any rainfall deficit and the crop is not water limited thus the attainable potential yield can be reached i e yield correction factor 1 4 if wtd is very shallow band 1 the positive effects of groundwater are replaced by a groundwater penalty the negative impacts of waterlogging that limits root activity nutrient availability and plant establishment kahlown and azam 2002 zipper et al 2015 the correction factor and therefore simulated yields decrease rapidly with shallower wtds until the factor equals zero indicating total crop loss finally a tipping point occurs as the water table reaches the surface free standing water flows much faster than within the soil thus spatial and temporal connectivity increases abruptly possibly triggering large flood events 2 2 6 economic calculations the wtd corrected yields are used to compute wtd corrected economic profits that influence farmers decisions during the following cropping cycle fig 2 details of profit calculations are given in bert et al 2015 here we discuss only those calculations that were modified for this work variable direct costs i e harvesting marketing and transportation costs are a function of crop yields transportation costs vary with distance from farmgate to export or processing facilities this item accounts for a large fraction of total production costs in the sab about 15 20 of the gross value of harvested grains in earlier versions of the pm we had assumed an average distance to the port of rosario where most grain processing and export facilities are located for each of the two regions studied instead here we computed the shortest route distance from the centroid of each synthetic farm section 3 2 2 1 to rosario using the google maps direction application programming interface developers google com maps documentation directions intro 2 2 6 1 input output prices input costs and output prices were held constant for all simulations unless indicated otherwise input costs e g seed fertilizer agrochemicals and labors corresponded to april june 2015 when inputs would have been purchased for the reference cropping cycle 2015 2016 costs were extracted from the agroseries data base https www crea org ar agroseries app maintained by crea output grain prices were obtained from the rosario board of trade http www cac bcr com ar and corresponded to those months when most of the production is traded for each crop january march april august and may june 2016 for wheat maize and soybean respectively all values were expressed in april june 2015 us dollars usd using us bureau of labor statistics all commodities series https download bls gov pub time series wp wp data 1 allcommodities exchange rates from argentine pesos ars to usd were obtained from argentina s central bank http www bcra gov ar 2 3 flow of information among framework components the various components of the linked modelling framework fig 2 must be able to exchange information and results throughout the simulations some inputs are defined during the setup and initialization stages for instance synthetic weather and crop yields water limited or not are simulated at the beginning of an experiment and results are accessed when needed as the simulations iterate over the desired number of simulated cropping cycles data flow among framework components the results of one component become inputs to another component for brevity we focus on the flows between the two main components of the framework the land use pm and the hydrological mike she model at the start of a cropping cycle pm agents select land allocation within their farms this information is then processed into inputs needed by mike she time series of weighted lai and rd for each model cell section 3 2 4 1 note that these series include the pasture grassland area within a mike she cell but not included in farmers allocation decisions once this information is passed the pm pauses while mike she simulates hydrological processes synthetic weather section 3 2 3 for the cycle being simulated is retrieved from netcdf files and converted into the dfs2 input format supported by mike she the hydrological model produces a daily time series of wtd for each cell and for the cropping cycle being simulated these series are stored in another netcdf file and passed back to the pm where an average wtd for each crop s growing cycle is computed for each farm in order to calculate wtd corrected yields and economic results note that both the empirical correction of yields for wtd effects and farm level economic calculations are discussed as individual components and shown separately in fig 2 to facilitate presentation but they are actually implemented within the pm the pm then updates the working capital for each simulated farmer and the following simulation cycle begins there are standard interfaces that allow the exchange of information between two or more model components and the intercommunication of processes running on different platforms an example is the openmi interface http www openmi org to use this interface however each component involved must be compliant with the protocol defined by openmi the mike she version to which we had access v 2012 for windows was not openmi compliant this capability became available for later versions in contrast as the pm was entirely developed by us in java it would have been possible to implement the openmi protocol as we were unable to use the openmi standard we implemented an ad hoc protocol to exchange information between framework components that was based on intermediate files in the formats needed by the component receiving each input this was an acceptable alternative in the context of the current framework because exchanges are fairly limited flow of data between the pm and mike she occurs only once in each direction during a simulated cropping cycle as more complex functionalities are added e g the ability by farmers to modify decisions in response to wtd at various times during a cropping cycle several starts and stops of hydrological and agronomic management simulations will be required with multiple exchanges of information during a cycle 2 4 validation of the entire linked modelling framework our linked framework includes components that already had been separately validated showing their capacity to reproduce important patterns of the systems each model represents the mike she hydrological model had been validated earlier for the entire salado basin badano 2010 menéndez et al 2012 and recalibrated validated for the a1 sub basin garcía et al 2017 2018 and the sab section 3 2 1 1 similarly the land use agent based model pm also had undergone a thorough previous validation that combined conceptual and empirical approaches bert et al 2014 in contrast validation of the linked framework described here i e the process of assessing the level of confidence that can be placed in the framework s overall results is more difficult the framework involves multiple models describing the dynamics of the target coupled natural and human systems such integrative frameworks almost invariably involve non linearities stochastic dynamics and micro macro feedback loops fagiolo et al 2007 the ability to replicate empirical evidence is often seen as the only truly decisive criterion for quality of a scientific model however most integrative frameworks are used to explore interesting scenarios for which there are no real world data available indeed many of the data needed both as inputs and to compare the recent historical trajectory of the target systems with simulated results were unavailable for the reasons discussed above we adopted a conceptual validation approach for the framework first we sought to ensure that all framework components involved reasonable real world mechanisms and properties this process is what rand and rust 2011 call micro face validation secondly we followed the tapas take a previous model and add something approach frenken 2006 polhill et al 2010 this incremental approach enhances the conceptual validity of new or newly linked models by building upon previously used and accepted models components and underlying assumptions finally overall framework validity can be enhanced through the pom pattern oriented modelling approach proposed by grimm et al 2005 the central idea behind pom is using patterns observed in real systems such as the recent rise in shallow water tables to guide the design of model structure and check whether the expected patterns are produced 3 climate hydrology and land use interactions in the pampas this section presents results from simulations performed with the linked modelling framework with the twin goals of i validating the framework as a whole and ii demonstrating its usefulness to explore interesting contexts such as unusual climate scenarios e g multiannual wet dry sequences hypothetical policies e g differential export taxes on agricultural commodities and adoption of non structural technologies e g cover crops to manage wtd simulated experiments are organized into three groups results for the various groups range from quite predictable a priori by experts and thus used for conceptual validation to relatively unpredictable emerging patterns used to demonstrate the usefulness of the framework simulated contexts represent both realistic and less realistic scenarios but do not necessarily correspond to any observed situation 3 1 combining land use and climate scenarios the first group of experiments was intended to provide face validation of the framework by exploring whether relatively extreme scenarios of land use and climate produced wtd patterns anticipated by regional experts in flat environments such as the sab groundwater recharge mostly depends on rainfall whereas groundwater discharge is mainly modulated by vegetation jobbágy and jackson 2004 jobbágy et al 2008 viglizzo et al 2009 to simulate the interactions between these two drivers we ran seven experiments in each one a single land use the six agricultural uses considered in the pm plus pasture were assigned to the whole agricultural area in the sab i e about 55 of the basin the remaining portion of the sab i e 45 was always assigned to pasture grassland each of these seven land uses was simulated with three different climate scenarios dry normal and wet climate these experiments did not involve the long pseudo historical climate series used in all other simulations instead we created three ad hoc sets of daily weather series two of which were fairly extreme and the third represented normal conditions the climate scenarios were created as follows first we picked the weather realization out of the 10 we had simulated with the highest range of may april precipitation values over 54 cropping cycles for this realization we sorted all may april precipitation totals in ascending order the 15 cycles with lowest totals represented the dry weather ad hoc scenario similarly the wet ad hoc scenario included those 15 cropping cycles with the highest rainfall totals the remaining 24 cropping cycles were considered as the normal ad hoc scenario cropping cycles within each scenario were randomly shuffled to avoid systematic patterns e g temporally increasing rainfall annual rainfall totals averaged over the sab for the dry normal and wet scenarios were about 700 950 and 1200 mm cycle 1 respectively all 21 combinations of weather and land use were run through the framework crop selection by individual agents was disabled and land use was externally imposed in all scenarios initial wtd was set at 1 m the combined effects of i cropping cycle rainfall in the three scenarios and ii total water consumed by crops and pastures were reflected in fairly different temporal wtd patterns fig 5 as expected the water table was deeper when the basin was covered with pasture as this use consumes water throughout the entire cropping cycle and has deeper roots than grain crops nosetto et al 2015 when the sab was fully covered with pasture the water table was at least 1 m deeper in the wet scenario than for all agricultural land uses wtd differences between crops and pasture were larger for both dry and normal climates although as expected wtds were shallower in the latter scenario among agricultural land uses double crops induced deeper water tables than single crops these differences however were only apparent under dry or normal ad hoc climates and almost negligible in the wet ad hoc climate the six agricultural land uses can be ordered by the temporal evolution of wtd that they induced from shallower to deeper wtd this order was late sowing maize early sowing maize full cycle soybean short cover crop soybean wheat soybean and long cover crop soybean shorter wtd series for some agricultural land uses observed under extreme climates e g wheat soybean in dry climate are a consequence of all farmers in the basin exiting production due to poor economic outcomes a higher consumption of available soil water over the whole cropping cycle explains the deeper water tables under long cover crop soybean in comparison with wheat soybean soybean yield and in turn water use is lower when the crop is part of a double cropping use due to its delayed sowing date i e less time to evapotranspirate and the resource depletion caused by the precedent wheat harvest crop andrade et al 2015 the wheat soybean double crop also has little water consumption during the transition between crops because of low leaf area in early summer when high atmospheric evaporative demand occurs mercau et al 2016 on the contrary when wheat is used as cover crop the land is released earlier allowing an earlier sowing and establishment of the following soybean crop by about one month table 1 in this case differences in yield potential and water consumption between single or cover following soybean are smaller or negligible caviglia and andrade 2010 rimski korsakov et al 2015 intra basin variability e g topography and soil aptitude are captured by the linked modelling framework reflecting spatial differences in the influence of climate and land use decisions on wtd as an example fig 6 shows wtd at the end of the 4th simulated cropping cycle for nine combinations of land use and climate scenarios the impacts of land use on wtd can be explored in fig 6 basin wide average wtd increases as land use goes from late sowing maize to a long cover crop soybean to pasture for each land use ad hoc climate scenarios ranging from dry top row to wet bottom row are tied to increasingly shallower wtds additionally basin flooded area i e wtd above the surface grows from almost non existent for pasture cover and dry climate fig 6 upper right to a large proportion of the sab when late sowing maize and wet climate are simulated fig 6 lower left 3 2 influence of grain price on land use decisions and water table dynamics land use allocation is influenced by both internal and external drivers grain prices are a major driver of land use decisions by farmers in the pampas calviño and monzon 2009 satorre 2011 we used the linked modelling framework to explore the implications of plausible changes in prices of agricultural commodities on i land use decisions influenced by the relative profitability of alternative land uses and in turn ii water table dynamics national market policies applied at the end of the 2000s discouraged wheat sowing in argentina and induced an increase in the area allocated to full cycle soybean the most noticeable drop of wheat sowing area occurred during 2007 2013 from ca 6 to 3 2 million ha agroindustria 2016 as wheat is most often followed by a short cycle soybean i e wheat is seldom sown as a single crop in a cropping cycle this pattern led to a smaller area allocated to double crops in the sab in turn double crops were shown to have a larger influence on wtd than single crops fig 5 for these experiments we chose to vary wheat prices to influence the area assigned to the wheat soybean double crop although based on historical events these simulations do not aim to reconstruct specific historical patterns wheat price for the 2015 16 cycle 140 usd ton 1 was reduced by 23 to mimic the export tax rate used by an earlier argentine administration and reciprocally increased by 23 these two manipulations resulted in wheat soybean price ratios of 0 37 a low ratio and 0 59 a value close to the historical ratio respectively these wheat prices as well as those of other grain crops 151 and 293 usd ton 1 for maize and soybean respectively and input prices were kept constant during the simulated period the initial allocation of agricultural land in farms within the sab was set at 1 3 of wheat soybean 1 3 of full cycle soybean 1 6 of early sowing maize and 1 6 of late sowing maize the pseudo historical climate series was used for these simulations the higher wheat price induced a large proportion of area sown with wheat soybean after 25 cropping cycles this land use expanded from 33 3 to ca 82 of the sab agricultural area fig 7 a low wheat price in contrast caused the wheat soybean area to drop from 33 3 to less than 6 after 25 simulated cycles for this scenario full cycle soybean area increased from 33 3 to about 78 for both wheat price scenarios farmers adoption of cover crops was practically negligible admittedly the ecological services provided by cover crops including flood control were not explicitly quantified within the pm thus for the model they only incurred costs as expected given the results of the previous group of simulations fig 5 the larger proportion of wheat soybean induced deeper water tables in the sab fig 8 after 25 cropping cycles the most frequent wtds were 3 5 m in the high wheat price scenario in response to an increased wheat soybean area vs 1 3 m in the low price one reduced wheat soybean area differences between price scenarios in basin wide average wtd began to be noticeable after 8 9 cropping cycles data not shown 3 3 can adoption of cover crops help maintain the water table at a safe depth drainage infrastructure channels reservoirs have a fairly localized impact in the sab due to the flat relief menéndez et al 2012 moreover although often promoted as an alternative for bio drainage alconada magliano et al 2009 forestation is infrequent in the sab because of its slower return on investment and lack of market or business structures finally as described above the area allocated to pasture with higher annual water consumption has steadily decreased viglizzo et al 2011 for all these reasons the choice and management of agricultural crops to help manage wtd dynamics deserves close attention florio et al 2015 mercau et al 2016 the use of cover crops is proposed as a non structural approach to increase soil water consumption and thus lower or prevent further rise of a shallow water table in addition cover crops provide many other useful ecosystem services pinto et al 2017 rimski korsakov et al 2015 schipanski et al 2014 and many farmers are increasingly adopting them this last group of simulations therefore aims to provide evidence to the debate on the use of cover crops to maintain the water table at a safe depth this experiment included two scenarios in which farmers either i do not consider or ii consider wtd to select their land use allocation in the first scenario farmers choose land uses through different mechanisms such as imitation or maximization of an objective function section 3 2 2 without considering the status of wtd in contrast in the second scenario farmers observe wtd in their farms on may 1st the beginning of a cropping cycle and act according to the following rules i if wtd is deeper than 2 m farmers follow their usual land allocation mechanism ii if on the other hand wtd is shallower than 2 m suggesting the potential for waterlogging and flooding farmers ignore their land allocation mechanism and instead sow a long cover crop followed by full cycle soybean constant input and output prices and pseudo historical climate series were used in both scenarios it is important to highlight that the strategy explored is only one of several plausible rules recommendation of land use decisions is not an objective of this work instead we aim to illustrate the usefulness of the linked modelling framework to explore complex problems such as this as shown above figs 5 and 6 simulated wtd for each 2500 ha grid cell in the framework domain is influenced by the type and proportion of land use in that cell section 3 2 1 fig 9 shows time series of wtd in two model cells with different covers i a mixed use zone in which only 28 of the area was apt for grain crops and the rest was assumed to be covered by pasture grassland and ii an agricultural zone in which the entire cell was covered by grain crops both cells have similar precipitation totals ca 1000 mm and annual distribution for each type of cover fig 9 displays wtds simulated with and without considering wtd as part of land use selection in a mixed use zone fig 9 left panel wtds decrease steadily throughout the simulation and thus are not expected to present significant risks in this situation cover crop adoption is not very relevant from a hydrological perspective in fact conditions leading to cover crop use occurred only once during the first year of simulation as wtd was initialized at 1 m depth in the agricultural zone in contrast simulated wtds were shallower than 2 m during a large portion of the simulation consequently farmers who based land use decisions on wtd sowed cover crops in most years cover crop use helped maintain water tables about 0 4 m deeper than without cover crops at the same time the use of cover crops lowered the probability of wtds reaching very risky levels 0 5 m from 21 to about 2 as we only consider the hydrological implications of the use of cover crops the current model does not quantify their other ecological services it seems appropriate to focus on situations in which a shallow water table creates high risks of waterlogging and flooding i e when land is covered by crops we selected all cells within the model domain that had 100 agricultural cover and calculated economic results relative to the basin s median for every farm inside those cells for both experimental scenarios that is considering wtd to allocate land fig 10 blue boxes and whiskers and not considering wtd fig 10 red boxes and whiskers in most cropping cycles the use of cover crops to maintain water table at a safe depth resulted in somewhat lower average profits but with a considerably lower dispersion i e much less variable profits than when cover crops were not used on average for the entire simulation the relative global gross margin no units obtained by farmers willing to use cover crops was 0 79 0 43 vs 0 97 0 57 for those who did not monitor wtd and thus never used cover crops in this experiment negative results i e relative global gross margin 0 were more frequent for farmers who did not consider wtd in their land use decision 7 of the cases vs 4 by farmers who adopted cover crops in response to shallow wtd the patterns of relative profitability respectively associated with use no use of cover crops could have several explanations first cover crops imply higher costs but produce no income as they are not harvested thus average profits are lower a second reason for this result could be that in dryer years cover crops lower the wtd and therefore eliminate the groundwater subsidy for the soybean that follows at the same time avoidance of extremely shallow wtds for which total losses were possible may have contributed to the higher stability of profits stability of economic results is an issue that has great relevance for small farmers as one or two consecutive years of negative profits may cause small farmers to run out of working capital and exit production bert et al 2011 4 concluding remarks soil water is a major link between climate food and energy production and other agroecosystems services jobbágy and jackson 2004 zipper et al 2015 this work described a linked modelling and analysis framework intended to capture linkages across multiple scales at the climate water crop nexus in an extremely flat environment such as the argentine pampas various groups of experiments were performed to both validate the framework as a whole individual components had been validated previously and to demonstrate the usefulness of the linked framework to address complex problems involving both natural and human dimensions first we explored the combined effects of cropping cycle rainfall under contrasting ad hoc climate scenarios e g wet normal dry and total water consumed by different land uses various crops and pasture as expected the various combinations of land use and climate resulted in fairly different temporal and spatial patterns of wtd across the sab the impact of fluctuations in relative grain prices on selected land use and in turn on water table dynamics was also captured by the linked modelling framework finally we explored the adoption of non structural approaches to manage wtd such as the use of cover crops in agricultural systems where shallow water tables create recurrent risks of waterlogging and flooding winter cover crops can be used to keep water tables at a safe depth acknowledgements this research was supported by the national science foundation nsf usa grant 1211613 dynamics of coupled natural and human systems by the inter american institute for global change research iai grant crn 3035 the iai is supported by the nsf grant geo 1128040 by the national agency for science and technology promotion anpcyt argentina grant pict 2790 14 and by the national scientific and technical research council conicet argentina grant pip 112 201501 00609 gag held a postdoctoral fellowship from conicet climate data were kindly provided by the regional climate centre for southern south america 
26306,in this paper we describe a modelling framework that allows the integration of human and physical components of flood risk within this framework flood risk management is conceptualized as a coupled human flood system the human subsystem includes individuals and their behaviour and institutions that shape human flood interaction the framework presents a dynamic integration between agent based models of individuals and institutions and numerical flood models we demonstrate the framework s modelling application by examining the effects of three institutions in the caribbean island of sint maarten the case study shows the capabilities of the framework by exploring impacts of existing policies on flood risk reduction coupled agent based flood models built using the framework are useful to analyse policy options that address flood hazard and communities vulnerability and exposure to support policy decision making these models also show how flood risk changes over time in relation to the human dynamics on the urban environment keywords coupled human flood systems socio hydrology institutions agent based modelling flood risk management urban flood modelling software and data availability program title coupled abm flood model developer yared abayneh abebe contact address y abebe un ihe org software access https github com yaredo77 coupled abm flood model software required repast simphony 2 4 https repast github io and mike flood 2016 https www mikepoweredbydhi com products mike flood program language java availability the full agent based model is available for free the flood model and input data used in the abm are not available due to data confidentiality license this work is licensed under a creative commons attribution noncommercial sharealike 4 0 international license 1 introduction of all weather related disasters in the last two decades floods are by far the most common 47 affecting 2 3 billion people cred and unisdr 2015 the cred and unisdr report emphasizes that after storms and geophysical disasters floods have been causing the third highest amount of economic damage 662 billion usd over the past 20 years the number of flood events has significantly increased in which urban areas have been hit particularly hard jha et al 2012 the risk associated with floods can be defined as the probability of negative impacts due to floods schanze 2006 flood impacts are mainly attributed to the extent and magnitude of a flood hazard which can be caused by one or a combination of fluvial flash pluvial groundwater and coastal floods vojinovic and huang 2014 however the negative impacts are also due to the vulnerability and exposure of natural and human elements such as individuals livelihoods economic and cultural assets infrastructure ecosystems and environmental resources vojinovic et al 2016 hence floods are not just nature related disasters rather they are the result of meteorological and hydrological factors aggravated by human actions apfm 2012 changes in the climate system and economic social cultural institutional and governance factors are drivers of flood hazard vulnerability and exposure ipcc 2014 2012 for example in the context of urban flood risk population growth and the associated urban expansion result in changes to land use and land cover that leads to an increase in impermeable surfaces and more flooding and hence affects flood hazard when accompanied by inadequate planning and policies urban expansion may happen in flood prone areas increasing exposure or happen in dense low quality informal settlements that contribute to a higher number of vulnerable people jha et al 2012 for example in uk the government acknowledged that the increasing demand for housing leads to more building in high flood risk zones department for communities and local government 2007 in which the proportion of new residential properties located in flood zones grow from 7 in 2013 14 to 9 in 2015 16 department for communities and local government 2016 moreover the behaviour of individuals plays an important role in flood risk based on their economic situation and risk perception which is a function of values feelings experiences and cultural perspectives schanze 2006 heterogeneous individuals living in flood prone areas may implement their own local measures to reduce hazard e g green roofs or rainwater tanks vojinovic and huang 2014 or vulnerability e g dwellings with a non habitable ground floor gersonius et al 2008 further individuals may insure their properties to avoid huge financial losses or to recover better in the case of flooding currently governments are reorganizing flood insurance policies changing individual behaviour dubbelboer et al 2017 individuals may also reduce exposure to flood hazard by relocating assets to less flood prone areas and through evacuations unisdr 2015 in flood risk management frm the likelihood of adopting and implementing measures that reduce flood hazard vulnerability and exposure depends on changes in individual and institutional behaviour in response to the potential of flooding and the accompanying impact loucks 2015 therefore on the one hand frm is dependent on the rules regulations policies and implementations that aim to reduce flood risk but on the other hand it relies on how individuals react towards those aspects and adapt their behaviour the factors which shape the flood hazard and a community s exposure and vulnerability to flooding can be understood as institutions institutions are sets of humanly devised constraints that shape human interaction north 1990 they are key elements in the social economic and political makeup of human beings that define our interaction with the physical system the importance of institutions as social structures that influence the society as a whole and in turn are influenced by the society has been repeatedly emphasized by prominent scholars in economics political science and sociology among others e g hodgson 1988 north 1990 ostrom 1990 to strengthen frm and to reduce flood risk a more holistic interdisciplinary approach that integrates all components of risk is essential aerts et al 2018 this approach should consider the interaction between human and physical subsystems schanze 2006 vojinovic 2015 the human subsystem consists of decision making individuals whose collective behaviour creates and is constrained by institutions such as norms habits and laws the human subsystem is embedded in and interacts with the physical subsystem the physical subsystem includes drainage systems and dykes that might be affected by flood events with interactions across multiple spatial temporal and organizational scales and behaviour driven by imperfect information and bounded rationality the coupled human flood system is a complex system see also pahl wostl 2015 further as individuals and organizations learn mitchell 2009 from previous flood impacts the human flood system is a complex adaptive system cas a systems approach which explicitly takes into account institutions as factors that shape the flood hazard and community s exposure and vulnerability to flooding has not yet been sufficiently addressed in the literature one notable related work is presented by yu et al 2017 which examines collective actions in polder flooding as a contribution to the major advances in socio hydrology sivapalan et al 2012 in recent years we aim to add these key social aspects to the domain the aim of this paper is to develop a modelling framework and a methodology to build models for holistic frm the framework called coupled flood agent institution modelling framework claim integrates actors institutions the urban environment hydrologic and hydrodynamic processes and external factors which affect local frm activities the framework defines the system as a cas and conceptualizes the complex interaction of floods humans and their environment as drivers of flood hazard vulnerability and exposure in the methodology that accompanies claim framework the human subsystem is modelled using the agent based modelling approach abm consequently claim incorporates heterogeneous actors and their actions and interactions with the environment and flooding it also provides the possibility to analyse the underlying institutions that govern the actions and interactions in managing flood risk by incorporating maia modelling agent systems using institutional analysis meta model ghorbani et al 2013 the flood subsystem is modelled using physically based numerical model the abm is dynamically coupled to the flood model in order to understand how humans interact with the environment and to investigate the effect of different institutions and frm policy options we apply the framework to the frm case of the caribbean island of sint maarten to show the functionality of claim and the policy insights gained from coupled abm flood model outputs 2 relationship to existing human flood interaction studies in this section we summarize the state of the literature regarding modelling approaches that have been used to study coupled human flood interactions the use of numerical flood models has been invaluable in frm as they are used to simulate the physics of floods in relation to any state of the system however careful attention to data collection and processing as well as model instantiation is needed in order to gain full benefits from numerical models e g vojinovic et al 2013 2011 2006 recently modelling of the coupled human flood system is getting more attention in socio hydrology which mainly studies the co evolution of humans and water explicitly by considering the possibility of generating emergent behaviours sivapalan et al 2012 in socio hydrology the human subsystem is considered as an endogenous part of the water subsystem and there is a two way interaction between the two subsystems sivapalan and blöschl 2015 identify two possible approaches to model coupled human flood interactions the first ones are called stylized models and they formalize the human and flood subsystems processes using a single differential equation the second type of models are called comprehensive system of systems models and they represent the subsystems by individual models that are based on well established methodologies from the relevant disciplines examples of stylized models that conceptualize the dynamics of settled floodplains as a complex human flood system include those discussed by di baldassarre et al 2013 2015 and viglione et al 2014 in the conceptual models they consider hydrological economic political technological and social processes that co evolve over time but can be altered by a sudden occurrence of flooding they formalize the feedbacks and interactions deriving the behaviour of the system using a set of differential equations these models are easy to use and flexible but as also pointed out by the authors the main drawback of the stylized models is that they neglect the heterogeneity that exists within the human subsystem in addition their conceptualization is based on societal memory or experience of prior flood events as a link between the human and flood subsystems and it does not incorporate the institutions that shape the behaviour of humans in their interaction with their environment and flood yu et al 2017 study the human flood interaction in polders of coastal bangladesh by including institutions for collective actions they model informal institutions mainly the norm that local people cooperate on the collective maintenance of embankments that enclose the polders because of fear of losing a good name or reputation in the community which leads to social ostracism that outcasts defectors and refuses help in times of need yet again yu et al use stylized models that do not consider heterogeneity and focus only on institutions for collective actions conversely studies such as dawson et al 2011 tesfatsion et al 2017 valkering et al 2005 conceptualize the human and flood subsystems separately and model the human subsystem using abm considering heterogeneous actors decision making however the main gap in these studies is that either they use simplified flood models and a set of behavioural rules or they do not methodically analyze institutions to study drivers of flood risk votsis 2017 utilized cellular automaton model to study the relationship between urbanization trends and frm strategies the study shows the effects of bottom up flood risk information based housing market responses and top down floodplain development restriction scenarios on urbanization however the study does not show if the flood extent and depth changes with the development pattern it also focuses only on the exposure component of the flood risk in general there are important initiatives to model the human flood interactions using systems perspective however these efforts do not address either analysing institutions or heterogeneity of actors or all components of the flood risk i e hazard vulnerability and exposure in their modelling exercise in this paper we develop a framework that helps to explicitly conceptualize heterogeneous agents and institutions and propose a modelling methodology that couples abm and flood model 3 theoretical background in order to build a holistic modelling framework for frm a comprehensive systems view needs to be taken into account to cover the human and physical aspects of the system in this section we explain our modelling approach by introducing the methods and language used for building holistic models 3 1 agent based modelling approach for frm the main advantage of the cas perspective introduced earlier is its ability to dynamically link two different subsystems i e the human subsystem and the flood subsystem and to model their interaction models which incorporate the systems thinking may consider structural change learning and innovation and hence provide a new basis for policy exploration allen et al 2008 since the human subsystem is a cas by itself it requires careful selection of modelling methods to simulate heterogeneity and adaptation for example the classical reductionist modelling methods such as partial differential equations or statistical techniques such as regression and bayesian nets have limitations in modelling cas holland 2006 these methods are characterized by restrictive or unrealistic assumptions such as linearity homogeneity normality and stationarity bankes 2002 hence methods which capture a more realistic view of cas shall be used of these methodologies abms provide the most natural description and simulation of a cas bonabeau 2002 and relax the assumptions that characterize differential equations and statistical models bankes 2002 abms offer a way to model social systems that are composed of agents who interact with and influence each other learn from their experiences and adapt their behaviours so they are better suited to their environment macal and north 2010 an abm consists of three elements a set of agents actor is the real thing and agent is actor s representation in a model set of agent relationships and methods of interaction and agents environment macal and north 2010 as highlighted by filatova et al 2013 since abms primarily focus on human behaviour integrating them with other domain modelling methods better inform policy challenges in coupled human natural systems hence in frm studies abms can be integrated with physically based flood models to analyse the institutions that affect flood hazard vulnerability and exposure 3 2 institutional analysis as mentioned previously human behaviour is governed by a set of rules known as institutions institutions can be expressed and modelled through institutional statements described by the adico grammatical syntax crawford and ostrom 1995 ghorbani et al 2013 according to crawford and ostrom institutional statement refers to the shared linguistic constraint or opportunity that prescribes permits or advises actions or outcomes for actors institutional statements are spoken written or tacitly understood in a form intelligible to actors in an empirical setting in a way institutions have conceptual or abstract nature while institutional statements are linguistic statements basurto et al 2010 in adico grammatical syntax a refers to attributes d refers to deontic i refers to aim c refers to condition and o refers to or else crawford and ostrom 1995 the attribute is the actor to whom the institutional statement applies the deontic is the modal operator which can be permitted obliged or forbidden the aim describes the actions or outcomes to which the institutional statement refers it defines what action is conducted and how the action is conducted basurto et al 2010 the condition defines when and where the aim is permitted obliged or forbidden finally the or else describes the sanction for failing to comply with a rule if an institutional statement consists of aic it is regarded as a shared strategy if the statement consists of adic it is a norm and if the statement contains all the five components it is called a rule crawford and ostrom 1995 to structure and conceptualize social systems by emphasizing on institutions and to build abms we use the maia modelling agent systems using institutional analysis meta model ghorbani et al 2013 as it provides a comprehensive modelling language maia is a formalized representation of the institutional analysis and development framework ostrom et al 1994 and it is the only agent based modelling language that systematically and explicitly incorporates institutions into models maia makes use of the adico grammar to conceptualize and model different types of institutions the maia meta model is organized into five structures social structure defines agents and their attributes such as properties behaviour and decision making institutional structure defines the social context such as role of agents and institutions that govern agents behaviour physical structure defines the physical aspects of the system such as infrastructure operational structure defines the dynamics of the system and finally the evaluative structure defines the concepts that are used to validate and measure the outcomes of the system see also verhoog et al 2016 for details of maia 4 claim the coupled flood agent institution modelling framework to capture the main components of the coupled human flood system that is to be studied and modelled we develop the claim framework claim is composed of five elements agents institutions urban environment physical processes and external factors using claim a system can be socially and physically conceptualized and modelled as a coupled human flood system such a holistic model provides the possibility to test various policy scenarios for frm because of the explicit modelling and integration of such policies in the model it is possible to explore how different scenarios affect actors and the physical environment and vice versa the framework also defines the system boundary and identifies the type and level of interaction within the system claim is specifically designed for the context of urban frm it is based on the cas perspective takes abm and physically based flood models as the modelling approach and uses maia to structure the institutions and build the abm fig 1 illustrates the concepts of the framework and their relations in the following subsections we will describe each element by providing generic examples 4 1 agents agents represent individuals or composite actors that are a collection of actors such as an organizational entity or a household an agent has an internal state that represents the essential variables associated with its current situation and behaviours that relate information sensed by the agent to its decisions and actions macal and north 2010 agents state may have intrinsic nature such as age gender and household size the environment may also define agents state as agents perceive the urban environment and set their state for example the location and elevation of a house which can be extracted from the topographic map define the internal state of an agent if there is a flood event agents also perceive whether they are flooded and update their state the behaviour of the agent consists of its decision making process and the action that takes place as a result examples of these actions include building a house constructing frm measures or purchasing flood insurance agents behaviour can be influenced by their internal state and vice versa for example if there is a flood event and a house is flooded i e agent s state updates the agent may decide to protect the house by flood proofing i e the new state resulting in a change in behaviour alternatively if an agent decides to build an elevated house i e agent s behaviour the house will not be flooded i e no update in agent s state unless the flood level is higher than the floor height as agents are social their interaction with other agents may also change their behaviour extending the above example an agent s decision to build an elevated house may be incentivized by an insurance firm agent through lower premiums 4 2 institutions humans devise institutions whose goal is to shape human behaviour therefore institutions have a two way relationship with agents in claim on the one hand institutions may influence agents behaviour depending on their heterogeneity in making decisions and complying or not with the institutions for example the eu floods directive european commission 2007 demands member states to assess the potential risk of flooding and to prepare flood hazard and risk maps based on these rules member states engage in activities i e influence on the government agents behaviour to comply with an agreed deadline on the other hand agents may create change or abolish institutions for example after hurricane sandy the u s federal emergency management agency improved the high risk areas map for coastal flooding in new york dixon et al 2013 consequently the flood insurance rate maps are also changed which in effect changed the flood insurance premiums of businesses and residents the institutions defined here are internal i e set within the system boundary rules norms and shared strategies that can influence agents behaviours and they can also be changed by the agents in models they can be defined exogenously as fixed parameters that the agents only follow or endogenously as dependent variables that are updated over time as a response to agents behaviour the latter may show the evolution of institutions through feedbacks in claim institutions are not directly linked with the urban environment as their impact is only through the influence they have on agents agents perceive and follow or not institutions prescribed by them and act on the urban environment conversely agents perceive the urban environment mainly when there is a change in the urban environment such as flooding and may update institutions for example to designate floodplains as no building zones 4 3 urban environment agents are situated in an environment which contains all the information external to the agent and provides space for agents interaction nikolic and kasmire 2013 in claim agents live and build their livelihood and physical artefacts in the urban physical environment at the same time floods also happen in the same environment as a result in fig 1 we illustrate the urban environment as a link between the human and flood subsystems for example if agents want to reduce flood hazard they do not try to directly influence rainfall magnitude and patterns they rather implement measures such as detention basins in the urban environment to retain excess rainfall the urban environment consists of the built and natural environments the built environment includes buildings roads drainage networks and flood reduction measures whereas the natural environment includes natural watercourses and floodplains changes in the urban environment are driven by the institutions and states of the agents for example with an increase in income level individuals may decide to build more houses based on a new economic policy governments may build more roads or to reduce a recurrent riverine flooding municipalities may invest on the construction of dykes along a river bank as geographic information is crucial in frm the urban environment is a physically defined space based on gis maps such as topography map and building and road layers the urban environment sets the spatial boundary and its size depends on the objective of the study 4 4 physical processes although the physical processes occur on the urban environment we separate the two elements i e the processes and the environment to emphasize that our focus is only on flooding and not on other types of hazard e g earthquake or landslide that may occur in the same environment aspects of the urban environment that are directly linked to floods such as drainage networks rivers and hydraulic structures are represented in the hydrologic and hydrodynamic processes depending on the magnitude of the source of flood and presence and capacity of frm measures flood may occur flood is represented by flood maps showing its extent depth and velocity and the map is overlaid over the urban environment to assess the impacts on people and properties agents affect the hydrologic and hydrodynamic processes through their actions on the urban environment for example land cover change such as the construction of more houses and paved parking lots may increase the imperviousness of the surface and hence contribute to higher runoff whereas if agents implement adaptation and mitigation measures such as green roofs water harvesting barrels or levees that reduces runoff generation similarly the processes have an effect on the agents through the urban environment flood maps overlaid on the urban environment may define agents internal states for example by changing their states from not flooded to flooded 4 5 external factors there are two sets of external factors which are important in influencing the flood human urban environment interaction source of flood and external economic and political factors a flood occurs when there is a hydro meteorological event that causes it for example in flash floods the source can be intense rainfall or in the case of coastal floods the source can be a hurricane induced surge although the hydro meteorological events are necessary conditions for the occurrence of floods they are classified as external factors given agents do not have the power to regulate them agents can only reduce the flood hazard associated with the events by implementing frm measures i e drivers of hazard the external economic and political factors can be institutions though these factors are beyond the direct influence of the actions and interactions of agents and internal institutions in the defined urban system thus in models they can only be defined exogenously for example a global financial crisis may affect budgets a government agent may allocate for frm measures an example of external political factors can be the requirements of eu floods directive european commission 2007 demanding member states to map and assess their flood risk 5 building a coupled model using claim to model the complex human flood system we use a coupled component model approach kelly et al 2013 that integrates a physically based model to model the flood subsystem and an abm to model the human subsystem model integration may follow multiple phases such as pre integration assessment preparation of models model orchestration data interoperability and testing belete et al 2017 to build a coupled abm flood model we have summarized the modelling process into four main steps 1 conceptualizing the system using the claim framework 2 building an abm of the human subsystem 3 building a flood model of the flood subsystem 4 coupling the abm and the flood model step 1 is related to the pre integration assessment steps 2 and 3 are related to the preparation of component models and step 4 incorporates orchestration and data operability to demonstrate the application of the claim approach we use the sint maarten frm which is one of the fp7 pearl project www pearl fp7 eu case study areas as a case study for a complex human flood system we would like to emphasize that this case study is used to help explain the functionality and applicability of the framework therefore we have not gone into the details of the model output and lessons learned from it to keep the focus after describing the case we discuss the above four steps in more detail case description sint maarten is a caribbean island state located in the north atlantic ocean and subject to frequent hurricanes vojinovic and teeffelen 2007 the potential impact due to hurricanes and isolated heavy rainfalls has increased considerably over the recent years due to economic and population growth on the island reflecting on previous disasters it is apparent that the disaster prevention preparedness and mitigations on the island have not been sufficiently developed to be able to cope with potential disasters for sint maarten authorities the ability to address and minimize the risk of flood related disasters represents a major challenge hence a policy plan was drafted to improve disaster management on the island the government of sint maarten is also drafting a national development plan ndp with the plan the government will introduce building codes and suggest floor height elevations for flood prone areas to reduce flood risk therefore our aim is to conceptualize the frm in sint maarten using claim and to build a coupled abm flood model we perform scenario based simulations to analyse the implications of policies i e institutions and evaluate how different agents responses to existing and future policies influence the overall flood risk 5 1 conceptualizing the system using claim the first step towards building a coupled abm flood model is to formulate the human flood interaction problem that needs to be investigated and to decompose and structure the concepts related to the two subsystems besides guiding the collection of primary and secondary data depending on the level of detail we want to represent in the models this step provides the different knowledge domains or expertise required to build the agent based and flood models basically this step is about deciding the model boundary and identifying the five components of the claim framework in the coupled system for the sint maarten frm case we have identified two key agents household agents and government agent the household agents are individual agents that represent the population living in sint maarten these agents make decisions on whether to implement policies that are devised by the government of sint maarten to reduce flood risk the government agent in our conceptualization is a composite agent that comprises the permits the inspection and the new projects and management departments of the ministry of public housing spatial planning environment and infrastructure of the government of sint maarten vromi the three departments play a major role in designing regulating and inspecting urban planning policies that shape the hazard and household agents exposure and vulnerability we have also identified three formal institutions to shape the human flood interaction these institutions are the sint maarten beach policy bp the sint maarten building ordinance bo and the flood zoning fz under the ndp the bp forbids construction works within 50 m from the coastline it is ratified mainly for the purpose of protecting beaches recreational value however the policy implementation can have a direct effect on the exposure of household agents the bo and fz are drivers of the vulnerability of household agents because agents are obliged to elevate the floor of new houses the difference between the two is that the bo requires a minimum floor height of 0 2 m irrespective of the location of a house while the fz requires floor height of 0 5 m 1 0 m or 1 5 m depending on the delineated flood zones as shown in fig 2 the bp and bo are existing institutions while the fz is in the draft phase in our conceptualization we considered the whole island including part of the atlantic ocean as the urban environment the ocean is included to study impacts of coastal floods the urban environment is represented by a digital terrain model the hydrologic and hydrodynamic processes included in this study are rainfall runoff processes one dimensional channel flows two dimensional floodplain flows and hurricane induced storm surges as a result the flood impacts on the island are attributed to inland and coastal floods agents dynamics such as an expansion of built up areas on the island may affect the inland flood hazard the institutions mentioned above directly affect the exposure and vulnerability of agents rather than the flood hazards the only external factors considered here are the sources of flood rainfall and hurricane induced surge are the sources of inland and coastal floods respectively 5 2 building the agent based model once the claim elements are identified the maia meta model is used to conceptualize and structure the human subsystem and to formally describe it as a model agents in claim their states and behaviours are defined in the social structure of maia agents physical artefacts and the urban environment in claim are defined in the physical structure institutions and the external political and economic policies in claim are coded using the adico grammar within the institutional structure the dynamics of the subsystem which include agents actions and their interactions with other agents and the environment are defined in the operational structure then the maia structured descriptions of the human subsystem is converted to pseudo codes that can be implemented in programming languages the odd protocol grimm et al 2006 describing the abm is provided in the github repository mentioned in the software and data availability section for the actual software implementation one of the main criteria for choosing an abm modelling environment is that the environment should have gis capabilities as spatial considerations are important in claim e g households are identified by their unique locations and flood extents also have spatial attribute the second criterion would be ease of use in processing results of the coupled flood model or in manipulating flood model input files for the sint maarten case we develop an abm using the repast simphony modelling environment north et al 2013 for our case study we implement two agent types in the social structure household agents and government agent household agents are characterized by location and elevation and they have houses corresponding to the policies agents have attributes that reflect their behaviour we assume that there are only residential houses a household owns only one house and the agents have a static location the government agent is characterized by a level of policy enforcement in the institutional structure we describe the three institutions bp bo and fz we code the institutions using the adico grammar as shown in table 1 since there is no strict enforcement of the policies in sint maarten the or else component of adico is left blank however the institutions are still classified as rules and not norms as they are formal policies we assume that all household agents know about all the institutions as agents may not behave in the same way for all institutions e g an agent may build an elevated house but 20 m from the coastline each household agent has three parameters that correspond to the compliance of the three institutions i e bp bo and fz compliances these behaviour parameters are assigned randomly for the institutions we specify threshold compliance values in which agents comply with the institutions if their behaviour parameter is less than or equal to the compliance threshold the thresholds implicitly reflect the level of policy enforcement by the government agent for example household agents have an attribute a number between 0 and 1 that reflect their compliance to bo if the bo compliance threshold is 1 all household agents will comply with the bo since their attribute is less than the compliance threshold that can be interpreted as there is a strict enforcement of bo on the other hand if the compliance threshold is 0 household agents will not follow the bo because their compliance attribute has a value greater than the compliance threshold the physical structure is composed of houses and the urban environment the houses are characterized by location elevation and floor height the most important attribute of the urban environment is its imperviousness in the operational structure we define agents actions and interactions agent related actions are making a plan to build a house implementing the policies depending on the location of the plan and building the new house for example if the location of a house in the plan is 20 m from the coastline and if there is strict enforcement of the policy the government agent will not give building permit and there will not be new house whereas if there is low enforcement of the policy there will be a new house with potential exposure to coastal flooding flood related actions described in the operational structure are updating catchments imperviousness running the flood model executable processing result file uploading flood map and assessing impact 5 3 building the flood model the flood subsystem can be modelled using a coupled hydrologic and hydrodynamic models the preferred way of hydrodynamic modelling is simulating rivers and urban drainage networks open channels or pipes using one dimensional models coupled with two dimensional models for urban floodplains the flood model may simulate any one or combination of fluvial flash pluvial groundwater or coastal floods for the sint maarten frm case we build the flood model using the mike flood environment which couples mike11 and mike21 dhi 2016a in the flood model developed earlier version in vojinovic and tutulic 2009 mike11 is used to model the rainfall runoff processes and flows in the drainage channels we use design rainfall events of 5yr 10yr 20yr 50yr and 100yr recurrence intervals we assume that any rainfall magnitude below the 5yr recurrence interval does not cause flooding for rainfall runoff analysis we use the unit hydrograph method with scs runoff curve number dhi 2016b mike21 is used to model coastal flood and inland flood flows in the urban floodplains 5 4 coupling abm and flood models in the coupled model we consider the abm as a principal model and when we mention time steps we are referring to the time steps of the abm the reason is that the agent dynamics defined in the operational structure occur continuously and hence the abm runs in all the time steps the mike flood model to the contrary is executed only if there is a flood generating rainfall in a given time step for example based on a design rainfall event series given in fig 3 in the first time step since there is no flood generating rainfall only agent related actions are executed when the time step is 2 there is a rainfall with a recurrence interval of 100yr and hence all agent and flood related actions defined in the operational structure are executed in addition for practical reasons i e to be able to run the flood model automatically the link between the abm and flood model is embedded within the abm and hence the flood model is called and run from the abm environment the coupled abm flood model method starts by initializing the agents and the urban environment the initialization includes setting the social and physical structures and geographic boundaries then in each time step agent related actions run first agents actions and interactions that drive their exposure e g following the bp and vulnerability e g following bo or fz do not affect the flood model input files in that case only agents state is updated and its effect is evaluated later in the modelling process on the other hand if their actions and interactions lead to a change in the urban environment that affects the hazard component the hydrologic or hydrodynamic states and parameters are updated for example as agents continue to build new houses catchments imperviousness may increase therefore the rainfall runoff parameters should be updated accordingly next the flood related actions run as the link between the abm and flood model is embedded within the abm the flood dynamics are also coded in the operational structure of maia before running the flood model for the first time it must be calibrated in advance the calibration is based on the initial urban environment setting and after that the flood model runs based on the continuously updated urban environment the urban environment is updated in two cases the first is when new houses are built every time step we simplified the housing expansion mechanism in which the number and locations of new houses are based on the building permits issued by vromi and on the ndp land use map that is agents choose from a predefined set of potential future house locations the second case is when there is a decision to build flood hazard reduction measures which are improving drainage networks and building dykes an important remark here is that the coupled model building is designed considering long term frm plans in which institutions are created updated or measures are implemented in a longer time scale i e abm has time steps in years whereas flood events may happen for hours or days i e flood models usually have time steps in seconds or minutes thus we couple the two models by considering one flood event of a given duration happening within one abm time step in which the abm is suspended while the flood model runs the abm resumes once the flood model completes the run and produces the result finally flood impacts are assessed by overlaying the flood map over the urban environment agents attributes that reflect their state of exposure i e location and bp compliance and vulnerability i e floor height bo compliance and bp compliance may affect the outcome of the impact assessment for example if the flood depth where a house is located is below the house floor height the flood impact on that household will be zero since not all flood cases result in the implementation of frm measures the need for measures is an important decision making process in frm in the sint maarten frm case the government agent implements two structural measures widening channel cross sections and building dykes catchments where measures are implemented are selected based on the highest number of flooded houses if a measure is implemented the hydrologic and hydrodynamic states must again be updated after setting up the coupled model it is necessary to perform model verification and validation abms developed in the claim framework are verified using the evaluative structure of maia ghorbani et al 2013 which indicates the relationship between expected outcomes and agent actions in the sint maarten frm model if the bo and fz compliance thresholds increase a higher number of elevated houses are expected however changing the bp threshold should not affect the number of elevated houses regarding the model validation due to lack of empirical data regarding the flood and human dynamics at the same time validating the abm and coupled model is a challenge thus we performed expert validation using domain experts from the sint maarten disaster management and the vromi who were engaged during the model development 6 simulation result and discussion 6 1 simulation execution we design an abm experimentation to test the effect of the three institutions in reducing flood risk for that purpose we design a full factorial experiment setup by varying the institutions threshold values as follows the bo compliance threshold value is varied between 0 5 and 1 with a space of 0 25 the fz compliance threshold value is varied between 0 and 1 with a space of 0 25 the bp compliance threshold value is varied between 0 and 1 with a space of 0 25 in case of the fz and bp compliance threshold values the lower and higher limits of the ranges are set to 0 and 1 to test the extreme conditions of no compliance and total compliance respectively the lower end of the bo compliance threshold range is set to 0 5 because many people in sint maarten comply with this institution in addition to varying the threshold values we tested three other scenarios of the bp as indicated in table 1 the bp forbids the building of houses within 50 m of the coastline however considering the tradeoff between the economic benefits of building close to the coastline and reducing flood impacts from coastal floods we also tested if the policy forbids the building of houses within 0 m i e no policy and within 100 m of the coastline we instantiate the simulations with 12000 households in which 80 are elevated and run each experiment for 30 time steps with similar design rainfall event series shown in fig 3 we assume that a maximum of one flood event happens in a given time step where a time step represents one year a one factor at a time sensitivity analysis ten broeke et al 2016 is performed to assess how changes in some key input factors change the model outcome for example the initial number of agents has a direct linear relationship with the total number of flooded houses whereas the initial number of elevated houses has an indirect relationship furthermore to quantify the uncertainty related to the use of random numbers in the abm we run each model setup in repetition 10 times the results in figs 4 6 show the uncertainties using box plots 6 2 results and discussion the results in fig 4 show the number of flooded houses in response to agents compliance rate of the bo and fz fig 4a and c correspond to new houses whereas fig 4b and d correspond to all the houses on the island in general irrespective of the institution the number of flooded houses is higher with lower compliance thresholds i e low policy enforcement and it increases over time as the number of houses increases fig 4a and c shows the number of vulnerable agents in this case vulnerability is measured by the number of not elevated houses increase during the simulation period however for the same compliance threshold of both the bo and the fz not complying with the bo results in higher number of vulnerable agents compared to not complying with the fz in addition change in compliance threshold values for example an increase from 0 5 to 0 75 has a bigger effect in case of not complying with bo than not complying with fz the reason is that the bo affects the vulnerability of agents in the whole island while the fz affects small portions of the island as shown in fig 2 furthermore the areas delineated as flood zones are already well developed and existing agents are not affected by the fz results shown in fig 4b and d also follow the same reasoning increase in the compliance threshold of bo has a bigger effect on the total number of flooded houses that is observed more at the end of the simulations with an increase in the number of houses the figures also show that in 25 years i e from time step 4 to 29 the number of flooded houses because of a rainfall with 5yr recurrence interval rises by more than 20 in case of bo compliance threshold of 0 75 in fig 4d this is mainly attributed to the increase in the number of new houses in areas exposed to flooding in general because of the wider effect of the bo if agents fully comply with the ordinance or if there is strict enforcement by the government agent the vulnerability of residents will reduce which in turn will reduce the total impact on the other hand with its localized effect the fz can have a huge effect on reducing the vulnerability of residents in the delineated flood zones though its effect on reducing the total flood risk is very little fig 5 shows the effect of the bp on the exposure of agents in both cases of bps that forbids construction within 50 m and 100 m from the coastline increasing the compliance threshold has a minor effect on the total number of flooded houses moreover widening the no construction zone from 50 m to 100 m has a marginal reduction in the total number of flooded houses only at the end of the simulation period the reason is that as in the case of the fz the bp also does not impact all agents and the coastal flooding affects localized areas the results in figs 4 and 5 show the effect of an increase in the number of houses with varying exposure and vulnerability on the total impact however agents may also implement measures that reduce the flood hazard to demonstrate this feedback we introduce an institution in which the government agent implements a flood hazard reduction measure in a catchment with the highest number of flooded houses the conditions for this institution to be executed are i when there is a rainfall with a recurrence interval of 50yr or above in a given time step or ii the last measure was implemented at least 3 years before the current time step fig 6 shows that compared to results in fig 4a and b the total number of flooded houses decreases by almost half because of the reduction in the flood hazard with the model setup described analysing the flood risk even when agents have the highest compliance rate for each policy the total number of flooded houses increase with the increase in urban development in fact the total number of flooded houses is high at the beginning of the simulation however implementing flood hazard reduction measures in some catchments may reduce the number of flooded houses significantly especially in case of a bigger flood event at this point it is important to highlight that our analysis is subject to the uncertainties associated with the abm the flood model and the coupled model 7 conclusion traditional flood risk management and flood modelling practices have been solely focusing on the flood hazard reduction however as policymakers are challenged to develop resilient climate change adaptation and mitigation measures impacts of these policies on the exposure and vulnerability of communities is increasingly important in this work we presented the claim modelling framework which allows for improved conceptualization and simulation of coupled human flood systems the human subsystem consists of heterogeneous agents and institutions which shape agents decisions actions and interactions and are modelled using abm the flood subsystem consists of hydrologic and hydrodynamic processes which generate floods and are modelled using numerical flood models the dynamic link between the two subsystems happens through the urban environment the abm is coupled with the flood model to study the behaviour i e actions and interactions of agents in relation to the defined institutions and to evaluate agents exposure and vulnerability as well as the flood hazard the methodology presented to build a coupled model is designed considering long term frm plans than operational level during flood strategies the output of the coupled model is a level of flood risk in terms of assessed impact which is used as a proxy to measure the effectiveness of the institutions in the study area the main advantage of claim is that it is possible to explicitly model the human and flood subsystems using knowledge from the respective domains and link the two subsystems dynamically to study their interactions the framework provides an interdisciplinary approach by allowing knowledge integrations from hydrologists hydraulic engineers and social scientists the coupled abm flood modelling method also helps to study how levels of exposure i e number of assets at risk flood hazard i e flood magnitude and extent and vulnerability i e propensity to be affected change with changes in human behaviour i e policies and their implementations as demonstrated in the case of sint maarten frm models developed using claim can assess the dynamic impacts of proposed policies taking into account imperfectly rational and heterogeneous responses of individuals to the policies model outputs allow policymakers in frm decision making to adopt an appropriate adaptation measure that will reduce the future flood risk for example in sint maarten implementing hazard reduction measures significantly reduce the number of flooded houses in addition the government i e vromi may need to improve its inspection and enforcement of the building ordinance as it has a wider effect over the island to reduce the vulnerability of households further by incorporating implementations that change flood hazard exposure and vulnerability coupled abm flood models which utilize the claim framework allow flood risk to be examined as a function of time this provides a more comprehensive view of a flood risk than if it were calculated based on a single historical and fixed urban environment condition it is our belief that the claim framework and models built to represent heterogeneous agents together with the institutions that shape their behaviour will extend to socio hydrological orientated studies one of the limitations of claim is that conceptualizing and modelling two complex subsystems which in turn are comprised of further complex subsystems requires large amount of data the inclusion of additional or nested subsystems requires a balance between better representation of a system or needed complexity and building a very complicated model sivapalan and blöschl 2015 voinov and shugart 2013 in addition to the large data sets required to build each model model runs may require large computational resources in the current study this was a consequence of the two dimensional hydrodynamic model and the number of experiments and repetitions of the abm setup concerning the coupled abm flood model paradigm proposed to model the human flood interaction using claim the coupled model suffers from the limitations of both the abm and flood modelling techniques a substantial issue in modelling human flood interaction is the parametrization of human behaviour in abms see crooks and heppenstall 2012 for detailed limitations of abm the uncertainty of the coupled model will also increase as it includes uncertainties of the individual models claim is designed to analyse long term strategic level institutions that are considered during the flood disaster recovery and prevention stages to study the implications of operational level institutions that are considered during the preparedness and response stages the system conceptualization changes as the focus shifts to institutions such as early warning and dissemination plans and evacuation policies the agents and their attributes will change considering individual agents and their age gender or education status become more significant at that scale the structure of the coupled model also changes because the abm and flood model run simultaneously to evaluate agents behaviour as the flood propagates the modelling exercise presented in this paper analysed predefined institutions that agents may follow given their individual resources to extend the applicability of coupled abm flood models in socio hydrologic studies future studies could include endogenous institutional changes or the evolution of institutions through feedback mechanisms as described in ghorbani and bravo 2016 smajgl et al 2008 this may provide insight into how frm policies emerge bottom up or evolve in the future in addition analysing the uncertainty of the coupled model will help to better communicate the model outputs with stakeholders acknowledgements the research leading to these results has received funding from the european union seventh framework programme fp7 2007 2013 under grant agreement n 603663 for the research project pearl preparing for extreme and rare events in coastal regions we thank surfsara https www surf nl en for providing a high performance computing hpc cloud resources that we used to run all the simulations mentioned in the manuscript we are also grateful to the three anonymous reviewers who gave constructive comments that help us to improve the manuscript 
26306,in this paper we describe a modelling framework that allows the integration of human and physical components of flood risk within this framework flood risk management is conceptualized as a coupled human flood system the human subsystem includes individuals and their behaviour and institutions that shape human flood interaction the framework presents a dynamic integration between agent based models of individuals and institutions and numerical flood models we demonstrate the framework s modelling application by examining the effects of three institutions in the caribbean island of sint maarten the case study shows the capabilities of the framework by exploring impacts of existing policies on flood risk reduction coupled agent based flood models built using the framework are useful to analyse policy options that address flood hazard and communities vulnerability and exposure to support policy decision making these models also show how flood risk changes over time in relation to the human dynamics on the urban environment keywords coupled human flood systems socio hydrology institutions agent based modelling flood risk management urban flood modelling software and data availability program title coupled abm flood model developer yared abayneh abebe contact address y abebe un ihe org software access https github com yaredo77 coupled abm flood model software required repast simphony 2 4 https repast github io and mike flood 2016 https www mikepoweredbydhi com products mike flood program language java availability the full agent based model is available for free the flood model and input data used in the abm are not available due to data confidentiality license this work is licensed under a creative commons attribution noncommercial sharealike 4 0 international license 1 introduction of all weather related disasters in the last two decades floods are by far the most common 47 affecting 2 3 billion people cred and unisdr 2015 the cred and unisdr report emphasizes that after storms and geophysical disasters floods have been causing the third highest amount of economic damage 662 billion usd over the past 20 years the number of flood events has significantly increased in which urban areas have been hit particularly hard jha et al 2012 the risk associated with floods can be defined as the probability of negative impacts due to floods schanze 2006 flood impacts are mainly attributed to the extent and magnitude of a flood hazard which can be caused by one or a combination of fluvial flash pluvial groundwater and coastal floods vojinovic and huang 2014 however the negative impacts are also due to the vulnerability and exposure of natural and human elements such as individuals livelihoods economic and cultural assets infrastructure ecosystems and environmental resources vojinovic et al 2016 hence floods are not just nature related disasters rather they are the result of meteorological and hydrological factors aggravated by human actions apfm 2012 changes in the climate system and economic social cultural institutional and governance factors are drivers of flood hazard vulnerability and exposure ipcc 2014 2012 for example in the context of urban flood risk population growth and the associated urban expansion result in changes to land use and land cover that leads to an increase in impermeable surfaces and more flooding and hence affects flood hazard when accompanied by inadequate planning and policies urban expansion may happen in flood prone areas increasing exposure or happen in dense low quality informal settlements that contribute to a higher number of vulnerable people jha et al 2012 for example in uk the government acknowledged that the increasing demand for housing leads to more building in high flood risk zones department for communities and local government 2007 in which the proportion of new residential properties located in flood zones grow from 7 in 2013 14 to 9 in 2015 16 department for communities and local government 2016 moreover the behaviour of individuals plays an important role in flood risk based on their economic situation and risk perception which is a function of values feelings experiences and cultural perspectives schanze 2006 heterogeneous individuals living in flood prone areas may implement their own local measures to reduce hazard e g green roofs or rainwater tanks vojinovic and huang 2014 or vulnerability e g dwellings with a non habitable ground floor gersonius et al 2008 further individuals may insure their properties to avoid huge financial losses or to recover better in the case of flooding currently governments are reorganizing flood insurance policies changing individual behaviour dubbelboer et al 2017 individuals may also reduce exposure to flood hazard by relocating assets to less flood prone areas and through evacuations unisdr 2015 in flood risk management frm the likelihood of adopting and implementing measures that reduce flood hazard vulnerability and exposure depends on changes in individual and institutional behaviour in response to the potential of flooding and the accompanying impact loucks 2015 therefore on the one hand frm is dependent on the rules regulations policies and implementations that aim to reduce flood risk but on the other hand it relies on how individuals react towards those aspects and adapt their behaviour the factors which shape the flood hazard and a community s exposure and vulnerability to flooding can be understood as institutions institutions are sets of humanly devised constraints that shape human interaction north 1990 they are key elements in the social economic and political makeup of human beings that define our interaction with the physical system the importance of institutions as social structures that influence the society as a whole and in turn are influenced by the society has been repeatedly emphasized by prominent scholars in economics political science and sociology among others e g hodgson 1988 north 1990 ostrom 1990 to strengthen frm and to reduce flood risk a more holistic interdisciplinary approach that integrates all components of risk is essential aerts et al 2018 this approach should consider the interaction between human and physical subsystems schanze 2006 vojinovic 2015 the human subsystem consists of decision making individuals whose collective behaviour creates and is constrained by institutions such as norms habits and laws the human subsystem is embedded in and interacts with the physical subsystem the physical subsystem includes drainage systems and dykes that might be affected by flood events with interactions across multiple spatial temporal and organizational scales and behaviour driven by imperfect information and bounded rationality the coupled human flood system is a complex system see also pahl wostl 2015 further as individuals and organizations learn mitchell 2009 from previous flood impacts the human flood system is a complex adaptive system cas a systems approach which explicitly takes into account institutions as factors that shape the flood hazard and community s exposure and vulnerability to flooding has not yet been sufficiently addressed in the literature one notable related work is presented by yu et al 2017 which examines collective actions in polder flooding as a contribution to the major advances in socio hydrology sivapalan et al 2012 in recent years we aim to add these key social aspects to the domain the aim of this paper is to develop a modelling framework and a methodology to build models for holistic frm the framework called coupled flood agent institution modelling framework claim integrates actors institutions the urban environment hydrologic and hydrodynamic processes and external factors which affect local frm activities the framework defines the system as a cas and conceptualizes the complex interaction of floods humans and their environment as drivers of flood hazard vulnerability and exposure in the methodology that accompanies claim framework the human subsystem is modelled using the agent based modelling approach abm consequently claim incorporates heterogeneous actors and their actions and interactions with the environment and flooding it also provides the possibility to analyse the underlying institutions that govern the actions and interactions in managing flood risk by incorporating maia modelling agent systems using institutional analysis meta model ghorbani et al 2013 the flood subsystem is modelled using physically based numerical model the abm is dynamically coupled to the flood model in order to understand how humans interact with the environment and to investigate the effect of different institutions and frm policy options we apply the framework to the frm case of the caribbean island of sint maarten to show the functionality of claim and the policy insights gained from coupled abm flood model outputs 2 relationship to existing human flood interaction studies in this section we summarize the state of the literature regarding modelling approaches that have been used to study coupled human flood interactions the use of numerical flood models has been invaluable in frm as they are used to simulate the physics of floods in relation to any state of the system however careful attention to data collection and processing as well as model instantiation is needed in order to gain full benefits from numerical models e g vojinovic et al 2013 2011 2006 recently modelling of the coupled human flood system is getting more attention in socio hydrology which mainly studies the co evolution of humans and water explicitly by considering the possibility of generating emergent behaviours sivapalan et al 2012 in socio hydrology the human subsystem is considered as an endogenous part of the water subsystem and there is a two way interaction between the two subsystems sivapalan and blöschl 2015 identify two possible approaches to model coupled human flood interactions the first ones are called stylized models and they formalize the human and flood subsystems processes using a single differential equation the second type of models are called comprehensive system of systems models and they represent the subsystems by individual models that are based on well established methodologies from the relevant disciplines examples of stylized models that conceptualize the dynamics of settled floodplains as a complex human flood system include those discussed by di baldassarre et al 2013 2015 and viglione et al 2014 in the conceptual models they consider hydrological economic political technological and social processes that co evolve over time but can be altered by a sudden occurrence of flooding they formalize the feedbacks and interactions deriving the behaviour of the system using a set of differential equations these models are easy to use and flexible but as also pointed out by the authors the main drawback of the stylized models is that they neglect the heterogeneity that exists within the human subsystem in addition their conceptualization is based on societal memory or experience of prior flood events as a link between the human and flood subsystems and it does not incorporate the institutions that shape the behaviour of humans in their interaction with their environment and flood yu et al 2017 study the human flood interaction in polders of coastal bangladesh by including institutions for collective actions they model informal institutions mainly the norm that local people cooperate on the collective maintenance of embankments that enclose the polders because of fear of losing a good name or reputation in the community which leads to social ostracism that outcasts defectors and refuses help in times of need yet again yu et al use stylized models that do not consider heterogeneity and focus only on institutions for collective actions conversely studies such as dawson et al 2011 tesfatsion et al 2017 valkering et al 2005 conceptualize the human and flood subsystems separately and model the human subsystem using abm considering heterogeneous actors decision making however the main gap in these studies is that either they use simplified flood models and a set of behavioural rules or they do not methodically analyze institutions to study drivers of flood risk votsis 2017 utilized cellular automaton model to study the relationship between urbanization trends and frm strategies the study shows the effects of bottom up flood risk information based housing market responses and top down floodplain development restriction scenarios on urbanization however the study does not show if the flood extent and depth changes with the development pattern it also focuses only on the exposure component of the flood risk in general there are important initiatives to model the human flood interactions using systems perspective however these efforts do not address either analysing institutions or heterogeneity of actors or all components of the flood risk i e hazard vulnerability and exposure in their modelling exercise in this paper we develop a framework that helps to explicitly conceptualize heterogeneous agents and institutions and propose a modelling methodology that couples abm and flood model 3 theoretical background in order to build a holistic modelling framework for frm a comprehensive systems view needs to be taken into account to cover the human and physical aspects of the system in this section we explain our modelling approach by introducing the methods and language used for building holistic models 3 1 agent based modelling approach for frm the main advantage of the cas perspective introduced earlier is its ability to dynamically link two different subsystems i e the human subsystem and the flood subsystem and to model their interaction models which incorporate the systems thinking may consider structural change learning and innovation and hence provide a new basis for policy exploration allen et al 2008 since the human subsystem is a cas by itself it requires careful selection of modelling methods to simulate heterogeneity and adaptation for example the classical reductionist modelling methods such as partial differential equations or statistical techniques such as regression and bayesian nets have limitations in modelling cas holland 2006 these methods are characterized by restrictive or unrealistic assumptions such as linearity homogeneity normality and stationarity bankes 2002 hence methods which capture a more realistic view of cas shall be used of these methodologies abms provide the most natural description and simulation of a cas bonabeau 2002 and relax the assumptions that characterize differential equations and statistical models bankes 2002 abms offer a way to model social systems that are composed of agents who interact with and influence each other learn from their experiences and adapt their behaviours so they are better suited to their environment macal and north 2010 an abm consists of three elements a set of agents actor is the real thing and agent is actor s representation in a model set of agent relationships and methods of interaction and agents environment macal and north 2010 as highlighted by filatova et al 2013 since abms primarily focus on human behaviour integrating them with other domain modelling methods better inform policy challenges in coupled human natural systems hence in frm studies abms can be integrated with physically based flood models to analyse the institutions that affect flood hazard vulnerability and exposure 3 2 institutional analysis as mentioned previously human behaviour is governed by a set of rules known as institutions institutions can be expressed and modelled through institutional statements described by the adico grammatical syntax crawford and ostrom 1995 ghorbani et al 2013 according to crawford and ostrom institutional statement refers to the shared linguistic constraint or opportunity that prescribes permits or advises actions or outcomes for actors institutional statements are spoken written or tacitly understood in a form intelligible to actors in an empirical setting in a way institutions have conceptual or abstract nature while institutional statements are linguistic statements basurto et al 2010 in adico grammatical syntax a refers to attributes d refers to deontic i refers to aim c refers to condition and o refers to or else crawford and ostrom 1995 the attribute is the actor to whom the institutional statement applies the deontic is the modal operator which can be permitted obliged or forbidden the aim describes the actions or outcomes to which the institutional statement refers it defines what action is conducted and how the action is conducted basurto et al 2010 the condition defines when and where the aim is permitted obliged or forbidden finally the or else describes the sanction for failing to comply with a rule if an institutional statement consists of aic it is regarded as a shared strategy if the statement consists of adic it is a norm and if the statement contains all the five components it is called a rule crawford and ostrom 1995 to structure and conceptualize social systems by emphasizing on institutions and to build abms we use the maia modelling agent systems using institutional analysis meta model ghorbani et al 2013 as it provides a comprehensive modelling language maia is a formalized representation of the institutional analysis and development framework ostrom et al 1994 and it is the only agent based modelling language that systematically and explicitly incorporates institutions into models maia makes use of the adico grammar to conceptualize and model different types of institutions the maia meta model is organized into five structures social structure defines agents and their attributes such as properties behaviour and decision making institutional structure defines the social context such as role of agents and institutions that govern agents behaviour physical structure defines the physical aspects of the system such as infrastructure operational structure defines the dynamics of the system and finally the evaluative structure defines the concepts that are used to validate and measure the outcomes of the system see also verhoog et al 2016 for details of maia 4 claim the coupled flood agent institution modelling framework to capture the main components of the coupled human flood system that is to be studied and modelled we develop the claim framework claim is composed of five elements agents institutions urban environment physical processes and external factors using claim a system can be socially and physically conceptualized and modelled as a coupled human flood system such a holistic model provides the possibility to test various policy scenarios for frm because of the explicit modelling and integration of such policies in the model it is possible to explore how different scenarios affect actors and the physical environment and vice versa the framework also defines the system boundary and identifies the type and level of interaction within the system claim is specifically designed for the context of urban frm it is based on the cas perspective takes abm and physically based flood models as the modelling approach and uses maia to structure the institutions and build the abm fig 1 illustrates the concepts of the framework and their relations in the following subsections we will describe each element by providing generic examples 4 1 agents agents represent individuals or composite actors that are a collection of actors such as an organizational entity or a household an agent has an internal state that represents the essential variables associated with its current situation and behaviours that relate information sensed by the agent to its decisions and actions macal and north 2010 agents state may have intrinsic nature such as age gender and household size the environment may also define agents state as agents perceive the urban environment and set their state for example the location and elevation of a house which can be extracted from the topographic map define the internal state of an agent if there is a flood event agents also perceive whether they are flooded and update their state the behaviour of the agent consists of its decision making process and the action that takes place as a result examples of these actions include building a house constructing frm measures or purchasing flood insurance agents behaviour can be influenced by their internal state and vice versa for example if there is a flood event and a house is flooded i e agent s state updates the agent may decide to protect the house by flood proofing i e the new state resulting in a change in behaviour alternatively if an agent decides to build an elevated house i e agent s behaviour the house will not be flooded i e no update in agent s state unless the flood level is higher than the floor height as agents are social their interaction with other agents may also change their behaviour extending the above example an agent s decision to build an elevated house may be incentivized by an insurance firm agent through lower premiums 4 2 institutions humans devise institutions whose goal is to shape human behaviour therefore institutions have a two way relationship with agents in claim on the one hand institutions may influence agents behaviour depending on their heterogeneity in making decisions and complying or not with the institutions for example the eu floods directive european commission 2007 demands member states to assess the potential risk of flooding and to prepare flood hazard and risk maps based on these rules member states engage in activities i e influence on the government agents behaviour to comply with an agreed deadline on the other hand agents may create change or abolish institutions for example after hurricane sandy the u s federal emergency management agency improved the high risk areas map for coastal flooding in new york dixon et al 2013 consequently the flood insurance rate maps are also changed which in effect changed the flood insurance premiums of businesses and residents the institutions defined here are internal i e set within the system boundary rules norms and shared strategies that can influence agents behaviours and they can also be changed by the agents in models they can be defined exogenously as fixed parameters that the agents only follow or endogenously as dependent variables that are updated over time as a response to agents behaviour the latter may show the evolution of institutions through feedbacks in claim institutions are not directly linked with the urban environment as their impact is only through the influence they have on agents agents perceive and follow or not institutions prescribed by them and act on the urban environment conversely agents perceive the urban environment mainly when there is a change in the urban environment such as flooding and may update institutions for example to designate floodplains as no building zones 4 3 urban environment agents are situated in an environment which contains all the information external to the agent and provides space for agents interaction nikolic and kasmire 2013 in claim agents live and build their livelihood and physical artefacts in the urban physical environment at the same time floods also happen in the same environment as a result in fig 1 we illustrate the urban environment as a link between the human and flood subsystems for example if agents want to reduce flood hazard they do not try to directly influence rainfall magnitude and patterns they rather implement measures such as detention basins in the urban environment to retain excess rainfall the urban environment consists of the built and natural environments the built environment includes buildings roads drainage networks and flood reduction measures whereas the natural environment includes natural watercourses and floodplains changes in the urban environment are driven by the institutions and states of the agents for example with an increase in income level individuals may decide to build more houses based on a new economic policy governments may build more roads or to reduce a recurrent riverine flooding municipalities may invest on the construction of dykes along a river bank as geographic information is crucial in frm the urban environment is a physically defined space based on gis maps such as topography map and building and road layers the urban environment sets the spatial boundary and its size depends on the objective of the study 4 4 physical processes although the physical processes occur on the urban environment we separate the two elements i e the processes and the environment to emphasize that our focus is only on flooding and not on other types of hazard e g earthquake or landslide that may occur in the same environment aspects of the urban environment that are directly linked to floods such as drainage networks rivers and hydraulic structures are represented in the hydrologic and hydrodynamic processes depending on the magnitude of the source of flood and presence and capacity of frm measures flood may occur flood is represented by flood maps showing its extent depth and velocity and the map is overlaid over the urban environment to assess the impacts on people and properties agents affect the hydrologic and hydrodynamic processes through their actions on the urban environment for example land cover change such as the construction of more houses and paved parking lots may increase the imperviousness of the surface and hence contribute to higher runoff whereas if agents implement adaptation and mitigation measures such as green roofs water harvesting barrels or levees that reduces runoff generation similarly the processes have an effect on the agents through the urban environment flood maps overlaid on the urban environment may define agents internal states for example by changing their states from not flooded to flooded 4 5 external factors there are two sets of external factors which are important in influencing the flood human urban environment interaction source of flood and external economic and political factors a flood occurs when there is a hydro meteorological event that causes it for example in flash floods the source can be intense rainfall or in the case of coastal floods the source can be a hurricane induced surge although the hydro meteorological events are necessary conditions for the occurrence of floods they are classified as external factors given agents do not have the power to regulate them agents can only reduce the flood hazard associated with the events by implementing frm measures i e drivers of hazard the external economic and political factors can be institutions though these factors are beyond the direct influence of the actions and interactions of agents and internal institutions in the defined urban system thus in models they can only be defined exogenously for example a global financial crisis may affect budgets a government agent may allocate for frm measures an example of external political factors can be the requirements of eu floods directive european commission 2007 demanding member states to map and assess their flood risk 5 building a coupled model using claim to model the complex human flood system we use a coupled component model approach kelly et al 2013 that integrates a physically based model to model the flood subsystem and an abm to model the human subsystem model integration may follow multiple phases such as pre integration assessment preparation of models model orchestration data interoperability and testing belete et al 2017 to build a coupled abm flood model we have summarized the modelling process into four main steps 1 conceptualizing the system using the claim framework 2 building an abm of the human subsystem 3 building a flood model of the flood subsystem 4 coupling the abm and the flood model step 1 is related to the pre integration assessment steps 2 and 3 are related to the preparation of component models and step 4 incorporates orchestration and data operability to demonstrate the application of the claim approach we use the sint maarten frm which is one of the fp7 pearl project www pearl fp7 eu case study areas as a case study for a complex human flood system we would like to emphasize that this case study is used to help explain the functionality and applicability of the framework therefore we have not gone into the details of the model output and lessons learned from it to keep the focus after describing the case we discuss the above four steps in more detail case description sint maarten is a caribbean island state located in the north atlantic ocean and subject to frequent hurricanes vojinovic and teeffelen 2007 the potential impact due to hurricanes and isolated heavy rainfalls has increased considerably over the recent years due to economic and population growth on the island reflecting on previous disasters it is apparent that the disaster prevention preparedness and mitigations on the island have not been sufficiently developed to be able to cope with potential disasters for sint maarten authorities the ability to address and minimize the risk of flood related disasters represents a major challenge hence a policy plan was drafted to improve disaster management on the island the government of sint maarten is also drafting a national development plan ndp with the plan the government will introduce building codes and suggest floor height elevations for flood prone areas to reduce flood risk therefore our aim is to conceptualize the frm in sint maarten using claim and to build a coupled abm flood model we perform scenario based simulations to analyse the implications of policies i e institutions and evaluate how different agents responses to existing and future policies influence the overall flood risk 5 1 conceptualizing the system using claim the first step towards building a coupled abm flood model is to formulate the human flood interaction problem that needs to be investigated and to decompose and structure the concepts related to the two subsystems besides guiding the collection of primary and secondary data depending on the level of detail we want to represent in the models this step provides the different knowledge domains or expertise required to build the agent based and flood models basically this step is about deciding the model boundary and identifying the five components of the claim framework in the coupled system for the sint maarten frm case we have identified two key agents household agents and government agent the household agents are individual agents that represent the population living in sint maarten these agents make decisions on whether to implement policies that are devised by the government of sint maarten to reduce flood risk the government agent in our conceptualization is a composite agent that comprises the permits the inspection and the new projects and management departments of the ministry of public housing spatial planning environment and infrastructure of the government of sint maarten vromi the three departments play a major role in designing regulating and inspecting urban planning policies that shape the hazard and household agents exposure and vulnerability we have also identified three formal institutions to shape the human flood interaction these institutions are the sint maarten beach policy bp the sint maarten building ordinance bo and the flood zoning fz under the ndp the bp forbids construction works within 50 m from the coastline it is ratified mainly for the purpose of protecting beaches recreational value however the policy implementation can have a direct effect on the exposure of household agents the bo and fz are drivers of the vulnerability of household agents because agents are obliged to elevate the floor of new houses the difference between the two is that the bo requires a minimum floor height of 0 2 m irrespective of the location of a house while the fz requires floor height of 0 5 m 1 0 m or 1 5 m depending on the delineated flood zones as shown in fig 2 the bp and bo are existing institutions while the fz is in the draft phase in our conceptualization we considered the whole island including part of the atlantic ocean as the urban environment the ocean is included to study impacts of coastal floods the urban environment is represented by a digital terrain model the hydrologic and hydrodynamic processes included in this study are rainfall runoff processes one dimensional channel flows two dimensional floodplain flows and hurricane induced storm surges as a result the flood impacts on the island are attributed to inland and coastal floods agents dynamics such as an expansion of built up areas on the island may affect the inland flood hazard the institutions mentioned above directly affect the exposure and vulnerability of agents rather than the flood hazards the only external factors considered here are the sources of flood rainfall and hurricane induced surge are the sources of inland and coastal floods respectively 5 2 building the agent based model once the claim elements are identified the maia meta model is used to conceptualize and structure the human subsystem and to formally describe it as a model agents in claim their states and behaviours are defined in the social structure of maia agents physical artefacts and the urban environment in claim are defined in the physical structure institutions and the external political and economic policies in claim are coded using the adico grammar within the institutional structure the dynamics of the subsystem which include agents actions and their interactions with other agents and the environment are defined in the operational structure then the maia structured descriptions of the human subsystem is converted to pseudo codes that can be implemented in programming languages the odd protocol grimm et al 2006 describing the abm is provided in the github repository mentioned in the software and data availability section for the actual software implementation one of the main criteria for choosing an abm modelling environment is that the environment should have gis capabilities as spatial considerations are important in claim e g households are identified by their unique locations and flood extents also have spatial attribute the second criterion would be ease of use in processing results of the coupled flood model or in manipulating flood model input files for the sint maarten case we develop an abm using the repast simphony modelling environment north et al 2013 for our case study we implement two agent types in the social structure household agents and government agent household agents are characterized by location and elevation and they have houses corresponding to the policies agents have attributes that reflect their behaviour we assume that there are only residential houses a household owns only one house and the agents have a static location the government agent is characterized by a level of policy enforcement in the institutional structure we describe the three institutions bp bo and fz we code the institutions using the adico grammar as shown in table 1 since there is no strict enforcement of the policies in sint maarten the or else component of adico is left blank however the institutions are still classified as rules and not norms as they are formal policies we assume that all household agents know about all the institutions as agents may not behave in the same way for all institutions e g an agent may build an elevated house but 20 m from the coastline each household agent has three parameters that correspond to the compliance of the three institutions i e bp bo and fz compliances these behaviour parameters are assigned randomly for the institutions we specify threshold compliance values in which agents comply with the institutions if their behaviour parameter is less than or equal to the compliance threshold the thresholds implicitly reflect the level of policy enforcement by the government agent for example household agents have an attribute a number between 0 and 1 that reflect their compliance to bo if the bo compliance threshold is 1 all household agents will comply with the bo since their attribute is less than the compliance threshold that can be interpreted as there is a strict enforcement of bo on the other hand if the compliance threshold is 0 household agents will not follow the bo because their compliance attribute has a value greater than the compliance threshold the physical structure is composed of houses and the urban environment the houses are characterized by location elevation and floor height the most important attribute of the urban environment is its imperviousness in the operational structure we define agents actions and interactions agent related actions are making a plan to build a house implementing the policies depending on the location of the plan and building the new house for example if the location of a house in the plan is 20 m from the coastline and if there is strict enforcement of the policy the government agent will not give building permit and there will not be new house whereas if there is low enforcement of the policy there will be a new house with potential exposure to coastal flooding flood related actions described in the operational structure are updating catchments imperviousness running the flood model executable processing result file uploading flood map and assessing impact 5 3 building the flood model the flood subsystem can be modelled using a coupled hydrologic and hydrodynamic models the preferred way of hydrodynamic modelling is simulating rivers and urban drainage networks open channels or pipes using one dimensional models coupled with two dimensional models for urban floodplains the flood model may simulate any one or combination of fluvial flash pluvial groundwater or coastal floods for the sint maarten frm case we build the flood model using the mike flood environment which couples mike11 and mike21 dhi 2016a in the flood model developed earlier version in vojinovic and tutulic 2009 mike11 is used to model the rainfall runoff processes and flows in the drainage channels we use design rainfall events of 5yr 10yr 20yr 50yr and 100yr recurrence intervals we assume that any rainfall magnitude below the 5yr recurrence interval does not cause flooding for rainfall runoff analysis we use the unit hydrograph method with scs runoff curve number dhi 2016b mike21 is used to model coastal flood and inland flood flows in the urban floodplains 5 4 coupling abm and flood models in the coupled model we consider the abm as a principal model and when we mention time steps we are referring to the time steps of the abm the reason is that the agent dynamics defined in the operational structure occur continuously and hence the abm runs in all the time steps the mike flood model to the contrary is executed only if there is a flood generating rainfall in a given time step for example based on a design rainfall event series given in fig 3 in the first time step since there is no flood generating rainfall only agent related actions are executed when the time step is 2 there is a rainfall with a recurrence interval of 100yr and hence all agent and flood related actions defined in the operational structure are executed in addition for practical reasons i e to be able to run the flood model automatically the link between the abm and flood model is embedded within the abm and hence the flood model is called and run from the abm environment the coupled abm flood model method starts by initializing the agents and the urban environment the initialization includes setting the social and physical structures and geographic boundaries then in each time step agent related actions run first agents actions and interactions that drive their exposure e g following the bp and vulnerability e g following bo or fz do not affect the flood model input files in that case only agents state is updated and its effect is evaluated later in the modelling process on the other hand if their actions and interactions lead to a change in the urban environment that affects the hazard component the hydrologic or hydrodynamic states and parameters are updated for example as agents continue to build new houses catchments imperviousness may increase therefore the rainfall runoff parameters should be updated accordingly next the flood related actions run as the link between the abm and flood model is embedded within the abm the flood dynamics are also coded in the operational structure of maia before running the flood model for the first time it must be calibrated in advance the calibration is based on the initial urban environment setting and after that the flood model runs based on the continuously updated urban environment the urban environment is updated in two cases the first is when new houses are built every time step we simplified the housing expansion mechanism in which the number and locations of new houses are based on the building permits issued by vromi and on the ndp land use map that is agents choose from a predefined set of potential future house locations the second case is when there is a decision to build flood hazard reduction measures which are improving drainage networks and building dykes an important remark here is that the coupled model building is designed considering long term frm plans in which institutions are created updated or measures are implemented in a longer time scale i e abm has time steps in years whereas flood events may happen for hours or days i e flood models usually have time steps in seconds or minutes thus we couple the two models by considering one flood event of a given duration happening within one abm time step in which the abm is suspended while the flood model runs the abm resumes once the flood model completes the run and produces the result finally flood impacts are assessed by overlaying the flood map over the urban environment agents attributes that reflect their state of exposure i e location and bp compliance and vulnerability i e floor height bo compliance and bp compliance may affect the outcome of the impact assessment for example if the flood depth where a house is located is below the house floor height the flood impact on that household will be zero since not all flood cases result in the implementation of frm measures the need for measures is an important decision making process in frm in the sint maarten frm case the government agent implements two structural measures widening channel cross sections and building dykes catchments where measures are implemented are selected based on the highest number of flooded houses if a measure is implemented the hydrologic and hydrodynamic states must again be updated after setting up the coupled model it is necessary to perform model verification and validation abms developed in the claim framework are verified using the evaluative structure of maia ghorbani et al 2013 which indicates the relationship between expected outcomes and agent actions in the sint maarten frm model if the bo and fz compliance thresholds increase a higher number of elevated houses are expected however changing the bp threshold should not affect the number of elevated houses regarding the model validation due to lack of empirical data regarding the flood and human dynamics at the same time validating the abm and coupled model is a challenge thus we performed expert validation using domain experts from the sint maarten disaster management and the vromi who were engaged during the model development 6 simulation result and discussion 6 1 simulation execution we design an abm experimentation to test the effect of the three institutions in reducing flood risk for that purpose we design a full factorial experiment setup by varying the institutions threshold values as follows the bo compliance threshold value is varied between 0 5 and 1 with a space of 0 25 the fz compliance threshold value is varied between 0 and 1 with a space of 0 25 the bp compliance threshold value is varied between 0 and 1 with a space of 0 25 in case of the fz and bp compliance threshold values the lower and higher limits of the ranges are set to 0 and 1 to test the extreme conditions of no compliance and total compliance respectively the lower end of the bo compliance threshold range is set to 0 5 because many people in sint maarten comply with this institution in addition to varying the threshold values we tested three other scenarios of the bp as indicated in table 1 the bp forbids the building of houses within 50 m of the coastline however considering the tradeoff between the economic benefits of building close to the coastline and reducing flood impacts from coastal floods we also tested if the policy forbids the building of houses within 0 m i e no policy and within 100 m of the coastline we instantiate the simulations with 12000 households in which 80 are elevated and run each experiment for 30 time steps with similar design rainfall event series shown in fig 3 we assume that a maximum of one flood event happens in a given time step where a time step represents one year a one factor at a time sensitivity analysis ten broeke et al 2016 is performed to assess how changes in some key input factors change the model outcome for example the initial number of agents has a direct linear relationship with the total number of flooded houses whereas the initial number of elevated houses has an indirect relationship furthermore to quantify the uncertainty related to the use of random numbers in the abm we run each model setup in repetition 10 times the results in figs 4 6 show the uncertainties using box plots 6 2 results and discussion the results in fig 4 show the number of flooded houses in response to agents compliance rate of the bo and fz fig 4a and c correspond to new houses whereas fig 4b and d correspond to all the houses on the island in general irrespective of the institution the number of flooded houses is higher with lower compliance thresholds i e low policy enforcement and it increases over time as the number of houses increases fig 4a and c shows the number of vulnerable agents in this case vulnerability is measured by the number of not elevated houses increase during the simulation period however for the same compliance threshold of both the bo and the fz not complying with the bo results in higher number of vulnerable agents compared to not complying with the fz in addition change in compliance threshold values for example an increase from 0 5 to 0 75 has a bigger effect in case of not complying with bo than not complying with fz the reason is that the bo affects the vulnerability of agents in the whole island while the fz affects small portions of the island as shown in fig 2 furthermore the areas delineated as flood zones are already well developed and existing agents are not affected by the fz results shown in fig 4b and d also follow the same reasoning increase in the compliance threshold of bo has a bigger effect on the total number of flooded houses that is observed more at the end of the simulations with an increase in the number of houses the figures also show that in 25 years i e from time step 4 to 29 the number of flooded houses because of a rainfall with 5yr recurrence interval rises by more than 20 in case of bo compliance threshold of 0 75 in fig 4d this is mainly attributed to the increase in the number of new houses in areas exposed to flooding in general because of the wider effect of the bo if agents fully comply with the ordinance or if there is strict enforcement by the government agent the vulnerability of residents will reduce which in turn will reduce the total impact on the other hand with its localized effect the fz can have a huge effect on reducing the vulnerability of residents in the delineated flood zones though its effect on reducing the total flood risk is very little fig 5 shows the effect of the bp on the exposure of agents in both cases of bps that forbids construction within 50 m and 100 m from the coastline increasing the compliance threshold has a minor effect on the total number of flooded houses moreover widening the no construction zone from 50 m to 100 m has a marginal reduction in the total number of flooded houses only at the end of the simulation period the reason is that as in the case of the fz the bp also does not impact all agents and the coastal flooding affects localized areas the results in figs 4 and 5 show the effect of an increase in the number of houses with varying exposure and vulnerability on the total impact however agents may also implement measures that reduce the flood hazard to demonstrate this feedback we introduce an institution in which the government agent implements a flood hazard reduction measure in a catchment with the highest number of flooded houses the conditions for this institution to be executed are i when there is a rainfall with a recurrence interval of 50yr or above in a given time step or ii the last measure was implemented at least 3 years before the current time step fig 6 shows that compared to results in fig 4a and b the total number of flooded houses decreases by almost half because of the reduction in the flood hazard with the model setup described analysing the flood risk even when agents have the highest compliance rate for each policy the total number of flooded houses increase with the increase in urban development in fact the total number of flooded houses is high at the beginning of the simulation however implementing flood hazard reduction measures in some catchments may reduce the number of flooded houses significantly especially in case of a bigger flood event at this point it is important to highlight that our analysis is subject to the uncertainties associated with the abm the flood model and the coupled model 7 conclusion traditional flood risk management and flood modelling practices have been solely focusing on the flood hazard reduction however as policymakers are challenged to develop resilient climate change adaptation and mitigation measures impacts of these policies on the exposure and vulnerability of communities is increasingly important in this work we presented the claim modelling framework which allows for improved conceptualization and simulation of coupled human flood systems the human subsystem consists of heterogeneous agents and institutions which shape agents decisions actions and interactions and are modelled using abm the flood subsystem consists of hydrologic and hydrodynamic processes which generate floods and are modelled using numerical flood models the dynamic link between the two subsystems happens through the urban environment the abm is coupled with the flood model to study the behaviour i e actions and interactions of agents in relation to the defined institutions and to evaluate agents exposure and vulnerability as well as the flood hazard the methodology presented to build a coupled model is designed considering long term frm plans than operational level during flood strategies the output of the coupled model is a level of flood risk in terms of assessed impact which is used as a proxy to measure the effectiveness of the institutions in the study area the main advantage of claim is that it is possible to explicitly model the human and flood subsystems using knowledge from the respective domains and link the two subsystems dynamically to study their interactions the framework provides an interdisciplinary approach by allowing knowledge integrations from hydrologists hydraulic engineers and social scientists the coupled abm flood modelling method also helps to study how levels of exposure i e number of assets at risk flood hazard i e flood magnitude and extent and vulnerability i e propensity to be affected change with changes in human behaviour i e policies and their implementations as demonstrated in the case of sint maarten frm models developed using claim can assess the dynamic impacts of proposed policies taking into account imperfectly rational and heterogeneous responses of individuals to the policies model outputs allow policymakers in frm decision making to adopt an appropriate adaptation measure that will reduce the future flood risk for example in sint maarten implementing hazard reduction measures significantly reduce the number of flooded houses in addition the government i e vromi may need to improve its inspection and enforcement of the building ordinance as it has a wider effect over the island to reduce the vulnerability of households further by incorporating implementations that change flood hazard exposure and vulnerability coupled abm flood models which utilize the claim framework allow flood risk to be examined as a function of time this provides a more comprehensive view of a flood risk than if it were calculated based on a single historical and fixed urban environment condition it is our belief that the claim framework and models built to represent heterogeneous agents together with the institutions that shape their behaviour will extend to socio hydrological orientated studies one of the limitations of claim is that conceptualizing and modelling two complex subsystems which in turn are comprised of further complex subsystems requires large amount of data the inclusion of additional or nested subsystems requires a balance between better representation of a system or needed complexity and building a very complicated model sivapalan and blöschl 2015 voinov and shugart 2013 in addition to the large data sets required to build each model model runs may require large computational resources in the current study this was a consequence of the two dimensional hydrodynamic model and the number of experiments and repetitions of the abm setup concerning the coupled abm flood model paradigm proposed to model the human flood interaction using claim the coupled model suffers from the limitations of both the abm and flood modelling techniques a substantial issue in modelling human flood interaction is the parametrization of human behaviour in abms see crooks and heppenstall 2012 for detailed limitations of abm the uncertainty of the coupled model will also increase as it includes uncertainties of the individual models claim is designed to analyse long term strategic level institutions that are considered during the flood disaster recovery and prevention stages to study the implications of operational level institutions that are considered during the preparedness and response stages the system conceptualization changes as the focus shifts to institutions such as early warning and dissemination plans and evacuation policies the agents and their attributes will change considering individual agents and their age gender or education status become more significant at that scale the structure of the coupled model also changes because the abm and flood model run simultaneously to evaluate agents behaviour as the flood propagates the modelling exercise presented in this paper analysed predefined institutions that agents may follow given their individual resources to extend the applicability of coupled abm flood models in socio hydrologic studies future studies could include endogenous institutional changes or the evolution of institutions through feedback mechanisms as described in ghorbani and bravo 2016 smajgl et al 2008 this may provide insight into how frm policies emerge bottom up or evolve in the future in addition analysing the uncertainty of the coupled model will help to better communicate the model outputs with stakeholders acknowledgements the research leading to these results has received funding from the european union seventh framework programme fp7 2007 2013 under grant agreement n 603663 for the research project pearl preparing for extreme and rare events in coastal regions we thank surfsara https www surf nl en for providing a high performance computing hpc cloud resources that we used to run all the simulations mentioned in the manuscript we are also grateful to the three anonymous reviewers who gave constructive comments that help us to improve the manuscript 
26307,geoanalysis models are an abstraction and expression of geographic phenomena and processes which are associated to environmental issues such models continue to be created in many different domains and collaborative modeling and simulation using models in the open web environment is becoming popular for geographic and environmental research service oriented sharing and reusing of distributed geoanalysis models is an important foundation of this type of work however service oriented modeling faces several challenges especially associated with reusing heterogeneous geo simulation model resources this paper builds on research related to creating managing and publishing plug and play model services with the aim to design and develop a web based wrapper system for geoanalysis models that acts as a service loader and manager to publish these models as services to users our wrapper system can accomplish functions such as standardizing model preparation workflows managing model services and invoking interactive model services thus bridging the gap between geo simulation resource contributors and service users we use the soil and water assessment tool swat model and the unstructured grid finite volume community ocean model fvcom as case studies to show that the developed wrapper system can readily and efficiently enable sharing of model resources and can contribute to collaborative modeling and simulation for environment across a network keywords geoanalysis models wrapper system web service oriented nomenclature software availability service oriented wrapper system for geoanalysis models architecture designer min chen and yongning wen software developer fengyuan zhang songshan yue and chaoran shen ming wang address no 1 wenyuan road qixia district nanjing 210046 p r china tel 86 1565187357 e mail zhangfengyuangis 163 com first available 2017 hardware requirements 1 ghz cpu 1024 mb ram software requirements windows 7 or newer and ubuntu availability open source agpl cost free program language javascript c java and c program size 740 mb software access http 106 14 78 235 8060 index source code sent by request 1 introduction models are abstractions and simplifications of reality belete et al 2017b geoanalysis models are specifically abstractions of geographic phenomena and are typically used to simulate these phenomena and processes lu 2011 parsons 2011 lin et al 2013a 2015 wen et al 2013 yue et al 2016b geoanalysis models have been created in multiple domains to address a variety of problems research areas and temporal spatial scales and to simulate different geographical phenomena explore the mechanisms of processes solve geographic and environmental problems and support decisions basnyat et al 2000 claussen et al 2002 dickinson et al 2006 reichardt 2010 todorova et al 2010 dennis et al 2012 lin et al 2013b zhang et al 2014 2015 zhu et al 2015 yin et al 2015 wen et al 2017 geoanalysis models vary widely in granularity and domain for example some geoanalysis models perform simple geoprocessing tasks such as terrain slope calculation whereas others are large and complex with many algorithms or even multiple programming languages such as the soil and water assessment tool swat neitsch et al 2011 model and the weather research and forecasting wrf model the analysis of complex phenomena often requires the combination of several models granell et al 2013 laniak et al 2013 it is challenging for model users to reuse distributed geoanalysis models in unfamiliar domains when users wish to use an unfamiliar model they may expend considerable time acquiring the special knowledge necessary to make the best use of the model many researchers have worked on this problem of can reducing the cost of applying models and avoiding the waste of model resources sancho jiménez et al 2008 nativi et al 2013 for example the community surface dynamics modeling system csdms is a community of earth scientists promoting the modeling of earth surface processes overeem et al 2013 loosely coupled applications are becoming more popular for flexible data exchange and convenient connection with other computers curbera et al 2002 huhns and singh 2005 based on a loosely coupled architecture service oriented sharing and reuse of these geoanalysis models and plug and play components in the web environment is becoming more prominent in research yang et al 2011 zhao et al 2012 laniak et al 2013 belete et al 2017a if models of geospatial processes can be consumed as web services considerable time could be saved in organizing hardware and installing software granell et al 2013 presently there are several service oriented applications and standards for model sharing and reuse on the web the open geospatial consortium ogc web processing service wps is a protocol and standard for executing geoprocessing functions via web service open geospatial consortium 2006 michaelis and ames 2009 tethys is a web based application development toolkit for water resources modeling that supports sharing and consuming web services based functionality swain et al 2016 kadlec and ames 2017 qiao et al 2018 cloud services innovation platform csip is another software framework for providing services on the web david et al 2014 other service oriented applications and frameworks are also well known such as argent 2004 gehlot et al 2006 granell et al 2010 chen et al 2011 goodall et al 2011 li et al 2011 lü 2011 butt and li 2012 brovelli et al 2013 chen et al 2013 yue et al 2016a in addition there are related applications for enabling so called plug and play components enabling communication within and between geoanalysis and environmental models for example the open modeling interface openmi supports linking of existing and new models in hydrology and other domains using a software module application programmer interface api gregersen et al 2007 another api based model interoperability approach is the basic model interface bmi which is a very succinct api for providing metadata that allows a model to fit into a second level plug and play type wrapper peckham et al 2013 encapsulating geoanalysis models to generate services in the web environment is challenging because such models are typically heterogeneous in form requiring different executing file and script files and complex in runtime behaviors i e data input output starting resuming and message exchanging methods it is not trivial for model builders to create custom web services for large and complex models because related service publication and encapsulation tools are generally lacking geoanalysis models are normally developed by different groups and individuals from different domains such as hydrology soil and atmosphere without a standard set of user programmer interfaces or design criteria the heterogeneity of geoanalysis models is reflected in their differences in form such as open source codes executable files and dependent libraries programming languages such as c c and java and platforms such as microsoft windows linux and macos for example some geoanalysis models are programmed using c in windows thus linux users cannot use them the complexity of geoanalysis models is reflected in the different types of data interaction and operational characteristics therein for data interaction some geoanalysis models request data from files in a local file system such as the swat model and the storm water management model swmm some geoanalysis models can use data available on the web the operational characteristics of geoanalysis models also differ such as data input output message logging and parameter control the heterogeneity and complexity of geoanalysis models have led to difficulties in sharing and reusing them on the web service oriented management of complex models is not trivial prior to running geoanalysis models users must provide necessary input data while the models are running model status should be managed and the associated interactive interfaces should be opened to users including data uploading message exchanging pausing and resuming once a model has finished running model users can review the records and obtain output data from the models at present strategies for the service oriented management and integration of geosimulation resources which consist of resources for geoanalysis models and geodata still have limited capacity they thus struggle to meet the demands of running and invoking complex geoanalysis models on the web therefore the requirement for a strategy to manage geosimulation resources including model and data resources is becoming increasingly pressing in summary the main challenges in related research are as follows heterogeneity of the structures and forms of geoanalysis models the structures and forms of geoanalysis models differ owing to the different domains and developers involved if model users do not know the details of the geoanalysis models it is challenging for them to invoke and use models from other disciplines or those developed by others lack of strategy for the management of related geosimulation resources model runs are comprehensive due to the variety of resources related to geoanalysis models the lack of resource management leads to difficulties in providing effective services to model users such as those allowing the management of run records and input output data complexity of the operation mechanism of geoanalysis models various geoanalysis models in different disciplines involve different types of data interactions and run behaviors such as those involving data input output message logging and parameter control thus service users cannot easily obtain details of target geoanalysis models or the relevant data interactions and runtime behaviors this paper aims to address the above challenges by designing a service oriented wrapper system and related tools for geoanalysis models with the objective of sharing strategies for preparing such models managing related geosimulation resources on computing nodes and invoking and running geoanalysis models in the open web environment the above functions also benefit interactions among the wrapper system geoanalysis models and model users in addition service oriented geoanalysis model services can help eliminate many unnecessary procedures in model use the remainder of this paper is structured as follows the concept design for the service oriented wrapper system for geoanalysis models is introduced in section 2 in section 3 three components of the wrapper system are explained the encapsulation and packaging management and publication and communication and running interaction components along with the related resources library section 4 introduces the creation of a prototype system and related experiments section 5 further discusses the wrapper system finally the conclusions and future work of the study are presented in section 6 2 conceptual design of a service oriented wrapper system 2 1 design criteria for a service oriented wrapper system we provide and implement a service generation publication and usage framework for a service oriented wrapper system and related tools the main criteria are listed below be accessible on the web support cross platform running for different geoanalysis models be compatible with different types of geoanalysis models make geoanalysis models plug and play components provide rich management interfaces for administrators be convenient for service users to invoke provide flexible control of complex model behaviors applying the above criteria this article describes a service oriented wrapper system that support model services sharing and reusing between resource contributors and users 2 2 scenario analysis of a service oriented wrapper system for geoanalysis models as shown in fig 1 our service oriented wrapper system for geoanalysis models is a service loader and manager that can be used to publish services offered by the models on the web this wrapper system plays a key role in three steps preparation of model resources management and publication of model service resources and invoking and running model services first two phases comprise the preparation of model resources i e model encapsulation and packing and service deployment model encapsulation involves model contributors wen et al 2013 which are responsible for providing model resources to enable geoanalysis models to generate new models of standard form and behavior encapsulation can reduce the complexity and heterogeneity of these models in terms of how they appear to end users model packing then involves model contributors wrapping resources related to the geoanalysis models into packages which can be deployed in the wrapper system the new models are plug and play components for the wrapper system achieved by encapsulation and packing second once geoanalysis models are deployed in the wrapper system they are stored in the system and prepared as services that can be invoked on the web thus the administrator of the wrapper system requires a management strategy such as for records of model runs input output data and other factors for resources of the geo simulation once the model packages have been deployed the wrapper system must generate invoking interfaces for the models according to the established rules through these rules the administrator of the wrapper system publishes the services of packages of the deployed model as model services which are standardized models that can be invoked on the web finally for demands of complex run interactions the wrapper system for the geoanalysis models must achieve multiple run interactions for messages and run controls first the wrapper system develops interfaces for message exchanges between the wrapper system and the model service through these interfaces the wrapper system controls the status of the model services then through model execution and run monitoring the wrapper system logs information related to the model services and sends this information and related statistics to service users a wrapper system for geoanalysis models can be built based on the design described in the three steps above allowing the user to invoke the model services in the system and interact with them the computer resource in fig 1 can be a personal computer server or high performance computing hpc resource upon which the wrapper system can be installed and thereby become a computing node in the network the wrapper system can be deployed on different platforms which can reduce negative effects of system heterogeneity this design can render geoanalysis models sharable and reusable on the web and can bridge the gap between model contributors and model users 2 3 framework of a service oriented wrapper system for geoanalysis models our service oriented wrapper system for the geoanalysis models consists of four primary entities three components and a simulation resource library as shown in fig 2 the components are the encapsulation and packaging component the management and publication component and the communication and running interaction component all service resources are stored in the simulation resource library which has four sub libraries a model service library a model instance library a data cache library and a data preprocessing methods library the model service library stores resources related to the model service including files and metadata pertaining to model services and records of model service runs the model instance library stores the run instances of the model services the run instance is the handle used to interact with a geoanalysis model process running in a computing node the data cache library stores the input output data of the model runs and the data preprocessing methods library stores resources for outside service for data conversion that can be invoked by the model services model providers first supply model service packages to prepare for model resources with the help of the encapsulation and packaging component these packages encapsulate the native geoanalysis models through a component and create a standardized executable file that contains customized data and behavior interfaces normally running geoanalysis models does not rely on only a single file thus the related resources are packaged to generate model service packages which can be deployed to the simulation resource library in the wrapper system following the above steps based on the simulation library the management and publication component is used to manage these geo simulation resources in the wrapper system and publish the related services the wrapper system manages these simulated resources through information classification and permission setting information classification for related geo simulation resources aims to make it convenient for users to obtain related services and permission setting is used to control their use limits moreover through this component resources in the wrapper system form services by designing the invoking interfaces of model services and publishing these services using rest web services finally the wrapper system interacts with the run instances of the model services using the communication and running interaction component the services can be invoked and interact with the wrapper system based on the communication and interaction strategy through this strategy the wrapper system can also monitor and control the operations of model services through run monitoring and real time control including records and logs of behaviors and exceptions therefore the wrapper system forms the foundation for runtime and error analysis detailed design of specific system components is provided in the following section 3 component design of a service oriented wrapper system for geoanalysis models 3 1 encapsulation and packaging component the encapsulation and packaging component is responsible for the customization and encapsulation of the data and behavior module and the packaging of the related resources module and the model service deployment module encapsulation of the data and behavior module is intended to make each model conform to a standard application programming interface api prior to encapsulation models must be described using a model description language yue et al 2016b a model description language document is used to describe the model s attributes behaviors and runtime demands fig 3 shows the model description language document which consists of three nodes attributeset behaviors and runtime here the swat model is used as an example to introduce the method of composing a model description language document 1 the attributeset node is composed of the properties of the model including a brief introduction abstract keywords and categories 2 the behavior node introduces run behaviors and data interactions in the model the datasetdeclarations node is used to show the schema of the data yue et al 2015 each datasetdeclarations node is a schema of the input output data the states in the stategroup node represent the run states of this model different events occur in each state and each event involves data interactions in the model the state of the geoanalysis model is its step or phase and the event is a behavior such as requesting model data for a given state in the event node the responseparameter tag represents the behavior of the requesting input data and the dispatchparameter node represents that of the responding output data the swat model is divided into four states watersheddelienationstate hydroresponseunitstate runswatstate and swatbasinshapegenerator watersheddelienationstate is used to generate watershed data using dem data mask data and threshold values hydroresponseunitstate is used to create the hydrologic response unit by using watershed land data soil and weather data runswatstate is used to invoke the swat executable to start the simulation and swatbasinshapegenerator is used to generate results in shapefile format 3 the runtime node introduces deployment information including entry information hardware dependency software dependency assembly dependency and resource dependency this document is used to couple model resource and computer resource the encapsulation program of swat is built in windows uses c as programming language and uses mapwindow api ames et al 2008 thus this model need 1 0g for cup main frequency and 1024m constitute the hardware dependencies and windows c 2010 and mapwindow constitute the software dependencies according to other environment requirements data preprocessing libraries such as gdalrastermapping ogrvectormapping and taudem path make up the assembly dependencies and software installing packages gdal and msmps make up resource dependency the model description language document is the bridge between the model providers and users of the model service with the help of this document model providers can use the encapsulation module to encapsulate models of geoanalysis as standardized models in this way model service users can prepare input data and obtain results through the document the module aims to map native interaction interfaces which are the original interactions of the geoanalysis models with users to standardized interfaces as shown on the left side of fig 4 to achieve a one to one correspondence among them the interfaces of the native model are original interactions with the users such as running an executable file or invoking a function in a library file the wrapper system can interact with standardized interfaces including behavior interfaces data interfaces and log interfaces the behavior interfaces consist of an initialization interface a state switching interface and an event firing interface these interfaces aim to control switching between model states and events the data interfaces consist of a data input interface and a data output interface for data interaction between the model and the wrapper system the log interfaces consist of a message output interface a warning output interface and an error output interface which are used to record the process and status information of the running instances as shown on the right side of fig 4 the operations in the swat model have standard interfaces that facilitate interaction between modules of the standard component in the wrapper system and contribute to invoking and running the service in subsequent steps following encapsulation the standardized geoanalysis model can be wrapped as executable files or script files the execution of these executable or script files often relies on other files including dependent libraries such as dynamic link library dll and shared object so files and related resources such as model description files and test data model providers should package all these files by packaging the related resources module to a model service package that can be deployed in the wrapper system as shown in fig 5 the swat model files in the package are composed of model related files model related resources and copyright files 1 the model related files stored in the model folder consist of the model startup file model dependent libraries and a model description language document the model startup file is used to run the model an example is the swatmodelallinone exe file the model dependent libraries are files that support the execution of the model such as the swat 664 64rel exe file and the nxmodel context csharp dll file the model description language document is used to describe the geoanalysis models swatmodel664 mdl is an example 2 model related resources consist of resource files and test data the former are stored in the supportive folder and are the installation packages on which the models rely the test data stored in the testify folder determine whether the test model can run correctly where the data are composed according to the model input description rules 3 the copyright information stored in the license file is the copyright statement or open source statement of the model model service packages must be deployed in a wrapper system as they become model services three steps are involved in the model service deployment module deployment information matching such as software and hardware information model information extraction and registration and model file deployment 1 deployment information matching involves matching the software and hardware information between the model description language document and the target wrapper system thus the model service deployers can determine whether the model service runs normally in this system as shown in the runtime node in fig 3 the swat model needs a windows platform if an administrator of a wrapper system in linux wants to deploy this package the wrapper system prevents it 2 model information extraction and registration extracts information from the model description language document and stores it in the service information library with information extraction the model service can be registered in the wrapper system which makes it easy for users to query 3 model file deployment is the release of the file resources mentioned above to the model service library 3 2 management and publication component 3 2 1 information classification and permission setting running the model service is dependent on more than a single geo simulation resource thus the model wrapper system is important for the management of several geo simulation resources for example once a model user invokes the swat model in the wrapper system the system must record this task and publish it as a service to the user fig 6 shows that these geo simulation resources in the wrapper system include model service related resources and data related resources the model service related resources can be used to retrieve manage invoke and run model services these resources include model services model run records and model running instances as follows 1 through the deployment module model services are deployed from model service packages which include model service information and model service files the model service information is classified into three parts model attribute information model deployment information and model status and access information the model attribute information is extracted from the model description language document model deployment information and some of the model status and access information are generated by the wrapper system different parts of the information have different duties this information can help model service users find the right models a model attribute information such as model name model type version and description is used to describe model services b model deployment information such as deployment time and deployer information is used to record information concerning when model services are deployed c model status and access information such as online offline permission public private and registration are used to mark the statuses and authorities of the model services once the model services have been deployed the management module stores this information in a service information library and builds an index of model services to facilitate retrieval by users the retrieval interfaces are shown in section 3 2 2 meanwhile the model service files are extracted from the abovementioned model service package 2 the model records are used to record information concerning the status configuration and log whereby model services are invoked model service users can supervise the status and obtain the results through records a model status information refers to the model in the given status divided into finished unfinished and exception b configuration information is a configuration document that supports running the model service including the input output information of the model and the id of the instance of model execution c the log information contains the run information of the model during execution and at the end of the run contains information logs of state switching model stand output stand exception and error invocation 3 the model running instances of the model are program processes of the model services and are stored in a model instance library these instances consist of run record information and the model instance handle the instance handle contains information such as the model instance id and model communication interface data related resources in fig 6 are the input output data of the run model services and data preprocessing methods and include the following elements 1 prior to running the model services the wrapper system should provide services to help users of the services upload input data and these data should be stored in the data cache library the data stored in the library include the format size tag generation time and other metadata as the model services complete processing the output data are stored in the data cache library which allows users to check download and visualize them 2 data preprocessing methods are conversion programs and libraries that may be invoked in model service these methods are stored in the data preprocessing methods library the permission setting is designed according to the above analysis the controlled status and access for model services in a service oriented wrapper system for geoanalysis models are controlled by the model status and access information these consist of online offline information permission information public information and register information as follows 1 the online status implies that the model service is available and can be used whereas an offline status means that the model service is unavailable and cannot be used 2 permission information is used to show users the token type before using the model to ensure that the model service is authorized for use the token is a key string set by a model provider and is used to control access to model services through provision to specific users public information has two states private and public 3 a private state means that the model services can be used only by the administrator of the given wrapper system a public state means that model services can be queried and used by everyone in the network 4 register information indicates whether the model has been registered on a portal site portal site is a web site that gathers registered models for sharing on the internet a registered model service is a model service that can be used in the portal as shown in fig 7 model service sharing is divided into three levels in the wrapper system private model service public model service and registered model service different user groups use different model service levels thus the wrapper system can control access rights for control of the model services 3 2 2 design and publication of services using rest all of the system s apis for model management and use are published through the publication module the publication protocols of related geo simulation resource services that need to be published in the wrapper system are in hypertext transfer protocol http and the design of the api follows the rest approach where web services are invoked as url based requests the path names of these resources are different and include the resource ids to indicate access to a unique resource the basic operations are addition deletion query and update of the resources and the http requests that post delete get and put correspond to these operations respectively special operations used to identify resources by a query string are added behind the path for example the invoking operation needs ac run to be added to the end of the path in the api of the model service resource as service invoking interfaces are designed according to the rest style they can accommodate various user operations in the related geo simulation resource services the design of the model service invoking interfaces is shown in table 1 the designs of the invoking interfaces for data services are shown in table 2 the designs of the interaction interface for model running instances are shown in table 3 3 3 communication and running interaction component 3 3 1 communication and interaction design as indicated above the interaction of a geoanalysis model can be complex and can vary greatly from one model to the next thus it is important to extend and design related communication and running interaction interfaces of geoanalysis models to reduce the amount of communication needed between models for example for the unstructured grid finite volume community ocean model fvcom chen et al 2003 step one entails two input data items first users input a geodom dat file which indicates the numbers of points and triangles in mesh then they input other files to indicate the location of the points and the structure of the triangles as shown in fig 8 the communication and interaction module operates in two parts the wrapper system and the model running instance the wrapper system has a publication module a control module and a communication module the publication module provides invocation interfaces to communicate with users provided in 3 2 2 by http the control module is used to control the logical operation of the instances of model execution and to translate the order of users into the order of interactions of this execution by socket the communication module is used to send messages to the instances of model execution by configuring a document to run the model service or to send messages for user operation and to receive messages from such instances there are two modules in the model running instance the running module and the monitoring module the running module is used to execute the native model and map native interfaces to standard interfaces the monitoring module is used to accept messages from the wrapper system change the state in the running module using an internal message exchange mechanism and send messages from the running module finally the interaction protocol involves the interaction of order and message between instances of execution of the model and the wrapper system once the model services have been invoked by users the wrapper system fires a model running instance in the computing node then these instances communicate with the communication module in the wrapper system which can change the run state based on this protocol in the model running instance and can obtain the state and output messages from it in some cases the user can stop model running instances using this protocol the interaction between the model running instance and the wrapper system is shown in fig 9 these interaction protocols are shown below initialization the model prepares for and begins to enter the running status and obtains the running parameters enter state the model begins to enter a running state and the state is marked fire event the model triggers an event in a state and the content of the general event is the input output data of the model or parameter adjustment which is a state that contains one or more events request data the model running instance asks the wrapper system for the input data of an event in a state response data the model running instance sends the wrapper system the input data of an event in a state leave state the model running instance leaves a state and the state is marked as stateless finalize the model running instance releases all resources and prepares to end the program request data mapping path the wrapper system sends the mapping library directory to the model running instance which helps the model running instance locate the corresponding data mapping method message export the model running instance outputs information error export the model running instance outputs error information warning export the model running instance outputs warning information 3 3 2 running monitoring and real time control when running model services interactions between instances of the running model and the wrapper system are determined by the input output configurations of the model services based on the requirements of service users the configuration documents for running the model service are created by the wrapper system the input output configurations of the model services are determined by the configuration documents as shown in fig 10 the configuration document consists of four parts the model service id model running instance id and model input and output data the model service id is the unique id of the model service in the service information library and the model service information can be queried by using this the model running instance id is the unique id used by model running instances to interact with the wrapper system the input output data of the model service are data interactions with the model service during the run in fig 10 the input data are dem data and the output data are filled dem data the wrapper system can monitor the status of the running instance of the model through calculations this monitoring involves records of run logs and exception judgments the run log records contain a log of the communication between the running instances and the wrapper system such as messages errors and warning export information and the standard outputs and error messages of the running instances of the model various exceptions in executing the model service may occur such as an exception in the model program a mismatch between model services and data or a mismatch between model services and the computing environment during execution the model service has five indicators for the types of exceptions including whether the process is successfully invoked whether the communication module is running and standard output standard error and error invoking information these indicators can provide users with information concerning the exceptions of the model service executed to evaluate the types of run exceptions encountered in executing the model 4 experiment 4 1 system building using the designs described above the authors employed the swat model version 664 and fvcom as examples to show the capabilities of the proposed service oriented wrapper system through standard encapsulation and packaging service oriented deployment management invocation and monitoring of the model service this case study completed all resource preparations model service management and publishing and model service interaction the encapsulation module provided c c and java as software development kit sdk to encapsulate various geoanalysis models as standardized models the management module and communication module were built using node js the wrapper system used http and socket to communicate with users and model running instances http uses 8060 port and socket uses 6000 as default the geo simulation resource library consisted of mongodb redis and memory cache model services and data preprocessing methods were stored in mongodb the data cache was stored in redis and the model running instances were stored in memory cache fig 11 shows the implementation of the wrapper system we built a graphical user interface gui to provide a function for the administrator to manage these resources in the network as shown in fig 12 the left sidebar of the wrapper system gui shows the management entries for all resource types including model resources and data resources the icons in the middle of the page can be used for rapid access to sub pages including those for the management of model services the notice system computer information model service deployment running service records the child node agent data cache and help the model service list page shows the model services stored in the model service library as shown in fig 13 the administrator can manage model services on this page which shows the information and operation of the model services the information includes the name version type permission accessibility and status of the model the operation of model services includes detail invocation and registration the data cache list page shows the input output data stored in the data cache library as shown in fig 14 the administrator of the wrapper system manages the input output data cache of the model run in the data cache list page this page shows the information and operation of the data cache the information includes the data tag storage type data size and date of generation the operation includes checking visualization download and deletion the model service record page is used to monitor the running of model services and check the results as shown in fig 15 the run records include run record statistics a run record list and details of the run records the run record statistics are used to monitor all run records and show the statistical information in this wrapper system as shown in fig 15a the statistical information includes the number of model services invoked over a certain period and the model services invoked most often in the given wrapper system as shown in fig 15c the run record list shows records that have been invoked in this wrapper system and provide the entry to check the details of the run record as shown in fig 15b the running record is each run of a model service and show detail of running information including the configuration and information on the model service run and log as shown in fig 15d on the run records page the input output data can be visualized 4 2 services generation we used the swat model and fvcom as examples to show all procedures the swat model is wrapped by c and fvcom by java through standard encapsulation the model service provider can map native data and the behavior interfaces to standard interfaces using the encapsulation tools described above as shown in fig 16 a the provider builds an executable file with standard interfaces from the swat model through encapsulation in this example the watershed data are calculated by invoking taudem using dem data hydrologic response units are generated by invoking mapwindow api and the simulation is initiated by using the swat executable file then as shown in fig 16b the provider copies the related files to a folder and packages them as shown in fig 17 a once the model service package of swat has been generated the administrator of the wrapper system can deploy the package to a wrapper system on the deployment page once a model service of swat is deployed the service is listed in the model service list a model service is published by setting the service status to online as shown in fig 17b by clicking the register button as illustrated in fig 17c the swat model service can be registered on the portal site once the service is registered it is shared on the internet and every user in the portal can use the swat model services provided by this computer 4 3 services use model users can obtain model services pertaining to swat information in two ways one way is to open the gui page in the wrapper system directly and the other is to visit the portal site http geomodeling njnu edu cn and search index keywords of swat in the first way as shown in fig 18 a the administrator provides the local url of the wrapper system to service users by visiting the url of the wrapper system users can access the swat service directly and use it in the second way as shown in fig 18b service users can search model items related to swat in the portal they can then obtain more details about swat and select an available service to use which is registered in the portal as shown in fig 19 a and b users can obtain details and information concerning the input output of the swat model service and prepare the input data for execution the invocation of the model service monitoring page is shown in fig 19c to demonstrate this we used data from mexico including dem data land use data soil data and weather data on this page users can check the status of a model run and obtain input output data once the run is finished fig 19d shows the output data of the swat model and some indicators in each sub watershed in this example no2 output was set as the indicator as shown in fig 20 we used the same method as a service to encapsulate fvcom which consists of four steps the authors thus represent fvcom as four model services the input data were mesh data from the east sea of china and a few parameters and the output data were the flow speed of waves in the east sea of china by refactoring the mesh data and output data we visualized the results as shown in fig 20d 5 discussion we designed and developed a flexible service oriented wrapper system for geoanalysis models to date there are more than 500 model services registered and available in our system most of these model services are simple calculation models such as slope and buffer calculation models and there are also over 10 large models still increasing including the swat and fvcom models mentioned above swmm and the wrf model we are still collecting models and encourage related researchers to upload their geoanalysis models among the generation procedures for model service encapsulation is the most difficult we are continually providing sets of tools and sdk to facilitate this step including providing several program languages for sdk and a code generator for encapsulation with the development of geographical and technological tools the behavior of geoanalysis models is becoming increasingly complex such models have not only simple running states but also many other behaviors such as iterations exchange of parameters with other geoanalysis models and other complex interactions in summary we will support more complex interactions between geoanalysis models and the wrapper system an advantage of the loose coupling framework is its flexibility for simulation resource contributors including model resource and computer resource and the service oriented architecture makes it convenient to share and reuse geoanalysis models in the wrapper system on the web for example a student develops a large model which need massive computing but could not pay the bill for high performance computer a non profit organization may provide a hpc for students for free the wrapper system can be the bridge between them and provide the model service for the user on the web we choose to design and code the wrapper system with the help of open source or free software and libraries and to encapsulate original geoanalysis models as plug and play components however the performance of model services will be limited in this architecture especially for small models like geo processing tasks fox example in the model running instance the monitoring module will cover extra hardware resources such as threads and must have message exchange with the wrapper system which will entail massive time costs furthermore message exchange on the web is slower than it is in memory but for complex and slow running models the additional time costs associated with message exchange on the web can be inconsequential compared to mode run time geoanalysis models require different data formats hardware and software environments and execution approaches before running a model service the wrapper system must search convert and match data that exist on the web to support the execution of the model services making full use of the intelligent data index and preparation and quickly coupling the data with the model are other key research issues in model service sharing we intend to complete model service oriented data preparation on the web in addition security for open services on the web remains a concern we have integrated some limits for usage control for three levels of users as mentioned above but there still remains much work in service protection for different users model service sharing does not always entail the unconditional sharing of a model resource it involves various stakeholders such as model service providers service users and computing resource providers according to collaboration and profit distributions we need to perfect the access to and control of model services during the contribution usage and research of each stakeholder in so doing the interests of all stakeholders such as copyrights can be protected model services can be shared and exploration and collaboration can occur to solve complex geographical problems on the web 6 summary we described an implementation strategy for a service oriented wrapper system for geoanalysis models in the open web environment the wrapper system solves key points including the preparation of model resources the management and publication of model resources and the invocation and execution of services we analysis using scenario for the wrapper system and types of geo simulation resources in this article we also create the interface for service user and protocol between model running instances and the wrapper system to enrich interaction for service users finally we have provided an implementation of the wrapper system and two cases swat model and fvcom usage in the wrapper system thus by publishing geoanalysis models as services in the open web environment the wrapper system supports service oriented reuse and sharing of geoanalysis models for geographical research acknowledgements we appreciate the detailed suggestions and comments from the anonymous reviewers we express heartfelt thanks to the other members of the opengms team this work was supported by the nsf for excellent young scholars of china under grant number 41622108 the national basic research program of china 973 program under grant number 2015cb954103 and the priority academic program development of jiangsu higher education institutions under grant 164320h116 
26307,geoanalysis models are an abstraction and expression of geographic phenomena and processes which are associated to environmental issues such models continue to be created in many different domains and collaborative modeling and simulation using models in the open web environment is becoming popular for geographic and environmental research service oriented sharing and reusing of distributed geoanalysis models is an important foundation of this type of work however service oriented modeling faces several challenges especially associated with reusing heterogeneous geo simulation model resources this paper builds on research related to creating managing and publishing plug and play model services with the aim to design and develop a web based wrapper system for geoanalysis models that acts as a service loader and manager to publish these models as services to users our wrapper system can accomplish functions such as standardizing model preparation workflows managing model services and invoking interactive model services thus bridging the gap between geo simulation resource contributors and service users we use the soil and water assessment tool swat model and the unstructured grid finite volume community ocean model fvcom as case studies to show that the developed wrapper system can readily and efficiently enable sharing of model resources and can contribute to collaborative modeling and simulation for environment across a network keywords geoanalysis models wrapper system web service oriented nomenclature software availability service oriented wrapper system for geoanalysis models architecture designer min chen and yongning wen software developer fengyuan zhang songshan yue and chaoran shen ming wang address no 1 wenyuan road qixia district nanjing 210046 p r china tel 86 1565187357 e mail zhangfengyuangis 163 com first available 2017 hardware requirements 1 ghz cpu 1024 mb ram software requirements windows 7 or newer and ubuntu availability open source agpl cost free program language javascript c java and c program size 740 mb software access http 106 14 78 235 8060 index source code sent by request 1 introduction models are abstractions and simplifications of reality belete et al 2017b geoanalysis models are specifically abstractions of geographic phenomena and are typically used to simulate these phenomena and processes lu 2011 parsons 2011 lin et al 2013a 2015 wen et al 2013 yue et al 2016b geoanalysis models have been created in multiple domains to address a variety of problems research areas and temporal spatial scales and to simulate different geographical phenomena explore the mechanisms of processes solve geographic and environmental problems and support decisions basnyat et al 2000 claussen et al 2002 dickinson et al 2006 reichardt 2010 todorova et al 2010 dennis et al 2012 lin et al 2013b zhang et al 2014 2015 zhu et al 2015 yin et al 2015 wen et al 2017 geoanalysis models vary widely in granularity and domain for example some geoanalysis models perform simple geoprocessing tasks such as terrain slope calculation whereas others are large and complex with many algorithms or even multiple programming languages such as the soil and water assessment tool swat neitsch et al 2011 model and the weather research and forecasting wrf model the analysis of complex phenomena often requires the combination of several models granell et al 2013 laniak et al 2013 it is challenging for model users to reuse distributed geoanalysis models in unfamiliar domains when users wish to use an unfamiliar model they may expend considerable time acquiring the special knowledge necessary to make the best use of the model many researchers have worked on this problem of can reducing the cost of applying models and avoiding the waste of model resources sancho jiménez et al 2008 nativi et al 2013 for example the community surface dynamics modeling system csdms is a community of earth scientists promoting the modeling of earth surface processes overeem et al 2013 loosely coupled applications are becoming more popular for flexible data exchange and convenient connection with other computers curbera et al 2002 huhns and singh 2005 based on a loosely coupled architecture service oriented sharing and reuse of these geoanalysis models and plug and play components in the web environment is becoming more prominent in research yang et al 2011 zhao et al 2012 laniak et al 2013 belete et al 2017a if models of geospatial processes can be consumed as web services considerable time could be saved in organizing hardware and installing software granell et al 2013 presently there are several service oriented applications and standards for model sharing and reuse on the web the open geospatial consortium ogc web processing service wps is a protocol and standard for executing geoprocessing functions via web service open geospatial consortium 2006 michaelis and ames 2009 tethys is a web based application development toolkit for water resources modeling that supports sharing and consuming web services based functionality swain et al 2016 kadlec and ames 2017 qiao et al 2018 cloud services innovation platform csip is another software framework for providing services on the web david et al 2014 other service oriented applications and frameworks are also well known such as argent 2004 gehlot et al 2006 granell et al 2010 chen et al 2011 goodall et al 2011 li et al 2011 lü 2011 butt and li 2012 brovelli et al 2013 chen et al 2013 yue et al 2016a in addition there are related applications for enabling so called plug and play components enabling communication within and between geoanalysis and environmental models for example the open modeling interface openmi supports linking of existing and new models in hydrology and other domains using a software module application programmer interface api gregersen et al 2007 another api based model interoperability approach is the basic model interface bmi which is a very succinct api for providing metadata that allows a model to fit into a second level plug and play type wrapper peckham et al 2013 encapsulating geoanalysis models to generate services in the web environment is challenging because such models are typically heterogeneous in form requiring different executing file and script files and complex in runtime behaviors i e data input output starting resuming and message exchanging methods it is not trivial for model builders to create custom web services for large and complex models because related service publication and encapsulation tools are generally lacking geoanalysis models are normally developed by different groups and individuals from different domains such as hydrology soil and atmosphere without a standard set of user programmer interfaces or design criteria the heterogeneity of geoanalysis models is reflected in their differences in form such as open source codes executable files and dependent libraries programming languages such as c c and java and platforms such as microsoft windows linux and macos for example some geoanalysis models are programmed using c in windows thus linux users cannot use them the complexity of geoanalysis models is reflected in the different types of data interaction and operational characteristics therein for data interaction some geoanalysis models request data from files in a local file system such as the swat model and the storm water management model swmm some geoanalysis models can use data available on the web the operational characteristics of geoanalysis models also differ such as data input output message logging and parameter control the heterogeneity and complexity of geoanalysis models have led to difficulties in sharing and reusing them on the web service oriented management of complex models is not trivial prior to running geoanalysis models users must provide necessary input data while the models are running model status should be managed and the associated interactive interfaces should be opened to users including data uploading message exchanging pausing and resuming once a model has finished running model users can review the records and obtain output data from the models at present strategies for the service oriented management and integration of geosimulation resources which consist of resources for geoanalysis models and geodata still have limited capacity they thus struggle to meet the demands of running and invoking complex geoanalysis models on the web therefore the requirement for a strategy to manage geosimulation resources including model and data resources is becoming increasingly pressing in summary the main challenges in related research are as follows heterogeneity of the structures and forms of geoanalysis models the structures and forms of geoanalysis models differ owing to the different domains and developers involved if model users do not know the details of the geoanalysis models it is challenging for them to invoke and use models from other disciplines or those developed by others lack of strategy for the management of related geosimulation resources model runs are comprehensive due to the variety of resources related to geoanalysis models the lack of resource management leads to difficulties in providing effective services to model users such as those allowing the management of run records and input output data complexity of the operation mechanism of geoanalysis models various geoanalysis models in different disciplines involve different types of data interactions and run behaviors such as those involving data input output message logging and parameter control thus service users cannot easily obtain details of target geoanalysis models or the relevant data interactions and runtime behaviors this paper aims to address the above challenges by designing a service oriented wrapper system and related tools for geoanalysis models with the objective of sharing strategies for preparing such models managing related geosimulation resources on computing nodes and invoking and running geoanalysis models in the open web environment the above functions also benefit interactions among the wrapper system geoanalysis models and model users in addition service oriented geoanalysis model services can help eliminate many unnecessary procedures in model use the remainder of this paper is structured as follows the concept design for the service oriented wrapper system for geoanalysis models is introduced in section 2 in section 3 three components of the wrapper system are explained the encapsulation and packaging management and publication and communication and running interaction components along with the related resources library section 4 introduces the creation of a prototype system and related experiments section 5 further discusses the wrapper system finally the conclusions and future work of the study are presented in section 6 2 conceptual design of a service oriented wrapper system 2 1 design criteria for a service oriented wrapper system we provide and implement a service generation publication and usage framework for a service oriented wrapper system and related tools the main criteria are listed below be accessible on the web support cross platform running for different geoanalysis models be compatible with different types of geoanalysis models make geoanalysis models plug and play components provide rich management interfaces for administrators be convenient for service users to invoke provide flexible control of complex model behaviors applying the above criteria this article describes a service oriented wrapper system that support model services sharing and reusing between resource contributors and users 2 2 scenario analysis of a service oriented wrapper system for geoanalysis models as shown in fig 1 our service oriented wrapper system for geoanalysis models is a service loader and manager that can be used to publish services offered by the models on the web this wrapper system plays a key role in three steps preparation of model resources management and publication of model service resources and invoking and running model services first two phases comprise the preparation of model resources i e model encapsulation and packing and service deployment model encapsulation involves model contributors wen et al 2013 which are responsible for providing model resources to enable geoanalysis models to generate new models of standard form and behavior encapsulation can reduce the complexity and heterogeneity of these models in terms of how they appear to end users model packing then involves model contributors wrapping resources related to the geoanalysis models into packages which can be deployed in the wrapper system the new models are plug and play components for the wrapper system achieved by encapsulation and packing second once geoanalysis models are deployed in the wrapper system they are stored in the system and prepared as services that can be invoked on the web thus the administrator of the wrapper system requires a management strategy such as for records of model runs input output data and other factors for resources of the geo simulation once the model packages have been deployed the wrapper system must generate invoking interfaces for the models according to the established rules through these rules the administrator of the wrapper system publishes the services of packages of the deployed model as model services which are standardized models that can be invoked on the web finally for demands of complex run interactions the wrapper system for the geoanalysis models must achieve multiple run interactions for messages and run controls first the wrapper system develops interfaces for message exchanges between the wrapper system and the model service through these interfaces the wrapper system controls the status of the model services then through model execution and run monitoring the wrapper system logs information related to the model services and sends this information and related statistics to service users a wrapper system for geoanalysis models can be built based on the design described in the three steps above allowing the user to invoke the model services in the system and interact with them the computer resource in fig 1 can be a personal computer server or high performance computing hpc resource upon which the wrapper system can be installed and thereby become a computing node in the network the wrapper system can be deployed on different platforms which can reduce negative effects of system heterogeneity this design can render geoanalysis models sharable and reusable on the web and can bridge the gap between model contributors and model users 2 3 framework of a service oriented wrapper system for geoanalysis models our service oriented wrapper system for the geoanalysis models consists of four primary entities three components and a simulation resource library as shown in fig 2 the components are the encapsulation and packaging component the management and publication component and the communication and running interaction component all service resources are stored in the simulation resource library which has four sub libraries a model service library a model instance library a data cache library and a data preprocessing methods library the model service library stores resources related to the model service including files and metadata pertaining to model services and records of model service runs the model instance library stores the run instances of the model services the run instance is the handle used to interact with a geoanalysis model process running in a computing node the data cache library stores the input output data of the model runs and the data preprocessing methods library stores resources for outside service for data conversion that can be invoked by the model services model providers first supply model service packages to prepare for model resources with the help of the encapsulation and packaging component these packages encapsulate the native geoanalysis models through a component and create a standardized executable file that contains customized data and behavior interfaces normally running geoanalysis models does not rely on only a single file thus the related resources are packaged to generate model service packages which can be deployed to the simulation resource library in the wrapper system following the above steps based on the simulation library the management and publication component is used to manage these geo simulation resources in the wrapper system and publish the related services the wrapper system manages these simulated resources through information classification and permission setting information classification for related geo simulation resources aims to make it convenient for users to obtain related services and permission setting is used to control their use limits moreover through this component resources in the wrapper system form services by designing the invoking interfaces of model services and publishing these services using rest web services finally the wrapper system interacts with the run instances of the model services using the communication and running interaction component the services can be invoked and interact with the wrapper system based on the communication and interaction strategy through this strategy the wrapper system can also monitor and control the operations of model services through run monitoring and real time control including records and logs of behaviors and exceptions therefore the wrapper system forms the foundation for runtime and error analysis detailed design of specific system components is provided in the following section 3 component design of a service oriented wrapper system for geoanalysis models 3 1 encapsulation and packaging component the encapsulation and packaging component is responsible for the customization and encapsulation of the data and behavior module and the packaging of the related resources module and the model service deployment module encapsulation of the data and behavior module is intended to make each model conform to a standard application programming interface api prior to encapsulation models must be described using a model description language yue et al 2016b a model description language document is used to describe the model s attributes behaviors and runtime demands fig 3 shows the model description language document which consists of three nodes attributeset behaviors and runtime here the swat model is used as an example to introduce the method of composing a model description language document 1 the attributeset node is composed of the properties of the model including a brief introduction abstract keywords and categories 2 the behavior node introduces run behaviors and data interactions in the model the datasetdeclarations node is used to show the schema of the data yue et al 2015 each datasetdeclarations node is a schema of the input output data the states in the stategroup node represent the run states of this model different events occur in each state and each event involves data interactions in the model the state of the geoanalysis model is its step or phase and the event is a behavior such as requesting model data for a given state in the event node the responseparameter tag represents the behavior of the requesting input data and the dispatchparameter node represents that of the responding output data the swat model is divided into four states watersheddelienationstate hydroresponseunitstate runswatstate and swatbasinshapegenerator watersheddelienationstate is used to generate watershed data using dem data mask data and threshold values hydroresponseunitstate is used to create the hydrologic response unit by using watershed land data soil and weather data runswatstate is used to invoke the swat executable to start the simulation and swatbasinshapegenerator is used to generate results in shapefile format 3 the runtime node introduces deployment information including entry information hardware dependency software dependency assembly dependency and resource dependency this document is used to couple model resource and computer resource the encapsulation program of swat is built in windows uses c as programming language and uses mapwindow api ames et al 2008 thus this model need 1 0g for cup main frequency and 1024m constitute the hardware dependencies and windows c 2010 and mapwindow constitute the software dependencies according to other environment requirements data preprocessing libraries such as gdalrastermapping ogrvectormapping and taudem path make up the assembly dependencies and software installing packages gdal and msmps make up resource dependency the model description language document is the bridge between the model providers and users of the model service with the help of this document model providers can use the encapsulation module to encapsulate models of geoanalysis as standardized models in this way model service users can prepare input data and obtain results through the document the module aims to map native interaction interfaces which are the original interactions of the geoanalysis models with users to standardized interfaces as shown on the left side of fig 4 to achieve a one to one correspondence among them the interfaces of the native model are original interactions with the users such as running an executable file or invoking a function in a library file the wrapper system can interact with standardized interfaces including behavior interfaces data interfaces and log interfaces the behavior interfaces consist of an initialization interface a state switching interface and an event firing interface these interfaces aim to control switching between model states and events the data interfaces consist of a data input interface and a data output interface for data interaction between the model and the wrapper system the log interfaces consist of a message output interface a warning output interface and an error output interface which are used to record the process and status information of the running instances as shown on the right side of fig 4 the operations in the swat model have standard interfaces that facilitate interaction between modules of the standard component in the wrapper system and contribute to invoking and running the service in subsequent steps following encapsulation the standardized geoanalysis model can be wrapped as executable files or script files the execution of these executable or script files often relies on other files including dependent libraries such as dynamic link library dll and shared object so files and related resources such as model description files and test data model providers should package all these files by packaging the related resources module to a model service package that can be deployed in the wrapper system as shown in fig 5 the swat model files in the package are composed of model related files model related resources and copyright files 1 the model related files stored in the model folder consist of the model startup file model dependent libraries and a model description language document the model startup file is used to run the model an example is the swatmodelallinone exe file the model dependent libraries are files that support the execution of the model such as the swat 664 64rel exe file and the nxmodel context csharp dll file the model description language document is used to describe the geoanalysis models swatmodel664 mdl is an example 2 model related resources consist of resource files and test data the former are stored in the supportive folder and are the installation packages on which the models rely the test data stored in the testify folder determine whether the test model can run correctly where the data are composed according to the model input description rules 3 the copyright information stored in the license file is the copyright statement or open source statement of the model model service packages must be deployed in a wrapper system as they become model services three steps are involved in the model service deployment module deployment information matching such as software and hardware information model information extraction and registration and model file deployment 1 deployment information matching involves matching the software and hardware information between the model description language document and the target wrapper system thus the model service deployers can determine whether the model service runs normally in this system as shown in the runtime node in fig 3 the swat model needs a windows platform if an administrator of a wrapper system in linux wants to deploy this package the wrapper system prevents it 2 model information extraction and registration extracts information from the model description language document and stores it in the service information library with information extraction the model service can be registered in the wrapper system which makes it easy for users to query 3 model file deployment is the release of the file resources mentioned above to the model service library 3 2 management and publication component 3 2 1 information classification and permission setting running the model service is dependent on more than a single geo simulation resource thus the model wrapper system is important for the management of several geo simulation resources for example once a model user invokes the swat model in the wrapper system the system must record this task and publish it as a service to the user fig 6 shows that these geo simulation resources in the wrapper system include model service related resources and data related resources the model service related resources can be used to retrieve manage invoke and run model services these resources include model services model run records and model running instances as follows 1 through the deployment module model services are deployed from model service packages which include model service information and model service files the model service information is classified into three parts model attribute information model deployment information and model status and access information the model attribute information is extracted from the model description language document model deployment information and some of the model status and access information are generated by the wrapper system different parts of the information have different duties this information can help model service users find the right models a model attribute information such as model name model type version and description is used to describe model services b model deployment information such as deployment time and deployer information is used to record information concerning when model services are deployed c model status and access information such as online offline permission public private and registration are used to mark the statuses and authorities of the model services once the model services have been deployed the management module stores this information in a service information library and builds an index of model services to facilitate retrieval by users the retrieval interfaces are shown in section 3 2 2 meanwhile the model service files are extracted from the abovementioned model service package 2 the model records are used to record information concerning the status configuration and log whereby model services are invoked model service users can supervise the status and obtain the results through records a model status information refers to the model in the given status divided into finished unfinished and exception b configuration information is a configuration document that supports running the model service including the input output information of the model and the id of the instance of model execution c the log information contains the run information of the model during execution and at the end of the run contains information logs of state switching model stand output stand exception and error invocation 3 the model running instances of the model are program processes of the model services and are stored in a model instance library these instances consist of run record information and the model instance handle the instance handle contains information such as the model instance id and model communication interface data related resources in fig 6 are the input output data of the run model services and data preprocessing methods and include the following elements 1 prior to running the model services the wrapper system should provide services to help users of the services upload input data and these data should be stored in the data cache library the data stored in the library include the format size tag generation time and other metadata as the model services complete processing the output data are stored in the data cache library which allows users to check download and visualize them 2 data preprocessing methods are conversion programs and libraries that may be invoked in model service these methods are stored in the data preprocessing methods library the permission setting is designed according to the above analysis the controlled status and access for model services in a service oriented wrapper system for geoanalysis models are controlled by the model status and access information these consist of online offline information permission information public information and register information as follows 1 the online status implies that the model service is available and can be used whereas an offline status means that the model service is unavailable and cannot be used 2 permission information is used to show users the token type before using the model to ensure that the model service is authorized for use the token is a key string set by a model provider and is used to control access to model services through provision to specific users public information has two states private and public 3 a private state means that the model services can be used only by the administrator of the given wrapper system a public state means that model services can be queried and used by everyone in the network 4 register information indicates whether the model has been registered on a portal site portal site is a web site that gathers registered models for sharing on the internet a registered model service is a model service that can be used in the portal as shown in fig 7 model service sharing is divided into three levels in the wrapper system private model service public model service and registered model service different user groups use different model service levels thus the wrapper system can control access rights for control of the model services 3 2 2 design and publication of services using rest all of the system s apis for model management and use are published through the publication module the publication protocols of related geo simulation resource services that need to be published in the wrapper system are in hypertext transfer protocol http and the design of the api follows the rest approach where web services are invoked as url based requests the path names of these resources are different and include the resource ids to indicate access to a unique resource the basic operations are addition deletion query and update of the resources and the http requests that post delete get and put correspond to these operations respectively special operations used to identify resources by a query string are added behind the path for example the invoking operation needs ac run to be added to the end of the path in the api of the model service resource as service invoking interfaces are designed according to the rest style they can accommodate various user operations in the related geo simulation resource services the design of the model service invoking interfaces is shown in table 1 the designs of the invoking interfaces for data services are shown in table 2 the designs of the interaction interface for model running instances are shown in table 3 3 3 communication and running interaction component 3 3 1 communication and interaction design as indicated above the interaction of a geoanalysis model can be complex and can vary greatly from one model to the next thus it is important to extend and design related communication and running interaction interfaces of geoanalysis models to reduce the amount of communication needed between models for example for the unstructured grid finite volume community ocean model fvcom chen et al 2003 step one entails two input data items first users input a geodom dat file which indicates the numbers of points and triangles in mesh then they input other files to indicate the location of the points and the structure of the triangles as shown in fig 8 the communication and interaction module operates in two parts the wrapper system and the model running instance the wrapper system has a publication module a control module and a communication module the publication module provides invocation interfaces to communicate with users provided in 3 2 2 by http the control module is used to control the logical operation of the instances of model execution and to translate the order of users into the order of interactions of this execution by socket the communication module is used to send messages to the instances of model execution by configuring a document to run the model service or to send messages for user operation and to receive messages from such instances there are two modules in the model running instance the running module and the monitoring module the running module is used to execute the native model and map native interfaces to standard interfaces the monitoring module is used to accept messages from the wrapper system change the state in the running module using an internal message exchange mechanism and send messages from the running module finally the interaction protocol involves the interaction of order and message between instances of execution of the model and the wrapper system once the model services have been invoked by users the wrapper system fires a model running instance in the computing node then these instances communicate with the communication module in the wrapper system which can change the run state based on this protocol in the model running instance and can obtain the state and output messages from it in some cases the user can stop model running instances using this protocol the interaction between the model running instance and the wrapper system is shown in fig 9 these interaction protocols are shown below initialization the model prepares for and begins to enter the running status and obtains the running parameters enter state the model begins to enter a running state and the state is marked fire event the model triggers an event in a state and the content of the general event is the input output data of the model or parameter adjustment which is a state that contains one or more events request data the model running instance asks the wrapper system for the input data of an event in a state response data the model running instance sends the wrapper system the input data of an event in a state leave state the model running instance leaves a state and the state is marked as stateless finalize the model running instance releases all resources and prepares to end the program request data mapping path the wrapper system sends the mapping library directory to the model running instance which helps the model running instance locate the corresponding data mapping method message export the model running instance outputs information error export the model running instance outputs error information warning export the model running instance outputs warning information 3 3 2 running monitoring and real time control when running model services interactions between instances of the running model and the wrapper system are determined by the input output configurations of the model services based on the requirements of service users the configuration documents for running the model service are created by the wrapper system the input output configurations of the model services are determined by the configuration documents as shown in fig 10 the configuration document consists of four parts the model service id model running instance id and model input and output data the model service id is the unique id of the model service in the service information library and the model service information can be queried by using this the model running instance id is the unique id used by model running instances to interact with the wrapper system the input output data of the model service are data interactions with the model service during the run in fig 10 the input data are dem data and the output data are filled dem data the wrapper system can monitor the status of the running instance of the model through calculations this monitoring involves records of run logs and exception judgments the run log records contain a log of the communication between the running instances and the wrapper system such as messages errors and warning export information and the standard outputs and error messages of the running instances of the model various exceptions in executing the model service may occur such as an exception in the model program a mismatch between model services and data or a mismatch between model services and the computing environment during execution the model service has five indicators for the types of exceptions including whether the process is successfully invoked whether the communication module is running and standard output standard error and error invoking information these indicators can provide users with information concerning the exceptions of the model service executed to evaluate the types of run exceptions encountered in executing the model 4 experiment 4 1 system building using the designs described above the authors employed the swat model version 664 and fvcom as examples to show the capabilities of the proposed service oriented wrapper system through standard encapsulation and packaging service oriented deployment management invocation and monitoring of the model service this case study completed all resource preparations model service management and publishing and model service interaction the encapsulation module provided c c and java as software development kit sdk to encapsulate various geoanalysis models as standardized models the management module and communication module were built using node js the wrapper system used http and socket to communicate with users and model running instances http uses 8060 port and socket uses 6000 as default the geo simulation resource library consisted of mongodb redis and memory cache model services and data preprocessing methods were stored in mongodb the data cache was stored in redis and the model running instances were stored in memory cache fig 11 shows the implementation of the wrapper system we built a graphical user interface gui to provide a function for the administrator to manage these resources in the network as shown in fig 12 the left sidebar of the wrapper system gui shows the management entries for all resource types including model resources and data resources the icons in the middle of the page can be used for rapid access to sub pages including those for the management of model services the notice system computer information model service deployment running service records the child node agent data cache and help the model service list page shows the model services stored in the model service library as shown in fig 13 the administrator can manage model services on this page which shows the information and operation of the model services the information includes the name version type permission accessibility and status of the model the operation of model services includes detail invocation and registration the data cache list page shows the input output data stored in the data cache library as shown in fig 14 the administrator of the wrapper system manages the input output data cache of the model run in the data cache list page this page shows the information and operation of the data cache the information includes the data tag storage type data size and date of generation the operation includes checking visualization download and deletion the model service record page is used to monitor the running of model services and check the results as shown in fig 15 the run records include run record statistics a run record list and details of the run records the run record statistics are used to monitor all run records and show the statistical information in this wrapper system as shown in fig 15a the statistical information includes the number of model services invoked over a certain period and the model services invoked most often in the given wrapper system as shown in fig 15c the run record list shows records that have been invoked in this wrapper system and provide the entry to check the details of the run record as shown in fig 15b the running record is each run of a model service and show detail of running information including the configuration and information on the model service run and log as shown in fig 15d on the run records page the input output data can be visualized 4 2 services generation we used the swat model and fvcom as examples to show all procedures the swat model is wrapped by c and fvcom by java through standard encapsulation the model service provider can map native data and the behavior interfaces to standard interfaces using the encapsulation tools described above as shown in fig 16 a the provider builds an executable file with standard interfaces from the swat model through encapsulation in this example the watershed data are calculated by invoking taudem using dem data hydrologic response units are generated by invoking mapwindow api and the simulation is initiated by using the swat executable file then as shown in fig 16b the provider copies the related files to a folder and packages them as shown in fig 17 a once the model service package of swat has been generated the administrator of the wrapper system can deploy the package to a wrapper system on the deployment page once a model service of swat is deployed the service is listed in the model service list a model service is published by setting the service status to online as shown in fig 17b by clicking the register button as illustrated in fig 17c the swat model service can be registered on the portal site once the service is registered it is shared on the internet and every user in the portal can use the swat model services provided by this computer 4 3 services use model users can obtain model services pertaining to swat information in two ways one way is to open the gui page in the wrapper system directly and the other is to visit the portal site http geomodeling njnu edu cn and search index keywords of swat in the first way as shown in fig 18 a the administrator provides the local url of the wrapper system to service users by visiting the url of the wrapper system users can access the swat service directly and use it in the second way as shown in fig 18b service users can search model items related to swat in the portal they can then obtain more details about swat and select an available service to use which is registered in the portal as shown in fig 19 a and b users can obtain details and information concerning the input output of the swat model service and prepare the input data for execution the invocation of the model service monitoring page is shown in fig 19c to demonstrate this we used data from mexico including dem data land use data soil data and weather data on this page users can check the status of a model run and obtain input output data once the run is finished fig 19d shows the output data of the swat model and some indicators in each sub watershed in this example no2 output was set as the indicator as shown in fig 20 we used the same method as a service to encapsulate fvcom which consists of four steps the authors thus represent fvcom as four model services the input data were mesh data from the east sea of china and a few parameters and the output data were the flow speed of waves in the east sea of china by refactoring the mesh data and output data we visualized the results as shown in fig 20d 5 discussion we designed and developed a flexible service oriented wrapper system for geoanalysis models to date there are more than 500 model services registered and available in our system most of these model services are simple calculation models such as slope and buffer calculation models and there are also over 10 large models still increasing including the swat and fvcom models mentioned above swmm and the wrf model we are still collecting models and encourage related researchers to upload their geoanalysis models among the generation procedures for model service encapsulation is the most difficult we are continually providing sets of tools and sdk to facilitate this step including providing several program languages for sdk and a code generator for encapsulation with the development of geographical and technological tools the behavior of geoanalysis models is becoming increasingly complex such models have not only simple running states but also many other behaviors such as iterations exchange of parameters with other geoanalysis models and other complex interactions in summary we will support more complex interactions between geoanalysis models and the wrapper system an advantage of the loose coupling framework is its flexibility for simulation resource contributors including model resource and computer resource and the service oriented architecture makes it convenient to share and reuse geoanalysis models in the wrapper system on the web for example a student develops a large model which need massive computing but could not pay the bill for high performance computer a non profit organization may provide a hpc for students for free the wrapper system can be the bridge between them and provide the model service for the user on the web we choose to design and code the wrapper system with the help of open source or free software and libraries and to encapsulate original geoanalysis models as plug and play components however the performance of model services will be limited in this architecture especially for small models like geo processing tasks fox example in the model running instance the monitoring module will cover extra hardware resources such as threads and must have message exchange with the wrapper system which will entail massive time costs furthermore message exchange on the web is slower than it is in memory but for complex and slow running models the additional time costs associated with message exchange on the web can be inconsequential compared to mode run time geoanalysis models require different data formats hardware and software environments and execution approaches before running a model service the wrapper system must search convert and match data that exist on the web to support the execution of the model services making full use of the intelligent data index and preparation and quickly coupling the data with the model are other key research issues in model service sharing we intend to complete model service oriented data preparation on the web in addition security for open services on the web remains a concern we have integrated some limits for usage control for three levels of users as mentioned above but there still remains much work in service protection for different users model service sharing does not always entail the unconditional sharing of a model resource it involves various stakeholders such as model service providers service users and computing resource providers according to collaboration and profit distributions we need to perfect the access to and control of model services during the contribution usage and research of each stakeholder in so doing the interests of all stakeholders such as copyrights can be protected model services can be shared and exploration and collaboration can occur to solve complex geographical problems on the web 6 summary we described an implementation strategy for a service oriented wrapper system for geoanalysis models in the open web environment the wrapper system solves key points including the preparation of model resources the management and publication of model resources and the invocation and execution of services we analysis using scenario for the wrapper system and types of geo simulation resources in this article we also create the interface for service user and protocol between model running instances and the wrapper system to enrich interaction for service users finally we have provided an implementation of the wrapper system and two cases swat model and fvcom usage in the wrapper system thus by publishing geoanalysis models as services in the open web environment the wrapper system supports service oriented reuse and sharing of geoanalysis models for geographical research acknowledgements we appreciate the detailed suggestions and comments from the anonymous reviewers we express heartfelt thanks to the other members of the opengms team this work was supported by the nsf for excellent young scholars of china under grant number 41622108 the national basic research program of china 973 program under grant number 2015cb954103 and the priority academic program development of jiangsu higher education institutions under grant 164320h116 
26308,3 d representations of flood inundation through emerging formats in virtual and augmented realities may be a powerful tool with which to interact with political decision makers and to engage people with flood hazards despite that environmental scientists are far from fully harnessing these techniques when interacting with non scientists integrations with computer graphic science is considered necessary to such an extent that a distinct and emerging field of research related to the visualization in assisting environmental scientists can be detected in the literature a key issue could be represented by the implementation of a simple visualization product that can be used by hydraulic engineers as a reasonable balance between the intrinsic informatics complexity of virtual reality and the practical need to represent flooding events in 3 d environments for risk communication purposes therefore this paper aims at defining a suitable path that starts from the river model set up and passing through 2 d flood simulations obtained by means of shallow water equations arrives at 3 d visualizations of the results in particular this paper is focused on developing an intentionally simple workflow for the representation of two dimensional hydraulic simulations within a 3 d virtual reality environment the level of detail as well as the pro and cons associated with the use of this procedure are discussed and the appropriateness of visualization outputs of the proposed procedure are analysed these issues are discussed with reference to a case study located in the old town of cosenza calabria italy keywords 3 d visualization flood hazard communication blender two dimensional numerical modelling shallow water equations 1 introduction the eu flood directive 2007 60 ec requires all member states to assess flood hazard and risk and adopt measures to reduce adverse impacts due to flood events a key step of the directive is the preparation of flood hazard and flood risk maps these essentially consist of a graphical representation of the numerical results of the maximum extension and hydraulic variables generally water depth and flow velocity usually computed by means of 1 d or 2 d hydraulic modelling according to probabilistic or deterministic approaches see for example de moel et al 2009 van alphen et al 2009 di baldassarre et al 2010 costabile et al 2015a guan et al 2018 the european directive does not provide specific guidance on the criteria to be used for the preparation of maps only in 2010 did the european commission publish the document risk assessment and mapping guidelines for disaster management as for the floods it cites the handbook on good practice for flood mapping in europe produced by the european exchange on flood mapping excimap 2007 in the chapter on flood hazard maps the handbook lists different elaborates flood extent map flood depth map and flow velocity and flood propagation map the flood depth map reports the water level values generally represented in various shades of blue or in multiple colours ranging from red to yellow and green the practice of flood mapping is older in the united states than in europe since this mapping is part of the basis of premium flood insurance setting in recent years the federal emergency management administration fema has promoted a study to improve flood map accuracy national research council 2009 this study analyses the factors that influence map accuracy assesses the benefits achievable by improving accuracy and provides perspectives for mapping and risk communication in particular the fema agency produces the flood insurance rate maps firms that identify flood insurance rate zones the firms in their digital version dfirm include three layers of information the base map imagery i e ortophoto digital elevation data and flood hazard data on the basis of dfirm information people can write an address at fema s floodsmart gov website and see whether the property is subject to flood risk and what the risk degree is low moderate or high in spite of this risk communication tool for people the report recognizes that fema has to improve the accuracy of flood data and maps and has to make a leap forward in communicating hazard and risk information national research council 2009 p 89 dransch et al 2010 underlined the current restrictions of risk communication nowadays mainly still oriented toward a cartography and risk expert perspective and proposed a frame that extends the technical view on risk maps to support effective risk communication to the laypeople indeed poor use is often made of the traditional risk maps for supporting decisions leskens et al 2014 and in any case they do not allow a non expert audience an immediate understanding of what is seen because the public may not be aware of the flooding impacts this is mainly due to the fact that 1 the existing flood hazard maps or web gis are not characterized by a good balance between simplicity and complexity with adequate readability and usability for the public hagemeier klose and wagner 2009 2 lay people experience difficulties with understanding and interpreting probabilistic risk information such as the return period that characterizes the flood maps o sullivan et al 2012 strathie et al 2017 3 many people have no direct experience of floods bradford et al 2012 highlighting that people find it difficult to imagine a flood really occurring especially for individuals living in flood prone areas that are unprotected by dikes botzen et al 2009 bubek et al 2012 moreover often flood maps do not meet the user needs for example rollason et al 2018 reported that group members want to know what the predicted flood levels meant for their properties and the potential impacts on them in comparison with past events in such a context it is clear that a significant part of risk management is risk communication which aims at the population at risk being prepared for an emergency situation maskrey et al 2016 argent et al 2016 risk communication also influences the perception of flood risk hagemeier klose and wagner 2009 strathie et al 2017 the role of public perception in developing flood risk strategies and enhancing resilience has been recently explored in several studies o sullivan et al 2012 bradford et al 2012 eiser et al 2012 kellens et al 2013 brennan et al 2016 roder et al 2016 some studies focus also on social aspects of flood risk management and perception because the latter can influence how individuals and groups prepare or not for these hazards and how they respond to information or hazard warnings kellens et al 2013 among the approaches used to explain how people judge a risk and the factors that influence the perception of a risk the so called psychometric model developed in psychology and decision research based on representations of the perception of the risk using metrics scaling and statistics is relevant in this context the factors controlling risk perception are numerous and can be characterized by a combination of awareness worry and preparedness bradford et al 2012 although these aspects are important they go beyond the scope of this paper a significant contribution in the flood hazard communication and risk perception can be provided by 3 d representations of flood inundation through emerging formats in virtual and augmented realities which provide new platforms with which to engage in a substantive process with stakeholders voinov et al 2016 virtual environments can be defined as computer based spaces that we can observe participate in and experience in person lin et al 2015 this approach is generally identified as realistic visualization the aim of which is to add drama to the scenarios while adhering to representation of accurate scientific representation kuser olsen et al 2016 more precisely as regards urban flooding there is some evidence that coping responses to flooding risks could be enhanced in a 3 d environment zaalberg and midden 2013 which at least improves the interpretability of disaster data and the effectiveness of decision making processes qiu et al 2017 despite limited efforts having been made in this field van ackere et al 2016 the potential of 3 d virtual reality in flood risk communication is gradually starting to be discussed in the literature lai et al 2011 zhang et al 2013 liang et al 2015 liu et al 2016 leskens et al 2017 leading also to the development of serious games for teaching and learning breuer et al 2017 these papers show that this approach is increasingly seen as a powerful tool with which to engage people with flood hazards the previous considerations gain importance in the flood risk management that being a developing activity with changes in legislation policy and practice necessarily involves the use and integration of knowledge from several disciplines samuels 2011 as a consequence considering the increasing importance of 3 d visualization techniques in the understanding and communication of flood simulation results by the public practitioners and decision makers a basic expertise in this topic seems to be no longer avoidable for scientists working on flood hazards taking into account the state of art outlined so far this paper is focused on developing an intentionally simple workflow to represent two dimensional hydraulic simulations within a 3 d virtual reality environment the flood simulations were obtained by means of a numerical model based on shallow water equations costabile and macchione 2015 this workflow has been applied for displaying virtual views of a potential flooding of the crati river in the old town of cosenza the scientific visualization of the 2 d flooding simulations was performed using the open source software blender that to the authors knowledge has never been applied to problems like these before 2 study area and available data cosenza is a town located at the confluence of two rivers the busento and the crati fig 1 around which the urban area has developed the historical series of the floods that have affected the town over the centuries highlights a real risk of flooding due to the crati river overflow on october 30th 1590 the crati river broke its banks and flooded the spirito santo and st agostino neighbourhoods on september 23rd 1729 a flood caused the collapse of the st lorenzo bridge on october 29th 1789 a flood brought a part of the rivocati bridge down in 1790 there was another overflow of the crati river on september 14th 1839 a violent flood invaded ground floors of buildings of the st agostino st lorenzo bridge and the spirito santo areas three years later a similar event took place again due to the additional damage caused by the flood of april 1853 a retaining wall was built along the crati river on september 26th 1860 cosenza experienced another overflow that severely damaged the spirito santo st lorenzo and st agostino neighbourhoods on november 24th 1959 the crati river flooded several areas of the old town many buildings were damaged and about 600 people remained homeless the workflow proposed in section 4 has been applied to the part of the domain that has been flooded by the crati river over the last few centuries for the construction of the computational grid related to the area topographic data obtained by high resolution airborne lidar survey 4 points per square meter were used the horizontal and vertical resolution of the data are respectively equal to 0 5 cm and 15 20 cm the calculation refers to a hypothetical flood with a return time of 500 years the details of the calculation can be found on the web http www regione calabria it abr index php option com content task view id 460 itemid 299 the hydraulic analysis of the flood evolution and the simulations details are not discussed here because they go beyond the purpose of the work and in any case can be found in costabile and macchione 2015 3 related work 3 1 numerical simulation of a hypothetical flood 3 1 1 river model set up the first step for the 2 d flood simulation is the setting up of the river model to be used the computational domain has been organized using an unstructured grid because due to its high degree of flexibility and adaptability it provides an accurate geometrical description of the site even in the presence of a significant topographical gradient or when the hydraulic variables are expected to change very rapidly costabile and macchione 2015 the computational grid has been organized in such a way as to respect all the singularities that characterize an urban environment such as the structure lines canals streams breaklines roads levees etc buildings weirs etc fig 2 the mesh is denser in areas of interest specifically in the riverbed at the levees and inside the town close to the river the nodal generation process was carried out using aquaveo sms surface water modelling system the output of this step is an irregular triangular network saved in a specific format provided by aquaveo sms 2 dm containing both the coordinate of the nodes s and the id of the nodes composing the grid itself as a rough indication the main roads and the channelized rivers were discretized with cells having average dimensions of 5 m2 and 8 m2 respectively as for the buildings their contours have been treated as solid wall i e interior boundary condition the bridges have been treated as shown in costabile and macchione 2015 and in costabile et al 2015b 3 1 2 numerical model the second step concerns the hydraulic simulation of a hypothetical flood it seems important to recall here that an accurate local estimation of the water levels timing and duration of inundation can be achieved by only using the 2 d fully dynamic shallow water equations swe teng et al 2017 that are widely used in the literature see for the recent ones cea and bladé 2015 xia et al 2017 macchione et al 2016 costabile et al 2017 guan and liang 2017 vacondio et al 2017 in particular in this paper the results obtained using the finite volume methodology fvm have been used for the numerical integration of the system numerical fluxes have been computed using the first order roe scheme the numerical code stability has been enforced with a semi implicit approach of the friction slope for the bottom slopes computation wet dry treatment and other numerical details one may refer to costabile and macchione 2015 in this paper attention is focused only on the outputs provided by the proposed workflow underlining their importance and use in practice the numerical solutions generate one or more text files containing the water surface levels calculated in the barycentre of each computing cell and the velocity field for the purpose of this work we used only the simulated water depths computed in predetermined instants of time and the maximum water depths in order to have the water surface consistent with the ground surface the final step was to interpolate the water surface levels into the same nodes used for the computational grid presented in the previous sub section once again the output of this step is an irregular triangular network saved in the 2 dm format containing both the coordinates of the nodes and the id of the nodes composing the grid itself 3 1 3 representation of the numerical results with a flood hazard map fig 3 shows the results displayed according to the classic representation of a hazard map the map was made according to criteria similar to those reported in the national research council 2009 and excimap 2007 in particular the water depths are represented according to various shades of the colour blue it is evident that from this type of map it is not possible to have immediate and accurate information on the depth of the water especially when the depth range is very wide as in this case even differentiating the increments at the deep and shallow depths the number of shades becomes high and the human eye does not easily distinguish one class from another on the other hand the use of different colours does not lead to a more intuitive understanding of the map furthermore it is not easy to realize the level at which water reaches the various points of the streets and the facades of buildings so it is difficult to have an immediate perception of the viability of buildings and roads 4 proposed method for a quick 3 d representation of 2 d hydraulic results the workflow goal is to achieve a simple representation of two dimensional hydraulic simulations within a 3 d virtual reality environment able to support scientists technicians and agencies for emergency management in flood risk communications this section has been organized in such a way that a reader can understand all the key aspects related to the connections between river model set up 2 d flood simulations and 3 d visualizations of the results in particular the procedure is based on two main steps 1 3 d building reconstruction and modelling for realistic visualization purposes 2 visual quality improvement of virtual urban environment and final renderings the whole procedure including hydraulic calculations is therefore made of four steps as shown in fig 4 which also shows the software used for each step 4 1 3 d building reconstruction and modelling buildings are relevant objects in an urban area the first problem to be faced is the level of detail lod definition of the 3d model level of detail is an important concept in 3d city modelling since it defines the degree of abstraction of real world objects primarily designated to use an optimum amount of details according to the user s needs for the 3d objects the open standardized data model citygml defines five different standard levels of detail lod 0 4 which are differentiated mostly by the complexity of the geometries in this study the authors have chosen to represent 3d building models with lod1 which is defined as the well known blocks model comprising prismatic buildings with flat roof structures open geospatial consortium 2012 in other words the level of detail in lod1 consists in representing the buildings as solid elements with vertical walls obtained by extruding the footprint and modelled at the eaves of a building the lod1 model contains no semantics on constituting geometries and it is consistent with the assumption introduced in our flood simulation model specifically it should be recalled that the most accurate way to consider the influence of buildings in shallow water models is to consider them as solid wall internal boundaries see for example schubert and sanders 2012 that means they are treated as not submergible solids as a consequence no variations occur along the vertical development of the wall in the hydraulic modelling of the buildings furthermore buildings are acquired by extracting from their 2d footprints in the shape file format in combination with airborne lidar point cloud a representative height of the building is found by averaging the heights of the lidar points inside the footprint some esri arcgis 10 3 geoprocessing tools are used to generate a set of random sample points constrained by building footprints and referenced to their unique object identifiers thus a horizontal plane approximates the building s roof since the 3 d virtual city model is intended for understanding the flood hazard in an urban area the texture mapping technique is used to improve the realism of the building model façade for this purpose sketchup make 2014 was used because it allows one to capture google maps street view imagery inserting texture on the facades of buildings giving them a realistic look the photo texture is not part of the lod specification but the appearance may represent features not geometrically and semantically acquired building elements doors windows etc may not be geometrically present in a textured model however they are available for approximate measurements biljecki et al 2014 the main limitations of this kind of approach will be explained later 4 2 improvement of visual quality and final rendering the final step is to move from a very basic scene to a more realistic and attractive one to provide realism to the world environment computational grid and water surface the user has to set the materials of each object and the textures the camera settings and the lighting of the scene these operations can be performed using a 3d software that includes a render engine in our approach the buildings and the grids related to the ground level and the maximum water levels were imported into blender which is a free and open source 3 d creation suite and cross platform and is optimized for three dimensional graphics high quality rendering of 3 d models and data according to the purposes of the work the authors chose blender because it is possible to get a good enough mastery of this program without specialized training due to its intuitive graphical user interface gui moreover an active and wide ranging community support provides the amount of online material for developers and users such as tutorials videos articles add ons and scripts while blender has long been a popular open source software among animators and visual effects artists in recent years it has also become a tool for visualizing data in different fields of research andrei et al 2012 kent 2015 jorstad et al 2015 naiman 2016 palomar vazquez et al 2017 on the internet https www youtube com watch v wgpxzwlugdo there are videos showing urban inundation due to tsunami simulated with blender s fluid simulator based on the lattice boltzmann method lbm as the blender manual highlights for the lbm solver the large domains long duration high velocities and low viscosities make the simulation harder to compute it is important to recall here that our interest in the use of blender does not lie in the use of its physical simulator but only in the rendering of a 3d urban environment of flooded areas simulated by our hydraulic model in this context blender has two default render engines blender internal and cycles blender internal works by calculating which objects are visible to the camera and which are not by simulating the behaviour of light so it is a non photo real render engine cycles is an unbiased physically based path tracing engine it gives a more realistic rendering but clearly requires long renderings times compared to other unbiased engines cycles can utilize a graphics card in opencl mode ati graphics cards or cuda nvidia graphics cards so a significant speeding up of the calculation can be obtained blender manual kent 2015 we used cycles render engine the pre operative step is to import buildings terrain and water surface into blender in order to increase the level of the automation of the global procedure a script is implemented to import the grid data ground and simulated water levels in blender using the python application programming interface api the python script is made available as a part of this paper as supplementary material then materials and textures are created and assigned to the world environment computational grid and water surface mesh materials lights and backgrounds are well defined using a shading nodes network these nodes output shaders colours values and vectors for the world environment the high dynamic range image based lighting hdr ibl technique is adopted to illuminate the scene and to enhance reflections using the uv mapping technique a georeferenced high resolution 8001 8002 pixels orthophoto was mapped over the computational grid this process assigns 2d coordinates to mesh polygon s vertex providing an accurate texturing and more realism to the scene a specific water and mud material was created for the water mesh for illustrative purpose in fig 5 we present the material nodes scheme the node scheme consists of mixing between anisotropic bsdf and glass bsdf shaders to create glossy and rough reflection the layer weight node produces a fresnel effect for blending shaders by driving the fac input of the mix shader node a diffuse node is used to give the surface the characteristic colour of muddy water the acronym bsdf stands for bidirectional scattering distribution function and defines the probability that a specific light ray will be reflected at a given angle by setting the roughness factor it makes glass shader matter and diffuse surfaces more light absorbing in accordance with flooding water the wave texture node reproduces a water rippling effect on the static surface adding procedural bands with a sine profile 5 flood event in a 3 d virtual environment results in this section we provide some pictures showing parts of the town with and without water levels in order to give an idea of the level of detail that one may obtain using our procedure then we provide a discussion to support the idea that the outputs of the proposed workflow represent a useful integration to the classic maps contributing to satisfy the different needs that according to meyer et al 2012 different end user groups from strategic planning groups emergency management to the public have with regards to flood maps the images shown in figs 6 8 are three examples of a three dimensional representation of the information depicted in the flood map shown in fig 3 in the same figures classic flood hazard maps are also included to highlight the value that virtual views add to the communication of actual hazard conditions making risk perception easier in particular fig 6 refers to a situation occurring along the left bank upstream of the st lorenzo bridge in the spirito santo neighbourhood figs 7 and 8 refer to martiri street in these figures the water depths computed around the time corresponding to their maximum values are depicted indeed the information content of these images is not exactly identical to that contained in the hazard map because the hazard map shows the envelope of the maximum depths while the 3 d image represents the depths during the period of maximum depths and obviously the two things are not strictly equal in any case we preferred to represent the surface at a given instant instead of the envelope of the maximum depths to give a physically congruent and therefore more realistic image of the water surface the comparison with the image of the same area without flooding using the same point of view helps the human eye to realize the water depths in the different locations the images of the town without flooding have been taken from google earth in the 3 d view the white arrows help to localize the same objects in the figure in order to make the comparison easier more precisely figs 7 and 8 show the simulated inundation for martiri street which is separated from the channelled water by the right bank of the crati river the point of view shown in fig 7 helps to realize the level reached by the surface of the water and the human eye looking at the facades of the buildings easily perceives that the water reaches almost the soffit of the ground floors fig 8 helps to perceive at a glance the state of the river current when it produces the flooding of adjacent streets this type of image may represent a never before seen situation to people who have no experience of previous floods of the crati river which might increase the level of risk awareness in that area moreover the contrast between different corrugations used for the water textures greater for the channelled water and slightly smoother for urban flood areas helps the eye to understand intuitively that the flooding hazard originates from the river the rendering of the urban area obtained with this application is characterized by a similar level of detail in comparison to that reproduced by google earth for cosenza in some cases see fig 8c buildings facades are presented with more definition and with less distortion than in google earth 6 discussion of the proposed workflow on the basis of our experience gained in the 3 d visualization of a 2 d flood simulation we underline in this section the advantages and limitations that are associated with the use of the proposed workflow 6 1 strong points the main strong points of our procedures can be summarized in what follows 1 several parts of the procedure are based on free and open source software these software products provide full access to freely modifiable source programs according to one s own interests for example blender can be customised using python in order to fulfil the user needs 2 the workflow is characterized by a significant degree of automation in particular the fully automated steps concern a the use of python scripts for the communication between blender and the text files describing the grid representing the river topography and the simulated water surfaces and b the generation of buildings footprints in a gis environment starting from a lidar survey 3 the use of texture allows the user to improve the level of realism without increasing the complexity of the building modelling however this fact shows some drawbacks in the sense explained later 4 the procedure is relatively easy and simple to implement in all the steps related to the building modelling the connections between hydraulic computations and visual environments and the final rendering no particular knowledge in computer graphics is required 5 the urban model and the water surfaces do not require any particularly large resources of memory because the computer data storage resources needed are low this allows fast analyses and management of the virtual environment 6 2 weak points 1 building façades are characterized by planar polygons this modelling approach is satisfactory for orthogonal views for oblique views however the differences between the 3 d model and the real façade geometry reproduced in the photo textures are evident especially in the presence of balconies bows corbels and so on the absence of parallax points out the flatness of the surface 2 the use of uncalibrated photos i e without camera position information involves stretching and pinching problems in the textured façades the foreshortening and masking due to perspective projection implies that the façade is not rectangular consequently when texturing onto a rectangular facade the resulting image presents severe distortions this fact must be considered carefully when one tries to zoom the image to the level of the individual building in order to evaluate in detail the water level close to it in this case it might be useful to collect terrestrial lidar scans in order to have photorealistic meshes for the representation of 3d environments risse et al 2018 3 rendered views show different illuminations between the virtual model and the real environment as the former is acquired by photo textures which might present fictitious shadows induced by objects not reproduced in the 3 d model 4 the photo textures quality is related to camera and standpoint in narrow or jammed streets there is the risk of taking a photo of a façade with vehicles vegetation or pedestrians flattened onto it 5 the inability of the shallow water equations to simulate secondary corrugations of the water surface makes the visualized water surfaces smoother than they actually are for the same reason extremely localized phenomena with significant vertical components of velocities water jets or splashes cannot be visualized however to make the effect of moving water more realistic procedural textures were used in particular a more rippled texture was used for the water surface at the channelled stream while a texture more similar to stagnant water was used for the flooded areas therefore the choice of water texture must always be aimed at communicating flow velocity values and at least turbidity for example if the water is stagnant in a flooded area a smoother and more reflective surface should be used as done in fig 8c however in order to communicate the rapid inundation that might occur in the same area e g in case of levee overtopping another image that displays the flood wave front arrival using a much more corrugated texture might be produced to enforce the idea that the inundation could sneak up on the people the comparison of frames related to consecutive time steps would help people to better realize the sudden and fast flow arrival that might lead to a situation characterized for some time by stagnant water and thus an impassable street in this sense well constructed images can provide additional information compared to the classic hazard map 7 perspectives how the 3 d visualization outputs can integrate flood hazard maps to satisfy the needs of different end user groups in flood risk management prior to focusing on the potential value that our methodology could have for decision makers and laypeople it is important to clarify here that the virtual views showed in this paper cannot replace hazard maps since the latter report the envelope of numerical results while the 3 d views represent the situation at a single time step close to the time to peak obviously the two things do not necessarily coincide even for very small areas however this limit could be overcome by using various frames at particular time steps of simulation for a given area this could be a first step towards realizing movies bearing in mind the limitations underlined in the previous section the perspective of the added value of the 3 d outputs of the workflow proposed here can be summarized in what follows 7 1 getting of people s attention the analysis of figs 6 8 allows us to underline one of the several benefits associated to the use of 3 d visualization and in particular to provide an answer to the crucial question in flood risk communications which is of how to get the attention of people who have not been affected by the topic so far maidl and buchecker 2015 since there are no historic photos which can document the scenario that could occur in this area during a flooding event these 3 d visualizations clearly represent pictures which are able to explain the consequence of a flooding event to all generations especially those who have not experienced a flood in this context the visual risk communication based on the 3 d graphics is an effective substitute for personal experience in areas at risk seldom affected by hazards as considered necessary in the literature see for example lindell and perry 2003 however it should be observed that the more vivid the visual representations are then the more has responsibility to communicate correctly what can really happen in a given area 7 2 risk perception the benefits of the 3 d visual representation can be further appreciated in the two details shown in figs 9 and 10 for the point of view see fig 7 referred to martiri street in particular the above figures refer to the façades shown on the left and right ends respectively of fig 7 bearing in mind the drawbacks associated to the use of this procedure for the accurate representation of the water levels close to the buildings see section 6 it is clear that figs 9 10 compared to the flood hazard map shown in fig 3 might add further information about the interaction between the flood level and the public private goods and allow people to better imagine how severe the flood is in that area for example people living in those buildings can roughly realize whether the maximum flood level may reach their balconies or if it is simply limited to the ground floor moreover the perception of the viability of the entrance to the building and the streets and lanes surrounding the building is more immediate considering these benefits in terms of a better understanding of flood related issues the proposed visualization techniques could be nested in wider flood information systems in which the visualization module is the key element to make data more accessible and understandable to the public demir and krajewski 2013 it should be noted however that the two images refer to out of bank areas for which our results may induce the perception of an inundation characterized by almost stagnant water levels it would have been more problematic performing 3 d visualizations related to high velocity flood flows approaching and interacting with building facades 7 3 emergency planning and preparation the previous images show how cosenza could be transformed during a flood event highlighting that all roads near the river are impassable with water levels up to the ground floors of buildings therefore this kind of visual communication of flood risk contributes to the development and better communication of emergency planning also because it facilitates the identification of evacuation routes assembly points the number of people who would need to be evacuated and so on outputs like these can be integrated together with the shallow water model infrastructure assessment model and evacuation planning models into a single system leading to a fully automated scheme for emergency preparedness as shown by akbar et al 2013 who used model output saved in kml format viewable in google earth for decision making moreover figures like these help the public to realize the behaviour that they should have in case of flooding to move to the first floor or the roof for example or whether evacuation is necessary this aspect is essential because it has been shown that in several cases people seem to be aware of the risk they are subjected to but they do not behave according to those perceptions and concerns mysiak et al 2013 therefore the workflow discussed here could give important indications about how citizens should behave in case of a flood another important aspect of risk communication is to show the rapid and often the discontinuous behaviour of the evolution of the flood this effect obviously cannot be communicated with single frames but it is necessary to produce videos however thisgoes beyond the scope of this paper 7 4 supporting flood damage estimate the estimation of the consequences associated to the evolution of the flood is easier because the image is vivid and realistic in particular 3 d views like these can be particularly useful for the damage estimation liu et al 2017 moreover those figures might favour a validation approach of 2 d flood simulation results focusing on flood exposure and loss analyses at the single building scale zischg et al 2018 as is well known messner et al 2007 these analyses can be performed at different scales macro scale meso scale micro scale in the last of these for example damages are calculated for single properties while the meso scale analysis considers aggregated land units residential areas industrial areas and so on in this context the depth damage curves are used see for example garrote et al 2016 it is quite obvious that the pictures shown in figs 6 10 might provide further evaluation elements because they roughly show the maximum water levels in relation with both the business premises or warehouses mainly located at the ground floor and private apartments in the upper floors though these images can provide additional information for a case by case analysis a better estimation of flood damages can be achieved only using a 3 d digital representation of all aspects of a building in a single information model using the so called bim building information model approach as recently shown by amirebrahimi et al 2016 finally it is essential to underline here that the results presented in this paper have not been tested to assess how much the 3d representation improves flood risk communication to lay people compared to flood hazard maps this aspect will be addressed in a future work 8 concluding remarks this work has focused on the proposal of support tools for a more intuitive interpretation of classic hazard maps in this sense the work is essentially based on the concept of hazard risk and therefore can be framed in the context of risk management however in section 7 further developments were outlined which could also help to build flood prediction tools useful in the context of disaster management the images in this paper highlight the significant level of realism that can be achieved graphic rendering of the town model achieved by this approach has shown the same quality which can be currently obtained with google earth for cosenza it should be noted that the effectiveness of the images shown in this study for hazard communication purposes has not been quantitatively tested yet this activity though already planned by the authors does not fall within the scope of this paper and therefore will be addressed in a future work the 3 d visualization outputs obtained using the proposed workflow can support classical maps in order to satisfy the needs of different end user groups in flood risk management the pictures shown in this paper cannot by themselves replace the classic hazard risk maps however considering that several frames can be produced using the method proposed in this work it is clear that the whole flood behaviour in a given area can be represented by a sequence of consecutive images depicting in particular the water levels evolution and their persistence over time for hazard communication purposes the use of this sequence of frames reveals more information than classic 2 d maps representing the water levels and it might be proposed even as a useful support for the so called flood propagation maps for particular time steps suggested by excimap 2007 the main strong points of the proposed workflow are related to the use of free and open source software and the presence of fully automatic steps in the procedure moreover no particular knowledge ofcomputer graphics or significant resources of computer memory are requested the suitability of the procedure for representing particulars of the water surfaces at the level of the individual buildings in detail depends on the resolution of the textures used for buildings the size of the computation grid cells and interpolation of the numerical results calculated for each cell a further aspect that should be considered is the inability of shallow water equations to simulate the secondary corrugations of the free surface which are particularly developed in torrential currents thus the water surfaces that are produced in the 3 d maps shown here appear smoother than they actually are this could generate reduced perception of the dynamic effects of the current this requires further work that has not been addressed in this article finally this paper has attempted to highlight the importance of getting people s attention and supporting flood damage estimates risk perception emergency planning and preparation acknowledgements this paper is based on research carried out in partial fulfilment of the ph d requirements at the university of calabria for the fourth author under the scientific supervision of the first and the second authors the numerical simulation of the flood was based on the data and methods developed in the project por calabria 2000 2006 asse 1 misura 1 4 azione 1 4 c studio e sperimentazione di metodologie e tecniche per la mitigazione del rischio idrogeologico lotto 8 metodologie di individuazione delle aree soggette a rischio idraulico di esondazione for which the first author was the principal investigator appendix a supplementary data the following is the supplementary data to this article data profile data profile appendix a supplementary data supplementary data to this article can be found online at https doi org 10 1016 j envsoft 2018 11 005 
26308,3 d representations of flood inundation through emerging formats in virtual and augmented realities may be a powerful tool with which to interact with political decision makers and to engage people with flood hazards despite that environmental scientists are far from fully harnessing these techniques when interacting with non scientists integrations with computer graphic science is considered necessary to such an extent that a distinct and emerging field of research related to the visualization in assisting environmental scientists can be detected in the literature a key issue could be represented by the implementation of a simple visualization product that can be used by hydraulic engineers as a reasonable balance between the intrinsic informatics complexity of virtual reality and the practical need to represent flooding events in 3 d environments for risk communication purposes therefore this paper aims at defining a suitable path that starts from the river model set up and passing through 2 d flood simulations obtained by means of shallow water equations arrives at 3 d visualizations of the results in particular this paper is focused on developing an intentionally simple workflow for the representation of two dimensional hydraulic simulations within a 3 d virtual reality environment the level of detail as well as the pro and cons associated with the use of this procedure are discussed and the appropriateness of visualization outputs of the proposed procedure are analysed these issues are discussed with reference to a case study located in the old town of cosenza calabria italy keywords 3 d visualization flood hazard communication blender two dimensional numerical modelling shallow water equations 1 introduction the eu flood directive 2007 60 ec requires all member states to assess flood hazard and risk and adopt measures to reduce adverse impacts due to flood events a key step of the directive is the preparation of flood hazard and flood risk maps these essentially consist of a graphical representation of the numerical results of the maximum extension and hydraulic variables generally water depth and flow velocity usually computed by means of 1 d or 2 d hydraulic modelling according to probabilistic or deterministic approaches see for example de moel et al 2009 van alphen et al 2009 di baldassarre et al 2010 costabile et al 2015a guan et al 2018 the european directive does not provide specific guidance on the criteria to be used for the preparation of maps only in 2010 did the european commission publish the document risk assessment and mapping guidelines for disaster management as for the floods it cites the handbook on good practice for flood mapping in europe produced by the european exchange on flood mapping excimap 2007 in the chapter on flood hazard maps the handbook lists different elaborates flood extent map flood depth map and flow velocity and flood propagation map the flood depth map reports the water level values generally represented in various shades of blue or in multiple colours ranging from red to yellow and green the practice of flood mapping is older in the united states than in europe since this mapping is part of the basis of premium flood insurance setting in recent years the federal emergency management administration fema has promoted a study to improve flood map accuracy national research council 2009 this study analyses the factors that influence map accuracy assesses the benefits achievable by improving accuracy and provides perspectives for mapping and risk communication in particular the fema agency produces the flood insurance rate maps firms that identify flood insurance rate zones the firms in their digital version dfirm include three layers of information the base map imagery i e ortophoto digital elevation data and flood hazard data on the basis of dfirm information people can write an address at fema s floodsmart gov website and see whether the property is subject to flood risk and what the risk degree is low moderate or high in spite of this risk communication tool for people the report recognizes that fema has to improve the accuracy of flood data and maps and has to make a leap forward in communicating hazard and risk information national research council 2009 p 89 dransch et al 2010 underlined the current restrictions of risk communication nowadays mainly still oriented toward a cartography and risk expert perspective and proposed a frame that extends the technical view on risk maps to support effective risk communication to the laypeople indeed poor use is often made of the traditional risk maps for supporting decisions leskens et al 2014 and in any case they do not allow a non expert audience an immediate understanding of what is seen because the public may not be aware of the flooding impacts this is mainly due to the fact that 1 the existing flood hazard maps or web gis are not characterized by a good balance between simplicity and complexity with adequate readability and usability for the public hagemeier klose and wagner 2009 2 lay people experience difficulties with understanding and interpreting probabilistic risk information such as the return period that characterizes the flood maps o sullivan et al 2012 strathie et al 2017 3 many people have no direct experience of floods bradford et al 2012 highlighting that people find it difficult to imagine a flood really occurring especially for individuals living in flood prone areas that are unprotected by dikes botzen et al 2009 bubek et al 2012 moreover often flood maps do not meet the user needs for example rollason et al 2018 reported that group members want to know what the predicted flood levels meant for their properties and the potential impacts on them in comparison with past events in such a context it is clear that a significant part of risk management is risk communication which aims at the population at risk being prepared for an emergency situation maskrey et al 2016 argent et al 2016 risk communication also influences the perception of flood risk hagemeier klose and wagner 2009 strathie et al 2017 the role of public perception in developing flood risk strategies and enhancing resilience has been recently explored in several studies o sullivan et al 2012 bradford et al 2012 eiser et al 2012 kellens et al 2013 brennan et al 2016 roder et al 2016 some studies focus also on social aspects of flood risk management and perception because the latter can influence how individuals and groups prepare or not for these hazards and how they respond to information or hazard warnings kellens et al 2013 among the approaches used to explain how people judge a risk and the factors that influence the perception of a risk the so called psychometric model developed in psychology and decision research based on representations of the perception of the risk using metrics scaling and statistics is relevant in this context the factors controlling risk perception are numerous and can be characterized by a combination of awareness worry and preparedness bradford et al 2012 although these aspects are important they go beyond the scope of this paper a significant contribution in the flood hazard communication and risk perception can be provided by 3 d representations of flood inundation through emerging formats in virtual and augmented realities which provide new platforms with which to engage in a substantive process with stakeholders voinov et al 2016 virtual environments can be defined as computer based spaces that we can observe participate in and experience in person lin et al 2015 this approach is generally identified as realistic visualization the aim of which is to add drama to the scenarios while adhering to representation of accurate scientific representation kuser olsen et al 2016 more precisely as regards urban flooding there is some evidence that coping responses to flooding risks could be enhanced in a 3 d environment zaalberg and midden 2013 which at least improves the interpretability of disaster data and the effectiveness of decision making processes qiu et al 2017 despite limited efforts having been made in this field van ackere et al 2016 the potential of 3 d virtual reality in flood risk communication is gradually starting to be discussed in the literature lai et al 2011 zhang et al 2013 liang et al 2015 liu et al 2016 leskens et al 2017 leading also to the development of serious games for teaching and learning breuer et al 2017 these papers show that this approach is increasingly seen as a powerful tool with which to engage people with flood hazards the previous considerations gain importance in the flood risk management that being a developing activity with changes in legislation policy and practice necessarily involves the use and integration of knowledge from several disciplines samuels 2011 as a consequence considering the increasing importance of 3 d visualization techniques in the understanding and communication of flood simulation results by the public practitioners and decision makers a basic expertise in this topic seems to be no longer avoidable for scientists working on flood hazards taking into account the state of art outlined so far this paper is focused on developing an intentionally simple workflow to represent two dimensional hydraulic simulations within a 3 d virtual reality environment the flood simulations were obtained by means of a numerical model based on shallow water equations costabile and macchione 2015 this workflow has been applied for displaying virtual views of a potential flooding of the crati river in the old town of cosenza the scientific visualization of the 2 d flooding simulations was performed using the open source software blender that to the authors knowledge has never been applied to problems like these before 2 study area and available data cosenza is a town located at the confluence of two rivers the busento and the crati fig 1 around which the urban area has developed the historical series of the floods that have affected the town over the centuries highlights a real risk of flooding due to the crati river overflow on october 30th 1590 the crati river broke its banks and flooded the spirito santo and st agostino neighbourhoods on september 23rd 1729 a flood caused the collapse of the st lorenzo bridge on october 29th 1789 a flood brought a part of the rivocati bridge down in 1790 there was another overflow of the crati river on september 14th 1839 a violent flood invaded ground floors of buildings of the st agostino st lorenzo bridge and the spirito santo areas three years later a similar event took place again due to the additional damage caused by the flood of april 1853 a retaining wall was built along the crati river on september 26th 1860 cosenza experienced another overflow that severely damaged the spirito santo st lorenzo and st agostino neighbourhoods on november 24th 1959 the crati river flooded several areas of the old town many buildings were damaged and about 600 people remained homeless the workflow proposed in section 4 has been applied to the part of the domain that has been flooded by the crati river over the last few centuries for the construction of the computational grid related to the area topographic data obtained by high resolution airborne lidar survey 4 points per square meter were used the horizontal and vertical resolution of the data are respectively equal to 0 5 cm and 15 20 cm the calculation refers to a hypothetical flood with a return time of 500 years the details of the calculation can be found on the web http www regione calabria it abr index php option com content task view id 460 itemid 299 the hydraulic analysis of the flood evolution and the simulations details are not discussed here because they go beyond the purpose of the work and in any case can be found in costabile and macchione 2015 3 related work 3 1 numerical simulation of a hypothetical flood 3 1 1 river model set up the first step for the 2 d flood simulation is the setting up of the river model to be used the computational domain has been organized using an unstructured grid because due to its high degree of flexibility and adaptability it provides an accurate geometrical description of the site even in the presence of a significant topographical gradient or when the hydraulic variables are expected to change very rapidly costabile and macchione 2015 the computational grid has been organized in such a way as to respect all the singularities that characterize an urban environment such as the structure lines canals streams breaklines roads levees etc buildings weirs etc fig 2 the mesh is denser in areas of interest specifically in the riverbed at the levees and inside the town close to the river the nodal generation process was carried out using aquaveo sms surface water modelling system the output of this step is an irregular triangular network saved in a specific format provided by aquaveo sms 2 dm containing both the coordinate of the nodes s and the id of the nodes composing the grid itself as a rough indication the main roads and the channelized rivers were discretized with cells having average dimensions of 5 m2 and 8 m2 respectively as for the buildings their contours have been treated as solid wall i e interior boundary condition the bridges have been treated as shown in costabile and macchione 2015 and in costabile et al 2015b 3 1 2 numerical model the second step concerns the hydraulic simulation of a hypothetical flood it seems important to recall here that an accurate local estimation of the water levels timing and duration of inundation can be achieved by only using the 2 d fully dynamic shallow water equations swe teng et al 2017 that are widely used in the literature see for the recent ones cea and bladé 2015 xia et al 2017 macchione et al 2016 costabile et al 2017 guan and liang 2017 vacondio et al 2017 in particular in this paper the results obtained using the finite volume methodology fvm have been used for the numerical integration of the system numerical fluxes have been computed using the first order roe scheme the numerical code stability has been enforced with a semi implicit approach of the friction slope for the bottom slopes computation wet dry treatment and other numerical details one may refer to costabile and macchione 2015 in this paper attention is focused only on the outputs provided by the proposed workflow underlining their importance and use in practice the numerical solutions generate one or more text files containing the water surface levels calculated in the barycentre of each computing cell and the velocity field for the purpose of this work we used only the simulated water depths computed in predetermined instants of time and the maximum water depths in order to have the water surface consistent with the ground surface the final step was to interpolate the water surface levels into the same nodes used for the computational grid presented in the previous sub section once again the output of this step is an irregular triangular network saved in the 2 dm format containing both the coordinates of the nodes and the id of the nodes composing the grid itself 3 1 3 representation of the numerical results with a flood hazard map fig 3 shows the results displayed according to the classic representation of a hazard map the map was made according to criteria similar to those reported in the national research council 2009 and excimap 2007 in particular the water depths are represented according to various shades of the colour blue it is evident that from this type of map it is not possible to have immediate and accurate information on the depth of the water especially when the depth range is very wide as in this case even differentiating the increments at the deep and shallow depths the number of shades becomes high and the human eye does not easily distinguish one class from another on the other hand the use of different colours does not lead to a more intuitive understanding of the map furthermore it is not easy to realize the level at which water reaches the various points of the streets and the facades of buildings so it is difficult to have an immediate perception of the viability of buildings and roads 4 proposed method for a quick 3 d representation of 2 d hydraulic results the workflow goal is to achieve a simple representation of two dimensional hydraulic simulations within a 3 d virtual reality environment able to support scientists technicians and agencies for emergency management in flood risk communications this section has been organized in such a way that a reader can understand all the key aspects related to the connections between river model set up 2 d flood simulations and 3 d visualizations of the results in particular the procedure is based on two main steps 1 3 d building reconstruction and modelling for realistic visualization purposes 2 visual quality improvement of virtual urban environment and final renderings the whole procedure including hydraulic calculations is therefore made of four steps as shown in fig 4 which also shows the software used for each step 4 1 3 d building reconstruction and modelling buildings are relevant objects in an urban area the first problem to be faced is the level of detail lod definition of the 3d model level of detail is an important concept in 3d city modelling since it defines the degree of abstraction of real world objects primarily designated to use an optimum amount of details according to the user s needs for the 3d objects the open standardized data model citygml defines five different standard levels of detail lod 0 4 which are differentiated mostly by the complexity of the geometries in this study the authors have chosen to represent 3d building models with lod1 which is defined as the well known blocks model comprising prismatic buildings with flat roof structures open geospatial consortium 2012 in other words the level of detail in lod1 consists in representing the buildings as solid elements with vertical walls obtained by extruding the footprint and modelled at the eaves of a building the lod1 model contains no semantics on constituting geometries and it is consistent with the assumption introduced in our flood simulation model specifically it should be recalled that the most accurate way to consider the influence of buildings in shallow water models is to consider them as solid wall internal boundaries see for example schubert and sanders 2012 that means they are treated as not submergible solids as a consequence no variations occur along the vertical development of the wall in the hydraulic modelling of the buildings furthermore buildings are acquired by extracting from their 2d footprints in the shape file format in combination with airborne lidar point cloud a representative height of the building is found by averaging the heights of the lidar points inside the footprint some esri arcgis 10 3 geoprocessing tools are used to generate a set of random sample points constrained by building footprints and referenced to their unique object identifiers thus a horizontal plane approximates the building s roof since the 3 d virtual city model is intended for understanding the flood hazard in an urban area the texture mapping technique is used to improve the realism of the building model façade for this purpose sketchup make 2014 was used because it allows one to capture google maps street view imagery inserting texture on the facades of buildings giving them a realistic look the photo texture is not part of the lod specification but the appearance may represent features not geometrically and semantically acquired building elements doors windows etc may not be geometrically present in a textured model however they are available for approximate measurements biljecki et al 2014 the main limitations of this kind of approach will be explained later 4 2 improvement of visual quality and final rendering the final step is to move from a very basic scene to a more realistic and attractive one to provide realism to the world environment computational grid and water surface the user has to set the materials of each object and the textures the camera settings and the lighting of the scene these operations can be performed using a 3d software that includes a render engine in our approach the buildings and the grids related to the ground level and the maximum water levels were imported into blender which is a free and open source 3 d creation suite and cross platform and is optimized for three dimensional graphics high quality rendering of 3 d models and data according to the purposes of the work the authors chose blender because it is possible to get a good enough mastery of this program without specialized training due to its intuitive graphical user interface gui moreover an active and wide ranging community support provides the amount of online material for developers and users such as tutorials videos articles add ons and scripts while blender has long been a popular open source software among animators and visual effects artists in recent years it has also become a tool for visualizing data in different fields of research andrei et al 2012 kent 2015 jorstad et al 2015 naiman 2016 palomar vazquez et al 2017 on the internet https www youtube com watch v wgpxzwlugdo there are videos showing urban inundation due to tsunami simulated with blender s fluid simulator based on the lattice boltzmann method lbm as the blender manual highlights for the lbm solver the large domains long duration high velocities and low viscosities make the simulation harder to compute it is important to recall here that our interest in the use of blender does not lie in the use of its physical simulator but only in the rendering of a 3d urban environment of flooded areas simulated by our hydraulic model in this context blender has two default render engines blender internal and cycles blender internal works by calculating which objects are visible to the camera and which are not by simulating the behaviour of light so it is a non photo real render engine cycles is an unbiased physically based path tracing engine it gives a more realistic rendering but clearly requires long renderings times compared to other unbiased engines cycles can utilize a graphics card in opencl mode ati graphics cards or cuda nvidia graphics cards so a significant speeding up of the calculation can be obtained blender manual kent 2015 we used cycles render engine the pre operative step is to import buildings terrain and water surface into blender in order to increase the level of the automation of the global procedure a script is implemented to import the grid data ground and simulated water levels in blender using the python application programming interface api the python script is made available as a part of this paper as supplementary material then materials and textures are created and assigned to the world environment computational grid and water surface mesh materials lights and backgrounds are well defined using a shading nodes network these nodes output shaders colours values and vectors for the world environment the high dynamic range image based lighting hdr ibl technique is adopted to illuminate the scene and to enhance reflections using the uv mapping technique a georeferenced high resolution 8001 8002 pixels orthophoto was mapped over the computational grid this process assigns 2d coordinates to mesh polygon s vertex providing an accurate texturing and more realism to the scene a specific water and mud material was created for the water mesh for illustrative purpose in fig 5 we present the material nodes scheme the node scheme consists of mixing between anisotropic bsdf and glass bsdf shaders to create glossy and rough reflection the layer weight node produces a fresnel effect for blending shaders by driving the fac input of the mix shader node a diffuse node is used to give the surface the characteristic colour of muddy water the acronym bsdf stands for bidirectional scattering distribution function and defines the probability that a specific light ray will be reflected at a given angle by setting the roughness factor it makes glass shader matter and diffuse surfaces more light absorbing in accordance with flooding water the wave texture node reproduces a water rippling effect on the static surface adding procedural bands with a sine profile 5 flood event in a 3 d virtual environment results in this section we provide some pictures showing parts of the town with and without water levels in order to give an idea of the level of detail that one may obtain using our procedure then we provide a discussion to support the idea that the outputs of the proposed workflow represent a useful integration to the classic maps contributing to satisfy the different needs that according to meyer et al 2012 different end user groups from strategic planning groups emergency management to the public have with regards to flood maps the images shown in figs 6 8 are three examples of a three dimensional representation of the information depicted in the flood map shown in fig 3 in the same figures classic flood hazard maps are also included to highlight the value that virtual views add to the communication of actual hazard conditions making risk perception easier in particular fig 6 refers to a situation occurring along the left bank upstream of the st lorenzo bridge in the spirito santo neighbourhood figs 7 and 8 refer to martiri street in these figures the water depths computed around the time corresponding to their maximum values are depicted indeed the information content of these images is not exactly identical to that contained in the hazard map because the hazard map shows the envelope of the maximum depths while the 3 d image represents the depths during the period of maximum depths and obviously the two things are not strictly equal in any case we preferred to represent the surface at a given instant instead of the envelope of the maximum depths to give a physically congruent and therefore more realistic image of the water surface the comparison with the image of the same area without flooding using the same point of view helps the human eye to realize the water depths in the different locations the images of the town without flooding have been taken from google earth in the 3 d view the white arrows help to localize the same objects in the figure in order to make the comparison easier more precisely figs 7 and 8 show the simulated inundation for martiri street which is separated from the channelled water by the right bank of the crati river the point of view shown in fig 7 helps to realize the level reached by the surface of the water and the human eye looking at the facades of the buildings easily perceives that the water reaches almost the soffit of the ground floors fig 8 helps to perceive at a glance the state of the river current when it produces the flooding of adjacent streets this type of image may represent a never before seen situation to people who have no experience of previous floods of the crati river which might increase the level of risk awareness in that area moreover the contrast between different corrugations used for the water textures greater for the channelled water and slightly smoother for urban flood areas helps the eye to understand intuitively that the flooding hazard originates from the river the rendering of the urban area obtained with this application is characterized by a similar level of detail in comparison to that reproduced by google earth for cosenza in some cases see fig 8c buildings facades are presented with more definition and with less distortion than in google earth 6 discussion of the proposed workflow on the basis of our experience gained in the 3 d visualization of a 2 d flood simulation we underline in this section the advantages and limitations that are associated with the use of the proposed workflow 6 1 strong points the main strong points of our procedures can be summarized in what follows 1 several parts of the procedure are based on free and open source software these software products provide full access to freely modifiable source programs according to one s own interests for example blender can be customised using python in order to fulfil the user needs 2 the workflow is characterized by a significant degree of automation in particular the fully automated steps concern a the use of python scripts for the communication between blender and the text files describing the grid representing the river topography and the simulated water surfaces and b the generation of buildings footprints in a gis environment starting from a lidar survey 3 the use of texture allows the user to improve the level of realism without increasing the complexity of the building modelling however this fact shows some drawbacks in the sense explained later 4 the procedure is relatively easy and simple to implement in all the steps related to the building modelling the connections between hydraulic computations and visual environments and the final rendering no particular knowledge in computer graphics is required 5 the urban model and the water surfaces do not require any particularly large resources of memory because the computer data storage resources needed are low this allows fast analyses and management of the virtual environment 6 2 weak points 1 building façades are characterized by planar polygons this modelling approach is satisfactory for orthogonal views for oblique views however the differences between the 3 d model and the real façade geometry reproduced in the photo textures are evident especially in the presence of balconies bows corbels and so on the absence of parallax points out the flatness of the surface 2 the use of uncalibrated photos i e without camera position information involves stretching and pinching problems in the textured façades the foreshortening and masking due to perspective projection implies that the façade is not rectangular consequently when texturing onto a rectangular facade the resulting image presents severe distortions this fact must be considered carefully when one tries to zoom the image to the level of the individual building in order to evaluate in detail the water level close to it in this case it might be useful to collect terrestrial lidar scans in order to have photorealistic meshes for the representation of 3d environments risse et al 2018 3 rendered views show different illuminations between the virtual model and the real environment as the former is acquired by photo textures which might present fictitious shadows induced by objects not reproduced in the 3 d model 4 the photo textures quality is related to camera and standpoint in narrow or jammed streets there is the risk of taking a photo of a façade with vehicles vegetation or pedestrians flattened onto it 5 the inability of the shallow water equations to simulate secondary corrugations of the water surface makes the visualized water surfaces smoother than they actually are for the same reason extremely localized phenomena with significant vertical components of velocities water jets or splashes cannot be visualized however to make the effect of moving water more realistic procedural textures were used in particular a more rippled texture was used for the water surface at the channelled stream while a texture more similar to stagnant water was used for the flooded areas therefore the choice of water texture must always be aimed at communicating flow velocity values and at least turbidity for example if the water is stagnant in a flooded area a smoother and more reflective surface should be used as done in fig 8c however in order to communicate the rapid inundation that might occur in the same area e g in case of levee overtopping another image that displays the flood wave front arrival using a much more corrugated texture might be produced to enforce the idea that the inundation could sneak up on the people the comparison of frames related to consecutive time steps would help people to better realize the sudden and fast flow arrival that might lead to a situation characterized for some time by stagnant water and thus an impassable street in this sense well constructed images can provide additional information compared to the classic hazard map 7 perspectives how the 3 d visualization outputs can integrate flood hazard maps to satisfy the needs of different end user groups in flood risk management prior to focusing on the potential value that our methodology could have for decision makers and laypeople it is important to clarify here that the virtual views showed in this paper cannot replace hazard maps since the latter report the envelope of numerical results while the 3 d views represent the situation at a single time step close to the time to peak obviously the two things do not necessarily coincide even for very small areas however this limit could be overcome by using various frames at particular time steps of simulation for a given area this could be a first step towards realizing movies bearing in mind the limitations underlined in the previous section the perspective of the added value of the 3 d outputs of the workflow proposed here can be summarized in what follows 7 1 getting of people s attention the analysis of figs 6 8 allows us to underline one of the several benefits associated to the use of 3 d visualization and in particular to provide an answer to the crucial question in flood risk communications which is of how to get the attention of people who have not been affected by the topic so far maidl and buchecker 2015 since there are no historic photos which can document the scenario that could occur in this area during a flooding event these 3 d visualizations clearly represent pictures which are able to explain the consequence of a flooding event to all generations especially those who have not experienced a flood in this context the visual risk communication based on the 3 d graphics is an effective substitute for personal experience in areas at risk seldom affected by hazards as considered necessary in the literature see for example lindell and perry 2003 however it should be observed that the more vivid the visual representations are then the more has responsibility to communicate correctly what can really happen in a given area 7 2 risk perception the benefits of the 3 d visual representation can be further appreciated in the two details shown in figs 9 and 10 for the point of view see fig 7 referred to martiri street in particular the above figures refer to the façades shown on the left and right ends respectively of fig 7 bearing in mind the drawbacks associated to the use of this procedure for the accurate representation of the water levels close to the buildings see section 6 it is clear that figs 9 10 compared to the flood hazard map shown in fig 3 might add further information about the interaction between the flood level and the public private goods and allow people to better imagine how severe the flood is in that area for example people living in those buildings can roughly realize whether the maximum flood level may reach their balconies or if it is simply limited to the ground floor moreover the perception of the viability of the entrance to the building and the streets and lanes surrounding the building is more immediate considering these benefits in terms of a better understanding of flood related issues the proposed visualization techniques could be nested in wider flood information systems in which the visualization module is the key element to make data more accessible and understandable to the public demir and krajewski 2013 it should be noted however that the two images refer to out of bank areas for which our results may induce the perception of an inundation characterized by almost stagnant water levels it would have been more problematic performing 3 d visualizations related to high velocity flood flows approaching and interacting with building facades 7 3 emergency planning and preparation the previous images show how cosenza could be transformed during a flood event highlighting that all roads near the river are impassable with water levels up to the ground floors of buildings therefore this kind of visual communication of flood risk contributes to the development and better communication of emergency planning also because it facilitates the identification of evacuation routes assembly points the number of people who would need to be evacuated and so on outputs like these can be integrated together with the shallow water model infrastructure assessment model and evacuation planning models into a single system leading to a fully automated scheme for emergency preparedness as shown by akbar et al 2013 who used model output saved in kml format viewable in google earth for decision making moreover figures like these help the public to realize the behaviour that they should have in case of flooding to move to the first floor or the roof for example or whether evacuation is necessary this aspect is essential because it has been shown that in several cases people seem to be aware of the risk they are subjected to but they do not behave according to those perceptions and concerns mysiak et al 2013 therefore the workflow discussed here could give important indications about how citizens should behave in case of a flood another important aspect of risk communication is to show the rapid and often the discontinuous behaviour of the evolution of the flood this effect obviously cannot be communicated with single frames but it is necessary to produce videos however thisgoes beyond the scope of this paper 7 4 supporting flood damage estimate the estimation of the consequences associated to the evolution of the flood is easier because the image is vivid and realistic in particular 3 d views like these can be particularly useful for the damage estimation liu et al 2017 moreover those figures might favour a validation approach of 2 d flood simulation results focusing on flood exposure and loss analyses at the single building scale zischg et al 2018 as is well known messner et al 2007 these analyses can be performed at different scales macro scale meso scale micro scale in the last of these for example damages are calculated for single properties while the meso scale analysis considers aggregated land units residential areas industrial areas and so on in this context the depth damage curves are used see for example garrote et al 2016 it is quite obvious that the pictures shown in figs 6 10 might provide further evaluation elements because they roughly show the maximum water levels in relation with both the business premises or warehouses mainly located at the ground floor and private apartments in the upper floors though these images can provide additional information for a case by case analysis a better estimation of flood damages can be achieved only using a 3 d digital representation of all aspects of a building in a single information model using the so called bim building information model approach as recently shown by amirebrahimi et al 2016 finally it is essential to underline here that the results presented in this paper have not been tested to assess how much the 3d representation improves flood risk communication to lay people compared to flood hazard maps this aspect will be addressed in a future work 8 concluding remarks this work has focused on the proposal of support tools for a more intuitive interpretation of classic hazard maps in this sense the work is essentially based on the concept of hazard risk and therefore can be framed in the context of risk management however in section 7 further developments were outlined which could also help to build flood prediction tools useful in the context of disaster management the images in this paper highlight the significant level of realism that can be achieved graphic rendering of the town model achieved by this approach has shown the same quality which can be currently obtained with google earth for cosenza it should be noted that the effectiveness of the images shown in this study for hazard communication purposes has not been quantitatively tested yet this activity though already planned by the authors does not fall within the scope of this paper and therefore will be addressed in a future work the 3 d visualization outputs obtained using the proposed workflow can support classical maps in order to satisfy the needs of different end user groups in flood risk management the pictures shown in this paper cannot by themselves replace the classic hazard risk maps however considering that several frames can be produced using the method proposed in this work it is clear that the whole flood behaviour in a given area can be represented by a sequence of consecutive images depicting in particular the water levels evolution and their persistence over time for hazard communication purposes the use of this sequence of frames reveals more information than classic 2 d maps representing the water levels and it might be proposed even as a useful support for the so called flood propagation maps for particular time steps suggested by excimap 2007 the main strong points of the proposed workflow are related to the use of free and open source software and the presence of fully automatic steps in the procedure moreover no particular knowledge ofcomputer graphics or significant resources of computer memory are requested the suitability of the procedure for representing particulars of the water surfaces at the level of the individual buildings in detail depends on the resolution of the textures used for buildings the size of the computation grid cells and interpolation of the numerical results calculated for each cell a further aspect that should be considered is the inability of shallow water equations to simulate the secondary corrugations of the free surface which are particularly developed in torrential currents thus the water surfaces that are produced in the 3 d maps shown here appear smoother than they actually are this could generate reduced perception of the dynamic effects of the current this requires further work that has not been addressed in this article finally this paper has attempted to highlight the importance of getting people s attention and supporting flood damage estimates risk perception emergency planning and preparation acknowledgements this paper is based on research carried out in partial fulfilment of the ph d requirements at the university of calabria for the fourth author under the scientific supervision of the first and the second authors the numerical simulation of the flood was based on the data and methods developed in the project por calabria 2000 2006 asse 1 misura 1 4 azione 1 4 c studio e sperimentazione di metodologie e tecniche per la mitigazione del rischio idrogeologico lotto 8 metodologie di individuazione delle aree soggette a rischio idraulico di esondazione for which the first author was the principal investigator appendix a supplementary data the following is the supplementary data to this article data profile data profile appendix a supplementary data supplementary data to this article can be found online at https doi org 10 1016 j envsoft 2018 11 005 
26309,this article presents qswatmod a qgis based graphical user interface for application and evaluation of swat modflow models qswatmod includes i pre processing modules to prepare input data for model execution ii configuration modules for swat modflow options and iii post processing modules to view and interpret model results qswatmod written in python creates linkage files between swat and modflow models runs a simulation and displays results within the open source quantum geographic information system qgis environment qswatmod is equipped with functionalities that assist in storing and retrieving user and default configuration settings and parameter values performing the linkage and simulation processes and uses various geo processing functionalities e g selection intersection union of qgis the use of qswatmod is demonstrated through an application to the 471 km2 middle bosque river watershed in central texas as the number of swat modflow users grows worldwide qswatmod can be a valuable tool to assist in creating and managing swat modflow projects keywords swat modflow graphical user interface qgis qswatmod software availability name of software qswatmod developers seonggyu park and anders nielsen contact address department of civil and environmental engineering colorado state university fort collins co 80523 united states email seonggyu park colostate edu year first available 2018 cost free programming language python software required qgis availability software including swat modflow executable and datasets for the middle bosque river watershed and documentation can be downloaded from https swat tamu edu software swat modflow 1 introduction the shortage of freshwater supply due to population growth land use and climate change has been recognized as one of the most critical global issues in water resources engineering many techniques and methods have been developed to quantify water resources at the regional scale including large scale watershed models swat arnold et al 1998 and modflow harbaugh 2005 niswonger et al 2011 are two of the most widely used hydrologic models for this purpose wible 2014 however due to the deficiencies in swat and modflow for simulating groundwater hydrology and land surface hydrology respectively several studies have linked these two models sophocleous and perkins 2000 kim et al 2008 guzman et al 2015 bailey et al 2016 these swat modflow models however and coupled models in general often are not used extensively due to the level of complexity of preparing input data configuring model options executing models and interpreting results barthel and banzhaf 2016 nielsen et al 2017 in particular preparing input data for coupled hydrologic models often is a slow tedious and error prone process to save time and avoid errors bailey et al 2017 developed swatmod prep a stand alone python based graphical user interface gui that facilitates preparing linkage files for a swat modflow model simulation the gui however does not provide geographical context with maps does not allow linkage between swat and an existing modflow model and does not display results or compare model results with observation data this article presents qswatmod a qgis based gui plugin that links a swat model with a modflow model within a geographical information system gis setting thus facilitating model preparation and model results viewing for the broad swat and modflow users the linkage is based on the swat modflow modeling code of bailey et al 2016 in which modflow nwt niswonger et al 2011 is imbedded within the swat 2012 modeling code revision 591 to simulate groundwater flow and groundwater surface water interactions the availability of qswatmod allows coupled surface water groundwater models to become more accessible to a broad hydrologic modeling community particularly since the tool is based on the free and open source qgis platform the features and capabilities of qswatmod are demonstrated through an application to the middle bosque river watershed 471 km2 in the texas gulf region of central texas fig 1 which has major groundwater discharge and stream seepage areas cannata 1988 subsurface geology consists of mainly sedimentary limestone rocks cannata 1988 pearson 2013 with two observation wells located near the river the climate of the study area is characterized by semi arid conditions with long hot summers and brief mild winters the annual precipitation between 1985 and 2012 ranges from 340 to 950 mm year details of the swat and modflow models are shown in table 1 results are compared with observed streamflow and groundwater head to demonstrate the viewing features of qswatmod 2 development and application of qswatmod 2 1 qswatmod overview and development qswatmod is cross platform compatible and implemented in the open source qgis platform documentation and a qswatmod installer are available through http swat tamu edu software swat modflow qgis must be installed on the system prior to the installation of qswatmod we recommend installing the latest long term release ltr version of qgis through osgeo4w a binary distribution of open source geospatial software https qgis org qswatmod has dependencies to third party python packages including flopy3 bakker et al 2016 pandas mckinney 2010 opencv bradski 2000 and pyshp these packages will be installed automatically in the designated python environment after qswatmod is activated in qgis qswatmod has the option of creating a new project or opening a saved existing project from a previous session a project consists of a qgis file qgs which stores the information of qgis status loaded layers user settings and a project directory which holds all project inputs and outputs default user inputs and simulation settings are stored in a designated sqlite hipp et al 2015 project database qswatmod includes plotting functions based on matplotlib hunter 2007 the tabs of qswatmod fig 2 are pre processing simulation and post processing all data processing is based on the pre processing configuration and post processing modules see fig s1 in supplementary material 2 2 pre processing tab the main role of the pre processing tab is to guide users to specify paths to the folders containing input files prepare modflow data and perform geo processing routines to link the two models shapefiles for the river network subbasins and hrus from an existing swat model are required fig 2b 2 2 1 swat inputs qswatmod creates copies of all swat model input files and associated gis files rasters vectors in the project folder once users specify the path to an existing swat model the copied hru sub basin and river network shapefiles are then imported to the qgis canvas these shapefiles are available with the original swat model created using either arcswat olivera et al 2006 or qswat dile et al 2016 2 2 2 modflow options qswatmod provides the user with three options for modflow fig 2 and s2 1 modflow model files and grid shapefile are available 2 modflow model files are available but there is no grid shapefile and 3 modflow model has not yet been constructed the first option guides users to specify the path to an existing modflow model and modflow grid shapefile with the latter requiring the same projection as the swat shapefiles for the second option the user specifies the coordinate of the north west corner of the modflow boundary or the modflow grid area is based on the extent of the swat subbasin shapefile with both reading cell information width depth top elevation from the modflow discretization file dis through the third option a simple modflow model powered by the flopy3 bakker et al 2016 package can be developed with user inputs of cell dimensions river bed properties and aquifer properties hydraulic conductivity specific yield specific storage fig s3 locations of observation wells can be established by an observation well shapefile or through the user selecting cells on the qgis canvas fig s4 2 2 3 river connections linking the cells in the modflow river package with the swat river network is required to simulate groundwater surface water interactions qswatmod provides three options 1 use only modflow river package 2 use only swat river network and 3 use both modflow and swat fig s5 for the first option qswatmod extracts river cell values river stage river bed conductance river bottom elevation from the modflow river package file for the second option the modflow grid cells are intersected with the swat river network shapefile and then river cell parameters for each river cell are calculated based on information provided by the swat river network dem stream length and width and user inputs thickness and hydraulic conductivity of river bed material for the third option the existing modflow river cells are compared to the swat river network fig s5e with the user deciding which information to keep 2 2 4 linking process through the linking process fig 2b the hrus are disaggregated to create dhrus which are then intersected with modflow grid cells modflow river cells are identified using the swat stream network or other river connection options and the set of river cells within each subbasin are identified for mapping groundwater surface water exchange rates from river cells to swat subbasin channels these generated shapefiles are used to create the required swat modflow text linkage files for the middle bosque model the time required by qswatmod to perform the linking operations on a standard desktop computer is several minutes see table s1 for details a total of 12 366 dhrus were created and 1468 river cells were identified to link with the swat river network 2 3 simulation tab in the simulation tab fig 3 starting date ending date warm up period and time step of the simulation are provided based on information in the swat input file file cio and used for synchronizing the modflow model time and writing simulation results in the configuration settings users can activate swat modflow simulation options optional model output and change the frequency of swat calls to modflow finally run simulation button is selected 2 4 post processing tab the post processing tab and model results are shown in fig 4 the tab facilitates mapping results within qgis and displaying results dynamically during the simulation run qswatmod has three types of post processing modules plotting mapping and exporting results the plot function shows observed and simulated hydrographs of streamflow and groundwater head with objective function summary values nash sutcliffe efficiency nse percent bias pbias and r squared r2 displayed on the figures fig 4a and b the mapping function is designed to show maps of recharge fig 4c and groundwater head fig 4d on the qgis canvas via shapefiles figures showing spatial patterns of surface water and groundwater interactions fig 4e can be converted to a single video clip by selecting the save to video icon see video s1 in supplementary material the water balance chart is created using values of precipitation surface runoff lateral flow groundwater flow to streams deep percolation to groundwater soil water seepage from streams to the aquifer and groundwater volume from swat s output std file except for spatially distributed groundwater head and recharge values users can export all results to text formatted files see figure s6 supplementary video related to this article can be found at https doi org 10 1016 j envsoft 2018 10 017 the following is the supplementary data related to this article output3 3 summary and conclusion qswatmod a qgis based graphical user interface for swat modflow models was developed to provide an easy to use workflow for users preparing input data configuring simulation settings and visualizing and interpreting results qswatmod includes options for using an existing modflow or creating a new one with a variety of options for linking modflow river cells with swat subbasins for groundwater surface water interactions qswatmod was applied to the middle bosque river watershed in texas to demonstrate the linkage between existing swat and modflow qswatmod can be a valuable tool in assisting users to create and manage swat modflow projects allowing coupled surface water groundwater models to become more accessible to a broader hydrologic modeling community acknowledgements this work was supported by grant from the agriculture and food research initiative of the usda national institute of food and agriculture nifa grant number 2012 67003 19904 and grant number 2017 67019 26332 appendix a supplementary data the following are the supplementary data to this article supplementary material supplementary material data profile data profile appendix a supplementary data supplementary data to this article can be found online at https doi org 10 1016 j envsoft 2018 10 017 
26309,this article presents qswatmod a qgis based graphical user interface for application and evaluation of swat modflow models qswatmod includes i pre processing modules to prepare input data for model execution ii configuration modules for swat modflow options and iii post processing modules to view and interpret model results qswatmod written in python creates linkage files between swat and modflow models runs a simulation and displays results within the open source quantum geographic information system qgis environment qswatmod is equipped with functionalities that assist in storing and retrieving user and default configuration settings and parameter values performing the linkage and simulation processes and uses various geo processing functionalities e g selection intersection union of qgis the use of qswatmod is demonstrated through an application to the 471 km2 middle bosque river watershed in central texas as the number of swat modflow users grows worldwide qswatmod can be a valuable tool to assist in creating and managing swat modflow projects keywords swat modflow graphical user interface qgis qswatmod software availability name of software qswatmod developers seonggyu park and anders nielsen contact address department of civil and environmental engineering colorado state university fort collins co 80523 united states email seonggyu park colostate edu year first available 2018 cost free programming language python software required qgis availability software including swat modflow executable and datasets for the middle bosque river watershed and documentation can be downloaded from https swat tamu edu software swat modflow 1 introduction the shortage of freshwater supply due to population growth land use and climate change has been recognized as one of the most critical global issues in water resources engineering many techniques and methods have been developed to quantify water resources at the regional scale including large scale watershed models swat arnold et al 1998 and modflow harbaugh 2005 niswonger et al 2011 are two of the most widely used hydrologic models for this purpose wible 2014 however due to the deficiencies in swat and modflow for simulating groundwater hydrology and land surface hydrology respectively several studies have linked these two models sophocleous and perkins 2000 kim et al 2008 guzman et al 2015 bailey et al 2016 these swat modflow models however and coupled models in general often are not used extensively due to the level of complexity of preparing input data configuring model options executing models and interpreting results barthel and banzhaf 2016 nielsen et al 2017 in particular preparing input data for coupled hydrologic models often is a slow tedious and error prone process to save time and avoid errors bailey et al 2017 developed swatmod prep a stand alone python based graphical user interface gui that facilitates preparing linkage files for a swat modflow model simulation the gui however does not provide geographical context with maps does not allow linkage between swat and an existing modflow model and does not display results or compare model results with observation data this article presents qswatmod a qgis based gui plugin that links a swat model with a modflow model within a geographical information system gis setting thus facilitating model preparation and model results viewing for the broad swat and modflow users the linkage is based on the swat modflow modeling code of bailey et al 2016 in which modflow nwt niswonger et al 2011 is imbedded within the swat 2012 modeling code revision 591 to simulate groundwater flow and groundwater surface water interactions the availability of qswatmod allows coupled surface water groundwater models to become more accessible to a broad hydrologic modeling community particularly since the tool is based on the free and open source qgis platform the features and capabilities of qswatmod are demonstrated through an application to the middle bosque river watershed 471 km2 in the texas gulf region of central texas fig 1 which has major groundwater discharge and stream seepage areas cannata 1988 subsurface geology consists of mainly sedimentary limestone rocks cannata 1988 pearson 2013 with two observation wells located near the river the climate of the study area is characterized by semi arid conditions with long hot summers and brief mild winters the annual precipitation between 1985 and 2012 ranges from 340 to 950 mm year details of the swat and modflow models are shown in table 1 results are compared with observed streamflow and groundwater head to demonstrate the viewing features of qswatmod 2 development and application of qswatmod 2 1 qswatmod overview and development qswatmod is cross platform compatible and implemented in the open source qgis platform documentation and a qswatmod installer are available through http swat tamu edu software swat modflow qgis must be installed on the system prior to the installation of qswatmod we recommend installing the latest long term release ltr version of qgis through osgeo4w a binary distribution of open source geospatial software https qgis org qswatmod has dependencies to third party python packages including flopy3 bakker et al 2016 pandas mckinney 2010 opencv bradski 2000 and pyshp these packages will be installed automatically in the designated python environment after qswatmod is activated in qgis qswatmod has the option of creating a new project or opening a saved existing project from a previous session a project consists of a qgis file qgs which stores the information of qgis status loaded layers user settings and a project directory which holds all project inputs and outputs default user inputs and simulation settings are stored in a designated sqlite hipp et al 2015 project database qswatmod includes plotting functions based on matplotlib hunter 2007 the tabs of qswatmod fig 2 are pre processing simulation and post processing all data processing is based on the pre processing configuration and post processing modules see fig s1 in supplementary material 2 2 pre processing tab the main role of the pre processing tab is to guide users to specify paths to the folders containing input files prepare modflow data and perform geo processing routines to link the two models shapefiles for the river network subbasins and hrus from an existing swat model are required fig 2b 2 2 1 swat inputs qswatmod creates copies of all swat model input files and associated gis files rasters vectors in the project folder once users specify the path to an existing swat model the copied hru sub basin and river network shapefiles are then imported to the qgis canvas these shapefiles are available with the original swat model created using either arcswat olivera et al 2006 or qswat dile et al 2016 2 2 2 modflow options qswatmod provides the user with three options for modflow fig 2 and s2 1 modflow model files and grid shapefile are available 2 modflow model files are available but there is no grid shapefile and 3 modflow model has not yet been constructed the first option guides users to specify the path to an existing modflow model and modflow grid shapefile with the latter requiring the same projection as the swat shapefiles for the second option the user specifies the coordinate of the north west corner of the modflow boundary or the modflow grid area is based on the extent of the swat subbasin shapefile with both reading cell information width depth top elevation from the modflow discretization file dis through the third option a simple modflow model powered by the flopy3 bakker et al 2016 package can be developed with user inputs of cell dimensions river bed properties and aquifer properties hydraulic conductivity specific yield specific storage fig s3 locations of observation wells can be established by an observation well shapefile or through the user selecting cells on the qgis canvas fig s4 2 2 3 river connections linking the cells in the modflow river package with the swat river network is required to simulate groundwater surface water interactions qswatmod provides three options 1 use only modflow river package 2 use only swat river network and 3 use both modflow and swat fig s5 for the first option qswatmod extracts river cell values river stage river bed conductance river bottom elevation from the modflow river package file for the second option the modflow grid cells are intersected with the swat river network shapefile and then river cell parameters for each river cell are calculated based on information provided by the swat river network dem stream length and width and user inputs thickness and hydraulic conductivity of river bed material for the third option the existing modflow river cells are compared to the swat river network fig s5e with the user deciding which information to keep 2 2 4 linking process through the linking process fig 2b the hrus are disaggregated to create dhrus which are then intersected with modflow grid cells modflow river cells are identified using the swat stream network or other river connection options and the set of river cells within each subbasin are identified for mapping groundwater surface water exchange rates from river cells to swat subbasin channels these generated shapefiles are used to create the required swat modflow text linkage files for the middle bosque model the time required by qswatmod to perform the linking operations on a standard desktop computer is several minutes see table s1 for details a total of 12 366 dhrus were created and 1468 river cells were identified to link with the swat river network 2 3 simulation tab in the simulation tab fig 3 starting date ending date warm up period and time step of the simulation are provided based on information in the swat input file file cio and used for synchronizing the modflow model time and writing simulation results in the configuration settings users can activate swat modflow simulation options optional model output and change the frequency of swat calls to modflow finally run simulation button is selected 2 4 post processing tab the post processing tab and model results are shown in fig 4 the tab facilitates mapping results within qgis and displaying results dynamically during the simulation run qswatmod has three types of post processing modules plotting mapping and exporting results the plot function shows observed and simulated hydrographs of streamflow and groundwater head with objective function summary values nash sutcliffe efficiency nse percent bias pbias and r squared r2 displayed on the figures fig 4a and b the mapping function is designed to show maps of recharge fig 4c and groundwater head fig 4d on the qgis canvas via shapefiles figures showing spatial patterns of surface water and groundwater interactions fig 4e can be converted to a single video clip by selecting the save to video icon see video s1 in supplementary material the water balance chart is created using values of precipitation surface runoff lateral flow groundwater flow to streams deep percolation to groundwater soil water seepage from streams to the aquifer and groundwater volume from swat s output std file except for spatially distributed groundwater head and recharge values users can export all results to text formatted files see figure s6 supplementary video related to this article can be found at https doi org 10 1016 j envsoft 2018 10 017 the following is the supplementary data related to this article output3 3 summary and conclusion qswatmod a qgis based graphical user interface for swat modflow models was developed to provide an easy to use workflow for users preparing input data configuring simulation settings and visualizing and interpreting results qswatmod includes options for using an existing modflow or creating a new one with a variety of options for linking modflow river cells with swat subbasins for groundwater surface water interactions qswatmod was applied to the middle bosque river watershed in texas to demonstrate the linkage between existing swat and modflow qswatmod can be a valuable tool in assisting users to create and manage swat modflow projects allowing coupled surface water groundwater models to become more accessible to a broader hydrologic modeling community acknowledgements this work was supported by grant from the agriculture and food research initiative of the usda national institute of food and agriculture nifa grant number 2012 67003 19904 and grant number 2017 67019 26332 appendix a supplementary data the following are the supplementary data to this article supplementary material supplementary material data profile data profile appendix a supplementary data supplementary data to this article can be found online at https doi org 10 1016 j envsoft 2018 10 017 
