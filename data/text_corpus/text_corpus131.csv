index,text
655,reservoir operation optimization aims to determine release and transfer decisions that maximise water management objectives such as ensuring a reliable water supply hydropower production mitigation of downstream floods etc an extensive and growing body of scientific literature exists on advancing and applying mathematical optimization methods to reservoir operation problems in this paper we review such literature according to a novel classification system of optimization approaches which focuses on the characteristics of the actual operation problem i e what needs to be optimized or in mathematical terms the argument of the optimization problems rather than the mathematical properties of the optimization algorithm this enables us to discuss the advantages limitations and the scope of application of the different optimisation methods and to provide practical guidelines for matching the properties of a system and operation problem with a suitable optimization method alongside this paper we provide code to implement many of the methods we review for an illustrative reservoir system graphical abstract image graphical abstract keywords reservoir operation water resources multi objective optimization 1 introduction a recent estimate places the total global storage capacity of reservoirs and dams between 7000 8 000 km3 lehner et al 2011 while dam construction has slowed in countries with a human development index hdi above 0 7 the un development programme s threshold for a high level of development jahan 2015 it is likely to continue at a considerable rate in countries with an hdi below 0 7 the latter countries contain around half of the human population and have the highest projected growth rates with a total population increase of 18 27 by 2030 un 2015 as shown in fig 1 currently the per capita water storage of low hdi 0 7 countries is around one third of high hdi 0 7 countries besides building new dams to fulfil irrigation and water supply needs hydropower dams are also expected to triple worldwide from 2000 to nearly 6000 by 2030 under growing electricity demand ansar et al 2014 zarfl et al 2014 despite their importance and the level of planning and resources required to construct a dam it is common for reservoirs not to achieve the goals envisaged in their design in terms of both economic returns and mitigation of negative impacts wcd 2000 labadie 2004 dams are most commonly criticised for causing social and environmental damage such as the displacement of communities or the obstruction of sediments graf 1999 ouyang et al 2010 tockner et al 2011 liermann et al 2012 scudder 2012 which may not be sufficiently understood beforehand therefore damages are underestimated and poorly mitigated by actions recommended in social and environmental impact assessments nakayama 1998 fearnside 2016 nonetheless countries with unsatisfactory water resource infrastructures continue dam construction in a drive to increase quality of life muller et al 2015 in countries with adequate water security negative impacts have occasionally resulted in the decommissioning of dams allan 2003 bellmore et al 2016 ho et al 2017 and in substantial legal regulation for water resources management regulations include changing investment preferences towards efficiency gains that can be achieved through for example water transfer or network projects brown et al 2015 the coordinated operation of these linked systems allows greater scope for increased efficiency than could be achieved by uncoordinated operation of individual sources with efficiency gains that could be applied towards environmental impact mitigation poff and schmidt 2016 optimization of reservoir operations is therefore more relevant than ever both as a complement to the efficient design of new dams and for the revision of operations in existing ones here we would define reservoir operation as the determination of how much water to abstract from sources e g rivers to transfer between reservoirs and to release from reservoirs to points of consumption e g for irrigation domestic or industrial consumption or use e g hydropower production reservoir operation is a challenging decision making problem because it requires finding a balance between decisions conflicting in time for example whether to accept a cost in the short term in order to avoid a larger but more uncertain cost in the mid term and across uses for example between irrigation hydropower and municipal supply research has demonstrated that the use of mathematical models to simulate and optimize reservoir operation can significantly enhance the performance of existing reservoirs as well as enable efficient design of new dams or their repurposing expansion traditionally dam design has been based on rippl s method an approach that aims to find the smallest reservoir capacity that can ensure releasing the target water demand through a worst case drought rippl 1883 hazen 1914 loucks et al 2005 drawbacks of this approach include the difficulty in applying it to systems that go beyond the simple single reservoir and single purpose case for example coordinated reservoir networks or multiple purpose reservoirs maass et al 1962 more flexible approaches that can accommodate these drawbacks have been proposed for many years vogel and stedinger 1987 1988 douglas et al 2002 celeste 2016 and are now widely adopted in scientific research loucks et al 2005 these design methods simulate the reservoir system against long time series of reservoir inflows and iterate the simulation until finding the minimum reservoir capacity that meets the target objectives under a variety of hydrological conditions as such they require an explicit formulation and preferably nested optimization of the reservoir operating policy that will be used to make release decisions in the various simulated circumstances reservoir operation optimization is a mature and yet very active research area see fig 2 and a number of reviews of the available optimization methods have been carried out over time yeh 1985 labadie 2004 castelletti et al 2008 rani and moreira 2009 ahmad et al 2014 while these reviews may differ in the emphasis given to a particular group of methods or another they all share the same fundamental approach to classifying and presenting methods which is based on the mathematical properties of the optimization algorithms however we believe that an alternative approach to classifying methods is possible and useful particularly for new and non specialised users by focusing on the argument of the optimization problem in order to better understand this point we note that there are four elements to an optimization problem 1 the objective s i e the variable s to be minimised maximised such as the average water supply or hydropower production level of flood protection etc 2 the argument of the optimization problem i e the decision variable s whose optimal choice would deliver the minimum maximum objective value s 3 the constraints i e the set of equations that link the decision variables to the objectives and 4 the optimization method i e the algorithm used to determine the values of the decision variables that optimize the objectives while respecting all the constraints we have presented these elements in the order in which they should be defined in practice indeed when formulating an optimization problem the optimization method should be the last element to be chosen and yet previous reviews in this field focus on this element as the key to present and compare literature contributions we propose instead that the highest level of classification should be the argument which determines the output of the optimization task which type of variable is being optimized i e a sequence of release transfer decisions or an operating policy as further explained in the following sections this changes the focus to the practical aspects that make an optimization approach more or less suitable for the problem at hand what type of solution they deliver and when they are useful rather than the mathematical properties of the solution algorithm how the methods achieve those solutions this paper hence offers a new review of the scientific literature on reservoir operation optimization where optimization methods and applications are presented according to the type of argument to the optimization problem instead of the underlying mathematics in use indeed we will show that the same type of algorithm for instance a genetic algorithm can be used to solve reservoir optimization problems with very different arguments e g deriving the optimal sequence of short term decisions vs determining the long term optimal operating policy while an optimization problem with the same type of argument and hence solution can be solved by using very different algorithms e g a genetic algorithm vs a nonlinear programming one we complement the review with a terminology disambiguation table to help the reader navigate both our review and the wider literature where terms are sometimes used with different meanings by different authors by focusing less on the mathematical properties of solution algorithms in favour of an argument based classification of the optimization methods we are also able to draw a comparison between them discuss important practical factors such as the different assumptions required by each method and ultimately provide guidelines towards selecting a suitable method for the decision making problem at hand we hope our paper will make the reservoir operation optimization literature accessible to a wider audience besides the academic community already active in water systems analysis and optimization 2 review and classification of reservoir operation optimization by argument in this section we present our classification system by argument and review optimization methods and applications accordingly beforehand however in the following subsection we briefly define the two other elements of the optimization problem formulation described in the introduction the objectives and the constraints 2 1 objectives and constraints in the optimization literature an objective is a scalar variable that summarises the system performance over a temporal period the optimization method aims at either minimizing or maximizing the objective throughout this review we will assume that objectives must be minimized i e they represent either costs or benefits changed in sign objectives that are commonly used to evaluate the performance of reservoir systems capture the system s reliability resilience or vulnerability hashimoto et al 1982 loucks et al 2005 kasprzyk et al 2013 reliability objectives measure the frequency of occurrence of a specified failure event for example failure to supply adequate amounts of water to a demand node resilience objectives measure the recovery time from a failure event and vulnerability objectives measure the severity of the failure s consequences the choice and definition of objectives can vary greatly depending on the specific reservoir system under study the availability of data etc and as a general rule should reflect as much as possible the reservoir operator s targets and preferences however two factors in the formulation of the objective impact the applicability of operation optimization methods the first is the presence of non linear components in the objective s mathematical definition which may prevent the application of some methods that assume linearity as will be summarised in section 3 4 the second is the so called time separability i e the fact that the objective is defined by temporal aggregation for instance averaging of step costs or step benefits that only depend on system variables at one time step barro and king 1982 an example of a time non separable objective is the profit from selling water in a water market where the price at each time step is dependent on water sales at previous time steps another critical aspect that may strongly influence the applicability of reservoir optimization methods is the number of objectives that the operation aims to minimize in fact reservoirs are typically expected to serve multiple purposes for example nearly half of all large dams included in the world register of dams icold 2003 have multiple uses most commonly irrigation hydropower water supply and flood control a possible approach to handle multiple objectives is to make them commensurable by appointing them an economic value so that they can be summed up into a single objective that expresses the total net benefit or cost over the simulation period maass et al 1962 however this technique may not sufficiently compensate for non economic indicators and does not express the available trade offs between objectives to the decision maker as described in detail in kasprzyk et al 2013 an increasingly preferable alternative is to solve a multi objective optimization problem which returns a set of pareto optimal or pareto efficient solutions instead of one optimal solution pareto optimal solutions are characterised by the property that an improvement in one objective is unattainable without a deterioration in at least one other objective cohon and marks 1975 the choice of the best solution within the set of pareto optimal ones is not considered as part of the optimization process because it involves a subjective evaluation of what acceptable trade offs between the objectives should be however in order to assist the decision maker in such evaluation and choice the set of pareto optimal solutions can be displayed in the objective space this representation is called the pareto front to reveal and quantify those trade offs the benefit of visualizing the pareto front lies in enabling the decision maker to view the impact of their decisions in the context of all objectives rather than a single prior weighted objective in selecting one solution within the pareto front the decision maker implicitly selects a posterior set of weights for the sake of simplicity in the next section we will first introduce optimization methods with reference to the single objective case and in section 3 2 we will discuss their ability in handling multi objective optimization problems in particular when the number of objectives increases above 3 the so called many objective problems fleming et al 2005 the constraints of an optimization problem are all the equations that are needed to compute the objective s from the decision variables in a reservoir operation optimization problem this link is established via a simulation model of the reservoir system which is run over the simulation period for given initial condition and trajectory of forcing inputs initial conditions such as reservoir storages at the beginning of the simulation period are typically selected by a sensible guess and the impact of their choice mitigated by calculating system performances only after a warmup period see ashbolt et al 2016 as an example forcing inputs such as trajectories of inflows or water demands may be represented by historical data synthetic data generated from a statistical model or a statistical model in itself as we later discuss in section 3 1 whether a statistical model or actual data synthetic or historical is used will impact the choice of the solution algorithm how to best create the statistical model whether to be used directly in the optimisation or to generate synthetic forcing data has been an active field of research throughout the history of reservoir operation fiering and bund 1971 hirsch 1979 salas et al 2005 rajagopalan et al 2010 herman et al 2016 the simulation model is essentially based on the law of conservation of mass in the form of a water balance equation over time for each reservoir and a water balance across space for each link between reservoirs and abstractions consumption nodes ford and fulkerson 1962 a detailed description of typical reservoir system simulation equations can be found in rani and moreira 2009 matrosov et al 2011 mo et al 2013 and seifollahi aghmiuni et al 2016 and examples of reservoir simulation software in coelho and andrade campos 2014 and wurbs 2005 this mathematical description is typically complemented with several hard and soft constraints on individual variables hard constraints are those constraints that cannot be violated under any circumstance and typically represent physical limits such as non negativity of storage and flow variables less commonly used hard constraints include equations to impose conservation of energy and wave travel times soft constraints instead are those constraints that should not be violated but that are not physically impossible to break mayne et al 2000 for example a minimum environmental flow requirement downstream of a reservoir soft constraints may be included in the optimization problem either as additional objectives or as hard constraints treating soft constraints as objectives allows exploring the trade off between breaking the soft constraints and preventing a greater cost elsewhere the downside is the increase in the number of objectives which may increase the difficulty of solving the multi objective optimization problem depending on the case study application a balance can be found between the ease of optimization which would suggest using hard constraints and completeness of information delivered to decision makers which would suggest using objectives some interesting examples of swapping constraints and objectives include sigvaldson 1976 which uses channel capacity as an objective rather than a constraint as most commonly treated and koutsoyiannis and economou 2003 which uses deficit as a constraint rather than an objective 2 2 classification of methods by argument this section presents our classification system of reservoir operation optimization methods which focuses on a higher level understanding of the decision variables to which they are applied the argument of the optimization problem for each method we will review applications in the literature and provide a short description of the most commonly used optimization algorithms with reference for further reading on more mathematical details the classification system is summarised in fig 3 while further details about the adopted terminology are given in fig 4 in appendix a we also provide the detailed equations of the revised methods applied to an illustrative case study the matlab code implementing these methods can be found at https github com barneydobson reservoir operation optimization examples in our classification we distinguish three main types of argument 1 release sequences rs optimization methods optimization aims at finding the sequence of release decisions over a prescribed time period fig 5 a that minimises operational objectives under a given scenario of forcing inputs for example a given time series of reservoir inflows and water demand rs optimization can be used to directly inform operational decisions if the underlying assumption that forcing inputs can be deterministically predicted is valid the larger the deviations from the assumed deterministic scenario the less effective the optimal rs will actually be when applied in reality since forcing inputs are typically very uncertain and the mismatch between predictions and actual trajectories very large optimal rs are rarely implemented in practice more commonly rs optimization is an intermediate step within a more complex optimization process of the other two types below discussed in section 2 2 3 another possible use of rs optimization is in what if studies for example to determine a reference baseline for comparison with other optimization solutions or to assess the upper bound of system performance the maximum that could be achieved with the existing infrastructure under the ideal assumption of perfect foresight of all future inflows for an example see castelletti et al 2012 2 operating policy op optimization methods optimization aims at finding the optimal operating policy i e a function that can be used to determine the release conditional on the state of the reservoir system in the current time step fig 5b in other words optimization returns a strategy the op for making release decisions rather than the release decisions themselves at each time step the optimal op should return the decisions that will perform best over the expected trajectories of forcing inputs that may occur from that time step onwards the assumption here is not that the future forcing inputs trajectory is deterministically known as with rs optimization but only that the trajectories historical or synthetic time series or distributions assumed in the op optimization are representative of actual conditions the state variables that ops depend on typically include reservoir storage and time of year they may also include other variables e g current inflow oliveira and loucks 1997 depending on the characteristics of the study site the reservoir system equations and the chosen optimization method 3 real time optimization rto methods rto uses an optimized rs over a rolling time horizon for which real time forecasts of forcing inputs are available the first release in the rs is implemented and then at the next time step the optimization process is performed again with updated forecasts as displayed in fig 5c rto is ideal if real time computing resources and accurate input forecasts are available for each of the three above cases our classification system fig 3 distinguishes optimization methods based on their key working principles i e essential mathematical properties of the optimization problem formulation for each method the optimization problem can be solved using different algorithms as shown in the last layer of our classification system while there are certainly differences between algorithms under the same method they do not significantly affect the broader type of reservoir system to which the overarching method is applicable with the exception of algorithms for mathematical programming as further discussed in section 2 2 1 therefore in the following sections we will focus on the description of the different methods and only provide references for further details on the specific algorithms these descriptions form the basis for our discussion in section 3 where we will compare the applicability of the various methods to different types of reservoir systems for example presence of multiple reservoirs or multiple objectives linearity or non linearity of the reservoir simulation model etc and give practical guidelines towards selecting an appropriate method for a given system 2 2 1 methods for release sequence rs optimization the first case identified by our classification system is that of release sequence rs optimization see fig 4 for disambiguation of terminology a rs is a sequence of reservoir release decisions over a prescribed time period thus each release in the sequence is a variable in the optimization problem an optimal rs is the release sequence for which an objective is minimized under a given deterministic scenario of the system forcing inputs e g reservoir inflows and demands i e 1 u a r g min u j where u is a matrix containing all releases over the simulation period for all the reservoirs in the system under study i e a rs j is the aggregated objective associated with these releases and u is the optimal rs since the optimization argument is the matrix u the solution space to be explored in the optimization quickly grows with the length of the simulation period and the number of reservoirs the large search space is a characteristic difficultly of rs optimization the three most commonly used methods for rs optimization are summarized below mathematical programming we classify as mathematical programming any method that exploits the mathematical properties of the optimization problem for example linearity and convexity of the constraints and objective to efficiently find an optimal rs as such mathematical programming is most effective where speed is important and simplifications to fit the required assumptions e g linearizing non linear components are acceptable mathematical programming employs a broad range of algorithms distinguishable primarily by the level of non linearity allowed in the objective and constraint definitions linear and quadratic programming algorithms lp qp require that all constraints be described by linear equations and that the objectives be either linear lp e g applied to rs optimization by hiew et al 1989 and terlaky 2013 or quadratic qp e g mariño and loaiciga 1985 while these assumptions are strong the advantage of lp and qp is that they can quickly find global optima even for large rs optimization problems however as the linearity assumptions become less acceptable and non linear equations are needed for a more realistic representation of the reservoir system non linear programming nlp is required sequential linear programming e g martin 1983 grygier and stedinger 1985 and sequential quadratic programming e g boggs and tolle 1995 have been most commonly applied to rs optimization however other nlp algorithms exist and continue to be developed see for example bazaraa et al 2013 for a recent collection of available algorithms the disadvantage of nlp algorithms is that they cannot guarantee reaching a globally optimal solution in usable computation time for many problems bazaraa et al 2013 value function estimation this method exploits the dynamic nature of the optimization problem by breaking it into a sequence of easier to solve sub problems each relevant to one time step in the simulation period the key idea is to define a value function that for each time step represents the cost it takes to transition from the state at that time step t to the state at the final time step of the simulation period t if only optimal decisions are made i e via the optimal rs from t to t hall and buras 1961 the value function can be derived by solving the recursive bellman equation of dynamic programming bellman 1956 which has been extensively used for reservoir operation optimization for a long time the first review of its application dating back to yakowitz 1982 there are two primary strengths to the value function estimation method firstly it does not impose any limitation on the level of non linearity of the objective or constraints secondly the solution time only increases linearly with the length t of the simulation period in contrast to the other rs optimization methods which increase polynomially or worse so that it can be applied to find optimal rs that are very long the drawback is that since at each time step the numerical resolution of the bellman equation requires the evaluation of all possible combinations of state variables e g storages and decision variables e g releases the solution time scales exponentially with the number of states and decisions this problem was named by bellman as the curse of dimensionality bellman 1956 and it severely limits the applicability of this method to large reservoir systems a second drawback is that since the value function is only defined at discrete points interpolation between point evaluations is required the first weakness compounds the second the curse of dimensionality pushes towards using a coarser resolution and this makes the interpolation less accurate several variants of the discrete dp algorithm have been proposed to mitigate the problem in the context of reservoir operation optimization for example incremental dynamic programming hall et al 1967 and dynamic programming successive approximation shim et al 2002 however none of these have established as standard practice another very important limitation of the value function estimation method which no technical advances will overcome is that the very definition of a value function requires a time separable objective as discussed in section 2 1 making the method incompatible with common performance metrics such as resilience metrics hashimoto et al 1982 heuristic optimization this term covers a wide range of algorithms that can use very different working principles but have as a common trait the fact that they attempt to find an approximate solution to a problem in our case highly non linear and or with large number of reservoirs for which classic methods mathematical programming and value function estimation in our case are not applicable given such variety of heuristic optimization algorithms we do not discuss the entire spectrum of options but highlight that the two most common methods currently in use for rs optimization are genetic algorithms ga wardlaw and sharif 1999 hınçal et al 2010 and particle swarm optimization pso kumar and reddy 2007 noory et al 2012 however numerous other algorithms have been tried in the context of rs optimization such as honey bees mating haddad et al 2006 ant colony optimization kumar and reddy 2006 simulated annealing georgiou et al 2006 and many more garousi nejad et al 2016 to the best of the authors knowledge heuristic optimization was first applied to the rs optimization problem by wardlaw and sharif 1999 given that no single algorithm dominates in all cases newer algorithms use a combination of optimization search strategies blended from different algorithms reed et al 2013 which are selected in an adaptive manner throughout the optimization process an example that appears to be very successful is the borg algorithm hadka and reed 2013 the advantage of heuristic optimization is that it can be equally applied to linear or non linear constraints and objectives as well as to either time separable or non separable objectives hence it can be applied to problems where complex decisions are investigated for example planning drought revenue loss insurance as in herman et al 2014 since heuristic optimization covers a large variety of algorithms it is difficult to make generic statements about its weaknesses which may vary from one algorithm to another however one general comment is that as the size of the rs increases either due to many decisions per time step or a long simulation period or both the solution time can become prohibitively long 2 2 2 methods for operating policy op optimization an operating policy op is a function that takes the current state of the system and returns a release decision or set of release decisions to be implemented in the current time step at a minimum the system state vector i e the independent variable of the op should include the reservoir storages at the current time step in a more sophisticated op it may also include additional information such as time of year useful for reservoir systems with strong seasonal behaviour reservoir inflows at the current or previous time step tejada guibert et al 1995 or other information like flows at upstream locations in the reservoir network giuliani et al 2015a in the following we denote an op as 2 u t m θ x t where u t is the vector of all release decisions to be made at time t x t is the vector of relevant state variables such as storages reservoir inflows etc at time t and θ is a set of parameters to be determined as part of the op optimization task the op optimization problem can be described by 3 m a r g min m j we classify op optimization methods into three categories below release sequence based rsb the first step for these methods is to solve a rs optimization problem and thus obtain an optimal rs u and associated optimal states x the op the function m and its parameters θ in eq 2 is then derived as the result of a regression between the time series of state variables x and the optimal rs u in other words the op is a generalization of the optimal rs it originates from it follows that a better op is obtained when the optimal states x cover the state space as widely as possible this in turn is more likely to be achieved if the rs is optimized over a long simulation period resultantly in most cases heuristic optimization will not be applicable for the rs optimization step while either mathematical programming or value function estimation will need to be employed hence imposing constraints on the objective formulation and model structure as discussed in section 2 2 1 as for the second step many sophisticated regression techniques have been demonstrated most commonly artificial neural networks fuzzy logic and decision trees celeste and billib 2009 celeste et al 2009 kumar et al 2012 zhou et al 2015 since each regression algorithm has different benefits and drawbacks discussed in referenced papers it is unlikely that a single algorithm is preferable for all possible reservoir systems labadie 2004 a limitation of the rsb method is that it provides an op that is only optimal to the accuracy of the regression i e it is actually sub optimal even under the deterministic scenario used in the rs optimization step furthermore and possibly more importantly the very rsb optimization problem is somehow ill posed in fact the ultimate goal of reservoir optimization is to find the op that minimizes the management objective and not the distance from an optimal trajectory x that most likely will never occur because it is based on a deterministic scenario of uncertain input forcing directly minimizing the objective function is precisely the key idea of the dps method described in the next section the rsb method thus appears to be an unnecessarily indirect way to achieve in a sub optimal way what dps can achieve more directly direct policy search dps these methods aim to directly derive the op by directly finding the parameterization θ of a pre selected function m that minimizes the objective under a deterministic time series of forcing inputs in a special case of eq 3 4 θ a r g min θ j the dps approach can be linked back to early works by maass et al 1962 and revelle et al 1969 on the linear decision rule ldr in fact the op of a single purpose single reservoir and single demand node reservoir system can be expressed by the ldr 5 m s t θ t where θt is the ldr parameter essentially the target storage for time step t to be optimized if the objective and all constraints are linear then the optimization problem can be formulated as a linear program and the set of optimal parameters one per time step obtained by mp the ldr approach can be expanded to include a non linear op i e a non linear version of eq 5 by using first order taylor series approximation of non linear objectives shih and revelle 1994 1995 pan et al 2015 heuristic optimization algorithms can be used to extend the applicability of dps to non linear objectives and constraints as well as any function form for the op beyond the linear case all the heuristic optimization algorithms described previously section 2 2 1 are in principle suitable to solve eq 4 indeed both ga oliveira and loucks 1997 koutsoyiannis and economou 2003 ahmed and sarma 2005 chang et al 2005 momtahen and dariane 2007 li et al 2014 and pso ostadrahimi et al 2011 have been tested for this purpose the additional benefits of heuristic optimization algorithms such as no limits on using time non separable objectives giuliani et al 2014 spontaneous multi objective formulation and scalability to many objective problems will be further discussed in section 3 2 as for the choice of the op form many options beyond the simple linear curve in eq 5 have been proposed the op may be represented by for example a piecewise linear function oliveira and loucks 1997 as depicted in fig 5b given that non linear and piecewise constraints are handled by heuristic optimization algorithms it is possible to introduce variable policy structures within the same reservoir system for example to operate some reservoirs based on their inflows and some others based on their storage levels ashbolt et al 2016 universal approximating functions can also be used for example artificial neural networks ann pianosi et al 2011 or radial basis functions rbf which according to giuliani et al 2015b can outperform anns in many different aspects in all these cases the parameter vector θ contains the weights and biases of the ann or rbf the advantage of such universal approximating functions is that they do not a priori constrain the op to any specific structure and that they scale efficiently with the number of input arguments of the approximating function barron 1993 i e in our case the number of independent variables of the op the drawback is that the resulting op is a black box that is difficult to interpret and therefore possibly more difficult to communicate to decision makers a possible solution to this problem is to optimize the rule curves for definition see op disambiguation in fig 4 in use by the current operators as done for example by chang et al 2005 and zhou and guo 2013 however rule curves have a lack of flexibility that will significantly degrade their performance even when their parameters have been optimised they are also typically expressed in the form of target reservoir storages and hence they do not provide explicit recommendation on water release abstraction decisions an alternative is to create ops that have highly flexible structures but are easy to visualize such as in the form of a decision tree herman and giuliani 2018 expected value function estimation the expected value function estimation method extends the value function estimation approach discussed for rs optimization to the case of op optimization i e optimization under uncertain forcing inputs typically forcing inputs are regarded as stochastic variables described by probability distributions and the op is obtained by the minimization of the expected value of the value function the solution algorithm called stochastic dynamic programming sdp follows similar steps as the discrete dp algorithm but with one more layer of discretization for the forcing input variables the value function is thus evaluated against all possible combinations of the forcing inputs and the sample mean is used to approximates its expected value for each discretised state another possible approach although much less common is to describe forcing inputs by membership sets rather than probability distributions and search for the op that minimizes the maximum possible value function nardini et al 1992 the sdp algorithm has been widely used for reservoir operation for reviews see yakowitz 1982 nandalal and bogardi 2007 however its applicability is subject to the same limitations as deterministic dp i e the need for time separable objectives limited scalability to multi objective problems and the curse of dimensionality as discussed in section 2 2 1 the latter problem is even more severe here given that each state decision combination must be evaluated against each combination of forcing input variables to partially mitigate the computing burden several variants of the sdp algorithm have been proposed including the neuro dynamic programming ndp algorithm castelletti et al 2007 which uses a neural network to interpolate the value function evaluations allowing for a coarser state discretization grid another limitation of the sdp approach is that each forcing input must be characterized by an independent probability density function which might be an overly simplistic approach for input processes e g inflows which typically exhibit complex temporal and spatial structures carrillo et al 2011 on the other hand including temporal and spatial correlations among probability distributions would increase the number of variables required for discretization up to a point that the problem becomes computationally intractable an sdp variant that aims at overcoming the issue is sampling sdp ssdp which uses a large number of sample inflow sequences in place of inflow probability distributions see kelman et al 1990 for one of the earlier works on this and stedinger et al 2013 for a more recent review more recently reinforcement learning rl algorithms have been demonstrated as viable options for approximating expected value functions using time series of inflows rather than distributions e g castelletti et al 2010 2013 dariane and moradi 2016 2 2 3 real time optimization rto when forcing inputs of the reservoir system are uncertain but a forecasting system is in place real time optimization rto is an interesting alternative to the op approach differently from op optimization where the optimization task is concentrated in one effort in rto the optimization is repeated each time an operational decision needs to be taken this allows for exploiting forecasts for example inflow or demand forecasts that are available from a continuously updated forecasting system the optimization problem is typically formulated as an rs optimization with forcing inputs set equal to their deterministic forecasts and initial system state reflecting the current system conditions long term costs beyond the forecast horizon are accounted for by including a term that penalizes unfavourable final states into the objective function for example for a supply reservoir the penalisation function would help finding a balance between maximising supply reliability over the forecast period and not leaving the storage depleted at the end of the period the rto problem is hence formulated as 6 u arg min u j t t h 1 p x t h where p represents the penalisation function h is the length of the forecast period u is the rs over the period t t h 1 j t t h 1 is the cost associated with implementing u over this forecasted period and x t h represents the system state at the end of the forecasted period the rto problem in eq 6 can be solved by any of the rs optimization methods discussed in section 2 2 1 provided they can accommodate any non linearity associated with the penalization function although the optimal rs obtained through eq 6 provides release decisions over the entire forecast period only a small portion of the sequence will actually be implemented this may only be the releases for the current time step or it may be the releases until a new forecast becomes available when new forecasts become available the optimization process is performed again with updated forecasts and initial states fig 5c hence despite the mathematical formulation and the optimisation argument in eq 6 are the same as in rs optimisation the practical output of rto is different only the decision s to be made in the current time step or until the next forecast becomes available instead of the entire sequence of decisions a key issue in the application of rto is the adequate definition of the penalisation function different approaches have been demonstrated from using deviations from seasonal target storages as given for example by the reservoir s filling curves e g ficchì et al 2015 to linking the penalization function to the solution of an optimization problem where off line forecasts e g seasonal distributions are used in place of posterior real time forecasts e g galelli et al 2014 in principal any of the op optimization algorithms introduced in section 2 2 2 could be used to derive penalisation function the expected value function has been demonstrated to be suitable in pianosi and soncini sessa 2009 however as discussed expected value function optimization is not applicable to systems that contain many reservoirs or require many decisions to be made each time step as the deviations from the assumed deterministic forecast increase the rto release becomes less effective when applied in reality therefore the benefits of using rto are highly dependent on the quality of the real time forecasts if these forecasts are not significantly better than off line forecasts e g seasonal distributions then using an op will be equivalent to rto but at lower implementation costs as the optimization effort of an op is done once and for all before the operation starts this is the primary reason why rto has only recently received significant attention as a result of increasingly accurate forecasting systems anghileri et al 2016 a proven way to increase rto performance in the presence of inaccurate forecasts is by explicitly taking into account forecast uncertainty in the optimization problem this has been mainly implemented using two approaches the first is to explicitly characterise forecast s uncertainty by probability distributions and solve the resulting stochastic optimization problem by expected value function estimation which means the rto problem is mathematically reformulated as an op optimisation problem instead of an rs optimisation problem as in eq 6 the initial illustration of the idea although with an extremely simplified flow forecasting approach dates back to bras et al 1983 and more recent applications include pianosi and soncini sessa 2009 and zhao et al 2011 the second is to optimize an rs against an ensemble of inflow forecasts as done for instance by zhao et al 2011 raso et al 2014 and ficchì et al 2015 interestingly all these authors have found that including forecast uncertainty consistently outperforms any single deterministic worst case or most likely forecast rto approach finally an interesting question for rto is the impact of the forecast horizon length or lead time on rto performance for example zhao et al 2012 investigated how forecast horizon length and forecast uncertainty trade off against each other aiming to find the effective forecast horizon for which the forecast provides the most valuable information for decision making if the forecast horizon is short the optimized decision is highly sensitive to the horizon length as the horizon length increases the decision becomes increasingly sensitive to forecast uncertainty interestingly in zhao et al 2012 the inclusion of ensemble forecasts improved performance but had no effect on determining the effective forecast horizon seasonal forecasts between a month and a year with some skill are becoming widely available for water resources operators although the value of seasonal forecasts to improve operation by rto has proved limited thus far celeste et al 2008 anghileri et al 2016 we would expect this to become an increasingly active area of research as the skill of these forecasts improves or perhaps as characterization of their uncertainties becomes more accurate 3 comparison and choice of reservoir optimization methods in the previous sections we have briefly reviewed operation optimization methods individually in this section we will discuss some concepts and properties that are relevant across methods and can be useful for the comparison and choice of the most adequate method for the problem at hand we start by discussing how operating policy op optimization methods could be further classified based on the approach they use to handle uncertainty in forcing inputs typically reservoir inflows but possibly also other input variables parameters like water demand or energy price i e implicit or explicit such distinction is useful both in mathematical and in practical terms following this discussion we debate the concept of optimality within a practice oriented research field such as reservoir operation optimization and compare the extent to which different methods can be regarded as optimal given the uncertainties that the reservoir modelling and optimization process is subject to finally we compare the ability of different methods to scale from single objective to multi objective problems which as anticipated in section 2 1 is a very important feature in the context of reservoir operation optimization these topics and the advantages and disadvantages anticipated in sections 2 2 are then brought together into a set of practical guidelines towards appropriate method selection 3 1 implicit versus explicit treatment of forcing inputs variability in the context of op optimization a typical distinction is made between two classes of optimization methods based on the way they handle the variability in forcing inputs the distinction is used for example in the review by labadie 2004 these two classes are implicit stochastic optimization and explicit stochastic optimization implicit stochastic optimization accounts for variability in forcing inputs implicitly by using a long and diverse realisation typically a time series of historical observations or a synthetic time series generated by a statistical model explicit stochastic optimisation instead directly uses the statistical model within the optimisation process by this distinction release sequence based rsb optimization and direct policy search dps both belong to the implicit stochastic optimization class although at the time of labadie 2004 review dps was not a common approach and so implicit stochastic optimization was used almost as a synonym of rsb optimization while the expected value function approach is an example of explicit stochastic optimisation authors who have adopted the implicit explicit divide seem to suggest that an explicitly approach is preferable because it is more rigorous however it should be noted that forcing input probability distributions are also subject to simplifying assumptions such as simplification or omission of spatial and temporal correlations furthermore probability distributions are estimated from historical data and therefore can also be affected by scarcity or poor quality of the data koutsoyiannis 2000 chatfield 2013 so in our opinion the preference for explicit characterisation of uncertainty is often not strongly motivated except for the simplest case of a single input reservoir system where a complete characterization of inflow uncertainty by probability distribution is often possible more generally we would argue that classifying op optimization algorithms based on the implicit explicit divide is mathematically elegant but much less salient from a user s perspective 3 2 scaling methods to multi objective optimization as anticipated in section 2 1 reservoir operation is typically a multi objective optimization problem as different objectives need to be achieved simultaneously multi objective optimization problems can be approached through two distinct methods a priori and a posteriori methods cohon and marks 1975 a priori methods rely on a prior weighting of the objectives in a way that tries to capture the decision maker s preferences as a result of this weighting a single aggregated objective function is obtained and the problem is traced back to a single objective optimisation a posteriori methods instead preserve the multi objective nature of the problem and aim at creating a set of pareto optimal solutions each realising a different trade off between the multiple objectives there are two ways to create a set of pareto optimal solutions one approach is to repeatedly solve a single objective optimization problem with different aggregation weights of the multiple objectives the main drawback of this approach is that the number of optimizations required to approximate the pareto front the representation of optimal tradeoff solutions in the objective space at given resolution increases factorially with the number of objectives reed and kollat 2013 the other approach is to obtain a complete set of pareto optimal solutions in a single optimization run using population based optimization techniques which scale far more effectively with the number of objectives in the context of the reservoir operation optimization methods presented so far we note that the algorithms for mathematical programming and value function estimation and by extension for expected value see fig 3 are inherently single objective a priori techniques are therefore the only available way to handle multi objective problems if these approaches are used on the contrary most heuristic optimization ho algorithms and in particular population based algorithms such as ga and pso can equally handle single or multi objective optimization problems and therefore provide an entire set of pareto solutions in a single optimization run in the multi objective case sharif and wardlaw 2000 they thus constitute an a posteriori approach and make heuristic optimization whether it is used to directly obtain a rs or within dps particularly efficient when the number of objectives is large reed et al 2013 a review and comparison of many state of art population based approaches for mo optimization for dps is provided by salazar et al 2016 finally one exception to the distinction delineated above is the reinforcement learning rl algorithm introduced by castelletti et al 2013 which is the first and to the authors knowledge only a posteriori algorithm for multi objective expected value function optimization this method is also applied and compared with dps in dariane and moradi 2016 where it is found that dps outperforms rl although it is not possible to conclude whether the result would hold in a water system of lower dimensionality in which the limitations of expected value function optimization are less prohibitive 3 3 optimality and modelling assumptions the optimization algorithms reviewed in the previous sections provide different degrees of confidence with regard to the optimality or sub optimality of their solutions for example a correctly executed mathematical programming algorithm provides an optimal solution of the optimization problem value function approaches provide approximately optimal solutions i e accurate to the resolution of the interpolation while heuristic optimization algorithms give no guarantee of optimality and simply return the best solution that could be found in a given number of iterations however it is important to highlight that such optimality statements are only valid within the given problem formulation if the problem formulation is not correct i e the underlying assumptions for example linear reservoir equations or a single time separable objective provide an oversimplified representation of the system behaviour then the optimal solution will perform sub optimally when applied in the real world this is an important factor to be considered when selecting an optimization method as we will further discuss in the following section 3 4 practical guidelines towards selecting reservoir operation optimization methods the literature review presented in the previous sections was aimed to provide practical information about the advantages and limitations of reservoir operation optimization methods another contribution of this review is to identify a set of guidelines for the selection of the most appropriate optimization method for a given reservoir system our advice is summarised in the comparison table presented in fig 6 the table can be used to narrow down the number of suitable methods horizontal axis for a reservoir system of given characteristics vertical axis for release sequence rs optimization the choice is least obvious and highly dependent on the system characteristics the greatest advantage of mathematical programming is its speed scalability and the guarantee of analytical optimality albeit under the caveat that the problem must be simplified to fit the required assumptions on objectives and constraints value function estimation can solve non linear and thus more realistic optimization problems over long time periods of the order of t 10 000 time steps e g decades if the time step is daily or centuries if it is weekly but is limited to small reservoir networks up to 3 4 reservoirs at current computing power and the solution s optimality is subject to the interpolation accuracy of the value function heuristic optimization is a more flexible method that can handle multiple objectives efficiently and allows for time non separable objectives but it is limited to short lengths of the simulation optimization period for operating policy op optimization we suggest that direct policy search dps is the most widely applicable method and indeed in recent years it has been the most commonly applied method even if it cannot provide any assessment of the optimality or accuracy of the solution still we do not think this is a major issue for practical purposes given the difficulty in evaluating whether simplifying assumptions required by other methods are satisfied for the problem at hand and to what extent similarly expected value function estimation may still be preferred in those situations where it is computationally feasible i e relatively small reservoir networks and when one can reasonably presume that its underlying assumptions in particular time separability of the objectives are acceptable for real time optimization no specific method has been clearly established yet although value function approaches have possibly been employed more frequently in the literature but we would expect that more research will be carried out in this context given the increasing availability and advances in real time monitoring and forecasting systems 4 conclusions in this paper we have reviewed the ever growing body of literature in the field of reservoir operation optimization based on a novel classification system that uses the argument of the optimization problem as the main criterion to classify methods our classification system shows that while the use of different arguments leads to substantially different problem formulations and types of solution an optimal release sequence versus an optimal operating policy the algorithms used for solving the optimization problem are to some extent interchangeable we hope this way of introducing the literature enables to shift the focus from the mathematical properties of solution algorithms which we expect to be less accessible to users to the more obvious and tangible properties of the reservoir operation problem we also provided a comparison between different types of optimization algorithms and some guidance as to what types of system they are more likely to be applicable to ultimately we hope this paper will contribute to further improve the accessibility of this literature to a wider audience acknowledgements b dobson is funded as part of the wise cdt under a grant from the engineering and physical sciences research council epsrc grant number ep l016214 1 f pianosi is partially funded by an epsrc living with environmental uncertainty fellowship grant number ep r007330 1 partial support for t wagener was provided by a royal society wolfson research merit award supplementary materials supplementary material associated with this article can be found in the online version at doi 10 1016 j advwatres 2019 04 012 appendix b supplementary materials image application 1 appendix a in this appendix we present a simple example of a reservoir operation optimization problem that we use to describe the mathematical formulation of the different optimization methods reviewed in the paper we note that we use a highly simplified simulation model which omits several processes e g evaporation that would need to be represented in a real world application in order to allow the reader to focus on the specifics of the optimization problem formulation we also provide the matlab code to implement some of these methods at the link https github com barneydobson reservoir operation optimization examples the system is a single reservoir single release single point of demand system pictured fig a1 and characterised by the following variables and constant parameters st reservoir storage at time t scap reservoir capacity constant it reservoir inflow at time t ut release from the reservoir to the point of demand at time t d volume of water demanded assumed constant wt reservoir spill at time t the objective of the system operation is to minimize the squared deficits i e the squared differences between the release and the demand d ut 2 at each time t we will assume a simulation period of length t and that the system operator is interested in the cumulate squared deficits over this period a1 j t 1 t d u t 2 release sequence rs optimization the form of rs optimization will be a2 min u 1 u 2 ut t 1 t d u t 2 subject to the constraints a3 s t 1 s t i t u t w t for t 1 t w t max 0 s t 1 s c a p for t 1 t u t 0 u t d t u t s t i t for t 1 t s 1 l 1 l 2 l t d s cap given both heuristic optimization and mathematical programming directly solve eq a2 because linear programming requires a linear objective it is not suitable to make it suitable the objective in a1 would not be squared because quadratic programming requires linear constraints and the spill in a3 contains max it cannot be directly applied to the problem of a2 a3 instead spills can be treated as decision variables to make quadratic programming applicable which we demonstrate in the example code nonlinear programming and heuristic optimization are both straightforward to apply to the problem value function estimation requires a different approach where each element of the release sequence is obtained by minimizing the so called value function vt at the relevant time step a4 u t arg min u t d u t 2 v t 1 s t i subject to the constraints in a3 relevant to time t the value function gives the minimum cost associated at each storage state st i e the total cost that would be encountered if starting from that storage value at time t only optimal decisions were made until the end of the optimisation period a5 v t s t k t t g k w h e r e g k min u k d u k 2 by definition the value function satisfies the recursive equation also called bellman equation bellman 1956 a6 v t s t min u t d u t 2 v t 1 s t 1 the value function estimation algorithm hence exploits such recursive equation it starts by finding the value function at the end of the period t t since no further costs are defined beyond the end of the period i e vt 1 st 1 0 for any possible storage value st 1 the value function for the final storage vt st can be obtained by simply minimising the step costs gt of the final transition from t 1 to t because the storage state at the final time step st is not known as it is dependent on previous decisions the minimisation is repeatedly solved at several discrete storage values the value function will thus be defined for any final storage value within the accuracy of an interpolation between the evaluated discrete values once the value function for the final time step vt st has been defined the value function of the previous time step vt 1 st 1 can be derived by applying eq a3 at discretised values of the state st 1 the process is iterated backwards in time across the entire simulation period until the value function is defined for every time step operating policy op optimization for op optimization we define an operating policy that determines the release depending on a subset of the system state variables for example a simple op could be one that makes the release depend linearly on the current storage and inflow of the previous time step a7 u t m θ i t 1 s t θ 1 θ 2 i t 1 θ 3 s t if an optimal rs is available for example after solving problem a2 then the policy parameters can be estimated by least squares minimization of the difference between the optimal release sequence u and the outputs of the op a8 min θ 1 t t 1 t m θ i t 1 s t u t 2 where i and s are the inflows and storages associated with the optimal release sequence u also obtained when solving a2 such an approach is what we called release sequence based rsb optimisation in contrast the direct policy search dps formulation will take the following form a9 min θ 1 t t 1 t m θ i t 1 s t d 2 subject to the constraints in a2 as with rs optimization whether mathematical programming or heuristic optimization is used to perform the minimization in a9 the form of the optimization problem does not change as with value function estimation for rs optimization expected value function optimization requires first deriving value functions by exploiting the bellman equation and then defining the implicit operating policy as a10 v t s t min u t e i t d u t 2 v t 1 s t 1 where e represents the expected value operator calculated over the probability distribution of inflows thus an individual release is given by a11 u t arg min u t e i t d u t 2 v t 1 s t 1 
655,reservoir operation optimization aims to determine release and transfer decisions that maximise water management objectives such as ensuring a reliable water supply hydropower production mitigation of downstream floods etc an extensive and growing body of scientific literature exists on advancing and applying mathematical optimization methods to reservoir operation problems in this paper we review such literature according to a novel classification system of optimization approaches which focuses on the characteristics of the actual operation problem i e what needs to be optimized or in mathematical terms the argument of the optimization problems rather than the mathematical properties of the optimization algorithm this enables us to discuss the advantages limitations and the scope of application of the different optimisation methods and to provide practical guidelines for matching the properties of a system and operation problem with a suitable optimization method alongside this paper we provide code to implement many of the methods we review for an illustrative reservoir system graphical abstract image graphical abstract keywords reservoir operation water resources multi objective optimization 1 introduction a recent estimate places the total global storage capacity of reservoirs and dams between 7000 8 000 km3 lehner et al 2011 while dam construction has slowed in countries with a human development index hdi above 0 7 the un development programme s threshold for a high level of development jahan 2015 it is likely to continue at a considerable rate in countries with an hdi below 0 7 the latter countries contain around half of the human population and have the highest projected growth rates with a total population increase of 18 27 by 2030 un 2015 as shown in fig 1 currently the per capita water storage of low hdi 0 7 countries is around one third of high hdi 0 7 countries besides building new dams to fulfil irrigation and water supply needs hydropower dams are also expected to triple worldwide from 2000 to nearly 6000 by 2030 under growing electricity demand ansar et al 2014 zarfl et al 2014 despite their importance and the level of planning and resources required to construct a dam it is common for reservoirs not to achieve the goals envisaged in their design in terms of both economic returns and mitigation of negative impacts wcd 2000 labadie 2004 dams are most commonly criticised for causing social and environmental damage such as the displacement of communities or the obstruction of sediments graf 1999 ouyang et al 2010 tockner et al 2011 liermann et al 2012 scudder 2012 which may not be sufficiently understood beforehand therefore damages are underestimated and poorly mitigated by actions recommended in social and environmental impact assessments nakayama 1998 fearnside 2016 nonetheless countries with unsatisfactory water resource infrastructures continue dam construction in a drive to increase quality of life muller et al 2015 in countries with adequate water security negative impacts have occasionally resulted in the decommissioning of dams allan 2003 bellmore et al 2016 ho et al 2017 and in substantial legal regulation for water resources management regulations include changing investment preferences towards efficiency gains that can be achieved through for example water transfer or network projects brown et al 2015 the coordinated operation of these linked systems allows greater scope for increased efficiency than could be achieved by uncoordinated operation of individual sources with efficiency gains that could be applied towards environmental impact mitigation poff and schmidt 2016 optimization of reservoir operations is therefore more relevant than ever both as a complement to the efficient design of new dams and for the revision of operations in existing ones here we would define reservoir operation as the determination of how much water to abstract from sources e g rivers to transfer between reservoirs and to release from reservoirs to points of consumption e g for irrigation domestic or industrial consumption or use e g hydropower production reservoir operation is a challenging decision making problem because it requires finding a balance between decisions conflicting in time for example whether to accept a cost in the short term in order to avoid a larger but more uncertain cost in the mid term and across uses for example between irrigation hydropower and municipal supply research has demonstrated that the use of mathematical models to simulate and optimize reservoir operation can significantly enhance the performance of existing reservoirs as well as enable efficient design of new dams or their repurposing expansion traditionally dam design has been based on rippl s method an approach that aims to find the smallest reservoir capacity that can ensure releasing the target water demand through a worst case drought rippl 1883 hazen 1914 loucks et al 2005 drawbacks of this approach include the difficulty in applying it to systems that go beyond the simple single reservoir and single purpose case for example coordinated reservoir networks or multiple purpose reservoirs maass et al 1962 more flexible approaches that can accommodate these drawbacks have been proposed for many years vogel and stedinger 1987 1988 douglas et al 2002 celeste 2016 and are now widely adopted in scientific research loucks et al 2005 these design methods simulate the reservoir system against long time series of reservoir inflows and iterate the simulation until finding the minimum reservoir capacity that meets the target objectives under a variety of hydrological conditions as such they require an explicit formulation and preferably nested optimization of the reservoir operating policy that will be used to make release decisions in the various simulated circumstances reservoir operation optimization is a mature and yet very active research area see fig 2 and a number of reviews of the available optimization methods have been carried out over time yeh 1985 labadie 2004 castelletti et al 2008 rani and moreira 2009 ahmad et al 2014 while these reviews may differ in the emphasis given to a particular group of methods or another they all share the same fundamental approach to classifying and presenting methods which is based on the mathematical properties of the optimization algorithms however we believe that an alternative approach to classifying methods is possible and useful particularly for new and non specialised users by focusing on the argument of the optimization problem in order to better understand this point we note that there are four elements to an optimization problem 1 the objective s i e the variable s to be minimised maximised such as the average water supply or hydropower production level of flood protection etc 2 the argument of the optimization problem i e the decision variable s whose optimal choice would deliver the minimum maximum objective value s 3 the constraints i e the set of equations that link the decision variables to the objectives and 4 the optimization method i e the algorithm used to determine the values of the decision variables that optimize the objectives while respecting all the constraints we have presented these elements in the order in which they should be defined in practice indeed when formulating an optimization problem the optimization method should be the last element to be chosen and yet previous reviews in this field focus on this element as the key to present and compare literature contributions we propose instead that the highest level of classification should be the argument which determines the output of the optimization task which type of variable is being optimized i e a sequence of release transfer decisions or an operating policy as further explained in the following sections this changes the focus to the practical aspects that make an optimization approach more or less suitable for the problem at hand what type of solution they deliver and when they are useful rather than the mathematical properties of the solution algorithm how the methods achieve those solutions this paper hence offers a new review of the scientific literature on reservoir operation optimization where optimization methods and applications are presented according to the type of argument to the optimization problem instead of the underlying mathematics in use indeed we will show that the same type of algorithm for instance a genetic algorithm can be used to solve reservoir optimization problems with very different arguments e g deriving the optimal sequence of short term decisions vs determining the long term optimal operating policy while an optimization problem with the same type of argument and hence solution can be solved by using very different algorithms e g a genetic algorithm vs a nonlinear programming one we complement the review with a terminology disambiguation table to help the reader navigate both our review and the wider literature where terms are sometimes used with different meanings by different authors by focusing less on the mathematical properties of solution algorithms in favour of an argument based classification of the optimization methods we are also able to draw a comparison between them discuss important practical factors such as the different assumptions required by each method and ultimately provide guidelines towards selecting a suitable method for the decision making problem at hand we hope our paper will make the reservoir operation optimization literature accessible to a wider audience besides the academic community already active in water systems analysis and optimization 2 review and classification of reservoir operation optimization by argument in this section we present our classification system by argument and review optimization methods and applications accordingly beforehand however in the following subsection we briefly define the two other elements of the optimization problem formulation described in the introduction the objectives and the constraints 2 1 objectives and constraints in the optimization literature an objective is a scalar variable that summarises the system performance over a temporal period the optimization method aims at either minimizing or maximizing the objective throughout this review we will assume that objectives must be minimized i e they represent either costs or benefits changed in sign objectives that are commonly used to evaluate the performance of reservoir systems capture the system s reliability resilience or vulnerability hashimoto et al 1982 loucks et al 2005 kasprzyk et al 2013 reliability objectives measure the frequency of occurrence of a specified failure event for example failure to supply adequate amounts of water to a demand node resilience objectives measure the recovery time from a failure event and vulnerability objectives measure the severity of the failure s consequences the choice and definition of objectives can vary greatly depending on the specific reservoir system under study the availability of data etc and as a general rule should reflect as much as possible the reservoir operator s targets and preferences however two factors in the formulation of the objective impact the applicability of operation optimization methods the first is the presence of non linear components in the objective s mathematical definition which may prevent the application of some methods that assume linearity as will be summarised in section 3 4 the second is the so called time separability i e the fact that the objective is defined by temporal aggregation for instance averaging of step costs or step benefits that only depend on system variables at one time step barro and king 1982 an example of a time non separable objective is the profit from selling water in a water market where the price at each time step is dependent on water sales at previous time steps another critical aspect that may strongly influence the applicability of reservoir optimization methods is the number of objectives that the operation aims to minimize in fact reservoirs are typically expected to serve multiple purposes for example nearly half of all large dams included in the world register of dams icold 2003 have multiple uses most commonly irrigation hydropower water supply and flood control a possible approach to handle multiple objectives is to make them commensurable by appointing them an economic value so that they can be summed up into a single objective that expresses the total net benefit or cost over the simulation period maass et al 1962 however this technique may not sufficiently compensate for non economic indicators and does not express the available trade offs between objectives to the decision maker as described in detail in kasprzyk et al 2013 an increasingly preferable alternative is to solve a multi objective optimization problem which returns a set of pareto optimal or pareto efficient solutions instead of one optimal solution pareto optimal solutions are characterised by the property that an improvement in one objective is unattainable without a deterioration in at least one other objective cohon and marks 1975 the choice of the best solution within the set of pareto optimal ones is not considered as part of the optimization process because it involves a subjective evaluation of what acceptable trade offs between the objectives should be however in order to assist the decision maker in such evaluation and choice the set of pareto optimal solutions can be displayed in the objective space this representation is called the pareto front to reveal and quantify those trade offs the benefit of visualizing the pareto front lies in enabling the decision maker to view the impact of their decisions in the context of all objectives rather than a single prior weighted objective in selecting one solution within the pareto front the decision maker implicitly selects a posterior set of weights for the sake of simplicity in the next section we will first introduce optimization methods with reference to the single objective case and in section 3 2 we will discuss their ability in handling multi objective optimization problems in particular when the number of objectives increases above 3 the so called many objective problems fleming et al 2005 the constraints of an optimization problem are all the equations that are needed to compute the objective s from the decision variables in a reservoir operation optimization problem this link is established via a simulation model of the reservoir system which is run over the simulation period for given initial condition and trajectory of forcing inputs initial conditions such as reservoir storages at the beginning of the simulation period are typically selected by a sensible guess and the impact of their choice mitigated by calculating system performances only after a warmup period see ashbolt et al 2016 as an example forcing inputs such as trajectories of inflows or water demands may be represented by historical data synthetic data generated from a statistical model or a statistical model in itself as we later discuss in section 3 1 whether a statistical model or actual data synthetic or historical is used will impact the choice of the solution algorithm how to best create the statistical model whether to be used directly in the optimisation or to generate synthetic forcing data has been an active field of research throughout the history of reservoir operation fiering and bund 1971 hirsch 1979 salas et al 2005 rajagopalan et al 2010 herman et al 2016 the simulation model is essentially based on the law of conservation of mass in the form of a water balance equation over time for each reservoir and a water balance across space for each link between reservoirs and abstractions consumption nodes ford and fulkerson 1962 a detailed description of typical reservoir system simulation equations can be found in rani and moreira 2009 matrosov et al 2011 mo et al 2013 and seifollahi aghmiuni et al 2016 and examples of reservoir simulation software in coelho and andrade campos 2014 and wurbs 2005 this mathematical description is typically complemented with several hard and soft constraints on individual variables hard constraints are those constraints that cannot be violated under any circumstance and typically represent physical limits such as non negativity of storage and flow variables less commonly used hard constraints include equations to impose conservation of energy and wave travel times soft constraints instead are those constraints that should not be violated but that are not physically impossible to break mayne et al 2000 for example a minimum environmental flow requirement downstream of a reservoir soft constraints may be included in the optimization problem either as additional objectives or as hard constraints treating soft constraints as objectives allows exploring the trade off between breaking the soft constraints and preventing a greater cost elsewhere the downside is the increase in the number of objectives which may increase the difficulty of solving the multi objective optimization problem depending on the case study application a balance can be found between the ease of optimization which would suggest using hard constraints and completeness of information delivered to decision makers which would suggest using objectives some interesting examples of swapping constraints and objectives include sigvaldson 1976 which uses channel capacity as an objective rather than a constraint as most commonly treated and koutsoyiannis and economou 2003 which uses deficit as a constraint rather than an objective 2 2 classification of methods by argument this section presents our classification system of reservoir operation optimization methods which focuses on a higher level understanding of the decision variables to which they are applied the argument of the optimization problem for each method we will review applications in the literature and provide a short description of the most commonly used optimization algorithms with reference for further reading on more mathematical details the classification system is summarised in fig 3 while further details about the adopted terminology are given in fig 4 in appendix a we also provide the detailed equations of the revised methods applied to an illustrative case study the matlab code implementing these methods can be found at https github com barneydobson reservoir operation optimization examples in our classification we distinguish three main types of argument 1 release sequences rs optimization methods optimization aims at finding the sequence of release decisions over a prescribed time period fig 5 a that minimises operational objectives under a given scenario of forcing inputs for example a given time series of reservoir inflows and water demand rs optimization can be used to directly inform operational decisions if the underlying assumption that forcing inputs can be deterministically predicted is valid the larger the deviations from the assumed deterministic scenario the less effective the optimal rs will actually be when applied in reality since forcing inputs are typically very uncertain and the mismatch between predictions and actual trajectories very large optimal rs are rarely implemented in practice more commonly rs optimization is an intermediate step within a more complex optimization process of the other two types below discussed in section 2 2 3 another possible use of rs optimization is in what if studies for example to determine a reference baseline for comparison with other optimization solutions or to assess the upper bound of system performance the maximum that could be achieved with the existing infrastructure under the ideal assumption of perfect foresight of all future inflows for an example see castelletti et al 2012 2 operating policy op optimization methods optimization aims at finding the optimal operating policy i e a function that can be used to determine the release conditional on the state of the reservoir system in the current time step fig 5b in other words optimization returns a strategy the op for making release decisions rather than the release decisions themselves at each time step the optimal op should return the decisions that will perform best over the expected trajectories of forcing inputs that may occur from that time step onwards the assumption here is not that the future forcing inputs trajectory is deterministically known as with rs optimization but only that the trajectories historical or synthetic time series or distributions assumed in the op optimization are representative of actual conditions the state variables that ops depend on typically include reservoir storage and time of year they may also include other variables e g current inflow oliveira and loucks 1997 depending on the characteristics of the study site the reservoir system equations and the chosen optimization method 3 real time optimization rto methods rto uses an optimized rs over a rolling time horizon for which real time forecasts of forcing inputs are available the first release in the rs is implemented and then at the next time step the optimization process is performed again with updated forecasts as displayed in fig 5c rto is ideal if real time computing resources and accurate input forecasts are available for each of the three above cases our classification system fig 3 distinguishes optimization methods based on their key working principles i e essential mathematical properties of the optimization problem formulation for each method the optimization problem can be solved using different algorithms as shown in the last layer of our classification system while there are certainly differences between algorithms under the same method they do not significantly affect the broader type of reservoir system to which the overarching method is applicable with the exception of algorithms for mathematical programming as further discussed in section 2 2 1 therefore in the following sections we will focus on the description of the different methods and only provide references for further details on the specific algorithms these descriptions form the basis for our discussion in section 3 where we will compare the applicability of the various methods to different types of reservoir systems for example presence of multiple reservoirs or multiple objectives linearity or non linearity of the reservoir simulation model etc and give practical guidelines towards selecting an appropriate method for a given system 2 2 1 methods for release sequence rs optimization the first case identified by our classification system is that of release sequence rs optimization see fig 4 for disambiguation of terminology a rs is a sequence of reservoir release decisions over a prescribed time period thus each release in the sequence is a variable in the optimization problem an optimal rs is the release sequence for which an objective is minimized under a given deterministic scenario of the system forcing inputs e g reservoir inflows and demands i e 1 u a r g min u j where u is a matrix containing all releases over the simulation period for all the reservoirs in the system under study i e a rs j is the aggregated objective associated with these releases and u is the optimal rs since the optimization argument is the matrix u the solution space to be explored in the optimization quickly grows with the length of the simulation period and the number of reservoirs the large search space is a characteristic difficultly of rs optimization the three most commonly used methods for rs optimization are summarized below mathematical programming we classify as mathematical programming any method that exploits the mathematical properties of the optimization problem for example linearity and convexity of the constraints and objective to efficiently find an optimal rs as such mathematical programming is most effective where speed is important and simplifications to fit the required assumptions e g linearizing non linear components are acceptable mathematical programming employs a broad range of algorithms distinguishable primarily by the level of non linearity allowed in the objective and constraint definitions linear and quadratic programming algorithms lp qp require that all constraints be described by linear equations and that the objectives be either linear lp e g applied to rs optimization by hiew et al 1989 and terlaky 2013 or quadratic qp e g mariño and loaiciga 1985 while these assumptions are strong the advantage of lp and qp is that they can quickly find global optima even for large rs optimization problems however as the linearity assumptions become less acceptable and non linear equations are needed for a more realistic representation of the reservoir system non linear programming nlp is required sequential linear programming e g martin 1983 grygier and stedinger 1985 and sequential quadratic programming e g boggs and tolle 1995 have been most commonly applied to rs optimization however other nlp algorithms exist and continue to be developed see for example bazaraa et al 2013 for a recent collection of available algorithms the disadvantage of nlp algorithms is that they cannot guarantee reaching a globally optimal solution in usable computation time for many problems bazaraa et al 2013 value function estimation this method exploits the dynamic nature of the optimization problem by breaking it into a sequence of easier to solve sub problems each relevant to one time step in the simulation period the key idea is to define a value function that for each time step represents the cost it takes to transition from the state at that time step t to the state at the final time step of the simulation period t if only optimal decisions are made i e via the optimal rs from t to t hall and buras 1961 the value function can be derived by solving the recursive bellman equation of dynamic programming bellman 1956 which has been extensively used for reservoir operation optimization for a long time the first review of its application dating back to yakowitz 1982 there are two primary strengths to the value function estimation method firstly it does not impose any limitation on the level of non linearity of the objective or constraints secondly the solution time only increases linearly with the length t of the simulation period in contrast to the other rs optimization methods which increase polynomially or worse so that it can be applied to find optimal rs that are very long the drawback is that since at each time step the numerical resolution of the bellman equation requires the evaluation of all possible combinations of state variables e g storages and decision variables e g releases the solution time scales exponentially with the number of states and decisions this problem was named by bellman as the curse of dimensionality bellman 1956 and it severely limits the applicability of this method to large reservoir systems a second drawback is that since the value function is only defined at discrete points interpolation between point evaluations is required the first weakness compounds the second the curse of dimensionality pushes towards using a coarser resolution and this makes the interpolation less accurate several variants of the discrete dp algorithm have been proposed to mitigate the problem in the context of reservoir operation optimization for example incremental dynamic programming hall et al 1967 and dynamic programming successive approximation shim et al 2002 however none of these have established as standard practice another very important limitation of the value function estimation method which no technical advances will overcome is that the very definition of a value function requires a time separable objective as discussed in section 2 1 making the method incompatible with common performance metrics such as resilience metrics hashimoto et al 1982 heuristic optimization this term covers a wide range of algorithms that can use very different working principles but have as a common trait the fact that they attempt to find an approximate solution to a problem in our case highly non linear and or with large number of reservoirs for which classic methods mathematical programming and value function estimation in our case are not applicable given such variety of heuristic optimization algorithms we do not discuss the entire spectrum of options but highlight that the two most common methods currently in use for rs optimization are genetic algorithms ga wardlaw and sharif 1999 hınçal et al 2010 and particle swarm optimization pso kumar and reddy 2007 noory et al 2012 however numerous other algorithms have been tried in the context of rs optimization such as honey bees mating haddad et al 2006 ant colony optimization kumar and reddy 2006 simulated annealing georgiou et al 2006 and many more garousi nejad et al 2016 to the best of the authors knowledge heuristic optimization was first applied to the rs optimization problem by wardlaw and sharif 1999 given that no single algorithm dominates in all cases newer algorithms use a combination of optimization search strategies blended from different algorithms reed et al 2013 which are selected in an adaptive manner throughout the optimization process an example that appears to be very successful is the borg algorithm hadka and reed 2013 the advantage of heuristic optimization is that it can be equally applied to linear or non linear constraints and objectives as well as to either time separable or non separable objectives hence it can be applied to problems where complex decisions are investigated for example planning drought revenue loss insurance as in herman et al 2014 since heuristic optimization covers a large variety of algorithms it is difficult to make generic statements about its weaknesses which may vary from one algorithm to another however one general comment is that as the size of the rs increases either due to many decisions per time step or a long simulation period or both the solution time can become prohibitively long 2 2 2 methods for operating policy op optimization an operating policy op is a function that takes the current state of the system and returns a release decision or set of release decisions to be implemented in the current time step at a minimum the system state vector i e the independent variable of the op should include the reservoir storages at the current time step in a more sophisticated op it may also include additional information such as time of year useful for reservoir systems with strong seasonal behaviour reservoir inflows at the current or previous time step tejada guibert et al 1995 or other information like flows at upstream locations in the reservoir network giuliani et al 2015a in the following we denote an op as 2 u t m θ x t where u t is the vector of all release decisions to be made at time t x t is the vector of relevant state variables such as storages reservoir inflows etc at time t and θ is a set of parameters to be determined as part of the op optimization task the op optimization problem can be described by 3 m a r g min m j we classify op optimization methods into three categories below release sequence based rsb the first step for these methods is to solve a rs optimization problem and thus obtain an optimal rs u and associated optimal states x the op the function m and its parameters θ in eq 2 is then derived as the result of a regression between the time series of state variables x and the optimal rs u in other words the op is a generalization of the optimal rs it originates from it follows that a better op is obtained when the optimal states x cover the state space as widely as possible this in turn is more likely to be achieved if the rs is optimized over a long simulation period resultantly in most cases heuristic optimization will not be applicable for the rs optimization step while either mathematical programming or value function estimation will need to be employed hence imposing constraints on the objective formulation and model structure as discussed in section 2 2 1 as for the second step many sophisticated regression techniques have been demonstrated most commonly artificial neural networks fuzzy logic and decision trees celeste and billib 2009 celeste et al 2009 kumar et al 2012 zhou et al 2015 since each regression algorithm has different benefits and drawbacks discussed in referenced papers it is unlikely that a single algorithm is preferable for all possible reservoir systems labadie 2004 a limitation of the rsb method is that it provides an op that is only optimal to the accuracy of the regression i e it is actually sub optimal even under the deterministic scenario used in the rs optimization step furthermore and possibly more importantly the very rsb optimization problem is somehow ill posed in fact the ultimate goal of reservoir optimization is to find the op that minimizes the management objective and not the distance from an optimal trajectory x that most likely will never occur because it is based on a deterministic scenario of uncertain input forcing directly minimizing the objective function is precisely the key idea of the dps method described in the next section the rsb method thus appears to be an unnecessarily indirect way to achieve in a sub optimal way what dps can achieve more directly direct policy search dps these methods aim to directly derive the op by directly finding the parameterization θ of a pre selected function m that minimizes the objective under a deterministic time series of forcing inputs in a special case of eq 3 4 θ a r g min θ j the dps approach can be linked back to early works by maass et al 1962 and revelle et al 1969 on the linear decision rule ldr in fact the op of a single purpose single reservoir and single demand node reservoir system can be expressed by the ldr 5 m s t θ t where θt is the ldr parameter essentially the target storage for time step t to be optimized if the objective and all constraints are linear then the optimization problem can be formulated as a linear program and the set of optimal parameters one per time step obtained by mp the ldr approach can be expanded to include a non linear op i e a non linear version of eq 5 by using first order taylor series approximation of non linear objectives shih and revelle 1994 1995 pan et al 2015 heuristic optimization algorithms can be used to extend the applicability of dps to non linear objectives and constraints as well as any function form for the op beyond the linear case all the heuristic optimization algorithms described previously section 2 2 1 are in principle suitable to solve eq 4 indeed both ga oliveira and loucks 1997 koutsoyiannis and economou 2003 ahmed and sarma 2005 chang et al 2005 momtahen and dariane 2007 li et al 2014 and pso ostadrahimi et al 2011 have been tested for this purpose the additional benefits of heuristic optimization algorithms such as no limits on using time non separable objectives giuliani et al 2014 spontaneous multi objective formulation and scalability to many objective problems will be further discussed in section 3 2 as for the choice of the op form many options beyond the simple linear curve in eq 5 have been proposed the op may be represented by for example a piecewise linear function oliveira and loucks 1997 as depicted in fig 5b given that non linear and piecewise constraints are handled by heuristic optimization algorithms it is possible to introduce variable policy structures within the same reservoir system for example to operate some reservoirs based on their inflows and some others based on their storage levels ashbolt et al 2016 universal approximating functions can also be used for example artificial neural networks ann pianosi et al 2011 or radial basis functions rbf which according to giuliani et al 2015b can outperform anns in many different aspects in all these cases the parameter vector θ contains the weights and biases of the ann or rbf the advantage of such universal approximating functions is that they do not a priori constrain the op to any specific structure and that they scale efficiently with the number of input arguments of the approximating function barron 1993 i e in our case the number of independent variables of the op the drawback is that the resulting op is a black box that is difficult to interpret and therefore possibly more difficult to communicate to decision makers a possible solution to this problem is to optimize the rule curves for definition see op disambiguation in fig 4 in use by the current operators as done for example by chang et al 2005 and zhou and guo 2013 however rule curves have a lack of flexibility that will significantly degrade their performance even when their parameters have been optimised they are also typically expressed in the form of target reservoir storages and hence they do not provide explicit recommendation on water release abstraction decisions an alternative is to create ops that have highly flexible structures but are easy to visualize such as in the form of a decision tree herman and giuliani 2018 expected value function estimation the expected value function estimation method extends the value function estimation approach discussed for rs optimization to the case of op optimization i e optimization under uncertain forcing inputs typically forcing inputs are regarded as stochastic variables described by probability distributions and the op is obtained by the minimization of the expected value of the value function the solution algorithm called stochastic dynamic programming sdp follows similar steps as the discrete dp algorithm but with one more layer of discretization for the forcing input variables the value function is thus evaluated against all possible combinations of the forcing inputs and the sample mean is used to approximates its expected value for each discretised state another possible approach although much less common is to describe forcing inputs by membership sets rather than probability distributions and search for the op that minimizes the maximum possible value function nardini et al 1992 the sdp algorithm has been widely used for reservoir operation for reviews see yakowitz 1982 nandalal and bogardi 2007 however its applicability is subject to the same limitations as deterministic dp i e the need for time separable objectives limited scalability to multi objective problems and the curse of dimensionality as discussed in section 2 2 1 the latter problem is even more severe here given that each state decision combination must be evaluated against each combination of forcing input variables to partially mitigate the computing burden several variants of the sdp algorithm have been proposed including the neuro dynamic programming ndp algorithm castelletti et al 2007 which uses a neural network to interpolate the value function evaluations allowing for a coarser state discretization grid another limitation of the sdp approach is that each forcing input must be characterized by an independent probability density function which might be an overly simplistic approach for input processes e g inflows which typically exhibit complex temporal and spatial structures carrillo et al 2011 on the other hand including temporal and spatial correlations among probability distributions would increase the number of variables required for discretization up to a point that the problem becomes computationally intractable an sdp variant that aims at overcoming the issue is sampling sdp ssdp which uses a large number of sample inflow sequences in place of inflow probability distributions see kelman et al 1990 for one of the earlier works on this and stedinger et al 2013 for a more recent review more recently reinforcement learning rl algorithms have been demonstrated as viable options for approximating expected value functions using time series of inflows rather than distributions e g castelletti et al 2010 2013 dariane and moradi 2016 2 2 3 real time optimization rto when forcing inputs of the reservoir system are uncertain but a forecasting system is in place real time optimization rto is an interesting alternative to the op approach differently from op optimization where the optimization task is concentrated in one effort in rto the optimization is repeated each time an operational decision needs to be taken this allows for exploiting forecasts for example inflow or demand forecasts that are available from a continuously updated forecasting system the optimization problem is typically formulated as an rs optimization with forcing inputs set equal to their deterministic forecasts and initial system state reflecting the current system conditions long term costs beyond the forecast horizon are accounted for by including a term that penalizes unfavourable final states into the objective function for example for a supply reservoir the penalisation function would help finding a balance between maximising supply reliability over the forecast period and not leaving the storage depleted at the end of the period the rto problem is hence formulated as 6 u arg min u j t t h 1 p x t h where p represents the penalisation function h is the length of the forecast period u is the rs over the period t t h 1 j t t h 1 is the cost associated with implementing u over this forecasted period and x t h represents the system state at the end of the forecasted period the rto problem in eq 6 can be solved by any of the rs optimization methods discussed in section 2 2 1 provided they can accommodate any non linearity associated with the penalization function although the optimal rs obtained through eq 6 provides release decisions over the entire forecast period only a small portion of the sequence will actually be implemented this may only be the releases for the current time step or it may be the releases until a new forecast becomes available when new forecasts become available the optimization process is performed again with updated forecasts and initial states fig 5c hence despite the mathematical formulation and the optimisation argument in eq 6 are the same as in rs optimisation the practical output of rto is different only the decision s to be made in the current time step or until the next forecast becomes available instead of the entire sequence of decisions a key issue in the application of rto is the adequate definition of the penalisation function different approaches have been demonstrated from using deviations from seasonal target storages as given for example by the reservoir s filling curves e g ficchì et al 2015 to linking the penalization function to the solution of an optimization problem where off line forecasts e g seasonal distributions are used in place of posterior real time forecasts e g galelli et al 2014 in principal any of the op optimization algorithms introduced in section 2 2 2 could be used to derive penalisation function the expected value function has been demonstrated to be suitable in pianosi and soncini sessa 2009 however as discussed expected value function optimization is not applicable to systems that contain many reservoirs or require many decisions to be made each time step as the deviations from the assumed deterministic forecast increase the rto release becomes less effective when applied in reality therefore the benefits of using rto are highly dependent on the quality of the real time forecasts if these forecasts are not significantly better than off line forecasts e g seasonal distributions then using an op will be equivalent to rto but at lower implementation costs as the optimization effort of an op is done once and for all before the operation starts this is the primary reason why rto has only recently received significant attention as a result of increasingly accurate forecasting systems anghileri et al 2016 a proven way to increase rto performance in the presence of inaccurate forecasts is by explicitly taking into account forecast uncertainty in the optimization problem this has been mainly implemented using two approaches the first is to explicitly characterise forecast s uncertainty by probability distributions and solve the resulting stochastic optimization problem by expected value function estimation which means the rto problem is mathematically reformulated as an op optimisation problem instead of an rs optimisation problem as in eq 6 the initial illustration of the idea although with an extremely simplified flow forecasting approach dates back to bras et al 1983 and more recent applications include pianosi and soncini sessa 2009 and zhao et al 2011 the second is to optimize an rs against an ensemble of inflow forecasts as done for instance by zhao et al 2011 raso et al 2014 and ficchì et al 2015 interestingly all these authors have found that including forecast uncertainty consistently outperforms any single deterministic worst case or most likely forecast rto approach finally an interesting question for rto is the impact of the forecast horizon length or lead time on rto performance for example zhao et al 2012 investigated how forecast horizon length and forecast uncertainty trade off against each other aiming to find the effective forecast horizon for which the forecast provides the most valuable information for decision making if the forecast horizon is short the optimized decision is highly sensitive to the horizon length as the horizon length increases the decision becomes increasingly sensitive to forecast uncertainty interestingly in zhao et al 2012 the inclusion of ensemble forecasts improved performance but had no effect on determining the effective forecast horizon seasonal forecasts between a month and a year with some skill are becoming widely available for water resources operators although the value of seasonal forecasts to improve operation by rto has proved limited thus far celeste et al 2008 anghileri et al 2016 we would expect this to become an increasingly active area of research as the skill of these forecasts improves or perhaps as characterization of their uncertainties becomes more accurate 3 comparison and choice of reservoir optimization methods in the previous sections we have briefly reviewed operation optimization methods individually in this section we will discuss some concepts and properties that are relevant across methods and can be useful for the comparison and choice of the most adequate method for the problem at hand we start by discussing how operating policy op optimization methods could be further classified based on the approach they use to handle uncertainty in forcing inputs typically reservoir inflows but possibly also other input variables parameters like water demand or energy price i e implicit or explicit such distinction is useful both in mathematical and in practical terms following this discussion we debate the concept of optimality within a practice oriented research field such as reservoir operation optimization and compare the extent to which different methods can be regarded as optimal given the uncertainties that the reservoir modelling and optimization process is subject to finally we compare the ability of different methods to scale from single objective to multi objective problems which as anticipated in section 2 1 is a very important feature in the context of reservoir operation optimization these topics and the advantages and disadvantages anticipated in sections 2 2 are then brought together into a set of practical guidelines towards appropriate method selection 3 1 implicit versus explicit treatment of forcing inputs variability in the context of op optimization a typical distinction is made between two classes of optimization methods based on the way they handle the variability in forcing inputs the distinction is used for example in the review by labadie 2004 these two classes are implicit stochastic optimization and explicit stochastic optimization implicit stochastic optimization accounts for variability in forcing inputs implicitly by using a long and diverse realisation typically a time series of historical observations or a synthetic time series generated by a statistical model explicit stochastic optimisation instead directly uses the statistical model within the optimisation process by this distinction release sequence based rsb optimization and direct policy search dps both belong to the implicit stochastic optimization class although at the time of labadie 2004 review dps was not a common approach and so implicit stochastic optimization was used almost as a synonym of rsb optimization while the expected value function approach is an example of explicit stochastic optimisation authors who have adopted the implicit explicit divide seem to suggest that an explicitly approach is preferable because it is more rigorous however it should be noted that forcing input probability distributions are also subject to simplifying assumptions such as simplification or omission of spatial and temporal correlations furthermore probability distributions are estimated from historical data and therefore can also be affected by scarcity or poor quality of the data koutsoyiannis 2000 chatfield 2013 so in our opinion the preference for explicit characterisation of uncertainty is often not strongly motivated except for the simplest case of a single input reservoir system where a complete characterization of inflow uncertainty by probability distribution is often possible more generally we would argue that classifying op optimization algorithms based on the implicit explicit divide is mathematically elegant but much less salient from a user s perspective 3 2 scaling methods to multi objective optimization as anticipated in section 2 1 reservoir operation is typically a multi objective optimization problem as different objectives need to be achieved simultaneously multi objective optimization problems can be approached through two distinct methods a priori and a posteriori methods cohon and marks 1975 a priori methods rely on a prior weighting of the objectives in a way that tries to capture the decision maker s preferences as a result of this weighting a single aggregated objective function is obtained and the problem is traced back to a single objective optimisation a posteriori methods instead preserve the multi objective nature of the problem and aim at creating a set of pareto optimal solutions each realising a different trade off between the multiple objectives there are two ways to create a set of pareto optimal solutions one approach is to repeatedly solve a single objective optimization problem with different aggregation weights of the multiple objectives the main drawback of this approach is that the number of optimizations required to approximate the pareto front the representation of optimal tradeoff solutions in the objective space at given resolution increases factorially with the number of objectives reed and kollat 2013 the other approach is to obtain a complete set of pareto optimal solutions in a single optimization run using population based optimization techniques which scale far more effectively with the number of objectives in the context of the reservoir operation optimization methods presented so far we note that the algorithms for mathematical programming and value function estimation and by extension for expected value see fig 3 are inherently single objective a priori techniques are therefore the only available way to handle multi objective problems if these approaches are used on the contrary most heuristic optimization ho algorithms and in particular population based algorithms such as ga and pso can equally handle single or multi objective optimization problems and therefore provide an entire set of pareto solutions in a single optimization run in the multi objective case sharif and wardlaw 2000 they thus constitute an a posteriori approach and make heuristic optimization whether it is used to directly obtain a rs or within dps particularly efficient when the number of objectives is large reed et al 2013 a review and comparison of many state of art population based approaches for mo optimization for dps is provided by salazar et al 2016 finally one exception to the distinction delineated above is the reinforcement learning rl algorithm introduced by castelletti et al 2013 which is the first and to the authors knowledge only a posteriori algorithm for multi objective expected value function optimization this method is also applied and compared with dps in dariane and moradi 2016 where it is found that dps outperforms rl although it is not possible to conclude whether the result would hold in a water system of lower dimensionality in which the limitations of expected value function optimization are less prohibitive 3 3 optimality and modelling assumptions the optimization algorithms reviewed in the previous sections provide different degrees of confidence with regard to the optimality or sub optimality of their solutions for example a correctly executed mathematical programming algorithm provides an optimal solution of the optimization problem value function approaches provide approximately optimal solutions i e accurate to the resolution of the interpolation while heuristic optimization algorithms give no guarantee of optimality and simply return the best solution that could be found in a given number of iterations however it is important to highlight that such optimality statements are only valid within the given problem formulation if the problem formulation is not correct i e the underlying assumptions for example linear reservoir equations or a single time separable objective provide an oversimplified representation of the system behaviour then the optimal solution will perform sub optimally when applied in the real world this is an important factor to be considered when selecting an optimization method as we will further discuss in the following section 3 4 practical guidelines towards selecting reservoir operation optimization methods the literature review presented in the previous sections was aimed to provide practical information about the advantages and limitations of reservoir operation optimization methods another contribution of this review is to identify a set of guidelines for the selection of the most appropriate optimization method for a given reservoir system our advice is summarised in the comparison table presented in fig 6 the table can be used to narrow down the number of suitable methods horizontal axis for a reservoir system of given characteristics vertical axis for release sequence rs optimization the choice is least obvious and highly dependent on the system characteristics the greatest advantage of mathematical programming is its speed scalability and the guarantee of analytical optimality albeit under the caveat that the problem must be simplified to fit the required assumptions on objectives and constraints value function estimation can solve non linear and thus more realistic optimization problems over long time periods of the order of t 10 000 time steps e g decades if the time step is daily or centuries if it is weekly but is limited to small reservoir networks up to 3 4 reservoirs at current computing power and the solution s optimality is subject to the interpolation accuracy of the value function heuristic optimization is a more flexible method that can handle multiple objectives efficiently and allows for time non separable objectives but it is limited to short lengths of the simulation optimization period for operating policy op optimization we suggest that direct policy search dps is the most widely applicable method and indeed in recent years it has been the most commonly applied method even if it cannot provide any assessment of the optimality or accuracy of the solution still we do not think this is a major issue for practical purposes given the difficulty in evaluating whether simplifying assumptions required by other methods are satisfied for the problem at hand and to what extent similarly expected value function estimation may still be preferred in those situations where it is computationally feasible i e relatively small reservoir networks and when one can reasonably presume that its underlying assumptions in particular time separability of the objectives are acceptable for real time optimization no specific method has been clearly established yet although value function approaches have possibly been employed more frequently in the literature but we would expect that more research will be carried out in this context given the increasing availability and advances in real time monitoring and forecasting systems 4 conclusions in this paper we have reviewed the ever growing body of literature in the field of reservoir operation optimization based on a novel classification system that uses the argument of the optimization problem as the main criterion to classify methods our classification system shows that while the use of different arguments leads to substantially different problem formulations and types of solution an optimal release sequence versus an optimal operating policy the algorithms used for solving the optimization problem are to some extent interchangeable we hope this way of introducing the literature enables to shift the focus from the mathematical properties of solution algorithms which we expect to be less accessible to users to the more obvious and tangible properties of the reservoir operation problem we also provided a comparison between different types of optimization algorithms and some guidance as to what types of system they are more likely to be applicable to ultimately we hope this paper will contribute to further improve the accessibility of this literature to a wider audience acknowledgements b dobson is funded as part of the wise cdt under a grant from the engineering and physical sciences research council epsrc grant number ep l016214 1 f pianosi is partially funded by an epsrc living with environmental uncertainty fellowship grant number ep r007330 1 partial support for t wagener was provided by a royal society wolfson research merit award supplementary materials supplementary material associated with this article can be found in the online version at doi 10 1016 j advwatres 2019 04 012 appendix b supplementary materials image application 1 appendix a in this appendix we present a simple example of a reservoir operation optimization problem that we use to describe the mathematical formulation of the different optimization methods reviewed in the paper we note that we use a highly simplified simulation model which omits several processes e g evaporation that would need to be represented in a real world application in order to allow the reader to focus on the specifics of the optimization problem formulation we also provide the matlab code to implement some of these methods at the link https github com barneydobson reservoir operation optimization examples the system is a single reservoir single release single point of demand system pictured fig a1 and characterised by the following variables and constant parameters st reservoir storage at time t scap reservoir capacity constant it reservoir inflow at time t ut release from the reservoir to the point of demand at time t d volume of water demanded assumed constant wt reservoir spill at time t the objective of the system operation is to minimize the squared deficits i e the squared differences between the release and the demand d ut 2 at each time t we will assume a simulation period of length t and that the system operator is interested in the cumulate squared deficits over this period a1 j t 1 t d u t 2 release sequence rs optimization the form of rs optimization will be a2 min u 1 u 2 ut t 1 t d u t 2 subject to the constraints a3 s t 1 s t i t u t w t for t 1 t w t max 0 s t 1 s c a p for t 1 t u t 0 u t d t u t s t i t for t 1 t s 1 l 1 l 2 l t d s cap given both heuristic optimization and mathematical programming directly solve eq a2 because linear programming requires a linear objective it is not suitable to make it suitable the objective in a1 would not be squared because quadratic programming requires linear constraints and the spill in a3 contains max it cannot be directly applied to the problem of a2 a3 instead spills can be treated as decision variables to make quadratic programming applicable which we demonstrate in the example code nonlinear programming and heuristic optimization are both straightforward to apply to the problem value function estimation requires a different approach where each element of the release sequence is obtained by minimizing the so called value function vt at the relevant time step a4 u t arg min u t d u t 2 v t 1 s t i subject to the constraints in a3 relevant to time t the value function gives the minimum cost associated at each storage state st i e the total cost that would be encountered if starting from that storage value at time t only optimal decisions were made until the end of the optimisation period a5 v t s t k t t g k w h e r e g k min u k d u k 2 by definition the value function satisfies the recursive equation also called bellman equation bellman 1956 a6 v t s t min u t d u t 2 v t 1 s t 1 the value function estimation algorithm hence exploits such recursive equation it starts by finding the value function at the end of the period t t since no further costs are defined beyond the end of the period i e vt 1 st 1 0 for any possible storage value st 1 the value function for the final storage vt st can be obtained by simply minimising the step costs gt of the final transition from t 1 to t because the storage state at the final time step st is not known as it is dependent on previous decisions the minimisation is repeatedly solved at several discrete storage values the value function will thus be defined for any final storage value within the accuracy of an interpolation between the evaluated discrete values once the value function for the final time step vt st has been defined the value function of the previous time step vt 1 st 1 can be derived by applying eq a3 at discretised values of the state st 1 the process is iterated backwards in time across the entire simulation period until the value function is defined for every time step operating policy op optimization for op optimization we define an operating policy that determines the release depending on a subset of the system state variables for example a simple op could be one that makes the release depend linearly on the current storage and inflow of the previous time step a7 u t m θ i t 1 s t θ 1 θ 2 i t 1 θ 3 s t if an optimal rs is available for example after solving problem a2 then the policy parameters can be estimated by least squares minimization of the difference between the optimal release sequence u and the outputs of the op a8 min θ 1 t t 1 t m θ i t 1 s t u t 2 where i and s are the inflows and storages associated with the optimal release sequence u also obtained when solving a2 such an approach is what we called release sequence based rsb optimisation in contrast the direct policy search dps formulation will take the following form a9 min θ 1 t t 1 t m θ i t 1 s t d 2 subject to the constraints in a2 as with rs optimization whether mathematical programming or heuristic optimization is used to perform the minimization in a9 the form of the optimization problem does not change as with value function estimation for rs optimization expected value function optimization requires first deriving value functions by exploiting the bellman equation and then defining the implicit operating policy as a10 v t s t min u t e i t d u t 2 v t 1 s t 1 where e represents the expected value operator calculated over the probability distribution of inflows thus an individual release is given by a11 u t arg min u t e i t d u t 2 v t 1 s t 1 
656,multicomponent reactive transport modeling of effluent chemistry using locally obtained mineral dissolution rates of forsterite and pyrrhotite from a mine tailings deposit rodrigo f embile jr a b ingar f walder a b john j mahoney c a new mexico institute of mining and technology 801 leroy pl socorro new mexico usa 87801 new mexico institute of mining and technology 801 leroy pl socorro new mexico 87801 usa b kjeøy research and education center vestbygd norway 8412 kjeøy research and education center vestbygd 8412 norway c mahoney geochemical consulting llc 892 s newcombe way lakewood colorado usa 80226 mahoney geochemical consulting llc 892 s newcombe way lakewood colorado 80226 usa corresponding author at kjeøy research and education center vestbygd norway 8412 kjeøy research and education center vestbygd 8412 norway multicomponent reactive transport modeling using phreeqc of a ni sulfide tailings deposit was undertaken to assess how effective locally obtained mineral dissolution rates in simulating long term kinetic testing results of the tailings material forsterite and pyrrhotite were used as proxies for the chemical reactions occuring within the tailings the dissolution rates of forsterite and pyrrhotite were obtained based on the actual kinetic testing data and phreeqc inverse modeling bet brunauer emmet teller and geometric surface area derived rates were used in the kinetic test data simulation and long term prediction for 100 years results indicate that the geochemical models for both the bet and geometric surface area derived rates are generally consistent with the actual ph mg so 4 and ni of the kinetic testing data long term prediction of effluent chemistry suggests that ph will continue to increase until a stable ph of 8 is achieved while the predicted mg so 4 and ni concentrations will be stable and will be close to the concentrations observed towards the end of the kinetic test this method of using locally obtained mineral dissolution rates in multicomponent reactive transport modeling of a kinetic test data has proven to be reliable as compared to using literature dissolution rate values this method can then be used for a quick and cost effective way for future effluent chemistry prediction rather than conducting long and expensive kinetic tests keywords multicomponent reactive transport phreeqc kinetic test prediction 1 introduction effluent produced from long term kinetic testing provides a good picture of the reactions occurring within a material of interest the use of kinetic testing as a major tool in acid neutral rock drainage prediction and testing has been proven by many studies stromberg and banwart 1999 bowell et al 2006 eary and williamson 2006 lapakko 1988 morin et al 1995 as a follow up or conjunction with static testing cen 292 2009 however the issue of scaling kinetic testing results to actual field conditions often limits the effective use of this method furthermore kinetic testing can take a long time and cost may be stretched higher than planned depending if the original purpose has already been achieved or not although there are some prescribed ideal durations of a kinetic test this is often subject to change depending on purpose cen 16363 2012 it is therefore important to be able to predict long term effluent chemistry from a mine wastes for example using geochemical reactive transport modeling approaches in the mining industry reactive transport modeling plays an important role in modeling metal and other contaminant transport in tailings jaynes et al 1984 salmon and malmstrom 2004 and waste rocks eary and williamson 2006 the use of reactive transport modeling in conjunction with detailed geochemical and mineralogical data to simulate effluent chemistry from kinetic testing or column leach studies has been conducted by several studies including appelo and postma 1999 guha et al 2001 jurjovec et al 2004 eary and williamson 2006 lipson et al 2007 bea et al 2012 and chang et al 2012 simunika et al 2013 and motalbi et al 2014 with notable success reactive transport modeling using phreeqc provides an efficient method for simulating simple advective reactive transport as a solution flows through a column parkhurst and appelo 1999 modeling can be done in one dimension wherein a column or block is discretized into smaller nodal blocks termed as cells with similar pore volumes parkhurst and appelo 1999 bethke and brady 2000 which are also defined by their lengths parkhurst and appelo 1999 initial conditions include an unreacted fluid entering the column parkhurst and appelo 1999 bethke and brady 2000 and the solution that is initially present in the column the duration of reactions on each node is dictated by the time step parkhurst and appelo 1999 at which the fluid passes through each cell for every shift kinetic reactions are integrated for each cell while maintaining equilibrium with any gas or mineral phase present in each cell parkhurst and appelo 1999 dividing the cell length by the time step gives the fluid velocity parkhurst and appelo 1999 for each time step several equations are evaluated including equilibrium equations transport equations sorption models and surface complexations bethke and brady 2000 for most models the inclusion of kinetics and rate expressions makes a model more robust and allows phreeqc to better simulate kinetic reactions there are different methods to obtain the specific rate and constants of a mineral reaction delany et al 1986 aagaard and hegelson 1982 cappellen and wang 1996 these rates are typically conducted using monomineralic materials and may not reflect actual field conditions of a specific study area according to salmon and malmstrom 2004 the use of mineral dissolution rates from monomineralic samples to model dissolution rates in the field may limit the ability to predict actual weathering rates this is primarily because pure mineral phase experiments use fresh particles rather than weathered samples the need for a widely used reaction rate constants and variables to be used for geochemical modeling led palandri and kharaka 2004 to publish a list of these constants and variables based on a pool of values from different experimental studies however these rates are often larger by at least an order of magnitude than those observed in the field brantley and white 2003 where heterogeneous material such as mine tailings exist so far there has been no known study utilizing locally obtained mineral dissolution rates from a tailings deposit to simulate and predict future effluent chemistry using a multicomponent reactive transport modeling approach for this study fast reacting minerals forsterite and pyrrhotite were used as proxies for the temporal evolution of effluent chemistry produced from kinetic testing more information about the obtained forsterite and pyrrhotite dissolution rates can be found in embile et al 2018 2 methodology 2 1 tailings sample and characterization tailings sample from four locations in a ni sulfide mine tailings deposit located in a fjord in north norway were obtained and subjected to kinetic testing details about the tailings sample collection characterization and kinetic testing experiments can be found in embile et al 2018 the bulk mineralogy of the tailings from each column are presented in table 1 2 2 kinetic test data and assumptions one of the major assumptions in this study is that forsterite and pyrrhotite dissolution controls the resulting effluent chemistry in this regard mg and so 4 in the effluent is strongly correlated to the dissolution of these minerals respectively this is based from the fact that the reaction rates of these minerals are several orders of magnitude higher than the other silicates and sulfides present in the tailings embile et al 2018 furthermore forsterite constitute at least half of the tailings bulk mineralogy during simulation dissolution reactions of the other silicate minerals enstatite tremolite clinochlore clay were therefore assumed to be unimportant compared to that of forsterite based on the observed reaction rate similarly pyrrhotite is the main sulfide mineral in the tailings embile et al 2018 kinetic testing data for 70 weeks from four kinetic test columns were used as input parameters while the fifth week effluent chemistries from each column were used as initial column compositions this is based on the assumption that during the first four weeks secondary minerals formed prior to sample collection are dissolving and are thus excluded from the modeling a summary of the initial input chemistry is presented in table 2 alkalinity is generally zero for the columns based on the kinetic testing results except for ra 01 where a value of 1 mg l caco 3 was assigned due to reported alkalinity values in the beginning of the kinetic test solution speciation using phreeqc was also conducted for each weekly data to obtain an idea of any potential saturated mineral phases 2 3 conceptual model and parameters used 2 3 1 chemical parameters phreeqc generally evaluates transport of solution and components in a saturated medium by moving a solution through each cell in the following sequence advection dispersion kinetic reactions and equilibrium calculations parkhurst and appelo 1999 however one can also simulate an undersaturated system by assuming equilibrium with oxygen from the atmosphere when the flow velocity is known the use of mass balance and mass action equations allows the calculation of dissolved ions and complexes as well as dissolution and precipitation of mineral phases brown et al 1998 parkhurst and appelo 1999 surface complexation mechanisms in phreeqc are modeled using the diffuse double layer model dzombak and morel 1990 on hydrous ferric oxide hfo or ferrihydrite parkhurst and appelo 1999 this can be established using literature values of common fe oxyhydroxide surface sites the chemical composition of forsterite and pyrrhotite was defined using the keyword phases dissolution rate constants logk for forsterite and pyrrhotite were based on the lawrence livermore national laboratory llnl database mass transfer mechanisms such as adsorption and exchange were simulated in phreeqc using the surface and exchange keywords surface adsorption to fe oxides in the form of ferrihydrite was used exchange was modeled to simulate possible exchange between cations in the tailings the value of 0 1 was assumed based on the cation exchange capacity of a soil material that is in the range of 1 10 meq 100 g white and nairn 2007 ferrihydrite was set to equilibrate with the initial solution to take into account its formation and role as a potential sink to metals the simulated flow path was assumed to be unsaturated with respect to water by allowing o 2 and co 2 gas exchange since an open system was simulated the mass of iron hydroxide was calculated using data from sequential extraction on the bulk tailings sample embile et al 2018 loss of solution due to pore water retention and weekly evaporation was modeled using the keyword reaction at each shift 0 28 mol of water 5 gs is removed to maintain an average recovered effluent volume of 950 ml 2 3 2 physical and hydrologic parameters to represent the columns a single cell was used which equates to a total cell height of 0 12 m a time step of 604 800 s 1 week with sixty five shifts was used resulting to a total simulation time of sixty five weeks this is equivalent to the duration of the kinetic test minus the five weeks of data that was not used phreeqc requires input of reacting minerals in units of moles parkhurst and appelo 1999 initial moles of forsterite and pyrrhotite was calculated based on the volume percent of each mineral in the bulk tailings the formula presented by eary and williamson 2006 and simunika et al 2013 was used to calculate initial moles of the reactants eq 1 1 initial moles mineral f mineral 1 θ θ ρ solids ρ water 1000 g water k g water 1 m mineral where fmineral is the fractional content of the mineral in the bulk tailings sample θ is the fluid filled porosity of the tailings ρsolids is the density of the mineral ρwater is the density of the water and mmineral is the molar mass of the mineral a bulk density of 2 6 g cm 3 which is equivalent to the solid portion of a bulk rock was assumed the 1000 g water is a conversion factor eary and williamson 2006 to obtain the surface area per volume of sample sa v that will be used as phreeqc input parameter bet and geometric surface areas were used which were determined using the following formulas 2 a b e t s p m 2 g 1 a b e t x i 3 a g e o s p m 2 g 1 a g e o x i a where a b e t s p is the bet specific surface area of the bulk tailings a g e o s p is the cumulative geometric specific surface area xi is the volumetric fraction of forsterite or pyrrhotite and γ is the roughness factor the cumulative surface area was based on the contribution of each particle size present in the tailings a roughness factor of 100 was used to represent the most conservative number of the range suggested by anbeek 1992 using the specific surface areas the actual surface area to volume of forsterite and pyrrhotite can be obtained using the following equations 4 surface area m 2 d m 3 a b e t s p m i m i 5 surface area m 2 d m 3 a g e o s p m i m i where mi and mi are the molar mass g mol and total moles moles of forsterite and pyrrhotite in the tailings respectively average porosity and bulk density of the tailings was determined to be 0 20 and 1 25 g cm 3 the average flow rate in the four columns during rinsing is 6x10 4 ms 1 since the columns were left open to its surroundings oxygen partial pressure and temperature were assumed to be that of the ambient air conditions 21 dissolved oxygen log po 2 of 7 and log pco 2 of 3 5 at 25 c 2 3 3 kinetics and reaction rate expression the rate expression rk for a mineral undergoing kinetic reaction in phreeqc is expressed as 6 r k r k a 0 v m m 0 n where rk is the specific rate mol m 2 s 1 a 0 is the initial surface area of the solid m 2 v is the volume of solution kgw m is the moles of the solid at a certain time m 0 is the inital moles of the solid and m m 0 n is a factor that takes into account the changes in the surface area of the mineral during dissolution parkhurst and appelo 1999 the value of n for uniformly dissolving spheres and cubes is set to 0 67 2 3 according to parkhurst and appelo 1999 a summary of the specific rate expressions k for forsterite and pyrrhotite used in this study as compared with that of palandri and kharaka 2004 is presented in table 3 pyrrhotite dissolves via oxidative dissolution janzen et al 2000 such that the dependency of pyrrhotite dissolution to o 2 must be established however since the kinetic test assumes constant ambient o 2 partial pressure reaction order for o 2 was not established for pyrrhotite dependency to o 2 a value of 0 5 was assumed similar to that of pyrite williamson and rimstidt 1994 2 3 4 1 d solution and multi component transport to simulate one dimensional water movement and the consequent chemical reactions through the column of tailings the transport keyword was used the defined incoming solution distilled water reacts with the initial column solution effluent chemistry and is advected downward at each shift fluid and solute transport was assumed to be dominated by advection and dispersion with chemical reactions occurring simultaneously a dispersivity and diffusion coefficient of 7 92e 4 m and 1 0e 9 m s 1 respectively were used flow in the cell was controlled by the permeability porosity and turtousity in the grains thus it was difficult to accurately quantify flow velocity during the weekly cycle furthermore the fluid trapped in the pore spaces when the column was not being rinsed was also not taken into account in the flow regime thus the flow velocity used in this model was purely based on the equation implied from the phreeqc code which is 1 98e 7 m s 1 the actual time it takes for the rinse solution to report as an effluent is 5 6e 4 m s 1 the three orders of magnitude slower flow velocity is considered appropriate in this case since the column was not continuously rinsed and was moist without flow for seven days until the next rinsing after rinsing some of the rinse solution wass trapped in the pore spaces of the tailings as supported by the less than 1 l solution collected every week the trapped water in the pore spaces made it possible for mineral water interactions to continue during the whole week the results of these reactions were either washed off during the next rinsing or remain in the pore spaces depending on preferential flow paths and insoluble products that were formed in the pore spaces such as ferrihydrite the slower flow velocity therefore takes all of these factors into account the transport of components through the column is depicted by the advective reaction dispersion ard equation which has been tested by tebes stevens and valocchi 1997 tebes stevens et al 1998 7 δ c δ t v δ c δ x d l δ 2 c δ x 2 δ q δ t where c is the concentration in the effluent mol kgw 1 t is time s v is pore water velocity ms 1 x is distance m dl is hydrodynamic dispersion coefficient and q is the concentration in the solid phase advective transport dispersive transport and the change in concentration due to reactions are represented by the first second and third terms in the equation to solve the transport equation eq 7 employs an explicit finite difference approach that is upwind for advective transport central in space for dispersion and is forward in time parkhurst and appelo 1999 the sum of all the equilibrium and non equilirium reaction rates is equivalent to δ q δ t and is calculated separately from the transport calculations parkhurst and appelo 1999 during each time step the sequence advective transport calculations all equilibrium and kinetically controlled reactions dispersive transport all equilibrium and kinetically controlled reactions is followed parkhurst and appelo 1999 a schematic diagram of the transport mechanism for the single cell used in this study is presented in fig 1 2 4 model calibration and parameter fitting model calibration using ph mg so 4 and ni was undertaken by matching the model results to that of the kinetic testing data except for ph these components of the effluent chemistry were chosen mainly because they were released into solution during the dissolution of forsterite and pyrrhotite the ph is thought to be the result of the interaction between the different ions in solution as well as surface complexation and redox reactions of pyrrhotite and dissolution of forsterite embile et al 2018 since the minerals were being reacted in time their surface area during steady dissolution rate will give an idea of how much surface area was exposed during this period to do this a surface area parameter fitting using phreeplot kinniburgh and cooper 2011 was conducted for forsterite and pyrrhotite dissolution results from this fitting was then compared to the initial surface area of these minerals for this fitting attempt the non linear least squares nlls method was chosen as the algorithm the goodness of fit was assessed by looking at the weighted sum of the residuals kinniburgh and cooper 2011 for more details about phreeplot fitting capability the reader is referred to kinniburgh and cooper 2011 and mahoney 2015 2 5 limitations and assumptions phreeqc 1 d transport and phreeqc in general have several limitations in its aqueous model ion exchange surface complexation and transport modeling parkhurst and appelo 1999 simunika et al 2013 phreeqc is generally well suited for low ionic strength up to 0 7 mol dm 3 aqueous solutions such that for higher ionic strengths the model may break down parkhurst and appelo 1999 the lawrence livermore national laboratory llnl database provided with the phreeqc installation package was used for this investigation primarily for uniformity with the inverse modeling approach that also used the same database embile et al 2018 preferential flow variation in pore water content and transverse flow are not considered in phreeqc transport simunika et al 2013 preferential flow paths on the other hand becomes very important for unsaturated conditions where regular rinsing and drying may result to different flow regimes in the columns the transport of oxygen in an unsaturated material is also not considered in phreeqc simunika et al 2013 in our model dissolved oxygen was assumed to be half of what is available in ambient air since there is only one cell 0 12 m thick the depth of oxygen penetration was assumed uniform another major limitation is the lack of consideration of the effect of bacterial oxidation for ion exchange phreeqc assumes that the fraction of an exchange species is assumed to be equivalent to its thermodynamic activity parkhurst and appelo 1999 for surface complexation phreeqc uses the diffuse layer model of dzombak and morel 1990 for details of the limitations and assumptions of phreeqc the reader is referred to parkhurst and appelo 1999 3 results and discussion 3 1 kinetic testing data and calculated parameters results of kinetic testing showed temporal variations in ph major ions and metal concentrations during the first 10 weeks starting from week 5 there was a notable decrease in component concentration before a stable period from week 15 to 50 was observed this stable period was the basis for the calculation of the dissolution rates of forsterite and pyrrhotite embile et al 2018 the calculated initial moles and surface areas are presented in table 4 it can be observed that the bet surface area for both minerals is about one magnitude higher than the geometric surface area furthermore the initial moles of forsterite is significantly higher than pyrrhotite this is not surprising based on the bulk mineralogy of the sample 3 2 model calibration and forward modeling it is important to note that the tailings material is about 25 years old and that oxidation of the tailings has been occurring over the same time period this resulted in a buildup of secondary minerals depending on precipitation and physicochemical conditions in the area the weekly rinsing increased the water to rock ratio which in turn increased the solubility and eventual removal of these secondary minerals that are mainly fe oxyhydroxides based on the observed drop in the component concentrations through time in the effluent it can be concluded that most of the soluble secondary minerals have been flushed out during the first few weeks of the kinetic test this period was assumed to be the first five weeks however as can be seen in the resulting models there are several reasons that may explain the discordance of the fit between the models and the actual kinetic test data these are explored in the following sections plots of ph mg so 4 and ni based on the modeled parameters for 65 weeks were compared to the actual kinetic test data fig 2 fe was not chosen because of its erratic behavior in the effluent chemistry plots which made it difficult to model embile et al 2018 while the models and actual kinetic test data have inconsistencies it was apparent that the bet and geometric surface area determined parameters did not produce significant difference in the resulting models in fact they are almost similar except for ni and mg in ra 01 the following sections discusses these four components 3 2 1 ph the solution ph is believed to be controlled mainly by the oxidation of pyrrhotite through the release of protons and the subsequent buffering effect of the dissolution of forsterite except for ra 01 the models generally fit that of the actual data the lack of agreement between the models and the actual effluent data in ra 01 can be linked to higher dissolution rate of forsterite as suggested by the higher concentration of mg than the actual data this variation in the ph of the tailings reflects the dissolution of forsterite which is known to consume protons oelkers 1999 pokrovsky and schott 2000 eary and williamson 2006 nordstrom and alpers 1999 that is produced from the dissolution of pyrrhotite although not discounted in this experiment non redox pyrrhotite dissolution can also consume protons steger 1982 jambor 1986 ahonen and tuovinen 1994 aside from forsterite other fast reacting silicates such as anorthite and enstatite may have also contributed to the neutralization of acid produced in the tailings eary and williamson 2006 oelkers and schott 2001 the lower ph in ra 04a may be linked to two possible reasons first is the high pyrrhotite content relative to the other columns and second is possible desorption of protons from fe hydroxide surfaces which was also observed by stollenwerk 1994 in general the ph is stable and is showing signs of an increasing trend towards the end of the modeling similar observation of an increasing ph due to forsterite dissolution was noted by de souza et al 2013 however at alkaline ph forsterite dissolution becomes independent of ph pokrovsky and schott 2000 it is therefore inferred that the ph of these tailings will continue to increase and eventually stabilize in time as pyrrhotite is oxidized and depleted 3 2 2 mg models for magnesium generally follow the trend of initially high and progressively decreasing trend that stabilizes towards the end except for ra 01 and ra 05 the period between week 10 to 20 is where the model and mg from actual data starts to stabilize initially following the same trend both models diverge by week 10 to end up having at least 2 mg l difference between the bet surface area and the geometric surface area models the geometric surface area eventually captured the kinetic test data towards the end ra 05 models show a steep drop in concentration by week 10 followed by a stable mg release at about 12 mg l until the end this is in contrast to the actual kinetic test data that show a somewhat gradual decline in concentration to about 10 mg l towards the end the main plausible reason for the lower mg concentration in the models is the fact that the models did not take into account the contribution of the dissolution of enstatite and clinochlore clay which also contains mg in their structure the dissolution of clinochlore clay minerals in the finer fractions of the tailings may have also affected the mg released into solution thereby giving higher concentration in the kinetic test than in the modeled solution 3 2 3 so 4 sulfate generally follows the same trend as mg the geometric surface area model was able to capture the first 15 weeks of the kinetic test data while the bet surface area model is generally higher by about 5 mg l than the kinetic test data the inability of the models to capture the observed so 4 concentrations for ra 01 may be linked to two possible explanations related to the modeling approach first is that the model may not have captured the actual amount of pyrrhotite that is dissolving due to the formation of fe oxides on the surface of pyrrhotite second is that chalcopyrite dissolution may be contributing to the higher initial sulfate release in the observed data in our model however chalcopyrite was not included as a dissolving mineral although cu was available in solution the sudden drop in the so 4 models for ra 04a and ra 05 models may suggest enhanced precipitation of gypsum from week 10 to 30 although evidence to support this was not observed in the solution speciation thus there must be other factors controlling this drop in so 4 such as complex formations all models are consistent with the actual data for the remaining 20 weeks 3 2 4 ni ni showed notable differences in the bet and geometric surface area models for ra 01 the bet model is almost approximately 25 higher than the kinetic test data while the geometric surface area model closely matched the kinetic test data for ra 03 and ra 04a ni dropped immediately to about 0 05 mg l and 0 10 mg l respectively during week 10 before following a stable ni release until the end of the test the actual kinetic test data is generally higher by as much as 0 2 mg l for ra 03 and 1 mg l for ra 04a however by week 40 to 50 both models closely matched that of the actual kinetic test data for ra 05 the models are significantly off from the actual data by as much 0 8 mg l while the actual ni concentration is decreasing the models are generally stable at about 0 2 mg l this high degree of variation can be explained by the possibility of immediate ni sorption to ferrihydrite and goethite surfaces during the initial weeks until the end of the modeled period another possibility is that the number of fully liberated pyrrhotite may have increased significantly in the ra 05 column such that more pyrrhotite were exposed to oxidize thereby releasing more ni embile et al 2018 this is supported by the almost four orders of magnitude increase in the bet surface area of ra 05 table 5 this mechanism of changing degrees of pyrrhotite liberation is difficult to capture in a reactive transport modeling code while there is generally consistency with the observed kinetic test data when the reaction rate parameters compiled by palandri and kharaka 2004 were used the resulting models have major inconsistencies with the kinetic test results this implies that the pure mineral reaction rates are overestimating the actual rates in the tailings since the reaction rate of forsterite and pyrrhotite in the tailings are significantly slower this was also observed by bea et al 2012 wherein laboratory derived dissolution rates of serpentine in their models were reduced significantly to match the actual data 3 3 surface area parameter fitting although the linear fitting model by phreeplot does not incorporate surface area changes the estimated surface area reflects the potential surface area that has been reacted in order to produce the mg concentration during the steady dissolution rate surface area fit during the steady state period points to almost two orders of magnitude increase based on the pre experiment table 4 and fitting result table 6 this was expected since both forsterite and pyrrhotite are continuously dissolving thereby generating more total surface areas it is inferred that clay weathering and secondary mineral formation such as fe hydroxides in the surfaces of these minerals may have significantly increased the total surface area fig 3 at the same time the active surface areas can also be reduced due to formation of secondary minerals in a study of brantley and mellott 2000 they argued that the increase in bet surface area of silicate minerals after weathering is due to formation of mesopores pores with 2 to 50 nm diameter within the mineral grains brantley et al 1999 also observed that an increase in bet surface area is correlated with increased dissolution rate resulting from solution etching while mesopores and solution etching were not investigated in this study it is inferred that such mechanisms are present during the kinetic testing in this case ra 04a registered the highest dissolution rate which corresponds to the highest change in surface area relative to the other columns for pyrrhotite a fit was difficult to obtain for the geometric surface area derived rates this may be attributed to the fact that the modeling attempt includes several simplifications changes in the external surface area due to formation of fe hydroxides are not taken into account by phreeplot a possible reason for the increase in surface area of pyrrhotite may be the degree of liberation of pyrrhotite grains as forsterite dissolves pyrrhotite enclosed on it may be liberated thereby increasing adding new surface area the increase in surface area is also supported by the bet surface area analysis of the tailings after the kinetic test table 5 results show that at least an order of magnitude increase is observed for most columns except ra 05 an increase of almost four orders of magnitude was observed after the kinetic test this implies that the dissolution of minerals especially the finer fraction is a major driver of the reaction 3 4 surface complexation and secondary mineral formation aqueous speciation and surface charge often dictate surface complexation reactions brown et al 1998 while surface charge by itself is generally controlled by ph brown et al 1998 liger et al 1999 at lower ph the surface of iron hydroxides tend to become more positive thus adsorption of cations is inhibited iron hydroxides provide an area in weakly acidic to alkaline condition where metals such as cu and ni may adsorb thereby decreasing metal concentrations in the effluent brown et al 1999 stollenwerk 1994 appelo et al 2002 in this study the amount of fe and ni reporting into the effluent is controlled by the precipitation of goethite and ferrihydrite the process of sorption of fe 2 on iron hydroxides is the most likely process that sequesters fe in the system which then forms additional fe hydroxides as the resulting fe 3 is precipitated this is mostly expected at columns having ph greater than 3 5 as pointed out by li 2004 a similar process was observed by van beek and vaessen 1979 in appelo et al 1999 in aquifers where injected oxidants oxidize the sorbed fe 2 to form new layers over existing iron oxyhydroxides according to davis and kent 1990 one important aspect to remember is that the calculated number of ferrihydrite sites does not necessarily represent the actual active sites present in the iron hydroxide surface due to microporosity from the bse images of pyrrhotite and forsterite thin sections the formation of fe oxides hydroxides was distinctly observed on the rims and surfaces of these minerals fig 3 li 2004 described these secondary mineral phases as brownish iron oxides that can stop oxygen penetration into the sulfides this coloration was likewise observed on the kinetic test columns mineral crusts suspected to be fe oxides hydroxides were also observed on grain mounts of forsterite interestingly microprobe chemistry data revealed that these forsterite grains become enriched in fe and depleted in mg as they are leached 3 5 prediction of effluent chemistry prediction of future effluent chemistry was carried out for 100 years using the obtained dissolution rate values of forsterite and pyrrhotite similar to the model calibration results with the actual kinetic test data minor differences in the resulting models between the bet and geometric surface area determined rates were observed fig 4 in general the geometric surface area determined rates produced relatively lower concentrations of mg so 4 and ni this difference is most pronounced in ra 01 all the four columns exhibit a similar pattern although at different concentrations through time for ra 01 and ra 03 ph is generally increasing from about 6 to 8 until year 40 from this time onward ph was relatively stable for ra 05 a stable ph started at about year 90 while for ra 04a ph still has to reach a stable period by year 100 the increasing to stable ph can be correlated to the drop in so 4 and ni concentration in the same period mg release also dropped in the same period which agrees to the conclusion by several studies that the dissolution of forsterite consumes protons oelkers 1999 pokrovsky and schott 2000 eary and williamson 2006 nordstrom and alpers 1999 which then leads to slower forsterite dissolution the decreasing mg can be correlated to an increase in ph this suggests that pyrrhotite dissolution may have higher control on the solution ph it was also observed that there was a large vertical drop 25 to 40 in concentrations of mg so 4 and ni during the first year this may be attributed to the high dissolution rate of forsterite and pyrrhotite during the first year further dissolution of these minerals can be inferred to be slower in time due to the formation of secondary mineral crusts and silica gel for forsterie on their surfaces which can significantly limit further dissolution as pointed by brantley and white 2003 and pokrovsky and schott 2000 unfortunately secondary mineral formation cannot be modeled in this case nevertheless stability of ph can be well correlated with the stable release of components for ra 01 ra 03 and ra 05 it is therefore inferred that the ph of the tailings will remain stable at about 7 to 8 in the long term pyrrhotite has significantly higher ni content than forsterite thus its dissolution will produce more ni in solution looking at the predicted ni concentration for 100 years it can be said that bulk of the ni released in the first 10 to 30 years is coming from pyrrhotite dissolution there are however uncertainties in this estimate due the degree of mineral liberation it is inferred that as pyrrhotite becomes depleted the only source of ni will be from the dissolution of forsterite this switch therefore results to lower ni release at the same time as forsterite becomes coated with silica gel brantley and white 2003 béarat et al 2006 and other secondary minerals its dissolution becomes passivated resulting to even lower ni and mg release 3 6 effect of grain size heterogeneity and age of tailings from the particle size analysis it was observed that particles less than 0 10 mm in diameter accounts for at least half of the tailings this suggests that the dissolution of fine particles will have a strong effect on the rates of dissolution as pointed by salmon and malmstrom 2006 drever and clow 1995 white 1995 it was therefore important that this grain size variation be taken into account comparing the methods used in obtained surface areas embile et al 2018 the geometric surface may be more representative than bet in terms of this grain size variation however the use of a roughness factor in the geometric surface area calculation adds to the uncertainty since it is a function of grain size drever and clow 1995 furthermore since the tailings are about 25 years old surface roughness will be considerably higher as pointed by anbeek 1992 salmon and malmstrom 2004 have pointed out in their study that surface reactivity decreases the longer the exposure of tailings to weathering agents the use of a roughness factor of 100 may therefore underestimate the surface area thus the rates while the attempt to quantify the surface area based on the different grain size may have its uncertainty due to the presence of clay minerals as suggested by drever and clow 1995 the geometric surface area is nevertheless the closest estimate that takes into account the different grain sizes present in the tailings 3 7 sensitivity analysis and model limitations sensitivity analysis was conducted by varying the initial concentrations of chemical components reaction rate constant and initial moles an increase in the initial concentrations of components resulted in increased metal release variation in the reaction order with respect to oxygen did not seem to have an effect on the resulting model a change in the time step however significantly affects the resulting models this is expected since as time step decreases the flow velocity increases which then results to less reaction time between the minerals and the infiltrating solution however varying the length of the cell to match the actual flow velocity did not significantly affect the models while there was a good fit on most components using the calculated parameters the inconsistencies in the other components are believed to be associated with the obvious limitations of this model 1 phreeqc s capability to perform multi component reactive transport modeling is based on a saturated condition our kinetic testing condition may not fully incorporate this scenario as our columns undergo a quick saturated condition and then shifting to mostly undersaturated condition until the next rinsing episode the modeling attempt rests in the assumption that transport of fluids and chemical components are repeated 65 times 2 the use of the fifth rinse as the initial solution chemistry may underestimate the weekly evolution of the effluents the continuous and steady decline in the concentration of the components cannot be accurately captured by just using this model surely there are several factors at play that must be considered as discussed below however as seen from the model and actual data this approach is considered successful 3 the use of only forsterite and pyrrhotite as the minerals controlling the effluent chemistry may bypass the contribution of other silicates present in the tailings the dissolution of other sources of mg such as enstatite and clinochlore clay minerals which may undoubtedly add to the total mg released was not taken into account 4 the phreeqc model assumes a uniform grain size as indicated by the surface area to volume ratio thus it does not take into account the observed variation in grain size which is very important in assessing the dissolution rates of the minerals through time furthermore the liberation of minerals such as pyrrhotite in this study was not taken into account by phreeqc which limits the access of dissolved oxygen to the pyrrhotite in turn this affects the resulting ni concentration in the effluent 4 conclusion simulation of kinetic test data from a ni sulfide mine tailings sample using phreeqc proved to be consistent with the observed kinetic test data when locally obtained mineral dissolution rates are used this modeling attempt further showed that it is possible to use the initial weekly effluent chemistry from kinetic testing to predict future effuent chemistry with the exception of ni the models based on the bet and geometric surface area derived dissolution rates did not significantly differ in terms of ph mg and so 4 ni showed notable difference during the initial period of the model but eventually matched the actual data which can be attributed to potential ni sorption on fe hydroxides and complex formation this modeling attempt showed the possibility of performing long term prediction of kinetic testing parameters such as ph major ions and some trace metals such that the duration of these tests can be reduced as needed acknowledgments this project was funded by the norwegian research council project no 241879 the authors are grateful for the insights and suggestions from david parkhurst during the formulation of the phreeqc models used in this effort the authors would also like to extend their gratitude to the staff of the new mexico bureau of geology xrd microprobe and chemistry laboratories thanks is likewise extended to samantha saville phoebe nicholls and jenna donatelli who helped in data collection and analysis supplementary materials supplementary material associated with this article can be found in the online version at doi 10 1016 j advwatres 2019 04 008 appendix supplementary materials image application 1 
656,multicomponent reactive transport modeling of effluent chemistry using locally obtained mineral dissolution rates of forsterite and pyrrhotite from a mine tailings deposit rodrigo f embile jr a b ingar f walder a b john j mahoney c a new mexico institute of mining and technology 801 leroy pl socorro new mexico usa 87801 new mexico institute of mining and technology 801 leroy pl socorro new mexico 87801 usa b kjeøy research and education center vestbygd norway 8412 kjeøy research and education center vestbygd 8412 norway c mahoney geochemical consulting llc 892 s newcombe way lakewood colorado usa 80226 mahoney geochemical consulting llc 892 s newcombe way lakewood colorado 80226 usa corresponding author at kjeøy research and education center vestbygd norway 8412 kjeøy research and education center vestbygd 8412 norway multicomponent reactive transport modeling using phreeqc of a ni sulfide tailings deposit was undertaken to assess how effective locally obtained mineral dissolution rates in simulating long term kinetic testing results of the tailings material forsterite and pyrrhotite were used as proxies for the chemical reactions occuring within the tailings the dissolution rates of forsterite and pyrrhotite were obtained based on the actual kinetic testing data and phreeqc inverse modeling bet brunauer emmet teller and geometric surface area derived rates were used in the kinetic test data simulation and long term prediction for 100 years results indicate that the geochemical models for both the bet and geometric surface area derived rates are generally consistent with the actual ph mg so 4 and ni of the kinetic testing data long term prediction of effluent chemistry suggests that ph will continue to increase until a stable ph of 8 is achieved while the predicted mg so 4 and ni concentrations will be stable and will be close to the concentrations observed towards the end of the kinetic test this method of using locally obtained mineral dissolution rates in multicomponent reactive transport modeling of a kinetic test data has proven to be reliable as compared to using literature dissolution rate values this method can then be used for a quick and cost effective way for future effluent chemistry prediction rather than conducting long and expensive kinetic tests keywords multicomponent reactive transport phreeqc kinetic test prediction 1 introduction effluent produced from long term kinetic testing provides a good picture of the reactions occurring within a material of interest the use of kinetic testing as a major tool in acid neutral rock drainage prediction and testing has been proven by many studies stromberg and banwart 1999 bowell et al 2006 eary and williamson 2006 lapakko 1988 morin et al 1995 as a follow up or conjunction with static testing cen 292 2009 however the issue of scaling kinetic testing results to actual field conditions often limits the effective use of this method furthermore kinetic testing can take a long time and cost may be stretched higher than planned depending if the original purpose has already been achieved or not although there are some prescribed ideal durations of a kinetic test this is often subject to change depending on purpose cen 16363 2012 it is therefore important to be able to predict long term effluent chemistry from a mine wastes for example using geochemical reactive transport modeling approaches in the mining industry reactive transport modeling plays an important role in modeling metal and other contaminant transport in tailings jaynes et al 1984 salmon and malmstrom 2004 and waste rocks eary and williamson 2006 the use of reactive transport modeling in conjunction with detailed geochemical and mineralogical data to simulate effluent chemistry from kinetic testing or column leach studies has been conducted by several studies including appelo and postma 1999 guha et al 2001 jurjovec et al 2004 eary and williamson 2006 lipson et al 2007 bea et al 2012 and chang et al 2012 simunika et al 2013 and motalbi et al 2014 with notable success reactive transport modeling using phreeqc provides an efficient method for simulating simple advective reactive transport as a solution flows through a column parkhurst and appelo 1999 modeling can be done in one dimension wherein a column or block is discretized into smaller nodal blocks termed as cells with similar pore volumes parkhurst and appelo 1999 bethke and brady 2000 which are also defined by their lengths parkhurst and appelo 1999 initial conditions include an unreacted fluid entering the column parkhurst and appelo 1999 bethke and brady 2000 and the solution that is initially present in the column the duration of reactions on each node is dictated by the time step parkhurst and appelo 1999 at which the fluid passes through each cell for every shift kinetic reactions are integrated for each cell while maintaining equilibrium with any gas or mineral phase present in each cell parkhurst and appelo 1999 dividing the cell length by the time step gives the fluid velocity parkhurst and appelo 1999 for each time step several equations are evaluated including equilibrium equations transport equations sorption models and surface complexations bethke and brady 2000 for most models the inclusion of kinetics and rate expressions makes a model more robust and allows phreeqc to better simulate kinetic reactions there are different methods to obtain the specific rate and constants of a mineral reaction delany et al 1986 aagaard and hegelson 1982 cappellen and wang 1996 these rates are typically conducted using monomineralic materials and may not reflect actual field conditions of a specific study area according to salmon and malmstrom 2004 the use of mineral dissolution rates from monomineralic samples to model dissolution rates in the field may limit the ability to predict actual weathering rates this is primarily because pure mineral phase experiments use fresh particles rather than weathered samples the need for a widely used reaction rate constants and variables to be used for geochemical modeling led palandri and kharaka 2004 to publish a list of these constants and variables based on a pool of values from different experimental studies however these rates are often larger by at least an order of magnitude than those observed in the field brantley and white 2003 where heterogeneous material such as mine tailings exist so far there has been no known study utilizing locally obtained mineral dissolution rates from a tailings deposit to simulate and predict future effluent chemistry using a multicomponent reactive transport modeling approach for this study fast reacting minerals forsterite and pyrrhotite were used as proxies for the temporal evolution of effluent chemistry produced from kinetic testing more information about the obtained forsterite and pyrrhotite dissolution rates can be found in embile et al 2018 2 methodology 2 1 tailings sample and characterization tailings sample from four locations in a ni sulfide mine tailings deposit located in a fjord in north norway were obtained and subjected to kinetic testing details about the tailings sample collection characterization and kinetic testing experiments can be found in embile et al 2018 the bulk mineralogy of the tailings from each column are presented in table 1 2 2 kinetic test data and assumptions one of the major assumptions in this study is that forsterite and pyrrhotite dissolution controls the resulting effluent chemistry in this regard mg and so 4 in the effluent is strongly correlated to the dissolution of these minerals respectively this is based from the fact that the reaction rates of these minerals are several orders of magnitude higher than the other silicates and sulfides present in the tailings embile et al 2018 furthermore forsterite constitute at least half of the tailings bulk mineralogy during simulation dissolution reactions of the other silicate minerals enstatite tremolite clinochlore clay were therefore assumed to be unimportant compared to that of forsterite based on the observed reaction rate similarly pyrrhotite is the main sulfide mineral in the tailings embile et al 2018 kinetic testing data for 70 weeks from four kinetic test columns were used as input parameters while the fifth week effluent chemistries from each column were used as initial column compositions this is based on the assumption that during the first four weeks secondary minerals formed prior to sample collection are dissolving and are thus excluded from the modeling a summary of the initial input chemistry is presented in table 2 alkalinity is generally zero for the columns based on the kinetic testing results except for ra 01 where a value of 1 mg l caco 3 was assigned due to reported alkalinity values in the beginning of the kinetic test solution speciation using phreeqc was also conducted for each weekly data to obtain an idea of any potential saturated mineral phases 2 3 conceptual model and parameters used 2 3 1 chemical parameters phreeqc generally evaluates transport of solution and components in a saturated medium by moving a solution through each cell in the following sequence advection dispersion kinetic reactions and equilibrium calculations parkhurst and appelo 1999 however one can also simulate an undersaturated system by assuming equilibrium with oxygen from the atmosphere when the flow velocity is known the use of mass balance and mass action equations allows the calculation of dissolved ions and complexes as well as dissolution and precipitation of mineral phases brown et al 1998 parkhurst and appelo 1999 surface complexation mechanisms in phreeqc are modeled using the diffuse double layer model dzombak and morel 1990 on hydrous ferric oxide hfo or ferrihydrite parkhurst and appelo 1999 this can be established using literature values of common fe oxyhydroxide surface sites the chemical composition of forsterite and pyrrhotite was defined using the keyword phases dissolution rate constants logk for forsterite and pyrrhotite were based on the lawrence livermore national laboratory llnl database mass transfer mechanisms such as adsorption and exchange were simulated in phreeqc using the surface and exchange keywords surface adsorption to fe oxides in the form of ferrihydrite was used exchange was modeled to simulate possible exchange between cations in the tailings the value of 0 1 was assumed based on the cation exchange capacity of a soil material that is in the range of 1 10 meq 100 g white and nairn 2007 ferrihydrite was set to equilibrate with the initial solution to take into account its formation and role as a potential sink to metals the simulated flow path was assumed to be unsaturated with respect to water by allowing o 2 and co 2 gas exchange since an open system was simulated the mass of iron hydroxide was calculated using data from sequential extraction on the bulk tailings sample embile et al 2018 loss of solution due to pore water retention and weekly evaporation was modeled using the keyword reaction at each shift 0 28 mol of water 5 gs is removed to maintain an average recovered effluent volume of 950 ml 2 3 2 physical and hydrologic parameters to represent the columns a single cell was used which equates to a total cell height of 0 12 m a time step of 604 800 s 1 week with sixty five shifts was used resulting to a total simulation time of sixty five weeks this is equivalent to the duration of the kinetic test minus the five weeks of data that was not used phreeqc requires input of reacting minerals in units of moles parkhurst and appelo 1999 initial moles of forsterite and pyrrhotite was calculated based on the volume percent of each mineral in the bulk tailings the formula presented by eary and williamson 2006 and simunika et al 2013 was used to calculate initial moles of the reactants eq 1 1 initial moles mineral f mineral 1 θ θ ρ solids ρ water 1000 g water k g water 1 m mineral where fmineral is the fractional content of the mineral in the bulk tailings sample θ is the fluid filled porosity of the tailings ρsolids is the density of the mineral ρwater is the density of the water and mmineral is the molar mass of the mineral a bulk density of 2 6 g cm 3 which is equivalent to the solid portion of a bulk rock was assumed the 1000 g water is a conversion factor eary and williamson 2006 to obtain the surface area per volume of sample sa v that will be used as phreeqc input parameter bet and geometric surface areas were used which were determined using the following formulas 2 a b e t s p m 2 g 1 a b e t x i 3 a g e o s p m 2 g 1 a g e o x i a where a b e t s p is the bet specific surface area of the bulk tailings a g e o s p is the cumulative geometric specific surface area xi is the volumetric fraction of forsterite or pyrrhotite and γ is the roughness factor the cumulative surface area was based on the contribution of each particle size present in the tailings a roughness factor of 100 was used to represent the most conservative number of the range suggested by anbeek 1992 using the specific surface areas the actual surface area to volume of forsterite and pyrrhotite can be obtained using the following equations 4 surface area m 2 d m 3 a b e t s p m i m i 5 surface area m 2 d m 3 a g e o s p m i m i where mi and mi are the molar mass g mol and total moles moles of forsterite and pyrrhotite in the tailings respectively average porosity and bulk density of the tailings was determined to be 0 20 and 1 25 g cm 3 the average flow rate in the four columns during rinsing is 6x10 4 ms 1 since the columns were left open to its surroundings oxygen partial pressure and temperature were assumed to be that of the ambient air conditions 21 dissolved oxygen log po 2 of 7 and log pco 2 of 3 5 at 25 c 2 3 3 kinetics and reaction rate expression the rate expression rk for a mineral undergoing kinetic reaction in phreeqc is expressed as 6 r k r k a 0 v m m 0 n where rk is the specific rate mol m 2 s 1 a 0 is the initial surface area of the solid m 2 v is the volume of solution kgw m is the moles of the solid at a certain time m 0 is the inital moles of the solid and m m 0 n is a factor that takes into account the changes in the surface area of the mineral during dissolution parkhurst and appelo 1999 the value of n for uniformly dissolving spheres and cubes is set to 0 67 2 3 according to parkhurst and appelo 1999 a summary of the specific rate expressions k for forsterite and pyrrhotite used in this study as compared with that of palandri and kharaka 2004 is presented in table 3 pyrrhotite dissolves via oxidative dissolution janzen et al 2000 such that the dependency of pyrrhotite dissolution to o 2 must be established however since the kinetic test assumes constant ambient o 2 partial pressure reaction order for o 2 was not established for pyrrhotite dependency to o 2 a value of 0 5 was assumed similar to that of pyrite williamson and rimstidt 1994 2 3 4 1 d solution and multi component transport to simulate one dimensional water movement and the consequent chemical reactions through the column of tailings the transport keyword was used the defined incoming solution distilled water reacts with the initial column solution effluent chemistry and is advected downward at each shift fluid and solute transport was assumed to be dominated by advection and dispersion with chemical reactions occurring simultaneously a dispersivity and diffusion coefficient of 7 92e 4 m and 1 0e 9 m s 1 respectively were used flow in the cell was controlled by the permeability porosity and turtousity in the grains thus it was difficult to accurately quantify flow velocity during the weekly cycle furthermore the fluid trapped in the pore spaces when the column was not being rinsed was also not taken into account in the flow regime thus the flow velocity used in this model was purely based on the equation implied from the phreeqc code which is 1 98e 7 m s 1 the actual time it takes for the rinse solution to report as an effluent is 5 6e 4 m s 1 the three orders of magnitude slower flow velocity is considered appropriate in this case since the column was not continuously rinsed and was moist without flow for seven days until the next rinsing after rinsing some of the rinse solution wass trapped in the pore spaces of the tailings as supported by the less than 1 l solution collected every week the trapped water in the pore spaces made it possible for mineral water interactions to continue during the whole week the results of these reactions were either washed off during the next rinsing or remain in the pore spaces depending on preferential flow paths and insoluble products that were formed in the pore spaces such as ferrihydrite the slower flow velocity therefore takes all of these factors into account the transport of components through the column is depicted by the advective reaction dispersion ard equation which has been tested by tebes stevens and valocchi 1997 tebes stevens et al 1998 7 δ c δ t v δ c δ x d l δ 2 c δ x 2 δ q δ t where c is the concentration in the effluent mol kgw 1 t is time s v is pore water velocity ms 1 x is distance m dl is hydrodynamic dispersion coefficient and q is the concentration in the solid phase advective transport dispersive transport and the change in concentration due to reactions are represented by the first second and third terms in the equation to solve the transport equation eq 7 employs an explicit finite difference approach that is upwind for advective transport central in space for dispersion and is forward in time parkhurst and appelo 1999 the sum of all the equilibrium and non equilirium reaction rates is equivalent to δ q δ t and is calculated separately from the transport calculations parkhurst and appelo 1999 during each time step the sequence advective transport calculations all equilibrium and kinetically controlled reactions dispersive transport all equilibrium and kinetically controlled reactions is followed parkhurst and appelo 1999 a schematic diagram of the transport mechanism for the single cell used in this study is presented in fig 1 2 4 model calibration and parameter fitting model calibration using ph mg so 4 and ni was undertaken by matching the model results to that of the kinetic testing data except for ph these components of the effluent chemistry were chosen mainly because they were released into solution during the dissolution of forsterite and pyrrhotite the ph is thought to be the result of the interaction between the different ions in solution as well as surface complexation and redox reactions of pyrrhotite and dissolution of forsterite embile et al 2018 since the minerals were being reacted in time their surface area during steady dissolution rate will give an idea of how much surface area was exposed during this period to do this a surface area parameter fitting using phreeplot kinniburgh and cooper 2011 was conducted for forsterite and pyrrhotite dissolution results from this fitting was then compared to the initial surface area of these minerals for this fitting attempt the non linear least squares nlls method was chosen as the algorithm the goodness of fit was assessed by looking at the weighted sum of the residuals kinniburgh and cooper 2011 for more details about phreeplot fitting capability the reader is referred to kinniburgh and cooper 2011 and mahoney 2015 2 5 limitations and assumptions phreeqc 1 d transport and phreeqc in general have several limitations in its aqueous model ion exchange surface complexation and transport modeling parkhurst and appelo 1999 simunika et al 2013 phreeqc is generally well suited for low ionic strength up to 0 7 mol dm 3 aqueous solutions such that for higher ionic strengths the model may break down parkhurst and appelo 1999 the lawrence livermore national laboratory llnl database provided with the phreeqc installation package was used for this investigation primarily for uniformity with the inverse modeling approach that also used the same database embile et al 2018 preferential flow variation in pore water content and transverse flow are not considered in phreeqc transport simunika et al 2013 preferential flow paths on the other hand becomes very important for unsaturated conditions where regular rinsing and drying may result to different flow regimes in the columns the transport of oxygen in an unsaturated material is also not considered in phreeqc simunika et al 2013 in our model dissolved oxygen was assumed to be half of what is available in ambient air since there is only one cell 0 12 m thick the depth of oxygen penetration was assumed uniform another major limitation is the lack of consideration of the effect of bacterial oxidation for ion exchange phreeqc assumes that the fraction of an exchange species is assumed to be equivalent to its thermodynamic activity parkhurst and appelo 1999 for surface complexation phreeqc uses the diffuse layer model of dzombak and morel 1990 for details of the limitations and assumptions of phreeqc the reader is referred to parkhurst and appelo 1999 3 results and discussion 3 1 kinetic testing data and calculated parameters results of kinetic testing showed temporal variations in ph major ions and metal concentrations during the first 10 weeks starting from week 5 there was a notable decrease in component concentration before a stable period from week 15 to 50 was observed this stable period was the basis for the calculation of the dissolution rates of forsterite and pyrrhotite embile et al 2018 the calculated initial moles and surface areas are presented in table 4 it can be observed that the bet surface area for both minerals is about one magnitude higher than the geometric surface area furthermore the initial moles of forsterite is significantly higher than pyrrhotite this is not surprising based on the bulk mineralogy of the sample 3 2 model calibration and forward modeling it is important to note that the tailings material is about 25 years old and that oxidation of the tailings has been occurring over the same time period this resulted in a buildup of secondary minerals depending on precipitation and physicochemical conditions in the area the weekly rinsing increased the water to rock ratio which in turn increased the solubility and eventual removal of these secondary minerals that are mainly fe oxyhydroxides based on the observed drop in the component concentrations through time in the effluent it can be concluded that most of the soluble secondary minerals have been flushed out during the first few weeks of the kinetic test this period was assumed to be the first five weeks however as can be seen in the resulting models there are several reasons that may explain the discordance of the fit between the models and the actual kinetic test data these are explored in the following sections plots of ph mg so 4 and ni based on the modeled parameters for 65 weeks were compared to the actual kinetic test data fig 2 fe was not chosen because of its erratic behavior in the effluent chemistry plots which made it difficult to model embile et al 2018 while the models and actual kinetic test data have inconsistencies it was apparent that the bet and geometric surface area determined parameters did not produce significant difference in the resulting models in fact they are almost similar except for ni and mg in ra 01 the following sections discusses these four components 3 2 1 ph the solution ph is believed to be controlled mainly by the oxidation of pyrrhotite through the release of protons and the subsequent buffering effect of the dissolution of forsterite except for ra 01 the models generally fit that of the actual data the lack of agreement between the models and the actual effluent data in ra 01 can be linked to higher dissolution rate of forsterite as suggested by the higher concentration of mg than the actual data this variation in the ph of the tailings reflects the dissolution of forsterite which is known to consume protons oelkers 1999 pokrovsky and schott 2000 eary and williamson 2006 nordstrom and alpers 1999 that is produced from the dissolution of pyrrhotite although not discounted in this experiment non redox pyrrhotite dissolution can also consume protons steger 1982 jambor 1986 ahonen and tuovinen 1994 aside from forsterite other fast reacting silicates such as anorthite and enstatite may have also contributed to the neutralization of acid produced in the tailings eary and williamson 2006 oelkers and schott 2001 the lower ph in ra 04a may be linked to two possible reasons first is the high pyrrhotite content relative to the other columns and second is possible desorption of protons from fe hydroxide surfaces which was also observed by stollenwerk 1994 in general the ph is stable and is showing signs of an increasing trend towards the end of the modeling similar observation of an increasing ph due to forsterite dissolution was noted by de souza et al 2013 however at alkaline ph forsterite dissolution becomes independent of ph pokrovsky and schott 2000 it is therefore inferred that the ph of these tailings will continue to increase and eventually stabilize in time as pyrrhotite is oxidized and depleted 3 2 2 mg models for magnesium generally follow the trend of initially high and progressively decreasing trend that stabilizes towards the end except for ra 01 and ra 05 the period between week 10 to 20 is where the model and mg from actual data starts to stabilize initially following the same trend both models diverge by week 10 to end up having at least 2 mg l difference between the bet surface area and the geometric surface area models the geometric surface area eventually captured the kinetic test data towards the end ra 05 models show a steep drop in concentration by week 10 followed by a stable mg release at about 12 mg l until the end this is in contrast to the actual kinetic test data that show a somewhat gradual decline in concentration to about 10 mg l towards the end the main plausible reason for the lower mg concentration in the models is the fact that the models did not take into account the contribution of the dissolution of enstatite and clinochlore clay which also contains mg in their structure the dissolution of clinochlore clay minerals in the finer fractions of the tailings may have also affected the mg released into solution thereby giving higher concentration in the kinetic test than in the modeled solution 3 2 3 so 4 sulfate generally follows the same trend as mg the geometric surface area model was able to capture the first 15 weeks of the kinetic test data while the bet surface area model is generally higher by about 5 mg l than the kinetic test data the inability of the models to capture the observed so 4 concentrations for ra 01 may be linked to two possible explanations related to the modeling approach first is that the model may not have captured the actual amount of pyrrhotite that is dissolving due to the formation of fe oxides on the surface of pyrrhotite second is that chalcopyrite dissolution may be contributing to the higher initial sulfate release in the observed data in our model however chalcopyrite was not included as a dissolving mineral although cu was available in solution the sudden drop in the so 4 models for ra 04a and ra 05 models may suggest enhanced precipitation of gypsum from week 10 to 30 although evidence to support this was not observed in the solution speciation thus there must be other factors controlling this drop in so 4 such as complex formations all models are consistent with the actual data for the remaining 20 weeks 3 2 4 ni ni showed notable differences in the bet and geometric surface area models for ra 01 the bet model is almost approximately 25 higher than the kinetic test data while the geometric surface area model closely matched the kinetic test data for ra 03 and ra 04a ni dropped immediately to about 0 05 mg l and 0 10 mg l respectively during week 10 before following a stable ni release until the end of the test the actual kinetic test data is generally higher by as much as 0 2 mg l for ra 03 and 1 mg l for ra 04a however by week 40 to 50 both models closely matched that of the actual kinetic test data for ra 05 the models are significantly off from the actual data by as much 0 8 mg l while the actual ni concentration is decreasing the models are generally stable at about 0 2 mg l this high degree of variation can be explained by the possibility of immediate ni sorption to ferrihydrite and goethite surfaces during the initial weeks until the end of the modeled period another possibility is that the number of fully liberated pyrrhotite may have increased significantly in the ra 05 column such that more pyrrhotite were exposed to oxidize thereby releasing more ni embile et al 2018 this is supported by the almost four orders of magnitude increase in the bet surface area of ra 05 table 5 this mechanism of changing degrees of pyrrhotite liberation is difficult to capture in a reactive transport modeling code while there is generally consistency with the observed kinetic test data when the reaction rate parameters compiled by palandri and kharaka 2004 were used the resulting models have major inconsistencies with the kinetic test results this implies that the pure mineral reaction rates are overestimating the actual rates in the tailings since the reaction rate of forsterite and pyrrhotite in the tailings are significantly slower this was also observed by bea et al 2012 wherein laboratory derived dissolution rates of serpentine in their models were reduced significantly to match the actual data 3 3 surface area parameter fitting although the linear fitting model by phreeplot does not incorporate surface area changes the estimated surface area reflects the potential surface area that has been reacted in order to produce the mg concentration during the steady dissolution rate surface area fit during the steady state period points to almost two orders of magnitude increase based on the pre experiment table 4 and fitting result table 6 this was expected since both forsterite and pyrrhotite are continuously dissolving thereby generating more total surface areas it is inferred that clay weathering and secondary mineral formation such as fe hydroxides in the surfaces of these minerals may have significantly increased the total surface area fig 3 at the same time the active surface areas can also be reduced due to formation of secondary minerals in a study of brantley and mellott 2000 they argued that the increase in bet surface area of silicate minerals after weathering is due to formation of mesopores pores with 2 to 50 nm diameter within the mineral grains brantley et al 1999 also observed that an increase in bet surface area is correlated with increased dissolution rate resulting from solution etching while mesopores and solution etching were not investigated in this study it is inferred that such mechanisms are present during the kinetic testing in this case ra 04a registered the highest dissolution rate which corresponds to the highest change in surface area relative to the other columns for pyrrhotite a fit was difficult to obtain for the geometric surface area derived rates this may be attributed to the fact that the modeling attempt includes several simplifications changes in the external surface area due to formation of fe hydroxides are not taken into account by phreeplot a possible reason for the increase in surface area of pyrrhotite may be the degree of liberation of pyrrhotite grains as forsterite dissolves pyrrhotite enclosed on it may be liberated thereby increasing adding new surface area the increase in surface area is also supported by the bet surface area analysis of the tailings after the kinetic test table 5 results show that at least an order of magnitude increase is observed for most columns except ra 05 an increase of almost four orders of magnitude was observed after the kinetic test this implies that the dissolution of minerals especially the finer fraction is a major driver of the reaction 3 4 surface complexation and secondary mineral formation aqueous speciation and surface charge often dictate surface complexation reactions brown et al 1998 while surface charge by itself is generally controlled by ph brown et al 1998 liger et al 1999 at lower ph the surface of iron hydroxides tend to become more positive thus adsorption of cations is inhibited iron hydroxides provide an area in weakly acidic to alkaline condition where metals such as cu and ni may adsorb thereby decreasing metal concentrations in the effluent brown et al 1999 stollenwerk 1994 appelo et al 2002 in this study the amount of fe and ni reporting into the effluent is controlled by the precipitation of goethite and ferrihydrite the process of sorption of fe 2 on iron hydroxides is the most likely process that sequesters fe in the system which then forms additional fe hydroxides as the resulting fe 3 is precipitated this is mostly expected at columns having ph greater than 3 5 as pointed out by li 2004 a similar process was observed by van beek and vaessen 1979 in appelo et al 1999 in aquifers where injected oxidants oxidize the sorbed fe 2 to form new layers over existing iron oxyhydroxides according to davis and kent 1990 one important aspect to remember is that the calculated number of ferrihydrite sites does not necessarily represent the actual active sites present in the iron hydroxide surface due to microporosity from the bse images of pyrrhotite and forsterite thin sections the formation of fe oxides hydroxides was distinctly observed on the rims and surfaces of these minerals fig 3 li 2004 described these secondary mineral phases as brownish iron oxides that can stop oxygen penetration into the sulfides this coloration was likewise observed on the kinetic test columns mineral crusts suspected to be fe oxides hydroxides were also observed on grain mounts of forsterite interestingly microprobe chemistry data revealed that these forsterite grains become enriched in fe and depleted in mg as they are leached 3 5 prediction of effluent chemistry prediction of future effluent chemistry was carried out for 100 years using the obtained dissolution rate values of forsterite and pyrrhotite similar to the model calibration results with the actual kinetic test data minor differences in the resulting models between the bet and geometric surface area determined rates were observed fig 4 in general the geometric surface area determined rates produced relatively lower concentrations of mg so 4 and ni this difference is most pronounced in ra 01 all the four columns exhibit a similar pattern although at different concentrations through time for ra 01 and ra 03 ph is generally increasing from about 6 to 8 until year 40 from this time onward ph was relatively stable for ra 05 a stable ph started at about year 90 while for ra 04a ph still has to reach a stable period by year 100 the increasing to stable ph can be correlated to the drop in so 4 and ni concentration in the same period mg release also dropped in the same period which agrees to the conclusion by several studies that the dissolution of forsterite consumes protons oelkers 1999 pokrovsky and schott 2000 eary and williamson 2006 nordstrom and alpers 1999 which then leads to slower forsterite dissolution the decreasing mg can be correlated to an increase in ph this suggests that pyrrhotite dissolution may have higher control on the solution ph it was also observed that there was a large vertical drop 25 to 40 in concentrations of mg so 4 and ni during the first year this may be attributed to the high dissolution rate of forsterite and pyrrhotite during the first year further dissolution of these minerals can be inferred to be slower in time due to the formation of secondary mineral crusts and silica gel for forsterie on their surfaces which can significantly limit further dissolution as pointed by brantley and white 2003 and pokrovsky and schott 2000 unfortunately secondary mineral formation cannot be modeled in this case nevertheless stability of ph can be well correlated with the stable release of components for ra 01 ra 03 and ra 05 it is therefore inferred that the ph of the tailings will remain stable at about 7 to 8 in the long term pyrrhotite has significantly higher ni content than forsterite thus its dissolution will produce more ni in solution looking at the predicted ni concentration for 100 years it can be said that bulk of the ni released in the first 10 to 30 years is coming from pyrrhotite dissolution there are however uncertainties in this estimate due the degree of mineral liberation it is inferred that as pyrrhotite becomes depleted the only source of ni will be from the dissolution of forsterite this switch therefore results to lower ni release at the same time as forsterite becomes coated with silica gel brantley and white 2003 béarat et al 2006 and other secondary minerals its dissolution becomes passivated resulting to even lower ni and mg release 3 6 effect of grain size heterogeneity and age of tailings from the particle size analysis it was observed that particles less than 0 10 mm in diameter accounts for at least half of the tailings this suggests that the dissolution of fine particles will have a strong effect on the rates of dissolution as pointed by salmon and malmstrom 2006 drever and clow 1995 white 1995 it was therefore important that this grain size variation be taken into account comparing the methods used in obtained surface areas embile et al 2018 the geometric surface may be more representative than bet in terms of this grain size variation however the use of a roughness factor in the geometric surface area calculation adds to the uncertainty since it is a function of grain size drever and clow 1995 furthermore since the tailings are about 25 years old surface roughness will be considerably higher as pointed by anbeek 1992 salmon and malmstrom 2004 have pointed out in their study that surface reactivity decreases the longer the exposure of tailings to weathering agents the use of a roughness factor of 100 may therefore underestimate the surface area thus the rates while the attempt to quantify the surface area based on the different grain size may have its uncertainty due to the presence of clay minerals as suggested by drever and clow 1995 the geometric surface area is nevertheless the closest estimate that takes into account the different grain sizes present in the tailings 3 7 sensitivity analysis and model limitations sensitivity analysis was conducted by varying the initial concentrations of chemical components reaction rate constant and initial moles an increase in the initial concentrations of components resulted in increased metal release variation in the reaction order with respect to oxygen did not seem to have an effect on the resulting model a change in the time step however significantly affects the resulting models this is expected since as time step decreases the flow velocity increases which then results to less reaction time between the minerals and the infiltrating solution however varying the length of the cell to match the actual flow velocity did not significantly affect the models while there was a good fit on most components using the calculated parameters the inconsistencies in the other components are believed to be associated with the obvious limitations of this model 1 phreeqc s capability to perform multi component reactive transport modeling is based on a saturated condition our kinetic testing condition may not fully incorporate this scenario as our columns undergo a quick saturated condition and then shifting to mostly undersaturated condition until the next rinsing episode the modeling attempt rests in the assumption that transport of fluids and chemical components are repeated 65 times 2 the use of the fifth rinse as the initial solution chemistry may underestimate the weekly evolution of the effluents the continuous and steady decline in the concentration of the components cannot be accurately captured by just using this model surely there are several factors at play that must be considered as discussed below however as seen from the model and actual data this approach is considered successful 3 the use of only forsterite and pyrrhotite as the minerals controlling the effluent chemistry may bypass the contribution of other silicates present in the tailings the dissolution of other sources of mg such as enstatite and clinochlore clay minerals which may undoubtedly add to the total mg released was not taken into account 4 the phreeqc model assumes a uniform grain size as indicated by the surface area to volume ratio thus it does not take into account the observed variation in grain size which is very important in assessing the dissolution rates of the minerals through time furthermore the liberation of minerals such as pyrrhotite in this study was not taken into account by phreeqc which limits the access of dissolved oxygen to the pyrrhotite in turn this affects the resulting ni concentration in the effluent 4 conclusion simulation of kinetic test data from a ni sulfide mine tailings sample using phreeqc proved to be consistent with the observed kinetic test data when locally obtained mineral dissolution rates are used this modeling attempt further showed that it is possible to use the initial weekly effluent chemistry from kinetic testing to predict future effuent chemistry with the exception of ni the models based on the bet and geometric surface area derived dissolution rates did not significantly differ in terms of ph mg and so 4 ni showed notable difference during the initial period of the model but eventually matched the actual data which can be attributed to potential ni sorption on fe hydroxides and complex formation this modeling attempt showed the possibility of performing long term prediction of kinetic testing parameters such as ph major ions and some trace metals such that the duration of these tests can be reduced as needed acknowledgments this project was funded by the norwegian research council project no 241879 the authors are grateful for the insights and suggestions from david parkhurst during the formulation of the phreeqc models used in this effort the authors would also like to extend their gratitude to the staff of the new mexico bureau of geology xrd microprobe and chemistry laboratories thanks is likewise extended to samantha saville phoebe nicholls and jenna donatelli who helped in data collection and analysis supplementary materials supplementary material associated with this article can be found in the online version at doi 10 1016 j advwatres 2019 04 008 appendix supplementary materials image application 1 
657,modern geological modeling techniques represent anisotropic heterogeneous formations by high resolution grids which can be computationally prohibitive this motivates the upscaling process that scales up properties defined at a fine scale system to equivalent properties defined at a coarse scale system in general analytical methods are very efficient but limited to assumptions and approximations whereas numerical methods are more robust albeit more time consuming in this work we developed an analytical method to approximate numerical solutions in a finite difference scheme with periodic boundary conditions for two dimensional problem using perturbation expansion techniques and fourier analysis the method generates explicit formulas of tensorial equivalent conductivity considering heterogeneity and anisotropy of two dimensional space as well as geometry of gridblocks it is applicable for various cases with different covariance variagram models and a wide range of log conductivity variances correlation lengths rotation angles anisotropy ratios of fine grid conductivity anisotropy ratios of fine grid size and the number of fine gridblocks in a coarse gridblock the analytical method matched well with the numerical method for the estimation of the conductivity tensor hydraulic head and discharge velocity the coefficients in the analytical method need to be computed only once for any given statistics which makes the proposed method much more efficient than the numerical method keywords upscaling equivalent conductivity tensor analytical method anisotropy heterogeneity 1 introduction groundwater flow simulation requires a detailed description of spatially distributed hydraulic conductivity for geological modeling large scale geological models generated by statistical tools often consist of a large number of gridblocks which can be computationally expensive or even prohibitive in addition it is sometimes necessary to generate a large number of realizations or scenarios for uncertainty quantification and risk assessment which further increases computational burden therefore upscaling hydraulic conductivity from fine scale to coarse scale description becomes an important research aim for fluid flow in porous media the upscaling comprises the calculation of spatial averages of hydraulic conductivity over blocks of the geological model under the premise of keeping the hydraulic head and discharge velocity as accurate as possible upscaled conductivity which is also referred to as equivalent block conductivity differs from effective conductivity based on averaging over the ensemble of realizations from a stochastic point of view renard and marsily 1997 the upscaling problem has attracted a great deal of attention in the past few decades ababou et al 1989 indelman and dagan 1993 noetinger 1994 christie and blunt 2001 chen et al 2003 chen and durlofsky 2006 noetinger and zargar 2004 zhou et al 2010 boschan and noetinger 2012 dagan et al 2013 evazi and jessen 2014 li and durlofsky 2016 li et al 2016 some extensive reviews described a broad range of approaches with an exhaustive coverage of previous work wen and gómez hernández 1996 renard and marsily 1997 farmer 2002 durlofsky 2005 noetinger et al 2005 sanchez vila et al 2006 vereecken et al 2007 in general upscaling methods can be classified as analytical methods and numerical methods renard and marsily 1997 analytical methods include a series of simple averaging algorithms such as arithmetic mean harmonic mean geometric mean and power mean some researchers proposed to combine two simple averaging methods such as the arithmetic harmonic and harmonic arithmetic means as the upper and lower bounds to make the results more accurate the equivalent conductivity is then taken as a value between these two with a weighting coefficient previous studies suggested the geometric mean of the upper and lower bounds under isotropic conditions le loc h 1987 guerillot et al 1990 it was later extended from two dimensions 2d to three dimensions 3d lemouzy 1991 and from isotropic formations to anisotropic ones duquerroix et al 1993 the numerical method is implemented by solving the fluid flow equation based on the mass balance equation and darcy s law wen and gómez hernández 1996 in local upscaling approaches the fine scale problem has to be solved for each coarse gridblock the most widely utilized discretization method is probably the finite difference method commonly used boundary conditions include fixed pressure no flow boundaries and periodic boundaries actually the equivalent conductivity is not the intrinsic property of the coarse gridblock since it depends not only on the fine scale conductivities within the coarse gridblock but also on the boundary conditions around the coarse gridblock some previous works set constant heads at the left and right bounds while constant head gradient at the top and bottom bounds zhou et al 2010 or constant heads at the left and right bounds while no flow at the top and bottom bounds an additional inversion process is required to obtain the off diagonal terms in the conductivity tensor kfoury et al 2007 as another alternative the periodic boundary conditions possess some attractive features in that the upscaled conductivity is tensorial always symmetric and positive definite durlofsky 1991 on the one hand analytical methods can provide quick estimates of equivalent properties but suffer from limitations associated with assumptions or approximations on the other hand numerical methods are more general and hence more accurate for complex formations albeit at the cost of additional computational effort therefore a salient question is how to estimate the equivalent block conductivity at the same level of accuracy as in the numerical method but more efficiently and hopefully for general cases romeu and noetinger 1995 proposed an analytical method to approximate numerical results from the finite difference method with periodic boundaries however the solution just contains diagonal components in the conductivity tensor and is only applicable for isotropic media for some models off diagonal components cannot be neglected e g formations containing crossbedding layering not parallel to the coordinates in these cases the upscaled conductivity will be a full tensor with significant off diagonal components which must be accommodated for accurate prediction kasap and lake 1990 pickup et al 1994 in this study we propose a new analytical method using perturbation expansion techniques and fourier analysis for upscaling which produces tensorial equivalent conductivity as accurate as the finite difference numerical method with periodic boundary conditions in 2d space following the idea and derivation in romeu and noetinger 1995 we extended their work from diagonal tensor to full tensor conductivity in addition the analytical method accounts for heterogeneity and anisotropy of the formation as well as the geometry of the coarse gridblock and is applicable for various cases in general it is verified by the upscaled conductivity tensor and validated by the hydraulic head and discharge velocity compared to the numerical results the case studies show that the proposed method can accurately replicate results from the numerical method 2 methodology 2 1 governing equation and finite difference scheme incompressible single phase steady state flow in saturated porous media is governed by the continuity equation and darcy s law bear 1972 1 v 0 v k h where v vx vy t is the velocity vector lt 1 k is the hydraulic conductivity tensor lt 1 and h is the hydraulic head l in this study we focus on 2d problem and assume that the fine scale conductivity is a diagonal tensor i e with two components kx and ky whereas the coarse scale conductivity is a full tensor i e with four components kx ky kxy and kyx eq 1 leads to 2 k h 0 the above equation is solved with boundary conditions among which the periodic boundary conditions durlofsky 1991 are widely used 3 h y x 0 h y x l x g 1 v x y x 0 v x y x l x h x y 0 h x y l y g 2 v y x y 0 v y x y l y where lx and ly define the domain size and g 1 and g 2 are constants for head differences the most popular numerical solution for eq 2 is probably the finite difference fd method with five point scheme consider in an orthogonal grid one coarse gridblock is divided into nx ny fine gridblocks each size δx δy the internodal discharge q l 2 t 1 is approximated by the central difference scheme as 4 q x i 1 2 j t x i 1 2 j h i 1 j h i j δ x q y i j 1 2 t y i j 1 2 h i j 1 h i j δ y where tx and ty are the internodal transmissibilities l 2 t 1 from the harmonic average of two conductivities in the adjacent gridblocks 5 t x i 1 2 j δ y k i j 1 k i 1 j 1 2 1 t y i j 1 2 δ x k i j 1 k i j 1 1 2 1 then we have for eq 2 6 t x i 1 2 j h i 1 j h i j δ x t x i 1 2 j h i 1 j h i j δ x t y i j 1 2 h i j 1 h i j δ y t y i j 1 2 h i j 1 h i j δ y 0 the solution of eq 6 generates an equivalent conductivity of the coarse gridblock computed by the finite difference method as durlofsky 1991 7 k f d k x x f d k x y f d k y x f d k y y f d which satisfies 8 q x k x x f d g 1 l y l x k x y f d g 2 l y l y q y k y x f d g 1 l x l x k y y f d g 2 l x l y where q x and q y are total discharges in x and y directions respectively the four components of k fd in eq 7 are obtained by solving eq 8 twice with two different periodic boundary conditions e g g 1 1 g 2 0 and g 1 0 g 2 1 2 2 heterogeneity to solve the governing equation we need information about conductivity in space in hydrogeology the log conductivity field y ln kx is usually treated as a second order stationary gaussian random process with mean e lnkx and variance σ y 2 zhang 2002 therefore the probabilistic geometric mean of kx is 9 κ g exp e ln k x and the probabilistic arithmetic mean and variance of kx are from the property of the lognormal distribution 10 κ e k x κ g exp σ y 2 2 σ 2 κ g 2 exp σ y 2 exp σ y 2 1 κ 2 σ y 2 σ y 2 1 we consider three types of covariance functions commonly used in hydrogeology dagan 1989 11 exponential c y x 1 x 2 σ y 2 exp x 1 x 2 η x 2 y 1 y 2 η y 2 gaussian c y x 1 x 2 σ y 2 exp x 1 x 2 η x 2 y 1 y 2 η y 2 spherical c y x 1 x 2 σ y 2 1 3 u 2 u 3 2 u 1 0 u 1 u x 1 x 2 η x 2 y 1 y 2 η y 2 x y cos θ sin θ sin θ cos θ x y where η x and η y are the correlation lengths and θ is the counterclockwise rotation angle 2 3 anisotropy in some cases the conductivities or the size of the gridblock in different directions are not the same denote by aky the global anisotropy ratio of conductivity that relates the hydraulic conductivities in different directions as aky ky kx for example the vertical conductivity could be one order of magnitude less than the horizontal one denote by aly the global anisotropy ratio of fine grid size as aly δy δx it is used when the shape of the fine gridblock is a rectangle instead of a square by global we mean the anisotropy ratio is a constant for the whole space consider eq 2 in a 2d problem 12 x k x h x y k y h y 0 whose finite difference scheme is i and j are indices in x and y directions respectively 13 1 δ x k x i 1 2 j h i 1 j h i j δ x k x i 1 2 j h i j h i 1 j δ x 1 δ y k y i j 1 2 h i j 1 h i j δ y k y i j 1 2 h i j h i j 1 δ y 0 by introducing a global anisotropy coefficient 14 a y k y k x δ x δ y 2 a k y a l y 2 eq 13 becomes 15 1 δ x k x i 1 2 j h i 1 j h i j δ x k x i 1 2 j h i j h i 1 j δ x a y 1 δ x k x i j 1 2 h i j 1 h i j δ x k x i j 1 2 h i j h i j 1 δ x 0 by setting δx δx δy δx kx kx and ky aykx we have 16 x k x h x y k y h y 0 indicating that the anisotropic problem in eq 12 can be transformed to an alternative problem in eq 16 for which the finite difference scheme is with δx δy and ay ky kx 17 t x i 1 2 j h i 1 j h i j t x i 1 2 j h i 1 j h i j t y i j 1 2 h i j 1 h i j t y i j 1 2 h i j 1 h i j 0 2 4 simple averaging and upper and lower bounds here we briefly review some basic concepts for analytical upscaling methods in 2d space the arithmetic mean is 18 k a 1 n x n y i 1 n x j 1 n y k i j the harmonic mean is 19 k h 1 n x n y i 1 n x j 1 n y 1 k i j 1 the geometric mean is 20 k g i 1 n x j 1 n y k i j 1 n x n y the power mean is given by 21 k p 1 n x n y i 1 n x j 1 n y k i j ω 1 ω the arithmetic mean harmonic mean and geometric mean are special cases of the power mean with ω 1 1 and 0 respectively the arithmetic harmonic mean which is exact for the stratified formation when the flow is parallel perpendicular to the bedding is the upper lower bound for the block conductivity the geometric mean is applicable for the 2d lognormal isotropic ergodic medium matheron 1967 and more appropriate for an infinite block size or spatially uncorrelated field warren and price 1961 note that the mean values above are taken in physical space for equivalent conductivity which is different from the effective conductivity for which the mean values are taken in probability space cardwell and parsons 1945 showed that the equivalent conductivity in 2d is bounded by the harmonic mean of the arithmetic means of the local conductivities calculated over each slice of cells perpendicular to the given direction as upper bound 22 k x max μ h x μ a y 1 n x i 1 n x 1 n y j 1 n y k x i j 1 1 and the arithmetic mean of the harmonic means of the local conductivities calculated on each line of cells parallel to the given direction as lower bound 23 k x min μ a y μ h x 1 n y j 1 n y 1 n x i 1 n x k x i j 1 1 as these bounds are narrower than the arithmetic mean and harmonic mean averaging them would provide a better estimation for equivalent block conductivity with a coefficient α 0 1 as 24 k x e q k x max α k x min 1 α it is clear that the proper choice of α is the key for accurate estimation le loc h 1987 and guerillot et al 1990 proposed to take the geometric mean of the two bounds i e α 1 2 this approach was introduced to 3d by lemouzy 1991 and extended to anisotropic media by duquerroix et al 1993 some empirical formulas for choosing proper values of α are discussed later in li et al 1999 renard et al 2000 maschio and schiozer 2003 liao 2018 however the above approaches generated diagonal conductivity tensors neglecting off diagonal terms 2 5 analytical solution in this work we derive an analytical solution of full tensorial equivalent conductivity using perturbation expansion techniques and fourier analysis considering not only anisotropy but also heterogeneity we solve for equivalent block conductivity in eq 7 by approximating the numerical solution in a finite difference scheme in eq 17 detailed derivations are included in the appendices specifically appendix a provides the analytical solution of kxxfd and kyxfd in matrix form appendix b provides the analytical approximation of e kxxfd and e kyxfd for the general anisotropic correlated case the isotropic or uncorrelated cases are just special cases appendix c provides analytical expressions for the spatial averages including arithmetic harmonic geometric power law harmonic arithmetic and arithmetic harmonic means of block conductivity appendix d provides the formulas of kxx and kyx by combining all of the results above the other two terms kyy and kxy can be obtained readily by changing the boundary conditions or by rotating the coordinates below we just show the final results the diagonal term kxx is 25 e k x x f d κ g exp σ y 2 γ x x where 26 γ x x ω 1 4 n x 1 ρ 1 0 ρ n x 1 0 n x k 1 1 n x k 2 1 n y s i n 2 π k 1 n x cos 2 π k 1 n x sin 2 π k 1 n x a y sin 2 π k 2 n y ρ k 1 k 2 1 1 a y ρ x y where 27 ρ x 1 x 2 y 1 y 2 c y x 1 y 1 x 2 y 2 ρ k 1 k 2 1 n x n y x n x 1 n x 1 y n y 1 n y 1 exp i 2 π k 1 x n x k 2 y n y 1 x n x 1 y n y ρ x y ρ x y 1 n x 2 n y 2 i 1 n x j 1 n y i 1 n x j 1 n y ρ i i j j and ω is the power law average coefficient for commonly used harmonic average scheme for the interblock transmissibility ω 1 a better choice to estimate e kxxfd is to use the arithmetic harmonic mean kx max and the harmonic arithmetic mean kx min adopting the idea of upper and lower bounds in eq 24 as 28 e k x x f d e k x max α e k x min 1 α where 29 α ln e k x x f d ln e k x min ln e k x max ln e k x min γ x x 1 2 ρ x ρ x y 1 ρ x ρ y ρ x y where 30 ρ y 1 n y 2 j 1 n y j 1 n y ρ 0 j j ρ x 1 n x 2 i 1 n x i 1 n x ρ i i 0 eq 28 is preferred because it is less sensitive to σ y 2 as can be seen from eq 29 to obtain kxx for the given block by eq 28 we just need to compute the coefficient α using eq 29 as well as kx max and kx min for the given block using eqs 22 and 23 the off diagonal term kyx is 31 e k y x f d a l y κ g σ y 2 γ y x where 32 γ y x k 1 1 n x k 2 1 n y a y s i n π k 1 n x s i n π k 2 n y cos π k 1 n x cos π k 2 n y sin 2 π k 1 n x a y sin 2 π k 2 n y ρ k 1 k 2 a y 1 a y ρ x y a better choice is to use 33 e k y x f d e k x g a l y σ y 2 γ y x 1 σ y 2 ρ x y 2 to obtain kyx for the given block we just need to compute the ratio of e kyxfd e kxg using eq 33 and the geometric mean kxg for the given block using eq 20 the results for e kyyfd and e kxyfd can be obtained similarly leading to a full tensor for equivalent block conductivity note that the upscaled conductivity tensor is always symmetric as e kyxfd e kxyfd which can be clearly seen from a13 unfortunately there is no theoretical proof yet that the upscaled conductivity tensor is always positive definite however it is positive definite in various tests as will be shown in section 3 in summary we express the conductivity tensor explicitly which considers the type of covariance the variance σ y 2 the correlation lengths η x and η y the rotation angle θ the anisotropy ratio of conductivity aky ky kx the anisotropy ratio of gridblock size aly δy δx and the upscaling ratios nx and ny 3 case studies 3 1 verification by equivalent conductivity in this section the proposed analytical method is verified by the numerical method in a finite difference scheme specifically we compare equivalent block conductivities from the analytical method using eqs 28 and 33 and the numerical method considered as the reference in various cases as shown in table 1 in all cases we assume e lnkx 0 since it does not affect relative error we start from a typical base case and analyze the effect of each factor parameter for example the log conductivity variance is from 0 1 to 10 in case 1 the correlation lengths ηx ηy is from 1 to 100 in case 2 different types of covariance functions are tested in cases 9 and 10 the results are illustrated in fig 1 for cases 1 5 and fig 2 for cases 6 10 in both methods the expectations are computed by taking averages of 10 000 randomly generated realizations we can see that in general the analytical results match very well with the numerical results the main differences between the analytical results and the numerical ones appear in cases 1 9 and 10 indicating that accuracy is dominated by the variance of the log conductivity in these cases the diagonal components kxx and kyy are more accurate than the off diagonal components kyx and kxy considering that the magnitude of the diagonal components in o 1 is much larger than that of the off diagonal components in o 10 1 the differences in the off diagonal components would not affect the solutions of hydraulic head and velocity substantially as will be illustrated in section 3 2 3 2 validation by hydraulic head and velocity in this section the proposed analytical method is validated by the true reference specifically we compare the hydraulic head and velocity results from the analytical method and the numerical method in coarse scale to the true reference from the numerical method in fine scale the boundary conditions are set impervious at the top and bottom and with constant heads of 1 and 0 at the left and right respectively table 2 shows the model setup in three cases where the domain size lx ly 1 contains 100 100 fine gridblocks which is upscaled to 10 10 coarse gridblocks each consisting of 10 10 fine gridblocks fig 3 a shows one realization of the fine scale log conductivity field randomly generated using statistics for the base case in the first row of table 2 the numerical method is used to solve for the hydraulic head and velocity for this realization considered as the fine scale true reference as shown in fig 3 b d then the fine scale hydraulic head and velocity are averaged to obtain the coarse scale hydraulic head and velocity considered as the coarse scale true reference respectively as shown in fig 3 e g specifically the coarse scale hydraulic head is computed by the arithmetic average of the fine scale hydraulic heads in the coarse gridblock and the coarse scale interblock velocity is computed by the arithmetic average of the fine scale interblock velocities on the face of the coarse gridblock fig 3 h illustrates the upscaled log conductivity by the numerical method in a finite difference scheme with periodic boundary conditions it is used to solve for the coarse scale hydraulic head and velocity as shown in fig 3 i k note that the upscaled conductivity is a tensor for each coarse gridblock and thus we used the multipoint flux approximation mpfa approach aavatsmark 2002 implemented by the matlab reservoir simulation toolbox mrst lie 2014 in this study fig 3 l illustrates the upscaled log conductivity by the analytical method it is used to solve for the coarse scale hydraulic head and velocity as shown in figs 3 m o also using the mpfa approach we can see that the analytical results are almost identical to the numerical results both of which are very close to the true references fig 4 depicts the scatter plots of numerical results analytical results and true references for three variables i e hydraulic head x velocity and y velocity the coefficient of determination r 2 is adopted to compare different methods quantitatively in general the better the estimated value matches the reference value the closer the value of r 2 is to 1 fig 4 a shows that the numerical results match the exact values of the hydraulic head very well fig 4 b and c reveal that the numerical results of the x and y velocities are not as good as those of the hydraulic head similar results are observed for the analytical methods as in figs 4 d f for each variable the patterns of the scatter plots are also very similar in the first row and the second row and the r 2 values are almost the same figs 4 g i compare the numerical results and the analytical results it is seen that r 2 0 99 for all variables indicating that the numerical results are successfully replicated by the analytical method we also computed the total velocity in the x direction the exact value is 1 18 lt 1 the numerical result is 1 13 lt 1 and the analytical result is also 1 13 lt 1 both of which have approximately 4 error this means that the global effect of the fluid flow is captured well in upscaling either numerically or analytically for the upscaling step i e computing the equivalent conductivity the cpu time for the numerical method is 0 2 s and the cpu time for the analytical method is 0 01 s including 0 003 s for the coefficients α in eq 29 and γ yx in eq 32 and 0 007 s for the rest formulas as in eqs 28 and 33 these tests are programed by matlab with vectorization and performed on i7 6700k cpu 4 00 ghz we can see that the analytical method is 20 times faster than the numerical one in this example in addition although the formulas as in eqs 29 and 32 appear to be complicated the computations are actually very fast we then considered another case by changing the correlation lengths and rotation angle case 11 in the second row of table 2 the results are illustrated in figs 5 and 6 again the analytical results and the numerical results have negligible differences and both are very close to the true references for total velocity in the x direction the exact value is 0 837 lt 1 the numerical result is 0 814 lt 1 and the analytical result is also 0 814 lt 1 both of which have approximately 3 error in the last case we tested an extremely large variance σ y 2 10 case 12 in the third row of table 2 fig 7 a shows one realization of the fine scale log conductivity field with values from 8 to 8 which is quite challenging for both the numerical and analytical method fig 7 shows that the upscaled results are still close to the true references the r 2 values presented in fig 8 are unsurprisingly smaller less accurate than those in the previous cases nevertheless for total velocity in the x direction the exact value is 1 46 lt 1 the numerical result is 1 55 lt 1 and the analytical result is 1 56 lt 1 both of which have approximately 6 error it can be seen that although the analytical method is derived using the first order approximation it can reproduce the results from the numerical method even for very large variances this is due to two reasons adopting the landau lifshitz conjecture landau and lifshitz 1960 and using the upper and lower bounds as in eq 28 3 3 effect of upscaling ratios to analyze the effect of upscaling ratios nx and ny we randomly generate a realization of log conductivity field of size 128 128 blocks following an exponential covariance function with σ2 ln k 1 ηx ηx 8 aky 1 and aly 1 varieties of upscaling ratios nx and ny at 2 4 8 16 32 and 64 are tested with a total number of combinations at 6 6 36 hence we would not show the detailed results of head and velocities as in figs 3 8 instead we compute the coefficient of determination r 2 for each case fig 9 shows that the heads are generally accurate and it is more difficult to match the velocities the first row and the second row are most the same which is confirmed by the third row where the values of r 2 are very close to 1 indicating the analytical results and the numerical results are almost identical the velocity results in fig 9 b f reveal that it is suggested that the upscaling ratios in x and y directions are close as nx ny which is reasonable since a large difference in the upscaling ratios may lead to instability some researches show that it is favorable to adapt the coarse grid to geological heterogeneity where the upscaling ratio is not constant anymore we expect our method to be combined with the idea of adaptive grid since the formula is a function of upscaling ratios interested readers may refer to preux 2016 for more information 3 4 scale dependent variance of log conductivity the perturbation expansion techniques can be utilized to derive the expression for the scale dependent variance of coarse scale by power law average of conductivity log conductivity 34 σ y c 2 e ln k x p o w e r e ln k x p o w e r 2 e ln k x p o w e r 2 e ln k x p o w e r 2 from eq c2 we have 35 ln k x p o w e r ln κ β ω 1 2 β 2 1 ω 2 β 2 substituting eq 35 into eq 34 36 σ y c 2 e β ω 1 2 β 2 1 ω 2 β 2 2 e β ω 1 2 β 2 1 ω 2 β 2 2 using eq c4 and low order approximation 37 σ y c 2 σ y 2 ρ x y where ρ x y is defined in eq 27 note that eq 37 is in general and not related to the power ω in the power law average to verify this analytical solution we use different size of coarse square gridblocks with nx ny 1 2 4 8 16 32 64 for each size we generate 10 000 random fields following an exponential or gaussian covariance function with σ y 2 0 1 aky 1 and aly 1 we consider an isotropic case ηx ηy 4 and an anisotropic case ηx 4 ηy 40 we compute the geometric arithmetic and harmonic means of the coarse block conductivity then calculate the ratio of the log conductivity variance in the coarse gridblock and the log conductivity variance in the fine gridblock the analytical results overlap the numerical results for both isotropic case and an anisotropic case as shown in fig 10 3 5 five spot pattern in previous tests we set constant heads at the left and right bounds while no flow at the top and bottom bounds in this section we test the proposed method in a five spot pattern with one injection well in the center and four production wells in four corners assume a unit square domain consists of 75 75 fine gridblocks following an exponential covariance function with σ2 ln k 1 ηx 20 ηx 5 θ 45 aky 1 and aly 1 the upscaling ratios are nx ny 5 leading to 15 15 coarse gridblocks specifically the locations of the wells for the fine gridblocks are 38 38 3 3 3 73 73 3 73 73 the locations of the wells for the coarse gridblocks are 8 8 1 1 1 15 15 1 15 15 constant heads are assigned to the wells as h 1 for the injection well and h 0 for the production wells one realization is randomly generated and upscaled then solved by running mrst lie 2014 which uses peaceman s equation peaceman 1983 for the well treatment fig 11 illustrates the results of log conductivity hydraulic head velocity and streamline the upscaled log conductivities capture the high value and low value regions the x velocity is almost negative on the left hand side and positive on the right hand side since the injection well is in the center the upscaled streamlines are denser in the bottom left corner and sparser in the top left corner due to the difference of log conductivities fig 12 depicts the scatter plots of numerical results analytical results and true references we can see again that the proposed analytical upscaling method matches very well with the numerical upscaling method 4 discussions the influence of the scale of the underlying fine scale conductivity field is an interesting topic tartakovsky et al 2017 to this goal the proposed method is shown to be valid in various upscaling ratios from 2 2 to 64 64 in addition our method provides a possible way to explain the scale dependent phenomenon of flow in porous media specifically we may consider the drift component after subtracting the expectation from the original term and then obtain the variance and variogram in particular an analytical expression for the scale dependent variance of log conductivity as a function of covariance model and upscaling ratio is derived in this work which has been successfully validated by the numerical results in addition the formulas of tensor conductivity in eqs 28 and 33 can be used to estimate the bias of kfd compared to kg by computing ln e k f d k g σ y 2 as in romeu and noetinger 1995 with the extensions of including the off diagonal terms kxy and kyx as well as considering the effects of anisotropy and geometry extending the framework from saturated single phase flow to multiphase flow or unsaturated flow is also discussed here considering multiphase flow as an example there are two approaches in general to determine the relative permeabilities steady state approach and dynamic approach it would be easier to combine the former steady state approach and the proposed framework specifically for two phase flow system given certain values for the saturation at boundaries we need to solve two sets of governing equations one for each phase analytically then the upscaled conductivity or permeability for each phase will be used to calculate the relative permeability of the coarse gridblock as a function of saturation previous results show that the landau lifshitz conjecture is confirmed with the accuracy up to second or fourth order terms depending on the conditions in the log conductivity variance however the discrepancy with the results from a high order approximation using perturbation expansion especially for non gaussian random fields or anisotropic media is reported in the work by indelman and abramovich 1994 abramovich and indelman 1995 de wit 1995 noetinger 2000 stepanyants and teodorovich 2003 nevertheless the landau lifshitz conjecture provides an estimation of equivalent conductivity with less than 1 error for log conductivity variance up to 3 de wit 1995 including high order terms in the derivation with improved accuracy will be the subject of future work the proposed method is shown to be accurate in problems with structured and orthogonal grids where the log conductivity field is a gaussian random field with known mean and covariance function these conditions are related to the assumptions made in the derivation possible extension to unstructured grids requires other models e g the finite analytic techniques which is based upon the power law analytic nodal solution in the angular domain with arbitrary shape and has been shown to be super converging and independent of the conductivity heterogeneity wang et al 2017 2018 zheng et al 2017 we also tested the proposed method in a channelized reservoir in the spe10 benchmark example the results from the analytical upscaling method is still close to the results from the numerical upscaling method however both are inaccurate compared to the reference this is because the local upscaling approaches as the analytical and numerical methods in this study may not be suitable for channelized reservoirs whereas extended local or global approaches are required a possible solution is to first smoothen the conductivity and then upscale it by the proposed method another type of non gaussian fields is related to the concept of truncated fractals formed by a gaussian random function with a truncated power variogram guadagnini et al 2018 in general extending the proposed framework to unstructured grids or non gaussian fields requires further investigation 5 conclusions in this study we proposed a new analytical method for upscaling of hydraulic conductivity in 2d anisotropic heterogeneous formations this method takes many factors into account including type of covariance log conductivity variance correlation lengths rotation angle anisotropy ratio of conductivity anisotropy ratio of gridblock size and upscaling ratios in x and y directions using perturbation expansion techniques and fourier analysis the analytical method provides explicit formulas for the equivalent block conductivity tensor as computed by the numerical method in a finite difference scheme with periodic boundary conditions the derivations in appendices a and b are similar to the work by romeu and noetinger 1995 who presented an analytical method for equivalent conductivity of isotropic media here we extended the method to anisotropic media for general conditions considering the effect of correlation lengths rotation angle anisotropy ratios of conductivity and fine grid size we also considered the effect of the number of fine gridblocks in a rectangle coarse gridblock in addition we presented solutions for off diagonal components kyx and kxy in the conductivity tensor furthermore for diagonal components kxx and kyy we proposed to use the upper and lower bounds k max and k min with coefficient α which is determined analytically from the statistics of the log conductivity random field this approach is preferred because the results are less sensitive to input variance we tested the proposed method in various cases and analyzed the effect of each factor as above the analytical method matched well with the numerical method in all cases for the estimation of the conductivity tensor we also computed the hydraulic head and velocity in three typical realizations the analytical method reproduced the results from the numerical method successfully even for an extremely large variance up to 10 furthermore we tested the method in a five spot pattern other than the constant head no flow boundary conditions although the formulas appear to be complicated the computations are very fast 20 times faster than numerical methods as shown in the example moreover they are computed once for all coarse gridblocks in one realization even if we generate multiple realizations of the conductivity fields using the same statistics e g to quantify uncertainty or analyze sensitivity we still just need to compute the formulas once for all realizations this is clearly favorable and naturally leads to improved efficiency of the proposed method over the numerically upscaling method besides the method can be extended from 2d to 3d which is currently being explored acknowledgments the authors would like to acknowledge the funding support provided by the national natural science foundation of china grant no 51604013 and the state major science and technology special project of china during the 13th five year plan grant no 2016zx05025 003 007 appendix a analytical solutions of kxxfd and kyxfd in matrix form denote by t the transmissibility and h the hydraulic head solving the 2d finite difference linear system in eq 17 with δx δy and ay ky kx as hereafter we neglect the symbol a1 t x i 1 2 j h i 1 j h i j t x i 1 2 j h i 1 j h i j t y i j 1 2 h i j 1 h i j t y i j 1 2 h i j 1 h i j 0 for a coarse gridblock i j 1 i nx 1 j ny under periodic boundary conditions in eq 3 with g 1 1 g 2 0 corresponds to minimizing a2 ξ i 1 n x j 1 n y t x i 1 2 j h i 1 j h i j 2 t y i j 1 2 h i j 1 h i j 2 where h i j is subject to a3a h n x 1 j h 1 j 1 a3b h i n y 1 h i 1 based on the perturbation theory hi j can be expressed as a4 h i j h i j h i j i 0 5 n x h i j combining a2 and a4 we have a5 ξ i 1 n x j 1 n y t x i 1 2 j h i 1 j h i j 2 t y i j 1 2 h i j 1 h i j 2 2 n x i 1 n x j 1 n y t x i 1 2 j h i 1 j h i j c where c is an irrelevant constant for minimization to convert a5 into matrix format we define the following a6 h h 1 1 h 2 1 h n x 1 h 1 2 h n x n y t t x t x 1 1 2 1 t x 2 1 2 1 t x n x 1 2 1 t x 1 1 2 2 t x n x 1 2 n y 0 0 0 t d d i a g t x 1 1 2 1 t x 2 1 2 1 t x n x 1 2 n y t y 1 1 1 2 t y 2 1 1 2 t y n x n y 1 2 δ x h i j h i 1 j h i j δ y h i j h i j 1 h i j δ δ y δ y t δ t δ h i j h i 1 j h i 1 j h i j 1 h i j 1 4 h i j where h is a nxny 1 column vector containing the nxny value of h tx is a 2nxny 1 column vector containing the nxny value of tx and nxny zeros instead of the nxny value of ty d is a 2nxny 2nxny diagonal matrix containing both tx and ty and δ x and δ y are nxny nxny finite difference operators in x and y directions respectively δ is a 2nxny nxny rectangular matrix that performs finite difference in both directions δ t δ is the finite difference laplacian operator and the superscript t indicates transpose using a6 a5 can be expressed as a7 ξ δ h t d δ h 2 n x δ h t t x c the solution for this minimization problem is a8 h 1 n x δ t d δ 1 δ t t x consider the total discharge in the x direction using a3a and δx δy q x t o t a l k x x f d l y h n x 1 j h 1 j l x k x x f d n y n x on the other hand from the finite difference solution q x t o t a l j 1 n y t x i 1 2 j h i 1 j h i j i therefore the hydraulic conductivity in the x direction i e diagonal component in conductivity tensor is a9 k x x f d n x n y j 1 n y t x i 1 2 j h i 1 j h i j i 1 n y i 1 n x j 1 n y t x i 1 2 j h i 1 j h i j 1 n x n y i 1 n x j 1 n y t x i 1 2 j 1 n y i 1 n x j 1 n y t x i 1 2 j h i 1 j h i j t x a 1 n y t x t δ h t x a 1 n x n y t x t δ δ t d δ 1 δ t t x where txa indicates the arithmetic average of tx using a global anisotropy coefficient ay defined in eq 14 for a slightly perturbed medium specifically we need b4 with the first order approximation to obtain ty tx ky kx ay a10 t x t x a 1 1 0 δ t x δ t x t x a 1 1 0 d t x a i 1 a y δ d δ d i 1 a y δ t t δ t δ t δ t d δ 1 1 t x a δ t i 1 a y δ d δ 1 1 t x a δ t i 1 a y δ 1 where 1 1 0 is a 2nxny 1 column vector containing nxny ones followed by nxny zeros and i 1 ay is a 2nxny 2nxny diagonal matrix containing nxny ones followed by the nxny value of ay s inserting a10 in a9 produces a11 k x x f d t x a 1 n x n y t x a δ t x t δ δ t i 1 a y δ 1 δ t δ t x similarly consider the total discharge in the y direction using a3a q y t o t a l k y x f d l x h n x 1 j h 1 j l x k y x f d on the other hand from the finite difference solution q y t o t a l i 1 n x t y i j 1 2 h i j 1 h i j j therefore the hydraulic conductivity in the y direction is a12 k y x f d i 1 n x t y i j 1 2 h i j 1 h i j j 1 n y j 1 n y i 1 n x t y i j 1 2 h i j 1 h i j 1 n y j 1 n y i 1 n x t y i j 1 2 h i j 1 h i j 1 n y t y t δ h 1 n x n y t y t δ δ t d δ 1 δ t t x where ty is a 2nxny 1 column vector containing nxny zeros instead of the nxny value of tx and the nxny value of ty after approximation as in a10 we have a13 k y x f d 1 n x n y t x a δ t y t δ δ t i 1 a y δ 1 δ t δ t x appendix b analytical solutions of e kxxfd and e kyxfd for anisotropic correlated field the expectation of kfd is solved analytically for the general case i e the anisotropic correlated case whereas the isotropic or uncorrelated cases can be derived easily by considering them as special cases the conductivity is assumed to be a random function with mean and covariance as b1 e k x i j κ c o v k x i j k x i j σ 2 ρ i i j j σ 2 c y i j i j we want to solve the diagonal conductivity kxx from appendix a b2 e k x x f d e t x a e ℑ where b3a t x a 1 n x n y i 1 n x j 1 n y t x i 1 2 j b3b ℑ 1 n x n y t x a δ t x t δ δ t i 1 a y δ 1 δ t δ t x to solve for e txa we first analyze t x i 1 2 j assuming kx i j κ 1 β i j and using the expansion 1 x ω 1 ωx 1 2 ω ω 1 x 2 o x 2 we have b4 t x i 1 2 j k x i j ω k x i 1 j ω 2 1 ω κ 1 ω 2 β i j β i 1 j ω ω 1 4 β i j 2 β i 1 j 2 1 ω κ 1 1 2 β i j β i 1 j ω 1 8 β i j β i 1 j 2 for the special case of harmonic average we just need to set ω 1 in b4 and following equations therefore the first part of b2 is b5 e t x a e 1 n x n y i 1 n x j 1 n y t x i 1 2 j κ n x n y e i 1 n x j 1 n y 1 1 2 β i j β i 1 j ω 1 8 β i j β i 1 j 2 κ n x n y e i 1 n x j 1 n y 1 ω 1 4 β i j 2 β i j β i 1 j κ 1 ω 1 σ 2 4 κ 2 1 n x 1 ρ 1 0 ρ n x 1 0 n x then we solve for the second part of b2 using fourier transform in 2d space a function f e g transmissibility or conductivity in the fourier base can be expressed as b6a f i j k 1 1 n x k 2 1 n y exp i 2 π k 1 i n x k 2 j n y f k 1 k 2 i 1 b6b f k 1 k 2 1 n x n y i 1 n x j 1 n y exp i 2 π k 1 i n x k 2 j n y f i j consider a function b7 φ k 1 k 2 i j exp i 2 π k 1 i n x k 2 j n y then b8 δ φ k 1 k 2 exp i 2 π k 1 n x 1 φ k 1 k 2 exp i 2 π k 2 n y 1 φ k 1 k 2 b9 δ t i 1 a y δ φ k 1 k 2 exp i 2 π k 1 n x 1 exp i 2 π k 1 n x 1 a y exp i 2 π k 2 n y 1 exp i 2 π k 2 n y 1 φ k 1 k 2 using exp i2θ 1 2iexp iθ sin θ b9 becomes b10 δ t i 1 a y δ φ k 1 k 2 4 sin 2 π k 1 n x a y sin 2 π k 2 n y φ k 1 k 2 therefore b11 δ δ t i 1 a y δ 1 δ t φ k 1 k 2 s i n 2 π k 1 n x sin 2 π k 1 n x a y sin 2 π k 2 n y φ k 1 k 2 substitute b11 into b3b we have b12 ℑ 1 t x a k 1 1 n x k 2 1 n y s i n 2 π k 1 n x sin 2 π k 1 n x a y sin 2 π k 2 n y δ t x k 1 k 2 2 considering the first order approximation in b4 and b6 we have b13 δ t x k 1 k 2 1 n x n y i 1 n x j 1 n y exp i 2 π k 1 i n x k 2 j n y δ t x i j 1 n x n y i 1 n x j 1 n y exp i 2 π k 1 i n x k 2 j n y δ k x i j δ k x i 1 j 2 1 n x n y i 1 n x j 1 n y exp i 2 π k 1 i n x k 2 j n y δ k x i j 2 1 exp i 2 π k 1 n x using exp i2θ 1 2exp iθ cos θ we have b14 δ t x k 1 k 2 δ k x k 1 k 2 1 2 1 exp i 2 π k 1 n x δ k x k 1 k 2 cos π k 1 n x inserting b14 in b12 gives b15 ℑ 1 t x a k 1 1 n x k 2 1 n y s i n 2 π k 1 n x cos 2 π k 1 n x sin 2 π k 1 n x a y sin 2 π k 2 n y δ k x k 1 k 2 2 to compute e ℑ we need to address e δ k x k 1 k 2 2 using b6b it is b16 e δ k x k 1 k 2 2 1 n x 2 n y 2 i 1 n x j 1 n y i 1 n x j 1 n y exp i 2 π k 1 i i n x k 2 j j n y e δ k x i j δ k x i j denote kxa as the spatial arithmetic mean of kxi j since δkx i j kx i j kxa kx i j κ kxa κ we have b17 e δ k x i j δ k x i j c o v k x i j k x i j v a r k x a where b18a c o v k x i j k x i j σ 2 ρ i i j j b18b v a r k x a σ 2 n x 2 n y 2 i 1 n x j 1 n y i 1 n x j 1 n y ρ i i j j σ 2 ρ x y where b19 ρ x y 1 n x 2 n y 2 i 1 n x j 1 n y i 1 n x j 1 n y ρ i i j j substituting b18a in b17 and then in b16 gives the first part of b16 as since ρ is an even function b20 σ 2 n x 2 n y 2 i 1 n x j 1 n y i 1 n x j 1 n y exp i 2 π k 1 i i n x k 2 j j n y ρ i i j j σ 2 n x 2 n y 2 i 1 n x j 1 n y x i n x i 1 y j n y j 1 exp i 2 π k 1 x n x k 2 y n y ρ x y σ 2 n x n y x n x 1 n x 1 y n y 1 n y 1 exp i 2 π k 1 x n x k 2 y n y 1 x n x 1 y n y ρ x y σ 2 ρ k 1 k 2 where b21 ρ k 1 k 2 1 n x n y x n x 1 n x 1 y n y 1 n y 1 exp i 2 π k 1 x n x k 2 y n y 1 x n x 1 y n y ρ x y substituting b18b in b17 and then in b16 gives the second part of b16 as b22 σ 2 ρ x y n x 2 n y 2 i 1 n x j 1 n y i 1 n x j 1 n y exp i 2 π k 1 i i n x k 2 j j n y σ 2 ρ x y k 1 n x k 2 n y 0 o t h e r w i s e combining b15 b20 and b22 yields b23 e ℑ 1 e t x a k 1 1 n x k 2 1 n y s i n 2 π k 1 n x cos 2 π k 1 n x sin 2 π k 1 n x a y sin 2 π k 2 n y e δ k x k 1 k 2 2 σ 2 κ k 1 1 n x k 2 1 n y s i n 2 π k 1 n x cos 2 π k 1 n x sin 2 π k 1 n x a y sin 2 π k 2 n y ρ k 1 k 2 1 1 a y ρ x y inserting b5 and b23 into b2 we obtain the final results for kxx b24 e k x x f d e t x a e ℑ κ σ 2 κ ω 1 4 n x 1 ρ 1 0 ρ n x 1 0 2 n x k 1 1 n x k 2 1 n y s i n 2 π k 1 n x cos 2 π k 1 n x sin 2 π k 1 n x a y sin 2 π k 2 n y ρ k 1 k 2 1 1 a y ρ x y where ρ x y and ρ k 1 k 2 are described in b19 and b21 respectively similarly for the off diagonal conductivity kyx from a13 we have b25 e k y x f d e 1 n x n y t x a δ t y t δ δ t i 1 a y δ 1 δ t δ t x 1 t x a k 1 1 n x k 2 1 n y s i n π k 1 n x s i n π k 2 n y sin 2 π k 1 n x a y sin 2 π k 2 n y δ t x k 1 k 2 δ t y k 1 k 2 1 t x a k 1 1 n x k 2 1 n y a y s i n π k 1 n x s i n π k 2 n y cos π k 1 n x cos π k 2 n y sin 2 π k 1 n x a y sin 2 π k 2 n y δ k x k 1 k 2 2 σ 2 κ k 1 1 n x k 2 1 n y a y s i n π k 1 n x s i n π k 2 n y cos π k 1 n x cos π k 2 n y sin 2 π k 1 n x a y sin 2 π k 2 n y ρ k 1 k 2 a y 1 a y ρ x y appendix c spatial averages of block conductivity for the spatial average of kx it is well known that the arithmetic harmonic and geometric averages are special cases of power law average as c1 k x p o w e r 1 n x n y i 1 n x j 1 n y k x i j ω 1 ω ω 1 a r i t h m e t i c ω 0 g e o m e t r i c ω 1 h a r m o n i c assume kx i j κ 1 β i j and use the expansion 1 x ω 1 ωx 1 2 ω ω 1 x 2 o x 2 then c2 k x p o w e r κ 1 n x n y i 1 n x j 1 n y 1 β i j ω 1 ω κ 1 n x n y i 1 n x j 1 n y 1 ω β i j ω ω 1 2 β i j 2 1 ω κ 1 β ω ω 1 2 β 2 1 ω κ 1 β ω 1 2 β 2 1 ω 2 β 2 where c3a β 1 n x n y i 1 n x j 1 n y β i j c3b β 2 1 n x n y i 1 n x j 1 n y β i j 2 from eqs 10 and b18 for small σ y 2 c4a e β 0 c4b e β 2 σ 2 κ g 2 σ y 2 c4c e β 2 σ 2 ρ x y κ g 2 σ y 2 ρ x y combining c2 and c4 yields c5 e k x p o w e r κ 1 ω 1 2 σ y 2 1 ω 2 σ y 2 ρ x y consider c5 as the sum of the first two terms in a series expansion of an exponential function we have using eq 10 c6 e k x p o w e r κ g exp σ y 2 2 exp ω 1 2 σ y 2 1 ω 2 σ y 2 ρ x y κ g exp σ y 2 ω 2 1 ω 2 ρ x y this generalization to obtain an expression valid for large variance σ y 2 usually referred to as the landau lifshitz conjecture landau and lifshitz 1960 is well known in hydrogeology matheron 1967 gelhar and axness 1983 zhang 2002 from c1 and c6 the expectations of arithmetic harmonic and geometric spatial averages of kx are c7a e k x a κ g exp σ y 2 2 κ c7b e k x h κ g exp σ y 2 1 2 ρ x y c7c e k x g κ g exp σ y 2 ρ x y 2 next we analyze the harmonic means of the arithmetic mean of the local conductivities also the upper bound c8 k x max μ h x μ a y 1 n x i 1 n x 1 n y j 1 n y k x i j 1 1 κ 1 n x i 1 n x 1 n y j 1 n y 1 β i j 1 1 κ 1 n x i 1 n x 1 1 n y j 1 n y β i j 1 n y j 1 n y β i j 2 1 κ 1 1 n x n y i 1 n x j 1 n y β i j 1 n x i 1 n x 1 n y j 1 n y β i j 2 1 κ 1 β 1 n x i 1 n x β i 2 1 κ 1 β 1 n x i 1 n x β i 2 β 2 where c9 β i 1 n y j 1 n y β i j using the landau lifshitz conjecture c8 becomes c10 e k x max κ e 1 β 1 n x i 1 n x β i 2 β 2 κ g exp σ y 2 2 exp σ y 2 ρ y σ y 2 ρ x y κ g exp σ y 2 1 2 ρ y ρ x y where c11 ρ y 1 n y 2 j 1 n y j 1 n y ρ 0 j j similarly we analyze the arithmetic mean of the harmonic means of the local conductivities also the lower bound c12 k x min μ a y μ h x 1 n y j 1 n y 1 n x i 1 n x k x i j 1 1 κ n y j 1 n y 1 n x i 1 n x 1 β i j 1 1 κ n y j 1 n y 1 1 n x i 1 n x β i j 1 n x i 1 n x β i j 2 1 κ n y j 1 n y 1 β j β j 2 1 κ n y j 1 n y 1 β j β j 2 β j 2 κ 1 1 n y j 1 n y β j 1 n y j 1 n y β j 2 1 n y j 1 n y β j 2 where c13 β j 1 n x i 1 n x β i j β j 2 1 n x i 1 n x β i j 2 thus the expectation of c12 is using the landau lifshitz conjecture c14 e k x min κ e 1 1 n y j 1 n y β j 1 n y j 1 n y β j 2 1 n y j 1 n y β j 2 κ g exp σ y 2 2 exp σ y 2 σ y 2 ρ x κ g exp σ y 2 1 2 ρ x where c15 ρ x 1 n x 2 i 1 n x i 1 n x ρ i i 0 appendix d using conductivity ratio and upper and lower bounds we would like to relate all types of mean conductivities to the geometric spatial mean e kxg in c7c first let us consider e kxxfd using eqs 10 and b24 with first order approximation d1 e k x x f d κ g 1 σ y 2 γ x x where d2 γ x x ω 1 4 n x 1 ρ 1 0 ρ n x 1 0 n x k 1 1 n x k 2 1 n y s i n 2 π k 1 n x cos 2 π k 1 n x sin 2 π k 1 n x a y sin 2 π k 2 n y ρ k 1 k 2 1 1 a y ρ x y using the landau lifshitz conjecture d3 e k x x f d κ g exp σ y 2 γ x x from d3 and c7c d4 e k x x f d e k x g exp σ y 2 γ x x exp σ y 2 ρ x y 2 exp σ y 2 γ x x ρ x y 2 as for e kx max and e kx min combining c7c c10 and c14 we have d5 e k x max e k x g exp σ y 2 1 2 ρ y ρ x y 2 e k x min e k x g exp σ y 2 1 2 ρ x ρ x y 2 finally we can express e kxxfd by e kx max and e kx min d6 e k x x f d e k x max α e k x min 1 α where α is determined by d4 and d5 as d7 α ln e k x x f d ln e k x min ln e k x max ln e k x min γ x x ρ x y 2 1 2 ρ x ρ x y 2 1 2 ρ y ρ x y 2 1 2 ρ x ρ x y 2 γ x x 1 2 ρ x ρ x y 1 ρ x ρ y ρ x y similarly for e kyxfd using eqs 10 and b25 with first order approximation d8 e k y x f d κ g σ y 2 γ y x where d9 γ y x k 1 1 n x k 2 1 n y a y s i n π k 1 n x s i n π k 2 n y cos π k 1 n x cos π k 2 n y sin 2 π k 1 n x a y sin 2 π k 2 n y ρ k 1 k 2 a y 1 a y ρ x y note that the above kyx is for square gridblocks where δx δy thus the kyx for rectangular gridblocks where δy aly δx is d10 e k y x f d a l y κ g σ y 2 γ y x from d7 and c7c we have since the first order approximation is used for kyx it should be used for kxg as well d11 e k y x f d e k x g a l y σ y 2 γ y x exp σ y 2 ρ x y 2 a l y σ y 2 γ y x 1 σ y 2 ρ x y 2 
657,modern geological modeling techniques represent anisotropic heterogeneous formations by high resolution grids which can be computationally prohibitive this motivates the upscaling process that scales up properties defined at a fine scale system to equivalent properties defined at a coarse scale system in general analytical methods are very efficient but limited to assumptions and approximations whereas numerical methods are more robust albeit more time consuming in this work we developed an analytical method to approximate numerical solutions in a finite difference scheme with periodic boundary conditions for two dimensional problem using perturbation expansion techniques and fourier analysis the method generates explicit formulas of tensorial equivalent conductivity considering heterogeneity and anisotropy of two dimensional space as well as geometry of gridblocks it is applicable for various cases with different covariance variagram models and a wide range of log conductivity variances correlation lengths rotation angles anisotropy ratios of fine grid conductivity anisotropy ratios of fine grid size and the number of fine gridblocks in a coarse gridblock the analytical method matched well with the numerical method for the estimation of the conductivity tensor hydraulic head and discharge velocity the coefficients in the analytical method need to be computed only once for any given statistics which makes the proposed method much more efficient than the numerical method keywords upscaling equivalent conductivity tensor analytical method anisotropy heterogeneity 1 introduction groundwater flow simulation requires a detailed description of spatially distributed hydraulic conductivity for geological modeling large scale geological models generated by statistical tools often consist of a large number of gridblocks which can be computationally expensive or even prohibitive in addition it is sometimes necessary to generate a large number of realizations or scenarios for uncertainty quantification and risk assessment which further increases computational burden therefore upscaling hydraulic conductivity from fine scale to coarse scale description becomes an important research aim for fluid flow in porous media the upscaling comprises the calculation of spatial averages of hydraulic conductivity over blocks of the geological model under the premise of keeping the hydraulic head and discharge velocity as accurate as possible upscaled conductivity which is also referred to as equivalent block conductivity differs from effective conductivity based on averaging over the ensemble of realizations from a stochastic point of view renard and marsily 1997 the upscaling problem has attracted a great deal of attention in the past few decades ababou et al 1989 indelman and dagan 1993 noetinger 1994 christie and blunt 2001 chen et al 2003 chen and durlofsky 2006 noetinger and zargar 2004 zhou et al 2010 boschan and noetinger 2012 dagan et al 2013 evazi and jessen 2014 li and durlofsky 2016 li et al 2016 some extensive reviews described a broad range of approaches with an exhaustive coverage of previous work wen and gómez hernández 1996 renard and marsily 1997 farmer 2002 durlofsky 2005 noetinger et al 2005 sanchez vila et al 2006 vereecken et al 2007 in general upscaling methods can be classified as analytical methods and numerical methods renard and marsily 1997 analytical methods include a series of simple averaging algorithms such as arithmetic mean harmonic mean geometric mean and power mean some researchers proposed to combine two simple averaging methods such as the arithmetic harmonic and harmonic arithmetic means as the upper and lower bounds to make the results more accurate the equivalent conductivity is then taken as a value between these two with a weighting coefficient previous studies suggested the geometric mean of the upper and lower bounds under isotropic conditions le loc h 1987 guerillot et al 1990 it was later extended from two dimensions 2d to three dimensions 3d lemouzy 1991 and from isotropic formations to anisotropic ones duquerroix et al 1993 the numerical method is implemented by solving the fluid flow equation based on the mass balance equation and darcy s law wen and gómez hernández 1996 in local upscaling approaches the fine scale problem has to be solved for each coarse gridblock the most widely utilized discretization method is probably the finite difference method commonly used boundary conditions include fixed pressure no flow boundaries and periodic boundaries actually the equivalent conductivity is not the intrinsic property of the coarse gridblock since it depends not only on the fine scale conductivities within the coarse gridblock but also on the boundary conditions around the coarse gridblock some previous works set constant heads at the left and right bounds while constant head gradient at the top and bottom bounds zhou et al 2010 or constant heads at the left and right bounds while no flow at the top and bottom bounds an additional inversion process is required to obtain the off diagonal terms in the conductivity tensor kfoury et al 2007 as another alternative the periodic boundary conditions possess some attractive features in that the upscaled conductivity is tensorial always symmetric and positive definite durlofsky 1991 on the one hand analytical methods can provide quick estimates of equivalent properties but suffer from limitations associated with assumptions or approximations on the other hand numerical methods are more general and hence more accurate for complex formations albeit at the cost of additional computational effort therefore a salient question is how to estimate the equivalent block conductivity at the same level of accuracy as in the numerical method but more efficiently and hopefully for general cases romeu and noetinger 1995 proposed an analytical method to approximate numerical results from the finite difference method with periodic boundaries however the solution just contains diagonal components in the conductivity tensor and is only applicable for isotropic media for some models off diagonal components cannot be neglected e g formations containing crossbedding layering not parallel to the coordinates in these cases the upscaled conductivity will be a full tensor with significant off diagonal components which must be accommodated for accurate prediction kasap and lake 1990 pickup et al 1994 in this study we propose a new analytical method using perturbation expansion techniques and fourier analysis for upscaling which produces tensorial equivalent conductivity as accurate as the finite difference numerical method with periodic boundary conditions in 2d space following the idea and derivation in romeu and noetinger 1995 we extended their work from diagonal tensor to full tensor conductivity in addition the analytical method accounts for heterogeneity and anisotropy of the formation as well as the geometry of the coarse gridblock and is applicable for various cases in general it is verified by the upscaled conductivity tensor and validated by the hydraulic head and discharge velocity compared to the numerical results the case studies show that the proposed method can accurately replicate results from the numerical method 2 methodology 2 1 governing equation and finite difference scheme incompressible single phase steady state flow in saturated porous media is governed by the continuity equation and darcy s law bear 1972 1 v 0 v k h where v vx vy t is the velocity vector lt 1 k is the hydraulic conductivity tensor lt 1 and h is the hydraulic head l in this study we focus on 2d problem and assume that the fine scale conductivity is a diagonal tensor i e with two components kx and ky whereas the coarse scale conductivity is a full tensor i e with four components kx ky kxy and kyx eq 1 leads to 2 k h 0 the above equation is solved with boundary conditions among which the periodic boundary conditions durlofsky 1991 are widely used 3 h y x 0 h y x l x g 1 v x y x 0 v x y x l x h x y 0 h x y l y g 2 v y x y 0 v y x y l y where lx and ly define the domain size and g 1 and g 2 are constants for head differences the most popular numerical solution for eq 2 is probably the finite difference fd method with five point scheme consider in an orthogonal grid one coarse gridblock is divided into nx ny fine gridblocks each size δx δy the internodal discharge q l 2 t 1 is approximated by the central difference scheme as 4 q x i 1 2 j t x i 1 2 j h i 1 j h i j δ x q y i j 1 2 t y i j 1 2 h i j 1 h i j δ y where tx and ty are the internodal transmissibilities l 2 t 1 from the harmonic average of two conductivities in the adjacent gridblocks 5 t x i 1 2 j δ y k i j 1 k i 1 j 1 2 1 t y i j 1 2 δ x k i j 1 k i j 1 1 2 1 then we have for eq 2 6 t x i 1 2 j h i 1 j h i j δ x t x i 1 2 j h i 1 j h i j δ x t y i j 1 2 h i j 1 h i j δ y t y i j 1 2 h i j 1 h i j δ y 0 the solution of eq 6 generates an equivalent conductivity of the coarse gridblock computed by the finite difference method as durlofsky 1991 7 k f d k x x f d k x y f d k y x f d k y y f d which satisfies 8 q x k x x f d g 1 l y l x k x y f d g 2 l y l y q y k y x f d g 1 l x l x k y y f d g 2 l x l y where q x and q y are total discharges in x and y directions respectively the four components of k fd in eq 7 are obtained by solving eq 8 twice with two different periodic boundary conditions e g g 1 1 g 2 0 and g 1 0 g 2 1 2 2 heterogeneity to solve the governing equation we need information about conductivity in space in hydrogeology the log conductivity field y ln kx is usually treated as a second order stationary gaussian random process with mean e lnkx and variance σ y 2 zhang 2002 therefore the probabilistic geometric mean of kx is 9 κ g exp e ln k x and the probabilistic arithmetic mean and variance of kx are from the property of the lognormal distribution 10 κ e k x κ g exp σ y 2 2 σ 2 κ g 2 exp σ y 2 exp σ y 2 1 κ 2 σ y 2 σ y 2 1 we consider three types of covariance functions commonly used in hydrogeology dagan 1989 11 exponential c y x 1 x 2 σ y 2 exp x 1 x 2 η x 2 y 1 y 2 η y 2 gaussian c y x 1 x 2 σ y 2 exp x 1 x 2 η x 2 y 1 y 2 η y 2 spherical c y x 1 x 2 σ y 2 1 3 u 2 u 3 2 u 1 0 u 1 u x 1 x 2 η x 2 y 1 y 2 η y 2 x y cos θ sin θ sin θ cos θ x y where η x and η y are the correlation lengths and θ is the counterclockwise rotation angle 2 3 anisotropy in some cases the conductivities or the size of the gridblock in different directions are not the same denote by aky the global anisotropy ratio of conductivity that relates the hydraulic conductivities in different directions as aky ky kx for example the vertical conductivity could be one order of magnitude less than the horizontal one denote by aly the global anisotropy ratio of fine grid size as aly δy δx it is used when the shape of the fine gridblock is a rectangle instead of a square by global we mean the anisotropy ratio is a constant for the whole space consider eq 2 in a 2d problem 12 x k x h x y k y h y 0 whose finite difference scheme is i and j are indices in x and y directions respectively 13 1 δ x k x i 1 2 j h i 1 j h i j δ x k x i 1 2 j h i j h i 1 j δ x 1 δ y k y i j 1 2 h i j 1 h i j δ y k y i j 1 2 h i j h i j 1 δ y 0 by introducing a global anisotropy coefficient 14 a y k y k x δ x δ y 2 a k y a l y 2 eq 13 becomes 15 1 δ x k x i 1 2 j h i 1 j h i j δ x k x i 1 2 j h i j h i 1 j δ x a y 1 δ x k x i j 1 2 h i j 1 h i j δ x k x i j 1 2 h i j h i j 1 δ x 0 by setting δx δx δy δx kx kx and ky aykx we have 16 x k x h x y k y h y 0 indicating that the anisotropic problem in eq 12 can be transformed to an alternative problem in eq 16 for which the finite difference scheme is with δx δy and ay ky kx 17 t x i 1 2 j h i 1 j h i j t x i 1 2 j h i 1 j h i j t y i j 1 2 h i j 1 h i j t y i j 1 2 h i j 1 h i j 0 2 4 simple averaging and upper and lower bounds here we briefly review some basic concepts for analytical upscaling methods in 2d space the arithmetic mean is 18 k a 1 n x n y i 1 n x j 1 n y k i j the harmonic mean is 19 k h 1 n x n y i 1 n x j 1 n y 1 k i j 1 the geometric mean is 20 k g i 1 n x j 1 n y k i j 1 n x n y the power mean is given by 21 k p 1 n x n y i 1 n x j 1 n y k i j ω 1 ω the arithmetic mean harmonic mean and geometric mean are special cases of the power mean with ω 1 1 and 0 respectively the arithmetic harmonic mean which is exact for the stratified formation when the flow is parallel perpendicular to the bedding is the upper lower bound for the block conductivity the geometric mean is applicable for the 2d lognormal isotropic ergodic medium matheron 1967 and more appropriate for an infinite block size or spatially uncorrelated field warren and price 1961 note that the mean values above are taken in physical space for equivalent conductivity which is different from the effective conductivity for which the mean values are taken in probability space cardwell and parsons 1945 showed that the equivalent conductivity in 2d is bounded by the harmonic mean of the arithmetic means of the local conductivities calculated over each slice of cells perpendicular to the given direction as upper bound 22 k x max μ h x μ a y 1 n x i 1 n x 1 n y j 1 n y k x i j 1 1 and the arithmetic mean of the harmonic means of the local conductivities calculated on each line of cells parallel to the given direction as lower bound 23 k x min μ a y μ h x 1 n y j 1 n y 1 n x i 1 n x k x i j 1 1 as these bounds are narrower than the arithmetic mean and harmonic mean averaging them would provide a better estimation for equivalent block conductivity with a coefficient α 0 1 as 24 k x e q k x max α k x min 1 α it is clear that the proper choice of α is the key for accurate estimation le loc h 1987 and guerillot et al 1990 proposed to take the geometric mean of the two bounds i e α 1 2 this approach was introduced to 3d by lemouzy 1991 and extended to anisotropic media by duquerroix et al 1993 some empirical formulas for choosing proper values of α are discussed later in li et al 1999 renard et al 2000 maschio and schiozer 2003 liao 2018 however the above approaches generated diagonal conductivity tensors neglecting off diagonal terms 2 5 analytical solution in this work we derive an analytical solution of full tensorial equivalent conductivity using perturbation expansion techniques and fourier analysis considering not only anisotropy but also heterogeneity we solve for equivalent block conductivity in eq 7 by approximating the numerical solution in a finite difference scheme in eq 17 detailed derivations are included in the appendices specifically appendix a provides the analytical solution of kxxfd and kyxfd in matrix form appendix b provides the analytical approximation of e kxxfd and e kyxfd for the general anisotropic correlated case the isotropic or uncorrelated cases are just special cases appendix c provides analytical expressions for the spatial averages including arithmetic harmonic geometric power law harmonic arithmetic and arithmetic harmonic means of block conductivity appendix d provides the formulas of kxx and kyx by combining all of the results above the other two terms kyy and kxy can be obtained readily by changing the boundary conditions or by rotating the coordinates below we just show the final results the diagonal term kxx is 25 e k x x f d κ g exp σ y 2 γ x x where 26 γ x x ω 1 4 n x 1 ρ 1 0 ρ n x 1 0 n x k 1 1 n x k 2 1 n y s i n 2 π k 1 n x cos 2 π k 1 n x sin 2 π k 1 n x a y sin 2 π k 2 n y ρ k 1 k 2 1 1 a y ρ x y where 27 ρ x 1 x 2 y 1 y 2 c y x 1 y 1 x 2 y 2 ρ k 1 k 2 1 n x n y x n x 1 n x 1 y n y 1 n y 1 exp i 2 π k 1 x n x k 2 y n y 1 x n x 1 y n y ρ x y ρ x y 1 n x 2 n y 2 i 1 n x j 1 n y i 1 n x j 1 n y ρ i i j j and ω is the power law average coefficient for commonly used harmonic average scheme for the interblock transmissibility ω 1 a better choice to estimate e kxxfd is to use the arithmetic harmonic mean kx max and the harmonic arithmetic mean kx min adopting the idea of upper and lower bounds in eq 24 as 28 e k x x f d e k x max α e k x min 1 α where 29 α ln e k x x f d ln e k x min ln e k x max ln e k x min γ x x 1 2 ρ x ρ x y 1 ρ x ρ y ρ x y where 30 ρ y 1 n y 2 j 1 n y j 1 n y ρ 0 j j ρ x 1 n x 2 i 1 n x i 1 n x ρ i i 0 eq 28 is preferred because it is less sensitive to σ y 2 as can be seen from eq 29 to obtain kxx for the given block by eq 28 we just need to compute the coefficient α using eq 29 as well as kx max and kx min for the given block using eqs 22 and 23 the off diagonal term kyx is 31 e k y x f d a l y κ g σ y 2 γ y x where 32 γ y x k 1 1 n x k 2 1 n y a y s i n π k 1 n x s i n π k 2 n y cos π k 1 n x cos π k 2 n y sin 2 π k 1 n x a y sin 2 π k 2 n y ρ k 1 k 2 a y 1 a y ρ x y a better choice is to use 33 e k y x f d e k x g a l y σ y 2 γ y x 1 σ y 2 ρ x y 2 to obtain kyx for the given block we just need to compute the ratio of e kyxfd e kxg using eq 33 and the geometric mean kxg for the given block using eq 20 the results for e kyyfd and e kxyfd can be obtained similarly leading to a full tensor for equivalent block conductivity note that the upscaled conductivity tensor is always symmetric as e kyxfd e kxyfd which can be clearly seen from a13 unfortunately there is no theoretical proof yet that the upscaled conductivity tensor is always positive definite however it is positive definite in various tests as will be shown in section 3 in summary we express the conductivity tensor explicitly which considers the type of covariance the variance σ y 2 the correlation lengths η x and η y the rotation angle θ the anisotropy ratio of conductivity aky ky kx the anisotropy ratio of gridblock size aly δy δx and the upscaling ratios nx and ny 3 case studies 3 1 verification by equivalent conductivity in this section the proposed analytical method is verified by the numerical method in a finite difference scheme specifically we compare equivalent block conductivities from the analytical method using eqs 28 and 33 and the numerical method considered as the reference in various cases as shown in table 1 in all cases we assume e lnkx 0 since it does not affect relative error we start from a typical base case and analyze the effect of each factor parameter for example the log conductivity variance is from 0 1 to 10 in case 1 the correlation lengths ηx ηy is from 1 to 100 in case 2 different types of covariance functions are tested in cases 9 and 10 the results are illustrated in fig 1 for cases 1 5 and fig 2 for cases 6 10 in both methods the expectations are computed by taking averages of 10 000 randomly generated realizations we can see that in general the analytical results match very well with the numerical results the main differences between the analytical results and the numerical ones appear in cases 1 9 and 10 indicating that accuracy is dominated by the variance of the log conductivity in these cases the diagonal components kxx and kyy are more accurate than the off diagonal components kyx and kxy considering that the magnitude of the diagonal components in o 1 is much larger than that of the off diagonal components in o 10 1 the differences in the off diagonal components would not affect the solutions of hydraulic head and velocity substantially as will be illustrated in section 3 2 3 2 validation by hydraulic head and velocity in this section the proposed analytical method is validated by the true reference specifically we compare the hydraulic head and velocity results from the analytical method and the numerical method in coarse scale to the true reference from the numerical method in fine scale the boundary conditions are set impervious at the top and bottom and with constant heads of 1 and 0 at the left and right respectively table 2 shows the model setup in three cases where the domain size lx ly 1 contains 100 100 fine gridblocks which is upscaled to 10 10 coarse gridblocks each consisting of 10 10 fine gridblocks fig 3 a shows one realization of the fine scale log conductivity field randomly generated using statistics for the base case in the first row of table 2 the numerical method is used to solve for the hydraulic head and velocity for this realization considered as the fine scale true reference as shown in fig 3 b d then the fine scale hydraulic head and velocity are averaged to obtain the coarse scale hydraulic head and velocity considered as the coarse scale true reference respectively as shown in fig 3 e g specifically the coarse scale hydraulic head is computed by the arithmetic average of the fine scale hydraulic heads in the coarse gridblock and the coarse scale interblock velocity is computed by the arithmetic average of the fine scale interblock velocities on the face of the coarse gridblock fig 3 h illustrates the upscaled log conductivity by the numerical method in a finite difference scheme with periodic boundary conditions it is used to solve for the coarse scale hydraulic head and velocity as shown in fig 3 i k note that the upscaled conductivity is a tensor for each coarse gridblock and thus we used the multipoint flux approximation mpfa approach aavatsmark 2002 implemented by the matlab reservoir simulation toolbox mrst lie 2014 in this study fig 3 l illustrates the upscaled log conductivity by the analytical method it is used to solve for the coarse scale hydraulic head and velocity as shown in figs 3 m o also using the mpfa approach we can see that the analytical results are almost identical to the numerical results both of which are very close to the true references fig 4 depicts the scatter plots of numerical results analytical results and true references for three variables i e hydraulic head x velocity and y velocity the coefficient of determination r 2 is adopted to compare different methods quantitatively in general the better the estimated value matches the reference value the closer the value of r 2 is to 1 fig 4 a shows that the numerical results match the exact values of the hydraulic head very well fig 4 b and c reveal that the numerical results of the x and y velocities are not as good as those of the hydraulic head similar results are observed for the analytical methods as in figs 4 d f for each variable the patterns of the scatter plots are also very similar in the first row and the second row and the r 2 values are almost the same figs 4 g i compare the numerical results and the analytical results it is seen that r 2 0 99 for all variables indicating that the numerical results are successfully replicated by the analytical method we also computed the total velocity in the x direction the exact value is 1 18 lt 1 the numerical result is 1 13 lt 1 and the analytical result is also 1 13 lt 1 both of which have approximately 4 error this means that the global effect of the fluid flow is captured well in upscaling either numerically or analytically for the upscaling step i e computing the equivalent conductivity the cpu time for the numerical method is 0 2 s and the cpu time for the analytical method is 0 01 s including 0 003 s for the coefficients α in eq 29 and γ yx in eq 32 and 0 007 s for the rest formulas as in eqs 28 and 33 these tests are programed by matlab with vectorization and performed on i7 6700k cpu 4 00 ghz we can see that the analytical method is 20 times faster than the numerical one in this example in addition although the formulas as in eqs 29 and 32 appear to be complicated the computations are actually very fast we then considered another case by changing the correlation lengths and rotation angle case 11 in the second row of table 2 the results are illustrated in figs 5 and 6 again the analytical results and the numerical results have negligible differences and both are very close to the true references for total velocity in the x direction the exact value is 0 837 lt 1 the numerical result is 0 814 lt 1 and the analytical result is also 0 814 lt 1 both of which have approximately 3 error in the last case we tested an extremely large variance σ y 2 10 case 12 in the third row of table 2 fig 7 a shows one realization of the fine scale log conductivity field with values from 8 to 8 which is quite challenging for both the numerical and analytical method fig 7 shows that the upscaled results are still close to the true references the r 2 values presented in fig 8 are unsurprisingly smaller less accurate than those in the previous cases nevertheless for total velocity in the x direction the exact value is 1 46 lt 1 the numerical result is 1 55 lt 1 and the analytical result is 1 56 lt 1 both of which have approximately 6 error it can be seen that although the analytical method is derived using the first order approximation it can reproduce the results from the numerical method even for very large variances this is due to two reasons adopting the landau lifshitz conjecture landau and lifshitz 1960 and using the upper and lower bounds as in eq 28 3 3 effect of upscaling ratios to analyze the effect of upscaling ratios nx and ny we randomly generate a realization of log conductivity field of size 128 128 blocks following an exponential covariance function with σ2 ln k 1 ηx ηx 8 aky 1 and aly 1 varieties of upscaling ratios nx and ny at 2 4 8 16 32 and 64 are tested with a total number of combinations at 6 6 36 hence we would not show the detailed results of head and velocities as in figs 3 8 instead we compute the coefficient of determination r 2 for each case fig 9 shows that the heads are generally accurate and it is more difficult to match the velocities the first row and the second row are most the same which is confirmed by the third row where the values of r 2 are very close to 1 indicating the analytical results and the numerical results are almost identical the velocity results in fig 9 b f reveal that it is suggested that the upscaling ratios in x and y directions are close as nx ny which is reasonable since a large difference in the upscaling ratios may lead to instability some researches show that it is favorable to adapt the coarse grid to geological heterogeneity where the upscaling ratio is not constant anymore we expect our method to be combined with the idea of adaptive grid since the formula is a function of upscaling ratios interested readers may refer to preux 2016 for more information 3 4 scale dependent variance of log conductivity the perturbation expansion techniques can be utilized to derive the expression for the scale dependent variance of coarse scale by power law average of conductivity log conductivity 34 σ y c 2 e ln k x p o w e r e ln k x p o w e r 2 e ln k x p o w e r 2 e ln k x p o w e r 2 from eq c2 we have 35 ln k x p o w e r ln κ β ω 1 2 β 2 1 ω 2 β 2 substituting eq 35 into eq 34 36 σ y c 2 e β ω 1 2 β 2 1 ω 2 β 2 2 e β ω 1 2 β 2 1 ω 2 β 2 2 using eq c4 and low order approximation 37 σ y c 2 σ y 2 ρ x y where ρ x y is defined in eq 27 note that eq 37 is in general and not related to the power ω in the power law average to verify this analytical solution we use different size of coarse square gridblocks with nx ny 1 2 4 8 16 32 64 for each size we generate 10 000 random fields following an exponential or gaussian covariance function with σ y 2 0 1 aky 1 and aly 1 we consider an isotropic case ηx ηy 4 and an anisotropic case ηx 4 ηy 40 we compute the geometric arithmetic and harmonic means of the coarse block conductivity then calculate the ratio of the log conductivity variance in the coarse gridblock and the log conductivity variance in the fine gridblock the analytical results overlap the numerical results for both isotropic case and an anisotropic case as shown in fig 10 3 5 five spot pattern in previous tests we set constant heads at the left and right bounds while no flow at the top and bottom bounds in this section we test the proposed method in a five spot pattern with one injection well in the center and four production wells in four corners assume a unit square domain consists of 75 75 fine gridblocks following an exponential covariance function with σ2 ln k 1 ηx 20 ηx 5 θ 45 aky 1 and aly 1 the upscaling ratios are nx ny 5 leading to 15 15 coarse gridblocks specifically the locations of the wells for the fine gridblocks are 38 38 3 3 3 73 73 3 73 73 the locations of the wells for the coarse gridblocks are 8 8 1 1 1 15 15 1 15 15 constant heads are assigned to the wells as h 1 for the injection well and h 0 for the production wells one realization is randomly generated and upscaled then solved by running mrst lie 2014 which uses peaceman s equation peaceman 1983 for the well treatment fig 11 illustrates the results of log conductivity hydraulic head velocity and streamline the upscaled log conductivities capture the high value and low value regions the x velocity is almost negative on the left hand side and positive on the right hand side since the injection well is in the center the upscaled streamlines are denser in the bottom left corner and sparser in the top left corner due to the difference of log conductivities fig 12 depicts the scatter plots of numerical results analytical results and true references we can see again that the proposed analytical upscaling method matches very well with the numerical upscaling method 4 discussions the influence of the scale of the underlying fine scale conductivity field is an interesting topic tartakovsky et al 2017 to this goal the proposed method is shown to be valid in various upscaling ratios from 2 2 to 64 64 in addition our method provides a possible way to explain the scale dependent phenomenon of flow in porous media specifically we may consider the drift component after subtracting the expectation from the original term and then obtain the variance and variogram in particular an analytical expression for the scale dependent variance of log conductivity as a function of covariance model and upscaling ratio is derived in this work which has been successfully validated by the numerical results in addition the formulas of tensor conductivity in eqs 28 and 33 can be used to estimate the bias of kfd compared to kg by computing ln e k f d k g σ y 2 as in romeu and noetinger 1995 with the extensions of including the off diagonal terms kxy and kyx as well as considering the effects of anisotropy and geometry extending the framework from saturated single phase flow to multiphase flow or unsaturated flow is also discussed here considering multiphase flow as an example there are two approaches in general to determine the relative permeabilities steady state approach and dynamic approach it would be easier to combine the former steady state approach and the proposed framework specifically for two phase flow system given certain values for the saturation at boundaries we need to solve two sets of governing equations one for each phase analytically then the upscaled conductivity or permeability for each phase will be used to calculate the relative permeability of the coarse gridblock as a function of saturation previous results show that the landau lifshitz conjecture is confirmed with the accuracy up to second or fourth order terms depending on the conditions in the log conductivity variance however the discrepancy with the results from a high order approximation using perturbation expansion especially for non gaussian random fields or anisotropic media is reported in the work by indelman and abramovich 1994 abramovich and indelman 1995 de wit 1995 noetinger 2000 stepanyants and teodorovich 2003 nevertheless the landau lifshitz conjecture provides an estimation of equivalent conductivity with less than 1 error for log conductivity variance up to 3 de wit 1995 including high order terms in the derivation with improved accuracy will be the subject of future work the proposed method is shown to be accurate in problems with structured and orthogonal grids where the log conductivity field is a gaussian random field with known mean and covariance function these conditions are related to the assumptions made in the derivation possible extension to unstructured grids requires other models e g the finite analytic techniques which is based upon the power law analytic nodal solution in the angular domain with arbitrary shape and has been shown to be super converging and independent of the conductivity heterogeneity wang et al 2017 2018 zheng et al 2017 we also tested the proposed method in a channelized reservoir in the spe10 benchmark example the results from the analytical upscaling method is still close to the results from the numerical upscaling method however both are inaccurate compared to the reference this is because the local upscaling approaches as the analytical and numerical methods in this study may not be suitable for channelized reservoirs whereas extended local or global approaches are required a possible solution is to first smoothen the conductivity and then upscale it by the proposed method another type of non gaussian fields is related to the concept of truncated fractals formed by a gaussian random function with a truncated power variogram guadagnini et al 2018 in general extending the proposed framework to unstructured grids or non gaussian fields requires further investigation 5 conclusions in this study we proposed a new analytical method for upscaling of hydraulic conductivity in 2d anisotropic heterogeneous formations this method takes many factors into account including type of covariance log conductivity variance correlation lengths rotation angle anisotropy ratio of conductivity anisotropy ratio of gridblock size and upscaling ratios in x and y directions using perturbation expansion techniques and fourier analysis the analytical method provides explicit formulas for the equivalent block conductivity tensor as computed by the numerical method in a finite difference scheme with periodic boundary conditions the derivations in appendices a and b are similar to the work by romeu and noetinger 1995 who presented an analytical method for equivalent conductivity of isotropic media here we extended the method to anisotropic media for general conditions considering the effect of correlation lengths rotation angle anisotropy ratios of conductivity and fine grid size we also considered the effect of the number of fine gridblocks in a rectangle coarse gridblock in addition we presented solutions for off diagonal components kyx and kxy in the conductivity tensor furthermore for diagonal components kxx and kyy we proposed to use the upper and lower bounds k max and k min with coefficient α which is determined analytically from the statistics of the log conductivity random field this approach is preferred because the results are less sensitive to input variance we tested the proposed method in various cases and analyzed the effect of each factor as above the analytical method matched well with the numerical method in all cases for the estimation of the conductivity tensor we also computed the hydraulic head and velocity in three typical realizations the analytical method reproduced the results from the numerical method successfully even for an extremely large variance up to 10 furthermore we tested the method in a five spot pattern other than the constant head no flow boundary conditions although the formulas appear to be complicated the computations are very fast 20 times faster than numerical methods as shown in the example moreover they are computed once for all coarse gridblocks in one realization even if we generate multiple realizations of the conductivity fields using the same statistics e g to quantify uncertainty or analyze sensitivity we still just need to compute the formulas once for all realizations this is clearly favorable and naturally leads to improved efficiency of the proposed method over the numerically upscaling method besides the method can be extended from 2d to 3d which is currently being explored acknowledgments the authors would like to acknowledge the funding support provided by the national natural science foundation of china grant no 51604013 and the state major science and technology special project of china during the 13th five year plan grant no 2016zx05025 003 007 appendix a analytical solutions of kxxfd and kyxfd in matrix form denote by t the transmissibility and h the hydraulic head solving the 2d finite difference linear system in eq 17 with δx δy and ay ky kx as hereafter we neglect the symbol a1 t x i 1 2 j h i 1 j h i j t x i 1 2 j h i 1 j h i j t y i j 1 2 h i j 1 h i j t y i j 1 2 h i j 1 h i j 0 for a coarse gridblock i j 1 i nx 1 j ny under periodic boundary conditions in eq 3 with g 1 1 g 2 0 corresponds to minimizing a2 ξ i 1 n x j 1 n y t x i 1 2 j h i 1 j h i j 2 t y i j 1 2 h i j 1 h i j 2 where h i j is subject to a3a h n x 1 j h 1 j 1 a3b h i n y 1 h i 1 based on the perturbation theory hi j can be expressed as a4 h i j h i j h i j i 0 5 n x h i j combining a2 and a4 we have a5 ξ i 1 n x j 1 n y t x i 1 2 j h i 1 j h i j 2 t y i j 1 2 h i j 1 h i j 2 2 n x i 1 n x j 1 n y t x i 1 2 j h i 1 j h i j c where c is an irrelevant constant for minimization to convert a5 into matrix format we define the following a6 h h 1 1 h 2 1 h n x 1 h 1 2 h n x n y t t x t x 1 1 2 1 t x 2 1 2 1 t x n x 1 2 1 t x 1 1 2 2 t x n x 1 2 n y 0 0 0 t d d i a g t x 1 1 2 1 t x 2 1 2 1 t x n x 1 2 n y t y 1 1 1 2 t y 2 1 1 2 t y n x n y 1 2 δ x h i j h i 1 j h i j δ y h i j h i j 1 h i j δ δ y δ y t δ t δ h i j h i 1 j h i 1 j h i j 1 h i j 1 4 h i j where h is a nxny 1 column vector containing the nxny value of h tx is a 2nxny 1 column vector containing the nxny value of tx and nxny zeros instead of the nxny value of ty d is a 2nxny 2nxny diagonal matrix containing both tx and ty and δ x and δ y are nxny nxny finite difference operators in x and y directions respectively δ is a 2nxny nxny rectangular matrix that performs finite difference in both directions δ t δ is the finite difference laplacian operator and the superscript t indicates transpose using a6 a5 can be expressed as a7 ξ δ h t d δ h 2 n x δ h t t x c the solution for this minimization problem is a8 h 1 n x δ t d δ 1 δ t t x consider the total discharge in the x direction using a3a and δx δy q x t o t a l k x x f d l y h n x 1 j h 1 j l x k x x f d n y n x on the other hand from the finite difference solution q x t o t a l j 1 n y t x i 1 2 j h i 1 j h i j i therefore the hydraulic conductivity in the x direction i e diagonal component in conductivity tensor is a9 k x x f d n x n y j 1 n y t x i 1 2 j h i 1 j h i j i 1 n y i 1 n x j 1 n y t x i 1 2 j h i 1 j h i j 1 n x n y i 1 n x j 1 n y t x i 1 2 j 1 n y i 1 n x j 1 n y t x i 1 2 j h i 1 j h i j t x a 1 n y t x t δ h t x a 1 n x n y t x t δ δ t d δ 1 δ t t x where txa indicates the arithmetic average of tx using a global anisotropy coefficient ay defined in eq 14 for a slightly perturbed medium specifically we need b4 with the first order approximation to obtain ty tx ky kx ay a10 t x t x a 1 1 0 δ t x δ t x t x a 1 1 0 d t x a i 1 a y δ d δ d i 1 a y δ t t δ t δ t δ t d δ 1 1 t x a δ t i 1 a y δ d δ 1 1 t x a δ t i 1 a y δ 1 where 1 1 0 is a 2nxny 1 column vector containing nxny ones followed by nxny zeros and i 1 ay is a 2nxny 2nxny diagonal matrix containing nxny ones followed by the nxny value of ay s inserting a10 in a9 produces a11 k x x f d t x a 1 n x n y t x a δ t x t δ δ t i 1 a y δ 1 δ t δ t x similarly consider the total discharge in the y direction using a3a q y t o t a l k y x f d l x h n x 1 j h 1 j l x k y x f d on the other hand from the finite difference solution q y t o t a l i 1 n x t y i j 1 2 h i j 1 h i j j therefore the hydraulic conductivity in the y direction is a12 k y x f d i 1 n x t y i j 1 2 h i j 1 h i j j 1 n y j 1 n y i 1 n x t y i j 1 2 h i j 1 h i j 1 n y j 1 n y i 1 n x t y i j 1 2 h i j 1 h i j 1 n y t y t δ h 1 n x n y t y t δ δ t d δ 1 δ t t x where ty is a 2nxny 1 column vector containing nxny zeros instead of the nxny value of tx and the nxny value of ty after approximation as in a10 we have a13 k y x f d 1 n x n y t x a δ t y t δ δ t i 1 a y δ 1 δ t δ t x appendix b analytical solutions of e kxxfd and e kyxfd for anisotropic correlated field the expectation of kfd is solved analytically for the general case i e the anisotropic correlated case whereas the isotropic or uncorrelated cases can be derived easily by considering them as special cases the conductivity is assumed to be a random function with mean and covariance as b1 e k x i j κ c o v k x i j k x i j σ 2 ρ i i j j σ 2 c y i j i j we want to solve the diagonal conductivity kxx from appendix a b2 e k x x f d e t x a e ℑ where b3a t x a 1 n x n y i 1 n x j 1 n y t x i 1 2 j b3b ℑ 1 n x n y t x a δ t x t δ δ t i 1 a y δ 1 δ t δ t x to solve for e txa we first analyze t x i 1 2 j assuming kx i j κ 1 β i j and using the expansion 1 x ω 1 ωx 1 2 ω ω 1 x 2 o x 2 we have b4 t x i 1 2 j k x i j ω k x i 1 j ω 2 1 ω κ 1 ω 2 β i j β i 1 j ω ω 1 4 β i j 2 β i 1 j 2 1 ω κ 1 1 2 β i j β i 1 j ω 1 8 β i j β i 1 j 2 for the special case of harmonic average we just need to set ω 1 in b4 and following equations therefore the first part of b2 is b5 e t x a e 1 n x n y i 1 n x j 1 n y t x i 1 2 j κ n x n y e i 1 n x j 1 n y 1 1 2 β i j β i 1 j ω 1 8 β i j β i 1 j 2 κ n x n y e i 1 n x j 1 n y 1 ω 1 4 β i j 2 β i j β i 1 j κ 1 ω 1 σ 2 4 κ 2 1 n x 1 ρ 1 0 ρ n x 1 0 n x then we solve for the second part of b2 using fourier transform in 2d space a function f e g transmissibility or conductivity in the fourier base can be expressed as b6a f i j k 1 1 n x k 2 1 n y exp i 2 π k 1 i n x k 2 j n y f k 1 k 2 i 1 b6b f k 1 k 2 1 n x n y i 1 n x j 1 n y exp i 2 π k 1 i n x k 2 j n y f i j consider a function b7 φ k 1 k 2 i j exp i 2 π k 1 i n x k 2 j n y then b8 δ φ k 1 k 2 exp i 2 π k 1 n x 1 φ k 1 k 2 exp i 2 π k 2 n y 1 φ k 1 k 2 b9 δ t i 1 a y δ φ k 1 k 2 exp i 2 π k 1 n x 1 exp i 2 π k 1 n x 1 a y exp i 2 π k 2 n y 1 exp i 2 π k 2 n y 1 φ k 1 k 2 using exp i2θ 1 2iexp iθ sin θ b9 becomes b10 δ t i 1 a y δ φ k 1 k 2 4 sin 2 π k 1 n x a y sin 2 π k 2 n y φ k 1 k 2 therefore b11 δ δ t i 1 a y δ 1 δ t φ k 1 k 2 s i n 2 π k 1 n x sin 2 π k 1 n x a y sin 2 π k 2 n y φ k 1 k 2 substitute b11 into b3b we have b12 ℑ 1 t x a k 1 1 n x k 2 1 n y s i n 2 π k 1 n x sin 2 π k 1 n x a y sin 2 π k 2 n y δ t x k 1 k 2 2 considering the first order approximation in b4 and b6 we have b13 δ t x k 1 k 2 1 n x n y i 1 n x j 1 n y exp i 2 π k 1 i n x k 2 j n y δ t x i j 1 n x n y i 1 n x j 1 n y exp i 2 π k 1 i n x k 2 j n y δ k x i j δ k x i 1 j 2 1 n x n y i 1 n x j 1 n y exp i 2 π k 1 i n x k 2 j n y δ k x i j 2 1 exp i 2 π k 1 n x using exp i2θ 1 2exp iθ cos θ we have b14 δ t x k 1 k 2 δ k x k 1 k 2 1 2 1 exp i 2 π k 1 n x δ k x k 1 k 2 cos π k 1 n x inserting b14 in b12 gives b15 ℑ 1 t x a k 1 1 n x k 2 1 n y s i n 2 π k 1 n x cos 2 π k 1 n x sin 2 π k 1 n x a y sin 2 π k 2 n y δ k x k 1 k 2 2 to compute e ℑ we need to address e δ k x k 1 k 2 2 using b6b it is b16 e δ k x k 1 k 2 2 1 n x 2 n y 2 i 1 n x j 1 n y i 1 n x j 1 n y exp i 2 π k 1 i i n x k 2 j j n y e δ k x i j δ k x i j denote kxa as the spatial arithmetic mean of kxi j since δkx i j kx i j kxa kx i j κ kxa κ we have b17 e δ k x i j δ k x i j c o v k x i j k x i j v a r k x a where b18a c o v k x i j k x i j σ 2 ρ i i j j b18b v a r k x a σ 2 n x 2 n y 2 i 1 n x j 1 n y i 1 n x j 1 n y ρ i i j j σ 2 ρ x y where b19 ρ x y 1 n x 2 n y 2 i 1 n x j 1 n y i 1 n x j 1 n y ρ i i j j substituting b18a in b17 and then in b16 gives the first part of b16 as since ρ is an even function b20 σ 2 n x 2 n y 2 i 1 n x j 1 n y i 1 n x j 1 n y exp i 2 π k 1 i i n x k 2 j j n y ρ i i j j σ 2 n x 2 n y 2 i 1 n x j 1 n y x i n x i 1 y j n y j 1 exp i 2 π k 1 x n x k 2 y n y ρ x y σ 2 n x n y x n x 1 n x 1 y n y 1 n y 1 exp i 2 π k 1 x n x k 2 y n y 1 x n x 1 y n y ρ x y σ 2 ρ k 1 k 2 where b21 ρ k 1 k 2 1 n x n y x n x 1 n x 1 y n y 1 n y 1 exp i 2 π k 1 x n x k 2 y n y 1 x n x 1 y n y ρ x y substituting b18b in b17 and then in b16 gives the second part of b16 as b22 σ 2 ρ x y n x 2 n y 2 i 1 n x j 1 n y i 1 n x j 1 n y exp i 2 π k 1 i i n x k 2 j j n y σ 2 ρ x y k 1 n x k 2 n y 0 o t h e r w i s e combining b15 b20 and b22 yields b23 e ℑ 1 e t x a k 1 1 n x k 2 1 n y s i n 2 π k 1 n x cos 2 π k 1 n x sin 2 π k 1 n x a y sin 2 π k 2 n y e δ k x k 1 k 2 2 σ 2 κ k 1 1 n x k 2 1 n y s i n 2 π k 1 n x cos 2 π k 1 n x sin 2 π k 1 n x a y sin 2 π k 2 n y ρ k 1 k 2 1 1 a y ρ x y inserting b5 and b23 into b2 we obtain the final results for kxx b24 e k x x f d e t x a e ℑ κ σ 2 κ ω 1 4 n x 1 ρ 1 0 ρ n x 1 0 2 n x k 1 1 n x k 2 1 n y s i n 2 π k 1 n x cos 2 π k 1 n x sin 2 π k 1 n x a y sin 2 π k 2 n y ρ k 1 k 2 1 1 a y ρ x y where ρ x y and ρ k 1 k 2 are described in b19 and b21 respectively similarly for the off diagonal conductivity kyx from a13 we have b25 e k y x f d e 1 n x n y t x a δ t y t δ δ t i 1 a y δ 1 δ t δ t x 1 t x a k 1 1 n x k 2 1 n y s i n π k 1 n x s i n π k 2 n y sin 2 π k 1 n x a y sin 2 π k 2 n y δ t x k 1 k 2 δ t y k 1 k 2 1 t x a k 1 1 n x k 2 1 n y a y s i n π k 1 n x s i n π k 2 n y cos π k 1 n x cos π k 2 n y sin 2 π k 1 n x a y sin 2 π k 2 n y δ k x k 1 k 2 2 σ 2 κ k 1 1 n x k 2 1 n y a y s i n π k 1 n x s i n π k 2 n y cos π k 1 n x cos π k 2 n y sin 2 π k 1 n x a y sin 2 π k 2 n y ρ k 1 k 2 a y 1 a y ρ x y appendix c spatial averages of block conductivity for the spatial average of kx it is well known that the arithmetic harmonic and geometric averages are special cases of power law average as c1 k x p o w e r 1 n x n y i 1 n x j 1 n y k x i j ω 1 ω ω 1 a r i t h m e t i c ω 0 g e o m e t r i c ω 1 h a r m o n i c assume kx i j κ 1 β i j and use the expansion 1 x ω 1 ωx 1 2 ω ω 1 x 2 o x 2 then c2 k x p o w e r κ 1 n x n y i 1 n x j 1 n y 1 β i j ω 1 ω κ 1 n x n y i 1 n x j 1 n y 1 ω β i j ω ω 1 2 β i j 2 1 ω κ 1 β ω ω 1 2 β 2 1 ω κ 1 β ω 1 2 β 2 1 ω 2 β 2 where c3a β 1 n x n y i 1 n x j 1 n y β i j c3b β 2 1 n x n y i 1 n x j 1 n y β i j 2 from eqs 10 and b18 for small σ y 2 c4a e β 0 c4b e β 2 σ 2 κ g 2 σ y 2 c4c e β 2 σ 2 ρ x y κ g 2 σ y 2 ρ x y combining c2 and c4 yields c5 e k x p o w e r κ 1 ω 1 2 σ y 2 1 ω 2 σ y 2 ρ x y consider c5 as the sum of the first two terms in a series expansion of an exponential function we have using eq 10 c6 e k x p o w e r κ g exp σ y 2 2 exp ω 1 2 σ y 2 1 ω 2 σ y 2 ρ x y κ g exp σ y 2 ω 2 1 ω 2 ρ x y this generalization to obtain an expression valid for large variance σ y 2 usually referred to as the landau lifshitz conjecture landau and lifshitz 1960 is well known in hydrogeology matheron 1967 gelhar and axness 1983 zhang 2002 from c1 and c6 the expectations of arithmetic harmonic and geometric spatial averages of kx are c7a e k x a κ g exp σ y 2 2 κ c7b e k x h κ g exp σ y 2 1 2 ρ x y c7c e k x g κ g exp σ y 2 ρ x y 2 next we analyze the harmonic means of the arithmetic mean of the local conductivities also the upper bound c8 k x max μ h x μ a y 1 n x i 1 n x 1 n y j 1 n y k x i j 1 1 κ 1 n x i 1 n x 1 n y j 1 n y 1 β i j 1 1 κ 1 n x i 1 n x 1 1 n y j 1 n y β i j 1 n y j 1 n y β i j 2 1 κ 1 1 n x n y i 1 n x j 1 n y β i j 1 n x i 1 n x 1 n y j 1 n y β i j 2 1 κ 1 β 1 n x i 1 n x β i 2 1 κ 1 β 1 n x i 1 n x β i 2 β 2 where c9 β i 1 n y j 1 n y β i j using the landau lifshitz conjecture c8 becomes c10 e k x max κ e 1 β 1 n x i 1 n x β i 2 β 2 κ g exp σ y 2 2 exp σ y 2 ρ y σ y 2 ρ x y κ g exp σ y 2 1 2 ρ y ρ x y where c11 ρ y 1 n y 2 j 1 n y j 1 n y ρ 0 j j similarly we analyze the arithmetic mean of the harmonic means of the local conductivities also the lower bound c12 k x min μ a y μ h x 1 n y j 1 n y 1 n x i 1 n x k x i j 1 1 κ n y j 1 n y 1 n x i 1 n x 1 β i j 1 1 κ n y j 1 n y 1 1 n x i 1 n x β i j 1 n x i 1 n x β i j 2 1 κ n y j 1 n y 1 β j β j 2 1 κ n y j 1 n y 1 β j β j 2 β j 2 κ 1 1 n y j 1 n y β j 1 n y j 1 n y β j 2 1 n y j 1 n y β j 2 where c13 β j 1 n x i 1 n x β i j β j 2 1 n x i 1 n x β i j 2 thus the expectation of c12 is using the landau lifshitz conjecture c14 e k x min κ e 1 1 n y j 1 n y β j 1 n y j 1 n y β j 2 1 n y j 1 n y β j 2 κ g exp σ y 2 2 exp σ y 2 σ y 2 ρ x κ g exp σ y 2 1 2 ρ x where c15 ρ x 1 n x 2 i 1 n x i 1 n x ρ i i 0 appendix d using conductivity ratio and upper and lower bounds we would like to relate all types of mean conductivities to the geometric spatial mean e kxg in c7c first let us consider e kxxfd using eqs 10 and b24 with first order approximation d1 e k x x f d κ g 1 σ y 2 γ x x where d2 γ x x ω 1 4 n x 1 ρ 1 0 ρ n x 1 0 n x k 1 1 n x k 2 1 n y s i n 2 π k 1 n x cos 2 π k 1 n x sin 2 π k 1 n x a y sin 2 π k 2 n y ρ k 1 k 2 1 1 a y ρ x y using the landau lifshitz conjecture d3 e k x x f d κ g exp σ y 2 γ x x from d3 and c7c d4 e k x x f d e k x g exp σ y 2 γ x x exp σ y 2 ρ x y 2 exp σ y 2 γ x x ρ x y 2 as for e kx max and e kx min combining c7c c10 and c14 we have d5 e k x max e k x g exp σ y 2 1 2 ρ y ρ x y 2 e k x min e k x g exp σ y 2 1 2 ρ x ρ x y 2 finally we can express e kxxfd by e kx max and e kx min d6 e k x x f d e k x max α e k x min 1 α where α is determined by d4 and d5 as d7 α ln e k x x f d ln e k x min ln e k x max ln e k x min γ x x ρ x y 2 1 2 ρ x ρ x y 2 1 2 ρ y ρ x y 2 1 2 ρ x ρ x y 2 γ x x 1 2 ρ x ρ x y 1 ρ x ρ y ρ x y similarly for e kyxfd using eqs 10 and b25 with first order approximation d8 e k y x f d κ g σ y 2 γ y x where d9 γ y x k 1 1 n x k 2 1 n y a y s i n π k 1 n x s i n π k 2 n y cos π k 1 n x cos π k 2 n y sin 2 π k 1 n x a y sin 2 π k 2 n y ρ k 1 k 2 a y 1 a y ρ x y note that the above kyx is for square gridblocks where δx δy thus the kyx for rectangular gridblocks where δy aly δx is d10 e k y x f d a l y κ g σ y 2 γ y x from d7 and c7c we have since the first order approximation is used for kyx it should be used for kxg as well d11 e k y x f d e k x g a l y σ y 2 γ y x exp σ y 2 ρ x y 2 a l y σ y 2 γ y x 1 σ y 2 ρ x y 2 
658,coastal aquifers are vulnerable to seawater intrusion due to excessive groundwater pumping most research on salinization vulnerability considers homogeneous aquifers forming the basis of management guidance however geologic structure can be highly heterogeneous with preferential flow paths and low permeability barriers that complicate flow and salt transport processes under pumping conditions here we use a series of variable density groundwater flow and salt transport models with geostatistical representations of heterogeneity to illustrate characteristics of vulnerability in heterogeneous and homogeneous aquifers simulations showed that in homogeneous aquifers salinization patterns were simple and related only to the hydraulic properties in heterogeneous aquifers salinization rates and patterns were much more complicated and related to pumping location and depth aquifer geometry and geologic connections between pumping location landward boundaries and saline groundwater an intrusion configuration typology approach was developed for both homogeneous and heterogeneous aquifers the configuration approach was applied to heterogeneous aquifers of low medium and high geologic continuity and vulnerability was assessed the probability based assessment was able to characterize the impact of pumping locations and rates in heterogeneous aquifers considering different types of intrusion the results showed that groundwater vulnerability to salinization was sensitive to pumping distance to the coastline for low continuity aquifers and to pumping depth for high continuity aquifers the analysis provides new insights into the relationship between land sea geologic connections and seawater intrusion vulnerability the configuration approach plus probability based assessment can be a starting point for large scale aquifer characterization and more sophisticated groundwater management including vulnerability assessment and optimization of pumping location depth and rate keywords groundwater saltwater intrusion heterogeneity geostatistics coastal water resources vulnerability 1 introduction coastal areas around the world host large populations and intense economic activity in the us coastal counties have a population of 134 million and contribute 48 of the nation s gdp kildow et al 2016 fresh water resources in coastal zones are critical to human health and economies agriculture e g narayan et al 2007 and ecosystems and their services e g langston et al 2017 white and kaplan 2017 xiao et al 2018 these water use requirements increase pressure on coastal groundwater resources michael et al 2017 in many areas intensive pumping of fresh groundwater has resulted in widespread intrusion of seawater driving aquifers beyond sustainability werner et al 2013 at larger scales excessive groundwater pumping whether onshore or offshore can lead to widespread losses of freshwater due to geologic connections from wells to fresh groundwater reserves knight et al 2018 yu and michael 2019 pumping saline groundwater for desalination can also cause seaward movement of the freshwater saltwater interface stein et al 2019 thus understanding seawater intrusion swi in coastal aquifers at a large scale is essential for managing and protecting onshore and offshore groundwater resources analytical and numerical models have been used to assess aquifer vulnerability to swi for more than a century the most simple models approximate the freshwater saltwater interface as sharp often based on the ghyben herzberg relation post et al 2018 and then a single potential formulation strack 1976 to describe groundwater flow a variety of analytical models have been developed considering different pumping scenarios and boundary conditions e g mazi et al 2014 park et al 2009 llopis albert and pulido velazquez 2014 mantoglou 2003 wang et al 2014 more realistic analytical models of variable density flow include mixing between freshwater and saltwater e g fahs et al 2016 simpson and clement 2004 strack et al 2016 shao et al 2018 these methods can give a first approximation of vulnerability and aquifer response to pumping under various sets of assumptions e g beebe et al 2016 cheng et al 2000 kacimov and sherif 2006 lu et al 2015 mantoglou 2003 morgan and werner 2014 pool and carrera 2011 wang et al 2014 werner et al 2012 numerical models are used for more realistic simulation of swi processes considering nonlinearity transience and miscibility of fresh and saline groundwater these models couple flow and transport equations to obtain the salinity distribution across the domain for a given pumping location and rate e g narayan et al 2007 park and aral 2004 compared to analytical solutions numerical models are more flexible allowing more complex boundary conditions and parameter distributions and they are more accurate when the transition zone is thick liopis albert and pulido velazquez 2014 swi can be predicted by numerical simulations under different scenarios of climate and pumping operation e g de filippis et al 2016 garcía menéndez et al 2016 sherif et al 2013 michael et al 2013 model predictions can also be linked with optimization tools that enhance coastal aquifer management e g ataie ashtiani and ketabchi 2011 ketabchi and ataie ashtiani 2015a hussain et al 2015 qahman et al 2005 rao et al 2014 ketabchi and ataie ashtiani 2015b singh 2014 2015 song et al 2018 mantoglou 2003 prieto et al 2006 despite their flexibility the vast majority of studies on vulnerability assessment of swi assume homogeneous aquifer properties or simplified layered geology although much of our understanding of swi mechanisms and management are derived from homogeneous models aquifer heterogeneity has been shown to critically affect both salinity distributions and seawater intrusion processes lu et al 2013a b found that a thick mixing zone may occur in low conductivity layers in stratified coastal aquifers zamrsky et al 2018 found that an aquitard has a substantial effect on the final salinity profile when compared to the salinity profile for homogenous geological conditions houben et al 2018 investigated different types of heterogeneity and found that heterogeneity strongly influences coastal groundwater flow siena and riva 2018 found that the combined effects of aquifer heterogeneity and pumping operations on seawater intrusion reduce the intrusion rate and increases the width of the mixing zone michael et al 2016 showed that connected aquifer structures create preferential flow paths resulting in complex salinity distributions that differ greatly from those simulated in equivalent homogeneous aquifers kerrou and renard 2010 presented the effects of heterogeneity on swi and found that heterogeneity can substantially increase the size of mixing zone due to increased macrodispersion mantoglou 2003 found that optimal pumping rates are very sensitive to hydraulic conductivity heterogeneities sebben et al 2015 showed that in fractured coastal aquifers both the density and orientation of fracture networks have a significant impact on the seawater freshwater interface xu et al 2016 found that subsurface conduit networks in a coastal karst aquifer created a preferential swi pathway reaching as far as 23 km inland scharping et al 2018 explored spring vents near tampa usa and showed that spring water is connected to the coastal mixing zone through bedrock fractures thus preferential flow paths resulting from aquifer heterogeneity can dramatically increase the vulnerability of groundwater to pumping induced swi despite advances in modeling swi it remains difficult to realistically predict swi along the coast at large scales e g bocanegra et al 2010 perhaps in large part because of the difficulty in realistically assessing and representing heterogeneity as such the vulnerability of coastal groundwater is often assessed by simplified indicators e g lobo ferreira et al 2007 werner et al 2012 and classification methods e g fleury et al 2007 fetter 1973 proposed a two part classification of swi problems 1 passive swi referring to the inland movement of seawater in areas where fresh groundwater flows towards the coastline and 2 active swi where seawater moves in the same direction as fresh groundwater flow morgan and werner 2015 assessed vulnerability of 28 coastal aquifers in australia based on the two types of swi passive active werner 2017 revisited fetter s 1973 classification and characterized swi into three classes passive passive active and active further investigation showed that real world occurrences of active swi can occur in many field settings which was traditionally unappreciated and overlooked badaruddin et al 2017 knight et al 2018 analyzed twenty seven coastal aquifers and found that fourteen of them are experiencing active swi towards pumping wells this new classification identified critical intrusion patterns in different hydrogeological settings improving the vulnerability assessment of coastal groundwater aquifers to salinization however these classifications while useful for initial assessment are based on an assumption of homogeneity thus applicability may be limited if the ubiquitous heterogeneity of coastal aquifers holland and elmore 2008 is not considered despite the strong dependence of seawater intrusion processes on aquifer heterogeneity heterogeneous models have not yet been well integrated into coastal aquifer vulnerability assessments or management activities on one hand heterogeneity may allow fresh groundwater to exist far offshore michael et al 2016 potentially greatly delaying onshore salinization one the other hand geologic heterogeneity can create preferential flowpaths for fast swi as well as intrusion barriers e g strack et al 2016 anwar 1983 during pumping saline water can arrive at a pumping well quickly without salinization of the entire aquifer fig 1 potentially bypassing monitoring wells and artificial low permeability barriers we hypothesize that these processes can substantially impact vulnerability as assessed by previous indicators this study investigates the effect of heterogeneity on seawater intrusion due to groundwater pumping and establishes a new configuration typology and probability based vulnerability assessment for heterogeneous aquifers specific objectives of the present study are to i show how large scale heterogeneities in hydraulic conductivity may influence saltwater intrusion under pumping ii develop a configuration framework to identify the influence of different characteristics on intrusion extent rate and path and iii apply the configuration method to different types of aquifers and probabilistically assess groundwater resource vulnerability to coastal pumping 2 methods 2 1 simulated scenarios of aquifer heterogeneity heterogeneous distributions of geologic facies were developed using a geostatistical model by sequential indicator simulation chiles and delfiner 2009 in the models four distinct facies clay silt fine sand and medium to coarse sand were distinguished based on the thick stack of highly heterogeneous sediments that comprise the lower bengal delta aquifer system alam et al 2003 allison et al 2003 a variogram model was developed to capture the spatial correlation of these facies and the horizontal and vertical variogram ranges were 25 km and 50 m respectively using that model as a basis for realistic aquifer structure the facies proportions and vertical variogram ranges were kept unchanged but horizontal variogram ranges were varied to obtain three groups 5 km 25 km and 50 km for simulation of heterogeneous fields that encompass that of the bengal delta and a range of other coastal aquifers low medium and high geologic continuity respectively we used 35 realizations for each geologic continuity group for a more detailed description of the geostatistical model see michael et al 2016 representative values of hydraulic conductivity k were assigned to each of the four facies 10 11 m s 10 6 m s 10 3 m s and 10 1 m s for clay silt fine sand and medium to coarse sand respectively to connect with previous classification methods for homogeneous cases e g werner 2017 fetter 1973 we also analyzed swi in homogeneous aquifers these homogeneous aquifers were assigned equivalent hydraulic conductivities to each heterogeneous case the equivalent effective horizontal hydraulic conductivity k h and vertical hydraulic conductivity k v values for each of the 105 realizations was calculated using darcy s law by simulating horizontal and vertical freshwater flow through each field across a specified head gradient using modflow harbaugh 2005 these effective k values were later applied in the setup of equivalent homogeneous models corresponding to each heterogeneous realization 2 2 simulation technique boundary conditions and model parameters the variable density code seawat langevin et al 2007 was used to simulate groundwater flow and salt transport in the model aquifers the model domains were 402 m deep and extended 150 km offshore and 50 km onshore fig 2 the model encompasses both offshore and onshore aquifers so that existing offshore fresh groundwater post et al 2013 michael et al 2016 can be tapped during pumping the model depth is large but reasonable according to a global product by zamrsky et al 2018 where 93 of coastal aquifer thickness values are equal to or less than 402 m the 2 d shore perpendicular setup represents a theoretical system in which the facies distributions extend a long distance in the alongshore direction the ocean was represented as a 0 m specified saltwater hydraulic head boundary along the offshore model top and the offshore vertical boundary equivalent freshwater head of 0 m along the top and increasing along the vertical boundary transport boundary conditions along the ocean boundary red line in fig 2 were specified concentration of 35 g l 1 for inflow and zero concentration gradient for outflow the landward vertical boundary black line in fig 2 was assigned a hydraulic head of 10 m for heterogeneous models and the simulated flux through that boundary was assigned to each corresponding homogeneous model in order to maintain equivalence in the models concentration was specified as 0 g l 1 other boundaries black line with hatches in fig 2 were zero flux for both fluid and solute grid discretization was 500 m 3 m values of longitudinal and vertical transverse dispersivity were 200 m and 2 m respectively consistent with those estimated for systems of this scale gelhar et al 1992 specific storage was 10 4 m 1 the effective porosity was 0 2 and the molecular diffusion coefficient was 10 9 m2 s models were run without pumping until they reached a steady state salinity distribution we conducted transient simulations to show pumping introduced swi the previously simulated pre pumping steady state heads and concentrations were assigned as initial conditions in the heterogeneous cases we replaced the inland head boundary with a freshwater flux boundary the flux boundary in homogeneous cases was kept the same this boundary condition allowed a decrease in head along that boundary due to groundwater depletion and did not allow an increase in freshwater inflow pumping was assigned to one model cell 25 km inland and 200 m deep fig 2 which in a 2 d model represents the theoretical situation of a continuous series of pumping wells parallel to the shoreline in the cases where the lithology of the pumping cell was clay or silt the well was moved vertically to the closest sandy cell to minimize excessive drawdown for seawater intrusion simulations the pumping rate was kept constant at 10 m3 day 1 m 1 pumping rates were varied only in the probability based vulnerability assessment see section 2 4 we selected a relatively large pumping rate from those of previous studies table s1 due to the size of our domain the combination of domain size pumping rate and pumping location allowed us to simulate different preferential flow patterns see section 3 3 the 2 d setup neglects potentially important 3 d effects e g pool et al 2011 kerrou and renard 2010 siena and riva 2018 however the computation time required to conduct a statistically meaningful number of 3 d simulations was prohibitive a set of 3 d simulations was run to test the impacts of pumping from a point well rather than a horizontal well and resulting differences were small see text s2 figures s1 s8 a grid refinement test was also conducted around the pumping well to ensure that the results were grid independent see text s2 figures s9 s16 we note however that the rate of density driven saline circulation is dependent on discretization because it is sensitive to small density gradients as discussed in michael et al 2016 2 3 seawater intrusion assessment we used three assessment criteria salinized area seawater intrusion rate and salinization time to describe the groundwater salinization process salinized area is the area in the model domain that changed from below 0 5 g l 1 the u s environmental protection agency drinking water standard epa 2009 to above it within 100 years the seawater intrusion rate is the rate of movement of the saline front the most landward location of the area where concentration is above 0 5 g l 1 it is the 0 5 g l 1 contour at the model base or toe in homogeneous cases during 100 years of pumping salinization time is the time from the start of pumping until to the time that the groundwater salinity of the well reached 0 5 g l 1 2 4 hypothetical scenarios and probability based vulnerability we hypothetically designed a series of scenarios with different pumping locations and pumping rates for the heterogeneous cases in the vulnerability assessment the pumping location was moved to each grid cell within the entire onshore part of the domain i e 0 x 50 km 400 m z 0 at each cell three pumping rates i e 5 m3 day 10 m3 day and 20 m3 day were applied vulnerability level was identified for each case according to the configuration scheme see section 3 3 without running seawat simulations for each geologic continuity group and pumping rate the probabilities of falling in a vulnerability level were calculated as a function of pumping location moving away from the shoreline to understand the impact of pumping depth the probabilities were also calculated as a function of pumping depth moving from top to bottom of the domain 3 results 3 1 influence of aquifer heterogeneity on seawater intrusion comparison of metrics of seawater intrusion indicated differences in vulnerability of fresh groundwater to seawater intrusion for simulations with heterogeneous k distributions compared to equivalent homogeneous models the average salinized area was not significantly different p value 0 15 table 1 between the two populations though the ranges were much greater for the homogeneous models the maximum average and minimum salinized areas were 3 1 1 4 and 0 km2 for heterogeneous simulations compared to 6 3 1 9 and 0 km2 respectively for homogeneous simulations fig 3 seawater intrusion rates were significantly greater in heterogeneous compared to equivalent homogeneous simulations p value 0 0035 the maximum intrusion rates and variability in heterogeneous models were much greater than in the equivalent homogenous models fig 3 salinization time ranged from less than 1 year to more than 1000 years in both homogeneous and heterogeneous models with average times of 467 years and 311 years in the homogeneous and heterogeneous models respectively fig 3 statistical tests were not done for salinization time because some simulations were not salinized within the 1000 years simulation timeframe there was no significant trend with continuity in salinized area or intrusion rate in homogeneous cases the differences between each mean were not statistically significant table 1 except for salinized area in homogeneous models in which low continuity cases had significantly less salinization compared to the highest continuity cases in heterogeneous groups all of the differences between means were not statistically significant to the 95 confidence level table 1 there is an apparent trend of increasing salinization time with continuity however this could not be tested statistically due to the limited model simulation times 3 2 configuration of types of seawater intrusion the results of the 105 pumping simulations for homogeneous aquifers showed three types of seawater intrusion in decreasing order of vulnerability type i active vertical intrusion type ii active horizontal intrusion and type iii passive horizontal intrusion in type i the pumping rate was greater than the inland flux causing freshwater flow to the sea to cease thus it falls within fetter s 1973 categorization of active seawater intrusion in type i a saline front developed at the shoreline and moved vertically downward causing more salinization this occurred in cases with high vertical anisotropy in k i e k h k v 3 6 104 fig 4 a we use active vertical intrusion to describe this type of salinization with horizontal movement of the existing interface and vertical movement of a new saline front fig 5 a in type ii again the pumping rate was greater than the inland flux but the vertical anisotropy was relatively low i e k h k v 2 7 102 fig 4b in these simulations the freshwater saltwater interface moved landward but no upper interface developed we use active horizontal intrusion to describe this salinization pattern fig 5b in type iii the pumping rate was less than the inland flux fresh groundwater continued to flow toward the sea after bypassing the pumping well but the interface still moved inland this is categorized as passive seawater intrusion fetter 1973 and we retain that terminology fig 5c type i is rarely reported but could be more likely to happen as sea level rises and seawater overtops fresh groundwater though our model setup is a static sea type ii has been studied and identified in many coastal aquifers e g badaruddin et al 2017 knight et al 2018 type iii has been intensively studied by analytical methods e g lu et al 2012 rathore et al 2018 and numerical simulations e g pool and carrera 2011 seawater intrusion processes in heterogeneous aquifers also demonstrated three types type iv active preferential intrusion type v passive active preferential intrusion and type vi passive preferential intrusion in type iv active preferential the pumping location was connected to the saline portion of the aquifer by high k facies and the pumping rate was greater than the inland flux fig 4d both fresh and saline groundwater flowed toward the pumping well through a preferential flow path we illustrated this type as fig 5d in type v the pumping location was not connected to saline water and the pumping rate was greater than the inland flux fig 4e initially at the onset of pumping fresh groundwater was withdrawn with negligible impact on the salinity distribution with continued pumping however the saline water may intrude into the sandy layer connected to the well and salinize it due to flow through lower k facies according to werner 2017 passive active intrusion denotes complicated flow patterns we therefore call this type passive active preferential fig 5e lastly in type vi passive preferential the pumping rate was less than the inland flux and the fresh water continued to flow seaward figs 4f and 5f observed real world intrusion processes show preferential flow paths e g lacombe and carleton 2002 xu et al 2016 which may belong to type iv v or vi depending on the distribution of facies relative to saline groundwater 3 3 vulnerability of swi types the types of seawater intrusion described above can be determined based on physical factors that include geology hydrology pumping rate and pumping location we examined geology e g if the pumping location is connected to saline groundwater through a sandy layer and anisotropy and salinization patterns in all the simulations and developed configuration criteria the criteria that determine swi types are mapped in fig 6 first we considered geologic structure homogeneous and heterogeneous in homogeneous cases swi type depended on the pumping rate relative to recharge rate if the pumping rate was less than freshwater inflow the case was type iii passive horizontal intrusion otherwise intrusion was active in active the type depended on anisotropy with a threshold of k h k v 1000 below that the case was type i active vertical intrusion otherwise it was type ii active horizontal intrusion for heterogeneous cases connectivity between pumping location and saline groundwater determined the type if there was a high k connection it was type iv active preferential intrusion the amount of pumping relative to recharge differentiated the final two types if the pumping rate was greater than the freshwater inflow the case was type v passive active preferential intrusion if the pumping rate was less than the inland flux it was type vi passive preferential intrusion the different swi types exhibited contrasting intrusion patterns that resulted in differences in vulnerability fig 7 these group differences were more pronounced and statistically significant than those for differing geologic continuity fig 3 table 1 nine of 12 paired differences between the means of each type were statistically significant to the 95 confidence level table 1 in homogeneous cases type i was most vulnerable with large salinized areas fast intrusion rates and short salinization times type ii was intermediate with medium values of salinized area intrusion rate and salinization time type iii was the least vulnerable due to small salinized areas slow intrusion rates and no salinization at the well in heterogeneous cases type iv was most vulnerable due to high variability in salinized area and intrusion rate and short salinization times type v was of intermediate vulnerability and type vi was the least vulnerable the salinized area and intrusion rates were small and the well was never salinized throughout the simulation period 3 4 influence of pumping depth as an illustration of the influence of pumping depth and geologic connectivity in heterogeneous and homogeneous aquifers we conducted numerical simulations with changing pumping depth for one heterogeneous and equivalent homogeneous set of models pumping depth was critical to salinization processes in the heterogeneous aquifer but had negligible impacts in the equivalent homogeneous aquifer in the heterogeneous aquifer pumping depth variation strongly affected the connectedness of the pumping well to saline or fresh water fig 8 shows how pumping depth variation altered salinization process and configuration results in fig 8a the heterogeneous field is on the left and the steady state salinity distribution is on the right at the well location there were four connected sandy layers shown in the left panels of fig 8b e four pumping scenarios were created in which the well screen intersected one of the sandy layers with depths of 50 m 250 m 280 m and 400 m fig 8b e respectively in each case intrusion advanced quickly only in the sandy zone connected to the well fig 8b e right panels the salinized area also demonstrated dramatic differences due to variation in pumping depth in the case of pumping scenario b depth 50 m the salinized area was largest i e 2 3 km2 while the smallest salinized area was 0 3 km2 in scenario e fig 8f intrusion rates ranged from 6 to 23 m yr 1 fig 8g the intrusion configuration also depended on the pumping depth since it determined the connectedness between the well and saltwater and freshwater zones in pumping scenarios b depth 50 m c depth 250 m e depth 400 m the sandy layer connected to the pumping location was also connected to saline water the inland fresh water flux was smaller than the pumping rate therefore they were type iv active preferential intrusion in scenario d depth 280 m the pumping location was not connected to saline water and therefore it was type vi as passive preferential intrusion 3 5 probability based vulnerability assessment a probability based vulnerability assessment was conducted based on scenarios with changing pumping rates and pumping locations which are shown to be critical for swi vulnerability in sections 3 3 and 3 4 simply configuring the systems based on the scheme in fig 5 enables an assessment of how pumping locations and depths change the probability of falling into a particular type and therefore a first indicator of vulnerability without requiring a full simulation for every pumping rate and location geologic continuity decreased groundwater vulnerability to seawater intrusion fig 9 the frequency of the most vulnerable intrusion type type iv was 0 53 0 28 and 0 28 in low medium and high continuity groups respectively the frequency of the least vulnerable intrusion type type vi was 0 18 0 54 and 0 58 in low medium and high continuity groups respectively pumping rate increased groundwater vulnerability to seawater intrusion fig 10 the frequency of the most vulnerable intrusion type type iv was 0 48 0 53 and 0 59 for pumping rates of 5 m3 day 10 m3 day and 20 m3 day respectively the frequency of the least vulnerable intrusion type type vi was 0 26 0 18 and 0 05 for pumping rates of 5 m3 day 10 m3 day and 20 m3 day respectively vulnerability was reduced as the pumping wells moved inland but only markedly in the low continuity cases in the low continuity group the vulnerability decreased dramatically as the pumping location moved away from the coastline in the fig 9a the frequency of the most vulnerable type type iv was 0 70 when the pumping location was less than 10 km from the shoreline and frequency gradually decreased to 0 20 when pumping location moved to the inland boundary in medium and high continuity groups the frequency of the most vulnerable type type iv showed only a slight decrease as the pumping location moved landward vulnerability also varied somewhat with pumping depth fig 10 in the high continuity group fig 10c the frequency of the most vulnerable type was approximately 0 20 0 30 and 0 35 for the three pumping rates respectively when pumping depth was less than 50 m and it gradually increased to 0 50 when pumping location moved to the bottom of the aquifer 400 m depth the impact of pumping depth was less significant in the medium continuity group fig 10b and was not consistent in the low continuity group fig 10a 4 discussion 4 1 characterizing heterogeneity for vulnerability assessment this study highlights the importance of large scale geologic heterogeneity for pumping induced groundwater salinization heterogeneity had two main impacts on swi first the heterogeneous models had vastly different fresh throughflow rates for the same inland head and facies proportions suggesting that the amount of fresh groundwater from land available to pump may be unexpectedly low in some cases pumping on this type of system must be cautious since a normal pumping rate based on simplified hydrological considerations may exceed the inland recharge rate causing active intrusion second heterogeneity may create preferential flow paths that accelerate intrusion processes e g xu et al 2016 scharping et al 2018 meyer et al 2019 or barriers that slow swi e g strack et al 2016 geostatistical simulations of aquifer heterogeneity are useful tools for understanding groundwater flow and solute transport processes since ensemble model simulation results can reveal a range of potential environmental consequences e g koohbor et al 2019 by modeling the same pumping rate and equivalent freshwater inflow in paired heterogeneous and homogenous aquifers we isolated the effect of geologic heterogeneity on swi and gained a better understanding of coastal groundwater vulnerability our results suggest that geologic structure is a critical factor to vulnerability hinging primarily on the connectedness of high k facies between the well location and saline portions of aquifers to apply these insights however managers must have the information necessary to configure the system information on aquifer scale geological structure this type of well connectivity is difficult or impossible to obtain from subsurface characterization because our scale of observation is generally much smaller than the extent of the layering and the regional operational scale e g fogg and zhang 2016 it may be more realistic however to determine overall how extensive geologic layers are corresponding to different continuity groups thus we developed a swi configuration scheme that differentiates vulnerability more effectively than continuity and calculated a probability based vulnerability for each geologic continuity group that provides insights into the most critical management considerations in different types of geologic systems the continuity of geologic layers or facies which is still challenging to obtain may be derived from borehole data geophysics or understanding of the depositional environment whether the continuity should be considered low or high depends on the scale of the system essentially the distance from the proposed pumping area to the saline portion of the aquifer in this analysis we fixed that scale to be on the order of tens of kilometers and so our low continuity system has connected facies that on average are much smaller and our high continuity system has connected facies that are on average longer than the pump to saline groundwater separation in smaller systems the continuity characterization would scale accordingly 4 2 implications for coastal groundwater management our analysis demonstrates that it is uninformative to use a homogeneous model to plan and manage coastal groundwater pumping in heterogeneous aquifers in our simulations the pumping location in homogeneous models is not critical to configuration results and vulnerability types whereas in heterogeneous aquifers changes in the pumping depth and location can completely change the intrusion pattern and vulnerability our analysis shows that the controlling factors vary as geologic continuity increases suggesting that management priorities may change depending on aquifer structure according to this analysis in low continuity aquifers groundwater management should focus on well distance from the coastline which can significantly affect the vulnerability in high continuity aquifers well depth is more of a management priority and shallow pumping tends to be less vulnerable than deep pumping the call for attention to large scale heterogeneity is also important for managed aquifer recharge mar artificial recharge which is the inverse process of groundwater pumping has been widely applied to secure fresh groundwater resources control seawater intrusion and recover groundwater quality e g lu et al 2017 luyun et al 2011 kang et al 2017 introduced small scale 10 100 m heterogeneity in mar characterization and found that it is important in recovery efficiency considering the role of large scale geologic heterogeneity in this study the application of mar may be even more complex with preferential flow creating active connections between recharge sources and disparate locations in the aquifer the analysis provides insights into how geologic heterogeneity and land sea hydrogeologic connections relate to modes and rates of seawater intrusion while the approach was developed for a particular type of system the approach of configuration plus probability can be applied to settings with different types of heterogeneity the configuration typology may be modified for different settings and extended to include 3 d heterogeneity in the alongshore direction 4 3 assumptions and limitations the aim of this work is to improve understanding of basic controls on seawater intrusion due to pumping and to assess coastal groundwater vulnerability for heterogeneous aquifers the numerical experiments were conducted in the framework of a highly idealized system based on 2 d heterogeneous geological fields and a single pumping well with a constant rate of groundwater withdrawal representing a geologic and pumping system that extends continuously in the alongshore direction while this approach allows illustration of the effects of heterogeneity it neglects 3 d effects and boundary condition variations lu et al 2012 for example greater inland penetration of seawater intrusion has been shown in simulation of a single pumping well in a 3 d domain compared to 2 d lu et al 2013a b however these 3 d simulations are highly computationally intensive and would prohibit analysis of a large number of realizations that allows characterization of different types of salinization behavior as well as the significance of the observed differences in order to assess the potential impacts of using a 2 d pumping scenario we conducted 3 d pumping simulations for each representative case in fig 4 the intrusion configuration results were not changed and salinity distributions and vulnerability metrics had only minor differences see text s1 therefore we believe that the same general results and insights will hold for 3 d systems however a more robust analysis testing sensitivity to connectivity in the alongshore directions could yield different continuity typologies and vulnerability we also did not consider the effects of specific yield specific storage and dispersivity which could impact salinity distributions and salt transport rates abarca et al 2007 another overlooked issue is the pumping operation which affects salinization processes often groundwater abstraction is determined by both annual and seasonal requirements especially in areas with agriculture and tourism e g chekirbane et al 2015 cobaner et al 2012 prieto et al 2006 and wells are distributed spatially e g llopis albert and pulido velazquez 2014 narayan et al 2007 these transient and distributed conditions may affect intrusion processes compared to having a constant pumping rate at a single well our results provide some insights into preferential patterns of seawater intrusion but site specific characteristics should be considered for optimal management of groundwater e g cheng et al 2000 huang and mayer 1997 ketabchi and ataie ashtiani 2015b libera et al 2017 park and aral 2004 5 conclusion the traditional prediction of swi in homogeneous aquifers requires revision to account for the influence of aquifer heterogeneity this study provides insights into how heterogeneous land sea geologic connections relate to the mode rate and extent of seawater intrusion our simulations suggest that heterogeneity substantially affects swi in coastal aquifers subject to pumping to better understand such impacts we identified 6 types of swi i active vertical ii active horizontal iii passive horizontal iv active preferential v passive active preferential and vi passive preferential the configurations can discriminate critical features of swi which are associated with vulnerability levels i e types i and iv are high vulnerability types ii and v are medium vulnerability and types iii and vi are low vulnerability we applied a probability based assessment to heterogeneous aquifers and found that vulnerability based on the configuration is sensitive to pumping distance in low geologic continuity aquifers and to pumping depth in high continuity aquifers thus management priorities may change depending on aquifer structure future efforts to refine the configuration typology for swi should consider other processes not considered here e g multi well pumping seasonal variation of land ocean gradient analyses of other types of geologic heterogeneity e g highly connected karst or volcanic aquifers could also be critical to understanding pumping induced salinization in real systems an improved understanding of swi processes will enable more effective assessment of the vulnerability of coastal groundwater resources to salinization by pumping acknowledgments the authors gratefully acknowledge julia guimond for helpful comments on the manuscript we would like to thank the associate editor and four anonymous reviewers for their critical reviews and constructive comments that improved the manuscript this work was funded by the u s national science foundation ear1151733 to h m model files can be obtained by contacting the corresponding author this research was supported in part through the use of information technologies it resources at the university of delaware specifically the high performance computing resources supplementary materials supplementary material associated with this article can be found in the online version at doi 10 1016 j advwatres 2019 04 013 appendix supplementary materials image application 1 
658,coastal aquifers are vulnerable to seawater intrusion due to excessive groundwater pumping most research on salinization vulnerability considers homogeneous aquifers forming the basis of management guidance however geologic structure can be highly heterogeneous with preferential flow paths and low permeability barriers that complicate flow and salt transport processes under pumping conditions here we use a series of variable density groundwater flow and salt transport models with geostatistical representations of heterogeneity to illustrate characteristics of vulnerability in heterogeneous and homogeneous aquifers simulations showed that in homogeneous aquifers salinization patterns were simple and related only to the hydraulic properties in heterogeneous aquifers salinization rates and patterns were much more complicated and related to pumping location and depth aquifer geometry and geologic connections between pumping location landward boundaries and saline groundwater an intrusion configuration typology approach was developed for both homogeneous and heterogeneous aquifers the configuration approach was applied to heterogeneous aquifers of low medium and high geologic continuity and vulnerability was assessed the probability based assessment was able to characterize the impact of pumping locations and rates in heterogeneous aquifers considering different types of intrusion the results showed that groundwater vulnerability to salinization was sensitive to pumping distance to the coastline for low continuity aquifers and to pumping depth for high continuity aquifers the analysis provides new insights into the relationship between land sea geologic connections and seawater intrusion vulnerability the configuration approach plus probability based assessment can be a starting point for large scale aquifer characterization and more sophisticated groundwater management including vulnerability assessment and optimization of pumping location depth and rate keywords groundwater saltwater intrusion heterogeneity geostatistics coastal water resources vulnerability 1 introduction coastal areas around the world host large populations and intense economic activity in the us coastal counties have a population of 134 million and contribute 48 of the nation s gdp kildow et al 2016 fresh water resources in coastal zones are critical to human health and economies agriculture e g narayan et al 2007 and ecosystems and their services e g langston et al 2017 white and kaplan 2017 xiao et al 2018 these water use requirements increase pressure on coastal groundwater resources michael et al 2017 in many areas intensive pumping of fresh groundwater has resulted in widespread intrusion of seawater driving aquifers beyond sustainability werner et al 2013 at larger scales excessive groundwater pumping whether onshore or offshore can lead to widespread losses of freshwater due to geologic connections from wells to fresh groundwater reserves knight et al 2018 yu and michael 2019 pumping saline groundwater for desalination can also cause seaward movement of the freshwater saltwater interface stein et al 2019 thus understanding seawater intrusion swi in coastal aquifers at a large scale is essential for managing and protecting onshore and offshore groundwater resources analytical and numerical models have been used to assess aquifer vulnerability to swi for more than a century the most simple models approximate the freshwater saltwater interface as sharp often based on the ghyben herzberg relation post et al 2018 and then a single potential formulation strack 1976 to describe groundwater flow a variety of analytical models have been developed considering different pumping scenarios and boundary conditions e g mazi et al 2014 park et al 2009 llopis albert and pulido velazquez 2014 mantoglou 2003 wang et al 2014 more realistic analytical models of variable density flow include mixing between freshwater and saltwater e g fahs et al 2016 simpson and clement 2004 strack et al 2016 shao et al 2018 these methods can give a first approximation of vulnerability and aquifer response to pumping under various sets of assumptions e g beebe et al 2016 cheng et al 2000 kacimov and sherif 2006 lu et al 2015 mantoglou 2003 morgan and werner 2014 pool and carrera 2011 wang et al 2014 werner et al 2012 numerical models are used for more realistic simulation of swi processes considering nonlinearity transience and miscibility of fresh and saline groundwater these models couple flow and transport equations to obtain the salinity distribution across the domain for a given pumping location and rate e g narayan et al 2007 park and aral 2004 compared to analytical solutions numerical models are more flexible allowing more complex boundary conditions and parameter distributions and they are more accurate when the transition zone is thick liopis albert and pulido velazquez 2014 swi can be predicted by numerical simulations under different scenarios of climate and pumping operation e g de filippis et al 2016 garcía menéndez et al 2016 sherif et al 2013 michael et al 2013 model predictions can also be linked with optimization tools that enhance coastal aquifer management e g ataie ashtiani and ketabchi 2011 ketabchi and ataie ashtiani 2015a hussain et al 2015 qahman et al 2005 rao et al 2014 ketabchi and ataie ashtiani 2015b singh 2014 2015 song et al 2018 mantoglou 2003 prieto et al 2006 despite their flexibility the vast majority of studies on vulnerability assessment of swi assume homogeneous aquifer properties or simplified layered geology although much of our understanding of swi mechanisms and management are derived from homogeneous models aquifer heterogeneity has been shown to critically affect both salinity distributions and seawater intrusion processes lu et al 2013a b found that a thick mixing zone may occur in low conductivity layers in stratified coastal aquifers zamrsky et al 2018 found that an aquitard has a substantial effect on the final salinity profile when compared to the salinity profile for homogenous geological conditions houben et al 2018 investigated different types of heterogeneity and found that heterogeneity strongly influences coastal groundwater flow siena and riva 2018 found that the combined effects of aquifer heterogeneity and pumping operations on seawater intrusion reduce the intrusion rate and increases the width of the mixing zone michael et al 2016 showed that connected aquifer structures create preferential flow paths resulting in complex salinity distributions that differ greatly from those simulated in equivalent homogeneous aquifers kerrou and renard 2010 presented the effects of heterogeneity on swi and found that heterogeneity can substantially increase the size of mixing zone due to increased macrodispersion mantoglou 2003 found that optimal pumping rates are very sensitive to hydraulic conductivity heterogeneities sebben et al 2015 showed that in fractured coastal aquifers both the density and orientation of fracture networks have a significant impact on the seawater freshwater interface xu et al 2016 found that subsurface conduit networks in a coastal karst aquifer created a preferential swi pathway reaching as far as 23 km inland scharping et al 2018 explored spring vents near tampa usa and showed that spring water is connected to the coastal mixing zone through bedrock fractures thus preferential flow paths resulting from aquifer heterogeneity can dramatically increase the vulnerability of groundwater to pumping induced swi despite advances in modeling swi it remains difficult to realistically predict swi along the coast at large scales e g bocanegra et al 2010 perhaps in large part because of the difficulty in realistically assessing and representing heterogeneity as such the vulnerability of coastal groundwater is often assessed by simplified indicators e g lobo ferreira et al 2007 werner et al 2012 and classification methods e g fleury et al 2007 fetter 1973 proposed a two part classification of swi problems 1 passive swi referring to the inland movement of seawater in areas where fresh groundwater flows towards the coastline and 2 active swi where seawater moves in the same direction as fresh groundwater flow morgan and werner 2015 assessed vulnerability of 28 coastal aquifers in australia based on the two types of swi passive active werner 2017 revisited fetter s 1973 classification and characterized swi into three classes passive passive active and active further investigation showed that real world occurrences of active swi can occur in many field settings which was traditionally unappreciated and overlooked badaruddin et al 2017 knight et al 2018 analyzed twenty seven coastal aquifers and found that fourteen of them are experiencing active swi towards pumping wells this new classification identified critical intrusion patterns in different hydrogeological settings improving the vulnerability assessment of coastal groundwater aquifers to salinization however these classifications while useful for initial assessment are based on an assumption of homogeneity thus applicability may be limited if the ubiquitous heterogeneity of coastal aquifers holland and elmore 2008 is not considered despite the strong dependence of seawater intrusion processes on aquifer heterogeneity heterogeneous models have not yet been well integrated into coastal aquifer vulnerability assessments or management activities on one hand heterogeneity may allow fresh groundwater to exist far offshore michael et al 2016 potentially greatly delaying onshore salinization one the other hand geologic heterogeneity can create preferential flowpaths for fast swi as well as intrusion barriers e g strack et al 2016 anwar 1983 during pumping saline water can arrive at a pumping well quickly without salinization of the entire aquifer fig 1 potentially bypassing monitoring wells and artificial low permeability barriers we hypothesize that these processes can substantially impact vulnerability as assessed by previous indicators this study investigates the effect of heterogeneity on seawater intrusion due to groundwater pumping and establishes a new configuration typology and probability based vulnerability assessment for heterogeneous aquifers specific objectives of the present study are to i show how large scale heterogeneities in hydraulic conductivity may influence saltwater intrusion under pumping ii develop a configuration framework to identify the influence of different characteristics on intrusion extent rate and path and iii apply the configuration method to different types of aquifers and probabilistically assess groundwater resource vulnerability to coastal pumping 2 methods 2 1 simulated scenarios of aquifer heterogeneity heterogeneous distributions of geologic facies were developed using a geostatistical model by sequential indicator simulation chiles and delfiner 2009 in the models four distinct facies clay silt fine sand and medium to coarse sand were distinguished based on the thick stack of highly heterogeneous sediments that comprise the lower bengal delta aquifer system alam et al 2003 allison et al 2003 a variogram model was developed to capture the spatial correlation of these facies and the horizontal and vertical variogram ranges were 25 km and 50 m respectively using that model as a basis for realistic aquifer structure the facies proportions and vertical variogram ranges were kept unchanged but horizontal variogram ranges were varied to obtain three groups 5 km 25 km and 50 km for simulation of heterogeneous fields that encompass that of the bengal delta and a range of other coastal aquifers low medium and high geologic continuity respectively we used 35 realizations for each geologic continuity group for a more detailed description of the geostatistical model see michael et al 2016 representative values of hydraulic conductivity k were assigned to each of the four facies 10 11 m s 10 6 m s 10 3 m s and 10 1 m s for clay silt fine sand and medium to coarse sand respectively to connect with previous classification methods for homogeneous cases e g werner 2017 fetter 1973 we also analyzed swi in homogeneous aquifers these homogeneous aquifers were assigned equivalent hydraulic conductivities to each heterogeneous case the equivalent effective horizontal hydraulic conductivity k h and vertical hydraulic conductivity k v values for each of the 105 realizations was calculated using darcy s law by simulating horizontal and vertical freshwater flow through each field across a specified head gradient using modflow harbaugh 2005 these effective k values were later applied in the setup of equivalent homogeneous models corresponding to each heterogeneous realization 2 2 simulation technique boundary conditions and model parameters the variable density code seawat langevin et al 2007 was used to simulate groundwater flow and salt transport in the model aquifers the model domains were 402 m deep and extended 150 km offshore and 50 km onshore fig 2 the model encompasses both offshore and onshore aquifers so that existing offshore fresh groundwater post et al 2013 michael et al 2016 can be tapped during pumping the model depth is large but reasonable according to a global product by zamrsky et al 2018 where 93 of coastal aquifer thickness values are equal to or less than 402 m the 2 d shore perpendicular setup represents a theoretical system in which the facies distributions extend a long distance in the alongshore direction the ocean was represented as a 0 m specified saltwater hydraulic head boundary along the offshore model top and the offshore vertical boundary equivalent freshwater head of 0 m along the top and increasing along the vertical boundary transport boundary conditions along the ocean boundary red line in fig 2 were specified concentration of 35 g l 1 for inflow and zero concentration gradient for outflow the landward vertical boundary black line in fig 2 was assigned a hydraulic head of 10 m for heterogeneous models and the simulated flux through that boundary was assigned to each corresponding homogeneous model in order to maintain equivalence in the models concentration was specified as 0 g l 1 other boundaries black line with hatches in fig 2 were zero flux for both fluid and solute grid discretization was 500 m 3 m values of longitudinal and vertical transverse dispersivity were 200 m and 2 m respectively consistent with those estimated for systems of this scale gelhar et al 1992 specific storage was 10 4 m 1 the effective porosity was 0 2 and the molecular diffusion coefficient was 10 9 m2 s models were run without pumping until they reached a steady state salinity distribution we conducted transient simulations to show pumping introduced swi the previously simulated pre pumping steady state heads and concentrations were assigned as initial conditions in the heterogeneous cases we replaced the inland head boundary with a freshwater flux boundary the flux boundary in homogeneous cases was kept the same this boundary condition allowed a decrease in head along that boundary due to groundwater depletion and did not allow an increase in freshwater inflow pumping was assigned to one model cell 25 km inland and 200 m deep fig 2 which in a 2 d model represents the theoretical situation of a continuous series of pumping wells parallel to the shoreline in the cases where the lithology of the pumping cell was clay or silt the well was moved vertically to the closest sandy cell to minimize excessive drawdown for seawater intrusion simulations the pumping rate was kept constant at 10 m3 day 1 m 1 pumping rates were varied only in the probability based vulnerability assessment see section 2 4 we selected a relatively large pumping rate from those of previous studies table s1 due to the size of our domain the combination of domain size pumping rate and pumping location allowed us to simulate different preferential flow patterns see section 3 3 the 2 d setup neglects potentially important 3 d effects e g pool et al 2011 kerrou and renard 2010 siena and riva 2018 however the computation time required to conduct a statistically meaningful number of 3 d simulations was prohibitive a set of 3 d simulations was run to test the impacts of pumping from a point well rather than a horizontal well and resulting differences were small see text s2 figures s1 s8 a grid refinement test was also conducted around the pumping well to ensure that the results were grid independent see text s2 figures s9 s16 we note however that the rate of density driven saline circulation is dependent on discretization because it is sensitive to small density gradients as discussed in michael et al 2016 2 3 seawater intrusion assessment we used three assessment criteria salinized area seawater intrusion rate and salinization time to describe the groundwater salinization process salinized area is the area in the model domain that changed from below 0 5 g l 1 the u s environmental protection agency drinking water standard epa 2009 to above it within 100 years the seawater intrusion rate is the rate of movement of the saline front the most landward location of the area where concentration is above 0 5 g l 1 it is the 0 5 g l 1 contour at the model base or toe in homogeneous cases during 100 years of pumping salinization time is the time from the start of pumping until to the time that the groundwater salinity of the well reached 0 5 g l 1 2 4 hypothetical scenarios and probability based vulnerability we hypothetically designed a series of scenarios with different pumping locations and pumping rates for the heterogeneous cases in the vulnerability assessment the pumping location was moved to each grid cell within the entire onshore part of the domain i e 0 x 50 km 400 m z 0 at each cell three pumping rates i e 5 m3 day 10 m3 day and 20 m3 day were applied vulnerability level was identified for each case according to the configuration scheme see section 3 3 without running seawat simulations for each geologic continuity group and pumping rate the probabilities of falling in a vulnerability level were calculated as a function of pumping location moving away from the shoreline to understand the impact of pumping depth the probabilities were also calculated as a function of pumping depth moving from top to bottom of the domain 3 results 3 1 influence of aquifer heterogeneity on seawater intrusion comparison of metrics of seawater intrusion indicated differences in vulnerability of fresh groundwater to seawater intrusion for simulations with heterogeneous k distributions compared to equivalent homogeneous models the average salinized area was not significantly different p value 0 15 table 1 between the two populations though the ranges were much greater for the homogeneous models the maximum average and minimum salinized areas were 3 1 1 4 and 0 km2 for heterogeneous simulations compared to 6 3 1 9 and 0 km2 respectively for homogeneous simulations fig 3 seawater intrusion rates were significantly greater in heterogeneous compared to equivalent homogeneous simulations p value 0 0035 the maximum intrusion rates and variability in heterogeneous models were much greater than in the equivalent homogenous models fig 3 salinization time ranged from less than 1 year to more than 1000 years in both homogeneous and heterogeneous models with average times of 467 years and 311 years in the homogeneous and heterogeneous models respectively fig 3 statistical tests were not done for salinization time because some simulations were not salinized within the 1000 years simulation timeframe there was no significant trend with continuity in salinized area or intrusion rate in homogeneous cases the differences between each mean were not statistically significant table 1 except for salinized area in homogeneous models in which low continuity cases had significantly less salinization compared to the highest continuity cases in heterogeneous groups all of the differences between means were not statistically significant to the 95 confidence level table 1 there is an apparent trend of increasing salinization time with continuity however this could not be tested statistically due to the limited model simulation times 3 2 configuration of types of seawater intrusion the results of the 105 pumping simulations for homogeneous aquifers showed three types of seawater intrusion in decreasing order of vulnerability type i active vertical intrusion type ii active horizontal intrusion and type iii passive horizontal intrusion in type i the pumping rate was greater than the inland flux causing freshwater flow to the sea to cease thus it falls within fetter s 1973 categorization of active seawater intrusion in type i a saline front developed at the shoreline and moved vertically downward causing more salinization this occurred in cases with high vertical anisotropy in k i e k h k v 3 6 104 fig 4 a we use active vertical intrusion to describe this type of salinization with horizontal movement of the existing interface and vertical movement of a new saline front fig 5 a in type ii again the pumping rate was greater than the inland flux but the vertical anisotropy was relatively low i e k h k v 2 7 102 fig 4b in these simulations the freshwater saltwater interface moved landward but no upper interface developed we use active horizontal intrusion to describe this salinization pattern fig 5b in type iii the pumping rate was less than the inland flux fresh groundwater continued to flow toward the sea after bypassing the pumping well but the interface still moved inland this is categorized as passive seawater intrusion fetter 1973 and we retain that terminology fig 5c type i is rarely reported but could be more likely to happen as sea level rises and seawater overtops fresh groundwater though our model setup is a static sea type ii has been studied and identified in many coastal aquifers e g badaruddin et al 2017 knight et al 2018 type iii has been intensively studied by analytical methods e g lu et al 2012 rathore et al 2018 and numerical simulations e g pool and carrera 2011 seawater intrusion processes in heterogeneous aquifers also demonstrated three types type iv active preferential intrusion type v passive active preferential intrusion and type vi passive preferential intrusion in type iv active preferential the pumping location was connected to the saline portion of the aquifer by high k facies and the pumping rate was greater than the inland flux fig 4d both fresh and saline groundwater flowed toward the pumping well through a preferential flow path we illustrated this type as fig 5d in type v the pumping location was not connected to saline water and the pumping rate was greater than the inland flux fig 4e initially at the onset of pumping fresh groundwater was withdrawn with negligible impact on the salinity distribution with continued pumping however the saline water may intrude into the sandy layer connected to the well and salinize it due to flow through lower k facies according to werner 2017 passive active intrusion denotes complicated flow patterns we therefore call this type passive active preferential fig 5e lastly in type vi passive preferential the pumping rate was less than the inland flux and the fresh water continued to flow seaward figs 4f and 5f observed real world intrusion processes show preferential flow paths e g lacombe and carleton 2002 xu et al 2016 which may belong to type iv v or vi depending on the distribution of facies relative to saline groundwater 3 3 vulnerability of swi types the types of seawater intrusion described above can be determined based on physical factors that include geology hydrology pumping rate and pumping location we examined geology e g if the pumping location is connected to saline groundwater through a sandy layer and anisotropy and salinization patterns in all the simulations and developed configuration criteria the criteria that determine swi types are mapped in fig 6 first we considered geologic structure homogeneous and heterogeneous in homogeneous cases swi type depended on the pumping rate relative to recharge rate if the pumping rate was less than freshwater inflow the case was type iii passive horizontal intrusion otherwise intrusion was active in active the type depended on anisotropy with a threshold of k h k v 1000 below that the case was type i active vertical intrusion otherwise it was type ii active horizontal intrusion for heterogeneous cases connectivity between pumping location and saline groundwater determined the type if there was a high k connection it was type iv active preferential intrusion the amount of pumping relative to recharge differentiated the final two types if the pumping rate was greater than the freshwater inflow the case was type v passive active preferential intrusion if the pumping rate was less than the inland flux it was type vi passive preferential intrusion the different swi types exhibited contrasting intrusion patterns that resulted in differences in vulnerability fig 7 these group differences were more pronounced and statistically significant than those for differing geologic continuity fig 3 table 1 nine of 12 paired differences between the means of each type were statistically significant to the 95 confidence level table 1 in homogeneous cases type i was most vulnerable with large salinized areas fast intrusion rates and short salinization times type ii was intermediate with medium values of salinized area intrusion rate and salinization time type iii was the least vulnerable due to small salinized areas slow intrusion rates and no salinization at the well in heterogeneous cases type iv was most vulnerable due to high variability in salinized area and intrusion rate and short salinization times type v was of intermediate vulnerability and type vi was the least vulnerable the salinized area and intrusion rates were small and the well was never salinized throughout the simulation period 3 4 influence of pumping depth as an illustration of the influence of pumping depth and geologic connectivity in heterogeneous and homogeneous aquifers we conducted numerical simulations with changing pumping depth for one heterogeneous and equivalent homogeneous set of models pumping depth was critical to salinization processes in the heterogeneous aquifer but had negligible impacts in the equivalent homogeneous aquifer in the heterogeneous aquifer pumping depth variation strongly affected the connectedness of the pumping well to saline or fresh water fig 8 shows how pumping depth variation altered salinization process and configuration results in fig 8a the heterogeneous field is on the left and the steady state salinity distribution is on the right at the well location there were four connected sandy layers shown in the left panels of fig 8b e four pumping scenarios were created in which the well screen intersected one of the sandy layers with depths of 50 m 250 m 280 m and 400 m fig 8b e respectively in each case intrusion advanced quickly only in the sandy zone connected to the well fig 8b e right panels the salinized area also demonstrated dramatic differences due to variation in pumping depth in the case of pumping scenario b depth 50 m the salinized area was largest i e 2 3 km2 while the smallest salinized area was 0 3 km2 in scenario e fig 8f intrusion rates ranged from 6 to 23 m yr 1 fig 8g the intrusion configuration also depended on the pumping depth since it determined the connectedness between the well and saltwater and freshwater zones in pumping scenarios b depth 50 m c depth 250 m e depth 400 m the sandy layer connected to the pumping location was also connected to saline water the inland fresh water flux was smaller than the pumping rate therefore they were type iv active preferential intrusion in scenario d depth 280 m the pumping location was not connected to saline water and therefore it was type vi as passive preferential intrusion 3 5 probability based vulnerability assessment a probability based vulnerability assessment was conducted based on scenarios with changing pumping rates and pumping locations which are shown to be critical for swi vulnerability in sections 3 3 and 3 4 simply configuring the systems based on the scheme in fig 5 enables an assessment of how pumping locations and depths change the probability of falling into a particular type and therefore a first indicator of vulnerability without requiring a full simulation for every pumping rate and location geologic continuity decreased groundwater vulnerability to seawater intrusion fig 9 the frequency of the most vulnerable intrusion type type iv was 0 53 0 28 and 0 28 in low medium and high continuity groups respectively the frequency of the least vulnerable intrusion type type vi was 0 18 0 54 and 0 58 in low medium and high continuity groups respectively pumping rate increased groundwater vulnerability to seawater intrusion fig 10 the frequency of the most vulnerable intrusion type type iv was 0 48 0 53 and 0 59 for pumping rates of 5 m3 day 10 m3 day and 20 m3 day respectively the frequency of the least vulnerable intrusion type type vi was 0 26 0 18 and 0 05 for pumping rates of 5 m3 day 10 m3 day and 20 m3 day respectively vulnerability was reduced as the pumping wells moved inland but only markedly in the low continuity cases in the low continuity group the vulnerability decreased dramatically as the pumping location moved away from the coastline in the fig 9a the frequency of the most vulnerable type type iv was 0 70 when the pumping location was less than 10 km from the shoreline and frequency gradually decreased to 0 20 when pumping location moved to the inland boundary in medium and high continuity groups the frequency of the most vulnerable type type iv showed only a slight decrease as the pumping location moved landward vulnerability also varied somewhat with pumping depth fig 10 in the high continuity group fig 10c the frequency of the most vulnerable type was approximately 0 20 0 30 and 0 35 for the three pumping rates respectively when pumping depth was less than 50 m and it gradually increased to 0 50 when pumping location moved to the bottom of the aquifer 400 m depth the impact of pumping depth was less significant in the medium continuity group fig 10b and was not consistent in the low continuity group fig 10a 4 discussion 4 1 characterizing heterogeneity for vulnerability assessment this study highlights the importance of large scale geologic heterogeneity for pumping induced groundwater salinization heterogeneity had two main impacts on swi first the heterogeneous models had vastly different fresh throughflow rates for the same inland head and facies proportions suggesting that the amount of fresh groundwater from land available to pump may be unexpectedly low in some cases pumping on this type of system must be cautious since a normal pumping rate based on simplified hydrological considerations may exceed the inland recharge rate causing active intrusion second heterogeneity may create preferential flow paths that accelerate intrusion processes e g xu et al 2016 scharping et al 2018 meyer et al 2019 or barriers that slow swi e g strack et al 2016 geostatistical simulations of aquifer heterogeneity are useful tools for understanding groundwater flow and solute transport processes since ensemble model simulation results can reveal a range of potential environmental consequences e g koohbor et al 2019 by modeling the same pumping rate and equivalent freshwater inflow in paired heterogeneous and homogenous aquifers we isolated the effect of geologic heterogeneity on swi and gained a better understanding of coastal groundwater vulnerability our results suggest that geologic structure is a critical factor to vulnerability hinging primarily on the connectedness of high k facies between the well location and saline portions of aquifers to apply these insights however managers must have the information necessary to configure the system information on aquifer scale geological structure this type of well connectivity is difficult or impossible to obtain from subsurface characterization because our scale of observation is generally much smaller than the extent of the layering and the regional operational scale e g fogg and zhang 2016 it may be more realistic however to determine overall how extensive geologic layers are corresponding to different continuity groups thus we developed a swi configuration scheme that differentiates vulnerability more effectively than continuity and calculated a probability based vulnerability for each geologic continuity group that provides insights into the most critical management considerations in different types of geologic systems the continuity of geologic layers or facies which is still challenging to obtain may be derived from borehole data geophysics or understanding of the depositional environment whether the continuity should be considered low or high depends on the scale of the system essentially the distance from the proposed pumping area to the saline portion of the aquifer in this analysis we fixed that scale to be on the order of tens of kilometers and so our low continuity system has connected facies that on average are much smaller and our high continuity system has connected facies that are on average longer than the pump to saline groundwater separation in smaller systems the continuity characterization would scale accordingly 4 2 implications for coastal groundwater management our analysis demonstrates that it is uninformative to use a homogeneous model to plan and manage coastal groundwater pumping in heterogeneous aquifers in our simulations the pumping location in homogeneous models is not critical to configuration results and vulnerability types whereas in heterogeneous aquifers changes in the pumping depth and location can completely change the intrusion pattern and vulnerability our analysis shows that the controlling factors vary as geologic continuity increases suggesting that management priorities may change depending on aquifer structure according to this analysis in low continuity aquifers groundwater management should focus on well distance from the coastline which can significantly affect the vulnerability in high continuity aquifers well depth is more of a management priority and shallow pumping tends to be less vulnerable than deep pumping the call for attention to large scale heterogeneity is also important for managed aquifer recharge mar artificial recharge which is the inverse process of groundwater pumping has been widely applied to secure fresh groundwater resources control seawater intrusion and recover groundwater quality e g lu et al 2017 luyun et al 2011 kang et al 2017 introduced small scale 10 100 m heterogeneity in mar characterization and found that it is important in recovery efficiency considering the role of large scale geologic heterogeneity in this study the application of mar may be even more complex with preferential flow creating active connections between recharge sources and disparate locations in the aquifer the analysis provides insights into how geologic heterogeneity and land sea hydrogeologic connections relate to modes and rates of seawater intrusion while the approach was developed for a particular type of system the approach of configuration plus probability can be applied to settings with different types of heterogeneity the configuration typology may be modified for different settings and extended to include 3 d heterogeneity in the alongshore direction 4 3 assumptions and limitations the aim of this work is to improve understanding of basic controls on seawater intrusion due to pumping and to assess coastal groundwater vulnerability for heterogeneous aquifers the numerical experiments were conducted in the framework of a highly idealized system based on 2 d heterogeneous geological fields and a single pumping well with a constant rate of groundwater withdrawal representing a geologic and pumping system that extends continuously in the alongshore direction while this approach allows illustration of the effects of heterogeneity it neglects 3 d effects and boundary condition variations lu et al 2012 for example greater inland penetration of seawater intrusion has been shown in simulation of a single pumping well in a 3 d domain compared to 2 d lu et al 2013a b however these 3 d simulations are highly computationally intensive and would prohibit analysis of a large number of realizations that allows characterization of different types of salinization behavior as well as the significance of the observed differences in order to assess the potential impacts of using a 2 d pumping scenario we conducted 3 d pumping simulations for each representative case in fig 4 the intrusion configuration results were not changed and salinity distributions and vulnerability metrics had only minor differences see text s1 therefore we believe that the same general results and insights will hold for 3 d systems however a more robust analysis testing sensitivity to connectivity in the alongshore directions could yield different continuity typologies and vulnerability we also did not consider the effects of specific yield specific storage and dispersivity which could impact salinity distributions and salt transport rates abarca et al 2007 another overlooked issue is the pumping operation which affects salinization processes often groundwater abstraction is determined by both annual and seasonal requirements especially in areas with agriculture and tourism e g chekirbane et al 2015 cobaner et al 2012 prieto et al 2006 and wells are distributed spatially e g llopis albert and pulido velazquez 2014 narayan et al 2007 these transient and distributed conditions may affect intrusion processes compared to having a constant pumping rate at a single well our results provide some insights into preferential patterns of seawater intrusion but site specific characteristics should be considered for optimal management of groundwater e g cheng et al 2000 huang and mayer 1997 ketabchi and ataie ashtiani 2015b libera et al 2017 park and aral 2004 5 conclusion the traditional prediction of swi in homogeneous aquifers requires revision to account for the influence of aquifer heterogeneity this study provides insights into how heterogeneous land sea geologic connections relate to the mode rate and extent of seawater intrusion our simulations suggest that heterogeneity substantially affects swi in coastal aquifers subject to pumping to better understand such impacts we identified 6 types of swi i active vertical ii active horizontal iii passive horizontal iv active preferential v passive active preferential and vi passive preferential the configurations can discriminate critical features of swi which are associated with vulnerability levels i e types i and iv are high vulnerability types ii and v are medium vulnerability and types iii and vi are low vulnerability we applied a probability based assessment to heterogeneous aquifers and found that vulnerability based on the configuration is sensitive to pumping distance in low geologic continuity aquifers and to pumping depth in high continuity aquifers thus management priorities may change depending on aquifer structure future efforts to refine the configuration typology for swi should consider other processes not considered here e g multi well pumping seasonal variation of land ocean gradient analyses of other types of geologic heterogeneity e g highly connected karst or volcanic aquifers could also be critical to understanding pumping induced salinization in real systems an improved understanding of swi processes will enable more effective assessment of the vulnerability of coastal groundwater resources to salinization by pumping acknowledgments the authors gratefully acknowledge julia guimond for helpful comments on the manuscript we would like to thank the associate editor and four anonymous reviewers for their critical reviews and constructive comments that improved the manuscript this work was funded by the u s national science foundation ear1151733 to h m model files can be obtained by contacting the corresponding author this research was supported in part through the use of information technologies it resources at the university of delaware specifically the high performance computing resources supplementary materials supplementary material associated with this article can be found in the online version at doi 10 1016 j advwatres 2019 04 013 appendix supplementary materials image application 1 
659,fractional derivative models are promising tools for characterizing non fickian transport in heterogeneous media most fractional models utilize an infinite domain although realistic problems occur on bounded domains to quantify the impact of a finite or semi infinite boundary on non fickian transport in natural geological media this study evaluates three representative fractional advection dispersion equations fades with absorbing or reflective boundaries results show that the temporal fade t fade with absorbing reflective boundaries has analytical solutions the one sided spatial fade s fade in bounded domains can be simulated using an eulerian solver and the tempered spatiotemporal fade st fade can be efficiently solved using a fully lagrangian approach further simulations reveal important impacts of absorbing reflective boundaries on non fickian diffusion first the local reflective boundary mainly affects the solute dynamics near the boundary for non local super diffusion while the nonlocal reflective boundary changes the overall pattern of non fickian transport in the whole domain second the total mass for solutes in absorbing boundaries declines non linearly with respect to time third the mobile and immobile phase plumes tend to respond differently to the boundary because of their different transport mechanisms fourth a field application shows that both the s fade with a negative skewness and the t fade can be used to quantify bounded domain sub diffusion for fluorescein dye transport in the red cedar river with a large péclet number although the determination of the upstream boundary position contains high uncertainty evaluation of the boundary impact on sub diffusion super diffusion and their mixture may improve our understanding of the nature of non fickian transport in bounded domains keywords fractional advection dispersion equation non fickian diffusion bounded domain absorbing boundary reflective boundary 1 introduction fractional partial differential equations fpdes are used to quantify non fickian or anomalous transport characterized by the plume variance increasing nonlinearly in time in heterogeneous systems where the domains are typically assumed to be unbounded for simplicity metzler and klafter 2000 2004 these fpdes replace the integer order derivative by its fractional order counterpart miller et al 1993 and many fpdes are the scaling limit of a continuous time random walk ctrw kilbas and trujillo 2002 metzler and klafter 2000 the infinite domain assumption has also been made by the hydrologic community for two decades when applying the fractional order advection dispersion equations fades to model non fickian dynamics for pollutant transport in hydrological systems i e soil rivers and aquifers see the extensive review by zhang et al 2009 2017 there are three main types of fades the temporal fade t fade the spatial fade s fade and their mixture with fractional derivative in time space and both respectively which can capture anomalous sub diffusion super diffusion and their mixture respectively zhang et al 2009 natural systems however are usually bounded and so are geological media the impact of boundary on non fickian dynamics is poorly understood motivating this study the major reason for assuming an unbounded domain in fractional calculus models is the difficulty in formulating appropriate boundary conditions for these fpdes baeumer et al 2016 defterli et al 2015 recent progresses by mathematicians have led to physically meaningful boundary conditions for fpdes such as the absorbing and reflecting or reflective boundary conditions proposed by baeumer et al 2018a using a mass balance approach and the stochastic processes identified by baeumer et al 2018b for the one sided fpdes on a bounded domain this study has two major aims first we quantify and evaluate various non fickian diffusion processes in bounded domains various fpdes fades have been proposed by physicists hydrologists to quantify various complex non fickian transport phenomena including super diffusion sub diffusion and their mixture in addition as shown in section 5 1 different fades have been applied to describe the same hydrologic process leading to a historical debate about model selection furthermore previous studies baeumer et al 2018a focused on bounded domain super diffusion driven by fractional diffusion without advection this study will explore all the representative fades in bounded domains which cover not only fractional super diffusion but also advection to account for the motion of water in geologic media and sub diffusion with multiple phases which is common in hydrology zhang et al 2009 second we will explore the applicability of the bounded domain fade in real world hydrologic processes this study will focus on absorbing and reflective boundary conditions both representing either physical boundaries or physically meaningful boundaries when the model boundary does not overlap with the real hydrogeological boundary particularly they are the two major boundary conditions needed for backward modeling tracking of contaminants neupauer et al 2007 neupauer and wilson 2002 2003 2005 neupauer et al 2009 which has been used by hydrologists and engineers for four decades in various applications atmadja and bagtzoglou 2001 for example the absorbing boundary can define a physical boundary at the downstream such as a mass sink due example to the traditional absorption well karamouz et al 2004 a protected zone where groundwater is pumped up van kooten 1994 or a in situ groundwater remediation absorbing barrier obiri nyarko et al 2014 the downstream absorbing boundary used in the forward in time transport process which removes all pollutants moving from the upstream source becomes the upstream absorbing boundary in the backward probability model which conforms to the zero probability for the pollutant source at the sink zone neupauer and wilson 2002 2003 2005 the upstream absorbing boundary is also needed for specific physical boundaries such as the absorbing fixed boundary at the upstream used by physicists to evaluate the species downstream dynamics or wave propagation vidal henriquez et al 2017 the pumping well that does not change the ambient groundwater flow direction or the boundary at the water table when calculating groundwater age distributions weissmann et al 2002 or assessing aquifer susceptibility zhang et al 2018 the reflective boundary can define either a no flux physical boundary at the upstream such as the subsurface divide or impermeable rocks cremer et al 2016 fitts 1997 gupta et al 2015 labolle et al 1996 or the fracture wall for solute such as colloid transport reimus et al 1994 the upstream reflective boundary typically used in the forward in time transport process where no solute particles can pass the no flux boundary switches to the downstream reflective boundary in the backward probability model which is physically meaningful and unreplaceable since it can exclude the outside pollutants in pollutant source identification neupauer et al 2007 neupauer and wilson 2002 neupauer et al 2009 therefore this study selects these two commonly used boundary conditions the non zero boundary conditions for the fpdes including the non zero type one type two and type three boundary conditions defined by zhang et al 2016b are non trivial and should be evaluated separately in a future study it is also noteworthy that the incorporation of boundaries should not bring additional fitting parameters for the fades since no additional unknown parameters are required to define the boundary condition and the position of the boundary is the same no matter the fractional derivative model or the classical 2nd order advection dispersion equation ade is used in addition when mobile particles reach the reflective absorbing boundary they are either reflected or removed from the system hence the two boundaries considered by this study cannot cut the waiting times of immobile particles the rest of this work is organized as follows in section 2 we focus on the standard temporal fade in bounded domains and derive the analytical solution for both absorbing and reflective boundaries section 3 evaluates the standard spatial fade in a bounded domain and introduces an eulerian solver using the shifted grünwald approximation approach in baeumer et al 2018a section 4 extends the fade to a generalized form and explores its lagrangian solver for bounded domains in section 5 we discuss the impact of absorbing reflective boundary on non fickian dynamics and apply the lagrangian solver to quantify non fickian transport observed in the red cedar river conclusions are drawn in section 6 fractional derivatives defining nonlocal dispersion are introduced in appendix a for interested readers mathematical derivation of the analytical solutions for the temporal fades is shown in the remaining appendixes 2 the temporal fade t fade for sub diffusion in the following three sections we develop an efficient solver for each fade the t fade models sub diffusion using a caputo fractional derivative in time metzler and klafter 2000 the boundary conditions for the t fade are the same as those for the classical ade this is because the diffusive jump described by the t fade follows the classical fickian diffusion since all the spatial derivatives are local leading to the same local flux boundary condition this section shows that for the case of constant parameters and an impulse initial condition one can derive analytical solutions for the t fade in bounded domains subject to both absorbing and reflective boundary conditions 2 1 absorbing boundary we first explore the impact of an absorbing boundary on the dynamics of an initial pollutant pulse placed at location x l in a semi infinite domain for the t fade huang and liu 2005 metzler and klafter 2000 1a β 0 γ c t γ d 2 c x 2 v c x for 0 x 1b c x t 0 c 0 δ x l 1c c x t x x l 0 0 where 0 γ 1 denotes the order of the caputo fractional derivative in time d is the effective dispersion coefficient v is the average velocity and xl denotes the position of the left boundary here the factor β 0 1 t γ 1 is used for units conversion or if needed for adjusting the measured velocity when fitting the observed transport with β 0 1 for simplicity here we focus on the one dimensional problem extensions to non fickian mixed sub and super diffusive transport in multiple dimensions are not trivial due to the complex vector fpde which will be discussed in a future study the analytical solution of model 1 is see appendix b for derivation 2 c x t exp v x l 2 d 2 π c 0 d 0 e γ ω 2 v 2 4 d t γ sin ω l d sin ω x d d ω where d d β 0 v v β 0 and e γ z k 0 z k γ γ k 1 where γ is the gamma function denotes the single parameter mittag leffler function kilbas et al 2006 2 2 reflective boundary we next consider the t fade with a reflective boundary 3a β 0 γ c t γ d 2 c x 2 v c x for 0 x 3b c x 0 c 0 δ x l 3c c x t x v d c x t x x l 0 0 whose analytical solution is appendix c 4 c x t e v x 2 d 2 π c 0 d e v l 2 d 0 e γ ω 2 v 2 4 d t γ cos ω l d cos ω x d d ω for comparison purposes we also consider the t fade in an unbounded domain 5a β 0 γ c t γ d 2 c x 2 v c x for x 5b c x t 0 c 0 δ x l 5c c x t x 0 which has the analytical solution huang and guo 2010 kelly et al 2017 6 c x t c 0 2 π d t γ exp v x l 2 d 0 exp x l 2 4 d t γ u u t γ u 1 2 m γ u d u where mγ z is the m function m γ z n 0 z n n γ γ n 1 γ mainardi 2010 2 3 examples we then discuss the analytical solutions of the t fade derived above and compare them with those in an unbounded domain i e free boundary for simplicity the parameters are in dimensionless units and their dimensional units will be shown in the field application in section 5 1 fig 1 shows examples of the t fade 1a with an absorbing boundary 1c or a reflective boundary 3c compared to the one without a boundary i e formula 5c the absorbing boundary located at the left side x 0 removes pollutant particles reaching the boundary resulting in lower mass near the boundary and a relatively lower peak for the plume snapshot the opposite is true for the reflective boundary random walking particles are reflected back to the model domain resulting in accumulation of mass near the boundary if the initial point source of pollutants is close to the left boundary as expected fig 2 a shows that the mean velocity v or the péclet number pe affects the plume skewness since v which defines the mean downstream shift of solute particles affects the distance of solute particles from the upstream left boundary fig 2b shows that with an increasing fractional order γ representing shorter retention time for solutes the plume spreads out in space and therefore reaches the upstream boundary quicker these examples model sub diffusion due to solute retention in relatively immobile domains observed in many heterogeneous media e g the low permeability floodplain deposits abundant in a typical fluvial setting in the next section we discuss super diffusion for solutes in the presence of preferential flow paths e g fracture reeves et al 2008 or high permeability layers benson et al 2001 which can be efficiently characterized by the spatial fade s fade 3 the spatial fade s fade for super diffusion the one sided spatial fade used by hydrologists takes the form benson et al 2001 7 c x t t v c x t x d α c x t x α where 1 α 2 dimensionless is the space index and α xα denotes the riemann liouville fractional derivative the riemann liouville derivative is used in 7 rather than the caputo derivative since the space fractional diffusion equation with the caputo derivative produces negative values which is not a valid hydrological model baeumer et al 2018a to maintain consistency with the initial condition used in the last section here the initial condition for 7 is 8 c x t 0 c 0 δ x l where the bounded domain is xl x xr at present analytical solutions to 7 on a bounded domain do not exist hence numerical solvers are needed 3 1 absorbing boundary we first consider the absorbing boundary at both sides of the model domain 9 c x t 0 x x l 0 c x t 0 x x r 0 the spatial domain is discretized into n uniform sections with the ith node denoted as x i i h x l where i 0 1 2 n and h x r x l n is the spatial step size and the temporal domain is then discretized into m uniform intervals with the jth node t j j δ t where j 1 2 m and δt is the temporal step size using the shifted grünwald formula meerschaert and tadjeran 2004 to approximate the riemann liouville fractional derivative in a bounded domain by following the discretization formula 3 8 proposed by baeumer et al 2018a we obtain the following explicit euler finite difference scheme to approximate the s fade 7 with the absorbing boundary 9 10 c x i t j 1 c x i t j d δ t h α k 0 i 1 b k i c x i k 1 t j v δ t h w i 1 c x i t j w i 2 c x i 1 t j where b k i g i k 1 α if 0 i n where g l α 1 l γ α 1 γ l 1 γ α l 1 denotes the grünwald weights and b k i 0 if i 0 or i n the parameter w i 1 1 if 0 i n and w i 1 0 if i n the parameter w i 2 1 if 0 i n and w i 2 0 if i 0 3 2 reflective boundary we then consider the reflective boundary at both sides of the model domain using eq 4 3 in baeumer et al 2018a 11a v c x t d α 1 c x t x α 1 x x l 0 11b v c x t d α 1 c x t x α 1 x x r 0 for t 0 where xr denotes the position of the right boundary when α 2 the boundary condition 11 reduces to the reflective boundary condition v c x t d c x t x 0 or the zero value robin boundary for the classical ade note that the reflective boundary condition 11 differs from 3c because the dispersive flux in the s fade 7 differs from that in the t fade 3a this is because the flux across the boundary must be consistent with the flux described by the governing equation zhang et al 2016b the boundary condition 11 imposes zero flux at the boundary thus preventing any mass from leaving the domain adopting the finite difference scheme proposed by baeumer et al 2018a we obtain the eulerian approximation for the s fade 7 with the fully reflective boundary 11 12 c x i t j 1 c x i t j d δ t h α k 0 i 1 b k i c x i k 1 t j v δ t h w i 3 c x i t j w i 4 c x i 1 t j where the parameter w i 3 1 if 0 i n and w i 3 0 if i n and the parameter w i 4 1 if 0 i n and w i 4 0 if i 0 the matrix b ki is defined as b ki g i k 1 α if 0 i n and k i 1 1 if k 1 and i 0 1 α if k i 0 g n k α 1 if i n and k n 0 otherwise 3 3 partial reflective boundary different boundary conditions may apply for different sides of the model domain to capture real world boundary conditions for example we propose the s fade 7 with the following boundary conditions 13a c x t x x l 0 13b α 1 c x t x α 1 x x r 0 where the left boundary 13a is the absorbing boundary and the right i e outlet boundary 13b is a zero value neumann boundary which is called the partial reflective boundary the partial reflective boundary defined by 13b was used by hydrologists to represent the exit boundary where the solute concentration is continuous across the downstream boundary danckwerts 1953 schwartz et al 1999 following the argument in baeumer et al 2018a we obtain the eulerian approximation for the s fade 7 with the boundary conditions 13 14 c x i t j 1 c x i t j d δ t h α k 0 i 1 b ki c x i k 1 t j v δ t h c x i t j w i 2 c x i 1 t j where the matrix b ki is defined by b ki g i k 1 α if 0 i n and k i 1 0 if i 0 g n k α 1 if i n and k n 0 otherwise notably 13 is selected here only for illustration purposes any physically possible combination of absorbing reflective boundary conditions can be used in 13 and the finite difference scheme similar to the one shown above can be developed to solve the bounded value problem numerically 3 4 numerical examples we first solve the s fade 7 in a domain of length 100 with the reflective boundary condition 11 and a point source at x 20 using the finite difference scheme 12 the eulerian solver can generate fine resolutions which are needed to identify detailed behavior for non fickian transport near the boundary fig 3 shows the concentration profiles in both space and time for fractional diffusion with reflective boundaries four characteristics are observed first the plume snapshot exhibits a heavier reflected mass around the downstream right boundary and a slower plume peak for a smaller index α fig 3a this numerical result is consistent with the prior knowledge of α stable density where the smaller α defines a heavier leading front with a relatively higher probability for large jumps and a delayed peak to reach a zero mean diffusive jump which is because the mean shift of the random variables used to calculate diffusive jumps and following the α stable density distribution is always zero when 1 α 2 second the plume peak moves gradually downstream with time till most of the mass is accumulated trapped by the right reflective boundary fig 3b third the tracer concentration profiles note that the above model calculates the resident concentration for the index 1 α 2 all have a heavy early time tail increasing linearly with time c t small t 1 fig 3c d finally the late time concentration approaches the steady state solution d 4 which is a non constant with respect to x fig 3c d it is noteworthy that the fully reflectively boundary at downstream quantified in fig 3 was used by neupauer and wilson 2001 2002 to calculate backward location probability density functions where there are no outside pollutant sources and the particles carrying probabilities should not escape the model domain we then solve the s fade 7 with the absorbing boundary condition 9 using the finite difference scheme 10 some examples are shown in fig 4 it is noteworthy that as shown by fig 4d the total solute mass in the bounded model domain with the absorbing boundaries declines nonlinearly with time at a similar rate as the free boundary implying that all the solute particles reaching the two absorbing boundaries are removed immediately from the system at a similar rate as free particles passing through xl and xr we also solve the s fade 7 with the absorbing and partial reflective boundary conditions 13 using the finite difference scheme 14 fig 5 now the tracer concentration remains zero at the left absorbing boundary and the solute particles can exit the right downstream boundary via advection not due to diffusion fig 5a b before reaching the boundary the plume snapshot is similar to the one with reflective boundaries fig 5a b when arriving the boundary defined by 13 the total mass for solutes in the bounded domain decreases much faster than the solution with the reflective boundary at both sides of the model domain fig 5c d as expected 4 the tempered spatiotemporal fade st fade for mixed sub and super diffusion complex geological media such as the typical fluvial settings and fractured rock mass may contain both low permeability deposits and preferential flow paths resulting in mixed super and sub diffusion which can be quantified by the tempered spatiotemporal fade st fade zhang et al 2006 2015 15a a c m t β e κ t γ e κ t c m t γ v c m x x d e λ x α 1 e λ x c m x α 1 15b c i m t e κ t γ e κ t c m t γ 15c c t o t x t 0 θ m c m x t 0 θ i m c i m x t 0 g 0 x 15d b l v c t o t x t d l d e λ x α 1 x α 1 e λ x c t o t x t x x l 0 15e b r v c t o t x t d r d e λ x α 1 x α 1 e λ x c t o t x t x x r 0 where the factor a 1 or 0 cm cim and ctot m l 3 denote the mobile immobile and total concentrations respectively β t γ 1 is the fractional capacity coefficient κ t 1 is the truncation parameter in time γ dimensionless is the time index 0 γ 1 d l α t 1 is the diffusion coefficient which is assumed to be either constant or a linear function of the travel distance for simplicity λ l 1 is the truncation parameter in space and the function g 0 x defines the initial distribution of contaminants the fpde 15 allows the spatial variation of dispersion coefficient zhang et al 2006 which generalizes the fades discussed above the factors bi i l r and di i l r in 15 define the boundary type for example formula 15d is the absorbing boundary or the zero value dirichlet boundary i e zero value type 1 boundary if b l 1 and d l 0 partially reflective boundary or zero value neumann boundary i e type 2 boundary if b l 0 and d l 1 or fully reflective boundary or zero value robin boundary i e type 3 boundary if b l 1 and d l 1 if κ λ 0 the t fade 1a and s fade 7 are recovered as special cases there is no analytical solution for the tempered st fade 15 and the eulerian solver for 15 remains to be developed note that the classical grid based solvers are not computationally efficient for the fade containing the time fractional derivative due to the long term memory in the model here we apply a fully lagrangian solver by combining the renewal reward particle tracking scheme in unbounded domains proposed by zhang et al 2015 and the lagrangian approximation for fractional diffusion in bounded domains for the single phase proposed by zhang et al 2016b this solver contains the following three major steps step 1 track the advective and super diffusive displacement of each particle during its ith jump using the following langevin equation 16 d x i v d m i cos π α 2 d m i d x i 1 1 α d l α λ θ cos π α 1 2 d m i α 1 d x 1 α 1 d l α 1 λ where dxi l is a random jump size during a random motion time dmi t d l α λ dimensionless is a tempered lévy α stable random noise with maximally positive skewness truncation parameter λ one scale and zero shift and the sign θ 1 if d x 0 and 1 otherwise notably here we consider an instantaneous point source in the mobile phase which represents real world contamination starting from the mobile pollutants 17a c m x t t 0 m 0 δ x x 0 17b c i m x t t 0 0 where m 0 m l 3 denotes the initial mass located in the mobile domain particles can also be conveniently distributed initially in the immobile domain if there is initial contamination in the immobile phase step 2 calculate the operational time for each particle during the ith jump 18 d t i a d m i cos π γ 2 β d m i 1 γ d l γ κ where d l γ κ dimensionless is similar to d l α λ except for the index and truncation parameter the particle is mobile during the time window t i 1 t i 1 d m i and it remains immobile during the subsequent time window t i 1 d m i t i hence the lagrangian solver can conveniently distinguish the mobile and immobile phase concentrations it is computationally efficient for the strong retention process because particles can be motionless for a long waiting time without requiring any computation in the lagrangian solver step 3 adjust particle properties given the boundary condition by tracking particle trajectory near the boundary for example if the particle crosses the absorbing boundary during one jump then it is removed immediately from the system denoted as inactive particle in the program the particle tracking scheme for efficiently removing particles from the absorbing boundary for the fade is the same as that for the classical ade model which can be found in particle tracking based software such as rwhet labolle 2006 if the particle can cross the reflective boundary during one jump it will be either reflected back to the domain as suggested by krepysheva et al 2006 or be relocated near the boundary and then continue its trajectory in the next jump details of the latter can be seen in zhang et al 2016b further discussion and comparison of the two reflective schemes will be shown in section 5 2 1 the three steps are then iterated until the end of the modeling time or until all particles leave the model domain the above model and the three step lagrangian solver were applied extensively some examples are shown in figs 6 and 7 solute particles are removed from the system as soon as they arrive the absorbing boundary resulting in the decline of mass in both mobile and immobile phases fig 6 contrarily particles deposit around the reflective boundary for solutes in all phases fig 7 response of different phases to the boundary will be discussed further in section 5 2 it is noteworthy that the lagrangian solver has to release a large number of particles if a fine resolution of solution is required unless specific schemes are used such as the particle number splitting with an increasing number of particles in the plume edges or mass splitting where particles can carry different mass to achieve the best resolution which should be evaluated in a future study 5 discussion here we first check the field applicability of various fade models with the boundary conditions proposed and solved above and then discuss the detailed impact of absorbing and reflective boundaries on the non fickian dynamics of solutes even in different phases we also conduct preliminary tests for multi dimensional non fickian transport in bounded geological media for comparison we also show the transport dynamics on unbounded domains 5 1 field application a historical debate spatial or temporal fade for tracer transport in rivers due to the various forms of the fractional derivative models and the complex nature of real world transport processes there is a historical debate over model selection for example in addition to the models discussed above the following two sided spatial fade with an arbitrary skewness has also been applied in hydrology meerschaert and tadjeran 2006 19 c x t t v c x t x d 1 β 2 α c x t x α d 1 β 2 α c x t x α where β dimensionless is the skewness parameter 1 β 1 controlling the direction of large jumps when β 1 large jumps are from upstream to downstream while β 1 describes large backward jumps and β 0 generates an equal probability of large forward and backward jumps model 19 assumes that particles can have heavy tailed jumps along both downstream and upstream directions whose weights are controlled by β as will be shown below this study does not use the two sided model 19 but its one sided special cases β 1 and β 1 which have explicit physical meanings discussed below model 19 with a negative skewness in unbounded domains has been used to capture solute retention in rivers for example chakraborty et al 2009 used the spatial fade 19 with β 0 96 0 99 to successfully fit the breakthrough curves btcs for fluorescein dye transport in the red cedar river measured by phanikumar et al 2007 hunt 2006 found that the spatial fade 19 with β 1 can capture the impact of a wide spectrum of dead zones on tracer transport in rivers xiong and huang 2006 also applied the spatial fade 19 with a maximally negative skewness β 1 to model solute retention however the spatial fade with a negative skewness will generate apparent backward displacement for solute particles which requires strong backward forces that might not be physically realistic and therefore was not recommended by other users zhang et al 2009 zhang et al 2009 showed that the temporal fade which captures retention should replace the spatial fade 19 with β 1 to simulate solute transport in rivers here we address the above mentioned debate for bounded domains using the methods developed by this study theoretically the spatial fade 19 with a negative skewness can capture the late time tail in the btc because it takes a long time for the particles undergoing large backward jumps note that previous fpdes assumed unbounded domains where particles can move along any direction with any jump sizes to reverse their jump direction and arrive eventually at the downstream control plane however if there is an upstream boundary that prevents unrealistic large backward jumps i e the truncated backward jumps have a different distribution from that for the spatial fade 19 with β 1 then will the spatial fade 19 with β 1 still be applicable for a retention process in rivers to answer the question mentioned above and compare alternate fpdes we apply the tempered temporal fade in the bounded domain 20a c x t t β e κ t γ e κ t c x t t γ v c x t x d 2 c x t x 2 20b c x t t 0 m 0 δ x 20c v c x t b d c x t x x x l 0 20d c x t x 0 which is model 15 in a semi infinite domain and α 2 the temporal fade 20 models the delayed contaminant particles the late time tail of the btc as multiple trapping steps in the open channel the model application results are shown in fig 8 in the legend s fade infinite denotes the spatial fade 19 with β 1 in an infinite domain which is the model used by chakraborty et al 2009 s fade reflective denotes the spatial fade 19 with β 1 and the following reflective upstream boundary 21 v c x t d α 1 c x t x α 1 x x l 0 where the upstream boundary is located at xl m and the instantaneous tracer source is located at x 0 0 in this semi infinite domain the reflective boundary used here is not a physical boundary since the numerical model s upstream boundary does not overlap with any real hydrogeological hydrologic boundary but a physically meaningful boundary needed to set up the limit for backward jumps of tracers in the river rivers can flow backward due to hurricane monsoon season or stream course change but none of these large scale events happened during the short tracer test period at the relatively straight test reach of the red cedar river reverse flows and or backward jumps of dissolved tracers in this river may be induced by turbulent eddies dead zones in bends and pools side pockets local scale river bed topography variation logs etc which are typically less than 100 m in scale at the red cedar river the average flow velocity is 0 02 0 05 km min so the backward flow rate is most likely to be much smaller than 0 02 0 05 km min such as 0 002 0 005 km min one order of magnitude smaller than the forward flow leading to the maximum backward displacement of 50 m in 10 min in addition the range of backward dispersion is most likely larger than the bedform scale i e 1 m and smaller than the reach scale i e 100 m therefore the location x l 50 m was approximated as the maximum distance that the tracer particle can move backward driven by backward flows the selection of this boundary location therefore contains high uncertainty and this uncertainty exists no matter what model fade or ade is used here we emphasize the physical meaning of the upstream boundary although information for the physical boundary was not revealed by the reference phanikumar et al 2007 a physically reasonable boundary condition such as 20c is needed to constrain backward dispersion especially for the spatial fade model assuming extensive backward dispersion a partially reflective boundary may also be used to control backward dispersion which has the similar effect as the fully reflective boundary since advection does not cause tracers to move backward or exit the upstream boundary hence here the meaning of the boundary condition 20c for the temporal fade 20a or the boundary condition 21 for the spatial fade 19 is to constrain backward dispersion notably the physical meaning of the integer order boundary condition 20c remains the same as the traditional case which prevents solutes from exiting the boundary via either advection or local dispersion the negative fractional derivative defined by a 4 used to define the fractional dispersive flux in 21 means that all the dye reflected at the upstream boundary come from the model domain x xl and 21 prevents solutes from exiting the upstream boundary via either advection or nonlocal dispersion details about the definition and physical meaning of the fractional order flux boundary condition can be found in zhang et al 2016a results show that for this advection dominated process with the péclet number pe 1 the reflective boundary 21 only slightly affects the tracer btc by reflecting a small percentage of tracer mass fig 8 in particular the btc peak slightly increases and the late time tail decreases slightly because the tracer particles now travel a relatively shorter distance backward due to the existence of the reflective barrier the best fit parameters for the maximally negative spatial fade 19 are similar to those found by chakraborty et al 2009 α 1 32 v 0 022 km min and d 0 00181 km α min for travel distance s 1 4 km the parameters for distance s 3 1 km are as follows α 1 56 v 0 026 km min and d 0 00131 km α min the parameters for distance s 5 08 km are α 1 58 v 0 029 km min and d 0 00181 km α min the method for fitting the spatial fade parameters given the measured tracer btc was discussed in chakraborty et al 2009 the best fit parameters using the temporal fade 20 with the reflective boundary 21 are shown in table 1 the time index γ and capacity coefficient β remain relatively stable with an increasing travel distance implying that the statistics of immobile zones may not change significantly in space the maximum trapping capability however may increase with increasing travel distance i e the dye has a higher chance to experience a stronger retention zone when moving a larger distance downstream an effect that can be characterized by the time truncation parameter κ decreasing with an increase in the travel distance chakraborty et al 2009 fitted the velocity separately for each travel distance using the spatial fade with a constant velocity and we follow the same strategy for comparison purposes the best fit velocity v increases downstream due to the increased discharge downstream a trend which is consistent with that of the spatial fade 19 with β 1 the downstream increase of velocity v leads to an increasing dispersion coefficient d implying enhanced dispersion for dye particles when moving further downstream and experiencing more variation of local velocities in the open channel the time truncation parameter κ in the temporal fade 20 which is not present in the spatial fade 19 controls the transition of the late time btc tail from power law to exponential which is observed frequently in hydrologic processes zhang et al 2015 in addition the fractional capacity coefficient β distinguishes the mobile and immobile phases although here the best fit β is relatively small combined with a large time index γ since mass loss at the red cedar river was not significant phanikumar et al 2007 the application mentioned above shows that for a large péclet number pe and a relatively weak mass retention process the spatial fade 19 with β 1 can capture the tracer btc just as well as the temporal fade 20 in bounded domains therefore both the spatial fade with a negative skewness in bounded domains and the temporal fade can be used to quantify dye transport in the red cedar river this conclusion however does not imply that the boundary effect for non fickian diffusion should always be ignored considering the following two reasons first for advection dominated transport the upstream reflective barrier may only slightly affect the peak concentration at early times part of the reason is the counterbalance between advection and dispersion the downstream advection tends to move backward diffusion particles away from the upstream reflective boundary when the model is the spatial fade 19 with β 1 decreasing the boundary impact on non fickian transport at late travel times i e t 1 κ when the advective plume is gone and the remaining btc is dominated by solute retention in sub diffusion or solute particles with large backward diffusion the boundary effect is apparent even for advection dominated systems such as the red cedar river as shown by the late time tail in fig 8d f note that very late time data are missing at the red cedar river and therefore there is uncertainty in model evaluation our additional numerical tests not shown here reveal that with the decrease of pe as commonly occurring in groundwater the boundary effect will be more apparent see for example the figures in section 3 and the selection of appropriately bounded models is therefore critical second for some hydrologic processes such as surface water groundwater interaction the temporal fade can describe the residence time distribution for solutes in open channels which is critical to biogeochemical processes in the hyporheic zone such as nutrient update while the spatial fade 19 cannot capture such a time distribution no matter the selection of the skewness β note that there are three reasons for us to select this field data with limited tailing first this is the exact data set involving the historical debate for the selection of fades second it serves a good testing bed by showing that how much tailing is needed to distinguish the boundary impact for transport in rivers under a large péclet number third uncertainty persists in field measurements and here we made the conclusion in model evaluation by addressing the uncertainty in data tailing it is also noteworthy that due to the high uncertainty of the upstream boundary location xl it is essentially a fitting parameter the late time concentration of the maximally negative spatial fade 19 is sensitive to xl which challenges the model applicability since one more fitting parameter is needed the temporal fade 20a however suffers less from this additional fitting parameter due to the fast river flow and its assumption of limited backward dispersion parameter predictability for fades is not the focus of this study see our previous effort zhang et al 2014 in predicting model 20a 5 2 impact of absorbing and reflective boundaries on non fickian transport the boundary affects the trajectory for solute particles especially for a relatively large travel time and a relatively small domain which will be discussed in detail below 5 2 1 reflective boundary condition local versus nonlocal reflective boundary numerical tests in section 3 show that the reflective boundary condition can only affect the distribution of solute particles near the boundary although they undergo nonlocal super diffusion this is because the reflective boundary condition is defined by local reflection i e the particles across the boundary are relocated locally from the boundary which is named the local reflective boundary condition in this study the impact of the local reflective boundary condition on transport dynamics decreases with a decreasing index α this is because although a smaller α captures larger diffusive jumps downstream note that the positively skewed stable density generates downstream large jumps along preferential flow paths the backward diffusive jumps are shorter and have a higher probability since the overall backward jump probability is 1 α hence particles reflected and accumulated near the downstream reflective boundary move relatively slower than those with a larger α in other words the stronger the nonlocal diffusive jumps inside the model domain corresponding to a smaller α the less influence of the local reflective boundary on the overall plume distribution this local reflective boundary condition in the lagrangian solver as shown by zhang et al 2016b can efficiently capture the fractional order reflective boundary defined by baeumer et al 2018b for the s fade 7 which was proved to be well posed by baeumer et al 2018b to further reveal the boundary impact on super diffusion we test the following nonlocal reflective boundary condition 22 x reflect 2 x b x where xb denotes the boundary position either xl or xr here and x denotes the position of the particle outside the domain without the reflective barrier eq 22 says that particles exiting the boundary will then be reflected to their image position in the domain which follows the image theory for particle tracking around the reflective boundary labolle et al 1996 2000 as shown by fig 9 for the s fade model 7 the nonlocal reflective boundary condition 22 can affect the overall transport dynamics in the whole domain due to the nonlocal particle jumps reflected to the model domain which can now be re located at any place in the domain in other words the nonlocal reflective boundary can change the non fickian dynamics for solutes in the whole domain challenging the feasibility of the governing equation 7 since the resultant internal dynamics now differs from the one described by model 7 indeed the governing equation with the reflective boundary condition 22 may no longer be the standard fade 7 but another form of fpde such as eq 12 in krepysheva et al 2006 for detailed discussion see zhang et al 2016b hence the nonlocal reflective boundary condition 22 used for the s fade 7 may result in an ill posed problem note that the unit mass steady state solution for the s fade 7 with velocity v 0 and d 1 with reflective boundaries is 23 c t x α 1 x r x l x x l x r x l α 2 where x l x r c t x d x 1 due to mass conservation as shown in fig 9d the spatial fade with the nonlocal reflective boundary condition approaches the steady state solution faster than the local reflective boundary condition the steady state solution for 7 with advection is shown in appendix d 5 2 2 absorbing boundary condition mass decline rate the absorbing boundary can remove solute mass in a rate sensitive to time and non fickian dynamics for example the mass decline rate exhibits a time dependent trend for super diffusion expressed by the s fade 7 in a bounded domain under absorbing boundary conditions fig 10 a at the early stage when t x r x l v the total mass declines faster with a linear declining trend for the s fade 7 with a smaller index α as shown by the insert in fig 10a and b because the smaller α captures stronger super diffusion i e more particles can reach the downstream absorbing boundary during the early stage during the intermediate stage when the plume peak is driven mainly by advection fig 10a and c the plume peak for normal diffusion gradually reaches the absorbing boundary and then the solute mass declines quickly at a nonlinear rate super diffusion with α 2 0 however has a delayed plume peak to balance the heavy leading edge resulting in a slower mass decline than normal diffusion figs 10a and c at later times i e t x r x l v when diffusion dominates transport of the remaining solutes the mass declines exponentially fig 10d hence the highly skewed distribution for super diffusive solute particles described by the s fade 7 can produce a transient decline rate for the solute mass remaining in the model domain with absorbing boundaries therefore caution is needed when interpreting or predicting spatial moments of solutes given limited temporal observations of non fickian dynamics 5 2 3 response of solutes in different phases to boundaries the boundary may exert different impacts on solute dynamics in different phases since the mobile and immobile solutes exhibit different transport mechanisms trajectories the mobile particles typically move relatively faster downstream than the immobile particles and hence the leading edge of the mobile plume is affected changed more by the boundary figs 6 and 7 hence compared to the immobile phase solute the leading edge of the mobile phase solute experiences more mass loss at the absorbing boundary and higher mass reflection at the reflectively boundary this subtle discrepancy can accumulate with time and be exaggerated if the size of the bounded domain is relatively small i e at the laboratory or bedform scale 6 conclusion this study quantifies and evaluates the impact of absorbing and reflective boundaries on non fickian transport captured by the temporal fade t fade the spatial fade s fade and the tempered spatiotemporal fade st fade analytical and numerical analysis and field application of the three fade models in bounded domains lead to the following conclusions the first conclusion focuses on quantification of non fickian transport in bounded domains and the others reveal the boundary impact on non fickian transport first semi analytical or numerical techniques can be applied to the t fade the s fade and the tempered st fade in bounded domains for example the t fade with absorbing or reflective boundaries can be solved analytically the standard one side spatial fade for super diffusion in bounded domains can be simulated using an eulerian solver and the bounded domain spatiotemporal fade for mixed sub and super diffusion can be solved using a fully lagrangian approach the grid free lagrangian solver is more general but a large number of particles is required to accurately capture the nuance of the leading tailing plume edge the selection of the solver mainly depends on the type of non fickian transport the physical model and the research requirement second the impact of reflective boundaries on particle trajectories can be defined as either local or nonlocal resulting in quite different dynamics for super diffusion in bounded domains on one hand the local reflective boundary where the particles exiting the boundary are relocated locally around the reflective boundary see section 3 affects mainly the local solute dynamics near the boundary due to the relatively weak backward diffusion compared with the forward large jumps defined by the maximally positive skewed stable density in the space fade on the other hand the nonlocal reflective boundary built by the standard image theory see formula 22 changes the overall super diffusive dynamics for all solutes in the whole domain due to the nonlocal transport of solute particles and the corresponding large reflection which leads to ill posed problems and therefore is not recommended hence the impact of local reflective boundary on nonlocal transport can be local in addition the impact of the local reflective boundaries on super diffusion is sensitive to the péclet number due to the competition between forward advection and backward diffusion third absorbing boundaries remove first arriving solute particles and generates a mass decline for solutes in the bounded domain the total mass in the bounded domain declines faster at earlier times than for normal diffusion due to the super diffusive leading edge that quickly reaches the absorbing boundary for intermediate and late times however the mass for super diffusive solutes inside the absorbing boundaries declines much slower due to the plume peak moving slower downstream than normal diffusion therefore the mass decline rate changes with time due to the positively skewed diffusive jumps for solute particles undergoing super diffusion fourth the mobile and immobile phase plumes typical in sub diffusion may have different response to the absorbing reflective boundaries since solute particles in different phases follow different random processes the mobile particle jumps in mobile time and moves downstream relatively faster while the immobile particle remains motionless before returning mobile compared to the immobile phase solute the leading edge of the mobile phase solute can decline relatively faster at the absorbing boundary or accumulate a higher mass near the reflective boundary therefore the bounded domain can cause subtle discrepancy in non fickian dynamics for particles in different phases resulting in further challenge in distinguishing pollutant in different phases in the field fifth application of the bounded domain fade models to quantify anomalous transport in the red cedar river shows that both the spatial fade with a negative skewness in bounded domains and the t fade can be used to quantify bounded anomalous transport in natural rivers with a large péclet number although the field data has a limited tail at the very late time and there is high uncertainty in the determination of the upstream boundary location we can conclude that the impact of the upstream boundary on solute dynamics is minimized for advection dominated transport since the downstream advection tends to push solute particles away from the upstream boundary at late travel times and or a small pe as commonly occurs in groundwater however the boundary effect for even the upstream boundary can be apparent and the selection of appropriately bounded models is therefore critical acknowledgments the work was partially supported by the national natural science foundation of china under 41628202 41330632 and 11572112 and natural science foundation of shandong zr2016al01 kelly was partially supported by aro muri grant muri w911nf 15 1 0562 and us nsf grant ear 1344280 this paper does not necessary reflect the view of the funding agencies comments from three reviewers helped to significantly improve the presentation of this work appendix a riemann liouville and caputo fractional derivatives this section briefly introduces the definition for riemann liouville and caputo fractional derivatives for readers who are interested in the relationship between upstream contribution and the spatial nonlocality and the memory impact defined by the fpdes detailed evaluation of diffusion models using the two derivatives can be found in baeumer et al 2018a a 1 riemann liouville fractional derivative the positive riemann liouville fractional derivative takes the following form on the entire real space miller et al 1993 a 1 r l d x α c x t α x α c x t 1 γ n α n x n x c ξ t x ξ n α 1 d ξ where α 0 n is the smallest integer greater than α i e n 1 α n and γ denotes the gamma function since this study considers super diffusion in preferential flow paths described by the s fade 7 here 1 α 2 and n 2 the spatial nonlocal operator a 1 shows that the concentration at every point in the semi finite up location zone denoted as ξ x can contribute with the weight decreasing with distance to the local concentration at x this is the so called spatial nonlocality which may capture the fast contribution of solute mass via preferential flow pathes at the upstream zone analytical solution to 7 in the unbounded domain can be written in terms of the α stable probability density function which does not have a closed form meerschaert and sikorskii 2012 for the bounded domain xl x xr the positive riemann liouville fractional derivative takes the form a 2 x l r l d x α c x t 1 γ n α n x n x l x c ξ t x ξ n α 1 d ξ where every point in the finite up location zone denoted as xl ξ x can contribute to the local concentration at x note that the up location zone defined by the coordinate system differs from the up stream zone defined by the flow direction for description simplicity here the two zones are coincide i e water flows from left to right for all examples used in this study as mentioned in the main text there is no analytical solution for the s fade 7 in bounded domains the negative riemann liouville fractional derivative used in the two sided fade 19 is of the form on the entire real space miller et al 1993 a 3 x r l d α c x t α x α c x t 1 n γ n α n x n x c ξ t ξ x n α 1 d ξ where the concentration at every point in the semi infinite down location zone denoted as ξ x can contribute to the local concentration at x in a bounded domain the negative riemann liouville fractional derivative becomes a 4 x r l d x r α c x t 1 n γ n α n x n x x r c ξ t ξ x n α 1 d ξ where the concentration at every point in the finite down location zone denoted as x ξ xr can contribute to the local concentration at x a 2 caputo fractional derivative the caputo fractional derivative used in the t fade 1 3 and 5 was proposed by caputo 1967 and takes the following form a 5 0 c d t γ c x t γ t γ c x t 1 γ n γ 0 t n c x τ τ n t τ n γ 1 d τ where 0 γ 1 and n 1 in this study the nonlocal definition a 5 shows that the historical concentration affects the current concentration or the so called memory impact which may describe the influence of immobile mass concentration trapped at this position to the current mass concentration the caputo fractional derivative a 5 differs from the riemann liouville fractional derivative a 2 in that the integer order derivative is moved inside the integral the two fractional derivatives can be linked by see eq 2 33 in meerschaert and sikorskii 2012 a 6 0 c d y γ f y 0 r l d y γ f y f 0 y γ γ 1 γ when 0 γ 1 the caputo fractional derivative was used to derive the temporal fade by hydrologists see for example schumer et al 2003 however if the spatial fade 7 uses the caputo fractional derivative a 5 with order between 1 and 2 then eq 7 cannot provide a physical meaningfully model for anomalous diffusion because the resulting boundary value problem takes negative solutions baeumer et al 2018a in addition the fractional diffusion equation with the riemann liouville derivative on a bounded domain governs a well defined stochastic process baeumer et al 2018b therefore we have to switch from the caputo fractional derivative used in the t fade to the riemann liouville fractional derivative in the s fade in bounded domains appendix b analytical solution of the t fade 1 with absorbing boundaries introducing c x t u ξ t e v ξ 2 d and ξ x d where d d β 0 and v v β 0 model 1 becomes b 1a γ u t γ 2 u ξ 2 v 2 4 d u for 0 ξ b 1b u ξ t 0 c 0 e v ξ 2 d δ d ξ l for ξ 0 b 1c u ξ t ξ 0 0 b 1d u ξ t ξ 0 denoting u ξ p as the laplace transform and u ω t as the fourier sine transform of u ξ t and applying the laplace transform of 1 with respect to the variable t and the fourier sine transform with respect to the variable ξ the differential eq b 1a becomes an algebraic equation b 2 p γ u p γ 1 2 c 0 π d e v l 2 d sin ω l d ω 2 u v 2 4 d u with solution b 3 u 2 c 0 d π e v l 2 d p γ 1 sin ω l d p γ ω 2 v 2 4 d using the following formula kilbas et al 2006 b 4 l e γ λ t γ s p γ 1 p γ λ and the inverse fourier sine transform b 5 f s 1 f ω 2 π 0 f ω sin ω ξ d ω the solution of the problem 1 can be written as b 6 u ξ t 2 π c 0 d e v l 2 d 0 e γ ω 2 v 2 4 d t γ sin ω l d sin ω ξ d ω yielding eq 2 appendix c analytical solution of the t fade 3 with reflective boundaries using the substitution in appendix b problem 3 becomes c 1a γ u t γ 2 u ξ 2 v 2 4 d u for 0 ξ c 1b u ξ t 0 c 0 e v ξ 2 d δ d ξ l for ξ 0 c 1c u ξ t ξ ξ 0 0 c 1d u ξ t ξ 0 denoting u ω t as the fourier cosine transform of u ξ t and applying the laplace transform of c 1a with respect to the variable t and the fourier cosine transform with respect to the variable ξ c 1 becomes c 2 p γ u p γ 1 2 c 0 1 d e v l 2 d cos ω l d ω 2 u v 2 4 d u with solution c 3 u 2 c 0 d π e v l 2 d p γ 1 cos ω l d p γ ω 2 v 2 4 d applying the inverse laplace transform and fourier cosine transform the solution of the problem can be written as c 4 u ξ t 2 π c 0 d e v l 2 d 0 e γ ω 2 v 2 4 d t γ cos ω l d cos ω ξ d ω yielding eq 4 appendix d steady state solution of the s fade 7 with reflective boundaries consider the steady state space fade s fade d 1 v x c t x d α x α c t x 0 for 1 α 2 with v 0 and d 0 we solve s fade d 1 on the bounded domain 0 r subject to the reflecting boundary condition given by 11 note that d 1 may be written in conservation form d 2 x α 1 x α 1 c t x v d c t x 0 where the expression in parentheses is the flux following the approach in kelly et al 2019 set the flux equal to zero d 3 α 1 x α 1 c t x λ c t x where λ v d since the flux is zero everywhere in the domain 0 r the reflecting boundary condition 11 is satisfied solutions to d 3 are the eigenfunctions of the riemann liouville fractional derivative of order α 1 by equation 4 2 44 in kilbas et al 2006 d 3 has exactly one linearly independent solution given by d 4 c t x a x α 2 e α 1 α 1 v d x α 1 where a 0 and e α 1 α 1 denotes the two parameter mittag leffler function for 1 α 2 the steady state solution d 4 is singular at x 0 while for α 2 d 4 is an exponential function and hence regular at all points in 0 r assuming unit mass the normalization constant is given by a 1 0 r x α 2 e α 1 α 1 v d x α 1 d x v d α 2 1 α 0 a u α 2 e α 1 α 1 u α 1 v d 1 1 α d u d v 0 a u α 2 e α 1 α 1 u α 1 d u where u v d 1 α 1 x and a r v d 1 α 1 using the following relationship for the mittag leffler function see equation 1 9 6 in kilbas et al 2006 d 5 u u α 1 e α 1 α u α 1 u α 2 e α 1 α 1 u α 1 and the fundamental theorem of calculus yields d 6 a 1 r α 1 e α 1 α r α 1 v d as a check we consider the special case of zero drift v 0 in the unit interval with a diffusion coefficient of one setting r d 1 in d 4 and d 6 yields d 7 c t x x α 2 e α 1 α 1 v x α 1 e α 1 α v expanding the numerator and denominator using the taylor series for e α β z yields e α 1 α 1 v x α 1 1 γ α 1 v x α 1 γ 2 α 2 e α 1 α v 1 γ α v γ 2 α 1 letting v 0 yields d 8 c t x γ α γ α 1 x α 2 α 1 x α 2 which corresponds to the steady state solution reported in baeumer et al 2018b the analytical solution d 4 is compared with the numerical solution at time t 500 using the explicit eulerian solver proposed in section 3 2 the analytical and numerical solutions are in good agreement fig d 1 
659,fractional derivative models are promising tools for characterizing non fickian transport in heterogeneous media most fractional models utilize an infinite domain although realistic problems occur on bounded domains to quantify the impact of a finite or semi infinite boundary on non fickian transport in natural geological media this study evaluates three representative fractional advection dispersion equations fades with absorbing or reflective boundaries results show that the temporal fade t fade with absorbing reflective boundaries has analytical solutions the one sided spatial fade s fade in bounded domains can be simulated using an eulerian solver and the tempered spatiotemporal fade st fade can be efficiently solved using a fully lagrangian approach further simulations reveal important impacts of absorbing reflective boundaries on non fickian diffusion first the local reflective boundary mainly affects the solute dynamics near the boundary for non local super diffusion while the nonlocal reflective boundary changes the overall pattern of non fickian transport in the whole domain second the total mass for solutes in absorbing boundaries declines non linearly with respect to time third the mobile and immobile phase plumes tend to respond differently to the boundary because of their different transport mechanisms fourth a field application shows that both the s fade with a negative skewness and the t fade can be used to quantify bounded domain sub diffusion for fluorescein dye transport in the red cedar river with a large péclet number although the determination of the upstream boundary position contains high uncertainty evaluation of the boundary impact on sub diffusion super diffusion and their mixture may improve our understanding of the nature of non fickian transport in bounded domains keywords fractional advection dispersion equation non fickian diffusion bounded domain absorbing boundary reflective boundary 1 introduction fractional partial differential equations fpdes are used to quantify non fickian or anomalous transport characterized by the plume variance increasing nonlinearly in time in heterogeneous systems where the domains are typically assumed to be unbounded for simplicity metzler and klafter 2000 2004 these fpdes replace the integer order derivative by its fractional order counterpart miller et al 1993 and many fpdes are the scaling limit of a continuous time random walk ctrw kilbas and trujillo 2002 metzler and klafter 2000 the infinite domain assumption has also been made by the hydrologic community for two decades when applying the fractional order advection dispersion equations fades to model non fickian dynamics for pollutant transport in hydrological systems i e soil rivers and aquifers see the extensive review by zhang et al 2009 2017 there are three main types of fades the temporal fade t fade the spatial fade s fade and their mixture with fractional derivative in time space and both respectively which can capture anomalous sub diffusion super diffusion and their mixture respectively zhang et al 2009 natural systems however are usually bounded and so are geological media the impact of boundary on non fickian dynamics is poorly understood motivating this study the major reason for assuming an unbounded domain in fractional calculus models is the difficulty in formulating appropriate boundary conditions for these fpdes baeumer et al 2016 defterli et al 2015 recent progresses by mathematicians have led to physically meaningful boundary conditions for fpdes such as the absorbing and reflecting or reflective boundary conditions proposed by baeumer et al 2018a using a mass balance approach and the stochastic processes identified by baeumer et al 2018b for the one sided fpdes on a bounded domain this study has two major aims first we quantify and evaluate various non fickian diffusion processes in bounded domains various fpdes fades have been proposed by physicists hydrologists to quantify various complex non fickian transport phenomena including super diffusion sub diffusion and their mixture in addition as shown in section 5 1 different fades have been applied to describe the same hydrologic process leading to a historical debate about model selection furthermore previous studies baeumer et al 2018a focused on bounded domain super diffusion driven by fractional diffusion without advection this study will explore all the representative fades in bounded domains which cover not only fractional super diffusion but also advection to account for the motion of water in geologic media and sub diffusion with multiple phases which is common in hydrology zhang et al 2009 second we will explore the applicability of the bounded domain fade in real world hydrologic processes this study will focus on absorbing and reflective boundary conditions both representing either physical boundaries or physically meaningful boundaries when the model boundary does not overlap with the real hydrogeological boundary particularly they are the two major boundary conditions needed for backward modeling tracking of contaminants neupauer et al 2007 neupauer and wilson 2002 2003 2005 neupauer et al 2009 which has been used by hydrologists and engineers for four decades in various applications atmadja and bagtzoglou 2001 for example the absorbing boundary can define a physical boundary at the downstream such as a mass sink due example to the traditional absorption well karamouz et al 2004 a protected zone where groundwater is pumped up van kooten 1994 or a in situ groundwater remediation absorbing barrier obiri nyarko et al 2014 the downstream absorbing boundary used in the forward in time transport process which removes all pollutants moving from the upstream source becomes the upstream absorbing boundary in the backward probability model which conforms to the zero probability for the pollutant source at the sink zone neupauer and wilson 2002 2003 2005 the upstream absorbing boundary is also needed for specific physical boundaries such as the absorbing fixed boundary at the upstream used by physicists to evaluate the species downstream dynamics or wave propagation vidal henriquez et al 2017 the pumping well that does not change the ambient groundwater flow direction or the boundary at the water table when calculating groundwater age distributions weissmann et al 2002 or assessing aquifer susceptibility zhang et al 2018 the reflective boundary can define either a no flux physical boundary at the upstream such as the subsurface divide or impermeable rocks cremer et al 2016 fitts 1997 gupta et al 2015 labolle et al 1996 or the fracture wall for solute such as colloid transport reimus et al 1994 the upstream reflective boundary typically used in the forward in time transport process where no solute particles can pass the no flux boundary switches to the downstream reflective boundary in the backward probability model which is physically meaningful and unreplaceable since it can exclude the outside pollutants in pollutant source identification neupauer et al 2007 neupauer and wilson 2002 neupauer et al 2009 therefore this study selects these two commonly used boundary conditions the non zero boundary conditions for the fpdes including the non zero type one type two and type three boundary conditions defined by zhang et al 2016b are non trivial and should be evaluated separately in a future study it is also noteworthy that the incorporation of boundaries should not bring additional fitting parameters for the fades since no additional unknown parameters are required to define the boundary condition and the position of the boundary is the same no matter the fractional derivative model or the classical 2nd order advection dispersion equation ade is used in addition when mobile particles reach the reflective absorbing boundary they are either reflected or removed from the system hence the two boundaries considered by this study cannot cut the waiting times of immobile particles the rest of this work is organized as follows in section 2 we focus on the standard temporal fade in bounded domains and derive the analytical solution for both absorbing and reflective boundaries section 3 evaluates the standard spatial fade in a bounded domain and introduces an eulerian solver using the shifted grünwald approximation approach in baeumer et al 2018a section 4 extends the fade to a generalized form and explores its lagrangian solver for bounded domains in section 5 we discuss the impact of absorbing reflective boundary on non fickian dynamics and apply the lagrangian solver to quantify non fickian transport observed in the red cedar river conclusions are drawn in section 6 fractional derivatives defining nonlocal dispersion are introduced in appendix a for interested readers mathematical derivation of the analytical solutions for the temporal fades is shown in the remaining appendixes 2 the temporal fade t fade for sub diffusion in the following three sections we develop an efficient solver for each fade the t fade models sub diffusion using a caputo fractional derivative in time metzler and klafter 2000 the boundary conditions for the t fade are the same as those for the classical ade this is because the diffusive jump described by the t fade follows the classical fickian diffusion since all the spatial derivatives are local leading to the same local flux boundary condition this section shows that for the case of constant parameters and an impulse initial condition one can derive analytical solutions for the t fade in bounded domains subject to both absorbing and reflective boundary conditions 2 1 absorbing boundary we first explore the impact of an absorbing boundary on the dynamics of an initial pollutant pulse placed at location x l in a semi infinite domain for the t fade huang and liu 2005 metzler and klafter 2000 1a β 0 γ c t γ d 2 c x 2 v c x for 0 x 1b c x t 0 c 0 δ x l 1c c x t x x l 0 0 where 0 γ 1 denotes the order of the caputo fractional derivative in time d is the effective dispersion coefficient v is the average velocity and xl denotes the position of the left boundary here the factor β 0 1 t γ 1 is used for units conversion or if needed for adjusting the measured velocity when fitting the observed transport with β 0 1 for simplicity here we focus on the one dimensional problem extensions to non fickian mixed sub and super diffusive transport in multiple dimensions are not trivial due to the complex vector fpde which will be discussed in a future study the analytical solution of model 1 is see appendix b for derivation 2 c x t exp v x l 2 d 2 π c 0 d 0 e γ ω 2 v 2 4 d t γ sin ω l d sin ω x d d ω where d d β 0 v v β 0 and e γ z k 0 z k γ γ k 1 where γ is the gamma function denotes the single parameter mittag leffler function kilbas et al 2006 2 2 reflective boundary we next consider the t fade with a reflective boundary 3a β 0 γ c t γ d 2 c x 2 v c x for 0 x 3b c x 0 c 0 δ x l 3c c x t x v d c x t x x l 0 0 whose analytical solution is appendix c 4 c x t e v x 2 d 2 π c 0 d e v l 2 d 0 e γ ω 2 v 2 4 d t γ cos ω l d cos ω x d d ω for comparison purposes we also consider the t fade in an unbounded domain 5a β 0 γ c t γ d 2 c x 2 v c x for x 5b c x t 0 c 0 δ x l 5c c x t x 0 which has the analytical solution huang and guo 2010 kelly et al 2017 6 c x t c 0 2 π d t γ exp v x l 2 d 0 exp x l 2 4 d t γ u u t γ u 1 2 m γ u d u where mγ z is the m function m γ z n 0 z n n γ γ n 1 γ mainardi 2010 2 3 examples we then discuss the analytical solutions of the t fade derived above and compare them with those in an unbounded domain i e free boundary for simplicity the parameters are in dimensionless units and their dimensional units will be shown in the field application in section 5 1 fig 1 shows examples of the t fade 1a with an absorbing boundary 1c or a reflective boundary 3c compared to the one without a boundary i e formula 5c the absorbing boundary located at the left side x 0 removes pollutant particles reaching the boundary resulting in lower mass near the boundary and a relatively lower peak for the plume snapshot the opposite is true for the reflective boundary random walking particles are reflected back to the model domain resulting in accumulation of mass near the boundary if the initial point source of pollutants is close to the left boundary as expected fig 2 a shows that the mean velocity v or the péclet number pe affects the plume skewness since v which defines the mean downstream shift of solute particles affects the distance of solute particles from the upstream left boundary fig 2b shows that with an increasing fractional order γ representing shorter retention time for solutes the plume spreads out in space and therefore reaches the upstream boundary quicker these examples model sub diffusion due to solute retention in relatively immobile domains observed in many heterogeneous media e g the low permeability floodplain deposits abundant in a typical fluvial setting in the next section we discuss super diffusion for solutes in the presence of preferential flow paths e g fracture reeves et al 2008 or high permeability layers benson et al 2001 which can be efficiently characterized by the spatial fade s fade 3 the spatial fade s fade for super diffusion the one sided spatial fade used by hydrologists takes the form benson et al 2001 7 c x t t v c x t x d α c x t x α where 1 α 2 dimensionless is the space index and α xα denotes the riemann liouville fractional derivative the riemann liouville derivative is used in 7 rather than the caputo derivative since the space fractional diffusion equation with the caputo derivative produces negative values which is not a valid hydrological model baeumer et al 2018a to maintain consistency with the initial condition used in the last section here the initial condition for 7 is 8 c x t 0 c 0 δ x l where the bounded domain is xl x xr at present analytical solutions to 7 on a bounded domain do not exist hence numerical solvers are needed 3 1 absorbing boundary we first consider the absorbing boundary at both sides of the model domain 9 c x t 0 x x l 0 c x t 0 x x r 0 the spatial domain is discretized into n uniform sections with the ith node denoted as x i i h x l where i 0 1 2 n and h x r x l n is the spatial step size and the temporal domain is then discretized into m uniform intervals with the jth node t j j δ t where j 1 2 m and δt is the temporal step size using the shifted grünwald formula meerschaert and tadjeran 2004 to approximate the riemann liouville fractional derivative in a bounded domain by following the discretization formula 3 8 proposed by baeumer et al 2018a we obtain the following explicit euler finite difference scheme to approximate the s fade 7 with the absorbing boundary 9 10 c x i t j 1 c x i t j d δ t h α k 0 i 1 b k i c x i k 1 t j v δ t h w i 1 c x i t j w i 2 c x i 1 t j where b k i g i k 1 α if 0 i n where g l α 1 l γ α 1 γ l 1 γ α l 1 denotes the grünwald weights and b k i 0 if i 0 or i n the parameter w i 1 1 if 0 i n and w i 1 0 if i n the parameter w i 2 1 if 0 i n and w i 2 0 if i 0 3 2 reflective boundary we then consider the reflective boundary at both sides of the model domain using eq 4 3 in baeumer et al 2018a 11a v c x t d α 1 c x t x α 1 x x l 0 11b v c x t d α 1 c x t x α 1 x x r 0 for t 0 where xr denotes the position of the right boundary when α 2 the boundary condition 11 reduces to the reflective boundary condition v c x t d c x t x 0 or the zero value robin boundary for the classical ade note that the reflective boundary condition 11 differs from 3c because the dispersive flux in the s fade 7 differs from that in the t fade 3a this is because the flux across the boundary must be consistent with the flux described by the governing equation zhang et al 2016b the boundary condition 11 imposes zero flux at the boundary thus preventing any mass from leaving the domain adopting the finite difference scheme proposed by baeumer et al 2018a we obtain the eulerian approximation for the s fade 7 with the fully reflective boundary 11 12 c x i t j 1 c x i t j d δ t h α k 0 i 1 b k i c x i k 1 t j v δ t h w i 3 c x i t j w i 4 c x i 1 t j where the parameter w i 3 1 if 0 i n and w i 3 0 if i n and the parameter w i 4 1 if 0 i n and w i 4 0 if i 0 the matrix b ki is defined as b ki g i k 1 α if 0 i n and k i 1 1 if k 1 and i 0 1 α if k i 0 g n k α 1 if i n and k n 0 otherwise 3 3 partial reflective boundary different boundary conditions may apply for different sides of the model domain to capture real world boundary conditions for example we propose the s fade 7 with the following boundary conditions 13a c x t x x l 0 13b α 1 c x t x α 1 x x r 0 where the left boundary 13a is the absorbing boundary and the right i e outlet boundary 13b is a zero value neumann boundary which is called the partial reflective boundary the partial reflective boundary defined by 13b was used by hydrologists to represent the exit boundary where the solute concentration is continuous across the downstream boundary danckwerts 1953 schwartz et al 1999 following the argument in baeumer et al 2018a we obtain the eulerian approximation for the s fade 7 with the boundary conditions 13 14 c x i t j 1 c x i t j d δ t h α k 0 i 1 b ki c x i k 1 t j v δ t h c x i t j w i 2 c x i 1 t j where the matrix b ki is defined by b ki g i k 1 α if 0 i n and k i 1 0 if i 0 g n k α 1 if i n and k n 0 otherwise notably 13 is selected here only for illustration purposes any physically possible combination of absorbing reflective boundary conditions can be used in 13 and the finite difference scheme similar to the one shown above can be developed to solve the bounded value problem numerically 3 4 numerical examples we first solve the s fade 7 in a domain of length 100 with the reflective boundary condition 11 and a point source at x 20 using the finite difference scheme 12 the eulerian solver can generate fine resolutions which are needed to identify detailed behavior for non fickian transport near the boundary fig 3 shows the concentration profiles in both space and time for fractional diffusion with reflective boundaries four characteristics are observed first the plume snapshot exhibits a heavier reflected mass around the downstream right boundary and a slower plume peak for a smaller index α fig 3a this numerical result is consistent with the prior knowledge of α stable density where the smaller α defines a heavier leading front with a relatively higher probability for large jumps and a delayed peak to reach a zero mean diffusive jump which is because the mean shift of the random variables used to calculate diffusive jumps and following the α stable density distribution is always zero when 1 α 2 second the plume peak moves gradually downstream with time till most of the mass is accumulated trapped by the right reflective boundary fig 3b third the tracer concentration profiles note that the above model calculates the resident concentration for the index 1 α 2 all have a heavy early time tail increasing linearly with time c t small t 1 fig 3c d finally the late time concentration approaches the steady state solution d 4 which is a non constant with respect to x fig 3c d it is noteworthy that the fully reflectively boundary at downstream quantified in fig 3 was used by neupauer and wilson 2001 2002 to calculate backward location probability density functions where there are no outside pollutant sources and the particles carrying probabilities should not escape the model domain we then solve the s fade 7 with the absorbing boundary condition 9 using the finite difference scheme 10 some examples are shown in fig 4 it is noteworthy that as shown by fig 4d the total solute mass in the bounded model domain with the absorbing boundaries declines nonlinearly with time at a similar rate as the free boundary implying that all the solute particles reaching the two absorbing boundaries are removed immediately from the system at a similar rate as free particles passing through xl and xr we also solve the s fade 7 with the absorbing and partial reflective boundary conditions 13 using the finite difference scheme 14 fig 5 now the tracer concentration remains zero at the left absorbing boundary and the solute particles can exit the right downstream boundary via advection not due to diffusion fig 5a b before reaching the boundary the plume snapshot is similar to the one with reflective boundaries fig 5a b when arriving the boundary defined by 13 the total mass for solutes in the bounded domain decreases much faster than the solution with the reflective boundary at both sides of the model domain fig 5c d as expected 4 the tempered spatiotemporal fade st fade for mixed sub and super diffusion complex geological media such as the typical fluvial settings and fractured rock mass may contain both low permeability deposits and preferential flow paths resulting in mixed super and sub diffusion which can be quantified by the tempered spatiotemporal fade st fade zhang et al 2006 2015 15a a c m t β e κ t γ e κ t c m t γ v c m x x d e λ x α 1 e λ x c m x α 1 15b c i m t e κ t γ e κ t c m t γ 15c c t o t x t 0 θ m c m x t 0 θ i m c i m x t 0 g 0 x 15d b l v c t o t x t d l d e λ x α 1 x α 1 e λ x c t o t x t x x l 0 15e b r v c t o t x t d r d e λ x α 1 x α 1 e λ x c t o t x t x x r 0 where the factor a 1 or 0 cm cim and ctot m l 3 denote the mobile immobile and total concentrations respectively β t γ 1 is the fractional capacity coefficient κ t 1 is the truncation parameter in time γ dimensionless is the time index 0 γ 1 d l α t 1 is the diffusion coefficient which is assumed to be either constant or a linear function of the travel distance for simplicity λ l 1 is the truncation parameter in space and the function g 0 x defines the initial distribution of contaminants the fpde 15 allows the spatial variation of dispersion coefficient zhang et al 2006 which generalizes the fades discussed above the factors bi i l r and di i l r in 15 define the boundary type for example formula 15d is the absorbing boundary or the zero value dirichlet boundary i e zero value type 1 boundary if b l 1 and d l 0 partially reflective boundary or zero value neumann boundary i e type 2 boundary if b l 0 and d l 1 or fully reflective boundary or zero value robin boundary i e type 3 boundary if b l 1 and d l 1 if κ λ 0 the t fade 1a and s fade 7 are recovered as special cases there is no analytical solution for the tempered st fade 15 and the eulerian solver for 15 remains to be developed note that the classical grid based solvers are not computationally efficient for the fade containing the time fractional derivative due to the long term memory in the model here we apply a fully lagrangian solver by combining the renewal reward particle tracking scheme in unbounded domains proposed by zhang et al 2015 and the lagrangian approximation for fractional diffusion in bounded domains for the single phase proposed by zhang et al 2016b this solver contains the following three major steps step 1 track the advective and super diffusive displacement of each particle during its ith jump using the following langevin equation 16 d x i v d m i cos π α 2 d m i d x i 1 1 α d l α λ θ cos π α 1 2 d m i α 1 d x 1 α 1 d l α 1 λ where dxi l is a random jump size during a random motion time dmi t d l α λ dimensionless is a tempered lévy α stable random noise with maximally positive skewness truncation parameter λ one scale and zero shift and the sign θ 1 if d x 0 and 1 otherwise notably here we consider an instantaneous point source in the mobile phase which represents real world contamination starting from the mobile pollutants 17a c m x t t 0 m 0 δ x x 0 17b c i m x t t 0 0 where m 0 m l 3 denotes the initial mass located in the mobile domain particles can also be conveniently distributed initially in the immobile domain if there is initial contamination in the immobile phase step 2 calculate the operational time for each particle during the ith jump 18 d t i a d m i cos π γ 2 β d m i 1 γ d l γ κ where d l γ κ dimensionless is similar to d l α λ except for the index and truncation parameter the particle is mobile during the time window t i 1 t i 1 d m i and it remains immobile during the subsequent time window t i 1 d m i t i hence the lagrangian solver can conveniently distinguish the mobile and immobile phase concentrations it is computationally efficient for the strong retention process because particles can be motionless for a long waiting time without requiring any computation in the lagrangian solver step 3 adjust particle properties given the boundary condition by tracking particle trajectory near the boundary for example if the particle crosses the absorbing boundary during one jump then it is removed immediately from the system denoted as inactive particle in the program the particle tracking scheme for efficiently removing particles from the absorbing boundary for the fade is the same as that for the classical ade model which can be found in particle tracking based software such as rwhet labolle 2006 if the particle can cross the reflective boundary during one jump it will be either reflected back to the domain as suggested by krepysheva et al 2006 or be relocated near the boundary and then continue its trajectory in the next jump details of the latter can be seen in zhang et al 2016b further discussion and comparison of the two reflective schemes will be shown in section 5 2 1 the three steps are then iterated until the end of the modeling time or until all particles leave the model domain the above model and the three step lagrangian solver were applied extensively some examples are shown in figs 6 and 7 solute particles are removed from the system as soon as they arrive the absorbing boundary resulting in the decline of mass in both mobile and immobile phases fig 6 contrarily particles deposit around the reflective boundary for solutes in all phases fig 7 response of different phases to the boundary will be discussed further in section 5 2 it is noteworthy that the lagrangian solver has to release a large number of particles if a fine resolution of solution is required unless specific schemes are used such as the particle number splitting with an increasing number of particles in the plume edges or mass splitting where particles can carry different mass to achieve the best resolution which should be evaluated in a future study 5 discussion here we first check the field applicability of various fade models with the boundary conditions proposed and solved above and then discuss the detailed impact of absorbing and reflective boundaries on the non fickian dynamics of solutes even in different phases we also conduct preliminary tests for multi dimensional non fickian transport in bounded geological media for comparison we also show the transport dynamics on unbounded domains 5 1 field application a historical debate spatial or temporal fade for tracer transport in rivers due to the various forms of the fractional derivative models and the complex nature of real world transport processes there is a historical debate over model selection for example in addition to the models discussed above the following two sided spatial fade with an arbitrary skewness has also been applied in hydrology meerschaert and tadjeran 2006 19 c x t t v c x t x d 1 β 2 α c x t x α d 1 β 2 α c x t x α where β dimensionless is the skewness parameter 1 β 1 controlling the direction of large jumps when β 1 large jumps are from upstream to downstream while β 1 describes large backward jumps and β 0 generates an equal probability of large forward and backward jumps model 19 assumes that particles can have heavy tailed jumps along both downstream and upstream directions whose weights are controlled by β as will be shown below this study does not use the two sided model 19 but its one sided special cases β 1 and β 1 which have explicit physical meanings discussed below model 19 with a negative skewness in unbounded domains has been used to capture solute retention in rivers for example chakraborty et al 2009 used the spatial fade 19 with β 0 96 0 99 to successfully fit the breakthrough curves btcs for fluorescein dye transport in the red cedar river measured by phanikumar et al 2007 hunt 2006 found that the spatial fade 19 with β 1 can capture the impact of a wide spectrum of dead zones on tracer transport in rivers xiong and huang 2006 also applied the spatial fade 19 with a maximally negative skewness β 1 to model solute retention however the spatial fade with a negative skewness will generate apparent backward displacement for solute particles which requires strong backward forces that might not be physically realistic and therefore was not recommended by other users zhang et al 2009 zhang et al 2009 showed that the temporal fade which captures retention should replace the spatial fade 19 with β 1 to simulate solute transport in rivers here we address the above mentioned debate for bounded domains using the methods developed by this study theoretically the spatial fade 19 with a negative skewness can capture the late time tail in the btc because it takes a long time for the particles undergoing large backward jumps note that previous fpdes assumed unbounded domains where particles can move along any direction with any jump sizes to reverse their jump direction and arrive eventually at the downstream control plane however if there is an upstream boundary that prevents unrealistic large backward jumps i e the truncated backward jumps have a different distribution from that for the spatial fade 19 with β 1 then will the spatial fade 19 with β 1 still be applicable for a retention process in rivers to answer the question mentioned above and compare alternate fpdes we apply the tempered temporal fade in the bounded domain 20a c x t t β e κ t γ e κ t c x t t γ v c x t x d 2 c x t x 2 20b c x t t 0 m 0 δ x 20c v c x t b d c x t x x x l 0 20d c x t x 0 which is model 15 in a semi infinite domain and α 2 the temporal fade 20 models the delayed contaminant particles the late time tail of the btc as multiple trapping steps in the open channel the model application results are shown in fig 8 in the legend s fade infinite denotes the spatial fade 19 with β 1 in an infinite domain which is the model used by chakraborty et al 2009 s fade reflective denotes the spatial fade 19 with β 1 and the following reflective upstream boundary 21 v c x t d α 1 c x t x α 1 x x l 0 where the upstream boundary is located at xl m and the instantaneous tracer source is located at x 0 0 in this semi infinite domain the reflective boundary used here is not a physical boundary since the numerical model s upstream boundary does not overlap with any real hydrogeological hydrologic boundary but a physically meaningful boundary needed to set up the limit for backward jumps of tracers in the river rivers can flow backward due to hurricane monsoon season or stream course change but none of these large scale events happened during the short tracer test period at the relatively straight test reach of the red cedar river reverse flows and or backward jumps of dissolved tracers in this river may be induced by turbulent eddies dead zones in bends and pools side pockets local scale river bed topography variation logs etc which are typically less than 100 m in scale at the red cedar river the average flow velocity is 0 02 0 05 km min so the backward flow rate is most likely to be much smaller than 0 02 0 05 km min such as 0 002 0 005 km min one order of magnitude smaller than the forward flow leading to the maximum backward displacement of 50 m in 10 min in addition the range of backward dispersion is most likely larger than the bedform scale i e 1 m and smaller than the reach scale i e 100 m therefore the location x l 50 m was approximated as the maximum distance that the tracer particle can move backward driven by backward flows the selection of this boundary location therefore contains high uncertainty and this uncertainty exists no matter what model fade or ade is used here we emphasize the physical meaning of the upstream boundary although information for the physical boundary was not revealed by the reference phanikumar et al 2007 a physically reasonable boundary condition such as 20c is needed to constrain backward dispersion especially for the spatial fade model assuming extensive backward dispersion a partially reflective boundary may also be used to control backward dispersion which has the similar effect as the fully reflective boundary since advection does not cause tracers to move backward or exit the upstream boundary hence here the meaning of the boundary condition 20c for the temporal fade 20a or the boundary condition 21 for the spatial fade 19 is to constrain backward dispersion notably the physical meaning of the integer order boundary condition 20c remains the same as the traditional case which prevents solutes from exiting the boundary via either advection or local dispersion the negative fractional derivative defined by a 4 used to define the fractional dispersive flux in 21 means that all the dye reflected at the upstream boundary come from the model domain x xl and 21 prevents solutes from exiting the upstream boundary via either advection or nonlocal dispersion details about the definition and physical meaning of the fractional order flux boundary condition can be found in zhang et al 2016a results show that for this advection dominated process with the péclet number pe 1 the reflective boundary 21 only slightly affects the tracer btc by reflecting a small percentage of tracer mass fig 8 in particular the btc peak slightly increases and the late time tail decreases slightly because the tracer particles now travel a relatively shorter distance backward due to the existence of the reflective barrier the best fit parameters for the maximally negative spatial fade 19 are similar to those found by chakraborty et al 2009 α 1 32 v 0 022 km min and d 0 00181 km α min for travel distance s 1 4 km the parameters for distance s 3 1 km are as follows α 1 56 v 0 026 km min and d 0 00131 km α min the parameters for distance s 5 08 km are α 1 58 v 0 029 km min and d 0 00181 km α min the method for fitting the spatial fade parameters given the measured tracer btc was discussed in chakraborty et al 2009 the best fit parameters using the temporal fade 20 with the reflective boundary 21 are shown in table 1 the time index γ and capacity coefficient β remain relatively stable with an increasing travel distance implying that the statistics of immobile zones may not change significantly in space the maximum trapping capability however may increase with increasing travel distance i e the dye has a higher chance to experience a stronger retention zone when moving a larger distance downstream an effect that can be characterized by the time truncation parameter κ decreasing with an increase in the travel distance chakraborty et al 2009 fitted the velocity separately for each travel distance using the spatial fade with a constant velocity and we follow the same strategy for comparison purposes the best fit velocity v increases downstream due to the increased discharge downstream a trend which is consistent with that of the spatial fade 19 with β 1 the downstream increase of velocity v leads to an increasing dispersion coefficient d implying enhanced dispersion for dye particles when moving further downstream and experiencing more variation of local velocities in the open channel the time truncation parameter κ in the temporal fade 20 which is not present in the spatial fade 19 controls the transition of the late time btc tail from power law to exponential which is observed frequently in hydrologic processes zhang et al 2015 in addition the fractional capacity coefficient β distinguishes the mobile and immobile phases although here the best fit β is relatively small combined with a large time index γ since mass loss at the red cedar river was not significant phanikumar et al 2007 the application mentioned above shows that for a large péclet number pe and a relatively weak mass retention process the spatial fade 19 with β 1 can capture the tracer btc just as well as the temporal fade 20 in bounded domains therefore both the spatial fade with a negative skewness in bounded domains and the temporal fade can be used to quantify dye transport in the red cedar river this conclusion however does not imply that the boundary effect for non fickian diffusion should always be ignored considering the following two reasons first for advection dominated transport the upstream reflective barrier may only slightly affect the peak concentration at early times part of the reason is the counterbalance between advection and dispersion the downstream advection tends to move backward diffusion particles away from the upstream reflective boundary when the model is the spatial fade 19 with β 1 decreasing the boundary impact on non fickian transport at late travel times i e t 1 κ when the advective plume is gone and the remaining btc is dominated by solute retention in sub diffusion or solute particles with large backward diffusion the boundary effect is apparent even for advection dominated systems such as the red cedar river as shown by the late time tail in fig 8d f note that very late time data are missing at the red cedar river and therefore there is uncertainty in model evaluation our additional numerical tests not shown here reveal that with the decrease of pe as commonly occurring in groundwater the boundary effect will be more apparent see for example the figures in section 3 and the selection of appropriately bounded models is therefore critical second for some hydrologic processes such as surface water groundwater interaction the temporal fade can describe the residence time distribution for solutes in open channels which is critical to biogeochemical processes in the hyporheic zone such as nutrient update while the spatial fade 19 cannot capture such a time distribution no matter the selection of the skewness β note that there are three reasons for us to select this field data with limited tailing first this is the exact data set involving the historical debate for the selection of fades second it serves a good testing bed by showing that how much tailing is needed to distinguish the boundary impact for transport in rivers under a large péclet number third uncertainty persists in field measurements and here we made the conclusion in model evaluation by addressing the uncertainty in data tailing it is also noteworthy that due to the high uncertainty of the upstream boundary location xl it is essentially a fitting parameter the late time concentration of the maximally negative spatial fade 19 is sensitive to xl which challenges the model applicability since one more fitting parameter is needed the temporal fade 20a however suffers less from this additional fitting parameter due to the fast river flow and its assumption of limited backward dispersion parameter predictability for fades is not the focus of this study see our previous effort zhang et al 2014 in predicting model 20a 5 2 impact of absorbing and reflective boundaries on non fickian transport the boundary affects the trajectory for solute particles especially for a relatively large travel time and a relatively small domain which will be discussed in detail below 5 2 1 reflective boundary condition local versus nonlocal reflective boundary numerical tests in section 3 show that the reflective boundary condition can only affect the distribution of solute particles near the boundary although they undergo nonlocal super diffusion this is because the reflective boundary condition is defined by local reflection i e the particles across the boundary are relocated locally from the boundary which is named the local reflective boundary condition in this study the impact of the local reflective boundary condition on transport dynamics decreases with a decreasing index α this is because although a smaller α captures larger diffusive jumps downstream note that the positively skewed stable density generates downstream large jumps along preferential flow paths the backward diffusive jumps are shorter and have a higher probability since the overall backward jump probability is 1 α hence particles reflected and accumulated near the downstream reflective boundary move relatively slower than those with a larger α in other words the stronger the nonlocal diffusive jumps inside the model domain corresponding to a smaller α the less influence of the local reflective boundary on the overall plume distribution this local reflective boundary condition in the lagrangian solver as shown by zhang et al 2016b can efficiently capture the fractional order reflective boundary defined by baeumer et al 2018b for the s fade 7 which was proved to be well posed by baeumer et al 2018b to further reveal the boundary impact on super diffusion we test the following nonlocal reflective boundary condition 22 x reflect 2 x b x where xb denotes the boundary position either xl or xr here and x denotes the position of the particle outside the domain without the reflective barrier eq 22 says that particles exiting the boundary will then be reflected to their image position in the domain which follows the image theory for particle tracking around the reflective boundary labolle et al 1996 2000 as shown by fig 9 for the s fade model 7 the nonlocal reflective boundary condition 22 can affect the overall transport dynamics in the whole domain due to the nonlocal particle jumps reflected to the model domain which can now be re located at any place in the domain in other words the nonlocal reflective boundary can change the non fickian dynamics for solutes in the whole domain challenging the feasibility of the governing equation 7 since the resultant internal dynamics now differs from the one described by model 7 indeed the governing equation with the reflective boundary condition 22 may no longer be the standard fade 7 but another form of fpde such as eq 12 in krepysheva et al 2006 for detailed discussion see zhang et al 2016b hence the nonlocal reflective boundary condition 22 used for the s fade 7 may result in an ill posed problem note that the unit mass steady state solution for the s fade 7 with velocity v 0 and d 1 with reflective boundaries is 23 c t x α 1 x r x l x x l x r x l α 2 where x l x r c t x d x 1 due to mass conservation as shown in fig 9d the spatial fade with the nonlocal reflective boundary condition approaches the steady state solution faster than the local reflective boundary condition the steady state solution for 7 with advection is shown in appendix d 5 2 2 absorbing boundary condition mass decline rate the absorbing boundary can remove solute mass in a rate sensitive to time and non fickian dynamics for example the mass decline rate exhibits a time dependent trend for super diffusion expressed by the s fade 7 in a bounded domain under absorbing boundary conditions fig 10 a at the early stage when t x r x l v the total mass declines faster with a linear declining trend for the s fade 7 with a smaller index α as shown by the insert in fig 10a and b because the smaller α captures stronger super diffusion i e more particles can reach the downstream absorbing boundary during the early stage during the intermediate stage when the plume peak is driven mainly by advection fig 10a and c the plume peak for normal diffusion gradually reaches the absorbing boundary and then the solute mass declines quickly at a nonlinear rate super diffusion with α 2 0 however has a delayed plume peak to balance the heavy leading edge resulting in a slower mass decline than normal diffusion figs 10a and c at later times i e t x r x l v when diffusion dominates transport of the remaining solutes the mass declines exponentially fig 10d hence the highly skewed distribution for super diffusive solute particles described by the s fade 7 can produce a transient decline rate for the solute mass remaining in the model domain with absorbing boundaries therefore caution is needed when interpreting or predicting spatial moments of solutes given limited temporal observations of non fickian dynamics 5 2 3 response of solutes in different phases to boundaries the boundary may exert different impacts on solute dynamics in different phases since the mobile and immobile solutes exhibit different transport mechanisms trajectories the mobile particles typically move relatively faster downstream than the immobile particles and hence the leading edge of the mobile plume is affected changed more by the boundary figs 6 and 7 hence compared to the immobile phase solute the leading edge of the mobile phase solute experiences more mass loss at the absorbing boundary and higher mass reflection at the reflectively boundary this subtle discrepancy can accumulate with time and be exaggerated if the size of the bounded domain is relatively small i e at the laboratory or bedform scale 6 conclusion this study quantifies and evaluates the impact of absorbing and reflective boundaries on non fickian transport captured by the temporal fade t fade the spatial fade s fade and the tempered spatiotemporal fade st fade analytical and numerical analysis and field application of the three fade models in bounded domains lead to the following conclusions the first conclusion focuses on quantification of non fickian transport in bounded domains and the others reveal the boundary impact on non fickian transport first semi analytical or numerical techniques can be applied to the t fade the s fade and the tempered st fade in bounded domains for example the t fade with absorbing or reflective boundaries can be solved analytically the standard one side spatial fade for super diffusion in bounded domains can be simulated using an eulerian solver and the bounded domain spatiotemporal fade for mixed sub and super diffusion can be solved using a fully lagrangian approach the grid free lagrangian solver is more general but a large number of particles is required to accurately capture the nuance of the leading tailing plume edge the selection of the solver mainly depends on the type of non fickian transport the physical model and the research requirement second the impact of reflective boundaries on particle trajectories can be defined as either local or nonlocal resulting in quite different dynamics for super diffusion in bounded domains on one hand the local reflective boundary where the particles exiting the boundary are relocated locally around the reflective boundary see section 3 affects mainly the local solute dynamics near the boundary due to the relatively weak backward diffusion compared with the forward large jumps defined by the maximally positive skewed stable density in the space fade on the other hand the nonlocal reflective boundary built by the standard image theory see formula 22 changes the overall super diffusive dynamics for all solutes in the whole domain due to the nonlocal transport of solute particles and the corresponding large reflection which leads to ill posed problems and therefore is not recommended hence the impact of local reflective boundary on nonlocal transport can be local in addition the impact of the local reflective boundaries on super diffusion is sensitive to the péclet number due to the competition between forward advection and backward diffusion third absorbing boundaries remove first arriving solute particles and generates a mass decline for solutes in the bounded domain the total mass in the bounded domain declines faster at earlier times than for normal diffusion due to the super diffusive leading edge that quickly reaches the absorbing boundary for intermediate and late times however the mass for super diffusive solutes inside the absorbing boundaries declines much slower due to the plume peak moving slower downstream than normal diffusion therefore the mass decline rate changes with time due to the positively skewed diffusive jumps for solute particles undergoing super diffusion fourth the mobile and immobile phase plumes typical in sub diffusion may have different response to the absorbing reflective boundaries since solute particles in different phases follow different random processes the mobile particle jumps in mobile time and moves downstream relatively faster while the immobile particle remains motionless before returning mobile compared to the immobile phase solute the leading edge of the mobile phase solute can decline relatively faster at the absorbing boundary or accumulate a higher mass near the reflective boundary therefore the bounded domain can cause subtle discrepancy in non fickian dynamics for particles in different phases resulting in further challenge in distinguishing pollutant in different phases in the field fifth application of the bounded domain fade models to quantify anomalous transport in the red cedar river shows that both the spatial fade with a negative skewness in bounded domains and the t fade can be used to quantify bounded anomalous transport in natural rivers with a large péclet number although the field data has a limited tail at the very late time and there is high uncertainty in the determination of the upstream boundary location we can conclude that the impact of the upstream boundary on solute dynamics is minimized for advection dominated transport since the downstream advection tends to push solute particles away from the upstream boundary at late travel times and or a small pe as commonly occurs in groundwater however the boundary effect for even the upstream boundary can be apparent and the selection of appropriately bounded models is therefore critical acknowledgments the work was partially supported by the national natural science foundation of china under 41628202 41330632 and 11572112 and natural science foundation of shandong zr2016al01 kelly was partially supported by aro muri grant muri w911nf 15 1 0562 and us nsf grant ear 1344280 this paper does not necessary reflect the view of the funding agencies comments from three reviewers helped to significantly improve the presentation of this work appendix a riemann liouville and caputo fractional derivatives this section briefly introduces the definition for riemann liouville and caputo fractional derivatives for readers who are interested in the relationship between upstream contribution and the spatial nonlocality and the memory impact defined by the fpdes detailed evaluation of diffusion models using the two derivatives can be found in baeumer et al 2018a a 1 riemann liouville fractional derivative the positive riemann liouville fractional derivative takes the following form on the entire real space miller et al 1993 a 1 r l d x α c x t α x α c x t 1 γ n α n x n x c ξ t x ξ n α 1 d ξ where α 0 n is the smallest integer greater than α i e n 1 α n and γ denotes the gamma function since this study considers super diffusion in preferential flow paths described by the s fade 7 here 1 α 2 and n 2 the spatial nonlocal operator a 1 shows that the concentration at every point in the semi finite up location zone denoted as ξ x can contribute with the weight decreasing with distance to the local concentration at x this is the so called spatial nonlocality which may capture the fast contribution of solute mass via preferential flow pathes at the upstream zone analytical solution to 7 in the unbounded domain can be written in terms of the α stable probability density function which does not have a closed form meerschaert and sikorskii 2012 for the bounded domain xl x xr the positive riemann liouville fractional derivative takes the form a 2 x l r l d x α c x t 1 γ n α n x n x l x c ξ t x ξ n α 1 d ξ where every point in the finite up location zone denoted as xl ξ x can contribute to the local concentration at x note that the up location zone defined by the coordinate system differs from the up stream zone defined by the flow direction for description simplicity here the two zones are coincide i e water flows from left to right for all examples used in this study as mentioned in the main text there is no analytical solution for the s fade 7 in bounded domains the negative riemann liouville fractional derivative used in the two sided fade 19 is of the form on the entire real space miller et al 1993 a 3 x r l d α c x t α x α c x t 1 n γ n α n x n x c ξ t ξ x n α 1 d ξ where the concentration at every point in the semi infinite down location zone denoted as ξ x can contribute to the local concentration at x in a bounded domain the negative riemann liouville fractional derivative becomes a 4 x r l d x r α c x t 1 n γ n α n x n x x r c ξ t ξ x n α 1 d ξ where the concentration at every point in the finite down location zone denoted as x ξ xr can contribute to the local concentration at x a 2 caputo fractional derivative the caputo fractional derivative used in the t fade 1 3 and 5 was proposed by caputo 1967 and takes the following form a 5 0 c d t γ c x t γ t γ c x t 1 γ n γ 0 t n c x τ τ n t τ n γ 1 d τ where 0 γ 1 and n 1 in this study the nonlocal definition a 5 shows that the historical concentration affects the current concentration or the so called memory impact which may describe the influence of immobile mass concentration trapped at this position to the current mass concentration the caputo fractional derivative a 5 differs from the riemann liouville fractional derivative a 2 in that the integer order derivative is moved inside the integral the two fractional derivatives can be linked by see eq 2 33 in meerschaert and sikorskii 2012 a 6 0 c d y γ f y 0 r l d y γ f y f 0 y γ γ 1 γ when 0 γ 1 the caputo fractional derivative was used to derive the temporal fade by hydrologists see for example schumer et al 2003 however if the spatial fade 7 uses the caputo fractional derivative a 5 with order between 1 and 2 then eq 7 cannot provide a physical meaningfully model for anomalous diffusion because the resulting boundary value problem takes negative solutions baeumer et al 2018a in addition the fractional diffusion equation with the riemann liouville derivative on a bounded domain governs a well defined stochastic process baeumer et al 2018b therefore we have to switch from the caputo fractional derivative used in the t fade to the riemann liouville fractional derivative in the s fade in bounded domains appendix b analytical solution of the t fade 1 with absorbing boundaries introducing c x t u ξ t e v ξ 2 d and ξ x d where d d β 0 and v v β 0 model 1 becomes b 1a γ u t γ 2 u ξ 2 v 2 4 d u for 0 ξ b 1b u ξ t 0 c 0 e v ξ 2 d δ d ξ l for ξ 0 b 1c u ξ t ξ 0 0 b 1d u ξ t ξ 0 denoting u ξ p as the laplace transform and u ω t as the fourier sine transform of u ξ t and applying the laplace transform of 1 with respect to the variable t and the fourier sine transform with respect to the variable ξ the differential eq b 1a becomes an algebraic equation b 2 p γ u p γ 1 2 c 0 π d e v l 2 d sin ω l d ω 2 u v 2 4 d u with solution b 3 u 2 c 0 d π e v l 2 d p γ 1 sin ω l d p γ ω 2 v 2 4 d using the following formula kilbas et al 2006 b 4 l e γ λ t γ s p γ 1 p γ λ and the inverse fourier sine transform b 5 f s 1 f ω 2 π 0 f ω sin ω ξ d ω the solution of the problem 1 can be written as b 6 u ξ t 2 π c 0 d e v l 2 d 0 e γ ω 2 v 2 4 d t γ sin ω l d sin ω ξ d ω yielding eq 2 appendix c analytical solution of the t fade 3 with reflective boundaries using the substitution in appendix b problem 3 becomes c 1a γ u t γ 2 u ξ 2 v 2 4 d u for 0 ξ c 1b u ξ t 0 c 0 e v ξ 2 d δ d ξ l for ξ 0 c 1c u ξ t ξ ξ 0 0 c 1d u ξ t ξ 0 denoting u ω t as the fourier cosine transform of u ξ t and applying the laplace transform of c 1a with respect to the variable t and the fourier cosine transform with respect to the variable ξ c 1 becomes c 2 p γ u p γ 1 2 c 0 1 d e v l 2 d cos ω l d ω 2 u v 2 4 d u with solution c 3 u 2 c 0 d π e v l 2 d p γ 1 cos ω l d p γ ω 2 v 2 4 d applying the inverse laplace transform and fourier cosine transform the solution of the problem can be written as c 4 u ξ t 2 π c 0 d e v l 2 d 0 e γ ω 2 v 2 4 d t γ cos ω l d cos ω ξ d ω yielding eq 4 appendix d steady state solution of the s fade 7 with reflective boundaries consider the steady state space fade s fade d 1 v x c t x d α x α c t x 0 for 1 α 2 with v 0 and d 0 we solve s fade d 1 on the bounded domain 0 r subject to the reflecting boundary condition given by 11 note that d 1 may be written in conservation form d 2 x α 1 x α 1 c t x v d c t x 0 where the expression in parentheses is the flux following the approach in kelly et al 2019 set the flux equal to zero d 3 α 1 x α 1 c t x λ c t x where λ v d since the flux is zero everywhere in the domain 0 r the reflecting boundary condition 11 is satisfied solutions to d 3 are the eigenfunctions of the riemann liouville fractional derivative of order α 1 by equation 4 2 44 in kilbas et al 2006 d 3 has exactly one linearly independent solution given by d 4 c t x a x α 2 e α 1 α 1 v d x α 1 where a 0 and e α 1 α 1 denotes the two parameter mittag leffler function for 1 α 2 the steady state solution d 4 is singular at x 0 while for α 2 d 4 is an exponential function and hence regular at all points in 0 r assuming unit mass the normalization constant is given by a 1 0 r x α 2 e α 1 α 1 v d x α 1 d x v d α 2 1 α 0 a u α 2 e α 1 α 1 u α 1 v d 1 1 α d u d v 0 a u α 2 e α 1 α 1 u α 1 d u where u v d 1 α 1 x and a r v d 1 α 1 using the following relationship for the mittag leffler function see equation 1 9 6 in kilbas et al 2006 d 5 u u α 1 e α 1 α u α 1 u α 2 e α 1 α 1 u α 1 and the fundamental theorem of calculus yields d 6 a 1 r α 1 e α 1 α r α 1 v d as a check we consider the special case of zero drift v 0 in the unit interval with a diffusion coefficient of one setting r d 1 in d 4 and d 6 yields d 7 c t x x α 2 e α 1 α 1 v x α 1 e α 1 α v expanding the numerator and denominator using the taylor series for e α β z yields e α 1 α 1 v x α 1 1 γ α 1 v x α 1 γ 2 α 2 e α 1 α v 1 γ α v γ 2 α 1 letting v 0 yields d 8 c t x γ α γ α 1 x α 2 α 1 x α 2 which corresponds to the steady state solution reported in baeumer et al 2018b the analytical solution d 4 is compared with the numerical solution at time t 500 using the explicit eulerian solver proposed in section 3 2 the analytical and numerical solutions are in good agreement fig d 1 
