index,text
275,turbulent mixing is a key process influencing the dynamics of subaqueous gravity currents in this study the evolution of the local turbulent mixing dynamics along a lock exchange gravity current propagating over a mild slope is statistically investigated by ensemble averaging and spanwise averaging 200 large eddy simulation results at two time steps characteristic of the slumping and inertial phases of the current s propagation premultiplied velocity and density transport spectra are computed and confirm that vertical turbulent mixing is mainly due to the large scale structures i e kelvin helmholtz billows with smaller scale turbulence acting to homogenise the density field we show that unlike large scale oceanic underflows the head holds a substantial portion of the total turbulent transport flux 25 and the decrease of the local vertical density transport flux in the body scales exponentially with distance from the head when normalised by the current s length finally the vertical density transport flux is shown to be well predicted by an eddy viscosity model after appropriate tuning of the model constants keywords gravity current buoyancy driven flow large eddy simulation mixing layer turbulent mixing stratified turbulence 1 introduction gravity currents are a type of unsteady planar buoyancy driven flow generated from the sudden release of a fixed volume of heavy fluid into a lighter quiescent ambience lock exchange models where the current is generated from the release of a dense fluid into a channel filled with lighter water with a gate initially separating the two fluids represent a simple yet useful and representative model to investigate the fundamental dynamics of large range of environmental flows such as subaqueous reservoir outflows fluvial channel landslides or sublacustrine and sea river estuaries turbidity currents simpson 1999 meiburg and kneller 2010 small initial density differences allow the generation of fully turbulent currents the density gradient driving the motion is caused by differences either in temperature salinity or in the specific case of turbidity currents by an inhomogeneous distribution of suspended particles the lock exchange configuration has been extensively applied experimentally wilson et al 2017 fragoso et al 2013 nogueira et al 2014 middleton 1966 middleton 1966 marino et al 2005 hacker et al 1996 bonnecaze et al 1993 cenedese et al 2018 lombardi et al 2018 zhao et al 2018 zordan et al 2018 and numerically härtel et al 2000 härtel et al 2000 cantero et al 2008 cantero et al 2007 özgökmen and chassignet 2002 özgökmen et al 2004 nasr azadani and meiburg 2011 nasr azadani and meiburg 2014 ooi et al 2009 ottolenghi et al 2018 inghilesi et al 2018 pelmard et al 2018 pelmard et al 2020 to the study of subaqueous gravity currents generated in a variety of geophysical conditions upon the lock release the dense fluid quickly takes on the form of an avalanche like wave with a compositional structure displaying a dense frontal head an overhanging nose at its foremost location followed by a long lasting diluted stratified body eventually ending in a thin decayed passive tail fig 1 cantero et al 2008 kneller et al 1999 komar 1972 overall the propagation of gravity currents is well understood and accurately described by characteristic scaling laws which evolve according to the dominant forces acting upon the fluid over the current s propagation gratton and vigo 1994 huppert and simpson 1980 cantero et al 2007 shin et al 2004 huppert 1982 rottman and simpson 1983 it is thus clear that the sustainability of the current is directly subjected to its ability to preserve the buoyant forces behind its motion and therefore to its dilution rate in this sense the understanding of the mechanisms responsible for the entrainment of ambient fluid inside the current and the dilution of the current remains a central topic of interest among gravity current studies to date cantero et al 2008 cenedese and adduce 2010 ottolenghi et al 2016 ottolenghi et al 2016 ottolenghi et al 2017 özgökmen et al 2009 neamtu halic et al 2019 krug et al 2013 krug et al 2015 odier et al 2012 odier et al 2014 odier et al 2009 sher and woods 2015 thomas et al 2003 sher and woods 2017 ottolenghi et al 2017 van reeuwijk et al 2018 de falco et al 2020 and is particularly challenging in the case of unsteady finite volume currents due to the uneven distribution of mixing along its length 1 1 gravity current mixing mechanisms dynamically the dilution of gravity currents is driven by two flow instabilities namely i kelvin helmholtz instabilities which are responsible for the role up of the upper interface of the current into large coherent billows and ii the lobe and cleft instability resulting from the combination of shear and buoyant instabilities underneath the overhanging nose fig 1 härtel et al 2000 lobe and cleft instabilities first entrain ambient fluid inside the current front where the light fluid is transported backward along the upper interface of the current alongside dense fluid supplied from the dense head the entrained fluid is progressively mixed by the kelvin helmholtz billows as it travels backward thus forming an interfacial mixing layer that progressively grows in the wake of the head nogueira et al 2014 härtel et al 2000 cantero et al 2008 ottolenghi et al 2016 sher and woods 2015 simpson and britter 1979 the dilution of the mixing layer is further enhanced by the small scale turbulence generated from shearing at the current interface and buoyancy at the front recent work of sher and woods 2015 has identified in detail the motion of the entrained fluid as well as the dense fluid composing the head using dye attenuation methods and high frequency camera records they tracked the displacement and dilution of punctual dye pointers injected at different positions inside and ahead of gravity currents during their propagation following previous observations kneller et al 1999 thomas et al 2003 they gave a detailed description of the evolution of the internal circulation that drives the transport of dense fluid towards the head and recycles part of the fluid transported backward back inside the head 1 2 ambient fluid entrainment quantification quantitatively mixing and entrainment in gravity currents has been the subject of considerable attention at the scale of the entire current turner 1986 has first parameterized the overall entrainment of fluid in gravity currents from bulk properties of the flow this approach was later discussed by cenedese and adduce 2010 for planar and axisymmetric gravity currents and is now largely applied to the study of fluid entrainment in gravity currents wilson et al 2017 ottolenghi et al 2016 ottolenghi et al 2016 odier et al 2014 jacobson and testik 2014 bhaganagar 2017 another indirect measure of the current s dilution is given by the background potential energy corresponding to the minimum potential energy possibly attained after adiabatically redistributing the density field in the fluid s domain fragoso et al 2013 ottolenghi et al 2016 özgökmen et al 2009 winters et al 1995 such parameterization of entrainment is particularly useful for the enhancement of one dimensional depth averaged shallow water models describing the evolution of field scale steady gravity currents with long body to head length ratios ungarish 2009 however these quantities only provide a partial description of mixing in the case of unsteady gravity currents in which the local entrainment along the current and the inner mixing dynamics of the flow significantly change along the current s length 1 3 local turbulent mixing a local measure of mixing is given by the turbulent transport fluxes i e the density velocity cross correlations however the calculation of the second order turbulence statistics such as the reynolds stresses and turbulent transport fluxes is rendered difficult by the inhomogeneous and unsteady nature of unsteady gravity currents in the case of currents produced from the continuous supply of fluid or through having a sufficiently high initial volume of fluid the dynamics of the current is dominated by its quasi steady body which is comparable to a stratified shear layer local turbulent fluxes have been computed from time and ensemble averaging of coupled planar laser induced fluorescence particle image velocimetry piv plif krug et al 2013 odier et al 2012 perez diaz et al 2018 and coupled planar laser induced fluorescence particle tracking velocimetry ptv plif neamtu halic et al 2019 krug et al 2015 measurements similarly the flux exchanges of turbidity currents have been studied numerically by applying periodic boundary conditions to a channel flow in order to reproduce similar statistically homogeneous conditions cantero et al 2009 shringarpure et al 2017 these approaches have proven themselves valuable to derive and validate closure models which directly express the flux exchanges as functions of the current s bulk properties together with its mean flow evolution for large scale oceanic under and overflows ungarish 2009 based on three dimensional large eddy simulations les of a gravity current propagating over an array of obstacles tokyay et al 2014 made use of the locally spatial homogeneity of the flow in between two consecutive obstacles to compute the turbulence statistics in the current s body to analyse their impact on the flow evolution in comparison statistical mapping of the turbulent fluxes along spatially and temporally evolving unsteady lock exchange gravity currents has been given limited attention a first attempt to give a two dimensional statistical description of the head s turbulence was given experimentally by kneller et al 1999 from time averaging laser doppler velocimetry measurements over a window of 100 ms they observed the presence of large regions of negative velocity cross correlations that were likely to indicate feeding of the flow s inertia by turbulence through energy backscattering the turbulence statistics were later calculated from the span averaging of three dimensional les simulations to investigate channel gravity currents propagating up a slope ottolenghi et al 2017 as well as the erosive properties of saline gravity currents propagating over a mobile floor kyrousi et al 2018 yet the evolution of the turbulence mixing along lock released gravity currents remains poorly understood 1 4 objectives the present work aims to characterize numerically the structural evolution of the mixing layer of a laboratory scale unsteady gravity current the relationship between the turbulence structures and turbulent transport are analysed les is used to model a three dimensional lock exchange gravity current propagating down a smooth bed of 2 inclination the evolution of the billows shedding for different propagation phases are presented this information is used to assess the energy distribution along the turbulence spectra finally the evolution of the local flux exchanges are discussed and the validity of the eddy diffusivity model which is used to represent turbulent fluxes in various field scale models is validated for the spatially evolving current two key contributions to the understanding of mixing in a turbulent unsteady lock exchange gravity current are presented firstly a statistical characterisation of the local mixing due to turbulence in phase with the structural changes undergone by an unsteady current over its length secondly the identification of the nature of the turbulence mixing decay along the current 2 methodology 2 1 numerical model the fluid conditions and domain dimensions were based on experimental work by wilson et al 2017 a density difference between the lock and the channel of ρ 1 ρ 0 ρ 0 0 0829 was imposed with a lock length lx l 0 58 m channel length lx l 5 58 m ambient water depth h 0 3 m and channel width lz 0 4 m fig 2 in the computational model the top upstream downstream and side boundaries were set to slip walls whereas a non slip wall condition was imposed at the bottom boundary owing to the weak density difference the current was treated as a newtonian boussinesq density driven flow described by the incompressible navier stokes equations with the gravity term dependent on the fluid s density to account for buoyancy together with a transport equation for the dimensionless density m ρ ρ 0 ρ 1 ρ 0 the filtered les equations filtered to only resolve the largest scales of turbulence were used 2 1 u i x i 0 2 2 u i t u i u j x j p x i x j 1 r e b u i x j τ i j x j m e i g 2 3 m t u i m x i x i 1 s c r e b m x i τ i m x i with the overbar denoting the les filter operator the physical variables distinguished herewith by a tilde above the variable when relevant φ were made dimensionless using the buoyant velocity ub g η 2 0 5 as the velocity scale with the reduced gravity g g ρ 1 ρ 0 ρ 0 half the lock height h 2 as the length scale and t 0 h 2 ub as the time scale the physical properties of the fluid are represented in the equations by the buoyant reynolds number reb ub h 2 ν quantifying the ratio of buoyant induced inertial forces to viscosity and the schmidt number sc ν γ representing the ratio of the viscous momentum diffusivity ν to the density diffusivity γ in the present case the buoyant reynolds number was set to reb 60 000 resulting in a fully turbulent current pelmard et al 2018 field scale and laboratory scale gravity currents have schmidt numbers ranging from tenth to thousands however bonometti and balachandar 2008 investigated the impact of the schmidt number on the development of gravity currents and reported negligible structural changes on the current with increasing schmidt number so long as sc 1 therefore dns and les of gravity currents usually set the schmidt number to unity nasr azadani and meiburg 2011 ooi et al 2009 özgökmen et al 2009 necker et al 2005 necker et al 2002 consequently sc 1 was used for this study the momentum subgrid scale stresses τ i j u i u j u i u j represent the effect of the subgrid scale structures eliminated by the filtering process on the resolved turbulence structures and were modelled as a turbulent viscous term using the smagorinsky model smagorinsky 1963 as 2 4 τ i j 2 ν s g s s i j 2 5 ν s g s c s δ 2 s i j s i j 2 6 s i j 1 2 u i x j u j x i where s i j represent the components of the resolved shear stress tensor and νsgs corresponds to a subgrid scale eddy viscosity the smagorinsky coefficient was set to cs 0 18 and the filter width was locally defined using the cell size volume δ v 1 3 pope 2000 similarly the transport subgrid scale tensor τ i m m u i m u i was modelled as a diffusive flux with a turbulent subgrid scale diffusion γsgs linearly dependant on the subgrid scale viscosity through a constant subgrid scale schmidt number scsgs νsgs γsgs 0 7 pelmard et al 2018 as 2 7 τ i m γ s g s m x i while providing a good estimate of fully developed turbulence the smagorinsky model is known to overpredict the subgrid scale viscosity νsgs in laminar regions with non negligible shear and consequently to damp the development of turbulence in laminar turbulent transitional regions this leads to the overprediction of the near wall velocity gradient as well as the underprediction of the streamwise turbulence intensity u u and the normal reynolds stress close to the wall in fully turbulent channel flows vreman 2004 in the present case the turbulent density transport fluxes were expected to be underestimated in this region in addition while the standard smagorinsky model has been proven inferior to the dynamic smagorinsky model in the prediction of developing mixing layers vreman et al 1997 it still provides overall good estimates of the turbulence within fully turbulent mixing layers when validated against experimental data yang et al 2004 and dns simulation results vreman 2004 vreman et al 1997 the simulation were carried using the non staggered structured cartesian three dimensional finite volume code sns norris 2000 the les filtered equations were solved using the fractional step method time discretization of the advection terms was achieved using an adams bashforth scheme whereas the diffusion terms were discretized using the crank nicholson the diffusion terms and the advection term of the momentum equation were discretized using a second order central differencing scheme and the advection term of the transport equation was discretized using a third order quick method with the ultra flux limiter a variable time step was used to limit the courant lewy friedrich number cfl ui δt δx in the range 0 15 0 25 initially designed for the computation of buoyancy driven convective flows williamson et al 2015 hattori et al 2013 the sns code has successfully been applied to the modelling of wind turbine farms storey et al 2016 and gravity currents pelmard et al 2018 pelmard et al 2020 in the experiment of wilson et al 2017 the dense fluid filling the lock was initially mixed to homogenise the density therefore a random velocity distribution respecting 0 45 ui 0 45 was imposed in the lock while the channel was not perturbed this has also the advantage of accelerating the development of the instabilities driving the turbulence production inside the current 2 2 grid resolution and statistics calculation the turbulence fluxes were derived by applying a reynolds decomposition to the physical quantities introducing as the reynolds averaging operator the velocity and density fields are decomposed as u i u i u i and m m m where the capital letters represent the averaged quantities u i u i and m m and the tildes denote the turbulent perturbation components the turbulence fluxes the reynolds stresses u i u j and turbulent transport fluxes u i m are obtained from the cross correlations of the turbulent perturbations considering the strongly chaotic nature of the flow 200 independent simulations each differing from each other by a different random distribution of velocity imposed inside the lock have been performed to generate statistically independent turbulence distribution within the flow the statistics are computed from the ensemble averaging of the 200 results at the same recording time step the use of les for the calculation of turbulent statistics is complicated by the fact that the small scale turbulence is modelled rather than resolved in the simulation however previous studies using les to model shear layers vreman et al 1997 balaras et al 2001 demonstrated the ability of les to predict second order turbulent statistics both qualitatively and quantitatively provided that a sufficiently large part of the turbulence spectra is resolved a grid sensitivity study was previously presented in pelmard et al 2018 following which the 200 simulations were run on the mesh m2 which was chosen to balance the accuracy requirements of the les simulation against the computational cost the combined ensemble and span averaging of the flow leads to a total of 200 74 14 800 individual frames for the calculation of the turbulence statistics the bulk flow features front speed mixing layer s expansion wall shear stress as well as spanwise averaged density and velocity were shown to be negligibly impacted by further refinement of the grid resolution beyond m2 pelmard et al 2018 pelmard et al 2020 furthermore pelmard et al 2018 demonstrated that the dominant subgrid scale stress τ12 remained lower than 5 of its resolved reynolds stress counterpart u v across the fully turbulent mixing layer located at the limit of the current s head the reynolds stresses were calculated by averaging over the spanwise direction along with averaging over a short streamwise layer where the kelvin helmholtz billows detach from the head the subgrid scale viscosity νsgs was also shown to reduce in the weakly turbulent region above the current to a value that was 0 5 of the molecular viscosity ν whilst the modelled νsgs would ideally be required to become negligible above the current it is here considered acceptable to represent the subsequent effect of the weak background turbulence in this region and the turbulence model is expected to have an insignificant impact on the already weak reynolds stresses and turbulent density transport fluxes as compared to those in the rest of the mixing layer it is however worth noting that this level of dissipation may become important when investigating the local dynamics of the diffusive turbulent non turbulent interface of the mixing layer with the ambient fluid as experimentally investigated for instance by krug et al 2015 and neamtu halic et al 2019 hence more computationally expensive approaches such as dns would be preferable when studying the dynamics of the interface of the current such as performed by van reeuwijk et al 2018 streamwise and spanwise turbulence energy spectra averaged over the two remaining directions exhibit a sufficient inertial subrange with an overall decay of the energy level over two orders of magnitude pelmard et al 2018 pelmard et al 2020 local energy spectral densities esds are further discussed in section 6 fig 8 notably they confirm the prediction of a substantial inertial subrange over three orders of magnitude in the mixing layer however in the nose the esds only expand over one order of magnitude which is assumed to be too short to accurately quantify the flow turbulence at the nose but is considered acceptable to qualitatively discuss the turbulence dynamics in this region the coherency of the kelvin helmholtz billows populating the mixing layer of gravity currents is directly subjected to their interactions with the inherent flow turbulence cantero et al 2008 showed the existence of complex interdependent dynamics shared by the small scale turbulence and the large scale kelvin helmholtz billows the local shear strain due to the small scale turbulence leads to the progressive bending and stretching of the kelvin helmholtz billows until their subsequent breakup into three dimensional turbulence consequently the representation of the billows is directly dependent on the amount and size of the small scale turbulence resolved hence pelmard et al 2018 observed increasing loss of the billows coherency with increasing grid resolution even though this effect appears to be transparent on the statistical evolution of the flow for clarity the visualisation of the instantaneous flow dynamics is presented from available simulation results obtained using the finer mesh m1 note that the advantage of m1 against m2 resides here solely in the improved representation of the local turbulence dynamics this allows to better showcase the various flow scales and to emphasize the interactions between the large scale kelvin helmholtz billows and the small scales of turbulence yet at the expense of a substantial increase of the computation time by a factor of 7 see table 1 the specific features of m1 and m2 are detailed in table 1 both grid sets have uniform grids of dimensions nx ny w ny d nz corresponding to a uniform mesh spacing of δ except in the bottom near wall region where the mesh spacing was refined over ny w mesh points a first vertical mesh δy 1 0 00133 was imposed at the bottom wall to ensure y 5 and progressively coarsened over ny w cells in the range 0 y 0 67 to reach δy δ over the remaining ny d cells 3 front propagation throughout its lifespan a gravity current goes through three propagation phases that are identified by the evolution of its front froude number dimensionless front velocity f r f u f g h u f 2 on fig 3 a uf being the dimensional front velocity as stated in section 2 2 grid m1 and m2 predict comparable frf upon the dense fluid release the current undergoes a rapid acceleration until reaching a maximum value frf peak 0 53 which agrees well with the estimate value 0 527 derived from hydraulic theory shin et al 2004 the present frf peak has been plotted along with values obtained by pelmard et al pelmard et al 2018 for reb of 250 1000 10000 and 25000 in fig 3b for the same numerical model and grid resolution as used in the present study values presented in cantero et al 2007 are also plotted for comparison the peak velocity decreases logarithmically with increasing reynolds number and strengthens the assumption of collapse of the front velocity at high reynolds number as shown by cantero et al 2007 from the analysis of three dimensional currents of reb 3200 using the present definition of the reynolds number the inset on fig 3a also shows the evolution of frf as a function of the front position from the lock gate xf the points indicate the instantaneous values of frf computed using central differencing of the front position the solid line being the filtered result while cantero et al 2007 observed the peak velocity to be reached regardless of the reynolds number at a distance approximately 0 3h from the gate this position is attained when the front velocity crosses the threshold value frf 0 5 defined for infinitely loaded energy preserving currents the peak itself is observed farther from the lock gate at x f peak 0 45h after the peak the front velocity decreases and stabilises at a constant value frf 0 46 characteristic of the slumping phase of the current s propagation and similar values are reported by pelmard et al 2018 for reb 10 000 and 25 000 the front velocity attained is in good agreement with experimental measurement by keulegan 1957 leading to frf sl 0 48 for lock exchange saline currents of buoyant reynolds numbers reb 35 000 using the present definition after a certain distance the current transitions to the inertial phase and starts decelerating as t 1 3 huppert and simpson 1980 the deceleration scales well with the analytical prediction f r f i 0 98 l x l h h 2 1 3 t h g 1 3 reported by cantero et al 2007 giving f r f i 1 22 t h g 1 3 the time scale of the transition between the slumping and inertial phases can be estimated by t s l i h g 0 94 l x l h h 2 f r f s l 3 cantero et al 2007 which in the present case leads to t s l i h g 18 7 that is ti sl 26 4 under the present dimensionless form the front velocity is seen to deviate from the constant slumping velocity after t 30 which roughly matches with the estimate at this transition time the front has travelled approximately 5 2 lock lengths in agreement with the range 5 to 10 lock lengths indicated by rottman and simpson 1983 the transition from the self preserving phase to the buoyant viscous phase is not attained and a prediction of its occurrence is given by t i b v h g 0 4 l x l h h 2 4 7 2 2 r e b 3 7 cantero et al 2007 which corresponds to approximately ti bv 143 significantly longer than the duration of the present computation 4 structure of the current the dilution of the current has a straightforward impact on its structure over the propagation fig 1a c present isosurfaces of density m 0 1 and the two dimensional density field on the symmetry plane at three time steps shown by vertical dotted lines on fig 3 the early stage of the slumping phase t 1 8 1 the instants preceding the slumping inertial phases transition t 2 29 1 and the inertial phase t 3 50 at the early stages of the slumping phase fig 1a the current is developing and remains compact the dense head is formed but remains globally undiluted the propagation of the current is accompanied by the backward propagation of a low density wave above the current which reflects at the backward lock wall the dual formation of kelvin helmholtz billows from the roll up of the forward and backward high and low density waves interfaces due to the growth of interfacial shear instabilities characteristic of shear layers townsend 1980 is observed at the interface of the current with the ambient fluid the influence of the kelvin helmholtz billows on the entrainment and the dilution of the current can intuitively and visually be perceived by the increased dilution of the large rolls as they expand in the rear of the current which results in the growth and dilution of the mixing layer at the interface of the two fluids as the current advances more ambient fluid is entrained within the current the mixing layer expands towards the bottom wall and the current displays its characteristic structure of a dense compact head followed by a stratified elongated body fig 1b it has long been assumed that the head remains undiluted during the slumping phase of the current britter and simpson 1978 the recent improvement of image analysis has permitted finer quantification of the density field in laboratory scale gravity currents for example the image analysis of colour shades of dye loaded lock exchange saline currents of fragoso et al 2013 has permitted the identification of a progressive yet still slow dilution of the dense head during the slumping phase this observation agrees with the slow diminution of the overall current s buoyant potential energy as identified by cantero et al 2007 during the slumping phase despite not being the focus of the present work this phenomenon is here highlighted by the decrease of the average maximum density to mmax 0 981 1 at t 2 29 1 the end of the slumping phase in agreement with experimental observations reported by hacker et al 1996 and more recently by sher and woods 2015 in the present case a similar density decrease inside the head is obtained with no initial velocity perturbation not shown so that the existence of potential artificial mixing due to the rather strong initial velocity perturbation can a priori be discounted as the current enters the inertial phase the current s potential energy drops faster cantero et al 2007 and the dilution of the head is more apparent therefore the head displays enhanced dilution with its maximum density falling to mmax 0 903 1 at t 3 50 turbulence plays a dual role in the mixing of the current on one hand the small scale turbulence induced vortical motions act as a diffusive flux which works to homogenise the turbulence in the mixing layer on the other the small scale turbulence generates a continuous stress on the large scale kelvin helmholtz billows through a complex combination of bending and stretching processes that result in the progressive breakup of the two dimensional billows into three dimensional turbulence cantero et al 2008 the impact of turbulence on the billows is represented by the disturbance of the density isosurface as the current advances and the disappearance of clear roll ups at t 3 50 fig 1c the evolution of the billows coherency can be better tracked using the swirling strength λci the swirling strength corresponds to the imaginary part of the conjugate complex eigenvalues of the velocity gradient tensor compared to the vorticity λci quantifies the local swirling of a fluid parcel and allows the identification of the compact and local vortical structures of the flow by isolating their swirling wavelength from the collapsing wavelength generated from pure shearing for each time step the value of the isosurface is chosen to represent strong rotating motion qualitative tracking of the billows is achieved by plotting the span averaged isolines of λci over the two dimensional pressure field for the three time steps in fig 4 a c the isolines are plotted for λci 1 3 2 3 and 2 9 at t 1 8 1 1 15 1 95 and 2 4 at t 2 29 1 and 1 2 1 75 and 2 1 at t 3 50 swirling vortices are represented by significant local pressure minima at their centre therefore the kelvin helmholtz billows are identified by successive pressure minima along the current which value quantifies the intensity of the swirling at t 1 8 1 fig 4a the local pressure minima increase until p 1 15 the isolines of λci highlight the increase in the size of the billows in parallel the merging of vortical structures at x 4 2 and x 3 5 fig 4a indicates the presence of vortex pairing which further improves mixing in the mixing layer vortex pairing are also noticeable at x 17 5 at t 2 29 1 fig 4b and x 30 7 at t 3 50 fig 4c during early propagation stages the cores of the billows remain consistently represented by closed isolines of λci surrounding the pressure minima at the centre signs of the billows breaking are given by the disturbances observed in the isoline λci 2 3 composing the second and third billows following the front at t 1 8 1 fig 4a during the slumping and inertial phases fig 4b c the pressure minima grow until the second vortex core before decreasing the billows are already disturbed due to the turbulence at the front and breakup starting from this position the significance of their collapse is shown by the progressive deformation of the previously circular swirling strength isolines until their fragmentation observed at x 14 at t 2 29 1 fig 4b and x 27 5 at t 3 50 fig 4c which show the billows breakup 5 turbulent mixing layer 5 1 reynolds stresses fig 5 presents the reynolds stresses u u v v and w w corresponding to the streamwise vertical and spanwise contributions to the turbulence kinetic energy tke k 0 5 u i u i along the current at t 2 29 1 streamwise and spanwise turbulence u u and w w appear in the near wall region of the nose as observed on fig 5a and c cantero et al 2008 showed that this region is populated by a complex array of hairpin and quasi streamwise vortices which correlate well with the structure of the lobe and cleft instability at the front these observations are emphasized by the dominance of streamwise turbulence which maxima reach u u 0 0513 whereas its spanwise counterpart reaches w w 0 0235 in the same region the strong near wall turbulence is accompanied by an increase of the distance between the concentration isolines thus showing higher dilution of the current and the elongation of the nose above the elongated nose the density isolines tighten and show the contraction of the mixing layer during its rotation this region correlates with a local maximum of v v peaking at 0 0233 fig 5b the increase of the concentration gradient is compensated by enhanced negative vertical turbulent transport of density which acts to confine the current yet turbulence is dominated by its streamwise contributions which are 2 to 3 times greater than the spanwise contributions in this area the pre existing turbulence at the front nose directly impacts the development of the interfacial instabilities responsible for the formation of the billows and leads to chaotic vortex shedding in the mixing layer and consequently to the locally random locations of the billows for each simulation and their smoothing by the ensemble averaging process during the mixing layer s rotation the three dimensionality of turbulence is represented by the decrease of u u and the rise of v v and w w alongside with the rise of the total tke until reaching their maxima close to the threshold between the head identified at x 16 4 fig 5b c from that point on v v and w w remain of the same relative magnitude and decrease at the same rate as u u 5 2 turbulence model predictions the smagorinsky model is known for its tendency to over predict the subgrid scale viscosity in laminar turbulent transitional regions subject to strong shear such as near wall regions and stagnation points pope 2000 this results in the prediction of non physical turbulence dissipation which damps the production of tke and leads to a delay in the development of regular shear layers vreman 2004 vreman et al 2008 in gravity currents both types of region are found at the front nose where a stagnation point is located close to the bottom wall underneath the overhanging nose fig 6 a presents the ratio of the subgrid scale viscosity to the physical viscosity whereas fig 6b c show the dissipation flux ε and subgrid scale dissipation flux ε sgs the eddy viscosity fig 6a is found to be 3 to 15 times higher than the viscosity of the fluid inside the current and is expected to have a significant impact on the flow in comparison to the viscous dissipation this observation is also depicted on the dissipation fluxes showing subgrid scale dissipations one order of magnitude higher than its physical counterpart both dissipation fluxes fig 6b c peak inside the head and at the front of the current the behaviour at the front is depicted by the insets presented in fig 6 right the strong dissipation is due to the intense shear resulting from the contact of the overhanging nose with the ambient fluid placed underneath strong dissipation is observed close to the wall as a characteristic of the viscous sublayer in the present case y 2 75 at x 18 6 and extends over the two first vertical cells the overdissipative effects of the smagorinsky model are represented by large subgrid scale viscosity νsgs in the near wall region however this effect is seen to quickly fade owing for the quick decrease of νsgs until reaching values of the same magnitude as regions subject to similar turbulence intensity in different positions of the flow the viscous ratio inset also shows velocity pathlines in the reference frame moving with the front to highlight the relative motion of the flow in the front region the contact between the overhanging nose and the overlapped ambient fluid leads to local shear instabilities under the nose close to the stagnation point s härtel et al 2000 härtel et al 2000 identifies the local shear instability to be one of the mechanisms alongside local buoyant instabilities causing the formation and amplification of the lobe and cleft instability at the front and the associated turbulence structures the peak of subgrid scale dissipation close to s directly relates to important physical turbulence as represented by the corresponding local peaks of the reynolds stresses presented in fig 5a c this observations suggests that the smagorinsky turbulence model provides a qualitatively realistic development of turbulence in the mixing layer at the front 6 spectral description of the mixing layer the turbulence in the nose is directly related to the alternating lobes developing at the front whereas the turbulence developing in the mixing layer is associated with the shear instabilities of the upper mixing layer and the breakup of the kelvin helmholtz billows hence the size of the corresponding turbulent structures and the distribution of energy among the energy spectra are expected to differ between the nose and the developed mixing layer the energy spectral densities esd euiuj were computed from the discrete fourier transform u i κ κ and u j κ κ of u i and u j over the spanwise direction for each simulation and ensemble averaged over the 200 simulation results as 6 1 e u i u j κ 1 200 n 1 200 0 5 re u i κ κ u j κ κ n where the indicates the complex conjugate re is the real part of a complex quantity and κ is the index of the esd discrete sequence comprised in the range 1 nz 2 1 associated to the wavenumber 2π κ 1 lz and the wavelength λ lz κ 1 fig 7 presents the velocity ensemble averaged esds euu evv eww and the cross esd for the dominant momentum turbulent stress euv on log log coordinates as well as the ratio of the standard deviation to the corresponding average in the mixing layer directly following the head x 15 y 0 68 a c as well as in the region where turbulence is highest in the nose x 18 8 y 0 0273 b d in the nose the extraction point is at a distance of y 113 wall distance from the bottom wall the highest wavenumber corresponds to the cut off wavelength of the les filter 2π κmax 1 lz π δ 87 in the nose u v is negative and the subsequent ensemble averaged euv as well consequently euv is shown in fig 7 b instead of euv in pelmard et al 2020 it is argued that the negative u v are associated with backscatter energy transfer of momentum from turbulent motion partly generated by buoyancy instabilities at the front to the average flow field to illustrate the averaging procedure the inset of fig 7 a shows the ensemble averaged streamwise esd euu thick black line superimposed with the individual profiles obtained for each simulation thin lines the variability in the growth of turbulence and shedding of the kelvin helmholtz billows over the 200 runs results in a large dispersion of the esds around the average profiles the standard deviations fig 7 c d are found to be of the same magnitude or higher than their corresponding average over the resolved wavenumbers hence the average esds are likely to be sensitive to the sample size and 95 confidence intervals for the esds are estimated emery and thomson 1998 review methods to evaluate confidence intervals to qualify the amplitude over which true statistical quantities generated for an infinite population can be expected to deviate from an estimate obtained using a finite random sample of the population for a given probability two approaches are here compared a straightforward approach consists in determining the confidence interval for the average esds ciave at each wavenumber assuming an esd sample of length n 200 and standard deviation s distributed as a normal probability variable z around its average the true esd euiui true κ is expected to fall in the range emery and thomson 1998 6 2 e u i u i κ z 1 p 2 s n e u i u i t r u e κ e u i u i κ z p 2 s n in the context of spectral analysis an alternative approach is to apply a chi square variable analysis to evaluate the confidence intervals for the spectral estimates ci χ 2 knowing that the ratio of the sample standard deviation to the population true standard deviation behaves as a chi square variable χ n 1 2 with n 1 degrees of freedom it can be shown that euiui true κ is expected to fall in the range 6 3 n 1 e u i u i κ χ 1 p 2 n 1 2 e u i u i t r u e κ n 1 e u i u i κ χ p 2 n 1 2 with 1 p 100 confidence emery and thomson 1998 whilst this confidence interval is scale dependent 6 3 can be rewritten as 6 4 log n 1 χ 1 p 2 n 1 2 log e u i u i t r u e κ log e u i u i κ log n 1 χ p 2 n 1 2 and the ci χ 2 can be synthetised to a single vertical interval of amplitude log n 1 χ 1 p 2 n 1 2 log n 1 χ p 2 n 1 2 when represented in log scale note that contrarily to a symmetric normal variable χ n 1 2 is asymmetric and χ 1 p 2 n 1 2 χ p 2 n 1 2 in most cases the 95 confidence intervals are obtained for p 0 05 and n 200 the normal distribution table gives z 0 975 z 0 025 1 96 and the chi squared table χ 0 975 n 1 200 2 161 826 and χ 0 025 n 1 200 2 239 960 which results in the 95 ci χ 2 0 0813 0 0898 in log scale the 95 ciave at each wavenumber are shown as error bars whereas the amplitude of the 95 ci χ 2 is represented by the vertical black bars both approaches result in confidence intervals covering similar narrow ranges with the confidence interval for the spectral estimates being overall slightly larger note that the standard deviation of euv becomes significantly higher at high wavenumbers and reaches values of up to 4 in the mixing layer fig 7 c d subsequently resulting in an increase of the 95 ciave relative to the average indeed unlike the euiui the individual euv are not strictly positive and its standard deviation is unbounded although the energy cascade theory infers that kinetic energy is preferably transferred from the large scales to the small scales of the flow negative euv at given wavenumbers indicates the existence of punctual backscatter energy transfer from small to large flow scales at the corresponding flow scales hence the increase of the standard deviation relatively to the average suggests an increase of the proportion of backscatter energy transfer at the smaller scales of the flow fig 7 a shows typical isotropic turbulence spectra in the mixing layer with an inertial subrange following a power law close to κ 5 3 in the nose fig 7 b the dominance of streamwise and spanwise turbulence observed in fig 5 is here reflected by euu and eww one order of magnitude higher than evv euu evv and euv are overall evenly distributed among the wavenumbers until mid range wavenumbers 2π κ 1 lz 30 which illustrates the small size of the energetic turbulence structures in the nose as compared to the mixing layer beyond that point the spectra decay at a much faster rate comparable to a dissipative viscous subrange suggesting that the most energetic modes of streamwise and vertical turbulence are resolved despite being of the same order of magnitude as euu at the largest and smallest resolved scales eww appears to continuously decay at a slower rate close to κ 1 for 2π κ 1 lz 30 and does not exhibit any viscous like subrange yet unlike the mixing layer where the esds have dropped over three orders of magnitudes before the cut off wavenumber all the esds decay about one order of magnitude in the nose and the smallest resolved scales of turbulence are likely to carry a non negligible part of the tke at the nose further insight into the energy distribution along the spectra is obtained from the pre multiplied esds the relation between the esd and the corresponding spatial reynolds stress is rewritten as 6 5 0 5 u i u j e u i u j κ d κ κ e u i u j κ d log κ the pre multiplied esds κ euiui plotted against log κ give a compact representation of the contribution of each individual wavenumber to the associated overall reynolds stress and thus allow a direct identification of the most energetic modes of turbulence fig 8 presents three dimensional plots of pre multiplied esds for each velocity component κ euiui as functions of log κ and the height y the plots are given at four streamwise positions representing the body x 8 the direct rear of the head x 15 the region of maximum tke located at the head s limit x 16 4 and the front nose x 18 8 the black lines represent the bottom and top borders of the mixing layer the mixing layer is defined using the vorticity based formulation presented by chang and lee 2017 and applied in pelmard et al 2020 the vorticity is first expressed as the sum ωz ωsh ωres of the contribution due to shear ωsh the shear induced vorticity with a residual vorticity due to the rotation of turbulent structures ωres and the mixing layer is identified as the region where ωsh 0 close to the borders ωres is found to be over one order of magnitude smaller than ωsh and the previous condition can be reduced to ωz 0 the bottom border corresponds to the junction between the negative ωz in the near wall region and the positive ωz in the mixing layer where ωz 0 at the top border the mixing layer is rather diffuse and the vorticity collapses at a negligible but non zero value therefore the top border is chosen as the height where ωz reaches 5 of the vorticity scale 0 05ub h 2 0 12 reduced here to ωz 0 1 as observed in fig 5 the pre multiplied esds show the dominance of streamwise turbulence at the four streamwise locations in the mixing layer x 8 15 and 16 4 the peak of κ euiui at low wavenumbers κ 35 for the three components and their rapid decay towards the cut off wavenumber indicates that the most energetic structures are resolved another region of high turbulence mainly oriented in the streamwise direction and distinct from the mixing layer is identified close to the bottom wall in the head and its rear x 15 and 16 4 this illustrates the quasi streamwise near wall structures produced by the internal shear at the contact between the internal circulation of the current and the counter rotating near wall circulation in the head and its rear fragoso et al 2013 cantero et al 2008 kneller et al 1999 the details of these structures are out of the scope of this study however their confinement leads to the most energetic structures being of mid range wavenumbers as assumed the pre multiplied esds in the front nose x 18 8 have different distributions than observed in the mixing layer with the energy being stored in mid and high wavenumbers while the streamwise and vertical spectra κ euu and κ evv decay towards the cut off wavenumber the energy stored by the spanwise turbulence remains of the same order of magnitude until the cut off wavenumber consequently it is fair to assume that the complete spectrum may extend farther than the resolved range of wavenumbers and finer mesh is presumably needed to appropriately resolve the main turbulent structures of the front nose 7 dilution of the mixing layer fig 8 also shows the expansion of the mixing layer through the spread of the energetic modes along the y axis while moving away from the head the energetic mid size structures are located in the middle of the mixing layer whereas the influence of the large scale structures on the turbulence is seen to deviate towards the upper threshold of the mixing layer on κ euu and κ evv this tendency is expected to be reflected on the vertical turbulent density fluxes in such that the large scale structures are believed to prevail over smaller scale turbulence on the ambient fluid entrainment at the turbulent non turbulent interface of the current neamtu halic et al 2019 following 6 1 the vertical transport flux cross spectral density csd evm is expressed as 7 1 e v m κ 1 200 n 1 200 0 5 re v κ m κ n with m κ κ the discrete fourier transform of m over the spanwise direction fig 9 presents the pre multiplied csd for the vertical transport flux in the head and its rear x 8 15 and 16 4 as observed with the reynolds stresses entrainment due to the large scale structures is seen to deviate towards the side of the mixing layer while moving farther from the front whereas the smaller scale structures tend to be distributed inside the mixing layer after the rotation of the mixing layer the vertical turbulent flux is positive as a consequence of the turbulent entrainment to separately quantify the contributions to the turbulent density transport flux due to entrainment light fluid advected inside the current and detrainment dense fluid advected in the ambient fluid on the overall dilution of the current odier et al 2012 defined effective entrainment and detrainment parameters ce v m m 0 and cd v m m 0 respectively as the averaged advection flux of negative density perturbations and the averaged turbulent advection flux of positive density perturbations for the study of density exchanges in the body of a continuously released current propagating up a smooth plate it is important to note that the term entrainment is usually used in the context of gravity currents to signify the flux of ambient fluid incorporated into the current stream as introduced by turner 1986 and subsequently causes its dilution whereas odier et al 2012 use the terms entrainment and detrainment to distinguish the contributions to the local turbulent density transport for clarity ce and cd will be refered herein as the local turbulent entrainment and local turbulent detrainment parameters respectively fig 10 a b show the distribution of ce and cd at t 29 1 the black lines represent the mixing layer s thresholds defined in terms of vorticity by ωz 0 at the bottom and ωz 0 05 corresponding to approximately 5 of the vorticity scale ub h 2 where the vorticity vanishes at the upper threshold krug et al 2015 chang and lee 2017 and the blue lines track the parameters vertical peaks along the current the detrainment cd is seen to lie close to the upper boundary of the mixing layer regardless of the distance from the front whereas the entrainment ce is mainly concentrated in the centre of the mixing layer their corresponding peaks are predicted at approximately 70 and 55 of the mixing layer comparing this observation to the pre multiplied spectra suggests that the local turbulent detrainment is mainly due to the large scale low wavenumber structures whereas the local turbulent entrainment is a consequence of the energetic smaller scales of turbulence observed at the centre of the mixing layer nevertheless this last conclusion does not exactly match with the results reported by odier et al 2012 who identified local turbulent entrainment and detrainment further inside the mixing layer with peaks located at respectively 35 and 60 of the mixing layer s depth no real explanation on the origin of this deviation can be given based only on the present dataset though the difference in the mechanism used to generate the currents lock released current against continuously supplied current for odier et al 2012 questions on the potential influence of initial stratification on the damping of the large scale structures and the local distribution of energy along the energy spectra in the mixing layer introducing the depth averaging operator as d fig 11 a presents the evolution of the depth averaged local turbulent entrainment and detrainment parameters ce d and cd d along the current the values at t 2 29 1 are compared to statistics computed from data recorded at t 3 50 during the inertial phase two regions are identified corresponding to the two compositional parts of the current the turbulent density transport flux increases rapidly until peaking at the head s limit from that point the parameters decrease exponentially local turbulent detrainment and entrainment are of similar orders of magnitude at the two time steps despite a slight dominance of detrainment over entrainment as reported by odier et al 2012 continuously supplied gravity currents are in some degrees analogous to perpetually slumping currents which allows comparison of the computed ce d and cd d to the experimental results presented by odier et al 2012 thereby at the end of the slumping phase t 2 29 1 the parameters show values varying between 1 10 4 in the body and 1 2 10 3 at the head s limit approximately one order of magnitude smaller than the values c e d u 0 δ ρ 0 1 7 10 3 and c d d u 0 δ ρ 0 2 1 10 3 obtained from depth averaging the datasets presented by odier et al 2012 and non dimensionalizing the resulting values using the constant dense fluid injection velocity and the density difference used for the experimental setup u 0 7 cm s and δρ 0 2 6 g l it is important to note that the choice of the characteristic velocity used to compute the scaled parameters from odier et al 2012 is not straightforward since both the initial momentum due to the release of light fluid at the nozzle and the buoyant forces at the front contribute to the motion of the current scaling using the buoyant velocity ub gh δρ 0 ρ s 0 5 3 6 cm s 0 5u 0 with h 7cm the injection nozzle height and ρ s 1000 g l the density of the ambient fluid gives the values c e d u b δ ρ 0 3 2 10 3 and c d d u b δ ρ 0 4 2 10 3 which remain of the same order of magnitude the importance of the head on the dilution of unsteady gravity currents has been noted in the literature fragoso et al 2013 kneller et al 1999 mcelwaine 2005 based on three dimensional les simulations of a lock exchange current bhaganagar 2017 concluded that the body and tail have a weak influence on the current s dilution after observing the limited increase of the bulk entrainment over the current s propagation in comparison to the rapid expansion of the current in the rear of the head the concentration of turbulent density transport at the front of the current is here confirmed by the exponential decrease of ce d and cd d starting from the limit of the head xh 16 and 29 at t 1 29 1 and t 2 50 the rate of decrease of the exponential laws can be better identified on fig 11b which presents ce d and cd d plotted using a vertical semi log scale and the horizontal coordinate xf x lc normalised by the current s length lc table 2 for lc hence the transport fluxes decrease following the laws 7 2 c 29 1 d x 1 65 10 3 exp 9 04 x h x l c 1 10 4 7 3 c 50 d x 5 10 4 exp 8 97 x h x l c 2 10 5 interestingly the rate of decrease for the exponentials is similar at the two time steps exp 9 xh x lc when normalised by the length of the current similarly to the front position and velocity the previous observations suggest the existence of a scaling law describing the decay of the transport flux during the inertial phase this assumption is supported by the good match of ce d and cd d at t 2 29 1 with 5 ce d and 5 cd d at t 3 50 fig 11b inset large scale geophysical currents are often large volume underflows and present high body to head s length aspect ratio thereby most models used to represent in situ gravity currents neglect the influence of the head on the current s mixing dynamics ungarish 2009 to discuss the validity of this assumption for the present case we introduce the normalised cumulative local turbulent entrainment parameters at each position x from the front i c e and i c d as 7 4 i c e x x x f c e d x d x l x l h x f c e d x d x i c d x x x f c d d x d x l x l h x f c d d x d x where the denominator corresponds to the total depth averaged local turbulent entrainment detrainment along the current whereas the numerator represents the contribution between the front and the position x table 2 presents the values of the cumulative local turbulent entrainment parameters at the limit of the head xh at t 2 29 1 and t 3 50 at both time steps the head holds a substantial portion of the total turbulent density transport in the current approximately 25 which cannot be neglected a rapid estimate of the current s length needed to neglect the role of the head can be calculated using the previously identified correlations during the slumping phase the total transport flux in the current is first decomposed into the sum of the head and body contributions 7 5 i c t o t i c h i c b the contribution of the body is derived by integrating relation 7 2 over the body s length lb lc lh with lh the length of the head leading to relation 7 6 7 6 i c b x 0 00183 l c 1 exp 9 04 l c l h l c 1 10 4 l c l h the head is considered negligible if it holds less than a portion α of the total flux e g ic h α ic tot this condition together with 7 5 and 7 6 requires the current s length estimate to respect eq 7 7 7 7 0 00183 l c 1 exp 9 04 l c e s t l h l c 1 10 4 l c e s t l h 1 α 1 i c h 0 7 7 is solved numerically for 0 01 α 0 25 and the solutions are presented on fig 12 the estimate lc est decreases as 4 7α 1 07 for α 0 25 corresponding to the present case the estimate lc est 19 96 compares well with the length of the current before the transport flux collapses in the tail l 20 therefore for the head to represent less than 5 of the total turbulent density transport the estimate gives a minimum length lc est 120 that is more than 60 lock height knowing the constant front froude number during the slumping phase frf 0 46 see section 3 the time necessary for the current to travel the distance lc est under slumping conditions scales with δ t l c e s t 2 f r f 180 similarly for a threshold set at 1 the estimate gives a minimum lc est 625 corresponding to more than 300 lock height and a travel time scaling with δt 960 during the slumping phase 7 1 eddy viscosity diffusivity modelling geophysical flows are commonly modelled using an eddy viscosity diffusivity formulation for the reynolds transport fluxes 7 8 v k ε γ t m y with the eddy diffusivity written γt in this section two parameterizations of γt are compared the k ε model is a popular parameterization which relates γt to an eddy viscosity νt using a turbulent schmidt number sct νt γt with νt defined as 7 9 ν t c m k 2 ε v m k ε can then be written as 7 10 v k ε c m s c t k 2 ε m y the value of the model constants can be tuned for particular problems the standard values found from calibration to free stream decay and boundary layers are cm 0 09 and sct 0 9 pope 2000 in the present case the standard constants predict values of v m k ε two orders of magnitude higher than expected therefore the model constants are modified to satisfy cm sct 0 001 and fig 13 shows the resulting vertical profiles of v m and v m k ε at three positions along the current the results show a good representation of the distribution of the transport flux over the depth of the current the deviation of the model in the near wall region in the body is due to overpredictions of νt and γt characteristic of the k ε model in near wall regions geophysical and laboratory scale datasets rarely have access to the cross correlations necessary for the computations of the dissipation flux therefore simpler parameterizations have been presented to correlate v m with the behaviour of the first order flow quantities mean velocity and density odier et al 2009 proposed a simple formulation for v m using a constant prandtl mixing length formulation of the turbulent fluxes to study turbulent transport in a continuously released gravity current propagating along a flat plate v m is expressed as the product of the vertical density and velocity gradient with the square of a mixing length lρ characteristic of the mixing layer s section 7 11 v l ρ l ρ m y u y the negative sign in the formulation of odier et al 2009 disappears here since the vertical axis points downward in odier et al 2009 v m lρ is presented in fig 13 alongside v m and v m k ε the value of lρ is carefully chosen at the three positions to provide the best fit and is set to 0 0761 0 0485 and 0 0553 at x 4 10 and 16 respectively the performances of the mixing length model are comparable or better than the k ε model however the problem with the mixing length model is determining the value of lρ assuming that shear is dominant over stratification for low richardson number ri odier et al 2012 deduced experimentally a linear relation between lρ and the shear length scale ls as 7 12 l ρ 0 7 0 03 l s l s ε u y 3 the relation was obtained from a series of continuously released upward currents propagating along a plate of bulk richardson numbers in the range 0 2 ri 1 4 where r i g h δ ρ ρ 0 u 2 with δρ the density difference between the inflow and the ambient fluid u the inflow velocity and h the inflow nozzle height in the present configuration 7 12 gives inconsistent results for v m several orders of magnitude higher than the resolved value these discrepancies are likely to be due to the rapid increase of the bulk richardson number in the wake of the head using the maximum velocity inside the current as velocity scale u and the density difference between the wall and the ambience as δρ the distribution of ri along the current is computed and presented in fig 14 at t 29 1 and 50 as expected the overall ri remains greater than the range studied by odier et al 2012 and quickly increases in the wake of the head such high values of ri suggest the dominance of stratification over shear in the mixing layer with increasing distance from the front nevertheless the actual competition between shear and stratification in the wake of the head is more complex than is depicted by ri indeed close inspection of the depth averaged local flux and gradient richardson numbers rif and rig as presented in pelmard et al 2020 indicates that rather than the dominance of stratification over shear the flow develops an equilibrium state where the destruction of turbulence due to irreversible buoyant mixing becomes a constant fraction of the shear production of turbulence rif 0 28 for the present simulation further observations of pelmard et al 2020 also led to the conclusion that the disappearance of the kelvin helmholtz billows and the subsequent suppression of ambient fluid entrainment appears to coincide with the stabilisation of the depth averaged r i g m y u y 2 to a constant value dependent on the propagation time in the far rear of the current based on these conclusions it is here infered that the bulk richardson number ri does not appear to be a suitable parameter to qualify the evolution of turbulence transport for the present unsteady gravity current in agreement with the experimental conclusions of strang and fernando 2001 for stratified shear layers over a broad range of bulk richardson numbers 8 conclusions a laboratory scale turbulent gravity current of reynolds number reb 60 000 has been studied using les to assess the evolution of turbulent density transport along the current the development of turbulence in the gravity current s mixing layer is quantified reynolds stresses have been computed from ensemble averaging 200 simulations together with span averaging of the flow and are presented at a time step corresponding to the late stage of the slumping phase of the current the overall features of the modelled flow agree well with previous experimental and numerical observations for different types of flows the front propagation agrees with the analytical estimates reported by cantero et al cantero et al 2007 the turbulence spectra and pre multiplied spectra show that the model resolves the most energetic modes of turbulence in the mixing layer however a refined mesh is required to accurately represent the energetic spanwise modes at the nose which seem to extend farther than the cut off wavenumber used here the spectral description of the flow shows that the large scale structures mainly influence the turbulence density transport in the mixing layer close to the interface with the ambient fluid whereas the smaller structures are confined further inside the mixing layer acting to homogenise the density field close inspection of the vertical transport fluxes suggests that local turbulent entrainment downward transport of low density fluid in denser fluid concentrated close to the centre of the mixing layer is mainly driven by small scale structures whereas local turbulent detrainment upward transport of dense fluid in lower density fluid observed close to the interface with the ambient fluid is mainly due to the largest turbulent structures more work is needed to study both the local turbulent entrainment and detrainment with the help of turbulence spectra in the frequency domain further analysis of the evolution of the depth averaged vertical transport fluxes show that the turbulent density transport peaks at the limit of the head before decreasing exponentially in the body this demonstrates the important role the head of unsteady gravity currents has in mixing processes representing approximately 25 of the total mixing potential of the current over the propagation period investigated an estimate of the length of the current necessary to neglect the role of the head on the overall current s inner turbulent density transport is calculated based on the exponential decay of the transport flux during the slumping we show that for the present flow conditions the current would need to be more than 60 lock heights long for the turbulent density transport occurring in the head to be less than 5 of the total turbulent density transport in the current s mixing layer this observation is important to ensure accurate modelling of geophysical gravity current processes credit authorship contribution statement joë pelmard conceptualization methodology software formal analysis investigation data curation writing original draft visualization stuart norris methodology software validation writing review editing supervision heide friedrich writing review editing supervision funding acquisition declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgement the analysis was partly undertaken using a high performance computing hpc platform provided by the new zealand escience infrastructure nesi consortium this research did not receive any specific grant from funding agencies in the public commercial or not for profit sectors supplementary materials supplementary material associated with this article can be found in the online version at doi 10 1016 j advwatres 2021 103963 appendix supplementary materials image application 1 
275,turbulent mixing is a key process influencing the dynamics of subaqueous gravity currents in this study the evolution of the local turbulent mixing dynamics along a lock exchange gravity current propagating over a mild slope is statistically investigated by ensemble averaging and spanwise averaging 200 large eddy simulation results at two time steps characteristic of the slumping and inertial phases of the current s propagation premultiplied velocity and density transport spectra are computed and confirm that vertical turbulent mixing is mainly due to the large scale structures i e kelvin helmholtz billows with smaller scale turbulence acting to homogenise the density field we show that unlike large scale oceanic underflows the head holds a substantial portion of the total turbulent transport flux 25 and the decrease of the local vertical density transport flux in the body scales exponentially with distance from the head when normalised by the current s length finally the vertical density transport flux is shown to be well predicted by an eddy viscosity model after appropriate tuning of the model constants keywords gravity current buoyancy driven flow large eddy simulation mixing layer turbulent mixing stratified turbulence 1 introduction gravity currents are a type of unsteady planar buoyancy driven flow generated from the sudden release of a fixed volume of heavy fluid into a lighter quiescent ambience lock exchange models where the current is generated from the release of a dense fluid into a channel filled with lighter water with a gate initially separating the two fluids represent a simple yet useful and representative model to investigate the fundamental dynamics of large range of environmental flows such as subaqueous reservoir outflows fluvial channel landslides or sublacustrine and sea river estuaries turbidity currents simpson 1999 meiburg and kneller 2010 small initial density differences allow the generation of fully turbulent currents the density gradient driving the motion is caused by differences either in temperature salinity or in the specific case of turbidity currents by an inhomogeneous distribution of suspended particles the lock exchange configuration has been extensively applied experimentally wilson et al 2017 fragoso et al 2013 nogueira et al 2014 middleton 1966 middleton 1966 marino et al 2005 hacker et al 1996 bonnecaze et al 1993 cenedese et al 2018 lombardi et al 2018 zhao et al 2018 zordan et al 2018 and numerically härtel et al 2000 härtel et al 2000 cantero et al 2008 cantero et al 2007 özgökmen and chassignet 2002 özgökmen et al 2004 nasr azadani and meiburg 2011 nasr azadani and meiburg 2014 ooi et al 2009 ottolenghi et al 2018 inghilesi et al 2018 pelmard et al 2018 pelmard et al 2020 to the study of subaqueous gravity currents generated in a variety of geophysical conditions upon the lock release the dense fluid quickly takes on the form of an avalanche like wave with a compositional structure displaying a dense frontal head an overhanging nose at its foremost location followed by a long lasting diluted stratified body eventually ending in a thin decayed passive tail fig 1 cantero et al 2008 kneller et al 1999 komar 1972 overall the propagation of gravity currents is well understood and accurately described by characteristic scaling laws which evolve according to the dominant forces acting upon the fluid over the current s propagation gratton and vigo 1994 huppert and simpson 1980 cantero et al 2007 shin et al 2004 huppert 1982 rottman and simpson 1983 it is thus clear that the sustainability of the current is directly subjected to its ability to preserve the buoyant forces behind its motion and therefore to its dilution rate in this sense the understanding of the mechanisms responsible for the entrainment of ambient fluid inside the current and the dilution of the current remains a central topic of interest among gravity current studies to date cantero et al 2008 cenedese and adduce 2010 ottolenghi et al 2016 ottolenghi et al 2016 ottolenghi et al 2017 özgökmen et al 2009 neamtu halic et al 2019 krug et al 2013 krug et al 2015 odier et al 2012 odier et al 2014 odier et al 2009 sher and woods 2015 thomas et al 2003 sher and woods 2017 ottolenghi et al 2017 van reeuwijk et al 2018 de falco et al 2020 and is particularly challenging in the case of unsteady finite volume currents due to the uneven distribution of mixing along its length 1 1 gravity current mixing mechanisms dynamically the dilution of gravity currents is driven by two flow instabilities namely i kelvin helmholtz instabilities which are responsible for the role up of the upper interface of the current into large coherent billows and ii the lobe and cleft instability resulting from the combination of shear and buoyant instabilities underneath the overhanging nose fig 1 härtel et al 2000 lobe and cleft instabilities first entrain ambient fluid inside the current front where the light fluid is transported backward along the upper interface of the current alongside dense fluid supplied from the dense head the entrained fluid is progressively mixed by the kelvin helmholtz billows as it travels backward thus forming an interfacial mixing layer that progressively grows in the wake of the head nogueira et al 2014 härtel et al 2000 cantero et al 2008 ottolenghi et al 2016 sher and woods 2015 simpson and britter 1979 the dilution of the mixing layer is further enhanced by the small scale turbulence generated from shearing at the current interface and buoyancy at the front recent work of sher and woods 2015 has identified in detail the motion of the entrained fluid as well as the dense fluid composing the head using dye attenuation methods and high frequency camera records they tracked the displacement and dilution of punctual dye pointers injected at different positions inside and ahead of gravity currents during their propagation following previous observations kneller et al 1999 thomas et al 2003 they gave a detailed description of the evolution of the internal circulation that drives the transport of dense fluid towards the head and recycles part of the fluid transported backward back inside the head 1 2 ambient fluid entrainment quantification quantitatively mixing and entrainment in gravity currents has been the subject of considerable attention at the scale of the entire current turner 1986 has first parameterized the overall entrainment of fluid in gravity currents from bulk properties of the flow this approach was later discussed by cenedese and adduce 2010 for planar and axisymmetric gravity currents and is now largely applied to the study of fluid entrainment in gravity currents wilson et al 2017 ottolenghi et al 2016 ottolenghi et al 2016 odier et al 2014 jacobson and testik 2014 bhaganagar 2017 another indirect measure of the current s dilution is given by the background potential energy corresponding to the minimum potential energy possibly attained after adiabatically redistributing the density field in the fluid s domain fragoso et al 2013 ottolenghi et al 2016 özgökmen et al 2009 winters et al 1995 such parameterization of entrainment is particularly useful for the enhancement of one dimensional depth averaged shallow water models describing the evolution of field scale steady gravity currents with long body to head length ratios ungarish 2009 however these quantities only provide a partial description of mixing in the case of unsteady gravity currents in which the local entrainment along the current and the inner mixing dynamics of the flow significantly change along the current s length 1 3 local turbulent mixing a local measure of mixing is given by the turbulent transport fluxes i e the density velocity cross correlations however the calculation of the second order turbulence statistics such as the reynolds stresses and turbulent transport fluxes is rendered difficult by the inhomogeneous and unsteady nature of unsteady gravity currents in the case of currents produced from the continuous supply of fluid or through having a sufficiently high initial volume of fluid the dynamics of the current is dominated by its quasi steady body which is comparable to a stratified shear layer local turbulent fluxes have been computed from time and ensemble averaging of coupled planar laser induced fluorescence particle image velocimetry piv plif krug et al 2013 odier et al 2012 perez diaz et al 2018 and coupled planar laser induced fluorescence particle tracking velocimetry ptv plif neamtu halic et al 2019 krug et al 2015 measurements similarly the flux exchanges of turbidity currents have been studied numerically by applying periodic boundary conditions to a channel flow in order to reproduce similar statistically homogeneous conditions cantero et al 2009 shringarpure et al 2017 these approaches have proven themselves valuable to derive and validate closure models which directly express the flux exchanges as functions of the current s bulk properties together with its mean flow evolution for large scale oceanic under and overflows ungarish 2009 based on three dimensional large eddy simulations les of a gravity current propagating over an array of obstacles tokyay et al 2014 made use of the locally spatial homogeneity of the flow in between two consecutive obstacles to compute the turbulence statistics in the current s body to analyse their impact on the flow evolution in comparison statistical mapping of the turbulent fluxes along spatially and temporally evolving unsteady lock exchange gravity currents has been given limited attention a first attempt to give a two dimensional statistical description of the head s turbulence was given experimentally by kneller et al 1999 from time averaging laser doppler velocimetry measurements over a window of 100 ms they observed the presence of large regions of negative velocity cross correlations that were likely to indicate feeding of the flow s inertia by turbulence through energy backscattering the turbulence statistics were later calculated from the span averaging of three dimensional les simulations to investigate channel gravity currents propagating up a slope ottolenghi et al 2017 as well as the erosive properties of saline gravity currents propagating over a mobile floor kyrousi et al 2018 yet the evolution of the turbulence mixing along lock released gravity currents remains poorly understood 1 4 objectives the present work aims to characterize numerically the structural evolution of the mixing layer of a laboratory scale unsteady gravity current the relationship between the turbulence structures and turbulent transport are analysed les is used to model a three dimensional lock exchange gravity current propagating down a smooth bed of 2 inclination the evolution of the billows shedding for different propagation phases are presented this information is used to assess the energy distribution along the turbulence spectra finally the evolution of the local flux exchanges are discussed and the validity of the eddy diffusivity model which is used to represent turbulent fluxes in various field scale models is validated for the spatially evolving current two key contributions to the understanding of mixing in a turbulent unsteady lock exchange gravity current are presented firstly a statistical characterisation of the local mixing due to turbulence in phase with the structural changes undergone by an unsteady current over its length secondly the identification of the nature of the turbulence mixing decay along the current 2 methodology 2 1 numerical model the fluid conditions and domain dimensions were based on experimental work by wilson et al 2017 a density difference between the lock and the channel of ρ 1 ρ 0 ρ 0 0 0829 was imposed with a lock length lx l 0 58 m channel length lx l 5 58 m ambient water depth h 0 3 m and channel width lz 0 4 m fig 2 in the computational model the top upstream downstream and side boundaries were set to slip walls whereas a non slip wall condition was imposed at the bottom boundary owing to the weak density difference the current was treated as a newtonian boussinesq density driven flow described by the incompressible navier stokes equations with the gravity term dependent on the fluid s density to account for buoyancy together with a transport equation for the dimensionless density m ρ ρ 0 ρ 1 ρ 0 the filtered les equations filtered to only resolve the largest scales of turbulence were used 2 1 u i x i 0 2 2 u i t u i u j x j p x i x j 1 r e b u i x j τ i j x j m e i g 2 3 m t u i m x i x i 1 s c r e b m x i τ i m x i with the overbar denoting the les filter operator the physical variables distinguished herewith by a tilde above the variable when relevant φ were made dimensionless using the buoyant velocity ub g η 2 0 5 as the velocity scale with the reduced gravity g g ρ 1 ρ 0 ρ 0 half the lock height h 2 as the length scale and t 0 h 2 ub as the time scale the physical properties of the fluid are represented in the equations by the buoyant reynolds number reb ub h 2 ν quantifying the ratio of buoyant induced inertial forces to viscosity and the schmidt number sc ν γ representing the ratio of the viscous momentum diffusivity ν to the density diffusivity γ in the present case the buoyant reynolds number was set to reb 60 000 resulting in a fully turbulent current pelmard et al 2018 field scale and laboratory scale gravity currents have schmidt numbers ranging from tenth to thousands however bonometti and balachandar 2008 investigated the impact of the schmidt number on the development of gravity currents and reported negligible structural changes on the current with increasing schmidt number so long as sc 1 therefore dns and les of gravity currents usually set the schmidt number to unity nasr azadani and meiburg 2011 ooi et al 2009 özgökmen et al 2009 necker et al 2005 necker et al 2002 consequently sc 1 was used for this study the momentum subgrid scale stresses τ i j u i u j u i u j represent the effect of the subgrid scale structures eliminated by the filtering process on the resolved turbulence structures and were modelled as a turbulent viscous term using the smagorinsky model smagorinsky 1963 as 2 4 τ i j 2 ν s g s s i j 2 5 ν s g s c s δ 2 s i j s i j 2 6 s i j 1 2 u i x j u j x i where s i j represent the components of the resolved shear stress tensor and νsgs corresponds to a subgrid scale eddy viscosity the smagorinsky coefficient was set to cs 0 18 and the filter width was locally defined using the cell size volume δ v 1 3 pope 2000 similarly the transport subgrid scale tensor τ i m m u i m u i was modelled as a diffusive flux with a turbulent subgrid scale diffusion γsgs linearly dependant on the subgrid scale viscosity through a constant subgrid scale schmidt number scsgs νsgs γsgs 0 7 pelmard et al 2018 as 2 7 τ i m γ s g s m x i while providing a good estimate of fully developed turbulence the smagorinsky model is known to overpredict the subgrid scale viscosity νsgs in laminar regions with non negligible shear and consequently to damp the development of turbulence in laminar turbulent transitional regions this leads to the overprediction of the near wall velocity gradient as well as the underprediction of the streamwise turbulence intensity u u and the normal reynolds stress close to the wall in fully turbulent channel flows vreman 2004 in the present case the turbulent density transport fluxes were expected to be underestimated in this region in addition while the standard smagorinsky model has been proven inferior to the dynamic smagorinsky model in the prediction of developing mixing layers vreman et al 1997 it still provides overall good estimates of the turbulence within fully turbulent mixing layers when validated against experimental data yang et al 2004 and dns simulation results vreman 2004 vreman et al 1997 the simulation were carried using the non staggered structured cartesian three dimensional finite volume code sns norris 2000 the les filtered equations were solved using the fractional step method time discretization of the advection terms was achieved using an adams bashforth scheme whereas the diffusion terms were discretized using the crank nicholson the diffusion terms and the advection term of the momentum equation were discretized using a second order central differencing scheme and the advection term of the transport equation was discretized using a third order quick method with the ultra flux limiter a variable time step was used to limit the courant lewy friedrich number cfl ui δt δx in the range 0 15 0 25 initially designed for the computation of buoyancy driven convective flows williamson et al 2015 hattori et al 2013 the sns code has successfully been applied to the modelling of wind turbine farms storey et al 2016 and gravity currents pelmard et al 2018 pelmard et al 2020 in the experiment of wilson et al 2017 the dense fluid filling the lock was initially mixed to homogenise the density therefore a random velocity distribution respecting 0 45 ui 0 45 was imposed in the lock while the channel was not perturbed this has also the advantage of accelerating the development of the instabilities driving the turbulence production inside the current 2 2 grid resolution and statistics calculation the turbulence fluxes were derived by applying a reynolds decomposition to the physical quantities introducing as the reynolds averaging operator the velocity and density fields are decomposed as u i u i u i and m m m where the capital letters represent the averaged quantities u i u i and m m and the tildes denote the turbulent perturbation components the turbulence fluxes the reynolds stresses u i u j and turbulent transport fluxes u i m are obtained from the cross correlations of the turbulent perturbations considering the strongly chaotic nature of the flow 200 independent simulations each differing from each other by a different random distribution of velocity imposed inside the lock have been performed to generate statistically independent turbulence distribution within the flow the statistics are computed from the ensemble averaging of the 200 results at the same recording time step the use of les for the calculation of turbulent statistics is complicated by the fact that the small scale turbulence is modelled rather than resolved in the simulation however previous studies using les to model shear layers vreman et al 1997 balaras et al 2001 demonstrated the ability of les to predict second order turbulent statistics both qualitatively and quantitatively provided that a sufficiently large part of the turbulence spectra is resolved a grid sensitivity study was previously presented in pelmard et al 2018 following which the 200 simulations were run on the mesh m2 which was chosen to balance the accuracy requirements of the les simulation against the computational cost the combined ensemble and span averaging of the flow leads to a total of 200 74 14 800 individual frames for the calculation of the turbulence statistics the bulk flow features front speed mixing layer s expansion wall shear stress as well as spanwise averaged density and velocity were shown to be negligibly impacted by further refinement of the grid resolution beyond m2 pelmard et al 2018 pelmard et al 2020 furthermore pelmard et al 2018 demonstrated that the dominant subgrid scale stress τ12 remained lower than 5 of its resolved reynolds stress counterpart u v across the fully turbulent mixing layer located at the limit of the current s head the reynolds stresses were calculated by averaging over the spanwise direction along with averaging over a short streamwise layer where the kelvin helmholtz billows detach from the head the subgrid scale viscosity νsgs was also shown to reduce in the weakly turbulent region above the current to a value that was 0 5 of the molecular viscosity ν whilst the modelled νsgs would ideally be required to become negligible above the current it is here considered acceptable to represent the subsequent effect of the weak background turbulence in this region and the turbulence model is expected to have an insignificant impact on the already weak reynolds stresses and turbulent density transport fluxes as compared to those in the rest of the mixing layer it is however worth noting that this level of dissipation may become important when investigating the local dynamics of the diffusive turbulent non turbulent interface of the mixing layer with the ambient fluid as experimentally investigated for instance by krug et al 2015 and neamtu halic et al 2019 hence more computationally expensive approaches such as dns would be preferable when studying the dynamics of the interface of the current such as performed by van reeuwijk et al 2018 streamwise and spanwise turbulence energy spectra averaged over the two remaining directions exhibit a sufficient inertial subrange with an overall decay of the energy level over two orders of magnitude pelmard et al 2018 pelmard et al 2020 local energy spectral densities esds are further discussed in section 6 fig 8 notably they confirm the prediction of a substantial inertial subrange over three orders of magnitude in the mixing layer however in the nose the esds only expand over one order of magnitude which is assumed to be too short to accurately quantify the flow turbulence at the nose but is considered acceptable to qualitatively discuss the turbulence dynamics in this region the coherency of the kelvin helmholtz billows populating the mixing layer of gravity currents is directly subjected to their interactions with the inherent flow turbulence cantero et al 2008 showed the existence of complex interdependent dynamics shared by the small scale turbulence and the large scale kelvin helmholtz billows the local shear strain due to the small scale turbulence leads to the progressive bending and stretching of the kelvin helmholtz billows until their subsequent breakup into three dimensional turbulence consequently the representation of the billows is directly dependent on the amount and size of the small scale turbulence resolved hence pelmard et al 2018 observed increasing loss of the billows coherency with increasing grid resolution even though this effect appears to be transparent on the statistical evolution of the flow for clarity the visualisation of the instantaneous flow dynamics is presented from available simulation results obtained using the finer mesh m1 note that the advantage of m1 against m2 resides here solely in the improved representation of the local turbulence dynamics this allows to better showcase the various flow scales and to emphasize the interactions between the large scale kelvin helmholtz billows and the small scales of turbulence yet at the expense of a substantial increase of the computation time by a factor of 7 see table 1 the specific features of m1 and m2 are detailed in table 1 both grid sets have uniform grids of dimensions nx ny w ny d nz corresponding to a uniform mesh spacing of δ except in the bottom near wall region where the mesh spacing was refined over ny w mesh points a first vertical mesh δy 1 0 00133 was imposed at the bottom wall to ensure y 5 and progressively coarsened over ny w cells in the range 0 y 0 67 to reach δy δ over the remaining ny d cells 3 front propagation throughout its lifespan a gravity current goes through three propagation phases that are identified by the evolution of its front froude number dimensionless front velocity f r f u f g h u f 2 on fig 3 a uf being the dimensional front velocity as stated in section 2 2 grid m1 and m2 predict comparable frf upon the dense fluid release the current undergoes a rapid acceleration until reaching a maximum value frf peak 0 53 which agrees well with the estimate value 0 527 derived from hydraulic theory shin et al 2004 the present frf peak has been plotted along with values obtained by pelmard et al pelmard et al 2018 for reb of 250 1000 10000 and 25000 in fig 3b for the same numerical model and grid resolution as used in the present study values presented in cantero et al 2007 are also plotted for comparison the peak velocity decreases logarithmically with increasing reynolds number and strengthens the assumption of collapse of the front velocity at high reynolds number as shown by cantero et al 2007 from the analysis of three dimensional currents of reb 3200 using the present definition of the reynolds number the inset on fig 3a also shows the evolution of frf as a function of the front position from the lock gate xf the points indicate the instantaneous values of frf computed using central differencing of the front position the solid line being the filtered result while cantero et al 2007 observed the peak velocity to be reached regardless of the reynolds number at a distance approximately 0 3h from the gate this position is attained when the front velocity crosses the threshold value frf 0 5 defined for infinitely loaded energy preserving currents the peak itself is observed farther from the lock gate at x f peak 0 45h after the peak the front velocity decreases and stabilises at a constant value frf 0 46 characteristic of the slumping phase of the current s propagation and similar values are reported by pelmard et al 2018 for reb 10 000 and 25 000 the front velocity attained is in good agreement with experimental measurement by keulegan 1957 leading to frf sl 0 48 for lock exchange saline currents of buoyant reynolds numbers reb 35 000 using the present definition after a certain distance the current transitions to the inertial phase and starts decelerating as t 1 3 huppert and simpson 1980 the deceleration scales well with the analytical prediction f r f i 0 98 l x l h h 2 1 3 t h g 1 3 reported by cantero et al 2007 giving f r f i 1 22 t h g 1 3 the time scale of the transition between the slumping and inertial phases can be estimated by t s l i h g 0 94 l x l h h 2 f r f s l 3 cantero et al 2007 which in the present case leads to t s l i h g 18 7 that is ti sl 26 4 under the present dimensionless form the front velocity is seen to deviate from the constant slumping velocity after t 30 which roughly matches with the estimate at this transition time the front has travelled approximately 5 2 lock lengths in agreement with the range 5 to 10 lock lengths indicated by rottman and simpson 1983 the transition from the self preserving phase to the buoyant viscous phase is not attained and a prediction of its occurrence is given by t i b v h g 0 4 l x l h h 2 4 7 2 2 r e b 3 7 cantero et al 2007 which corresponds to approximately ti bv 143 significantly longer than the duration of the present computation 4 structure of the current the dilution of the current has a straightforward impact on its structure over the propagation fig 1a c present isosurfaces of density m 0 1 and the two dimensional density field on the symmetry plane at three time steps shown by vertical dotted lines on fig 3 the early stage of the slumping phase t 1 8 1 the instants preceding the slumping inertial phases transition t 2 29 1 and the inertial phase t 3 50 at the early stages of the slumping phase fig 1a the current is developing and remains compact the dense head is formed but remains globally undiluted the propagation of the current is accompanied by the backward propagation of a low density wave above the current which reflects at the backward lock wall the dual formation of kelvin helmholtz billows from the roll up of the forward and backward high and low density waves interfaces due to the growth of interfacial shear instabilities characteristic of shear layers townsend 1980 is observed at the interface of the current with the ambient fluid the influence of the kelvin helmholtz billows on the entrainment and the dilution of the current can intuitively and visually be perceived by the increased dilution of the large rolls as they expand in the rear of the current which results in the growth and dilution of the mixing layer at the interface of the two fluids as the current advances more ambient fluid is entrained within the current the mixing layer expands towards the bottom wall and the current displays its characteristic structure of a dense compact head followed by a stratified elongated body fig 1b it has long been assumed that the head remains undiluted during the slumping phase of the current britter and simpson 1978 the recent improvement of image analysis has permitted finer quantification of the density field in laboratory scale gravity currents for example the image analysis of colour shades of dye loaded lock exchange saline currents of fragoso et al 2013 has permitted the identification of a progressive yet still slow dilution of the dense head during the slumping phase this observation agrees with the slow diminution of the overall current s buoyant potential energy as identified by cantero et al 2007 during the slumping phase despite not being the focus of the present work this phenomenon is here highlighted by the decrease of the average maximum density to mmax 0 981 1 at t 2 29 1 the end of the slumping phase in agreement with experimental observations reported by hacker et al 1996 and more recently by sher and woods 2015 in the present case a similar density decrease inside the head is obtained with no initial velocity perturbation not shown so that the existence of potential artificial mixing due to the rather strong initial velocity perturbation can a priori be discounted as the current enters the inertial phase the current s potential energy drops faster cantero et al 2007 and the dilution of the head is more apparent therefore the head displays enhanced dilution with its maximum density falling to mmax 0 903 1 at t 3 50 turbulence plays a dual role in the mixing of the current on one hand the small scale turbulence induced vortical motions act as a diffusive flux which works to homogenise the turbulence in the mixing layer on the other the small scale turbulence generates a continuous stress on the large scale kelvin helmholtz billows through a complex combination of bending and stretching processes that result in the progressive breakup of the two dimensional billows into three dimensional turbulence cantero et al 2008 the impact of turbulence on the billows is represented by the disturbance of the density isosurface as the current advances and the disappearance of clear roll ups at t 3 50 fig 1c the evolution of the billows coherency can be better tracked using the swirling strength λci the swirling strength corresponds to the imaginary part of the conjugate complex eigenvalues of the velocity gradient tensor compared to the vorticity λci quantifies the local swirling of a fluid parcel and allows the identification of the compact and local vortical structures of the flow by isolating their swirling wavelength from the collapsing wavelength generated from pure shearing for each time step the value of the isosurface is chosen to represent strong rotating motion qualitative tracking of the billows is achieved by plotting the span averaged isolines of λci over the two dimensional pressure field for the three time steps in fig 4 a c the isolines are plotted for λci 1 3 2 3 and 2 9 at t 1 8 1 1 15 1 95 and 2 4 at t 2 29 1 and 1 2 1 75 and 2 1 at t 3 50 swirling vortices are represented by significant local pressure minima at their centre therefore the kelvin helmholtz billows are identified by successive pressure minima along the current which value quantifies the intensity of the swirling at t 1 8 1 fig 4a the local pressure minima increase until p 1 15 the isolines of λci highlight the increase in the size of the billows in parallel the merging of vortical structures at x 4 2 and x 3 5 fig 4a indicates the presence of vortex pairing which further improves mixing in the mixing layer vortex pairing are also noticeable at x 17 5 at t 2 29 1 fig 4b and x 30 7 at t 3 50 fig 4c during early propagation stages the cores of the billows remain consistently represented by closed isolines of λci surrounding the pressure minima at the centre signs of the billows breaking are given by the disturbances observed in the isoline λci 2 3 composing the second and third billows following the front at t 1 8 1 fig 4a during the slumping and inertial phases fig 4b c the pressure minima grow until the second vortex core before decreasing the billows are already disturbed due to the turbulence at the front and breakup starting from this position the significance of their collapse is shown by the progressive deformation of the previously circular swirling strength isolines until their fragmentation observed at x 14 at t 2 29 1 fig 4b and x 27 5 at t 3 50 fig 4c which show the billows breakup 5 turbulent mixing layer 5 1 reynolds stresses fig 5 presents the reynolds stresses u u v v and w w corresponding to the streamwise vertical and spanwise contributions to the turbulence kinetic energy tke k 0 5 u i u i along the current at t 2 29 1 streamwise and spanwise turbulence u u and w w appear in the near wall region of the nose as observed on fig 5a and c cantero et al 2008 showed that this region is populated by a complex array of hairpin and quasi streamwise vortices which correlate well with the structure of the lobe and cleft instability at the front these observations are emphasized by the dominance of streamwise turbulence which maxima reach u u 0 0513 whereas its spanwise counterpart reaches w w 0 0235 in the same region the strong near wall turbulence is accompanied by an increase of the distance between the concentration isolines thus showing higher dilution of the current and the elongation of the nose above the elongated nose the density isolines tighten and show the contraction of the mixing layer during its rotation this region correlates with a local maximum of v v peaking at 0 0233 fig 5b the increase of the concentration gradient is compensated by enhanced negative vertical turbulent transport of density which acts to confine the current yet turbulence is dominated by its streamwise contributions which are 2 to 3 times greater than the spanwise contributions in this area the pre existing turbulence at the front nose directly impacts the development of the interfacial instabilities responsible for the formation of the billows and leads to chaotic vortex shedding in the mixing layer and consequently to the locally random locations of the billows for each simulation and their smoothing by the ensemble averaging process during the mixing layer s rotation the three dimensionality of turbulence is represented by the decrease of u u and the rise of v v and w w alongside with the rise of the total tke until reaching their maxima close to the threshold between the head identified at x 16 4 fig 5b c from that point on v v and w w remain of the same relative magnitude and decrease at the same rate as u u 5 2 turbulence model predictions the smagorinsky model is known for its tendency to over predict the subgrid scale viscosity in laminar turbulent transitional regions subject to strong shear such as near wall regions and stagnation points pope 2000 this results in the prediction of non physical turbulence dissipation which damps the production of tke and leads to a delay in the development of regular shear layers vreman 2004 vreman et al 2008 in gravity currents both types of region are found at the front nose where a stagnation point is located close to the bottom wall underneath the overhanging nose fig 6 a presents the ratio of the subgrid scale viscosity to the physical viscosity whereas fig 6b c show the dissipation flux ε and subgrid scale dissipation flux ε sgs the eddy viscosity fig 6a is found to be 3 to 15 times higher than the viscosity of the fluid inside the current and is expected to have a significant impact on the flow in comparison to the viscous dissipation this observation is also depicted on the dissipation fluxes showing subgrid scale dissipations one order of magnitude higher than its physical counterpart both dissipation fluxes fig 6b c peak inside the head and at the front of the current the behaviour at the front is depicted by the insets presented in fig 6 right the strong dissipation is due to the intense shear resulting from the contact of the overhanging nose with the ambient fluid placed underneath strong dissipation is observed close to the wall as a characteristic of the viscous sublayer in the present case y 2 75 at x 18 6 and extends over the two first vertical cells the overdissipative effects of the smagorinsky model are represented by large subgrid scale viscosity νsgs in the near wall region however this effect is seen to quickly fade owing for the quick decrease of νsgs until reaching values of the same magnitude as regions subject to similar turbulence intensity in different positions of the flow the viscous ratio inset also shows velocity pathlines in the reference frame moving with the front to highlight the relative motion of the flow in the front region the contact between the overhanging nose and the overlapped ambient fluid leads to local shear instabilities under the nose close to the stagnation point s härtel et al 2000 härtel et al 2000 identifies the local shear instability to be one of the mechanisms alongside local buoyant instabilities causing the formation and amplification of the lobe and cleft instability at the front and the associated turbulence structures the peak of subgrid scale dissipation close to s directly relates to important physical turbulence as represented by the corresponding local peaks of the reynolds stresses presented in fig 5a c this observations suggests that the smagorinsky turbulence model provides a qualitatively realistic development of turbulence in the mixing layer at the front 6 spectral description of the mixing layer the turbulence in the nose is directly related to the alternating lobes developing at the front whereas the turbulence developing in the mixing layer is associated with the shear instabilities of the upper mixing layer and the breakup of the kelvin helmholtz billows hence the size of the corresponding turbulent structures and the distribution of energy among the energy spectra are expected to differ between the nose and the developed mixing layer the energy spectral densities esd euiuj were computed from the discrete fourier transform u i κ κ and u j κ κ of u i and u j over the spanwise direction for each simulation and ensemble averaged over the 200 simulation results as 6 1 e u i u j κ 1 200 n 1 200 0 5 re u i κ κ u j κ κ n where the indicates the complex conjugate re is the real part of a complex quantity and κ is the index of the esd discrete sequence comprised in the range 1 nz 2 1 associated to the wavenumber 2π κ 1 lz and the wavelength λ lz κ 1 fig 7 presents the velocity ensemble averaged esds euu evv eww and the cross esd for the dominant momentum turbulent stress euv on log log coordinates as well as the ratio of the standard deviation to the corresponding average in the mixing layer directly following the head x 15 y 0 68 a c as well as in the region where turbulence is highest in the nose x 18 8 y 0 0273 b d in the nose the extraction point is at a distance of y 113 wall distance from the bottom wall the highest wavenumber corresponds to the cut off wavelength of the les filter 2π κmax 1 lz π δ 87 in the nose u v is negative and the subsequent ensemble averaged euv as well consequently euv is shown in fig 7 b instead of euv in pelmard et al 2020 it is argued that the negative u v are associated with backscatter energy transfer of momentum from turbulent motion partly generated by buoyancy instabilities at the front to the average flow field to illustrate the averaging procedure the inset of fig 7 a shows the ensemble averaged streamwise esd euu thick black line superimposed with the individual profiles obtained for each simulation thin lines the variability in the growth of turbulence and shedding of the kelvin helmholtz billows over the 200 runs results in a large dispersion of the esds around the average profiles the standard deviations fig 7 c d are found to be of the same magnitude or higher than their corresponding average over the resolved wavenumbers hence the average esds are likely to be sensitive to the sample size and 95 confidence intervals for the esds are estimated emery and thomson 1998 review methods to evaluate confidence intervals to qualify the amplitude over which true statistical quantities generated for an infinite population can be expected to deviate from an estimate obtained using a finite random sample of the population for a given probability two approaches are here compared a straightforward approach consists in determining the confidence interval for the average esds ciave at each wavenumber assuming an esd sample of length n 200 and standard deviation s distributed as a normal probability variable z around its average the true esd euiui true κ is expected to fall in the range emery and thomson 1998 6 2 e u i u i κ z 1 p 2 s n e u i u i t r u e κ e u i u i κ z p 2 s n in the context of spectral analysis an alternative approach is to apply a chi square variable analysis to evaluate the confidence intervals for the spectral estimates ci χ 2 knowing that the ratio of the sample standard deviation to the population true standard deviation behaves as a chi square variable χ n 1 2 with n 1 degrees of freedom it can be shown that euiui true κ is expected to fall in the range 6 3 n 1 e u i u i κ χ 1 p 2 n 1 2 e u i u i t r u e κ n 1 e u i u i κ χ p 2 n 1 2 with 1 p 100 confidence emery and thomson 1998 whilst this confidence interval is scale dependent 6 3 can be rewritten as 6 4 log n 1 χ 1 p 2 n 1 2 log e u i u i t r u e κ log e u i u i κ log n 1 χ p 2 n 1 2 and the ci χ 2 can be synthetised to a single vertical interval of amplitude log n 1 χ 1 p 2 n 1 2 log n 1 χ p 2 n 1 2 when represented in log scale note that contrarily to a symmetric normal variable χ n 1 2 is asymmetric and χ 1 p 2 n 1 2 χ p 2 n 1 2 in most cases the 95 confidence intervals are obtained for p 0 05 and n 200 the normal distribution table gives z 0 975 z 0 025 1 96 and the chi squared table χ 0 975 n 1 200 2 161 826 and χ 0 025 n 1 200 2 239 960 which results in the 95 ci χ 2 0 0813 0 0898 in log scale the 95 ciave at each wavenumber are shown as error bars whereas the amplitude of the 95 ci χ 2 is represented by the vertical black bars both approaches result in confidence intervals covering similar narrow ranges with the confidence interval for the spectral estimates being overall slightly larger note that the standard deviation of euv becomes significantly higher at high wavenumbers and reaches values of up to 4 in the mixing layer fig 7 c d subsequently resulting in an increase of the 95 ciave relative to the average indeed unlike the euiui the individual euv are not strictly positive and its standard deviation is unbounded although the energy cascade theory infers that kinetic energy is preferably transferred from the large scales to the small scales of the flow negative euv at given wavenumbers indicates the existence of punctual backscatter energy transfer from small to large flow scales at the corresponding flow scales hence the increase of the standard deviation relatively to the average suggests an increase of the proportion of backscatter energy transfer at the smaller scales of the flow fig 7 a shows typical isotropic turbulence spectra in the mixing layer with an inertial subrange following a power law close to κ 5 3 in the nose fig 7 b the dominance of streamwise and spanwise turbulence observed in fig 5 is here reflected by euu and eww one order of magnitude higher than evv euu evv and euv are overall evenly distributed among the wavenumbers until mid range wavenumbers 2π κ 1 lz 30 which illustrates the small size of the energetic turbulence structures in the nose as compared to the mixing layer beyond that point the spectra decay at a much faster rate comparable to a dissipative viscous subrange suggesting that the most energetic modes of streamwise and vertical turbulence are resolved despite being of the same order of magnitude as euu at the largest and smallest resolved scales eww appears to continuously decay at a slower rate close to κ 1 for 2π κ 1 lz 30 and does not exhibit any viscous like subrange yet unlike the mixing layer where the esds have dropped over three orders of magnitudes before the cut off wavenumber all the esds decay about one order of magnitude in the nose and the smallest resolved scales of turbulence are likely to carry a non negligible part of the tke at the nose further insight into the energy distribution along the spectra is obtained from the pre multiplied esds the relation between the esd and the corresponding spatial reynolds stress is rewritten as 6 5 0 5 u i u j e u i u j κ d κ κ e u i u j κ d log κ the pre multiplied esds κ euiui plotted against log κ give a compact representation of the contribution of each individual wavenumber to the associated overall reynolds stress and thus allow a direct identification of the most energetic modes of turbulence fig 8 presents three dimensional plots of pre multiplied esds for each velocity component κ euiui as functions of log κ and the height y the plots are given at four streamwise positions representing the body x 8 the direct rear of the head x 15 the region of maximum tke located at the head s limit x 16 4 and the front nose x 18 8 the black lines represent the bottom and top borders of the mixing layer the mixing layer is defined using the vorticity based formulation presented by chang and lee 2017 and applied in pelmard et al 2020 the vorticity is first expressed as the sum ωz ωsh ωres of the contribution due to shear ωsh the shear induced vorticity with a residual vorticity due to the rotation of turbulent structures ωres and the mixing layer is identified as the region where ωsh 0 close to the borders ωres is found to be over one order of magnitude smaller than ωsh and the previous condition can be reduced to ωz 0 the bottom border corresponds to the junction between the negative ωz in the near wall region and the positive ωz in the mixing layer where ωz 0 at the top border the mixing layer is rather diffuse and the vorticity collapses at a negligible but non zero value therefore the top border is chosen as the height where ωz reaches 5 of the vorticity scale 0 05ub h 2 0 12 reduced here to ωz 0 1 as observed in fig 5 the pre multiplied esds show the dominance of streamwise turbulence at the four streamwise locations in the mixing layer x 8 15 and 16 4 the peak of κ euiui at low wavenumbers κ 35 for the three components and their rapid decay towards the cut off wavenumber indicates that the most energetic structures are resolved another region of high turbulence mainly oriented in the streamwise direction and distinct from the mixing layer is identified close to the bottom wall in the head and its rear x 15 and 16 4 this illustrates the quasi streamwise near wall structures produced by the internal shear at the contact between the internal circulation of the current and the counter rotating near wall circulation in the head and its rear fragoso et al 2013 cantero et al 2008 kneller et al 1999 the details of these structures are out of the scope of this study however their confinement leads to the most energetic structures being of mid range wavenumbers as assumed the pre multiplied esds in the front nose x 18 8 have different distributions than observed in the mixing layer with the energy being stored in mid and high wavenumbers while the streamwise and vertical spectra κ euu and κ evv decay towards the cut off wavenumber the energy stored by the spanwise turbulence remains of the same order of magnitude until the cut off wavenumber consequently it is fair to assume that the complete spectrum may extend farther than the resolved range of wavenumbers and finer mesh is presumably needed to appropriately resolve the main turbulent structures of the front nose 7 dilution of the mixing layer fig 8 also shows the expansion of the mixing layer through the spread of the energetic modes along the y axis while moving away from the head the energetic mid size structures are located in the middle of the mixing layer whereas the influence of the large scale structures on the turbulence is seen to deviate towards the upper threshold of the mixing layer on κ euu and κ evv this tendency is expected to be reflected on the vertical turbulent density fluxes in such that the large scale structures are believed to prevail over smaller scale turbulence on the ambient fluid entrainment at the turbulent non turbulent interface of the current neamtu halic et al 2019 following 6 1 the vertical transport flux cross spectral density csd evm is expressed as 7 1 e v m κ 1 200 n 1 200 0 5 re v κ m κ n with m κ κ the discrete fourier transform of m over the spanwise direction fig 9 presents the pre multiplied csd for the vertical transport flux in the head and its rear x 8 15 and 16 4 as observed with the reynolds stresses entrainment due to the large scale structures is seen to deviate towards the side of the mixing layer while moving farther from the front whereas the smaller scale structures tend to be distributed inside the mixing layer after the rotation of the mixing layer the vertical turbulent flux is positive as a consequence of the turbulent entrainment to separately quantify the contributions to the turbulent density transport flux due to entrainment light fluid advected inside the current and detrainment dense fluid advected in the ambient fluid on the overall dilution of the current odier et al 2012 defined effective entrainment and detrainment parameters ce v m m 0 and cd v m m 0 respectively as the averaged advection flux of negative density perturbations and the averaged turbulent advection flux of positive density perturbations for the study of density exchanges in the body of a continuously released current propagating up a smooth plate it is important to note that the term entrainment is usually used in the context of gravity currents to signify the flux of ambient fluid incorporated into the current stream as introduced by turner 1986 and subsequently causes its dilution whereas odier et al 2012 use the terms entrainment and detrainment to distinguish the contributions to the local turbulent density transport for clarity ce and cd will be refered herein as the local turbulent entrainment and local turbulent detrainment parameters respectively fig 10 a b show the distribution of ce and cd at t 29 1 the black lines represent the mixing layer s thresholds defined in terms of vorticity by ωz 0 at the bottom and ωz 0 05 corresponding to approximately 5 of the vorticity scale ub h 2 where the vorticity vanishes at the upper threshold krug et al 2015 chang and lee 2017 and the blue lines track the parameters vertical peaks along the current the detrainment cd is seen to lie close to the upper boundary of the mixing layer regardless of the distance from the front whereas the entrainment ce is mainly concentrated in the centre of the mixing layer their corresponding peaks are predicted at approximately 70 and 55 of the mixing layer comparing this observation to the pre multiplied spectra suggests that the local turbulent detrainment is mainly due to the large scale low wavenumber structures whereas the local turbulent entrainment is a consequence of the energetic smaller scales of turbulence observed at the centre of the mixing layer nevertheless this last conclusion does not exactly match with the results reported by odier et al 2012 who identified local turbulent entrainment and detrainment further inside the mixing layer with peaks located at respectively 35 and 60 of the mixing layer s depth no real explanation on the origin of this deviation can be given based only on the present dataset though the difference in the mechanism used to generate the currents lock released current against continuously supplied current for odier et al 2012 questions on the potential influence of initial stratification on the damping of the large scale structures and the local distribution of energy along the energy spectra in the mixing layer introducing the depth averaging operator as d fig 11 a presents the evolution of the depth averaged local turbulent entrainment and detrainment parameters ce d and cd d along the current the values at t 2 29 1 are compared to statistics computed from data recorded at t 3 50 during the inertial phase two regions are identified corresponding to the two compositional parts of the current the turbulent density transport flux increases rapidly until peaking at the head s limit from that point the parameters decrease exponentially local turbulent detrainment and entrainment are of similar orders of magnitude at the two time steps despite a slight dominance of detrainment over entrainment as reported by odier et al 2012 continuously supplied gravity currents are in some degrees analogous to perpetually slumping currents which allows comparison of the computed ce d and cd d to the experimental results presented by odier et al 2012 thereby at the end of the slumping phase t 2 29 1 the parameters show values varying between 1 10 4 in the body and 1 2 10 3 at the head s limit approximately one order of magnitude smaller than the values c e d u 0 δ ρ 0 1 7 10 3 and c d d u 0 δ ρ 0 2 1 10 3 obtained from depth averaging the datasets presented by odier et al 2012 and non dimensionalizing the resulting values using the constant dense fluid injection velocity and the density difference used for the experimental setup u 0 7 cm s and δρ 0 2 6 g l it is important to note that the choice of the characteristic velocity used to compute the scaled parameters from odier et al 2012 is not straightforward since both the initial momentum due to the release of light fluid at the nozzle and the buoyant forces at the front contribute to the motion of the current scaling using the buoyant velocity ub gh δρ 0 ρ s 0 5 3 6 cm s 0 5u 0 with h 7cm the injection nozzle height and ρ s 1000 g l the density of the ambient fluid gives the values c e d u b δ ρ 0 3 2 10 3 and c d d u b δ ρ 0 4 2 10 3 which remain of the same order of magnitude the importance of the head on the dilution of unsteady gravity currents has been noted in the literature fragoso et al 2013 kneller et al 1999 mcelwaine 2005 based on three dimensional les simulations of a lock exchange current bhaganagar 2017 concluded that the body and tail have a weak influence on the current s dilution after observing the limited increase of the bulk entrainment over the current s propagation in comparison to the rapid expansion of the current in the rear of the head the concentration of turbulent density transport at the front of the current is here confirmed by the exponential decrease of ce d and cd d starting from the limit of the head xh 16 and 29 at t 1 29 1 and t 2 50 the rate of decrease of the exponential laws can be better identified on fig 11b which presents ce d and cd d plotted using a vertical semi log scale and the horizontal coordinate xf x lc normalised by the current s length lc table 2 for lc hence the transport fluxes decrease following the laws 7 2 c 29 1 d x 1 65 10 3 exp 9 04 x h x l c 1 10 4 7 3 c 50 d x 5 10 4 exp 8 97 x h x l c 2 10 5 interestingly the rate of decrease for the exponentials is similar at the two time steps exp 9 xh x lc when normalised by the length of the current similarly to the front position and velocity the previous observations suggest the existence of a scaling law describing the decay of the transport flux during the inertial phase this assumption is supported by the good match of ce d and cd d at t 2 29 1 with 5 ce d and 5 cd d at t 3 50 fig 11b inset large scale geophysical currents are often large volume underflows and present high body to head s length aspect ratio thereby most models used to represent in situ gravity currents neglect the influence of the head on the current s mixing dynamics ungarish 2009 to discuss the validity of this assumption for the present case we introduce the normalised cumulative local turbulent entrainment parameters at each position x from the front i c e and i c d as 7 4 i c e x x x f c e d x d x l x l h x f c e d x d x i c d x x x f c d d x d x l x l h x f c d d x d x where the denominator corresponds to the total depth averaged local turbulent entrainment detrainment along the current whereas the numerator represents the contribution between the front and the position x table 2 presents the values of the cumulative local turbulent entrainment parameters at the limit of the head xh at t 2 29 1 and t 3 50 at both time steps the head holds a substantial portion of the total turbulent density transport in the current approximately 25 which cannot be neglected a rapid estimate of the current s length needed to neglect the role of the head can be calculated using the previously identified correlations during the slumping phase the total transport flux in the current is first decomposed into the sum of the head and body contributions 7 5 i c t o t i c h i c b the contribution of the body is derived by integrating relation 7 2 over the body s length lb lc lh with lh the length of the head leading to relation 7 6 7 6 i c b x 0 00183 l c 1 exp 9 04 l c l h l c 1 10 4 l c l h the head is considered negligible if it holds less than a portion α of the total flux e g ic h α ic tot this condition together with 7 5 and 7 6 requires the current s length estimate to respect eq 7 7 7 7 0 00183 l c 1 exp 9 04 l c e s t l h l c 1 10 4 l c e s t l h 1 α 1 i c h 0 7 7 is solved numerically for 0 01 α 0 25 and the solutions are presented on fig 12 the estimate lc est decreases as 4 7α 1 07 for α 0 25 corresponding to the present case the estimate lc est 19 96 compares well with the length of the current before the transport flux collapses in the tail l 20 therefore for the head to represent less than 5 of the total turbulent density transport the estimate gives a minimum length lc est 120 that is more than 60 lock height knowing the constant front froude number during the slumping phase frf 0 46 see section 3 the time necessary for the current to travel the distance lc est under slumping conditions scales with δ t l c e s t 2 f r f 180 similarly for a threshold set at 1 the estimate gives a minimum lc est 625 corresponding to more than 300 lock height and a travel time scaling with δt 960 during the slumping phase 7 1 eddy viscosity diffusivity modelling geophysical flows are commonly modelled using an eddy viscosity diffusivity formulation for the reynolds transport fluxes 7 8 v k ε γ t m y with the eddy diffusivity written γt in this section two parameterizations of γt are compared the k ε model is a popular parameterization which relates γt to an eddy viscosity νt using a turbulent schmidt number sct νt γt with νt defined as 7 9 ν t c m k 2 ε v m k ε can then be written as 7 10 v k ε c m s c t k 2 ε m y the value of the model constants can be tuned for particular problems the standard values found from calibration to free stream decay and boundary layers are cm 0 09 and sct 0 9 pope 2000 in the present case the standard constants predict values of v m k ε two orders of magnitude higher than expected therefore the model constants are modified to satisfy cm sct 0 001 and fig 13 shows the resulting vertical profiles of v m and v m k ε at three positions along the current the results show a good representation of the distribution of the transport flux over the depth of the current the deviation of the model in the near wall region in the body is due to overpredictions of νt and γt characteristic of the k ε model in near wall regions geophysical and laboratory scale datasets rarely have access to the cross correlations necessary for the computations of the dissipation flux therefore simpler parameterizations have been presented to correlate v m with the behaviour of the first order flow quantities mean velocity and density odier et al 2009 proposed a simple formulation for v m using a constant prandtl mixing length formulation of the turbulent fluxes to study turbulent transport in a continuously released gravity current propagating along a flat plate v m is expressed as the product of the vertical density and velocity gradient with the square of a mixing length lρ characteristic of the mixing layer s section 7 11 v l ρ l ρ m y u y the negative sign in the formulation of odier et al 2009 disappears here since the vertical axis points downward in odier et al 2009 v m lρ is presented in fig 13 alongside v m and v m k ε the value of lρ is carefully chosen at the three positions to provide the best fit and is set to 0 0761 0 0485 and 0 0553 at x 4 10 and 16 respectively the performances of the mixing length model are comparable or better than the k ε model however the problem with the mixing length model is determining the value of lρ assuming that shear is dominant over stratification for low richardson number ri odier et al 2012 deduced experimentally a linear relation between lρ and the shear length scale ls as 7 12 l ρ 0 7 0 03 l s l s ε u y 3 the relation was obtained from a series of continuously released upward currents propagating along a plate of bulk richardson numbers in the range 0 2 ri 1 4 where r i g h δ ρ ρ 0 u 2 with δρ the density difference between the inflow and the ambient fluid u the inflow velocity and h the inflow nozzle height in the present configuration 7 12 gives inconsistent results for v m several orders of magnitude higher than the resolved value these discrepancies are likely to be due to the rapid increase of the bulk richardson number in the wake of the head using the maximum velocity inside the current as velocity scale u and the density difference between the wall and the ambience as δρ the distribution of ri along the current is computed and presented in fig 14 at t 29 1 and 50 as expected the overall ri remains greater than the range studied by odier et al 2012 and quickly increases in the wake of the head such high values of ri suggest the dominance of stratification over shear in the mixing layer with increasing distance from the front nevertheless the actual competition between shear and stratification in the wake of the head is more complex than is depicted by ri indeed close inspection of the depth averaged local flux and gradient richardson numbers rif and rig as presented in pelmard et al 2020 indicates that rather than the dominance of stratification over shear the flow develops an equilibrium state where the destruction of turbulence due to irreversible buoyant mixing becomes a constant fraction of the shear production of turbulence rif 0 28 for the present simulation further observations of pelmard et al 2020 also led to the conclusion that the disappearance of the kelvin helmholtz billows and the subsequent suppression of ambient fluid entrainment appears to coincide with the stabilisation of the depth averaged r i g m y u y 2 to a constant value dependent on the propagation time in the far rear of the current based on these conclusions it is here infered that the bulk richardson number ri does not appear to be a suitable parameter to qualify the evolution of turbulence transport for the present unsteady gravity current in agreement with the experimental conclusions of strang and fernando 2001 for stratified shear layers over a broad range of bulk richardson numbers 8 conclusions a laboratory scale turbulent gravity current of reynolds number reb 60 000 has been studied using les to assess the evolution of turbulent density transport along the current the development of turbulence in the gravity current s mixing layer is quantified reynolds stresses have been computed from ensemble averaging 200 simulations together with span averaging of the flow and are presented at a time step corresponding to the late stage of the slumping phase of the current the overall features of the modelled flow agree well with previous experimental and numerical observations for different types of flows the front propagation agrees with the analytical estimates reported by cantero et al cantero et al 2007 the turbulence spectra and pre multiplied spectra show that the model resolves the most energetic modes of turbulence in the mixing layer however a refined mesh is required to accurately represent the energetic spanwise modes at the nose which seem to extend farther than the cut off wavenumber used here the spectral description of the flow shows that the large scale structures mainly influence the turbulence density transport in the mixing layer close to the interface with the ambient fluid whereas the smaller structures are confined further inside the mixing layer acting to homogenise the density field close inspection of the vertical transport fluxes suggests that local turbulent entrainment downward transport of low density fluid in denser fluid concentrated close to the centre of the mixing layer is mainly driven by small scale structures whereas local turbulent detrainment upward transport of dense fluid in lower density fluid observed close to the interface with the ambient fluid is mainly due to the largest turbulent structures more work is needed to study both the local turbulent entrainment and detrainment with the help of turbulence spectra in the frequency domain further analysis of the evolution of the depth averaged vertical transport fluxes show that the turbulent density transport peaks at the limit of the head before decreasing exponentially in the body this demonstrates the important role the head of unsteady gravity currents has in mixing processes representing approximately 25 of the total mixing potential of the current over the propagation period investigated an estimate of the length of the current necessary to neglect the role of the head on the overall current s inner turbulent density transport is calculated based on the exponential decay of the transport flux during the slumping we show that for the present flow conditions the current would need to be more than 60 lock heights long for the turbulent density transport occurring in the head to be less than 5 of the total turbulent density transport in the current s mixing layer this observation is important to ensure accurate modelling of geophysical gravity current processes credit authorship contribution statement joë pelmard conceptualization methodology software formal analysis investigation data curation writing original draft visualization stuart norris methodology software validation writing review editing supervision heide friedrich writing review editing supervision funding acquisition declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgement the analysis was partly undertaken using a high performance computing hpc platform provided by the new zealand escience infrastructure nesi consortium this research did not receive any specific grant from funding agencies in the public commercial or not for profit sectors supplementary materials supplementary material associated with this article can be found in the online version at doi 10 1016 j advwatres 2021 103963 appendix supplementary materials image application 1 
276,arya and paris developed a model in 1981 to predict the water retention curve of a soil from the grain size distribution and the porosity this model was very convenient due to the simplicity of the input parameters and because experimental measures are expensive and with no lack of uncertainties the model was based on very simple equations but the need to discretize the grain size distribution restricted its usability a new model is presented preserving the physical meaning but solving this dependency and other issues and allowing a continuous expression that was not possible with the original model the new model is very convenient and practical as expressions are easy to implement and its predictions depend on only one parameter for which some recommended values are also included limitations and uncertainties of the model are also discussed graphical abstract image graphical abstract keywords water retention curve soil water characteristic curve pore size distribution arya and paris acap 1 introduction water content has a major influence on the response of soils many soil related construction and infrastructure problems are directly or indirectly related to water presence so that understanding the factors that link water to soil behaviour is vital in general near surface soils are in a variable saturated state which means that sometimes all the pores are filled by the wetting fluid water the saturated state or partially filled the unsaturated state in the latter case due to capillary forces there is a connection between the suction the difference between water pressure with air pressure and the water content that is defined by the soil water retention curve hereinafter referred to as wrc that may be considered as a constituent property of a soil obtaining the wrc in the laboratory is difficult expensive and time consuming chapuis et al 2015 also it usually leads to different kinds of uncertainties common to the experimental process zapata et al 2000 for that reason several approaches have been proposed to infer the wrc from other inexpensive properties of the soil the methods to estimate wrc can be divided into three categories buczko and gerke 2005 fredlund et al 2012 1 direct stochastic estimation of water contents at various soil suction points 2 stochastic or empirical estimation of soil parameters using some algebraic functions for the wrc of the soil and 3 physic empirical models some authors group the first two categories into a more general empirically based class and in general there is not a pure empirically based or a pure physically based category but some mixture of both haverkamp et al 2002 within any of those categories can be included the large set of pedotransfer functions ptfs with which to infer desired water retention curves estimands from more simple basic soil properties predictors van looy et al 2017 this ptf term was first defined as translating data that we have into data we need but do not have by bouma 1989 and in most cases the ptfs are simple empirical expressions fitted to the contents of specialized databases like unsoda leij et al 1996 grizzly haverkamp et al 1997 hypres wösten et al 1999 or eu hydi weynants et al 2013 which include the required estimands van looy et al 2017 the number of purely empirical ptfs to infer the wrc from basic properties is substantial and several reviews are available patil and singh 2016 van looy et al 2017 vereecken et al 2010 wösten et al 2001 empirically based methods vary and can extend the original concept of ptfs methods based on simple look up tables regression techniques neural networks and other machine learning techniques decision and regression trees random forests etc empirical methods are data driven models which usually elicit a large number of parameters with no physical meaning and which are fitted to specific data their applicability is usually limited to the dataset to avoid extrapolation outside the data domain on the other hand physically based models usually include fewer parameters and are derived from physical concepts the number of parameters is reduced as the water retention curve expression is usually derived from expected physical behaviour sometimes some parameters need to be empirically defined to include some unknowns and assumptions i e in physico empirical models the first approach to obtain the wrc based on physical principles is due to childs 1940 who applied the capillary concept in which the pores are simplified as a bundle of interconnected capillary tubes so that when wetting the smaller tubes fill first due to higher suctions other more complex physical models consider different packings of spheres assouline and rouault 1997 chan and govindaraju 2004 or probabilistic expressions for pore throats based on packing of spheres jaafar and likos 2014 zhai et al 2020 fractal models chan and govindaraju 2004 perrier et al 1996 percolation methods chatzis and dullien 1977 diaz et al 1987 dullien et al 1976 pore networks defined by prismatic throats and spherical bodies ahrenholz et al 2008 blunt et al 2002 mahabadi et al 2016 vogel 2000 xiong et al 2016 etc these methods relays on pure geometrical interpretations therefore it seems evident that the water retention curve definition is intimately linked to soil geometry and pore structure thus the gsd and the porosity index can be expected to heavily influence the inferred wrc this expectation is strengthened in that almost all pedo transfer functions depend on the gsd and optionally on the porosity index or on the equivalent void ratio or density physically based models can be accurate but difficult to implement or simpler and less accurate but more practical arya et al 2008 1999 arya and paris 1981 haverkamp and parlange 1986 mishra et al 1989 mohammadi and vanclooster 2011 nimmo et al 2007 one of these simple models that can be considered as the first model to obtain the wrc from the gsd and porosity index based on physical concepts and with only one empirical parameter is the model created by arya and paris 1981 hereinafter referred to as the ap81 model who made good use of the observed similarities between the shape of the psd and the gsd other models also considered this similarity concept arya et al 2003 gupta and ewing 1989 gupta et al 2004 haverkamp and parlange 1986 mishra et al 1989 mohammadi and vanclooster 2011 nimmo et al 2007 the main advantage of the ap81 model was its simplicity with its use of gsd and void ratio as inputs and with only one parameter the scaling parameter α for this reason ap81 became the most applied method that relates pore scale to grain size based on physical concepts buczko and gerke 2005 despite that shortly after the publication of the model some inconveniences were detected by haverkamp and parlange 1982 and later by haverkamp et al 2002 and nimmo et al 2007 other issues are also detected in the present paper these problems are listed later in section 2 table 1 further insights into the scaling parameter α were included in arya et al 1999 hereinafter referred as ap99 model and a modification of the model was included in arya et al 2008 hereinafter referred to as the ap08 model however most of the problems remained arya and dierolf 1992 modified the original model in this case the pore length was assumed to be equal to a parameter α for every grain size fraction nevertheless because of their theoretical basis ap models became of real interest in wrc prediction and are included in a large number of publications arya et al 1982 applied the ap81 model to a large dataset of 181 new jersey soil horizons gupta and ewing 1989 mixed the arya and paris approach with a packing model to differentiate between inter and intra aggregate pore space mishra et al 1989 applied a modified version of the arya and paris model to estimate uncertainties of the van genuchten parameters basile and d urso 1997 performed a calibration of the ap model to increase the performance on clay loamy soils fredlund et al 1997 presented a method to estimate the wrc and although it did not apply the ap model the conceptual idea was very similar dividing the gsd to combine specific wrc to each division arya et al 2003 applied the estimation of the psd by arya and paris approach to assess the hydraulic conductivity of soils gupta et al 2004 applied the ap model to estimate the water content on roadbed materials buczko and gerke 2005 applied the ap model to coarse mine soil material and they concluded the model mispredicted water content at high suctions and that the closest fits for the α parameter was a variable expression depending on particle size vaz et al 2005 evaluated the ap model for brazilian soil types and propose a much smaller α parameter than in the original ap81 model and a variable α parameter depending on the water content nimmo et al 2007 compared several physical models including the arya and paris approach concluding that most of them shares similar concepts and a general framework they included two continuous modified versions of the arya and paris model and mohammadi and vanclooster 2011 perform a nearly similar approach to the ap model considering different grain assemblages which result in a very simple equation prevedello and loyola 2002 developed the splintex model this model applies the ap model to a measured grain size distribution with a scaling factor α defined by the ap81 and ap99 models that is corrected to match a measured point in the wrc or to an estimated water content at a specific point of the wrc by using an empirical expression the output of the model are the parameters of the van genuchten expression fitted to the resulting wrc with the ap model there are two versions of the model in the first one the saturated water content can be estimated equal to the porosity or estimated empirically from bulk and solid densities and no measured point of the wrc is given splintex ptf1 and in the second version the saturated water content and a point of the wrc are inputs to the model splintex ptf2 this model has been evaluated in further papers with satisfactory results da silva et al 2017 huf dos reis et al 2018 and the software implemented in c resulting in the version 2 0 da silva et al 2020 the splintex model however is still based on the original ap81 and ap99 models and therefore shares their limitations ap models depend on a particular discretization of the gsd but a continuous form would be more practical and permit a more convenient implementation of the ap concept nimmo et al 2007 tried to obtain a direct continuous form from the discrete ap81 model by transforming the discrete intervals into differential intervals and integrating but the expression degenerate to 0 or when the scaling parameter α is diferent to 1 to avoid this issue they modified some terms of the expression and built the cneap model continuous near equivalent of the ap model nevertheless several problems of the ap model remained unresolved the purpose of the present paper is to build a closed continuous expression of the wrc or psd as a function of the gsd and the porosity by performing slight modifications to the original ap81 model so as to overcome the difficulties identified this new modified arya and paris model depends on only one parameter β parameter β is chosen so as to distinguish it from the original parameter α this new parameter will have much less variation across the full suction range than in the original ap81 model the new model results in a simple expression that relates the grain sizes in the gsd to the pore sizes in the psd without the need of discretization and some values or empirical expressions for parameter β will be recommended also expressions to relate previous models with the new parameter β will be given the new model slightly increases the accuracy of original ap81 model for most simple definitions of parameter β but substantially increases the accuracy when β is defined by an empirical expression unlike other models that consider capillary forces and adhesion aubertin et al 2003 kovács 1981 qiao et al 2021 ap based models rely on the capillarity concept only therefore their predictions are limited to capillary based water retention and the water retention due to adsorption is not considered adsorption has more influence the smaller the grains aubertin et al 2003 chan and govindaraju 2004 chang et al 2019 lu 2016 mohammadi and meskini vishkaee 2012 this model does not consider either the water retention in the form of pendular rings or the aggregation of clay particles due to chemical interactions adsorption and pendular rings could be the cause of the uncertainties detected on the samples with clay content and for high suctions chang et al 2019 meskini vishkaee et al 2014 mohammadi and meskini vishkaee 2012 this is partially solved by using empirical expressions of the β parameter depending on the grain size or the pore size therefore the acap model is especially suitable for soils with small clay content and for the mid range of the water retention curve 2 background the arya and paris model 2 1 original arya and paris 1981 model noticing the general similarities between gsd curves and the psd curves arya and paris 1981 assumed that every pore size in the psd corresponded with a particular grain size on the gsd assuming in this way that the fractions of the largest pores were directly related to fractions of largest grains and the same with each successive smaller fraction the gsd was divided into several particle size fractions δd g i with a mean particle size d g i spherical particles being assumed all fractions were assumed to have the same particle density and the same void ratio e fig 1 shows a diagrammatically the process followed by the arya and paris based models for each fraction i in the discretization of the gsd the mean particle size is d g i and the particles have a volume δv g i and because the same void ratio is assumed for all fractions the pore volume δv p i is equal to the void ratio multiplied by the particle volume e δv g i the ap81 model considered that the particles are spherical and the pores are constituted by cylindrical tubes that in an ideal soil and for each fraction i will have a length equal to the number of particles in the fraction δni multiplied by the grain size d g i i e δni particles placed in a line would have the same overall dimension as the tube length but the ap81 model recognises that in general the pore length will be different to the one assumed for the ideal soil so its value is assumed to be equal to the number of particles powered by an scaling parameter α i e considering a different number δ n i α of virtual particles multiplied by the particle size this different pore length is then used to obtain the pore volume of the fraction δv p i e δv g i and the required pore size is then obtained reaching the final expression of the ap81 model in eq 1 the full formulation of the model is included in appendix b arya and paris 1981 proposed a constant value of α 1 38 1 d p i d g i 2 e δ n i 1 α 3 once the psd is estimated the wrc can be calculated by applying the youngs laplace equation to the pores eq 2 where ψ is the suction ts the surface tension φ the liquid solid contact angle ρ w the liquid density and g the gravity ap models assume that larger pores drain before the smaller pores due to their lower suctions which neglects an important retention mechanism that causes hysteresis and some residual water content ap based methods do not consider hysteresis 2 d p 4 t s c o s φ ρ w g ψ 2 2 problems of the original arya and paris 1981 model from a direct observation of eq 1 it can be easily noted that the predicted pore size for each fraction d p i depends by one side on the particular discretization selected as wider intervals of the gsd will result in larger numbers of grains δni and as a consequence a larger pore size for the same mean grain size of the discretization and by the other side if a particular discretization is selected then the pore size for each fraction will depend on the total sample mass as the greater mass of the sample the more grains there will be in each discretization and therefore a higher pore size in the psd for the same grain size in the gsd the total mass problem was fixed in the same paper arya and paris 1981 by establishing the sample mass to a notional 1 gram the discretization problem was noticed soon after by haverkamp and parlange 1982 who emphasized the sensitivity of the pore grain size relationship to the way in which the gsd was subdivided furthermore the fractions selected by the authors were not clear arya et al 1999 fixed the discretization problem by fixing the discretization of the gsd into 20 fractions at diameters of 1 2 3 4 10 20 30 40 50 70 100 150 200 300 400 600 800 1000 1500 and 2000 μm arya and dierolf 1992 ap92 model noticed that the results were highly sensitive to parameter α and also agreed with haverkamp and parlange 1982 considerations proposing an alternative approach considering now that pore length associated with each particle were fixed by a parameter α for which they propose an average value of 0 911 cm with low variability ranging from 0 3 to 1 5 cm this nearly constant pore length per particle does not have a real physical meaning as it is unreasonably long for very small particles nimmo et al 2007 in the ap99 model arya et al 1999 parameter α was further studied by comparing the real number of particles δni for each size fraction directly obtained from the gsd with the number of particles δ n i α needed to obtain the pore length calculated from measured pore size distributions they proposed a variable value for parameter α depending on the pore size however this parameter still depends on the number of particles and therefore on the discretization done and the total sample mass following a similar approach than in the ap92 model arya et al 2008 proposed a further modification to the ap99 model herein this will be named the ap08 model arguing that the pore diameter was highly sensitive to the two parameters a and b in this case they noted that instead of comparing the number of particles δni in each fraction of the gsd with the number of particles δ n i α required to get the real pore length it was better to compare the real pore length l p i with the ideal configuration of particles l p i evaluated directly from the gsd they noted that these two values of the pore length could be related by a linear regression in a log log plot the approach to get the ideal length of pores is similar to that used in the ap 81 model and the computed pore length in the ideal configuration is now calibrated to the real measured pore length l p i by an empirical expression depending on the ideal pore length l p i and two parameters still the ideal pore length and also the final expression to get the psd depends on the number of particles and therefore on the discretization performed on the gsd and the total sample mass in this ap08 model a different discretization other than previous models was selected with further insights into the eq 1 it can be noticed that the ap81 model in this form cannot be directly converted into a continuous form it needs a discrete division of the gsd if the gsd is discretized into infinite differential divisions then the number of particles δni tends to 0 when α is higher than 1 or to infinity if α is lower than 1 giving as a result values of the pore size equal to 0 or infinity respectively for each fraction of the psd this problem was detected by nimmo et al 2007 who included a slight modification on the ap81 model to create the continuous nearly equivalent form of the ap81 model cneap model that is now described it would be advantageous to obtain a continuous expression in which a given continuous expression of the gsd is used to compute a continuous expression for the psd this is convenient for several reasons one reason is that a continuous form of the grain size distribution lead to a continuous form of the pore size distribution that can be easily included in analytical calculations inversely an algebraic continuous form for the water retention curve i e van genuchten 1980 or fredlund et al 1994 leads to a continuous expression of the gsd also depending on those parameters that could be directly fitted to the measured grain size distribution it will be possible to directly obtain van genuchten or fredlund and xing parameters additionally continuous expression are easily implemented in computer algorithms and in the particular case of ap models no dependence of the results on the selected discretization exist with this aim nimmo et al 2007 developed a general framework following the same principles as in the ap models in this case and to be able to obtain the continuous expression nimmo et al 2007 discretized the gsd not in the same way as in the ap models but in differential intervals from dg to dg ddg they noted that if ddg tends to 0 then ψ d degenerates to ψ d 0 for α 1 and to ψ for α 1 and to solve this inconsistency they changed the values for the differential interval ddg such that ddg 2 3 dg obtaining a near equivalent continuous expression of the ap81 model for the wrc nimmo et al 2007 called this the continuous near equivalent aria and paris model cneap model by including the mass of 1g with w0 g and the definition of the gsd by its distribution function f v g d g nimmo et al s expression now does not depend on the way of discretizing the gsd nor on the total sample mass nevertheless the change to ddg 2 3 dg does not have a real physical explanation the substitution has been done to avoid the degeneration of the continuous expression for the ap81 model two issues can be noticed in the cneap model a minor one is that this expression is not invertible in general due to f v g d g therefore a closed expression for the water content from the suction θ ψ in general cannot be obtained another more relevant issue is that the cneap expression represents a continuous but sometimes non monotonic relationship between suction ψ in the wrc and particle size dg in the gsd which has no physical meaning as the wrc needs to be always monotonically decreasing this is noticed especially on gap graded soils as the direct application of the cneap model leads no a non monotonic wrc all these issues are summarized in table 1 and will be overcome with the proposed new acap model 3 theory alternative continuous form for ap model the acap model 3 1 formulation of the acap model in this section a modified continuous version of the original ap81 model will be developed by following the same concept and formulation than the original ap81 model but taking special care in selecting the scaling parameter and discretization to overcome all the issues included in table 1 the same assumptions as in the original ap81 model will be considered 1 there is a one to one association between the grain size dg in the gsd with the pore size dp in the psd and with the suction ψ in the wrc 2 void ratio and particle density remain uniform for every possible discretization of the gsd 3 particles are assumed to behave as if they have a spherical shape 4 the capillary model is based on an assumed cylindrical shape of the pores with a diameter of dp 5 pore diameter dp and suction ψ are related by the young laplace capillary equation given by eq 2 to overcome the problem in the original ap81 model of its dependence on the number of particles in the fraction which depends the size of the fraction this paper no longer applies the scaling parameter α to the number of particles in the fraction as in eq 1 but to the intensity of spheres in this way in this acap model in order to estimate the real pore length the real intensity of particles will be raised by a scaling parameter named β to distinguish it from α as in the original models and this will result in a change in the number of spheres but will maintain the particle volume in the virtual fraction see fig 2 in addition note that by assuming that the pores are constituted by a bundle of capillary tubes and that every grain size d g i is associated with a pore diameter d p i then the link between the grain geometry and the pore geometry is purely geometrical hence the model should be scale invariant if we reduce the geometry of the soil by scaling its geometry the pore geometry will be scaled in the same proportion as a result it seems a good idea to express the new model non dimensionally by dividing by a reference factor with units of length d0 therefore volumes will be scaled by dividing by d03 and the number of particles won t change furthermore as the connection is purely geometrical it is more appropriate to work with volumes of grains and pores instead of mass so from this point onwards the gsd will be referred as gsd in terms of volume instead of the usual gsd in terms of mass the relation between both of them is normally trivial if the grain density for each grain size fraction is known the intensity of particles for the fraction i is the number of particles per volume δni δv g i d03 and this value is independent of the size of the fraction selected the number of particles can be expressed as the intensity multiplied by the volume δni δni δv g i d03 δv g i d03 then the number of virtual particles to get the predicted length of the pores in the new model will be given by eq 4 where sur index means the number of particles in the virtual geometry after applying the scaling parameter β fig 2 helps to visualize the differences between acap model approach centre and ap models right the real number of particles and the cylindrical tubes in the ideal soil left are transformed to a virtual arrangement that represent the predicted pore length and diameter in the acap model centre the volume of the particles does not change in the fraction when raising the intensity of particles to the power β but the pore length does change and in the ap models right the volume of particles and their number changes when raising the number of particles to the power α although the pore volume remains equal to the ideal state the approach to get the pore length and diameters varies in the ap models this length depends on the ideal number of particles selected and therefore on the discretization performed which is not the case of the acap model 3 δ n i δ n i δ v g i β δ v g i the number of virtual particles in the scaled soil is then expressed by eq 4 the scaled volume of a number δ n i of virtual spheres with diameter d g i is given by eq 5 where the sur index means that this applies to virtual geometry after applying the scaling parameter β and the scaled volume with the number δni of real particles of diameter d g i is given by eq 6 the scaled volume of real particles and virtual particles in each fraction i is the same and equal to δv g i d03 4 δ n i δ n i δ v g i d 0 3 β δ v g i d 0 3 5 δ v g i d 0 3 δ n i π 6 d g i d 0 3 6 δ v g i d 0 3 δ n i π 6 d g i d 0 3 by combining eqs 4 6 the diameter of the virtual spheres is given by eq 7 7 d g i π 6 β 1 3 d g i d 0 β d 0 the non dimensional predicted length for the pores l p i d 0 per unit of non dimensional volume δ v g i d 0 3 is given by eq 8 8 l p i d 0 δ v g i d 0 3 δ n i d g i d 0 δ v g i d 0 3 π 6 1 2 β 3 d g i d 0 2 β considering a uniform void ratio e the scaled volume of the pores is given by eq 9 as the scaled cylindrical pores have a non dimensional length l p i d 0 and a scaled diameter d p i d0 the scaled pore volume can also be expressed by eq 10 the volume of a cylinder 9 δ v p i d 0 3 e δ v g i d 0 3 10 δ v p i d 0 3 π 4 l p i d 0 d p i d 0 2 substituting the non dimensional pore length l p i d 0 from eq 8 into eq 10 the non dimensional volume of the pores can also be expressed by eq 11 11 δ v p i d 0 3 2 2 β 5 3 3 2 β 1 3 π 2 2 β 3 d g i d 0 2 β d p d 0 2 δ v g i d 0 3 and combining both expressions for the non dimensional volume of the pores eqs 9 and 11 the direct connection between the grain size d g i in the gsd and the pore size d p i in the psd is given by eq 12 and its inverse by eq 13 eq 12 then becomes the replacement of eq 1 in the ap81 model and also becomes a very simple expression relating each point d g i f v g i in the gsd with one point d p i f v p i in the psd being f v p i f v g i 12 d p i d 0 e 3 π 2 β 2 2 2 β 5 3 2 β 1 1 6 d g i d 0 β 13 d g i d 0 2 2 β 5 3 2 β 1 e 3 π 2 β 2 1 6 β d p i d 0 1 β first it can be noted that the new expression eq 12 is not discrete as the connection between pore size and grain size does not depend on any discrete term of the gsd in this way eq 12 can be expressed without the i subindexes second it can be noted that eq 12 is monotonically increasing in d p i when the grain size d g i is monotonically increasing for all positive and constant β values therefore if the gsd is expressed by the continuous function f v p d g as the cummulative distribution of the volumes of grain sizes below dg then the psd as the cumulative distribution f v p d p of the volume of pores below d p d is reached by simply including the expression dg dp from eq 12 in the continuous expression of the gsd f v p d p f v g d g d p also the wrc is obtained by simply including the capillary equation eq 2 into the psd s ψ f v g d g d p ψ thus the volumetric pore size distribution is obtained from the volumetric grain size distribution continuous function f v g d g as follows 14 f v p d p d pmin dp v p d p d d p d pmin dpmax v p d p d d p e d gmin dg v g d g d d g e d gmin dpmax v g d g d d g f v g d g d p f v g 2 2 β 5 3 2 β 1 e 3 π 2 β 2 1 6 β d p d 0 1 β the water retention curve is then obtained from the grain size distribution by eq 15 considering that the volumetric water content θ is related to the equivalent saturation by se θ θ res θ sat θ res where θ res is the irreducible water content and θ sat is the water content at saturation in this model equivalent saturation is the same as the total saturation s θ θ sat as θ res is considered equal to 0 as in the original ap models 15 s ψ d p ψ max d p ψ v p d p d d p d p ψ max d p ψ min v p d p d d p f v g 2 2 β 5 3 2 β 1 e 3 π 2 β 2 1 6 β 4 t s cos φ ρ w g ψ d 0 1 β from eqs 14 and 15 it can be also noted that there is a direct connection between the gsd psd and wrc for the same values of f v g v g v 0 g in the gsd f v p v p v 0 p in the psd and s from the wrc the curves only differ by a variable substitution using eqs 12 13 or the capillary equation eq 2 f v g f v p s fig 3 the connection between gsd psd and wrc is volumetric for that reason what it is really connected are the discrete volumes and only indirectly the particle sizes and pore sizes hence because the discretization of the gsd is done volumetrically a monotonically increasing grain size results in a monotonically increasing pore size and a monotonically decreasing wrc 3 2 comparison between scaling parameter β in the acap model with scaling parameters α by comparing dependence of the grain size d g i and the pore size d p i in the acap model as described in eqs 12 and 13 and using the capillary relationship eq 2 with the expressions in section 2 it is possible to calculate β from known values of α and vice versa if the discretization done in the ap models and the sample mass are known the expressions are included in table 2 4 materials and methods data from unsoda database leij et al 1996 has been selected to analyze measured values of the β parameter this database has 790 records of soils most of them includes the grain size distribution bulk density porosity and hydraulic properties of the soil the last of these includes water retention curves measured in the laboratory and in the field along with drying curves and some wetting curves the capillary approach does not consider hysteresis in the analysis beyond the change in the angle of contact water soil thus the analysis done in this paper considers only the drying water retention curves measured in the laboratory i e one must measure the water content of the soil for different suction values while drying the soil from a saturated state the wrcs from wetting and wrc in the field have been discarded in the present analysis unsoda records have been extended with data from some papers including information of gsd porosity and wrc for some soils zapata et al 2000 included 3 records a poorly graded sand sp a low plasticity silt ml and a high plasticity clay ch to extend the study to coarser materials data from singh et al 2006 has been included with 18 records of aggregate materials with sizes ranging from 0 0001 mm to 80 mm and finally data from chiapponi 2017 includes 14 records by mixing nearly uniform gradations of 4 different glass beads sizes with diameters between 0 5 mm and 3 mm the unsoda data have been filtered by selecting only the records that include grain size distributions and water retention with more than five points in the curve some records have been excluded because they did not have large series of water contents to properly fit the beta parameter records 1162 1163 1192 1193 1194 1213 2340 and 4575 also some records 3030 3031 3032 and 4760 whose gsd wasn t clear a record with only 4 points in the wrc data was also included 2217 as it was suitable to fit the beta parameter with this criterion a total of 393 records from the unsoda database were selected figure 4 if a value for porosity existed then the porosity took that value in other case the porosity was calculated from dry density of the soil or the saturated water content from the wrc this paper considers the capillary concept which is more appropriately linked with the mid size part of the wrc in which pores that are susceptible to capillary flow are considered as capillary tubes the original ap81 model considered that the residual water content was zero meaning that all voids are susceptible to capillary flow and also that all voids can become be fully saturated meaning that no air entrapment exists when the soil is fully saturated and hence the volumetric water content at saturation is equal to the porosity in general some air entrapment usually exists in measured wrcs so in the ap99 model a percentage of the porosity circa 90 was considered when defining the saturated water content although the real value depends on the method and time taken to saturate the sample the acap model considers that all the pores can be fully saturated with no air entrapment and that the residual saturation is equal to zero for very high suctions for fitting purposes only the points between the air entry value and the residual saturation are considered because the acap model aims to reproduce the wrc more accurately between these two points therefore the measured points between suction zero and suction at the air entry values and suction at the residual point to the totally dry soil are avoided in the fit as the acap model do not perform the prediction of the air entrapment nor residual saturation being both of them imposed including those measures in the regressions leads to higher errors in the middle zone of the wrc parameter β can be obtained from each point of the measured water retention curve by using eq 15 that relates the saturation with suction s ψ with a closed expression given the continuous gsd stated in volumetric terms f v g d g and the parameter β because of the direct link between the gsd f v g d g the psd f v p d p and the wrc from s ψ fig 3 the parameter β j can be obtained from each measured point j of the wrc by isolating it from eq 15 and getting a closed expression for this parameter at each point of the measured wrc eq 16 note that f v g 1 s j f v g 1 f v g d g j d g j where d g j is the grain size linked to the suction ψ j from the wrc such that d g j f v g 1 s ψ j 16 β j log 3 2 e 3 2 π 4 4 t s cos φ ρ w g ψ j d 0 3 log π 6 f v g 1 s ψ j d 0 3 log 3 2 e 3 2 π 4 4 t s cos φ ρ w g ψ j d 0 3 log π 6 d g i d 0 3 in a similar way if the pore size distribution is known for each measure j of the pore size distribution a parameter β j can be obtained by isolating its value from eq 14 and by knowing that the pore size d p j from the psd f v p d p it can be linked to the grain size d g j from the gsd f v g d g j by d g j f v g 1 s ψ j resulting in eq 17 17 β j log 3 2 e 3 2 π 4 d p j d 0 3 log π 6 f v g 1 s j d 0 3 log 3 2 e 3 2 π 4 d p j d 0 3 log π 6 d g j d 0 3 the scaling parameter β j is non dimensional but depends on the selected scale d0 because the intensity of particles depends on the scaling done to the volume volume varies in the scaled soil though not the number of particles eq 17 shows that the value of β is equal to the ratio of the logarithm of the volume of one scaled pore cylinder with scaled pore diameter d p i d0 and scaled pore length of 3 2 e 3 2 times the scaled pore diameter to the logarithm of the volume of one spherical particle with scaled grain size d g i d0 if a constant value of β is to be applied to a soil then its value can be easily obtained by linearly fitting these two volumes on a double logarithmic plot intercepting at the origin log 1 log 1 an example of such a plot is shown as fig 5 for the unsoda soil sample 1010 leij et al 1996 measured values of β are evaluated from the gsd void ratio and wrc by using eq 16 which will have different values depending on the length scale d0 considered five different values for d0 g as been considered being the first one which resulted in better regressions for the prediction of wrc d01 d 50 1e 3 this value implies that the soil is scaled in a way as if the median of the gsd is 1mm in size d0 in s i units of length d02 d 50 0 074e 3 in this case the median is scaled to 0 074mm d0 in s i units of length d03 d 50 0 002e 3 in this case the median is scaled to 0 002mm d0 in s i units of length d04 26501 3 the soil is scaled in a way that the total scaled volume will be 1 for a total sample of v g0 1g and considering d0 in s i units v g 0 d 0 4 3 1 2650 d 0 4 3 this approach will be near to the ap models d05 1m this means no scaling when using s i units in following sections only the results for d01 d 50 1e 3 will be shown results for other options can be consulted in the git hub repository https github com ivaninasetec acap the repository includes matlab code for the model acap for other ap based models ap 81 ap 99 ap 08 cneap other physic empirical models haverkamp and parlange 1986 mohammadi and vanclooster 2011 and some only empirical models rosetta schaap et al 2001 vereecken et al 1989 wösten et al 2001 and weynants et al 2009 the repository includes the input soil records applied in the present paper some scripts to generate the outputs of this paper and live scripts with some samples and the empirical fittings included in following sections the application of the acap model is very simple by using eq 12 each point of the gsd results in one point of the psd and by using the equation of youngs laplace eq 2 at one point of the wrc this yields the cumulated grain volume equal to the cumulated pore volume and equal to the saturation for the point using this equation requires a proper estimation of β four cases are considered a fixed constant β fix a constant β fix tex for each soil texture an empirical expression for a constant β fix emp depending on granulometry properties and porosity an empirical expression for β emp dp also depending on pore size in section 5 these four cases are calibrated against the whole dataset by using eq 15 and minimizing the error between the measured water content and the predicted water content for each of the measured points of the wrc 5 results the prediction capabilities and uncertainties of the acap model have been tested against the whole dataset described in section 4 as a first step expressions for the parameter β have been calibrated the simplest expression is a constant β fix whose best fit result in β fix 1 2042 median of the whole measured β i the distribution and uncertainty of β fix is given by a mean of 1 2415 and a standard deviation of 0 2322 if the texture of the soil is considered the accuracy can be increased in this case recommended values and uncertainties of β fix tex are included by table 3 and figure 6 accuracy can be increased by using an empirical expression for a constant β fix emp as given by eq 18 where log means natural logarithm and particle size is given in m 18 β f i x e m p 1 28798 0 32597 n 0 564173 log cu 0 51332 log d 10 0 50632 log d 50 0 033267 log d 80 0 00429 log d 10 log d 80 it is well known that ap models result in an underprediction of the water content at high suction ranges chang et al 2019 meskini vishkaee et al 2014 mohammadi and meskini vishkaee 2012 therefore a variable empirical expression of β emp depending on the pore size should increase the accuracy the best expression was found to be eq 19 this expression is non linear but once included in eq 12 the value of dp can be solved easily as a closed expression 19 β emp d p 0 554079 0 807073 β fix emp 0 067649 0 002852 β fix emp log d p predictions of the water content for each measured point on the wrc have been calculated by using eq 15 and the four proposed β parameters table 4 gives the coefficient of determination r 2 the root mean squared error rmse and the absolute mean error me between the measured and predicted volumetric water content results that indicates high accuracy of the model the prediction capabilities of acap model are also compared against the other physico empirical ap based models arya et al 2008 1999 arya and paris 1981 nimmo et al 2007 and splintex 2 0 da silva et al 2020 and with other physico empirical but not ap based models haverkamp and parlange 1986 mohammadi and vanclooster 2011 and are also compared against some only empirical and generally accepted pedotransfer functions schaap et al 2001 vereecken et al 1989 wösten et al 1999 in the case of the ap based models the parameters suggested in the source papers where selected the ap81 model includes the value of α 1 38 as proposed in arya and paris 1981 ap99 model includes a and b parameters from the source paper for the soil types to estimate α and a constant value α 1 38 for the other soil textures the ap08 model uses the values of the parameters c 0 233 and d 1 109 from arya et al 2008 to estimate α the cneap model uses the same α parameter as in the ap81 model for the splintex 2 0 model da silva et al 2017 2020 prevedello and loyola 2002 the splitex pft1 approach was selected in which saturated water content is considered equal to porosity first case or estimated second case more accurate results could be obtained if measured saturated water content and a measured point of the wrc is included in the model in that case the approach is named splitex pft2 however only splitex pft1 is included in the results presented here as the purpose is to compare predictions from gsd and porosity only in the physico empirical model by haverkamp five parameters are needed a1 a2 b1 b2 and b3 that are selected from the ones suggested in the source paper haverkamp and parlange 1986 mohammadi and vanclooster 2011 included another simple physico empirical model that as in the ap models is based on the assumption of the similarities between the shape of the gsd and the psd and also based on the sphere packing abstraction this model is based only on one parameter ξ meaning the estimation of the number of contacts between particles divided by 8 and its value is included in the source paper mohammadi and vanclooster 2011 within the very wide range of available only empirical pedotransfer functions patil and singh 2016 van looy et al 2017 vereecken et al 2010 wösten et al 2001 some of the more commonly applied have been selected for comparison with the acap approach the neural networks based model rosetta schaap et al 2001 is trained from the same unsoda database within all the proposed models the one called sccbd has been selected as it is the most suitable in this case as it needs as inputs information of the gsd soil textures and the bulk density of the soil intimately related to porosity the vereecken et al 1989 pedotransfer functions have been reported by several researchers as one of the most accurate ptfs weynants et al 2009 these include empirical expressions to estimate the van genuchten parameters from the gsd carbon content and bulk density they propose five models to define the parameter m of van genuchten and two levels two different ptf expressions in the first level the information of the gsd is based on its texture percentages of clay and silt while the second level includes expressions that use the grain volumes for selected grain size fractions of the gsd for comparison purposes the first level approach has been selected as the second one was found to perform badly outside the dataset to which it was initially fitted several belgium soil samples and specifically result in poor fits for the unsoda dataset weynants et al 2009 developed ptfs based on the vereecken et al 1989 dataset a set of 182 belgium soil samples and stated that they yield a similar goodness of fit as vereecken et al 1989 by using the large database of hydraulic properties of european soils hypres wösten et al 1999 with more than 5521 soil samples wösten et al 2001 fitted empirical expressions for the van genuchten parameters by expressions that depend on clay and silt content bulk density organic matter and whether the sample is top soil or subsoil to evaluate its prediction capabilities from gsd and porosity the organic matter is considered to be zero and the soil is considered to be sub soil not near the ground surface in this paper practical application of wösten et al 2001 implies that when the clay content silt content and organic matter are below 1 the expression needs to be modified supressing the clay silt and organic matter terms respectively table 4 summarizes the accuracy of the acap model when using the proposed fixed constant parameter β fix a fixed constant parameter β fix tex depending on soil texture table 3 an empirical constant parameter β fix emp eq 18 or an empirical variable parameter β emp depending on pore size eq 19 results are compared against the physico empirical ap based models arya et al 2008 1999 arya and paris 1981 nimmo et al 2007 da silva et al 2020 and those described earlier in this section haverkamp and parlange 1986 mohammadi and vanclooster 2011 schaap et al 2001 vereecken et al 1989 weynants et al 2009 wösten et al 1999 results indicates good water retention predictions in a range of rmse from 0 09 for a fixed β fix down to a 0 075 for a variable empirical β emp errors that are in the range of typical ptf accuracy as reported by wösten et al 2001 negative values in some empirical ptfs might be due to the high dependence their empirical expressions on the source dataset as an example wösten et al 2001 include log terms for clay silt and organic matter that result in large negative numbers when those terms are near zero similarly the physico empirical method by haverkamp and parlange has its the five parameters strongly linked with the source dataset fig 7 includes diagrams comparing the goodness of the fit between measured and predicted volumetric water content for three of the tested models against the sample data described in section 4 in particular it includes the results of acap model using empirical β emp eq 18 results from the ap81 model and results from the rosetta model using the sccbd model the accuracy of acap model is slightly better than rosetta and much better than original ap81 model fig 8 illustrates measured and predicted psds for a particular soil record code 1010 in unsoda database with acap model using β emp other ap based models the mohammadi physical model and the rosetta sccbd model 6 discussion a very simple relationship between the pore size and the grain size has been derived based on a modification of the original ap81 model arya and paris 1981 getting as a result eq 12 with this equation each point of the psd d p f v p is directly obtained from each point of the gsd d g f v g considering that for any particular point the cumulative grain volume per unit is equal to the cumulative pore volume per unit f v g f v p the pore size is proportional to a power of the grain size and depends on only one β parameter the expression derived has the same simplicity as the original ap81 model but with the advantage of overcoming all the issues listed on table 1 the acap model is not dependant on the total selected sample mass of the soil nor on any specific discretization of the grain size distribution moreover for a fixed β parameter the resulting psd is always monotonically increasing and the derived wrc is always monotonically decreasing as it is expected to be discrete points of the psd and wrc can be achieved from discrete values of the gsd by directly using eq 12 but also a continuous psd and wrc is directly obtained from this continuous form of the gsd with the same expression which couldn t be achieved from previous ap models except from the cneap model and the ap92 model the calibration of a constant β parameter from a measured wrc is also very easily achieved by a linear regression as explained in section 4 or particular values of β can be evaluated for every measured point of the wrc by using eq 16 in this way accuracy of the model can be further increased if one point of the wrc is known the acap model can be applied by using a fixed constant β fix parameter equal to 1 2042 with a scaling parameter d0 d 50 1mm which gives as a result good predictions with an acceptable rmse for the predicted volumetric water content of 0 09 this accuracy could be increased up to an rmse of 0 086 by using a fixed constant β fix tex that depends on the usda soil texture and can be further increased to an rmse of 0 081 by using an empirical expression β fix emp given by eq 18 and to rmse of 0 075 by using an empirical value β emp that depends on the pore size eq 19 a fixed β fix results in a simpler implementation of the model and can predict the response of soils dissimilar to the reference dataset close to their actual behaviour in contrast the more complex empirical expressions are better at predicting the response of soils similar to those in the dataset but worse at predicting the response of soils dissimilar the reference dataset for this reason it seems appropriate to use β fix or β fix tex values when a simple model is needed and or when some differences from the dataset selected in this study is expected and it is recommended empirical expressions β fix emp and β emp when more accuracy is needed and the soils are similar to the ones evaluated in this paper comparing the goodness of the fits in table 4 it can be noticed that the proposed acap model has nearly the same accuracy as the ap models when using the fixed β fix or β fix tex recommended parameters and the accuracy improves when using the empirical expressions β fix emp and β emp the accuracy using the empirical β emp parameter gives a slightly higher than the accuracy obtained by the rosseta model even when both have been fitted using nearly the same sample dataset and even when rosseta model uses additional θ sat and θ res parameters which in the acap models are imposed to be equal to the porosity and zero respectively the accuracy obtained is also improved over that of the mohammadi and vanclooster 2011 physico empirical model when using an empirical β the poor fit of the haverkamp and parlange 1986 model to the sample data is probably because the proposed parameters of this models are based on only a small number of samples it could probably be improved with more appropriate parameters for this sample dataset the advantage of a physically based wrc prediction is that the model is based on physical concepts and only some parameters are usually included to allow for unaccounted characteristics of real soils in this way the number of parameters required is usually smaller than in the case of empirically based ptfs thus neural networks models like rosetta usually needs one coefficient per neuron and another coefficient for the bias at each depth level while regression based ptfs need to fit one coefficient for each order of the polynomials thus empirically based ptfs depend on very large datasets to cover the whole range of applicability in order to not overfit a model based on a large number of coefficients as an example the level 2 of the vereecken et al 1989 model needs one coefficient for each of nine discretizations of the gsd one for the bulk density and one for organic matter and all of them for each of the van genuchten parameters yet the dataset is based on belgium soils that do not cover uniformly the whole usda texture triangle soil science division staff 2017 and therefore when extrapolating to other data usually lead to parameters without sense level 1 of the vereecken et al 1989 model need less coefficients and its use to other soils lead to better results but in this case with worse predictions than acap model the same could be said of other ptfs investigated in this case the best fit from a regression based ptf was achieved by the weynants et al 2009 ptf but still with worse accuracy than acap model the acap model assumes that the residual water content is zero this restriction is considered by other ptfs e g weynants et al 2009 but even with this assumption a residual water content can be inferred from the shape of the predicted wrc which depends on the selected β parameter which in turn has been fitted from measured curves which have a real residual water content the acap model considers that the saturated water content is equal to the porosity as the original ap81 does this means that the model is not able to predict measured wrc when some air entrapment exists or changes in the porosity due to expansion or collapses of a soil occurs in such a case the predictions from the air entry suction to zero suction won t be very accurate when compared to a wrc of a soil that is not fully saturated in this way accuracy can be improved if the saturated water content is known and other point of the wrc exist to calibrate β the acap model only predicts drying wrc curves and does not model the hysteresis theoretically it could be possible to fit other β parameters more suitable to a wetting wrc hysteresis can be partially considered by using different contact angles however other effects are involved in hysteresis that the acap model is not able to predict because the acap model is based on the capillary approach it is not able to consider the water retention due to adsorption this effect has special importance when the finer are the grains aubertin et al 2003 chan and govindaraju 2004 chang et al 2019 lu 2016 mohammadi and meskini vishkaee 2012 arya and paris based models underpredict the water content on the high saturation ranges this is partially solved by using the empirical expressions depending on the grain size and pore size the acap model as previous ap models assumes that the pore structure depends on the granulometry and the porosity but in plastic soils the pore structure is usually more related to the clay mineral s gouy chapman double layer that is reflected in its plasticity chapuis and aubertin 2003 zapata et al 2000 on plastic soils chemical forces between particles have major influence leading to aggregation of particles affecting the pore structure on sandy soils the acap model seem to perform the best with higher accuracies as observed in table 3 for plastic soils acap could still be applied but the associated uncertainty need to be taken into account it seems that for plastic soils a better predictor could be the atterberg limits but most of existing databases like unsoda usually do not include this information not many wrc predictive models include this information in their ptfs one of the limited examples is zapata et al 2000 the main advantage of the acap model as in the original ap81 model is its simplicity which is possible thanks to the similarity concept between the shapes of the gsd and the psd in which each point of the psd is related an evaluated from one point of the gsd however pore sizes are usually related to the geometry of pore throats dullien 1991 while grain sizes are related to geometry of the grain particles pore throats are defined by the contact of several grains that in the acap model are assumed to be equal for each grain fraction but in real soils pore throats are defined by the contact of several particles more complex physically based wrc prediction models i e pore network models generated from packing different spheres can take into account pore geometry from the contact of spheres of different sizes but with the lack of simplicity despite the gsd and porosity being known to be the properties that most affect the wrc prediction other physical properties can also influence the wrc such as particle shape and roughness beckett and augarde 2013 stresses wang et al 2020 and adsorption model uncertainty is usually linked to model complexity chiachío et al 2015 the more complex the model the more accurate but by contrary its implementability and usefulness is limited as an example if the acap model is applied to a gap graded soil this will result in a gap graded pore size distribution while observed pore size distributions of gap graded soils are not gap graded see fig 9 because of the reasons explained therefore in gap graded soils lower accuracies can be expected yet even in those cases the acap model won t fail in the prediction as it happens with other ap models ap81 ap99 and cneap models that are not applicable to gap graded soils fig 9 indeed this may be a key feature of the acap model it s continuous monotonic modelling of the wrc from geometric inputs will allow it to be used analytically in a numerical code without fear of singularities or ambiguities arising regardless of the grading input with all these considerations the acap model becomes a very convenient way to estimate the wrc from the grain size distribution and porosity it has all the advantages of the widely applied previous ap models while overcoming all the issues listed in table 1 because of the simplicity of the acap model the psd is directly and easily obtained by using eq 12 and the wrc by applying the youngs laplace equation to the psd eq 2 all this is achieved while increasing the accuracy compared to earlier models and being able to obtain discrete and continuous results ap models have been widely applied in the past and the equations in table 2 can be employed to relate previous parameters with the new parameter β 7 conclusion a physic empirical model to predict the water retention curve and the pore size distribution from the grain size distribution and the porosity of the soil has been formulated this model has been named the alternative continuous form of the arya and paris acap model because it is a modified version of the previous model presented by arya and paris 1981 the implementation of the previous model was only possible by a finite discretization of the grain size distribution of the soil whereas in the new model a more convenient continuous form is reached where it is possible to predict a continuous form of the water retention curve and the pore size distribution with a simple expression it only requires the definition of a continuous expression of the grain size distribution the porosity of the soil and with the use of one single fixed or empirical defined parameter β detected issues and subjectivities of the previous models have also been eliminated the new parameter β has been correlated with the granulometry properties of the soil and its porosity using data from 428 soil samples by using a constant parameter β the accuracy remains only slightly better than in the original arya and paris 1981 model but more accurate results are obtained when this parameter is defined by an empirical expression depending on the pore size or the suction some particular parameters of the gsd and the soil porosity reaching an accuracy similar to other popular models like rosetta but with a simpler expression some limitations and uncertainties still exist and are discussed in the present paper however the validity of the new model as a predictive tool is remarkable when considered in combination with the uncertainties of inferred results using different expressions for the new parameter β performing specially well in soils with small clay content closed continuous expressions of the water retention curves pore size distributions pore size from grain size and its inverse are included and are easy to implement the monotonic nature of the wrc relationship predicted by the acap model may make it particularly useful for numerical implementations credit authorship contribution statement ivan campos guereta conceptualization methodology software formal analysis writing original draft andrew dawson supervision nicholas thom supervision declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments this research is funded by the university of nottingham appendix a notation a 1 acronyms a 2 symbols symbol units full meaning e npor l3 l 3 void ratio porosity index ρ s ρ w m l 3 density of particles density of water α α i parameter in ap models and cneap model subindex i refers to the value for a particular fraction of the soil i ts m t 2 surface tension cosφ cosine of contact angle between solid and water g l t 2 acceleration of gravity β β i β parameter in acap model referring to fraction i when subindex is present and continuous expression when there is no subindex the superindex means that value of β is constant over the whole wrc for a given soil β fix constant parameter β independent on the soil selected β fix tex constant parameter β for each soil texture β fix emp constant parameter β from an empirical expression depending on some properties of the gsd and porosity β fix fit constant parameter β fitted to the wrc of an specific soil β emp dp parameter β depending on the pore size and evaluated from an empirical expression depending on βfix emp and d50 fitted to the soil data base β fit dp parameter β depending on the pore size and evaluated from an empirical expression depending on the previously calibrated β fix fit in the soil and d 50 a b parameters in the ap99 model to infer α c d log l parameters in the ap08 model to infer real pore length dg d g i l grain size diameter in continuous form or in the fraction i of the soil subindex g refers to grain dp d p i l pore size diameter in continuous form and for a discrete fraction i subindex p refers to pore d0 l parameter to scale the soil geometry 5 options are considered this paper refers to d01 d 50 0 001 d 10 d 50 d 60 d 80 l characteristic diameters of the grain size distribution at the quantiles 10 50 60 and 80 when included in empirical expressions of β the units have to be in m cu coefficient of uniformity of the grain size distribution cu d 60 d 10 ψ ψ i l suction expressed in height of water column in a continuous form or for the fraction i δ n i δ n i number of virtual particles on fraction i without the superindex refers to the number of particles in the ideal soil while without the super index refers to the real or predicted number of particles of the fraction l p i l p i l length of pores without the super index refers to the length of the pores considering an ideal configuration of cylindrical tubes while with the superindex refers to the real or predicted pore length w0 g m total mass of particles in the sample v0 g m total volume of particles in the sample δw g i m mass of particles for the fraction i δv g i l3 volume of particles for the fraction i f v g d g l3 l 3 cumulated volume of particles per unit from the grain size distribution expressed per unit this expression is the grain size distribution of particles per unit gsd subindex vg means that the cumulated distribution is per volume of particles instead of the usual gsd per mass dependant variable dg is the grain size f v g d g l 1 density distribution function of the volume of particles of size dg f v g d g d f v g d d g subindex and dependant variable have the same meaning than for f v g d g f v p d p l3 l 3 cumulated volume of pores per unit this expression is the pore size distribution per unit psd subindex vp means that the cumulated distribution refers to the volume of pores dependent variable dp is the pore diameter s sr l3 l 3 saturation relative saturation θ θ sat θ res l3 l 3 volumetric content volumetric water content at saturation irreducible volumetric water content appendix b the arya and paris 1981 model for an ideal soil for the fraction i with a particle volume δv g i the total number of particles δni assuming that they have spherical shape is given by eq 20 20 δ n i δ v g i π d g i 3 6 the voids in the same fraction i have a volume δv p i that is equal to the void ratio e multiplied by the particle volume δv g i as the ap model assumes a constant void ratio for each fraction obtaining eq 21 21 δ v p i e δ v g i e δ n i π d g i 3 6 the pores are assumed to be constituted by cylindrical tubes that in an ideal soil will have a total length li equal to the number of particles multiplied by their diameter point 4 in fig 1 obtaining as a result eq 22 22 l i δ n i d g i this configuration of cylindrical pores in an ideal soil could be considered also in others directions but it has no importance as the ap81 model considers that in a real soil the pore length will be different l i and is calculated by raising the number of particles to the power of a scaling factor α as expressed in eq 23 see point 5 in fig 1 23 l i δ n i α d g i the volume of the cylindrical pore tubes with a pore length l i and a pore size of d p i is then given by eq 24 24 δ v p i l i π 4 d p i 2 δ n i α d g i π 4 d p i 2 combining assumed pore volume in eq 24 with the pore volume in the gsd fraction in eq 21 arya and paris 1981 finally reached eq 25 using the notation of the present paper that related the grain size d g i of the fraction i of the gsd with the pore size d p i of the same fraction i in the psd arya and paris 1981 proposed a constant value of α 1 38 the total sample mas was fixed to 1g and an specific discretization of the gsd included in arya et al 1999 is needed 25 d p i d g i 2 e δ n i 1 α 3 
276,arya and paris developed a model in 1981 to predict the water retention curve of a soil from the grain size distribution and the porosity this model was very convenient due to the simplicity of the input parameters and because experimental measures are expensive and with no lack of uncertainties the model was based on very simple equations but the need to discretize the grain size distribution restricted its usability a new model is presented preserving the physical meaning but solving this dependency and other issues and allowing a continuous expression that was not possible with the original model the new model is very convenient and practical as expressions are easy to implement and its predictions depend on only one parameter for which some recommended values are also included limitations and uncertainties of the model are also discussed graphical abstract image graphical abstract keywords water retention curve soil water characteristic curve pore size distribution arya and paris acap 1 introduction water content has a major influence on the response of soils many soil related construction and infrastructure problems are directly or indirectly related to water presence so that understanding the factors that link water to soil behaviour is vital in general near surface soils are in a variable saturated state which means that sometimes all the pores are filled by the wetting fluid water the saturated state or partially filled the unsaturated state in the latter case due to capillary forces there is a connection between the suction the difference between water pressure with air pressure and the water content that is defined by the soil water retention curve hereinafter referred to as wrc that may be considered as a constituent property of a soil obtaining the wrc in the laboratory is difficult expensive and time consuming chapuis et al 2015 also it usually leads to different kinds of uncertainties common to the experimental process zapata et al 2000 for that reason several approaches have been proposed to infer the wrc from other inexpensive properties of the soil the methods to estimate wrc can be divided into three categories buczko and gerke 2005 fredlund et al 2012 1 direct stochastic estimation of water contents at various soil suction points 2 stochastic or empirical estimation of soil parameters using some algebraic functions for the wrc of the soil and 3 physic empirical models some authors group the first two categories into a more general empirically based class and in general there is not a pure empirically based or a pure physically based category but some mixture of both haverkamp et al 2002 within any of those categories can be included the large set of pedotransfer functions ptfs with which to infer desired water retention curves estimands from more simple basic soil properties predictors van looy et al 2017 this ptf term was first defined as translating data that we have into data we need but do not have by bouma 1989 and in most cases the ptfs are simple empirical expressions fitted to the contents of specialized databases like unsoda leij et al 1996 grizzly haverkamp et al 1997 hypres wösten et al 1999 or eu hydi weynants et al 2013 which include the required estimands van looy et al 2017 the number of purely empirical ptfs to infer the wrc from basic properties is substantial and several reviews are available patil and singh 2016 van looy et al 2017 vereecken et al 2010 wösten et al 2001 empirically based methods vary and can extend the original concept of ptfs methods based on simple look up tables regression techniques neural networks and other machine learning techniques decision and regression trees random forests etc empirical methods are data driven models which usually elicit a large number of parameters with no physical meaning and which are fitted to specific data their applicability is usually limited to the dataset to avoid extrapolation outside the data domain on the other hand physically based models usually include fewer parameters and are derived from physical concepts the number of parameters is reduced as the water retention curve expression is usually derived from expected physical behaviour sometimes some parameters need to be empirically defined to include some unknowns and assumptions i e in physico empirical models the first approach to obtain the wrc based on physical principles is due to childs 1940 who applied the capillary concept in which the pores are simplified as a bundle of interconnected capillary tubes so that when wetting the smaller tubes fill first due to higher suctions other more complex physical models consider different packings of spheres assouline and rouault 1997 chan and govindaraju 2004 or probabilistic expressions for pore throats based on packing of spheres jaafar and likos 2014 zhai et al 2020 fractal models chan and govindaraju 2004 perrier et al 1996 percolation methods chatzis and dullien 1977 diaz et al 1987 dullien et al 1976 pore networks defined by prismatic throats and spherical bodies ahrenholz et al 2008 blunt et al 2002 mahabadi et al 2016 vogel 2000 xiong et al 2016 etc these methods relays on pure geometrical interpretations therefore it seems evident that the water retention curve definition is intimately linked to soil geometry and pore structure thus the gsd and the porosity index can be expected to heavily influence the inferred wrc this expectation is strengthened in that almost all pedo transfer functions depend on the gsd and optionally on the porosity index or on the equivalent void ratio or density physically based models can be accurate but difficult to implement or simpler and less accurate but more practical arya et al 2008 1999 arya and paris 1981 haverkamp and parlange 1986 mishra et al 1989 mohammadi and vanclooster 2011 nimmo et al 2007 one of these simple models that can be considered as the first model to obtain the wrc from the gsd and porosity index based on physical concepts and with only one empirical parameter is the model created by arya and paris 1981 hereinafter referred to as the ap81 model who made good use of the observed similarities between the shape of the psd and the gsd other models also considered this similarity concept arya et al 2003 gupta and ewing 1989 gupta et al 2004 haverkamp and parlange 1986 mishra et al 1989 mohammadi and vanclooster 2011 nimmo et al 2007 the main advantage of the ap81 model was its simplicity with its use of gsd and void ratio as inputs and with only one parameter the scaling parameter α for this reason ap81 became the most applied method that relates pore scale to grain size based on physical concepts buczko and gerke 2005 despite that shortly after the publication of the model some inconveniences were detected by haverkamp and parlange 1982 and later by haverkamp et al 2002 and nimmo et al 2007 other issues are also detected in the present paper these problems are listed later in section 2 table 1 further insights into the scaling parameter α were included in arya et al 1999 hereinafter referred as ap99 model and a modification of the model was included in arya et al 2008 hereinafter referred to as the ap08 model however most of the problems remained arya and dierolf 1992 modified the original model in this case the pore length was assumed to be equal to a parameter α for every grain size fraction nevertheless because of their theoretical basis ap models became of real interest in wrc prediction and are included in a large number of publications arya et al 1982 applied the ap81 model to a large dataset of 181 new jersey soil horizons gupta and ewing 1989 mixed the arya and paris approach with a packing model to differentiate between inter and intra aggregate pore space mishra et al 1989 applied a modified version of the arya and paris model to estimate uncertainties of the van genuchten parameters basile and d urso 1997 performed a calibration of the ap model to increase the performance on clay loamy soils fredlund et al 1997 presented a method to estimate the wrc and although it did not apply the ap model the conceptual idea was very similar dividing the gsd to combine specific wrc to each division arya et al 2003 applied the estimation of the psd by arya and paris approach to assess the hydraulic conductivity of soils gupta et al 2004 applied the ap model to estimate the water content on roadbed materials buczko and gerke 2005 applied the ap model to coarse mine soil material and they concluded the model mispredicted water content at high suctions and that the closest fits for the α parameter was a variable expression depending on particle size vaz et al 2005 evaluated the ap model for brazilian soil types and propose a much smaller α parameter than in the original ap81 model and a variable α parameter depending on the water content nimmo et al 2007 compared several physical models including the arya and paris approach concluding that most of them shares similar concepts and a general framework they included two continuous modified versions of the arya and paris model and mohammadi and vanclooster 2011 perform a nearly similar approach to the ap model considering different grain assemblages which result in a very simple equation prevedello and loyola 2002 developed the splintex model this model applies the ap model to a measured grain size distribution with a scaling factor α defined by the ap81 and ap99 models that is corrected to match a measured point in the wrc or to an estimated water content at a specific point of the wrc by using an empirical expression the output of the model are the parameters of the van genuchten expression fitted to the resulting wrc with the ap model there are two versions of the model in the first one the saturated water content can be estimated equal to the porosity or estimated empirically from bulk and solid densities and no measured point of the wrc is given splintex ptf1 and in the second version the saturated water content and a point of the wrc are inputs to the model splintex ptf2 this model has been evaluated in further papers with satisfactory results da silva et al 2017 huf dos reis et al 2018 and the software implemented in c resulting in the version 2 0 da silva et al 2020 the splintex model however is still based on the original ap81 and ap99 models and therefore shares their limitations ap models depend on a particular discretization of the gsd but a continuous form would be more practical and permit a more convenient implementation of the ap concept nimmo et al 2007 tried to obtain a direct continuous form from the discrete ap81 model by transforming the discrete intervals into differential intervals and integrating but the expression degenerate to 0 or when the scaling parameter α is diferent to 1 to avoid this issue they modified some terms of the expression and built the cneap model continuous near equivalent of the ap model nevertheless several problems of the ap model remained unresolved the purpose of the present paper is to build a closed continuous expression of the wrc or psd as a function of the gsd and the porosity by performing slight modifications to the original ap81 model so as to overcome the difficulties identified this new modified arya and paris model depends on only one parameter β parameter β is chosen so as to distinguish it from the original parameter α this new parameter will have much less variation across the full suction range than in the original ap81 model the new model results in a simple expression that relates the grain sizes in the gsd to the pore sizes in the psd without the need of discretization and some values or empirical expressions for parameter β will be recommended also expressions to relate previous models with the new parameter β will be given the new model slightly increases the accuracy of original ap81 model for most simple definitions of parameter β but substantially increases the accuracy when β is defined by an empirical expression unlike other models that consider capillary forces and adhesion aubertin et al 2003 kovács 1981 qiao et al 2021 ap based models rely on the capillarity concept only therefore their predictions are limited to capillary based water retention and the water retention due to adsorption is not considered adsorption has more influence the smaller the grains aubertin et al 2003 chan and govindaraju 2004 chang et al 2019 lu 2016 mohammadi and meskini vishkaee 2012 this model does not consider either the water retention in the form of pendular rings or the aggregation of clay particles due to chemical interactions adsorption and pendular rings could be the cause of the uncertainties detected on the samples with clay content and for high suctions chang et al 2019 meskini vishkaee et al 2014 mohammadi and meskini vishkaee 2012 this is partially solved by using empirical expressions of the β parameter depending on the grain size or the pore size therefore the acap model is especially suitable for soils with small clay content and for the mid range of the water retention curve 2 background the arya and paris model 2 1 original arya and paris 1981 model noticing the general similarities between gsd curves and the psd curves arya and paris 1981 assumed that every pore size in the psd corresponded with a particular grain size on the gsd assuming in this way that the fractions of the largest pores were directly related to fractions of largest grains and the same with each successive smaller fraction the gsd was divided into several particle size fractions δd g i with a mean particle size d g i spherical particles being assumed all fractions were assumed to have the same particle density and the same void ratio e fig 1 shows a diagrammatically the process followed by the arya and paris based models for each fraction i in the discretization of the gsd the mean particle size is d g i and the particles have a volume δv g i and because the same void ratio is assumed for all fractions the pore volume δv p i is equal to the void ratio multiplied by the particle volume e δv g i the ap81 model considered that the particles are spherical and the pores are constituted by cylindrical tubes that in an ideal soil and for each fraction i will have a length equal to the number of particles in the fraction δni multiplied by the grain size d g i i e δni particles placed in a line would have the same overall dimension as the tube length but the ap81 model recognises that in general the pore length will be different to the one assumed for the ideal soil so its value is assumed to be equal to the number of particles powered by an scaling parameter α i e considering a different number δ n i α of virtual particles multiplied by the particle size this different pore length is then used to obtain the pore volume of the fraction δv p i e δv g i and the required pore size is then obtained reaching the final expression of the ap81 model in eq 1 the full formulation of the model is included in appendix b arya and paris 1981 proposed a constant value of α 1 38 1 d p i d g i 2 e δ n i 1 α 3 once the psd is estimated the wrc can be calculated by applying the youngs laplace equation to the pores eq 2 where ψ is the suction ts the surface tension φ the liquid solid contact angle ρ w the liquid density and g the gravity ap models assume that larger pores drain before the smaller pores due to their lower suctions which neglects an important retention mechanism that causes hysteresis and some residual water content ap based methods do not consider hysteresis 2 d p 4 t s c o s φ ρ w g ψ 2 2 problems of the original arya and paris 1981 model from a direct observation of eq 1 it can be easily noted that the predicted pore size for each fraction d p i depends by one side on the particular discretization selected as wider intervals of the gsd will result in larger numbers of grains δni and as a consequence a larger pore size for the same mean grain size of the discretization and by the other side if a particular discretization is selected then the pore size for each fraction will depend on the total sample mass as the greater mass of the sample the more grains there will be in each discretization and therefore a higher pore size in the psd for the same grain size in the gsd the total mass problem was fixed in the same paper arya and paris 1981 by establishing the sample mass to a notional 1 gram the discretization problem was noticed soon after by haverkamp and parlange 1982 who emphasized the sensitivity of the pore grain size relationship to the way in which the gsd was subdivided furthermore the fractions selected by the authors were not clear arya et al 1999 fixed the discretization problem by fixing the discretization of the gsd into 20 fractions at diameters of 1 2 3 4 10 20 30 40 50 70 100 150 200 300 400 600 800 1000 1500 and 2000 μm arya and dierolf 1992 ap92 model noticed that the results were highly sensitive to parameter α and also agreed with haverkamp and parlange 1982 considerations proposing an alternative approach considering now that pore length associated with each particle were fixed by a parameter α for which they propose an average value of 0 911 cm with low variability ranging from 0 3 to 1 5 cm this nearly constant pore length per particle does not have a real physical meaning as it is unreasonably long for very small particles nimmo et al 2007 in the ap99 model arya et al 1999 parameter α was further studied by comparing the real number of particles δni for each size fraction directly obtained from the gsd with the number of particles δ n i α needed to obtain the pore length calculated from measured pore size distributions they proposed a variable value for parameter α depending on the pore size however this parameter still depends on the number of particles and therefore on the discretization done and the total sample mass following a similar approach than in the ap92 model arya et al 2008 proposed a further modification to the ap99 model herein this will be named the ap08 model arguing that the pore diameter was highly sensitive to the two parameters a and b in this case they noted that instead of comparing the number of particles δni in each fraction of the gsd with the number of particles δ n i α required to get the real pore length it was better to compare the real pore length l p i with the ideal configuration of particles l p i evaluated directly from the gsd they noted that these two values of the pore length could be related by a linear regression in a log log plot the approach to get the ideal length of pores is similar to that used in the ap 81 model and the computed pore length in the ideal configuration is now calibrated to the real measured pore length l p i by an empirical expression depending on the ideal pore length l p i and two parameters still the ideal pore length and also the final expression to get the psd depends on the number of particles and therefore on the discretization performed on the gsd and the total sample mass in this ap08 model a different discretization other than previous models was selected with further insights into the eq 1 it can be noticed that the ap81 model in this form cannot be directly converted into a continuous form it needs a discrete division of the gsd if the gsd is discretized into infinite differential divisions then the number of particles δni tends to 0 when α is higher than 1 or to infinity if α is lower than 1 giving as a result values of the pore size equal to 0 or infinity respectively for each fraction of the psd this problem was detected by nimmo et al 2007 who included a slight modification on the ap81 model to create the continuous nearly equivalent form of the ap81 model cneap model that is now described it would be advantageous to obtain a continuous expression in which a given continuous expression of the gsd is used to compute a continuous expression for the psd this is convenient for several reasons one reason is that a continuous form of the grain size distribution lead to a continuous form of the pore size distribution that can be easily included in analytical calculations inversely an algebraic continuous form for the water retention curve i e van genuchten 1980 or fredlund et al 1994 leads to a continuous expression of the gsd also depending on those parameters that could be directly fitted to the measured grain size distribution it will be possible to directly obtain van genuchten or fredlund and xing parameters additionally continuous expression are easily implemented in computer algorithms and in the particular case of ap models no dependence of the results on the selected discretization exist with this aim nimmo et al 2007 developed a general framework following the same principles as in the ap models in this case and to be able to obtain the continuous expression nimmo et al 2007 discretized the gsd not in the same way as in the ap models but in differential intervals from dg to dg ddg they noted that if ddg tends to 0 then ψ d degenerates to ψ d 0 for α 1 and to ψ for α 1 and to solve this inconsistency they changed the values for the differential interval ddg such that ddg 2 3 dg obtaining a near equivalent continuous expression of the ap81 model for the wrc nimmo et al 2007 called this the continuous near equivalent aria and paris model cneap model by including the mass of 1g with w0 g and the definition of the gsd by its distribution function f v g d g nimmo et al s expression now does not depend on the way of discretizing the gsd nor on the total sample mass nevertheless the change to ddg 2 3 dg does not have a real physical explanation the substitution has been done to avoid the degeneration of the continuous expression for the ap81 model two issues can be noticed in the cneap model a minor one is that this expression is not invertible in general due to f v g d g therefore a closed expression for the water content from the suction θ ψ in general cannot be obtained another more relevant issue is that the cneap expression represents a continuous but sometimes non monotonic relationship between suction ψ in the wrc and particle size dg in the gsd which has no physical meaning as the wrc needs to be always monotonically decreasing this is noticed especially on gap graded soils as the direct application of the cneap model leads no a non monotonic wrc all these issues are summarized in table 1 and will be overcome with the proposed new acap model 3 theory alternative continuous form for ap model the acap model 3 1 formulation of the acap model in this section a modified continuous version of the original ap81 model will be developed by following the same concept and formulation than the original ap81 model but taking special care in selecting the scaling parameter and discretization to overcome all the issues included in table 1 the same assumptions as in the original ap81 model will be considered 1 there is a one to one association between the grain size dg in the gsd with the pore size dp in the psd and with the suction ψ in the wrc 2 void ratio and particle density remain uniform for every possible discretization of the gsd 3 particles are assumed to behave as if they have a spherical shape 4 the capillary model is based on an assumed cylindrical shape of the pores with a diameter of dp 5 pore diameter dp and suction ψ are related by the young laplace capillary equation given by eq 2 to overcome the problem in the original ap81 model of its dependence on the number of particles in the fraction which depends the size of the fraction this paper no longer applies the scaling parameter α to the number of particles in the fraction as in eq 1 but to the intensity of spheres in this way in this acap model in order to estimate the real pore length the real intensity of particles will be raised by a scaling parameter named β to distinguish it from α as in the original models and this will result in a change in the number of spheres but will maintain the particle volume in the virtual fraction see fig 2 in addition note that by assuming that the pores are constituted by a bundle of capillary tubes and that every grain size d g i is associated with a pore diameter d p i then the link between the grain geometry and the pore geometry is purely geometrical hence the model should be scale invariant if we reduce the geometry of the soil by scaling its geometry the pore geometry will be scaled in the same proportion as a result it seems a good idea to express the new model non dimensionally by dividing by a reference factor with units of length d0 therefore volumes will be scaled by dividing by d03 and the number of particles won t change furthermore as the connection is purely geometrical it is more appropriate to work with volumes of grains and pores instead of mass so from this point onwards the gsd will be referred as gsd in terms of volume instead of the usual gsd in terms of mass the relation between both of them is normally trivial if the grain density for each grain size fraction is known the intensity of particles for the fraction i is the number of particles per volume δni δv g i d03 and this value is independent of the size of the fraction selected the number of particles can be expressed as the intensity multiplied by the volume δni δni δv g i d03 δv g i d03 then the number of virtual particles to get the predicted length of the pores in the new model will be given by eq 4 where sur index means the number of particles in the virtual geometry after applying the scaling parameter β fig 2 helps to visualize the differences between acap model approach centre and ap models right the real number of particles and the cylindrical tubes in the ideal soil left are transformed to a virtual arrangement that represent the predicted pore length and diameter in the acap model centre the volume of the particles does not change in the fraction when raising the intensity of particles to the power β but the pore length does change and in the ap models right the volume of particles and their number changes when raising the number of particles to the power α although the pore volume remains equal to the ideal state the approach to get the pore length and diameters varies in the ap models this length depends on the ideal number of particles selected and therefore on the discretization performed which is not the case of the acap model 3 δ n i δ n i δ v g i β δ v g i the number of virtual particles in the scaled soil is then expressed by eq 4 the scaled volume of a number δ n i of virtual spheres with diameter d g i is given by eq 5 where the sur index means that this applies to virtual geometry after applying the scaling parameter β and the scaled volume with the number δni of real particles of diameter d g i is given by eq 6 the scaled volume of real particles and virtual particles in each fraction i is the same and equal to δv g i d03 4 δ n i δ n i δ v g i d 0 3 β δ v g i d 0 3 5 δ v g i d 0 3 δ n i π 6 d g i d 0 3 6 δ v g i d 0 3 δ n i π 6 d g i d 0 3 by combining eqs 4 6 the diameter of the virtual spheres is given by eq 7 7 d g i π 6 β 1 3 d g i d 0 β d 0 the non dimensional predicted length for the pores l p i d 0 per unit of non dimensional volume δ v g i d 0 3 is given by eq 8 8 l p i d 0 δ v g i d 0 3 δ n i d g i d 0 δ v g i d 0 3 π 6 1 2 β 3 d g i d 0 2 β considering a uniform void ratio e the scaled volume of the pores is given by eq 9 as the scaled cylindrical pores have a non dimensional length l p i d 0 and a scaled diameter d p i d0 the scaled pore volume can also be expressed by eq 10 the volume of a cylinder 9 δ v p i d 0 3 e δ v g i d 0 3 10 δ v p i d 0 3 π 4 l p i d 0 d p i d 0 2 substituting the non dimensional pore length l p i d 0 from eq 8 into eq 10 the non dimensional volume of the pores can also be expressed by eq 11 11 δ v p i d 0 3 2 2 β 5 3 3 2 β 1 3 π 2 2 β 3 d g i d 0 2 β d p d 0 2 δ v g i d 0 3 and combining both expressions for the non dimensional volume of the pores eqs 9 and 11 the direct connection between the grain size d g i in the gsd and the pore size d p i in the psd is given by eq 12 and its inverse by eq 13 eq 12 then becomes the replacement of eq 1 in the ap81 model and also becomes a very simple expression relating each point d g i f v g i in the gsd with one point d p i f v p i in the psd being f v p i f v g i 12 d p i d 0 e 3 π 2 β 2 2 2 β 5 3 2 β 1 1 6 d g i d 0 β 13 d g i d 0 2 2 β 5 3 2 β 1 e 3 π 2 β 2 1 6 β d p i d 0 1 β first it can be noted that the new expression eq 12 is not discrete as the connection between pore size and grain size does not depend on any discrete term of the gsd in this way eq 12 can be expressed without the i subindexes second it can be noted that eq 12 is monotonically increasing in d p i when the grain size d g i is monotonically increasing for all positive and constant β values therefore if the gsd is expressed by the continuous function f v p d g as the cummulative distribution of the volumes of grain sizes below dg then the psd as the cumulative distribution f v p d p of the volume of pores below d p d is reached by simply including the expression dg dp from eq 12 in the continuous expression of the gsd f v p d p f v g d g d p also the wrc is obtained by simply including the capillary equation eq 2 into the psd s ψ f v g d g d p ψ thus the volumetric pore size distribution is obtained from the volumetric grain size distribution continuous function f v g d g as follows 14 f v p d p d pmin dp v p d p d d p d pmin dpmax v p d p d d p e d gmin dg v g d g d d g e d gmin dpmax v g d g d d g f v g d g d p f v g 2 2 β 5 3 2 β 1 e 3 π 2 β 2 1 6 β d p d 0 1 β the water retention curve is then obtained from the grain size distribution by eq 15 considering that the volumetric water content θ is related to the equivalent saturation by se θ θ res θ sat θ res where θ res is the irreducible water content and θ sat is the water content at saturation in this model equivalent saturation is the same as the total saturation s θ θ sat as θ res is considered equal to 0 as in the original ap models 15 s ψ d p ψ max d p ψ v p d p d d p d p ψ max d p ψ min v p d p d d p f v g 2 2 β 5 3 2 β 1 e 3 π 2 β 2 1 6 β 4 t s cos φ ρ w g ψ d 0 1 β from eqs 14 and 15 it can be also noted that there is a direct connection between the gsd psd and wrc for the same values of f v g v g v 0 g in the gsd f v p v p v 0 p in the psd and s from the wrc the curves only differ by a variable substitution using eqs 12 13 or the capillary equation eq 2 f v g f v p s fig 3 the connection between gsd psd and wrc is volumetric for that reason what it is really connected are the discrete volumes and only indirectly the particle sizes and pore sizes hence because the discretization of the gsd is done volumetrically a monotonically increasing grain size results in a monotonically increasing pore size and a monotonically decreasing wrc 3 2 comparison between scaling parameter β in the acap model with scaling parameters α by comparing dependence of the grain size d g i and the pore size d p i in the acap model as described in eqs 12 and 13 and using the capillary relationship eq 2 with the expressions in section 2 it is possible to calculate β from known values of α and vice versa if the discretization done in the ap models and the sample mass are known the expressions are included in table 2 4 materials and methods data from unsoda database leij et al 1996 has been selected to analyze measured values of the β parameter this database has 790 records of soils most of them includes the grain size distribution bulk density porosity and hydraulic properties of the soil the last of these includes water retention curves measured in the laboratory and in the field along with drying curves and some wetting curves the capillary approach does not consider hysteresis in the analysis beyond the change in the angle of contact water soil thus the analysis done in this paper considers only the drying water retention curves measured in the laboratory i e one must measure the water content of the soil for different suction values while drying the soil from a saturated state the wrcs from wetting and wrc in the field have been discarded in the present analysis unsoda records have been extended with data from some papers including information of gsd porosity and wrc for some soils zapata et al 2000 included 3 records a poorly graded sand sp a low plasticity silt ml and a high plasticity clay ch to extend the study to coarser materials data from singh et al 2006 has been included with 18 records of aggregate materials with sizes ranging from 0 0001 mm to 80 mm and finally data from chiapponi 2017 includes 14 records by mixing nearly uniform gradations of 4 different glass beads sizes with diameters between 0 5 mm and 3 mm the unsoda data have been filtered by selecting only the records that include grain size distributions and water retention with more than five points in the curve some records have been excluded because they did not have large series of water contents to properly fit the beta parameter records 1162 1163 1192 1193 1194 1213 2340 and 4575 also some records 3030 3031 3032 and 4760 whose gsd wasn t clear a record with only 4 points in the wrc data was also included 2217 as it was suitable to fit the beta parameter with this criterion a total of 393 records from the unsoda database were selected figure 4 if a value for porosity existed then the porosity took that value in other case the porosity was calculated from dry density of the soil or the saturated water content from the wrc this paper considers the capillary concept which is more appropriately linked with the mid size part of the wrc in which pores that are susceptible to capillary flow are considered as capillary tubes the original ap81 model considered that the residual water content was zero meaning that all voids are susceptible to capillary flow and also that all voids can become be fully saturated meaning that no air entrapment exists when the soil is fully saturated and hence the volumetric water content at saturation is equal to the porosity in general some air entrapment usually exists in measured wrcs so in the ap99 model a percentage of the porosity circa 90 was considered when defining the saturated water content although the real value depends on the method and time taken to saturate the sample the acap model considers that all the pores can be fully saturated with no air entrapment and that the residual saturation is equal to zero for very high suctions for fitting purposes only the points between the air entry value and the residual saturation are considered because the acap model aims to reproduce the wrc more accurately between these two points therefore the measured points between suction zero and suction at the air entry values and suction at the residual point to the totally dry soil are avoided in the fit as the acap model do not perform the prediction of the air entrapment nor residual saturation being both of them imposed including those measures in the regressions leads to higher errors in the middle zone of the wrc parameter β can be obtained from each point of the measured water retention curve by using eq 15 that relates the saturation with suction s ψ with a closed expression given the continuous gsd stated in volumetric terms f v g d g and the parameter β because of the direct link between the gsd f v g d g the psd f v p d p and the wrc from s ψ fig 3 the parameter β j can be obtained from each measured point j of the wrc by isolating it from eq 15 and getting a closed expression for this parameter at each point of the measured wrc eq 16 note that f v g 1 s j f v g 1 f v g d g j d g j where d g j is the grain size linked to the suction ψ j from the wrc such that d g j f v g 1 s ψ j 16 β j log 3 2 e 3 2 π 4 4 t s cos φ ρ w g ψ j d 0 3 log π 6 f v g 1 s ψ j d 0 3 log 3 2 e 3 2 π 4 4 t s cos φ ρ w g ψ j d 0 3 log π 6 d g i d 0 3 in a similar way if the pore size distribution is known for each measure j of the pore size distribution a parameter β j can be obtained by isolating its value from eq 14 and by knowing that the pore size d p j from the psd f v p d p it can be linked to the grain size d g j from the gsd f v g d g j by d g j f v g 1 s ψ j resulting in eq 17 17 β j log 3 2 e 3 2 π 4 d p j d 0 3 log π 6 f v g 1 s j d 0 3 log 3 2 e 3 2 π 4 d p j d 0 3 log π 6 d g j d 0 3 the scaling parameter β j is non dimensional but depends on the selected scale d0 because the intensity of particles depends on the scaling done to the volume volume varies in the scaled soil though not the number of particles eq 17 shows that the value of β is equal to the ratio of the logarithm of the volume of one scaled pore cylinder with scaled pore diameter d p i d0 and scaled pore length of 3 2 e 3 2 times the scaled pore diameter to the logarithm of the volume of one spherical particle with scaled grain size d g i d0 if a constant value of β is to be applied to a soil then its value can be easily obtained by linearly fitting these two volumes on a double logarithmic plot intercepting at the origin log 1 log 1 an example of such a plot is shown as fig 5 for the unsoda soil sample 1010 leij et al 1996 measured values of β are evaluated from the gsd void ratio and wrc by using eq 16 which will have different values depending on the length scale d0 considered five different values for d0 g as been considered being the first one which resulted in better regressions for the prediction of wrc d01 d 50 1e 3 this value implies that the soil is scaled in a way as if the median of the gsd is 1mm in size d0 in s i units of length d02 d 50 0 074e 3 in this case the median is scaled to 0 074mm d0 in s i units of length d03 d 50 0 002e 3 in this case the median is scaled to 0 002mm d0 in s i units of length d04 26501 3 the soil is scaled in a way that the total scaled volume will be 1 for a total sample of v g0 1g and considering d0 in s i units v g 0 d 0 4 3 1 2650 d 0 4 3 this approach will be near to the ap models d05 1m this means no scaling when using s i units in following sections only the results for d01 d 50 1e 3 will be shown results for other options can be consulted in the git hub repository https github com ivaninasetec acap the repository includes matlab code for the model acap for other ap based models ap 81 ap 99 ap 08 cneap other physic empirical models haverkamp and parlange 1986 mohammadi and vanclooster 2011 and some only empirical models rosetta schaap et al 2001 vereecken et al 1989 wösten et al 2001 and weynants et al 2009 the repository includes the input soil records applied in the present paper some scripts to generate the outputs of this paper and live scripts with some samples and the empirical fittings included in following sections the application of the acap model is very simple by using eq 12 each point of the gsd results in one point of the psd and by using the equation of youngs laplace eq 2 at one point of the wrc this yields the cumulated grain volume equal to the cumulated pore volume and equal to the saturation for the point using this equation requires a proper estimation of β four cases are considered a fixed constant β fix a constant β fix tex for each soil texture an empirical expression for a constant β fix emp depending on granulometry properties and porosity an empirical expression for β emp dp also depending on pore size in section 5 these four cases are calibrated against the whole dataset by using eq 15 and minimizing the error between the measured water content and the predicted water content for each of the measured points of the wrc 5 results the prediction capabilities and uncertainties of the acap model have been tested against the whole dataset described in section 4 as a first step expressions for the parameter β have been calibrated the simplest expression is a constant β fix whose best fit result in β fix 1 2042 median of the whole measured β i the distribution and uncertainty of β fix is given by a mean of 1 2415 and a standard deviation of 0 2322 if the texture of the soil is considered the accuracy can be increased in this case recommended values and uncertainties of β fix tex are included by table 3 and figure 6 accuracy can be increased by using an empirical expression for a constant β fix emp as given by eq 18 where log means natural logarithm and particle size is given in m 18 β f i x e m p 1 28798 0 32597 n 0 564173 log cu 0 51332 log d 10 0 50632 log d 50 0 033267 log d 80 0 00429 log d 10 log d 80 it is well known that ap models result in an underprediction of the water content at high suction ranges chang et al 2019 meskini vishkaee et al 2014 mohammadi and meskini vishkaee 2012 therefore a variable empirical expression of β emp depending on the pore size should increase the accuracy the best expression was found to be eq 19 this expression is non linear but once included in eq 12 the value of dp can be solved easily as a closed expression 19 β emp d p 0 554079 0 807073 β fix emp 0 067649 0 002852 β fix emp log d p predictions of the water content for each measured point on the wrc have been calculated by using eq 15 and the four proposed β parameters table 4 gives the coefficient of determination r 2 the root mean squared error rmse and the absolute mean error me between the measured and predicted volumetric water content results that indicates high accuracy of the model the prediction capabilities of acap model are also compared against the other physico empirical ap based models arya et al 2008 1999 arya and paris 1981 nimmo et al 2007 and splintex 2 0 da silva et al 2020 and with other physico empirical but not ap based models haverkamp and parlange 1986 mohammadi and vanclooster 2011 and are also compared against some only empirical and generally accepted pedotransfer functions schaap et al 2001 vereecken et al 1989 wösten et al 1999 in the case of the ap based models the parameters suggested in the source papers where selected the ap81 model includes the value of α 1 38 as proposed in arya and paris 1981 ap99 model includes a and b parameters from the source paper for the soil types to estimate α and a constant value α 1 38 for the other soil textures the ap08 model uses the values of the parameters c 0 233 and d 1 109 from arya et al 2008 to estimate α the cneap model uses the same α parameter as in the ap81 model for the splintex 2 0 model da silva et al 2017 2020 prevedello and loyola 2002 the splitex pft1 approach was selected in which saturated water content is considered equal to porosity first case or estimated second case more accurate results could be obtained if measured saturated water content and a measured point of the wrc is included in the model in that case the approach is named splitex pft2 however only splitex pft1 is included in the results presented here as the purpose is to compare predictions from gsd and porosity only in the physico empirical model by haverkamp five parameters are needed a1 a2 b1 b2 and b3 that are selected from the ones suggested in the source paper haverkamp and parlange 1986 mohammadi and vanclooster 2011 included another simple physico empirical model that as in the ap models is based on the assumption of the similarities between the shape of the gsd and the psd and also based on the sphere packing abstraction this model is based only on one parameter ξ meaning the estimation of the number of contacts between particles divided by 8 and its value is included in the source paper mohammadi and vanclooster 2011 within the very wide range of available only empirical pedotransfer functions patil and singh 2016 van looy et al 2017 vereecken et al 2010 wösten et al 2001 some of the more commonly applied have been selected for comparison with the acap approach the neural networks based model rosetta schaap et al 2001 is trained from the same unsoda database within all the proposed models the one called sccbd has been selected as it is the most suitable in this case as it needs as inputs information of the gsd soil textures and the bulk density of the soil intimately related to porosity the vereecken et al 1989 pedotransfer functions have been reported by several researchers as one of the most accurate ptfs weynants et al 2009 these include empirical expressions to estimate the van genuchten parameters from the gsd carbon content and bulk density they propose five models to define the parameter m of van genuchten and two levels two different ptf expressions in the first level the information of the gsd is based on its texture percentages of clay and silt while the second level includes expressions that use the grain volumes for selected grain size fractions of the gsd for comparison purposes the first level approach has been selected as the second one was found to perform badly outside the dataset to which it was initially fitted several belgium soil samples and specifically result in poor fits for the unsoda dataset weynants et al 2009 developed ptfs based on the vereecken et al 1989 dataset a set of 182 belgium soil samples and stated that they yield a similar goodness of fit as vereecken et al 1989 by using the large database of hydraulic properties of european soils hypres wösten et al 1999 with more than 5521 soil samples wösten et al 2001 fitted empirical expressions for the van genuchten parameters by expressions that depend on clay and silt content bulk density organic matter and whether the sample is top soil or subsoil to evaluate its prediction capabilities from gsd and porosity the organic matter is considered to be zero and the soil is considered to be sub soil not near the ground surface in this paper practical application of wösten et al 2001 implies that when the clay content silt content and organic matter are below 1 the expression needs to be modified supressing the clay silt and organic matter terms respectively table 4 summarizes the accuracy of the acap model when using the proposed fixed constant parameter β fix a fixed constant parameter β fix tex depending on soil texture table 3 an empirical constant parameter β fix emp eq 18 or an empirical variable parameter β emp depending on pore size eq 19 results are compared against the physico empirical ap based models arya et al 2008 1999 arya and paris 1981 nimmo et al 2007 da silva et al 2020 and those described earlier in this section haverkamp and parlange 1986 mohammadi and vanclooster 2011 schaap et al 2001 vereecken et al 1989 weynants et al 2009 wösten et al 1999 results indicates good water retention predictions in a range of rmse from 0 09 for a fixed β fix down to a 0 075 for a variable empirical β emp errors that are in the range of typical ptf accuracy as reported by wösten et al 2001 negative values in some empirical ptfs might be due to the high dependence their empirical expressions on the source dataset as an example wösten et al 2001 include log terms for clay silt and organic matter that result in large negative numbers when those terms are near zero similarly the physico empirical method by haverkamp and parlange has its the five parameters strongly linked with the source dataset fig 7 includes diagrams comparing the goodness of the fit between measured and predicted volumetric water content for three of the tested models against the sample data described in section 4 in particular it includes the results of acap model using empirical β emp eq 18 results from the ap81 model and results from the rosetta model using the sccbd model the accuracy of acap model is slightly better than rosetta and much better than original ap81 model fig 8 illustrates measured and predicted psds for a particular soil record code 1010 in unsoda database with acap model using β emp other ap based models the mohammadi physical model and the rosetta sccbd model 6 discussion a very simple relationship between the pore size and the grain size has been derived based on a modification of the original ap81 model arya and paris 1981 getting as a result eq 12 with this equation each point of the psd d p f v p is directly obtained from each point of the gsd d g f v g considering that for any particular point the cumulative grain volume per unit is equal to the cumulative pore volume per unit f v g f v p the pore size is proportional to a power of the grain size and depends on only one β parameter the expression derived has the same simplicity as the original ap81 model but with the advantage of overcoming all the issues listed on table 1 the acap model is not dependant on the total selected sample mass of the soil nor on any specific discretization of the grain size distribution moreover for a fixed β parameter the resulting psd is always monotonically increasing and the derived wrc is always monotonically decreasing as it is expected to be discrete points of the psd and wrc can be achieved from discrete values of the gsd by directly using eq 12 but also a continuous psd and wrc is directly obtained from this continuous form of the gsd with the same expression which couldn t be achieved from previous ap models except from the cneap model and the ap92 model the calibration of a constant β parameter from a measured wrc is also very easily achieved by a linear regression as explained in section 4 or particular values of β can be evaluated for every measured point of the wrc by using eq 16 in this way accuracy of the model can be further increased if one point of the wrc is known the acap model can be applied by using a fixed constant β fix parameter equal to 1 2042 with a scaling parameter d0 d 50 1mm which gives as a result good predictions with an acceptable rmse for the predicted volumetric water content of 0 09 this accuracy could be increased up to an rmse of 0 086 by using a fixed constant β fix tex that depends on the usda soil texture and can be further increased to an rmse of 0 081 by using an empirical expression β fix emp given by eq 18 and to rmse of 0 075 by using an empirical value β emp that depends on the pore size eq 19 a fixed β fix results in a simpler implementation of the model and can predict the response of soils dissimilar to the reference dataset close to their actual behaviour in contrast the more complex empirical expressions are better at predicting the response of soils similar to those in the dataset but worse at predicting the response of soils dissimilar the reference dataset for this reason it seems appropriate to use β fix or β fix tex values when a simple model is needed and or when some differences from the dataset selected in this study is expected and it is recommended empirical expressions β fix emp and β emp when more accuracy is needed and the soils are similar to the ones evaluated in this paper comparing the goodness of the fits in table 4 it can be noticed that the proposed acap model has nearly the same accuracy as the ap models when using the fixed β fix or β fix tex recommended parameters and the accuracy improves when using the empirical expressions β fix emp and β emp the accuracy using the empirical β emp parameter gives a slightly higher than the accuracy obtained by the rosseta model even when both have been fitted using nearly the same sample dataset and even when rosseta model uses additional θ sat and θ res parameters which in the acap models are imposed to be equal to the porosity and zero respectively the accuracy obtained is also improved over that of the mohammadi and vanclooster 2011 physico empirical model when using an empirical β the poor fit of the haverkamp and parlange 1986 model to the sample data is probably because the proposed parameters of this models are based on only a small number of samples it could probably be improved with more appropriate parameters for this sample dataset the advantage of a physically based wrc prediction is that the model is based on physical concepts and only some parameters are usually included to allow for unaccounted characteristics of real soils in this way the number of parameters required is usually smaller than in the case of empirically based ptfs thus neural networks models like rosetta usually needs one coefficient per neuron and another coefficient for the bias at each depth level while regression based ptfs need to fit one coefficient for each order of the polynomials thus empirically based ptfs depend on very large datasets to cover the whole range of applicability in order to not overfit a model based on a large number of coefficients as an example the level 2 of the vereecken et al 1989 model needs one coefficient for each of nine discretizations of the gsd one for the bulk density and one for organic matter and all of them for each of the van genuchten parameters yet the dataset is based on belgium soils that do not cover uniformly the whole usda texture triangle soil science division staff 2017 and therefore when extrapolating to other data usually lead to parameters without sense level 1 of the vereecken et al 1989 model need less coefficients and its use to other soils lead to better results but in this case with worse predictions than acap model the same could be said of other ptfs investigated in this case the best fit from a regression based ptf was achieved by the weynants et al 2009 ptf but still with worse accuracy than acap model the acap model assumes that the residual water content is zero this restriction is considered by other ptfs e g weynants et al 2009 but even with this assumption a residual water content can be inferred from the shape of the predicted wrc which depends on the selected β parameter which in turn has been fitted from measured curves which have a real residual water content the acap model considers that the saturated water content is equal to the porosity as the original ap81 does this means that the model is not able to predict measured wrc when some air entrapment exists or changes in the porosity due to expansion or collapses of a soil occurs in such a case the predictions from the air entry suction to zero suction won t be very accurate when compared to a wrc of a soil that is not fully saturated in this way accuracy can be improved if the saturated water content is known and other point of the wrc exist to calibrate β the acap model only predicts drying wrc curves and does not model the hysteresis theoretically it could be possible to fit other β parameters more suitable to a wetting wrc hysteresis can be partially considered by using different contact angles however other effects are involved in hysteresis that the acap model is not able to predict because the acap model is based on the capillary approach it is not able to consider the water retention due to adsorption this effect has special importance when the finer are the grains aubertin et al 2003 chan and govindaraju 2004 chang et al 2019 lu 2016 mohammadi and meskini vishkaee 2012 arya and paris based models underpredict the water content on the high saturation ranges this is partially solved by using the empirical expressions depending on the grain size and pore size the acap model as previous ap models assumes that the pore structure depends on the granulometry and the porosity but in plastic soils the pore structure is usually more related to the clay mineral s gouy chapman double layer that is reflected in its plasticity chapuis and aubertin 2003 zapata et al 2000 on plastic soils chemical forces between particles have major influence leading to aggregation of particles affecting the pore structure on sandy soils the acap model seem to perform the best with higher accuracies as observed in table 3 for plastic soils acap could still be applied but the associated uncertainty need to be taken into account it seems that for plastic soils a better predictor could be the atterberg limits but most of existing databases like unsoda usually do not include this information not many wrc predictive models include this information in their ptfs one of the limited examples is zapata et al 2000 the main advantage of the acap model as in the original ap81 model is its simplicity which is possible thanks to the similarity concept between the shapes of the gsd and the psd in which each point of the psd is related an evaluated from one point of the gsd however pore sizes are usually related to the geometry of pore throats dullien 1991 while grain sizes are related to geometry of the grain particles pore throats are defined by the contact of several grains that in the acap model are assumed to be equal for each grain fraction but in real soils pore throats are defined by the contact of several particles more complex physically based wrc prediction models i e pore network models generated from packing different spheres can take into account pore geometry from the contact of spheres of different sizes but with the lack of simplicity despite the gsd and porosity being known to be the properties that most affect the wrc prediction other physical properties can also influence the wrc such as particle shape and roughness beckett and augarde 2013 stresses wang et al 2020 and adsorption model uncertainty is usually linked to model complexity chiachío et al 2015 the more complex the model the more accurate but by contrary its implementability and usefulness is limited as an example if the acap model is applied to a gap graded soil this will result in a gap graded pore size distribution while observed pore size distributions of gap graded soils are not gap graded see fig 9 because of the reasons explained therefore in gap graded soils lower accuracies can be expected yet even in those cases the acap model won t fail in the prediction as it happens with other ap models ap81 ap99 and cneap models that are not applicable to gap graded soils fig 9 indeed this may be a key feature of the acap model it s continuous monotonic modelling of the wrc from geometric inputs will allow it to be used analytically in a numerical code without fear of singularities or ambiguities arising regardless of the grading input with all these considerations the acap model becomes a very convenient way to estimate the wrc from the grain size distribution and porosity it has all the advantages of the widely applied previous ap models while overcoming all the issues listed in table 1 because of the simplicity of the acap model the psd is directly and easily obtained by using eq 12 and the wrc by applying the youngs laplace equation to the psd eq 2 all this is achieved while increasing the accuracy compared to earlier models and being able to obtain discrete and continuous results ap models have been widely applied in the past and the equations in table 2 can be employed to relate previous parameters with the new parameter β 7 conclusion a physic empirical model to predict the water retention curve and the pore size distribution from the grain size distribution and the porosity of the soil has been formulated this model has been named the alternative continuous form of the arya and paris acap model because it is a modified version of the previous model presented by arya and paris 1981 the implementation of the previous model was only possible by a finite discretization of the grain size distribution of the soil whereas in the new model a more convenient continuous form is reached where it is possible to predict a continuous form of the water retention curve and the pore size distribution with a simple expression it only requires the definition of a continuous expression of the grain size distribution the porosity of the soil and with the use of one single fixed or empirical defined parameter β detected issues and subjectivities of the previous models have also been eliminated the new parameter β has been correlated with the granulometry properties of the soil and its porosity using data from 428 soil samples by using a constant parameter β the accuracy remains only slightly better than in the original arya and paris 1981 model but more accurate results are obtained when this parameter is defined by an empirical expression depending on the pore size or the suction some particular parameters of the gsd and the soil porosity reaching an accuracy similar to other popular models like rosetta but with a simpler expression some limitations and uncertainties still exist and are discussed in the present paper however the validity of the new model as a predictive tool is remarkable when considered in combination with the uncertainties of inferred results using different expressions for the new parameter β performing specially well in soils with small clay content closed continuous expressions of the water retention curves pore size distributions pore size from grain size and its inverse are included and are easy to implement the monotonic nature of the wrc relationship predicted by the acap model may make it particularly useful for numerical implementations credit authorship contribution statement ivan campos guereta conceptualization methodology software formal analysis writing original draft andrew dawson supervision nicholas thom supervision declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments this research is funded by the university of nottingham appendix a notation a 1 acronyms a 2 symbols symbol units full meaning e npor l3 l 3 void ratio porosity index ρ s ρ w m l 3 density of particles density of water α α i parameter in ap models and cneap model subindex i refers to the value for a particular fraction of the soil i ts m t 2 surface tension cosφ cosine of contact angle between solid and water g l t 2 acceleration of gravity β β i β parameter in acap model referring to fraction i when subindex is present and continuous expression when there is no subindex the superindex means that value of β is constant over the whole wrc for a given soil β fix constant parameter β independent on the soil selected β fix tex constant parameter β for each soil texture β fix emp constant parameter β from an empirical expression depending on some properties of the gsd and porosity β fix fit constant parameter β fitted to the wrc of an specific soil β emp dp parameter β depending on the pore size and evaluated from an empirical expression depending on βfix emp and d50 fitted to the soil data base β fit dp parameter β depending on the pore size and evaluated from an empirical expression depending on the previously calibrated β fix fit in the soil and d 50 a b parameters in the ap99 model to infer α c d log l parameters in the ap08 model to infer real pore length dg d g i l grain size diameter in continuous form or in the fraction i of the soil subindex g refers to grain dp d p i l pore size diameter in continuous form and for a discrete fraction i subindex p refers to pore d0 l parameter to scale the soil geometry 5 options are considered this paper refers to d01 d 50 0 001 d 10 d 50 d 60 d 80 l characteristic diameters of the grain size distribution at the quantiles 10 50 60 and 80 when included in empirical expressions of β the units have to be in m cu coefficient of uniformity of the grain size distribution cu d 60 d 10 ψ ψ i l suction expressed in height of water column in a continuous form or for the fraction i δ n i δ n i number of virtual particles on fraction i without the superindex refers to the number of particles in the ideal soil while without the super index refers to the real or predicted number of particles of the fraction l p i l p i l length of pores without the super index refers to the length of the pores considering an ideal configuration of cylindrical tubes while with the superindex refers to the real or predicted pore length w0 g m total mass of particles in the sample v0 g m total volume of particles in the sample δw g i m mass of particles for the fraction i δv g i l3 volume of particles for the fraction i f v g d g l3 l 3 cumulated volume of particles per unit from the grain size distribution expressed per unit this expression is the grain size distribution of particles per unit gsd subindex vg means that the cumulated distribution is per volume of particles instead of the usual gsd per mass dependant variable dg is the grain size f v g d g l 1 density distribution function of the volume of particles of size dg f v g d g d f v g d d g subindex and dependant variable have the same meaning than for f v g d g f v p d p l3 l 3 cumulated volume of pores per unit this expression is the pore size distribution per unit psd subindex vp means that the cumulated distribution refers to the volume of pores dependent variable dp is the pore diameter s sr l3 l 3 saturation relative saturation θ θ sat θ res l3 l 3 volumetric content volumetric water content at saturation irreducible volumetric water content appendix b the arya and paris 1981 model for an ideal soil for the fraction i with a particle volume δv g i the total number of particles δni assuming that they have spherical shape is given by eq 20 20 δ n i δ v g i π d g i 3 6 the voids in the same fraction i have a volume δv p i that is equal to the void ratio e multiplied by the particle volume δv g i as the ap model assumes a constant void ratio for each fraction obtaining eq 21 21 δ v p i e δ v g i e δ n i π d g i 3 6 the pores are assumed to be constituted by cylindrical tubes that in an ideal soil will have a total length li equal to the number of particles multiplied by their diameter point 4 in fig 1 obtaining as a result eq 22 22 l i δ n i d g i this configuration of cylindrical pores in an ideal soil could be considered also in others directions but it has no importance as the ap81 model considers that in a real soil the pore length will be different l i and is calculated by raising the number of particles to the power of a scaling factor α as expressed in eq 23 see point 5 in fig 1 23 l i δ n i α d g i the volume of the cylindrical pore tubes with a pore length l i and a pore size of d p i is then given by eq 24 24 δ v p i l i π 4 d p i 2 δ n i α d g i π 4 d p i 2 combining assumed pore volume in eq 24 with the pore volume in the gsd fraction in eq 21 arya and paris 1981 finally reached eq 25 using the notation of the present paper that related the grain size d g i of the fraction i of the gsd with the pore size d p i of the same fraction i in the psd arya and paris 1981 proposed a constant value of α 1 38 the total sample mas was fixed to 1g and an specific discretization of the gsd included in arya et al 1999 is needed 25 d p i d g i 2 e δ n i 1 α 3 
277,two layer and multi layer depth averaged models have become popular for simulating exchange flows seawater currents and geophysical flows the partial differential equation systems associated with these models are similar to the single layer shallow water model yet their eigenstructures are more complex owing to the pressure coupling between the layers such models occasionally lose their hyperbolic character which may lead to numerical issues a physical explanation is that kelvin helmholtz type instabilities arise at the layers interface if the velocity difference between the layers becomes sufficiently large a way to avoid the hyperbolicity loss is to locally introduce an extra momentum exchange between the layers assessable from the system eigenstructure and aimed at roughly mimicking the dynamical effects of such instabilities to better understand the hyperbolicity conditions the eigenstructure of the two layer model is methodically studied by an asymptotic analysis the analysis for the limiting cases where the layers thicknesses are either comparable or very different from each other reveals new stability criteria these analytical criteria are then exploited to design a new family of approximate criteria valid for any flow condition numerical investigations demonstrate the reliability of this approach which can be easily implemented in numerical schemes for preserving the hyperbolicity keywords two layer shallow water equations non conservative hyperbolic systems asymptotic analysis interface instability finite volume 1 introduction shallow water equations de saint venant 1871 and depth averaged models e g savage and hutter 1991 pudasaini 2012 are widely employed to simulate free surface flows characterized by a thin flow depth and are particularly suitable for describing natural phenomena such as floods and geophysical flows e g fraccarollo and toro 1995 ancey et al 2008 sarno et al 2011a sarno et al 2013 papa et al 2018 the popularity of such models is favoured by the fact that different from a three dimensional approach they allow a straightforward and fast numerical integration typically based on finite difference or finite volume schemes multi layer depth averaged models represent an extension of single layer models and have recently gained attention in hydraulic engineering for their capability of describing the dynamics of stratified flows analogous to the shallow water model they can be obtained by depth averaging the mass and momentum balance equations across the different layers and by subsequently simplifying the resulting equations by means of a suitable asymptotic approximation e g savage and hutter 1991 the capabilities of these models in capturing the dynamics of different superimposed flows allow a more accurate description of the flow dynamics along the transverse to flow direction with reasonable computational costs a two layer approach has been successfully adopted for describing seawater currents with small density gradients castro et al 2004 gravity currents adduce et al 2012 la rocca et al 2012 and the saltwater intrusion in stratified estuaries krvavica and ružić 2020 moreover two layer models have been proposed for modelling stratified geophysical flows such as debris flows and avalanches fernández nieto et al 2008 luca et al 2009 doyle et al 2010 canestrelli et al 2012 sarno et al 2014 meng et al 2017 which often exhibit a rheological stratification especially influenced by the presence of side walls e g armanini et al 2005 sarno et al 2011b sarno et al 2018a sarno et al 2018b carleo et al 2019 a multi layer model was introduced by audusse 2005 to describe free surface flows of a newtonian fluid in a computationally more efficient way than the 3d navier stokes equations as well a multi layer approach based on piecewise smooth weak solutions has been recently proposed by fernández nieto et al 2014 2016 to describe newtonian and dense granular flows focusing on the case of the two layer model long 1956 armi 1986 it should be recalled that its partial differential equation pde system is non strictly hyperbolic due to the pressure coupling between the layers namely two of the propagation speeds of the infinitesimal perturbations may become complex numbers which may lead to instabilities of the numerical solution e g castro et al 2011 the mathematical structure of the two layer model is similar to the two phase model e g keyfitz et al 2003 pelanti et al 2008 which is well known to lose its hyperbolic character when the phase velocities are too different from each other under these circumstances these models become of mixed hyperbolic elliptic type e g keyfitz 1987 which poses several open questions about the correct boundary conditions the validity of the exact solution and not least the stability of the numerical approximation from the viewpoint of physics the hyperbolicity loss is often associated with the onset of kelvin helmholtz type instabilities at the interface von helmholtz 1868 which cause the occurrence of an intermediate mixing layer of finite thickness since the two layer is a simplified model of reality unable to describe the mixing layer several numerical phenomenological approaches have been proposed to get around the problem of the hyperbolicity loss the parabolization of the pde system by introducing some small artificial viscosity in the pde model or at the level of the numerical scheme would circumvent the hyperbolicity issue e g fjordholm 2012 etrati and frigaard 2018 yet this modification often causes unrealistically smeared solutions if it is not justified on a physical basis moreover different from models with a finite physically based viscosity introducing some artificial viscosity which decreases with the mesh refinement might not always yield a meaningful solution in the vanishing viscosity limit keyfitz et al 2003 in several application oriented works the issue related to the hyperbolicity loss was apparently overcome by considering the real part of the pde system eigenvalues e g savary and zech 2007 chen and peng 2006 chen et al 2007 spinewine et al 2011 canestrelli et al 2012 yet these approaches basically rely on the intrinsic diffusion of the numerical scheme and may still experience oscillations of the numerical solution if the mesh is refined greco et al 2008 castro et al 2011 abgrall and karni 2009 introduced auxiliary variables to enforce a finite relaxation time for the pressure coupling between the layers which from the physical viewpoint is similar to assuming a finite speed of the pressure waves along the transverse to flow direction chiapolino and saurel 2018 this method ensures that the modified pde system is strictly hyperbolic but causes the uncoupling of the layers propagation speeds which is undesirable e g audusse 2005 castro et al 2012 attempted to describe the evolution of the intermediate mixing layer by locally shifting from two layer to a three layer model however this approach is computationally more expensive and does not completely solve the issue of the hyperbolicity loss since even the more sophisticated three layer model is only conditionally hyperbolic another physically based approach to avoid the loss of hyperbolicity consists of introducing an extra momentum exchange between the layers so as to keep the solution within the hyperbolic region namely renouncing to describe the dynamics of the mixing layer the dynamical effects of the interface instabilities on the two layers are approximately accounted for to determine the proper amount of this momentum exchange castro et al 2011 proposed to use an approximate hyperbolicity criterion suitable for boussinesq flows i e stratified flows with small density differences a generalization of this approach valid for any density difference is given by sarno et al 2017 where the system hyperbolicity is analytically checked by calculating the discriminant of the characteristic polynomial associated with the eigenvalue problem however this approach requires a more computationally expensive iterative algorithm to speed up the method by sarno et al 2017 krvavica et al 2018 proposed to calculate the discriminant and the entire eigenvalues set by the ferrari s formula for quartic equations abramowitz and stegun 1965 yet as reported also by krvavica et al 2018 the ferrari s analytical roots are prone to round off errors which may become relevant if the coefficients of the characteristic polynomial span over different orders of magnitude e g strobach 2010 considering these difficulties and also that the available analytical formulae are algebraically too complicated to reveal the essential features of the two layer model in this work we systematically studied the eigenstructure of the model by asymptotic analysis different assumptions on the variables involved in the system stability are alternatively made by considering the two limiting cases where the layers thicknesses are comparable and very different from each other we found new analytical stability criteria valid for any velocity difference and density ratio then with the help of an extensive numerical investigation general stability conditions are obtained by regularizing the two limiting cases the paper is organized as follows the two layer model and the issues related to the hyperbolicity loss are recalled in section 2 the asymptotic analyses are reported in section 3 in section 4 the reliability of the new stability criteria is numerically investigated and a family of approximate stability criteria valid for any flow condition is proposed in section 5 the new stability criteria are implemented in the numerical treatment for preserving the hyperbolicity the conclusions are summarized in section 6 2 the two layer model and the hyperbolicity loss the two layer depth averaged model describes the motion of two superimposed immiscible fluids and can be derived by a suitable asymptotic simplification of the depth averaged mass and momentum balance equations written separately for each layer depending on the specific physical problem the source terms of the model vary from case to case here we are interested in the essential properties of the two layer model thus we neglect all additional source terms depending on dissipative forces or mass exchanges between the layers considering an orthogonal cartesian frame of reference oxy with x parallel to the main flow direction and y being oriented opposite to the gravity vector g and denoting the upper and lower layers with subscripts 1 and 2 respectively the two layer model in one space variable x is written as e g kim and leveque 2008 1 t h 1 x h 1 u 1 0 t h 1 u 1 x 1 2 g h 1 2 h 1 u 1 2 g h 1 x h 2 g h 1 x b t h 2 x h 2 u 2 0 t h 2 u 2 x 1 2 g h 2 2 h 2 u 2 2 ρ 1 ρ 2 g h 2 x h 1 g h 2 x b here hi ui and ρ i are the thickness the depth averaged velocity and the density of the i th layer with i 1 2 while t is time and b x is the basal topography see the sketch in fig 1 the unknown functions are q q 1 q 2 q 3 q 4 t h 1 h 1 u 1 h 2 h 2 u 2 t hereafter the density ratio ρ 1 ρ 2 will be denoted with r the terms gh 1 x h 2 and rgh 2 x h 1 represent the pressure coupling between the layers and cause the pde system 1 to be non conservative moreover the non conservative terms prevent the definition of weak solutions in the classical sense e g toro 2013 so that the introduction of physically admissible paths connecting the states of the riemann problem becomes necessary dal maso et al 1995 parés 2006 the conservative part of 1 yields the following flux vector 2 f q q 2 1 2 g q 1 2 q 2 2 q 1 q 4 1 2 g q 3 2 q 4 2 q 3 t by rewriting 1 in the quasi linear form 3 t q a x q s with s 0 gh 1 x b 0 gh 2 x b t the non conservative matrix a non cons is incorporated into the pseudo jacobian matrix a 4 a q r q f a n o n c o n s 0 1 0 0 g q 1 q 2 2 q 1 2 2 q 2 q 1 0 0 0 0 0 1 0 0 g q 3 q 4 2 q 3 2 2 q 4 q 3 0 0 0 0 0 0 g q 1 0 0 0 0 0 r g q 3 0 0 0 one may be tempted to regard the non conservative terms a non cons x q as source terms and neglect them in the study of the system eigenstructure however neglecting the non conservative terms may cause incorrect characteristic speeds under infinitesimal perturbations at both the free surface barotropic speeds and the layers interface baroclinic speeds as an example for u 1 u 2 u and ρ 1 ρ 2 disregarding the non conservative terms yields wrong barotropic speeds u g h 1 which are smaller than the ones predicted by the classical shallow water model u g h 1 h 2 the correct perturbation speeds for the two layer model correspond to the eigenvalues of a i e to the roots of the characteristic polynomial 5 p a det a λ i λ 2 2 λ u 1 u 1 2 g h 1 λ 2 2 λ u 2 u 2 2 g h 2 r g 2 h 1 h 2 0 the pde system 3 is non strictly hyperbolic since the baroclinic eigenvalues may become complex it typically occurs if the relative velocity u 1 u 2 becomes sufficiently large so that kelvin helmholtz type instabilities are triggered at the internal interface in a linear model this occurrence would cause catastrophic hadamard instabilities which are characterized by unbounded growth rates of the short wave perturbations e g joseph and saut 1990 however in the two layer model such instabilities are somehow less catastrophic because the amplitudes of the perturbations saturate thanks to non linear effects and high frequency terms rapidly decay thanks to energy dissipation of shocks and other explicit dissipative mechanisms see e g keyfitz 2003 from the viewpoint of physics these non linear effects are associated with the onset of an intermediate mixing layer of finite thickness which a two layer approach is unable to describe the aforementioned hyperbolicity loss may cause relevant numerical issues which typically show up as unphysical oscillations of the solution if the mesh is refined e g greco et al 2008 castro et al 2011 a physics based way to overcome these numerical issues without the need to shift to a more complex model is the local introduction of an additional momentum exchange fextra for roughly capturing the effects of the turbulent like mixing between the layers castro et al 2011 namely the momentum equations of the pde system 1 are slightly modified as follows 6 t h 1 u 1 x 1 2 g h 1 2 h 1 u 1 2 g h 1 x h 2 g h 1 x b f e x t r a sgn u 1 u 2 t h 2 u 2 x 1 2 g h 2 2 h 2 u 2 2 r g h 2 x h 1 g h 2 x b r f e x t r a sgn u 1 u 2 if as usual fextra cannot be estimated on a physical basis the amount of fextra has to be sufficient to keep the solution within the hyperbolic region this amount may be calculated by an approximate formula castro et al 2011 or by a more accurate and yet more computationally demanding iterative algorithm based on the study of the system hyperbolicity sarno et al 2017 to check the system hyperbolicity for a particular solution q several approaches are possible one of them is to numerically calculate the eigenvalues of a q r yet this method is rather time consuming and requires the tedious calculation of the entire eigenvalues set which is unnecessary if the chosen numerical scheme is based on an incomplete riemann or riemann free solver 2 1 the discriminant method a more computationally appealing alternative is to check the hyperbolicity by calculating the discriminant d of the characteristic polynomial 5 since two of the four roots are always real the other two ones are real if and only if d p a 0 e g dickenstein and emiris 2005 a general analytical formula for the discriminant of a n degree polynomial f x anxn a n 1 x n 1 a 1 x a 0 reads 7 d f 1 1 2 n n 1 1 a n det r f f where f is the first derivative of f and r f f is the sylvester matrix of f and f for a quartic polynomial n 4 7 is recast as 8 d f 256 a 4 3 a 0 3 192 a 4 2 a 3 1 a 1 1 a 0 2 128 a 4 2 a 2 2 a 0 2 144 a 4 2 a 2 1 a 1 2 a 0 1 27 a 4 2 a 1 4 144 a 4 1 a 3 2 a 2 1 a 0 2 6 a 4 1 a 3 2 a 1 2 a 0 1 80 a 4 1 a 3 1 a 2 2 a 1 1 a 0 1 18 a 4 1 a 3 1 a 2 1 a 1 3 16 a 4 1 a 2 4 a 0 1 4 a 4 1 a 2 3 a 1 2 27 a 3 4 a 0 2 18 a 3 3 a 2 1 a 1 1 a 0 1 4 a 3 3 a 1 3 4 a 3 2 a 2 3 a 0 1 a 3 2 a 2 2 a 1 2 eq 8 was proposed by sarno et al 2017 to check the stability of the two layer model and it has been found to be approximately four times faster than the numerical calculation of the eigenvalues performance comparison tests have been carried out in matlab by confronting the computation time of 8 with the one of the eig built in matlab function although 8 is an analytical exact expression we found that relevant cancellation errors may occur when fixed precision variables are employed and the coefficients in 8 spread over several orders of magnitude unfortunately it may occasionally happen also in cases of practical interest i e when the layers velocities are relatively large e g for the values h 1 h 2 0 1 m u 1 16 m s u 2 15 m s r 0 5 and g 9 806 m s2 the formula 8 with a standard double precision floating point format 64bit wrongly yields a non hyperbolic state d 0 a computationally more efficient reformulation of 8 which also greatly reduces the round off errors is reported by krvavika et al 2018 9 d f 4 a 2 2 12 a 0 3 a 3 a 1 3 27 a 3 2 a 0 9 a 3 a 2 a 1 2 a 2 3 72 a 2 a 0 27 a 1 2 2 27 eq 9 was derived from the ferrari s analytical solution of the quartic equation which is based on the solution of the cubic resolvent equation by the cardano s method abramowitz and stegun 1965 it can be easily verified that 8 is equivalent to 9 after normalizing a 4 1 krvavica et al 2018 reported that cancellation errors of the ferrari s analytical solution are typically not an issue for realistic values of layers thicknesses 0 100m and velocities between 20 and 20 m s yet we found that 9 may still yield wrong information about the system hyperbolicity for cases with small layers thicknesses typically 0 01m and large layers velocities 15m s these numerical issues can be overcome by adopting arbitrary precision instead of double precision arithmetic but it would cause increased computation time and implementation difficulties in some programming environments moreover it is unfortunate that the discriminant method does not allow a genuine understanding of the stability problem in terms of interplay of the involved variables that is it does not provide explicit information about the deviation of the solution from the hyperbolic non hyperbolic boundary hence if the discriminant is employed to check the system hyperbolicity an iterative algorithm is required to determine the proper amount of fextra sarno et al 2017 2 2 approximate formulae to check the system hyperbolicity a different approach to check the model stability is by means of an approximate criterion the classical approximate formula for boussinesq flows schijf and schönfled 1953 10 u 1 u 2 2 g 1 r h 1 h 2 1 was proposed by castro et al 2011 to verify the model hyperbolicity and to directly calculate fextra yet the condition 10 is only accurate for 1 r 0 as an example in fig 2 we report the approximate hyperbolic non hyperbolic boundary predicted by 10 and a number of hyperbolic and non hyperbolic states numerically calculated in correspondence to random values of h 1 h 1 u 1 h 2 h 2 u 2 t with density ratios r 0 95 r 0 5 and r 0 2 two different hyperbolic regions exist in green color in fig 2 in geophysical flows only the left hyperbolic region is of physical interest since these flows are typically driven by gravity from a state of rest with non vanishing depths castro et al 2011 the right hyperbolic region could become relevant in industrial and astrophysical contexts if the initial velocities were non zero for r 0 95 fig 2 a the approximate stability condition 10 well describes the boundary of left hyperbolic region while it becomes progressively inaccurate as the density ratio decreases fig 2 b c fig 2 also reveals that the boundaries of the non hyperbolic region become fuzzy for small enough values of r fig 2 b c as highlighted by sarno et al 2017 this scatter only shows up in the plot u 1 u 2 vs h 1 h 2 while the boundaries of the hyperbolic regions are sharp in the space of h 1 h 1 u 1 h 2 h 2 u 2 t such a behavior is caused by the fact that states with the same value of h 1 h 2 may represent different thickness differences between the layers on which the stability also depends see e g lawrence 1990 namely the intermediate fuzzy regions whose extensions grow with 1 r correspond to states that may be either hyperbolic or non hyperbolic depending on the relative thickness of the layers conversely the uniformly colored areas in fig 2 correspond to states that are hyperbolic or non hyperbolic independent from the relative thickness 3 asymptotic analyses to get a deeper understanding of the stability conditions in the two layer model here we report different asymptotic analyses on the eigenstructure of 3 all the factors on which the stability depends i e velocity density and layers thickness differences are methodically investigated the first analysis reported in sec 3 1 is based on the classical assumption of small velocity differences between the layers the asymptotic expansions for the special cases r 0 and r 1 are discussed in sec 3 1 while the relevant case r 1 is reported separately in sec 3 1 1 a second group of asymptotic analyses is carried out assuming that the thicknesses of the layers h 1 and h 2 are either comparable h 1 h 2 h 1 h 2 1 sec 3 2 or very different from each other 1 h 1 h 2 h 1 h 2 1 sec 3 3 3 1 asymptotic analysis for small velocity differences here we study the eigenstructure of the characteristic equation 5 associated with the pde system 3 by assuming that the velocity difference between the layers is small the cases of r 0 r 1 and r 1 are investigated as special cases we define the asymptotic parameter ε u 1 u 2 u m with um being some non zero characteristic velocity and assume that ε u 1 u 2 u m 1 the solution of the eigenvalue problem can be approximated by an asymptotic expansion λ λ 0 λ 1 ε λ 2 ε 2 λ n ε n o ε n 1 after substituting u 2 u 1 εum eq 5 is recast as 11 λ 2 2 λ u 1 g h 1 u 1 2 λ 2 2 λ u 1 ε u m g h 2 u 1 ε u m 2 r g 2 h 1 h 2 0 substituting the expansion λ λ 0 λ 1 ε λ 2 ε 2 in 11 and neglecting higher order terms the o ε 0 equation is 12 λ 0 2 2 λ 0 u 1 g h 1 u 1 2 λ 0 2 2 λ 0 u 1 g h 2 u 1 2 r g 2 h 1 h 2 0 eq 12 is biquadratic in λ 0 u 1 hence the roots are given by 13 λ 0 1 u 1 g 2 h 1 h 2 h 1 h 2 2 4 1 r h 1 h 2 λ 0 2 u 1 g 2 h 1 h 2 h 1 h 2 2 4 1 r h 1 h 2 λ 0 3 u 1 g 2 h 1 h 2 h 1 h 2 2 4 1 r h 1 h 2 λ 0 4 u 1 g 2 h 1 h 2 h 1 h 2 2 4 1 r h 1 h 2 it can be easily verified that λ 0 in 13 are real for 0 r 1 in the limiting case r 0 i e zero pressure coupling between layers 13 yields λ 0 1 2 u 1 g h 1 and λ 0 3 4 u 1 g h 2 which match the eigenvalues of the shallow water model written separately for the two layers in the other limiting case r 1 λ 0 1 2 u 1 g h 1 h 2 and λ 0 3 4 u 1 where the barotropic speeds match the eigenvalues of the shallow water model written for the entire current the o ε 1 equation obtained from 11 by collecting o ε 1 terms reads 14 λ 0 2 2 u 1 λ 0 u 1 2 g h 1 2 λ 0 λ 1 2 u 1 λ 1 2 u m λ 0 2 u 1 u m λ 0 2 2 u 1 λ 0 u 1 2 g h 2 2 λ 0 λ 1 2 u 1 λ 1 0 whence 15 λ 1 u m λ 0 2 2 u 1 λ 0 g h 1 u 1 2 λ 0 u 1 2 λ 0 2 4 u 1 λ 0 2 u 1 2 g h 2 g h 1 λ 0 u 1 by substituting λ 0 1 λ 0 2 λ 0 3 λ 0 4 into 15 the four o ε 1 coefficients λ 1 1 λ 1 2 λ 1 3 λ 1 4 are 16 λ 1 1 2 u m h 1 h 2 h 1 h 2 2 4 1 r h 1 h 2 2 h 1 h 2 2 4 1 r h 1 h 2 λ 1 3 4 u m h 2 h 1 h 1 h 2 2 4 1 r h 1 h 2 2 h 1 h 2 2 4 1 r h 1 h 2 if r 0 λ 1 1 2 0 and λ 1 3 4 u m conversely if r 1 λ 1 1 2 h 2 u m h 1 h 2 while λ 1 3 4 are indeterminate because eq 14 is identically satisfied for λ 0 3 4 u 1 the o ε 2 equation is 17 λ 0 2 2 u 1 λ 0 u 1 2 g h 1 2 λ 0 λ 2 2 u 1 λ 2 λ 1 2 2 u m λ 1 u m 2 λ 0 2 2 u 1 λ 0 u 1 2 g h 2 2 λ 0 λ 2 2 u 1 λ 2 λ 1 2 2 λ 0 λ 1 2 u 1 λ 1 2 λ 0 λ 1 2 u 1 λ 1 2 u m λ 0 2 u 1 u m 0 whence 18 λ 2 6 λ 0 2 12 u 1 λ 0 6 u 1 2 g h 2 g h 1 λ 1 2 6 λ 0 2 12 u 1 λ 0 6 u 1 2 2 g h 1 u m λ 1 u m 2 λ 0 λ 0 2 u 1 u 1 2 g h 1 u m 2 4 λ 0 3 12 u 1 λ 0 2 12 u 1 2 2 g h 2 2 g h 1 λ 0 4 u 1 3 2 g h 2 2 g h 1 u 1 by substituting λ 0 1 2 3 4 and λ 1 1 2 3 4 into 18 the o ε 2 coefficients λ 2 1 λ 2 2 λ 2 3 λ 2 4 are obtained if r 0 the o ε 2 coefficients are 19 λ 2 1 h 2 u m 2 4 h 1 2 h 1 h 2 h 2 2 2 g h 1 h 1 h 2 2 h 1 h 2 λ 2 2 λ 2 1 λ 2 3 h 1 u m 2 h 1 2 h 1 h 2 4 h 2 2 2 g h 2 h 1 h 2 2 h 1 h 2 λ 2 4 λ 2 3 conversely if r 1 eq 17 yields 20 λ 2 1 3 h 1 h 2 u m 2 2 g h 1 h 2 5 2 λ 2 2 3 h 1 h 2 u m 2 2 g h 1 h 2 5 2 λ 2 3 and λ 2 4 indeterminate after substituting λ 0 3 4 u 1 into eq 17 the following equation determining the still unknown o ε 1 coefficients λ 1 3 and λ 1 4 emerges 21 g h 1 λ 1 2 2 u m λ 1 u m 2 g h 2 λ 1 2 0 whence 22 λ 1 3 h 1 i h 1 h 2 u m h 1 h 2 λ 1 4 h 1 i h 1 h 2 u m h 1 h 2 for r 1 eq 17 cannot determine λ 2 3 and λ 2 4 hence we need to study the o ε 3 equation 23 λ 0 2 2 u 1 λ 0 u 1 2 g h 1 2 λ 0 λ 3 2 u 1 λ 3 2 λ 1 λ 2 2 u m λ 2 λ 0 2 2 u 1 λ 0 u 1 2 g h 2 2 λ 0 λ 3 2 u 1 λ 3 2 λ 1 λ 2 2 λ 0 λ 1 2 u 1 λ 1 2 λ 0 λ 2 2 u 1 λ 2 λ 1 2 2 u m λ 1 u m 2 2 λ 0 λ 1 2 u 1 λ 1 2 u m λ 0 2 u 1 u m 2 λ 0 λ 2 2 u 1 λ 2 0 substituting λ 0 3 4 u 1 and λ 1 λ 1 3 4 of 22 into eq 23 we get 24 g h 1 2 λ 1 λ 2 2 u m λ 2 2 g h 2 λ 1 λ 2 0 which results in λ 2 3 4 0 in summary for r 1 the second order expansions of the pde system eigenvalues are 25 λ 1 λ 0 1 λ 1 1 ε 1 λ 2 1 ε 2 o ε 3 h 1 u 1 h 2 u 2 h 1 h 2 g h 1 h 2 3 h 1 h 2 u 1 u 2 2 2 g h 1 h 2 5 2 o u 1 u 2 3 u m 3 26 λ 2 h 1 u 1 h 2 u 2 h 1 h 2 g h 1 h 2 3 h 1 h 2 u 1 u 2 2 2 g h 1 h 2 5 2 o u 1 u 2 3 u m 3 27 λ 3 h 1 u 2 h 2 u 1 h 1 h 2 i u 1 u 2 2 1 h 1 h 2 h 1 h 2 2 o u 1 u 2 3 u m 3 28 λ 4 h 1 u 2 h 2 u 1 h 1 h 2 i u 1 u 2 2 1 h 1 h 2 h 1 h 2 2 o u 1 u 2 3 u m 3 where λ 1 2 and λ 3 4 are the barotropic and baroclinic speeds respectively the first order truncations of 25 26 27 28 recover the approximations reported by audusse 2005 for layered flows of uniform density for r 1 it is worth remarking that any non zero velocity difference between the layers immediately causes the loss of hyperbolicity the modulus of the imaginary parts of λ 3 4 is bounded by u 1 u 2 2 and depends on the factor 1 h 1 h 2 h 1 h 2 2 1 note that beside the case u 1 u 2 0 the system is asymptotically stable even if one layer thickness becomes negligible compared to the other h 1 h 2 h 1 h 2 1 the importance of the quantity κ h 1 h 2 h 1 h 2 hereafter referred to as relative thickness difference confirms that the source of instability due to r 1 and a non zero velocity difference ultimately depends on the pressure coupling between the layers and thus to be effective requires that the layers thicknesses are non negligible with respect to each other the degenerate hyperbolic region is given by the criterion 29 u 1 u 2 2 1 κ 0 3 1 1 special case r 1 o ε α here we assume that r is slightly smaller than 1 with 1 r o ε α α 2 the o ε 0 equation 12 is thus recast as 30 λ 0 2 2 λ 0 u 1 g h 1 u 1 2 λ 0 2 2 λ 0 u 1 g h 2 u 1 2 g 2 h 1 h 2 0 and admits the same roots λ 0 1 2 u 1 g h 1 h 2 λ 0 3 4 u 1 already found for r 1 the remaining part of rg 2 h 1 h 2 i e the term 1 r g 2 h 1 h 2 cannot be accounted for in the o ε 1 equation since the modified o ε 1 equation would have no solutions for the two baroclinic branches i e with λ 0 3 4 u 1 we would get 1 r ε g 2 h 1 h 2 0 thus from the o ε 1 equation we get the same roots of r 1 conversely the o ε 2 equation 17 is rewritten as follows 31 λ 0 2 2 u 1 λ 0 u 1 2 g h 1 2 λ 0 λ 2 2 u 1 λ 2 λ 1 2 2 u m λ 1 u m 2 λ 0 2 2 u 1 λ 0 u 1 2 g h 2 2 λ 0 λ 2 2 u 1 λ 2 λ 1 2 2 λ 0 λ 1 2 u 1 λ 1 2 λ 0 λ 1 2 u 1 λ 1 2 u m λ 0 2 u 1 u m 1 r ε 2 g 2 h 1 h 2 0 the barotropic roots λ 2 1 and λ 2 2 are slightly different than the ones from 20 32 λ 2 1 3 h 1 h 2 u m 2 2 g h 1 h 2 5 2 g 1 r h 1 h 2 h 1 h 2 u m 2 2 g h 1 h 2 5 2 u 1 u 2 2 λ 2 2 3 h 1 h 2 u m 2 2 g h 1 h 2 5 2 g 1 r h 1 h 2 h 1 h 2 u m 2 2 g h 1 h 2 5 2 u 1 u 2 2 while λ 2 3 4 are indeterminate analogous to that found with 20 indeed after substituting λ 0 3 4 u 1 into 31 we get 33 g h 1 λ 1 2 2 u m λ 1 u m 2 g h 2 λ 1 2 1 r ε 2 g 2 h 1 h 2 0 which substituting ε u 1 u 2 u m is recast as 34 g h 1 λ 1 2 2 u m λ 1 u m 2 g h 2 λ 1 2 1 r u 1 u 2 2 u m 2 g 2 h 1 h 2 0 eq 34 allows to determine the still unknown first order baroclinic coefficients 35 λ 1 3 u m h 1 u 1 u 2 h 1 h 2 g 1 r h 1 h 2 u 1 u 2 2 h 1 h 2 u 2 u 1 λ 1 4 u m h 1 u 1 u 2 h 1 h 2 g 1 r h 1 h 2 u 1 u 2 2 h 1 h 2 u 2 u 1 λ 1 3 4 are real numbers if and only if 36 g 1 r h 1 h 2 u 1 u 2 2 0 the stability condition 36 here derived under the hypothesis that r 1 o ε α recovers the approximate criterion 10 different from the case with r 1 the hyperbolic domain is not degenerate yet only the left hyperbolic region cf fig 2 is predicted by 36 since this condition is still based on the assumption of small velocity differences moreover it is interesting to note that different from the stability criterion 29 36 depends on the quantities 1 r h 1 h 2 u 1 u 2 but not on κ h 1 h 2 h 1 h 2 it indicates that κ is not critical for the stability if r is smaller but close to 1 nonetheless we anticipate cf sec 3 4 that beyond the range of validity of cond 36 some effects of κ on the stability arise similar to that already observed in cond 29 finally to determine λ 2 3 and λ 2 4 we use the o ε 3 equation 23 which is unchanged substituting λ 0 3 4 u 1 and the expressions of λ 1 3 4 reported in 35 into 23 it can be checked that also in this case λ 2 3 4 0 the expansions of the eigenvalues up to o ε 2 for r 1 o ε α are summarized below 37 λ 1 2 λ 0 1 2 λ 1 1 2 ε 1 λ 2 1 2 ε 2 o ε 3 h 1 u 1 h 2 u 2 h 1 h 2 g h 1 h 2 3 h 1 h 2 u 1 u 2 2 2 g h 1 h 2 5 2 g 1 r h 1 h 2 h 1 h 2 2 g h 1 h 2 5 2 o u 1 u 2 3 u m 3 38 λ 3 4 h 2 u 1 h 1 u 2 h 1 h 2 g 1 r h 1 h 2 h 1 h 2 u 1 u 2 2 h 1 h 2 h 1 h 2 2 o u 1 u 2 3 u m 3 by truncating 37 38 at the first order we recover the classical formulae by schijf and schönfled 1953 3 2 asymptotic analysis for layers of comparable thicknesses here we perform a different asymptotic analysis by assuming that the layers thicknesses are comparable namely we introduce the alternative asymptotic parameter ε h 2 h 1 h 1 h 2 with ε 1 thus the layers thicknesses are expressed as h 1 h ε h and h 2 h ε h with h h 1 h 2 2 without loss of generality the layers velocities can be written as u 1 u δ u 2 and u 2 u δ u 2 with u u 1 u 2 2 and δu u 1 u 2 therefore eq 5 is recast as 39 λ 2 2 λ u δ u 2 u δ u 2 2 g h ε h λ 2 2 λ u δ u 2 u δ u 2 2 g h ε h r g 2 h ε h h ε h 0 substituting λ λ 0 λ 1 ε λ 2 ε 2 o ε 3 into 39 the o ε 0 equation is 40 λ 0 2 2 λ 0 u δ u 2 u δ u 2 2 g h λ 0 2 2 λ 0 u δ u 2 u δ u 2 2 g h r g 2 h 2 0 although less obvious than the case of eq 12 also 40 is a biquadratic equation indeed introducing the variable ζ λ 0 u 2 40 is recast as 41 ζ 2 2 g h 1 2 δ u 2 ζ g 2 h 2 1 r δ u 2 1 16 δ u 2 1 2 g h 0 which yields the solutions 42 λ 0 1 u 1 2 δ u 2 4 g h 4 g h δ u 2 r g h λ 0 2 u 1 2 δ u 2 4 g h 4 g h δ u 2 r g h λ 0 3 u 1 2 δ u 2 4 g h 4 g h δ u 2 r g h λ 0 4 u 1 2 δ u 2 4 g h 4 g h δ u 2 r g h where the superscripts 1 2 and 3 4 respectively stand for the barotropic and baroclinic branches while λ 0 1 2 are always real λ 0 3 4 are real if and only if 43 δ u 2 4 g h 4 g h δ u 2 r g h the o ε 1 equation associated with 39 is 44 4 λ 0 3 12 u λ 0 2 12 u 2 4 g h δ u 2 λ 0 4 u 3 4 g h δ u 2 u λ 1 2 δ u g h λ 0 2 δ u g h u 0 its solution takes the form 45 λ 1 2 δ u g h λ 0 u 4 λ 0 3 12 u λ 0 2 12 u 2 4 g h δ u 2 λ 0 4 u 3 4 g h δ u 2 u substituting the o ε 0 solutions λ 0 1 2 3 4 into 45 we obtain 46 λ 1 1 2 δ u g h 2 g h r g h δ u 2 λ 1 3 4 δ u g h 2 g h r g h δ u 2 the o ε 2 equation is obtained from 39 47 8 λ 0 3 24 u λ 0 2 24 u 2 8 g h 2 δ u 2 λ 0 8 u 3 8 g h 2 δ u 2 u λ 2 12 λ 0 2 24 u λ 0 12 u 2 4 g h δ u 2 λ 1 2 4 δ u g h λ 1 2 g 2 h 2 r 2 g 2 h 2 0 whence 48 λ 2 12 λ 0 2 24 u λ 0 12 u 2 4 g h δ u 2 λ 1 2 4 δ u g h λ 1 2 g 2 h 2 r 2 g 2 h 2 8 λ 0 3 24 u λ 0 2 24 u 2 8 g h 2 δ u 2 λ 0 8 u 3 8 g h 2 δ u 2 u substituting the o ε 0 and o ε 1 coefficients into 47 we get 49 λ 2 1 g h r g h δ u 2 2 r g h δ u 2 2 4 r g 2 h 2 2 δ u 2 g h r g h δ u 2 8 r g h δ u 2 2 4 g h δ u 2 4 g h r g h δ u 2 λ 2 2 λ 2 1 λ 2 3 g h r g h δ u 2 2 r g h δ u 2 2 4 r g 2 h 2 2 δ u 2 g h r g h δ u 2 8 r g h δ u 2 2 4 g h δ u 2 4 g h r g h δ u 2 λ 2 4 λ 2 3 in summary the asymptotic expansions up to the second order are put together below 50 λ 1 u 1 u 2 2 1 2 δ u 2 4 g h 4 g h r g h δ u 2 δ u g h 2 g h r g h δ u 2 h 2 h 1 h 1 h 2 1 g h r g h δ u 2 2 r g h δ u 2 2 4 r g 2 h 2 2 δ u 2 g h r g h δ u 2 8 r g h δ u 2 2 δ u 2 4 g h 4 g h r g h δ u 2 h 2 h 1 h 1 h 2 2 o h 2 h 1 3 h 1 h 2 3 51 λ 2 u 1 u 2 2 1 2 δ u 2 4 g h 4 g h r g h δ u 2 δ u g h 2 g h r g h δ u 2 h 2 h 1 h 1 h 2 1 g h r g h δ u 2 2 r g h δ u 2 2 4 r g 2 h 2 2 δ u 2 g h r g h δ u 2 8 r g h δ u 2 2 δ u 2 4 g h 4 g h r g h δ u 2 h 2 h 1 h 1 h 2 2 o h 2 h 1 3 h 1 h 2 3 52 λ 3 u 1 u 2 2 1 2 δ u 2 4 g h 4 g h r g h δ u 2 δ u g h 2 g h r g h δ u 2 h 2 h 1 h 1 h 2 1 g h r g h δ u 2 2 r g h δ u 2 2 4 r g 2 h 2 2 δ u 2 g h r g h δ u 2 8 r g h δ u 2 2 δ u 2 4 g h 4 g h r g h δ u 2 h 2 h 1 h 1 h 2 2 o h 2 h 1 3 h 1 h 2 3 53 λ 4 u 1 u 2 2 1 2 δ u 2 4 g h 4 g h r g h δ u 2 δ u g h 2 g h r g h δ u 2 h 2 h 1 h 1 h 2 1 g h r g h δ u 2 2 r g h δ u 2 2 4 r g 2 h 2 2 δ u 2 g h r g h δ u 2 8 r g h δ u 2 2 δ u 2 4 g h 4 g h r g h δ u 2 h 2 h 1 h 1 h 2 2 o h 2 h 1 3 h 1 h 2 3 3 2 1 stability criterion for layers of comparable thicknesses the above asymptotic expansions carried out for κ h 2 h 1 h 1 h 2 1 may yield two complex eigenvalues as λ 0 3 4 may become complex conversely λ 1 and λ 2 are always real for all branches of the solution as the dominant imaginary parts of λ 3 4 are given by the corresponding o ε 0 coefficients the inequality 43 can be regarded as a criterion for the pde system hyperbolicity which is exact for κ 0 after some algebraic manipulations 43 is recast as 54 g 2 1 r h 1 h 2 2 δ u 2 g h 1 h 2 δ u 2 4 0 it is interesting to compare cond 54 with 36 derived under the hypotheses of δu 0 and r 1 the two conditions show a similar structure with the only difference being represented by the term δ u 2 4 which has a stabilizing effect for δu 0 cond 54 recovers the stability criterion 36 thanks to the quadratic term δu 2 54 describes two separate hyperbolic regions and thus is also capable of capturing the right hyperbolic region cf fig 2 please note that the left hand side of 54 is a second degree polynomial in the two variables h 1 h 2 and δu 2 and hence it can be easily factorized consequently 54 is decomposed into the following two conditions 55 δ u 2 2 g 1 r h 1 h 2 0 56 δ u 2 2 g 1 r h 1 h 2 0 which respectively correspond to the left and right hyperbolic domains for 1 r 0 thus 2 1 r 1 r hence the leading order approximation of 55 recovers the stability criterion 36 this remarkable correspondence between the two stability criteria also explains why in the limit of 1 r 0 the classical criterion 36 gives a reasonably good estimation of the hyperbolic boundary even for large values of δu cf fig 2 a for r 0 55 56 are alternatively verified for any flow condition as the middle non hyperbolic region vanishes 3 3 asymptotic analysis for the limiting case of very large thickness difference finally we perform the asymptotic analysis for κ 1 we assume that h 2 h 1 and thus h 2 h 1 h 1 h 2 1 however note that eq 5 is symmetric with respect to the layers indices hence the choice of h 2 h 1 is irrelevant in this analysis here we define the asymptotic parameter as ε 1 h 2 h 1 h 1 h 2 0 hence the layers thicknesses are h 1 ε h and h 2 2 ε h with h h 1 h 2 2 as in sec 3 2 we use the notation u 1 u δ u 2 u 2 u δ u 2 with u u 1 u 2 2 and δu u 1 u 2 eq 5 is recast as 57 λ 2 2 λ u δ u 2 u δ u 2 2 g ε h λ 2 2 λ u δ u 2 u δ u 2 2 g h 2 ε r g 2 h 2 2 ε ε 0 the o ε 0 equation is 58 λ 0 2 2 λ 0 u δ u 2 u δ u 2 2 λ 0 2 2 λ 0 u δ u 2 u δ u 2 2 2 g h 0 whence 59 λ 0 1 u δ u 2 2 g h u 2 g h 1 h 2 λ 0 2 λ 0 1 λ 0 3 u δ u 2 u 1 λ 0 4 λ 0 3 the o ε 1 equation is 60 4 λ 0 3 12 u λ 0 2 12 u 2 4 g h δ u 2 λ 0 4 u 3 4 g h δ u 2 u 2 δ u g h λ 1 2 δ u g h u 1 λ 0 2 1 r g 2 h 2 0 substituting λ 0 1 2 in 60 we obtain the two barotropic coefficients 61 λ 1 1 δ u g h 8 g h δ u 2 g 2 h 2 1 r 8 g h 2 g h δ u 2 8 δ u g h λ 1 2 δ u g h 8 g h δ u 2 g 2 h 2 1 r 8 g h 2 g h δ u 2 8 δ u g h conversely substituting λ 0 3 4 in 60 we get 62 0 λ 1 2 g 2 h 2 1 r δ u 2 g h 0 which does not allow to determine λ 1 3 4 moreover eq 62 is verified only for certain values of the solution thus we need to take into account the non zero remainder of the left hand side of 62 in the baroclinic branches of the o ε 2 equation the o ε 2 equation valid for the barotropic branches of the solution is given by 63 4 λ 0 3 12 u λ 0 2 12 u 2 4 g h δ u 2 λ 0 4 u 3 4 g h δ u 2 u 2 δ u g h λ 2 6 λ 0 2 12 u λ 0 6 u 2 2 g h 1 2 δ u 2 λ 1 2 2 δ u g h λ 1 r 1 g 2 h 2 0 after substituting λ 0 1 2 and λ 1 1 2 into 63 we obtain the coefficients λ 2 1 and λ 2 2 not reported here for brevity differently for the two baroclinic branches the o ε 2 equation 63 is modified with the remainder of 62 namely 64 4 λ 0 3 12 u λ 0 2 12 u 2 4 g h δ u 2 λ 0 4 u 3 4 g h δ u 2 u 2 δ u g h λ 2 6 λ 0 2 12 u λ 0 6 u 2 2 g h 1 2 δ u 2 λ 1 2 2 δ u g h λ 1 r 1 g 2 h 2 2 g 2 h 2 1 r δ u 2 g h ε 0 by substituting λ 0 3 4 into 64 we obtain the following equation in λ 1 65 ε 2 g h δ u 2 λ 1 2 2 ε δ u g h λ 1 ε 2 2 ε r g 2 h 2 δ u 2 g h 0 whence 66 λ 1 3 2 ε δ u g h 4 ε 2 δ u 2 g 2 h 2 4 ε 2 g h δ u 2 ε 2 2 ε r g 2 h 2 δ u 2 g h 2 ε 2 g h δ u 2 λ 1 4 2 ε δ u g h 4 ε 2 δ u 2 g 2 h 2 4 ε 2 g h δ u 2 ε 2 2 ε r g 2 h 2 δ u 2 g h 2 ε 2 g h δ u 2 obviously λ 1 3 and λ 1 4 are real if and only if 67 δ u 4 δ u 2 g h 1 h 2 2 r 1 ε 2 g 2 h 1 h 2 2 1 r 1 ε 2 0 in the limit that ε 0 67 is recast as 68 δ u 4 δ u 2 g h 1 h 2 2 r g 2 h 1 h 2 2 1 r 0 equivalent to 69 δ u 2 g h 1 h 2 δ u 2 g 1 r h 1 h 2 0 69 can be decomposed into the following inequalities 70 δ u 2 g 1 r h 1 h 2 0 71 δ u 2 g h 1 h 2 0 it is interesting to note that cond 70 is equivalent to 36 derived with the completely different assumptions of 1 r 0 and δu 0 on the one hand it suggests that for the stability κ 1 is equivalent to assuming 1 r 0 it is reasonable considering that both factors play a similar role in the model stability through the pressure distributions within the layers however it should be remarked that cond 70 is valid for any density ratio and hence it expands the range of validity of 36 another clear advantage of the present analysis over the previous asymptotical analysis with δu 1 is that a description of the right hyperbolic region is also provided cond 71 comparing cond 70 with 55 it can be also noted that the left hyperbolic region by 70 is strictly contained in the region by 55 thus conditions 55 and 70 whose difference vanishes for r 1 are lower and upper bounds for the left boundary of the non hyperbolic region cf fig 2 conversely conditions 71 and 56 represent the upper and lower bounds of the right boundary 3 4 general stability conditions the latter asymptotic analyses carried out by respectively assuming small and diverging thickness differences between the layers provided new stability criteria 55 56 and 70 71 capable of describing both left and right hyperbolic regions clearly for intermediate values of κ the criteria 55 56 derived for κ 1 and especially the criteria 70 71 derived in the sharp limit of κ 1 are expected to yield some errors yet the analytical structures of 55 56 and 70 71 are very similar and characterized by a proportionality between δu 2 and h 1 h 2 through a certain factor depending on r thus by keeping this analytical structure it could be possible to derive a general stability criterion also valid for intermediate values of κ by assuming that the limiting conditions 55 56 and 70 71 are smoothly connected to each other by two regularization functions ξ1 κ r and ξ2 κ r a generalized reformulation of 55 56 can be written in the following compact forms 72 δ u 2 2 g 1 r ξ 1 κ r h 1 h 2 1 73 δ u 2 2 g 1 r ξ 2 κ r h 1 h 2 1 where ξ1 κ r and ξ2 κ r have to fulfill the following constraints 74 ξ 1 0 r 1 ξ 2 0 r 1 ξ 1 1 r 1 r 2 1 r ξ 2 1 r 1 2 1 r in the limiting cases of r 0 and r 1 74 yields 75 ξ 1 1 0 ξ 2 1 0 1 2 ξ 1 1 1 1 ξ 2 1 1 1 4 4 numerical tests and approximate stability criteria in this section by an extensive numerical investigation we propose suitable approximations of the functions ξ1 and ξ2 sketched in 72 73 subsequently we investigate the reliability of the various stability criteria 4 1 calibration of the regularization functions the asymptotic analyses for κ 1 and κ 1 indicate that the boundaries between the hyperbolic and non hyperbolic regions may be described by a linear relationship between δu 2 and h 1 h 2 we numerically checked that this behavior is also verified for intermediate values of 0 κ 1 after setting arbitrary values for κ and r we generated 106 random values of h 1 h 1 u 1 h 2 h 2 u 2 t in the ranges 0 m h 1 h 2 50 m and 0 u 1 u 2 20 m s different from the random generations reported in fig 2 here the layers thicknesses h 1 and h 2 are constrained by the fixed κ h 1 h 2 h 1 h 2 chosen a priori the following values of κ and r encompassing the entire range of flow conditions have been investigated 76 k 0 01 0 1 0 2 0 3 0 4 0 5 0 6 0 7 0 8 0 9 0 99 77 r 0 01 0 1 0 2 0 3 0 4 0 5 0 6 0 7 0 8 0 9 0 99 the numerical data confirm that the boundaries of the hyperbolic and non hyperbolic regions always exhibit a linear behavior for any choice of κ and r as an example fig 3 reports the hyperbolic and non hyperbolic states in the plane δu 2 h 1 h 2 for the case κ 0 5 and r 0 2 from fig 3 it can be noted that the boundaries between hyperbolic and non hyperbolic regions are sharp different from fig 2 b it is due to the fact that here all states share the same κ by numerically tracking the linear boundaries of the non hyperbolic region for each investigated combination of κ r we calculated the best fitting ratios h 1 h 2 δ u 2 at the boundaries the coefficient of determination r 2 was found 0 99 for all investigated combinations of κ and r then by exploiting 72 73 we obtained numerical point wise estimations of the regularization functions denoted as ξ 1 κ r and ξ 2 κ r considering the generalized stability conditions 72 73 and the constraints 74 we propose the following exponential functions for ξ1 κ r and ξ2 κ r 78 ξ 1 κ r exp ln 1 r 1 κ a 1 1 r 2 r 2 1 r b 1 κ c 1 79 ξ 2 κ r exp ln 1 1 κ a 2 1 2 r 2 1 r b 2 κ c 2 where the parameters ai bi and ci have to be calibrated on ξ 1 and ξ 2 note that 78 79 are constructed in such a way that for κ 0 the first two conditions of 74 are fulfilled in a smooth way conversely for κ 1 78 and 79 respectively tend to 1 r 2 1 r and 1 2 1 r as required by the other two constraints the best fitting values of ai bi and ci are reported in table 1 together with the fitness indicators r 2 coefficient of determination sse sum of squares due to error and rmse root mean square error moreover comparisons between ξ1 and ξ 1 and between ξ2 and ξ 2 are reported in fig 4 as shown in table 1 and in fig 4 the agreement between the best fitting functions 78 79 and the numerical data is very good it confirms that the choice of the simple analytical functions 78 and 79 is reasonable more sophisticated functions with a higher number of parameters would further improve the description of ξ1 and ξ2 but it goes beyond the scope of this work we found that the best fitting values of the parameters b 1 and c 1 were very close to 1 thus we chose to set them exactly equal to 1 it allowed a further simplification of the analytical expression of ξ1 with the only a 1 parameter to be optimized cf table 1 from fig 4 it is interesting noting that ξ1 and ξ2 are 1 for a quite large range of κ specifically ξ1 0 98 for κ 0 3 and ξ2 0 98 for κ 0 2 it indicates that the unmodified asymptotic stability conditions 55 56 are able to yield reasonably accurate results for these lower ranges of κ for both ξ1 and ξ2 the largest errors typically occur in correspondence of relatively high values of κ 0 7 in particular for very small values of r 0 1 cf fig 4 both the conditions r 0 1 and κ 0 7 are quite rare in real geophysical flows hence these errors are expected to be of little relevance in applications fig 5 illustrates the boundaries of the non hyperbolic region calculated by the generalized stability conditions 72 73 for different values of κ and r as expected the left boundary moves upwards as κ increases while the differences between the curves corresponding to different κ become smaller as r increases also the right boundary heaves for increasing κ but is almost independent from r as a matter of fact it should be noted that little inaccuracies in ξ1 and ξ2 may still occasionally lead to a wrong hyperbolicity check a false positive exists when the approximate stability criterion wrongly detects a hyperbolicity loss in opposition a false negative occurs if the approximate criterion wrongly detects a hyperbolic state false negatives are more detrimental than false positives if the stability criteria are used in a numerical treatment for the hyperbolicity loss castro et al 2011 sarno et al 2017 as they may potentially cause numerical instabilities when the mesh is refined a false negative occurs at the left boundary if the best fitting of ξ1 overestimates its exact value while the opposite holds for ξ2 from the present numerical investigation it emerges that the maximum error on ξ1 is e max ξ 1 max ξ 1 ξ 1 0 012 while e min ξ 2 min ξ 2 ξ 2 0 004 considering that the residuals are everywhere small compared to the order of magnitude of ξ1 and ξ2 and that they typically increase with κ it can be found a small constant w max e max ξ1 e min ξ2 such that the following modified regularization functions 80 ξ 1 κ r ξ 1 κ r w κ 81 ξ 2 κ r ξ 2 κ r w κ yield no false negatives on the basis of our numerical tests a workable choice is w 0 015 4 2 validation finally we study the performance of the various stability criteria on a large numerical dataset composed of 106 uniformly distributed random generations of q in the following intervals chosen larger than the ones employed for calibration sec 4 1 0 m h 1 h 2 100 m 30 m s u 1 u 2 30 m s 0 r 1 four stability criteria are tested criterion i cond 55 56 derived by asymptotic analysis for κ 0 criterion ii for the left hyperbolic region cond 70 derived for κ 1 for the right hyperbolic region cond 56 derived for κ 0 criterion iii generalized cond 72 73 with best fitting regularization functions 78 79 criterion iv generalized cond 72 73 with the modified regularization functions 80 81 in table 2 the error rates are reported together with the occurrence rates of false positives and false negatives as it is clear from the table the best results are obtained with criterion iii and criterion iv where the minimum amount of false negative cases as expected is achieved by criterion iv at the cost of a slightly higher error rate 0 1682 vs 0 1146 it can be noted that a very small but not zero occurrence rate of false negatives is observed even with criterion iv this very small numerical discrepancy which corresponds to just one false negative out of one million of random generations is probably due to a slight underestimation of w in 80 81 which has been independently estimated on narrower ranges of layers thicknesses and velocities as expected criterion i yields more accurate results than the more conservative criterion ii the only advantage of criterion ii is that it never yields false negatives because it systematically underestimates the extension of both hyperbolic regions this numerical result also confirms that the conditions 56 and 70 exactly correspond to the external bounds of the non hyperbolic region now we consider a slightly different numerical dataset where 106 random generations of q are selected from the same intervals 0 m h 1 h 2 100 m 30 m s u 1 u 2 30 m s 0 r 1 by enforcing that κ 0 5 this constraint on the layers thicknesses appears reasonable for the majority of real geophysical flows since it amounts to assuming that the thicker layer is at most 3 times larger than the other layer the error rates of the various criteria are reported in table 3 as shown by the table all criteria perform even better than the case without constraints on κ in particular criteria iii and iv exhibit overall errors 0 1 moreover as a confirmation of the trend reported in fig 5 it is interesting to note that the simple criterion i derived for κ 1 yields reasonably consistent results with an overall error rate of approximately 0 43 5 application of the proposed stability criteria to the treatment for the hyperbolicity loss an important application of the new stability criteria is represented by the numerical treatment for the hyperbolicity loss castro et al 2011 which can be implemented with any finite volume scheme by a multi stage operator splitting technique in the present numerical application without loss of generality we employ the roe approximate riemann solver roe 1981 and a fractional step godunov splitting approach e g leveque 2004 5 1 numerical treatment for the loss of the hyperbolicity the numerical solution of the two layer pde system can be obtained through a two stage explicit scheme 82 stage i t q a x q 0 q i j 1 stage ii d q d t s q t t j q i j 1 q i j 1 in 82 the intermediate numerical solution q i j 1 at the i th cell and at the time point j 1 is calculated by some suitable finite volume scheme while the effects of the source term are calculated in stage ii by solving an ordinary differential equation ode with initial condition q i j 1 the treatment for the hyperbolicity loss proposed by castro et al 2011 consists of introducing an extra momentum exchange fextra 0 cf 6 to be accounted for in a stage iii subsequent to the two stages of scheme 82 in which the ode 83 d q d t 0 f e x t r a sgn u 1 u 2 0 r f e x t r a sgn u 1 u 2 t is solved with initial condition q i j 1 obtained by stage ii if q i j 1 is non hyperbolic fextra has to be large enough to keep the solution within the left hyperbolic region semi explicit expressions for fextra were derived by castro et al 2011 by using the classical approximate criterion 10 specifically it is assumed that 84 f e x t r a c u 1 u 2 where the factor u 1 u 2 is treated implicitly and the parameter c is treated explicitly i e as a function of q i j 1 and is determined in such a way that the updated solution q i j 1 lies on the hyperbolic boundary predicted by 10 85 c 1 τ max 0 u 1 u 2 g 1 r h 1 h 2 1 h 1 h 2 h 2 r h 1 in 85 τ is the relaxation time towards the equilibrium which can be interpreted as the characteristic time of restabilization associated to the mixing process to reach the equilibrium within the time advancement δt t j 1 tj it is required that τ δt without loss of generality it can be set τ δt for more details about the derivation of 85 we refer the reader to castro et al 2011 a more accurate and yet more computationally expensive way to estimate fextra was proposed by sarno et al 2017 this approach different from the one based on criterion 10 is workable for any density ratio and is based on the iterative illinois algorithm where the hyperbolicity is repeatedly checked by the discriminant method and a convergence criterion on fextra depending on a small threshold is employed 5 2 new formula for determining fextra in this application we employ the generalized left stability criterion 72 which describes the physically relevant hyperbolic region in geophysical flows since 72 with the definition of the regularization function ξ1 78 has an analytical form it is possible to reach an expression for fextra more accurate than 84 85 specifically keeping 84 in order to obtain that the updated solution q i j 1 lies on the hyperbolic boundary predicted by 72 eq 85 is modified as 86 c 1 δ t max 0 u 1 u 2 2 g 1 r ξ 1 κ r h 1 h 2 1 h 1 h 2 h 2 r h 1 analogous to castro et al 2011 the updated momentum components of q i j 1 are calculated semi implicitly by the linear system 87 h 1 u 1 i j 1 h 1 u 1 i j 1 δ t c i j 1 h 2 u 2 i j 1 h 2 i j 1 h 1 u 1 i j 1 h 1 i j 1 h 2 u 2 i j 1 h 2 u 2 i j 1 δ t r c i j 1 h 2 u 2 i j 1 h 2 i j 1 h 1 u 1 i j 1 h 1 i j 1 5 3 test case of an exchange flow with non hyperbolic initial conditions and small density ratio an exchange flow with non hyperbolic initial conditions and small density ratio was proposed by sarno et al 2017 as a paradigmatic test case to show that for small density ratios the numerical treatment proposed by castro et al 2011 not only yields less accurate results but may even change the flow structure by modifying the signs of the layers velocities here we employ a similar test to show that the semi implicit treatment 87 with the modification 86 well approximates the reference solution obtained by using the more computationally expensive iterative method by sarno et al 2017 the test case describes the exchange flow of two superimposed fluids with r 0 3 the spatial domain is x 1 1 and the initial conditions are 88 h 1 x 0 0 1 m if x 0 5 m 0 5 m if x 0 5 m h 2 x 0 1 0 m h 1 x 0 u 1 x 0 1 00 m s u 2 x 0 3 00 m s to study the performance of the hyperbolicity treatment with the new stability criteria over a wide range of κ the initial conditions 88 are chosen such that κ 0 for x 0 5m and κ 0 8 in the middle region x 0 5m non reflective boundary conditions are imposed at x 1 and x 1 the numerical simulations reported below are performed by using a spatial discretization δx 1 200 0 005 m while various mesh refinements have been tested for checking grid convergence to get stable time steps δt the courant friedrichs lewy cfl number was set equal to 0 95 for all simulations analogous to sarno et al 2017 to which we refer the reader for details the advection terms of the pde system 1 are treated by means of a first order finite volume scheme based on the roe approximate riemann solver with the real jordan decomposition roe 1981 castro et al 2011 although the scope of this numerical investigation does not include the optimization of the advection numerical scheme it is worth remarking that the numerical treatment for the hyperbolicity loss is compatible with any finite volume scheme more efficient advection numerical schemes are reported e g by krvavika et al 2018 the following options for the numerical treatment of the hyperbolicity loss are tested sim a iterative algorithm by sarno et al 2017 where the hyperbolicity is checked by the discriminant 8 of the quartic characteristic polynomial sim b iterative algorithm by sarno et al 2017 where the hyperbolicity is checked by the discriminant of the resolvent cubic 9 sim c semi implicit formulae 86 87 and fextra parameterized according to the stability criterion 10 sim d semi implicit formulae 86 87 and fextra parameterized according to the stability criterion 72 the illinois iterative algorithm in sim a and sim b is run with the convergence threshold equal to 10 5m2 s as suggested by sarno et al 2017 sim d is run with the modified regularization function ξ 1 determined by 80 with w 0 015 the numerical simulations were carried out on a pc with intel core i7 9700k 3 60ghz and were run up to t 5s when the steady state is reached table 4 lists the relevant numerical results the maximum value of fextra reported in table 4 occurs in the first time step for all simulations as expected sim a and sim b yield exactly the same numerical results with a slightly lower run time for sim b this improvement is in qualitative agreement with krvavika et al 2018 fig 6 shows the layers thicknesses and velocities predicted by sim b sim c and sim d at the time points t 0 25s 0 5s 1 0s and 5 0s respectively it is evident that sim c obtained by using the approximate criterion 10 overcorrects the numerical solution indeed in this simulation the initial exchange flow becomes unidirectional and thus arrives at a completely different steady state than sim b this is due to the strong overestimation of the corrective momentum exchange fextra 771 2 m2 s2 table 4 at the beginning of the simulation in turn caused by the low density ratio that the approximate criterion 10 cannot cope with conversely sim d obtained by using the generalized stability criterion 72 is in excellent agreement with the reference numerical solution sim a and sim b with only minor discrepancies being observed where the gradients of the solution are steep figs 6 a b c the very good agreement among sim a sim b and sim d is also corroborated by the comparable values of max fextra 578 3 m2 s2 for sim d and 576 8 m2 s2 for sim a and sim b as well the steady state solution by sim d is almost identical to the one obtained by using the computationally more expensive iterative algorithm table 4 and fig 6 d fig 7 shows the maximum values of fextra calculated over the spatial domain as a function of time for representation convenience the larger values of fextra corresponding to the initial time interval t 0 002s are displayed in the inset plot of fig 7 it can be noted that the sim c systematically underestimates fextra for all t except for the first time step and furthermore it yields fextra 0 after t 0 5s this is due to the strong overestimation of fextra 771 2 m2 s2 at the beginning of the simulation which considerably modifies the flow dynamics differently the values of max fextra by sim d are very close to the ones by the reference sim b yet especially for t 0 5s it can be noticed that these values are slightly smaller than the ones by sim b this behavior is the consequence of the fact that in the earlier time steps sim d slightly overestimates fextra for t 0 5s a small time phase shift occurs between the corrections by sim b and sim d due to minor discrepancies between the flow dynamics predicted by the two simulations cf fig 6 looking at the run times of table 4 the advantage of the proposed algorithm is evident indeed the run time for sim d is considerably lower than sim b 124 6s versus 205 9s with a speed up of approximately 40 in this test case in the light of these findings we can state that while the iterative algorithm by sarno et al 2017 remains very accurate in determining the smallest amount of fextra necessary for guaranteeing the pde system hyperbolicity the proposed semi implicit treatment with the generalized stability criterion represents an excellent alternative with much lower computational costs the decrease of the computational time is even higher when a more refined mesh is used especially if the loss of hyperbolicity occurs in a large number of computational cells 5 3 1 mesh refinements and computational costs to better illustrate it the same test case is carried out with different mesh sizes δ x 1 50 1 100 1 200 1 400 1 800 1 1600 m and refinement ratio p 2 the cpu times for sim b and sim d are listed in table 5 the speed up of sim d over sim b further increases with the mesh refinement indeed while the run time of sim d increases by p 2 sim b shows a higher increase of the computational costs as the mesh becomes finer this is due to the additional overhead of the iterative algorithm employed for calculating fextra as we observed that the average number of iterations required by the illinois iterative algorithm to converge increases with the mesh refinement taking as reference the simulations obtained by sim b and sim d with the finest grid δ x 1 1600 m we could also estimate the relative ℓ1 norm errors e g leveque 2004 of the runs with coarse grids for a given time point j the relative ℓ1 norm error of the function q is defined as 89 e 1 i 1 n q i j q i j i 1 n q i j where q is the coarse numerical solution q is the reference solution i is the spatial discretization index and n is the number of cells in the coarse grid as expected we observed that for all variables h 1 h 1 u 1 h 2 h 2 u 2 e 1 decreases almost linearly with decreasing δx for any grid size the magnitudes of e 1 by the two treatments sim b and sim d are comparable although the two schemes converge to slightly different steady states which is expected since fextra are calculated in slightly different ways cf fig 7 fig 8 shows the simulation run times versus the relative errors e 1 obtained at the intermediate time point t 2 5s as it is evident from the figure not only sim d requires much less cpu resources than sim b but this advantage widens for decreasing values of e 1 hence for large scale simulations the semi implicit scheme with the new generalized stability criterion is preferable over the iterative scheme 5 4 test case of a 1d riemann problem with zero initial velocities here we present a test case consisting of a 1d riemann problem with zero velocities and non zero layers thicknesses this test is analogous to the wet bed dam break problem of the one layer shallow water model stoker 1957 and is similar to the shock tube test of gas dynamics leveque 2004 the spatial domain is x 1 1 and has non reflective boundaries at x 1 and x 1 the density ratio between the two fluids is r 0 5 and the initial data hyperbolic everywhere are piecewise constant 90 h 1 x 0 0 1 m h 2 x 0 1 9 m if x 0 m 0 1 m if x 0 m u 1 x 0 0 m s u 2 x 0 0 m s the jump of h 2 between left and right states q l and q r in 90 is chosen high enough so that there is a non hyperbolic intermediate region in the riemann solution i e the one directly connected to q r cf fig 9 although the meaningfulness of a riemann problem with non hyperbolic regions is debatable from a rigorous mathematical viewpoint e g keyfitz et al 2003 this test is of practical use to better study the effects of the hyperbolicity treatment on the numerical solution the code with the semi implicit algorithm 86 87 and the stability criteria 72 denoted with sim d as stated in sec 5 3 is run with δ x 1 1600 m and cfl 0 95 a comparative numerical solution denoted with sim e is obtained without the hyperbolicity treatment to properly capture transonic rarefactions in both codes we employed the harten entropy fix harten 1984 as expected while the numerical code sim d is found to converge to a similarity solution q x t q x t q l q r the one without the hyperbolicity treatment sim e yields catastrophic short wave instabilities noticeable from t 0 2s and rapidly growing with time till the solution blow up with reference to the time point t 0 2s fig 9 reports the calculated quantities h 1 h 2 h 2 h 1 u 1 and h 2 u 2 together with the extra momentum exchange fextra additionally fig 9 f illustrates the eigenvalues of the sim d solution indexed in ascending order λ 1 λ 2 λ 3 λ 4 which are useful to check the fulfilment of the entropy conditions in the sense of lax e g leveque 2004 the initial states q l to q r are connected to each other through a sequence of 3 intermediate states and 4 waves similar to the wet bed dam break problem e g tseng et al 2001 tai et al 2021 q l is connected to the first intermediate state by a left going rarefaction wave of the first characteristic family here corresponding to the smallest barotropic eigenvalue λ 1 and the third intermediate state is connected to q r by a lax 4 shock as well the second intermediate state is connected to the third one by a lax 3 shock yet interestingly the first intermediate state appears to be connected to the second one by a composite wave made of a 2 shock to which is attached a smooth wave of short length incidentally such a composite wave is entropy admissible in the sense of lax while conversely a unique 2 shock wave would be not fig 9 f although it is beyond the scope of this paper to theoretically determine why the numerical code converges to this precise weak solution it can be speculated that this phenomenon probably depends on the particular choice of the lipschitz continuous family of paths here assumed to be straight lines required to extend the definition of weak solution to non conservative pde systems dal maso et al 1995 parés 2006 on the other hand it is worth mentioning that minor effects on the convergence point might be also due to the particular numerical scheme as signalled by castro et al 2010 the hyperbolicity treatment is active at the right going shock connecting the third intermediate state to q r where a non zero fextra is continuously injected to guarantee the hyperbolicity of the cells immediately behind the hydraulic jump fig 9 e as expected the treatment causes some slight changes of the solution especially in the second and third intermediate states moreover the extra momentum fextra enters into play in the generalized rankine hugoniot jump conditions across the 4 shock e g castro et al 2010 hence it is expected to slightly change the shock speed as well nonetheless we observed that the speed of the 4 shock is only marginally modified in sim d while a slightly larger change occurs in the speed of the 3 shock with an increase of 3 over the one of sim e finally it is useful to compare the integral means of h 1 h 1 u 1 h 2 and h 2 u 2 in the intervals 1 x 0 and 0 x 1 the integral means reported in table 6 are practically identical in the left sub domain x 1 0 and are very similar to each other also in the right sub domain with the largest difference being observed for h 1 u 1 relative ℓ1 norm error of 5 6 conclusions in this work we systematically studied the eigenstructure of the two layer model by asymptotic analysis a first analysis was carried out by assuming small velocity differences between the layers from which the classical stability criterion by schijf and schönfled 1953 is recovered for r 1 subsequently various asymptotic analyses were carried out by alternatively assuming that the relative thickness difference between the layers κ h 1 h 2 h 1 h 2 is either small or very large this novel approach does not require any assumption on density ratio r or on the velocity difference between the layers u 1 u 2 and allows a new postulation of the stability criteria corresponding to the lower and upper bounds of both left and right boundaries of the non hyperbolic region generalized stability criteria were then proposed for intermediate values of κ i e for any flow condition the analytical structure of the generalized criteria is similar to the exact conditions derived for κ 0 and κ 1 while the determination of four parameters was required for the characterization of two regularization functions the best fitting values of these parameters were obtained by an extensive numerical investigation on the space of unknowns an excellent agreement between the semi analytical stability criteria and the actual hyperbolicity conditions was subsequently found by numerically exploring a much larger portion of the space of unknowns h 1 h 1 u 1 h 2 h 2 u 2 t the generalized stability criteria were then successfully implemented in a semi implicit numerical treatment for avoiding the hyperbolicity loss originally proposed by castro et al 2011 this treatment is based on the introduction of an extra momentum exchange fextra which has to be sufficient to keep the solution within the hyperbolic domain numerical investigations on a test case of a two layer exchange flow with small density ratio showed that the new stability criterion is more favorable than the classical approximate criterion moreover this new approach yields numerical results very close to the ones obtained by the iterative algorithm based on the discriminant method sarno et al 2017 but requires much less computational effort a second test showed the numerical stabilization of a 1d riemann problem with a non hyperbolic intermediate state which was successfully achieved thanks to the hyperbolicity treatment with the generalized stability criteria credit authorship contribution statement l s conceptualization methodology software validation formal analysis writing original draft writing review editing visualization funding acquisition y w writing original draft writing review editing formal analysis funding acquisition y c t writing original draft writing review editing formal analysis r m writing original draft writing review editing a c writing original draft writing review editing declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments this work is part of the project stratifiedgranular which received funding from the european union s horizon 2020 research and innovation programme under the marie skłodowska curie grant agreement no 797890 
277,two layer and multi layer depth averaged models have become popular for simulating exchange flows seawater currents and geophysical flows the partial differential equation systems associated with these models are similar to the single layer shallow water model yet their eigenstructures are more complex owing to the pressure coupling between the layers such models occasionally lose their hyperbolic character which may lead to numerical issues a physical explanation is that kelvin helmholtz type instabilities arise at the layers interface if the velocity difference between the layers becomes sufficiently large a way to avoid the hyperbolicity loss is to locally introduce an extra momentum exchange between the layers assessable from the system eigenstructure and aimed at roughly mimicking the dynamical effects of such instabilities to better understand the hyperbolicity conditions the eigenstructure of the two layer model is methodically studied by an asymptotic analysis the analysis for the limiting cases where the layers thicknesses are either comparable or very different from each other reveals new stability criteria these analytical criteria are then exploited to design a new family of approximate criteria valid for any flow condition numerical investigations demonstrate the reliability of this approach which can be easily implemented in numerical schemes for preserving the hyperbolicity keywords two layer shallow water equations non conservative hyperbolic systems asymptotic analysis interface instability finite volume 1 introduction shallow water equations de saint venant 1871 and depth averaged models e g savage and hutter 1991 pudasaini 2012 are widely employed to simulate free surface flows characterized by a thin flow depth and are particularly suitable for describing natural phenomena such as floods and geophysical flows e g fraccarollo and toro 1995 ancey et al 2008 sarno et al 2011a sarno et al 2013 papa et al 2018 the popularity of such models is favoured by the fact that different from a three dimensional approach they allow a straightforward and fast numerical integration typically based on finite difference or finite volume schemes multi layer depth averaged models represent an extension of single layer models and have recently gained attention in hydraulic engineering for their capability of describing the dynamics of stratified flows analogous to the shallow water model they can be obtained by depth averaging the mass and momentum balance equations across the different layers and by subsequently simplifying the resulting equations by means of a suitable asymptotic approximation e g savage and hutter 1991 the capabilities of these models in capturing the dynamics of different superimposed flows allow a more accurate description of the flow dynamics along the transverse to flow direction with reasonable computational costs a two layer approach has been successfully adopted for describing seawater currents with small density gradients castro et al 2004 gravity currents adduce et al 2012 la rocca et al 2012 and the saltwater intrusion in stratified estuaries krvavica and ružić 2020 moreover two layer models have been proposed for modelling stratified geophysical flows such as debris flows and avalanches fernández nieto et al 2008 luca et al 2009 doyle et al 2010 canestrelli et al 2012 sarno et al 2014 meng et al 2017 which often exhibit a rheological stratification especially influenced by the presence of side walls e g armanini et al 2005 sarno et al 2011b sarno et al 2018a sarno et al 2018b carleo et al 2019 a multi layer model was introduced by audusse 2005 to describe free surface flows of a newtonian fluid in a computationally more efficient way than the 3d navier stokes equations as well a multi layer approach based on piecewise smooth weak solutions has been recently proposed by fernández nieto et al 2014 2016 to describe newtonian and dense granular flows focusing on the case of the two layer model long 1956 armi 1986 it should be recalled that its partial differential equation pde system is non strictly hyperbolic due to the pressure coupling between the layers namely two of the propagation speeds of the infinitesimal perturbations may become complex numbers which may lead to instabilities of the numerical solution e g castro et al 2011 the mathematical structure of the two layer model is similar to the two phase model e g keyfitz et al 2003 pelanti et al 2008 which is well known to lose its hyperbolic character when the phase velocities are too different from each other under these circumstances these models become of mixed hyperbolic elliptic type e g keyfitz 1987 which poses several open questions about the correct boundary conditions the validity of the exact solution and not least the stability of the numerical approximation from the viewpoint of physics the hyperbolicity loss is often associated with the onset of kelvin helmholtz type instabilities at the interface von helmholtz 1868 which cause the occurrence of an intermediate mixing layer of finite thickness since the two layer is a simplified model of reality unable to describe the mixing layer several numerical phenomenological approaches have been proposed to get around the problem of the hyperbolicity loss the parabolization of the pde system by introducing some small artificial viscosity in the pde model or at the level of the numerical scheme would circumvent the hyperbolicity issue e g fjordholm 2012 etrati and frigaard 2018 yet this modification often causes unrealistically smeared solutions if it is not justified on a physical basis moreover different from models with a finite physically based viscosity introducing some artificial viscosity which decreases with the mesh refinement might not always yield a meaningful solution in the vanishing viscosity limit keyfitz et al 2003 in several application oriented works the issue related to the hyperbolicity loss was apparently overcome by considering the real part of the pde system eigenvalues e g savary and zech 2007 chen and peng 2006 chen et al 2007 spinewine et al 2011 canestrelli et al 2012 yet these approaches basically rely on the intrinsic diffusion of the numerical scheme and may still experience oscillations of the numerical solution if the mesh is refined greco et al 2008 castro et al 2011 abgrall and karni 2009 introduced auxiliary variables to enforce a finite relaxation time for the pressure coupling between the layers which from the physical viewpoint is similar to assuming a finite speed of the pressure waves along the transverse to flow direction chiapolino and saurel 2018 this method ensures that the modified pde system is strictly hyperbolic but causes the uncoupling of the layers propagation speeds which is undesirable e g audusse 2005 castro et al 2012 attempted to describe the evolution of the intermediate mixing layer by locally shifting from two layer to a three layer model however this approach is computationally more expensive and does not completely solve the issue of the hyperbolicity loss since even the more sophisticated three layer model is only conditionally hyperbolic another physically based approach to avoid the loss of hyperbolicity consists of introducing an extra momentum exchange between the layers so as to keep the solution within the hyperbolic region namely renouncing to describe the dynamics of the mixing layer the dynamical effects of the interface instabilities on the two layers are approximately accounted for to determine the proper amount of this momentum exchange castro et al 2011 proposed to use an approximate hyperbolicity criterion suitable for boussinesq flows i e stratified flows with small density differences a generalization of this approach valid for any density difference is given by sarno et al 2017 where the system hyperbolicity is analytically checked by calculating the discriminant of the characteristic polynomial associated with the eigenvalue problem however this approach requires a more computationally expensive iterative algorithm to speed up the method by sarno et al 2017 krvavica et al 2018 proposed to calculate the discriminant and the entire eigenvalues set by the ferrari s formula for quartic equations abramowitz and stegun 1965 yet as reported also by krvavica et al 2018 the ferrari s analytical roots are prone to round off errors which may become relevant if the coefficients of the characteristic polynomial span over different orders of magnitude e g strobach 2010 considering these difficulties and also that the available analytical formulae are algebraically too complicated to reveal the essential features of the two layer model in this work we systematically studied the eigenstructure of the model by asymptotic analysis different assumptions on the variables involved in the system stability are alternatively made by considering the two limiting cases where the layers thicknesses are comparable and very different from each other we found new analytical stability criteria valid for any velocity difference and density ratio then with the help of an extensive numerical investigation general stability conditions are obtained by regularizing the two limiting cases the paper is organized as follows the two layer model and the issues related to the hyperbolicity loss are recalled in section 2 the asymptotic analyses are reported in section 3 in section 4 the reliability of the new stability criteria is numerically investigated and a family of approximate stability criteria valid for any flow condition is proposed in section 5 the new stability criteria are implemented in the numerical treatment for preserving the hyperbolicity the conclusions are summarized in section 6 2 the two layer model and the hyperbolicity loss the two layer depth averaged model describes the motion of two superimposed immiscible fluids and can be derived by a suitable asymptotic simplification of the depth averaged mass and momentum balance equations written separately for each layer depending on the specific physical problem the source terms of the model vary from case to case here we are interested in the essential properties of the two layer model thus we neglect all additional source terms depending on dissipative forces or mass exchanges between the layers considering an orthogonal cartesian frame of reference oxy with x parallel to the main flow direction and y being oriented opposite to the gravity vector g and denoting the upper and lower layers with subscripts 1 and 2 respectively the two layer model in one space variable x is written as e g kim and leveque 2008 1 t h 1 x h 1 u 1 0 t h 1 u 1 x 1 2 g h 1 2 h 1 u 1 2 g h 1 x h 2 g h 1 x b t h 2 x h 2 u 2 0 t h 2 u 2 x 1 2 g h 2 2 h 2 u 2 2 ρ 1 ρ 2 g h 2 x h 1 g h 2 x b here hi ui and ρ i are the thickness the depth averaged velocity and the density of the i th layer with i 1 2 while t is time and b x is the basal topography see the sketch in fig 1 the unknown functions are q q 1 q 2 q 3 q 4 t h 1 h 1 u 1 h 2 h 2 u 2 t hereafter the density ratio ρ 1 ρ 2 will be denoted with r the terms gh 1 x h 2 and rgh 2 x h 1 represent the pressure coupling between the layers and cause the pde system 1 to be non conservative moreover the non conservative terms prevent the definition of weak solutions in the classical sense e g toro 2013 so that the introduction of physically admissible paths connecting the states of the riemann problem becomes necessary dal maso et al 1995 parés 2006 the conservative part of 1 yields the following flux vector 2 f q q 2 1 2 g q 1 2 q 2 2 q 1 q 4 1 2 g q 3 2 q 4 2 q 3 t by rewriting 1 in the quasi linear form 3 t q a x q s with s 0 gh 1 x b 0 gh 2 x b t the non conservative matrix a non cons is incorporated into the pseudo jacobian matrix a 4 a q r q f a n o n c o n s 0 1 0 0 g q 1 q 2 2 q 1 2 2 q 2 q 1 0 0 0 0 0 1 0 0 g q 3 q 4 2 q 3 2 2 q 4 q 3 0 0 0 0 0 0 g q 1 0 0 0 0 0 r g q 3 0 0 0 one may be tempted to regard the non conservative terms a non cons x q as source terms and neglect them in the study of the system eigenstructure however neglecting the non conservative terms may cause incorrect characteristic speeds under infinitesimal perturbations at both the free surface barotropic speeds and the layers interface baroclinic speeds as an example for u 1 u 2 u and ρ 1 ρ 2 disregarding the non conservative terms yields wrong barotropic speeds u g h 1 which are smaller than the ones predicted by the classical shallow water model u g h 1 h 2 the correct perturbation speeds for the two layer model correspond to the eigenvalues of a i e to the roots of the characteristic polynomial 5 p a det a λ i λ 2 2 λ u 1 u 1 2 g h 1 λ 2 2 λ u 2 u 2 2 g h 2 r g 2 h 1 h 2 0 the pde system 3 is non strictly hyperbolic since the baroclinic eigenvalues may become complex it typically occurs if the relative velocity u 1 u 2 becomes sufficiently large so that kelvin helmholtz type instabilities are triggered at the internal interface in a linear model this occurrence would cause catastrophic hadamard instabilities which are characterized by unbounded growth rates of the short wave perturbations e g joseph and saut 1990 however in the two layer model such instabilities are somehow less catastrophic because the amplitudes of the perturbations saturate thanks to non linear effects and high frequency terms rapidly decay thanks to energy dissipation of shocks and other explicit dissipative mechanisms see e g keyfitz 2003 from the viewpoint of physics these non linear effects are associated with the onset of an intermediate mixing layer of finite thickness which a two layer approach is unable to describe the aforementioned hyperbolicity loss may cause relevant numerical issues which typically show up as unphysical oscillations of the solution if the mesh is refined e g greco et al 2008 castro et al 2011 a physics based way to overcome these numerical issues without the need to shift to a more complex model is the local introduction of an additional momentum exchange fextra for roughly capturing the effects of the turbulent like mixing between the layers castro et al 2011 namely the momentum equations of the pde system 1 are slightly modified as follows 6 t h 1 u 1 x 1 2 g h 1 2 h 1 u 1 2 g h 1 x h 2 g h 1 x b f e x t r a sgn u 1 u 2 t h 2 u 2 x 1 2 g h 2 2 h 2 u 2 2 r g h 2 x h 1 g h 2 x b r f e x t r a sgn u 1 u 2 if as usual fextra cannot be estimated on a physical basis the amount of fextra has to be sufficient to keep the solution within the hyperbolic region this amount may be calculated by an approximate formula castro et al 2011 or by a more accurate and yet more computationally demanding iterative algorithm based on the study of the system hyperbolicity sarno et al 2017 to check the system hyperbolicity for a particular solution q several approaches are possible one of them is to numerically calculate the eigenvalues of a q r yet this method is rather time consuming and requires the tedious calculation of the entire eigenvalues set which is unnecessary if the chosen numerical scheme is based on an incomplete riemann or riemann free solver 2 1 the discriminant method a more computationally appealing alternative is to check the hyperbolicity by calculating the discriminant d of the characteristic polynomial 5 since two of the four roots are always real the other two ones are real if and only if d p a 0 e g dickenstein and emiris 2005 a general analytical formula for the discriminant of a n degree polynomial f x anxn a n 1 x n 1 a 1 x a 0 reads 7 d f 1 1 2 n n 1 1 a n det r f f where f is the first derivative of f and r f f is the sylvester matrix of f and f for a quartic polynomial n 4 7 is recast as 8 d f 256 a 4 3 a 0 3 192 a 4 2 a 3 1 a 1 1 a 0 2 128 a 4 2 a 2 2 a 0 2 144 a 4 2 a 2 1 a 1 2 a 0 1 27 a 4 2 a 1 4 144 a 4 1 a 3 2 a 2 1 a 0 2 6 a 4 1 a 3 2 a 1 2 a 0 1 80 a 4 1 a 3 1 a 2 2 a 1 1 a 0 1 18 a 4 1 a 3 1 a 2 1 a 1 3 16 a 4 1 a 2 4 a 0 1 4 a 4 1 a 2 3 a 1 2 27 a 3 4 a 0 2 18 a 3 3 a 2 1 a 1 1 a 0 1 4 a 3 3 a 1 3 4 a 3 2 a 2 3 a 0 1 a 3 2 a 2 2 a 1 2 eq 8 was proposed by sarno et al 2017 to check the stability of the two layer model and it has been found to be approximately four times faster than the numerical calculation of the eigenvalues performance comparison tests have been carried out in matlab by confronting the computation time of 8 with the one of the eig built in matlab function although 8 is an analytical exact expression we found that relevant cancellation errors may occur when fixed precision variables are employed and the coefficients in 8 spread over several orders of magnitude unfortunately it may occasionally happen also in cases of practical interest i e when the layers velocities are relatively large e g for the values h 1 h 2 0 1 m u 1 16 m s u 2 15 m s r 0 5 and g 9 806 m s2 the formula 8 with a standard double precision floating point format 64bit wrongly yields a non hyperbolic state d 0 a computationally more efficient reformulation of 8 which also greatly reduces the round off errors is reported by krvavika et al 2018 9 d f 4 a 2 2 12 a 0 3 a 3 a 1 3 27 a 3 2 a 0 9 a 3 a 2 a 1 2 a 2 3 72 a 2 a 0 27 a 1 2 2 27 eq 9 was derived from the ferrari s analytical solution of the quartic equation which is based on the solution of the cubic resolvent equation by the cardano s method abramowitz and stegun 1965 it can be easily verified that 8 is equivalent to 9 after normalizing a 4 1 krvavica et al 2018 reported that cancellation errors of the ferrari s analytical solution are typically not an issue for realistic values of layers thicknesses 0 100m and velocities between 20 and 20 m s yet we found that 9 may still yield wrong information about the system hyperbolicity for cases with small layers thicknesses typically 0 01m and large layers velocities 15m s these numerical issues can be overcome by adopting arbitrary precision instead of double precision arithmetic but it would cause increased computation time and implementation difficulties in some programming environments moreover it is unfortunate that the discriminant method does not allow a genuine understanding of the stability problem in terms of interplay of the involved variables that is it does not provide explicit information about the deviation of the solution from the hyperbolic non hyperbolic boundary hence if the discriminant is employed to check the system hyperbolicity an iterative algorithm is required to determine the proper amount of fextra sarno et al 2017 2 2 approximate formulae to check the system hyperbolicity a different approach to check the model stability is by means of an approximate criterion the classical approximate formula for boussinesq flows schijf and schönfled 1953 10 u 1 u 2 2 g 1 r h 1 h 2 1 was proposed by castro et al 2011 to verify the model hyperbolicity and to directly calculate fextra yet the condition 10 is only accurate for 1 r 0 as an example in fig 2 we report the approximate hyperbolic non hyperbolic boundary predicted by 10 and a number of hyperbolic and non hyperbolic states numerically calculated in correspondence to random values of h 1 h 1 u 1 h 2 h 2 u 2 t with density ratios r 0 95 r 0 5 and r 0 2 two different hyperbolic regions exist in green color in fig 2 in geophysical flows only the left hyperbolic region is of physical interest since these flows are typically driven by gravity from a state of rest with non vanishing depths castro et al 2011 the right hyperbolic region could become relevant in industrial and astrophysical contexts if the initial velocities were non zero for r 0 95 fig 2 a the approximate stability condition 10 well describes the boundary of left hyperbolic region while it becomes progressively inaccurate as the density ratio decreases fig 2 b c fig 2 also reveals that the boundaries of the non hyperbolic region become fuzzy for small enough values of r fig 2 b c as highlighted by sarno et al 2017 this scatter only shows up in the plot u 1 u 2 vs h 1 h 2 while the boundaries of the hyperbolic regions are sharp in the space of h 1 h 1 u 1 h 2 h 2 u 2 t such a behavior is caused by the fact that states with the same value of h 1 h 2 may represent different thickness differences between the layers on which the stability also depends see e g lawrence 1990 namely the intermediate fuzzy regions whose extensions grow with 1 r correspond to states that may be either hyperbolic or non hyperbolic depending on the relative thickness of the layers conversely the uniformly colored areas in fig 2 correspond to states that are hyperbolic or non hyperbolic independent from the relative thickness 3 asymptotic analyses to get a deeper understanding of the stability conditions in the two layer model here we report different asymptotic analyses on the eigenstructure of 3 all the factors on which the stability depends i e velocity density and layers thickness differences are methodically investigated the first analysis reported in sec 3 1 is based on the classical assumption of small velocity differences between the layers the asymptotic expansions for the special cases r 0 and r 1 are discussed in sec 3 1 while the relevant case r 1 is reported separately in sec 3 1 1 a second group of asymptotic analyses is carried out assuming that the thicknesses of the layers h 1 and h 2 are either comparable h 1 h 2 h 1 h 2 1 sec 3 2 or very different from each other 1 h 1 h 2 h 1 h 2 1 sec 3 3 3 1 asymptotic analysis for small velocity differences here we study the eigenstructure of the characteristic equation 5 associated with the pde system 3 by assuming that the velocity difference between the layers is small the cases of r 0 r 1 and r 1 are investigated as special cases we define the asymptotic parameter ε u 1 u 2 u m with um being some non zero characteristic velocity and assume that ε u 1 u 2 u m 1 the solution of the eigenvalue problem can be approximated by an asymptotic expansion λ λ 0 λ 1 ε λ 2 ε 2 λ n ε n o ε n 1 after substituting u 2 u 1 εum eq 5 is recast as 11 λ 2 2 λ u 1 g h 1 u 1 2 λ 2 2 λ u 1 ε u m g h 2 u 1 ε u m 2 r g 2 h 1 h 2 0 substituting the expansion λ λ 0 λ 1 ε λ 2 ε 2 in 11 and neglecting higher order terms the o ε 0 equation is 12 λ 0 2 2 λ 0 u 1 g h 1 u 1 2 λ 0 2 2 λ 0 u 1 g h 2 u 1 2 r g 2 h 1 h 2 0 eq 12 is biquadratic in λ 0 u 1 hence the roots are given by 13 λ 0 1 u 1 g 2 h 1 h 2 h 1 h 2 2 4 1 r h 1 h 2 λ 0 2 u 1 g 2 h 1 h 2 h 1 h 2 2 4 1 r h 1 h 2 λ 0 3 u 1 g 2 h 1 h 2 h 1 h 2 2 4 1 r h 1 h 2 λ 0 4 u 1 g 2 h 1 h 2 h 1 h 2 2 4 1 r h 1 h 2 it can be easily verified that λ 0 in 13 are real for 0 r 1 in the limiting case r 0 i e zero pressure coupling between layers 13 yields λ 0 1 2 u 1 g h 1 and λ 0 3 4 u 1 g h 2 which match the eigenvalues of the shallow water model written separately for the two layers in the other limiting case r 1 λ 0 1 2 u 1 g h 1 h 2 and λ 0 3 4 u 1 where the barotropic speeds match the eigenvalues of the shallow water model written for the entire current the o ε 1 equation obtained from 11 by collecting o ε 1 terms reads 14 λ 0 2 2 u 1 λ 0 u 1 2 g h 1 2 λ 0 λ 1 2 u 1 λ 1 2 u m λ 0 2 u 1 u m λ 0 2 2 u 1 λ 0 u 1 2 g h 2 2 λ 0 λ 1 2 u 1 λ 1 0 whence 15 λ 1 u m λ 0 2 2 u 1 λ 0 g h 1 u 1 2 λ 0 u 1 2 λ 0 2 4 u 1 λ 0 2 u 1 2 g h 2 g h 1 λ 0 u 1 by substituting λ 0 1 λ 0 2 λ 0 3 λ 0 4 into 15 the four o ε 1 coefficients λ 1 1 λ 1 2 λ 1 3 λ 1 4 are 16 λ 1 1 2 u m h 1 h 2 h 1 h 2 2 4 1 r h 1 h 2 2 h 1 h 2 2 4 1 r h 1 h 2 λ 1 3 4 u m h 2 h 1 h 1 h 2 2 4 1 r h 1 h 2 2 h 1 h 2 2 4 1 r h 1 h 2 if r 0 λ 1 1 2 0 and λ 1 3 4 u m conversely if r 1 λ 1 1 2 h 2 u m h 1 h 2 while λ 1 3 4 are indeterminate because eq 14 is identically satisfied for λ 0 3 4 u 1 the o ε 2 equation is 17 λ 0 2 2 u 1 λ 0 u 1 2 g h 1 2 λ 0 λ 2 2 u 1 λ 2 λ 1 2 2 u m λ 1 u m 2 λ 0 2 2 u 1 λ 0 u 1 2 g h 2 2 λ 0 λ 2 2 u 1 λ 2 λ 1 2 2 λ 0 λ 1 2 u 1 λ 1 2 λ 0 λ 1 2 u 1 λ 1 2 u m λ 0 2 u 1 u m 0 whence 18 λ 2 6 λ 0 2 12 u 1 λ 0 6 u 1 2 g h 2 g h 1 λ 1 2 6 λ 0 2 12 u 1 λ 0 6 u 1 2 2 g h 1 u m λ 1 u m 2 λ 0 λ 0 2 u 1 u 1 2 g h 1 u m 2 4 λ 0 3 12 u 1 λ 0 2 12 u 1 2 2 g h 2 2 g h 1 λ 0 4 u 1 3 2 g h 2 2 g h 1 u 1 by substituting λ 0 1 2 3 4 and λ 1 1 2 3 4 into 18 the o ε 2 coefficients λ 2 1 λ 2 2 λ 2 3 λ 2 4 are obtained if r 0 the o ε 2 coefficients are 19 λ 2 1 h 2 u m 2 4 h 1 2 h 1 h 2 h 2 2 2 g h 1 h 1 h 2 2 h 1 h 2 λ 2 2 λ 2 1 λ 2 3 h 1 u m 2 h 1 2 h 1 h 2 4 h 2 2 2 g h 2 h 1 h 2 2 h 1 h 2 λ 2 4 λ 2 3 conversely if r 1 eq 17 yields 20 λ 2 1 3 h 1 h 2 u m 2 2 g h 1 h 2 5 2 λ 2 2 3 h 1 h 2 u m 2 2 g h 1 h 2 5 2 λ 2 3 and λ 2 4 indeterminate after substituting λ 0 3 4 u 1 into eq 17 the following equation determining the still unknown o ε 1 coefficients λ 1 3 and λ 1 4 emerges 21 g h 1 λ 1 2 2 u m λ 1 u m 2 g h 2 λ 1 2 0 whence 22 λ 1 3 h 1 i h 1 h 2 u m h 1 h 2 λ 1 4 h 1 i h 1 h 2 u m h 1 h 2 for r 1 eq 17 cannot determine λ 2 3 and λ 2 4 hence we need to study the o ε 3 equation 23 λ 0 2 2 u 1 λ 0 u 1 2 g h 1 2 λ 0 λ 3 2 u 1 λ 3 2 λ 1 λ 2 2 u m λ 2 λ 0 2 2 u 1 λ 0 u 1 2 g h 2 2 λ 0 λ 3 2 u 1 λ 3 2 λ 1 λ 2 2 λ 0 λ 1 2 u 1 λ 1 2 λ 0 λ 2 2 u 1 λ 2 λ 1 2 2 u m λ 1 u m 2 2 λ 0 λ 1 2 u 1 λ 1 2 u m λ 0 2 u 1 u m 2 λ 0 λ 2 2 u 1 λ 2 0 substituting λ 0 3 4 u 1 and λ 1 λ 1 3 4 of 22 into eq 23 we get 24 g h 1 2 λ 1 λ 2 2 u m λ 2 2 g h 2 λ 1 λ 2 0 which results in λ 2 3 4 0 in summary for r 1 the second order expansions of the pde system eigenvalues are 25 λ 1 λ 0 1 λ 1 1 ε 1 λ 2 1 ε 2 o ε 3 h 1 u 1 h 2 u 2 h 1 h 2 g h 1 h 2 3 h 1 h 2 u 1 u 2 2 2 g h 1 h 2 5 2 o u 1 u 2 3 u m 3 26 λ 2 h 1 u 1 h 2 u 2 h 1 h 2 g h 1 h 2 3 h 1 h 2 u 1 u 2 2 2 g h 1 h 2 5 2 o u 1 u 2 3 u m 3 27 λ 3 h 1 u 2 h 2 u 1 h 1 h 2 i u 1 u 2 2 1 h 1 h 2 h 1 h 2 2 o u 1 u 2 3 u m 3 28 λ 4 h 1 u 2 h 2 u 1 h 1 h 2 i u 1 u 2 2 1 h 1 h 2 h 1 h 2 2 o u 1 u 2 3 u m 3 where λ 1 2 and λ 3 4 are the barotropic and baroclinic speeds respectively the first order truncations of 25 26 27 28 recover the approximations reported by audusse 2005 for layered flows of uniform density for r 1 it is worth remarking that any non zero velocity difference between the layers immediately causes the loss of hyperbolicity the modulus of the imaginary parts of λ 3 4 is bounded by u 1 u 2 2 and depends on the factor 1 h 1 h 2 h 1 h 2 2 1 note that beside the case u 1 u 2 0 the system is asymptotically stable even if one layer thickness becomes negligible compared to the other h 1 h 2 h 1 h 2 1 the importance of the quantity κ h 1 h 2 h 1 h 2 hereafter referred to as relative thickness difference confirms that the source of instability due to r 1 and a non zero velocity difference ultimately depends on the pressure coupling between the layers and thus to be effective requires that the layers thicknesses are non negligible with respect to each other the degenerate hyperbolic region is given by the criterion 29 u 1 u 2 2 1 κ 0 3 1 1 special case r 1 o ε α here we assume that r is slightly smaller than 1 with 1 r o ε α α 2 the o ε 0 equation 12 is thus recast as 30 λ 0 2 2 λ 0 u 1 g h 1 u 1 2 λ 0 2 2 λ 0 u 1 g h 2 u 1 2 g 2 h 1 h 2 0 and admits the same roots λ 0 1 2 u 1 g h 1 h 2 λ 0 3 4 u 1 already found for r 1 the remaining part of rg 2 h 1 h 2 i e the term 1 r g 2 h 1 h 2 cannot be accounted for in the o ε 1 equation since the modified o ε 1 equation would have no solutions for the two baroclinic branches i e with λ 0 3 4 u 1 we would get 1 r ε g 2 h 1 h 2 0 thus from the o ε 1 equation we get the same roots of r 1 conversely the o ε 2 equation 17 is rewritten as follows 31 λ 0 2 2 u 1 λ 0 u 1 2 g h 1 2 λ 0 λ 2 2 u 1 λ 2 λ 1 2 2 u m λ 1 u m 2 λ 0 2 2 u 1 λ 0 u 1 2 g h 2 2 λ 0 λ 2 2 u 1 λ 2 λ 1 2 2 λ 0 λ 1 2 u 1 λ 1 2 λ 0 λ 1 2 u 1 λ 1 2 u m λ 0 2 u 1 u m 1 r ε 2 g 2 h 1 h 2 0 the barotropic roots λ 2 1 and λ 2 2 are slightly different than the ones from 20 32 λ 2 1 3 h 1 h 2 u m 2 2 g h 1 h 2 5 2 g 1 r h 1 h 2 h 1 h 2 u m 2 2 g h 1 h 2 5 2 u 1 u 2 2 λ 2 2 3 h 1 h 2 u m 2 2 g h 1 h 2 5 2 g 1 r h 1 h 2 h 1 h 2 u m 2 2 g h 1 h 2 5 2 u 1 u 2 2 while λ 2 3 4 are indeterminate analogous to that found with 20 indeed after substituting λ 0 3 4 u 1 into 31 we get 33 g h 1 λ 1 2 2 u m λ 1 u m 2 g h 2 λ 1 2 1 r ε 2 g 2 h 1 h 2 0 which substituting ε u 1 u 2 u m is recast as 34 g h 1 λ 1 2 2 u m λ 1 u m 2 g h 2 λ 1 2 1 r u 1 u 2 2 u m 2 g 2 h 1 h 2 0 eq 34 allows to determine the still unknown first order baroclinic coefficients 35 λ 1 3 u m h 1 u 1 u 2 h 1 h 2 g 1 r h 1 h 2 u 1 u 2 2 h 1 h 2 u 2 u 1 λ 1 4 u m h 1 u 1 u 2 h 1 h 2 g 1 r h 1 h 2 u 1 u 2 2 h 1 h 2 u 2 u 1 λ 1 3 4 are real numbers if and only if 36 g 1 r h 1 h 2 u 1 u 2 2 0 the stability condition 36 here derived under the hypothesis that r 1 o ε α recovers the approximate criterion 10 different from the case with r 1 the hyperbolic domain is not degenerate yet only the left hyperbolic region cf fig 2 is predicted by 36 since this condition is still based on the assumption of small velocity differences moreover it is interesting to note that different from the stability criterion 29 36 depends on the quantities 1 r h 1 h 2 u 1 u 2 but not on κ h 1 h 2 h 1 h 2 it indicates that κ is not critical for the stability if r is smaller but close to 1 nonetheless we anticipate cf sec 3 4 that beyond the range of validity of cond 36 some effects of κ on the stability arise similar to that already observed in cond 29 finally to determine λ 2 3 and λ 2 4 we use the o ε 3 equation 23 which is unchanged substituting λ 0 3 4 u 1 and the expressions of λ 1 3 4 reported in 35 into 23 it can be checked that also in this case λ 2 3 4 0 the expansions of the eigenvalues up to o ε 2 for r 1 o ε α are summarized below 37 λ 1 2 λ 0 1 2 λ 1 1 2 ε 1 λ 2 1 2 ε 2 o ε 3 h 1 u 1 h 2 u 2 h 1 h 2 g h 1 h 2 3 h 1 h 2 u 1 u 2 2 2 g h 1 h 2 5 2 g 1 r h 1 h 2 h 1 h 2 2 g h 1 h 2 5 2 o u 1 u 2 3 u m 3 38 λ 3 4 h 2 u 1 h 1 u 2 h 1 h 2 g 1 r h 1 h 2 h 1 h 2 u 1 u 2 2 h 1 h 2 h 1 h 2 2 o u 1 u 2 3 u m 3 by truncating 37 38 at the first order we recover the classical formulae by schijf and schönfled 1953 3 2 asymptotic analysis for layers of comparable thicknesses here we perform a different asymptotic analysis by assuming that the layers thicknesses are comparable namely we introduce the alternative asymptotic parameter ε h 2 h 1 h 1 h 2 with ε 1 thus the layers thicknesses are expressed as h 1 h ε h and h 2 h ε h with h h 1 h 2 2 without loss of generality the layers velocities can be written as u 1 u δ u 2 and u 2 u δ u 2 with u u 1 u 2 2 and δu u 1 u 2 therefore eq 5 is recast as 39 λ 2 2 λ u δ u 2 u δ u 2 2 g h ε h λ 2 2 λ u δ u 2 u δ u 2 2 g h ε h r g 2 h ε h h ε h 0 substituting λ λ 0 λ 1 ε λ 2 ε 2 o ε 3 into 39 the o ε 0 equation is 40 λ 0 2 2 λ 0 u δ u 2 u δ u 2 2 g h λ 0 2 2 λ 0 u δ u 2 u δ u 2 2 g h r g 2 h 2 0 although less obvious than the case of eq 12 also 40 is a biquadratic equation indeed introducing the variable ζ λ 0 u 2 40 is recast as 41 ζ 2 2 g h 1 2 δ u 2 ζ g 2 h 2 1 r δ u 2 1 16 δ u 2 1 2 g h 0 which yields the solutions 42 λ 0 1 u 1 2 δ u 2 4 g h 4 g h δ u 2 r g h λ 0 2 u 1 2 δ u 2 4 g h 4 g h δ u 2 r g h λ 0 3 u 1 2 δ u 2 4 g h 4 g h δ u 2 r g h λ 0 4 u 1 2 δ u 2 4 g h 4 g h δ u 2 r g h where the superscripts 1 2 and 3 4 respectively stand for the barotropic and baroclinic branches while λ 0 1 2 are always real λ 0 3 4 are real if and only if 43 δ u 2 4 g h 4 g h δ u 2 r g h the o ε 1 equation associated with 39 is 44 4 λ 0 3 12 u λ 0 2 12 u 2 4 g h δ u 2 λ 0 4 u 3 4 g h δ u 2 u λ 1 2 δ u g h λ 0 2 δ u g h u 0 its solution takes the form 45 λ 1 2 δ u g h λ 0 u 4 λ 0 3 12 u λ 0 2 12 u 2 4 g h δ u 2 λ 0 4 u 3 4 g h δ u 2 u substituting the o ε 0 solutions λ 0 1 2 3 4 into 45 we obtain 46 λ 1 1 2 δ u g h 2 g h r g h δ u 2 λ 1 3 4 δ u g h 2 g h r g h δ u 2 the o ε 2 equation is obtained from 39 47 8 λ 0 3 24 u λ 0 2 24 u 2 8 g h 2 δ u 2 λ 0 8 u 3 8 g h 2 δ u 2 u λ 2 12 λ 0 2 24 u λ 0 12 u 2 4 g h δ u 2 λ 1 2 4 δ u g h λ 1 2 g 2 h 2 r 2 g 2 h 2 0 whence 48 λ 2 12 λ 0 2 24 u λ 0 12 u 2 4 g h δ u 2 λ 1 2 4 δ u g h λ 1 2 g 2 h 2 r 2 g 2 h 2 8 λ 0 3 24 u λ 0 2 24 u 2 8 g h 2 δ u 2 λ 0 8 u 3 8 g h 2 δ u 2 u substituting the o ε 0 and o ε 1 coefficients into 47 we get 49 λ 2 1 g h r g h δ u 2 2 r g h δ u 2 2 4 r g 2 h 2 2 δ u 2 g h r g h δ u 2 8 r g h δ u 2 2 4 g h δ u 2 4 g h r g h δ u 2 λ 2 2 λ 2 1 λ 2 3 g h r g h δ u 2 2 r g h δ u 2 2 4 r g 2 h 2 2 δ u 2 g h r g h δ u 2 8 r g h δ u 2 2 4 g h δ u 2 4 g h r g h δ u 2 λ 2 4 λ 2 3 in summary the asymptotic expansions up to the second order are put together below 50 λ 1 u 1 u 2 2 1 2 δ u 2 4 g h 4 g h r g h δ u 2 δ u g h 2 g h r g h δ u 2 h 2 h 1 h 1 h 2 1 g h r g h δ u 2 2 r g h δ u 2 2 4 r g 2 h 2 2 δ u 2 g h r g h δ u 2 8 r g h δ u 2 2 δ u 2 4 g h 4 g h r g h δ u 2 h 2 h 1 h 1 h 2 2 o h 2 h 1 3 h 1 h 2 3 51 λ 2 u 1 u 2 2 1 2 δ u 2 4 g h 4 g h r g h δ u 2 δ u g h 2 g h r g h δ u 2 h 2 h 1 h 1 h 2 1 g h r g h δ u 2 2 r g h δ u 2 2 4 r g 2 h 2 2 δ u 2 g h r g h δ u 2 8 r g h δ u 2 2 δ u 2 4 g h 4 g h r g h δ u 2 h 2 h 1 h 1 h 2 2 o h 2 h 1 3 h 1 h 2 3 52 λ 3 u 1 u 2 2 1 2 δ u 2 4 g h 4 g h r g h δ u 2 δ u g h 2 g h r g h δ u 2 h 2 h 1 h 1 h 2 1 g h r g h δ u 2 2 r g h δ u 2 2 4 r g 2 h 2 2 δ u 2 g h r g h δ u 2 8 r g h δ u 2 2 δ u 2 4 g h 4 g h r g h δ u 2 h 2 h 1 h 1 h 2 2 o h 2 h 1 3 h 1 h 2 3 53 λ 4 u 1 u 2 2 1 2 δ u 2 4 g h 4 g h r g h δ u 2 δ u g h 2 g h r g h δ u 2 h 2 h 1 h 1 h 2 1 g h r g h δ u 2 2 r g h δ u 2 2 4 r g 2 h 2 2 δ u 2 g h r g h δ u 2 8 r g h δ u 2 2 δ u 2 4 g h 4 g h r g h δ u 2 h 2 h 1 h 1 h 2 2 o h 2 h 1 3 h 1 h 2 3 3 2 1 stability criterion for layers of comparable thicknesses the above asymptotic expansions carried out for κ h 2 h 1 h 1 h 2 1 may yield two complex eigenvalues as λ 0 3 4 may become complex conversely λ 1 and λ 2 are always real for all branches of the solution as the dominant imaginary parts of λ 3 4 are given by the corresponding o ε 0 coefficients the inequality 43 can be regarded as a criterion for the pde system hyperbolicity which is exact for κ 0 after some algebraic manipulations 43 is recast as 54 g 2 1 r h 1 h 2 2 δ u 2 g h 1 h 2 δ u 2 4 0 it is interesting to compare cond 54 with 36 derived under the hypotheses of δu 0 and r 1 the two conditions show a similar structure with the only difference being represented by the term δ u 2 4 which has a stabilizing effect for δu 0 cond 54 recovers the stability criterion 36 thanks to the quadratic term δu 2 54 describes two separate hyperbolic regions and thus is also capable of capturing the right hyperbolic region cf fig 2 please note that the left hand side of 54 is a second degree polynomial in the two variables h 1 h 2 and δu 2 and hence it can be easily factorized consequently 54 is decomposed into the following two conditions 55 δ u 2 2 g 1 r h 1 h 2 0 56 δ u 2 2 g 1 r h 1 h 2 0 which respectively correspond to the left and right hyperbolic domains for 1 r 0 thus 2 1 r 1 r hence the leading order approximation of 55 recovers the stability criterion 36 this remarkable correspondence between the two stability criteria also explains why in the limit of 1 r 0 the classical criterion 36 gives a reasonably good estimation of the hyperbolic boundary even for large values of δu cf fig 2 a for r 0 55 56 are alternatively verified for any flow condition as the middle non hyperbolic region vanishes 3 3 asymptotic analysis for the limiting case of very large thickness difference finally we perform the asymptotic analysis for κ 1 we assume that h 2 h 1 and thus h 2 h 1 h 1 h 2 1 however note that eq 5 is symmetric with respect to the layers indices hence the choice of h 2 h 1 is irrelevant in this analysis here we define the asymptotic parameter as ε 1 h 2 h 1 h 1 h 2 0 hence the layers thicknesses are h 1 ε h and h 2 2 ε h with h h 1 h 2 2 as in sec 3 2 we use the notation u 1 u δ u 2 u 2 u δ u 2 with u u 1 u 2 2 and δu u 1 u 2 eq 5 is recast as 57 λ 2 2 λ u δ u 2 u δ u 2 2 g ε h λ 2 2 λ u δ u 2 u δ u 2 2 g h 2 ε r g 2 h 2 2 ε ε 0 the o ε 0 equation is 58 λ 0 2 2 λ 0 u δ u 2 u δ u 2 2 λ 0 2 2 λ 0 u δ u 2 u δ u 2 2 2 g h 0 whence 59 λ 0 1 u δ u 2 2 g h u 2 g h 1 h 2 λ 0 2 λ 0 1 λ 0 3 u δ u 2 u 1 λ 0 4 λ 0 3 the o ε 1 equation is 60 4 λ 0 3 12 u λ 0 2 12 u 2 4 g h δ u 2 λ 0 4 u 3 4 g h δ u 2 u 2 δ u g h λ 1 2 δ u g h u 1 λ 0 2 1 r g 2 h 2 0 substituting λ 0 1 2 in 60 we obtain the two barotropic coefficients 61 λ 1 1 δ u g h 8 g h δ u 2 g 2 h 2 1 r 8 g h 2 g h δ u 2 8 δ u g h λ 1 2 δ u g h 8 g h δ u 2 g 2 h 2 1 r 8 g h 2 g h δ u 2 8 δ u g h conversely substituting λ 0 3 4 in 60 we get 62 0 λ 1 2 g 2 h 2 1 r δ u 2 g h 0 which does not allow to determine λ 1 3 4 moreover eq 62 is verified only for certain values of the solution thus we need to take into account the non zero remainder of the left hand side of 62 in the baroclinic branches of the o ε 2 equation the o ε 2 equation valid for the barotropic branches of the solution is given by 63 4 λ 0 3 12 u λ 0 2 12 u 2 4 g h δ u 2 λ 0 4 u 3 4 g h δ u 2 u 2 δ u g h λ 2 6 λ 0 2 12 u λ 0 6 u 2 2 g h 1 2 δ u 2 λ 1 2 2 δ u g h λ 1 r 1 g 2 h 2 0 after substituting λ 0 1 2 and λ 1 1 2 into 63 we obtain the coefficients λ 2 1 and λ 2 2 not reported here for brevity differently for the two baroclinic branches the o ε 2 equation 63 is modified with the remainder of 62 namely 64 4 λ 0 3 12 u λ 0 2 12 u 2 4 g h δ u 2 λ 0 4 u 3 4 g h δ u 2 u 2 δ u g h λ 2 6 λ 0 2 12 u λ 0 6 u 2 2 g h 1 2 δ u 2 λ 1 2 2 δ u g h λ 1 r 1 g 2 h 2 2 g 2 h 2 1 r δ u 2 g h ε 0 by substituting λ 0 3 4 into 64 we obtain the following equation in λ 1 65 ε 2 g h δ u 2 λ 1 2 2 ε δ u g h λ 1 ε 2 2 ε r g 2 h 2 δ u 2 g h 0 whence 66 λ 1 3 2 ε δ u g h 4 ε 2 δ u 2 g 2 h 2 4 ε 2 g h δ u 2 ε 2 2 ε r g 2 h 2 δ u 2 g h 2 ε 2 g h δ u 2 λ 1 4 2 ε δ u g h 4 ε 2 δ u 2 g 2 h 2 4 ε 2 g h δ u 2 ε 2 2 ε r g 2 h 2 δ u 2 g h 2 ε 2 g h δ u 2 obviously λ 1 3 and λ 1 4 are real if and only if 67 δ u 4 δ u 2 g h 1 h 2 2 r 1 ε 2 g 2 h 1 h 2 2 1 r 1 ε 2 0 in the limit that ε 0 67 is recast as 68 δ u 4 δ u 2 g h 1 h 2 2 r g 2 h 1 h 2 2 1 r 0 equivalent to 69 δ u 2 g h 1 h 2 δ u 2 g 1 r h 1 h 2 0 69 can be decomposed into the following inequalities 70 δ u 2 g 1 r h 1 h 2 0 71 δ u 2 g h 1 h 2 0 it is interesting to note that cond 70 is equivalent to 36 derived with the completely different assumptions of 1 r 0 and δu 0 on the one hand it suggests that for the stability κ 1 is equivalent to assuming 1 r 0 it is reasonable considering that both factors play a similar role in the model stability through the pressure distributions within the layers however it should be remarked that cond 70 is valid for any density ratio and hence it expands the range of validity of 36 another clear advantage of the present analysis over the previous asymptotical analysis with δu 1 is that a description of the right hyperbolic region is also provided cond 71 comparing cond 70 with 55 it can be also noted that the left hyperbolic region by 70 is strictly contained in the region by 55 thus conditions 55 and 70 whose difference vanishes for r 1 are lower and upper bounds for the left boundary of the non hyperbolic region cf fig 2 conversely conditions 71 and 56 represent the upper and lower bounds of the right boundary 3 4 general stability conditions the latter asymptotic analyses carried out by respectively assuming small and diverging thickness differences between the layers provided new stability criteria 55 56 and 70 71 capable of describing both left and right hyperbolic regions clearly for intermediate values of κ the criteria 55 56 derived for κ 1 and especially the criteria 70 71 derived in the sharp limit of κ 1 are expected to yield some errors yet the analytical structures of 55 56 and 70 71 are very similar and characterized by a proportionality between δu 2 and h 1 h 2 through a certain factor depending on r thus by keeping this analytical structure it could be possible to derive a general stability criterion also valid for intermediate values of κ by assuming that the limiting conditions 55 56 and 70 71 are smoothly connected to each other by two regularization functions ξ1 κ r and ξ2 κ r a generalized reformulation of 55 56 can be written in the following compact forms 72 δ u 2 2 g 1 r ξ 1 κ r h 1 h 2 1 73 δ u 2 2 g 1 r ξ 2 κ r h 1 h 2 1 where ξ1 κ r and ξ2 κ r have to fulfill the following constraints 74 ξ 1 0 r 1 ξ 2 0 r 1 ξ 1 1 r 1 r 2 1 r ξ 2 1 r 1 2 1 r in the limiting cases of r 0 and r 1 74 yields 75 ξ 1 1 0 ξ 2 1 0 1 2 ξ 1 1 1 1 ξ 2 1 1 1 4 4 numerical tests and approximate stability criteria in this section by an extensive numerical investigation we propose suitable approximations of the functions ξ1 and ξ2 sketched in 72 73 subsequently we investigate the reliability of the various stability criteria 4 1 calibration of the regularization functions the asymptotic analyses for κ 1 and κ 1 indicate that the boundaries between the hyperbolic and non hyperbolic regions may be described by a linear relationship between δu 2 and h 1 h 2 we numerically checked that this behavior is also verified for intermediate values of 0 κ 1 after setting arbitrary values for κ and r we generated 106 random values of h 1 h 1 u 1 h 2 h 2 u 2 t in the ranges 0 m h 1 h 2 50 m and 0 u 1 u 2 20 m s different from the random generations reported in fig 2 here the layers thicknesses h 1 and h 2 are constrained by the fixed κ h 1 h 2 h 1 h 2 chosen a priori the following values of κ and r encompassing the entire range of flow conditions have been investigated 76 k 0 01 0 1 0 2 0 3 0 4 0 5 0 6 0 7 0 8 0 9 0 99 77 r 0 01 0 1 0 2 0 3 0 4 0 5 0 6 0 7 0 8 0 9 0 99 the numerical data confirm that the boundaries of the hyperbolic and non hyperbolic regions always exhibit a linear behavior for any choice of κ and r as an example fig 3 reports the hyperbolic and non hyperbolic states in the plane δu 2 h 1 h 2 for the case κ 0 5 and r 0 2 from fig 3 it can be noted that the boundaries between hyperbolic and non hyperbolic regions are sharp different from fig 2 b it is due to the fact that here all states share the same κ by numerically tracking the linear boundaries of the non hyperbolic region for each investigated combination of κ r we calculated the best fitting ratios h 1 h 2 δ u 2 at the boundaries the coefficient of determination r 2 was found 0 99 for all investigated combinations of κ and r then by exploiting 72 73 we obtained numerical point wise estimations of the regularization functions denoted as ξ 1 κ r and ξ 2 κ r considering the generalized stability conditions 72 73 and the constraints 74 we propose the following exponential functions for ξ1 κ r and ξ2 κ r 78 ξ 1 κ r exp ln 1 r 1 κ a 1 1 r 2 r 2 1 r b 1 κ c 1 79 ξ 2 κ r exp ln 1 1 κ a 2 1 2 r 2 1 r b 2 κ c 2 where the parameters ai bi and ci have to be calibrated on ξ 1 and ξ 2 note that 78 79 are constructed in such a way that for κ 0 the first two conditions of 74 are fulfilled in a smooth way conversely for κ 1 78 and 79 respectively tend to 1 r 2 1 r and 1 2 1 r as required by the other two constraints the best fitting values of ai bi and ci are reported in table 1 together with the fitness indicators r 2 coefficient of determination sse sum of squares due to error and rmse root mean square error moreover comparisons between ξ1 and ξ 1 and between ξ2 and ξ 2 are reported in fig 4 as shown in table 1 and in fig 4 the agreement between the best fitting functions 78 79 and the numerical data is very good it confirms that the choice of the simple analytical functions 78 and 79 is reasonable more sophisticated functions with a higher number of parameters would further improve the description of ξ1 and ξ2 but it goes beyond the scope of this work we found that the best fitting values of the parameters b 1 and c 1 were very close to 1 thus we chose to set them exactly equal to 1 it allowed a further simplification of the analytical expression of ξ1 with the only a 1 parameter to be optimized cf table 1 from fig 4 it is interesting noting that ξ1 and ξ2 are 1 for a quite large range of κ specifically ξ1 0 98 for κ 0 3 and ξ2 0 98 for κ 0 2 it indicates that the unmodified asymptotic stability conditions 55 56 are able to yield reasonably accurate results for these lower ranges of κ for both ξ1 and ξ2 the largest errors typically occur in correspondence of relatively high values of κ 0 7 in particular for very small values of r 0 1 cf fig 4 both the conditions r 0 1 and κ 0 7 are quite rare in real geophysical flows hence these errors are expected to be of little relevance in applications fig 5 illustrates the boundaries of the non hyperbolic region calculated by the generalized stability conditions 72 73 for different values of κ and r as expected the left boundary moves upwards as κ increases while the differences between the curves corresponding to different κ become smaller as r increases also the right boundary heaves for increasing κ but is almost independent from r as a matter of fact it should be noted that little inaccuracies in ξ1 and ξ2 may still occasionally lead to a wrong hyperbolicity check a false positive exists when the approximate stability criterion wrongly detects a hyperbolicity loss in opposition a false negative occurs if the approximate criterion wrongly detects a hyperbolic state false negatives are more detrimental than false positives if the stability criteria are used in a numerical treatment for the hyperbolicity loss castro et al 2011 sarno et al 2017 as they may potentially cause numerical instabilities when the mesh is refined a false negative occurs at the left boundary if the best fitting of ξ1 overestimates its exact value while the opposite holds for ξ2 from the present numerical investigation it emerges that the maximum error on ξ1 is e max ξ 1 max ξ 1 ξ 1 0 012 while e min ξ 2 min ξ 2 ξ 2 0 004 considering that the residuals are everywhere small compared to the order of magnitude of ξ1 and ξ2 and that they typically increase with κ it can be found a small constant w max e max ξ1 e min ξ2 such that the following modified regularization functions 80 ξ 1 κ r ξ 1 κ r w κ 81 ξ 2 κ r ξ 2 κ r w κ yield no false negatives on the basis of our numerical tests a workable choice is w 0 015 4 2 validation finally we study the performance of the various stability criteria on a large numerical dataset composed of 106 uniformly distributed random generations of q in the following intervals chosen larger than the ones employed for calibration sec 4 1 0 m h 1 h 2 100 m 30 m s u 1 u 2 30 m s 0 r 1 four stability criteria are tested criterion i cond 55 56 derived by asymptotic analysis for κ 0 criterion ii for the left hyperbolic region cond 70 derived for κ 1 for the right hyperbolic region cond 56 derived for κ 0 criterion iii generalized cond 72 73 with best fitting regularization functions 78 79 criterion iv generalized cond 72 73 with the modified regularization functions 80 81 in table 2 the error rates are reported together with the occurrence rates of false positives and false negatives as it is clear from the table the best results are obtained with criterion iii and criterion iv where the minimum amount of false negative cases as expected is achieved by criterion iv at the cost of a slightly higher error rate 0 1682 vs 0 1146 it can be noted that a very small but not zero occurrence rate of false negatives is observed even with criterion iv this very small numerical discrepancy which corresponds to just one false negative out of one million of random generations is probably due to a slight underestimation of w in 80 81 which has been independently estimated on narrower ranges of layers thicknesses and velocities as expected criterion i yields more accurate results than the more conservative criterion ii the only advantage of criterion ii is that it never yields false negatives because it systematically underestimates the extension of both hyperbolic regions this numerical result also confirms that the conditions 56 and 70 exactly correspond to the external bounds of the non hyperbolic region now we consider a slightly different numerical dataset where 106 random generations of q are selected from the same intervals 0 m h 1 h 2 100 m 30 m s u 1 u 2 30 m s 0 r 1 by enforcing that κ 0 5 this constraint on the layers thicknesses appears reasonable for the majority of real geophysical flows since it amounts to assuming that the thicker layer is at most 3 times larger than the other layer the error rates of the various criteria are reported in table 3 as shown by the table all criteria perform even better than the case without constraints on κ in particular criteria iii and iv exhibit overall errors 0 1 moreover as a confirmation of the trend reported in fig 5 it is interesting to note that the simple criterion i derived for κ 1 yields reasonably consistent results with an overall error rate of approximately 0 43 5 application of the proposed stability criteria to the treatment for the hyperbolicity loss an important application of the new stability criteria is represented by the numerical treatment for the hyperbolicity loss castro et al 2011 which can be implemented with any finite volume scheme by a multi stage operator splitting technique in the present numerical application without loss of generality we employ the roe approximate riemann solver roe 1981 and a fractional step godunov splitting approach e g leveque 2004 5 1 numerical treatment for the loss of the hyperbolicity the numerical solution of the two layer pde system can be obtained through a two stage explicit scheme 82 stage i t q a x q 0 q i j 1 stage ii d q d t s q t t j q i j 1 q i j 1 in 82 the intermediate numerical solution q i j 1 at the i th cell and at the time point j 1 is calculated by some suitable finite volume scheme while the effects of the source term are calculated in stage ii by solving an ordinary differential equation ode with initial condition q i j 1 the treatment for the hyperbolicity loss proposed by castro et al 2011 consists of introducing an extra momentum exchange fextra 0 cf 6 to be accounted for in a stage iii subsequent to the two stages of scheme 82 in which the ode 83 d q d t 0 f e x t r a sgn u 1 u 2 0 r f e x t r a sgn u 1 u 2 t is solved with initial condition q i j 1 obtained by stage ii if q i j 1 is non hyperbolic fextra has to be large enough to keep the solution within the left hyperbolic region semi explicit expressions for fextra were derived by castro et al 2011 by using the classical approximate criterion 10 specifically it is assumed that 84 f e x t r a c u 1 u 2 where the factor u 1 u 2 is treated implicitly and the parameter c is treated explicitly i e as a function of q i j 1 and is determined in such a way that the updated solution q i j 1 lies on the hyperbolic boundary predicted by 10 85 c 1 τ max 0 u 1 u 2 g 1 r h 1 h 2 1 h 1 h 2 h 2 r h 1 in 85 τ is the relaxation time towards the equilibrium which can be interpreted as the characteristic time of restabilization associated to the mixing process to reach the equilibrium within the time advancement δt t j 1 tj it is required that τ δt without loss of generality it can be set τ δt for more details about the derivation of 85 we refer the reader to castro et al 2011 a more accurate and yet more computationally expensive way to estimate fextra was proposed by sarno et al 2017 this approach different from the one based on criterion 10 is workable for any density ratio and is based on the iterative illinois algorithm where the hyperbolicity is repeatedly checked by the discriminant method and a convergence criterion on fextra depending on a small threshold is employed 5 2 new formula for determining fextra in this application we employ the generalized left stability criterion 72 which describes the physically relevant hyperbolic region in geophysical flows since 72 with the definition of the regularization function ξ1 78 has an analytical form it is possible to reach an expression for fextra more accurate than 84 85 specifically keeping 84 in order to obtain that the updated solution q i j 1 lies on the hyperbolic boundary predicted by 72 eq 85 is modified as 86 c 1 δ t max 0 u 1 u 2 2 g 1 r ξ 1 κ r h 1 h 2 1 h 1 h 2 h 2 r h 1 analogous to castro et al 2011 the updated momentum components of q i j 1 are calculated semi implicitly by the linear system 87 h 1 u 1 i j 1 h 1 u 1 i j 1 δ t c i j 1 h 2 u 2 i j 1 h 2 i j 1 h 1 u 1 i j 1 h 1 i j 1 h 2 u 2 i j 1 h 2 u 2 i j 1 δ t r c i j 1 h 2 u 2 i j 1 h 2 i j 1 h 1 u 1 i j 1 h 1 i j 1 5 3 test case of an exchange flow with non hyperbolic initial conditions and small density ratio an exchange flow with non hyperbolic initial conditions and small density ratio was proposed by sarno et al 2017 as a paradigmatic test case to show that for small density ratios the numerical treatment proposed by castro et al 2011 not only yields less accurate results but may even change the flow structure by modifying the signs of the layers velocities here we employ a similar test to show that the semi implicit treatment 87 with the modification 86 well approximates the reference solution obtained by using the more computationally expensive iterative method by sarno et al 2017 the test case describes the exchange flow of two superimposed fluids with r 0 3 the spatial domain is x 1 1 and the initial conditions are 88 h 1 x 0 0 1 m if x 0 5 m 0 5 m if x 0 5 m h 2 x 0 1 0 m h 1 x 0 u 1 x 0 1 00 m s u 2 x 0 3 00 m s to study the performance of the hyperbolicity treatment with the new stability criteria over a wide range of κ the initial conditions 88 are chosen such that κ 0 for x 0 5m and κ 0 8 in the middle region x 0 5m non reflective boundary conditions are imposed at x 1 and x 1 the numerical simulations reported below are performed by using a spatial discretization δx 1 200 0 005 m while various mesh refinements have been tested for checking grid convergence to get stable time steps δt the courant friedrichs lewy cfl number was set equal to 0 95 for all simulations analogous to sarno et al 2017 to which we refer the reader for details the advection terms of the pde system 1 are treated by means of a first order finite volume scheme based on the roe approximate riemann solver with the real jordan decomposition roe 1981 castro et al 2011 although the scope of this numerical investigation does not include the optimization of the advection numerical scheme it is worth remarking that the numerical treatment for the hyperbolicity loss is compatible with any finite volume scheme more efficient advection numerical schemes are reported e g by krvavika et al 2018 the following options for the numerical treatment of the hyperbolicity loss are tested sim a iterative algorithm by sarno et al 2017 where the hyperbolicity is checked by the discriminant 8 of the quartic characteristic polynomial sim b iterative algorithm by sarno et al 2017 where the hyperbolicity is checked by the discriminant of the resolvent cubic 9 sim c semi implicit formulae 86 87 and fextra parameterized according to the stability criterion 10 sim d semi implicit formulae 86 87 and fextra parameterized according to the stability criterion 72 the illinois iterative algorithm in sim a and sim b is run with the convergence threshold equal to 10 5m2 s as suggested by sarno et al 2017 sim d is run with the modified regularization function ξ 1 determined by 80 with w 0 015 the numerical simulations were carried out on a pc with intel core i7 9700k 3 60ghz and were run up to t 5s when the steady state is reached table 4 lists the relevant numerical results the maximum value of fextra reported in table 4 occurs in the first time step for all simulations as expected sim a and sim b yield exactly the same numerical results with a slightly lower run time for sim b this improvement is in qualitative agreement with krvavika et al 2018 fig 6 shows the layers thicknesses and velocities predicted by sim b sim c and sim d at the time points t 0 25s 0 5s 1 0s and 5 0s respectively it is evident that sim c obtained by using the approximate criterion 10 overcorrects the numerical solution indeed in this simulation the initial exchange flow becomes unidirectional and thus arrives at a completely different steady state than sim b this is due to the strong overestimation of the corrective momentum exchange fextra 771 2 m2 s2 table 4 at the beginning of the simulation in turn caused by the low density ratio that the approximate criterion 10 cannot cope with conversely sim d obtained by using the generalized stability criterion 72 is in excellent agreement with the reference numerical solution sim a and sim b with only minor discrepancies being observed where the gradients of the solution are steep figs 6 a b c the very good agreement among sim a sim b and sim d is also corroborated by the comparable values of max fextra 578 3 m2 s2 for sim d and 576 8 m2 s2 for sim a and sim b as well the steady state solution by sim d is almost identical to the one obtained by using the computationally more expensive iterative algorithm table 4 and fig 6 d fig 7 shows the maximum values of fextra calculated over the spatial domain as a function of time for representation convenience the larger values of fextra corresponding to the initial time interval t 0 002s are displayed in the inset plot of fig 7 it can be noted that the sim c systematically underestimates fextra for all t except for the first time step and furthermore it yields fextra 0 after t 0 5s this is due to the strong overestimation of fextra 771 2 m2 s2 at the beginning of the simulation which considerably modifies the flow dynamics differently the values of max fextra by sim d are very close to the ones by the reference sim b yet especially for t 0 5s it can be noticed that these values are slightly smaller than the ones by sim b this behavior is the consequence of the fact that in the earlier time steps sim d slightly overestimates fextra for t 0 5s a small time phase shift occurs between the corrections by sim b and sim d due to minor discrepancies between the flow dynamics predicted by the two simulations cf fig 6 looking at the run times of table 4 the advantage of the proposed algorithm is evident indeed the run time for sim d is considerably lower than sim b 124 6s versus 205 9s with a speed up of approximately 40 in this test case in the light of these findings we can state that while the iterative algorithm by sarno et al 2017 remains very accurate in determining the smallest amount of fextra necessary for guaranteeing the pde system hyperbolicity the proposed semi implicit treatment with the generalized stability criterion represents an excellent alternative with much lower computational costs the decrease of the computational time is even higher when a more refined mesh is used especially if the loss of hyperbolicity occurs in a large number of computational cells 5 3 1 mesh refinements and computational costs to better illustrate it the same test case is carried out with different mesh sizes δ x 1 50 1 100 1 200 1 400 1 800 1 1600 m and refinement ratio p 2 the cpu times for sim b and sim d are listed in table 5 the speed up of sim d over sim b further increases with the mesh refinement indeed while the run time of sim d increases by p 2 sim b shows a higher increase of the computational costs as the mesh becomes finer this is due to the additional overhead of the iterative algorithm employed for calculating fextra as we observed that the average number of iterations required by the illinois iterative algorithm to converge increases with the mesh refinement taking as reference the simulations obtained by sim b and sim d with the finest grid δ x 1 1600 m we could also estimate the relative ℓ1 norm errors e g leveque 2004 of the runs with coarse grids for a given time point j the relative ℓ1 norm error of the function q is defined as 89 e 1 i 1 n q i j q i j i 1 n q i j where q is the coarse numerical solution q is the reference solution i is the spatial discretization index and n is the number of cells in the coarse grid as expected we observed that for all variables h 1 h 1 u 1 h 2 h 2 u 2 e 1 decreases almost linearly with decreasing δx for any grid size the magnitudes of e 1 by the two treatments sim b and sim d are comparable although the two schemes converge to slightly different steady states which is expected since fextra are calculated in slightly different ways cf fig 7 fig 8 shows the simulation run times versus the relative errors e 1 obtained at the intermediate time point t 2 5s as it is evident from the figure not only sim d requires much less cpu resources than sim b but this advantage widens for decreasing values of e 1 hence for large scale simulations the semi implicit scheme with the new generalized stability criterion is preferable over the iterative scheme 5 4 test case of a 1d riemann problem with zero initial velocities here we present a test case consisting of a 1d riemann problem with zero velocities and non zero layers thicknesses this test is analogous to the wet bed dam break problem of the one layer shallow water model stoker 1957 and is similar to the shock tube test of gas dynamics leveque 2004 the spatial domain is x 1 1 and has non reflective boundaries at x 1 and x 1 the density ratio between the two fluids is r 0 5 and the initial data hyperbolic everywhere are piecewise constant 90 h 1 x 0 0 1 m h 2 x 0 1 9 m if x 0 m 0 1 m if x 0 m u 1 x 0 0 m s u 2 x 0 0 m s the jump of h 2 between left and right states q l and q r in 90 is chosen high enough so that there is a non hyperbolic intermediate region in the riemann solution i e the one directly connected to q r cf fig 9 although the meaningfulness of a riemann problem with non hyperbolic regions is debatable from a rigorous mathematical viewpoint e g keyfitz et al 2003 this test is of practical use to better study the effects of the hyperbolicity treatment on the numerical solution the code with the semi implicit algorithm 86 87 and the stability criteria 72 denoted with sim d as stated in sec 5 3 is run with δ x 1 1600 m and cfl 0 95 a comparative numerical solution denoted with sim e is obtained without the hyperbolicity treatment to properly capture transonic rarefactions in both codes we employed the harten entropy fix harten 1984 as expected while the numerical code sim d is found to converge to a similarity solution q x t q x t q l q r the one without the hyperbolicity treatment sim e yields catastrophic short wave instabilities noticeable from t 0 2s and rapidly growing with time till the solution blow up with reference to the time point t 0 2s fig 9 reports the calculated quantities h 1 h 2 h 2 h 1 u 1 and h 2 u 2 together with the extra momentum exchange fextra additionally fig 9 f illustrates the eigenvalues of the sim d solution indexed in ascending order λ 1 λ 2 λ 3 λ 4 which are useful to check the fulfilment of the entropy conditions in the sense of lax e g leveque 2004 the initial states q l to q r are connected to each other through a sequence of 3 intermediate states and 4 waves similar to the wet bed dam break problem e g tseng et al 2001 tai et al 2021 q l is connected to the first intermediate state by a left going rarefaction wave of the first characteristic family here corresponding to the smallest barotropic eigenvalue λ 1 and the third intermediate state is connected to q r by a lax 4 shock as well the second intermediate state is connected to the third one by a lax 3 shock yet interestingly the first intermediate state appears to be connected to the second one by a composite wave made of a 2 shock to which is attached a smooth wave of short length incidentally such a composite wave is entropy admissible in the sense of lax while conversely a unique 2 shock wave would be not fig 9 f although it is beyond the scope of this paper to theoretically determine why the numerical code converges to this precise weak solution it can be speculated that this phenomenon probably depends on the particular choice of the lipschitz continuous family of paths here assumed to be straight lines required to extend the definition of weak solution to non conservative pde systems dal maso et al 1995 parés 2006 on the other hand it is worth mentioning that minor effects on the convergence point might be also due to the particular numerical scheme as signalled by castro et al 2010 the hyperbolicity treatment is active at the right going shock connecting the third intermediate state to q r where a non zero fextra is continuously injected to guarantee the hyperbolicity of the cells immediately behind the hydraulic jump fig 9 e as expected the treatment causes some slight changes of the solution especially in the second and third intermediate states moreover the extra momentum fextra enters into play in the generalized rankine hugoniot jump conditions across the 4 shock e g castro et al 2010 hence it is expected to slightly change the shock speed as well nonetheless we observed that the speed of the 4 shock is only marginally modified in sim d while a slightly larger change occurs in the speed of the 3 shock with an increase of 3 over the one of sim e finally it is useful to compare the integral means of h 1 h 1 u 1 h 2 and h 2 u 2 in the intervals 1 x 0 and 0 x 1 the integral means reported in table 6 are practically identical in the left sub domain x 1 0 and are very similar to each other also in the right sub domain with the largest difference being observed for h 1 u 1 relative ℓ1 norm error of 5 6 conclusions in this work we systematically studied the eigenstructure of the two layer model by asymptotic analysis a first analysis was carried out by assuming small velocity differences between the layers from which the classical stability criterion by schijf and schönfled 1953 is recovered for r 1 subsequently various asymptotic analyses were carried out by alternatively assuming that the relative thickness difference between the layers κ h 1 h 2 h 1 h 2 is either small or very large this novel approach does not require any assumption on density ratio r or on the velocity difference between the layers u 1 u 2 and allows a new postulation of the stability criteria corresponding to the lower and upper bounds of both left and right boundaries of the non hyperbolic region generalized stability criteria were then proposed for intermediate values of κ i e for any flow condition the analytical structure of the generalized criteria is similar to the exact conditions derived for κ 0 and κ 1 while the determination of four parameters was required for the characterization of two regularization functions the best fitting values of these parameters were obtained by an extensive numerical investigation on the space of unknowns an excellent agreement between the semi analytical stability criteria and the actual hyperbolicity conditions was subsequently found by numerically exploring a much larger portion of the space of unknowns h 1 h 1 u 1 h 2 h 2 u 2 t the generalized stability criteria were then successfully implemented in a semi implicit numerical treatment for avoiding the hyperbolicity loss originally proposed by castro et al 2011 this treatment is based on the introduction of an extra momentum exchange fextra which has to be sufficient to keep the solution within the hyperbolic domain numerical investigations on a test case of a two layer exchange flow with small density ratio showed that the new stability criterion is more favorable than the classical approximate criterion moreover this new approach yields numerical results very close to the ones obtained by the iterative algorithm based on the discriminant method sarno et al 2017 but requires much less computational effort a second test showed the numerical stabilization of a 1d riemann problem with a non hyperbolic intermediate state which was successfully achieved thanks to the hyperbolicity treatment with the generalized stability criteria credit authorship contribution statement l s conceptualization methodology software validation formal analysis writing original draft writing review editing visualization funding acquisition y w writing original draft writing review editing formal analysis funding acquisition y c t writing original draft writing review editing formal analysis r m writing original draft writing review editing a c writing original draft writing review editing declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments this work is part of the project stratifiedgranular which received funding from the european union s horizon 2020 research and innovation programme under the marie skłodowska curie grant agreement no 797890 
278,laboratory experiments investigating the interaction of a lock exchange dense gravity current and a submerged obstacle with a triangular section have been conducted to determine the influence of the relative obstacle height i e the ratio between the heights of the current and the obstacle on the dynamics of the overflowing dense current experimental measurements were aimed to obtain detailed instantaneous density fields through an image analysis technique based on light attenuation the dense current is deeply affected by the interaction depending on the relative obstacle height when the height of the current approaching the obstacle is small a lower percentage of overflow propagates downstream and a large reduction in the gravity current velocity is observed the analysis of the density fields highlights that the formation of a macro vortex downstream of the obstacle is the mechanism responsible for the enhanced dilution of the overflow nevertheless the bulk entrainment parameter is slightly affected by the presence of a bottom obstacle results deepen our understanding of the entrainment processes related to the interaction with the obstacle and confirm the role of relevant non dimensional numbers keywords gravity currents experiments obstacle entrainment 1 introduction gravity currents generated by a density difference between two fluids are density driven flows developing predominantly in the horizontal direction the density difference can be due to temperature and salinity gradients or sediment concentration when the density difference is due to the presence of particles in suspension these flows are known as turbidity currents which are multiscale flows since their propagation is closely tied to the small scale mechanisms of erosion and re suspension of particles moreover at larger sediments concentrations the rheology of the fluid can be modified by a non newtonian behavior with significant consequences for the dynamics of the flow meiburg et al 2015 for large density differences non boussinesq gravity currents develop and a rising of the free surface close to the front position can be observed in the experiments sciortino et al 2018 longo et al 2018 for an accurate model prediction of non boussineq gravity currents free surface effects cannot be neglected gravity currents can occur spontaneously in nature for example as dense oceanic currents avalanches or sand storms hopfinger 1983 simpson 1997 but can also be the outcome of anthropic activities such as the accidental oil spills to marine areas or released pollutant mass dispersing in rivers with a significant impact on marine and fluvial ecosystems the spreading of gravity currents is affected by the ambient fluid which can be either homogeneous or density stratified in the latter condition internal waves are generated zemach et al 2017 ottolenghi et al 2020 in the ocean internal waves and internal solitary waves are mainly generated by the tide oscillation over rough features at the bottom such as ridges seamounts and canyons sarkar and scotti 2017 helfrich and melville 2006 previous studies showed that the interaction between internal solitary waves and the continental or near shore slope may cause their shoaling and breaking sutherland et al 2013 droghei et al 2016 cavaliere et al 2021 inducing mixing la forgia et al 2018b 2021 and bed material motion sutherland et al 2013 la forgia et al 2019 2020 the dynamics of gravity currents propagating in a stratified ambient fluid i e in presence of internal waves has been widely investigated by both laboratory experiments and theoretical models maxworthy et al 2002 ungarish and huppert 2002 longo et al 2016 zemach et al 2017 chiapponi et al 2018 also in the case of particulate gravity currents propagating in channels with a non rectangular cross section the propagation of dense bottom gravity currents is strongly controlled by topographic features cuthbertson et al 2014 2018 de falco et al 2021a inghilesi et al 2018 la rocca et al 2013 these currents develop generally over complex boundaries kyrousi et al 2018 venuleo et al 2019 zordan et al 2018a 2018b and the interaction with specific geometric configurations can deeply affect the dynamics of these flows and modify the final proprieties of the outflowing current a topographic discontinuity such as an obstacle on a horizontal bottom can deeply modify the structure of the bottom dense current can regulate the overflow and finally can cause the partial or complete confinement of it an example of gravity current interacting with a submerged obstacle is given by the study of dam reservoir where the concentration of sediments is often high and the development of turbidity currents due to underwater landslip is frequent the dense and highly concentrated current develops at the bottom of the reservoir travels downstream and possibly can reach the intake structures of the dam compromising its functionality de cesare et al 2001 thus the design of an appropriate structure as an obstacle able to stop or dissipate the dense current is essential for the proper functioning of the dam system moreover turbidity currents can represent a geohazard to seafloor structures and offshore pipelines and an accurate comprehension of the implications of the interaction can help to improve the engineering models and design depending on the parametric conditions characterizing these flows bruschi et al 2006 in the past few studies on gravity currents involving the interaction with a submerged obstacle or an array of elements have been developed bell 1942 developed an experimental study in channels emphasizing the importance of turbidity currents in sedimentation of reservoirs in their experiments the interaction of a turbidity current with a submerged barrier is investigated shallow water analysis was developed to describe the main features of the flow and the spillage of dense current greenspan and young 1978 lane serff et al 1995 rottman et al 1985 moreover numerical simulations were employed to investigate the structure and evolution of bottom propagating turbidity and gravity currents over one or a series of obstacles oehy and schleiss 2007 tokyay et al 2011 2014 obstacles with a triangular cross section are a good approximation to represent submerged barriers de cesare et al 2001 oehy and schleiss 2007 tokyay and constantinescu 2015 in this case many features of a gravity current interacting with a submerged triangular obstacle resemble the interaction with both up and downslopes in fact if the length of the obstacle is sufficiently large the gravity current propagating on the obstacle decelerates and can possibly stop before reaching the upper edge of the obstacle de falco et al 2020 2021b likewise the spillage of dense current overflowing the obstacle can be studied similarly to a downslope current in this case the front of the current is firstly characterized by an acceleration and then by a deceleration phase along the slope with the formation of a vortex at the rear of the head dai 2013a 2014 2015 steenhauer et al 2017 in this regard while many recent studies focused on the entrainment of fresh ambient water within a dense current propagating on a horizontal or inclined bottom cenedese and adduce 2008 2010 laanearu et al 2014 ottolenghi et al 2017 turner 1986 to date the entrainment processes resulting from the interaction with a submerged obstacle are far from being completely understood wilson et al 2017 2021 although of particular engineering relevance in the present work the dynamics of the gravity current interacting with a triangular cross section obstacle are discussed and the entrainment processes related to the increase of dense current area and the entrainment parameter are evaluated for the first time on one hand the presence of the obstacle causes an interruption of the evolution of the dense current which acts enhancing mixing by contrast a decrease of the overflow front velocity is observed downstream while part of the current is reflected in the upstream region by the obstacle inhibiting the formation of turbulent structures responsible for mixing at the interface the analysis conducted aims to establish how the relative ratio between the current height and the obstacle affects the velocity of the front and the instantaneous density fields moreover the percentage of the overflow depending on the aspect ratio is evaluated and compared with previous findings in the literature the paper is structured as follows details of the experimental apparatus and experimental measurements are given in section 2 results are discussed in section 3 with a general description of the flow in section 3 1 and a focus on the front propagation and on the front velocity in section 3 2 section 3 3 then presents the analysis of the non dimensional height and averaged density fields outlining the time evolution of the dense current for the varying parametric conditions the entrainment processes are discussed in section 3 4 through the analysis of the non dimensional area of the current the bulk entrainment parameter and the entrainment associated to the overflow downstream of the obstacle 2 experimental apparatus laboratory experiments on gravity currents were performed at the hydraulics laboratory of roma tre university using a perspex tank 3 0 m long 0 2 m wide and 0 3 m deep the ambient light source was provided by a panel of led lights with a diffusing screen covering the full length of the channel ensuring uniform back lighting the boussinesq gravity currents were produced by the lock release technique by dividing the tank in two different volumes with the removable gate placed at a distance x 0 0 4 m from the left wall full depth lock exchange experiments were realized by filling up to the same water depth h 0 h fig 1 the left and right volume of the tank the left side of the tank was filled with a saline mixture at density ρ 1 while the right side of it was filled with fresh tap water at a measured density ρ 0 where ρ 1 ρ 0 the electronic density meter anton paar dma 4100 m was used to perform initial density measurements and all the experiments were conducted with a constant reduced gravity g 0 0 1 m s 2 defined as g 0 g δ ρ ρ 0 with δ ρ ρ 1 ρ 0 a ccd camera with a frequency of 25 hz and space resolution of 1024 x 668 pixels was used to acquire experimental images the instantaneous density field ρ x y t was evaluated by a light attenuation technique as in la forgia et al 2018a 2020 the dimensionless density field ρ x y t is defined as 1 ρ x y t ρ x y t ρ 0 ρ 1 ρ 0 in order to apply the light attenuation technique and to visualize the dense fluid a controlled quantity of dye was added to the salty water in particular the concentration of dye in the gravity current is considered linearly correlated to the salt concentration a calibration technique is used to correlate the light intensity with the concentration of dye for each pixel of the acquired images to this aim nine controlled concentrations of dye were added and mixed to the fresh water in the tank in order to obtain a homogeneous dyed fluid and the calibration images were acquired to build the calibration curves the experiments performed without the obstacle served as benchmarks for the experiments with the triangular cross section obstacle the obstacle had a height d 0 105 m a length b 0 35 m with inclined approaches of angle α o 31 and was placed at a constant distance l 0 0 8 m from the gate the distance l 0 was chosen in order to guarantee the current to approach the obstacle once completely formed and during the slumping phase the x 0 used in the present experiments is selected in order to have a gravity current within the slumping phase for the whole length of the tank marino et al 2005 rottman and simpson 1983 with a lower x 0 the gravity current could approach the obstacle when the velocity is no longer constant and the transition to the self similar phase has already occurred in this case a different behaviour of the interaction is expected however in the cases under investigation the main goal is to study the dynamics of the interaction with the obstacle while the dense current is within the slumping phase i e with a constant front velocity a total of 12 experiments were performed 6 with the obstacle o series and 6 without the obstacle b series and the associated parameters are summarized in tab 1 the main parameter varied is the dimensionless obstacle height r 0 h c d where h c is the height of the dense current which is assumed to be half of the initial salt water depth h in the lock region benjamin 1968 the ratio r 0 ranged between 0 36 and 1 29 by varying the initial water depth h i e 0 27 m h 0 075 m the submergence depth d h and the aspect ratio λ h x 0 are also varied the reynolds number is defined as r e g 0 h h c ν with ν the kinematic viscosity and 3000 r e 22000 for the base experiments conducted the mass density of saline water is measured with an accuracy of 10 4 g c m 3 and the relative error is 0 01 the water depth h measured with an accuracy of 3 m m is characterized by a relative uncertainty of δ h h 4 the uncertainties of the velocity and the time scales are δ u u 2 and δ t t 1 6 and the uncertainty in the kinematic viscosity of the dense fluid is equal to 2 consequently the reynolds number r e has an uncertainty δ r e r e 8 3 results and discussion 3 1 general observations an insight into the qualitative description of the experiments is given in fig 2 displaying two series of snapshots of the experiment b1 λ 0 68 and r 0 0 base case without the obstacle fig 2a e and o1 λ 0 68 and r 0 1 29 with the bottom obstacle fig 2f j when the currents have travelled the distances x 1 1 5 2 2 5 and 3 m at different non dimensional times defined as 2 t t x 0 g 0 h in both cases at the sudden removal of the gate a gravity current develops as the dense fluid collapses under the lighter ambient fluid fig 2a and f in the base experiments fig 2a e the gravity current propagates along the bottom and develops the characteristic head followed by the tail fig 2b and c during its propagation the gravity current entrains ambient fluid which causes an increase of the overall volume of the current and a reduction of its density fig 2c and d till to reach the right wall of the tank fig 2e as h increases r e increases and larger instabilities i e kelvin helmoltz billows develop at the rear of the head these instabilities are responsible for entrainment of ambient fluid and the consequent mixing ottolenghi et al 2016a the interaction of the gravity current with the obstacle deeply affects the structure of the current when the gravity current impacts the obstacle a portion of the current is able to overflow the obstacle fig 2g i and continues to propagate to the right fig 2i until reaching the right wall of the tank fig 2j while the rest of the current is reflected back as an undular bore in agreement with the previous studies of lane serff et al 1995 and tokyay and constantinescu 2015 the quantity of overflow is dependent on h the greater is h the larger is the overflow as d h increases i e for gravity currents propagating over the obstacle with a low submergence depth the mass of salty current overflowing the obstacle decreases see tab 1 in agreement with the previous findings of lane serff et al 1995 and tokyay and constantinescu 2015 immediately downstream of the obstacle the gravity current develops a strong intensified mixing vortex imv close to the head see fig 2h i similar to the one observed from previous works on gravity currents interacting with square ribs and dunes tokyay et al 2011 this phenomena has been also studied for gravity currents propagating downslope and it has been observed to be caused by the kelvin helmholtz instability of a shear layer separating two fluids of different density being supplied from the rear by the outflow of the current over the obstacle hopfinger and tochon danguy 1977 britter and simpson 1978 dai 2013a this structure persists for a few seconds until it fades away the vortex dimension is dependent on the initial h in particular when h is small e g run o5 h 0 13 m and r 0 0 62 only a little amount of the density current is able to flow over the obstacle in this case the overflow continues as a gravity current and stops immediately downstream of the barrier while part of the gravity current continues to flow to the right of the tank entrains ambient fluid and decreases its density a portion characterized by larger density is reflected back by the obstacle and accumulates in the left part of the tank in fact the vortex traps a large amount of the ambient fluid which induces a significant decay of the concentration inside the head of the downstream current thus a more diluted current propagates downstream of the obstacle while part denser is retained upstream fig 3 displays at four different times the non dimensional density field for the run o2 h 0 20 m and r 0 0 95 where the imv fig 3b the diluted gravity current fig 3c and the denser portion of the current retained by the obstacle are observable fig 3d when the initial h is lower than the height of the obstacle d as in run o6 h 0 075 m and r 0 0 36 the whole current is reflected to the left of the tank once it reaches the obstacle the total overflow of the dense current above the obstacle is evaluated and compared with the previous experimental findings of greenspan and young 1978 of a dyke with 30 slope inclination and good agreement is found in the latter work different shape of a dyke are investigated to derive the spillage of dense current in particular in tab 1 the percentage of overflow m o for the experiments performed is reported the percentage of overflow has been derived considering the ratio between the mass of the dense current downstream of the obstacle obtained through the density fields at the end of each experiment to the initial mass of salty fluid in the lock in agreement with the previous findings of greenspan and young 1978 m o increases as h and r 0 increase the complete blockage of the dense current is obtained only when h d when h c d for the experiment o1 the gravity current shows a percentage of m o 31 of dense current which propagates downstream weakly influenced by the interaction with the obstacle as r 0 decreases and the depth across the obstacle is reduced the percentage m o decreases when h 0 2 the height of the current approaching the obstacle is approximately equal to height of the obstacle i e r 0 1 and the percentage of overflow is 17 a r 0 0 8 is needed to have a percentage of overflow lower than 10 3 2 front propagation and front velocity the front position x f is defined as the coordinate of the nose of the dense current along the streamwise direction and is analysed in order to invesigate the influence of r 0 on the front evolution the non dimensional front postion x f is defined as 3 x f x f x 0 x 0 fig 4 shows log log plots of x f versus t of the dense currents for all the experiments performed without the obstacle fig 4a and with the bottom obstacle fig 4b the trend lines referring to the different flow regimes which develop according to the shallow water theory are also shown i e the slumping phase with the slope 1 the self similar phase with the slope 2 3 and the viscous phase with the slope 1 5 rottman and simpson 1983 the slumping phase takes place until x f x 0 x 0 9 for the base experiments in fig 4a as expected only the slumping phase is developed for each λ considered and a constant velocity is observed for the whole propagation of the current fig 4b clearly shows the effect induced by the bottom obstacle in particular during the first phase of spreading the front of the current moves at a constant velocity and the slumping phase develops then when the current reaches the obstacle black horizontal dotted lines mark from the bottom to the top the toe the vertex and the far edge of the obstacle respectively a change in the flow dynamics occurs all the gravity currents slow down and the self similar and the viscous phases develop depending on the initial h and r 0 the lower is h the larger is the obstacle effect run o1 blue circles characterized by the largest h is not affected by the presence of the bottom obstacle and the gravity current flows with a nearly constant velocity as h decreases the gravity currents dynamics is affected by the presence of the obstacle which causes a reduction of the front velocity and the transition to the self similar phase in addition in run o5 h 0 13 m and r 0 0 62 green diamonds i e the overflow with the lower h also the viscous phase is observed to develop in this case the current stops just downstream of the obstacle and before reaching the end wall of the tank finally in run o6 h 0 075 m and r 0 2 8 ciano hexagrams h d and the current is completely reflected by the obstacle and no overflow occurs the front velocity u f is calculated as the ratio between the distance travelled by the current and the time the dimensionless front velocity u f is defined as 4 u f u f g 0 h in fig 5 u f is shown in log log plots for both the base experiments and the configurations with the obstacle versus x f the theoretical front velocity for the slumping the self similar and the viscous regimes are indicated by the solid dashed and dash dot red lines respectively as previously discussed the front of the gravity current of the base experiments develops the slumping phase only and the velocity of the front is approximately constant this is confirmed by fig 5a since for the base experiments u f 0 46 as obtained in previous works on lock exchange gravity currents barr 1967 marino et al 2005 rottman and simpson 1983 the u f of the experiments with the obstacle before reaching the obstacle toe marked by the dashed black line are consistent with the above discussion as shown in fig 5b an increase of u f is observed on the upsloping face of the obstacle and is produced by the overtake of the gravity current following the head which supplies the front downstream of the obstacle crest a reduction of u f is observed and it is proportional to the incoming gravity current conditions and h i e the lower is h the lower is u f downstream moreover the velocity on the downsloping face of the obstacle decreases due to the interfacial and bottom friction and it is also related to the formation of imv at the rear of the head as observed in previous studies dai 2013a 2013b negretti et al 2017 characterizing the deceleration phase of the gravity current finally downstream of the obstacle an increase of u f once reached the horizontal bottom is followed by the deceleration of the current proportional to h as previously discussed for run o3 and o4 the transition to the self similar phase is reached while for run o5 also the viscous phase is observed to develop the lower is the overflow the higher is the effect of the obstacle and the deceleration downstream of the obstacle 3 3 space time evolution of the current thickness and depth averaged density fields the current thickness is evaluated as the interface between the dense and the light fluids defined by the dimensionless density threshold of 2 the non dimensional thickness of the current h h x t h is displayed in fig 6 for three experiments without the obstacle left panels and with the bottom obstacle right panels where the dotted lines mark from the left the toe the vertex and the far edge of the obstacle the front of the current i e the line which marks the passage from the white to the colormap area present a linear variation in time and does not vary with h for the experiments without the obstacle fig 6a c as discussed above in fig 6a the experiment b1 with the highest h is shown and the kelvin helmholtz instabilities are visible in the form of height discontinuities along the current as h decreases fig 6b and c the instabilities developing at the interface have a size smaller than in experiment b1 fig 6a the h is highly affected by the obstacle if compared with the respective base experiments an increase of h is highlighted close to the toe of the obstacle by the darker shades of blue in fig 6d f which represents the portion of the current being reflected upstream by the obstacle focusing on the region on the left of the obstacle the increase of h travels back at the beginning of the tank i e x 1 2 as the bore develops the latter depends on h and the water depth available for the overflow above the obstacle the lower is h the higher is h corresponding to the bore in the region downstream of the obstacle in fig 6d f lower values of h are observed and correspond to the overflow of dense current above the vertex of the obstacle it is followed by an increase of h where the imv forms in fig 6d e the macro vortex fades after a distance 1 x and a gravity current develops again with kelvin helmholtz instabilities at the interface characterized by a lower h by contrast for the experiment o5 in fig 6f with a lower h the evolution of the imv ends and the overflow stops fig 7 displays the non dimensional depth averaged density fields ρ v x t which are defined as 5 ρ v x t ρ v x t ρ 0 ρ 1 ρ 0 where ρ v x t is the depth averaged density obtained by considering as upper boundary the iso density threshold ρ x y t 2 following the discussion of h in the base experiments i e fig 7a c ρ v x t is not particularly affected by the initial dense water depth h and in all experiments the head is the region where the high values of ρ v x t are observed in fig 7d f high values of ρ v x t corresponds to the bore developing upstream the obstacle in particular a dense part of the current is reflected close to the central dotted line i e the vertex of the obstacle and travels near the lock the portion of the current retained upstream the obstacle shows high values of density which means that low mixing and entrainment is associated to the travelling bore this again is related to h the lower is h the higher is ρ v x t by contrast downstream of the obstacle the overflow is characterized by low values of ρ v x t the lower is h the more diluted is the overflow downstream of the obstacle this behaviour can be explained as follows when r 0 decreases less overflow is observed and the imv at the rear of the head causes much dilution in the overflowing current with implications on the entrainment of ambient water in the following section the consequences of the interaction with the obstacle on the evolution of the density fields and the related entrainment process is discussed 3 4 entrainment parameter and non dimensional volumes of fluid the kelvin helmholtz instabilities developing at the interface between dense and light fluid cause ambient fluid to be entrained this process produces an increase of the volume of the dense current which can be used to investigate the process of entrainment within the dense current in particular we examine the mixing rates by considering several concentration rates for the definition of the mixed fluid following the works of jacobson and testik 2013 and ottolenghi et al 2016a the non dimensional dense current area a per unit width can be defined as 6 a a i a 0 where a i is the bulk area in the x y plane of the dense current under the iso density level ρ 2 at the time t i and a 0 is the initial area of the lock dense fluid in fig 8 a is displayed versus the non dimensional front position x f for both the base experiments fig 8a and the obstacle runs fig 8b in fig 8a an increase of the volume of the current is observed in time as the front advances in accordance with previous studies jacobson and testik 2013 ottolenghi et al 2016a all the base experiments show a linear increase of a related to the development of the slumping phase only in fig 8b the evolution of a versus x f exhibits a different behaviour due to the interaction with the obstacle in fact a increases linearly up to the vertex of the obstacle marked by the middle black dotted line as for the base experiment in fig 8a after the overflow of the current above the obstacle a linear increase of a is also observed but with a lower rate suggesting that the ambient water is entrained more slowly the experiment o1 is the less influenced by the interaction with the obstacle and it is characterized by a linear increase of a up to the end of the tank the more affected run is the experiment o5 since a reaches a constant value indicating that the ambient fluid is no longer entrained in the dense current the non dimensional dense current area downstream of the obstacle a d is additionally evaluated to investigate the entrainment related to the overflow a schematic representation of the bulk dense current a i and the downstream dense current a d is shown in fig 9 a d a d a 0 is displayed in fig 10 a versus x f in particular for all the experiments conducted a d increases up to x f 3 8 as the overflow propagates first downslope and then downstream of the obstacle and the entrainment of ambient water occurs as previously observed in fig 8b in particular the overflow in run o1 presents an increase of a d which can be described by a linear law with slope 0 4 in runs o2 o3 o4 the same rate of increase of a d up to x f 4 5 is found while for a larger distance the rate of increase of a d is appreciably lower with slope decreasing to 0 3 0 2 in run o5 a plateau of slow growth is reached at x f 3 8 and the contribution to increase the non dimensional area goes to zero this is further confirmed by fig 10b considering the entrainment flowrate q e d of ambient fluid crossing the interface of the dense current downstream of the obstacle as previously discussed it is expected that the imv provides the major contribution to entrainment of ambient water in the dense current in order to identify the role of the imv on the entrainment process the increase of the current area downstream of the obstacle has been analysed and compared to the inlet area of dense current overflowing the crest of the obstacle a o i defined as 7 a o i h o b u o b d t where h o b is the current head over the crest of the obstacle u o b is the velocity of the overflow which is assumed to be close to the averaged front velocity on the crest and d t is the time interval of data acquisition for comparison purposes the inlet area a o i has been additionally evaluated by considering the instantaneous density fields to determine the dense overflow needed to dilute the ambient fluid volume downstream and good agreement is found given the inlet area a o i it is possible to evaluate the contribution of the entrainment of ambient fluid to the increase of the area downstream of the obstacle q e d is then defined as 8 q e d a d a o i w c h t i t 0 with w c h the width of the channel in fig 10b the entrainment flowrate q e d is observed to be strongly dependent on the parameter r 0 and to the formation of the imv whose dimensions are strictly related to the dense current overflowing the obstacle a larger increase occurs for run o1 related to the largest vortex forming downstream the obstacle see fig 2b in runs o2 o3 and o4 comparable values of q e d are found up to x f 4 which corresponds to the distance at which the imv detaches from the head of the current as observed in fig 6e finally in the experiment o5 after the formation of the imv on the downslope side of the obstacle causing a local increase of q e d the current decelerates and the entrainemnt decreases with q e d 0 when the current comes to a stop at x f 5 additionally the entrainment flowrate downstream of the obstacle and the total entrainment flowrate defined by the total increase of the volume of dense current in time can be used to derive the total bulk entrainment within the dense current in particular the bulk and the downstream entrainment parameters e and e d induced by the supply of ambient water due to kelvinhelmholtz instabilities in the shear layer of the dense current can be derived as 9 e w e α u b 10 e d w e d α u b where w e and w e d are the bulk and the downstream entrainment velocities respectively and α u b is a velocity scale representing the difference between the bulk velocity of the dense current and the bulk velocity of the ambient fluid flowing in the opposite direction the coefficient α here adopted takes into account the relative depths of dense and ambient fluids following the assumption of barr 1967 for a gravity current propagating over an horizontal bottom α 2 for the bulk entrainment e while for the downstream entrainment e d α 1 65 for the experiments o 1 4 and α 1 28 for o 5 these values of α are evaluated by using measured water depths and the no net flow condition as in lane serff et al 1995 the entrainment velocity is defined as the discharge of entrained ambient fluid crossing the interface between the dense current and the ambient fluid per unit area thus w e and w e d are evaluated as 11 w e q e s x 12 w e d q e d s x d where s x and s x d are defined as the total and downstream area along which the entrainment takes place i e the area of the interface of the dense current and the bulk entrainment flow q e is then defined as 13 q ei a i a 0 w c h t i t 0 in fig 11 the bulk e is displayed versus x f in agreement with previous studies adduce et al 2012 ottolenghi et al 2016b e decreases as the gravity current propagates and x f increases reaching a value of approximately e 10 2 moreover the entrainment depends on the initial total depth h and as r 0 decreases i e h c decreases e decreases to better understand the effect of the bottom obstacle e and e d evaluated at x f 4 are displayed respectively in fig 12 a d as a function of the local reynolds r e and froude f r numbers defined as 14 r e b u f h m a x ν r e d u f d h m a x ν 15 f r b u f g b h m a x f r d u f d g d h m a x where r e b and f r b refers to bulk quantities and r e d and f r d to the overflowing current downslope evaluated at x f 4 specifically u f d is the overflow velocity calculated as the distance d x f x v in the time interval taken to travel the distance d g b and g d are the reduced gravity obtained by the averaged densities ρ b of the total dense current and ρ d of the overflow only respectively in fig 12a e increases as r e increases in agreement with previous works ottolenghi et al 2016b cenedese and adduce 2008 in particular r e b decreases with h ranging between r e b 1000 when h 0 13 and r e b 11000 when h 0 27 moreover except for run o1 the interaction with the obstacle causes a reduction of the volume of the dense current driving the motion which produces a reduction of the front velocity and consequently r e b therefore a decrease of e is accordingly observed for the o1 5 runs compared to the b1 5 runs the dependence of the bulk e on f r b is additionally shown in fig 12b and in agreement with previous findings cenedese and adduce 2008 e increases as f r b increases ranging between f r b 0 95 for h 0 13 m and f r b 1 1 for h 0 27 m what emerges is that despite the formation of a macro vortex which entrains ambient water when the gravity current overflows the obstacle for r 0 0 71 the total bulk e is not significantly affected compared to the base experiments this can be explained by considering that the entrainment due to the macro vortex at the back of the head while the current propagates downslope is counteracted by the portion of the dense current reflected upstream the obstacle which is less diluted causing the bulk entrainment to remain constant moreover the reduction of r e b contributes to decrease the bulk entrainment by contrast a large influence of the obstacle is found for run o5 for which a reduction of the r e b 4000 to 1000 determines a significant decrease of e the obstacle marks a discontinuity in the dense current propagation thus it is important to investigate the entrainment processes associated to the overflow only to this aim the dependence of the entrainment parameter evaluated for the overflow downstream of the obstacle e d on r e d and on f r d is also verified and shown in fig 12c and d for the series o1 5 following the above discussion e d related to the overflow only is shown to increase as the r e d increases and it is slightly larger than the total bulk e suggesting the role of the imv as source of entrainment of ambient water within the current more specifically for r 0 0 81 the f r d related to the overflow downstream is larger than the bulk f r b since the g d is much reduced and the head of the dense current diluted these results suggest that for r 0 0 81 the interaction with the obstacle is able to cause the transition to a supercritical current characterized by large densimetric f r and diluted gravity currents associated with the imv development finally fig12 c d highlight that the relevant non dimensional number controlling the entrainment process is r e d 4 conclusions in the present work an experimental study on lock release gravity currents interacting with a bottom triangular obstacle is presented detailed density measurements enabled to deepen the dynamics of the dense current interaction with the obstacle depending on the relative obstacle height r 0 which has been shown to be the main parameter governing the overflowing current indeed the current dynamics is deeply affected by the obstacle depending on r 0 only part of the current overflows the obstacle and propagates downstream while part is reflected in the upstream region of the tank the overflow develops a circular macro vortex whose dimensions are dependent on the volume of dense current overflowing the obstacle i e the higher is r 0 and the larger is the vortex the overflow of dense current above the obstacle has been studied as a function of r 0 and the linear decrease of percentage of overflow with decreasing r 0 is found in agreement with previous findings the density field evaluation enabled to describe more thoroughly the evolution of the overflow in particular the height of the current defined as the 2 dimensionless density threshold has been analysed and shows that the dimensionless height of the vortex downstream the obstacle increases with r 0 moreover in the upstream region the portion of the current reflected propagates as a bore whose position is determined by the increase of the dimensionless height these informations can be coupled with the time and space evolution of the depth averaged density fields in fact as the the macro vortex develops a consequent more diluted overflow downstream of the obstacle is found by contrast in the upstream region the higher values of density are found suggesting that the portion of the current retained by the obstacle is less diluted and does not entrain ambient water the dynamics of the overflow has been deepened by analysing the time evolution of the front position in particular the effect of the obstacle on the front of the gravity current is to induce an early transition to the self similar flow regime ad in some cases also to the viscous flow regime this implies a decrease of the velocity of the front downstream of the obstacle which for r 0 0 62 lead the current to stop before reaching the end wall of the tank an increase of the velocity is indeed observed as the current climb up the upstream slope of the obstacle due to the overtaking dense flow following the head while a consequent decrease is observed when the macro vortex develops finally to fully understand the entrainment processes related to the interaction with the obstacle the evolution of the non dimensional area is presented for both the series of experiments with and without the obstacle for the base experiments on the rigid bottom the area increases linearly indicating that during the slumping phase the entrainment of ambient water occurs at constant rate according to literature when the current interact with the obstacle depending on r 0 a stops the increase and reaches a maximum value where no more ambient fluid is entrained in the dense current an insight into the downsloping overflow non dimensional area and entrainment flowrate indicates indeed that as r 0 decreases the rate of entrainment decreases evolving towards a plateau for run o5 i e r 0 0 62 for which q e d 0 since the overflow is completely diluted finally results of the bulk entrainment parameter suggest that the entrainment strongly depends on the initial dense water depth h i e the higher is h the higher is the entrainment associated to the dense current and confirm the role of relevant non dimensional numbers i e r e and f r despite the formation of the imv which entrains ambient water the bulk entrainment of the current does not increase for each r 0 investigated indicating that a balance is induced by the portion of the current reflected in the upstream region and the reduction of r e of the overflowing current in conclusion when r 0 1 the current overflowing is weakly influenced by the obstacle and the developing gravity current downstream continues to increase its volume and to entrain ambient water a complete blockage of the current is only reached when the total water depth is lower that the height of the obstacle nevertheless when r 0 0 62 the overflow of dense current is much reduced and the percentage of overflow m 0 1 is highly diluted and stops downstream the obstacle author statement we hereby declare and confirm that all the authors have substantially contributed to the work and have read and approved the submitted manuscript declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgements this research was funded by the italian ministry of education university and research miur through the departments of excellence 2018 2022 program 
278,laboratory experiments investigating the interaction of a lock exchange dense gravity current and a submerged obstacle with a triangular section have been conducted to determine the influence of the relative obstacle height i e the ratio between the heights of the current and the obstacle on the dynamics of the overflowing dense current experimental measurements were aimed to obtain detailed instantaneous density fields through an image analysis technique based on light attenuation the dense current is deeply affected by the interaction depending on the relative obstacle height when the height of the current approaching the obstacle is small a lower percentage of overflow propagates downstream and a large reduction in the gravity current velocity is observed the analysis of the density fields highlights that the formation of a macro vortex downstream of the obstacle is the mechanism responsible for the enhanced dilution of the overflow nevertheless the bulk entrainment parameter is slightly affected by the presence of a bottom obstacle results deepen our understanding of the entrainment processes related to the interaction with the obstacle and confirm the role of relevant non dimensional numbers keywords gravity currents experiments obstacle entrainment 1 introduction gravity currents generated by a density difference between two fluids are density driven flows developing predominantly in the horizontal direction the density difference can be due to temperature and salinity gradients or sediment concentration when the density difference is due to the presence of particles in suspension these flows are known as turbidity currents which are multiscale flows since their propagation is closely tied to the small scale mechanisms of erosion and re suspension of particles moreover at larger sediments concentrations the rheology of the fluid can be modified by a non newtonian behavior with significant consequences for the dynamics of the flow meiburg et al 2015 for large density differences non boussinesq gravity currents develop and a rising of the free surface close to the front position can be observed in the experiments sciortino et al 2018 longo et al 2018 for an accurate model prediction of non boussineq gravity currents free surface effects cannot be neglected gravity currents can occur spontaneously in nature for example as dense oceanic currents avalanches or sand storms hopfinger 1983 simpson 1997 but can also be the outcome of anthropic activities such as the accidental oil spills to marine areas or released pollutant mass dispersing in rivers with a significant impact on marine and fluvial ecosystems the spreading of gravity currents is affected by the ambient fluid which can be either homogeneous or density stratified in the latter condition internal waves are generated zemach et al 2017 ottolenghi et al 2020 in the ocean internal waves and internal solitary waves are mainly generated by the tide oscillation over rough features at the bottom such as ridges seamounts and canyons sarkar and scotti 2017 helfrich and melville 2006 previous studies showed that the interaction between internal solitary waves and the continental or near shore slope may cause their shoaling and breaking sutherland et al 2013 droghei et al 2016 cavaliere et al 2021 inducing mixing la forgia et al 2018b 2021 and bed material motion sutherland et al 2013 la forgia et al 2019 2020 the dynamics of gravity currents propagating in a stratified ambient fluid i e in presence of internal waves has been widely investigated by both laboratory experiments and theoretical models maxworthy et al 2002 ungarish and huppert 2002 longo et al 2016 zemach et al 2017 chiapponi et al 2018 also in the case of particulate gravity currents propagating in channels with a non rectangular cross section the propagation of dense bottom gravity currents is strongly controlled by topographic features cuthbertson et al 2014 2018 de falco et al 2021a inghilesi et al 2018 la rocca et al 2013 these currents develop generally over complex boundaries kyrousi et al 2018 venuleo et al 2019 zordan et al 2018a 2018b and the interaction with specific geometric configurations can deeply affect the dynamics of these flows and modify the final proprieties of the outflowing current a topographic discontinuity such as an obstacle on a horizontal bottom can deeply modify the structure of the bottom dense current can regulate the overflow and finally can cause the partial or complete confinement of it an example of gravity current interacting with a submerged obstacle is given by the study of dam reservoir where the concentration of sediments is often high and the development of turbidity currents due to underwater landslip is frequent the dense and highly concentrated current develops at the bottom of the reservoir travels downstream and possibly can reach the intake structures of the dam compromising its functionality de cesare et al 2001 thus the design of an appropriate structure as an obstacle able to stop or dissipate the dense current is essential for the proper functioning of the dam system moreover turbidity currents can represent a geohazard to seafloor structures and offshore pipelines and an accurate comprehension of the implications of the interaction can help to improve the engineering models and design depending on the parametric conditions characterizing these flows bruschi et al 2006 in the past few studies on gravity currents involving the interaction with a submerged obstacle or an array of elements have been developed bell 1942 developed an experimental study in channels emphasizing the importance of turbidity currents in sedimentation of reservoirs in their experiments the interaction of a turbidity current with a submerged barrier is investigated shallow water analysis was developed to describe the main features of the flow and the spillage of dense current greenspan and young 1978 lane serff et al 1995 rottman et al 1985 moreover numerical simulations were employed to investigate the structure and evolution of bottom propagating turbidity and gravity currents over one or a series of obstacles oehy and schleiss 2007 tokyay et al 2011 2014 obstacles with a triangular cross section are a good approximation to represent submerged barriers de cesare et al 2001 oehy and schleiss 2007 tokyay and constantinescu 2015 in this case many features of a gravity current interacting with a submerged triangular obstacle resemble the interaction with both up and downslopes in fact if the length of the obstacle is sufficiently large the gravity current propagating on the obstacle decelerates and can possibly stop before reaching the upper edge of the obstacle de falco et al 2020 2021b likewise the spillage of dense current overflowing the obstacle can be studied similarly to a downslope current in this case the front of the current is firstly characterized by an acceleration and then by a deceleration phase along the slope with the formation of a vortex at the rear of the head dai 2013a 2014 2015 steenhauer et al 2017 in this regard while many recent studies focused on the entrainment of fresh ambient water within a dense current propagating on a horizontal or inclined bottom cenedese and adduce 2008 2010 laanearu et al 2014 ottolenghi et al 2017 turner 1986 to date the entrainment processes resulting from the interaction with a submerged obstacle are far from being completely understood wilson et al 2017 2021 although of particular engineering relevance in the present work the dynamics of the gravity current interacting with a triangular cross section obstacle are discussed and the entrainment processes related to the increase of dense current area and the entrainment parameter are evaluated for the first time on one hand the presence of the obstacle causes an interruption of the evolution of the dense current which acts enhancing mixing by contrast a decrease of the overflow front velocity is observed downstream while part of the current is reflected in the upstream region by the obstacle inhibiting the formation of turbulent structures responsible for mixing at the interface the analysis conducted aims to establish how the relative ratio between the current height and the obstacle affects the velocity of the front and the instantaneous density fields moreover the percentage of the overflow depending on the aspect ratio is evaluated and compared with previous findings in the literature the paper is structured as follows details of the experimental apparatus and experimental measurements are given in section 2 results are discussed in section 3 with a general description of the flow in section 3 1 and a focus on the front propagation and on the front velocity in section 3 2 section 3 3 then presents the analysis of the non dimensional height and averaged density fields outlining the time evolution of the dense current for the varying parametric conditions the entrainment processes are discussed in section 3 4 through the analysis of the non dimensional area of the current the bulk entrainment parameter and the entrainment associated to the overflow downstream of the obstacle 2 experimental apparatus laboratory experiments on gravity currents were performed at the hydraulics laboratory of roma tre university using a perspex tank 3 0 m long 0 2 m wide and 0 3 m deep the ambient light source was provided by a panel of led lights with a diffusing screen covering the full length of the channel ensuring uniform back lighting the boussinesq gravity currents were produced by the lock release technique by dividing the tank in two different volumes with the removable gate placed at a distance x 0 0 4 m from the left wall full depth lock exchange experiments were realized by filling up to the same water depth h 0 h fig 1 the left and right volume of the tank the left side of the tank was filled with a saline mixture at density ρ 1 while the right side of it was filled with fresh tap water at a measured density ρ 0 where ρ 1 ρ 0 the electronic density meter anton paar dma 4100 m was used to perform initial density measurements and all the experiments were conducted with a constant reduced gravity g 0 0 1 m s 2 defined as g 0 g δ ρ ρ 0 with δ ρ ρ 1 ρ 0 a ccd camera with a frequency of 25 hz and space resolution of 1024 x 668 pixels was used to acquire experimental images the instantaneous density field ρ x y t was evaluated by a light attenuation technique as in la forgia et al 2018a 2020 the dimensionless density field ρ x y t is defined as 1 ρ x y t ρ x y t ρ 0 ρ 1 ρ 0 in order to apply the light attenuation technique and to visualize the dense fluid a controlled quantity of dye was added to the salty water in particular the concentration of dye in the gravity current is considered linearly correlated to the salt concentration a calibration technique is used to correlate the light intensity with the concentration of dye for each pixel of the acquired images to this aim nine controlled concentrations of dye were added and mixed to the fresh water in the tank in order to obtain a homogeneous dyed fluid and the calibration images were acquired to build the calibration curves the experiments performed without the obstacle served as benchmarks for the experiments with the triangular cross section obstacle the obstacle had a height d 0 105 m a length b 0 35 m with inclined approaches of angle α o 31 and was placed at a constant distance l 0 0 8 m from the gate the distance l 0 was chosen in order to guarantee the current to approach the obstacle once completely formed and during the slumping phase the x 0 used in the present experiments is selected in order to have a gravity current within the slumping phase for the whole length of the tank marino et al 2005 rottman and simpson 1983 with a lower x 0 the gravity current could approach the obstacle when the velocity is no longer constant and the transition to the self similar phase has already occurred in this case a different behaviour of the interaction is expected however in the cases under investigation the main goal is to study the dynamics of the interaction with the obstacle while the dense current is within the slumping phase i e with a constant front velocity a total of 12 experiments were performed 6 with the obstacle o series and 6 without the obstacle b series and the associated parameters are summarized in tab 1 the main parameter varied is the dimensionless obstacle height r 0 h c d where h c is the height of the dense current which is assumed to be half of the initial salt water depth h in the lock region benjamin 1968 the ratio r 0 ranged between 0 36 and 1 29 by varying the initial water depth h i e 0 27 m h 0 075 m the submergence depth d h and the aspect ratio λ h x 0 are also varied the reynolds number is defined as r e g 0 h h c ν with ν the kinematic viscosity and 3000 r e 22000 for the base experiments conducted the mass density of saline water is measured with an accuracy of 10 4 g c m 3 and the relative error is 0 01 the water depth h measured with an accuracy of 3 m m is characterized by a relative uncertainty of δ h h 4 the uncertainties of the velocity and the time scales are δ u u 2 and δ t t 1 6 and the uncertainty in the kinematic viscosity of the dense fluid is equal to 2 consequently the reynolds number r e has an uncertainty δ r e r e 8 3 results and discussion 3 1 general observations an insight into the qualitative description of the experiments is given in fig 2 displaying two series of snapshots of the experiment b1 λ 0 68 and r 0 0 base case without the obstacle fig 2a e and o1 λ 0 68 and r 0 1 29 with the bottom obstacle fig 2f j when the currents have travelled the distances x 1 1 5 2 2 5 and 3 m at different non dimensional times defined as 2 t t x 0 g 0 h in both cases at the sudden removal of the gate a gravity current develops as the dense fluid collapses under the lighter ambient fluid fig 2a and f in the base experiments fig 2a e the gravity current propagates along the bottom and develops the characteristic head followed by the tail fig 2b and c during its propagation the gravity current entrains ambient fluid which causes an increase of the overall volume of the current and a reduction of its density fig 2c and d till to reach the right wall of the tank fig 2e as h increases r e increases and larger instabilities i e kelvin helmoltz billows develop at the rear of the head these instabilities are responsible for entrainment of ambient fluid and the consequent mixing ottolenghi et al 2016a the interaction of the gravity current with the obstacle deeply affects the structure of the current when the gravity current impacts the obstacle a portion of the current is able to overflow the obstacle fig 2g i and continues to propagate to the right fig 2i until reaching the right wall of the tank fig 2j while the rest of the current is reflected back as an undular bore in agreement with the previous studies of lane serff et al 1995 and tokyay and constantinescu 2015 the quantity of overflow is dependent on h the greater is h the larger is the overflow as d h increases i e for gravity currents propagating over the obstacle with a low submergence depth the mass of salty current overflowing the obstacle decreases see tab 1 in agreement with the previous findings of lane serff et al 1995 and tokyay and constantinescu 2015 immediately downstream of the obstacle the gravity current develops a strong intensified mixing vortex imv close to the head see fig 2h i similar to the one observed from previous works on gravity currents interacting with square ribs and dunes tokyay et al 2011 this phenomena has been also studied for gravity currents propagating downslope and it has been observed to be caused by the kelvin helmholtz instability of a shear layer separating two fluids of different density being supplied from the rear by the outflow of the current over the obstacle hopfinger and tochon danguy 1977 britter and simpson 1978 dai 2013a this structure persists for a few seconds until it fades away the vortex dimension is dependent on the initial h in particular when h is small e g run o5 h 0 13 m and r 0 0 62 only a little amount of the density current is able to flow over the obstacle in this case the overflow continues as a gravity current and stops immediately downstream of the barrier while part of the gravity current continues to flow to the right of the tank entrains ambient fluid and decreases its density a portion characterized by larger density is reflected back by the obstacle and accumulates in the left part of the tank in fact the vortex traps a large amount of the ambient fluid which induces a significant decay of the concentration inside the head of the downstream current thus a more diluted current propagates downstream of the obstacle while part denser is retained upstream fig 3 displays at four different times the non dimensional density field for the run o2 h 0 20 m and r 0 0 95 where the imv fig 3b the diluted gravity current fig 3c and the denser portion of the current retained by the obstacle are observable fig 3d when the initial h is lower than the height of the obstacle d as in run o6 h 0 075 m and r 0 0 36 the whole current is reflected to the left of the tank once it reaches the obstacle the total overflow of the dense current above the obstacle is evaluated and compared with the previous experimental findings of greenspan and young 1978 of a dyke with 30 slope inclination and good agreement is found in the latter work different shape of a dyke are investigated to derive the spillage of dense current in particular in tab 1 the percentage of overflow m o for the experiments performed is reported the percentage of overflow has been derived considering the ratio between the mass of the dense current downstream of the obstacle obtained through the density fields at the end of each experiment to the initial mass of salty fluid in the lock in agreement with the previous findings of greenspan and young 1978 m o increases as h and r 0 increase the complete blockage of the dense current is obtained only when h d when h c d for the experiment o1 the gravity current shows a percentage of m o 31 of dense current which propagates downstream weakly influenced by the interaction with the obstacle as r 0 decreases and the depth across the obstacle is reduced the percentage m o decreases when h 0 2 the height of the current approaching the obstacle is approximately equal to height of the obstacle i e r 0 1 and the percentage of overflow is 17 a r 0 0 8 is needed to have a percentage of overflow lower than 10 3 2 front propagation and front velocity the front position x f is defined as the coordinate of the nose of the dense current along the streamwise direction and is analysed in order to invesigate the influence of r 0 on the front evolution the non dimensional front postion x f is defined as 3 x f x f x 0 x 0 fig 4 shows log log plots of x f versus t of the dense currents for all the experiments performed without the obstacle fig 4a and with the bottom obstacle fig 4b the trend lines referring to the different flow regimes which develop according to the shallow water theory are also shown i e the slumping phase with the slope 1 the self similar phase with the slope 2 3 and the viscous phase with the slope 1 5 rottman and simpson 1983 the slumping phase takes place until x f x 0 x 0 9 for the base experiments in fig 4a as expected only the slumping phase is developed for each λ considered and a constant velocity is observed for the whole propagation of the current fig 4b clearly shows the effect induced by the bottom obstacle in particular during the first phase of spreading the front of the current moves at a constant velocity and the slumping phase develops then when the current reaches the obstacle black horizontal dotted lines mark from the bottom to the top the toe the vertex and the far edge of the obstacle respectively a change in the flow dynamics occurs all the gravity currents slow down and the self similar and the viscous phases develop depending on the initial h and r 0 the lower is h the larger is the obstacle effect run o1 blue circles characterized by the largest h is not affected by the presence of the bottom obstacle and the gravity current flows with a nearly constant velocity as h decreases the gravity currents dynamics is affected by the presence of the obstacle which causes a reduction of the front velocity and the transition to the self similar phase in addition in run o5 h 0 13 m and r 0 0 62 green diamonds i e the overflow with the lower h also the viscous phase is observed to develop in this case the current stops just downstream of the obstacle and before reaching the end wall of the tank finally in run o6 h 0 075 m and r 0 2 8 ciano hexagrams h d and the current is completely reflected by the obstacle and no overflow occurs the front velocity u f is calculated as the ratio between the distance travelled by the current and the time the dimensionless front velocity u f is defined as 4 u f u f g 0 h in fig 5 u f is shown in log log plots for both the base experiments and the configurations with the obstacle versus x f the theoretical front velocity for the slumping the self similar and the viscous regimes are indicated by the solid dashed and dash dot red lines respectively as previously discussed the front of the gravity current of the base experiments develops the slumping phase only and the velocity of the front is approximately constant this is confirmed by fig 5a since for the base experiments u f 0 46 as obtained in previous works on lock exchange gravity currents barr 1967 marino et al 2005 rottman and simpson 1983 the u f of the experiments with the obstacle before reaching the obstacle toe marked by the dashed black line are consistent with the above discussion as shown in fig 5b an increase of u f is observed on the upsloping face of the obstacle and is produced by the overtake of the gravity current following the head which supplies the front downstream of the obstacle crest a reduction of u f is observed and it is proportional to the incoming gravity current conditions and h i e the lower is h the lower is u f downstream moreover the velocity on the downsloping face of the obstacle decreases due to the interfacial and bottom friction and it is also related to the formation of imv at the rear of the head as observed in previous studies dai 2013a 2013b negretti et al 2017 characterizing the deceleration phase of the gravity current finally downstream of the obstacle an increase of u f once reached the horizontal bottom is followed by the deceleration of the current proportional to h as previously discussed for run o3 and o4 the transition to the self similar phase is reached while for run o5 also the viscous phase is observed to develop the lower is the overflow the higher is the effect of the obstacle and the deceleration downstream of the obstacle 3 3 space time evolution of the current thickness and depth averaged density fields the current thickness is evaluated as the interface between the dense and the light fluids defined by the dimensionless density threshold of 2 the non dimensional thickness of the current h h x t h is displayed in fig 6 for three experiments without the obstacle left panels and with the bottom obstacle right panels where the dotted lines mark from the left the toe the vertex and the far edge of the obstacle the front of the current i e the line which marks the passage from the white to the colormap area present a linear variation in time and does not vary with h for the experiments without the obstacle fig 6a c as discussed above in fig 6a the experiment b1 with the highest h is shown and the kelvin helmholtz instabilities are visible in the form of height discontinuities along the current as h decreases fig 6b and c the instabilities developing at the interface have a size smaller than in experiment b1 fig 6a the h is highly affected by the obstacle if compared with the respective base experiments an increase of h is highlighted close to the toe of the obstacle by the darker shades of blue in fig 6d f which represents the portion of the current being reflected upstream by the obstacle focusing on the region on the left of the obstacle the increase of h travels back at the beginning of the tank i e x 1 2 as the bore develops the latter depends on h and the water depth available for the overflow above the obstacle the lower is h the higher is h corresponding to the bore in the region downstream of the obstacle in fig 6d f lower values of h are observed and correspond to the overflow of dense current above the vertex of the obstacle it is followed by an increase of h where the imv forms in fig 6d e the macro vortex fades after a distance 1 x and a gravity current develops again with kelvin helmholtz instabilities at the interface characterized by a lower h by contrast for the experiment o5 in fig 6f with a lower h the evolution of the imv ends and the overflow stops fig 7 displays the non dimensional depth averaged density fields ρ v x t which are defined as 5 ρ v x t ρ v x t ρ 0 ρ 1 ρ 0 where ρ v x t is the depth averaged density obtained by considering as upper boundary the iso density threshold ρ x y t 2 following the discussion of h in the base experiments i e fig 7a c ρ v x t is not particularly affected by the initial dense water depth h and in all experiments the head is the region where the high values of ρ v x t are observed in fig 7d f high values of ρ v x t corresponds to the bore developing upstream the obstacle in particular a dense part of the current is reflected close to the central dotted line i e the vertex of the obstacle and travels near the lock the portion of the current retained upstream the obstacle shows high values of density which means that low mixing and entrainment is associated to the travelling bore this again is related to h the lower is h the higher is ρ v x t by contrast downstream of the obstacle the overflow is characterized by low values of ρ v x t the lower is h the more diluted is the overflow downstream of the obstacle this behaviour can be explained as follows when r 0 decreases less overflow is observed and the imv at the rear of the head causes much dilution in the overflowing current with implications on the entrainment of ambient water in the following section the consequences of the interaction with the obstacle on the evolution of the density fields and the related entrainment process is discussed 3 4 entrainment parameter and non dimensional volumes of fluid the kelvin helmholtz instabilities developing at the interface between dense and light fluid cause ambient fluid to be entrained this process produces an increase of the volume of the dense current which can be used to investigate the process of entrainment within the dense current in particular we examine the mixing rates by considering several concentration rates for the definition of the mixed fluid following the works of jacobson and testik 2013 and ottolenghi et al 2016a the non dimensional dense current area a per unit width can be defined as 6 a a i a 0 where a i is the bulk area in the x y plane of the dense current under the iso density level ρ 2 at the time t i and a 0 is the initial area of the lock dense fluid in fig 8 a is displayed versus the non dimensional front position x f for both the base experiments fig 8a and the obstacle runs fig 8b in fig 8a an increase of the volume of the current is observed in time as the front advances in accordance with previous studies jacobson and testik 2013 ottolenghi et al 2016a all the base experiments show a linear increase of a related to the development of the slumping phase only in fig 8b the evolution of a versus x f exhibits a different behaviour due to the interaction with the obstacle in fact a increases linearly up to the vertex of the obstacle marked by the middle black dotted line as for the base experiment in fig 8a after the overflow of the current above the obstacle a linear increase of a is also observed but with a lower rate suggesting that the ambient water is entrained more slowly the experiment o1 is the less influenced by the interaction with the obstacle and it is characterized by a linear increase of a up to the end of the tank the more affected run is the experiment o5 since a reaches a constant value indicating that the ambient fluid is no longer entrained in the dense current the non dimensional dense current area downstream of the obstacle a d is additionally evaluated to investigate the entrainment related to the overflow a schematic representation of the bulk dense current a i and the downstream dense current a d is shown in fig 9 a d a d a 0 is displayed in fig 10 a versus x f in particular for all the experiments conducted a d increases up to x f 3 8 as the overflow propagates first downslope and then downstream of the obstacle and the entrainment of ambient water occurs as previously observed in fig 8b in particular the overflow in run o1 presents an increase of a d which can be described by a linear law with slope 0 4 in runs o2 o3 o4 the same rate of increase of a d up to x f 4 5 is found while for a larger distance the rate of increase of a d is appreciably lower with slope decreasing to 0 3 0 2 in run o5 a plateau of slow growth is reached at x f 3 8 and the contribution to increase the non dimensional area goes to zero this is further confirmed by fig 10b considering the entrainment flowrate q e d of ambient fluid crossing the interface of the dense current downstream of the obstacle as previously discussed it is expected that the imv provides the major contribution to entrainment of ambient water in the dense current in order to identify the role of the imv on the entrainment process the increase of the current area downstream of the obstacle has been analysed and compared to the inlet area of dense current overflowing the crest of the obstacle a o i defined as 7 a o i h o b u o b d t where h o b is the current head over the crest of the obstacle u o b is the velocity of the overflow which is assumed to be close to the averaged front velocity on the crest and d t is the time interval of data acquisition for comparison purposes the inlet area a o i has been additionally evaluated by considering the instantaneous density fields to determine the dense overflow needed to dilute the ambient fluid volume downstream and good agreement is found given the inlet area a o i it is possible to evaluate the contribution of the entrainment of ambient fluid to the increase of the area downstream of the obstacle q e d is then defined as 8 q e d a d a o i w c h t i t 0 with w c h the width of the channel in fig 10b the entrainment flowrate q e d is observed to be strongly dependent on the parameter r 0 and to the formation of the imv whose dimensions are strictly related to the dense current overflowing the obstacle a larger increase occurs for run o1 related to the largest vortex forming downstream the obstacle see fig 2b in runs o2 o3 and o4 comparable values of q e d are found up to x f 4 which corresponds to the distance at which the imv detaches from the head of the current as observed in fig 6e finally in the experiment o5 after the formation of the imv on the downslope side of the obstacle causing a local increase of q e d the current decelerates and the entrainemnt decreases with q e d 0 when the current comes to a stop at x f 5 additionally the entrainment flowrate downstream of the obstacle and the total entrainment flowrate defined by the total increase of the volume of dense current in time can be used to derive the total bulk entrainment within the dense current in particular the bulk and the downstream entrainment parameters e and e d induced by the supply of ambient water due to kelvinhelmholtz instabilities in the shear layer of the dense current can be derived as 9 e w e α u b 10 e d w e d α u b where w e and w e d are the bulk and the downstream entrainment velocities respectively and α u b is a velocity scale representing the difference between the bulk velocity of the dense current and the bulk velocity of the ambient fluid flowing in the opposite direction the coefficient α here adopted takes into account the relative depths of dense and ambient fluids following the assumption of barr 1967 for a gravity current propagating over an horizontal bottom α 2 for the bulk entrainment e while for the downstream entrainment e d α 1 65 for the experiments o 1 4 and α 1 28 for o 5 these values of α are evaluated by using measured water depths and the no net flow condition as in lane serff et al 1995 the entrainment velocity is defined as the discharge of entrained ambient fluid crossing the interface between the dense current and the ambient fluid per unit area thus w e and w e d are evaluated as 11 w e q e s x 12 w e d q e d s x d where s x and s x d are defined as the total and downstream area along which the entrainment takes place i e the area of the interface of the dense current and the bulk entrainment flow q e is then defined as 13 q ei a i a 0 w c h t i t 0 in fig 11 the bulk e is displayed versus x f in agreement with previous studies adduce et al 2012 ottolenghi et al 2016b e decreases as the gravity current propagates and x f increases reaching a value of approximately e 10 2 moreover the entrainment depends on the initial total depth h and as r 0 decreases i e h c decreases e decreases to better understand the effect of the bottom obstacle e and e d evaluated at x f 4 are displayed respectively in fig 12 a d as a function of the local reynolds r e and froude f r numbers defined as 14 r e b u f h m a x ν r e d u f d h m a x ν 15 f r b u f g b h m a x f r d u f d g d h m a x where r e b and f r b refers to bulk quantities and r e d and f r d to the overflowing current downslope evaluated at x f 4 specifically u f d is the overflow velocity calculated as the distance d x f x v in the time interval taken to travel the distance d g b and g d are the reduced gravity obtained by the averaged densities ρ b of the total dense current and ρ d of the overflow only respectively in fig 12a e increases as r e increases in agreement with previous works ottolenghi et al 2016b cenedese and adduce 2008 in particular r e b decreases with h ranging between r e b 1000 when h 0 13 and r e b 11000 when h 0 27 moreover except for run o1 the interaction with the obstacle causes a reduction of the volume of the dense current driving the motion which produces a reduction of the front velocity and consequently r e b therefore a decrease of e is accordingly observed for the o1 5 runs compared to the b1 5 runs the dependence of the bulk e on f r b is additionally shown in fig 12b and in agreement with previous findings cenedese and adduce 2008 e increases as f r b increases ranging between f r b 0 95 for h 0 13 m and f r b 1 1 for h 0 27 m what emerges is that despite the formation of a macro vortex which entrains ambient water when the gravity current overflows the obstacle for r 0 0 71 the total bulk e is not significantly affected compared to the base experiments this can be explained by considering that the entrainment due to the macro vortex at the back of the head while the current propagates downslope is counteracted by the portion of the dense current reflected upstream the obstacle which is less diluted causing the bulk entrainment to remain constant moreover the reduction of r e b contributes to decrease the bulk entrainment by contrast a large influence of the obstacle is found for run o5 for which a reduction of the r e b 4000 to 1000 determines a significant decrease of e the obstacle marks a discontinuity in the dense current propagation thus it is important to investigate the entrainment processes associated to the overflow only to this aim the dependence of the entrainment parameter evaluated for the overflow downstream of the obstacle e d on r e d and on f r d is also verified and shown in fig 12c and d for the series o1 5 following the above discussion e d related to the overflow only is shown to increase as the r e d increases and it is slightly larger than the total bulk e suggesting the role of the imv as source of entrainment of ambient water within the current more specifically for r 0 0 81 the f r d related to the overflow downstream is larger than the bulk f r b since the g d is much reduced and the head of the dense current diluted these results suggest that for r 0 0 81 the interaction with the obstacle is able to cause the transition to a supercritical current characterized by large densimetric f r and diluted gravity currents associated with the imv development finally fig12 c d highlight that the relevant non dimensional number controlling the entrainment process is r e d 4 conclusions in the present work an experimental study on lock release gravity currents interacting with a bottom triangular obstacle is presented detailed density measurements enabled to deepen the dynamics of the dense current interaction with the obstacle depending on the relative obstacle height r 0 which has been shown to be the main parameter governing the overflowing current indeed the current dynamics is deeply affected by the obstacle depending on r 0 only part of the current overflows the obstacle and propagates downstream while part is reflected in the upstream region of the tank the overflow develops a circular macro vortex whose dimensions are dependent on the volume of dense current overflowing the obstacle i e the higher is r 0 and the larger is the vortex the overflow of dense current above the obstacle has been studied as a function of r 0 and the linear decrease of percentage of overflow with decreasing r 0 is found in agreement with previous findings the density field evaluation enabled to describe more thoroughly the evolution of the overflow in particular the height of the current defined as the 2 dimensionless density threshold has been analysed and shows that the dimensionless height of the vortex downstream the obstacle increases with r 0 moreover in the upstream region the portion of the current reflected propagates as a bore whose position is determined by the increase of the dimensionless height these informations can be coupled with the time and space evolution of the depth averaged density fields in fact as the the macro vortex develops a consequent more diluted overflow downstream of the obstacle is found by contrast in the upstream region the higher values of density are found suggesting that the portion of the current retained by the obstacle is less diluted and does not entrain ambient water the dynamics of the overflow has been deepened by analysing the time evolution of the front position in particular the effect of the obstacle on the front of the gravity current is to induce an early transition to the self similar flow regime ad in some cases also to the viscous flow regime this implies a decrease of the velocity of the front downstream of the obstacle which for r 0 0 62 lead the current to stop before reaching the end wall of the tank an increase of the velocity is indeed observed as the current climb up the upstream slope of the obstacle due to the overtaking dense flow following the head while a consequent decrease is observed when the macro vortex develops finally to fully understand the entrainment processes related to the interaction with the obstacle the evolution of the non dimensional area is presented for both the series of experiments with and without the obstacle for the base experiments on the rigid bottom the area increases linearly indicating that during the slumping phase the entrainment of ambient water occurs at constant rate according to literature when the current interact with the obstacle depending on r 0 a stops the increase and reaches a maximum value where no more ambient fluid is entrained in the dense current an insight into the downsloping overflow non dimensional area and entrainment flowrate indicates indeed that as r 0 decreases the rate of entrainment decreases evolving towards a plateau for run o5 i e r 0 0 62 for which q e d 0 since the overflow is completely diluted finally results of the bulk entrainment parameter suggest that the entrainment strongly depends on the initial dense water depth h i e the higher is h the higher is the entrainment associated to the dense current and confirm the role of relevant non dimensional numbers i e r e and f r despite the formation of the imv which entrains ambient water the bulk entrainment of the current does not increase for each r 0 investigated indicating that a balance is induced by the portion of the current reflected in the upstream region and the reduction of r e of the overflowing current in conclusion when r 0 1 the current overflowing is weakly influenced by the obstacle and the developing gravity current downstream continues to increase its volume and to entrain ambient water a complete blockage of the current is only reached when the total water depth is lower that the height of the obstacle nevertheless when r 0 0 62 the overflow of dense current is much reduced and the percentage of overflow m 0 1 is highly diluted and stops downstream the obstacle author statement we hereby declare and confirm that all the authors have substantially contributed to the work and have read and approved the submitted manuscript declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgements this research was funded by the italian ministry of education university and research miur through the departments of excellence 2018 2022 program 
279,fresh groundwater reserves being of vital importance for more than a billion of people living in the coastal zone are being threatened by saltwater intrusion due to anthropogenic activities and climate change high resolution three dimensional 3d variable density vd groundwater flow and salt transport ft numerical models are increasingly being used to support water managers and decision makers in their strategic planning and measures for dealing with the problem of fresh water shortages however these computer models typically require long runtimes and large memory usage making them impractical to use without parallelization here we parallelize seawat and show that with our parallelization 3d vd ft modeling is now feasible for a wide range of hydrogeologists since a speedups of more than two orders of magnitude can be obtained as illustrated in this paper and b large 3d vd ft models are feasible with memory requirements far exceeding single machine memory keywords parallel computing distributed memory variable density groundwater flow salt transport numerical modelling seawat 1 introduction saltwater intrusion caused by anthropogenic activities and climate change threatens fresh groundwater reserves that are of vital importance for more than a billion of people living in the coastal zone neumann et al 2015 coastal unconsolidated groundwater systems are under pressure of salinization due to multiple threats that are related to climate change population increase and associated increase of freshwater demand and economic growth examples are land subsidence by excessive groundwater pumping minderhoud et al 2017 surface sealing by urbanization renaud et al 2013 climate induced relative sea level rise ferguson and gleeson 2012 oude essink et al 2010 seawater overwash by storm surges yang et al 2013 and changing patterns for groundwater recharge evaporation and groundwater seepage faneca s anchez et al 2012 to come up with strategies and measures to address these problems water managers and policy makers require accurate quantitative future projections at the highest resolution possible as a result high resolution three dimensional 3d groundwater flow and salt transport models become more and more important instruments to support water coastal management and policy development harbo et al 2011 unfortunately such models are generally very computational demanding since they often consist of many cells and many timesteps and are generally not capable of using the available computer resources efficiently it is important to note that the number of cells and timesteps are not only determined by the resolution required to capture features of interest but can also be directly imposed by the necessity to satisfy various numerical constraints oude essink 2003 short longitudinal dispersion lengths that are common in sedimentary basins such as the deltaic area of the netherlands might stress the grid péclet condition leading to small cell sizes and hence many cells furthermore the occurrence of large model groundwater flow velocities while satisfying the courant friedrichs lewy condition might result in small transport timesteps and hence many timesteps finally the large inertia of variable density groundwater flow systems makes that often large simulation times are needed to accurately estimate future groundwater salinities e g for paleo hydrogeological reconstruction of the fresh saline groundwater distribution delsman et al 2014 this makes transient variable density groundwater flow and salt transport simulations very computationally challenging distributed memory parallel computing see e g eijkhout et al 2015 is a commonly used practice to significantly reduce computing time and make large memory usage possible common distributed memory parallel computers use a non uniform memory access architecture numa in numa the entire computational grid memory is first distributed partitioned over multiple computer nodes each node having local main memory ram and each node consists of one or more multi core cpus processors then the problem is solved simultaneously by multiple cores while exchanging data through a fast interconnection network using the message passing interface mpi forum 1994 this is in contrast with shared memory parallel computing where each processor can only access the same memory of a single computer typically through openmp however parallel computers nowadays are heterogeneous systems with a mixed memory organization where memories are distributed across the nodes while multi core processors share memory within the same node or cpu solving the flow and salt transport equations in parallel typically means that after discretization consecutively one or more linear systems of equations need to be solved by e g a krylov subspace linear iterative solver such as the conjugate gradient method cg for symmetric positive definite matrices or the biconjugate gradient stabilized method bi cgstab for general matrices barrett et al 1995 accelerated by a suitable parallel preconditioner such as the additive schwarz block jacobi preconditioner or multigrid smith et al 1996 the focus in this paper is on parallelization of seawat langevin et al 2008 the most widely used public domain code developed by the u s geological survey for modeling 3d variable density groundwater flow and salt transport by coupling modflow harbaugh et al 2000 and mt3dms zheng and wang 1999 since seawat is based on modflow the worldwide leading code for groundwater modeling it largely benefits from the modflow ecosystem of a vast number of pre and post processing tools bakker et al 2016 and well documented graphics user interfaces waterloo hydrogeologic 2021 several proprietary codes claim to be suitable for modeling parallel 3d variable density groundwater flow such as tough jung et al 2018 pruess et al 2011 following a distributed memory approach using an additive schwarz preconditioned bi cgstab krylov solver from the aztec solver library elmroth et al 2001 hydrogeosphere using shared memory openmp hwang et al 2014 feflow diersch 2002 using the algebraic multi grid solver from the samg solver library and d3f schneider et al 2012 using the distributed memory multigrid solvers from the ug solver solver library lang and wittum 2005 as far as we know only for the latter d3f code parallel results were published for a 3d variable density groundwater model reporting a speedup of 282 on 512 computational cores for a saltdome problem having 66 million of unknowns lang and wittum 2005 modflow and mt3dms as standalone non coupled codes were parallelized by several researchers regarding modflow semi distributed memory parallelization was applied by schreuder 2005 where one parent process was set responsible for reading all model input data and scattering this data to the other worker processes as a linear parallel solver the additive schwarz preconditioned cg solver from the petsc library balay et al 2014 was applied cheng et al 2014 applied the algebraic multi grid preconditioned pcg solver from the jasmin library mo et al 2010 to speed up computations for a field flow problem located at yanming lake in china naff 2008 applied a semi distributed memory parallelization where he applied an additive schwarz preconditioned cg solver while keeping the matrix assembly and input output serial shared memory parallelization of modflow using openmp was done by dong and li 2009 parallelization of modflow using graphics processing units was done by hughes and white 2013 and ji et al 2014 regarding mt3dms shared memory parallelization using openmp was done by abdelaziz and le 2014 and huang et al 2018 to our knowledge we are the first to parallelize seawat the reason for parallelizing seawat is that we aim to push 3d groundwater flow and salt transport modeling to a next level for a large group of geohydrologists by making our code available as open source software as part of interactive modeling water quality software imod wq deltares 2020 also from that point of view we therefore believe that our code differs from proprietary codes like d3f lang and wittum 2005 our parallelization approach has a similarity with the parallelization of modflow done by schreuder 2005 and naff 2008 although there are significant differences first we have also parallellized salt transport computations hence mt3dms second compared to schreuder 2005 our physical overlap supports flexible rows of cells to account for the total variation diminishing tvd advection option our physical overlap also supports communication for evaluating the cross terms when using the full dispersion tensor option instead of lumping the cross terms to the righthand side second our parallellization approach is fully distributed and does not include any parent worker mechanism for scattering input data parallel output is supported and effcient parallel input can be used by grid wise direct access binary reads making our implementation more suitable in case of many varying stress input data and output comparing our work to all the above mentioned parallellelization efforts of modflow and mt3dms we believe that our fully distributed memory approach is the reason why we as far as we know are the first to report speedups for a very large model 100 million of active cells third our parallelization depends on the mpi software library only which is generally straightforward to use on cross platforms and can therefore be used by a wide range of hydrogeological modelers we developed a linear parallel unstuctured solver and do not make use of petsc solvers because at the time of development petsc was very hard to use by modelers using windows computers fourth our partioning differs in the way how it deals with irregular model boundaries where we apply the commonly used and more robust orthogonal recursive bisection partitioning berger and h bokhari 1987 it should be noted that regarding the salt transport advection scheme we did not parallelize the lagarangian method hence the method of characteristics particle tracking supporting this would likely require the implementation of dynamic load balancing of computational work involving re partitioning of moving particles in time and dynamically re mapping concentrations to the flow domain partitions since eulerian methods suffer from numerical dispersion oude essink and boekelman 1996 zheng and wang 1999 our parallelization might therefore be less applicable to problems requiring the simulation of sharp interfaces between fresh and saline groundwater 2 methods seawat langevin and guo 2006 uses modflow to solve the variable density groundwater flow equation see eq 3 in appendix a and mt3dms to solve the salt transport equation see eq 4 in appendix a coupled by the state equation see eq 6 in appendix a together with sufficient boundary and initial conditions both modflow and mt3dms apply a control volume finite difference or finite volume discretization on a structured grid and typically require multiple so called outer iterations picard linearization to reach convergence where in each outer iteration a linear system of equations is being solved using so called inner iterations distributed memory parallelization of seawat involves setting up the grid partitioning modifying the linear solver setting up the mpi communication and optimizing the input and output after setting the goals of the parallelization and how its performance is measured we will address each of these aspects of the parallelization method in the next sections 2 1 parallel performance measurement since hydrogeological modelers typically like to speed up their existing model by using the available processor cores we focus in our paper on obtaining strong parallel scalability measuring strong scaling means that the problem size is kept fixed while the number of processor cores being used increases this contrasts with weak parallel scalability where the problem size grows linearly with an increasing number of processor cores here we express the parallel performance in relative speedup sp t ref tp with t ref is the measured execution wall clock time for a reference configuration with p ref cores or mpi processes subdomains and tp is the measured execution runtime for an alternative configuration with p cores in case the reference time corresponds to a serial run then t ref t 1 in this definition of speedup we assume that all measurements are obtained by applying the same solvers and solver settings meaning that we do not seek for the fastest serial method and implementation for ideal strong parallel scalability the speedup equals s p ideal p p ref however in practice this is hard to obtain due to work load imbalance defined as i pmax p lp l where p is the total number of cores being used lp is the work load for core p and l the total work load partitioning primarily aims for obtaining a good load balance and secondary for minimizing the subdomain interface length edge cuts 2 2 subdomain partitioning partitioning or decomposing here refers to dividing the computational grid consisting of active cells into smaller grids partitions or subdomains see fig 1 for an example of partitioning a grid consisting of 16 columns n c 16 and 14 rows n r 14 into four partitions p 4 two methods are considered in this study a relatively straightforward method to obtain equally sized rectangular partitions here referred to as so called uniform partitioning and orthogonal recursive bisection orb partitioning partitioning is done in the horizontal plane only since for groundwater models the number of cells rows columns in the horizontal plane is usually significantly larger than the number of cells in the vertical dimension layers however this is simply an implementation choice and not a limitation of the method presented here this also holds for the implementation choice that each partition is uniquely assigned to one processor core mpi process hence we assume that the total number of subdomains equals the total number of processor cores moreover the partitioning is static and done only once as a pre processing step this neglects the spatio temporal variation in computing time that might occur during simulation causing load imbalance and hence a decrease in parallel performance since it turns out that for groundwater simulations most computing time is being spent in the linear solvers and in our model active cells remain active this seems to be a valid assumption for us however for models that have a highly varying stress input data or a highly changing spatial non linearity including cell rewetting dynamic partitioning might be more appropriate in addition our partitioning results in non overlapping rectangular partitions where the overlap is added after the partitioning without accounting for the work load for this study we assume that each active cell has the same weight furthermore we assume that flow and salt transport share the same partition this seems a valid assumption for us since for our models flow and salt transport always share the same model boundaries by this we do see any need to explicitly parallelize the coupling between the flow and salt transport computational domain therefore strongly simplifying implementation 2 2 1 uniform partitioning for regular rectangular grids so called uniform partitioning is a straightforward method for minimizing edge cuts hence the number of connections at the interface between the partitions while ignoring the work load that is typically defined by the active cells let n be the minimum of n c and n r from all possible combinations p p c p r where p c and p r are the number of blocks subdomains in column and row direction respectively that specific combination is selected such that p i max 1 n n c n r p 1 where i c when n n c or i r otherwise for the example of fig 1a process p1 clearly has the largest number of active cells 42 enclosed by red colored box and the load imbalance for the non overlapping uniform partitioning is i 4 42 100 1 68 2 2 2 orthogonal recursive bisection partitioning real world groundwater flow and salt transport models usually have irregular model boundaries e g following coastlines or watershed boundaries to define an area of interest this means that the computational load typically represented by the active cells can be scattered across the entire computational domain load balancing for such irregular boundaries is challenging and requires an appropriate partition strategy this was also observed by schreuder 2005 who developed an iterative partition method for a groundwater model with an irregular domain of the san luis valley colorado usa this method initially starts with a uniform partition and iteratively merges cell weighted rectangles and shifts interfaces to obtain sub optimal partitions however this method was found to be not sufficiently general or robust for general use schreuder 2005 as a more robust alternative method to account for irregular boundaries our partitioning supports orthogonal recursive bisection berger and h bokhari 1987 boman et al 2012 fox 1988 or briefly orb this commonly used divide and conquer partitioning method recursively bisects intermediate partitions perpendicular to their longest dimension k 0 times until p 2 k non overlapping equally loaded partitions are obtained for the example of fig 1b all the non overlapping partitions have the same load equal to 25 and hence there is no load imbalance in the originally proposed method berger and h bokhari 1987 the number of partitions can only be a power of two and therefore we modify this method to be applicable to general number of partitions p this is done by applying a prime factorization of p i 1 k f i where at each level i recursively fi parts of equal load are obtained by dividing along the longest dimension when fi 2 for all i the original orb method is obtained it should be noted that our orb implementation also includes the dirichlet boundary conditions or constant value active cells as in example fig 1b denoted by index 1 since these cells are eliminated in the linear system this means that a load imbalance might occur during linear solving although the orb partitioning could therefore be further optimized for these boundary conditions this was not a subject of this study 2 2 3 overlap and communication solving the variable density groundwater flow equation and salt transport equation in parallel requires that all necessary coefficients at subdomain interfaces should be available for the discretization and evaluation of the computational stencil for solving the variable density groundwater flow equation this means that interface coefficients such as the inter cell transmissivity should be known and matrix vector operations with the 7 point stencil across interfaces should be possible in parallel for solving the advection dispersion equation in parallel two downstream nodal concentrations should be available at interfaces when applying the third order tvd advection scheme using the ultimate limiter leonard 1988 zheng and wang 1999 furthermore when applying dispersion using the full tensor scheidegger 1961 all data near subdomain interfaces should be available for evaluating the dispersion cross terms for the 19 point stencil since we follow a distributed memory parallelization approach and data at subdomain interfaces typically depend on both processes sharing the interface data availability can be problematic to overcome these difficulties and to strongly simplify parallel implementation we introduce a so called physical overlap by specifying additional cells for the example in fig 1 denoted by the pink boxes these so called halo or ghost cells are used to automatically compute the correct coefficients at subdomain interfaces from shared input data without any communication or reconstruction necessary besides this using a physical overlap requires less modifications of the serial code in our parallelization each process is responsible for computing the groundwater heads and concentrations for the cells in the non overlapping partition exclusively this means that for the additional halo cells only copies of computed heads and concentrations are stored that are received from neighboring processes hence besides synchronized heads and concentrations halo cells are similar to other non halo cells synchronization is done by local point to point mpi communication this synchronization is typically done after the linear krylov solver has finished in which halo cells are used to synchronize search directions at each inner iteration to account for matrix vector products involving the computational stencil across the subdomain boundaries for this purpose we use a data structure that is arranged in communication bands each band has sending cells corresponding to cells where the associated process is responsible for and receiving cells corresponding to the halo cells where data from adjacent processes are being received fig 1 illustrates this for the case of two bands corresponding to an overlap of two rows that is required for the tvd advection scheme for the uniform partitioning in of fig 1a process p1 has local communication with neighbors p2 and p3 considering the first band p1 sends computed values to p2 from column 8 and rows 1 8 light green and receives computed value from p1 in the halo cells of column 9 rows 1 8 dark green note that almost half of these cells are inactive and have a user defined no data value nevertheless in the chosen implementation these inactive cells are also communicated and are therefore redundant when dispersion is applied accounting for the full tensor p1 also needs to communicate with p4 in that case cell 71 and cells 72 77 and 78 are also part of the halo cells for band 1 and 2 respectively it should be noted that although our code has the flexibility to perform a point to point communication for only the outer band in this study we always communicate for all bands at the same time this means that when tvd is applied local communication within the linear solver is for two bands although only values from the first band are used furthermore as can be seen in fig 1b orb partitioning results in more local communication than uniform partitioning since p2 has at least three neighbors p1 p3 and p4 this additional communication is the trade off for obtaining optimal load balance besides local point to point communication global collective mpi communication is required this is mainly required within the linear krylov solver for computing inner vector vector products and evaluating global grid maxima global communication is also necessary for synchronizing the salt transport timestep length global grid minimum accumulating volumetric or mass budgets for output or gathering observation wells for output in general global communication is more expensive than local communication since this type of communication requires a synchronization point involving all processes for example computing an inner vector vector product value that necessarily needs to be available for each process prior to continuing to the next linear iteration means that each process first needs to compute its partial sum before synchronizing then sends this value to all other processes and each process performs the addition global mpi communication strongly depends on the number of nodes used and the interconnection network characteristics such as diameter and latency delay in this study we mainly focus on relatively coarse grained parallelization many cells per subdomain using fast interconnection networks having a low latency and high bandwidth coarse grained means that the computational time that can be directly related to partition size is large compared to the total execution time we therefore may neglect actual communication times spent on local and global communication by this we assume that communication overhead is exclusively the result of wait states i e periods where processes sit idle at synchronization points that can directly be related to load imbalance böhme 2013 2 3 linear parallel krylov solver the linear systems are solved by preconditioned krylov subspace acceleration see e g barrett et al 1995 for solving groundwater flow the preconditioned cg method is used and for solving salt transport the preconditioned bi cgstab method within these methods the one level additive schwarz preconditioner dolean et al 2015 smith et al 1996 is taken corresponding to the block matrix diagonal see appendix b for more details our implementation in seawat called the parallel krylov solver pks corresponds to a double precision unstructured grid solver that is largely based on the pcgu solver from modflow usg hughes and white 2013 commonly used krylov subspace methods within seawat are the pcg solver for modflow hill 1990 and the compulsory generalized conjugate gradient gcg 1 1 note the gcg solver being used in seawat is also preconditioned but this is omitted in the acronym solver for mt3dms zheng and wang 1999 in the remainder of this paper we will sometimes refer to those linear solvers as default seawat solvers our pks has the same termination criteria as the pcg and gcg solvers hence for flow the infinity norm is used to declare converge of the linear iterates if the maximum absolute head differences are εhclose m and the maximum absolute head residuals are εrclose kg day for sufficient small values of εhclose m and εrclose kg day for salt transport the relative stopping criteria in the euclidian norm is used for the concentrations satisfying small values of εcclose for the remainder of this paper we refer to the additive schwarz preconditioned cg solver for solving flow as the flow pks fpks and the additive schwarz preconditioned bi cgstab solver for solving salt transport as the transport pks tpks for both methods respectively the algorithms are given by fig b1 and fig b2 in appendix b that include pseudocode for indicating the mpi communication points 2 4 input and output our parallelized code as part of imod wq supports all ascii and binary grid input data from standard seawat in a serial manner meaning that each process first needs to read the entire grid data into memory prior to clipping the data to its partition since this is not a scalable operation such input mechanism might have negative effects on the parallel performance for transient simulations requiring many stress period input data as a more scalable alternative imod data files idfs vermeulen et al 2019 are supported where each process directly reads its local grid data exclusively by applying direct access binary reads standard seawat column data input for stress packages e g for river boundary conditions are read in parallel by selectively reading only for cells that belong to the overlapping partition as a more scalable option we also support stress package input using idfs by reading all parameters as grids output is done in a straightforward parallel manner where each process uniquely writes its partition output e g binary groundwater heads and concentrations besides standard seawat files and idfs we support parallel vtk output files that can directly be visualized by graphical user interfaces such as paraview and tecplot furthermore we extended the seawat code by adding a pre processing routine for setting up an entire seawat model with a single key word driven run file that is easy to use and allows hydrogeological modelers to specify macros for efficiently setting up models consisting of many layers and stress periods 3 test cases 3 1 test case 1 henry 3d model solving the henry saltwater intrusion problem henry 1964 is a well known benchmark for variable density groundwater flow and salt transport simulation codes the henry test case considered here see fig 2 depends on the three dimensionless parameters a q in k fεd comparing viscous and buoyancy forces b d m q in comparing diffusive and advective salt fluxes and aspect ratio ξ l d for our test we take a 0 263 b 0 1 and ξ 2 corresponding to what henry evaluated semi analytically and similar values as taken by langevin et al 2008 to make the problem computationally challenging for parallel computing we expand the original 2d geometry to 3d by taking 2 units m in the y direction perpendicular to the xz plane hence specifying q in 11 405 m3 day however by doing this the flow and salt transport remains 2d in the xz plane for this test case δx δy 0 002m is taken and δz 0 01m resulting in 100 million active computational cells 1000 columns 1000 rows 100 layers the cell centered finite difference scheme is taken for advection and for dispersion all cross terms are lumped to the righthand side coupling between flow and salt transport is chosen to be explicit for the fpks the chosen stopping criteria are εhclose 1 0 10 8 m and εrclose 1 0 10 5 kg day for the tpks εcclose 1 0 10 7 since the flow problem is linear in each time step a maximum number of inner iterations 2500 for both linear solvers are taken such that convergence is achieved after one single outer iteration for this test case a maximum of 1024 cores are taken considering a uniform partitioning the number of subdomains in x and y direction is 1 2 4 6 8 10 14 16 24 and 32 and a single subdomain in z direction hence using 1024 cores this corresponds to a xyz decomposition of 32 32 1 since for this test case it is assumed that there is no flow in y direction this means that the domain decomposition in x direction contributes directly to the linear solver iterations and the decomposition in y direction corresponds to data decomposition only all the grid input data for this test case are specified as binary idf files vermeulen et al 2019 3 2 test case 2 sand engine model in 2011 a large sand nourishment of approximately 20 million m3 was placed along the dutch coastline between hook of holland and the hague for testing its protective efficacy against long term climate change effects such as sea level rise and storm surges mulder and tonnon 2011 stive et al 2013 as part of this sand engine pilot project a seawat model was developed huizer et al 2016 here referred to as sand engine model for assessing the effects of long term morphological evolution of the sand replenishment on the local groundwater system and the existing fresh groundwater resources this calibrated seawat model computes both variable density groundwater flow and salt transport in 3d using 50 model layers 234 rows 234 columns having a uniform horizontal cell size of 50 m with a varying layer thickness of 1 to 10 m covering a total model area of 11 7 km2 the molecular diffusion coefficient used is 10 9m2 s the longitudinal dispersivity used is 0 2 m with a ratio of transversal to longitudinal dispersivity of 0 02 the model computes total dissolved solutes tds values with seawater density of ρs 1020 kg m3 and concentration c s 28 kg m3 that is lower than the average salinity of the north sea due to a freshening by the river rhine the chloride concentrations are obtained afterwards by multiplying the computed tds values by a factor of 0 55 in this paper we consider a realistic test case version of the sand engine model having a higher horizontal resolution of 25 m and simulating half a year using daily timesteps july till december 2011 having 25 m cells this test case consists of a total of 4 733 797 active cells 50 layers 468 rows 468 columns the tvd scheme and cell centered discretization is used for advection and for dispersion all cross terms are lumped to the righthand side coupling between flow and salt transport is chosen to be explicit for solving groundwater flow the fpks criteria are εhclose 1 0 10 6 m and εrclose 0 1 kg day setting 2500 as a maximum number of linear solver iterations for solving salt transport εcclose 0 1 is taken for the tpks with a maximum of 50 iterations an initial timestep of 1 0 10 3 days is taken and a total of 186 transport timesteps are required to finish the simulation for this test case a maximum of 256 subdomains are used generated by orb partitioning cell weights are defined as the sum of active cells in z direction see fig 3 all the grid input data for this test case are specified as standard seawat ascii data 3 3 hardware and compiler the parallel performance of both test cases is evaluated on the cartesius dutch national supercomputer surfsara 2014 at the time of writing this machine has 1913 numa nodes connected by a fast infiniband interconnection network in a fat tree topology summing up to a total of 47 776 intel xeon cpu cores and 128 tb ram memory all our experiments are done on so called haswell thin nodes where each node has 64 gb ram memory and two intel xeon e5 2690 v3 12 core processors and each cpu has its own socket and four channels to main memory we use a maximum of four cores per thin node two cores per cpu since this value generally results in lowest wall clock times this is based on our experiences on cartesius and a variation of cores per node for a fixed number of cores considering our test cases this means that during computation at least 20 cores are idle and therefore the core utilization is low 17 non idle the reason why using more cores per cpu results in an increase in run times is very likely related to the large memory usage of our models and the competition of multiple cores within a multi core cpu for the main memory bandwidth through the caches tudor et al 2011 this seems a hardware related issue inherent to multi core numa architectures and not a direct result from our parallelization approach and therefore further research on core utilization is kept outside the scope of this study nevertheless first observation for the largest henry 3d case indicate that run times can increase 15 when using four cores per cpu 33 non idle and 100 when using all 12 cores per cpu although hybrid mpi openmp parallelization could possibly be a good approach to increase core utilization previous experiments with modflow did not show significant improvement verkaik et al 2015 furthermore for each core configuration two runs are executed and the minimum of wall clock times is taken to exclude hardware variation e g due to cpu throttling or network related issues we compiled imod wq on cartesius using the intel fortran compiler v15 0 0 using high level o3 optimization linked with the intel mpi library v5 0 update 3 we used mixed real precision compilation meaning that variables of type real used in the code can have single precision accuracy 4 bytes or double precision accuracy 8 bytes this contrasts with the usgs provided seawat binary that was compiled such that each real variable corresponds to a double precision accuracy compiler flags real size 64 align dcommons the reasons for not doing this explicitly are the incompatibility with the imod library that requires mixed precision and the increasing memory usage that double precision usage involves however mixed real precision might result in instability due to rounding errors with seawat although none of this behavior is observed for the test cases considered in this paper 4 results 4 1 henry 3d test case fig 4 a shows the results for running the henry 3d test case on the cartesius supercomputer up to 1024 cores using the pks the speedups are presented as relative values to two cores p ref 2 since the serial run requires more memory 96 gb than available on a single thin node 64 gb maximum because of this we take two thin nodes for evaluating the speedup with two cores using 1024 cores a maximum relative speedup of 140 is obtained to estimate the value of the absolute speedup a smaller run using 10 layers is compared on both a thin and so called fat node that has more memory 256 gb but a slower cpu 2 7 ghz intel xeon e5 4650 estimating that the fat node is 1 13 times slower the serial execution time on a thin node is estimated to be 16 hours 57 minutes 47 seconds hence estimating the speedup with two cores to be s 2 1 78 this estimates the absolute speedup with 1024 cores to be 140 1 78 249 fig 4b shows the total number of linear iterations hence accumulated over all outer iterations it can be clearly seen that the total number of linear solver iterations increases with the number of processor cores used for the fpks iterations considering flow this is a factor 3 for the tpks iterations considering salt transport this is a factor 3 7 the accuracy of the pks is verified against the combined pcg flow and gcg transport solvers for a sample configuration of 144 cores see fig 5 for the computed differences in isochlors 4 2 sand engine test case fig 6 a shows the measured speedups and fig 6b the linear solver iterations for running the sand engine test case on cartesius up to 256 cores p ref 1 using 256 cores a speedup of 86 is obtained while the linear fpks iterations for flow increased with a factor 1 7 compared to the serial run the linear tpks iterations for salt transport remain constant at a value of 372 for 256 cores using the pks fig 7 a and c show the computed groundwater table and concentrations at the last time step respectively and differences serial parallel compared to the serial run with the pcg and gcg solvers in fig 7b and d accordingly for the head differences the minimum maximum and average values are 3 14 10 5 m 1 24 10 5 m and 2 41 10 6 m respectively for the concentrations those values are 5 40 10 3 mg l 7 34 10 3 mg l and 2 41 10 6 mg l respectively 5 discussion the results show that significant speedups are obtained figs 4a and 6a up to two orders of magnitude for the henry 3d test case and for both test cases there is a strong linear solver iteration increase figs 4b and 6b for an increasing number of processor cores however surprisingly this iteration increase does not hold for the sand engine transport iterations that remain constant see fig 6b the reason for this might be found in the small mechanical dispersion used in the sand engine test case implying highly advection dominated flow and salt transport that therefore does not heavily strain the linear salt transport solver it can be seen in figs 4a and 6a that for an increasing number of cores the speedup curves tend to deviate more from ideal speedups and therefore our parallelization becomes less scalable see section 2 1 we analyze this behavior by using scalasca code profiling tools geimer et al 2010 to identify the main non scalable components of the code this is done by analyzing the component cost c p c p t p c for a component c in relation to the total cost cp ptp fig 8 a and c show c p c c ref for the henry 3d test case c ref c 2 2t 2 and sand engine test case c ref t 1 respectively in fig 8b and d values for c p c c p are plotted for the henry test case and sand engine test case respectively showing the portion of work for a certain component relative to the total execution time in the ideal case perfect strong scaling or cost optimality is achieved if for all or at least for the most dominant components c p c c ref remains constant for an increasing number of cores however as can be seen in fig 8a and c this is not the case the linear solver execution times are the main non scalable components that increase with the number of processes see fpks and tpks in fig 8a and c the reason for this is the linear solver iteration increase see figs 4b and 6b that can likely be explained from mathematics by the presence of low frequency eigenmodes induced by the domain decomposition in the dominant flow direction hampering the linear solver convergence dolean et al 2015 smith et al 1996 this is a known problem see e g hammond et al 2014 and our solver convergence can likely be improved by combining the additive schwarz preconditioner with a multi level preconditioner such as the additive coarse grid correction preconditioner the henry case would likely benefit most from applying such preconditioner since up to 256 cores the portion of work spend in the linear solver remains constant at about 80 see in fig 8b by adding for fpks and tpks we can estimate a theoretical upper bound for the speedup by assuming no iteration increase as shown in fig 9 the speedups are estimated by using the linear iteration time computation and mpi cost of 5 and 9 seconds using 2 cores for fpks and tpks respectively and reducing the total execution time linearly with the iteration increase while neglecting any additional work introduced by multi level preconditioning by doing this almost perfect scalability can be achieved up to 256 cores correcting for iteration loss we estimate s 256 602 which is big improvement of a factor 2 4 this more or less fine tuning of our parallelization is recommended for future research considering the henry test case load imbalance occurs when using more than 256 cores this can be seen in fig 8b by the downward trend of the linear solver computation time and upward trend of mpi communication time load imbalance is likely to be caused by the physical overlap that is added after the partitioning see section 2 2 for the henry case this is one additional row for interfacing with a neighboring subdomain since we are using finite difference advection this means that the amount of total work will increase e g the time spend on matrix assembly for dispersion see the slightly upward trend of t mat assembly in fig 8a starting from 256 cores although the linear solvers are mathematically strict non overlapping we also expect that the linear solver is responsible for a certain part of the load imbalance because all do loops in our code are defined over all the cells including the overlap the reason why larger speedups are obtained for the henry test case fig 6a than for the sand engine test case fig 7a might be directly related to the partition sizes and hence the grain sizes for each core configuration the number of active cells for each partition is about 21 times larger for the henry test case than for the sand engine test case making the parallelization coarser grained considering 256 cores the speedup for the sand engine model of 86 19 5k active cells per subdomain is smaller than the estimated speedup of 119 66 6 1 78 see section 4 1 for the henry test case 390k active cells per partition as long as the computational time remains dominant one should only have to focus on parallelizing computation which is generally relatively straightforward to do in order to obtain strong scaling as we have illustrated for the iteration increase the effect of the finer grained parallelization for the sand engine can be seen in fig 8c where the mpi curves grow faster than the linear solver iteration computational time indicating load imbalance furthermore for the sand engine test case i o becomes dominant taking 27 of the total execution time when using 256 cores the non scalability of i o for the sand engine test case can be explained by the usage of standard seawat input data that does not scale in parallel see section 2 4 we expect to improve this by using imod binary data files idfs exclusively for this model in the future since the sand engine test case is relatively fine grained analysis of constant iteration increase did not show any significant improvement in speedups because of the load imbalance and i o overhead as a rule of thumb for users one can say that our parallelization is most suitable for relatively larger models 105 active cells per partition lesser suitable for relatively smaller models 104 105 of active cells per partition and not suitable for very small models 104 of active cells per partition although highest speedups are to be expected for relatively larger models like the henry 3d test case still significant although less efficient speedups can be obtained when a sufficient number of processor cores is available as illustrated by the sand engine test case from our modeling experiences we believe that our pks computes sufficiently accurate heads and concentrations that have comparable accuracy compared to the default pcg and gcg solvers in seawat nevertheless from a numerical point of view a hydrogeological modeler should be aware that small differences might occur this is also the case for the sand engine test case see fig 7 where the observed maximum absolute head difference of 3 14 10 5 m for the top view layer with active cells is larger than εhclose 1 0 10 6 as well as for the henry test case where small differences occur for the 99 isochlors see fig 5 focusing on the sand engine test case we also observe that at the final timestep some computational cells have higher absolute maximum differences 3 04 10 4 m for head and 4 84 10 1 kg m3 tds than the solver stopping criteria although we did not find motivations for doing an extensive accuracy analysis we suspect that the reasons for these small differences that accumulate during simulation time are likely to be related to differences in solver methods rounding errors due to finite precision arithmetic and perhaps too aggressive compiler optimization the preconditioner used in the pks ilu 0 differs from the one used within the pcg solver modified incomplete cholesky preconditioner and the one used within the gcg solver symmetric successive over relaxation furthermore the fpks used the bi cgstab krylov method while the gcg solver uses lanczos orthomin these differences in solver methods might result in differences in accuracy after solving the linear systems for flow and salt transport furthermore mathematically seen for each different core configuration a different additive schwarz preconditioner is applied with the pks hence resulting in different convergence behavior moreover different core configurations result in different finite precision rounded arithmetic e g for the computing of inner product coefficient within the cg algorithm by adding partial sums that are computed by each core simultaneously in addition the tpks has double precision accuracy while the gcg solver has single precision accuracy meaning that in our applications using the gcg solver might introduce small rounding errors table 1 shows the root mean square error rmse measured over all daily timesteps and cells of the sand engine test case comparing the pks fpks tpks for 256 cores with different serial solver configurations default seawat solvers pcg gcg fpks tpks pcg tpks and fpks gcg the rmse values show that the main difference between the pks using 256 cores and the default seawat solvers see also fig 7 is caused by the difference between the gcg solver and the tpks this is very likely related to differences in solver methods or finite precision arithmetic 6 conclusions and recommendations a parallel version of seawat modflow mt3dms for simulating 3d variable density groundwater flow and salt transport is developed as part of imod wq in this paper we showed that our parallel implementation is capable of significantly reducing computing times up to two orders of magnitude and capable of running models with very large memory requirements our parallelization differs from other modflow and mt3dms parallelization efforts done by other researchers in a way that a salt transport is parallelized using a physical overlap to account for e g tvd advection b our approach fully distributes memory including parallel input output c we apply the robust orthogonal recursive bisection partitioning method to address irregular model boundaries since our parallelization is easy to use and open source we expect that our parallelization may lead to new scientific advancement in the field of groundwater flow and salt transport modeling where ultimately huge 3d problems having billion of cells can be solved with thousands of cores therefore we believe that our work can be an asset for water managers and decision makers in coastal areas in a way that it helps to provide them with high resolution estimates and future projections of the groundwater salinity distribution and fresh groundwater reserves although our reported speedups are high there is still room for future improvement first our parallelization may be improved by reducing the linear solver iteration increase by applying a suitable parallel multi level preconditioner second load balancing might by further optimized by explicitly considering the weights of the physical overlap during the partitioning phase third our implementation should be further analyzed on different hardware and multi core cpu configurations with the aim of improving processor core utilization we expect that in the future multi core cpus having more and more cores will become more efficient for memory bound problems such as the latest generation amd epyc zen cpus and result in improved speedup and better core utilization for 3d variable density groundwater flow and salt transport modeling credit authorship contribution statement j verkaik conceptualization methodology software validation investigation resources data curation writing original draft writing review editing j van engelen resources writing review editing s huizer methodology writing review editing m f p bierkens conceptualization writing review editing h x lin conceptualization writing review editing g h p oude essink conceptualization writing review editing declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgements we thank christian d langevin and joseph d hughes for their suggestions and comments on parallelization seawat we also thank deltares and utrecht university for making this research possible this work was part of the development of imod wq https oss deltares nl nl web imod and we thank gijs janssen for his support furthermore we thank edwin sutanudjaja and martijn russcher for their support on running jobs on cartesius all experiments were carried out on the dutch national e infrastructure with the support of the surf cooperative the authors also would like to thank the editor and two anonymous reviewers for their valuable comments and suggestions a governing equations for variable density groundwater flow and salt transport conservation of fluid mass can be expressed by the continuity equation see e g in bear 1979 1 θ ρ t ρ q ρ ss q ss 0 with θ the effective porosity ρ kg m3 the groundwater density q m day the specific discharge or darcy velocity vector ρss kg m3 and q ss 1 day the fluid density and flow rate from the sinks and sources respectively following the notation of guo and langevin 2002 conservation of momentum can be expressed by darcy s law neglecting viscosity effects for sake of simplicity 2 q k f h f ρ ρ f ρ f z where k f m day is the hydraulic conductivity tensor for saturated fresh groundwater h f m the to be solved fresh groundwater head ρf kg m3 the freshwater density typically 1000 kg m3 and z m the elevation assuming isothermal conditions expanding θρ t and substituting 2 eq 1 can be written as 3 ρ s f h f t ρ k f h f ρ ρ f ρ f z θ ρ c c t ρ ss q ss 0 where s f 1 day is the specific storage for fresh groundwater and c kg m3 is the salt e g chloride concentration to be solved this equation is known as the variable density groundwater flow equation vdgfe which reduces to the ordinary constant density groundwater flow equation when ρ ρss ρf neglecting chemical reactions assuming that diffusive and dispersive salt transport are based on fick s law assuming single species conservation of salt can be expressed by the governing advection dispersion equation 4 θ c t q c θ d c q ss c ss 0 where c ss kg m3 is the concentration for sink and sources and d m2 day the hydrodynamic dispersion tensor with coefficients for incorporating mechanical dispersion and molecular diffusion this equation can be expressed as 5 d i j α t θ q 2 d m δ i j α l α t θ q i q j q 2 where αl m and αt m are the and longitudinal and transversal dispersivities respectively d m m2 day the effective molecular diffusion coefficient and δ ij denotes the kronecker delta eq 4 is also known as the salt transport equation ste see zheng and wang 1999 since with the variable density groundwater flow eq 3 and salt transport eq 4 we have three unknowns hf ρ and c an additional equation of state is required neglecting other density effects due to temperature and pressure we can use the linear relation 6 ρ c ρ f ρ c c ρ f ρ s ρ f c s c where ρs kg m3 and c s kg m3 are the density and salt concentration of seawater respectively typical values for seawater are ρs 1025 kg m3 and c s 35 kg m3 of total dissolved solutes simplifying eq 6 to ρ c 1000 0 7143c b parallel linear solver algorithms for flow and salt transport finite volume discretization of the vdgfe eq 3 and ste eq 4 excluding advection results in after picard linearization and eliminating the dirichlet boundary constant value conditions the linear equation 7 a f t x f t b f t where subscript f here denotes flow and subscript t denotes transport for solving the flow equation x f m is the vector of unknown fresh water heads a f kg m day a square symmetric positive definite coefficient matrix with the hydraulic cell by cell conductivity times the density and b f kg day the vector with groundwater sink source and storage terms the corresponding computational stencil is 7 point hence a f has 7 bands for solving the transport equation x t kg m3 is the vector of unknown salt concentrations a t m3 day represents the discretization of dispersion sink source and is generally a nonsymmetric matrix and b t kg day is the vector with sink source terms when full tensor dispersion is used this will result in a 19 point stencil however in our study we assume that all dispersion cross terms are lumped to the right hand side vector resulting in a t to have 7 bands like a f for the preconditioned cg method fpks the symmetrized preconditioned system 8 m 1 2 a f m 1 2 m 1 2 x f m 1 2 b f m 1 2 m 1 2 m 1 is solved and for the preconditioned bi cgstab tpks the left preconditioned system 9 m 1 a t x t m 1 b t where the matrix m is the preconditioner barrett et al 1995 using block wise natural node ordering for the non overlapping partitions as illustrated by the positive numbering in fig 1 the matrix a can be written as a block matrix of the form 10 a 1 1 a 1 2 a 1 p a 2 1 a 2 2 a p 1 a p p where a ii correspond to the interior node coefficients and a i j i j to the coupling coefficients between the subdomains considering a 7 point computational stencil and a single band for the uniform partitioning example in fig 1a then block matrix 10 has 4 4 blocks p 4 and for the first subdomain p1 the interior coefficient sub matrix a 1 1 has dimension 37 37 local coupling sub matrix a 1 2 contains two non zero entries 33 38 37 39 and a 1 3 four non zero entries 34 44 35 45 36 46 37 47 and a 1 4 note that in a distributed memory parallel setting block matrix 10 is never been formed explicitly since each processor only has local coefficients corresponding to a block row of this system taking m as the block diagonal matrix of aresults in the non overlapping additive schwarz preconditioner dolean et al 2015 smith et al 1996 here denoted by m as m as a 1 1 a 2 2 a p p in each cg or bi cgstab iteration called inner iteration the preconditioner is being applied once for cg and twice for bi cgstab and the system of the form m as y z has to be solved where y and z are denoted as typical search directions the benefit of the additive schwarz preconditioner is that this can be solved entirely in parallel where each processor solves a i i y i z i independently called the local subdomain solve since it turns out that this can be done inaccurately we apply an incomplete lu factorization with zero fill in ilu 0 using gaussian elimination where a i i lufor the non zero entries of a i i the subdomain solution is obtained by first solving for the lower triangular matrix l y z i and then for the upper triangular matrix u y i y convergence at the k th inner iteration is obtained for fpks by using the infinity norm y max i y i such that the stopping criteria x k x k 1 εhclose and b ax k εrclose are satisfied for sufficiently small values of εhclose m and εrclose kg m3 for tpks the criterium b ax k 2 εcclose b 2 should hold for euclidian norm y 2 i y i 2 1 2 for εcclose small enough the fpks and tpks algorithms are given by fig b1 and fig b2 that include pseudocode for indicating the mpi communication points parallelization of these method involves a local mpi point to point communication of vectors between subdomains prior to sparse matrix vector multiplication in order to account for the coupling coefficientsa i j i j near the subdomain interfaces b global collective mpi communication to determine global sums for inner products and global maxima for stopping criteria 
279,fresh groundwater reserves being of vital importance for more than a billion of people living in the coastal zone are being threatened by saltwater intrusion due to anthropogenic activities and climate change high resolution three dimensional 3d variable density vd groundwater flow and salt transport ft numerical models are increasingly being used to support water managers and decision makers in their strategic planning and measures for dealing with the problem of fresh water shortages however these computer models typically require long runtimes and large memory usage making them impractical to use without parallelization here we parallelize seawat and show that with our parallelization 3d vd ft modeling is now feasible for a wide range of hydrogeologists since a speedups of more than two orders of magnitude can be obtained as illustrated in this paper and b large 3d vd ft models are feasible with memory requirements far exceeding single machine memory keywords parallel computing distributed memory variable density groundwater flow salt transport numerical modelling seawat 1 introduction saltwater intrusion caused by anthropogenic activities and climate change threatens fresh groundwater reserves that are of vital importance for more than a billion of people living in the coastal zone neumann et al 2015 coastal unconsolidated groundwater systems are under pressure of salinization due to multiple threats that are related to climate change population increase and associated increase of freshwater demand and economic growth examples are land subsidence by excessive groundwater pumping minderhoud et al 2017 surface sealing by urbanization renaud et al 2013 climate induced relative sea level rise ferguson and gleeson 2012 oude essink et al 2010 seawater overwash by storm surges yang et al 2013 and changing patterns for groundwater recharge evaporation and groundwater seepage faneca s anchez et al 2012 to come up with strategies and measures to address these problems water managers and policy makers require accurate quantitative future projections at the highest resolution possible as a result high resolution three dimensional 3d groundwater flow and salt transport models become more and more important instruments to support water coastal management and policy development harbo et al 2011 unfortunately such models are generally very computational demanding since they often consist of many cells and many timesteps and are generally not capable of using the available computer resources efficiently it is important to note that the number of cells and timesteps are not only determined by the resolution required to capture features of interest but can also be directly imposed by the necessity to satisfy various numerical constraints oude essink 2003 short longitudinal dispersion lengths that are common in sedimentary basins such as the deltaic area of the netherlands might stress the grid péclet condition leading to small cell sizes and hence many cells furthermore the occurrence of large model groundwater flow velocities while satisfying the courant friedrichs lewy condition might result in small transport timesteps and hence many timesteps finally the large inertia of variable density groundwater flow systems makes that often large simulation times are needed to accurately estimate future groundwater salinities e g for paleo hydrogeological reconstruction of the fresh saline groundwater distribution delsman et al 2014 this makes transient variable density groundwater flow and salt transport simulations very computationally challenging distributed memory parallel computing see e g eijkhout et al 2015 is a commonly used practice to significantly reduce computing time and make large memory usage possible common distributed memory parallel computers use a non uniform memory access architecture numa in numa the entire computational grid memory is first distributed partitioned over multiple computer nodes each node having local main memory ram and each node consists of one or more multi core cpus processors then the problem is solved simultaneously by multiple cores while exchanging data through a fast interconnection network using the message passing interface mpi forum 1994 this is in contrast with shared memory parallel computing where each processor can only access the same memory of a single computer typically through openmp however parallel computers nowadays are heterogeneous systems with a mixed memory organization where memories are distributed across the nodes while multi core processors share memory within the same node or cpu solving the flow and salt transport equations in parallel typically means that after discretization consecutively one or more linear systems of equations need to be solved by e g a krylov subspace linear iterative solver such as the conjugate gradient method cg for symmetric positive definite matrices or the biconjugate gradient stabilized method bi cgstab for general matrices barrett et al 1995 accelerated by a suitable parallel preconditioner such as the additive schwarz block jacobi preconditioner or multigrid smith et al 1996 the focus in this paper is on parallelization of seawat langevin et al 2008 the most widely used public domain code developed by the u s geological survey for modeling 3d variable density groundwater flow and salt transport by coupling modflow harbaugh et al 2000 and mt3dms zheng and wang 1999 since seawat is based on modflow the worldwide leading code for groundwater modeling it largely benefits from the modflow ecosystem of a vast number of pre and post processing tools bakker et al 2016 and well documented graphics user interfaces waterloo hydrogeologic 2021 several proprietary codes claim to be suitable for modeling parallel 3d variable density groundwater flow such as tough jung et al 2018 pruess et al 2011 following a distributed memory approach using an additive schwarz preconditioned bi cgstab krylov solver from the aztec solver library elmroth et al 2001 hydrogeosphere using shared memory openmp hwang et al 2014 feflow diersch 2002 using the algebraic multi grid solver from the samg solver library and d3f schneider et al 2012 using the distributed memory multigrid solvers from the ug solver solver library lang and wittum 2005 as far as we know only for the latter d3f code parallel results were published for a 3d variable density groundwater model reporting a speedup of 282 on 512 computational cores for a saltdome problem having 66 million of unknowns lang and wittum 2005 modflow and mt3dms as standalone non coupled codes were parallelized by several researchers regarding modflow semi distributed memory parallelization was applied by schreuder 2005 where one parent process was set responsible for reading all model input data and scattering this data to the other worker processes as a linear parallel solver the additive schwarz preconditioned cg solver from the petsc library balay et al 2014 was applied cheng et al 2014 applied the algebraic multi grid preconditioned pcg solver from the jasmin library mo et al 2010 to speed up computations for a field flow problem located at yanming lake in china naff 2008 applied a semi distributed memory parallelization where he applied an additive schwarz preconditioned cg solver while keeping the matrix assembly and input output serial shared memory parallelization of modflow using openmp was done by dong and li 2009 parallelization of modflow using graphics processing units was done by hughes and white 2013 and ji et al 2014 regarding mt3dms shared memory parallelization using openmp was done by abdelaziz and le 2014 and huang et al 2018 to our knowledge we are the first to parallelize seawat the reason for parallelizing seawat is that we aim to push 3d groundwater flow and salt transport modeling to a next level for a large group of geohydrologists by making our code available as open source software as part of interactive modeling water quality software imod wq deltares 2020 also from that point of view we therefore believe that our code differs from proprietary codes like d3f lang and wittum 2005 our parallelization approach has a similarity with the parallelization of modflow done by schreuder 2005 and naff 2008 although there are significant differences first we have also parallellized salt transport computations hence mt3dms second compared to schreuder 2005 our physical overlap supports flexible rows of cells to account for the total variation diminishing tvd advection option our physical overlap also supports communication for evaluating the cross terms when using the full dispersion tensor option instead of lumping the cross terms to the righthand side second our parallellization approach is fully distributed and does not include any parent worker mechanism for scattering input data parallel output is supported and effcient parallel input can be used by grid wise direct access binary reads making our implementation more suitable in case of many varying stress input data and output comparing our work to all the above mentioned parallellelization efforts of modflow and mt3dms we believe that our fully distributed memory approach is the reason why we as far as we know are the first to report speedups for a very large model 100 million of active cells third our parallelization depends on the mpi software library only which is generally straightforward to use on cross platforms and can therefore be used by a wide range of hydrogeological modelers we developed a linear parallel unstuctured solver and do not make use of petsc solvers because at the time of development petsc was very hard to use by modelers using windows computers fourth our partioning differs in the way how it deals with irregular model boundaries where we apply the commonly used and more robust orthogonal recursive bisection partitioning berger and h bokhari 1987 it should be noted that regarding the salt transport advection scheme we did not parallelize the lagarangian method hence the method of characteristics particle tracking supporting this would likely require the implementation of dynamic load balancing of computational work involving re partitioning of moving particles in time and dynamically re mapping concentrations to the flow domain partitions since eulerian methods suffer from numerical dispersion oude essink and boekelman 1996 zheng and wang 1999 our parallelization might therefore be less applicable to problems requiring the simulation of sharp interfaces between fresh and saline groundwater 2 methods seawat langevin and guo 2006 uses modflow to solve the variable density groundwater flow equation see eq 3 in appendix a and mt3dms to solve the salt transport equation see eq 4 in appendix a coupled by the state equation see eq 6 in appendix a together with sufficient boundary and initial conditions both modflow and mt3dms apply a control volume finite difference or finite volume discretization on a structured grid and typically require multiple so called outer iterations picard linearization to reach convergence where in each outer iteration a linear system of equations is being solved using so called inner iterations distributed memory parallelization of seawat involves setting up the grid partitioning modifying the linear solver setting up the mpi communication and optimizing the input and output after setting the goals of the parallelization and how its performance is measured we will address each of these aspects of the parallelization method in the next sections 2 1 parallel performance measurement since hydrogeological modelers typically like to speed up their existing model by using the available processor cores we focus in our paper on obtaining strong parallel scalability measuring strong scaling means that the problem size is kept fixed while the number of processor cores being used increases this contrasts with weak parallel scalability where the problem size grows linearly with an increasing number of processor cores here we express the parallel performance in relative speedup sp t ref tp with t ref is the measured execution wall clock time for a reference configuration with p ref cores or mpi processes subdomains and tp is the measured execution runtime for an alternative configuration with p cores in case the reference time corresponds to a serial run then t ref t 1 in this definition of speedup we assume that all measurements are obtained by applying the same solvers and solver settings meaning that we do not seek for the fastest serial method and implementation for ideal strong parallel scalability the speedup equals s p ideal p p ref however in practice this is hard to obtain due to work load imbalance defined as i pmax p lp l where p is the total number of cores being used lp is the work load for core p and l the total work load partitioning primarily aims for obtaining a good load balance and secondary for minimizing the subdomain interface length edge cuts 2 2 subdomain partitioning partitioning or decomposing here refers to dividing the computational grid consisting of active cells into smaller grids partitions or subdomains see fig 1 for an example of partitioning a grid consisting of 16 columns n c 16 and 14 rows n r 14 into four partitions p 4 two methods are considered in this study a relatively straightforward method to obtain equally sized rectangular partitions here referred to as so called uniform partitioning and orthogonal recursive bisection orb partitioning partitioning is done in the horizontal plane only since for groundwater models the number of cells rows columns in the horizontal plane is usually significantly larger than the number of cells in the vertical dimension layers however this is simply an implementation choice and not a limitation of the method presented here this also holds for the implementation choice that each partition is uniquely assigned to one processor core mpi process hence we assume that the total number of subdomains equals the total number of processor cores moreover the partitioning is static and done only once as a pre processing step this neglects the spatio temporal variation in computing time that might occur during simulation causing load imbalance and hence a decrease in parallel performance since it turns out that for groundwater simulations most computing time is being spent in the linear solvers and in our model active cells remain active this seems to be a valid assumption for us however for models that have a highly varying stress input data or a highly changing spatial non linearity including cell rewetting dynamic partitioning might be more appropriate in addition our partitioning results in non overlapping rectangular partitions where the overlap is added after the partitioning without accounting for the work load for this study we assume that each active cell has the same weight furthermore we assume that flow and salt transport share the same partition this seems a valid assumption for us since for our models flow and salt transport always share the same model boundaries by this we do see any need to explicitly parallelize the coupling between the flow and salt transport computational domain therefore strongly simplifying implementation 2 2 1 uniform partitioning for regular rectangular grids so called uniform partitioning is a straightforward method for minimizing edge cuts hence the number of connections at the interface between the partitions while ignoring the work load that is typically defined by the active cells let n be the minimum of n c and n r from all possible combinations p p c p r where p c and p r are the number of blocks subdomains in column and row direction respectively that specific combination is selected such that p i max 1 n n c n r p 1 where i c when n n c or i r otherwise for the example of fig 1a process p1 clearly has the largest number of active cells 42 enclosed by red colored box and the load imbalance for the non overlapping uniform partitioning is i 4 42 100 1 68 2 2 2 orthogonal recursive bisection partitioning real world groundwater flow and salt transport models usually have irregular model boundaries e g following coastlines or watershed boundaries to define an area of interest this means that the computational load typically represented by the active cells can be scattered across the entire computational domain load balancing for such irregular boundaries is challenging and requires an appropriate partition strategy this was also observed by schreuder 2005 who developed an iterative partition method for a groundwater model with an irregular domain of the san luis valley colorado usa this method initially starts with a uniform partition and iteratively merges cell weighted rectangles and shifts interfaces to obtain sub optimal partitions however this method was found to be not sufficiently general or robust for general use schreuder 2005 as a more robust alternative method to account for irregular boundaries our partitioning supports orthogonal recursive bisection berger and h bokhari 1987 boman et al 2012 fox 1988 or briefly orb this commonly used divide and conquer partitioning method recursively bisects intermediate partitions perpendicular to their longest dimension k 0 times until p 2 k non overlapping equally loaded partitions are obtained for the example of fig 1b all the non overlapping partitions have the same load equal to 25 and hence there is no load imbalance in the originally proposed method berger and h bokhari 1987 the number of partitions can only be a power of two and therefore we modify this method to be applicable to general number of partitions p this is done by applying a prime factorization of p i 1 k f i where at each level i recursively fi parts of equal load are obtained by dividing along the longest dimension when fi 2 for all i the original orb method is obtained it should be noted that our orb implementation also includes the dirichlet boundary conditions or constant value active cells as in example fig 1b denoted by index 1 since these cells are eliminated in the linear system this means that a load imbalance might occur during linear solving although the orb partitioning could therefore be further optimized for these boundary conditions this was not a subject of this study 2 2 3 overlap and communication solving the variable density groundwater flow equation and salt transport equation in parallel requires that all necessary coefficients at subdomain interfaces should be available for the discretization and evaluation of the computational stencil for solving the variable density groundwater flow equation this means that interface coefficients such as the inter cell transmissivity should be known and matrix vector operations with the 7 point stencil across interfaces should be possible in parallel for solving the advection dispersion equation in parallel two downstream nodal concentrations should be available at interfaces when applying the third order tvd advection scheme using the ultimate limiter leonard 1988 zheng and wang 1999 furthermore when applying dispersion using the full tensor scheidegger 1961 all data near subdomain interfaces should be available for evaluating the dispersion cross terms for the 19 point stencil since we follow a distributed memory parallelization approach and data at subdomain interfaces typically depend on both processes sharing the interface data availability can be problematic to overcome these difficulties and to strongly simplify parallel implementation we introduce a so called physical overlap by specifying additional cells for the example in fig 1 denoted by the pink boxes these so called halo or ghost cells are used to automatically compute the correct coefficients at subdomain interfaces from shared input data without any communication or reconstruction necessary besides this using a physical overlap requires less modifications of the serial code in our parallelization each process is responsible for computing the groundwater heads and concentrations for the cells in the non overlapping partition exclusively this means that for the additional halo cells only copies of computed heads and concentrations are stored that are received from neighboring processes hence besides synchronized heads and concentrations halo cells are similar to other non halo cells synchronization is done by local point to point mpi communication this synchronization is typically done after the linear krylov solver has finished in which halo cells are used to synchronize search directions at each inner iteration to account for matrix vector products involving the computational stencil across the subdomain boundaries for this purpose we use a data structure that is arranged in communication bands each band has sending cells corresponding to cells where the associated process is responsible for and receiving cells corresponding to the halo cells where data from adjacent processes are being received fig 1 illustrates this for the case of two bands corresponding to an overlap of two rows that is required for the tvd advection scheme for the uniform partitioning in of fig 1a process p1 has local communication with neighbors p2 and p3 considering the first band p1 sends computed values to p2 from column 8 and rows 1 8 light green and receives computed value from p1 in the halo cells of column 9 rows 1 8 dark green note that almost half of these cells are inactive and have a user defined no data value nevertheless in the chosen implementation these inactive cells are also communicated and are therefore redundant when dispersion is applied accounting for the full tensor p1 also needs to communicate with p4 in that case cell 71 and cells 72 77 and 78 are also part of the halo cells for band 1 and 2 respectively it should be noted that although our code has the flexibility to perform a point to point communication for only the outer band in this study we always communicate for all bands at the same time this means that when tvd is applied local communication within the linear solver is for two bands although only values from the first band are used furthermore as can be seen in fig 1b orb partitioning results in more local communication than uniform partitioning since p2 has at least three neighbors p1 p3 and p4 this additional communication is the trade off for obtaining optimal load balance besides local point to point communication global collective mpi communication is required this is mainly required within the linear krylov solver for computing inner vector vector products and evaluating global grid maxima global communication is also necessary for synchronizing the salt transport timestep length global grid minimum accumulating volumetric or mass budgets for output or gathering observation wells for output in general global communication is more expensive than local communication since this type of communication requires a synchronization point involving all processes for example computing an inner vector vector product value that necessarily needs to be available for each process prior to continuing to the next linear iteration means that each process first needs to compute its partial sum before synchronizing then sends this value to all other processes and each process performs the addition global mpi communication strongly depends on the number of nodes used and the interconnection network characteristics such as diameter and latency delay in this study we mainly focus on relatively coarse grained parallelization many cells per subdomain using fast interconnection networks having a low latency and high bandwidth coarse grained means that the computational time that can be directly related to partition size is large compared to the total execution time we therefore may neglect actual communication times spent on local and global communication by this we assume that communication overhead is exclusively the result of wait states i e periods where processes sit idle at synchronization points that can directly be related to load imbalance böhme 2013 2 3 linear parallel krylov solver the linear systems are solved by preconditioned krylov subspace acceleration see e g barrett et al 1995 for solving groundwater flow the preconditioned cg method is used and for solving salt transport the preconditioned bi cgstab method within these methods the one level additive schwarz preconditioner dolean et al 2015 smith et al 1996 is taken corresponding to the block matrix diagonal see appendix b for more details our implementation in seawat called the parallel krylov solver pks corresponds to a double precision unstructured grid solver that is largely based on the pcgu solver from modflow usg hughes and white 2013 commonly used krylov subspace methods within seawat are the pcg solver for modflow hill 1990 and the compulsory generalized conjugate gradient gcg 1 1 note the gcg solver being used in seawat is also preconditioned but this is omitted in the acronym solver for mt3dms zheng and wang 1999 in the remainder of this paper we will sometimes refer to those linear solvers as default seawat solvers our pks has the same termination criteria as the pcg and gcg solvers hence for flow the infinity norm is used to declare converge of the linear iterates if the maximum absolute head differences are εhclose m and the maximum absolute head residuals are εrclose kg day for sufficient small values of εhclose m and εrclose kg day for salt transport the relative stopping criteria in the euclidian norm is used for the concentrations satisfying small values of εcclose for the remainder of this paper we refer to the additive schwarz preconditioned cg solver for solving flow as the flow pks fpks and the additive schwarz preconditioned bi cgstab solver for solving salt transport as the transport pks tpks for both methods respectively the algorithms are given by fig b1 and fig b2 in appendix b that include pseudocode for indicating the mpi communication points 2 4 input and output our parallelized code as part of imod wq supports all ascii and binary grid input data from standard seawat in a serial manner meaning that each process first needs to read the entire grid data into memory prior to clipping the data to its partition since this is not a scalable operation such input mechanism might have negative effects on the parallel performance for transient simulations requiring many stress period input data as a more scalable alternative imod data files idfs vermeulen et al 2019 are supported where each process directly reads its local grid data exclusively by applying direct access binary reads standard seawat column data input for stress packages e g for river boundary conditions are read in parallel by selectively reading only for cells that belong to the overlapping partition as a more scalable option we also support stress package input using idfs by reading all parameters as grids output is done in a straightforward parallel manner where each process uniquely writes its partition output e g binary groundwater heads and concentrations besides standard seawat files and idfs we support parallel vtk output files that can directly be visualized by graphical user interfaces such as paraview and tecplot furthermore we extended the seawat code by adding a pre processing routine for setting up an entire seawat model with a single key word driven run file that is easy to use and allows hydrogeological modelers to specify macros for efficiently setting up models consisting of many layers and stress periods 3 test cases 3 1 test case 1 henry 3d model solving the henry saltwater intrusion problem henry 1964 is a well known benchmark for variable density groundwater flow and salt transport simulation codes the henry test case considered here see fig 2 depends on the three dimensionless parameters a q in k fεd comparing viscous and buoyancy forces b d m q in comparing diffusive and advective salt fluxes and aspect ratio ξ l d for our test we take a 0 263 b 0 1 and ξ 2 corresponding to what henry evaluated semi analytically and similar values as taken by langevin et al 2008 to make the problem computationally challenging for parallel computing we expand the original 2d geometry to 3d by taking 2 units m in the y direction perpendicular to the xz plane hence specifying q in 11 405 m3 day however by doing this the flow and salt transport remains 2d in the xz plane for this test case δx δy 0 002m is taken and δz 0 01m resulting in 100 million active computational cells 1000 columns 1000 rows 100 layers the cell centered finite difference scheme is taken for advection and for dispersion all cross terms are lumped to the righthand side coupling between flow and salt transport is chosen to be explicit for the fpks the chosen stopping criteria are εhclose 1 0 10 8 m and εrclose 1 0 10 5 kg day for the tpks εcclose 1 0 10 7 since the flow problem is linear in each time step a maximum number of inner iterations 2500 for both linear solvers are taken such that convergence is achieved after one single outer iteration for this test case a maximum of 1024 cores are taken considering a uniform partitioning the number of subdomains in x and y direction is 1 2 4 6 8 10 14 16 24 and 32 and a single subdomain in z direction hence using 1024 cores this corresponds to a xyz decomposition of 32 32 1 since for this test case it is assumed that there is no flow in y direction this means that the domain decomposition in x direction contributes directly to the linear solver iterations and the decomposition in y direction corresponds to data decomposition only all the grid input data for this test case are specified as binary idf files vermeulen et al 2019 3 2 test case 2 sand engine model in 2011 a large sand nourishment of approximately 20 million m3 was placed along the dutch coastline between hook of holland and the hague for testing its protective efficacy against long term climate change effects such as sea level rise and storm surges mulder and tonnon 2011 stive et al 2013 as part of this sand engine pilot project a seawat model was developed huizer et al 2016 here referred to as sand engine model for assessing the effects of long term morphological evolution of the sand replenishment on the local groundwater system and the existing fresh groundwater resources this calibrated seawat model computes both variable density groundwater flow and salt transport in 3d using 50 model layers 234 rows 234 columns having a uniform horizontal cell size of 50 m with a varying layer thickness of 1 to 10 m covering a total model area of 11 7 km2 the molecular diffusion coefficient used is 10 9m2 s the longitudinal dispersivity used is 0 2 m with a ratio of transversal to longitudinal dispersivity of 0 02 the model computes total dissolved solutes tds values with seawater density of ρs 1020 kg m3 and concentration c s 28 kg m3 that is lower than the average salinity of the north sea due to a freshening by the river rhine the chloride concentrations are obtained afterwards by multiplying the computed tds values by a factor of 0 55 in this paper we consider a realistic test case version of the sand engine model having a higher horizontal resolution of 25 m and simulating half a year using daily timesteps july till december 2011 having 25 m cells this test case consists of a total of 4 733 797 active cells 50 layers 468 rows 468 columns the tvd scheme and cell centered discretization is used for advection and for dispersion all cross terms are lumped to the righthand side coupling between flow and salt transport is chosen to be explicit for solving groundwater flow the fpks criteria are εhclose 1 0 10 6 m and εrclose 0 1 kg day setting 2500 as a maximum number of linear solver iterations for solving salt transport εcclose 0 1 is taken for the tpks with a maximum of 50 iterations an initial timestep of 1 0 10 3 days is taken and a total of 186 transport timesteps are required to finish the simulation for this test case a maximum of 256 subdomains are used generated by orb partitioning cell weights are defined as the sum of active cells in z direction see fig 3 all the grid input data for this test case are specified as standard seawat ascii data 3 3 hardware and compiler the parallel performance of both test cases is evaluated on the cartesius dutch national supercomputer surfsara 2014 at the time of writing this machine has 1913 numa nodes connected by a fast infiniband interconnection network in a fat tree topology summing up to a total of 47 776 intel xeon cpu cores and 128 tb ram memory all our experiments are done on so called haswell thin nodes where each node has 64 gb ram memory and two intel xeon e5 2690 v3 12 core processors and each cpu has its own socket and four channels to main memory we use a maximum of four cores per thin node two cores per cpu since this value generally results in lowest wall clock times this is based on our experiences on cartesius and a variation of cores per node for a fixed number of cores considering our test cases this means that during computation at least 20 cores are idle and therefore the core utilization is low 17 non idle the reason why using more cores per cpu results in an increase in run times is very likely related to the large memory usage of our models and the competition of multiple cores within a multi core cpu for the main memory bandwidth through the caches tudor et al 2011 this seems a hardware related issue inherent to multi core numa architectures and not a direct result from our parallelization approach and therefore further research on core utilization is kept outside the scope of this study nevertheless first observation for the largest henry 3d case indicate that run times can increase 15 when using four cores per cpu 33 non idle and 100 when using all 12 cores per cpu although hybrid mpi openmp parallelization could possibly be a good approach to increase core utilization previous experiments with modflow did not show significant improvement verkaik et al 2015 furthermore for each core configuration two runs are executed and the minimum of wall clock times is taken to exclude hardware variation e g due to cpu throttling or network related issues we compiled imod wq on cartesius using the intel fortran compiler v15 0 0 using high level o3 optimization linked with the intel mpi library v5 0 update 3 we used mixed real precision compilation meaning that variables of type real used in the code can have single precision accuracy 4 bytes or double precision accuracy 8 bytes this contrasts with the usgs provided seawat binary that was compiled such that each real variable corresponds to a double precision accuracy compiler flags real size 64 align dcommons the reasons for not doing this explicitly are the incompatibility with the imod library that requires mixed precision and the increasing memory usage that double precision usage involves however mixed real precision might result in instability due to rounding errors with seawat although none of this behavior is observed for the test cases considered in this paper 4 results 4 1 henry 3d test case fig 4 a shows the results for running the henry 3d test case on the cartesius supercomputer up to 1024 cores using the pks the speedups are presented as relative values to two cores p ref 2 since the serial run requires more memory 96 gb than available on a single thin node 64 gb maximum because of this we take two thin nodes for evaluating the speedup with two cores using 1024 cores a maximum relative speedup of 140 is obtained to estimate the value of the absolute speedup a smaller run using 10 layers is compared on both a thin and so called fat node that has more memory 256 gb but a slower cpu 2 7 ghz intel xeon e5 4650 estimating that the fat node is 1 13 times slower the serial execution time on a thin node is estimated to be 16 hours 57 minutes 47 seconds hence estimating the speedup with two cores to be s 2 1 78 this estimates the absolute speedup with 1024 cores to be 140 1 78 249 fig 4b shows the total number of linear iterations hence accumulated over all outer iterations it can be clearly seen that the total number of linear solver iterations increases with the number of processor cores used for the fpks iterations considering flow this is a factor 3 for the tpks iterations considering salt transport this is a factor 3 7 the accuracy of the pks is verified against the combined pcg flow and gcg transport solvers for a sample configuration of 144 cores see fig 5 for the computed differences in isochlors 4 2 sand engine test case fig 6 a shows the measured speedups and fig 6b the linear solver iterations for running the sand engine test case on cartesius up to 256 cores p ref 1 using 256 cores a speedup of 86 is obtained while the linear fpks iterations for flow increased with a factor 1 7 compared to the serial run the linear tpks iterations for salt transport remain constant at a value of 372 for 256 cores using the pks fig 7 a and c show the computed groundwater table and concentrations at the last time step respectively and differences serial parallel compared to the serial run with the pcg and gcg solvers in fig 7b and d accordingly for the head differences the minimum maximum and average values are 3 14 10 5 m 1 24 10 5 m and 2 41 10 6 m respectively for the concentrations those values are 5 40 10 3 mg l 7 34 10 3 mg l and 2 41 10 6 mg l respectively 5 discussion the results show that significant speedups are obtained figs 4a and 6a up to two orders of magnitude for the henry 3d test case and for both test cases there is a strong linear solver iteration increase figs 4b and 6b for an increasing number of processor cores however surprisingly this iteration increase does not hold for the sand engine transport iterations that remain constant see fig 6b the reason for this might be found in the small mechanical dispersion used in the sand engine test case implying highly advection dominated flow and salt transport that therefore does not heavily strain the linear salt transport solver it can be seen in figs 4a and 6a that for an increasing number of cores the speedup curves tend to deviate more from ideal speedups and therefore our parallelization becomes less scalable see section 2 1 we analyze this behavior by using scalasca code profiling tools geimer et al 2010 to identify the main non scalable components of the code this is done by analyzing the component cost c p c p t p c for a component c in relation to the total cost cp ptp fig 8 a and c show c p c c ref for the henry 3d test case c ref c 2 2t 2 and sand engine test case c ref t 1 respectively in fig 8b and d values for c p c c p are plotted for the henry test case and sand engine test case respectively showing the portion of work for a certain component relative to the total execution time in the ideal case perfect strong scaling or cost optimality is achieved if for all or at least for the most dominant components c p c c ref remains constant for an increasing number of cores however as can be seen in fig 8a and c this is not the case the linear solver execution times are the main non scalable components that increase with the number of processes see fpks and tpks in fig 8a and c the reason for this is the linear solver iteration increase see figs 4b and 6b that can likely be explained from mathematics by the presence of low frequency eigenmodes induced by the domain decomposition in the dominant flow direction hampering the linear solver convergence dolean et al 2015 smith et al 1996 this is a known problem see e g hammond et al 2014 and our solver convergence can likely be improved by combining the additive schwarz preconditioner with a multi level preconditioner such as the additive coarse grid correction preconditioner the henry case would likely benefit most from applying such preconditioner since up to 256 cores the portion of work spend in the linear solver remains constant at about 80 see in fig 8b by adding for fpks and tpks we can estimate a theoretical upper bound for the speedup by assuming no iteration increase as shown in fig 9 the speedups are estimated by using the linear iteration time computation and mpi cost of 5 and 9 seconds using 2 cores for fpks and tpks respectively and reducing the total execution time linearly with the iteration increase while neglecting any additional work introduced by multi level preconditioning by doing this almost perfect scalability can be achieved up to 256 cores correcting for iteration loss we estimate s 256 602 which is big improvement of a factor 2 4 this more or less fine tuning of our parallelization is recommended for future research considering the henry test case load imbalance occurs when using more than 256 cores this can be seen in fig 8b by the downward trend of the linear solver computation time and upward trend of mpi communication time load imbalance is likely to be caused by the physical overlap that is added after the partitioning see section 2 2 for the henry case this is one additional row for interfacing with a neighboring subdomain since we are using finite difference advection this means that the amount of total work will increase e g the time spend on matrix assembly for dispersion see the slightly upward trend of t mat assembly in fig 8a starting from 256 cores although the linear solvers are mathematically strict non overlapping we also expect that the linear solver is responsible for a certain part of the load imbalance because all do loops in our code are defined over all the cells including the overlap the reason why larger speedups are obtained for the henry test case fig 6a than for the sand engine test case fig 7a might be directly related to the partition sizes and hence the grain sizes for each core configuration the number of active cells for each partition is about 21 times larger for the henry test case than for the sand engine test case making the parallelization coarser grained considering 256 cores the speedup for the sand engine model of 86 19 5k active cells per subdomain is smaller than the estimated speedup of 119 66 6 1 78 see section 4 1 for the henry test case 390k active cells per partition as long as the computational time remains dominant one should only have to focus on parallelizing computation which is generally relatively straightforward to do in order to obtain strong scaling as we have illustrated for the iteration increase the effect of the finer grained parallelization for the sand engine can be seen in fig 8c where the mpi curves grow faster than the linear solver iteration computational time indicating load imbalance furthermore for the sand engine test case i o becomes dominant taking 27 of the total execution time when using 256 cores the non scalability of i o for the sand engine test case can be explained by the usage of standard seawat input data that does not scale in parallel see section 2 4 we expect to improve this by using imod binary data files idfs exclusively for this model in the future since the sand engine test case is relatively fine grained analysis of constant iteration increase did not show any significant improvement in speedups because of the load imbalance and i o overhead as a rule of thumb for users one can say that our parallelization is most suitable for relatively larger models 105 active cells per partition lesser suitable for relatively smaller models 104 105 of active cells per partition and not suitable for very small models 104 of active cells per partition although highest speedups are to be expected for relatively larger models like the henry 3d test case still significant although less efficient speedups can be obtained when a sufficient number of processor cores is available as illustrated by the sand engine test case from our modeling experiences we believe that our pks computes sufficiently accurate heads and concentrations that have comparable accuracy compared to the default pcg and gcg solvers in seawat nevertheless from a numerical point of view a hydrogeological modeler should be aware that small differences might occur this is also the case for the sand engine test case see fig 7 where the observed maximum absolute head difference of 3 14 10 5 m for the top view layer with active cells is larger than εhclose 1 0 10 6 as well as for the henry test case where small differences occur for the 99 isochlors see fig 5 focusing on the sand engine test case we also observe that at the final timestep some computational cells have higher absolute maximum differences 3 04 10 4 m for head and 4 84 10 1 kg m3 tds than the solver stopping criteria although we did not find motivations for doing an extensive accuracy analysis we suspect that the reasons for these small differences that accumulate during simulation time are likely to be related to differences in solver methods rounding errors due to finite precision arithmetic and perhaps too aggressive compiler optimization the preconditioner used in the pks ilu 0 differs from the one used within the pcg solver modified incomplete cholesky preconditioner and the one used within the gcg solver symmetric successive over relaxation furthermore the fpks used the bi cgstab krylov method while the gcg solver uses lanczos orthomin these differences in solver methods might result in differences in accuracy after solving the linear systems for flow and salt transport furthermore mathematically seen for each different core configuration a different additive schwarz preconditioner is applied with the pks hence resulting in different convergence behavior moreover different core configurations result in different finite precision rounded arithmetic e g for the computing of inner product coefficient within the cg algorithm by adding partial sums that are computed by each core simultaneously in addition the tpks has double precision accuracy while the gcg solver has single precision accuracy meaning that in our applications using the gcg solver might introduce small rounding errors table 1 shows the root mean square error rmse measured over all daily timesteps and cells of the sand engine test case comparing the pks fpks tpks for 256 cores with different serial solver configurations default seawat solvers pcg gcg fpks tpks pcg tpks and fpks gcg the rmse values show that the main difference between the pks using 256 cores and the default seawat solvers see also fig 7 is caused by the difference between the gcg solver and the tpks this is very likely related to differences in solver methods or finite precision arithmetic 6 conclusions and recommendations a parallel version of seawat modflow mt3dms for simulating 3d variable density groundwater flow and salt transport is developed as part of imod wq in this paper we showed that our parallel implementation is capable of significantly reducing computing times up to two orders of magnitude and capable of running models with very large memory requirements our parallelization differs from other modflow and mt3dms parallelization efforts done by other researchers in a way that a salt transport is parallelized using a physical overlap to account for e g tvd advection b our approach fully distributes memory including parallel input output c we apply the robust orthogonal recursive bisection partitioning method to address irregular model boundaries since our parallelization is easy to use and open source we expect that our parallelization may lead to new scientific advancement in the field of groundwater flow and salt transport modeling where ultimately huge 3d problems having billion of cells can be solved with thousands of cores therefore we believe that our work can be an asset for water managers and decision makers in coastal areas in a way that it helps to provide them with high resolution estimates and future projections of the groundwater salinity distribution and fresh groundwater reserves although our reported speedups are high there is still room for future improvement first our parallelization may be improved by reducing the linear solver iteration increase by applying a suitable parallel multi level preconditioner second load balancing might by further optimized by explicitly considering the weights of the physical overlap during the partitioning phase third our implementation should be further analyzed on different hardware and multi core cpu configurations with the aim of improving processor core utilization we expect that in the future multi core cpus having more and more cores will become more efficient for memory bound problems such as the latest generation amd epyc zen cpus and result in improved speedup and better core utilization for 3d variable density groundwater flow and salt transport modeling credit authorship contribution statement j verkaik conceptualization methodology software validation investigation resources data curation writing original draft writing review editing j van engelen resources writing review editing s huizer methodology writing review editing m f p bierkens conceptualization writing review editing h x lin conceptualization writing review editing g h p oude essink conceptualization writing review editing declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgements we thank christian d langevin and joseph d hughes for their suggestions and comments on parallelization seawat we also thank deltares and utrecht university for making this research possible this work was part of the development of imod wq https oss deltares nl nl web imod and we thank gijs janssen for his support furthermore we thank edwin sutanudjaja and martijn russcher for their support on running jobs on cartesius all experiments were carried out on the dutch national e infrastructure with the support of the surf cooperative the authors also would like to thank the editor and two anonymous reviewers for their valuable comments and suggestions a governing equations for variable density groundwater flow and salt transport conservation of fluid mass can be expressed by the continuity equation see e g in bear 1979 1 θ ρ t ρ q ρ ss q ss 0 with θ the effective porosity ρ kg m3 the groundwater density q m day the specific discharge or darcy velocity vector ρss kg m3 and q ss 1 day the fluid density and flow rate from the sinks and sources respectively following the notation of guo and langevin 2002 conservation of momentum can be expressed by darcy s law neglecting viscosity effects for sake of simplicity 2 q k f h f ρ ρ f ρ f z where k f m day is the hydraulic conductivity tensor for saturated fresh groundwater h f m the to be solved fresh groundwater head ρf kg m3 the freshwater density typically 1000 kg m3 and z m the elevation assuming isothermal conditions expanding θρ t and substituting 2 eq 1 can be written as 3 ρ s f h f t ρ k f h f ρ ρ f ρ f z θ ρ c c t ρ ss q ss 0 where s f 1 day is the specific storage for fresh groundwater and c kg m3 is the salt e g chloride concentration to be solved this equation is known as the variable density groundwater flow equation vdgfe which reduces to the ordinary constant density groundwater flow equation when ρ ρss ρf neglecting chemical reactions assuming that diffusive and dispersive salt transport are based on fick s law assuming single species conservation of salt can be expressed by the governing advection dispersion equation 4 θ c t q c θ d c q ss c ss 0 where c ss kg m3 is the concentration for sink and sources and d m2 day the hydrodynamic dispersion tensor with coefficients for incorporating mechanical dispersion and molecular diffusion this equation can be expressed as 5 d i j α t θ q 2 d m δ i j α l α t θ q i q j q 2 where αl m and αt m are the and longitudinal and transversal dispersivities respectively d m m2 day the effective molecular diffusion coefficient and δ ij denotes the kronecker delta eq 4 is also known as the salt transport equation ste see zheng and wang 1999 since with the variable density groundwater flow eq 3 and salt transport eq 4 we have three unknowns hf ρ and c an additional equation of state is required neglecting other density effects due to temperature and pressure we can use the linear relation 6 ρ c ρ f ρ c c ρ f ρ s ρ f c s c where ρs kg m3 and c s kg m3 are the density and salt concentration of seawater respectively typical values for seawater are ρs 1025 kg m3 and c s 35 kg m3 of total dissolved solutes simplifying eq 6 to ρ c 1000 0 7143c b parallel linear solver algorithms for flow and salt transport finite volume discretization of the vdgfe eq 3 and ste eq 4 excluding advection results in after picard linearization and eliminating the dirichlet boundary constant value conditions the linear equation 7 a f t x f t b f t where subscript f here denotes flow and subscript t denotes transport for solving the flow equation x f m is the vector of unknown fresh water heads a f kg m day a square symmetric positive definite coefficient matrix with the hydraulic cell by cell conductivity times the density and b f kg day the vector with groundwater sink source and storage terms the corresponding computational stencil is 7 point hence a f has 7 bands for solving the transport equation x t kg m3 is the vector of unknown salt concentrations a t m3 day represents the discretization of dispersion sink source and is generally a nonsymmetric matrix and b t kg day is the vector with sink source terms when full tensor dispersion is used this will result in a 19 point stencil however in our study we assume that all dispersion cross terms are lumped to the right hand side vector resulting in a t to have 7 bands like a f for the preconditioned cg method fpks the symmetrized preconditioned system 8 m 1 2 a f m 1 2 m 1 2 x f m 1 2 b f m 1 2 m 1 2 m 1 is solved and for the preconditioned bi cgstab tpks the left preconditioned system 9 m 1 a t x t m 1 b t where the matrix m is the preconditioner barrett et al 1995 using block wise natural node ordering for the non overlapping partitions as illustrated by the positive numbering in fig 1 the matrix a can be written as a block matrix of the form 10 a 1 1 a 1 2 a 1 p a 2 1 a 2 2 a p 1 a p p where a ii correspond to the interior node coefficients and a i j i j to the coupling coefficients between the subdomains considering a 7 point computational stencil and a single band for the uniform partitioning example in fig 1a then block matrix 10 has 4 4 blocks p 4 and for the first subdomain p1 the interior coefficient sub matrix a 1 1 has dimension 37 37 local coupling sub matrix a 1 2 contains two non zero entries 33 38 37 39 and a 1 3 four non zero entries 34 44 35 45 36 46 37 47 and a 1 4 note that in a distributed memory parallel setting block matrix 10 is never been formed explicitly since each processor only has local coefficients corresponding to a block row of this system taking m as the block diagonal matrix of aresults in the non overlapping additive schwarz preconditioner dolean et al 2015 smith et al 1996 here denoted by m as m as a 1 1 a 2 2 a p p in each cg or bi cgstab iteration called inner iteration the preconditioner is being applied once for cg and twice for bi cgstab and the system of the form m as y z has to be solved where y and z are denoted as typical search directions the benefit of the additive schwarz preconditioner is that this can be solved entirely in parallel where each processor solves a i i y i z i independently called the local subdomain solve since it turns out that this can be done inaccurately we apply an incomplete lu factorization with zero fill in ilu 0 using gaussian elimination where a i i lufor the non zero entries of a i i the subdomain solution is obtained by first solving for the lower triangular matrix l y z i and then for the upper triangular matrix u y i y convergence at the k th inner iteration is obtained for fpks by using the infinity norm y max i y i such that the stopping criteria x k x k 1 εhclose and b ax k εrclose are satisfied for sufficiently small values of εhclose m and εrclose kg m3 for tpks the criterium b ax k 2 εcclose b 2 should hold for euclidian norm y 2 i y i 2 1 2 for εcclose small enough the fpks and tpks algorithms are given by fig b1 and fig b2 that include pseudocode for indicating the mpi communication points parallelization of these method involves a local mpi point to point communication of vectors between subdomains prior to sparse matrix vector multiplication in order to account for the coupling coefficientsa i j i j near the subdomain interfaces b global collective mpi communication to determine global sums for inner products and global maxima for stopping criteria 
