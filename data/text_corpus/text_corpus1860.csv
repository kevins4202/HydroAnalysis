index,text
9300,rice is unique in that yields are maximized when it is grown under ponded or flooded conditions this however has implications for water use an important consideration in water scarce environments and greenhouse gas emissions this work aimed to provide precise predictions of the date when irrigated rice fields were ponded on a per field basis models were developed using sentinel 2 data with the advantage of inclusion of water sensitive shortwave infrared bands and planet fusion data which provides daily temporally consistent cross calibrated gap free data models were trained with data from both commercial farms and research sites in new south wales australia and over four growing seasons harvest in 2018 2021 predictions were tested on the 2022 harvest season which included a variety of sowing and water management strategies a time series method was developed to provide models with features including satellite observations from before and after the date being classified as ponded or non ponded logistic regression models using time series features produced mean absolute errors for ponding date prediction of 4 9 days using sentinel 2 data and 4 3 days using planet fusion data the temporal frequency of the planet fusion data compensated for the lack of spectral bands relative to sentinel 2 keywords rice irrigation management remote sensing time series logistic regression data availability the data that has been used is confidential 1 introduction globally rice is one of the most important staple food crops and around 75 of production is from irrigated environments chauhan et al 2017 yields are optimized when rice is grown in ponded flooded conditions bouman et al 2007 however water scarcity is an increasing pressure on rice production which has motivated research on optimizing the trade off between yield and water use non ponded growing systems include aerobic nie et al 2012 and alternate wetting and drying awd carrijo et al 2017 rice water management strategies also impact ecology and birdlife herring et al 2021 ranghetti and boschetti 2022 and greenhouse gas emissions linquist et al 2015 these factors drive demand for systems that can determine rice water management across growing regions and track changes in farmer practices over time ranghetti and boschetti 2022 ponding for at least some of the growing season remains the dominant practice due to improved yields and other agronomic factors such as weed control bouman et al 2007 ponding however incurs a penalty on water use due to non productive water loss from soil drainage and evaporation soil drainage may be ameliorated through using only fields with non leaky soils and puddling humphreys et al 2006 evaporation can be reduced by minimizing the duration of ponding particularly during the early growth stages when canopy coverage is not complete and thus evaporative losses are higher some hybrid systems seek to minimize the ponding period restricting it to critical growth phases bouman and tuong 2001 in australia the delayed permanent water dpw system involves drill sowing rice into dry soil after which a number of flush irrigations are applied during early growth stages to meet crop water demand rice fields are flooded before the microspore growth stage which is particularly important in temperate growing regions as the water provides a temprature buffer to reduce yield penalties due to cold induced sterility dunn and gaydon 2011 rice water management also affects phenology with growth accelerating after ponding tools that predict rice growth stage are significantly more accurate when the underlying models factor in not only planting date but also ponding date darbyshire et al 2019 these factors motivate the development of industry wide monitoring systems that can accurately determine per field water application dates such systems will facilitate assessment of the adoption of water saving practice such as delayed ponding and will improve accuracy of growth stage prediction tools remote sensing provides data at the scale and frequency necessary for the development of such systems busetto et al 2017 nelson et al 2014 ranghetti and boschetti 2022 synthetic aperture radar sar data has shown promise for mapping rice area torbick et al 2017 and phenology inoue et al 2014 one of the key advantages of sar data are its low sensitivity to cloud cover making it particularly crucial for use in frequently cloudy regions such as the tropics some work thorp and drajat 2021 has fused sar with optical data which slightly improved classification of phenology over using optical data alone which in turn provided better results than using sar data alone guo et al 2019 similarly combined sar and optical data to map rice in australia particularly focusing on ameliorating the challenge of reduced water signature when ponding is only applied after significant canopy coverage has been achieved however sentinel 1 revisit over much of the rice growing area of new south wales australia is 12 days which is not sufficient for accurately determining the precise date of ponding rice field monitoring products based on optical satellite data have also been developed boschetti et al 2017 ranghetti et al 2018 modis data are daily but at very limited resolution of 250 m red and near infrared only or 500 m landsat has 30 m resolution and an archive of more than 30 years with 16 day revisit or 8 days with two satellites the recent sentinel 2 satellites provide 10 20 or 60 m resolution depending on band and revisit from 3 to 7 days li and roy 2017 these all provide the shortwave infrared swir bands which are sensitive to water brinkhoff et al 2022 important for rice because of the ponded environment boschetti et al 2014 a recent development is near daily imagery at 3 m resolution such as from the planet dove cubesat constellation this data source does have limitations particularly the lack of swir bands and challenges associated with cross calibration between the many 150 sensors in orbit planet fusion planet fusion team 2021 constitutes a comprehensive harmonization and fusion methodology based on the cubesat enabled spatio temporal enhancement method cestem houborg and mccabe 2018a which effectively resolves cross calibration and sensor interoperability issues by calibrating the cubesat sensors against a deep stack of sentinel 2 and landsat 8 surface reflectance imagery whilst simultaneously filling gaps due to cloud and missing observations thus providing a daily calibrated dataset much previous work has been devoted to rice field mapping torbick et al 2017 guo et al 2019 niel and mcvicar 2003 stroppiana et al 2019 these exploit the distinctive water features of rice crops to distinguish them from other crops whilst some of these provide coarse estimates of ponding or start of season xiao et al 2022 few studies have attempted to determine the precise dates that ponded water was applied which requires field level observations across regions and years to train models accurate ponding date predictions are needed for phenology prediction tools darbyshire et al 2019 water use assessments qiu et al 2021 and water management practice monitoring through time we aim to develop a methodology to detect the date of ponding of rice fields across an entire growing region where a diverse range of water management practices are adopted aerial and dry broadcast sowing with early ponding drill sowing with flush irrigations and various delays before ponding we compare predictions using sentinel 2 s2 imagery with its advantage of measuring reflectance in the swir wavelengths to planet fusion pf imagery with its advantages of high spatio temporal consistency and daily image frequency we compare simple reflectance threshold based models with machine learning models and assess the error of ponding date prediction for each method the developed methods will provide improved data to the rice industry facilitating improved phenological predictions and assessing the growth in adoption of water saving practices 2 methods 2 1 location and study sites this study was based in the irrigated rice growing regions of new south wales australia fig 1 showing irrigation areas obtained from australian bureau of agriculture and resource economics and sciences 2022 the climate is temperate allowing production of one crop per year crops are sown in late spring typically october flowering occurs in mid summer january and harvest is in autumn april or may there are a variety of sowing and water management practices adopted in the area ward et al 2021 which are illustrated in fig 2 traditional methods include dry broadcast db where fields are ponded soon after seed distribution and aerial sowing ponding immediately before spreading pre germinated seed into the water recently drill sowing has been widely adopted because of its water saving benefits seed is drilled into dry soil then a number of intermittent irrigations are applied before ponding at around the three leaf vegetative growth stage dunn and gaydon 2011 typically late november delayed permanent water dpw dunn and gaydon 2011 further delays ponding until late december just before the panicle initiation growth phase water management strategies that eliminate a period of continuous ponding altogether such as alternate wetting and drying carrijo et al 2017 are not standard practice in the study area dunn et al 2014 fields are drained around physiological maturity late march or early april and dried for harvest ward et al 2021 the study locations included 182 fields and five harvest years 2018 2022 fig 3 note that throughout this paper year refers to the year of harvest rather than the planting year planting in australia occurs the year before harvest i e planting in october harvest in april we define day of season dos as the days since 1 july of the year prior to harvest corresponding approximately to day of year in the northern hemisphere the fields were distributed across a commercial site used for research and seed production two field research stations and numerous commercial farms fig 1 for each field the ponding date was recorded 2019 and 2020 were drought years australian government bureau of meteorology 2019 resulting in much less rice grown overall australian bureau of statistics 2020 and so less field observations were available in those years fig 3 the study period thus includes dry and wet seasons reflective of the variability in water availability typical of the system we used 2018 2021 data for training then tested models on the 2022 data unfortunately there were no db aerial sown crops within the smaller planet fusion tiles used in 2018 2021 fig 1 explaining the lack of early ponding data points for those years fig 3 different to the 2022 test dataset where a variety of sowing methods are used within the larger tiles this presents a difficulty because as shown in fig 2 drill sown crops have significant biomass by the time ponding is applied in contrast to db aerial where the water signature is dominant at ponding therefore it would be unreasonable to expect models trained on only drill sown crops to be able to predict ponding dates of fields using other sowing methods to solve this issue we synthesized training data to mimic db aerial sowing by including samples of an on farm dam in the 2018 2021 dataset the dam was within the study area 34 36 32 s 146 21 34 e and had low ndvi and swir throughout the study period similar to recently ponded aerial db crops we labelled the dam samples as constantly ponded the dam data points were duplicated to equalize the number of synthetic db aerial versus drill sown sites in the training data set we note this method has limitations as water applied to rice fields will have a range of spectral signatures depending on dissolved and particulate matter water depth and substrate type fisher et al 2016 2 2 remote sensing data the remote sensing imagery was processed in the google earth engine gee platform gorelick et al 2017 the study used two image sources sentinel 2 s2 and planet fusion pf with characteristics shown in table 1 four vegetation indices vis were computed from the reflectances normalized difference vegetation index ndvi nd nir r green normalized difference index gndvi nd nir g green red vegetation index grvi nd g r land surface water index lswi nd nir swir1 also known as ndwi nd is the normalized difference operator 1 n d b 1 b 2 b 1 b 2 b 1 b 2 these include all nd combinations of the g r and nir bands lswi is frequently used in rice remote sensing because of its sensitivity to both open water and vegetation water content but could only be derived from the s2 data because it requires a swir band gao 1996 models were developed using five combinations of reflectance bands and vis to assess which gave the best performance 4r b g r nir 6r b g r nir swir1 swir2 10r b g r re1 re2 re3 nir nir2 swir1 swir2 3vi grvi gndvi ndvi 4vi grvi gndvi ndvi lswi those marked were specific to sentinel 2 data due to reliance on swir and re bands 2 2 1 sentinel 2 sentinel 2 s2 data are available in gee including both the top of atmosphere l1c and surface reflectance l2a collections however the l2a collection in gee does not extend back to 2017 the year of planting for the 2018 harvest so we used the l1c collection other work has used l1c data for the same reason obtaining good results ni et al 2021 wolters et al 2021 two levels of cloud amelioration were used firstly tiles were filtered by the cloudy pixel percentage cpp metadata field secondly at the pixel level clouds are masked using the s2cloudless layer with a threshold of 40 skakun et al 2022 which is available in gee cloud and shadow masking remains a challenging task particularly for sentinel 2 where the lack of thermal band can cause confusion over bright targets skakun et al 2022 and shadows can be mistaken for water we defined an unmasked parameter 0 when the cloud masking is ignored 1 when 99 of pixels within each field for each image was unmasked 2 when 99 of pixels within a radius of 500 m were unmasked 3 when 99 of pixels within a radius of 2000 m were unmasked settings 2 and 3 help reduce the impact of cloud shadows and cloud that wasn t successfully masked there is a trade off between image quality better for more stringent filtering and the number of images available for training and predicting higher for less filtering we tested prediction accuracy versus cpp and with unmasked settings of 0 1 2 3 after these two levels of cloud filtering the number of days between images over each field varies depending on seasonal cloud conditions and s2 tile overlaps fig 1 for example with cpp 90 and unmasked 2 the median days between images per field ranged between 3 7 and 11 7 days median 8 8 days 2 2 2 planet fusion planet fusion pf data over 2 small tiles for 2018 2021 sites and 4 larger tiles for 2022 sites fig 1 were provided by planet labs pf constitutes a comprehensive radiometric and geometric harmonization and fusion methodology based on the cestem algorithm houborg and mccabe 2018a b pf performs multi sensor inter calibration and data fusion leveraging rigorously calibrated and freely available datasets from sentinel 2 landsat 8 moderate resolution imaging spectroradiometer modis and visible infrared imaging radiometer suite viirs in concert with the higher spatial and temporal resolution cubesat images from the planetscope constellations pf uses the framework for operational radiometric correction for environmental monitoring frantz 2019 to generate a 30 m harmonized sentinel 2 and landsat 8 brdf adjusted surface reflectance sr product to be used as the calibration target during the cestem based radiometric harmonization step additional pf features include 1 sub pixel geometric alignment of source imagery 2 rigorous temporally driven cloud and cloud shadow detection 3 fusion of sentinel 2 and landsat 8 data to help fill gaps in planetscope coverage and 4 advanced gap filling planet fusion team 2021 pf delivers daily gap filled 4 band 0 45 0 51 0 53 0 59 0 64 0 67 0 85 0 88 μm sensor agnostic sr data characterized by enhanced radiometric stability and consistency across space and time domains the data included daily imagery from 1 september 2017 to 31 may 2022 data were ingested and processed in gee because of the aforementioned planet fusion characteristics no pre processing apart from computation of vegetation indices gndvi ndvi and grvi was necessary 2 3 data engineering and classification the spatial mean per field image date of all reflectance bands and vegetation indices was computed for the s2 and pf image collections this resulted in a time series table with all combinations of image date and field as rows and reflectance and vi statistics as columns the aim is to predict the date of ponding for which there are numerous possibilities of organizing data to train and assess models we chose a method that classifies each image date of each field as either pre ponding ponded 0 or post ponding ponded 1 this is then a binary classification problem with a long dataset rows number of fields images per field a small period of the data for one field from the 2019 harvest year is shown in table 2a if only one date of image data is available for classifying each row ponding could be confused with the presence of intermittent water such as from pre ponding irrigation or rainfall as found by xiao et al 2022 therefore we adopted a time series approach that transforms the table so that each row allows the model to see a specified number of previous pre and future post images table 2b the total number of features available to a classifier is pre post 1 nf where nf is the number of base features before transformation e g nf 4 when b g r nir are used a range of pre and post values were trialed for the s2 and pf models the model was applied to predicting the ponded class across the time series for all fields in the test data tables finally the predicted ponding date for each field was extracted since pf provided daily data the ponding date was the first date where the ponded class flips from 0 to 1 for s2 there are time gaps between images leading to uncertainty in the precise date when the change occurred we took the ponding date to be the mid point between the first date where the ponded class became 1 and the date of the previous image which had ponded class 0 once these data engineering steps were performed the data was filtered to contain only dos from 80 to 220 a buffer of 22 days before and after the range of ponding dates in the dataset 2 4 model training and assessment to ensure robust validation of models at predicting new years with no field observations training and test data was separated by year test data was from the 2022 harvest year planted in 2021 and training data from the previous four harvest years 2018 2021 planted in 2017 2020 we first assessed a simple threshold based model using s2 data the swir reflectances drop immediately after ponding and stays low after vegetation emerges which has also been exploited in characterization of wetland inundation brinkhoff et al 2022 the swir threshold was selected by varying it from 0 05 to 0 25 in steps of 0 005 finding the most recent date when the reflectance dropped below the threshold then setting the ponding date prediction as the mid point between that date and the previous image date for each threshold the prediction rmse of ponding date over all data was calculated with the optimal threshold selected by that which gave low rmse this procedure was performed separately on each of the training years 2018 2021 allowing assessment of the consistency of the threshold over years the chosen threshold was then used to test predictions on 2022 data then machine learning ml models were trained using the logistic classifier in scikit learn pedregosa et al 2011 the ridge support vector machine svm and random forest rf classifiers were also assessed but no advantage was found over the logistic classifier and the latter trained significantly faster the tuning hyperparameters of the classifiers were optimized using leave one year out cross validation loyo cv brinkhoff et al 2019 to help ensure model predictions can be generalized to new years in the case of the logistic classifier the tuning hyperparameter was c and the optimal value was selected using gridsearchcv in scikit learn from a range of 0 001 10000 optimal data engineering settings cloud filtering pre and post images feature set were chosen by assessing the cross validation balanced accuracy on the training data the chosen settings were then applied to train a model on all training data harvest years 2018 2021 the model was then tested on the data from the 2022 harvest year test accuracy was assessed by comparing actual and predicted date of ponding we computed the error as the difference between actual and predicted dos of ponding these errors were summarized using the root mean squared error rmse and mean absolute error mae rmse accentuates large errors so is more sensitive to outliers while mae represents the average prediction performance we also calculated lin s correlation concordance lccc which has a similar interpretation to the coefficient of determination r 2 but is more useful for model prediction assessment as it indicates how close to the 1 1 line the predicted vs actual values are rather than simply how correlated they are lin 1989 3 results 3 1 time series characteristics examining the time series evolution of reflectances and vis provides intuition of how ponding can be detected fig 4 a dry broadcast or aerial sown field has no vegetation when ponding starts so ndvi becomes low or even negative see negative ndvi at dos 118 in fig 4a because nir r post ponding in fig 4b in contrast in drill sown fields fig 4c the rice plants have emerged by the time ponding occurs so the remote sensor sees a mix of vegetation and water thus ndvi is higher however in both cases the swir reflectances drop significantly following ponding and remain low through vegetation growth in contrast nir drops after ponding but very quickly increases as the plants grow the swir reflectances are thus a strong indicator of the presence of water brinkhoff et al 2022 3 2 threshold based model the threshold based model searches for the latest date when the swir bands fall below a threshold which is then used to determine the predicted ponding date best results were obtained with cloud filtering parameters cpp 10 and unmasked 2 swir1 results were less consistent between years and had higher rmses compared with swir2 the swir2 optimal threshold was near 0 11 in all years fig 5a applying this model to 2022 test data resulted in an mae of 6 3 days for ponding date prediction fig 5b 80 of the predictions had errors less than 8 days the biggest error point with predicted ponding dos 197 in fig 5b was due to an anomalous spike in the swir2 reflectance over that field from an image acquired on dos 195 2022 01 12 which was caused by cloud that was undetected by the cloud mask 3 3 ml models 3 3 1 sentinel 2 for the s2 ml models an exhaustive search of five parameters was performed 900 combinations i pre 0 2 4 ii post 0 2 4 iii cloud cpp 10 30 50 70 90 iv unmasked 0 1 2 3 and v 5 combinations of reflectances or vis we compared cross validated cv leave one year out balanced accuracy of classifying the ponding class among the combinations training data only we first examined the interaction between the cloud parameters cpp and unmasked fig 6a the best combination was cpp 90 very little tile based filtering and unmasked 2 only retaining data with more than 99 unmasked pixels within a radius of 500 m of the respective field image then we held the cloud settings fixed at the above values and examined the cv accuracy against pre and post images and the feature sets fig 6b c the swir bands are very important as the worst results were obtained with feature sets that don t contain information from those bands 3vi and 4r the highest accuracies were obtained using all reflectances 10r which were slightly better than accuracies obtained using the vegetation indices including lswi 4vi and limited reflectance bands 6r results generally improved with the number of post images and were less sensitive to the number of pre images our final parameter choice was cpp 90 unmasked 2 features 10r pre 4 and post 4 which gave a cv balanced accuracy score of 0 981 the total number of features for this model is 4 4 1 10 90 and there were 2066 rows for model training not including duplicated dam samples these parameter settings were then used to train a model on all the 2018 2021 data and ponding date predictions were tested by applying the model to the 2022 test data the mae was 4 9 days with 80 of the prediction errors less than 6 9 days fig 7 inspection of the time series s2 data from the fields with the largest errors showed these had large gaps in the observations near the ponding date due to cloud we tested predictions using s2 l2a surface reflectance data instead of l1c top of atmosphere data as noted in the methods there is less data available for this image collection the prediction mae degraded to 5 6 days vs 4 9 days we had additional ponding data for fields that were outside the pf tiles fig 1 these included db aerial sown fields in the training years so the duplicated dam samples were not needed this provided an additional 9 training fields 2018 2021 the mae reduced to 3 8 days vs 4 9 days with this additional data 3 3 2 planet fusion a similar parameter search was performed for models based on the pf data the range in the 3 parameters were i pre 0 2 4 8 16 ii post 0 2 4 8 16 and iii 4 reflectances vs 3 vis based on cross validated balanced accuracy on the training data the best results were obtained with the 3vi feature set which was significantly better than using the four reflectances fig 8 the number of pre images had little impact so we chose a value of 0 the results were best with 4 post images with balanced accuracy of 0 972 the total number of features for this combination is 4 1 3 15 and there were 17 220 rows for model training not including duplicated dam samples the chosen parameters were used to train the final model which was then tested using the 2022 data for ponding date prediction the overall mae was 4 3 days fig 9 and 80 of the prediction errors n 59 were five days or less the five worst predictions errors from 8 to 25 days were all db aerial sown fields 3 4 analysis of industry wide water application dates we obtained a shapefile of the approximately 60 000 ha of rice fields planted in 2021 harvested in 2022 the data included the sowing method drill or aerial db recorded by each farmer the s2 time series was extracted for each field and the optimal s2 ml model was used to predict the ponding date for each field the results show the large variation in ponding dates across the industry fig 10a the db aerial fields generally have early ponding dates whereas the drill fields have later ponding dates as expected the distribution of ponding dates across the growing region shows the spread of grower water management practice fig 10b southern fields close to half of the 2022 fields at latitude 35 o had earlier ponding dates mean dos 138 compared to northern fields mean dos 143 this corresponds to more fields being aerial db sown in the south than the north 4 discussion we developed methods to predict rice ponding date which are accurate for the variety of sowing methods and water management strategies adopted in australia two image sources were assessed usable sentinel 2 data had variable revisit due to cloud and tile overlap with some fields having large time gaps leading to uncertainty in precise ponding date predictions however s2 had the advantage of measuring reflectance in the water sensitive swir range on the other hand the planet fusion data had the advantage of daily revisit providing much more training data points and no temporal gaps a summary of results for the held out test year of 2022 table 3 indicate average ponding prediction date errors less than 5 days are possible swir reflectance is a robust indicator of the presence of water even when partially obscured by rice plants many previous rice studies have used swir based indices such as lswi to detect rice fields boschetti et al 2014 for detecting water indices involving swir reflectances are relatively insensitive to vegetation cover ji et al 2009 however as noted in studies of the inundation of wetlands with emergent vegetation wolski et al 2017 brinkhoff et al 2022 using swir reflectances without resorting to derived indices can provide more accurate inundation predictions our simple threshold model indicates a s2 l1c swir2 threshold of 0 11 was optimal over years to identify rice field ponding this method provided an easily interpretable model that could be implemented simply in geographic information systems however the ponding date predictions using this method were not as accurate as those produced by more complex ml methods which could utilize a wider range of temporal and spectral features derived from the imagery a source of error for s2 models is cloud in contrast to other works that apply fixed tile filtering thresholds and cloud masking ni et al 2021 we included cloud filter parameters as part of the model optimization we applied a pixel based cloud mask and tested accuracy when data was discarded that was partially masked over each field and or within the neighborhood 500 m and 2000 m radius of each field we also filtered the data by the s2 tile cloudy pixel percentage cpp metadata there were variable gaps between consecutive images over the fields with some fields having images at least every 4 days over a season and others with gaps as large as 12 days as ponding is a sudden event temporal gaps reduce precision additionally there was a tradeoff in the optimal setting for the cloud filtering more stringent filtering retains only high quality images but also provided less data for training models on the other hand more relaxed cloud filtering provided more data but reduced overall image quality including due to cloud shadows and clouds not detected by the masking algorithm we found that using the pixel based cloud masking removing any data with masked pixels within 500 m of the respective field produced the most accurate predictive models we found that s2 l1c top of atmosphere data provided higher accuracy predictions than l2a surface reflectance data which has been observed in other studies wolters et al 2021 this may be at least partly be due to the incomplete l2a collection in gee making less data available for model training ni et al 2021 we also found that using the raw reflectances and particularly the swir bands provided better accuracy than using derived vegetation indices the planet fusion dataset provides daily analysis ready data calibrated to sentinel 2 surface reflectances while it does not include swir bands we found that ponding date prediction was more accurate using pf compared with s2 mae 4 3 vs 4 9 days our results show that for applications requiring detection of the precise timing of agronomic parameters daily calibrated datasets such as pf are invaluable with the high temporal frequency overcoming some of the limitations due to having less reflectance bands this high frequency aspect has been similarly exploited in sowing date detection sadeh et al 2019 and phenology prediction myers et al 2019 nieto et al 2022 as our method uses optical data it is applicable to regions with limited cloud which may not be the case in tropical regions however the data engineering and machine learning techniques proposed here could be applied sar data to achieve similar outcomes sar data has been used in other studies to overcome the challenges related to cloud torbick et al 2017 stroppiana et al 2019 guo et al 2019 fused sentinel 1 sar with sentinel 2 multispectral data to map rice fields in one growing region in australia finding that this fusion increased classification accuracy significantly particularly considering the range of delays between sowing and ponding however in our study area the revisit of sentinel 1 is 12 days which is not sufficient for our particular application predicting the actual date of ponding one limitation of our training data was that no dry broadcast or aerial sown fields were available in the pf tiles these have very different spectral signatures at ponding than drill sown fields as unbalanced training data can lead to mis classification of minority groups waldner et al 2019 we synthesized training data approximating characteristics of the db aerial sowing methods at ponding by sampling reflectances of a permanent water body we had additional db aerial data for training years outside the pf tiles when we trained an s2 model using these the mae improved by 1 1 days to 3 8 days therefore with addition of increased training data from other sowing methods we expect greater accuracies could be obtained with the pf models as well adopting additional data balancing methods such as those described by waldner et al 2019 may further improve accuracy we used regularized logistic regression to classify each image date into pre ponding or ponded in the case of s2 using all 10 reflectance bands gave the best results generally better results were obtained when more features were provided to the classifier the swir features were particularly important with the red edge bands also providing some benefit reflectances were as good or better than vegetation indices for the s2 classifiers for pf less features are available and the combination of three vegetation indices produced better results than four reflectances we adopted a data transformation technique allowing the classifier to use information from images before and after the date being classified access to data after the classification date was particularly valuable probably avoiding the possibility of intermittent irrigations or rainfall being classified as ponding as subsequent images would indicate that the surface dries again which is not the case for ponding providing industry wide estimation of per field ponding dates will have many benefits for productivity and sustainability growers rely on accurate phenology dates to guide decisions such as timing of fertilizer and water application dunn and gaydon 2011 this work will benefit models that predict growth stages of rice such as panicle initiation which are more accurate when the date of ponding is included as an input darbyshire et al 2019 industry wide estimation of ponding dates will facilitate assessment of the adoption of water saving techniques such as delayed permanent water dunn et al 2014 and assessment of greenhouse gas emissions and impact on wildlife ranghetti and boschetti 2022 combining ponding date predictions with yield data will enable provision of recommendations to growers to optimize the tradeoff between rice water use and productivity decisions which are becoming increasingly important with increased demand for food production coupled with growing water insecurity 5 conclusion information on rice water application is important both for growers to predict phenological stage to manage inputs and assess impact of water saving irrigation techniques on productivity and for industry and government to track water use and greenhouse gas emissions this work has demonstrated development of machine learning models which use a time series of optical imagery as predictors to estimate the date of continuous ponding of rice fields across the main rice growing region of australia including features from images acquired after the date being classified as ponded or non ponded was particularly important we compared models built using two imagery datasets models based on sentinel 2 data were optimized when shortwave infrared bands were included planet fusion does not include shortwave infrared bands however the daily frequency of this imagery resulted in more accurate ponding date predictions than the sentinel 2 models in both cases the mean absolute error of ponding date predictions were less than 5 days declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgements the authors are grateful to ben heaslip of rice research australia pty ltd rrapl for field data additional field observations were gathered by tina dunn chris hodges craig dawes alex schultz sam north don griffin troy mauger and annabelle arnold planet labs provided the fusion imagery this work was funded by agrifutures grants pro 013078 real time remote sensing based monitoring for the rice industry and prj 009790 rice variety nitrogen and agronomic management we are thankful for the work of the anonymous reviewers who provided many helpful suggestions 
9300,rice is unique in that yields are maximized when it is grown under ponded or flooded conditions this however has implications for water use an important consideration in water scarce environments and greenhouse gas emissions this work aimed to provide precise predictions of the date when irrigated rice fields were ponded on a per field basis models were developed using sentinel 2 data with the advantage of inclusion of water sensitive shortwave infrared bands and planet fusion data which provides daily temporally consistent cross calibrated gap free data models were trained with data from both commercial farms and research sites in new south wales australia and over four growing seasons harvest in 2018 2021 predictions were tested on the 2022 harvest season which included a variety of sowing and water management strategies a time series method was developed to provide models with features including satellite observations from before and after the date being classified as ponded or non ponded logistic regression models using time series features produced mean absolute errors for ponding date prediction of 4 9 days using sentinel 2 data and 4 3 days using planet fusion data the temporal frequency of the planet fusion data compensated for the lack of spectral bands relative to sentinel 2 keywords rice irrigation management remote sensing time series logistic regression data availability the data that has been used is confidential 1 introduction globally rice is one of the most important staple food crops and around 75 of production is from irrigated environments chauhan et al 2017 yields are optimized when rice is grown in ponded flooded conditions bouman et al 2007 however water scarcity is an increasing pressure on rice production which has motivated research on optimizing the trade off between yield and water use non ponded growing systems include aerobic nie et al 2012 and alternate wetting and drying awd carrijo et al 2017 rice water management strategies also impact ecology and birdlife herring et al 2021 ranghetti and boschetti 2022 and greenhouse gas emissions linquist et al 2015 these factors drive demand for systems that can determine rice water management across growing regions and track changes in farmer practices over time ranghetti and boschetti 2022 ponding for at least some of the growing season remains the dominant practice due to improved yields and other agronomic factors such as weed control bouman et al 2007 ponding however incurs a penalty on water use due to non productive water loss from soil drainage and evaporation soil drainage may be ameliorated through using only fields with non leaky soils and puddling humphreys et al 2006 evaporation can be reduced by minimizing the duration of ponding particularly during the early growth stages when canopy coverage is not complete and thus evaporative losses are higher some hybrid systems seek to minimize the ponding period restricting it to critical growth phases bouman and tuong 2001 in australia the delayed permanent water dpw system involves drill sowing rice into dry soil after which a number of flush irrigations are applied during early growth stages to meet crop water demand rice fields are flooded before the microspore growth stage which is particularly important in temperate growing regions as the water provides a temprature buffer to reduce yield penalties due to cold induced sterility dunn and gaydon 2011 rice water management also affects phenology with growth accelerating after ponding tools that predict rice growth stage are significantly more accurate when the underlying models factor in not only planting date but also ponding date darbyshire et al 2019 these factors motivate the development of industry wide monitoring systems that can accurately determine per field water application dates such systems will facilitate assessment of the adoption of water saving practice such as delayed ponding and will improve accuracy of growth stage prediction tools remote sensing provides data at the scale and frequency necessary for the development of such systems busetto et al 2017 nelson et al 2014 ranghetti and boschetti 2022 synthetic aperture radar sar data has shown promise for mapping rice area torbick et al 2017 and phenology inoue et al 2014 one of the key advantages of sar data are its low sensitivity to cloud cover making it particularly crucial for use in frequently cloudy regions such as the tropics some work thorp and drajat 2021 has fused sar with optical data which slightly improved classification of phenology over using optical data alone which in turn provided better results than using sar data alone guo et al 2019 similarly combined sar and optical data to map rice in australia particularly focusing on ameliorating the challenge of reduced water signature when ponding is only applied after significant canopy coverage has been achieved however sentinel 1 revisit over much of the rice growing area of new south wales australia is 12 days which is not sufficient for accurately determining the precise date of ponding rice field monitoring products based on optical satellite data have also been developed boschetti et al 2017 ranghetti et al 2018 modis data are daily but at very limited resolution of 250 m red and near infrared only or 500 m landsat has 30 m resolution and an archive of more than 30 years with 16 day revisit or 8 days with two satellites the recent sentinel 2 satellites provide 10 20 or 60 m resolution depending on band and revisit from 3 to 7 days li and roy 2017 these all provide the shortwave infrared swir bands which are sensitive to water brinkhoff et al 2022 important for rice because of the ponded environment boschetti et al 2014 a recent development is near daily imagery at 3 m resolution such as from the planet dove cubesat constellation this data source does have limitations particularly the lack of swir bands and challenges associated with cross calibration between the many 150 sensors in orbit planet fusion planet fusion team 2021 constitutes a comprehensive harmonization and fusion methodology based on the cubesat enabled spatio temporal enhancement method cestem houborg and mccabe 2018a which effectively resolves cross calibration and sensor interoperability issues by calibrating the cubesat sensors against a deep stack of sentinel 2 and landsat 8 surface reflectance imagery whilst simultaneously filling gaps due to cloud and missing observations thus providing a daily calibrated dataset much previous work has been devoted to rice field mapping torbick et al 2017 guo et al 2019 niel and mcvicar 2003 stroppiana et al 2019 these exploit the distinctive water features of rice crops to distinguish them from other crops whilst some of these provide coarse estimates of ponding or start of season xiao et al 2022 few studies have attempted to determine the precise dates that ponded water was applied which requires field level observations across regions and years to train models accurate ponding date predictions are needed for phenology prediction tools darbyshire et al 2019 water use assessments qiu et al 2021 and water management practice monitoring through time we aim to develop a methodology to detect the date of ponding of rice fields across an entire growing region where a diverse range of water management practices are adopted aerial and dry broadcast sowing with early ponding drill sowing with flush irrigations and various delays before ponding we compare predictions using sentinel 2 s2 imagery with its advantage of measuring reflectance in the swir wavelengths to planet fusion pf imagery with its advantages of high spatio temporal consistency and daily image frequency we compare simple reflectance threshold based models with machine learning models and assess the error of ponding date prediction for each method the developed methods will provide improved data to the rice industry facilitating improved phenological predictions and assessing the growth in adoption of water saving practices 2 methods 2 1 location and study sites this study was based in the irrigated rice growing regions of new south wales australia fig 1 showing irrigation areas obtained from australian bureau of agriculture and resource economics and sciences 2022 the climate is temperate allowing production of one crop per year crops are sown in late spring typically october flowering occurs in mid summer january and harvest is in autumn april or may there are a variety of sowing and water management practices adopted in the area ward et al 2021 which are illustrated in fig 2 traditional methods include dry broadcast db where fields are ponded soon after seed distribution and aerial sowing ponding immediately before spreading pre germinated seed into the water recently drill sowing has been widely adopted because of its water saving benefits seed is drilled into dry soil then a number of intermittent irrigations are applied before ponding at around the three leaf vegetative growth stage dunn and gaydon 2011 typically late november delayed permanent water dpw dunn and gaydon 2011 further delays ponding until late december just before the panicle initiation growth phase water management strategies that eliminate a period of continuous ponding altogether such as alternate wetting and drying carrijo et al 2017 are not standard practice in the study area dunn et al 2014 fields are drained around physiological maturity late march or early april and dried for harvest ward et al 2021 the study locations included 182 fields and five harvest years 2018 2022 fig 3 note that throughout this paper year refers to the year of harvest rather than the planting year planting in australia occurs the year before harvest i e planting in october harvest in april we define day of season dos as the days since 1 july of the year prior to harvest corresponding approximately to day of year in the northern hemisphere the fields were distributed across a commercial site used for research and seed production two field research stations and numerous commercial farms fig 1 for each field the ponding date was recorded 2019 and 2020 were drought years australian government bureau of meteorology 2019 resulting in much less rice grown overall australian bureau of statistics 2020 and so less field observations were available in those years fig 3 the study period thus includes dry and wet seasons reflective of the variability in water availability typical of the system we used 2018 2021 data for training then tested models on the 2022 data unfortunately there were no db aerial sown crops within the smaller planet fusion tiles used in 2018 2021 fig 1 explaining the lack of early ponding data points for those years fig 3 different to the 2022 test dataset where a variety of sowing methods are used within the larger tiles this presents a difficulty because as shown in fig 2 drill sown crops have significant biomass by the time ponding is applied in contrast to db aerial where the water signature is dominant at ponding therefore it would be unreasonable to expect models trained on only drill sown crops to be able to predict ponding dates of fields using other sowing methods to solve this issue we synthesized training data to mimic db aerial sowing by including samples of an on farm dam in the 2018 2021 dataset the dam was within the study area 34 36 32 s 146 21 34 e and had low ndvi and swir throughout the study period similar to recently ponded aerial db crops we labelled the dam samples as constantly ponded the dam data points were duplicated to equalize the number of synthetic db aerial versus drill sown sites in the training data set we note this method has limitations as water applied to rice fields will have a range of spectral signatures depending on dissolved and particulate matter water depth and substrate type fisher et al 2016 2 2 remote sensing data the remote sensing imagery was processed in the google earth engine gee platform gorelick et al 2017 the study used two image sources sentinel 2 s2 and planet fusion pf with characteristics shown in table 1 four vegetation indices vis were computed from the reflectances normalized difference vegetation index ndvi nd nir r green normalized difference index gndvi nd nir g green red vegetation index grvi nd g r land surface water index lswi nd nir swir1 also known as ndwi nd is the normalized difference operator 1 n d b 1 b 2 b 1 b 2 b 1 b 2 these include all nd combinations of the g r and nir bands lswi is frequently used in rice remote sensing because of its sensitivity to both open water and vegetation water content but could only be derived from the s2 data because it requires a swir band gao 1996 models were developed using five combinations of reflectance bands and vis to assess which gave the best performance 4r b g r nir 6r b g r nir swir1 swir2 10r b g r re1 re2 re3 nir nir2 swir1 swir2 3vi grvi gndvi ndvi 4vi grvi gndvi ndvi lswi those marked were specific to sentinel 2 data due to reliance on swir and re bands 2 2 1 sentinel 2 sentinel 2 s2 data are available in gee including both the top of atmosphere l1c and surface reflectance l2a collections however the l2a collection in gee does not extend back to 2017 the year of planting for the 2018 harvest so we used the l1c collection other work has used l1c data for the same reason obtaining good results ni et al 2021 wolters et al 2021 two levels of cloud amelioration were used firstly tiles were filtered by the cloudy pixel percentage cpp metadata field secondly at the pixel level clouds are masked using the s2cloudless layer with a threshold of 40 skakun et al 2022 which is available in gee cloud and shadow masking remains a challenging task particularly for sentinel 2 where the lack of thermal band can cause confusion over bright targets skakun et al 2022 and shadows can be mistaken for water we defined an unmasked parameter 0 when the cloud masking is ignored 1 when 99 of pixels within each field for each image was unmasked 2 when 99 of pixels within a radius of 500 m were unmasked 3 when 99 of pixels within a radius of 2000 m were unmasked settings 2 and 3 help reduce the impact of cloud shadows and cloud that wasn t successfully masked there is a trade off between image quality better for more stringent filtering and the number of images available for training and predicting higher for less filtering we tested prediction accuracy versus cpp and with unmasked settings of 0 1 2 3 after these two levels of cloud filtering the number of days between images over each field varies depending on seasonal cloud conditions and s2 tile overlaps fig 1 for example with cpp 90 and unmasked 2 the median days between images per field ranged between 3 7 and 11 7 days median 8 8 days 2 2 2 planet fusion planet fusion pf data over 2 small tiles for 2018 2021 sites and 4 larger tiles for 2022 sites fig 1 were provided by planet labs pf constitutes a comprehensive radiometric and geometric harmonization and fusion methodology based on the cestem algorithm houborg and mccabe 2018a b pf performs multi sensor inter calibration and data fusion leveraging rigorously calibrated and freely available datasets from sentinel 2 landsat 8 moderate resolution imaging spectroradiometer modis and visible infrared imaging radiometer suite viirs in concert with the higher spatial and temporal resolution cubesat images from the planetscope constellations pf uses the framework for operational radiometric correction for environmental monitoring frantz 2019 to generate a 30 m harmonized sentinel 2 and landsat 8 brdf adjusted surface reflectance sr product to be used as the calibration target during the cestem based radiometric harmonization step additional pf features include 1 sub pixel geometric alignment of source imagery 2 rigorous temporally driven cloud and cloud shadow detection 3 fusion of sentinel 2 and landsat 8 data to help fill gaps in planetscope coverage and 4 advanced gap filling planet fusion team 2021 pf delivers daily gap filled 4 band 0 45 0 51 0 53 0 59 0 64 0 67 0 85 0 88 μm sensor agnostic sr data characterized by enhanced radiometric stability and consistency across space and time domains the data included daily imagery from 1 september 2017 to 31 may 2022 data were ingested and processed in gee because of the aforementioned planet fusion characteristics no pre processing apart from computation of vegetation indices gndvi ndvi and grvi was necessary 2 3 data engineering and classification the spatial mean per field image date of all reflectance bands and vegetation indices was computed for the s2 and pf image collections this resulted in a time series table with all combinations of image date and field as rows and reflectance and vi statistics as columns the aim is to predict the date of ponding for which there are numerous possibilities of organizing data to train and assess models we chose a method that classifies each image date of each field as either pre ponding ponded 0 or post ponding ponded 1 this is then a binary classification problem with a long dataset rows number of fields images per field a small period of the data for one field from the 2019 harvest year is shown in table 2a if only one date of image data is available for classifying each row ponding could be confused with the presence of intermittent water such as from pre ponding irrigation or rainfall as found by xiao et al 2022 therefore we adopted a time series approach that transforms the table so that each row allows the model to see a specified number of previous pre and future post images table 2b the total number of features available to a classifier is pre post 1 nf where nf is the number of base features before transformation e g nf 4 when b g r nir are used a range of pre and post values were trialed for the s2 and pf models the model was applied to predicting the ponded class across the time series for all fields in the test data tables finally the predicted ponding date for each field was extracted since pf provided daily data the ponding date was the first date where the ponded class flips from 0 to 1 for s2 there are time gaps between images leading to uncertainty in the precise date when the change occurred we took the ponding date to be the mid point between the first date where the ponded class became 1 and the date of the previous image which had ponded class 0 once these data engineering steps were performed the data was filtered to contain only dos from 80 to 220 a buffer of 22 days before and after the range of ponding dates in the dataset 2 4 model training and assessment to ensure robust validation of models at predicting new years with no field observations training and test data was separated by year test data was from the 2022 harvest year planted in 2021 and training data from the previous four harvest years 2018 2021 planted in 2017 2020 we first assessed a simple threshold based model using s2 data the swir reflectances drop immediately after ponding and stays low after vegetation emerges which has also been exploited in characterization of wetland inundation brinkhoff et al 2022 the swir threshold was selected by varying it from 0 05 to 0 25 in steps of 0 005 finding the most recent date when the reflectance dropped below the threshold then setting the ponding date prediction as the mid point between that date and the previous image date for each threshold the prediction rmse of ponding date over all data was calculated with the optimal threshold selected by that which gave low rmse this procedure was performed separately on each of the training years 2018 2021 allowing assessment of the consistency of the threshold over years the chosen threshold was then used to test predictions on 2022 data then machine learning ml models were trained using the logistic classifier in scikit learn pedregosa et al 2011 the ridge support vector machine svm and random forest rf classifiers were also assessed but no advantage was found over the logistic classifier and the latter trained significantly faster the tuning hyperparameters of the classifiers were optimized using leave one year out cross validation loyo cv brinkhoff et al 2019 to help ensure model predictions can be generalized to new years in the case of the logistic classifier the tuning hyperparameter was c and the optimal value was selected using gridsearchcv in scikit learn from a range of 0 001 10000 optimal data engineering settings cloud filtering pre and post images feature set were chosen by assessing the cross validation balanced accuracy on the training data the chosen settings were then applied to train a model on all training data harvest years 2018 2021 the model was then tested on the data from the 2022 harvest year test accuracy was assessed by comparing actual and predicted date of ponding we computed the error as the difference between actual and predicted dos of ponding these errors were summarized using the root mean squared error rmse and mean absolute error mae rmse accentuates large errors so is more sensitive to outliers while mae represents the average prediction performance we also calculated lin s correlation concordance lccc which has a similar interpretation to the coefficient of determination r 2 but is more useful for model prediction assessment as it indicates how close to the 1 1 line the predicted vs actual values are rather than simply how correlated they are lin 1989 3 results 3 1 time series characteristics examining the time series evolution of reflectances and vis provides intuition of how ponding can be detected fig 4 a dry broadcast or aerial sown field has no vegetation when ponding starts so ndvi becomes low or even negative see negative ndvi at dos 118 in fig 4a because nir r post ponding in fig 4b in contrast in drill sown fields fig 4c the rice plants have emerged by the time ponding occurs so the remote sensor sees a mix of vegetation and water thus ndvi is higher however in both cases the swir reflectances drop significantly following ponding and remain low through vegetation growth in contrast nir drops after ponding but very quickly increases as the plants grow the swir reflectances are thus a strong indicator of the presence of water brinkhoff et al 2022 3 2 threshold based model the threshold based model searches for the latest date when the swir bands fall below a threshold which is then used to determine the predicted ponding date best results were obtained with cloud filtering parameters cpp 10 and unmasked 2 swir1 results were less consistent between years and had higher rmses compared with swir2 the swir2 optimal threshold was near 0 11 in all years fig 5a applying this model to 2022 test data resulted in an mae of 6 3 days for ponding date prediction fig 5b 80 of the predictions had errors less than 8 days the biggest error point with predicted ponding dos 197 in fig 5b was due to an anomalous spike in the swir2 reflectance over that field from an image acquired on dos 195 2022 01 12 which was caused by cloud that was undetected by the cloud mask 3 3 ml models 3 3 1 sentinel 2 for the s2 ml models an exhaustive search of five parameters was performed 900 combinations i pre 0 2 4 ii post 0 2 4 iii cloud cpp 10 30 50 70 90 iv unmasked 0 1 2 3 and v 5 combinations of reflectances or vis we compared cross validated cv leave one year out balanced accuracy of classifying the ponding class among the combinations training data only we first examined the interaction between the cloud parameters cpp and unmasked fig 6a the best combination was cpp 90 very little tile based filtering and unmasked 2 only retaining data with more than 99 unmasked pixels within a radius of 500 m of the respective field image then we held the cloud settings fixed at the above values and examined the cv accuracy against pre and post images and the feature sets fig 6b c the swir bands are very important as the worst results were obtained with feature sets that don t contain information from those bands 3vi and 4r the highest accuracies were obtained using all reflectances 10r which were slightly better than accuracies obtained using the vegetation indices including lswi 4vi and limited reflectance bands 6r results generally improved with the number of post images and were less sensitive to the number of pre images our final parameter choice was cpp 90 unmasked 2 features 10r pre 4 and post 4 which gave a cv balanced accuracy score of 0 981 the total number of features for this model is 4 4 1 10 90 and there were 2066 rows for model training not including duplicated dam samples these parameter settings were then used to train a model on all the 2018 2021 data and ponding date predictions were tested by applying the model to the 2022 test data the mae was 4 9 days with 80 of the prediction errors less than 6 9 days fig 7 inspection of the time series s2 data from the fields with the largest errors showed these had large gaps in the observations near the ponding date due to cloud we tested predictions using s2 l2a surface reflectance data instead of l1c top of atmosphere data as noted in the methods there is less data available for this image collection the prediction mae degraded to 5 6 days vs 4 9 days we had additional ponding data for fields that were outside the pf tiles fig 1 these included db aerial sown fields in the training years so the duplicated dam samples were not needed this provided an additional 9 training fields 2018 2021 the mae reduced to 3 8 days vs 4 9 days with this additional data 3 3 2 planet fusion a similar parameter search was performed for models based on the pf data the range in the 3 parameters were i pre 0 2 4 8 16 ii post 0 2 4 8 16 and iii 4 reflectances vs 3 vis based on cross validated balanced accuracy on the training data the best results were obtained with the 3vi feature set which was significantly better than using the four reflectances fig 8 the number of pre images had little impact so we chose a value of 0 the results were best with 4 post images with balanced accuracy of 0 972 the total number of features for this combination is 4 1 3 15 and there were 17 220 rows for model training not including duplicated dam samples the chosen parameters were used to train the final model which was then tested using the 2022 data for ponding date prediction the overall mae was 4 3 days fig 9 and 80 of the prediction errors n 59 were five days or less the five worst predictions errors from 8 to 25 days were all db aerial sown fields 3 4 analysis of industry wide water application dates we obtained a shapefile of the approximately 60 000 ha of rice fields planted in 2021 harvested in 2022 the data included the sowing method drill or aerial db recorded by each farmer the s2 time series was extracted for each field and the optimal s2 ml model was used to predict the ponding date for each field the results show the large variation in ponding dates across the industry fig 10a the db aerial fields generally have early ponding dates whereas the drill fields have later ponding dates as expected the distribution of ponding dates across the growing region shows the spread of grower water management practice fig 10b southern fields close to half of the 2022 fields at latitude 35 o had earlier ponding dates mean dos 138 compared to northern fields mean dos 143 this corresponds to more fields being aerial db sown in the south than the north 4 discussion we developed methods to predict rice ponding date which are accurate for the variety of sowing methods and water management strategies adopted in australia two image sources were assessed usable sentinel 2 data had variable revisit due to cloud and tile overlap with some fields having large time gaps leading to uncertainty in precise ponding date predictions however s2 had the advantage of measuring reflectance in the water sensitive swir range on the other hand the planet fusion data had the advantage of daily revisit providing much more training data points and no temporal gaps a summary of results for the held out test year of 2022 table 3 indicate average ponding prediction date errors less than 5 days are possible swir reflectance is a robust indicator of the presence of water even when partially obscured by rice plants many previous rice studies have used swir based indices such as lswi to detect rice fields boschetti et al 2014 for detecting water indices involving swir reflectances are relatively insensitive to vegetation cover ji et al 2009 however as noted in studies of the inundation of wetlands with emergent vegetation wolski et al 2017 brinkhoff et al 2022 using swir reflectances without resorting to derived indices can provide more accurate inundation predictions our simple threshold model indicates a s2 l1c swir2 threshold of 0 11 was optimal over years to identify rice field ponding this method provided an easily interpretable model that could be implemented simply in geographic information systems however the ponding date predictions using this method were not as accurate as those produced by more complex ml methods which could utilize a wider range of temporal and spectral features derived from the imagery a source of error for s2 models is cloud in contrast to other works that apply fixed tile filtering thresholds and cloud masking ni et al 2021 we included cloud filter parameters as part of the model optimization we applied a pixel based cloud mask and tested accuracy when data was discarded that was partially masked over each field and or within the neighborhood 500 m and 2000 m radius of each field we also filtered the data by the s2 tile cloudy pixel percentage cpp metadata there were variable gaps between consecutive images over the fields with some fields having images at least every 4 days over a season and others with gaps as large as 12 days as ponding is a sudden event temporal gaps reduce precision additionally there was a tradeoff in the optimal setting for the cloud filtering more stringent filtering retains only high quality images but also provided less data for training models on the other hand more relaxed cloud filtering provided more data but reduced overall image quality including due to cloud shadows and clouds not detected by the masking algorithm we found that using the pixel based cloud masking removing any data with masked pixels within 500 m of the respective field produced the most accurate predictive models we found that s2 l1c top of atmosphere data provided higher accuracy predictions than l2a surface reflectance data which has been observed in other studies wolters et al 2021 this may be at least partly be due to the incomplete l2a collection in gee making less data available for model training ni et al 2021 we also found that using the raw reflectances and particularly the swir bands provided better accuracy than using derived vegetation indices the planet fusion dataset provides daily analysis ready data calibrated to sentinel 2 surface reflectances while it does not include swir bands we found that ponding date prediction was more accurate using pf compared with s2 mae 4 3 vs 4 9 days our results show that for applications requiring detection of the precise timing of agronomic parameters daily calibrated datasets such as pf are invaluable with the high temporal frequency overcoming some of the limitations due to having less reflectance bands this high frequency aspect has been similarly exploited in sowing date detection sadeh et al 2019 and phenology prediction myers et al 2019 nieto et al 2022 as our method uses optical data it is applicable to regions with limited cloud which may not be the case in tropical regions however the data engineering and machine learning techniques proposed here could be applied sar data to achieve similar outcomes sar data has been used in other studies to overcome the challenges related to cloud torbick et al 2017 stroppiana et al 2019 guo et al 2019 fused sentinel 1 sar with sentinel 2 multispectral data to map rice fields in one growing region in australia finding that this fusion increased classification accuracy significantly particularly considering the range of delays between sowing and ponding however in our study area the revisit of sentinel 1 is 12 days which is not sufficient for our particular application predicting the actual date of ponding one limitation of our training data was that no dry broadcast or aerial sown fields were available in the pf tiles these have very different spectral signatures at ponding than drill sown fields as unbalanced training data can lead to mis classification of minority groups waldner et al 2019 we synthesized training data approximating characteristics of the db aerial sowing methods at ponding by sampling reflectances of a permanent water body we had additional db aerial data for training years outside the pf tiles when we trained an s2 model using these the mae improved by 1 1 days to 3 8 days therefore with addition of increased training data from other sowing methods we expect greater accuracies could be obtained with the pf models as well adopting additional data balancing methods such as those described by waldner et al 2019 may further improve accuracy we used regularized logistic regression to classify each image date into pre ponding or ponded in the case of s2 using all 10 reflectance bands gave the best results generally better results were obtained when more features were provided to the classifier the swir features were particularly important with the red edge bands also providing some benefit reflectances were as good or better than vegetation indices for the s2 classifiers for pf less features are available and the combination of three vegetation indices produced better results than four reflectances we adopted a data transformation technique allowing the classifier to use information from images before and after the date being classified access to data after the classification date was particularly valuable probably avoiding the possibility of intermittent irrigations or rainfall being classified as ponding as subsequent images would indicate that the surface dries again which is not the case for ponding providing industry wide estimation of per field ponding dates will have many benefits for productivity and sustainability growers rely on accurate phenology dates to guide decisions such as timing of fertilizer and water application dunn and gaydon 2011 this work will benefit models that predict growth stages of rice such as panicle initiation which are more accurate when the date of ponding is included as an input darbyshire et al 2019 industry wide estimation of ponding dates will facilitate assessment of the adoption of water saving techniques such as delayed permanent water dunn et al 2014 and assessment of greenhouse gas emissions and impact on wildlife ranghetti and boschetti 2022 combining ponding date predictions with yield data will enable provision of recommendations to growers to optimize the tradeoff between rice water use and productivity decisions which are becoming increasingly important with increased demand for food production coupled with growing water insecurity 5 conclusion information on rice water application is important both for growers to predict phenological stage to manage inputs and assess impact of water saving irrigation techniques on productivity and for industry and government to track water use and greenhouse gas emissions this work has demonstrated development of machine learning models which use a time series of optical imagery as predictors to estimate the date of continuous ponding of rice fields across the main rice growing region of australia including features from images acquired after the date being classified as ponded or non ponded was particularly important we compared models built using two imagery datasets models based on sentinel 2 data were optimized when shortwave infrared bands were included planet fusion does not include shortwave infrared bands however the daily frequency of this imagery resulted in more accurate ponding date predictions than the sentinel 2 models in both cases the mean absolute error of ponding date predictions were less than 5 days declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgements the authors are grateful to ben heaslip of rice research australia pty ltd rrapl for field data additional field observations were gathered by tina dunn chris hodges craig dawes alex schultz sam north don griffin troy mauger and annabelle arnold planet labs provided the fusion imagery this work was funded by agrifutures grants pro 013078 real time remote sensing based monitoring for the rice industry and prj 009790 rice variety nitrogen and agronomic management we are thankful for the work of the anonymous reviewers who provided many helpful suggestions 
9301,quantitatively characterizing and accurately predicting plant transpiration are of great significance but directly measuring transpiration is impractical time consuming and labor intensive this study compared the transpiration estimation performance of multiple linear regression mlr modified jarvis stewart mjs and shuttleworth wallace s w with deep belief network dbn long short term memory recurrent neural network lstm rnn and lstm rnn improved with multiple restricted boltzmann machines r l rnn using 31 input combinations comprising complete subsets of vapor pressure deficit vpd net solar radiation rn average air temperature ta soil water content swc and leaf area index lai observations collected at wuwei changwu and taigu stations on the loess plateau in china the results showed that r l rnn obtained the most accurate estimations in the partial canopy stage dense canopy stage and whole growth stage compared to mlr mjs s w dbn and lstm rnn the accuracy of the deep learning models dnn increased exponentially as the number of input variables increased and the importance of the input variables followed the orders of lai vpd rn ta swc in the partial and whole canopy stage and vpd rn ta lai swc in the dense canopy stage the apple tree transpiration models were more accurate in the partial and dense canopy stages than the whole growth stage the coefficient of determination and nash sutcliffe efficiency coefficient for the r l rnn model increased by 8 1 13 1 and 11 2 25 4 in the partial canopy stage respectively and by 2 6 6 9 and 14 7 20 1 in the dense canopy stage whereas the relative root mean square error decreased by 8 7 28 6 and 17 3 38 2 overall r l rnn is the most recommended model for estimating the apple tree transpiration because it is such a simple method that agricultural water managers can easily determine the water consumption of apple trees using limited accessible observational data keywords hybrid deep learning model empirical model path analysis growth stage input variable data availability the authors do not have permission to share data nomenclature variables a total available energy to the substrate w m 2 as available energy to the substrate w m 2 aw cross sectional area of the water conducting sapwood m2 ai biases of the ith visible layer element bi biases of the jth hidden layer element cc canopy resistance coefficient cs soil surface resistance coefficient cp specific heat of dry air at constant pressure j kg 1 1 e soil evaporation mm ft forget gate f vpd constraint functions for vpd f rn constraint functions for rn f ta constraint functions for ta f θa constraint functions for θa f lai constraint functions for lai gpi global performance indicator h hidden layer it input gate i the ith visible layer node j the jth hidden layer node k the offset vector lai leaf area index m2 m 2 m number of statistical indicators nse nash sutcliffe efficiency coefficient ot output gate pmc canopy transpiration mm pms soil evaporation mm rh air relative humidity r2 coefficient of determination rrmse relative root mean square error rn net solar radiation w m 2 r correlation coefficient r a a aerodynamic resistances from the reference height to in canopy heat exchange plane height s m 1 r a s aerodynamic resistances from the reference height to the soil surface s m 1 r a c aerodynamic resistances of the canopy to in canopy flow s m 1 r s s soil surface resistance s m 1 r s c canopy resistance s m 1 sf sap flow rate mm s 1 st updated gate sii normalized value of r2 nse and rrmse simedian median of the sii ta average air temperature tmax maximum air temperature tmin minimum air temperature tsf tree transpiration mm tanh activation function vpd vapor pressure deficit kpa v visible layer w matrix composed of coefficients w weight of the visible layer and hidden layer xt input value of the current cell xi the ith independent variable yt output value of the current cell y dependent variable γ psychometric constant δ slope of the saturation water vapor pressure versus temperature curve θa actual volumetric soil water content m3 m 3 θwp wilting point soil water content m3 m 3 θfc field water capacity m3 m 3 λ latent heat of vaporization mj kg 1 λe latent heat flux of evaporation from the soil surface mj m 2 d 1 ξ learning rate ρ air density kg m 3 σ sigmoid activation function d a t a mathematical expectation of the characteristics of the training sample r e mathematical expectation of reconstructing the sample features after gibbs sampling abbreviations ann artificial neural network bpnn back propagation neural network bta simplified process based model cml classical machine learning model dbn deep belief network dnn deep learning model doy day of year etc act actual crop evapotranspiration et0 crop reference evapotranspiration fao food and agriculture organization of the united nations grnn generalized regression neural network lstm rnn long short term memory recurrent neural network mars multivariate adaptive regression splines model mjs modified jarvis stewart model mlr multiple linear regression model par photosynthetically active radiation rbm multiple stacked restricted boltzmann machines rf random forest r l rnn lstm rnn improved with multiple restricted boltzmann machines svm support vector machines s w shuttleworth wallace model swc volumetric soil water content tcn temporal convolution network 1 introduction the apple is the most widely cultivated fruit throughout the world wang et al 2020 according to the food and agriculture organization of the united nations fao china has become the largest global apple producer and it accounts for around 49 of the total production 87 106 t faostat 2019 the loess plateau area is the main apple producing region in china with 49 of the national yield because it provides the best photo thermal conditions for apple tree growth however seasonal drought low rainfall and unscientific irrigation management are the main limiting factors in this region wang et al 2020 in particular actual crop evapotranspiration etc act can reach 95 of the total water balance in northwest china hence accurate etc act calculations are essential for achieving the efficient utilization of regional water resources and ensuring the stable high yielding production of apples on the loess plateau evapotranspiration is closely related to eco hydrological processes in the soil plant atmosphere continuum fan et al 2021 so accurate etc act measurements or estimations especially the productive plant transpiration component are of great importance for yield prediction and irrigation schedule formulation in agricultural water management directly measuring plant transpiration using a stem sap flow gauge is impractical time consuming and labor intensive therefore numerous alternative methods have been widely applied for estimating transpiration based on related factors e g empirical physical and machine learning models fan et al 2021 zheng et al 2019 traditional plant transpiration simulations gradually developed from empirical models to tree process models empirical and physically transpiration models generally include multiple linear regression mlr fan et al 2021 tu et al 2019 modified jarvis stewart mjs nyolei et al 2021 zheng et al 2019 and shuttleworth wallace s w li et al 2015 nyolei et al 2021 however the applications of these mathematical transpiration estimation models are severely limited by the uncertainty caused by the model structure model parameters and measurement noise in addition traditional transpiration models exhibit complex nonlinearity which depends on numerous types of meteorological soil and tree observational data as well as their interactions consequently it is challenging to develop empirical or physical models that accurately represent the intrinsic transpiration mechanism as effective alternatives to traditional transpiration models machine learning models such as classical machine learning model cml artificial neural network ann and deep learning model dnn models have been successfully applied for estimating etc act and transpiration in various plant types where they are characterized as simple methods that readily find solutions with high precision and they can be constructed with limited data fan et al 2021 xu et al 2017 compared the performance of the mjs simplified process based bta and ann models and they found that the ann model performed better at etc act estimation than the mjs and bta models tu et al 2019 applied a back propagation neural network bpnn for estimating transpiration and showed that it obtained highly accurate sap flow estimations due to its superior adaptability to complicated nonlinear problems in recent years dnn have been successfully applied in various domains with excellent performance due to major advances in the calculation capacities of computers and in artificial intelligence theory dai et al 2021 dong et al 2022 however these models have rarely been applied in agriculture and hydrology particularly for predicting etc act chen et al 2020b developed a temporal convolution network tcn to estimate the etc act for irrigated maize based on meteorological soil and crop factors and they verified that the tcn could obtain high accuracy estimates of the maize etc act fan et al 2021 recently explored the suitability of cml and dnn or estimating daily maize transpiration in northwest china and their results showed that dnn was highly effective due to its advantage in terms of modeling high order complex relationships based on multiple hidden layers granata and di nunno 2021 applied several rnn models recurrent neural network for predicting the actual etc act and they found that long short term memory network lstm could provide highly accurate predictions of the actual etc act there were hitherto some studies on measuring apple tree transpiration using sap flow techniques and applied machine learning models for transpiration estimation of perennial trees weibel and de vos 1994 constructed an improved stem heat balance method to measure transpiration on a 10 year old apple tree orchard and the result showed that the sap flow density was varying with the exposition of the canopy to direct sunlight liu et al 2012 used the compensation heat pulse method to measure sap flow for making irrigation scheduling in the apple tree orchard and they concluded that it is beneficial for more accurate modeling of trunk sap flow by analyzing major factors affecting sap flow during two growth stages of the apple tree li et al 2009 constructed a generalized regression neural network grnn model for cherry transpiration and experiment verification showed that the model had a high prediction accuracy ellsäßer et al 2020 used random forest rf ann and support vector machines svm to predict sap flux in mixed agroforestry systems and they concluded that there is large potential in machine learning approaches for predicting transpiration however few researchers have compared the performance of deep learning models and traditional transpiration models at estimating daily apple tree transpiration thus this study aimed to develop a hybrid deep learning model r l rnn with the advantages of deep belief network dbn and long short term memory recurrent neural network lstm rnn models to improve the accuracy of transpiration simulation in addition the single and combined effects of tree meteorological and soil variables on daily apple tree transpiration on the loess plateau have not been systematically studied previously therefore the main objectives of this study were 1 to determine the variations of meteorological tree and soil factors and quantify their effects on daily apple tree transpiration on the loess plateau 2 to compare the performance of different dnn e g dbn lstm rnn and r l rnn and traditional transpiration models e g mlr mjs and s w at estimating daily apple tree transpiration 3 to investigate the effects of various input combinations based on tree meteorological and soil variables on the accuracy of apple tree transpiration estimation and 4 to evaluate the accuracy of various transpiration models in different apple tree growth stages particularly deep learning models 2 materials and methods 2 1 site description the main apple producing areas 33 43 41 16 n 100 54 114 33 e in the loess plateau region include the southeast of gansu province weibei plain of shaanxi province and the central southern part of shanxi province thus this study investigated three sites located in wuwei changwu and taigu fig 1 brief descriptions of these three sites are presented in the following wuwei station 33 52 12 n 102 51 01 e the experiment was conducted at the shiyanghe experimental station for water saving in agriculture and ecology of china agricultural university wuwei city gansu province during 2008 2010 the average annual temperature average annual rainfall average annual reference evapotranspiration and the average annual sunshine duration are 8 c 172 4 mm 2000 mm and 2890 h the apple orchard was rainfed before and planted in desert soil with soil water content at field capacity and wilting point being 0 33 m3 m 3 and 0 06 m3 m 3 respectively the field capacity is defined as the amount of soil water content held in soil after excess water has drained away the own rooted apple tree variety tested was red marshal 29 years old with an average height of 2 5 m and row spacing of 4 0 6 0 m the upper and lower limits of irrigation ranged between 65 and 100 field water capacity θfc and the irrigation amount satisfied the water consumption demand theoretically the border irrigation takes place when the soil reaches the lower limits and terminates on the upper limits liu et al 2012 changwu station 35 13 48 n 107 40 44 e the experiment was conducted at the agricultural ecological experimental station of the changwu loess plateau of the chinese academy of sciences xianyang city shaanxi province during 2012 2014 the average annual temperature average annual rainfall average annual reference evapotranspiration and the average annual sunshine duration are 9 c 584 mm 2290 mm and 2100 h the apple orchard was rainfed before and planted in dark loessial soils with soil water content at field capacity and wilting point being 0 28 m3 m 3 to 0 09 m3 m 3 respectively the methods used to determine soil field water capacity for this site was proposed by colman 1947 the own rooted apple tree variety tested was red fuji nine years old with an average height of 3 5 m and row spacing of 3 5 4 0 m the rainfed orchard had not received irrigation water for several years taigu station 37 22 53 n 112 31 41 e the experiment was conducted at the scientific research pilot base of pomology research institute of shanxi academy of agricultural sciences jinzhong city shanxi province during 2015 2017 the average annual temperature average annual rainfall average annual reference evapotranspiration and the average annual sunshine duration are 10 c 460 mm 1766 mm and 2700 h the apple orchard was rainfed before and planted in sandy loam soil with soil water content at field capacity and wilting point being 0 30 m3 m 3 and 0 08 m3 m 3 respectively the soil field capacity in this site is also defined as the amount of soil water content held in soil after excess water has drained away the own rooted apple tree variety tested was red fuji seven years old with an average height of 3 0 m and row spacing of 2 0 4 0 m the upper and lower limits of irrigation ranged between 55 and 90 field water capacity θfc and the annual irrigation quota was around 135 mm the water storage pit irrigation takes place when the soil reaches the lower limits and terminates on the upper limits 2 2 measurements the net solar radiation rn air relative humidity rh air temperature tmax tmin and ta atmospheric pressure wind speed and rainfall were recorded using meteorological monitoring systems meteorological monitoring system jauntering taiwan at the height of 2 m in the apple orchards the meteorological data were recorded by automatic data collector hl20 data logger jauntering taiwan at an hourly intervals the volumetric soil water content swc was continuously measured by tube type time domain reflectometry tube tdr imko micro modultechnik germany for five apple trees where sap flow were monitored four tubes for each tree were installed at 30 cm relative to the tree trunks in the east south north and west directions to a depth of 1 m the soil water content of the vertical profile in each tube was measured at 10 cm layer increments every 5 7 days soil water content measured by tube tdr was calibrated by the oven drying method every month and the gravimetric soil water content converted to volumetric water content values by multiplying it by the bulk density of the soil campbell and campbell 2005 the swc was linearly interpolated from five day scale to the daily scale for purposes of comparison to transpiration leaf area index lai was measured by winscanopy canopy analysis system winscanopy 2006a regent quebec canada the hemispherical photography was taken in sunny days every 5 7 days and was analyzed by winscanopy 2006a software to obtain the lai of apple tree the lai was interpolated by quadratic equation between lai and day of year doy each year for purposes of comparison to transpiration the sap flow rates in apple trees were monitored by commercial sap flow sensors model sf100 greenspan technology pty ltd warwick australia consisting of two temperature and one heater probe were used to monitor trunk sap flow sf automatically the depth of the sap wood from the bark 15 20 mm had the peak value of sap velocity that contributed to most of total sap flux so representative apple tree were selected and the probe was installed at a depth of 20 mm to calculate whole trunk sap flux the probe was installed at 1 m from the trunk to the ground and wrapped by silver paper to reduce the effect of environmental heat and prevent the entire system against rainfall the pulse duration was 2 s and the data was recorded every 10 min the sap flux was monitored on five trees randomly chosen in the orchards according to granier 1987 the formulae for conversion of sap flow rates sf from tree to stand transpiration tsf is listed as follow 1 s f i 0 00119 δ h max δ h δ t 1 23 2 t sf 1 6 i 1 144 s f i a w a c 3600 where tsf is the estimated transpiration mm d 1 sfi is the sap flow rate per record mm s 1 i is daily recorded volume i 1 2 144 δh is the difference in temperature between a pair of probes δhmax is the value of δh when there is no sap flux which corresponds to the nocturnal δh maximum over a 24 h period aw represent the cross sectional area of the water conducting sapwood m2 ac is the canopy area m2 2 3 traditional transpiration models the traditional transpiration models mainly include empirical models and physical models the mlr patle et al 2020 zheng et al 2021 mjs bosveld and bouten 2003 zheng et al 2021 and s w li et al 2015 shan et al 2020 were used to estimate the daily transpiration for the apple tree in this study 2 3 1 multiple linear regression model the mlr model for estimating transpiration is expressed as follows 3 t sf a l a i b v p d c r n d t a e θ a f where tsf lai vpd rn ta θa represent the estimated transpiration leaf area index vapor pressure deficit net solar radiation average air temperature and average volumetric soil water content respectively the empirical parameters a b c d e and f are fitted using the least squares method kovoor and nandagiri 2007 li et al 2016a 2 3 2 modified jarvis stewart model the mjs model defined by jarvis 1997 for modeling transpiration is expressed as follows 4 t sf t sf m a x f l a i f v p d f r n f t a f θ a where tsf max represent the maximum rate of apple tree transpiration which is modified by each driving variable in this study mjs model were constructed by combining different environmental submodel functional formulae as follows 5 f v p d 1 a 1 v p d 1 6 f r n r n r n a 2 7 f t a 1 a 3 a 4 t a 2 8 f θ a 1 exp a 5 θ w p θ a 9 f l a i l a i l a i 0 5 l a i m a x 0 5 l a i l a i 0 5 l a i m a x where θwp and θa are the volumetric wilting coefficient and the average soil water content laimax represent the maximum value of leaf area index the empirical parameters a1 a2 a3 a4 and a5 are fitted using the least squares method 2 3 3 shuttleworth wallace model shuttleworth and wallace 1985 studied the etc act for sparse cover surface assuming that the crop canopy is uniformly covered two canopy resistance and soil resistance parameters are introduced to establish a dual source etc act model s w comprising the crop canopy and surface under canopy the s w model is calculated as follows 10 λ et c c pm c c s pm s 11 p m c δ a ρ c p v p d δ r a c a s r a a r a c δ γ 1 r s c r a a r a c where λet is the etc act estimated using the s w model and the pms and pmc are same as the soil evaporation e and canopy transpiration tsf terms respectively which are applied in the p m model penman monteith model the detailed calculation processes were described by li et al 2015 in the present study the s w model was only applied to estimate apple tree transpiration 2 4 deep learning models 2 4 1 deep belief network the dbn model is a generative model proposed by hinton and salakhutdinov 2006 which involves multiple stacked restricted boltzmann machines rbm ma et al 2022 each rbm comprises a visible layer v and hidden layer h fig 2 the visible layer of the rbm on the upper layer comprises the hidden layer of the next layer in this method features are extracted layer by layer and the top layer is used as the input into bp for regression calculation as shown in fig 2 the state is more stable when the energy is smaller and thus the model s parameters are better at reflecting the probability distribution of the sample the energy function e v h of rbm is 12 e v h i 1 n j 1 m w i j v i h j i 1 n a i v i j 1 m b j h i where i represents the i th visible layer node j represents the j th hidden layer node a i and b j are the biases of the visible layer element and hidden layer element respectively and w represents the weight of the visible layer and hidden layer by setting the parameters β a b w the joint probability density of v h is as follows 13 p v h β e e v h i 1 n j 1 m e e v h due to the independent structural characteristics of the same rbm layer when the state of the visible layer is known the activation probability of the j th unit of the hidden layer h is 14 p h j 1 v σ i 1 n w i j v i b j where σ x 1 1 e x is the sigmoid activation function the rbm has a symmetrical structure so when the state of the hidden layer is known the activation probability of the i th unit of the visual layer v is as follows 15 p v i 1 h σ j 1 m w i j h j a i the rbm is trained an unsupervised learning process after determining the parameters using the maximum likelihood estimation method the parameters β can be iteratively solved by the contrast divergence method ning et al 2018 16 δ a i ζ h j d a t a h j r e δ b j ζ v i d a t a v i r e δ w i j ζ v i h j d a t a v i h j r e where ξ represents the learning rate d a t a represents the mathematical expectation of the characteristics of the training sample and r e represents the mathematical expectation of reconstructing the sample features after gibbs sampling 2 4 2 long short term memory recurrent neural network long short term memory recurrent neural network lstm rnn is based on the traditional rnn neural network which cannot deal with some long distance problems well it belongs to one of the variants of neural network similar to rnn lstm rnn neural network structure is one of the recursive memory neural networks based on memory block structure fig 2 it can record the hidden state of the current node and then transfer it to the subsequent nodes so as to achieve the purpose of learning historical input information the lstm rnn model has a unique memory cell mechanism which can better solve the problems of gradient data disappearance and explosion the core idea of lstm rnn is to use its unique three gate structure to protect and control cell state cell memory state is the key of lstm rnn it is similar to conveyor belt and runs through the whole lstm structure which can effectively ensure that the information flows on the whole chain the lstm rnn model has four special gate structures through which it can remove or increase information to the cell state mohanty et al 2020 the specific implementation process is as follows the forget gate f t determines whether the state st of the current cell should be retained the mathematical description is as follows 17 f t σ w f y t 1 x t k f where σ represents the sigmoid activation function yt 1 represents the output value of the old cell xt represents the input value of the current cell wf represents the matrix composed of coefficients in the forget gate kf represents the offset vector in the forget gate the input gate i t is responsible for determining whether the input value x t should be used to update the state s t of the current cell the sigmoid activation function is responsible for determining the output value y t of the current cell the mathematical description is as follows 18 i t σ w i y t 1 x t k i 19 u t tanh w c y t 1 x t k c where tanh represents hyperbolic tangent activation function which is responsible for creating a candidate vector u t of the current cell wi represents the matrix composed of coefficients in the input gate wc represents the matrix composed of coefficients in the candidate vector ki represents the offset vector in the input gate kc represents the offset vector in the candidate vector the updated gate u t determines whether the current cell should update the state of the old cell from s t 1 to s t by multiplying the forget gate and the input gate the mathematical description is as follows 20 s t f t s t 1 i t u i the output gate o t is responsible for calculating the output value y t of the current cell the output gate runs the sigmoid activation function to determine whether to output the current cell state by judging the output value of the old cell and the input value of the current cell then current cell state s t is then processed by the tanh activation function and multiplied by the output o t of the sigmoid activation function to finally determine the output value y t of the current cell the mathematical description is as follows 21 o t σ w o y t 1 x t k o 22 y t o t tanh s t where wo represents the matrix composed of coefficients in the output gate ko represents the offset vector in the output gate 2 4 3 lstm rnn improved with multiple restricted boltzmann machines the r l rnn is an extension of the original lstm rnn model where it is significantly improved by the rbm structure and it can be used for time series mining and data feature extraction in r l rnn the features extracted by rbm e t substitute for the input value x t of each memory block in the lstm rnn model and they are combined with the previous output value e t 1 to determine whether the cell state s t by the sigmoid activation function thus the lstm of the extracted sequence of input features is realized according to the activation of different gates as in the lstm rnn the functions of the input gate i t forget gate f t and update gate u t are similar to those in the lstm rnn model but the output gate o t in the r l rnn model is responsible for calculating the output feature extraction value e t in the current cell by progressing through the time series the r l rnn model finally produces a time series of dependent variables in the complex nonlinear system in the present study using r l rnn rather than lstm rnn and dbn could result in better generalization because the improved feature extraction with the rbm includes more potential history in the sequence compared with lstm rnn the mathematical process of the r l rnn model is based on dbn and lstm rnn and the complete structure of the r l rnn model is illustrated in fig 2 2 5 input combinations and model implementation the advantages of the k fold cross validation method in terms of effectively avoiding over learning and under learning have been demonstrated in numerous studies dong et al 2022 fan et al 2018 in the present study data observations in the representative years i e wuwei during 2008 2010 changwu during 2012 2014 and taigu during 2015 2017 were separated into three equal parts chronologically one part one year of data was used for testing and the other two parts two years of data were applied for training dnn or calibrating traditional models were calibrated using the least squares method the accuracy of the average estimated value was taken as the final result to further evaluate the performance of dnn models at estimating apple tree transpiration we used 31 input combinations based on the all subset strategy to construct the dbn lstm rnn and r l rnn for estimating transpiration respectively table 1 summarizes the input variables and model abbreviations for dnn models 2 6 water stress coefficient when the potential energy of the soil water drops below a threshold value the crop is said to be water stressed the effects of soil water stress are described by multiplying the basal crop coefficient by the water stress coefficient ks allen et al 1998 used the following expression for ks 23 k s t a w d r t a w r a w where ks is the water stress coefficient taw is the total available water i e water stored in the root zone between field water capacity and wilting point dr mm is the root zone depletion raw mm is the readily available water for soil water limiting conditions ks 1 where there is no soil water stress ks 1 based on fao56 hu et al 2006 expressed ks as a linear function of soil water storage at field capacity and at wilting point chen et al 2022 liu and luo 2010 which was calculated as follows 24 k s 1 0 8 b 0 04 e t 0 θ a θ w p θ f c θ w p where et0 is crop reference evapotranspiration θfc θwp and θa are the field water capacity the wilting coefficient and the average volumetric soil water content respectively b is average fraction of total available soil water that can be depleted from the root zone before water stress when et0 5 mm d 1 for the apple tree b 0 5 according to allen et al 1998 2 7 path analysis method path analysis was proposed by the geneticist wright 1934 and it can be applied to study the relationships between variables in multivariate statistical analysis path analysis can decompose the interactions correlation coefficients between causal variables into direct effects direct path coefficients and indirect effects indirect path coefficients in order to analyze the direct and indirect importance of independent variables for dependent variables jiang et al 2020 xu et al 2020 for a correlated system with one dependent variable y and numerous independent variables xi i 1 2 n the multivariate nonlinear equation is expressed as follows 25 y a 0 a 1 x 1 a 2 x 2 a n x n i 1 2 n where y represents the dependent variable x i represents the i th independent variable and a i represents the partial regression coefficient of variable x i to y by substituting the actual observed values into eq 25 the standard matrix equation can be established by solving the mathematical transformation of the equations through the least square method 26 1 r x 1 x 2 r x i x n r x 2 x 1 1 r x 2 x n r x n x 1 r x n x 2 1 p x 1 y p x 2 y p x n y r x 1 y r x 2 y r x n y where r x i x j represents the correlation coefficient of variable x i and x j and p x i y represents the direct path coefficient expressing the direct effect of variable x i on y 27 p x i y a i σ x i σ y i 1 2 n where σ x i and σ y represent the standard deviations of x i and y respectively and r x i x j p x i y represents the indirect path coefficient expressing the indirect effect of variable x i through variable x j on y the remaining variables represent the effects of other independent variables and errors on the dependent variable y and the path coefficient pey is calculated as follows 28 p ey 1 r x 1 y p x 1 y r x 2 y p x 2 y r x n y p x n y 2 8 model evaluations statistical accuracy indicators comprising the coefficient of determination r2 nash sutcliffe efficiency coefficient nse relative root mean square error rrmse feng et al 2017a 2017b and global performance indicator gpi feng et al 2019 were used to evaluate the models these indicators are defined as follows 29 r 2 i 1 n y i y x i x i 1 n y i y 2 i 1 n x i x 2 2 30 n s e 1 i 1 n y i x i 2 i 1 n x i x 2 31 r r m s e 1 n i 1 n y i x i 2 1 n i 1 n y i 32 g p i j 1 m α j s i j s i m e d i a n where x i and y i are the ith measured value and estimated value respectively x and y represent the corresponding mean values sii is the normalized value of r2 nse and rrmse simedian is the median of the corresponding parameter m is the number of statistical indicators α i is equal to 1 for r2 and nse and equal to 1 for rrmse 3 results 3 1 variations of daily meteorological tree and soil factors in the growth stage the changes in the daily vpd rn ta lai and swc were investigated in order to quantify the variations of tree meteorological and soil factors in the growth period of apple tree on the loess plateau in experimental years i e wuwei during 2008 2010 changwu during 2012 2014 and taigu during 2015 2017 fig 3a shows the variations of the daily vpd in the growth period of wuwei 2008 2010 changwu 2012 2014 and taigu 2015 2017 the variations of the vpd were unimodal and they ranged among 0 1 2 1 kpa at wuwei 0 8 3 2 kpa at changwu and 1 0 3 9 kpa at taigu with average values of 1 1 kpa 1 7 kpa and 2 2 kpa respectively the maximum vpd often occurred on day of year doy 183 238 from july to august each year fig 3b shows the variations of the daily rn in the growth period of wuwei 2008 2010 changwu 2012 2014 and taigu 2015 2017 the maximum rn occurred on doy 180 doy 170 and doy 210 with ranges of 22 2 217 6 w2 m 2 at wuwei 40 6 233 4 w2 m 2 at changwu and 37 2 296 5 w2 m 2 at taigu respectively as shown in fig 3c that the trends in ta were similar to those in rn with ranges of 2 0 26 5 c at wuwei 4 3 24 9 c at changwu and 11 9 28 6 c at taigu with the means of 17 2 c 17 6 c and 21 4 c in the growth period of apple tree respectively fig 3d shows that the soil water content fluctuated significantly under the influences of irrigation rainfall and evapotranspiration during the apple tree growth season with values ranging between 19 7 and 31 3 at wuwei 13 7 26 1 at changwu and 16 4 26 9 at taigu respectively according to eq 24 the values of ks at wuwei in 2008 2010 were all higher than 1 00 in terms of changwu the values of ks ranging between 0 71 and 1 00 in 2012 0 91 1 00 in 2013 and 0 92 1 00 in 2014 in terms of taigu the values of ks ranging between 0 77 and 1 00 in 2015 0 81 1 00 in 2016 and 0 77 1 00 in 2017 see specific values of ks at three stations in table s1 as shown in fig 3e that the apple tree lai values followed a regular parabolic curve and the maximum lai value at wuwei station was 1 77 m2 m 2 doy 179 in 2008 2 24 m2 m 2 doy 210 in 2009 and 1 96 m2 m 2 doy 208 in 2010 at changwu station was 1 95 m2 m 2 doy 190 in 2012 1 84 m2 m 2 doy 195 in 2013 1 94 m2 m 2 doy 201 in 2014 and at taigu station was 1 48 m2 m 2 doy 228 in 2015 1 47 m2 m 2 doy 247 in 2016 and 1 58 m2 m 2 doy 235 in 2017 after it reached the maximum the lai kept relatively stable until the end of the growth stage therefore we applied lai lai max as the threshold to divide the whole growth stage of apple tree into the partial canopy and dense canopy according to experimental observations at three stations the growth stage division of each year at wuwei changwu and taigu were listed in table 2 fig 3f shows the variations in the daily tsf were unimodal at each site with the range of 1 1 6 0 mm d 1 at wuwei 2008 2010 0 8 3 2 mm d 1 at changwu 2012 2014 and 0 4 6 8 mm d 1 at taigu 2015 2017 and the corresponding three year average values were 3 2 mm d 1 1 9 mm d 1 and 3 8 mm d 1 in the growth period of apple tree respectively with the development of the apple tree growth stage the daily tsf increased from 1 3 to 1 9 mm day 1 at wuwei 0 8 1 7 mm day 1 at changwu and 0 5 1 3 mm day 1 at taigu in early growth stage gradually peaked to 4 6 6 0 mm day 1 at wuwei doy 162 160 and 164 2 7 3 2 mm day 1 at changwu doy 189 220 and 196 and 5 6 6 8 mm day 1 at taigu doy 218 207 and 219 following gradually decreased to 1 5 2 2 mm day 1 at wuwei 0 8 1 0 mm day 1 at changwu and 1 6 2 0 mm day 1 at taigu 3 2 quantification of effects of tree meteorological and soil factors on daily transpiration based on path analysis path analysis explained 68 76 68 78 and 74 85 of the daily variations in transpiration across different sites p 0 001 fig 4 during the partial canopy stage dense canopy stage and whole growth stage respectively thereby indicating that the factors considered effectively explained much of the seasonal variability in daily transpiration on the loess plateau therefore transpiration models based on these factors could perform very well however the effects of meteorological tree and soil factors on the variations in the sap flow rate varied among growth stages and sites fig 4 the correlation coefficientin table 3 shows that lai had the main positive total effect on transpiration followed by vpd rn ta and swc with total effects ranging among 0 71 0 86 0 68 0 73 0 62 0 69 0 52 0 65 and 0 25 0 35 in the partial canopy stage and 0 66 0 71 0 60 0 67 0 52 0 58 0 41 0 55 and 0 19 0 31 in the whole growth stage therefore the tree factor lai was the most critical factor except in the dense canopy stage in the dense canopy stage vpd was the main positive regulator of transpiration total effects ranging among 0 85 0 89 and rn and ta were critical in the indirect effect path table 3 more importantly the total effect of meteorological factors i e vpd ta and rn on transpiration in different growth stages was more significant than that of lai thereby demonstrating that the daily transpiration was primarily driven by meteorological factors on the loess plateau in particular rn had direct effects in the partial canopy stage and the whole growth stage with direct coefficients of 0 37 p 0 05 and 0 34 p 0 05 respectively and the direct r 0 31 p 0 05 and indirect r 0 35 p 0 05 effect on transpiration were both significant positive in the dense canopy stage at wuwei station whereas ta had a direct effect in the partial canopy stage with a direct coefficient of 0 32 p 0 05 and played positive indirect effect on transpiration through vpd in the dense canopy stage and the whole growth stage significantly with indirect coefficients of 0 34 p 0 05 and 0 32 p 0 05 at wuwei station respectively however rn and ta had more consistent significant positive indirect effects through vpd on the variations in transpiration among different growth stages at changwu and taigu stations table 3 these results demonstrate that vpd was the most important meteorological factor that generally affected transpiration in the dense canopy stage at wuwei station swc had no significant effects on apple tree transpiration total effects ranged among 0 25 0 12 p 0 05 in wuwei presumably because the soil water content was adequate 20 and thus the soil water content was not sufficient to have a significant effect in addition swc had consistent significant positive effects on the transpiration variations in changwu and taigu table 3 presumably because the soil water content was insufficient 20 3 3 comparisons of daily transpiration estimating models using the complete input combination the traditional models used for estimating transpiration have limitations because complete sets of meteorological soil and tree data are required in order to evaluate the possibility of using deep learning models to replace the traditional models we compared empirical physical and dnn models using complete input combinations i e the input variables were the same for all models to calculate the transpiration in different growth stages table 4 shows the statistical indicators obtained by mlr mjs s w dbn lstm rnn and r l rnn based on the estimations of the daily apple tree transpiration using the complete input data combinations according to table 4 s w obtained the most accurate estimates of the daily transpiration in different growth stages among the empirical models followed by mjs and mlr successively with the median r2 nse and rrmse values ranging among 0 79 0 86 0 70 0 77 and 0 16 0 19 in the partial canopy stage respectively 0 76 0 82 0 67 0 72 and 0 16 0 17 in the dense canopy stage and 0 65 0 74 0 53 0 64 and 0 17 0 19 in the whole stage compared with mlr the r2 nse and rrmse values of s w improved by 26 8 144 7 38 0 190 9 and 35 1 53 8 in the partial canopy stage respectively 20 3 69 0 26 4 110 1 and 17 7 58 0 in the dense canopy stage and 35 6 60 0 41 1 66 7 and 13 4 42 1 in the whole stage compared with mjs the r2 nse and rrmse values of s w improved by 3 7 15 6 2 5 12 8 and 4 1 16 6 in the partial canopy stage respectively 6 6 21 0 5 1 9 0 and 1 9 11 0 in the dense canopy stage and 12 9 30 5 19 1 51 9 and 14 2 20 6 in the whole stage since s w was the best empirical model in this study we compared the accuracy of the estimates obtained by the s w r l rnn lstm rnn and dbn to evaluate the performance of the dnn models the gpi values in the partial canopy stage were ranked in the order of r l rnn lstm rnn dbn s w table 4 among the dnn models r l rnn obtained the most accurate estimates of the daily transpiration in different growth stages with median r2 nse and rrmse values ranging among 0 94 0 96 0 93 0 96 and 0 04 0 09 in the partial canopy stage respectively 0 94 0 96 0 94 0 96 and 0 05 0 07 in the dense canopy stage and 0 88 0 91 0 84 0 90 and 0 11 0 17 in the whole stage followed by lstm rnn and dbn compared with r l rnn the r2 values under s w dbn and lstm rnn decreased by 9 2 17 4 3 3 4 7 2 3 3 7 in the partial canopy stage respectively 14 2 21 1 3 8 4 8 and 3 2 5 7 in the dense canopy stage and 16 4 28 7 4 0 6 8 and 5 4 9 0 in the whole stage in addition compared with r l rnn the nse values under s w dbn and lstm rnn decreased by 19 9 25 5 2 9 5 4 and 2 0 4 8 in the partial canopy stage respectively 25 5 28 3 4 4 9 2 and 4 2 5 2 in the dense canopy stage and 24 9 37 2 5 0 9 5 and 10 0 11 0 in the whole stage moreover compared with r l rnn the rrmse values under s w dbn and lstm rnn increased by 107 8 307 5 14 7 140 0 and 8 8 38 9 in the partial canopy stage respectively 145 7 217 6 31 4 80 4 and 25 7 68 6 in the dense canopy stage and 16 8 68 5 5 6 30 6 and 7 5 31 5 in the whole stage except for mlr the statistical indicators obtained for all of the transpiration models i e mjs s w dbn lstm rnn and r l rnn were significantly lower under complete input combination in the whole growth stage than the partial and dense canopy stages in the partial canopy stage the r2 nse and rrmse values improved by 15 4 39 4 23 6 82 5 and 9 1 22 8 under mjs respectively by 16 1 22 3 9 8 35 6 and 8 1 11 7 under s w by 6 7 9 9 11 6 14 3 and 12 2 54 1 under dbn by 8 3 12 8 13 3 21 1 and 12 6 62 7 under lstm rnn and by 5 6 7 5 6 8 10 9 and 25 0 63 0 under r l rnn compared with the whole growth stage in the dense canopy stage the r2 nse and rrmse values improved by 9 2 24 4 15 8 76 3 and 16 1 30 7 under mjs respectively by 8 7 17 5 5 7 29 5 and 1 0 14 8 under s w by 6 0 9 9 5 9 14 3 and 37 4 45 9 under dbn by 8 2 11 8 14 3 19 3 and 38 5 52 1 under lstm rnn and by 5 7 9 0 7 3 12 4 41 7 68 3 under r l rnn compared with the whole growth stage in general the results demonstrated the r l rnn model obtained the most accurate estimates of the daily transpiration under complete input combination followed by lstm rnn dbn s w mjs mlr in the partial and dense canopy stage and by dbn lstm rnn s w mjs mlr in the whole growth stage 3 4 comparisons of daily transpiration estimating models using incomplete input combinations in order to systematically evaluate the accuracy of the dnn at estimating transpiration we also conducted comparisons with models using 30 incomplete input combinations clearly the statistical indicators i e r2 nse and rrmse differed significantly among the models and stages fig 5 presents the statistical results for the dbn lstm rnn and r l rnn models when used to estimate the daily apple tree transpiration with 30 incomplete input combinations in different growth stages according to fig 5 r l rnn obtained the most accurate estimates of the daily transpiration with 30 incomplete input combination in different growth stages with median r2 nse and rrmse values ranging among 0 77 0 80 0 63 0 64 and 0 14 0 24 in the partial canopy stage respectively 0 71 0 77 0 57 0 69 and 0 15 0 16 in the dense canopy stage and 0 68 0 73 0 50 0 58 and 0 19 0 26 in the whole growth stage compared with r l rnn the median r2 values under dbn and lstm rnn decreased by 16 1 27 1 and 7 5 16 5 the nse values decreased by 23 2 73 3 and 8 8 32 6 and the rrmse values increased by 16 1 26 7 and 13 1 25 5 in the partial canopy stage under 30 incomplete input combinations where the corresponding median values of r2 nse and rrmse under dbn ranged among 0 63 0 67 0 36 0 51 and 0 19 0 29 respectively and those under lstm rnn ranged among 0 67 0 73 0 48 0 58 and 0 19 0 28 respectively in the dense canopy stage the median r2 values under dbn and lstm rnn decreased by 4 1 19 1 and 2 3 8 0 the nse values decreased by 4 6 50 0 and 2 0 10 0 and the rrmse values increased by 3 9 15 5 and 1 8 14 0 under 30 incomplete input combinations where the corresponding median values of r2 nse and rrmse under dbn ranged among 0 63 0 73 0 42 0 58 and 0 16 0 19 respectively and those under lstm rnn ranged among 0 69 0 75 0 56 0 67 and 0 16 0 19 respectively similar results were obtained in the whole growth stage where the median r2 values under dbn and lstm rnn decreased by 4 8 18 4 and 19 7 27 1 respectively compared with r l rnn the nse values decreased by 10 9 45 1 and 20 3 83 4 and the rrmse values increased by 7 2 15 5 and 8 8 16 9 in addition the median r2 nse and rrmse values under all of the dnn models i e dbn lstm rnn and r l rnn were significantly lower in the whole growth stage than the partial or dense canopy stages in the partial canopy stage the r2 nse and rrmse values improved by 2 0 3 7 1 4 12 9 and 1 0 17 7 under dbn respectively by 18 1 20 3 13 7 67 4 and 4 1 20 4 under lstm rnn and by 8 1 13 1 11 2 25 4 and 8 7 28 6 under r l rnn compared with the whole growth stage in the dense canopy stage the r2 nse and rrmse values improved by 1 9 18 4 16 2 21 6 and 19 5 32 2 under dbn respectively by 20 7 24 8 38 9 100 2 and 23 4 34 5 under lstm rnn and by 2 6 6 9 14 7 20 1 and 17 3 38 2 under r l rnn compared with the whole growth stage these results demonstrated the r l rnn model obtained the most accurate estimates of the daily apple tree transpiration using 30 incomplete input combinations followed by lstm rnn dbn in the partial and dense stage and dbn lstm rnn in the whole growth stage generally see specific accuracy results of 31 input combinations for three dnn models in table s2 3 5 evaluation of input variables used in deep learning models at different growth stages the r l rnn model obtained the highest accuracy with various input combinations and we also found that the accuracy of the estimations produced by the dnn models increased exponentially with the number of input variables fig 6 thereby indicating that the dnn models were more effective when more complex relationships existed between the multivariate inputs and output at all sites in particular the median r2 values for the dnn models were 0 85 range 0 82 0 91 0 81 range 0 60 0 90 0 74 range 0 54 0 86 0 54 range 0 06 0 82 and 0 36 range 0 01 0 65 as the number of input variables decreased from five to one respectively in the whole growth stage in addition the median nse values were 0 80 range 0 75 0 90 0 72 range 0 36 0 89 0 57 range 0 26 0 83 0 27 range 2 06 0 75 and 0 01 range 6 90 0 57 as the number of input variables decreased from five to one respectively in the whole growth stage the simulation error of the model increased as the number of input variables decreased from five to one in the whole growth stage with median rrmse values of 0 14 range 0 11 0 17 0 17 range 0 11 0 28 0 20 range 0 13 0 30 0 28 range 0 17 0 90 and 0 33 range 0 23 0 95 respectively thus using more input variables improved the accuracy of the estimates obtained by the dnn models and using all of the variables as inputs obtained the best performance by all models in all of the different growth stages in addition we found that the specific input variables had significantly different effects on the daily apple tree transpiration estimates in different growth stages in particular in the partial canopy stage fig 7 the r2 values under the dnn improved by 57 4 70 0 27 5 66 5 18 9 52 8 12 3 48 1 and 5 4 47 1 when we included lai vpd rn ta and swc respectively compared with the transpiration models that excluded the corresponding variable as inputs and the corresponding median values were 0 82 0 87 0 82 0 85 0 77 0 83 0 76 0 83 and 0 75 0 82 at all sites i e wuwei changwu and taigu comparisons of the nse values also resulted in a similar conclusion where the median nse values under the dnn ranged among 0 73 0 76 0 72 0 73 0 62 0 70 0 58 0 69 and 0 54 0 61 when we included lai vpd rn ta and swc respectively whereas the median values when these variables were excluded decreased by 46 3 65 8 47 0 62 7 32 0 59 2 26 7 49 0 and 3 6 20 4 moreover the median rrmse values under the dnn were 0 20 0 31 0 22 0 34 0 20 0 32 0 19 0 31 and 0 19 0 27 when we included lai vpd rn ta and swc respectively with the improvement of 52 0 74 0 72 9 87 1 36 3 57 5 32 7 43 8 and 5 1 40 0 compared to the scenario of corresponding input variable excluded respectively in general the importance of the input variables when estimating the transpiration in the partial canopy stage using the dnn followed the order of lai vpd rn ta swc the apple tree entered the dense canopy stage when lai exceeded laimax and relationships between the meteorological soil and tree factors with transpiration changed significantly thus it was important to determine the importance of the input variables for estimating the daily apple tree transpiration in the dense canopy stage using the dnn models we found little difference in the performance of the dnn models at estimating transpiration in the dense canopy stage under different input combinations when we included or excluded lai because transpiration is mainly controlled by atmospheric factors in the dense canopy stage however the r2 nse and rrmse values for the models using input combinations that included vpd were significantly improved by 25 7 34 1 29 4 59 1 and 28 3 142 3 respectively with median values of 0 80 0 83 0 73 0 77 and 0 12 0 16 compared with the models that excluded vpd as inputs moreover the results indicated that rn and ta were of similar importance for improving the accuracy of the daily transpiration estimates obtained by the dnn models the r2 nse and rrmse values for dnn models that used input combinations including rn improved by 19 2 30 3 23 4 46 1 and 16 0 74 9 respectively with median values of 0 79 0 81 0 69 0 75 and 0 15 0 16 in terms of ta the r2 nse and rrmse values of dnn models improved by 20 1 23 7 24 1 42 6 and 11 5 53 6 respectively with median values of 0 76 0 80 0 69 0 74 and 0 15 0 17 in general the importance of the input variables for estimating transpiration in the dense canopy stage using the dnn models followed the order of vpd rn ta lai swc however including swc only significantly improved the accuracy of the daily transpiration estimates in changwu and taigu and not wuwei fig 8 fig 9 shows box plots illustrating the effects of including or excluding lai vpd rn ta and swc as input variables in the input combinations when estimating transpiration in the whole growth stage using dnn models the box plots show that the median r2 values were highest when lai was included followed by vpd rn ta and swc where the corresponding median values were 0 76 0 79 0 74 0 75 0 72 0 74 0 69 0 73 and 0 66 0 73 respectively similar results were obtained in terms of the nse values where the importance of the input variables when estimating transpiration using the dnn models followed the order of lai vpd rn ta swc with median values of 0 62 0 72 0 57 0 63 0 51 0 60 0 50 0 57 and 0 48 0 54 respectively excluding lai vpd rn ta and swc also significantly affected the rrmse values when estimating transpiration using the dnn models where the median rrmse values increased by 51 8 69 2 22 8 50 7 20 1 37 6 14 9 42 8 and 3 9 24 2 respectively therefore the importance of the input variables when estimating transpiration in the whole growth stage using the dnn models followed the order of lai vpd rn ta swc 4 discussion 4 1 reasons for accuracy differences using different model types according to our results the deep learning based models performed significantly better than the traditional models at estimating transpiration using consistent combinations of inputs table 4 similarly chen et al 2020a reported that lstm dnn and tcn performed better than empirical models at estimating the et0 values ferreira et al 2019 also found that dnn performed better than the hargreaves equations at estimating et0 values with incomplete meteorological input data in brazil however these previous studies only evaluated the performance of dnn and empirical models at estimating et0 values xu et al 2017 developed an ann model for estimating the daily transpiration by desert shrubs and showed that the ann model performed better than an empirical model moreover fan et al 2021 found that dnn was most effective at estimating the daily maize transpiration in northwest china thus the differences in the accuracy of dnn and empirical models when estimating the daily transpiration are presumably because the deep learning models are black box models that are not limited by the model structure and thus they are more flexible thereby effectively reducing the cognitive uncertainty due to the complex nonlinear relationships between transpiration and various factors compared with empirical models furthermore as expected the r l rnn model achieved better accuracy by coupling rbm and lstm rnn where the rbm is better at extracting features from input combinations and the lstm rnn model is more suitable for solving time series problems the rbm is a retraining model for the dbn and this markov random field model plays a vital role in the field of deep learning ma et al 2022 because the extraction of features affects the accuracy of the prediction model by improving the interpretability of input data zhang et al 2021 the lstm rnn model can continuously adjust the network structure update the state by learning the complex relationships between transpiration and various factors based on historical data mohanty et al 2020 in addition we found that the dbn ranked based on gpi higher in the whole growth period whereas the lstm rnn was more suitable than dbn for modeling in the partial and dense canopy stages table 4 these results are important because they demonstrate that modeling in different growth stages can effectively reduce the noise of input variables whereas modeling in the whole growth stage can reduce the interpretability of effective information in historical data therefore the r l rnn is more suitable for daily transpiration estimation because of its advantages at modeling the complex nonlinear relationships between transpiration and related variables by coupling rbm with the lstm rnn 4 2 reasons for accuracy differences using various input combinations the accuracy of the transpiration estimates obtained by dnn models differed significantly under various input combinations according to the statistical indicators fig 5 similarly fan et al 2021 found that including swc and or lai in machine learning models is highly recommended for obtaining accurate daily maize transpiration estimates ellsäßer et al 2020 opted for a randomization based permutation test to estimate the importance of each predictor variable on the oil palm agroforest in lowland sumatra and the result showed that the numbers of most important variables that explain 95 of the ml model outcome are highly variable li et al 2009 constructed a generalized regression neural network grnn model for cherry transpiration and they concluded that of swc par photosynthetically active radiation and vpd had a major impact on prediction of grnn shan et al 2020 also found that mars and bpnn models performed significantly better than empirical models at maize transpiration estimation under various input combinations in different growth stages furthermore we found that the r2 nse and rrmse values improved to different extents when lai vpd rn ta and swc were included in the dnn models compared with models that excluded these variables as inputs as shown in figs 7 9 which are consistent with the results that we obtained by path analysis in general the importance of the input variables for estimating transpiration using the dnn models followed the order of lai vpd rn ta swc in the partial canopy stage and vpd rn ta lai swc in the dense canopy stage which agreed with the correlation coefficients between transpiration and related factors table 3 furthermore we found that incorporating soil water content values as inputs in the dnn models was critical for satisfactorily estimating the variations in transpiration especially under limited soil water conditions e g swc ranged among 13 7 26 1 in changwu and 16 4 26 9 in taigu fig 3 similar conclusions were made in previous studies chen et al 2020c harris et al 2004 this study found that the performance of the dnn models differed significantly among sites when estimating transpiration because the linear relationships between transpiration and various factors might not have been the best fits thereby introducing uncertainty when estimating transpiration liu et al 2020 found that the importance of swc in the models also changed dramatically under different water management conditions and the difference in seasonal variation of etc act among different regions can be ascribed to rice phenological traits and irrigation treatments this study found that the differences in the water management conditions had important effects on the accuracy of the dnn models when estimating transpiration because that forces acting on the soil water decrease its potential energy and make it less available for plant root extraction and thus the soil water stress conditions impacts apple tree transpiration similar to the conclusion drawn from this study it is recommended to introduce the water stress coefficient ks to describe the effects of soil water stress on etc act by fao allen et al 1998 when the potential energy of the soil water content drops below a threshold value specifically for soil water limiting conditions ks 1 where there is no soil water stress ks 1 at wuwei station the irrigation amount satisfied the water consumption demand adequately 65 100 θfc and there was theoretically no effect of soil water stress on transpiration theoretically ks 1 the swc had therefore a smaller effect on transpiration estimates compared to other variables in this station however the lower limit values of ks at changwu and taigu ranged between 0 71 and 0 92 and 0 77 0 81 respectively table s1 and the inadequate irrigation or rainfed culture could have resulted in the transpiration being limited by the soil water stress condition that is the soil water has low potential energy and is strongly bound by capillary and absorptive forces to the soil matrix and is less easily extracted by the tree apple tree transpiration was mainly controlled by meteorological factors rather than by tree factors or soil factors table 3 vpd was the main positive regulator of transpiration in the dense canopy stage moreover lai had consistent and main positive total effects in the partial and whole growth stages the effect of swc may have been related to the degree of soil water deficit and the irrigation scheduling specially the importance of the input variables followed the orders of lai vpd rn ta swc in the partial and whole canopy stage and vpd rn ta lai swc in the dense canopy stage figs 7 8 the different seasonal variations in transpiration among regions may have been related to variations in the phenological traits of apple tree varieties and different irrigation treatments our results are in good agreement with those obtained by other researchers fan et al 2021 concluded that transpiration is all controlled by atmospheric demand soil water availability as well as plant growth condition chen et al 2020b suggested that average and maximal air temperature relative humidity solar radiation leaf area and soil temperature were important features which affect maize evapotranspiration li et al 2016b concluded that mjs models should be fit by different growing season in order to obtaining better performance because the sensitivity of canopy resistance to different influencing factors changed at different periods 4 3 reasons for accuracy differences at different growth stages our conclusion that the accuracy of transpiration estimation models existed significant difference between the divisive growth stage and the whole growth stage is consistent with previous studies shan et al 2020 built the mars at four crop growth stages and the whole growth period of maize for estimating etc act and they found not all input combination performed better at the whole growth period than at four growth stages pereira et al 2016 found that the mjs model was suitable in the summer where the slope of the regression of the model versus the observed values was 0 92 but it did not perform as well in the winter in general the s w model is considered more suitable for sparse crops that are not densely distributed li et al 2015 liu et al 2020 in the present study the s w model was most accurate at estimating the transpiration among the traditional models and it performed better in the dense canopy stage table 4 was also found in previous studies moreover the statistical indicators for the traditional transpiration models were significantly lower in the whole growth stage than the partial and dense canopy stages similar results were obtained with the dnn models using various input combinations thus the accuracy of transpiration estimation using both physically based models and dnn models exhibited significant seasonality but the reasons for the differences in the accuracy of these models in different plant growth stages have rarely been studied the meteorological and tree variables soil water content and transpiration varied seasonally fig 3 and thus the relationships between transpiration and these factors also differed significantly where lai and vpd primarily controlled transpiration according to path analysis when lai laimax was treated as the threshold for separating the apple tree growth stages as shown in figs 3 4 although lai increased sharply and had the main total positive effect on transpiration during the partial canopy stage the changes in lai slowed down and meteorological factors gradually dominated after entering the dense canopy stage and vpd became the main factors that affected transpiration in this growth stage the differences in the main drivers of transpiration among growth stages affected the accuracy of the transpiration estimates thereby emphasizing the need to recognize actual effects when constructing a transpiration model for different growth period similarly li et al 2016b concluded that fitting the parameters in the mjs model according to lai thresholds can improve the accuracy of etc act estimations moreover physiologically related model parameters for plants can vary according to plant organ e g leaf expansion aging and senescence whitley et al 2013 wilson et al 1994 furthermore plants generally experience and acclimatize to various biotic and abiotic stresses during their development which can also lead to changes in the relevant parameter values that are crucial for long term modeling xu et al 2020 zhu et al 2011 in general using fixed parameter values in traditional models for estimating transpiration throughout the whole growth stage can lead to overestimates of the transpiration values in the dense canopy stage but underestimates of the transpiration values in the partial canopy stage in addition it should be noted that the interpretability of a dnn model is worse when the structure of the model is more complex fan et al 2021 moreover data uncertainty has important effects on the interpretability of machine learning models the environment is random and longer time series of data will not reduce the uncertainty because the noise is inherent in the data therefore it may be appropriate to construct dnn models to estimate apple tree transpiration in different growth stages 4 4 analysis of uncertainties and applications due to the limitations of existing observation techniques and data processing methods there is significant uncertainty in the observation data which significantly affects the accuracy of model simulation despite machine failure or human operation will introduce uncertainty to meteorological observation data and the data processing method is the main factor for the uncertainty of swc and lai the measurement period of lai was 5 7 days in this study and interpolated to the daily scale by using the method of the fitting curve although the accuracy of fitting curve reaches more than 0 9 fig 3 the data error caused by interpolation will still lead to the uncertainty of the estimated model moreover the linear interpolation method is used for soil water data and the data outside the observation time is uncertain although the method has been widely used regarding observation data of the transpiration the thermal diffusion probe method used in this study is praised as the most wonderful method for measuring liquid flow velocity because of its simple operation continuous monitoring and less environmental damage zimmermann 1983 however the holes must be drilled in the trunk in order to install the thermal diffusion probe which will damage the normal liquid flow in the xylem of apple tree which is one of the reasons why the measured value of the probe method is smaller than the whole tree potometer measurement alla et al 2022 in addition a zero point is required as a benchmark when converting sapwood sap flow rate by the thermal diffusion probe method that is the rising sap flow at this time is considered to be zero gutierrez and santiago 2006 according to the monitoring results of the whole tree potometer measurement pasqualotto et al 2019 there is still water consumption when sapwood sap flow rate is zero which leads to a measurement error another reason of uncertainties is that the thermal diffusion probe method cannot detect the temperature difference between the heating probe and the reference probe when the rising sap flow is very weak and lasts for a long time although the whole tree potometer measurement has high precision the operability is poorer than the thermal diffusion probe method the measurement of tree transpiration water consumption by the thermal diffusion probe method is still reliable but it should still be paid attention to when using the method is applied to determine irrigation schedules according to mjs and sw model this study choose vpd rn ta swc and lai as input variables for dnn models and the path analysis method can explain 68 76 73 89 and 74 85 of the daily transpiration variations during different growth stage at wuwei changwu and taigu respectively fig 4 that is the insufficient input variables is the potential cause of uncertainty in model accuracy despite variables in this study shan et al 2020 further used plant height ground cover and wind speed as input of machine models to estimate evapotranspiration of summer maize and they found the models with plant height ground cover and lai performed better chen et al 2020b used daily maximal and minimal air temperature wind speed maize leaf area maize height soil water and soil temperature as input parameters to develop dnn models for maize etc act and the result showed the plant height mean temperature maximal temperature relative humidity solar radiation leaf area index and soil temperature are the most important features affecting maize et since the tree transpiration depends on the water available to the plant and the different soil types can have different amounts of plant available water at the same water content levels it will be possible to render better results of transpiration estimation by taking plant available water as input instead of swc thus it is necessary for further testing other variables as input of dnn models in the future to improve the accuracy and reliability in transpiration simulation this study found that the dnn models segmented according to the growth stage obtained more accurate estimated transpiration although the threshold according to maximum value of lai had been successfully applied in this study other researchers put forward different views allen et al 1998 recommend a description of growth stages for perennial fruit tree crops that is development stage partial canopy mid stage full canopy and late stage leaf fall started to estimate water use for irrigation purposes li et al 2016b proposed different growth stage segmented methods based on lai and they concluded that p m model penman monteith model had better performance in estimating etc act when building the model by dividing the growing season of maize into two periods according to the lai threshold of 0 5 m2 m 2 wu et al 2022 found the accuracy of estimated maize etc act was effectively improved by adopting the lai 0 5 m2 m 2 as threshold segmentation method at yucheng and the accuracy of etc act segmentally simulated was highest when lai 1 0 m2 m 2 at yangling and shangqiu stations according to these studies the selection of the threshold value dividing the growth stage is a potential factor causing the uncertainty of the model estimation results and exploring a more realistic choice of canopy development stages may result in better transpiration estimates based on dnn models which is essential research directions in the future 5 conclusions in this study we aimed to construct a suitable deep learning model for estimating apple tree transpiration to improve the accuracy of simulations using 31 input combinations based on the all subset strategy as well as to understand the accuracy differences among different model types input combinations and growth stages the main findings obtained in this study are summarized as follows 1 path analysis results indicated that the factors considered effectively explained the variability of the daily transpiration in the growth period of apple tree which was mainly driven by meteorological factors on the loess plateau leaf area index and vapor pressure deficit mainly affected apple tree transpiration in the partial and dense canopy stages respectively the importance of soil water content in the deep learning models also varied significantly among different water management conditions 2 the long short term memory recurrent neural network improved with multiple restricted boltzmann machines obtained the most accurate estimates of daily apple tree transpiration among the different model types and the deep learning models were generally more accurate than the traditional models under complete input combination 3 the long short term memory recurrent neural network improved with multiple restricted boltzmann machines obtained the most accurate estimates of the daily transpiration with 30 incomplete input combination in different growth stages followed by deep belief network and long short term memory recurrent neural network the apple tree transpiration models were significantly more accurate in the partial and dense canopy stages than the whole growth stage 4 the accuracy of the estimates obtained using deep learning models increased exponentially with the number of input variables and the specific input variables applied also significantly affected the daily transpiration estimates the importance of the input variables when estimating transpiration using the deep learning models followed the orders of leaf area index vapor pressure deficit net solar radiation average air temperature soil water content in the partial and whole canopy stage and vapor pressure deficit net solar radiation average air temperature leaf area index soil water content in the dense canopy stage declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgement this work was funded by the national key research and development program of china 2016yfc0400206 the national natural science foundation of china 51922072 51779161 51009101 and the fundamental research funds for the central universities 2018cdpzh10 2016cddy s04 scu 2017cdlz n22 appendix a supporting information supplementary data associated with this article can be found in the online version at doi 10 1016 j agwat 2022 107889 appendix a supplementary material supplementary material 
9301,quantitatively characterizing and accurately predicting plant transpiration are of great significance but directly measuring transpiration is impractical time consuming and labor intensive this study compared the transpiration estimation performance of multiple linear regression mlr modified jarvis stewart mjs and shuttleworth wallace s w with deep belief network dbn long short term memory recurrent neural network lstm rnn and lstm rnn improved with multiple restricted boltzmann machines r l rnn using 31 input combinations comprising complete subsets of vapor pressure deficit vpd net solar radiation rn average air temperature ta soil water content swc and leaf area index lai observations collected at wuwei changwu and taigu stations on the loess plateau in china the results showed that r l rnn obtained the most accurate estimations in the partial canopy stage dense canopy stage and whole growth stage compared to mlr mjs s w dbn and lstm rnn the accuracy of the deep learning models dnn increased exponentially as the number of input variables increased and the importance of the input variables followed the orders of lai vpd rn ta swc in the partial and whole canopy stage and vpd rn ta lai swc in the dense canopy stage the apple tree transpiration models were more accurate in the partial and dense canopy stages than the whole growth stage the coefficient of determination and nash sutcliffe efficiency coefficient for the r l rnn model increased by 8 1 13 1 and 11 2 25 4 in the partial canopy stage respectively and by 2 6 6 9 and 14 7 20 1 in the dense canopy stage whereas the relative root mean square error decreased by 8 7 28 6 and 17 3 38 2 overall r l rnn is the most recommended model for estimating the apple tree transpiration because it is such a simple method that agricultural water managers can easily determine the water consumption of apple trees using limited accessible observational data keywords hybrid deep learning model empirical model path analysis growth stage input variable data availability the authors do not have permission to share data nomenclature variables a total available energy to the substrate w m 2 as available energy to the substrate w m 2 aw cross sectional area of the water conducting sapwood m2 ai biases of the ith visible layer element bi biases of the jth hidden layer element cc canopy resistance coefficient cs soil surface resistance coefficient cp specific heat of dry air at constant pressure j kg 1 1 e soil evaporation mm ft forget gate f vpd constraint functions for vpd f rn constraint functions for rn f ta constraint functions for ta f θa constraint functions for θa f lai constraint functions for lai gpi global performance indicator h hidden layer it input gate i the ith visible layer node j the jth hidden layer node k the offset vector lai leaf area index m2 m 2 m number of statistical indicators nse nash sutcliffe efficiency coefficient ot output gate pmc canopy transpiration mm pms soil evaporation mm rh air relative humidity r2 coefficient of determination rrmse relative root mean square error rn net solar radiation w m 2 r correlation coefficient r a a aerodynamic resistances from the reference height to in canopy heat exchange plane height s m 1 r a s aerodynamic resistances from the reference height to the soil surface s m 1 r a c aerodynamic resistances of the canopy to in canopy flow s m 1 r s s soil surface resistance s m 1 r s c canopy resistance s m 1 sf sap flow rate mm s 1 st updated gate sii normalized value of r2 nse and rrmse simedian median of the sii ta average air temperature tmax maximum air temperature tmin minimum air temperature tsf tree transpiration mm tanh activation function vpd vapor pressure deficit kpa v visible layer w matrix composed of coefficients w weight of the visible layer and hidden layer xt input value of the current cell xi the ith independent variable yt output value of the current cell y dependent variable γ psychometric constant δ slope of the saturation water vapor pressure versus temperature curve θa actual volumetric soil water content m3 m 3 θwp wilting point soil water content m3 m 3 θfc field water capacity m3 m 3 λ latent heat of vaporization mj kg 1 λe latent heat flux of evaporation from the soil surface mj m 2 d 1 ξ learning rate ρ air density kg m 3 σ sigmoid activation function d a t a mathematical expectation of the characteristics of the training sample r e mathematical expectation of reconstructing the sample features after gibbs sampling abbreviations ann artificial neural network bpnn back propagation neural network bta simplified process based model cml classical machine learning model dbn deep belief network dnn deep learning model doy day of year etc act actual crop evapotranspiration et0 crop reference evapotranspiration fao food and agriculture organization of the united nations grnn generalized regression neural network lstm rnn long short term memory recurrent neural network mars multivariate adaptive regression splines model mjs modified jarvis stewart model mlr multiple linear regression model par photosynthetically active radiation rbm multiple stacked restricted boltzmann machines rf random forest r l rnn lstm rnn improved with multiple restricted boltzmann machines svm support vector machines s w shuttleworth wallace model swc volumetric soil water content tcn temporal convolution network 1 introduction the apple is the most widely cultivated fruit throughout the world wang et al 2020 according to the food and agriculture organization of the united nations fao china has become the largest global apple producer and it accounts for around 49 of the total production 87 106 t faostat 2019 the loess plateau area is the main apple producing region in china with 49 of the national yield because it provides the best photo thermal conditions for apple tree growth however seasonal drought low rainfall and unscientific irrigation management are the main limiting factors in this region wang et al 2020 in particular actual crop evapotranspiration etc act can reach 95 of the total water balance in northwest china hence accurate etc act calculations are essential for achieving the efficient utilization of regional water resources and ensuring the stable high yielding production of apples on the loess plateau evapotranspiration is closely related to eco hydrological processes in the soil plant atmosphere continuum fan et al 2021 so accurate etc act measurements or estimations especially the productive plant transpiration component are of great importance for yield prediction and irrigation schedule formulation in agricultural water management directly measuring plant transpiration using a stem sap flow gauge is impractical time consuming and labor intensive therefore numerous alternative methods have been widely applied for estimating transpiration based on related factors e g empirical physical and machine learning models fan et al 2021 zheng et al 2019 traditional plant transpiration simulations gradually developed from empirical models to tree process models empirical and physically transpiration models generally include multiple linear regression mlr fan et al 2021 tu et al 2019 modified jarvis stewart mjs nyolei et al 2021 zheng et al 2019 and shuttleworth wallace s w li et al 2015 nyolei et al 2021 however the applications of these mathematical transpiration estimation models are severely limited by the uncertainty caused by the model structure model parameters and measurement noise in addition traditional transpiration models exhibit complex nonlinearity which depends on numerous types of meteorological soil and tree observational data as well as their interactions consequently it is challenging to develop empirical or physical models that accurately represent the intrinsic transpiration mechanism as effective alternatives to traditional transpiration models machine learning models such as classical machine learning model cml artificial neural network ann and deep learning model dnn models have been successfully applied for estimating etc act and transpiration in various plant types where they are characterized as simple methods that readily find solutions with high precision and they can be constructed with limited data fan et al 2021 xu et al 2017 compared the performance of the mjs simplified process based bta and ann models and they found that the ann model performed better at etc act estimation than the mjs and bta models tu et al 2019 applied a back propagation neural network bpnn for estimating transpiration and showed that it obtained highly accurate sap flow estimations due to its superior adaptability to complicated nonlinear problems in recent years dnn have been successfully applied in various domains with excellent performance due to major advances in the calculation capacities of computers and in artificial intelligence theory dai et al 2021 dong et al 2022 however these models have rarely been applied in agriculture and hydrology particularly for predicting etc act chen et al 2020b developed a temporal convolution network tcn to estimate the etc act for irrigated maize based on meteorological soil and crop factors and they verified that the tcn could obtain high accuracy estimates of the maize etc act fan et al 2021 recently explored the suitability of cml and dnn or estimating daily maize transpiration in northwest china and their results showed that dnn was highly effective due to its advantage in terms of modeling high order complex relationships based on multiple hidden layers granata and di nunno 2021 applied several rnn models recurrent neural network for predicting the actual etc act and they found that long short term memory network lstm could provide highly accurate predictions of the actual etc act there were hitherto some studies on measuring apple tree transpiration using sap flow techniques and applied machine learning models for transpiration estimation of perennial trees weibel and de vos 1994 constructed an improved stem heat balance method to measure transpiration on a 10 year old apple tree orchard and the result showed that the sap flow density was varying with the exposition of the canopy to direct sunlight liu et al 2012 used the compensation heat pulse method to measure sap flow for making irrigation scheduling in the apple tree orchard and they concluded that it is beneficial for more accurate modeling of trunk sap flow by analyzing major factors affecting sap flow during two growth stages of the apple tree li et al 2009 constructed a generalized regression neural network grnn model for cherry transpiration and experiment verification showed that the model had a high prediction accuracy ellsäßer et al 2020 used random forest rf ann and support vector machines svm to predict sap flux in mixed agroforestry systems and they concluded that there is large potential in machine learning approaches for predicting transpiration however few researchers have compared the performance of deep learning models and traditional transpiration models at estimating daily apple tree transpiration thus this study aimed to develop a hybrid deep learning model r l rnn with the advantages of deep belief network dbn and long short term memory recurrent neural network lstm rnn models to improve the accuracy of transpiration simulation in addition the single and combined effects of tree meteorological and soil variables on daily apple tree transpiration on the loess plateau have not been systematically studied previously therefore the main objectives of this study were 1 to determine the variations of meteorological tree and soil factors and quantify their effects on daily apple tree transpiration on the loess plateau 2 to compare the performance of different dnn e g dbn lstm rnn and r l rnn and traditional transpiration models e g mlr mjs and s w at estimating daily apple tree transpiration 3 to investigate the effects of various input combinations based on tree meteorological and soil variables on the accuracy of apple tree transpiration estimation and 4 to evaluate the accuracy of various transpiration models in different apple tree growth stages particularly deep learning models 2 materials and methods 2 1 site description the main apple producing areas 33 43 41 16 n 100 54 114 33 e in the loess plateau region include the southeast of gansu province weibei plain of shaanxi province and the central southern part of shanxi province thus this study investigated three sites located in wuwei changwu and taigu fig 1 brief descriptions of these three sites are presented in the following wuwei station 33 52 12 n 102 51 01 e the experiment was conducted at the shiyanghe experimental station for water saving in agriculture and ecology of china agricultural university wuwei city gansu province during 2008 2010 the average annual temperature average annual rainfall average annual reference evapotranspiration and the average annual sunshine duration are 8 c 172 4 mm 2000 mm and 2890 h the apple orchard was rainfed before and planted in desert soil with soil water content at field capacity and wilting point being 0 33 m3 m 3 and 0 06 m3 m 3 respectively the field capacity is defined as the amount of soil water content held in soil after excess water has drained away the own rooted apple tree variety tested was red marshal 29 years old with an average height of 2 5 m and row spacing of 4 0 6 0 m the upper and lower limits of irrigation ranged between 65 and 100 field water capacity θfc and the irrigation amount satisfied the water consumption demand theoretically the border irrigation takes place when the soil reaches the lower limits and terminates on the upper limits liu et al 2012 changwu station 35 13 48 n 107 40 44 e the experiment was conducted at the agricultural ecological experimental station of the changwu loess plateau of the chinese academy of sciences xianyang city shaanxi province during 2012 2014 the average annual temperature average annual rainfall average annual reference evapotranspiration and the average annual sunshine duration are 9 c 584 mm 2290 mm and 2100 h the apple orchard was rainfed before and planted in dark loessial soils with soil water content at field capacity and wilting point being 0 28 m3 m 3 to 0 09 m3 m 3 respectively the methods used to determine soil field water capacity for this site was proposed by colman 1947 the own rooted apple tree variety tested was red fuji nine years old with an average height of 3 5 m and row spacing of 3 5 4 0 m the rainfed orchard had not received irrigation water for several years taigu station 37 22 53 n 112 31 41 e the experiment was conducted at the scientific research pilot base of pomology research institute of shanxi academy of agricultural sciences jinzhong city shanxi province during 2015 2017 the average annual temperature average annual rainfall average annual reference evapotranspiration and the average annual sunshine duration are 10 c 460 mm 1766 mm and 2700 h the apple orchard was rainfed before and planted in sandy loam soil with soil water content at field capacity and wilting point being 0 30 m3 m 3 and 0 08 m3 m 3 respectively the soil field capacity in this site is also defined as the amount of soil water content held in soil after excess water has drained away the own rooted apple tree variety tested was red fuji seven years old with an average height of 3 0 m and row spacing of 2 0 4 0 m the upper and lower limits of irrigation ranged between 55 and 90 field water capacity θfc and the annual irrigation quota was around 135 mm the water storage pit irrigation takes place when the soil reaches the lower limits and terminates on the upper limits 2 2 measurements the net solar radiation rn air relative humidity rh air temperature tmax tmin and ta atmospheric pressure wind speed and rainfall were recorded using meteorological monitoring systems meteorological monitoring system jauntering taiwan at the height of 2 m in the apple orchards the meteorological data were recorded by automatic data collector hl20 data logger jauntering taiwan at an hourly intervals the volumetric soil water content swc was continuously measured by tube type time domain reflectometry tube tdr imko micro modultechnik germany for five apple trees where sap flow were monitored four tubes for each tree were installed at 30 cm relative to the tree trunks in the east south north and west directions to a depth of 1 m the soil water content of the vertical profile in each tube was measured at 10 cm layer increments every 5 7 days soil water content measured by tube tdr was calibrated by the oven drying method every month and the gravimetric soil water content converted to volumetric water content values by multiplying it by the bulk density of the soil campbell and campbell 2005 the swc was linearly interpolated from five day scale to the daily scale for purposes of comparison to transpiration leaf area index lai was measured by winscanopy canopy analysis system winscanopy 2006a regent quebec canada the hemispherical photography was taken in sunny days every 5 7 days and was analyzed by winscanopy 2006a software to obtain the lai of apple tree the lai was interpolated by quadratic equation between lai and day of year doy each year for purposes of comparison to transpiration the sap flow rates in apple trees were monitored by commercial sap flow sensors model sf100 greenspan technology pty ltd warwick australia consisting of two temperature and one heater probe were used to monitor trunk sap flow sf automatically the depth of the sap wood from the bark 15 20 mm had the peak value of sap velocity that contributed to most of total sap flux so representative apple tree were selected and the probe was installed at a depth of 20 mm to calculate whole trunk sap flux the probe was installed at 1 m from the trunk to the ground and wrapped by silver paper to reduce the effect of environmental heat and prevent the entire system against rainfall the pulse duration was 2 s and the data was recorded every 10 min the sap flux was monitored on five trees randomly chosen in the orchards according to granier 1987 the formulae for conversion of sap flow rates sf from tree to stand transpiration tsf is listed as follow 1 s f i 0 00119 δ h max δ h δ t 1 23 2 t sf 1 6 i 1 144 s f i a w a c 3600 where tsf is the estimated transpiration mm d 1 sfi is the sap flow rate per record mm s 1 i is daily recorded volume i 1 2 144 δh is the difference in temperature between a pair of probes δhmax is the value of δh when there is no sap flux which corresponds to the nocturnal δh maximum over a 24 h period aw represent the cross sectional area of the water conducting sapwood m2 ac is the canopy area m2 2 3 traditional transpiration models the traditional transpiration models mainly include empirical models and physical models the mlr patle et al 2020 zheng et al 2021 mjs bosveld and bouten 2003 zheng et al 2021 and s w li et al 2015 shan et al 2020 were used to estimate the daily transpiration for the apple tree in this study 2 3 1 multiple linear regression model the mlr model for estimating transpiration is expressed as follows 3 t sf a l a i b v p d c r n d t a e θ a f where tsf lai vpd rn ta θa represent the estimated transpiration leaf area index vapor pressure deficit net solar radiation average air temperature and average volumetric soil water content respectively the empirical parameters a b c d e and f are fitted using the least squares method kovoor and nandagiri 2007 li et al 2016a 2 3 2 modified jarvis stewart model the mjs model defined by jarvis 1997 for modeling transpiration is expressed as follows 4 t sf t sf m a x f l a i f v p d f r n f t a f θ a where tsf max represent the maximum rate of apple tree transpiration which is modified by each driving variable in this study mjs model were constructed by combining different environmental submodel functional formulae as follows 5 f v p d 1 a 1 v p d 1 6 f r n r n r n a 2 7 f t a 1 a 3 a 4 t a 2 8 f θ a 1 exp a 5 θ w p θ a 9 f l a i l a i l a i 0 5 l a i m a x 0 5 l a i l a i 0 5 l a i m a x where θwp and θa are the volumetric wilting coefficient and the average soil water content laimax represent the maximum value of leaf area index the empirical parameters a1 a2 a3 a4 and a5 are fitted using the least squares method 2 3 3 shuttleworth wallace model shuttleworth and wallace 1985 studied the etc act for sparse cover surface assuming that the crop canopy is uniformly covered two canopy resistance and soil resistance parameters are introduced to establish a dual source etc act model s w comprising the crop canopy and surface under canopy the s w model is calculated as follows 10 λ et c c pm c c s pm s 11 p m c δ a ρ c p v p d δ r a c a s r a a r a c δ γ 1 r s c r a a r a c where λet is the etc act estimated using the s w model and the pms and pmc are same as the soil evaporation e and canopy transpiration tsf terms respectively which are applied in the p m model penman monteith model the detailed calculation processes were described by li et al 2015 in the present study the s w model was only applied to estimate apple tree transpiration 2 4 deep learning models 2 4 1 deep belief network the dbn model is a generative model proposed by hinton and salakhutdinov 2006 which involves multiple stacked restricted boltzmann machines rbm ma et al 2022 each rbm comprises a visible layer v and hidden layer h fig 2 the visible layer of the rbm on the upper layer comprises the hidden layer of the next layer in this method features are extracted layer by layer and the top layer is used as the input into bp for regression calculation as shown in fig 2 the state is more stable when the energy is smaller and thus the model s parameters are better at reflecting the probability distribution of the sample the energy function e v h of rbm is 12 e v h i 1 n j 1 m w i j v i h j i 1 n a i v i j 1 m b j h i where i represents the i th visible layer node j represents the j th hidden layer node a i and b j are the biases of the visible layer element and hidden layer element respectively and w represents the weight of the visible layer and hidden layer by setting the parameters β a b w the joint probability density of v h is as follows 13 p v h β e e v h i 1 n j 1 m e e v h due to the independent structural characteristics of the same rbm layer when the state of the visible layer is known the activation probability of the j th unit of the hidden layer h is 14 p h j 1 v σ i 1 n w i j v i b j where σ x 1 1 e x is the sigmoid activation function the rbm has a symmetrical structure so when the state of the hidden layer is known the activation probability of the i th unit of the visual layer v is as follows 15 p v i 1 h σ j 1 m w i j h j a i the rbm is trained an unsupervised learning process after determining the parameters using the maximum likelihood estimation method the parameters β can be iteratively solved by the contrast divergence method ning et al 2018 16 δ a i ζ h j d a t a h j r e δ b j ζ v i d a t a v i r e δ w i j ζ v i h j d a t a v i h j r e where ξ represents the learning rate d a t a represents the mathematical expectation of the characteristics of the training sample and r e represents the mathematical expectation of reconstructing the sample features after gibbs sampling 2 4 2 long short term memory recurrent neural network long short term memory recurrent neural network lstm rnn is based on the traditional rnn neural network which cannot deal with some long distance problems well it belongs to one of the variants of neural network similar to rnn lstm rnn neural network structure is one of the recursive memory neural networks based on memory block structure fig 2 it can record the hidden state of the current node and then transfer it to the subsequent nodes so as to achieve the purpose of learning historical input information the lstm rnn model has a unique memory cell mechanism which can better solve the problems of gradient data disappearance and explosion the core idea of lstm rnn is to use its unique three gate structure to protect and control cell state cell memory state is the key of lstm rnn it is similar to conveyor belt and runs through the whole lstm structure which can effectively ensure that the information flows on the whole chain the lstm rnn model has four special gate structures through which it can remove or increase information to the cell state mohanty et al 2020 the specific implementation process is as follows the forget gate f t determines whether the state st of the current cell should be retained the mathematical description is as follows 17 f t σ w f y t 1 x t k f where σ represents the sigmoid activation function yt 1 represents the output value of the old cell xt represents the input value of the current cell wf represents the matrix composed of coefficients in the forget gate kf represents the offset vector in the forget gate the input gate i t is responsible for determining whether the input value x t should be used to update the state s t of the current cell the sigmoid activation function is responsible for determining the output value y t of the current cell the mathematical description is as follows 18 i t σ w i y t 1 x t k i 19 u t tanh w c y t 1 x t k c where tanh represents hyperbolic tangent activation function which is responsible for creating a candidate vector u t of the current cell wi represents the matrix composed of coefficients in the input gate wc represents the matrix composed of coefficients in the candidate vector ki represents the offset vector in the input gate kc represents the offset vector in the candidate vector the updated gate u t determines whether the current cell should update the state of the old cell from s t 1 to s t by multiplying the forget gate and the input gate the mathematical description is as follows 20 s t f t s t 1 i t u i the output gate o t is responsible for calculating the output value y t of the current cell the output gate runs the sigmoid activation function to determine whether to output the current cell state by judging the output value of the old cell and the input value of the current cell then current cell state s t is then processed by the tanh activation function and multiplied by the output o t of the sigmoid activation function to finally determine the output value y t of the current cell the mathematical description is as follows 21 o t σ w o y t 1 x t k o 22 y t o t tanh s t where wo represents the matrix composed of coefficients in the output gate ko represents the offset vector in the output gate 2 4 3 lstm rnn improved with multiple restricted boltzmann machines the r l rnn is an extension of the original lstm rnn model where it is significantly improved by the rbm structure and it can be used for time series mining and data feature extraction in r l rnn the features extracted by rbm e t substitute for the input value x t of each memory block in the lstm rnn model and they are combined with the previous output value e t 1 to determine whether the cell state s t by the sigmoid activation function thus the lstm of the extracted sequence of input features is realized according to the activation of different gates as in the lstm rnn the functions of the input gate i t forget gate f t and update gate u t are similar to those in the lstm rnn model but the output gate o t in the r l rnn model is responsible for calculating the output feature extraction value e t in the current cell by progressing through the time series the r l rnn model finally produces a time series of dependent variables in the complex nonlinear system in the present study using r l rnn rather than lstm rnn and dbn could result in better generalization because the improved feature extraction with the rbm includes more potential history in the sequence compared with lstm rnn the mathematical process of the r l rnn model is based on dbn and lstm rnn and the complete structure of the r l rnn model is illustrated in fig 2 2 5 input combinations and model implementation the advantages of the k fold cross validation method in terms of effectively avoiding over learning and under learning have been demonstrated in numerous studies dong et al 2022 fan et al 2018 in the present study data observations in the representative years i e wuwei during 2008 2010 changwu during 2012 2014 and taigu during 2015 2017 were separated into three equal parts chronologically one part one year of data was used for testing and the other two parts two years of data were applied for training dnn or calibrating traditional models were calibrated using the least squares method the accuracy of the average estimated value was taken as the final result to further evaluate the performance of dnn models at estimating apple tree transpiration we used 31 input combinations based on the all subset strategy to construct the dbn lstm rnn and r l rnn for estimating transpiration respectively table 1 summarizes the input variables and model abbreviations for dnn models 2 6 water stress coefficient when the potential energy of the soil water drops below a threshold value the crop is said to be water stressed the effects of soil water stress are described by multiplying the basal crop coefficient by the water stress coefficient ks allen et al 1998 used the following expression for ks 23 k s t a w d r t a w r a w where ks is the water stress coefficient taw is the total available water i e water stored in the root zone between field water capacity and wilting point dr mm is the root zone depletion raw mm is the readily available water for soil water limiting conditions ks 1 where there is no soil water stress ks 1 based on fao56 hu et al 2006 expressed ks as a linear function of soil water storage at field capacity and at wilting point chen et al 2022 liu and luo 2010 which was calculated as follows 24 k s 1 0 8 b 0 04 e t 0 θ a θ w p θ f c θ w p where et0 is crop reference evapotranspiration θfc θwp and θa are the field water capacity the wilting coefficient and the average volumetric soil water content respectively b is average fraction of total available soil water that can be depleted from the root zone before water stress when et0 5 mm d 1 for the apple tree b 0 5 according to allen et al 1998 2 7 path analysis method path analysis was proposed by the geneticist wright 1934 and it can be applied to study the relationships between variables in multivariate statistical analysis path analysis can decompose the interactions correlation coefficients between causal variables into direct effects direct path coefficients and indirect effects indirect path coefficients in order to analyze the direct and indirect importance of independent variables for dependent variables jiang et al 2020 xu et al 2020 for a correlated system with one dependent variable y and numerous independent variables xi i 1 2 n the multivariate nonlinear equation is expressed as follows 25 y a 0 a 1 x 1 a 2 x 2 a n x n i 1 2 n where y represents the dependent variable x i represents the i th independent variable and a i represents the partial regression coefficient of variable x i to y by substituting the actual observed values into eq 25 the standard matrix equation can be established by solving the mathematical transformation of the equations through the least square method 26 1 r x 1 x 2 r x i x n r x 2 x 1 1 r x 2 x n r x n x 1 r x n x 2 1 p x 1 y p x 2 y p x n y r x 1 y r x 2 y r x n y where r x i x j represents the correlation coefficient of variable x i and x j and p x i y represents the direct path coefficient expressing the direct effect of variable x i on y 27 p x i y a i σ x i σ y i 1 2 n where σ x i and σ y represent the standard deviations of x i and y respectively and r x i x j p x i y represents the indirect path coefficient expressing the indirect effect of variable x i through variable x j on y the remaining variables represent the effects of other independent variables and errors on the dependent variable y and the path coefficient pey is calculated as follows 28 p ey 1 r x 1 y p x 1 y r x 2 y p x 2 y r x n y p x n y 2 8 model evaluations statistical accuracy indicators comprising the coefficient of determination r2 nash sutcliffe efficiency coefficient nse relative root mean square error rrmse feng et al 2017a 2017b and global performance indicator gpi feng et al 2019 were used to evaluate the models these indicators are defined as follows 29 r 2 i 1 n y i y x i x i 1 n y i y 2 i 1 n x i x 2 2 30 n s e 1 i 1 n y i x i 2 i 1 n x i x 2 31 r r m s e 1 n i 1 n y i x i 2 1 n i 1 n y i 32 g p i j 1 m α j s i j s i m e d i a n where x i and y i are the ith measured value and estimated value respectively x and y represent the corresponding mean values sii is the normalized value of r2 nse and rrmse simedian is the median of the corresponding parameter m is the number of statistical indicators α i is equal to 1 for r2 and nse and equal to 1 for rrmse 3 results 3 1 variations of daily meteorological tree and soil factors in the growth stage the changes in the daily vpd rn ta lai and swc were investigated in order to quantify the variations of tree meteorological and soil factors in the growth period of apple tree on the loess plateau in experimental years i e wuwei during 2008 2010 changwu during 2012 2014 and taigu during 2015 2017 fig 3a shows the variations of the daily vpd in the growth period of wuwei 2008 2010 changwu 2012 2014 and taigu 2015 2017 the variations of the vpd were unimodal and they ranged among 0 1 2 1 kpa at wuwei 0 8 3 2 kpa at changwu and 1 0 3 9 kpa at taigu with average values of 1 1 kpa 1 7 kpa and 2 2 kpa respectively the maximum vpd often occurred on day of year doy 183 238 from july to august each year fig 3b shows the variations of the daily rn in the growth period of wuwei 2008 2010 changwu 2012 2014 and taigu 2015 2017 the maximum rn occurred on doy 180 doy 170 and doy 210 with ranges of 22 2 217 6 w2 m 2 at wuwei 40 6 233 4 w2 m 2 at changwu and 37 2 296 5 w2 m 2 at taigu respectively as shown in fig 3c that the trends in ta were similar to those in rn with ranges of 2 0 26 5 c at wuwei 4 3 24 9 c at changwu and 11 9 28 6 c at taigu with the means of 17 2 c 17 6 c and 21 4 c in the growth period of apple tree respectively fig 3d shows that the soil water content fluctuated significantly under the influences of irrigation rainfall and evapotranspiration during the apple tree growth season with values ranging between 19 7 and 31 3 at wuwei 13 7 26 1 at changwu and 16 4 26 9 at taigu respectively according to eq 24 the values of ks at wuwei in 2008 2010 were all higher than 1 00 in terms of changwu the values of ks ranging between 0 71 and 1 00 in 2012 0 91 1 00 in 2013 and 0 92 1 00 in 2014 in terms of taigu the values of ks ranging between 0 77 and 1 00 in 2015 0 81 1 00 in 2016 and 0 77 1 00 in 2017 see specific values of ks at three stations in table s1 as shown in fig 3e that the apple tree lai values followed a regular parabolic curve and the maximum lai value at wuwei station was 1 77 m2 m 2 doy 179 in 2008 2 24 m2 m 2 doy 210 in 2009 and 1 96 m2 m 2 doy 208 in 2010 at changwu station was 1 95 m2 m 2 doy 190 in 2012 1 84 m2 m 2 doy 195 in 2013 1 94 m2 m 2 doy 201 in 2014 and at taigu station was 1 48 m2 m 2 doy 228 in 2015 1 47 m2 m 2 doy 247 in 2016 and 1 58 m2 m 2 doy 235 in 2017 after it reached the maximum the lai kept relatively stable until the end of the growth stage therefore we applied lai lai max as the threshold to divide the whole growth stage of apple tree into the partial canopy and dense canopy according to experimental observations at three stations the growth stage division of each year at wuwei changwu and taigu were listed in table 2 fig 3f shows the variations in the daily tsf were unimodal at each site with the range of 1 1 6 0 mm d 1 at wuwei 2008 2010 0 8 3 2 mm d 1 at changwu 2012 2014 and 0 4 6 8 mm d 1 at taigu 2015 2017 and the corresponding three year average values were 3 2 mm d 1 1 9 mm d 1 and 3 8 mm d 1 in the growth period of apple tree respectively with the development of the apple tree growth stage the daily tsf increased from 1 3 to 1 9 mm day 1 at wuwei 0 8 1 7 mm day 1 at changwu and 0 5 1 3 mm day 1 at taigu in early growth stage gradually peaked to 4 6 6 0 mm day 1 at wuwei doy 162 160 and 164 2 7 3 2 mm day 1 at changwu doy 189 220 and 196 and 5 6 6 8 mm day 1 at taigu doy 218 207 and 219 following gradually decreased to 1 5 2 2 mm day 1 at wuwei 0 8 1 0 mm day 1 at changwu and 1 6 2 0 mm day 1 at taigu 3 2 quantification of effects of tree meteorological and soil factors on daily transpiration based on path analysis path analysis explained 68 76 68 78 and 74 85 of the daily variations in transpiration across different sites p 0 001 fig 4 during the partial canopy stage dense canopy stage and whole growth stage respectively thereby indicating that the factors considered effectively explained much of the seasonal variability in daily transpiration on the loess plateau therefore transpiration models based on these factors could perform very well however the effects of meteorological tree and soil factors on the variations in the sap flow rate varied among growth stages and sites fig 4 the correlation coefficientin table 3 shows that lai had the main positive total effect on transpiration followed by vpd rn ta and swc with total effects ranging among 0 71 0 86 0 68 0 73 0 62 0 69 0 52 0 65 and 0 25 0 35 in the partial canopy stage and 0 66 0 71 0 60 0 67 0 52 0 58 0 41 0 55 and 0 19 0 31 in the whole growth stage therefore the tree factor lai was the most critical factor except in the dense canopy stage in the dense canopy stage vpd was the main positive regulator of transpiration total effects ranging among 0 85 0 89 and rn and ta were critical in the indirect effect path table 3 more importantly the total effect of meteorological factors i e vpd ta and rn on transpiration in different growth stages was more significant than that of lai thereby demonstrating that the daily transpiration was primarily driven by meteorological factors on the loess plateau in particular rn had direct effects in the partial canopy stage and the whole growth stage with direct coefficients of 0 37 p 0 05 and 0 34 p 0 05 respectively and the direct r 0 31 p 0 05 and indirect r 0 35 p 0 05 effect on transpiration were both significant positive in the dense canopy stage at wuwei station whereas ta had a direct effect in the partial canopy stage with a direct coefficient of 0 32 p 0 05 and played positive indirect effect on transpiration through vpd in the dense canopy stage and the whole growth stage significantly with indirect coefficients of 0 34 p 0 05 and 0 32 p 0 05 at wuwei station respectively however rn and ta had more consistent significant positive indirect effects through vpd on the variations in transpiration among different growth stages at changwu and taigu stations table 3 these results demonstrate that vpd was the most important meteorological factor that generally affected transpiration in the dense canopy stage at wuwei station swc had no significant effects on apple tree transpiration total effects ranged among 0 25 0 12 p 0 05 in wuwei presumably because the soil water content was adequate 20 and thus the soil water content was not sufficient to have a significant effect in addition swc had consistent significant positive effects on the transpiration variations in changwu and taigu table 3 presumably because the soil water content was insufficient 20 3 3 comparisons of daily transpiration estimating models using the complete input combination the traditional models used for estimating transpiration have limitations because complete sets of meteorological soil and tree data are required in order to evaluate the possibility of using deep learning models to replace the traditional models we compared empirical physical and dnn models using complete input combinations i e the input variables were the same for all models to calculate the transpiration in different growth stages table 4 shows the statistical indicators obtained by mlr mjs s w dbn lstm rnn and r l rnn based on the estimations of the daily apple tree transpiration using the complete input data combinations according to table 4 s w obtained the most accurate estimates of the daily transpiration in different growth stages among the empirical models followed by mjs and mlr successively with the median r2 nse and rrmse values ranging among 0 79 0 86 0 70 0 77 and 0 16 0 19 in the partial canopy stage respectively 0 76 0 82 0 67 0 72 and 0 16 0 17 in the dense canopy stage and 0 65 0 74 0 53 0 64 and 0 17 0 19 in the whole stage compared with mlr the r2 nse and rrmse values of s w improved by 26 8 144 7 38 0 190 9 and 35 1 53 8 in the partial canopy stage respectively 20 3 69 0 26 4 110 1 and 17 7 58 0 in the dense canopy stage and 35 6 60 0 41 1 66 7 and 13 4 42 1 in the whole stage compared with mjs the r2 nse and rrmse values of s w improved by 3 7 15 6 2 5 12 8 and 4 1 16 6 in the partial canopy stage respectively 6 6 21 0 5 1 9 0 and 1 9 11 0 in the dense canopy stage and 12 9 30 5 19 1 51 9 and 14 2 20 6 in the whole stage since s w was the best empirical model in this study we compared the accuracy of the estimates obtained by the s w r l rnn lstm rnn and dbn to evaluate the performance of the dnn models the gpi values in the partial canopy stage were ranked in the order of r l rnn lstm rnn dbn s w table 4 among the dnn models r l rnn obtained the most accurate estimates of the daily transpiration in different growth stages with median r2 nse and rrmse values ranging among 0 94 0 96 0 93 0 96 and 0 04 0 09 in the partial canopy stage respectively 0 94 0 96 0 94 0 96 and 0 05 0 07 in the dense canopy stage and 0 88 0 91 0 84 0 90 and 0 11 0 17 in the whole stage followed by lstm rnn and dbn compared with r l rnn the r2 values under s w dbn and lstm rnn decreased by 9 2 17 4 3 3 4 7 2 3 3 7 in the partial canopy stage respectively 14 2 21 1 3 8 4 8 and 3 2 5 7 in the dense canopy stage and 16 4 28 7 4 0 6 8 and 5 4 9 0 in the whole stage in addition compared with r l rnn the nse values under s w dbn and lstm rnn decreased by 19 9 25 5 2 9 5 4 and 2 0 4 8 in the partial canopy stage respectively 25 5 28 3 4 4 9 2 and 4 2 5 2 in the dense canopy stage and 24 9 37 2 5 0 9 5 and 10 0 11 0 in the whole stage moreover compared with r l rnn the rrmse values under s w dbn and lstm rnn increased by 107 8 307 5 14 7 140 0 and 8 8 38 9 in the partial canopy stage respectively 145 7 217 6 31 4 80 4 and 25 7 68 6 in the dense canopy stage and 16 8 68 5 5 6 30 6 and 7 5 31 5 in the whole stage except for mlr the statistical indicators obtained for all of the transpiration models i e mjs s w dbn lstm rnn and r l rnn were significantly lower under complete input combination in the whole growth stage than the partial and dense canopy stages in the partial canopy stage the r2 nse and rrmse values improved by 15 4 39 4 23 6 82 5 and 9 1 22 8 under mjs respectively by 16 1 22 3 9 8 35 6 and 8 1 11 7 under s w by 6 7 9 9 11 6 14 3 and 12 2 54 1 under dbn by 8 3 12 8 13 3 21 1 and 12 6 62 7 under lstm rnn and by 5 6 7 5 6 8 10 9 and 25 0 63 0 under r l rnn compared with the whole growth stage in the dense canopy stage the r2 nse and rrmse values improved by 9 2 24 4 15 8 76 3 and 16 1 30 7 under mjs respectively by 8 7 17 5 5 7 29 5 and 1 0 14 8 under s w by 6 0 9 9 5 9 14 3 and 37 4 45 9 under dbn by 8 2 11 8 14 3 19 3 and 38 5 52 1 under lstm rnn and by 5 7 9 0 7 3 12 4 41 7 68 3 under r l rnn compared with the whole growth stage in general the results demonstrated the r l rnn model obtained the most accurate estimates of the daily transpiration under complete input combination followed by lstm rnn dbn s w mjs mlr in the partial and dense canopy stage and by dbn lstm rnn s w mjs mlr in the whole growth stage 3 4 comparisons of daily transpiration estimating models using incomplete input combinations in order to systematically evaluate the accuracy of the dnn at estimating transpiration we also conducted comparisons with models using 30 incomplete input combinations clearly the statistical indicators i e r2 nse and rrmse differed significantly among the models and stages fig 5 presents the statistical results for the dbn lstm rnn and r l rnn models when used to estimate the daily apple tree transpiration with 30 incomplete input combinations in different growth stages according to fig 5 r l rnn obtained the most accurate estimates of the daily transpiration with 30 incomplete input combination in different growth stages with median r2 nse and rrmse values ranging among 0 77 0 80 0 63 0 64 and 0 14 0 24 in the partial canopy stage respectively 0 71 0 77 0 57 0 69 and 0 15 0 16 in the dense canopy stage and 0 68 0 73 0 50 0 58 and 0 19 0 26 in the whole growth stage compared with r l rnn the median r2 values under dbn and lstm rnn decreased by 16 1 27 1 and 7 5 16 5 the nse values decreased by 23 2 73 3 and 8 8 32 6 and the rrmse values increased by 16 1 26 7 and 13 1 25 5 in the partial canopy stage under 30 incomplete input combinations where the corresponding median values of r2 nse and rrmse under dbn ranged among 0 63 0 67 0 36 0 51 and 0 19 0 29 respectively and those under lstm rnn ranged among 0 67 0 73 0 48 0 58 and 0 19 0 28 respectively in the dense canopy stage the median r2 values under dbn and lstm rnn decreased by 4 1 19 1 and 2 3 8 0 the nse values decreased by 4 6 50 0 and 2 0 10 0 and the rrmse values increased by 3 9 15 5 and 1 8 14 0 under 30 incomplete input combinations where the corresponding median values of r2 nse and rrmse under dbn ranged among 0 63 0 73 0 42 0 58 and 0 16 0 19 respectively and those under lstm rnn ranged among 0 69 0 75 0 56 0 67 and 0 16 0 19 respectively similar results were obtained in the whole growth stage where the median r2 values under dbn and lstm rnn decreased by 4 8 18 4 and 19 7 27 1 respectively compared with r l rnn the nse values decreased by 10 9 45 1 and 20 3 83 4 and the rrmse values increased by 7 2 15 5 and 8 8 16 9 in addition the median r2 nse and rrmse values under all of the dnn models i e dbn lstm rnn and r l rnn were significantly lower in the whole growth stage than the partial or dense canopy stages in the partial canopy stage the r2 nse and rrmse values improved by 2 0 3 7 1 4 12 9 and 1 0 17 7 under dbn respectively by 18 1 20 3 13 7 67 4 and 4 1 20 4 under lstm rnn and by 8 1 13 1 11 2 25 4 and 8 7 28 6 under r l rnn compared with the whole growth stage in the dense canopy stage the r2 nse and rrmse values improved by 1 9 18 4 16 2 21 6 and 19 5 32 2 under dbn respectively by 20 7 24 8 38 9 100 2 and 23 4 34 5 under lstm rnn and by 2 6 6 9 14 7 20 1 and 17 3 38 2 under r l rnn compared with the whole growth stage these results demonstrated the r l rnn model obtained the most accurate estimates of the daily apple tree transpiration using 30 incomplete input combinations followed by lstm rnn dbn in the partial and dense stage and dbn lstm rnn in the whole growth stage generally see specific accuracy results of 31 input combinations for three dnn models in table s2 3 5 evaluation of input variables used in deep learning models at different growth stages the r l rnn model obtained the highest accuracy with various input combinations and we also found that the accuracy of the estimations produced by the dnn models increased exponentially with the number of input variables fig 6 thereby indicating that the dnn models were more effective when more complex relationships existed between the multivariate inputs and output at all sites in particular the median r2 values for the dnn models were 0 85 range 0 82 0 91 0 81 range 0 60 0 90 0 74 range 0 54 0 86 0 54 range 0 06 0 82 and 0 36 range 0 01 0 65 as the number of input variables decreased from five to one respectively in the whole growth stage in addition the median nse values were 0 80 range 0 75 0 90 0 72 range 0 36 0 89 0 57 range 0 26 0 83 0 27 range 2 06 0 75 and 0 01 range 6 90 0 57 as the number of input variables decreased from five to one respectively in the whole growth stage the simulation error of the model increased as the number of input variables decreased from five to one in the whole growth stage with median rrmse values of 0 14 range 0 11 0 17 0 17 range 0 11 0 28 0 20 range 0 13 0 30 0 28 range 0 17 0 90 and 0 33 range 0 23 0 95 respectively thus using more input variables improved the accuracy of the estimates obtained by the dnn models and using all of the variables as inputs obtained the best performance by all models in all of the different growth stages in addition we found that the specific input variables had significantly different effects on the daily apple tree transpiration estimates in different growth stages in particular in the partial canopy stage fig 7 the r2 values under the dnn improved by 57 4 70 0 27 5 66 5 18 9 52 8 12 3 48 1 and 5 4 47 1 when we included lai vpd rn ta and swc respectively compared with the transpiration models that excluded the corresponding variable as inputs and the corresponding median values were 0 82 0 87 0 82 0 85 0 77 0 83 0 76 0 83 and 0 75 0 82 at all sites i e wuwei changwu and taigu comparisons of the nse values also resulted in a similar conclusion where the median nse values under the dnn ranged among 0 73 0 76 0 72 0 73 0 62 0 70 0 58 0 69 and 0 54 0 61 when we included lai vpd rn ta and swc respectively whereas the median values when these variables were excluded decreased by 46 3 65 8 47 0 62 7 32 0 59 2 26 7 49 0 and 3 6 20 4 moreover the median rrmse values under the dnn were 0 20 0 31 0 22 0 34 0 20 0 32 0 19 0 31 and 0 19 0 27 when we included lai vpd rn ta and swc respectively with the improvement of 52 0 74 0 72 9 87 1 36 3 57 5 32 7 43 8 and 5 1 40 0 compared to the scenario of corresponding input variable excluded respectively in general the importance of the input variables when estimating the transpiration in the partial canopy stage using the dnn followed the order of lai vpd rn ta swc the apple tree entered the dense canopy stage when lai exceeded laimax and relationships between the meteorological soil and tree factors with transpiration changed significantly thus it was important to determine the importance of the input variables for estimating the daily apple tree transpiration in the dense canopy stage using the dnn models we found little difference in the performance of the dnn models at estimating transpiration in the dense canopy stage under different input combinations when we included or excluded lai because transpiration is mainly controlled by atmospheric factors in the dense canopy stage however the r2 nse and rrmse values for the models using input combinations that included vpd were significantly improved by 25 7 34 1 29 4 59 1 and 28 3 142 3 respectively with median values of 0 80 0 83 0 73 0 77 and 0 12 0 16 compared with the models that excluded vpd as inputs moreover the results indicated that rn and ta were of similar importance for improving the accuracy of the daily transpiration estimates obtained by the dnn models the r2 nse and rrmse values for dnn models that used input combinations including rn improved by 19 2 30 3 23 4 46 1 and 16 0 74 9 respectively with median values of 0 79 0 81 0 69 0 75 and 0 15 0 16 in terms of ta the r2 nse and rrmse values of dnn models improved by 20 1 23 7 24 1 42 6 and 11 5 53 6 respectively with median values of 0 76 0 80 0 69 0 74 and 0 15 0 17 in general the importance of the input variables for estimating transpiration in the dense canopy stage using the dnn models followed the order of vpd rn ta lai swc however including swc only significantly improved the accuracy of the daily transpiration estimates in changwu and taigu and not wuwei fig 8 fig 9 shows box plots illustrating the effects of including or excluding lai vpd rn ta and swc as input variables in the input combinations when estimating transpiration in the whole growth stage using dnn models the box plots show that the median r2 values were highest when lai was included followed by vpd rn ta and swc where the corresponding median values were 0 76 0 79 0 74 0 75 0 72 0 74 0 69 0 73 and 0 66 0 73 respectively similar results were obtained in terms of the nse values where the importance of the input variables when estimating transpiration using the dnn models followed the order of lai vpd rn ta swc with median values of 0 62 0 72 0 57 0 63 0 51 0 60 0 50 0 57 and 0 48 0 54 respectively excluding lai vpd rn ta and swc also significantly affected the rrmse values when estimating transpiration using the dnn models where the median rrmse values increased by 51 8 69 2 22 8 50 7 20 1 37 6 14 9 42 8 and 3 9 24 2 respectively therefore the importance of the input variables when estimating transpiration in the whole growth stage using the dnn models followed the order of lai vpd rn ta swc 4 discussion 4 1 reasons for accuracy differences using different model types according to our results the deep learning based models performed significantly better than the traditional models at estimating transpiration using consistent combinations of inputs table 4 similarly chen et al 2020a reported that lstm dnn and tcn performed better than empirical models at estimating the et0 values ferreira et al 2019 also found that dnn performed better than the hargreaves equations at estimating et0 values with incomplete meteorological input data in brazil however these previous studies only evaluated the performance of dnn and empirical models at estimating et0 values xu et al 2017 developed an ann model for estimating the daily transpiration by desert shrubs and showed that the ann model performed better than an empirical model moreover fan et al 2021 found that dnn was most effective at estimating the daily maize transpiration in northwest china thus the differences in the accuracy of dnn and empirical models when estimating the daily transpiration are presumably because the deep learning models are black box models that are not limited by the model structure and thus they are more flexible thereby effectively reducing the cognitive uncertainty due to the complex nonlinear relationships between transpiration and various factors compared with empirical models furthermore as expected the r l rnn model achieved better accuracy by coupling rbm and lstm rnn where the rbm is better at extracting features from input combinations and the lstm rnn model is more suitable for solving time series problems the rbm is a retraining model for the dbn and this markov random field model plays a vital role in the field of deep learning ma et al 2022 because the extraction of features affects the accuracy of the prediction model by improving the interpretability of input data zhang et al 2021 the lstm rnn model can continuously adjust the network structure update the state by learning the complex relationships between transpiration and various factors based on historical data mohanty et al 2020 in addition we found that the dbn ranked based on gpi higher in the whole growth period whereas the lstm rnn was more suitable than dbn for modeling in the partial and dense canopy stages table 4 these results are important because they demonstrate that modeling in different growth stages can effectively reduce the noise of input variables whereas modeling in the whole growth stage can reduce the interpretability of effective information in historical data therefore the r l rnn is more suitable for daily transpiration estimation because of its advantages at modeling the complex nonlinear relationships between transpiration and related variables by coupling rbm with the lstm rnn 4 2 reasons for accuracy differences using various input combinations the accuracy of the transpiration estimates obtained by dnn models differed significantly under various input combinations according to the statistical indicators fig 5 similarly fan et al 2021 found that including swc and or lai in machine learning models is highly recommended for obtaining accurate daily maize transpiration estimates ellsäßer et al 2020 opted for a randomization based permutation test to estimate the importance of each predictor variable on the oil palm agroforest in lowland sumatra and the result showed that the numbers of most important variables that explain 95 of the ml model outcome are highly variable li et al 2009 constructed a generalized regression neural network grnn model for cherry transpiration and they concluded that of swc par photosynthetically active radiation and vpd had a major impact on prediction of grnn shan et al 2020 also found that mars and bpnn models performed significantly better than empirical models at maize transpiration estimation under various input combinations in different growth stages furthermore we found that the r2 nse and rrmse values improved to different extents when lai vpd rn ta and swc were included in the dnn models compared with models that excluded these variables as inputs as shown in figs 7 9 which are consistent with the results that we obtained by path analysis in general the importance of the input variables for estimating transpiration using the dnn models followed the order of lai vpd rn ta swc in the partial canopy stage and vpd rn ta lai swc in the dense canopy stage which agreed with the correlation coefficients between transpiration and related factors table 3 furthermore we found that incorporating soil water content values as inputs in the dnn models was critical for satisfactorily estimating the variations in transpiration especially under limited soil water conditions e g swc ranged among 13 7 26 1 in changwu and 16 4 26 9 in taigu fig 3 similar conclusions were made in previous studies chen et al 2020c harris et al 2004 this study found that the performance of the dnn models differed significantly among sites when estimating transpiration because the linear relationships between transpiration and various factors might not have been the best fits thereby introducing uncertainty when estimating transpiration liu et al 2020 found that the importance of swc in the models also changed dramatically under different water management conditions and the difference in seasonal variation of etc act among different regions can be ascribed to rice phenological traits and irrigation treatments this study found that the differences in the water management conditions had important effects on the accuracy of the dnn models when estimating transpiration because that forces acting on the soil water decrease its potential energy and make it less available for plant root extraction and thus the soil water stress conditions impacts apple tree transpiration similar to the conclusion drawn from this study it is recommended to introduce the water stress coefficient ks to describe the effects of soil water stress on etc act by fao allen et al 1998 when the potential energy of the soil water content drops below a threshold value specifically for soil water limiting conditions ks 1 where there is no soil water stress ks 1 at wuwei station the irrigation amount satisfied the water consumption demand adequately 65 100 θfc and there was theoretically no effect of soil water stress on transpiration theoretically ks 1 the swc had therefore a smaller effect on transpiration estimates compared to other variables in this station however the lower limit values of ks at changwu and taigu ranged between 0 71 and 0 92 and 0 77 0 81 respectively table s1 and the inadequate irrigation or rainfed culture could have resulted in the transpiration being limited by the soil water stress condition that is the soil water has low potential energy and is strongly bound by capillary and absorptive forces to the soil matrix and is less easily extracted by the tree apple tree transpiration was mainly controlled by meteorological factors rather than by tree factors or soil factors table 3 vpd was the main positive regulator of transpiration in the dense canopy stage moreover lai had consistent and main positive total effects in the partial and whole growth stages the effect of swc may have been related to the degree of soil water deficit and the irrigation scheduling specially the importance of the input variables followed the orders of lai vpd rn ta swc in the partial and whole canopy stage and vpd rn ta lai swc in the dense canopy stage figs 7 8 the different seasonal variations in transpiration among regions may have been related to variations in the phenological traits of apple tree varieties and different irrigation treatments our results are in good agreement with those obtained by other researchers fan et al 2021 concluded that transpiration is all controlled by atmospheric demand soil water availability as well as plant growth condition chen et al 2020b suggested that average and maximal air temperature relative humidity solar radiation leaf area and soil temperature were important features which affect maize evapotranspiration li et al 2016b concluded that mjs models should be fit by different growing season in order to obtaining better performance because the sensitivity of canopy resistance to different influencing factors changed at different periods 4 3 reasons for accuracy differences at different growth stages our conclusion that the accuracy of transpiration estimation models existed significant difference between the divisive growth stage and the whole growth stage is consistent with previous studies shan et al 2020 built the mars at four crop growth stages and the whole growth period of maize for estimating etc act and they found not all input combination performed better at the whole growth period than at four growth stages pereira et al 2016 found that the mjs model was suitable in the summer where the slope of the regression of the model versus the observed values was 0 92 but it did not perform as well in the winter in general the s w model is considered more suitable for sparse crops that are not densely distributed li et al 2015 liu et al 2020 in the present study the s w model was most accurate at estimating the transpiration among the traditional models and it performed better in the dense canopy stage table 4 was also found in previous studies moreover the statistical indicators for the traditional transpiration models were significantly lower in the whole growth stage than the partial and dense canopy stages similar results were obtained with the dnn models using various input combinations thus the accuracy of transpiration estimation using both physically based models and dnn models exhibited significant seasonality but the reasons for the differences in the accuracy of these models in different plant growth stages have rarely been studied the meteorological and tree variables soil water content and transpiration varied seasonally fig 3 and thus the relationships between transpiration and these factors also differed significantly where lai and vpd primarily controlled transpiration according to path analysis when lai laimax was treated as the threshold for separating the apple tree growth stages as shown in figs 3 4 although lai increased sharply and had the main total positive effect on transpiration during the partial canopy stage the changes in lai slowed down and meteorological factors gradually dominated after entering the dense canopy stage and vpd became the main factors that affected transpiration in this growth stage the differences in the main drivers of transpiration among growth stages affected the accuracy of the transpiration estimates thereby emphasizing the need to recognize actual effects when constructing a transpiration model for different growth period similarly li et al 2016b concluded that fitting the parameters in the mjs model according to lai thresholds can improve the accuracy of etc act estimations moreover physiologically related model parameters for plants can vary according to plant organ e g leaf expansion aging and senescence whitley et al 2013 wilson et al 1994 furthermore plants generally experience and acclimatize to various biotic and abiotic stresses during their development which can also lead to changes in the relevant parameter values that are crucial for long term modeling xu et al 2020 zhu et al 2011 in general using fixed parameter values in traditional models for estimating transpiration throughout the whole growth stage can lead to overestimates of the transpiration values in the dense canopy stage but underestimates of the transpiration values in the partial canopy stage in addition it should be noted that the interpretability of a dnn model is worse when the structure of the model is more complex fan et al 2021 moreover data uncertainty has important effects on the interpretability of machine learning models the environment is random and longer time series of data will not reduce the uncertainty because the noise is inherent in the data therefore it may be appropriate to construct dnn models to estimate apple tree transpiration in different growth stages 4 4 analysis of uncertainties and applications due to the limitations of existing observation techniques and data processing methods there is significant uncertainty in the observation data which significantly affects the accuracy of model simulation despite machine failure or human operation will introduce uncertainty to meteorological observation data and the data processing method is the main factor for the uncertainty of swc and lai the measurement period of lai was 5 7 days in this study and interpolated to the daily scale by using the method of the fitting curve although the accuracy of fitting curve reaches more than 0 9 fig 3 the data error caused by interpolation will still lead to the uncertainty of the estimated model moreover the linear interpolation method is used for soil water data and the data outside the observation time is uncertain although the method has been widely used regarding observation data of the transpiration the thermal diffusion probe method used in this study is praised as the most wonderful method for measuring liquid flow velocity because of its simple operation continuous monitoring and less environmental damage zimmermann 1983 however the holes must be drilled in the trunk in order to install the thermal diffusion probe which will damage the normal liquid flow in the xylem of apple tree which is one of the reasons why the measured value of the probe method is smaller than the whole tree potometer measurement alla et al 2022 in addition a zero point is required as a benchmark when converting sapwood sap flow rate by the thermal diffusion probe method that is the rising sap flow at this time is considered to be zero gutierrez and santiago 2006 according to the monitoring results of the whole tree potometer measurement pasqualotto et al 2019 there is still water consumption when sapwood sap flow rate is zero which leads to a measurement error another reason of uncertainties is that the thermal diffusion probe method cannot detect the temperature difference between the heating probe and the reference probe when the rising sap flow is very weak and lasts for a long time although the whole tree potometer measurement has high precision the operability is poorer than the thermal diffusion probe method the measurement of tree transpiration water consumption by the thermal diffusion probe method is still reliable but it should still be paid attention to when using the method is applied to determine irrigation schedules according to mjs and sw model this study choose vpd rn ta swc and lai as input variables for dnn models and the path analysis method can explain 68 76 73 89 and 74 85 of the daily transpiration variations during different growth stage at wuwei changwu and taigu respectively fig 4 that is the insufficient input variables is the potential cause of uncertainty in model accuracy despite variables in this study shan et al 2020 further used plant height ground cover and wind speed as input of machine models to estimate evapotranspiration of summer maize and they found the models with plant height ground cover and lai performed better chen et al 2020b used daily maximal and minimal air temperature wind speed maize leaf area maize height soil water and soil temperature as input parameters to develop dnn models for maize etc act and the result showed the plant height mean temperature maximal temperature relative humidity solar radiation leaf area index and soil temperature are the most important features affecting maize et since the tree transpiration depends on the water available to the plant and the different soil types can have different amounts of plant available water at the same water content levels it will be possible to render better results of transpiration estimation by taking plant available water as input instead of swc thus it is necessary for further testing other variables as input of dnn models in the future to improve the accuracy and reliability in transpiration simulation this study found that the dnn models segmented according to the growth stage obtained more accurate estimated transpiration although the threshold according to maximum value of lai had been successfully applied in this study other researchers put forward different views allen et al 1998 recommend a description of growth stages for perennial fruit tree crops that is development stage partial canopy mid stage full canopy and late stage leaf fall started to estimate water use for irrigation purposes li et al 2016b proposed different growth stage segmented methods based on lai and they concluded that p m model penman monteith model had better performance in estimating etc act when building the model by dividing the growing season of maize into two periods according to the lai threshold of 0 5 m2 m 2 wu et al 2022 found the accuracy of estimated maize etc act was effectively improved by adopting the lai 0 5 m2 m 2 as threshold segmentation method at yucheng and the accuracy of etc act segmentally simulated was highest when lai 1 0 m2 m 2 at yangling and shangqiu stations according to these studies the selection of the threshold value dividing the growth stage is a potential factor causing the uncertainty of the model estimation results and exploring a more realistic choice of canopy development stages may result in better transpiration estimates based on dnn models which is essential research directions in the future 5 conclusions in this study we aimed to construct a suitable deep learning model for estimating apple tree transpiration to improve the accuracy of simulations using 31 input combinations based on the all subset strategy as well as to understand the accuracy differences among different model types input combinations and growth stages the main findings obtained in this study are summarized as follows 1 path analysis results indicated that the factors considered effectively explained the variability of the daily transpiration in the growth period of apple tree which was mainly driven by meteorological factors on the loess plateau leaf area index and vapor pressure deficit mainly affected apple tree transpiration in the partial and dense canopy stages respectively the importance of soil water content in the deep learning models also varied significantly among different water management conditions 2 the long short term memory recurrent neural network improved with multiple restricted boltzmann machines obtained the most accurate estimates of daily apple tree transpiration among the different model types and the deep learning models were generally more accurate than the traditional models under complete input combination 3 the long short term memory recurrent neural network improved with multiple restricted boltzmann machines obtained the most accurate estimates of the daily transpiration with 30 incomplete input combination in different growth stages followed by deep belief network and long short term memory recurrent neural network the apple tree transpiration models were significantly more accurate in the partial and dense canopy stages than the whole growth stage 4 the accuracy of the estimates obtained using deep learning models increased exponentially with the number of input variables and the specific input variables applied also significantly affected the daily transpiration estimates the importance of the input variables when estimating transpiration using the deep learning models followed the orders of leaf area index vapor pressure deficit net solar radiation average air temperature soil water content in the partial and whole canopy stage and vapor pressure deficit net solar radiation average air temperature leaf area index soil water content in the dense canopy stage declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgement this work was funded by the national key research and development program of china 2016yfc0400206 the national natural science foundation of china 51922072 51779161 51009101 and the fundamental research funds for the central universities 2018cdpzh10 2016cddy s04 scu 2017cdlz n22 appendix a supporting information supplementary data associated with this article can be found in the online version at doi 10 1016 j agwat 2022 107889 appendix a supplementary material supplementary material 
9302,appropriate ventilation and water management strategy are beneficial to boost crop yield and quality in greenhouses and their optimization is crucial for improving water use efficiency wue here we set up three irrigation levels based on measurements of the cumulative pan evaporation ae pan i e 0 9 ae pan 0 7 ae pan and 0 5 ae pan and three ventilation modes through opening the greenhouse vents at different location v st open the both roof and south vents v t open the roof vents only v s open the south vents only to reveal the effects of ventilation mode and irrigation amount on picking yield y evapotranspiration et wue and quality of tomato grown in a solar greenhouse nine treatments were split block design with ventilation mode as main treatment and irrigation amount as vice treatment each treatment was replicated three times results showed that harvesting time of tomato were substantially influenced by ventilation mode as a result of interior temperature differences the v t treatment was beneficial to early maturity of tomato than the v st and v s treatments the proportion of v t in the first three harvesting was 36 8 and 26 3 higher than of v st and v s respectively irrigation amount had a marked effect on et y wue irrigation water use efficient iwue and irrigation water compensation i rc here et y and i rc of k0 9 were 51 7 and 69 8 11 0 and 19 6 7 0 and 13 5 higher than those of k0 7 and k0 5 treatments respectively while the wue and iwue were 13 1 and 24 8 18 6 and 28 6 lower than k0 7 and k0 5 respectively however the significant interaction between ventilation and irrigation were only found on y wue and iwue both ventilation and irrigation treatments had considerable effect on soluble solids tss v c and organic acid tss could represent the comprehensive quality of tomato because tss was very significantly positively correlated with the comprehensive quality scores a better combination of ventilation and irrigation was recommended as v st 0 7 ae pan by using the topsis method based on a compromise of y quality and wue keywords greenhouse harvesting amount quality topsis water use efficiency yield data availability data will be made available on request 1 introduction pursuing high yield and quality as well as improving water use efficiency wue are the main goals for crop production in greenhouses katsoulas and stanghellini 2019 in china production of solar greenhouses has become a critical industry to ensure vegetables safety and promote local economic development of agriculture li et al 2021 because of low cost convenient management and the ability for providing a suitable environment solar greenhouses have been developed rapidly in recent years the planting area has exceeded 77 8 104 ha in 2020 increased by 1 06 times compared to 2010 the combined regulation of irrigation fertilizer and environment is beneficial to the formation of crop yield and the improvement of fruit quality li et al 2020b shamshiri et al 2018 wang and zhou 2017 however under the agricultural policy of pursuing water saving and achieving zero growing of fertilizer more efforts should be made on how to shift crop production from water fertilizer mode to water environment regulation solar greenhouses are semi closed structures which lead to obvious interaction between meteorological factors and crops gong et al 2020 therefore environmental changes is an important factor affecting the formation of crop yield which frames the scope here gong et al 2021a b li et al 2020a b environmental changes of solar greenhouses are mainly controlled by ventilation system which mainly located at the roof and bottom of the southern side of solar greenhouses however the current ventilation mode was mainly based on experience of farmers and lacks of scientific and effective control methods which may lead to environmental stress such as high temperature and high humidity zhang et al 2022 tanny et al 2003 different ventilation modes will lead to different microclimate conditions inside greenhouses hence affecting the crop growth wue yield and quality for example high temperature leads to pollen damage and leaf relaxation thus reducing yield harel et al 2014 on the contrary low temperature affects enzyme activity and inhibits plant growth and development vanthoor et al 2011 high humidity limits transpiration of plants leading to tip rot of flower han et al 2019 furthermore long term environment of high humidity will reduce fruit quality choi et al 1997 leaf calcium deficiency and leaf area reduction were also related to high humid and hot environment choi et al 1997 vapor pressure deficit vpd could reflect the changes of temperature and humidity and some studies found that vpd directly affected water uptake yield and quality for instance tip rot of flower and stomatal closure were easily happened when vpd was high 3 5 kpa because tomato roots could not absorb water from soil to compensate plant water demand xu et al 2015 however when vpd was low 0 3 1 5kpa calcium accumulation in plant leaves will be reduced leading to a decline in leaf area index fruit weight and yield shamshiri et al 2018 different ventilation modes also affect the variation of inside air speed former studies showed that a high ventilation rate increased the ineffective transpiration li et al 2008 whereas an appropriate ventilation rate 0 8 1 0 m s 1 can improve leaf area index stomatal conductance transpiration rate and photosynthetic rate hence improving yield li et al 2008 yang et al 2007 therefore suitable ventilation mode can improve the internal environment of greenhouses which is benefit to increase crop yield and quality irrigation is the only source of water supply for greenhouse crops thus is another important factor affecting crop growth yield and quality high irrigation amount promotes plant growth and yield formation however decreases fruit quality while it reverses for low irrigation amount therefore previous studies paid more attention on determining irrigation scheduling for greenhouse crops by setting different irrigation amounts chen et al 2014 2013 hooshmand et al 2019 liu et al 2019 to best of our knowledge many studies focused on the effects of single ventilation mode or irrigation amount on crop productions he et al 2017 yan et al 2020 however the combination effects of ventilation and irrigation on crop growth et yield and quality remain unknown as we all know appropriately reducing et can increase yield wue and yield duan et al 2017 yang et al 2016 here et was affected by t a and rh in the greenhouse gong et al 2021a b some studies also shown that ventilation plays an important role in the environment of crops in greenhouse cultivation he et al 2018 boulard et al 2004 therefore a better combination of ventilation and irrigation can change the t a and rh in the greenhouse reduce et improve crop yield and quality and maximize wue furthermore previous studies have focused on the effect of water deficit on tomato yield and quality but little has been done on whether the optimal water supply varies under different ventilation conditions therefore our study hypothesized that wue could be maximized by a compromise between yield and quality through improved ventilation and irrigation management strategies tomato is rich in antioxidant and vitamin and is one of the most cultivated and favorite vegetables worldwide growth yield and quality of tomato are largely influenced by environment and irrigation amount in greenhouses therefore the objectives of our study were to 1 investigate the effects of ventilation mode and irrigation amount on harvesting et wue yield and quality of tomato 2 determine a better combination of ventilation mode and irrigation amount by using principal component analysis and topsis methods 2 materials and methods 2 1 experimental site the experiment was conducted in 2019 and 2020 at a state key laboratory which belongs to the chinese academy of agricultural sciences the site is located at xinxiang country henan province 35 86 n 113 68 e altitude 78 7 m the climate of the site is a temperate continental monsoon climate with average annual t a precipitation and potential evaporation of 14 2 c 548 mm and 1908 mm respectively nine solar greenhouses of the same specification were employed in the experiment with an e w orientation and a planting area of 170 m2 20 m in length 8 5 m in width the height of eaves was 3 9 m the wall of the greenhouse was brick structure and inlaid with thermal insulation materials inner the wall of north east and west roof of the greenhouse was steel frame structure and covered with drip free polyethylene plastic film at night the surface of the sheet was spread with a 25 mm thick cotton quilt to maintain the interior temperature especially during the seedling stage the cotton quilt will also be spread out in rainy or windy weather if the indoor temperature was below 18 c there were two ventilation systems in the greenhouse one was at the roof 20 m in length 0 5 m in width and another one was 1 0 m above the ground at the south 20 m in length 1 0 m in width detailed sectional diagram of the solar greenhouse can be found elsewhere gong et al 2021a b the soil at the depth of 0 100 cm inside the greenhouse was a silt loam including 16 3 clay 77 1 silt and 6 6 sand mean field water capacity fc and wilting water content wp at the soil depth of 0 100 cm were 0 31 and 0 11 cm3 cm 3 respectively and the bulk density was 1 59 g cm 3 2 2 planting information and experiment design before transplanting 112 kg hm 2 urea containing n 46 150 kg hm 2 potassium sulfate containing k2o 50 and 120 kg hm 2 superphosphate containing p2o5 14 were used as a base fertilizer and plowed to a depth of 16 cm with a rotary spade thereafter differential pressure fertilizer tanks were used for topdressing urea of 18 8 kg hm 2 and potassium sulfate of 25 kg hm 2 the fertilizer was applied 4 times when the first second third and fourth truss fruits began to expand a leading local variety of tomato seedlings solanum lycopersicum l c v jinpeng m6 were transplanted into the greenhouse on march 11 2019 and march 4 2020 harvesting begins on may 29 2019 and may 17 2020 ending on july 13 2019 and july 5 2020 respectively immediately after transplanting the soil surface was mulched with black plastic film of 0 03 mm and irrigated with 20 mm water to ensure seedling survival planting pattern of wide 65 cm and narrow 40 cm rows was adopted to receive more sunlight for plants the planting density was 5 7 plants m 2 plot area was 17 6 m2 8 0 m in length 2 2 m in width with 100 plants planted and each treatment included three plots drip irrigation system was used for irrigation and each plant row corresponds to a drip irrigation belt the pressure compensated drip head was used with the flow rate of 1 1 l h 1 irrigation events were determined based on accumulated evaporation ae pan three standard 20 cm evaporation pan 0 20 m in diameter 0 11 m in depth in each greenhouse were used to measure ae pan which located in the east middle and west of greenhouse and they were located 30 cm above the plant canopy and adjusted as the crop grows water evaporated was measured by using a glass rain gauge at 7 00 a m every day irrigation events were performed when the ae pan reaches to 20 2 mm according to our previous results gong et al 2019 2017 in this study three levels of irrigation amount since the development stage 40 days after transplanting and three ventilation modes were set up three levels of irrigation amount were 0 9 ae pan k0 9 0 7 ae pan k0 7 and 0 5 ae pan k0 5 and three ventilation modes were opening the roof and south vents simultaneously v st single opening the roof vent v t and single opening the south vent v s the treatments were split block design with ventilation mode as main treatment and irrigation amount as vice treatment and each treatment was replicated three times irrigation events were performed 15 and 14 times in 2019 and 2020 respectively and the total irrigation amounts of k0 9 k0 7 and k0 5 treatments were 275 4 208 6 and 178 8 mm respectively for 2019 season and 274 0 214 0 and 170 0 mm respectively for 2020 season the agronomic practice such as pollination pest control and topping were the same in all treatments 2 3 measurements 2 3 1 meteorological conditions meteorological parameters for each ventilation mode were monitored by an automatic weather station including a high precision accuracy 0 02 m s 1 two dimensional air velocity meter wind sonic gill uk a nr lite2 net radiometer kipp zonen delft netherlands and a li200x solar radiometer campbell scientifc inc usa these sensors were installed at 2 0 m above the ground in the middle of the greenhouse for each ventilation modes the data were collected by a cr1000 data logger campbell scientifc inc usa and 15 min averages were calculated and stored in addition five temperature and humidity sensors u23 002a hobo usa were used to continuously measure the t a and rh in each ventilation mode these sensors were located 2 0 m above the ground located in the middle and 30 cm above the canopy in the south east north and west of the greenhouse the actual t a and rh were averaged by these sensors precision of t a and rh was 0 04 c and 0 05 respectively and the data were collected at an interval of 15 min 2 3 2 soil water content soil water contents at the depth of 0 100 cm soil layer were monitored by using a trime iph tdr imko germany at an interval of 20 cm during growth period the measuring sites were located in the middle position of two emitters on the same drip irrigation belt the measurement was performed every 7 10 d and three replications were conducted for each treatments the oven drying method was used to calibrate the instrument on a regular basis for ensuring the precision of the trime iph tdr 2 3 3 yield and quality twenty plants in the middle of each plot were sampled to measure the yield and each plot were repeated three times the tomatoes were harvested 9 times for each season and the three times were combined as a group with the following defined labels n1 3 indicates the harvesting amount in the first 3 times mainly concentrated in the first layer of fruit n4 6 in the 4th 6th times mainly concentrated in the 2nd 3rd layer of fruit n7 9 in the 7th 9th times mainly concentrated in the 4th 5th layer of fruit tomato weight of each plot was measured by using an electronic scale with a precision of 5 g nine mature tomatoes with similar size and color were selected from each plot during harvesting stage to measure quality indexes including soluble solids tss vitamin content v c soluble sugar content ssc and organic acid oa the tss was measured by using a handheld sugar meter v c content was measured by 2 6 dichlorophenol indophenol titration the ssc was measured by anthrone colorimetry method and the ratio of sugar to acid sar ssc oa was calculated the oa was first initially titrated with 0 1 mol l 1 naho and then calculated as the equivalence of citric acid expressed as the percentage of fresh mass 2 3 4 et water use efficiency irrigation water use efficiency and irrigation water compensation rate crop et was calculated by using the water balance equation chen et al 2021 qiu et al 2015 1 et i r p r u d w where et is the evapotranspiration mm i r is the irrigation amount mm p r is the rainfall mm u is the groundwater recharge mm d is the deep leakage mm and δw is the changes in soil profile water content within the 0 100 soil layer mm since no precipitation in the greenhouse thus p r 0 the groundwater level of the experimental site was below 5 0 m thus u 0 the maximum irrigation quota was 22 mm in this study that no deep leakage was occurred thus d 0 therefore the calculation of crop et in greenhouse can be simplified as 2 et i r w the equations of water use efficiency wue kg m 3 irrigation water use efficiency iwue kg m 3 and irrigation water compensation rate i rc were given as follows 3 wue y et 100 4 iwue y i r 100 5 i rc i r et 100 where y is the tomato yield t ha 1 2 3 4 data analysis principal component analysis pac was used to evaluate the comprehensive quality scores cqs of greenhouse tomato including tss v c oa ssc and sar the calculation formulas for each principal component score and comprehensive score were given as follows wang et al 2011 6 f i α 1 i x 1 α 2 i x 2 α pi x p 7 q w 1 f 1 w 2 f 2 w i f i where f i is the score of the i principal component α 1i α 2i α pi are the score coefficients of the i principal component x 1 x 2 x p are the values after the normalization process q is the comprehensive score of the principal component w 1 w 2 w i are the contribution rate of each principal component factors the technique for order preference by similarity to ideal solution topsis approach was used to evaluate different combination patterns of ventilation and irrigation for trading off yield wue and fruit quality the comprehensive evaluation indexes were calculated as follows wang et al 2019 8 c i d i d i d i 9 d i j 1 m z max j z ij 2 10 d i j 1 m z min j z ij 2 where c i is the comprehensive evaluation index of the i treatment 0 c i 1 d i and d i are the intercepts of positive and negative ideal solutions respectively z maxj and z minj are the vectors of the positive and negative ideal solutions respectively z ij is the standardized index the general linear model univariate procedure was used to perform anona analysis by using ibm spss 20 0 software duncan multiple comparison was then conducted to compare the means at significant level of p 0 05 3 results 3 1 variation of meteorological factor and soil water storage daily variations of t a rh vpd and u 2 were shown in the fig 1 where data were averaged values throughout the cropping seasons of 2019 and 2020 a discrepancy of meteorological factors inside greenhouse was found under different ventilation conditions the highest values of daily t a and rh were observed in the v s treatment while the lowest was in the v st treatment fig 1 the average daily t a and rh of the v st treatment were 31 2 c and 50 6 which was 5 0 and 5 5 4 6 and 6 5 lower than those of the v t and v s treatments respectively in the middle day during ventilation period 10 00 14 00 for two seasons the cumulative temperature of v t and v s treatments was very closer but 8 2 and 8 0 higher than v st in 2019 and 2020 respectively fig 1a1 b1 c1 the maximum difference of vpd was appeared at noon between the v t and v s treatments fig 1a3 b3 c3 while there was no obvious difference at other time periods for three ventilation treatments the u 2 had the greatest difference among three ventilations fig 1a4 b4 c4 the maximum u 2 occurred in the v st treatment with the value of 0 33 m s 1 which was 29 6 and 53 7 higher than those in the v s and v t treatments respectively for two seasons similar trends of soil water storage in 0 100 cm soil layer at three levels irrigation amounts can be found under different ventilation conditions fig 2 the average soil water storage of k0 9 fluctuated above 280 mm accounting for 88 9 fc fc 315 mm the average soil water storage of k0 7 was not less than 225 mm accounting for 71 4 fc soil water deficit may be occur in k0 5 since the water treatment starts from the development stage of tomato and soil water storage varies from 172 9 mm to 220 5 mm accounting for 54 9 70 0 fc indicating that tomato with irrigation amount of 0 5 ae pan may be affected by water stress 3 2 harvesting amount proportion of harvesting amount to total yield at n1 3 n4 6 and n7 9 under different ventilations and irrigation amount from two seasons were shown in fig 3 results showed that both ventilation and irrigation amount had a marked effect on harvesting amount of tomato grown in the greenhouse and a considerable interactions can be found between ventilation and year irrigation and year ventilation and irrigation as well as ventilation irrigation year fig 3 also shows that the harvesting amount of greenhouse tomato was mainly concentrated in the first 6 times among which the first three times had the largest difference the v t treatment for n1 3 was substantially higher than the v st and v s treatments and the proportion of v t in n1 3 was 36 8 and 26 3 higher than that in the v st and v s respectively indicating that the v t treatment can help promote the early ripening of greenhouse tomato similarly the k0 9 of n1 3 was also substantially higher than that of k0 7 and k0 5 treatments and the proportion of k0 9 in n1 3 was 11 1 and 4 7 higher than that in the k0 7 and k0 5 respectively indicating that the k0 9 can also help promote the early ripening of greenhouse tomato these results indicated that the combination strategy of v t and k0 9 was beneficial to early ripening of tomato grown in greenhouse 3 3 et water use efficient yield and quality table 1 shows that ventilation mode had no considerable differences for et y wue iwue and i rc however irrigation amount had a marked effects on all above parameters table 1 also shows that as irrigation amount decreased et y and i rc substantially decreased but wue and iwue substantially increased here et y and i rc of k0 9 were 51 7 and 69 8 11 0 and 19 6 7 0 and 13 5 higher than those of k0 7 and k0 5 treatments respectively while the wue and iwue were 13 1 and 24 8 18 6 and 28 6 lower than k0 7 and k0 5 respectively there were significant interactions between ventilation and irrigation for tomato y wue and iwue in addition there was also a marked interaction between irrigation and year for the iwue the quality parameters such as the tss v c oa and sar were significantly influenced by ventilation mode while irrigation amount had a marked effects on the tss v c oa and ssc table 1 the values of tss v c and sar in the v t treatment were substantially higher than those of the v s treatment but the oa was reversed here tss v c and sar of v t were 2 0 4 6 and 14 8 higher than those of v s treatment respectively while the oa was 9 2 lower than v s unsurprisingly the values of tss v c oa and ssc were substantially decreased with the increase of irrigation amount ventilation irrigation ventilation year irrigation year and ventilation irrigation year all had significant effects on tss in addition a marked interaction between ventilation and year on ssc was found therefore tss is the most sensitive to environmental changes 3 4 trading off yield wue and fruit quality the contribution rates of variance for the first and second principal components in the 2019 and 2020 seasons were 63 1 and 60 1 32 9 and 34 7 respectively based on the pac approach table 2 the cumulative variance contribution rates were 96 0 and 94 8 85 indicating that the first two principal components contain most information of the five quality indicators the eqs 6 and 7 were used to calculate the scores of the first and second principal component factors and comprehensive quality as shown in table 3 the v t k0 5 has the highest cqs 2 190 and 1 993 followed by the v t k0 7 1 321 and 1 590 and the lowest score occurred in the v st k0 9 1 847 and 1 837 for both seasons the correlation between tss and cqs was established to evaluate whether tss could represent the comprehensive quality index of greenhouse tomato a considerable positive correlation between tss and cqs were found for two seasons tss 5 45 cqs r 2 0 72 p 0 01 indicating that tss can represent the comprehensive fruit quality of greenhouse tomato liu et al 2019 also proved this conclusion the efficiency evaluation of different ventilation and irrigation combination modes was established by comprehensively considering tomato yield fruit quality and wue the topsis method was used to calculate the comprehensive evaluation indexes of nine combinations and the ranking according to numerical values was shown in table 4 the evaluation results of both seasons were consistent the worst combination mode was the v t k0 9 with the comprehensive evaluation value c i of 0 369 and 0 386 respectively for two seasons the best combination mode was the v st k0 7 with the c i of 0 662 and 0 753 respectively for two seasons indicating that the combination strategy of v st and k0 7 could be the best mode trading off yield wue and fruit quality for greenhouse tomato under mulched drip irrigation 4 discussion 4 1 effects of ventilation and water regulation on tomato yield and wue harvesting time were substantially influenced by ventilation mode as a result of interior temperature differences high temperature can shorten the nutritional growth days and make plants enter the reproductive growth stage in advance sato et al 2006 leading to a higher harvesting amount at the early stage than the late stage for example the v t treatment had the highest cumulative temperature fig 1a1 b1 and c1 leading to early tomato maturation than the v st and v s treatments fig 3 this difference is very important because the market price of early listed tomatoes is usually high surprisingly there was no considerable difference in total fruit yield among three ventilation modes table 1 which may be due to that accumulated temperature caused by the v t treatment had effect on plant reproductive growth but did not affect nutritional growth hernandez et al 2015 harvesting time was also affected by irrigation amount for instance the yield of the n1 3 for the k0 9 treatment was substantially higher than those of k0 7 and k0 5 treatments while reverse for the n4 6 this is different from the results by wang et al 2010 who indicated that water deficit would advance greenhouse tomato harvesting time under furrow irrigation this may be caused by different irrigation methods on the whole the combination of the v t and k0 9 was beneficial to the early ripening of greenhouse tomato and the increase of total fruit yield however guo et al 2010 indicated that ventilation of 60 90 combined with irrigation amount of 1 2 et can increase tomato yield per plant in autumn spring grown season this difference may be due to the increase of indoor temperature caused by the small ventilation area and increase in irrigation might achieve the goal of increasing production in addition mulching technique adopted in this study can effectively reduce evaporation in the root zone which can meet the water requirements of tomato plants under the 0 9 ae pan treatment irrigation treatment had a marked effect on total fruit yield water deficit leads to difficulty in water uptake by roots and restricts the transfer of nutrients to reproductive organs such as carbohydrates li et al 2020a b li et al 2012 resulting in reduction of yield similar results were also reported for many crops grown in greenhouse such as tomato li et al 2020a b li et al 2021 eggplant çolak et al 2018 and strawberry yuan et al 2004 the high wue can be obtained with appropriate reduction of irrigation amount but not the case for severe water deficit or excessive irrigation liu et al 2019 the highest wue was observed for the k0 5 and v st treatments table 1 which may be due to the fact that the v st treatment facilitates the supplementation of co2 from outside to inside and a higher co2 level can improve tomato growth yield and nutrient uptake wang et al 2018 4 2 effects of ventilation and water regulation on fruit quality except increasing yield it is also important to improve fruit quality because the quality index determines the nutritional value of a fruit our results showed that the tss v c oa and ssc contents of tomato substantially increased with the decreased irrigation amount table 1 previous studies indicated that water deficit affected transport of sap from the phloem to the fruit and then reduced water flow from the xylem to the fruit guichard et al 2001 therefore increased the solute concentration of fruit which will lead to a decrease in the relative concentration of v c oa and ssc chen et al 2014 therefore water deficit will lead to the improvement of fruit quality in addition fruit quality indexes would be diluted with increased irrigation amount resulting in increased fruit water content whereas moderate drought was conducive to the increase of nutrient contents such as tss and v c air temperature fluctuation is also one of the important factor affecting fruit quality zhao et al 2010 for instance we found that the values of tss v c ssc and sar in the v t treatment were higher than the v st and v s treatments table 1 while reverse for oa in this study which may be due to the fact that cumulative temperature fig 1a1 b1 and c1 of the v t treatment was high however lokesha et al 2019 indicated that increase in temperature increased oa but decreases ssc this difference may be caused by different warming ranges here the maximum daily temperature of the v t treatment was 42 5 c and lasted for four days in this study vijayakumar et al 2021 also indicated that tomato quality indexes were simultaneously influenced by the combined range and duration of heat stress high daily temperature accumulation was also beneficial to increase the content of v c in tomato fruits indicating that plant metabolism was adapted to high temperature vijayakumar et al 2021 similar results were also reported in greenhouse grown strawberry wang 2006 and filed grown tomato bita and gerats 2013 for the taste of tomatoes tss was considered as a beneficial indicator in this study tss ranged from 4 to 5 brix in tomato fruits and the changes of ssc and oa contents was the main cause for the changes of tss in tomato meanwhile the contribution of ssc to tss was higher than that of oa selahle et al 2014 leading to the increase of tss with the increase of daily air temperature a significantly positive correlation between tss and cqs were found in our study indicating that tss can represent the comprehensive fruit quality of greenhouse tomato this is because that tss contains most of the information about the quality indicators such as 65 sugars sucrose and hexose 13 acids citric and malic acids and 12 other components including phenols amino acids soluble pectin ascorbic acid and minerals chen et al 2014 4 3 ventilation and irrigation management strategy compromising between yield quality and wue a better ventilation and irrigation management strategy should compromise the relationships among yield fruit quality and wue in this study the topsis method was used to determine the optimal combination treatment topsis was a multi objective decision making method which can correctly and effectively evaluate the pros and cons of the planning scheme thus widely used in irrigation fertilizer schedule water conservancy engineering and other fields previous studies have evaluated comprehensive benefit of tomato grown in a greenhouse using topsis for example li et al 2021 used the yield crop water productivity nitrogen use efficiency and fruit quality of tomato as evaluation indexes set weights according to the importance of each factor and combined with topsis to propose the optimal fertilization strategy for high yield and high quality tomato liu et al 2019 used the topsis method to optimize the frequency and irrigation amount of greenhouse tomato by balancing the relationship between yield fruit quality and wue luo and li 2018 analyzed the yield quality and wue of tomato under three drip irrigation methods and five nitrogen application treatments and the comprehensive benefit of different treatments were evaluated by using principal component analysis and topsis so as to obtained suitable water and nitrogen supply mode for tomato production in greenhouse in addition suitable combination of water and fertilizers management for potato production in sandy areas of northern china was also conducted by using the topsis method wang et al 2019 in our study analysis experimental data using topsis showed that the combination strategy of v st and k0 7 ventilation mode open roof and south vents and irrigation amount 70 of ae pan was the best results and it was the suitable ventilation and water amount management strategy for tomato cultivated in greenhouse to best trade off yield wue and fruit quality 5 conclusions in this study we investigated the effects of different ventilation mode and irrigation amount on harvesting time yield wue and fruit quality of drip irrigated tomato cultivated in greenhouse the main conclusions are as follows 1 harvesting time were substantially influenced by ventilation mode as a result of interior temperature differences the v t treatment was beneficial to early maturity of tomato than the v st and v s treatments the ventilation mode had a marked effect on harvesting amount while irrigation amount substantially affected the total fruit yield et wue iwue and i rc there were considerable interactions between ventilation mode and irrigation amount for the yield wue and iwue 2 the soluble solids v c content and organic acid were substantially influenced by both irrigation and ventilation treatments and significant interaction between ventilation and irrigation were found for the soluble solids 3 based on the principal component analysis and topsis approach for trading off yield wue and fruit quality the best ventilation mode and irrigation amount management strategy was opening of the roof and south vents combined with irrigation amount of 0 7 ae pan declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to inﬂuence the work reported in this paper acknowledgments we are grateful for the research grants from the national natural science foundation of china 51809094 51709110 key technologies r d and promotion program of henan province 192102110090 foundation for university young key scholar by henan province 2020ggjs100 
9302,appropriate ventilation and water management strategy are beneficial to boost crop yield and quality in greenhouses and their optimization is crucial for improving water use efficiency wue here we set up three irrigation levels based on measurements of the cumulative pan evaporation ae pan i e 0 9 ae pan 0 7 ae pan and 0 5 ae pan and three ventilation modes through opening the greenhouse vents at different location v st open the both roof and south vents v t open the roof vents only v s open the south vents only to reveal the effects of ventilation mode and irrigation amount on picking yield y evapotranspiration et wue and quality of tomato grown in a solar greenhouse nine treatments were split block design with ventilation mode as main treatment and irrigation amount as vice treatment each treatment was replicated three times results showed that harvesting time of tomato were substantially influenced by ventilation mode as a result of interior temperature differences the v t treatment was beneficial to early maturity of tomato than the v st and v s treatments the proportion of v t in the first three harvesting was 36 8 and 26 3 higher than of v st and v s respectively irrigation amount had a marked effect on et y wue irrigation water use efficient iwue and irrigation water compensation i rc here et y and i rc of k0 9 were 51 7 and 69 8 11 0 and 19 6 7 0 and 13 5 higher than those of k0 7 and k0 5 treatments respectively while the wue and iwue were 13 1 and 24 8 18 6 and 28 6 lower than k0 7 and k0 5 respectively however the significant interaction between ventilation and irrigation were only found on y wue and iwue both ventilation and irrigation treatments had considerable effect on soluble solids tss v c and organic acid tss could represent the comprehensive quality of tomato because tss was very significantly positively correlated with the comprehensive quality scores a better combination of ventilation and irrigation was recommended as v st 0 7 ae pan by using the topsis method based on a compromise of y quality and wue keywords greenhouse harvesting amount quality topsis water use efficiency yield data availability data will be made available on request 1 introduction pursuing high yield and quality as well as improving water use efficiency wue are the main goals for crop production in greenhouses katsoulas and stanghellini 2019 in china production of solar greenhouses has become a critical industry to ensure vegetables safety and promote local economic development of agriculture li et al 2021 because of low cost convenient management and the ability for providing a suitable environment solar greenhouses have been developed rapidly in recent years the planting area has exceeded 77 8 104 ha in 2020 increased by 1 06 times compared to 2010 the combined regulation of irrigation fertilizer and environment is beneficial to the formation of crop yield and the improvement of fruit quality li et al 2020b shamshiri et al 2018 wang and zhou 2017 however under the agricultural policy of pursuing water saving and achieving zero growing of fertilizer more efforts should be made on how to shift crop production from water fertilizer mode to water environment regulation solar greenhouses are semi closed structures which lead to obvious interaction between meteorological factors and crops gong et al 2020 therefore environmental changes is an important factor affecting the formation of crop yield which frames the scope here gong et al 2021a b li et al 2020a b environmental changes of solar greenhouses are mainly controlled by ventilation system which mainly located at the roof and bottom of the southern side of solar greenhouses however the current ventilation mode was mainly based on experience of farmers and lacks of scientific and effective control methods which may lead to environmental stress such as high temperature and high humidity zhang et al 2022 tanny et al 2003 different ventilation modes will lead to different microclimate conditions inside greenhouses hence affecting the crop growth wue yield and quality for example high temperature leads to pollen damage and leaf relaxation thus reducing yield harel et al 2014 on the contrary low temperature affects enzyme activity and inhibits plant growth and development vanthoor et al 2011 high humidity limits transpiration of plants leading to tip rot of flower han et al 2019 furthermore long term environment of high humidity will reduce fruit quality choi et al 1997 leaf calcium deficiency and leaf area reduction were also related to high humid and hot environment choi et al 1997 vapor pressure deficit vpd could reflect the changes of temperature and humidity and some studies found that vpd directly affected water uptake yield and quality for instance tip rot of flower and stomatal closure were easily happened when vpd was high 3 5 kpa because tomato roots could not absorb water from soil to compensate plant water demand xu et al 2015 however when vpd was low 0 3 1 5kpa calcium accumulation in plant leaves will be reduced leading to a decline in leaf area index fruit weight and yield shamshiri et al 2018 different ventilation modes also affect the variation of inside air speed former studies showed that a high ventilation rate increased the ineffective transpiration li et al 2008 whereas an appropriate ventilation rate 0 8 1 0 m s 1 can improve leaf area index stomatal conductance transpiration rate and photosynthetic rate hence improving yield li et al 2008 yang et al 2007 therefore suitable ventilation mode can improve the internal environment of greenhouses which is benefit to increase crop yield and quality irrigation is the only source of water supply for greenhouse crops thus is another important factor affecting crop growth yield and quality high irrigation amount promotes plant growth and yield formation however decreases fruit quality while it reverses for low irrigation amount therefore previous studies paid more attention on determining irrigation scheduling for greenhouse crops by setting different irrigation amounts chen et al 2014 2013 hooshmand et al 2019 liu et al 2019 to best of our knowledge many studies focused on the effects of single ventilation mode or irrigation amount on crop productions he et al 2017 yan et al 2020 however the combination effects of ventilation and irrigation on crop growth et yield and quality remain unknown as we all know appropriately reducing et can increase yield wue and yield duan et al 2017 yang et al 2016 here et was affected by t a and rh in the greenhouse gong et al 2021a b some studies also shown that ventilation plays an important role in the environment of crops in greenhouse cultivation he et al 2018 boulard et al 2004 therefore a better combination of ventilation and irrigation can change the t a and rh in the greenhouse reduce et improve crop yield and quality and maximize wue furthermore previous studies have focused on the effect of water deficit on tomato yield and quality but little has been done on whether the optimal water supply varies under different ventilation conditions therefore our study hypothesized that wue could be maximized by a compromise between yield and quality through improved ventilation and irrigation management strategies tomato is rich in antioxidant and vitamin and is one of the most cultivated and favorite vegetables worldwide growth yield and quality of tomato are largely influenced by environment and irrigation amount in greenhouses therefore the objectives of our study were to 1 investigate the effects of ventilation mode and irrigation amount on harvesting et wue yield and quality of tomato 2 determine a better combination of ventilation mode and irrigation amount by using principal component analysis and topsis methods 2 materials and methods 2 1 experimental site the experiment was conducted in 2019 and 2020 at a state key laboratory which belongs to the chinese academy of agricultural sciences the site is located at xinxiang country henan province 35 86 n 113 68 e altitude 78 7 m the climate of the site is a temperate continental monsoon climate with average annual t a precipitation and potential evaporation of 14 2 c 548 mm and 1908 mm respectively nine solar greenhouses of the same specification were employed in the experiment with an e w orientation and a planting area of 170 m2 20 m in length 8 5 m in width the height of eaves was 3 9 m the wall of the greenhouse was brick structure and inlaid with thermal insulation materials inner the wall of north east and west roof of the greenhouse was steel frame structure and covered with drip free polyethylene plastic film at night the surface of the sheet was spread with a 25 mm thick cotton quilt to maintain the interior temperature especially during the seedling stage the cotton quilt will also be spread out in rainy or windy weather if the indoor temperature was below 18 c there were two ventilation systems in the greenhouse one was at the roof 20 m in length 0 5 m in width and another one was 1 0 m above the ground at the south 20 m in length 1 0 m in width detailed sectional diagram of the solar greenhouse can be found elsewhere gong et al 2021a b the soil at the depth of 0 100 cm inside the greenhouse was a silt loam including 16 3 clay 77 1 silt and 6 6 sand mean field water capacity fc and wilting water content wp at the soil depth of 0 100 cm were 0 31 and 0 11 cm3 cm 3 respectively and the bulk density was 1 59 g cm 3 2 2 planting information and experiment design before transplanting 112 kg hm 2 urea containing n 46 150 kg hm 2 potassium sulfate containing k2o 50 and 120 kg hm 2 superphosphate containing p2o5 14 were used as a base fertilizer and plowed to a depth of 16 cm with a rotary spade thereafter differential pressure fertilizer tanks were used for topdressing urea of 18 8 kg hm 2 and potassium sulfate of 25 kg hm 2 the fertilizer was applied 4 times when the first second third and fourth truss fruits began to expand a leading local variety of tomato seedlings solanum lycopersicum l c v jinpeng m6 were transplanted into the greenhouse on march 11 2019 and march 4 2020 harvesting begins on may 29 2019 and may 17 2020 ending on july 13 2019 and july 5 2020 respectively immediately after transplanting the soil surface was mulched with black plastic film of 0 03 mm and irrigated with 20 mm water to ensure seedling survival planting pattern of wide 65 cm and narrow 40 cm rows was adopted to receive more sunlight for plants the planting density was 5 7 plants m 2 plot area was 17 6 m2 8 0 m in length 2 2 m in width with 100 plants planted and each treatment included three plots drip irrigation system was used for irrigation and each plant row corresponds to a drip irrigation belt the pressure compensated drip head was used with the flow rate of 1 1 l h 1 irrigation events were determined based on accumulated evaporation ae pan three standard 20 cm evaporation pan 0 20 m in diameter 0 11 m in depth in each greenhouse were used to measure ae pan which located in the east middle and west of greenhouse and they were located 30 cm above the plant canopy and adjusted as the crop grows water evaporated was measured by using a glass rain gauge at 7 00 a m every day irrigation events were performed when the ae pan reaches to 20 2 mm according to our previous results gong et al 2019 2017 in this study three levels of irrigation amount since the development stage 40 days after transplanting and three ventilation modes were set up three levels of irrigation amount were 0 9 ae pan k0 9 0 7 ae pan k0 7 and 0 5 ae pan k0 5 and three ventilation modes were opening the roof and south vents simultaneously v st single opening the roof vent v t and single opening the south vent v s the treatments were split block design with ventilation mode as main treatment and irrigation amount as vice treatment and each treatment was replicated three times irrigation events were performed 15 and 14 times in 2019 and 2020 respectively and the total irrigation amounts of k0 9 k0 7 and k0 5 treatments were 275 4 208 6 and 178 8 mm respectively for 2019 season and 274 0 214 0 and 170 0 mm respectively for 2020 season the agronomic practice such as pollination pest control and topping were the same in all treatments 2 3 measurements 2 3 1 meteorological conditions meteorological parameters for each ventilation mode were monitored by an automatic weather station including a high precision accuracy 0 02 m s 1 two dimensional air velocity meter wind sonic gill uk a nr lite2 net radiometer kipp zonen delft netherlands and a li200x solar radiometer campbell scientifc inc usa these sensors were installed at 2 0 m above the ground in the middle of the greenhouse for each ventilation modes the data were collected by a cr1000 data logger campbell scientifc inc usa and 15 min averages were calculated and stored in addition five temperature and humidity sensors u23 002a hobo usa were used to continuously measure the t a and rh in each ventilation mode these sensors were located 2 0 m above the ground located in the middle and 30 cm above the canopy in the south east north and west of the greenhouse the actual t a and rh were averaged by these sensors precision of t a and rh was 0 04 c and 0 05 respectively and the data were collected at an interval of 15 min 2 3 2 soil water content soil water contents at the depth of 0 100 cm soil layer were monitored by using a trime iph tdr imko germany at an interval of 20 cm during growth period the measuring sites were located in the middle position of two emitters on the same drip irrigation belt the measurement was performed every 7 10 d and three replications were conducted for each treatments the oven drying method was used to calibrate the instrument on a regular basis for ensuring the precision of the trime iph tdr 2 3 3 yield and quality twenty plants in the middle of each plot were sampled to measure the yield and each plot were repeated three times the tomatoes were harvested 9 times for each season and the three times were combined as a group with the following defined labels n1 3 indicates the harvesting amount in the first 3 times mainly concentrated in the first layer of fruit n4 6 in the 4th 6th times mainly concentrated in the 2nd 3rd layer of fruit n7 9 in the 7th 9th times mainly concentrated in the 4th 5th layer of fruit tomato weight of each plot was measured by using an electronic scale with a precision of 5 g nine mature tomatoes with similar size and color were selected from each plot during harvesting stage to measure quality indexes including soluble solids tss vitamin content v c soluble sugar content ssc and organic acid oa the tss was measured by using a handheld sugar meter v c content was measured by 2 6 dichlorophenol indophenol titration the ssc was measured by anthrone colorimetry method and the ratio of sugar to acid sar ssc oa was calculated the oa was first initially titrated with 0 1 mol l 1 naho and then calculated as the equivalence of citric acid expressed as the percentage of fresh mass 2 3 4 et water use efficiency irrigation water use efficiency and irrigation water compensation rate crop et was calculated by using the water balance equation chen et al 2021 qiu et al 2015 1 et i r p r u d w where et is the evapotranspiration mm i r is the irrigation amount mm p r is the rainfall mm u is the groundwater recharge mm d is the deep leakage mm and δw is the changes in soil profile water content within the 0 100 soil layer mm since no precipitation in the greenhouse thus p r 0 the groundwater level of the experimental site was below 5 0 m thus u 0 the maximum irrigation quota was 22 mm in this study that no deep leakage was occurred thus d 0 therefore the calculation of crop et in greenhouse can be simplified as 2 et i r w the equations of water use efficiency wue kg m 3 irrigation water use efficiency iwue kg m 3 and irrigation water compensation rate i rc were given as follows 3 wue y et 100 4 iwue y i r 100 5 i rc i r et 100 where y is the tomato yield t ha 1 2 3 4 data analysis principal component analysis pac was used to evaluate the comprehensive quality scores cqs of greenhouse tomato including tss v c oa ssc and sar the calculation formulas for each principal component score and comprehensive score were given as follows wang et al 2011 6 f i α 1 i x 1 α 2 i x 2 α pi x p 7 q w 1 f 1 w 2 f 2 w i f i where f i is the score of the i principal component α 1i α 2i α pi are the score coefficients of the i principal component x 1 x 2 x p are the values after the normalization process q is the comprehensive score of the principal component w 1 w 2 w i are the contribution rate of each principal component factors the technique for order preference by similarity to ideal solution topsis approach was used to evaluate different combination patterns of ventilation and irrigation for trading off yield wue and fruit quality the comprehensive evaluation indexes were calculated as follows wang et al 2019 8 c i d i d i d i 9 d i j 1 m z max j z ij 2 10 d i j 1 m z min j z ij 2 where c i is the comprehensive evaluation index of the i treatment 0 c i 1 d i and d i are the intercepts of positive and negative ideal solutions respectively z maxj and z minj are the vectors of the positive and negative ideal solutions respectively z ij is the standardized index the general linear model univariate procedure was used to perform anona analysis by using ibm spss 20 0 software duncan multiple comparison was then conducted to compare the means at significant level of p 0 05 3 results 3 1 variation of meteorological factor and soil water storage daily variations of t a rh vpd and u 2 were shown in the fig 1 where data were averaged values throughout the cropping seasons of 2019 and 2020 a discrepancy of meteorological factors inside greenhouse was found under different ventilation conditions the highest values of daily t a and rh were observed in the v s treatment while the lowest was in the v st treatment fig 1 the average daily t a and rh of the v st treatment were 31 2 c and 50 6 which was 5 0 and 5 5 4 6 and 6 5 lower than those of the v t and v s treatments respectively in the middle day during ventilation period 10 00 14 00 for two seasons the cumulative temperature of v t and v s treatments was very closer but 8 2 and 8 0 higher than v st in 2019 and 2020 respectively fig 1a1 b1 c1 the maximum difference of vpd was appeared at noon between the v t and v s treatments fig 1a3 b3 c3 while there was no obvious difference at other time periods for three ventilation treatments the u 2 had the greatest difference among three ventilations fig 1a4 b4 c4 the maximum u 2 occurred in the v st treatment with the value of 0 33 m s 1 which was 29 6 and 53 7 higher than those in the v s and v t treatments respectively for two seasons similar trends of soil water storage in 0 100 cm soil layer at three levels irrigation amounts can be found under different ventilation conditions fig 2 the average soil water storage of k0 9 fluctuated above 280 mm accounting for 88 9 fc fc 315 mm the average soil water storage of k0 7 was not less than 225 mm accounting for 71 4 fc soil water deficit may be occur in k0 5 since the water treatment starts from the development stage of tomato and soil water storage varies from 172 9 mm to 220 5 mm accounting for 54 9 70 0 fc indicating that tomato with irrigation amount of 0 5 ae pan may be affected by water stress 3 2 harvesting amount proportion of harvesting amount to total yield at n1 3 n4 6 and n7 9 under different ventilations and irrigation amount from two seasons were shown in fig 3 results showed that both ventilation and irrigation amount had a marked effect on harvesting amount of tomato grown in the greenhouse and a considerable interactions can be found between ventilation and year irrigation and year ventilation and irrigation as well as ventilation irrigation year fig 3 also shows that the harvesting amount of greenhouse tomato was mainly concentrated in the first 6 times among which the first three times had the largest difference the v t treatment for n1 3 was substantially higher than the v st and v s treatments and the proportion of v t in n1 3 was 36 8 and 26 3 higher than that in the v st and v s respectively indicating that the v t treatment can help promote the early ripening of greenhouse tomato similarly the k0 9 of n1 3 was also substantially higher than that of k0 7 and k0 5 treatments and the proportion of k0 9 in n1 3 was 11 1 and 4 7 higher than that in the k0 7 and k0 5 respectively indicating that the k0 9 can also help promote the early ripening of greenhouse tomato these results indicated that the combination strategy of v t and k0 9 was beneficial to early ripening of tomato grown in greenhouse 3 3 et water use efficient yield and quality table 1 shows that ventilation mode had no considerable differences for et y wue iwue and i rc however irrigation amount had a marked effects on all above parameters table 1 also shows that as irrigation amount decreased et y and i rc substantially decreased but wue and iwue substantially increased here et y and i rc of k0 9 were 51 7 and 69 8 11 0 and 19 6 7 0 and 13 5 higher than those of k0 7 and k0 5 treatments respectively while the wue and iwue were 13 1 and 24 8 18 6 and 28 6 lower than k0 7 and k0 5 respectively there were significant interactions between ventilation and irrigation for tomato y wue and iwue in addition there was also a marked interaction between irrigation and year for the iwue the quality parameters such as the tss v c oa and sar were significantly influenced by ventilation mode while irrigation amount had a marked effects on the tss v c oa and ssc table 1 the values of tss v c and sar in the v t treatment were substantially higher than those of the v s treatment but the oa was reversed here tss v c and sar of v t were 2 0 4 6 and 14 8 higher than those of v s treatment respectively while the oa was 9 2 lower than v s unsurprisingly the values of tss v c oa and ssc were substantially decreased with the increase of irrigation amount ventilation irrigation ventilation year irrigation year and ventilation irrigation year all had significant effects on tss in addition a marked interaction between ventilation and year on ssc was found therefore tss is the most sensitive to environmental changes 3 4 trading off yield wue and fruit quality the contribution rates of variance for the first and second principal components in the 2019 and 2020 seasons were 63 1 and 60 1 32 9 and 34 7 respectively based on the pac approach table 2 the cumulative variance contribution rates were 96 0 and 94 8 85 indicating that the first two principal components contain most information of the five quality indicators the eqs 6 and 7 were used to calculate the scores of the first and second principal component factors and comprehensive quality as shown in table 3 the v t k0 5 has the highest cqs 2 190 and 1 993 followed by the v t k0 7 1 321 and 1 590 and the lowest score occurred in the v st k0 9 1 847 and 1 837 for both seasons the correlation between tss and cqs was established to evaluate whether tss could represent the comprehensive quality index of greenhouse tomato a considerable positive correlation between tss and cqs were found for two seasons tss 5 45 cqs r 2 0 72 p 0 01 indicating that tss can represent the comprehensive fruit quality of greenhouse tomato liu et al 2019 also proved this conclusion the efficiency evaluation of different ventilation and irrigation combination modes was established by comprehensively considering tomato yield fruit quality and wue the topsis method was used to calculate the comprehensive evaluation indexes of nine combinations and the ranking according to numerical values was shown in table 4 the evaluation results of both seasons were consistent the worst combination mode was the v t k0 9 with the comprehensive evaluation value c i of 0 369 and 0 386 respectively for two seasons the best combination mode was the v st k0 7 with the c i of 0 662 and 0 753 respectively for two seasons indicating that the combination strategy of v st and k0 7 could be the best mode trading off yield wue and fruit quality for greenhouse tomato under mulched drip irrigation 4 discussion 4 1 effects of ventilation and water regulation on tomato yield and wue harvesting time were substantially influenced by ventilation mode as a result of interior temperature differences high temperature can shorten the nutritional growth days and make plants enter the reproductive growth stage in advance sato et al 2006 leading to a higher harvesting amount at the early stage than the late stage for example the v t treatment had the highest cumulative temperature fig 1a1 b1 and c1 leading to early tomato maturation than the v st and v s treatments fig 3 this difference is very important because the market price of early listed tomatoes is usually high surprisingly there was no considerable difference in total fruit yield among three ventilation modes table 1 which may be due to that accumulated temperature caused by the v t treatment had effect on plant reproductive growth but did not affect nutritional growth hernandez et al 2015 harvesting time was also affected by irrigation amount for instance the yield of the n1 3 for the k0 9 treatment was substantially higher than those of k0 7 and k0 5 treatments while reverse for the n4 6 this is different from the results by wang et al 2010 who indicated that water deficit would advance greenhouse tomato harvesting time under furrow irrigation this may be caused by different irrigation methods on the whole the combination of the v t and k0 9 was beneficial to the early ripening of greenhouse tomato and the increase of total fruit yield however guo et al 2010 indicated that ventilation of 60 90 combined with irrigation amount of 1 2 et can increase tomato yield per plant in autumn spring grown season this difference may be due to the increase of indoor temperature caused by the small ventilation area and increase in irrigation might achieve the goal of increasing production in addition mulching technique adopted in this study can effectively reduce evaporation in the root zone which can meet the water requirements of tomato plants under the 0 9 ae pan treatment irrigation treatment had a marked effect on total fruit yield water deficit leads to difficulty in water uptake by roots and restricts the transfer of nutrients to reproductive organs such as carbohydrates li et al 2020a b li et al 2012 resulting in reduction of yield similar results were also reported for many crops grown in greenhouse such as tomato li et al 2020a b li et al 2021 eggplant çolak et al 2018 and strawberry yuan et al 2004 the high wue can be obtained with appropriate reduction of irrigation amount but not the case for severe water deficit or excessive irrigation liu et al 2019 the highest wue was observed for the k0 5 and v st treatments table 1 which may be due to the fact that the v st treatment facilitates the supplementation of co2 from outside to inside and a higher co2 level can improve tomato growth yield and nutrient uptake wang et al 2018 4 2 effects of ventilation and water regulation on fruit quality except increasing yield it is also important to improve fruit quality because the quality index determines the nutritional value of a fruit our results showed that the tss v c oa and ssc contents of tomato substantially increased with the decreased irrigation amount table 1 previous studies indicated that water deficit affected transport of sap from the phloem to the fruit and then reduced water flow from the xylem to the fruit guichard et al 2001 therefore increased the solute concentration of fruit which will lead to a decrease in the relative concentration of v c oa and ssc chen et al 2014 therefore water deficit will lead to the improvement of fruit quality in addition fruit quality indexes would be diluted with increased irrigation amount resulting in increased fruit water content whereas moderate drought was conducive to the increase of nutrient contents such as tss and v c air temperature fluctuation is also one of the important factor affecting fruit quality zhao et al 2010 for instance we found that the values of tss v c ssc and sar in the v t treatment were higher than the v st and v s treatments table 1 while reverse for oa in this study which may be due to the fact that cumulative temperature fig 1a1 b1 and c1 of the v t treatment was high however lokesha et al 2019 indicated that increase in temperature increased oa but decreases ssc this difference may be caused by different warming ranges here the maximum daily temperature of the v t treatment was 42 5 c and lasted for four days in this study vijayakumar et al 2021 also indicated that tomato quality indexes were simultaneously influenced by the combined range and duration of heat stress high daily temperature accumulation was also beneficial to increase the content of v c in tomato fruits indicating that plant metabolism was adapted to high temperature vijayakumar et al 2021 similar results were also reported in greenhouse grown strawberry wang 2006 and filed grown tomato bita and gerats 2013 for the taste of tomatoes tss was considered as a beneficial indicator in this study tss ranged from 4 to 5 brix in tomato fruits and the changes of ssc and oa contents was the main cause for the changes of tss in tomato meanwhile the contribution of ssc to tss was higher than that of oa selahle et al 2014 leading to the increase of tss with the increase of daily air temperature a significantly positive correlation between tss and cqs were found in our study indicating that tss can represent the comprehensive fruit quality of greenhouse tomato this is because that tss contains most of the information about the quality indicators such as 65 sugars sucrose and hexose 13 acids citric and malic acids and 12 other components including phenols amino acids soluble pectin ascorbic acid and minerals chen et al 2014 4 3 ventilation and irrigation management strategy compromising between yield quality and wue a better ventilation and irrigation management strategy should compromise the relationships among yield fruit quality and wue in this study the topsis method was used to determine the optimal combination treatment topsis was a multi objective decision making method which can correctly and effectively evaluate the pros and cons of the planning scheme thus widely used in irrigation fertilizer schedule water conservancy engineering and other fields previous studies have evaluated comprehensive benefit of tomato grown in a greenhouse using topsis for example li et al 2021 used the yield crop water productivity nitrogen use efficiency and fruit quality of tomato as evaluation indexes set weights according to the importance of each factor and combined with topsis to propose the optimal fertilization strategy for high yield and high quality tomato liu et al 2019 used the topsis method to optimize the frequency and irrigation amount of greenhouse tomato by balancing the relationship between yield fruit quality and wue luo and li 2018 analyzed the yield quality and wue of tomato under three drip irrigation methods and five nitrogen application treatments and the comprehensive benefit of different treatments were evaluated by using principal component analysis and topsis so as to obtained suitable water and nitrogen supply mode for tomato production in greenhouse in addition suitable combination of water and fertilizers management for potato production in sandy areas of northern china was also conducted by using the topsis method wang et al 2019 in our study analysis experimental data using topsis showed that the combination strategy of v st and k0 7 ventilation mode open roof and south vents and irrigation amount 70 of ae pan was the best results and it was the suitable ventilation and water amount management strategy for tomato cultivated in greenhouse to best trade off yield wue and fruit quality 5 conclusions in this study we investigated the effects of different ventilation mode and irrigation amount on harvesting time yield wue and fruit quality of drip irrigated tomato cultivated in greenhouse the main conclusions are as follows 1 harvesting time were substantially influenced by ventilation mode as a result of interior temperature differences the v t treatment was beneficial to early maturity of tomato than the v st and v s treatments the ventilation mode had a marked effect on harvesting amount while irrigation amount substantially affected the total fruit yield et wue iwue and i rc there were considerable interactions between ventilation mode and irrigation amount for the yield wue and iwue 2 the soluble solids v c content and organic acid were substantially influenced by both irrigation and ventilation treatments and significant interaction between ventilation and irrigation were found for the soluble solids 3 based on the principal component analysis and topsis approach for trading off yield wue and fruit quality the best ventilation mode and irrigation amount management strategy was opening of the roof and south vents combined with irrigation amount of 0 7 ae pan declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to inﬂuence the work reported in this paper acknowledgments we are grateful for the research grants from the national natural science foundation of china 51809094 51709110 key technologies r d and promotion program of henan province 192102110090 foundation for university young key scholar by henan province 2020ggjs100 
9303,an accurate crop yield forecast is vital for sustaining food security and preventing famine artificial intelligence provides a robust tool for integrating environmental physiological and management data and predicting crop yield in this study we used a multilayer perceptron mlp model in its default and hybrid learning modes to predict wheat yield in its default mode mlp was trained with the backpropagation algorithm and in the hybrid mode mlp was trained with the water striders algorithm wsa sine cosine algorithm sca and genetic algorithm ga we further considered two ensemble modeling approaches including the bayesian model averaging bma and copula based bayesian model averaging cbma the study area was classified into four homogenous wheat cultivation regions using the fuzzy clustering approach and for each region the models were trained based on 30 years of fertilizer information harvested yield and climatic data our results showed that hybridizing mlp with an optimization algorithm provides more accurate yield predictions than its default mode wsa required the lowest computational time and its combination with mlp resulted in a more accurate yield prediction compared to other optimization algorithms the accuracy of yield predictions was further improved when ensemble modeling was implemented accordingly the cbma approach generated the most accurate result with the lowest uncertainty range the mean absolute error mae of the cbma was 0 026 0 058 0 088 0 133 and 0 0201 lower than that of the bma mlp wsa mlp sca mlp ga and mlp models glue uncertainty analysis verified the superiority of the hybrid models and ensemble approaches the predicted yield by cbma bma and mlp wsa covered 94 92 and 89 of the observations respectively keywords bayesian model averaging copula based bayesian model averaging genetic algorithm glue uncertainty multi layer perceptron model sine cosine algorithm water strider optimization wheat yield prediction data availability will be sent if requested 1 introduction the increasing population and subsequent food and water consumption combined with climate change are among the main reasons for the global water crisis in recent years zhang et al 2017 the water crisis has translated into a high uncertainty in crop production in many agriculturally dominated regions thus it has become increasingly important to predict crop yield and strengthen national and global food security yield prediction and its uncertainty assessments are required in many advisory and management services and sections including policymakers for timely import and export strategies balaghi et al 2008 han et al 2020 authorities and decision makers for pricing storing and marketing strategies chen et al 2019 and growers and farmers to modify their inputs such as fertilizers to meet the crop and soil demands pantazi et al 2016 yield prediction is particularly important for strategic and staple crops at a national level in many parts of the world particularly in developing countries wheat is considered the primary strategic crop and provides the most calories and protein for the world s food supply cai et al 2019 han et al 2020 wheat is cultivated in almost one sixth of all arable land globally satorre and slafer 1999 and is the most important crop in arid and semi arid regions of asia norouzi et al 2010 with the limited water resources in the semi arid climates these regions have been shifting toward cultivating rainfed wheat iran is an example of a semi arid region with serious water management challenges in the agricultural section jamshidi et al 2020 considering the reported critical condition in 66 5 of groundwater aquifers forootan et al 2014 wheat is the staple food of the national diet and 2 5 of global wheat production is consumed in iran accounts for 47 of daily calories per capita amirnejad and asadpour kordi 2017 the country annually produces around 13 million tons of wheat and nearly 60 of the wheat cultivated lands are rainfed despite the importance of wheat in iran s food basket the country has become one of the largest importers of wheat in recent years since 2000 the average imports of this product have been approximately 3 million tons per year fao 2017 the rate of wheat production on a global scale has also declined steadily over the past decades resulting in the lowest yield growth rate among the world s major agricultural products ray et al 2015 in recent decades researchers have used a variety of models and algorithms to predict wheat yield tao et al 2009 from simple statistical approaches lobell and burke 2010 becker reshef et al 2010 to more advanced crop modeling frameworks li et al 2022 liu et al 2022 among yield prediction approaches ai and soft computing algorithms have been widely used owing to their accurate predictions e g hadadi et al 2022 mohammadi et al 2021 vaheddoost et al 2020 table 1 provides an overview of the application of different soft computing models based on different input data artificial neural network ann is one of the most widely used soft computing models ann has been developed based on artificial intelligence to extract complex nonlinear relationships between input and output data and includes the ability to hybridize with various other models ann has shown been reported with high accuracy in predicting crop yield the core part of ann is its optimization or training algorithm that carries out the learning process many optimization algorithms based on different concepts have been developed that differ in their computational requirements processing speed and numerical precision conventional algorithms such as the backpropagation and gradient methods do not have high convergence speed and can be trapped in local optimums accordingly more novel algorithms with faster convergence speed and higher precision have been introduced the particle swarm optimization pso mohammadi et al 2020 genetic algorithm ga mirjalili 2019 sine cosine algorithm sca mirjalili 2016 and water strider algorithm wsa kaveh and eslamlou 2020 are notable examples of these algorithms the optimization algorithms are robust and reliable tools for enhancing performance of the mlp models these tools can adjust the mlp parameters accurately additionally as shown in table 1 the focus of previous research has been mostly on using individual models rather than using an ensemble approach stand alone modeling approaches are initiated by selecting the best model based on specific criteria and conditioning the parameters according to the selected model in this process the uncertainty involved in model selection is neglected an alternative framework is to process the candidate models parameters first and then fuse the outcomes based on the model s posterior probabilities this approach has been done through the bayesian inference and is known as the bayesian model averaging bma madigan et al 1996 raftery et al 1997 the bma method can increase the accuracy of target variable predictions by creating a weighted average of output pdf of several models bma has been used in several agro hydrological applications e g nguyen huy et al 2021 achieng 2021 yin et al 2021 yang et al 2021 however the bma approach requires the models output to be bias corrected and assumes the gaussian distribution for the response variables madadgar and moradkhani 2014 this assumption can be violated in different scenarios the copula bayesian model averaging cbma modifies the bma assumption using other distribution and copula functions cbma has been reported to improve multi modeling accuracy and reliability in various fields such as groundwater level prediction liu et al 2021 streamflow prediction siqueira et al 2021 and precipitation forecast qi et al 2021 another challenge reported by previous research table 1 is selecting optimal features and attributes for developing an accurate predictive model the convergence speed and model accuracy are expected to improve by reducing data dimensionality and removing redundant attributes from model inputs many algorithms under three main categories including wrapper filter and embedded methods have been proposed for feature selection e g guyon and elisseeff 2006 lal et al 2006 rodriguez galiano et al 2018 the gamma test is a non parametric feature selection method that has gained popularity due to its fast and efficient processing li et al 2021 it measures the nonlinear relationship between the inputs and outputs evaluates data quality and describes the goodness of a predictive model jaafar and han 2012 overall the challenges and caveats in previous research can be summarized in four areas including i the use of stand alone modeling approaches ii overlooking the uncertainty assessments in model selection iii limited variable inputs not considering a combination of climatic and non climatic factors and iv the absence of a proper feature selection strategy therefore in this research we considered a variety of factors including maximum and minimum air temperature wind speed relative humidity sunny hours rainfall fertilizer effective precipitation transpiration and evapotranspiration and applied the gamma test to identify the most effective inputs for predicting wheat yield we used an ann model a multilayer perceptron and tested the accuracy and uncertainty using the glue method of different training algorithms including the default backpropagation algorithm sca ga wsa and ensemble modeling approaches including bma and cbma because of their fast convergence the ability for global search and flexibility these algorithms were chosen in addition to providing national scale crop specific data the study s novelty lies in using ensemble machine learning approaches mlp and neural network approaches have long been used in crop modeling schemes but they have primarily been used on individual modes using their default optimization algorithms this study highlights the advantage and disadvantages of different algorithms and shows the benefits of using ensemble methods additionally the framework that is provided in this study and step by step guidance from selecting the parameters to developing the final ensemble model can be generically adopted for other crop modeling schemes 2 material and methods 2 1 case study this study was performed on a national scale in iran iran is located in the semi arid region of the world yet it includes diverse climates the northern part of the country on the coast of the caspian sea is humid and wet the central to eastern sides have a hot arid climate south and western south have a semi arid climate and the mountainous regions of western to north western areas have a cold snowy climate wheat is a staple agricultural product in iran and it is cultivated almost in all regions as irrigated and rainfed dehghani sargazi et al 2021 the agricultural areas in iran cover 14 68 million hectares of which 41 belong to rainfed cultivation 7 2 million hectares and of this amount 72 5 2 million hectares belong to wheat cultivation the main wheat production areas in iran are shown in fig 1 which includes 21 regions for each of these regions the crop physiological information including yield and fertilization amounts and meteorological data including air temperature precipitation wind speed relative humidity and sunshine hours were retrieved from official national data centers i e the information and communication technology center and the national meteorological organization irimo 2021 ahmadi et al 2020a 2020b the long term average data 30 years for each region is shown in table 2 once the input data was collected we followed certain steps in our framework to apply the machine learning algorithms and predicts the wheat yield over the country these steps are summarized in the flowchart shown in fig 2 the following subsections explain the concept and mathematical representations of each step 2 2 fuzzy clustering algorithm we applied the fuzzy c means clustering algorithm bezdek 1981 to identify the homogenous areas of wheat cultivation each object can belong to several clusters with a membership degree between zero and one in the fuzzy algorithm the fuzzy c means clustering algorithm assigns a set of weighting coefficients u i to each data point r based on the degree of being included in the i th cluster and calculates the centroid of each cluster v i based on eq 1 1 v i k 1 n u ik m r k k 1 n u ik m where m is the fuzziness coefficient and n is the number of data points then the algorithm aims to partition data into c number of clusters by minimizing an objective function mokarian 2018 izakian and mesgari 2020 shown in eq 2 2 j i 1 c k 1 n u ik m d 2 v i r k where d is the distance function and u ik are the weighting coefficients u ik 0 1 i 1 n k 1 c calculated using the following equation 3 u ik 1 j 1 c d v i r k d v j r k 2 m 1 2 3 multi layer perceptron models a multilayer perceptron mpl model is a deep feedforward artificial neural network used to solve classification and regression problems ravi et al 2017 fig 3 displays the mlp structure mpl is composed of an input layer an arbitrary number of hidden or intermediate layers and an output layer the input variable is received in the first layer and processed in the hidden layers using nonlinear activation functions each mlp contains two parameters including weight and bias an input value to a neuron in the intermediate layer is multiplied by the neuron weight and added by a bias as a fixed term then the activation function processes the value and provides the outputs as the input to the output layer the bias and weights are the unknown parameters that are estimated by the training or optimization algorithms mlp uses backpropagation as its training algorithm pandey and barai 1995 taud and mas 2018 in this study we first trained mlp using its default learning algorithm and predicted the yield values several studies have highlighted that the backpropagation technique is slow and unreliable alejo et al 2015 therefore in this study we hybridized mlp with three novel optimization algorithms and tested their performances these algorithms are described in the subsequent sections 2 3 1 the water strider optimization algorithm the water strider optimization algorithm is a population based optimizer developed based on the life span of water strider insects kaveh and eslamlou 2020 the algorithm mathematically models a water strider s five main life cycle stages including birth territory establishment mating feeding and death the structure of the water strider optimization algorithm is shown in fig 4 at the birth stage the initial population of water striders is calculated based on the following equation taking into account the values of the upper and lower limits of the decision variable 4 ws i 0 ub rand ub lb i 1 2 nws where ws i 0 determines the initial position of the i th water strider ub and lb are the maximum and minimum values based on the problem assumption rand is a random number between 0 and 1 nws represents the number of water striders ws s the algorithm evaluates the fitness of the initial position for each member water strider using an objective function then the algorithm creates nt number of domains territory establishment step to categorize the ws s accordingly ws s are ranked by means of their fitness score and classified into nws nt groups the highest rank shows the most optimal foraging habitat that belongs to the female insect presumably and the lowest rank represents the keystone position that belongs to the male insect in the next step mating stage the algorithm adjusts the position of the male insect within each territory using a probability value p and the following equation kaveh and eslamlou 2020 5 ws i t 1 ws i t r rand mating occu rs with probability of p ws i t 1 ws i t r 1 rand no mating with probaility of 1 p where the i th position of the water strider in the t th iterate is represented by ws i t and r is the euclidean distance between the position of the male ws i t 1 and female ws f t 1 insects 6 r ws f t 1 ws i t 1 the feeding stage comes next in the algorithm in this stage the wss that their new position holds less value of the objective function compared to their previous position are moved to the territories with the highest fitness score and positioned around the best ws of the territory ws bl t 7 ws i t 1 ws i t 2 rand ws bl t ws i t suppose the translocated water strider is still assigned with lower fitness score compared to their previous position in that case it is removed from the population death stage and a new water strider is born succession stage based on the following equation kaveh and eslamlou 2020 8 ws i t 1 lb j t 2 rand ub j t lb j t where ub j t and lb j t represent the upper and lower limits of the values of ws in j th territory the algorithm continues its iterations until the termination condition maximum number of iterations is met the wsa based on eqs 5 and 8 provide new solutions these equations allow the wsa to provide better solutions 2 3 2 the sine cosine algorithm sca sca is a population based meta heuristic optimization algorithm that has been recently developed mirjalili 2016 the sca uses the sine and cosine functions to drive the initial population towards or outward the best solution using two following equations 9 x i t 1 x i t r 1 sin r 2 r 3 p i t x i t r 4 0 5 x i t r 1 cos r 2 r 3 p i t x ii t r 4 0 5 where x i t shows the position of the current solution i is the dimension t represents the iteration p refers to the destination solution position and r 1 r 2 r 3 r 4 are random numbers that are considered as the main parameters of the model the r 1 factor defines a search area for movement direction next positions and can be dynamically changed during the iteration stage eq 10 the r2 factor controls the distance and determines whether the next move is toward or outward the destination the r3 factor is a random weight assigned to the best solution so far to increase or decrease the impact of the destination in defining the distance lastly r 4 is used to shift between the sine and cosine functions in eq 9 10 r 1 a t a t where t current iteration t maximum iteration number a constant where t and t are the current and maximum number of iterations and a is a fixed function 2 3 3 structure of genetic algorithm ga the genetic algorithm ga is another population based meta heuristic optimization algorithm that has been developed based on the process of natural selection holland 1992 the genetic algorithm is based on the population of chromosomes initial values of decision metrics such as weight and bias of the mlp model are defined as the initial population of the genetic algorithm the genetic algorithm uses selection intersection and mutation operators the selection operator selects the best chromosomes based on the value of the target function so that these chromosomes produce offspring of the next generation the intersection operator is used to move the gene between two chromosomes gene translocation between chromosomes is used to generate newer responses the mutation operator is another important operator of the genetic algorithm mutation operators are used to increasing the population type of chromosomes the mutation operator moves the genes on a chromosome in order to produce a new chromosome in the genetic algorithm first the initial population is defined next the value of the objective function of each chromosome is calculated the best chromosomes are selected based on the selection operator intersection and mutation operators are used to generate new responses the optimization process continues until the convergence condition is satisfied 2 4 bayesian and copula bayesian model averaging selecting a single model among a class of models to be applied to a specific problem i e in our case for yield prediction ignores the uncertainty in model selection bayesian model averaging bma provides a coherent mechanism through obtaining posterior densities on model parameters and accounts for model uncertainty in decisions and conclusions as follows 11 p y t m 1 t m 2 t m k t y i 1 k ω i p y t m i t y where y t is the quantity to be predicted yield p y t m 1 t m 2 t m k t y represents the predictive distribution of y t or yield based on different model predictions m 1 t m 2 t m k t and observations for the training phase y p y t m i t y is the posterior distribution of y t based on the i th model predictions m i t and y and ω i is the model weight that reflects performance of the model i e the probability of correct predictions by each model during the training period each model s weight was estimated by the log likelihood function and the expectation maximization em algorithm was applied to maximize the log likelihood function as described in raftery et al 2005 the bma algorithm assumes that each model prediction is unbiased otherwise a bias correction approach should be considered and follows a specific pdf e g gaussian gamma etc removing biases from the models is challenging and the model prediction s pdf does not always follow certain distributions thus on some occasions the bma assumptions are violated resulting in biased outcomes integrating a copula function with bma or copula bma cbma can overcome these limitations copulas are multivariate distribution functions that include uniform distributions of multiple parameters in our study the probability distribution of yield predictions from different models can be considered as a multivariate distribution p m 1 t m 2 t m k t based on the sklar theorem sklar 1996 the multivariate distribution of yield predictions can be expressed by the univariate marginal distribution functions of each model prediction p m k t or u k t and a copula that explains the dependence structure between the models predictions huang et al 2019 12 p m 1 t m 2 t m k t c p m 1 t p m 2 t p m k t c u 1 t u 2 t u k t where c is the copula s cumulative distribution function cdf combining the joint probability function of m 1 t m 2 t m k t and their conditional probability distribution based on y t with eq 12 the predictive distribution of y t eq 11 can be re written in a copula format as huang et al 2019 13 p y t m 1 t m 2 t m k t y i 1 k ω i p y t m i t y i 1 k ω i c u m i t u y t p y t where c u m i t u y t represents the copula density function of m i t and y t according to madadgar et al 2014 the values of u m i t and u y t can be obtained by monte carlo sampling as we did in our study for applying cbma to the model s outputs we first identified an appropriate marginal distribution function that most accurately explained the distribution of the observed yield the gumbel gamma generalized extreme value gev and gaussian models were fitted to the observed yield values and the kolmogorov smirnov k s test was used to select the most appropriate distribution function according to the k s test the model with the lowest d value is best fitted to the data 2 5 hybrid mlp models in this study optimization algorithms were used to adjust the mlp parameters mlp parameters were adjusted based on the following steps which are summarized in fig 4 1 the data were divided into training and testing 2 the mlp model was run at the training level 3 the stop condition was checked mlp models go to the testing level if the stop condition is met otherwise they link with the optimization algorithms 4 mlp parameters are defined as the initial population of the algorithms 5 then the mlp runs using the training data 6 an objective function is computed to evaluate the solutions 7 the operators of algorithms are used to update the solutions mlp parameters 8 if the stop convergence condition is satisfied the model goes to step 3 otherwise the model goes to step 6 2 6 gama test many environmental variables and management practices can impact crop yield these impacts are not equal and may vary significantly at different locations using all these potential variables as inputs to machine learning models for yield prediction is not optimal we applied the gamma test to reduce such high dimensionality of the input data and select the optimal inputs for our models the gamma test provides an estimate of the error variance of the model s output that cannot be explained by any models based on the available input information remesan et al 2008 the details of calculating the gamma statistic are provided in evan and jones 2002 in this study we applied the same approach to calculate γ and used the following equation for a standardized gamma based index known as the v ratio 14 v ratio γ σ 2 y where σ 2 y is the variance of the observed data and v ratio represents the scale invariant noise estimate 0 v ratio 1 closer v ratio values to zero indicate a better input combination that can result in more accurate yield predictability by the model in the present study we considered 11 climatic and non climatic inputs generating 211 1 combination of the input variables 2 7 uncertainty assessments using glue we applied the generalized likelihood uncertainty estimation glue analysis beven and binley 1992 to measure the uncertainty of the models glue is a probabilistic analysis method based on the monte carlo simulation we followed the three steps described below to assess the models uncertainty by glue first a feasible range with a uniform distribution for each independent parameter was defined then the latin square sampling lhs technique was used to produce n sets of random parameters the lhs method increases the accuracy of monte carlo simulation the glue engine by sampling independent variables from their distributions at equal intervals abas et al 2018 in the second step the likelihood value l θ i y was calculated using the following equation and using each set of parameters sampled in the previous step θ i 15 l θ i y exp n σ i 2 σ obs 2 where n is the adjustable parameter σ i 2 is the error variance of the i th model σ obs 2 is the observation variance θ i is the set of the parameters of the i th model and l θ i y is the likelihood value of the i th model with respect to observation values of y the resulting likelihood values were compared with a threshold value abas et al 2018 the parameter sets with values greater than threshold were considered acceptable behavioral and retained to determine the uncertainty interval the final step includes calculating the model output uncertainty by calculating the likelihood weight for the acceptable parameter sets as 16 ϑ i l θ i σ k 1 n l θ k where ϑ i is the likelihood weight and n is the number of data eq 16 gives the model output uncertainty s cdf cumulative distribution function i e the weights sum up to one we considered a 95 confidence interval of the resulting cdf as the uncertainty bound i e removing the upper and lower 2 5 of the data the p and r metrics were used to quantify the uncertainty of the model the p metric represents the percentage of the observations that fall into the uncertainty bound and r is calculated as below 17 d x 1 k l 1 k x u x l r d σ x where σ x is the standard deviation of the observed parameter x u and x l are the simulated yield of the upper and lower limit values of 95 prediction uncertainty and k is the number of observations small values of r and large p values p 50 signify a low uncertainty and the opposite shows a high uncertainty level 3 results 3 1 homogenous regions we identified four homogenous regions of rainfed wheat cultivation across the country based on the fcm algorithm fig 5 displays these four regions and table 2 indicates the climatic characteristics of each station located in each region the first cluster cluster i primarily represents the arid regions with an average air temperature of 17 6 c and total rainfall of 185 mm the average wheat growing season in this cluster lasts 262 days from november to june with an average yield of 0 75 ton ha the second cluster cluster ii represents humid regions including northern iran along the caspian sea with an average air temperature of 13 9 c and total rainfall of 814 mm the average wheat growing season in this cluster lasts 211 days from late october to early june with an average yield of 1 6 ton ha cluster iii represents semi arid regions with an average air temperature of 12 c and total rainfall of 264 7 mm the wheat growing season in this cluster starts in early october and ends in early june 251 days with an average yield of 0 9 ton ha cluster iv represents humid regions including northern iran along the caspian sea with an average air temperature of 13 9 c and total rainfall of 814 mm the average wheat growing season in this cluster lasts 211 days from late october to early june with an average yield of 1 6 ton ha cluster iv includes a mediterranean climate and covers the western regions of iran the regions in this cluster have an average temperature of 9 2 c and total rainfall of 357 2 mm the wheat growing season in this cluster starts in early october and ends in early june 251 days with an average yield of 1 1 ton ha 3 2 sensitivity assessment of random parameters the results of sensitivity assessments of random parameters associated with the optimizing algorithms used in the study i e sca wsa ga for each cluster are listed in the table 3 and a summary of the optimum parameters are provided in table 4 sensitivity analysis indicates the change in the objective function in response to the change in the parameter value for each parameter the value that minimized the objective function was selected as the optimum for the majority of the clusters the optimum population size and maximum iteration number were estimated at 100 the r1 and r2 parameters of the sca algorithm were optimized at 0 8 and π for the first cluster and 0 5 and 2π 3 for other clusters respectively the crossover rate of the ga algorithm was calculated at 0 5 for the first cluster 0 2 for the second and fourth clusters and 0 3 for the third cluster 3 3 selecting input variables and marginal distribution function table 5 displays the best input combinations and their associated γ and v r a t i o values based on the gamma test the selected inputs did not differ significantly in the clusters except for effective precipitation in the first cluster and fertilizer in the second cluster all variables were identified as influential by the gamma test nevertheless the calculated γ and v r a t i o for the variables were not similar across the clusters the lowest γ and v r a t i o values were identified for the cluster ii we tested the gumbel gamma generalized extreme value gev and gaussian models to identify the most representative marginal distribution functions for the observed and predicted yield data fig 6 shows the d value resulting from the k s test for different models and clusters the gumbel distribution was found with the lowest d value range 0 01 0 019 and selected as the most appropriate marginal distribution function for the observed and predicted yield next we tested different copula functions i e the gumbel hougaard frank and clayton functions and the statistical results of these tests are provided in table 6 given the sample size of data the critical d value at the 95 confidence level was 0 047 i e d values above this threshold are not acceptable as shown in table 6 the lowest d value belonged to the gumbel hougaard copula ranging from 0 012 to 0 027 for all models and clusters therefore the gumbel hougaard was applied for further analysis based on the bayesian copula method 3 4 models accuracy assessment the results of accuracy assessments of the models predictions for the training and testing phases are provided in table 7 overall the cbma approach generated the most accurate yield predictions followed by the bma approach based on the statistical metrics derived by comparing the model s predictions and observations the predicted yield using cbma had the lowest errors i e rmse me and pbias and the highest correlation r2 and nse in all clusters the hybrid mlp performed better than the individual mlp and among them the mlp wsa model showed the best performance and mlp ga generated the least accurate predictions the detailed statistics for each cluster are described in the next paragraphs in the first cluster i the cbma approach provided the most accurate predictions in the training phase followed by the bma approach cmba reduced rmse of bma mlp wsa mlp sca mlp ga and mlp by 29 32 41 49 and 59 respectively the hybrid mlp performed better than the individual mlp and among them the mlp wsa model showed the best performance the mae of the mlp wsa model was 7 4 10 and 18 and lower than the mlp sca mlp ga and mlp models the results also showed that the mlp model produced the highest pbias and the lowest nse which signified its poor fitting cbma also had the best performance in the testing phase it reduced mae of bma mlp wsa mlp sca mlp ga and mlp by 28 33 38 47 and 48 respectively among the hybrid models mlp wsa showed the lowest pbias and the highest nse in the second cluster ii using the cbma approach generated the most accurate results in the training and testing phases followed by bma in the training phase cbma reduced the rmse of bma mlp wsa mlp sca mlp ga and mlp by 37 38 50 58 and 60 respectively in the training phase bma reduced the mae of mlp wsa mlp sca mlp ga and mlp by 10 20 54 and 56 respectively among all the tested models and approaches in this cluster mlp produced the lowest nse and the highest pbias a similar accuracy pattern also occurred during the testing phase during this phase rmse of predicted yields using the cbma approach was 47 50 62 64 and 69 lower compared to bma mlp wsa mlp sca mlp ga and mlp respectively the mae of the bma model was 0 0198 whereas the mae of mlp wsa mlp sca mlp ga and mlp models were 0 0224 0 0287 0 0312 and 0 0402 respectively among the hybrid mlp models the mlp wsa showed the most accurate fitting in the third cluster iii using the cmba approach during the testing phase reduced rmse of the predicted yield by bma mlp wsa mlp sca mlp ga and mlp by 6 6 20 26 34 and 34 respectively in this cluster mlp ga was the least accurate in the testing phase the bma reduced the rmse of predicted yield by mlp wsa mlp sca mlp ga and mlp by 7 3 10 23 and 8 2 respectively the mlp produced the highest pbias and lowest nse among all hybrid and non hybrid models similar to the previous clusters the cbma approach generated the most accurate yield prediction during the testing and training phases in the fourth cluster iv using this approach the rsme of the predicted yield was 21 26 34 36 and 39 lower than that of bma mlp wsa mlp sca mlp ga and mlp mlp ga generated the least accurate predictions in this cluster and mlp wsa showed the best performance among all the hybrid mlp models during the testing phase cbma reduced the mae of the predicted yield by bma mlp wsa mlp sca mlp ga and mlp by 12 18 20 33 and 44 respectively the models performance in each cluster was further evaluated using boxplots fig 7 comparing the performance of cbma in the four clusters presented in subfigures a b c and d of fig 7 we can see the range of predicted yield using this approach has close agreement with the observed data except in the first cluster in this cluster the predicted yield in the first quartile was in a higher range 0 4 ton ha compared to the observed values 0 2 ton ha the bma approach could accurately simulate the mean yield values but its performance in simulating the 3rd quartile particularly in clusters i and ii deteriorated the three hybrid models mlp wsa mlp ga mlp ga predicted the yield values in an approximately similar range although mlp was estimated the minimum and maximum values with higher accuracy the largest deviations from the measurements were observed when mlp was used individually in particular the mlp approach did not capture the low yield variability 1st quartile and overestimated the 3rd quartile in the first and second clusters overall the ensemble modeling schemes including cbma and bma performed more accurately than the other approaches the computational time required for each model to process the data is displayed in fig 7 all models processed the data and generated the outputs at an affordable computational time up to 100 s as shown in fig 8 mlp in its default mode i e using the backpropagation algorithm was the slowest approach with nearly 100 s processing time yellow bars in fig 7 using the optimization algorithms with mlp reduced the cpu time in all cases among the optimization algorithms wsa was the fastest method and the ga was the slowest algorithm 3 5 uncertainty assessments this section provides the uncertainty assessment results that were carried out using the glue analysis the resulting r and p parameters are provided in table 8 additionally the time series of the predicted yield by each model for the first cluster is demonstrated in fig 9 as an example to visualize the model uncertainty at a 95 confidence interval 95ppu note that larger p and smaller r values indicate a better model performance with less uncertainty accordingly cbma showed the lowest uncertainty with p 0 95 and r 0 14 this means only 5 of the predicted yield significantly differs from the observed values with a coefficient of variation of 0 14 the red arrows in fig 8 indicate the model deviation from the observed values followed by the cbma approach the bma model with p 0 94 and r 0 16 had the lowest uncertainty in predicting rainfed wheat yield the uncertainty range of the hybrid models ranked as mlp wsa with p 0 93 and r 0 19 mlp sca with p 0 92 and r 0 20 mlp ga with p 0 90 and r 0 22 the mlp model with p 0 89 and r 0 23 had the largest uncertainty among all models by comparing the clusters in terms of their uncertainty parameters the largest p p 0 95 was found in cluster i and the lowest r r 0 11 was observed in cluster iii 4 discussion in this study we first applied the gamma test to determine the optimal input parameters to the models the gamma test has been widely used in agro hydrological applications e g runoff modeling singh et al 2018 evapotranspiration predictions seifi and riahi 2020 to reduce the model development workload we further investigated the cross correlation between the input parameters and the observed yield to validate the gamma test applicability in our work fig 10 in fig 10 a correlation matrix between the parameters used in this study is shown as heatmaps the gamma test did not select precipitation as an input for the models in cluster i our correlation analysis showed that precipitation had the lowest correlation with the observed yield in this cluster the climate of the regions in the first cluster is arid and the low rainfall does not significantly impact yield this low correlation was recognized in the gamma test and this parameter was removed from the input set in cluster i in the second cluster cluster ii fertilizer was not selected for the input set in this cluster effective precipitation and humidity showed a high positive correlation with the observed yield which is consistent with the climate of this cluster wet and humid the regions in this cluster are located in northern iran along the caspian sea with a total rainfall of 814 mm due to the high leaching of nitrogen fertilizer in this region its applicate rate is high and its efficiency is low ahmadi et al 2020a 2020b therefore the fertilizer has been excluded by the gamma test in selecting the effective predictors in cluster ii for the third and fourth clusters the gamma test selected all the parameters as inputs which is consistent with the correlation results fig 10 c d all the models used in this study performed reasonably well in predicting wheat yield our statistical metrics and uncertainty assessments showed the superior performance of the cbma approach compared to other methods and models the cross comparison of the models predictions using taylor diagrams fig 11 ranks their performance with respect to each other the closer the models are to the reference point the better their performance the closer the models are to the reference point black square on the horizontal axis the better their performance accordingly the models performance is ranked as follows cbma bma mlp wsa mlp sca mlp ga and mlp the relatively inferior performance of the mlp model can be attributed to its training algorithm gradient algorithm which has low accuracy and speed in finding the model parameters mlp in its default mode applies the gradient descent algorithm which uses heavily linear regression and classification algorithms the gradient boosting algorithms modify the weights after calculating the gradient on the whole dataset which increases the converge time when mlp was combined with the optimization algorithms its performance improved significantly however the performance of the optimization algorithms differs in terms of their accuracy and computational time the wsa and sca algorithms have a higher ability to find the optimal answer to the optimization problems due to their advanced operators than the ga algorithm our comparison showed that wsa requires less computational time and provides more accurate predictions followed by sca and ga in the study by kaveh and eslamlou 2020 the authors show the high capability of the wsa in searching the spaces with multimodal topography and identifying the near global optimum such exploratory behavior leads to finding new solutions and reduces the possibility of getting trapped in local optima the cbma approach operates as a collective model and includes all the advantages of the individual models borrowing the most accurate features of the individual models in cbma and using multiple distribution functions reduces the error in its predictions nevertheless this approach is more complicated compared to other methods in the circumstances that no individual model can be found to be superior to other models using cbma to estimate the outputs is a viable option to improve the accuracy of individual models lastly the spatial distribution of the observed and predicted yield based on the cbma model is displayed in fig 12 similar to our results many studies have reported on the good performance of machine learning approaches in predicting crop yield particularly wheat yield for example zhou et al reported r2 0 66 0 79 for county level wheat yield prediction in china using random forest support vector machine and least absolute shrinkage models cai et al reported r2 0 75 for county level wheat yield prediction in australia using lasso as a benchmark and three mainstream machine learning methods support vector machine random forest and neural network and wang et al reported r2 0 86 rmse 0 51 ton ha mae 0 39 ton ha for wheat yield prediction in the u s using support vector machine svm random forest rf adaptive boosting adaboost and deep neural network dnn the reported performances in these studies are comparable with our models accuracy considering r2 0 78 and mae 0 07 ton ha in addition to the different machine learning approaches used in different studies the parameters selected for yield prediction vary significantly with some overlapping features in a systematic review by van klompenburg et al 2020 they identified rainfall temperature and soil information as the most widely used features in machine learning models for yield predictions in our study we did not have access to an accurate soil database therefore it was not considered in the modeling framework other newly emerged features that have been considered for wheat yield predictions and generally crop yield predictions include remotely sensed data in studies such as gómez et al 2021 kamir et al 2020 naghdyzadegan jahromi et al 2022 newman and furbank 2021 the researchers have used satellite based vegetation indices to derive yield data adding too many features however may be a source of uncertainty our glue uncertainty analysis section 3 5 and fig 8 showed that in the cbma approach the observed average wheat yields fell well within the 5 and 95 confidence limits but for other methods the predicted yield fell out of the 5 confidence interval limits this indicates that one source of the model uncertainty could be the model structural error additionally our spatial uncertainty assessment showed a higher uncertainty range in the third cluster this indicates that another source of uncertainty could be the other influential features that have not been considered in our study lastly a possible source of uncertainty for this study and generally in all modeling studies could be the input data while we tried to use accurate datasets using the official reports there might still be some error sources in the real world data 5 conclusion in this study we applied machine learning approaches as individual and combined with optimization algorithms and their ensembles using bayesian and capula bayesian methods to predict rainfed wheat yield in iran the performance of each method has been evaluated using various statistical metrics the most important conclusions of this study are as follows 1 using optimization algorithms improves the accuracy of the mlp model among the ga sva and wsa algorithms used in this study wsa showed a superior performance considering its higher yield prediction accuracy and lower computational time 2 we found the pre processing steps to be beneficial for reducing the model development workload the gamma test that was applied in our study was verified using correlation analysis and was found efficient for selecting the best combination for the models the such pre processing step is necessary particularly for a large number of input parameters with complex and nonlinear cross colorations 3 the ensemble modeling approach increased the accuracy of the predictions the accuracy of hybrid mlp was higher than the individual mlp model and the performance of hybrid mlp was further improved when they were combined using the bayesian and copula bayesian approaches the predicted yield using the cbma method showed the closest agreement with the observations based on statistical measures and revealed the lowest uncertainty range based on the glue method 4 combing mlp with wsa generated the fastest and most accurate results among these algorithms whereas mlp combination with ga was the slowest and least accurate nevertheless all optimized algorithms considered in this study added to the accuracy and lowered the training time compared to mpl default optimization algorithm these algorithms however add more complexity to the default mpl there are two main limitations in our study and the presented modeling framework first is the limited input data for the model development in the current modeling approach we only considered the rainfed wheat yield due to the unavailability of the actual irrigation amount that growers apply during a growing season our models also have not considered other management aspects soil information and genetic data the second limitation of the study is the spatial scale of our framework in the current study we considered province level data developing the models on cross scales using finer scale data would have added to the accuracy of the developing models declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper 
9303,an accurate crop yield forecast is vital for sustaining food security and preventing famine artificial intelligence provides a robust tool for integrating environmental physiological and management data and predicting crop yield in this study we used a multilayer perceptron mlp model in its default and hybrid learning modes to predict wheat yield in its default mode mlp was trained with the backpropagation algorithm and in the hybrid mode mlp was trained with the water striders algorithm wsa sine cosine algorithm sca and genetic algorithm ga we further considered two ensemble modeling approaches including the bayesian model averaging bma and copula based bayesian model averaging cbma the study area was classified into four homogenous wheat cultivation regions using the fuzzy clustering approach and for each region the models were trained based on 30 years of fertilizer information harvested yield and climatic data our results showed that hybridizing mlp with an optimization algorithm provides more accurate yield predictions than its default mode wsa required the lowest computational time and its combination with mlp resulted in a more accurate yield prediction compared to other optimization algorithms the accuracy of yield predictions was further improved when ensemble modeling was implemented accordingly the cbma approach generated the most accurate result with the lowest uncertainty range the mean absolute error mae of the cbma was 0 026 0 058 0 088 0 133 and 0 0201 lower than that of the bma mlp wsa mlp sca mlp ga and mlp models glue uncertainty analysis verified the superiority of the hybrid models and ensemble approaches the predicted yield by cbma bma and mlp wsa covered 94 92 and 89 of the observations respectively keywords bayesian model averaging copula based bayesian model averaging genetic algorithm glue uncertainty multi layer perceptron model sine cosine algorithm water strider optimization wheat yield prediction data availability will be sent if requested 1 introduction the increasing population and subsequent food and water consumption combined with climate change are among the main reasons for the global water crisis in recent years zhang et al 2017 the water crisis has translated into a high uncertainty in crop production in many agriculturally dominated regions thus it has become increasingly important to predict crop yield and strengthen national and global food security yield prediction and its uncertainty assessments are required in many advisory and management services and sections including policymakers for timely import and export strategies balaghi et al 2008 han et al 2020 authorities and decision makers for pricing storing and marketing strategies chen et al 2019 and growers and farmers to modify their inputs such as fertilizers to meet the crop and soil demands pantazi et al 2016 yield prediction is particularly important for strategic and staple crops at a national level in many parts of the world particularly in developing countries wheat is considered the primary strategic crop and provides the most calories and protein for the world s food supply cai et al 2019 han et al 2020 wheat is cultivated in almost one sixth of all arable land globally satorre and slafer 1999 and is the most important crop in arid and semi arid regions of asia norouzi et al 2010 with the limited water resources in the semi arid climates these regions have been shifting toward cultivating rainfed wheat iran is an example of a semi arid region with serious water management challenges in the agricultural section jamshidi et al 2020 considering the reported critical condition in 66 5 of groundwater aquifers forootan et al 2014 wheat is the staple food of the national diet and 2 5 of global wheat production is consumed in iran accounts for 47 of daily calories per capita amirnejad and asadpour kordi 2017 the country annually produces around 13 million tons of wheat and nearly 60 of the wheat cultivated lands are rainfed despite the importance of wheat in iran s food basket the country has become one of the largest importers of wheat in recent years since 2000 the average imports of this product have been approximately 3 million tons per year fao 2017 the rate of wheat production on a global scale has also declined steadily over the past decades resulting in the lowest yield growth rate among the world s major agricultural products ray et al 2015 in recent decades researchers have used a variety of models and algorithms to predict wheat yield tao et al 2009 from simple statistical approaches lobell and burke 2010 becker reshef et al 2010 to more advanced crop modeling frameworks li et al 2022 liu et al 2022 among yield prediction approaches ai and soft computing algorithms have been widely used owing to their accurate predictions e g hadadi et al 2022 mohammadi et al 2021 vaheddoost et al 2020 table 1 provides an overview of the application of different soft computing models based on different input data artificial neural network ann is one of the most widely used soft computing models ann has been developed based on artificial intelligence to extract complex nonlinear relationships between input and output data and includes the ability to hybridize with various other models ann has shown been reported with high accuracy in predicting crop yield the core part of ann is its optimization or training algorithm that carries out the learning process many optimization algorithms based on different concepts have been developed that differ in their computational requirements processing speed and numerical precision conventional algorithms such as the backpropagation and gradient methods do not have high convergence speed and can be trapped in local optimums accordingly more novel algorithms with faster convergence speed and higher precision have been introduced the particle swarm optimization pso mohammadi et al 2020 genetic algorithm ga mirjalili 2019 sine cosine algorithm sca mirjalili 2016 and water strider algorithm wsa kaveh and eslamlou 2020 are notable examples of these algorithms the optimization algorithms are robust and reliable tools for enhancing performance of the mlp models these tools can adjust the mlp parameters accurately additionally as shown in table 1 the focus of previous research has been mostly on using individual models rather than using an ensemble approach stand alone modeling approaches are initiated by selecting the best model based on specific criteria and conditioning the parameters according to the selected model in this process the uncertainty involved in model selection is neglected an alternative framework is to process the candidate models parameters first and then fuse the outcomes based on the model s posterior probabilities this approach has been done through the bayesian inference and is known as the bayesian model averaging bma madigan et al 1996 raftery et al 1997 the bma method can increase the accuracy of target variable predictions by creating a weighted average of output pdf of several models bma has been used in several agro hydrological applications e g nguyen huy et al 2021 achieng 2021 yin et al 2021 yang et al 2021 however the bma approach requires the models output to be bias corrected and assumes the gaussian distribution for the response variables madadgar and moradkhani 2014 this assumption can be violated in different scenarios the copula bayesian model averaging cbma modifies the bma assumption using other distribution and copula functions cbma has been reported to improve multi modeling accuracy and reliability in various fields such as groundwater level prediction liu et al 2021 streamflow prediction siqueira et al 2021 and precipitation forecast qi et al 2021 another challenge reported by previous research table 1 is selecting optimal features and attributes for developing an accurate predictive model the convergence speed and model accuracy are expected to improve by reducing data dimensionality and removing redundant attributes from model inputs many algorithms under three main categories including wrapper filter and embedded methods have been proposed for feature selection e g guyon and elisseeff 2006 lal et al 2006 rodriguez galiano et al 2018 the gamma test is a non parametric feature selection method that has gained popularity due to its fast and efficient processing li et al 2021 it measures the nonlinear relationship between the inputs and outputs evaluates data quality and describes the goodness of a predictive model jaafar and han 2012 overall the challenges and caveats in previous research can be summarized in four areas including i the use of stand alone modeling approaches ii overlooking the uncertainty assessments in model selection iii limited variable inputs not considering a combination of climatic and non climatic factors and iv the absence of a proper feature selection strategy therefore in this research we considered a variety of factors including maximum and minimum air temperature wind speed relative humidity sunny hours rainfall fertilizer effective precipitation transpiration and evapotranspiration and applied the gamma test to identify the most effective inputs for predicting wheat yield we used an ann model a multilayer perceptron and tested the accuracy and uncertainty using the glue method of different training algorithms including the default backpropagation algorithm sca ga wsa and ensemble modeling approaches including bma and cbma because of their fast convergence the ability for global search and flexibility these algorithms were chosen in addition to providing national scale crop specific data the study s novelty lies in using ensemble machine learning approaches mlp and neural network approaches have long been used in crop modeling schemes but they have primarily been used on individual modes using their default optimization algorithms this study highlights the advantage and disadvantages of different algorithms and shows the benefits of using ensemble methods additionally the framework that is provided in this study and step by step guidance from selecting the parameters to developing the final ensemble model can be generically adopted for other crop modeling schemes 2 material and methods 2 1 case study this study was performed on a national scale in iran iran is located in the semi arid region of the world yet it includes diverse climates the northern part of the country on the coast of the caspian sea is humid and wet the central to eastern sides have a hot arid climate south and western south have a semi arid climate and the mountainous regions of western to north western areas have a cold snowy climate wheat is a staple agricultural product in iran and it is cultivated almost in all regions as irrigated and rainfed dehghani sargazi et al 2021 the agricultural areas in iran cover 14 68 million hectares of which 41 belong to rainfed cultivation 7 2 million hectares and of this amount 72 5 2 million hectares belong to wheat cultivation the main wheat production areas in iran are shown in fig 1 which includes 21 regions for each of these regions the crop physiological information including yield and fertilization amounts and meteorological data including air temperature precipitation wind speed relative humidity and sunshine hours were retrieved from official national data centers i e the information and communication technology center and the national meteorological organization irimo 2021 ahmadi et al 2020a 2020b the long term average data 30 years for each region is shown in table 2 once the input data was collected we followed certain steps in our framework to apply the machine learning algorithms and predicts the wheat yield over the country these steps are summarized in the flowchart shown in fig 2 the following subsections explain the concept and mathematical representations of each step 2 2 fuzzy clustering algorithm we applied the fuzzy c means clustering algorithm bezdek 1981 to identify the homogenous areas of wheat cultivation each object can belong to several clusters with a membership degree between zero and one in the fuzzy algorithm the fuzzy c means clustering algorithm assigns a set of weighting coefficients u i to each data point r based on the degree of being included in the i th cluster and calculates the centroid of each cluster v i based on eq 1 1 v i k 1 n u ik m r k k 1 n u ik m where m is the fuzziness coefficient and n is the number of data points then the algorithm aims to partition data into c number of clusters by minimizing an objective function mokarian 2018 izakian and mesgari 2020 shown in eq 2 2 j i 1 c k 1 n u ik m d 2 v i r k where d is the distance function and u ik are the weighting coefficients u ik 0 1 i 1 n k 1 c calculated using the following equation 3 u ik 1 j 1 c d v i r k d v j r k 2 m 1 2 3 multi layer perceptron models a multilayer perceptron mpl model is a deep feedforward artificial neural network used to solve classification and regression problems ravi et al 2017 fig 3 displays the mlp structure mpl is composed of an input layer an arbitrary number of hidden or intermediate layers and an output layer the input variable is received in the first layer and processed in the hidden layers using nonlinear activation functions each mlp contains two parameters including weight and bias an input value to a neuron in the intermediate layer is multiplied by the neuron weight and added by a bias as a fixed term then the activation function processes the value and provides the outputs as the input to the output layer the bias and weights are the unknown parameters that are estimated by the training or optimization algorithms mlp uses backpropagation as its training algorithm pandey and barai 1995 taud and mas 2018 in this study we first trained mlp using its default learning algorithm and predicted the yield values several studies have highlighted that the backpropagation technique is slow and unreliable alejo et al 2015 therefore in this study we hybridized mlp with three novel optimization algorithms and tested their performances these algorithms are described in the subsequent sections 2 3 1 the water strider optimization algorithm the water strider optimization algorithm is a population based optimizer developed based on the life span of water strider insects kaveh and eslamlou 2020 the algorithm mathematically models a water strider s five main life cycle stages including birth territory establishment mating feeding and death the structure of the water strider optimization algorithm is shown in fig 4 at the birth stage the initial population of water striders is calculated based on the following equation taking into account the values of the upper and lower limits of the decision variable 4 ws i 0 ub rand ub lb i 1 2 nws where ws i 0 determines the initial position of the i th water strider ub and lb are the maximum and minimum values based on the problem assumption rand is a random number between 0 and 1 nws represents the number of water striders ws s the algorithm evaluates the fitness of the initial position for each member water strider using an objective function then the algorithm creates nt number of domains territory establishment step to categorize the ws s accordingly ws s are ranked by means of their fitness score and classified into nws nt groups the highest rank shows the most optimal foraging habitat that belongs to the female insect presumably and the lowest rank represents the keystone position that belongs to the male insect in the next step mating stage the algorithm adjusts the position of the male insect within each territory using a probability value p and the following equation kaveh and eslamlou 2020 5 ws i t 1 ws i t r rand mating occu rs with probability of p ws i t 1 ws i t r 1 rand no mating with probaility of 1 p where the i th position of the water strider in the t th iterate is represented by ws i t and r is the euclidean distance between the position of the male ws i t 1 and female ws f t 1 insects 6 r ws f t 1 ws i t 1 the feeding stage comes next in the algorithm in this stage the wss that their new position holds less value of the objective function compared to their previous position are moved to the territories with the highest fitness score and positioned around the best ws of the territory ws bl t 7 ws i t 1 ws i t 2 rand ws bl t ws i t suppose the translocated water strider is still assigned with lower fitness score compared to their previous position in that case it is removed from the population death stage and a new water strider is born succession stage based on the following equation kaveh and eslamlou 2020 8 ws i t 1 lb j t 2 rand ub j t lb j t where ub j t and lb j t represent the upper and lower limits of the values of ws in j th territory the algorithm continues its iterations until the termination condition maximum number of iterations is met the wsa based on eqs 5 and 8 provide new solutions these equations allow the wsa to provide better solutions 2 3 2 the sine cosine algorithm sca sca is a population based meta heuristic optimization algorithm that has been recently developed mirjalili 2016 the sca uses the sine and cosine functions to drive the initial population towards or outward the best solution using two following equations 9 x i t 1 x i t r 1 sin r 2 r 3 p i t x i t r 4 0 5 x i t r 1 cos r 2 r 3 p i t x ii t r 4 0 5 where x i t shows the position of the current solution i is the dimension t represents the iteration p refers to the destination solution position and r 1 r 2 r 3 r 4 are random numbers that are considered as the main parameters of the model the r 1 factor defines a search area for movement direction next positions and can be dynamically changed during the iteration stage eq 10 the r2 factor controls the distance and determines whether the next move is toward or outward the destination the r3 factor is a random weight assigned to the best solution so far to increase or decrease the impact of the destination in defining the distance lastly r 4 is used to shift between the sine and cosine functions in eq 9 10 r 1 a t a t where t current iteration t maximum iteration number a constant where t and t are the current and maximum number of iterations and a is a fixed function 2 3 3 structure of genetic algorithm ga the genetic algorithm ga is another population based meta heuristic optimization algorithm that has been developed based on the process of natural selection holland 1992 the genetic algorithm is based on the population of chromosomes initial values of decision metrics such as weight and bias of the mlp model are defined as the initial population of the genetic algorithm the genetic algorithm uses selection intersection and mutation operators the selection operator selects the best chromosomes based on the value of the target function so that these chromosomes produce offspring of the next generation the intersection operator is used to move the gene between two chromosomes gene translocation between chromosomes is used to generate newer responses the mutation operator is another important operator of the genetic algorithm mutation operators are used to increasing the population type of chromosomes the mutation operator moves the genes on a chromosome in order to produce a new chromosome in the genetic algorithm first the initial population is defined next the value of the objective function of each chromosome is calculated the best chromosomes are selected based on the selection operator intersection and mutation operators are used to generate new responses the optimization process continues until the convergence condition is satisfied 2 4 bayesian and copula bayesian model averaging selecting a single model among a class of models to be applied to a specific problem i e in our case for yield prediction ignores the uncertainty in model selection bayesian model averaging bma provides a coherent mechanism through obtaining posterior densities on model parameters and accounts for model uncertainty in decisions and conclusions as follows 11 p y t m 1 t m 2 t m k t y i 1 k ω i p y t m i t y where y t is the quantity to be predicted yield p y t m 1 t m 2 t m k t y represents the predictive distribution of y t or yield based on different model predictions m 1 t m 2 t m k t and observations for the training phase y p y t m i t y is the posterior distribution of y t based on the i th model predictions m i t and y and ω i is the model weight that reflects performance of the model i e the probability of correct predictions by each model during the training period each model s weight was estimated by the log likelihood function and the expectation maximization em algorithm was applied to maximize the log likelihood function as described in raftery et al 2005 the bma algorithm assumes that each model prediction is unbiased otherwise a bias correction approach should be considered and follows a specific pdf e g gaussian gamma etc removing biases from the models is challenging and the model prediction s pdf does not always follow certain distributions thus on some occasions the bma assumptions are violated resulting in biased outcomes integrating a copula function with bma or copula bma cbma can overcome these limitations copulas are multivariate distribution functions that include uniform distributions of multiple parameters in our study the probability distribution of yield predictions from different models can be considered as a multivariate distribution p m 1 t m 2 t m k t based on the sklar theorem sklar 1996 the multivariate distribution of yield predictions can be expressed by the univariate marginal distribution functions of each model prediction p m k t or u k t and a copula that explains the dependence structure between the models predictions huang et al 2019 12 p m 1 t m 2 t m k t c p m 1 t p m 2 t p m k t c u 1 t u 2 t u k t where c is the copula s cumulative distribution function cdf combining the joint probability function of m 1 t m 2 t m k t and their conditional probability distribution based on y t with eq 12 the predictive distribution of y t eq 11 can be re written in a copula format as huang et al 2019 13 p y t m 1 t m 2 t m k t y i 1 k ω i p y t m i t y i 1 k ω i c u m i t u y t p y t where c u m i t u y t represents the copula density function of m i t and y t according to madadgar et al 2014 the values of u m i t and u y t can be obtained by monte carlo sampling as we did in our study for applying cbma to the model s outputs we first identified an appropriate marginal distribution function that most accurately explained the distribution of the observed yield the gumbel gamma generalized extreme value gev and gaussian models were fitted to the observed yield values and the kolmogorov smirnov k s test was used to select the most appropriate distribution function according to the k s test the model with the lowest d value is best fitted to the data 2 5 hybrid mlp models in this study optimization algorithms were used to adjust the mlp parameters mlp parameters were adjusted based on the following steps which are summarized in fig 4 1 the data were divided into training and testing 2 the mlp model was run at the training level 3 the stop condition was checked mlp models go to the testing level if the stop condition is met otherwise they link with the optimization algorithms 4 mlp parameters are defined as the initial population of the algorithms 5 then the mlp runs using the training data 6 an objective function is computed to evaluate the solutions 7 the operators of algorithms are used to update the solutions mlp parameters 8 if the stop convergence condition is satisfied the model goes to step 3 otherwise the model goes to step 6 2 6 gama test many environmental variables and management practices can impact crop yield these impacts are not equal and may vary significantly at different locations using all these potential variables as inputs to machine learning models for yield prediction is not optimal we applied the gamma test to reduce such high dimensionality of the input data and select the optimal inputs for our models the gamma test provides an estimate of the error variance of the model s output that cannot be explained by any models based on the available input information remesan et al 2008 the details of calculating the gamma statistic are provided in evan and jones 2002 in this study we applied the same approach to calculate γ and used the following equation for a standardized gamma based index known as the v ratio 14 v ratio γ σ 2 y where σ 2 y is the variance of the observed data and v ratio represents the scale invariant noise estimate 0 v ratio 1 closer v ratio values to zero indicate a better input combination that can result in more accurate yield predictability by the model in the present study we considered 11 climatic and non climatic inputs generating 211 1 combination of the input variables 2 7 uncertainty assessments using glue we applied the generalized likelihood uncertainty estimation glue analysis beven and binley 1992 to measure the uncertainty of the models glue is a probabilistic analysis method based on the monte carlo simulation we followed the three steps described below to assess the models uncertainty by glue first a feasible range with a uniform distribution for each independent parameter was defined then the latin square sampling lhs technique was used to produce n sets of random parameters the lhs method increases the accuracy of monte carlo simulation the glue engine by sampling independent variables from their distributions at equal intervals abas et al 2018 in the second step the likelihood value l θ i y was calculated using the following equation and using each set of parameters sampled in the previous step θ i 15 l θ i y exp n σ i 2 σ obs 2 where n is the adjustable parameter σ i 2 is the error variance of the i th model σ obs 2 is the observation variance θ i is the set of the parameters of the i th model and l θ i y is the likelihood value of the i th model with respect to observation values of y the resulting likelihood values were compared with a threshold value abas et al 2018 the parameter sets with values greater than threshold were considered acceptable behavioral and retained to determine the uncertainty interval the final step includes calculating the model output uncertainty by calculating the likelihood weight for the acceptable parameter sets as 16 ϑ i l θ i σ k 1 n l θ k where ϑ i is the likelihood weight and n is the number of data eq 16 gives the model output uncertainty s cdf cumulative distribution function i e the weights sum up to one we considered a 95 confidence interval of the resulting cdf as the uncertainty bound i e removing the upper and lower 2 5 of the data the p and r metrics were used to quantify the uncertainty of the model the p metric represents the percentage of the observations that fall into the uncertainty bound and r is calculated as below 17 d x 1 k l 1 k x u x l r d σ x where σ x is the standard deviation of the observed parameter x u and x l are the simulated yield of the upper and lower limit values of 95 prediction uncertainty and k is the number of observations small values of r and large p values p 50 signify a low uncertainty and the opposite shows a high uncertainty level 3 results 3 1 homogenous regions we identified four homogenous regions of rainfed wheat cultivation across the country based on the fcm algorithm fig 5 displays these four regions and table 2 indicates the climatic characteristics of each station located in each region the first cluster cluster i primarily represents the arid regions with an average air temperature of 17 6 c and total rainfall of 185 mm the average wheat growing season in this cluster lasts 262 days from november to june with an average yield of 0 75 ton ha the second cluster cluster ii represents humid regions including northern iran along the caspian sea with an average air temperature of 13 9 c and total rainfall of 814 mm the average wheat growing season in this cluster lasts 211 days from late october to early june with an average yield of 1 6 ton ha cluster iii represents semi arid regions with an average air temperature of 12 c and total rainfall of 264 7 mm the wheat growing season in this cluster starts in early october and ends in early june 251 days with an average yield of 0 9 ton ha cluster iv represents humid regions including northern iran along the caspian sea with an average air temperature of 13 9 c and total rainfall of 814 mm the average wheat growing season in this cluster lasts 211 days from late october to early june with an average yield of 1 6 ton ha cluster iv includes a mediterranean climate and covers the western regions of iran the regions in this cluster have an average temperature of 9 2 c and total rainfall of 357 2 mm the wheat growing season in this cluster starts in early october and ends in early june 251 days with an average yield of 1 1 ton ha 3 2 sensitivity assessment of random parameters the results of sensitivity assessments of random parameters associated with the optimizing algorithms used in the study i e sca wsa ga for each cluster are listed in the table 3 and a summary of the optimum parameters are provided in table 4 sensitivity analysis indicates the change in the objective function in response to the change in the parameter value for each parameter the value that minimized the objective function was selected as the optimum for the majority of the clusters the optimum population size and maximum iteration number were estimated at 100 the r1 and r2 parameters of the sca algorithm were optimized at 0 8 and π for the first cluster and 0 5 and 2π 3 for other clusters respectively the crossover rate of the ga algorithm was calculated at 0 5 for the first cluster 0 2 for the second and fourth clusters and 0 3 for the third cluster 3 3 selecting input variables and marginal distribution function table 5 displays the best input combinations and their associated γ and v r a t i o values based on the gamma test the selected inputs did not differ significantly in the clusters except for effective precipitation in the first cluster and fertilizer in the second cluster all variables were identified as influential by the gamma test nevertheless the calculated γ and v r a t i o for the variables were not similar across the clusters the lowest γ and v r a t i o values were identified for the cluster ii we tested the gumbel gamma generalized extreme value gev and gaussian models to identify the most representative marginal distribution functions for the observed and predicted yield data fig 6 shows the d value resulting from the k s test for different models and clusters the gumbel distribution was found with the lowest d value range 0 01 0 019 and selected as the most appropriate marginal distribution function for the observed and predicted yield next we tested different copula functions i e the gumbel hougaard frank and clayton functions and the statistical results of these tests are provided in table 6 given the sample size of data the critical d value at the 95 confidence level was 0 047 i e d values above this threshold are not acceptable as shown in table 6 the lowest d value belonged to the gumbel hougaard copula ranging from 0 012 to 0 027 for all models and clusters therefore the gumbel hougaard was applied for further analysis based on the bayesian copula method 3 4 models accuracy assessment the results of accuracy assessments of the models predictions for the training and testing phases are provided in table 7 overall the cbma approach generated the most accurate yield predictions followed by the bma approach based on the statistical metrics derived by comparing the model s predictions and observations the predicted yield using cbma had the lowest errors i e rmse me and pbias and the highest correlation r2 and nse in all clusters the hybrid mlp performed better than the individual mlp and among them the mlp wsa model showed the best performance and mlp ga generated the least accurate predictions the detailed statistics for each cluster are described in the next paragraphs in the first cluster i the cbma approach provided the most accurate predictions in the training phase followed by the bma approach cmba reduced rmse of bma mlp wsa mlp sca mlp ga and mlp by 29 32 41 49 and 59 respectively the hybrid mlp performed better than the individual mlp and among them the mlp wsa model showed the best performance the mae of the mlp wsa model was 7 4 10 and 18 and lower than the mlp sca mlp ga and mlp models the results also showed that the mlp model produced the highest pbias and the lowest nse which signified its poor fitting cbma also had the best performance in the testing phase it reduced mae of bma mlp wsa mlp sca mlp ga and mlp by 28 33 38 47 and 48 respectively among the hybrid models mlp wsa showed the lowest pbias and the highest nse in the second cluster ii using the cbma approach generated the most accurate results in the training and testing phases followed by bma in the training phase cbma reduced the rmse of bma mlp wsa mlp sca mlp ga and mlp by 37 38 50 58 and 60 respectively in the training phase bma reduced the mae of mlp wsa mlp sca mlp ga and mlp by 10 20 54 and 56 respectively among all the tested models and approaches in this cluster mlp produced the lowest nse and the highest pbias a similar accuracy pattern also occurred during the testing phase during this phase rmse of predicted yields using the cbma approach was 47 50 62 64 and 69 lower compared to bma mlp wsa mlp sca mlp ga and mlp respectively the mae of the bma model was 0 0198 whereas the mae of mlp wsa mlp sca mlp ga and mlp models were 0 0224 0 0287 0 0312 and 0 0402 respectively among the hybrid mlp models the mlp wsa showed the most accurate fitting in the third cluster iii using the cmba approach during the testing phase reduced rmse of the predicted yield by bma mlp wsa mlp sca mlp ga and mlp by 6 6 20 26 34 and 34 respectively in this cluster mlp ga was the least accurate in the testing phase the bma reduced the rmse of predicted yield by mlp wsa mlp sca mlp ga and mlp by 7 3 10 23 and 8 2 respectively the mlp produced the highest pbias and lowest nse among all hybrid and non hybrid models similar to the previous clusters the cbma approach generated the most accurate yield prediction during the testing and training phases in the fourth cluster iv using this approach the rsme of the predicted yield was 21 26 34 36 and 39 lower than that of bma mlp wsa mlp sca mlp ga and mlp mlp ga generated the least accurate predictions in this cluster and mlp wsa showed the best performance among all the hybrid mlp models during the testing phase cbma reduced the mae of the predicted yield by bma mlp wsa mlp sca mlp ga and mlp by 12 18 20 33 and 44 respectively the models performance in each cluster was further evaluated using boxplots fig 7 comparing the performance of cbma in the four clusters presented in subfigures a b c and d of fig 7 we can see the range of predicted yield using this approach has close agreement with the observed data except in the first cluster in this cluster the predicted yield in the first quartile was in a higher range 0 4 ton ha compared to the observed values 0 2 ton ha the bma approach could accurately simulate the mean yield values but its performance in simulating the 3rd quartile particularly in clusters i and ii deteriorated the three hybrid models mlp wsa mlp ga mlp ga predicted the yield values in an approximately similar range although mlp was estimated the minimum and maximum values with higher accuracy the largest deviations from the measurements were observed when mlp was used individually in particular the mlp approach did not capture the low yield variability 1st quartile and overestimated the 3rd quartile in the first and second clusters overall the ensemble modeling schemes including cbma and bma performed more accurately than the other approaches the computational time required for each model to process the data is displayed in fig 7 all models processed the data and generated the outputs at an affordable computational time up to 100 s as shown in fig 8 mlp in its default mode i e using the backpropagation algorithm was the slowest approach with nearly 100 s processing time yellow bars in fig 7 using the optimization algorithms with mlp reduced the cpu time in all cases among the optimization algorithms wsa was the fastest method and the ga was the slowest algorithm 3 5 uncertainty assessments this section provides the uncertainty assessment results that were carried out using the glue analysis the resulting r and p parameters are provided in table 8 additionally the time series of the predicted yield by each model for the first cluster is demonstrated in fig 9 as an example to visualize the model uncertainty at a 95 confidence interval 95ppu note that larger p and smaller r values indicate a better model performance with less uncertainty accordingly cbma showed the lowest uncertainty with p 0 95 and r 0 14 this means only 5 of the predicted yield significantly differs from the observed values with a coefficient of variation of 0 14 the red arrows in fig 8 indicate the model deviation from the observed values followed by the cbma approach the bma model with p 0 94 and r 0 16 had the lowest uncertainty in predicting rainfed wheat yield the uncertainty range of the hybrid models ranked as mlp wsa with p 0 93 and r 0 19 mlp sca with p 0 92 and r 0 20 mlp ga with p 0 90 and r 0 22 the mlp model with p 0 89 and r 0 23 had the largest uncertainty among all models by comparing the clusters in terms of their uncertainty parameters the largest p p 0 95 was found in cluster i and the lowest r r 0 11 was observed in cluster iii 4 discussion in this study we first applied the gamma test to determine the optimal input parameters to the models the gamma test has been widely used in agro hydrological applications e g runoff modeling singh et al 2018 evapotranspiration predictions seifi and riahi 2020 to reduce the model development workload we further investigated the cross correlation between the input parameters and the observed yield to validate the gamma test applicability in our work fig 10 in fig 10 a correlation matrix between the parameters used in this study is shown as heatmaps the gamma test did not select precipitation as an input for the models in cluster i our correlation analysis showed that precipitation had the lowest correlation with the observed yield in this cluster the climate of the regions in the first cluster is arid and the low rainfall does not significantly impact yield this low correlation was recognized in the gamma test and this parameter was removed from the input set in cluster i in the second cluster cluster ii fertilizer was not selected for the input set in this cluster effective precipitation and humidity showed a high positive correlation with the observed yield which is consistent with the climate of this cluster wet and humid the regions in this cluster are located in northern iran along the caspian sea with a total rainfall of 814 mm due to the high leaching of nitrogen fertilizer in this region its applicate rate is high and its efficiency is low ahmadi et al 2020a 2020b therefore the fertilizer has been excluded by the gamma test in selecting the effective predictors in cluster ii for the third and fourth clusters the gamma test selected all the parameters as inputs which is consistent with the correlation results fig 10 c d all the models used in this study performed reasonably well in predicting wheat yield our statistical metrics and uncertainty assessments showed the superior performance of the cbma approach compared to other methods and models the cross comparison of the models predictions using taylor diagrams fig 11 ranks their performance with respect to each other the closer the models are to the reference point the better their performance the closer the models are to the reference point black square on the horizontal axis the better their performance accordingly the models performance is ranked as follows cbma bma mlp wsa mlp sca mlp ga and mlp the relatively inferior performance of the mlp model can be attributed to its training algorithm gradient algorithm which has low accuracy and speed in finding the model parameters mlp in its default mode applies the gradient descent algorithm which uses heavily linear regression and classification algorithms the gradient boosting algorithms modify the weights after calculating the gradient on the whole dataset which increases the converge time when mlp was combined with the optimization algorithms its performance improved significantly however the performance of the optimization algorithms differs in terms of their accuracy and computational time the wsa and sca algorithms have a higher ability to find the optimal answer to the optimization problems due to their advanced operators than the ga algorithm our comparison showed that wsa requires less computational time and provides more accurate predictions followed by sca and ga in the study by kaveh and eslamlou 2020 the authors show the high capability of the wsa in searching the spaces with multimodal topography and identifying the near global optimum such exploratory behavior leads to finding new solutions and reduces the possibility of getting trapped in local optima the cbma approach operates as a collective model and includes all the advantages of the individual models borrowing the most accurate features of the individual models in cbma and using multiple distribution functions reduces the error in its predictions nevertheless this approach is more complicated compared to other methods in the circumstances that no individual model can be found to be superior to other models using cbma to estimate the outputs is a viable option to improve the accuracy of individual models lastly the spatial distribution of the observed and predicted yield based on the cbma model is displayed in fig 12 similar to our results many studies have reported on the good performance of machine learning approaches in predicting crop yield particularly wheat yield for example zhou et al reported r2 0 66 0 79 for county level wheat yield prediction in china using random forest support vector machine and least absolute shrinkage models cai et al reported r2 0 75 for county level wheat yield prediction in australia using lasso as a benchmark and three mainstream machine learning methods support vector machine random forest and neural network and wang et al reported r2 0 86 rmse 0 51 ton ha mae 0 39 ton ha for wheat yield prediction in the u s using support vector machine svm random forest rf adaptive boosting adaboost and deep neural network dnn the reported performances in these studies are comparable with our models accuracy considering r2 0 78 and mae 0 07 ton ha in addition to the different machine learning approaches used in different studies the parameters selected for yield prediction vary significantly with some overlapping features in a systematic review by van klompenburg et al 2020 they identified rainfall temperature and soil information as the most widely used features in machine learning models for yield predictions in our study we did not have access to an accurate soil database therefore it was not considered in the modeling framework other newly emerged features that have been considered for wheat yield predictions and generally crop yield predictions include remotely sensed data in studies such as gómez et al 2021 kamir et al 2020 naghdyzadegan jahromi et al 2022 newman and furbank 2021 the researchers have used satellite based vegetation indices to derive yield data adding too many features however may be a source of uncertainty our glue uncertainty analysis section 3 5 and fig 8 showed that in the cbma approach the observed average wheat yields fell well within the 5 and 95 confidence limits but for other methods the predicted yield fell out of the 5 confidence interval limits this indicates that one source of the model uncertainty could be the model structural error additionally our spatial uncertainty assessment showed a higher uncertainty range in the third cluster this indicates that another source of uncertainty could be the other influential features that have not been considered in our study lastly a possible source of uncertainty for this study and generally in all modeling studies could be the input data while we tried to use accurate datasets using the official reports there might still be some error sources in the real world data 5 conclusion in this study we applied machine learning approaches as individual and combined with optimization algorithms and their ensembles using bayesian and capula bayesian methods to predict rainfed wheat yield in iran the performance of each method has been evaluated using various statistical metrics the most important conclusions of this study are as follows 1 using optimization algorithms improves the accuracy of the mlp model among the ga sva and wsa algorithms used in this study wsa showed a superior performance considering its higher yield prediction accuracy and lower computational time 2 we found the pre processing steps to be beneficial for reducing the model development workload the gamma test that was applied in our study was verified using correlation analysis and was found efficient for selecting the best combination for the models the such pre processing step is necessary particularly for a large number of input parameters with complex and nonlinear cross colorations 3 the ensemble modeling approach increased the accuracy of the predictions the accuracy of hybrid mlp was higher than the individual mlp model and the performance of hybrid mlp was further improved when they were combined using the bayesian and copula bayesian approaches the predicted yield using the cbma method showed the closest agreement with the observations based on statistical measures and revealed the lowest uncertainty range based on the glue method 4 combing mlp with wsa generated the fastest and most accurate results among these algorithms whereas mlp combination with ga was the slowest and least accurate nevertheless all optimized algorithms considered in this study added to the accuracy and lowered the training time compared to mpl default optimization algorithm these algorithms however add more complexity to the default mpl there are two main limitations in our study and the presented modeling framework first is the limited input data for the model development in the current modeling approach we only considered the rainfed wheat yield due to the unavailability of the actual irrigation amount that growers apply during a growing season our models also have not considered other management aspects soil information and genetic data the second limitation of the study is the spatial scale of our framework in the current study we considered province level data developing the models on cross scales using finer scale data would have added to the accuracy of the developing models declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper 
9304,this study aims to determine whether hass avocado irrigation can be triggered based on the surface soil water content sswc to address this question the soil water dynamics from three hass avocado orchard plots located in valle del cauca colombia was simulated using a model provided by hydrus 1d software which was calibrated through the genetic algorithm nsga ii and validated using the soil matric potential measured at several depths at nine monitoring stations installed in the three plots the influence of each superficial 0 5 5 10 and 10 15 cm and deeper 15 30 and 30 60 cm available water aw computed from the simulated moisture on the swb at 0 60 cm was estimated from the artificial neural network ann trained weights the most influential depth range was used to predict the soil water balance at 0 60 cm using ann for validation the rmse slightly increased regarding calibration varying from 1 73 to 8 20 while the r2 value varied from 0 61 to 0 89 p 0 001 for all cases the aw at 5 10 cm depth had a significant influence on swb with an average relevance index of 2 87 wilcoxon signed rank test p 0 05 for laurentina farm the aw at 0 5 cm depth had not significant influence on swb with an average relevance index of 1 34 independent group and 0 97 p 0 05 for laurentina and poncena respectively the ann model predicted the swb with a rmse no bigger than 13 76 mm in conclusion the sswc at a depth of 5 10 cm can be used as an indicator for scheduling hass avocado irrigation keywords soil water balance swb soil matric potential hydrus 1d genetic algorithm nsga ii artificial neural networks ann data availability data will be made available on request 1 introduction the current situation of highly limited and in demand freshwater resources can be realized in the troublesome fact that approximately 3 2 billion people who live in agricultural areas worldwide are facing water shortages and scarcity fao 2020 instead of bringing a steady panorama climate change will exacerbate the problem increasing the global water deficit in the agricultural sector by 29 9 by 2050 mainly affecting arid and semiarid areas of developing countries huang et al 2021 the efficient use of water in food production is among the first actions to discuss in the global agenda to mitigate the water crisis un 2016 although irrigation significantly decreases the consumption of water green and blue footprints in regard to irrigated versus rainfed crops mekonnen and hoekstra 2011 there is room for improvement in this regard which is the primary agricultural waste water driver perry et al 2009 the hass avocado crop has not escaped these global water concerns studies estimating its negative impact on natural resources cho et al 2021 gonzález estudillo et al 2017 unequal global virtual water trading among countries caro et al 2021 and its large water agricultural footprint novoa et al 2019 have suggested the necessity of rethinking effective and sustainable strategies to overcome water issues avocado growers face this situation in distinct ways while those in subtropical countries with 1000 mm or less yearly rainfall and extensive dry periods are committed to using efficient irrigation systems silber et al 2019 many of those in tropical countries with only short dry annual periods neglect irrigation management practices erazo mesa et al 2021 as part of the second group of countries colombia is highlighted as the tenth largest global hass avocado fruit producer imbert 2020 with an accelerating area growth rate serrano and brooks 2019 strategic market advantages and serious unknowns in production system sustainability builes and duque 2020 which is a product of deep agronomic knowledge gaps ramírez gil 2018 the straightforward decision to bridge water management gaps is to irrigate on a rational basis soil water balance swb and soil based sensors appear to be the most mature irrigation scheduling is methods in regard to hass avocados carr 2013 as a rule of thumb avocado growers who schedule irrigation based on swb use a depth of up to 60 cm called irrigation depth where more than 70 of roots are found lahav and whiley 2002 as those who read the in field soil matric potential smp bury sensors at a 30 cm depth and trigger irrigation when smp reaches between 20 and 50 kpa du plessis 1991 is methods have been invariantly employed for decades gu et al 2020 only changing the technology to perform them moreover irrigation technologies have been commonly provided at a farm scale however outstanding solutions must integrate much more than farm scale responses fao 2020 among the most prospective solutions to improve the water management of open field crops are those supplied by remote sensing rs tolomio and casa 2020 an example of rs products is radar images which are suited to free access ease to use and large scale coverage characteristics lacking conventional is technologies brown et al 2020 the few irrigation studies using radar images can be classified into those detecting irrigation events dari et al 2021 le page et al 2020 and those quantifying the water volume applied etchanchu et al 2019 jalilvand et al 2019 as well as all those taking advantage of the earth surface backscattering phenomenon bakker et al 2009 and soil dielectric properties hallikainen et al 1985 to estimate the state of art variable surface soil water content sswc sswc is the water content in the shallower layer of the soil where tropospheric phenomena interact with life and human actions sswc plays a primary role in infiltration runoff earth s surface temperature regulation and the hydrologic water cycle salas et al 2014 babaeian et al 2019 compartmentalized the soil water content into the surface and near surface and established their maximum depths at 2 and 10 cm respectively however most rs studies have reported in field soil water measurements or readings in a depth range of 0 5 cm to calibrate the soil water content retrieved from radar images benninga et al 2020 xu et al 2021 therefore the sswc in rs studies has not been yet approached from soil science and related disciplines although peng et al 2021 affirmed that the shallow penetration of c band radar sensors is the primary barrier to operationally using sswc estimations in farm scale irrigation tasks the absence of scientific evidence to sustain this affirmation the potential benefits of using rs products in irrigation and the salient rs applications to assimilate soil water estimations from the surface to the root zone soil water that is the soil water at the effective root depth xu et al 2021 leads us to explore before an in field operational implementation the fundamental question can crop irrigation be triggered based on the surface soil water content to address this question for hass avocado crops the following assumptions must be considered hass avocado trees have shallow roots many of them on the soil surface the tree canopy area and amount of mulch generate a microatmosphere in the surface rooting soil zone modifying the sswc dynamics and the type of irrigation system determines how water vertically moves in the soil this study aims to evaluate the potential of the surface soil water content to schedule avocado irrigation simulating sswc of three hass avocado orchards using hydrus 1d software we hypothesize that the soil water content in the top 15 cm of depth is a precise indicator of the soil water dynamics in the root zone of the avocado crop kiggundu et al 2012 2 materials and methods 2 1 location of the study area the study was carried out in 2 ha plots at laurentina olival and poncena which are three hass avocado commercial orchards located in the valle del cauca in the andean mountains colombia at 76 13 14 9 w 4 23 56 3 n 76 42 41 0 w 3 30 13 5 n and 76 29 59 7 w 3 50 6 5 n and with altitudes at 1516 1650 and 1800 m respectively soils in plots were derived from mafic igneous rocks and volcanic ash with a high content of sand in the top two horizons an effective depth of 100 150 cm moderately sloping 12 25 to very steep 25 50 slopes with thermic temperature and udic moisture regimes well drained acidic to very acidic soils and low to very low natural fertility cvc and igac 2017 further soil characteristics such as moisture content saturation θ s field capacity θ fc and permanent wilting point θ pwp as well as bulk density ρ b and texture are presented in table 1 precipitation on the selected farms occurs yearly in two high amount april to june and october to december and two low amount periods july to september and january to march guzmán et al 2014 with an average of 1433 mm a year more than 90 of the precipitation events that occurred during the study at laurentina olival and poncena were lower than 5 mm and shorter than 10 min the air temperature difference between day and night was 5 9 c 2 2 crop characteristics and agronomic practices hass avocado trees were grafted on native rootstocks maintained in a nursery for six months and planted by farmers between 2015 and 2017 using a rectangular pattern paull and duarte 2012 at densities of 408 3 5 7 0 m 204 7 0 7 0 m and 238 trees ha 1 7 0 6 0 m for laurentina olival and poncena respectively avocadoes in these farms are harvested twice a year in april may and september october usually one of these periods corresponds to on and the other to off alternate bearing ramírez gil 2017 postharvest tree pruning is applied at laurentina and poncena farms to mitigate alternate bearing effects farmers triggered irrigation in low precipitation periods when trees manifested water deficit using microsprinkler olival and manual systems poncena at laurentina one hour fertigation was triggered twice a month throughout the year using a drip system plots at olival and laurentina farms have open drainage channels between crop rows to evacuate excess water in high precipitation periods and the poncena plot has only one central open drainage channel the rest of the agronomic practices were partially performed as described in bernal et al 2014 2 3 equipment description and installation one portable weather station and three smp monitoring stations per plot were used to monitor the soil water dynamics and the climate respectively each smp station was composed of one soil temperature sensor three watermark granular matrix sensors a central processing unit receiving the sensor signal and transforming it into physical readings and one solar powered gprs module to transmit data fig 1 before installation watermark sensors were calibrated in the laboratory of soil and water of universidad del valle using soil from the plots shock et al 1998 davis vantage pro 2 for poncena and olival and lynkbox meteo for laurentina weather stations were equipped with temperature solar radiation wind direction and magnitude relative humidity and precipitation sensors each plot was divided into three zones according to the hillslope position top middle and bottom ritsema et al 1996 and the spatial variability of soil texture fig 1b van pelt and wierenga 2001 a representative avocado tree was selected in each zone based on canopy characteristics forming a three tree line of 60 100 m in length fig 1b sensors were buried below the soil wetting volume of each tree near the drippers dabach et al 2015 yang et al 2019 in the maximum crop root water uptake zone coelho et al 2007 goodall 1986 at depths of 15 45 and 75 cm representative of 0 30 31 60 and 61 90 cm depth ranges respectively fig 1c due to negligence in the sensor installation the deepest smp sensor at poncena farm was installed at 60 cm the temperature probe was buried at 45 cm weather stations were installed inside plots at 3 m above the ground and operated and maintained according to the recommendations of asabe 2006 2 4 acquisition and preprocessing of data data from the smp monitoring station and lynkbox meteo were recorded for the first five months every 1 h and 15 min respectively and then every 10 min and 5 min respectively and transmitted through grps to an internet server lynks ingeniería climate data from davis stations were recorded every 5 min in a datalogger and manually imported using weatherlink 6 0 5 software davis instruments 2020 all these readings were recorded for one year starting on 15 august 2020 a set of r functions was coded to process these data for smp data the coded r functions performed the following steps 1 reading microsoft excel files downloaded from the lynks ingeniería server 2 changing default column names 3 formatting the column date to posixct format and rounding it to the nearest hour 4 removing outliers 200 kpa smp 5 matching the smp values of the three trees by plotting at the same depth using column date and 5 exporting the resulting database to csv for weather station data the coded r functions performed the following steps 1 reading txt for davis station files or microsoft excel files for lynkbox meteo file 2 repeating step 3 described for the smp data 3 according to the climate variable computing the minimum maximum sum or mean by the hour and 4 repeating step 5 described for the smp data 2 5 soil water dynamics modeling sswc was retrieved by modeling the one dimensional vertical z axis water movement in unsaturated soils as described by the partial differential equation of richards eq 1 this mathematical transient model establishes that the spatiotemporal changes in the moisture content θ of unsaturated soils are governed by gravitational and matric forces that is how fast water moves into the soil given by the unsaturated hydraulic conductivity function k h and the soil matric potential h which is conditioned by cohesion and adhesion forces in the soil hillel 2014 1 θ t z k h h z s the sink term s in eq 1 refers to the amount of water removed by roots defined by the feddes model feddes et al 1988 pressure head values of 10 300 and 500 cm below which roots start to extract water extract water at the maximum possible rate and can no longer extract water at the maximum rate respectively were set in the feddes model according to hydrus 1d recommendations the soil water retention curve used to relate θ h and k h is given by the van genuchten model eqs 2 and 3 with the pore distribution of mualem mualem 1976 van genuchten 1980 where α m 1 1 n n 1 and n are fitting parameters k s is the saturated hydraulic conductivity l is the pore connectivity parameter and s e θ θ r θ s θ r 2 θ h θ r θ s θ r 1 α h n m h 0 θ s h 0 3 k h k s s e l 1 1 s e 1 m m h 0 k s h 0 the initial soil retention curve parameters α n θ s θ r and k s were obtained through the artificial neural network prediction module provided by rosetta lite 1 1 using farm soil properties as the training set table 1 the rmse by depth and the determination coefficient r 2 by farm were computed to compare the measured θ s θ fc and θ pwp at 0 33 and 1500 kpa respectively vs the optimized van genuchten model the effective precipitation was computed according to the interception model proposed by von hoyningen hüne 1983 and braden 1985 interception model parameters a interception constant b soil cover fraction and leaf area index lai were set to 0 25 mm d 1 0 40 and 3 5 cantuarias avilés 1995 respectively as constants because the tree canopy structure in the three farms did not change significantly during the study period the numerical approximation using finite differences of the richards equation solution was obtained by hydrus 1d version 4 17 software šimůnek et al 2008 boundary conditions were set assuming that the evapotranspiration separated into evaporation and transpiration and precipitation at the study sites interact with the soil surface no ponding in any case and water excesses are deeply drained below the end profile the soil profile was split into three layers materials at depths coinciding with the installed smp sensor depth and discretized using a gradient descent node density at depth from 10 nodes cm 1 at the soil surface to 1 node cm 1 at the bottom of the profile the avocado roots were linearly distributed assuming 70 is found in the top 60 cm of depth lahav and whiley 2002 hydrus 1d was executed for an hourly time step initializing with a homogeneous soil water content by layer 2 6 model calibration and validation calibration of the soil water dynamics model at the farms was performed in r software using the multiobjective optimization genetic algorithm ga called nondominated sorting genetic algorithm nsga ii simunek et al 2012 the multiobjective function to minimize was the rmse by depth eq 4 computed from observed h obs vs hydrus 1d simulated soil matric potential data h sim of a representative instrumented tree in a simulation time of approximately 720 h taken from 15 august 2020 14 february 2021 the nsga ii algorithm slightly perturbed over 50 generations a population size of 200 mutation of 10 and crossover probability of 70 the soil retention curve parameters the type of drainage free it is a drainage flux beyond the maximum modeled soil depth and deep it is a drainage flux with a groundwater reference level of 2 m the rainfall interception and radiation extinction coefficient multiplying each of these parameters by a factor between 0 9 and 1 1 4 rmse 1 n i 1 n h obs i h sim i 2 validation was carried out using the optimized parameters described above to simulate the hourly soil matric potential in hydrus 1d for approximately 1000 h maximum processing records allowed by hydrus 1d taken from 15 february 2020 15 august 2021 and comparing these values with the soil matric potential observed in the field model performance was evaluated using the rmse eq 4 and the determination coefficient r 2 2 7 soil water balance model description and its comparison with the surface soil water content the water balance in the hass avocado root zone depth z 0 60 cm was estimated through the model described in allen et al 1998 eq 5 where swb i 1 represents the change in the soil water storage in the i 1 th computation time i i is the water of irrigation which was triggered when smp decreases by 50 kpa based on recommendation of bower 1979 ep i is effective precipitation computed using the same model as that used for hydrus 1d simulation et ci is the crop evapotranspiration k c 0 75 r i is the runoff and d i is the deep percolation all occurring in i th time and water depth units 5 swb i 1 i i ep i et ci r i d i the following assumptions were introduced to set the swb when the water balance exceeded the irrigation need swb i 1 was equal to the water depth at field capacity the minimum amount of water that reached swb i 1 was given by the permanent wilting point value and drainage and runoff were neglected the magnitude of i i was computed through the readily available water model raw eq 6 waller and yitayew 2016 where θ fc and θ pwp are the soil water content at field capacity and permanent wilting point respectively z i is the root zone depth of layer i n is the number of layers and f is a depletion factor which depends on the irrigation system for laurentina f 0 9 and for poncena and olival f 0 5 6 raw f i 1 n θ fc θ pwp z i according to the soil depth ranges used in most rs studies sswc was defined through the available soil water aw at 0 5 5 10 and 10 15 cm aw at 15 30 and 30 60 cm was also evaluated jointly with soil water content depths equal to 0 60 cm which is the hass avocado root depth used to compute the swb for each depth range aw i 1 was computed by adding the product of the simulated volumetric soil water content θ in the validation time i with each r th simulation node depth as described in section 2 5 where n is the total number of nodes in the evaluated depth range eq 7 7 aw i 1 r 1 n z r 1 z r θ r i to evaluate whether sswc can be used as an indicator for hass avocado irrigation scheduling the influence of the surface 0 5 5 10 and 10 15 cm and deeper 15 30 and 30 60 cm aw i 1 on the change in the soil water storage swb i 1 eq 5 at 0 60 cm was estimated through a relevance metric analysis satizábal and pérez uribe 2007 which produces a dimensionless relevance index from the trained artificial neural network ann weights anns were trained 500 times by farm using a multilayer perceptron with a fixed architecture of 5 30 and 1 neuron in the input hidden and output layers respectively and taking as input variables the aw at the five depth ranges and the output variable as the swb at 0 60 cm percentage of training up to 65 of the dataset learning algorithm backpropagation and activation function tangent hyperbolicus on the computed relevance index by depth range a wilcoxon signed rank test p 0 05 was performed to determine which depth ranges conformed to an independent group labeled as 1 or not labeled as 0 when they were compared the available water simulated by hydrus 1d in the validation period at most influencing depth range by farm which was computed through the previous analysis was used as the input variable of an ann with an architecture of six layers 1 1 2 5 3 10 4 5 5 2 6 1 layer neurons in the layer to predict the swb the ann was trained 500 times with up to 65 of the percentage of the dataset all data analysis and graphical representation were performed using r software nsga2r ga nsga ii neuralnet ann training and ggplot2 graphs libraries 3 results 3 1 acquisition and preprocessing of data a range from 33 210 to 43 831 smp raw records per tree and by soil depth and 60 238 89 950 raw climate records by farm were obtained in the study period after removing outliers reducing to an hourly scale and matching valid smp and climate data the resulting database was reduced from the initial raw records to 8723 records fig 2 climate data for 0 20 and 36 days were missing for laurentina olival and poncena farms respectively smp varied in the three farms from 0 to 193 kpa with an average value recorded by the sensor at 15 cm of 22 6 kpa 19 6 kpa and 22 0 kpa for laurentina olival and poncena farms respectively the highest smp variability in the irrigation depth was found at poncena farm with a coefficient of variation cv of 81 0 while the lowest smp variability was recorded at laurentina farm with a cv of 38 7 fig 2 annual precipitation of 1372 1782 and 1275 mm distributed in 145 83 and 73 events 5 mm were recorded for laurentina olival and poncena farms respectively the daily evapotranspiration and precipitation varied from 0 4 to 4 2 mm and 0 73 mm respectively an increase in the annual precipitation compared with the historical record was reported by ideam 2021 because 10 out of 12 months of the study period were influenced by the enso phenomena phase la niña noaa 2021 to fulfill the crop water requirement 44 0 and 5 irrigation events were applied at laurentina olival and poncena farms respectively fig 2 3 2 calibration and validation of the hydrus 1d model a total of nine parameters were optimized using ga nsga ii including six retention curve parameters each one by three depths table 2 the type of drainage deep or free and the coefficients of rainfall interception and radiation extinction the type of drainage selected by nsga ii was free for all farms while the radiation extinction coefficients 0 25 0 05 and 0 29 for laurentina olival and poncena farms respectively were close to 0 39 the recommended value by hydrus 1d software for agricultural crops the magnitude of the optimized rainfall interception coefficient 1 80 0 12 and 1 18 mm d 1 for laurentina olival and poncena farms respectively was directly correlated with the observed tree canopy volume and the age of trees at each farm good agreement was found between the θ s and θ r determined in the laboratory and the optimized by nsga ii algorithm after the initial prediction with rosetta software resulting in a rmse not higher than 0 07 cm3 cm 3 a determination coefficient r2 value by farm not lower than 0 66 table 2 and a global value including the three farms r 2 0 97 p 0 001 after a ga nsga ii processing time of 4 5 d approximately 12 h by soil profile each algorithm execution converged to 200 possible solutions the best solution for each execution was selected based on the lowest sum of the rmse by depth which was a product of comparing the observed vs simulated soil matric potential by using hydrus software the results showed that the soil water dynamics model based on the richards equation showed good agreement in both calibration and validation with the observed soil matric potential data fig 3 for calibration in the laurentina and poncena farms the high smp variation in the top 15 cm of soil depth led to a rmse above 6 kpa contrasting with the olival farm where the rmse was below 2 kpa table 3 the smp at 45 and 60 75 cm depths was less variable than that at 15 cm depth causing the rmse to be larger than 4 33 kpa poncena depth 60 cm in the case of laurentina and poncena farms smaller than that of the surface layer the process of optimizing the parameters in the calibration succeeded because the resulting soil water dynamics model followed the rise and fall of smp at the three farms fig 3 the determination coefficient r2 value was higher than 0 52 poncena depth 60 cm at all depths table 3 olival was the farm with the best agreement between the observed and simulated smps in contrast to poncena which had the lowest r2 value on the olival and poncena farms the r2 value in the surface layer was higher than or equal to that in the deepest layers at laurentina the r2 value in the surface layer was lower than that in the deepest layers table 3 the performance of the soil water model in the validation had contrasting results in comparison with the calibration fig 4 at laurentina the r2 value in the validation was similar to that in the calibration not being smaller than 0 74 and the rmse slightly increased at 15 cm of depth at olival the r2 value notably decreased to 0 61 at depths of 15 and 75 cm of depth at poncena the validation performed better than the calibration increasing the r2 value at all depths and decreasing the rmse at depths of 15 and 60 cm 3 3 soil water balance model vs the surface soil water content the water depth corresponding to the swb model at 0 60 cm and the simulated aw at the surface 0 5 5 10 and 10 15 cm and deeper 15 30 and 30 60 cm depth ranges were computed in the validation period fig 5 soil layers up to 15 cm contained an average one standard deviation of 7 91 2 52 7 02 1 93 and 33 81 1 11 of the total water while the deepest layers store the remaining 92 09 2 52 92 98 1 93 and 66 19 1 11 for laurentina olival and poncena farms respectively significant water changes at irrigation depth of 0 60 cm occurred in the soil surface layers at laurentina and olival with coefficients of variation of 39 14 and 30 93 respectively while in deeper layers at these farms the cv varied by 6 92 and 13 02 in poncena the variation at the surface and deeper layers was similar with a coefficient of variation of 13 31 and 12 63 respectively the average absolute difference between the total aw that is the sum of all depth ranges and the swb was 10 26 and 29 mm for laurentina olival and poncena farms respectively fig 5 in the validation period 25 0 and 2 irrigation events were applied at laurentina olival and poncena farms respectively fig 5 the average absolute difference between swb and aw when irrigations at laurentina were applied was 8 mm which represents 29 of the raw applied in this farm with a minimum value of 0 mm irrigations labeled as 6 and 7 in fig 5 and a maximum value of 17 mm irrigation labeled as 10 in fig 5 swb was higher than aw in 4 out of the 25 irrigations at laurentina irrigations labeled as 11 17 18 and 22 in fig 5 swb could not be computed for poncena when the two irrigations were applied because climate data were missed the 500 anns trained by farm converged indicating good agreement r2 value 99 confidence interval ci of 0 68 0 677 0 683 0 78 0 778 0 782 and 0 58 0 579 0 581 p 0 001 for all cases for laurentina olival and poncena farms respectively and low prediction error rmse 99 ci of 4 3 92 4 02 8 7 97 8 03 and 7 6 99 7 01 mm for laurentina olival and poncena respectively between the aw at the five depths inputs and the swb output the relevance metric analysis performed on the resulting training ann weights suggested that aw at 5 10 cm for three farms were the most influential depth ranges on swb with an average relevance index 99 ci of 2 31 2 14 2 48 2 87 2 71 3 03 independent group wilcoxon signed rank test p 0 05 and 1 78 1 45 2 11 fig 6 among the surface depth ranges 0 5 cm depth range had less influence on swb with a relevance index 99 ci of 1 34 1 27 1 41 independent group 1 39 1 31 1 47 and 0 97 0 82 1 12 independent group p 0 05 respectively expressed by percent the soil water content in the top 15 cm of soil influenced the swb by 57 89 69 86 and 67 74 for laurentina olival and poncena respectively fig 6 the three farms available water at 5 10 cm depth range was used to predict the soil water balance at 0 60 depth 99 6 29 2 and 11 6 of anns converged in the training using 65 40 and 45 of the dataset respectively for laurentina olival and poncena comparing predicted swb with observed swb shows that although a good agreement was not found in olival and poncena farms r2 value 99 ci 0 37 0 362 0 376 and 0 56 0 556 0 568 respectively the error prediction was low rmse 99 ci 13 76 13 69 13 83 and 6 8 6 75 6 85 mm respectively fig 7 a good agreement r2 value 0 67 0 672 0 672 and low error prediction rmse 4 62 4 62 4 62 were found for laurentina the agreement and prediction error found for the three farms suggest that the aw at 5 10 cm depth can be an indicator of the soil water balance at 0 60 cm depth fig 7 when the irrigation events were applied at laurentina the trained ann model predicted the swb with an error varying between 11 irrigation event labeled as 21 in fig 7 and 10 mm irrigation event labeled as 7 in fig 7 and with an average absolute error of 4 mm which represents a 14 of the raw expressing the ann model error in terms of the difference in time to triggering a hypothetical irrigation event that is how much time the triggering was anticipated or delayed based on the soil water balance of the previous 12 h in the 52 of the irrigation events the triggering was anticipated on average 21 h while in 48 of the irrigation events the triggering was delayed on average 17 h 4 discussion 4 1 acquisition and preprocessing of data a proper amount and quality of data to validate the water dynamics model in the soils cropped with hass avocado was obtained through the installed sensors and soil samples collected in the field among the challenges that were overcome during the acquisition of sensor data there was a frequent loss of internet signal in the study zones which forced each time to restart the system in the field irrigation system failures and mobility restrictions in the study period due to the covid 19 pandemic that affected field visits this last challenge led to missing climate data at poncena and olival farms where the data download process was manual the preprocessing data step was critical for cleaning data and identifying the most representative calibration period for each farm the hourly time step used in this study to model the soil water dynamics differed from the daily basis used for most hydrus studies under tropical conditions similar to those occurring in this study where fallen precipitation is highly heterogeneous and variable richter 2016 a short time step permitted detailed modeling of the effect of precipitation on many hydrological variables such as the soil matric potential dunkerley 2021 however the rmse of the model calibration could increase because the precipitation interception model available in hydrus 1d software was calibrated to daily precipitation irrigation at laurentina and precipitation at olival and poncena played a paramount role in the smp variation while irrigations of 28 mm at laurentina slightly negatively depleted the smp precipitation of a similar magnitude at olival and poncena considerably reduced the smp figs 3 and 4 this was due to the punctual water application in each irrigation event moistening a reduced soil volume while precipitation moistened the soil homogeneously the high smp variability observed in the three farms study periods was associated with the terrain slope soil variability and the high heterogeneity of precipitation 4 2 calibration and validation of the hydrus 1d model calibration of the soil water dynamics model using hydrus 1d was successfully performed the agreement r2 and the visual adjustment between the observed and simulated water dynamics found for the three farms are similar to those reported by li et al 2019 for apple orchards and tu et al 2021 for citrus orchards the rmse obtained in this study could not be compared with that of other studies because they reported the rmse in soil water content units during the study period smp at the three farms was more variable in the top 15 cm of depth than 45 and 75 cm fig 3 agreeing with that reported by er raki et al 2021 in an irrigated wheat crop although it may be obvious that the superficial soil layers exhibit greater variability than the deepest layers because this layer is exposed more to atmospheric changes at the soil surface the groundwater contribution may generate the highest variability in the deepest layers according to a report by hou et al 2017 the genetic algorithm nsga ii optimizing the hydrus 1d parameters represents a suitable option due to its flexibility in the parameter selection the upper and lower bound selection to search the optimal parameter values and the option to optimize multiple target outputs the high ga nsga ii processing time by soil profile approximately 36 h was due to the high number of parameters to optimize although the common approach reported in hydrus 1d studies is to optimize through conventional techniques few parameters in the entire profile in this study nine parameters were optimized demonstrating that a single parameter by depth can be optimized 4 3 soil water balance model vs the surface soil water content water in the soils cropped with hass avocado at the three farms varied considerably in the top 15 cm of the soil depth during the validation period conversely water slowly accumulated and redistributed in the 15 60 cm depth range fig 5 irrigation application at laurentina and poncena farms and rainfall in olival farm kept the soil matric potential below 50 kpa it maintained sufficient water in the root zone for the crop to carry out its physiological processes moreover a rational scheduling of surface irrigation also reduces fertilizer leaching kiggundu et al 2012 these surface deeper soil water dynamics differences that occurred at the three hass avocado farms were also reported in other studies roets et al 2013 silber et al 2019 among the factors explaining the strong influence of the available water at the top 15 cm on the soil water balance at 0 60 cm fig 6 are the light textures in the upper layers at the three farms table 1 the high slope of the terrain where the three orchards were established exposure of the first soil layers to the solar radiation and air temperature changes and high root density of the avocado tree in the first 20 cm of depth in sandy soils salazar garcia and cortés flores 1986 studies relating water in the top centimeters of soils cropped with hass avocado to nutrient use efficiency beyer et al 2021 nutritional status tzatzani et al 2020 salinity acosta rangel et al 2019 and gene expression and flowering acosta rangel et al 2021 demonstrate the importance of soil water dynamics in this depth range the proposed model that represents the soil water balance at the irrigation depth through a fraction of the available water in this case the aw at 5 10 cm fig 7 implies rethinking the traditional irrigation scheduling for hass avocado at 60 cm which could simplify the soil water or soil matric potential measurements and improve the efficiency of irrigation application according to that found by mbabazi et al 2017 surface irrigations lead to implement periodically leaching to avoid soil salinization conversely the soil s heterogeneous composition and complex structure in its first 5 cm due to the high amount of mulch macro organisms grass coverage fertilizer application and other agronomic tasks in this zone alter its water dynamics therefore the available water in the 0 5 cm depth range is not a confident measure for scheduling or applying the irrigation for hass avocado crop the model relating aw at 5 10 cm to swb proposed in this study fig 7 opens the door to future studies using band c sar images to schedule hass avocado crop irrigation our results contribute to improve the sswc modeling needed to compute irrigation parameters using sar images dari et al 2021 le page et al 2020 because represent the first step to identify the most sensitive depth to compute sswc a practical irrigation scheduling in field for hass avocado crops using sar images results from computing the amount of irrigation water to be applied for the crop from the difference between the soil moisture at field capacity and sswc eisenhauer et al 2021 this irrigation scheduling can be accessed when sar satellites visit the study area the main limitations of the proposed model are the complexity of training the artificial neural networks and the necessity of determining the most influential depth range for each crop system the major novelty of this study is represented by the detailed analysis of the soil water dynamics at the irrigation depth fractioning the first 60 cm of the soil profile cropped with hass avocado 5 conclusions the soil water dynamics analysis at the soil surface of the hass avocado crop and its correlation with the soil water balance at 0 60 cm depth range through an artificial neural network model presented in this study permit us to conclude that the soil water content at 5 10 cm of depth range can be used as an indicator to schedule the crop irrigation moreover the available water in the top 15 cm of the irrigation depth in the hass avocado crop significantly influenced the total water required by the crop most remote sensing studies that correlate the backscattering coefficient and incidence angle from synthetic aperture radar sar images with the surface soil water content 0 5 cm depth range to estimate irrigation parameters should study the soil water dynamics at all irrigation depth to determine the depth range that best represents the total irrigation requirement of the crop declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgement we thank prof eduar aguirre universidad del valle for her guidance in the implementation of the genetic algorithm nsga ii and the support of fernando rendón miguel angel r and cené albán farmers from the laurentina olival and poncena farms respectively special thanks to rodrigo jiménez and kellym lópez young researchers of universidad del valle for their assistance received during field activities funding this research was granted by the research group regar engineering faculty universidad del valle smp monitoring and weather station loans and supported by the laboratory of soil and water of universidad del valle soil matric potential sensor calibration and soil physics determinations and the laboratory of soils of providencia s a soil water retention curve determination 
9304,this study aims to determine whether hass avocado irrigation can be triggered based on the surface soil water content sswc to address this question the soil water dynamics from three hass avocado orchard plots located in valle del cauca colombia was simulated using a model provided by hydrus 1d software which was calibrated through the genetic algorithm nsga ii and validated using the soil matric potential measured at several depths at nine monitoring stations installed in the three plots the influence of each superficial 0 5 5 10 and 10 15 cm and deeper 15 30 and 30 60 cm available water aw computed from the simulated moisture on the swb at 0 60 cm was estimated from the artificial neural network ann trained weights the most influential depth range was used to predict the soil water balance at 0 60 cm using ann for validation the rmse slightly increased regarding calibration varying from 1 73 to 8 20 while the r2 value varied from 0 61 to 0 89 p 0 001 for all cases the aw at 5 10 cm depth had a significant influence on swb with an average relevance index of 2 87 wilcoxon signed rank test p 0 05 for laurentina farm the aw at 0 5 cm depth had not significant influence on swb with an average relevance index of 1 34 independent group and 0 97 p 0 05 for laurentina and poncena respectively the ann model predicted the swb with a rmse no bigger than 13 76 mm in conclusion the sswc at a depth of 5 10 cm can be used as an indicator for scheduling hass avocado irrigation keywords soil water balance swb soil matric potential hydrus 1d genetic algorithm nsga ii artificial neural networks ann data availability data will be made available on request 1 introduction the current situation of highly limited and in demand freshwater resources can be realized in the troublesome fact that approximately 3 2 billion people who live in agricultural areas worldwide are facing water shortages and scarcity fao 2020 instead of bringing a steady panorama climate change will exacerbate the problem increasing the global water deficit in the agricultural sector by 29 9 by 2050 mainly affecting arid and semiarid areas of developing countries huang et al 2021 the efficient use of water in food production is among the first actions to discuss in the global agenda to mitigate the water crisis un 2016 although irrigation significantly decreases the consumption of water green and blue footprints in regard to irrigated versus rainfed crops mekonnen and hoekstra 2011 there is room for improvement in this regard which is the primary agricultural waste water driver perry et al 2009 the hass avocado crop has not escaped these global water concerns studies estimating its negative impact on natural resources cho et al 2021 gonzález estudillo et al 2017 unequal global virtual water trading among countries caro et al 2021 and its large water agricultural footprint novoa et al 2019 have suggested the necessity of rethinking effective and sustainable strategies to overcome water issues avocado growers face this situation in distinct ways while those in subtropical countries with 1000 mm or less yearly rainfall and extensive dry periods are committed to using efficient irrigation systems silber et al 2019 many of those in tropical countries with only short dry annual periods neglect irrigation management practices erazo mesa et al 2021 as part of the second group of countries colombia is highlighted as the tenth largest global hass avocado fruit producer imbert 2020 with an accelerating area growth rate serrano and brooks 2019 strategic market advantages and serious unknowns in production system sustainability builes and duque 2020 which is a product of deep agronomic knowledge gaps ramírez gil 2018 the straightforward decision to bridge water management gaps is to irrigate on a rational basis soil water balance swb and soil based sensors appear to be the most mature irrigation scheduling is methods in regard to hass avocados carr 2013 as a rule of thumb avocado growers who schedule irrigation based on swb use a depth of up to 60 cm called irrigation depth where more than 70 of roots are found lahav and whiley 2002 as those who read the in field soil matric potential smp bury sensors at a 30 cm depth and trigger irrigation when smp reaches between 20 and 50 kpa du plessis 1991 is methods have been invariantly employed for decades gu et al 2020 only changing the technology to perform them moreover irrigation technologies have been commonly provided at a farm scale however outstanding solutions must integrate much more than farm scale responses fao 2020 among the most prospective solutions to improve the water management of open field crops are those supplied by remote sensing rs tolomio and casa 2020 an example of rs products is radar images which are suited to free access ease to use and large scale coverage characteristics lacking conventional is technologies brown et al 2020 the few irrigation studies using radar images can be classified into those detecting irrigation events dari et al 2021 le page et al 2020 and those quantifying the water volume applied etchanchu et al 2019 jalilvand et al 2019 as well as all those taking advantage of the earth surface backscattering phenomenon bakker et al 2009 and soil dielectric properties hallikainen et al 1985 to estimate the state of art variable surface soil water content sswc sswc is the water content in the shallower layer of the soil where tropospheric phenomena interact with life and human actions sswc plays a primary role in infiltration runoff earth s surface temperature regulation and the hydrologic water cycle salas et al 2014 babaeian et al 2019 compartmentalized the soil water content into the surface and near surface and established their maximum depths at 2 and 10 cm respectively however most rs studies have reported in field soil water measurements or readings in a depth range of 0 5 cm to calibrate the soil water content retrieved from radar images benninga et al 2020 xu et al 2021 therefore the sswc in rs studies has not been yet approached from soil science and related disciplines although peng et al 2021 affirmed that the shallow penetration of c band radar sensors is the primary barrier to operationally using sswc estimations in farm scale irrigation tasks the absence of scientific evidence to sustain this affirmation the potential benefits of using rs products in irrigation and the salient rs applications to assimilate soil water estimations from the surface to the root zone soil water that is the soil water at the effective root depth xu et al 2021 leads us to explore before an in field operational implementation the fundamental question can crop irrigation be triggered based on the surface soil water content to address this question for hass avocado crops the following assumptions must be considered hass avocado trees have shallow roots many of them on the soil surface the tree canopy area and amount of mulch generate a microatmosphere in the surface rooting soil zone modifying the sswc dynamics and the type of irrigation system determines how water vertically moves in the soil this study aims to evaluate the potential of the surface soil water content to schedule avocado irrigation simulating sswc of three hass avocado orchards using hydrus 1d software we hypothesize that the soil water content in the top 15 cm of depth is a precise indicator of the soil water dynamics in the root zone of the avocado crop kiggundu et al 2012 2 materials and methods 2 1 location of the study area the study was carried out in 2 ha plots at laurentina olival and poncena which are three hass avocado commercial orchards located in the valle del cauca in the andean mountains colombia at 76 13 14 9 w 4 23 56 3 n 76 42 41 0 w 3 30 13 5 n and 76 29 59 7 w 3 50 6 5 n and with altitudes at 1516 1650 and 1800 m respectively soils in plots were derived from mafic igneous rocks and volcanic ash with a high content of sand in the top two horizons an effective depth of 100 150 cm moderately sloping 12 25 to very steep 25 50 slopes with thermic temperature and udic moisture regimes well drained acidic to very acidic soils and low to very low natural fertility cvc and igac 2017 further soil characteristics such as moisture content saturation θ s field capacity θ fc and permanent wilting point θ pwp as well as bulk density ρ b and texture are presented in table 1 precipitation on the selected farms occurs yearly in two high amount april to june and october to december and two low amount periods july to september and january to march guzmán et al 2014 with an average of 1433 mm a year more than 90 of the precipitation events that occurred during the study at laurentina olival and poncena were lower than 5 mm and shorter than 10 min the air temperature difference between day and night was 5 9 c 2 2 crop characteristics and agronomic practices hass avocado trees were grafted on native rootstocks maintained in a nursery for six months and planted by farmers between 2015 and 2017 using a rectangular pattern paull and duarte 2012 at densities of 408 3 5 7 0 m 204 7 0 7 0 m and 238 trees ha 1 7 0 6 0 m for laurentina olival and poncena respectively avocadoes in these farms are harvested twice a year in april may and september october usually one of these periods corresponds to on and the other to off alternate bearing ramírez gil 2017 postharvest tree pruning is applied at laurentina and poncena farms to mitigate alternate bearing effects farmers triggered irrigation in low precipitation periods when trees manifested water deficit using microsprinkler olival and manual systems poncena at laurentina one hour fertigation was triggered twice a month throughout the year using a drip system plots at olival and laurentina farms have open drainage channels between crop rows to evacuate excess water in high precipitation periods and the poncena plot has only one central open drainage channel the rest of the agronomic practices were partially performed as described in bernal et al 2014 2 3 equipment description and installation one portable weather station and three smp monitoring stations per plot were used to monitor the soil water dynamics and the climate respectively each smp station was composed of one soil temperature sensor three watermark granular matrix sensors a central processing unit receiving the sensor signal and transforming it into physical readings and one solar powered gprs module to transmit data fig 1 before installation watermark sensors were calibrated in the laboratory of soil and water of universidad del valle using soil from the plots shock et al 1998 davis vantage pro 2 for poncena and olival and lynkbox meteo for laurentina weather stations were equipped with temperature solar radiation wind direction and magnitude relative humidity and precipitation sensors each plot was divided into three zones according to the hillslope position top middle and bottom ritsema et al 1996 and the spatial variability of soil texture fig 1b van pelt and wierenga 2001 a representative avocado tree was selected in each zone based on canopy characteristics forming a three tree line of 60 100 m in length fig 1b sensors were buried below the soil wetting volume of each tree near the drippers dabach et al 2015 yang et al 2019 in the maximum crop root water uptake zone coelho et al 2007 goodall 1986 at depths of 15 45 and 75 cm representative of 0 30 31 60 and 61 90 cm depth ranges respectively fig 1c due to negligence in the sensor installation the deepest smp sensor at poncena farm was installed at 60 cm the temperature probe was buried at 45 cm weather stations were installed inside plots at 3 m above the ground and operated and maintained according to the recommendations of asabe 2006 2 4 acquisition and preprocessing of data data from the smp monitoring station and lynkbox meteo were recorded for the first five months every 1 h and 15 min respectively and then every 10 min and 5 min respectively and transmitted through grps to an internet server lynks ingeniería climate data from davis stations were recorded every 5 min in a datalogger and manually imported using weatherlink 6 0 5 software davis instruments 2020 all these readings were recorded for one year starting on 15 august 2020 a set of r functions was coded to process these data for smp data the coded r functions performed the following steps 1 reading microsoft excel files downloaded from the lynks ingeniería server 2 changing default column names 3 formatting the column date to posixct format and rounding it to the nearest hour 4 removing outliers 200 kpa smp 5 matching the smp values of the three trees by plotting at the same depth using column date and 5 exporting the resulting database to csv for weather station data the coded r functions performed the following steps 1 reading txt for davis station files or microsoft excel files for lynkbox meteo file 2 repeating step 3 described for the smp data 3 according to the climate variable computing the minimum maximum sum or mean by the hour and 4 repeating step 5 described for the smp data 2 5 soil water dynamics modeling sswc was retrieved by modeling the one dimensional vertical z axis water movement in unsaturated soils as described by the partial differential equation of richards eq 1 this mathematical transient model establishes that the spatiotemporal changes in the moisture content θ of unsaturated soils are governed by gravitational and matric forces that is how fast water moves into the soil given by the unsaturated hydraulic conductivity function k h and the soil matric potential h which is conditioned by cohesion and adhesion forces in the soil hillel 2014 1 θ t z k h h z s the sink term s in eq 1 refers to the amount of water removed by roots defined by the feddes model feddes et al 1988 pressure head values of 10 300 and 500 cm below which roots start to extract water extract water at the maximum possible rate and can no longer extract water at the maximum rate respectively were set in the feddes model according to hydrus 1d recommendations the soil water retention curve used to relate θ h and k h is given by the van genuchten model eqs 2 and 3 with the pore distribution of mualem mualem 1976 van genuchten 1980 where α m 1 1 n n 1 and n are fitting parameters k s is the saturated hydraulic conductivity l is the pore connectivity parameter and s e θ θ r θ s θ r 2 θ h θ r θ s θ r 1 α h n m h 0 θ s h 0 3 k h k s s e l 1 1 s e 1 m m h 0 k s h 0 the initial soil retention curve parameters α n θ s θ r and k s were obtained through the artificial neural network prediction module provided by rosetta lite 1 1 using farm soil properties as the training set table 1 the rmse by depth and the determination coefficient r 2 by farm were computed to compare the measured θ s θ fc and θ pwp at 0 33 and 1500 kpa respectively vs the optimized van genuchten model the effective precipitation was computed according to the interception model proposed by von hoyningen hüne 1983 and braden 1985 interception model parameters a interception constant b soil cover fraction and leaf area index lai were set to 0 25 mm d 1 0 40 and 3 5 cantuarias avilés 1995 respectively as constants because the tree canopy structure in the three farms did not change significantly during the study period the numerical approximation using finite differences of the richards equation solution was obtained by hydrus 1d version 4 17 software šimůnek et al 2008 boundary conditions were set assuming that the evapotranspiration separated into evaporation and transpiration and precipitation at the study sites interact with the soil surface no ponding in any case and water excesses are deeply drained below the end profile the soil profile was split into three layers materials at depths coinciding with the installed smp sensor depth and discretized using a gradient descent node density at depth from 10 nodes cm 1 at the soil surface to 1 node cm 1 at the bottom of the profile the avocado roots were linearly distributed assuming 70 is found in the top 60 cm of depth lahav and whiley 2002 hydrus 1d was executed for an hourly time step initializing with a homogeneous soil water content by layer 2 6 model calibration and validation calibration of the soil water dynamics model at the farms was performed in r software using the multiobjective optimization genetic algorithm ga called nondominated sorting genetic algorithm nsga ii simunek et al 2012 the multiobjective function to minimize was the rmse by depth eq 4 computed from observed h obs vs hydrus 1d simulated soil matric potential data h sim of a representative instrumented tree in a simulation time of approximately 720 h taken from 15 august 2020 14 february 2021 the nsga ii algorithm slightly perturbed over 50 generations a population size of 200 mutation of 10 and crossover probability of 70 the soil retention curve parameters the type of drainage free it is a drainage flux beyond the maximum modeled soil depth and deep it is a drainage flux with a groundwater reference level of 2 m the rainfall interception and radiation extinction coefficient multiplying each of these parameters by a factor between 0 9 and 1 1 4 rmse 1 n i 1 n h obs i h sim i 2 validation was carried out using the optimized parameters described above to simulate the hourly soil matric potential in hydrus 1d for approximately 1000 h maximum processing records allowed by hydrus 1d taken from 15 february 2020 15 august 2021 and comparing these values with the soil matric potential observed in the field model performance was evaluated using the rmse eq 4 and the determination coefficient r 2 2 7 soil water balance model description and its comparison with the surface soil water content the water balance in the hass avocado root zone depth z 0 60 cm was estimated through the model described in allen et al 1998 eq 5 where swb i 1 represents the change in the soil water storage in the i 1 th computation time i i is the water of irrigation which was triggered when smp decreases by 50 kpa based on recommendation of bower 1979 ep i is effective precipitation computed using the same model as that used for hydrus 1d simulation et ci is the crop evapotranspiration k c 0 75 r i is the runoff and d i is the deep percolation all occurring in i th time and water depth units 5 swb i 1 i i ep i et ci r i d i the following assumptions were introduced to set the swb when the water balance exceeded the irrigation need swb i 1 was equal to the water depth at field capacity the minimum amount of water that reached swb i 1 was given by the permanent wilting point value and drainage and runoff were neglected the magnitude of i i was computed through the readily available water model raw eq 6 waller and yitayew 2016 where θ fc and θ pwp are the soil water content at field capacity and permanent wilting point respectively z i is the root zone depth of layer i n is the number of layers and f is a depletion factor which depends on the irrigation system for laurentina f 0 9 and for poncena and olival f 0 5 6 raw f i 1 n θ fc θ pwp z i according to the soil depth ranges used in most rs studies sswc was defined through the available soil water aw at 0 5 5 10 and 10 15 cm aw at 15 30 and 30 60 cm was also evaluated jointly with soil water content depths equal to 0 60 cm which is the hass avocado root depth used to compute the swb for each depth range aw i 1 was computed by adding the product of the simulated volumetric soil water content θ in the validation time i with each r th simulation node depth as described in section 2 5 where n is the total number of nodes in the evaluated depth range eq 7 7 aw i 1 r 1 n z r 1 z r θ r i to evaluate whether sswc can be used as an indicator for hass avocado irrigation scheduling the influence of the surface 0 5 5 10 and 10 15 cm and deeper 15 30 and 30 60 cm aw i 1 on the change in the soil water storage swb i 1 eq 5 at 0 60 cm was estimated through a relevance metric analysis satizábal and pérez uribe 2007 which produces a dimensionless relevance index from the trained artificial neural network ann weights anns were trained 500 times by farm using a multilayer perceptron with a fixed architecture of 5 30 and 1 neuron in the input hidden and output layers respectively and taking as input variables the aw at the five depth ranges and the output variable as the swb at 0 60 cm percentage of training up to 65 of the dataset learning algorithm backpropagation and activation function tangent hyperbolicus on the computed relevance index by depth range a wilcoxon signed rank test p 0 05 was performed to determine which depth ranges conformed to an independent group labeled as 1 or not labeled as 0 when they were compared the available water simulated by hydrus 1d in the validation period at most influencing depth range by farm which was computed through the previous analysis was used as the input variable of an ann with an architecture of six layers 1 1 2 5 3 10 4 5 5 2 6 1 layer neurons in the layer to predict the swb the ann was trained 500 times with up to 65 of the percentage of the dataset all data analysis and graphical representation were performed using r software nsga2r ga nsga ii neuralnet ann training and ggplot2 graphs libraries 3 results 3 1 acquisition and preprocessing of data a range from 33 210 to 43 831 smp raw records per tree and by soil depth and 60 238 89 950 raw climate records by farm were obtained in the study period after removing outliers reducing to an hourly scale and matching valid smp and climate data the resulting database was reduced from the initial raw records to 8723 records fig 2 climate data for 0 20 and 36 days were missing for laurentina olival and poncena farms respectively smp varied in the three farms from 0 to 193 kpa with an average value recorded by the sensor at 15 cm of 22 6 kpa 19 6 kpa and 22 0 kpa for laurentina olival and poncena farms respectively the highest smp variability in the irrigation depth was found at poncena farm with a coefficient of variation cv of 81 0 while the lowest smp variability was recorded at laurentina farm with a cv of 38 7 fig 2 annual precipitation of 1372 1782 and 1275 mm distributed in 145 83 and 73 events 5 mm were recorded for laurentina olival and poncena farms respectively the daily evapotranspiration and precipitation varied from 0 4 to 4 2 mm and 0 73 mm respectively an increase in the annual precipitation compared with the historical record was reported by ideam 2021 because 10 out of 12 months of the study period were influenced by the enso phenomena phase la niña noaa 2021 to fulfill the crop water requirement 44 0 and 5 irrigation events were applied at laurentina olival and poncena farms respectively fig 2 3 2 calibration and validation of the hydrus 1d model a total of nine parameters were optimized using ga nsga ii including six retention curve parameters each one by three depths table 2 the type of drainage deep or free and the coefficients of rainfall interception and radiation extinction the type of drainage selected by nsga ii was free for all farms while the radiation extinction coefficients 0 25 0 05 and 0 29 for laurentina olival and poncena farms respectively were close to 0 39 the recommended value by hydrus 1d software for agricultural crops the magnitude of the optimized rainfall interception coefficient 1 80 0 12 and 1 18 mm d 1 for laurentina olival and poncena farms respectively was directly correlated with the observed tree canopy volume and the age of trees at each farm good agreement was found between the θ s and θ r determined in the laboratory and the optimized by nsga ii algorithm after the initial prediction with rosetta software resulting in a rmse not higher than 0 07 cm3 cm 3 a determination coefficient r2 value by farm not lower than 0 66 table 2 and a global value including the three farms r 2 0 97 p 0 001 after a ga nsga ii processing time of 4 5 d approximately 12 h by soil profile each algorithm execution converged to 200 possible solutions the best solution for each execution was selected based on the lowest sum of the rmse by depth which was a product of comparing the observed vs simulated soil matric potential by using hydrus software the results showed that the soil water dynamics model based on the richards equation showed good agreement in both calibration and validation with the observed soil matric potential data fig 3 for calibration in the laurentina and poncena farms the high smp variation in the top 15 cm of soil depth led to a rmse above 6 kpa contrasting with the olival farm where the rmse was below 2 kpa table 3 the smp at 45 and 60 75 cm depths was less variable than that at 15 cm depth causing the rmse to be larger than 4 33 kpa poncena depth 60 cm in the case of laurentina and poncena farms smaller than that of the surface layer the process of optimizing the parameters in the calibration succeeded because the resulting soil water dynamics model followed the rise and fall of smp at the three farms fig 3 the determination coefficient r2 value was higher than 0 52 poncena depth 60 cm at all depths table 3 olival was the farm with the best agreement between the observed and simulated smps in contrast to poncena which had the lowest r2 value on the olival and poncena farms the r2 value in the surface layer was higher than or equal to that in the deepest layers at laurentina the r2 value in the surface layer was lower than that in the deepest layers table 3 the performance of the soil water model in the validation had contrasting results in comparison with the calibration fig 4 at laurentina the r2 value in the validation was similar to that in the calibration not being smaller than 0 74 and the rmse slightly increased at 15 cm of depth at olival the r2 value notably decreased to 0 61 at depths of 15 and 75 cm of depth at poncena the validation performed better than the calibration increasing the r2 value at all depths and decreasing the rmse at depths of 15 and 60 cm 3 3 soil water balance model vs the surface soil water content the water depth corresponding to the swb model at 0 60 cm and the simulated aw at the surface 0 5 5 10 and 10 15 cm and deeper 15 30 and 30 60 cm depth ranges were computed in the validation period fig 5 soil layers up to 15 cm contained an average one standard deviation of 7 91 2 52 7 02 1 93 and 33 81 1 11 of the total water while the deepest layers store the remaining 92 09 2 52 92 98 1 93 and 66 19 1 11 for laurentina olival and poncena farms respectively significant water changes at irrigation depth of 0 60 cm occurred in the soil surface layers at laurentina and olival with coefficients of variation of 39 14 and 30 93 respectively while in deeper layers at these farms the cv varied by 6 92 and 13 02 in poncena the variation at the surface and deeper layers was similar with a coefficient of variation of 13 31 and 12 63 respectively the average absolute difference between the total aw that is the sum of all depth ranges and the swb was 10 26 and 29 mm for laurentina olival and poncena farms respectively fig 5 in the validation period 25 0 and 2 irrigation events were applied at laurentina olival and poncena farms respectively fig 5 the average absolute difference between swb and aw when irrigations at laurentina were applied was 8 mm which represents 29 of the raw applied in this farm with a minimum value of 0 mm irrigations labeled as 6 and 7 in fig 5 and a maximum value of 17 mm irrigation labeled as 10 in fig 5 swb was higher than aw in 4 out of the 25 irrigations at laurentina irrigations labeled as 11 17 18 and 22 in fig 5 swb could not be computed for poncena when the two irrigations were applied because climate data were missed the 500 anns trained by farm converged indicating good agreement r2 value 99 confidence interval ci of 0 68 0 677 0 683 0 78 0 778 0 782 and 0 58 0 579 0 581 p 0 001 for all cases for laurentina olival and poncena farms respectively and low prediction error rmse 99 ci of 4 3 92 4 02 8 7 97 8 03 and 7 6 99 7 01 mm for laurentina olival and poncena respectively between the aw at the five depths inputs and the swb output the relevance metric analysis performed on the resulting training ann weights suggested that aw at 5 10 cm for three farms were the most influential depth ranges on swb with an average relevance index 99 ci of 2 31 2 14 2 48 2 87 2 71 3 03 independent group wilcoxon signed rank test p 0 05 and 1 78 1 45 2 11 fig 6 among the surface depth ranges 0 5 cm depth range had less influence on swb with a relevance index 99 ci of 1 34 1 27 1 41 independent group 1 39 1 31 1 47 and 0 97 0 82 1 12 independent group p 0 05 respectively expressed by percent the soil water content in the top 15 cm of soil influenced the swb by 57 89 69 86 and 67 74 for laurentina olival and poncena respectively fig 6 the three farms available water at 5 10 cm depth range was used to predict the soil water balance at 0 60 depth 99 6 29 2 and 11 6 of anns converged in the training using 65 40 and 45 of the dataset respectively for laurentina olival and poncena comparing predicted swb with observed swb shows that although a good agreement was not found in olival and poncena farms r2 value 99 ci 0 37 0 362 0 376 and 0 56 0 556 0 568 respectively the error prediction was low rmse 99 ci 13 76 13 69 13 83 and 6 8 6 75 6 85 mm respectively fig 7 a good agreement r2 value 0 67 0 672 0 672 and low error prediction rmse 4 62 4 62 4 62 were found for laurentina the agreement and prediction error found for the three farms suggest that the aw at 5 10 cm depth can be an indicator of the soil water balance at 0 60 cm depth fig 7 when the irrigation events were applied at laurentina the trained ann model predicted the swb with an error varying between 11 irrigation event labeled as 21 in fig 7 and 10 mm irrigation event labeled as 7 in fig 7 and with an average absolute error of 4 mm which represents a 14 of the raw expressing the ann model error in terms of the difference in time to triggering a hypothetical irrigation event that is how much time the triggering was anticipated or delayed based on the soil water balance of the previous 12 h in the 52 of the irrigation events the triggering was anticipated on average 21 h while in 48 of the irrigation events the triggering was delayed on average 17 h 4 discussion 4 1 acquisition and preprocessing of data a proper amount and quality of data to validate the water dynamics model in the soils cropped with hass avocado was obtained through the installed sensors and soil samples collected in the field among the challenges that were overcome during the acquisition of sensor data there was a frequent loss of internet signal in the study zones which forced each time to restart the system in the field irrigation system failures and mobility restrictions in the study period due to the covid 19 pandemic that affected field visits this last challenge led to missing climate data at poncena and olival farms where the data download process was manual the preprocessing data step was critical for cleaning data and identifying the most representative calibration period for each farm the hourly time step used in this study to model the soil water dynamics differed from the daily basis used for most hydrus studies under tropical conditions similar to those occurring in this study where fallen precipitation is highly heterogeneous and variable richter 2016 a short time step permitted detailed modeling of the effect of precipitation on many hydrological variables such as the soil matric potential dunkerley 2021 however the rmse of the model calibration could increase because the precipitation interception model available in hydrus 1d software was calibrated to daily precipitation irrigation at laurentina and precipitation at olival and poncena played a paramount role in the smp variation while irrigations of 28 mm at laurentina slightly negatively depleted the smp precipitation of a similar magnitude at olival and poncena considerably reduced the smp figs 3 and 4 this was due to the punctual water application in each irrigation event moistening a reduced soil volume while precipitation moistened the soil homogeneously the high smp variability observed in the three farms study periods was associated with the terrain slope soil variability and the high heterogeneity of precipitation 4 2 calibration and validation of the hydrus 1d model calibration of the soil water dynamics model using hydrus 1d was successfully performed the agreement r2 and the visual adjustment between the observed and simulated water dynamics found for the three farms are similar to those reported by li et al 2019 for apple orchards and tu et al 2021 for citrus orchards the rmse obtained in this study could not be compared with that of other studies because they reported the rmse in soil water content units during the study period smp at the three farms was more variable in the top 15 cm of depth than 45 and 75 cm fig 3 agreeing with that reported by er raki et al 2021 in an irrigated wheat crop although it may be obvious that the superficial soil layers exhibit greater variability than the deepest layers because this layer is exposed more to atmospheric changes at the soil surface the groundwater contribution may generate the highest variability in the deepest layers according to a report by hou et al 2017 the genetic algorithm nsga ii optimizing the hydrus 1d parameters represents a suitable option due to its flexibility in the parameter selection the upper and lower bound selection to search the optimal parameter values and the option to optimize multiple target outputs the high ga nsga ii processing time by soil profile approximately 36 h was due to the high number of parameters to optimize although the common approach reported in hydrus 1d studies is to optimize through conventional techniques few parameters in the entire profile in this study nine parameters were optimized demonstrating that a single parameter by depth can be optimized 4 3 soil water balance model vs the surface soil water content water in the soils cropped with hass avocado at the three farms varied considerably in the top 15 cm of the soil depth during the validation period conversely water slowly accumulated and redistributed in the 15 60 cm depth range fig 5 irrigation application at laurentina and poncena farms and rainfall in olival farm kept the soil matric potential below 50 kpa it maintained sufficient water in the root zone for the crop to carry out its physiological processes moreover a rational scheduling of surface irrigation also reduces fertilizer leaching kiggundu et al 2012 these surface deeper soil water dynamics differences that occurred at the three hass avocado farms were also reported in other studies roets et al 2013 silber et al 2019 among the factors explaining the strong influence of the available water at the top 15 cm on the soil water balance at 0 60 cm fig 6 are the light textures in the upper layers at the three farms table 1 the high slope of the terrain where the three orchards were established exposure of the first soil layers to the solar radiation and air temperature changes and high root density of the avocado tree in the first 20 cm of depth in sandy soils salazar garcia and cortés flores 1986 studies relating water in the top centimeters of soils cropped with hass avocado to nutrient use efficiency beyer et al 2021 nutritional status tzatzani et al 2020 salinity acosta rangel et al 2019 and gene expression and flowering acosta rangel et al 2021 demonstrate the importance of soil water dynamics in this depth range the proposed model that represents the soil water balance at the irrigation depth through a fraction of the available water in this case the aw at 5 10 cm fig 7 implies rethinking the traditional irrigation scheduling for hass avocado at 60 cm which could simplify the soil water or soil matric potential measurements and improve the efficiency of irrigation application according to that found by mbabazi et al 2017 surface irrigations lead to implement periodically leaching to avoid soil salinization conversely the soil s heterogeneous composition and complex structure in its first 5 cm due to the high amount of mulch macro organisms grass coverage fertilizer application and other agronomic tasks in this zone alter its water dynamics therefore the available water in the 0 5 cm depth range is not a confident measure for scheduling or applying the irrigation for hass avocado crop the model relating aw at 5 10 cm to swb proposed in this study fig 7 opens the door to future studies using band c sar images to schedule hass avocado crop irrigation our results contribute to improve the sswc modeling needed to compute irrigation parameters using sar images dari et al 2021 le page et al 2020 because represent the first step to identify the most sensitive depth to compute sswc a practical irrigation scheduling in field for hass avocado crops using sar images results from computing the amount of irrigation water to be applied for the crop from the difference between the soil moisture at field capacity and sswc eisenhauer et al 2021 this irrigation scheduling can be accessed when sar satellites visit the study area the main limitations of the proposed model are the complexity of training the artificial neural networks and the necessity of determining the most influential depth range for each crop system the major novelty of this study is represented by the detailed analysis of the soil water dynamics at the irrigation depth fractioning the first 60 cm of the soil profile cropped with hass avocado 5 conclusions the soil water dynamics analysis at the soil surface of the hass avocado crop and its correlation with the soil water balance at 0 60 cm depth range through an artificial neural network model presented in this study permit us to conclude that the soil water content at 5 10 cm of depth range can be used as an indicator to schedule the crop irrigation moreover the available water in the top 15 cm of the irrigation depth in the hass avocado crop significantly influenced the total water required by the crop most remote sensing studies that correlate the backscattering coefficient and incidence angle from synthetic aperture radar sar images with the surface soil water content 0 5 cm depth range to estimate irrigation parameters should study the soil water dynamics at all irrigation depth to determine the depth range that best represents the total irrigation requirement of the crop declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgement we thank prof eduar aguirre universidad del valle for her guidance in the implementation of the genetic algorithm nsga ii and the support of fernando rendón miguel angel r and cené albán farmers from the laurentina olival and poncena farms respectively special thanks to rodrigo jiménez and kellym lópez young researchers of universidad del valle for their assistance received during field activities funding this research was granted by the research group regar engineering faculty universidad del valle smp monitoring and weather station loans and supported by the laboratory of soil and water of universidad del valle soil matric potential sensor calibration and soil physics determinations and the laboratory of soils of providencia s a soil water retention curve determination 
