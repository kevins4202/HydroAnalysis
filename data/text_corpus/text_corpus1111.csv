index,text
5555,recently a number of studies estimated evapotranspiration et via variational assimilation of land surface temperature lst data from moderate resolution imaging spectroradiometer modis their unknown parameters are neutral bulk heat transfer coefficient chn that scales the sum of sensible and latent heat fluxes and evaporative fraction ef that represents the partitioning of available energy between sensible and latent heat fluxes the variational data assimilation vda approaches estimate chn and ef by minimizing the difference between the modis lst observations and model estimates the applicability of these studies is limited only to clear sky conditions where modis lst data are available even when the sky is clear they cannot robustly update the initial guess of ef i e the a priori ef value because of the low temporal resolution of modis lst data this study overcomes these shortcomings by 1 using the random forest rf method to obtain a reasonable the a priori ef value and 2 assimilating the all weather lst data which are obtained by merging thermal infrared and passive microwave observations into the vda approach the vda approach is applied to the source regions of rivers srr in southwest china with heavy cloud covers results show that the rf method obtains a reasonably accurate the a priori ef value compared to assimilating the modis lst product assimilation of all weather lst data lead to an improvement in the et estimates especially in regions with dense clouds comparison of et estimates with the measurements at four sites i e dangxiong linzhi naqu and qomolangma in the srr shows that the vda approach can accurately estimate et in cloudy conditions finally the three cornered hat tch method is employed to assess the relative uncertainty of et estimates over the srr keywords variational data assimilation evapotranspiration all weather land surface temperature random forest method relative uncertainty 1 introduction evapotranspiration et is a major component of the global water cycle and governs the magnitude of water and energy fluxes from the land surface to the atmosphere williams et al 2016 zhang et al 2016a b fisher et al 2017 the accurate estimation of et is required for understanding the vegetation climate feedback and improving weather and climate model predictions shuttleworth 2007 maxwell and condon 2016 et can be measured by in situ flux tower networks e g fluxnet ameriflux euroflux fife bearex08 hiwater etc however these measurements are spatially sparse and available over limited time periods sellers et al 1988 baldocchi et al 2001 evett et al 2011 liu et al 2018 fortunately remote sensing rs technologies provide temporally and spatially continuous measurements of land surface variables e g land surface temperature lst soil moisture sm leaf area index lai vegetation type and density etc that control et tang et al 2010 yao et al 2013 zhu et al 2017 with the availability of these land surface variables from rs technologies various approaches have been developed to estimate et wang and dickinson 2012 yao et al 2015 fisher et al 2017 broadly speaking et retrieval approaches can be categorized into four main groups the first group known as the statistical and or empirical methods relates et to the relevant hydrologic variables such as enhanced vegetation index net radiation and or air temperature through empirical relationships carlson 2007 mu et al 2011 yao et al 2013 fang et al 2016 the second group known as the remote sensing based methods estimates et by incorporating remote sensing observations into the surface energy balance shuttleworth and wallace 1985 kustas 1990 su 2002 jia et al 2009 ma et al 2018 penman monteith mu et al 2007 mallick et al 2013 2014 zhang et al 2016a b song et al 2018 or priestley taylor equations fisher et al 2008 miralles et al 2011 the third group known as the land surface models merges soil moisture and temperature topography vegetation properties and meteorological forcing data with a land surface model e g common land model noah etc to estimate et dai et al 2001 2003 oleson et al 2010 niu et al 2011 xu et al 2011 yang et al 2011 the fourth group known as the data assimilation method merges sequences of remote sensing observations with physically models within variational bateni et al 2014 abdolghafoorian et al 2017 he et al 2018 tajfar et al 2019 2020 xu et al 2019a or ensemble based bateni and entekhabi 2012 xu et al 2011 2018a lu et al 2016 2017 2020 he et al 2019 data assimilation schemes to estimate et variational data assimilation vda methods estimates et by minimizing the difference between lst simulations and observations crow and kustas 2005 qin et al 2007 sini et al 2008 bateni and entekhabi 2012 bateni and liang 2012 bateni et al 2013a b 2014 xu et al 2014 2015 2016 2019a abdolghafoorian et al 2017 abdolghafoorian and farhadi 2019 he et al 2018 key unknown parameters of the vda approaches are neutral bulk heat transfer coefficient chn and evaporative fraction ef chn scales the sum of sensible h and latent le heat fluxes and ef represents the partitioning of available energy between h and le the vda approaches iteratively improve the initial guesses for chn and ef i e the a priori chn and ef values by minimizing the misfit between the predicted and satellite observed lst caparrini et al 2004a b crow and kustas 2005 bateni and liang 2012 xu et al 2019a xu et al 2014 estimated et by assimilating high temporal resolution i e hourly lst data from the geostationary operational environmental satellites goes goes can capture the diurnal cycle of lst and thus effectively updates the initial guesses of ef though they are far from their true values however goes have a low spatial resolution and cover mainly low and mid latitudes zhang et al 2014 xu et al 2019a advanced the capability of vda approaches to estimate et by using the a priori ef estimates from a regression based method and assimilating the low temporal resolution moderate resolution imaging spectroradiometer modis lst product to update them unfortunately the goes and modis thermal infrared tir lst products are not available when the sky is cloudy this makes the vda approaches incapable of updating chn and ef and retrieving et in cloud covered areas this work is built on xu et al 2019a study but it is augmented in three ways 1 the random forest rf approach is used to obtain the more accurate the a priori ef values the rf approach can generate independent regression trees or classification ensembles to predict variables of interests breiman 2001 it is superior to the traditional regression based approaches and produces more accurate results opitz and maclin 1999 boublenza et al 2015 2 the all weather lst data consist of thermal infrared and microwave lst observations are assimilated into the heat diffusion equation microwave lst observations are available in cloudy conditions which make the all weather lst product advantageous over the goes and modis lst data hence assimilation of all weather lst data allows the vda approaches to update chn and ef and retrieve et even in mostly cloudy regions such as southwest china united kingdom and france and finally 3 the relative uncertainty of et estimates is evaluated by the three cornered hat tch method the tch approach has been used recently to quantity uncertainties in the et estimates from remotely sensed observations and land surface models long et al 2014 2017 xu et al 2019b in this study the vda approach is tested in the source regions of rivers srr in southwest china under a variety of vegetative and hydrological conditions the et estimates from vda are compared with the measurements from the eddy covariance ec instruments at four sites in the srr also the vda et retrievals are compared with the modis mod16 and global land surface satellite glass et products this paper is organized as follows section 2 explains the methods and models including the heat diffusion equation surface energy balance seb equation rf approach and vda formulation section 3 describes the study area results and discussions are given in section 4 finally conclusions are reported in section 5 2 methods and models 2 1 heat diffusion equation the one dimensional heat diffusion equation in a soil column is given by 1 c t z t t k t 2 z t z 2 where t z t is the soil temperature at depth z and time t c and k are the soil heat capacity j m 3 k 1 and conductivity w m 1 k 1 respectively solution of the heat diffusion equation requires boundary conditions at the top and bottom of the soil column the boundary condition at the top of the soil column is obtained from the surface boundary forcing equation k dt z 0 t dz g z 0 t the boundary condition at the bottom of the soil column is dt z l t dz 0 where l is the depth of bottom boundary and is set to 0 5 m hu and islam 1995 bateni et al 2013a b the soil temperature is obtained by solving the heat diffusion equation forward in time from a starting time t t 0 the initial condition for the heat diffusion equation is given by 2 t z t 0 f 1 z where f 1 z is the soil temperature profile at the initial time t 0 f 1 z is built by fitting a curve to the soil temperatures at the depths of 0 0 05 0 1 and 0 4 m following bateni et al 2013a b soil temperature at the surface z 0 m is obtained from the surface boundary forcing equation soil temperatures at the depths of 0 05 0 1 and 0 4 m are obtained from china meteorological administration of land data assimilation system cldas product 2 2 surface energy balance seb the seb equation can be written as 3 r n h le g where h le and g are the sensible latent and ground heat fluxes w m 2 respectively rn is the net radiation w m 2 which is defined as 4 r n 1 α r s r l r l where α is the surface albedo and r s r l and r l represent the incoming shortwave incoming longwave and outgoing longwave radiations respectively w m 2 sensible heat flux can be represented by 5 h ρ c p c h u t t a where ρ is the air density kg m 3 cp is the air heat capacity 1012 j kg 1 k 1 and u and ta are the reference height wind speed m s 1 and air temperature k respectively ch can be written as the product of the neutral bulk heat transfer coefficient chn and the atmospheric stability correction function f ri caparrini et al 2003 6 c h c hn f ri where ri is the richardson number chn is the bulk heat transfer coefficient which is mainly a function of landscape characteristics caparrini et al 2004a b crow and kustas 2005 bateni and entekhabi 2012 bateni and liang 2012 bateni et al 2013a b xu et al 2014 2015 chn constitutes the first unknown parameter of vda approach the second unknown parameter of the vda approach is ef which is defined as 7 ef le h le ef is almost constant for daytime hours on days without precipitation caparrini et al 2004a b crow and kustas 2005 gentine et al 2007 tang and li 2017 in this study ef is assumed to be constant during the assimilation window 0900 1800 local time lt cloudy and or rainy days may undermine the assumption of constant ef resulting in errors in the vda et estimates et can be related to le via allen et al 1998 8 et 0 0353 le where et is the evapotranspiration mm day 2 3 random forest approach in this study the a priori ef values are obtained by the rf method proposed by breiman 2001 the rf approach generates independent regression trees or classification ensembles to predict variables of interests breiman 2001 it reduces overfitting because the generated trees are independent of each other breiman 2001 matin and chelgani 2016 in the training phase the rf algorithm creates multiple classification trees and the forest of classification trees is grown with a random subset of predictors without pruning the predictions are generated by aggregating the classification trees with the majority vote of all analogous trees in the forest more details about the rf approach can be found in breiman 2001 in this study the rf classification is conducted by the random forest package in program r liaw and wiener 2002 2 4 parameterizing the a priori ef value using the rf approach ef is affected by land cover type leaf area index lai antecedent precipitation index api and to a lesser extent solar radiation rs air temperature ta and relative humidity rh dirmeyer et al 2000 sini et al 2008 akuraju et al 2017 xu et al 2018b the api as an indicator of soil moisture and is defined as ziemer 1984 sini et al 2008 9 api t 1 i p t k t where pt is the precipitation occurring on the t th previous day and i is the number of antecedent days i is set to 30 according to xu et al 2018b k is the recession factor and is set to 0 97 keppeler and ziemer 1990 the input i e lai api rs ta and rh and output ef variables are normalized to vary within the range of 0 to 1 as follows feng et al 2016 10 x n x x m i n x m a x x m i n where xn is the normalized value of the variable x and xmax and xmin are the maximum and minimum values of x this normalization allows the random forest rf approach to train better for each land cover type the normalized lai api rs ta and rh as independents input variables and ef as the dependent output variable are used to train and test the rf model lai data are downloaded from the glass lai product api rs ta and rh and ef are obtained from a number of fluxnet http fluxnet fluxdata org and ameriflux https ameriflux lbl gov stations characteristics of these stations along with the period of utilized lai api rs ta rh and ef data from each station are shown in table 1 these stations are chosen to cover all the land cover types in the srr i e deciduous broadleaf forest dbf evergreen broadleaf forest ebf evergreen needleleaf forest enf deciduous needleleaf forest dnf mixed forest mf cropland cro grassland gra and barren sparse vegetation bsv in this study the global k fold testing approach is applied to assess performance of the rf method the whole dataset consists of 38 sites with 487 site years is divided into k parts herein k is set to 10 shiri et al 2014 2015 martí et al 2015 k 1 parts are used for training and the remaining part is utilized for testing the rf model although the k fold testing approach is computationally expensive it is widely used in rf because it yields accurate results martí et al 2015 shiri et al 2015 fig 1 shows the ef estimates from the rf approach i e k fold tests versus observations at the 38 sites as shown the rf approach can provide reasonably accurate ef estimates from lai api rs ta and rh measurements finally the lai api rs ta and rh measurements over the srr are used in the trained rf model to generate the a priori ef estimates for the vda approach 2 5 adjoint state formulation the unknown parameters of the vda approach are chn and ef which are estimated by minimizing the difference between the lst estimations and observations the cost function j can be written as 11 j t r e f λ i 1 n t 0 t 1 t obs i t t i t t k t 1 t obs i t t i t d t r r t k r 1 r r i 1 n e f i e f i t k ef 1 e f i e f i 2 i 1 n t 0 t 1 0 l λ i z t t i z t t k c 2 t i z t z 2 d z d t the first term on the right hand side of the cost function measures the difference between the estimated and observed lst values the second and third terms represent the misfit between the r and ef estimates and their prior values respectively to impose chn to be positive it is related to r via chn exp r the last term is the heat diffusion equation which is adjoined to the vda approach through the lagrange multiplier λ k t 1 k r 1 and k ef 1 are the inverse error covariance matrices of lst r and ef which determine the convergence rate of the vda system according to bateni et al 2013a the magnitudes of the diagonal elements in k t 1 k r 1 and k ef 1 are set to 0 01 k 2 1000 and 1000 respectively the optimal values of chn and ef are obtained by setting the first variation of j to zero i e δj 0 imposing δj 0 leads to a number of euler lagrangian equations these equations are solved iteratively every hour to estimate et 2 6 three cornered hat tch method the tch method is used to evaluate the uncertainty of vda et estimates over the study domain gray and allan 1974 tavella and premoli 1994 the tch approach considers cross correlation among et products and does not require the products to be independent premoli and tavella 1993 all the et products can be stored in the array et n m where n is the number of et products and m is the number of time samples any et product et i m where i varies from 1 to n can be written as 12 et i m e t t m ε i m i 1 2 n where ett m is the true value and εi m is the white noise for the i th et product since the true value of each product ett m is hard to obtain the differences between a reference et product etr m chosen arbitrarily from n et products in et n m and the remaining n 1 et products is computed as 13 y i m e t i m e t r m e t t m ε i m e t t m ε r m ε i m ε r m i 1 2 n 1 where y is the difference matrix with n 1 rows and m columns the covariance matrix s of y is defined as galindo and palacio 2003 14 s c o v y where cov is the covariance operator the unknown covariance matrix of the individual noise r is related to s via 15 s j r j t where the superscript t denotes the transpose and the matrices j and r are defined as 16 j n 1 n 1 0 0 1 0 1 0 1 0 0 0 1 1 and r r 11 r 12 r 1 n r 12 r 22 r 2 n r 1 n r 2 n r n n where rij cov ɛi ɛj there are n n 1 2 unknowns in equation 15 number of distinct elements of r but there are only n n 1 2 equations number of distinct elements of s thus there remain n free parameters that must be reasonably determined to obtain a unique solution galindo and palacio 2003 to determine the n free parameters the following objective function is minimized based on the kuhn tucker theorem galindo and palacio 1999 17 f r 1 n r nn 1 k 2 i j n r ij 2 where k det s n 1 where det is the matrix determinant when the free parameters have been estimated the solution for the other unknown elements of r is given by 18 r i j s i j r n n r i n r j n where sij is obtained from eq 14 the square root of the diagonal elements of r r 11 r 22 rnn represent the relative uncertainty of each et product 3 study domain and data the srr in southwest china 20 45 n and 80 113 e covers an area of approximately 1 34 106 km2 it has a complex topography and contrasting climatic conditions the srr has abundant precipitation 1200 1800 mm year and provides about 46 of total water resources in china fu et al 2004 the location of srr and its main land cover types are shown in fig 2 the land cover types in 2008 are obtained from the modis land cover type product mcd12q1 https lpdaac usgs gov products mcd12q1v006 the vegetation types of srr are forest grassland cropland and barren the ec flux towers at four sites namely dangxiong linzhi naqu and qomolangma in the srr provide et measurements every 30 min fig 2 these measurements are available on the chinaflux archive http www chinaflux org and are used to validate the vda et estimates during day of year doy 122 274 2008 characteristics of these sites are summarized in table 2 zhang et al 2019 generated the 15 year from 2003 to 2017 all weather lst product over china by merging tir lst from aqua modis and passive microwave pm lst from aqua advanced microwave scanning radiometer on earth observing system amsr e and gcom w1 advanced microwave scanning radiometer 2 amsr2 see table 3 this dataset has a spatial resolution of 1 km and an accuracy of 1 29 1 71 k in this study remotely sensed all weather and terra modis lst data are simultaneously assimilated into the heat diffusion equation it is worth noting that the all weather lst product does not include the terra modis lst data in another numerical experiment only the aqua and terra modis lst data are assimilated to evaluate the advantage offered by assimilating the all weather lst product table 3 https ladsweb modaps eosdis nasa gov the hourly micrometeorological variables i e air temperature relative humidity wind speed precipitation atmospheric pressure and incoming shortwave and longwave radiations as well as soil moisture for the upper 10 cm of soil and temperature at the depths of 5 cm 10 cm and 40 cm data with the spatial resolution of 6 km 6 km are downloaded from the china meteorological administration of land data assimilation system cldas archive http data cma cn data detail datacode nafp cldas2 0 rt html the global land surface satellite glass product provides 8 day lai and albedo with the spatial resolution of 1 km 1 km xiao et al 2014 2016 yao et al 2014 http glass product bnu edu cn the soil type and moisture are needed to estimate soil heat conductivity k and heat capacity c chen 2008 the soil type is obtained from the resource and environment data cloud platform http www resdc cn the vda et retrievals are compared with the modis mod16 and glass et products the 8 day mod16 et product with the spatial resolution of 1 km is available on the nasa distributed active archive center daac archive https ladsweb nascom nasa gov search the 8 day glass et product with the spatial resolution of 1 km is available on the glass website http glass product bnu edu cn 4 results and discussions 4 1 the a priori ef the daily micrometeorological variables including rainfall solar radiation air temperature and relative humidity are resampled from a spatial resolution of 6 km 6 km to 1 km 1 km using the bilinear interpolation method the daily rainfall data are used in eq 9 to estimate api the daily lai data are obtained from the 8 day glass lai product by interpolation finally the 1 km 1 km daily api lai solar radiation air temperature and relative humidity over the srr are used in the rf model to obtain the a priori ef values the statistical metrics of the a priori ef estimates from the rf model and xu et al 2019a are shown in table 4 for the dangxiong linzhi naqu and qomolangma sites as can be seen this study provides more accurate the a priori ef estimates compared to xu et al 2019a the four site average mean absolute percent error mape and root mean square error rmse of the a priori ef estimates from this study are 20 18 and 0 10 respectively which are 38 68 and 56 62 lower than those of xu et al 2019a the top row in fig 3 shows the mean of the a priori ef estimates during the growing season may september from xu et al 2019a and this study ef is defined as the ratio of le to available energy and thus the surface turbulence effects emerge in both its numerator and denominator hence the main determinant of ef variability is soil moisture sini et al 2008 the correlation coefficient r2 between the a priori ef estimates from xu et al 2019a and this study and soil moisture data from the cldas product is indicated in the bottom row of fig 3 the correlation coefficient values from this study are higher than those of xu et al 2019a implying that the rf method can improve the a priori ef estimates the correlation coefficients from this study are lower over the high precipitation fig 4 and or densely vegetated fig 7 areas in southeast than the sparsely vegetated and or low precipitation regions in west this is because in dry and or slightly vegetated areas et is water limited and is mainly controlled by the soil moisture therefore the coupling between ef and soil moisture is more robust in contrast in wet and or densely vegetated sites et is energy limited and is mainly affected by the atmospheric state variables i e air temperature and specific humidity hence the coupling between ef and soil moisture becomes weak resulting in a lower correlation coefficient 4 2 land surface temperature the all weather that includes aqua modis aqua amsr e and gcom w1 amsr2 and terra modis lst products are simultaneously assimilated into the vda approach to estimate et over the heavy cloud cover srr clouds reduce the spatial coverage of the aqua and terra modis lst products and thus weaken performance of the vda approach the missing rate of aqua and terra modis lst and precipitation maps over the srr are shown in fig 4 for doys 122 274 2008 as expected there is a positive correlation between the two maps the missing rate of aqua and terra modis lst is more in the south and southeast of srr with higher precipitation than the north and west with lower precipitation two numerical experiments are conducted to evaluate the importance of all weather lst data in estimating et in cloudy conditions in the first experiment both the all weather and terra modis lst data are simultaneously assimilated in the vda approach while in the second test only the aqua and terra modis lst products are assimilated the rmses of lst estimates from these two experiments are shown in fig 5 the rmses of estimated lst values by the synergistic assimilation of all weather and terra modis data are lower than those of assimilating aqua and terra modis lst data especially in areas with higher cloud covers as represented by the missing rate and precipitation in fig 4 for the second test i e assimilating aqua and terra modis lst data the spatial patterns in the rmses of lst estimates consistently resemble those of modis lst missing rate the rmses of lst estimates are larger over higher precipitation areas with more modis lst missing rate because the vda approach cannot update the a priori ef and chn values the vda approach finds the optimal values of chn and ef by minimizing the difference between the estimated and observed lsts the lower rmses of lst estimates from this study show that the synergistic assimilation of all weather and terra modis lst data improve the chn ef and et estimates particularly in cloudy conditions 4 3 neutral bulk heat transfer coefficient fig 6 shows the spatial patterns of chn estimates over the srr corresponding lai values over the srr are shown in fig 7 as indicated the variations of chn estimates are consistent with those of lai the chn estimates are generally higher in the densely vegetated areas i e forest in the southeast of srr but they are lower in the sparsely vegetated areas i e grassland and cropland in the northwest during may august chn retrievals increase with the growth of vegetation particularly in the south and southeast of the domain there is a reduction in lai from august to september especially in the east of srr similarly the chn estimates are decreased in september the spatio temporal consistency between the chn and lai maps shows that the assimilation of all weather data that includes passive microwave lst observations allow the vda approach to update chn even in cloudy areas 4 4 evaporative fraction the estimated ef values over the srr are shown in fig 8 for doys 122 133 184 190 and 222 the corresponding soil moisture maps 0 10 cm from cldas are indicated in fig 9 the spatio temporal variations of ef estimates are consistent with those of soil moisture for example the ef estimates and soil moisture values are highest on doy 190 and lowest on doy 122 in doys 122 133 and 222 there is a distinct gradient in soil moisture from northwest to southeast of srr i e soil moisture is higher in the southeast of srr and decreases towards northwest the same pattern is seen in the ef estimates fig 8 the higher ef estimates in the southeast of srr are due to the high precipitation and dense vegetation the ef estimates decrease towards the northwest of srr because of low precipitation and sparse vegetation 4 5 evapotranspiration time series of observed and estimated daily et values from vdaall weather terra modis at the dangxiong linzhi naqu and qomolangma sites are shown in fig 10 et increases in the growing season doys 122 201 and reach its maximum in mid july around doy 201 at the four sites thereafter et gradually reduces as the vegetation decays as indicated both the magnitude and day to day fluctuations in the et estimates are consistent with those of observations implying that the synergistic assimilation of all weather and terra modis lst data can estimate et in cloudy conditions for comparison the et estimates from vdaaqua terra modis assimilating aqua and terra modis lst data and ol which does not assimilate any lst data are also shown in fig 10 as indicated the et estimates by the synergistic assimilation of all weather and terra modis lst data are closer to the observations compared to those of assimilating aqua and terra modis lst data and ol these results show that the assimilation of all weather lst product that contain passive microwave lst data can significantly improve the et retrievals in cloudy skies the misfit between the model estimates and observations is mainly due to the parsimonious assumptions of constant daily ef and monthly chn and invariant soil thermal conductivity k and heat capacity c as well as observation errors table 5 shows the bias mape rmse and r2 of et estimates from the vdaall weather terra modis vdaaqua terra modis and ol approaches at the four sites the four site average bias mape and rmse of daily et estimates from ol are 1 17 mm 46 70 and 1 35 mm respectively corresponding values from vdaaqau terra modis are 0 93 mm 38 42 and 1 10 mm respectively by the synergistic assimilation of all weather and terra modis lst data the bias mape and rmse of daily et estimates reduce by 44 09 39 21 and 39 09 compared to vdaaqau terra modis and by 55 56 49 98 and 50 37 compared to ol the lower bias rmse and mape values from vdaall weather terra modis imply that exploiting information in the sequences of all weather lst data significantly improves the et estimates in cloudy skies table 6 indicates the four site average statistical indices of daily et estimates from the vdaall weather terra modis vdaaqau terra modis and ol approaches in clear and cloudy days in cloudy days no lst data are available from aqau terra modis and therefore the statistical metrics of daily et estimates from vdaaqau terra modis and ol are identical in contrast the bias and rmse of et estimates from the vdaaqau terra modis approach are lower than those of ol under clearly sky conditions implying that vda can extract the implicit information in the sequences of lst observations from aqua terra modis to optimize chn and ef and improve the et estimates in clear days not much additional information is available from microwave sensors and thus the statistical metrics of daily et estimates from vdaall weather terra modis and vdaaqau terra modis are similar the relative uncertainties of et estimates from vdaall weather terra modis vdaaqua terra modis and ol are shown in fig 11 these relative uncertainties are calculated by the tch approach the relative uncertainties of et estimates from vdaall weather terra modis and vdaaqua terra modis are lower than those of ol implying that vda approach is able to use information in the lst observations to reduce the uncertainty of et estimates the relative uncertainties of et retrievals from vdaall weather terra modis are also smaller than those of vdaaqua terra modis especially over areas with heavy clouds the lower uncertainties of et estimates from vdaall weather terra modis indicate the importance of all weather lst data in cloudy conditions the relative uncertainty of et estimates from vdaaqua terra modis and ol are close over high cloud areas this is because the model parameters e g ef and chn cannot get updated in regions with high clouds due to the unavailability of aqua and terra modis lst data the relative uncertainty of estimated et values from vdaall weather terra modis is larger over areas with higher lai and or precipitation this is because in dry and or slightly vegetated areas the coupling between ef and lst is robust and the drying rate is mainly controlled by the land surface processes while for the wet and or densely planted areas et is mostly influenced by atmospheric state variables i e air temperature and specific humidity rather than land surface processes shokri et al 2008a b fig 12 shows the relative uncertainties of daily et estimates from vdaall weather terra modis and vdaaqua terra modis versus precipitation over the srr the precipitation data are accumulated during the modeling period may september as anticipated the relative uncertainty of et retrievals from vdaall weather terra modis and vdaaqua terra modis slightly increases when precipitation rises from 400 mm to 1600 mm this is mainly due to the weaker coupling between lst and ef as land surface becomes wet xu et al 2018a as precipitation rises to more than 1600 mm the relative uncertainty of et estimates from vdaaqua terra modis shows a sharp growth because the modis lst data are unavailable over the heavy cloud covered areas and thus there is no update in the chn and ef estimates the relative uncertainty of et estimates from vdaall weather terra modis increases with a lower rate at high precipitation values implying that assimilating all weather lst data can provide more reliable et estimates in cloudy conditions fig 13 shows the monthly mean et estimates from vdaall weather terra modis first column soil moisture second column and lai third column over the srr during the modeling period may september in general et increases during the summer may july with the growth of soil moisture and lai and then reduces in the fall august september with the decrease of soil moisture and lai the et estimates in forest in the southeast of srr are higher than those of grassland and cropland in the north and northwest because of higher precipitation and denser vegetation cover the statistical boxplots of monthly mean et estimates for the main land cover types in the srr i e forest cropland grassland and barren land are shown in fig 14 the fractional area of forest cropland grassland and barren land over the srr are 6 23 1 07 83 25 and 9 45 respectively the lower and upper box edges are the 1st and 3rd quartiles in the sample distribution respectively the median position is marked within the box lines extending from the box ends indicate the 5th and 95th percentiles because of denser vegetation cover and higher rainfall in forest it has higher et values compared to cropland grassland and barren land during the modeling period i e may september et varies significantly in cropland and grassland due to large variations in vegetation dynamics while it remains almost constant in barren land because of sparse vegetation cover and low soil moisture in each month the variations of et over grassland as reflected in the interquartile range in the box plot are larger than those of forest cropland and barren land this is because soil moisture changes over the wide range of 0 3 to 0 7 in grassland which covers most 83 25 of the srr the modis mod16 and glass global et products provide 8 day et data mm 8 day 1 with the spatial resolution of 1 km 1 km mu et al 2007 yao et al 2014 daily et measurements and estimations at the four sites i e dangxiong linzhi naqu and qomolangma are summed to generate 8 day et values mm 8 day 1 fig 15 compares the 8 day et estimates from vdaall weather terra modis glass and mod16 with in situ et measurements during doy 122 274 2008 the results show that the vdaall weather terra modis 8 day et estimates are closer to the measurements the statistical indices of 8 day et retrievals from vdaall weather terra modis glass and mod16 are summarized in table 7 for the four sites the four site average mape rmse from vdaall weather terra modis is 15 37 3 49 mm which is 40 33 49 49 lower than the mape rmse of 25 76 6 91 mm from the glass et product and 48 58 57 70 lower than the mpae rmse of 29 89 8 25 mm from the mod16 et product fig 16 compares the relative uncertainty of vdaall weather terra modis et estimates with those of vdaaqau terra modis ol glass and mod16 et for the main land cover types in the srr for all the land covers the relative uncertainty of et estimates from this study vdaall weather terra modis is lower than those of vdaaqau terra modis ol glass and mod16 the average relative uncertainty of vdaall weather terra modis et estimates over the main land cover types is 26 60 which is lower than the mean relative uncertainty of 35 07 42 96 from the glass et mod16 et these results show that the et estimates from vdaall weather terra modis are more reliable that those of glass and mod16 fig 16 also shows that the relative uncertainty of et estimates from vdaall weather terra modis is highest and lowest over forest and barren land respectively this is due to the fact the coupling between ef and lst is strong over dry and or sparsely vegetated sites but it weakens over wet and or densely vegetated sites shokri et al 2008a b 5 conclusion in this study the all weather lst product obtained by merging lst data from aqua moderate resolution imaging spectroradiometer aqua modis aqua advanced microwave scanning radiometer on earth observing system aqua amsr e and gcom w1 advanced microwave sounding radiometer 2 global change observation mission gcom w1 amsr2 and terra modis lst data are assimilated into the bateni et al 2013a variational data assimilation vda approach to estimate evapotranspiration et in cloudy conditions the random forest rf method is utilized to obtain the a priori ef estimates these estimates are used in the vda approach as the initial guess the vda approach finds the optimal values of neutral bulk heat transfer coefficient chn and evaporative fraction ef by minimizing the misfit between the predicted and satellite observed lst the vda approach is tested over the source regions of rivers srr in southwest china with complicated topography and various climatic conditions the results show that the rf method improves the a priori ef estimates compared to the traditional regression based techniques and patterns in the a posterior ef estimates can capture those of soil moisture robustly the results show that the spatio temporal patterns of chn estimates agree well with those of leaf area index the lower rmses of lst estimates from this study imply that the assimilation of all weather lst data that includes passive microwave lst observations can improve the et estimates in cloudy conditions thus the all weather lst developed by zhang et al 2019 provides valuable inputs for et models for frequently cloud affected areas the daily et estimates from the vdaall weather terra modis approach that assimilates both all weather and terra modis lst data are validated with the eddy covariance ec et measurements at the dangxiong linzhi naqu and qomolangma sites in the srr the daily et estimates agree relatively well with measurements at the four experimental sites the four site average bias mean absolute percent error mape and root mean square error rmse of daily et estimates are 0 52 mm 24 04 and 0 85 mm respectively which are 55 56 30 46 and 46 54 lower than those of open loop ol these results indicate that the vda approach can take advantage of implicit information in the all weather and terra modis lst data to retrieve et estimates even in cloudy skies performance of the vdaall weather terra modis is compared to vdaaqua terra modis that assimilates only aqua and terra modis lst products the results show that vdaall weather terra modis provides more accurate et estimates especially over cloudy areas hence this study significantly advances the applicability of the vda approach in cloudy conditions the 8 day et estimates from vdaall weather terra modis are compared with those of glass and mod16 at the dangxiong linzhi naqu and qomolangma sites the result show that the et estimates from vdaall weather terra modis are more accurate than those of glass and mod16 finally the three cornered hat tch method is employed to quantify the relative uncertainty of et estimates from the vdaall weather terra modis mod16 and glass the results indicate that the et estimates from vdaall weather terra modis have a lower relative uncertainty implying that the vda approach provides more reliable et estimates credit authorship contribution statement xinlei he methodology data curation writing original draft writing review editing tongren xu supervision writing review editing funding acquisition sayed m bateni supervision writing review editing michael ek supervision shaomin liu supervision fei chen supervision declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments this work was funded by national natural science foundation of china 91647104 and 41671335 the united states department of agriculture natural resources conservation service usda nrcs grant 69 3a75 17 54 and the united states geological service usgs grant 2017hi440b awarded to the university of hawaii at manoa 
5555,recently a number of studies estimated evapotranspiration et via variational assimilation of land surface temperature lst data from moderate resolution imaging spectroradiometer modis their unknown parameters are neutral bulk heat transfer coefficient chn that scales the sum of sensible and latent heat fluxes and evaporative fraction ef that represents the partitioning of available energy between sensible and latent heat fluxes the variational data assimilation vda approaches estimate chn and ef by minimizing the difference between the modis lst observations and model estimates the applicability of these studies is limited only to clear sky conditions where modis lst data are available even when the sky is clear they cannot robustly update the initial guess of ef i e the a priori ef value because of the low temporal resolution of modis lst data this study overcomes these shortcomings by 1 using the random forest rf method to obtain a reasonable the a priori ef value and 2 assimilating the all weather lst data which are obtained by merging thermal infrared and passive microwave observations into the vda approach the vda approach is applied to the source regions of rivers srr in southwest china with heavy cloud covers results show that the rf method obtains a reasonably accurate the a priori ef value compared to assimilating the modis lst product assimilation of all weather lst data lead to an improvement in the et estimates especially in regions with dense clouds comparison of et estimates with the measurements at four sites i e dangxiong linzhi naqu and qomolangma in the srr shows that the vda approach can accurately estimate et in cloudy conditions finally the three cornered hat tch method is employed to assess the relative uncertainty of et estimates over the srr keywords variational data assimilation evapotranspiration all weather land surface temperature random forest method relative uncertainty 1 introduction evapotranspiration et is a major component of the global water cycle and governs the magnitude of water and energy fluxes from the land surface to the atmosphere williams et al 2016 zhang et al 2016a b fisher et al 2017 the accurate estimation of et is required for understanding the vegetation climate feedback and improving weather and climate model predictions shuttleworth 2007 maxwell and condon 2016 et can be measured by in situ flux tower networks e g fluxnet ameriflux euroflux fife bearex08 hiwater etc however these measurements are spatially sparse and available over limited time periods sellers et al 1988 baldocchi et al 2001 evett et al 2011 liu et al 2018 fortunately remote sensing rs technologies provide temporally and spatially continuous measurements of land surface variables e g land surface temperature lst soil moisture sm leaf area index lai vegetation type and density etc that control et tang et al 2010 yao et al 2013 zhu et al 2017 with the availability of these land surface variables from rs technologies various approaches have been developed to estimate et wang and dickinson 2012 yao et al 2015 fisher et al 2017 broadly speaking et retrieval approaches can be categorized into four main groups the first group known as the statistical and or empirical methods relates et to the relevant hydrologic variables such as enhanced vegetation index net radiation and or air temperature through empirical relationships carlson 2007 mu et al 2011 yao et al 2013 fang et al 2016 the second group known as the remote sensing based methods estimates et by incorporating remote sensing observations into the surface energy balance shuttleworth and wallace 1985 kustas 1990 su 2002 jia et al 2009 ma et al 2018 penman monteith mu et al 2007 mallick et al 2013 2014 zhang et al 2016a b song et al 2018 or priestley taylor equations fisher et al 2008 miralles et al 2011 the third group known as the land surface models merges soil moisture and temperature topography vegetation properties and meteorological forcing data with a land surface model e g common land model noah etc to estimate et dai et al 2001 2003 oleson et al 2010 niu et al 2011 xu et al 2011 yang et al 2011 the fourth group known as the data assimilation method merges sequences of remote sensing observations with physically models within variational bateni et al 2014 abdolghafoorian et al 2017 he et al 2018 tajfar et al 2019 2020 xu et al 2019a or ensemble based bateni and entekhabi 2012 xu et al 2011 2018a lu et al 2016 2017 2020 he et al 2019 data assimilation schemes to estimate et variational data assimilation vda methods estimates et by minimizing the difference between lst simulations and observations crow and kustas 2005 qin et al 2007 sini et al 2008 bateni and entekhabi 2012 bateni and liang 2012 bateni et al 2013a b 2014 xu et al 2014 2015 2016 2019a abdolghafoorian et al 2017 abdolghafoorian and farhadi 2019 he et al 2018 key unknown parameters of the vda approaches are neutral bulk heat transfer coefficient chn and evaporative fraction ef chn scales the sum of sensible h and latent le heat fluxes and ef represents the partitioning of available energy between h and le the vda approaches iteratively improve the initial guesses for chn and ef i e the a priori chn and ef values by minimizing the misfit between the predicted and satellite observed lst caparrini et al 2004a b crow and kustas 2005 bateni and liang 2012 xu et al 2019a xu et al 2014 estimated et by assimilating high temporal resolution i e hourly lst data from the geostationary operational environmental satellites goes goes can capture the diurnal cycle of lst and thus effectively updates the initial guesses of ef though they are far from their true values however goes have a low spatial resolution and cover mainly low and mid latitudes zhang et al 2014 xu et al 2019a advanced the capability of vda approaches to estimate et by using the a priori ef estimates from a regression based method and assimilating the low temporal resolution moderate resolution imaging spectroradiometer modis lst product to update them unfortunately the goes and modis thermal infrared tir lst products are not available when the sky is cloudy this makes the vda approaches incapable of updating chn and ef and retrieving et in cloud covered areas this work is built on xu et al 2019a study but it is augmented in three ways 1 the random forest rf approach is used to obtain the more accurate the a priori ef values the rf approach can generate independent regression trees or classification ensembles to predict variables of interests breiman 2001 it is superior to the traditional regression based approaches and produces more accurate results opitz and maclin 1999 boublenza et al 2015 2 the all weather lst data consist of thermal infrared and microwave lst observations are assimilated into the heat diffusion equation microwave lst observations are available in cloudy conditions which make the all weather lst product advantageous over the goes and modis lst data hence assimilation of all weather lst data allows the vda approaches to update chn and ef and retrieve et even in mostly cloudy regions such as southwest china united kingdom and france and finally 3 the relative uncertainty of et estimates is evaluated by the three cornered hat tch method the tch approach has been used recently to quantity uncertainties in the et estimates from remotely sensed observations and land surface models long et al 2014 2017 xu et al 2019b in this study the vda approach is tested in the source regions of rivers srr in southwest china under a variety of vegetative and hydrological conditions the et estimates from vda are compared with the measurements from the eddy covariance ec instruments at four sites in the srr also the vda et retrievals are compared with the modis mod16 and global land surface satellite glass et products this paper is organized as follows section 2 explains the methods and models including the heat diffusion equation surface energy balance seb equation rf approach and vda formulation section 3 describes the study area results and discussions are given in section 4 finally conclusions are reported in section 5 2 methods and models 2 1 heat diffusion equation the one dimensional heat diffusion equation in a soil column is given by 1 c t z t t k t 2 z t z 2 where t z t is the soil temperature at depth z and time t c and k are the soil heat capacity j m 3 k 1 and conductivity w m 1 k 1 respectively solution of the heat diffusion equation requires boundary conditions at the top and bottom of the soil column the boundary condition at the top of the soil column is obtained from the surface boundary forcing equation k dt z 0 t dz g z 0 t the boundary condition at the bottom of the soil column is dt z l t dz 0 where l is the depth of bottom boundary and is set to 0 5 m hu and islam 1995 bateni et al 2013a b the soil temperature is obtained by solving the heat diffusion equation forward in time from a starting time t t 0 the initial condition for the heat diffusion equation is given by 2 t z t 0 f 1 z where f 1 z is the soil temperature profile at the initial time t 0 f 1 z is built by fitting a curve to the soil temperatures at the depths of 0 0 05 0 1 and 0 4 m following bateni et al 2013a b soil temperature at the surface z 0 m is obtained from the surface boundary forcing equation soil temperatures at the depths of 0 05 0 1 and 0 4 m are obtained from china meteorological administration of land data assimilation system cldas product 2 2 surface energy balance seb the seb equation can be written as 3 r n h le g where h le and g are the sensible latent and ground heat fluxes w m 2 respectively rn is the net radiation w m 2 which is defined as 4 r n 1 α r s r l r l where α is the surface albedo and r s r l and r l represent the incoming shortwave incoming longwave and outgoing longwave radiations respectively w m 2 sensible heat flux can be represented by 5 h ρ c p c h u t t a where ρ is the air density kg m 3 cp is the air heat capacity 1012 j kg 1 k 1 and u and ta are the reference height wind speed m s 1 and air temperature k respectively ch can be written as the product of the neutral bulk heat transfer coefficient chn and the atmospheric stability correction function f ri caparrini et al 2003 6 c h c hn f ri where ri is the richardson number chn is the bulk heat transfer coefficient which is mainly a function of landscape characteristics caparrini et al 2004a b crow and kustas 2005 bateni and entekhabi 2012 bateni and liang 2012 bateni et al 2013a b xu et al 2014 2015 chn constitutes the first unknown parameter of vda approach the second unknown parameter of the vda approach is ef which is defined as 7 ef le h le ef is almost constant for daytime hours on days without precipitation caparrini et al 2004a b crow and kustas 2005 gentine et al 2007 tang and li 2017 in this study ef is assumed to be constant during the assimilation window 0900 1800 local time lt cloudy and or rainy days may undermine the assumption of constant ef resulting in errors in the vda et estimates et can be related to le via allen et al 1998 8 et 0 0353 le where et is the evapotranspiration mm day 2 3 random forest approach in this study the a priori ef values are obtained by the rf method proposed by breiman 2001 the rf approach generates independent regression trees or classification ensembles to predict variables of interests breiman 2001 it reduces overfitting because the generated trees are independent of each other breiman 2001 matin and chelgani 2016 in the training phase the rf algorithm creates multiple classification trees and the forest of classification trees is grown with a random subset of predictors without pruning the predictions are generated by aggregating the classification trees with the majority vote of all analogous trees in the forest more details about the rf approach can be found in breiman 2001 in this study the rf classification is conducted by the random forest package in program r liaw and wiener 2002 2 4 parameterizing the a priori ef value using the rf approach ef is affected by land cover type leaf area index lai antecedent precipitation index api and to a lesser extent solar radiation rs air temperature ta and relative humidity rh dirmeyer et al 2000 sini et al 2008 akuraju et al 2017 xu et al 2018b the api as an indicator of soil moisture and is defined as ziemer 1984 sini et al 2008 9 api t 1 i p t k t where pt is the precipitation occurring on the t th previous day and i is the number of antecedent days i is set to 30 according to xu et al 2018b k is the recession factor and is set to 0 97 keppeler and ziemer 1990 the input i e lai api rs ta and rh and output ef variables are normalized to vary within the range of 0 to 1 as follows feng et al 2016 10 x n x x m i n x m a x x m i n where xn is the normalized value of the variable x and xmax and xmin are the maximum and minimum values of x this normalization allows the random forest rf approach to train better for each land cover type the normalized lai api rs ta and rh as independents input variables and ef as the dependent output variable are used to train and test the rf model lai data are downloaded from the glass lai product api rs ta and rh and ef are obtained from a number of fluxnet http fluxnet fluxdata org and ameriflux https ameriflux lbl gov stations characteristics of these stations along with the period of utilized lai api rs ta rh and ef data from each station are shown in table 1 these stations are chosen to cover all the land cover types in the srr i e deciduous broadleaf forest dbf evergreen broadleaf forest ebf evergreen needleleaf forest enf deciduous needleleaf forest dnf mixed forest mf cropland cro grassland gra and barren sparse vegetation bsv in this study the global k fold testing approach is applied to assess performance of the rf method the whole dataset consists of 38 sites with 487 site years is divided into k parts herein k is set to 10 shiri et al 2014 2015 martí et al 2015 k 1 parts are used for training and the remaining part is utilized for testing the rf model although the k fold testing approach is computationally expensive it is widely used in rf because it yields accurate results martí et al 2015 shiri et al 2015 fig 1 shows the ef estimates from the rf approach i e k fold tests versus observations at the 38 sites as shown the rf approach can provide reasonably accurate ef estimates from lai api rs ta and rh measurements finally the lai api rs ta and rh measurements over the srr are used in the trained rf model to generate the a priori ef estimates for the vda approach 2 5 adjoint state formulation the unknown parameters of the vda approach are chn and ef which are estimated by minimizing the difference between the lst estimations and observations the cost function j can be written as 11 j t r e f λ i 1 n t 0 t 1 t obs i t t i t t k t 1 t obs i t t i t d t r r t k r 1 r r i 1 n e f i e f i t k ef 1 e f i e f i 2 i 1 n t 0 t 1 0 l λ i z t t i z t t k c 2 t i z t z 2 d z d t the first term on the right hand side of the cost function measures the difference between the estimated and observed lst values the second and third terms represent the misfit between the r and ef estimates and their prior values respectively to impose chn to be positive it is related to r via chn exp r the last term is the heat diffusion equation which is adjoined to the vda approach through the lagrange multiplier λ k t 1 k r 1 and k ef 1 are the inverse error covariance matrices of lst r and ef which determine the convergence rate of the vda system according to bateni et al 2013a the magnitudes of the diagonal elements in k t 1 k r 1 and k ef 1 are set to 0 01 k 2 1000 and 1000 respectively the optimal values of chn and ef are obtained by setting the first variation of j to zero i e δj 0 imposing δj 0 leads to a number of euler lagrangian equations these equations are solved iteratively every hour to estimate et 2 6 three cornered hat tch method the tch method is used to evaluate the uncertainty of vda et estimates over the study domain gray and allan 1974 tavella and premoli 1994 the tch approach considers cross correlation among et products and does not require the products to be independent premoli and tavella 1993 all the et products can be stored in the array et n m where n is the number of et products and m is the number of time samples any et product et i m where i varies from 1 to n can be written as 12 et i m e t t m ε i m i 1 2 n where ett m is the true value and εi m is the white noise for the i th et product since the true value of each product ett m is hard to obtain the differences between a reference et product etr m chosen arbitrarily from n et products in et n m and the remaining n 1 et products is computed as 13 y i m e t i m e t r m e t t m ε i m e t t m ε r m ε i m ε r m i 1 2 n 1 where y is the difference matrix with n 1 rows and m columns the covariance matrix s of y is defined as galindo and palacio 2003 14 s c o v y where cov is the covariance operator the unknown covariance matrix of the individual noise r is related to s via 15 s j r j t where the superscript t denotes the transpose and the matrices j and r are defined as 16 j n 1 n 1 0 0 1 0 1 0 1 0 0 0 1 1 and r r 11 r 12 r 1 n r 12 r 22 r 2 n r 1 n r 2 n r n n where rij cov ɛi ɛj there are n n 1 2 unknowns in equation 15 number of distinct elements of r but there are only n n 1 2 equations number of distinct elements of s thus there remain n free parameters that must be reasonably determined to obtain a unique solution galindo and palacio 2003 to determine the n free parameters the following objective function is minimized based on the kuhn tucker theorem galindo and palacio 1999 17 f r 1 n r nn 1 k 2 i j n r ij 2 where k det s n 1 where det is the matrix determinant when the free parameters have been estimated the solution for the other unknown elements of r is given by 18 r i j s i j r n n r i n r j n where sij is obtained from eq 14 the square root of the diagonal elements of r r 11 r 22 rnn represent the relative uncertainty of each et product 3 study domain and data the srr in southwest china 20 45 n and 80 113 e covers an area of approximately 1 34 106 km2 it has a complex topography and contrasting climatic conditions the srr has abundant precipitation 1200 1800 mm year and provides about 46 of total water resources in china fu et al 2004 the location of srr and its main land cover types are shown in fig 2 the land cover types in 2008 are obtained from the modis land cover type product mcd12q1 https lpdaac usgs gov products mcd12q1v006 the vegetation types of srr are forest grassland cropland and barren the ec flux towers at four sites namely dangxiong linzhi naqu and qomolangma in the srr provide et measurements every 30 min fig 2 these measurements are available on the chinaflux archive http www chinaflux org and are used to validate the vda et estimates during day of year doy 122 274 2008 characteristics of these sites are summarized in table 2 zhang et al 2019 generated the 15 year from 2003 to 2017 all weather lst product over china by merging tir lst from aqua modis and passive microwave pm lst from aqua advanced microwave scanning radiometer on earth observing system amsr e and gcom w1 advanced microwave scanning radiometer 2 amsr2 see table 3 this dataset has a spatial resolution of 1 km and an accuracy of 1 29 1 71 k in this study remotely sensed all weather and terra modis lst data are simultaneously assimilated into the heat diffusion equation it is worth noting that the all weather lst product does not include the terra modis lst data in another numerical experiment only the aqua and terra modis lst data are assimilated to evaluate the advantage offered by assimilating the all weather lst product table 3 https ladsweb modaps eosdis nasa gov the hourly micrometeorological variables i e air temperature relative humidity wind speed precipitation atmospheric pressure and incoming shortwave and longwave radiations as well as soil moisture for the upper 10 cm of soil and temperature at the depths of 5 cm 10 cm and 40 cm data with the spatial resolution of 6 km 6 km are downloaded from the china meteorological administration of land data assimilation system cldas archive http data cma cn data detail datacode nafp cldas2 0 rt html the global land surface satellite glass product provides 8 day lai and albedo with the spatial resolution of 1 km 1 km xiao et al 2014 2016 yao et al 2014 http glass product bnu edu cn the soil type and moisture are needed to estimate soil heat conductivity k and heat capacity c chen 2008 the soil type is obtained from the resource and environment data cloud platform http www resdc cn the vda et retrievals are compared with the modis mod16 and glass et products the 8 day mod16 et product with the spatial resolution of 1 km is available on the nasa distributed active archive center daac archive https ladsweb nascom nasa gov search the 8 day glass et product with the spatial resolution of 1 km is available on the glass website http glass product bnu edu cn 4 results and discussions 4 1 the a priori ef the daily micrometeorological variables including rainfall solar radiation air temperature and relative humidity are resampled from a spatial resolution of 6 km 6 km to 1 km 1 km using the bilinear interpolation method the daily rainfall data are used in eq 9 to estimate api the daily lai data are obtained from the 8 day glass lai product by interpolation finally the 1 km 1 km daily api lai solar radiation air temperature and relative humidity over the srr are used in the rf model to obtain the a priori ef values the statistical metrics of the a priori ef estimates from the rf model and xu et al 2019a are shown in table 4 for the dangxiong linzhi naqu and qomolangma sites as can be seen this study provides more accurate the a priori ef estimates compared to xu et al 2019a the four site average mean absolute percent error mape and root mean square error rmse of the a priori ef estimates from this study are 20 18 and 0 10 respectively which are 38 68 and 56 62 lower than those of xu et al 2019a the top row in fig 3 shows the mean of the a priori ef estimates during the growing season may september from xu et al 2019a and this study ef is defined as the ratio of le to available energy and thus the surface turbulence effects emerge in both its numerator and denominator hence the main determinant of ef variability is soil moisture sini et al 2008 the correlation coefficient r2 between the a priori ef estimates from xu et al 2019a and this study and soil moisture data from the cldas product is indicated in the bottom row of fig 3 the correlation coefficient values from this study are higher than those of xu et al 2019a implying that the rf method can improve the a priori ef estimates the correlation coefficients from this study are lower over the high precipitation fig 4 and or densely vegetated fig 7 areas in southeast than the sparsely vegetated and or low precipitation regions in west this is because in dry and or slightly vegetated areas et is water limited and is mainly controlled by the soil moisture therefore the coupling between ef and soil moisture is more robust in contrast in wet and or densely vegetated sites et is energy limited and is mainly affected by the atmospheric state variables i e air temperature and specific humidity hence the coupling between ef and soil moisture becomes weak resulting in a lower correlation coefficient 4 2 land surface temperature the all weather that includes aqua modis aqua amsr e and gcom w1 amsr2 and terra modis lst products are simultaneously assimilated into the vda approach to estimate et over the heavy cloud cover srr clouds reduce the spatial coverage of the aqua and terra modis lst products and thus weaken performance of the vda approach the missing rate of aqua and terra modis lst and precipitation maps over the srr are shown in fig 4 for doys 122 274 2008 as expected there is a positive correlation between the two maps the missing rate of aqua and terra modis lst is more in the south and southeast of srr with higher precipitation than the north and west with lower precipitation two numerical experiments are conducted to evaluate the importance of all weather lst data in estimating et in cloudy conditions in the first experiment both the all weather and terra modis lst data are simultaneously assimilated in the vda approach while in the second test only the aqua and terra modis lst products are assimilated the rmses of lst estimates from these two experiments are shown in fig 5 the rmses of estimated lst values by the synergistic assimilation of all weather and terra modis data are lower than those of assimilating aqua and terra modis lst data especially in areas with higher cloud covers as represented by the missing rate and precipitation in fig 4 for the second test i e assimilating aqua and terra modis lst data the spatial patterns in the rmses of lst estimates consistently resemble those of modis lst missing rate the rmses of lst estimates are larger over higher precipitation areas with more modis lst missing rate because the vda approach cannot update the a priori ef and chn values the vda approach finds the optimal values of chn and ef by minimizing the difference between the estimated and observed lsts the lower rmses of lst estimates from this study show that the synergistic assimilation of all weather and terra modis lst data improve the chn ef and et estimates particularly in cloudy conditions 4 3 neutral bulk heat transfer coefficient fig 6 shows the spatial patterns of chn estimates over the srr corresponding lai values over the srr are shown in fig 7 as indicated the variations of chn estimates are consistent with those of lai the chn estimates are generally higher in the densely vegetated areas i e forest in the southeast of srr but they are lower in the sparsely vegetated areas i e grassland and cropland in the northwest during may august chn retrievals increase with the growth of vegetation particularly in the south and southeast of the domain there is a reduction in lai from august to september especially in the east of srr similarly the chn estimates are decreased in september the spatio temporal consistency between the chn and lai maps shows that the assimilation of all weather data that includes passive microwave lst observations allow the vda approach to update chn even in cloudy areas 4 4 evaporative fraction the estimated ef values over the srr are shown in fig 8 for doys 122 133 184 190 and 222 the corresponding soil moisture maps 0 10 cm from cldas are indicated in fig 9 the spatio temporal variations of ef estimates are consistent with those of soil moisture for example the ef estimates and soil moisture values are highest on doy 190 and lowest on doy 122 in doys 122 133 and 222 there is a distinct gradient in soil moisture from northwest to southeast of srr i e soil moisture is higher in the southeast of srr and decreases towards northwest the same pattern is seen in the ef estimates fig 8 the higher ef estimates in the southeast of srr are due to the high precipitation and dense vegetation the ef estimates decrease towards the northwest of srr because of low precipitation and sparse vegetation 4 5 evapotranspiration time series of observed and estimated daily et values from vdaall weather terra modis at the dangxiong linzhi naqu and qomolangma sites are shown in fig 10 et increases in the growing season doys 122 201 and reach its maximum in mid july around doy 201 at the four sites thereafter et gradually reduces as the vegetation decays as indicated both the magnitude and day to day fluctuations in the et estimates are consistent with those of observations implying that the synergistic assimilation of all weather and terra modis lst data can estimate et in cloudy conditions for comparison the et estimates from vdaaqua terra modis assimilating aqua and terra modis lst data and ol which does not assimilate any lst data are also shown in fig 10 as indicated the et estimates by the synergistic assimilation of all weather and terra modis lst data are closer to the observations compared to those of assimilating aqua and terra modis lst data and ol these results show that the assimilation of all weather lst product that contain passive microwave lst data can significantly improve the et retrievals in cloudy skies the misfit between the model estimates and observations is mainly due to the parsimonious assumptions of constant daily ef and monthly chn and invariant soil thermal conductivity k and heat capacity c as well as observation errors table 5 shows the bias mape rmse and r2 of et estimates from the vdaall weather terra modis vdaaqua terra modis and ol approaches at the four sites the four site average bias mape and rmse of daily et estimates from ol are 1 17 mm 46 70 and 1 35 mm respectively corresponding values from vdaaqau terra modis are 0 93 mm 38 42 and 1 10 mm respectively by the synergistic assimilation of all weather and terra modis lst data the bias mape and rmse of daily et estimates reduce by 44 09 39 21 and 39 09 compared to vdaaqau terra modis and by 55 56 49 98 and 50 37 compared to ol the lower bias rmse and mape values from vdaall weather terra modis imply that exploiting information in the sequences of all weather lst data significantly improves the et estimates in cloudy skies table 6 indicates the four site average statistical indices of daily et estimates from the vdaall weather terra modis vdaaqau terra modis and ol approaches in clear and cloudy days in cloudy days no lst data are available from aqau terra modis and therefore the statistical metrics of daily et estimates from vdaaqau terra modis and ol are identical in contrast the bias and rmse of et estimates from the vdaaqau terra modis approach are lower than those of ol under clearly sky conditions implying that vda can extract the implicit information in the sequences of lst observations from aqua terra modis to optimize chn and ef and improve the et estimates in clear days not much additional information is available from microwave sensors and thus the statistical metrics of daily et estimates from vdaall weather terra modis and vdaaqau terra modis are similar the relative uncertainties of et estimates from vdaall weather terra modis vdaaqua terra modis and ol are shown in fig 11 these relative uncertainties are calculated by the tch approach the relative uncertainties of et estimates from vdaall weather terra modis and vdaaqua terra modis are lower than those of ol implying that vda approach is able to use information in the lst observations to reduce the uncertainty of et estimates the relative uncertainties of et retrievals from vdaall weather terra modis are also smaller than those of vdaaqua terra modis especially over areas with heavy clouds the lower uncertainties of et estimates from vdaall weather terra modis indicate the importance of all weather lst data in cloudy conditions the relative uncertainty of et estimates from vdaaqua terra modis and ol are close over high cloud areas this is because the model parameters e g ef and chn cannot get updated in regions with high clouds due to the unavailability of aqua and terra modis lst data the relative uncertainty of estimated et values from vdaall weather terra modis is larger over areas with higher lai and or precipitation this is because in dry and or slightly vegetated areas the coupling between ef and lst is robust and the drying rate is mainly controlled by the land surface processes while for the wet and or densely planted areas et is mostly influenced by atmospheric state variables i e air temperature and specific humidity rather than land surface processes shokri et al 2008a b fig 12 shows the relative uncertainties of daily et estimates from vdaall weather terra modis and vdaaqua terra modis versus precipitation over the srr the precipitation data are accumulated during the modeling period may september as anticipated the relative uncertainty of et retrievals from vdaall weather terra modis and vdaaqua terra modis slightly increases when precipitation rises from 400 mm to 1600 mm this is mainly due to the weaker coupling between lst and ef as land surface becomes wet xu et al 2018a as precipitation rises to more than 1600 mm the relative uncertainty of et estimates from vdaaqua terra modis shows a sharp growth because the modis lst data are unavailable over the heavy cloud covered areas and thus there is no update in the chn and ef estimates the relative uncertainty of et estimates from vdaall weather terra modis increases with a lower rate at high precipitation values implying that assimilating all weather lst data can provide more reliable et estimates in cloudy conditions fig 13 shows the monthly mean et estimates from vdaall weather terra modis first column soil moisture second column and lai third column over the srr during the modeling period may september in general et increases during the summer may july with the growth of soil moisture and lai and then reduces in the fall august september with the decrease of soil moisture and lai the et estimates in forest in the southeast of srr are higher than those of grassland and cropland in the north and northwest because of higher precipitation and denser vegetation cover the statistical boxplots of monthly mean et estimates for the main land cover types in the srr i e forest cropland grassland and barren land are shown in fig 14 the fractional area of forest cropland grassland and barren land over the srr are 6 23 1 07 83 25 and 9 45 respectively the lower and upper box edges are the 1st and 3rd quartiles in the sample distribution respectively the median position is marked within the box lines extending from the box ends indicate the 5th and 95th percentiles because of denser vegetation cover and higher rainfall in forest it has higher et values compared to cropland grassland and barren land during the modeling period i e may september et varies significantly in cropland and grassland due to large variations in vegetation dynamics while it remains almost constant in barren land because of sparse vegetation cover and low soil moisture in each month the variations of et over grassland as reflected in the interquartile range in the box plot are larger than those of forest cropland and barren land this is because soil moisture changes over the wide range of 0 3 to 0 7 in grassland which covers most 83 25 of the srr the modis mod16 and glass global et products provide 8 day et data mm 8 day 1 with the spatial resolution of 1 km 1 km mu et al 2007 yao et al 2014 daily et measurements and estimations at the four sites i e dangxiong linzhi naqu and qomolangma are summed to generate 8 day et values mm 8 day 1 fig 15 compares the 8 day et estimates from vdaall weather terra modis glass and mod16 with in situ et measurements during doy 122 274 2008 the results show that the vdaall weather terra modis 8 day et estimates are closer to the measurements the statistical indices of 8 day et retrievals from vdaall weather terra modis glass and mod16 are summarized in table 7 for the four sites the four site average mape rmse from vdaall weather terra modis is 15 37 3 49 mm which is 40 33 49 49 lower than the mape rmse of 25 76 6 91 mm from the glass et product and 48 58 57 70 lower than the mpae rmse of 29 89 8 25 mm from the mod16 et product fig 16 compares the relative uncertainty of vdaall weather terra modis et estimates with those of vdaaqau terra modis ol glass and mod16 et for the main land cover types in the srr for all the land covers the relative uncertainty of et estimates from this study vdaall weather terra modis is lower than those of vdaaqau terra modis ol glass and mod16 the average relative uncertainty of vdaall weather terra modis et estimates over the main land cover types is 26 60 which is lower than the mean relative uncertainty of 35 07 42 96 from the glass et mod16 et these results show that the et estimates from vdaall weather terra modis are more reliable that those of glass and mod16 fig 16 also shows that the relative uncertainty of et estimates from vdaall weather terra modis is highest and lowest over forest and barren land respectively this is due to the fact the coupling between ef and lst is strong over dry and or sparsely vegetated sites but it weakens over wet and or densely vegetated sites shokri et al 2008a b 5 conclusion in this study the all weather lst product obtained by merging lst data from aqua moderate resolution imaging spectroradiometer aqua modis aqua advanced microwave scanning radiometer on earth observing system aqua amsr e and gcom w1 advanced microwave sounding radiometer 2 global change observation mission gcom w1 amsr2 and terra modis lst data are assimilated into the bateni et al 2013a variational data assimilation vda approach to estimate evapotranspiration et in cloudy conditions the random forest rf method is utilized to obtain the a priori ef estimates these estimates are used in the vda approach as the initial guess the vda approach finds the optimal values of neutral bulk heat transfer coefficient chn and evaporative fraction ef by minimizing the misfit between the predicted and satellite observed lst the vda approach is tested over the source regions of rivers srr in southwest china with complicated topography and various climatic conditions the results show that the rf method improves the a priori ef estimates compared to the traditional regression based techniques and patterns in the a posterior ef estimates can capture those of soil moisture robustly the results show that the spatio temporal patterns of chn estimates agree well with those of leaf area index the lower rmses of lst estimates from this study imply that the assimilation of all weather lst data that includes passive microwave lst observations can improve the et estimates in cloudy conditions thus the all weather lst developed by zhang et al 2019 provides valuable inputs for et models for frequently cloud affected areas the daily et estimates from the vdaall weather terra modis approach that assimilates both all weather and terra modis lst data are validated with the eddy covariance ec et measurements at the dangxiong linzhi naqu and qomolangma sites in the srr the daily et estimates agree relatively well with measurements at the four experimental sites the four site average bias mean absolute percent error mape and root mean square error rmse of daily et estimates are 0 52 mm 24 04 and 0 85 mm respectively which are 55 56 30 46 and 46 54 lower than those of open loop ol these results indicate that the vda approach can take advantage of implicit information in the all weather and terra modis lst data to retrieve et estimates even in cloudy skies performance of the vdaall weather terra modis is compared to vdaaqua terra modis that assimilates only aqua and terra modis lst products the results show that vdaall weather terra modis provides more accurate et estimates especially over cloudy areas hence this study significantly advances the applicability of the vda approach in cloudy conditions the 8 day et estimates from vdaall weather terra modis are compared with those of glass and mod16 at the dangxiong linzhi naqu and qomolangma sites the result show that the et estimates from vdaall weather terra modis are more accurate than those of glass and mod16 finally the three cornered hat tch method is employed to quantify the relative uncertainty of et estimates from the vdaall weather terra modis mod16 and glass the results indicate that the et estimates from vdaall weather terra modis have a lower relative uncertainty implying that the vda approach provides more reliable et estimates credit authorship contribution statement xinlei he methodology data curation writing original draft writing review editing tongren xu supervision writing review editing funding acquisition sayed m bateni supervision writing review editing michael ek supervision shaomin liu supervision fei chen supervision declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments this work was funded by national natural science foundation of china 91647104 and 41671335 the united states department of agriculture natural resources conservation service usda nrcs grant 69 3a75 17 54 and the united states geological service usgs grant 2017hi440b awarded to the university of hawaii at manoa 
5556,accurate estimation of wetting front dimensions in surface and sub surface irrigation systems is very important for optimal management of water resources as well as increasing the performance of irrigation systems analytical and numerical models need lots of computational efforts and costs so their applications in practical issues might be difficult meanwhile artificial intelligence models could be suitable substitutes for these models the present study aimed at simulating wetting front wetting bulb dimensions in different soil types for surface and sub surface irrigation systems using continuous and pulse applications through the gene expressions programming gep and random forest rf techniques different experiments were carried out to achieve the required data a robust k fold testing data scanning technique was adopted for assessing the applied models where different criteria were considered for defining the k values per test procedure the results obtained revealed that with minor exceptions both the applied gep and rf models presented good ability in modeling the wetting front dimensions in all the conducted treatments the results also showed that soil type and emitter installation depth were the best criteria for defining the k values of k fold testing procedure for the surface and sub surface irrigation systems respectively keywords artificial intelligence irrigation systems k fold testing wetting bulb 1 introduction drip irrigation systems have been widely developed worldwide during the recent decades when designed good and operated suitably these systems help to achieve maximum crop yield drip irrigation systems reduce water applications and can be useful tools for increasing water use efficiency and productivity al ogaidi et al 2016 khanmohammadi and besharat 2018 however when poorly designed and or operated incorrectly the actual performance of drip systems can be much lower than their potential capability al ogaidi et al 2016 on the other hand suitable design and management of these systems requires understanding of the precise distribution of wetting pattern around the emitters kandelous et al 2011 during the past decades substantial studies have been performed to determine the wetting patterns of the point and line sources the diameter and depth of wetting pattern are the basic parameters of moisture front distribution liu and xu 2018 khattak et al 2017 the depth of the wetting front ought to be identified with expected root zone depth while its diameter is dependent to the spaces between the emitters and laterals the main parameters of the wetted zone are shown in fig 1 for surface and subsurface drip irrigation systems so far different methods have been developed for estimating the dimensions of the soil wetted pattern under drip irrigation systems the most common models are the empirical analytical and numerical models subbaiah 2013 empirical models schwartzman and zur 1986 singh et al 2006 amin and ekhmaj 2006 kandelous et al 2008 malek and peters 2011 al ogaidi et al 2016 have been developed using a regression analysis of field laboratory based data further analytical hammami and zayani 2016 cook et al 2003 and numerical šejna et al 2014 elmaloglou et al 2013 arbat et al 2013 models solve the governing flow equations e g richards equation under particular initial and boundary conditions analytical and numerical models require significant computing time and high skills to be applied so it is difficult to employ them for design purposes also empirical models despite their simplicity are site specific and cannot be generalized hence it is necessary to apply a suitable technique to estimate the wetting pattern dimensions with an acceptable accuracy and lower computational costs for wide range of influential factors e g emitter discharge emitter installation depth elapsed time saturated hydraulic conductivity soil bulk density initial moisture content and soil texture consequently soft computing techniques can be suitable alternatives to simulate wetting front dimensions these models can be categorized as empirical regression based models where the relations between independent and dependent variables are discovered and studied soft computing based techniques e g gene expression programming gep and random forest rf have been applied in different water resources engineering disciplines due to strong recognition pattern which can relate the inputs to the target parameter s maroufpoor et al 2019 applications of these approaches in different fields of water resources engineering have been reported in this context including e g modeling water distribution uniformity in sprinkler irrigation maroufpoor et al 2019 simulating water front advance of furrow irrigation golestani kermani et al 2019 modeling wind drift and evaporation losses from sprinkler irrigation maroufpoor et al 2018 al ghobari et al 2018 estimating crop water requirement landeras et al 2018 estimation of dew point temperature soil water capacity and bulk density shiri et al 2014 2017a b respectively and modeling friction factor in irrigation pipes najafzadeh et al 2018 meanwhile most of the investigations aimed to estimate the wetting pattern dimensions for surface drip irrigation systems with continuous singh et al 2006 karimi and mohammadi 2018 ekhmaj et al 2007 kandelous et al 2008 lazarovitch et al 2009 kandelous and simunek 2010a hinnell et al 2010 karimi et al 2015 and pulse karmeli and peri 1974 mostaghimi and mitchell 1983 elmaloglou and diamantopoulos 2009 mohammadbeigi et al 2017 application modes nonetheless most of the studies have used a single data assigning procedure 2 block data partitioning where a certain block of available patterns data are used for training the models and then the developed trained models are tested using an independent data set which might be misleading nevertheless application of gep and rf in such kinds of studies is rare in literature so there is a room to extend such kind of investigations for modeling wetting dimensions of surface subsurface irrigation systems with either continuous and pulse application modes the present study aimed at simulating horizontal and vertical wetting dimensions of the surface and subsurface drip irrigation systems with continuous and pulse application modes using the gep and rf techniques assessed by the robust k fold testing data scanning procedure 2 material and methods 2 1 laboratory experiments and used data the laboratory experiments were carried out at the central laboratory of the agricultural college of university of kurdistan iran a soil container with a length of 3 m width of 0 5 m and height of 1 m was used in the experiments one side of this container is plexiglass sheets to monitor the advance of wetting patterns at different times during the experiments three air dried soil samples were filled into the lysimeter according to bulk density of each soil table1 presents the physical properties of the studied soil samples fig 2 shows the studied soils texture graph for soil stability and uniform initial water distribution the soil container was left in the laboratory form 24 to 48 h moreover to prevent preferential flow along the walls lysimeter walls were treated with glue and sprayed with sand to create a coarse surface kandelous and simunek 2010b the reservoir volume was 200 l containing a float to keep a constant water level a pressure gauge and a ball valve were placed in discharge pipe of the pump for measuring the system pressure and maintaining the steady discharge all the experiments were performed at a fixed pressure i e 2 bars emitter clogging based suspended particle was prevented by the filtration system an off on valve placed between the lateral and sub main to control flow inside each container moreover to achieve high uniformity in subsurface irrigation system emitters were placed on soil surface in the middle of one of the lysimeter walls and water flow was delivered to certain depths through a thin tube with a diameter of 5 mm as advised by kandelous and simunek 2010b emitters were connected to a water reservoir by micro polyethylene tubes main sub main and lateral tubes with diameters of 32 20 and 16 mm respectively considering low discharge rate in each experiment a by pass assembly was installed to regulate inflow and return additional water to reservoir the wetting front and water distribution were evaluated in light medium and heavy textured homogeneous soils the length of the containers for all the soil textures was 1 m fig 3 shows the schematic description of experimental device this container represents half space of the complete cylinder i e half of the wetted zone so the actual emitter discharges were multiplied by 2 kandelous and simunek 2010a al ogaidi et al 2016 the saturated hydraulic conductivity was estimated using rosetta software schaap et al 2001 a total of 108 experiments 36 and 72 experiment for surface and subsurface drip irrigation systems respectively were conducted with three discharge rates of 2 4 and 6 l h the experiments were carried out for two continuous and pulse application modes in pulse application the pulse cycles were considered as 30 30 20 40 and 40 20 min the first shows the irrigation time on and the second denotes the rest time off of the system the irrigation time was set as 4 h and emitters were placed at three depths of 0 15 and 30 cm below the soil surface the locations of the wetting patterns were recorded by drawing them on the plexiglass walls at specified times at the end of each experiment graded tapes in lysimeter body were used for preparing the shape of wetting zone the coordinates of the horizontal and vertical wetting patterns were digitized using grapher software version 7 finally the values of wetted dimensions in horizontal and vertical directions were calculated 2 2 gene expression programming gep alike to genetic programming gp gep imitates the biological evolution for making a computer program that can simulate the target parameter the problems are encoded in fixed length linear chromosomes ferreira 2006 a strong aspect of gep is its capability in presenting the models mathematical expressions that have related the input target parameters which can be transferable to other patterns by using the gep method the first step is selecting the proper fitness function the root relative squared error rrse was used as the fitness function according to literature for the same kinds of studies maroufpoor et al 2019 the second step consists of defining the terminal input target pairs and functions sets terminal set includes the independent input variables see section 2 5 as well as the simulated targets wetting front dimensions in all treatments according to koza 1994 the first functions that should be used in simulation issues are the four basic mathematical operators here a set of mathematical functions consisted of the main functions trigonometric functions and other mathematical functions x2 exp as advised in such kinds of studies the third step with gep establishment is defining the architecture of gep chromosomes that were selected as length of head 8 and gene numbers per chromosome 3 according to ferreira 2001 the next step is defining the linking function with which the sub trees of gep are linked together among four possibilities for this function addition multiplication subtraction and division addition linking function was selected as this is the commonly used function in simulation issues as advised by ferreira 2006 the last phase of gep implementation is selecting the basic genetic operators mutation rate etc that were used as default values of genexpro program fig 4 shows a schematic gep representation where gep flowchart is completed each time to obtain the gep based model that relates the input variables to targets 2 3 random forest rf random forests rf a group learning algorithm handles high dimension regressive issues as a tree based group method all trees in rf are dependent of a series of random variables and the forest is grown from many regression trees put together and form a group breiman 2001 the final decision is a consequence of averaging the output following the fitting individual trees in ensemble bagging procedure the bias of the bagged trees is the same of the single trees whereas the variance is decreased by reducing the correlation between the trees hastie et al 2009 rfs for regression are formed by growing trees depending on a random vector θ so that tree predictor h x θ can take on numerical magnitudes the mean squared generalization error of each numerical estimator h x is breiman 2001 1 e x y y h x 2 rf estimator is formed through making an average over the j th tree in this case the following two basic theorems stand theorem1 by increasing the number of trees in the forest 2 e x y ya v j h x θ j 2 e x y y e θ h x θ 2 the right hand of the above equation illustrates the generalization error of the forest similarly the average generalization error of a tree is breiman 2001 3 pe tree e θ e x y y h x θ 2 theorem2 suppose that ey e x h x θ for all θ so 4 pe f o r e s t ρ p e t r e e in which ρ denotes the weighted correlation between the residuals y h x θ and y h x θ θ and θ are independent variables breiman 2001 fig 5 shows a general view of the rf method various numbers of rf trees were examined here to find the optimum tree number optimum tree numbers were different for each analyzed case and more detailed information in this regard will be given in the next sections further 10 cycles were found as the best cycle number for calculating the mean error the percentage decrease in training error was found as 5 iteratively minimum child node size to stop and the maximum number of levels were selected as 5 and 10 respectively based on trial and error process 2 4 commonly used empirical models in order to assess the performance of the developed soft computing approaches with respected to the traditional methods two commonly used models were applied and compared with gep and rf schwartzman and zur 1986 introduced an empirical model for simulating wetting front dimensions under surface drip irrigation systems their model stands on relating the emitter discharge q m3 s 1 saturated hydraulic conductivity ks m s 1 and total volume of applied water vw m3 to the diameter and depth of water front as follows 5 d h 1 82 v w 0 22 k s q 0 17 6 d v 2 54 v w 0 63 k s q 0 45 kandelous et al 2008 developed empirical equations for estimating wetting front dimension from the subsurface continuous irrigation systems as 7 d h 4 244 v w 0 526 k s q 0 026 8 d v 0 66 v w 0 333 k s q 0 167 9 z up 0 72 v w 0 344 k s q 0 156 to the best of the authors knowledge there is no recommended model for estimating wetting dimensions of pulse irrigation systems among the traditional methods 2 5 study protocol a major task with application of data driven approaches is selecting the appropriate input parameters that can easily simulate the target parameter s values there are different input selection methods from which analysis of the physical aspects of the studied phenomenon might be a good candidate for selecting the inputs here both the physical behavior of the studied phenomenon and the reports given by the published literature were considered for selecting the proper input variables hence the emitter discharges q soil texture factors silt sand and clay percentages soil bulk density ρb saturated hydraulic conductivity ks and the elapsed time t were considered as inputs for simulating the wetting front dimensions in all treatments e g al ogaidi et al 2016 an additional emitter depth d variable was also considered in subsurface irrigation systems while the ratio of irrigation cycle time to the total time of the irrigation process tirr tt was considered in pulse irrigation mode another major step with applying data driven models is partitioning the available patterns for training and testing the applied models a common procedure would be partitioning the available data into two blocks namely training and testing data set this division might be achieved randomly or by considering specific conditions of the studied phenomenon thus the established model using the training data will be tested by a single data set testing patterns although this is a straightforward procedure for developing and assessing the applied models the outcomes might be misleading because all the available patterns have not been participated in model development testing hence other robust scanning procedures should be adopted for assessing the models performances e g marti et al 2013 in the present research the powerful k fold testing data scanning tool was adopted for all the studied experiments so all available patterns of each experiment based on irrigation type application mode were divided into k blocks and the models were trained each time by using k 1 blocks and then tested using the patterns of the remaining one block the process was repeated until all available patterns of each experiment were incorporated in both the training and testing stages the values of k might be defined based on different criteria here different criteria were used to define the k values of k fold testing i e defining the test subset per experiment e g soil type based emitter depth based and tirr tt based partitioning of data table 2 provides general information on the available patterns of each irrigation type application mode based on the information presented in this table for the surface irrigation system with continuous application mode the patterns were divided based on soil type k 6 in the pulse mode two criteria were used the soil type k 3 and the ratio of irrigation cycle time to the total time of the irrigation process tirr tt k 3 so 12 training testing procedures were carried out per model for each simulated parameter and a total of 48 procedures conduced in surface irrigation type for gep and rf models in simulating wetting diameter dh and depth dv attending to the subsurface irrigation system the soil type k 6 and the emitter depth k 3 were used for dividing the available patterns in continuous application a number of 9 train test procedures were done per model per simulated parameter dh dv and upward water movement zup so totally 54 processes were fulfilled here further the soil type k 3 the emitter depth k 2 and the tirr tt ratio k 3 were used for partitioning the blocks and defining the k values for subsurface pulse irrigation 48 training testing procedures were carried out in this case fig 6 presents a schematic view of the irrigation types application modes along with the corresponded defined k fold test scenarios 2 6 evaluation criteria four statistical evaluation indices were used for assessing the adopted methodology namely the coefficient of determination r2 the root mean square error rmse the scatter index si and the nash sutcliffe coefficient ns as follows 10 r 2 i 1 n x i t arg e t x t arg e t x i mod e l x mod e l i 1 n x i t arg e t x t arg e t 2 i 1 n x i mod e l x mod e l 2 2 11 rmse 1 n i 1 n x i mod e l x i t arg e t 2 12 si rmse x t arg e t 1 n i 1 n x i mod e l x i t arg e t 2 x t arg e t 13 ns 1 i 1 n x i mod e l x i t arg e t 2 i 1 n x i t arg e t x t arg e t 2 in these equations x mod e l and x t arg e t stand for the simulated and target values at the i th time step respectively x mod e l and x t arg e t are the corresponding mean values of the simulated parameter respectively n denotes number of patterns the perfect value of r2 is unity representing a similar trend between the observed and simulated values as this index is sensitive to outliers it shouldn t be used alone as a model assessment tool legates and mccabe 1999 rmse measures the weighted distances between the simulated and observed values through assigning more weights to the larger error magnitudes moreover its weighted version i e si is an appropriate tool for comparative evaluation of the models treatments because it eliminates the impact of the observed values magnitude from rmse and can provide clear insight about the models performance finally the ns coefficient that compares the variance ratios can vary between and 1 perfect performance of the model the applied indices were computed for all testing subsets defined through k fold testing and the complete data set in computing the indices for the complete data set a global matrix was built comprising all simulated observed patters of each testing sub set and then the statistical performance indices were derived using all available patterns 3 results and discussions table 3 presents the global statistical indices of the gep and rf models for all the studied treatments the reported values correspond to the complete data set that have been computed by using observed simulated sets of all k fold testing stages outcomes as mentioned different criteria were considered for partitioning the available patterns into training and testing subsets the best models of each simulated parameter have been underlined to facilitate the comparative assessment of the models attending to the surface irrigation experiments it is clear from the table that the models gave more accurate results for pulse irrigation application than the continuous application for modeling both wetting diameter and depth dh and dv respectively parameters differences between the si and ns δsi and δns values of the best models of the continuous and pulse applications were respectively 0 098 and 0 094 gep and 0 068 and 0 032 rf for dh similarly the δsi and δns values were 0 114 and 0 068 gep and 0 115 and 0 099 rf for dv comparing the performance accuracy of the models for continuous application surface irrigation revealed that dh estimation models gave slightly better results than those of the dv estimation models while dh and dv estimation models presented similar performance accuracy in case of surface pulse irrigation from the data division viewpoint k definition criteria in k fold testing see fig 6 it can be clearly seen that using soil types for defining the test stages have produced more accurate results than using tirr tt criterion this might be linked to the characteristics of the moisture front movement in irrigation systems where a portion of front movement in pulse irrigation applications occurs at the systems rest off time this type of movement occurs when the discharge rate of the emitters are high so the soil doesn t have enough capacity to deliver the irrigation water during the irrigation process during the on time hence given that the water is freely distributed in surface irrigation systems and only a little part of movement occurs at rest time the influence of soil type would be more than the tirr tt ratio in this case finally comparing the gep and rf results with those of the schwartzman model revealed that both the gep and rf models presented more accurate results in surface continuous irrigation the poor performance of the schwartzman model might be linked to the experimental conditions under which it has been developed e g two emitter discharges as 1 1 10 6 and 5 6 10 6 m3 s in case of the subsurface irrigation system similar trends might be detected where the models gave the most accurate results for pulse application with δsi and δns magnitudes for best models of the pulse and continuous applications of 0 051 and 0 025 gep and 0 037 and 0 052 rf in dh estimations in continuous application treatment the models gave the best results for dh simulation followed by dv and upward movement zup using the emitter installation depth has produced better results than using soil type as data division criterion for continuous subsurface irrigation generally the dimensions of the wetted bulb of subsurface irrigation systems are influenced by the depths of subsurface emitter as well as the soil load over the emitter this might explain the higher impact of emitter installation depth on modeling wetting front dimensions which is in agreement with the conclusions obtained by kandelous et al 2008 and singh et al 2006 for subsurface pulse irrigation the best outcomes belonged to dh estimations followed by zup and dv respectively among the target parameters the best estimations for dh and zup were belonged to the models assessed by emitter depth variations while the soil type based partitioning the patterns gave the best results for dv comparing these results with those of the kandelous model for sub surface continuous irrigation it is seen that gep and rf outperformed this model in estimating dh and dv while the best results of zup estimation belonged to kandelous model figs 7 and 8 display the global observed and simulated values of the target parameters for both the surface and subsurface drip irrigation experiments respectively these values have been obtained through pooling the individual observed simulated values of each model per test k fold stage as defined before there are good matches between the target and simulated values in all cases although some scatters underestimations from the identity function 1 1 line can be clearly observed in some cases more specifically the observed and simulated values of dh showed obvious scatters for surface drip irrigation with continuous application mode similar scatters are also clear for zup estimation of subsurface pulse irrigation most of the underestimations shown in the figures corresponded to dv estimations especially for continuous applications obvious scatters are also observed for zup estimation in subsurface continuous application these specific observations are confirmed through analyzing the si values of table 3 this might be linked to the skewness and coefficient of variation cv values of dv and zup as can be seen in fig 9 from the figure it is clear that the values of these indices are higher than the others that can make their simulations difficult furthermore the performances of the best models were assessed through statistical tests so the null hypothesis of equal mean and variance at 0 05 significance level was considered and tested using the t test and f test respectively table 4 presents the t and f values as well as their critical thresholds for the studied models from the table it is clear that in most of the cases the null hypothesis is true and differences between the mean and variance of the observed and simulated values are non significant however significant differences between the mean and variance values are observed as highlighted in table 4 attending to dv simulation in surface continuous irrigation both the tests showed significant differences between observed simulated pairs by using rf method using the rf significant differences of variances were confirmed in modeling both dh and dv in surface pulse irrigation where gep shows a similar difference for modeling dv too finally significant differences of variance can be observed for zup modeling in sub surface pulse irrigation so it is clear that with minor exception gep has showed a good ability for modeling wetting front dimensions table 5 summarizes some metrics of the computational cost for the gep and rf models in the studied treatments figs 10 and 11 shows the importance of each input variable for the studied cases optimal models given by both the gep and rf models in case of the surface irrigation experiments the maximum weight was given for the elapsed time t by the gep and rf model in both continuous and pulse applications except for dh continuous application where gep assigned the maximum weight to flow discharge q further dv estimation gep models gave the similar weights highest values for t and q parameters in continuous application and for t q and tirr tt in pulse application modes for the subsurface irrigation experiments t q and tirr tt variables have had the highest impact on dh and dv modeling while soil bulk density and initial moisture content have presented higher influence on modeling zup for both the continuous and pulse applications attending to the other input variables differences similarities might be detected between the gep and rf models in all cases moreover the figures clearly show that gep has not selected some input variables for modeling the target parameters a first reason for such discrepancies might be the applied models theorem gep develops the constants and structure of the obtained formulae simultaneously so that the case specified constants are included in the formulation of the studied phenomenon nevertheless for reduction of the obtained genetic tress size the parsimony pressure was employed on the other hand rf is a tree based group method where all trees are dependent of a collection of random variables and the forest is grown from many regression trees put together and from a group another reason for differences between the input selections in the studied cases might be the physical facts of the simulated parameters in spite of the all similarities differences between the input selections of the gep and rf models it is evident that rf has utilized all introduced input variables for simulating the target parameters even by giving lower weights while gep has picked up some inputs based on the studied parameter and simulated the target values with higher accuracy hence it might be concluded that gep can handle these kinds of simulations by using limited input variables this is of special importance especially when the available data are limited to some easily measured parameters and one seek to get acceptable results of simulations using those limited variables further the effect of some variables on wetting front dimensions was analyzed first the results showed that the with increasing the elapsed time and the emitter flow discharge the observed and simulated values of dh dv and zup were increased for all treatments this might be anticipated because with increasing the elapsed time flow discharge the volume of water being delivered into soil profile will be increased nonetheless the dimensions of wetting front were influenced by the emitter depth in subsurface irrigation system where the larger the emitter depth the higher the observed and simulated dv and zup values this partial conclusion is in good agreement with the results reported by singh et al 2006 summarizing it was seen that both the models can produce acceptable results in simulating wetting front dimensions in the soil media although some monotonous fluctuations in the degree of performance accuracy can be observed as demonstrated in the tables and figures despite their good degree of accuracy the models developed would have some limitations such as their validity in the range of the data introduced to the models on the other hand the robust k fold testing procedure was adopted with different strategies to increase the generalizability of the applied models so it might be concluded that the models can be used for the similar irrigation systems with various soil type system discharge and emitter characteristics subjected to a quantitative limitation of the input variables to the range of those utilized here further studies might be conducted using more soil types emitter depths and discharge variations to reinforce these conclusions 4 conclusions modeling wetting front dimensions e g diameter depth and upward movement dh dv and zup respectively through gep and rf models assessed by k fold testing were reported in the present research the experiment were conducted for surface and sub surface drip irrigation systems with continuous and pulse water applications different soil e g particles percentage bulk density initial moisture content and saturated hydraulic conductivity and system e g emitter flow discharge irrigation duration elapsed time emitter installation depth and tirr tt parameters were used as input variables to feed the employed models the obtained results of the present research revealed that 1 for both the surface sub surface irrigation systems the pulse application mode presented more accurate results than the continuous application 2 in all the treatments wetting diameter dh simulation gave better results than the dv and zup estimation 3 using soil type as a criterion for defining the data partitioning mode in k fold testing process was the best choice in surface irrigation system for the subsurface system the best criterion for defining k values was emitter installation depth 4 the models showed underestimation trend for higher dh and dv values credit authorship contribution statement jalal shiri conceptualization methodology writing original draft bakhtiar karimi conceptualization data curation methodology nazir karimi experiment conducting mohammad hossein kazemi modeling sepideh karimi modeling writing review editing declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper 
5556,accurate estimation of wetting front dimensions in surface and sub surface irrigation systems is very important for optimal management of water resources as well as increasing the performance of irrigation systems analytical and numerical models need lots of computational efforts and costs so their applications in practical issues might be difficult meanwhile artificial intelligence models could be suitable substitutes for these models the present study aimed at simulating wetting front wetting bulb dimensions in different soil types for surface and sub surface irrigation systems using continuous and pulse applications through the gene expressions programming gep and random forest rf techniques different experiments were carried out to achieve the required data a robust k fold testing data scanning technique was adopted for assessing the applied models where different criteria were considered for defining the k values per test procedure the results obtained revealed that with minor exceptions both the applied gep and rf models presented good ability in modeling the wetting front dimensions in all the conducted treatments the results also showed that soil type and emitter installation depth were the best criteria for defining the k values of k fold testing procedure for the surface and sub surface irrigation systems respectively keywords artificial intelligence irrigation systems k fold testing wetting bulb 1 introduction drip irrigation systems have been widely developed worldwide during the recent decades when designed good and operated suitably these systems help to achieve maximum crop yield drip irrigation systems reduce water applications and can be useful tools for increasing water use efficiency and productivity al ogaidi et al 2016 khanmohammadi and besharat 2018 however when poorly designed and or operated incorrectly the actual performance of drip systems can be much lower than their potential capability al ogaidi et al 2016 on the other hand suitable design and management of these systems requires understanding of the precise distribution of wetting pattern around the emitters kandelous et al 2011 during the past decades substantial studies have been performed to determine the wetting patterns of the point and line sources the diameter and depth of wetting pattern are the basic parameters of moisture front distribution liu and xu 2018 khattak et al 2017 the depth of the wetting front ought to be identified with expected root zone depth while its diameter is dependent to the spaces between the emitters and laterals the main parameters of the wetted zone are shown in fig 1 for surface and subsurface drip irrigation systems so far different methods have been developed for estimating the dimensions of the soil wetted pattern under drip irrigation systems the most common models are the empirical analytical and numerical models subbaiah 2013 empirical models schwartzman and zur 1986 singh et al 2006 amin and ekhmaj 2006 kandelous et al 2008 malek and peters 2011 al ogaidi et al 2016 have been developed using a regression analysis of field laboratory based data further analytical hammami and zayani 2016 cook et al 2003 and numerical šejna et al 2014 elmaloglou et al 2013 arbat et al 2013 models solve the governing flow equations e g richards equation under particular initial and boundary conditions analytical and numerical models require significant computing time and high skills to be applied so it is difficult to employ them for design purposes also empirical models despite their simplicity are site specific and cannot be generalized hence it is necessary to apply a suitable technique to estimate the wetting pattern dimensions with an acceptable accuracy and lower computational costs for wide range of influential factors e g emitter discharge emitter installation depth elapsed time saturated hydraulic conductivity soil bulk density initial moisture content and soil texture consequently soft computing techniques can be suitable alternatives to simulate wetting front dimensions these models can be categorized as empirical regression based models where the relations between independent and dependent variables are discovered and studied soft computing based techniques e g gene expression programming gep and random forest rf have been applied in different water resources engineering disciplines due to strong recognition pattern which can relate the inputs to the target parameter s maroufpoor et al 2019 applications of these approaches in different fields of water resources engineering have been reported in this context including e g modeling water distribution uniformity in sprinkler irrigation maroufpoor et al 2019 simulating water front advance of furrow irrigation golestani kermani et al 2019 modeling wind drift and evaporation losses from sprinkler irrigation maroufpoor et al 2018 al ghobari et al 2018 estimating crop water requirement landeras et al 2018 estimation of dew point temperature soil water capacity and bulk density shiri et al 2014 2017a b respectively and modeling friction factor in irrigation pipes najafzadeh et al 2018 meanwhile most of the investigations aimed to estimate the wetting pattern dimensions for surface drip irrigation systems with continuous singh et al 2006 karimi and mohammadi 2018 ekhmaj et al 2007 kandelous et al 2008 lazarovitch et al 2009 kandelous and simunek 2010a hinnell et al 2010 karimi et al 2015 and pulse karmeli and peri 1974 mostaghimi and mitchell 1983 elmaloglou and diamantopoulos 2009 mohammadbeigi et al 2017 application modes nonetheless most of the studies have used a single data assigning procedure 2 block data partitioning where a certain block of available patterns data are used for training the models and then the developed trained models are tested using an independent data set which might be misleading nevertheless application of gep and rf in such kinds of studies is rare in literature so there is a room to extend such kind of investigations for modeling wetting dimensions of surface subsurface irrigation systems with either continuous and pulse application modes the present study aimed at simulating horizontal and vertical wetting dimensions of the surface and subsurface drip irrigation systems with continuous and pulse application modes using the gep and rf techniques assessed by the robust k fold testing data scanning procedure 2 material and methods 2 1 laboratory experiments and used data the laboratory experiments were carried out at the central laboratory of the agricultural college of university of kurdistan iran a soil container with a length of 3 m width of 0 5 m and height of 1 m was used in the experiments one side of this container is plexiglass sheets to monitor the advance of wetting patterns at different times during the experiments three air dried soil samples were filled into the lysimeter according to bulk density of each soil table1 presents the physical properties of the studied soil samples fig 2 shows the studied soils texture graph for soil stability and uniform initial water distribution the soil container was left in the laboratory form 24 to 48 h moreover to prevent preferential flow along the walls lysimeter walls were treated with glue and sprayed with sand to create a coarse surface kandelous and simunek 2010b the reservoir volume was 200 l containing a float to keep a constant water level a pressure gauge and a ball valve were placed in discharge pipe of the pump for measuring the system pressure and maintaining the steady discharge all the experiments were performed at a fixed pressure i e 2 bars emitter clogging based suspended particle was prevented by the filtration system an off on valve placed between the lateral and sub main to control flow inside each container moreover to achieve high uniformity in subsurface irrigation system emitters were placed on soil surface in the middle of one of the lysimeter walls and water flow was delivered to certain depths through a thin tube with a diameter of 5 mm as advised by kandelous and simunek 2010b emitters were connected to a water reservoir by micro polyethylene tubes main sub main and lateral tubes with diameters of 32 20 and 16 mm respectively considering low discharge rate in each experiment a by pass assembly was installed to regulate inflow and return additional water to reservoir the wetting front and water distribution were evaluated in light medium and heavy textured homogeneous soils the length of the containers for all the soil textures was 1 m fig 3 shows the schematic description of experimental device this container represents half space of the complete cylinder i e half of the wetted zone so the actual emitter discharges were multiplied by 2 kandelous and simunek 2010a al ogaidi et al 2016 the saturated hydraulic conductivity was estimated using rosetta software schaap et al 2001 a total of 108 experiments 36 and 72 experiment for surface and subsurface drip irrigation systems respectively were conducted with three discharge rates of 2 4 and 6 l h the experiments were carried out for two continuous and pulse application modes in pulse application the pulse cycles were considered as 30 30 20 40 and 40 20 min the first shows the irrigation time on and the second denotes the rest time off of the system the irrigation time was set as 4 h and emitters were placed at three depths of 0 15 and 30 cm below the soil surface the locations of the wetting patterns were recorded by drawing them on the plexiglass walls at specified times at the end of each experiment graded tapes in lysimeter body were used for preparing the shape of wetting zone the coordinates of the horizontal and vertical wetting patterns were digitized using grapher software version 7 finally the values of wetted dimensions in horizontal and vertical directions were calculated 2 2 gene expression programming gep alike to genetic programming gp gep imitates the biological evolution for making a computer program that can simulate the target parameter the problems are encoded in fixed length linear chromosomes ferreira 2006 a strong aspect of gep is its capability in presenting the models mathematical expressions that have related the input target parameters which can be transferable to other patterns by using the gep method the first step is selecting the proper fitness function the root relative squared error rrse was used as the fitness function according to literature for the same kinds of studies maroufpoor et al 2019 the second step consists of defining the terminal input target pairs and functions sets terminal set includes the independent input variables see section 2 5 as well as the simulated targets wetting front dimensions in all treatments according to koza 1994 the first functions that should be used in simulation issues are the four basic mathematical operators here a set of mathematical functions consisted of the main functions trigonometric functions and other mathematical functions x2 exp as advised in such kinds of studies the third step with gep establishment is defining the architecture of gep chromosomes that were selected as length of head 8 and gene numbers per chromosome 3 according to ferreira 2001 the next step is defining the linking function with which the sub trees of gep are linked together among four possibilities for this function addition multiplication subtraction and division addition linking function was selected as this is the commonly used function in simulation issues as advised by ferreira 2006 the last phase of gep implementation is selecting the basic genetic operators mutation rate etc that were used as default values of genexpro program fig 4 shows a schematic gep representation where gep flowchart is completed each time to obtain the gep based model that relates the input variables to targets 2 3 random forest rf random forests rf a group learning algorithm handles high dimension regressive issues as a tree based group method all trees in rf are dependent of a series of random variables and the forest is grown from many regression trees put together and form a group breiman 2001 the final decision is a consequence of averaging the output following the fitting individual trees in ensemble bagging procedure the bias of the bagged trees is the same of the single trees whereas the variance is decreased by reducing the correlation between the trees hastie et al 2009 rfs for regression are formed by growing trees depending on a random vector θ so that tree predictor h x θ can take on numerical magnitudes the mean squared generalization error of each numerical estimator h x is breiman 2001 1 e x y y h x 2 rf estimator is formed through making an average over the j th tree in this case the following two basic theorems stand theorem1 by increasing the number of trees in the forest 2 e x y ya v j h x θ j 2 e x y y e θ h x θ 2 the right hand of the above equation illustrates the generalization error of the forest similarly the average generalization error of a tree is breiman 2001 3 pe tree e θ e x y y h x θ 2 theorem2 suppose that ey e x h x θ for all θ so 4 pe f o r e s t ρ p e t r e e in which ρ denotes the weighted correlation between the residuals y h x θ and y h x θ θ and θ are independent variables breiman 2001 fig 5 shows a general view of the rf method various numbers of rf trees were examined here to find the optimum tree number optimum tree numbers were different for each analyzed case and more detailed information in this regard will be given in the next sections further 10 cycles were found as the best cycle number for calculating the mean error the percentage decrease in training error was found as 5 iteratively minimum child node size to stop and the maximum number of levels were selected as 5 and 10 respectively based on trial and error process 2 4 commonly used empirical models in order to assess the performance of the developed soft computing approaches with respected to the traditional methods two commonly used models were applied and compared with gep and rf schwartzman and zur 1986 introduced an empirical model for simulating wetting front dimensions under surface drip irrigation systems their model stands on relating the emitter discharge q m3 s 1 saturated hydraulic conductivity ks m s 1 and total volume of applied water vw m3 to the diameter and depth of water front as follows 5 d h 1 82 v w 0 22 k s q 0 17 6 d v 2 54 v w 0 63 k s q 0 45 kandelous et al 2008 developed empirical equations for estimating wetting front dimension from the subsurface continuous irrigation systems as 7 d h 4 244 v w 0 526 k s q 0 026 8 d v 0 66 v w 0 333 k s q 0 167 9 z up 0 72 v w 0 344 k s q 0 156 to the best of the authors knowledge there is no recommended model for estimating wetting dimensions of pulse irrigation systems among the traditional methods 2 5 study protocol a major task with application of data driven approaches is selecting the appropriate input parameters that can easily simulate the target parameter s values there are different input selection methods from which analysis of the physical aspects of the studied phenomenon might be a good candidate for selecting the inputs here both the physical behavior of the studied phenomenon and the reports given by the published literature were considered for selecting the proper input variables hence the emitter discharges q soil texture factors silt sand and clay percentages soil bulk density ρb saturated hydraulic conductivity ks and the elapsed time t were considered as inputs for simulating the wetting front dimensions in all treatments e g al ogaidi et al 2016 an additional emitter depth d variable was also considered in subsurface irrigation systems while the ratio of irrigation cycle time to the total time of the irrigation process tirr tt was considered in pulse irrigation mode another major step with applying data driven models is partitioning the available patterns for training and testing the applied models a common procedure would be partitioning the available data into two blocks namely training and testing data set this division might be achieved randomly or by considering specific conditions of the studied phenomenon thus the established model using the training data will be tested by a single data set testing patterns although this is a straightforward procedure for developing and assessing the applied models the outcomes might be misleading because all the available patterns have not been participated in model development testing hence other robust scanning procedures should be adopted for assessing the models performances e g marti et al 2013 in the present research the powerful k fold testing data scanning tool was adopted for all the studied experiments so all available patterns of each experiment based on irrigation type application mode were divided into k blocks and the models were trained each time by using k 1 blocks and then tested using the patterns of the remaining one block the process was repeated until all available patterns of each experiment were incorporated in both the training and testing stages the values of k might be defined based on different criteria here different criteria were used to define the k values of k fold testing i e defining the test subset per experiment e g soil type based emitter depth based and tirr tt based partitioning of data table 2 provides general information on the available patterns of each irrigation type application mode based on the information presented in this table for the surface irrigation system with continuous application mode the patterns were divided based on soil type k 6 in the pulse mode two criteria were used the soil type k 3 and the ratio of irrigation cycle time to the total time of the irrigation process tirr tt k 3 so 12 training testing procedures were carried out per model for each simulated parameter and a total of 48 procedures conduced in surface irrigation type for gep and rf models in simulating wetting diameter dh and depth dv attending to the subsurface irrigation system the soil type k 6 and the emitter depth k 3 were used for dividing the available patterns in continuous application a number of 9 train test procedures were done per model per simulated parameter dh dv and upward water movement zup so totally 54 processes were fulfilled here further the soil type k 3 the emitter depth k 2 and the tirr tt ratio k 3 were used for partitioning the blocks and defining the k values for subsurface pulse irrigation 48 training testing procedures were carried out in this case fig 6 presents a schematic view of the irrigation types application modes along with the corresponded defined k fold test scenarios 2 6 evaluation criteria four statistical evaluation indices were used for assessing the adopted methodology namely the coefficient of determination r2 the root mean square error rmse the scatter index si and the nash sutcliffe coefficient ns as follows 10 r 2 i 1 n x i t arg e t x t arg e t x i mod e l x mod e l i 1 n x i t arg e t x t arg e t 2 i 1 n x i mod e l x mod e l 2 2 11 rmse 1 n i 1 n x i mod e l x i t arg e t 2 12 si rmse x t arg e t 1 n i 1 n x i mod e l x i t arg e t 2 x t arg e t 13 ns 1 i 1 n x i mod e l x i t arg e t 2 i 1 n x i t arg e t x t arg e t 2 in these equations x mod e l and x t arg e t stand for the simulated and target values at the i th time step respectively x mod e l and x t arg e t are the corresponding mean values of the simulated parameter respectively n denotes number of patterns the perfect value of r2 is unity representing a similar trend between the observed and simulated values as this index is sensitive to outliers it shouldn t be used alone as a model assessment tool legates and mccabe 1999 rmse measures the weighted distances between the simulated and observed values through assigning more weights to the larger error magnitudes moreover its weighted version i e si is an appropriate tool for comparative evaluation of the models treatments because it eliminates the impact of the observed values magnitude from rmse and can provide clear insight about the models performance finally the ns coefficient that compares the variance ratios can vary between and 1 perfect performance of the model the applied indices were computed for all testing subsets defined through k fold testing and the complete data set in computing the indices for the complete data set a global matrix was built comprising all simulated observed patters of each testing sub set and then the statistical performance indices were derived using all available patterns 3 results and discussions table 3 presents the global statistical indices of the gep and rf models for all the studied treatments the reported values correspond to the complete data set that have been computed by using observed simulated sets of all k fold testing stages outcomes as mentioned different criteria were considered for partitioning the available patterns into training and testing subsets the best models of each simulated parameter have been underlined to facilitate the comparative assessment of the models attending to the surface irrigation experiments it is clear from the table that the models gave more accurate results for pulse irrigation application than the continuous application for modeling both wetting diameter and depth dh and dv respectively parameters differences between the si and ns δsi and δns values of the best models of the continuous and pulse applications were respectively 0 098 and 0 094 gep and 0 068 and 0 032 rf for dh similarly the δsi and δns values were 0 114 and 0 068 gep and 0 115 and 0 099 rf for dv comparing the performance accuracy of the models for continuous application surface irrigation revealed that dh estimation models gave slightly better results than those of the dv estimation models while dh and dv estimation models presented similar performance accuracy in case of surface pulse irrigation from the data division viewpoint k definition criteria in k fold testing see fig 6 it can be clearly seen that using soil types for defining the test stages have produced more accurate results than using tirr tt criterion this might be linked to the characteristics of the moisture front movement in irrigation systems where a portion of front movement in pulse irrigation applications occurs at the systems rest off time this type of movement occurs when the discharge rate of the emitters are high so the soil doesn t have enough capacity to deliver the irrigation water during the irrigation process during the on time hence given that the water is freely distributed in surface irrigation systems and only a little part of movement occurs at rest time the influence of soil type would be more than the tirr tt ratio in this case finally comparing the gep and rf results with those of the schwartzman model revealed that both the gep and rf models presented more accurate results in surface continuous irrigation the poor performance of the schwartzman model might be linked to the experimental conditions under which it has been developed e g two emitter discharges as 1 1 10 6 and 5 6 10 6 m3 s in case of the subsurface irrigation system similar trends might be detected where the models gave the most accurate results for pulse application with δsi and δns magnitudes for best models of the pulse and continuous applications of 0 051 and 0 025 gep and 0 037 and 0 052 rf in dh estimations in continuous application treatment the models gave the best results for dh simulation followed by dv and upward movement zup using the emitter installation depth has produced better results than using soil type as data division criterion for continuous subsurface irrigation generally the dimensions of the wetted bulb of subsurface irrigation systems are influenced by the depths of subsurface emitter as well as the soil load over the emitter this might explain the higher impact of emitter installation depth on modeling wetting front dimensions which is in agreement with the conclusions obtained by kandelous et al 2008 and singh et al 2006 for subsurface pulse irrigation the best outcomes belonged to dh estimations followed by zup and dv respectively among the target parameters the best estimations for dh and zup were belonged to the models assessed by emitter depth variations while the soil type based partitioning the patterns gave the best results for dv comparing these results with those of the kandelous model for sub surface continuous irrigation it is seen that gep and rf outperformed this model in estimating dh and dv while the best results of zup estimation belonged to kandelous model figs 7 and 8 display the global observed and simulated values of the target parameters for both the surface and subsurface drip irrigation experiments respectively these values have been obtained through pooling the individual observed simulated values of each model per test k fold stage as defined before there are good matches between the target and simulated values in all cases although some scatters underestimations from the identity function 1 1 line can be clearly observed in some cases more specifically the observed and simulated values of dh showed obvious scatters for surface drip irrigation with continuous application mode similar scatters are also clear for zup estimation of subsurface pulse irrigation most of the underestimations shown in the figures corresponded to dv estimations especially for continuous applications obvious scatters are also observed for zup estimation in subsurface continuous application these specific observations are confirmed through analyzing the si values of table 3 this might be linked to the skewness and coefficient of variation cv values of dv and zup as can be seen in fig 9 from the figure it is clear that the values of these indices are higher than the others that can make their simulations difficult furthermore the performances of the best models were assessed through statistical tests so the null hypothesis of equal mean and variance at 0 05 significance level was considered and tested using the t test and f test respectively table 4 presents the t and f values as well as their critical thresholds for the studied models from the table it is clear that in most of the cases the null hypothesis is true and differences between the mean and variance of the observed and simulated values are non significant however significant differences between the mean and variance values are observed as highlighted in table 4 attending to dv simulation in surface continuous irrigation both the tests showed significant differences between observed simulated pairs by using rf method using the rf significant differences of variances were confirmed in modeling both dh and dv in surface pulse irrigation where gep shows a similar difference for modeling dv too finally significant differences of variance can be observed for zup modeling in sub surface pulse irrigation so it is clear that with minor exception gep has showed a good ability for modeling wetting front dimensions table 5 summarizes some metrics of the computational cost for the gep and rf models in the studied treatments figs 10 and 11 shows the importance of each input variable for the studied cases optimal models given by both the gep and rf models in case of the surface irrigation experiments the maximum weight was given for the elapsed time t by the gep and rf model in both continuous and pulse applications except for dh continuous application where gep assigned the maximum weight to flow discharge q further dv estimation gep models gave the similar weights highest values for t and q parameters in continuous application and for t q and tirr tt in pulse application modes for the subsurface irrigation experiments t q and tirr tt variables have had the highest impact on dh and dv modeling while soil bulk density and initial moisture content have presented higher influence on modeling zup for both the continuous and pulse applications attending to the other input variables differences similarities might be detected between the gep and rf models in all cases moreover the figures clearly show that gep has not selected some input variables for modeling the target parameters a first reason for such discrepancies might be the applied models theorem gep develops the constants and structure of the obtained formulae simultaneously so that the case specified constants are included in the formulation of the studied phenomenon nevertheless for reduction of the obtained genetic tress size the parsimony pressure was employed on the other hand rf is a tree based group method where all trees are dependent of a collection of random variables and the forest is grown from many regression trees put together and from a group another reason for differences between the input selections in the studied cases might be the physical facts of the simulated parameters in spite of the all similarities differences between the input selections of the gep and rf models it is evident that rf has utilized all introduced input variables for simulating the target parameters even by giving lower weights while gep has picked up some inputs based on the studied parameter and simulated the target values with higher accuracy hence it might be concluded that gep can handle these kinds of simulations by using limited input variables this is of special importance especially when the available data are limited to some easily measured parameters and one seek to get acceptable results of simulations using those limited variables further the effect of some variables on wetting front dimensions was analyzed first the results showed that the with increasing the elapsed time and the emitter flow discharge the observed and simulated values of dh dv and zup were increased for all treatments this might be anticipated because with increasing the elapsed time flow discharge the volume of water being delivered into soil profile will be increased nonetheless the dimensions of wetting front were influenced by the emitter depth in subsurface irrigation system where the larger the emitter depth the higher the observed and simulated dv and zup values this partial conclusion is in good agreement with the results reported by singh et al 2006 summarizing it was seen that both the models can produce acceptable results in simulating wetting front dimensions in the soil media although some monotonous fluctuations in the degree of performance accuracy can be observed as demonstrated in the tables and figures despite their good degree of accuracy the models developed would have some limitations such as their validity in the range of the data introduced to the models on the other hand the robust k fold testing procedure was adopted with different strategies to increase the generalizability of the applied models so it might be concluded that the models can be used for the similar irrigation systems with various soil type system discharge and emitter characteristics subjected to a quantitative limitation of the input variables to the range of those utilized here further studies might be conducted using more soil types emitter depths and discharge variations to reinforce these conclusions 4 conclusions modeling wetting front dimensions e g diameter depth and upward movement dh dv and zup respectively through gep and rf models assessed by k fold testing were reported in the present research the experiment were conducted for surface and sub surface drip irrigation systems with continuous and pulse water applications different soil e g particles percentage bulk density initial moisture content and saturated hydraulic conductivity and system e g emitter flow discharge irrigation duration elapsed time emitter installation depth and tirr tt parameters were used as input variables to feed the employed models the obtained results of the present research revealed that 1 for both the surface sub surface irrigation systems the pulse application mode presented more accurate results than the continuous application 2 in all the treatments wetting diameter dh simulation gave better results than the dv and zup estimation 3 using soil type as a criterion for defining the data partitioning mode in k fold testing process was the best choice in surface irrigation system for the subsurface system the best criterion for defining k values was emitter installation depth 4 the models showed underestimation trend for higher dh and dv values credit authorship contribution statement jalal shiri conceptualization methodology writing original draft bakhtiar karimi conceptualization data curation methodology nazir karimi experiment conducting mohammad hossein kazemi modeling sepideh karimi modeling writing review editing declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper 
5557,artificial neural networks anns are one of the most widely used techniques for solving a variety of problems including classification and function approximation type of problems however the use of anns in hydrology is limited to academics and research and hydrologists policymakers are skeptical to use the anns in operational hydrology especially where a premium is placed on the comprehensibility of the systems this is probably because of the perceived black box nature of the anns as they do not provide an insight into their learning process or elucidation of obtaining a particular result since a long time researchers have been trying to improve the comprehensibility of trained ann models by knowledge extraction for improving their reliability and acceptability among the decision makers for operation purposes there are few such attempts in hydrology particularly for ann models developed for function approximation problems such as flow forecasting and evaporation estimation in this paper a novel approach is proposed that is capable of extracting knowledge from trained ann models for classification type of problems in hydrology this is achieved by extracting knowledge in terms of rules by inducing a decision tree using input output relation of a trained ann model for forecasting drought classes with standardized precipitation index for indian meteorological sub divisions the reported researches on knowledge extraction in hydrology is primarily been for the function approximation type of problems however the present approach is fundamentally different from them and useful for knowledge extraction exclusively for classification problems in hydrology the findings of this research indicate that definite rules are learned by ann models during their training to forecast a specific drought class these extracted rules are simple easily implementable and can be used as the drought class forecasting tool in a drought management activity the results suggest that due to the nature of the drought index used the rules extracted from one region may be suitable for drought monitoring of other regions keywords drought classification standard precipitation index artificial neural network decision tree knowledge extraction water resources 1 introduction the artificial neural networks anns possess proven ability in solving many complex real world problems including function approximation and classification type of problems in spite of their popularity among the hydrologists and researchers the anns have not been adopted as operational tools for hydrological modeling in solving real life problems in hydrology one of the major reasons for the anns not being adopted as operational tools may be the perception that they are not able to explain the physical behavior of the process being modeled and viewed rather skeptically due to their black box nature see et al 2008 jain and kumar 2009 maier and dandy 2000 dawson and wilby 2001 and maier et al 2010 constantly stressed the need to increase model transparency and enable knowledge to be extracted from the trained anns in the applications of solving various hydrological problems the knowledge extraction ke is a commonly adopted term for those methods which offer the end user an insight into either the process by which an ann has arrived at a given result or in general the totality of knowledge actually embedded therein tickle et al 1998 the ke tools for function approximation and classification type of problems can be quite different although a plethora of ann applications are available in hydrology the hydrologists have not endeavored to construe the knowledge embedded in the trained ann models jain et al 2004 except for a few research attempts to extract the knowledge from trained ann models for function approximation type of problems in hydrology and mainly on rainfall runoff modeling wilby et al 2003 jain et al 2004 sudheer and jain 2004 sudheer 2005 kingston et al 2006 jain and kumar 2009 londhe and shah 2017a b in the reported researches simple graphical and statistical methods have only been explored for knowledge extraction of trained ann hydrological models recently chen et al 2018 designed a 2 d topological bubble map to visualize the interactive mechanism between surface water and groundwater over the river basin while using self organizing map a type of ann however such methods are not suitable for knowledge extraction from ann models developed for classification applications in applied hydrology some of the studies on knowledge extraction have been reported on classification problems in various fields of science and technology other than hydrology where the knowledge in terms of rules was extracted from the trained ann models to enhance the comprehensibility of the ann models using more comprehensible techniques such as fuzzy rule based systems formal concept analysis ant colony optimization particle swarm optimization etc benitez et al 1997 castro et al 2002 mantas et al 2006 zarate et al 2008 ozbakir et al 2010 and ozbakir and delice 2011 the adaptive network based fuzzy inference system and decision tree techniques are used widely for function approximation problems in hydrology londhe and dixit 2012 chang and tsai 2016 zhou et al 2019 and have a potential to one of the best classifiers a decision tree dt which is a decision support tool known for highly comprehensible classifier among data driven techniques has been used for ke by few of researchers in the field other than hydrology schmitz et al 1999 dancey et al 2007 the dt generated by c4 5 algorithm quinlan 1993 is used for solving classification problems dt is the most widely used tool in practice as aclassifier xindong et al 2008 witten et al 2011 as it has ability to deal with missing values of attribute continuous and discrete attributes and can check the overfitting by involving pruning step during its development however the dt in hydrology is used mostly for simulation of regression type of hydrological problems mostly for rainfall runoff process using m5 model tree solomatine and dulal 2003 bhattacharya and solomatine 2005 londhe and dixit 2012 and have never been used for classification problems and their ke in hydrology there are several classification type of problems in hydrology that are routinely encountered by hydrologists and scientists while dealing with various real world hydrologic processes such as rainfall occurrence drought classification flood categorization etc valdes and sastri 1989 paulo et al 2005 paulo and pereira 2007 and therefore research is needed as the knowledge extraction from such models is still a new research area in this study we attempt to extract the knowledge from the trained ann model in one of the most challenging classification problems in hydrology i e drought class forecasting drought is one of the hydrologic extremes often referred to as a creeping phenomenon and an insidious hazard which creates a water scarce situation affecting many socio economical sectors demanding high water supply such as agricultural ecological municipal and industrial sectors as per the federal emergency management agency federal emergency management agency 1995 a typical drought costs american farmers and businesses 6 8 billion dollars each year more than damages incurred from floods and hurricanes the consequences tend to be far more severe in areas where there is scarcity of well developed planning for natural hazards and the agriculture is the major economic driver such as in india therefore the proper assessment and monitoring system of drought is essentially required to mitigate the impacts of drought there are several methods used as drought quantification tool e g simple measurement of rainfall deficit stream flow shortage and various drought indices dis however dis have been the most commonly used tools for drought forecasting in operational hydrology because the drought index is expressed as numbers which is believed to be far more functional than the raw data during decision making hayes 2003 and also it is able to quantify the drought for different time scales though the yearly and monthly time scales are mostly used time scales the monthly time scale is more appropriate for monitoring the effects of a drought in situations related to agriculture water supply and ground water abstractions panu and sharma 2002 some of the most commonly used dis are the palmer drought severity index pdsi palmer 1965 which needs precipitation and temperature data crop moisture index cmi palmer 1968 which needs weekly values of temperature and precipitation data surface water supply index swsi shafer and dezman 1982 which needs snow water content stream flow rainfall and storage reservoir volume data standardized precipitation index spi mckee et al 1993 1995 and percent of normal pn hayes 2003 which need only precipitation data the multivariate drought indices hao and singh 2015 such as aggregated drought index adi keyantash and dracup 2004 and the drought index based on data fusion and integration azmi et al 2016 azmi et al 2017 azmi and rüdiger 2018 are some of the recently developed drought indices which needs all significant hydrometeorological variables within the hydrologic cycle however the rainfall based dis are more widely used than the other dis due to fewer input data requirements flexibility and simplicity in calculations mishra and singh 2010 the use of statistical and data driven techniques in drought forecasting began in mid of 20th century yevjevich 1967 rao and padmanabhan 1984 mishra and desai 2005 cancelliere et al 2007 modarres 2007 fernandez et al 2009 durdu 2010 han et al 2010 beyaztas and yaseen 2019 xu et al 2018 but the anns became popular in the development of drought forecasting models in the 21st century kim and valdes 2003 started the use of ann in drought forecasting using pdsi while mishra and desai 2006 has used the spi series first time in development of ann drought forecasting model in the kansabati river basin india and reported that the ann models can be very useful for local administrations and water resource planners in continuation mishra et al 2007 developed a hybrid model by combining linear stochastic model and nonlinear ann model for forecasting droughts in the same basin using spi series later many researchers used anns for forecasting various drought indices morid et al 2007 barros and bowden 2008 ochoa rivera 2008 cutore et al 2009 jamshidi et al 2011 barua et al 2012 santos et al 2014 maca and pech 2016 recently kisi et al 2019 used various heuristic methods for drought forecasting in most of the works discussed here the magnitude of one of the drought indices has been forecasted though the objective may lie in forecasting the future drought class in terms of drought severity for forecasting drought class the markov chain models have been largely utilized by many researchers gabriel and neumann 1962 lohani and loganathan 1997 lohani et al 1998 paulo et al 2005 paulo and pereira 2007 cancelliere et al 2007 besides markov chain models other data driven models have also been explored by few researchers paulo et al 2005 moreira et al 2006 moreira et al 2008 and kavalieratou et al 2012 used log linear modeling approach to forecast drought class transition probabilities the use of atmospheric patterns such as el nino southern oscillation enso and the north atlantic oscillation nao in drought class forecasting has been explored by chen et al 2013 and bonaccorso et al 2015 based on probabilistic approaches though anns are known to be one of the best classifiers they have not been explored so far for drought class forecasting anns have a potential to forecast the drought class but it needs to be explored this paper proposes a methodology for extraction of knowledge from the trained ann drought class forecasting model using comprehensible technique known as decision tree the specific objectives of this paper are to i develop ann models for drought forecasting using standard precipitation index ii employ anns to characterize drought in future as the classification type of problem iii extract rules from the trained ann drought classification model using dt to establish simple rules for drought forecasting and monitoring the monthly rainfall data in mm derived from one of the meteorological subdivisions in india i e gangetic west bengal are employed to test the methodologies proposed in this paper the paper starts with a brief description of the tools and techniques employed in this study the description of the study area and the data employed are then presented before describing the procedure for model development for future drought severity a detailed description of the procedure for knowledge extraction is then discussed the obtained results are discussed next before making concluding remarks 2 tools and techniques the modeling tools and techniques employed to carry out the investigations in this study include the standard precipitation index spi ann and the dt three layered an input layer one hidden layer and an output layer feed forward neural network trained with back propagation ffbp using levenberg marquartd lm algorithm is used in this study hagan and menhaj 1994 hagan et al 1996 a brief overview about the spi and its procedure for calculation and the dt technique is presented next 2 1 standard precipitation index the spi proposed by mckee et al 1993 which is based on the long term precipitation record for a desired period is used as drought assessment tool in this study it is an index to categorize the severity of a drought due to rainfall deficit locally or globally the spi was used in this study because it is based on rainfall data alone so the drought assessment is possible where even other hydrometeorological measurements are not available also it has a variable time scale and is thus conducive to monitor short term water supplies such as soil moisture which is important for agricultural production and long term water resources such as groundwater supplies stream flow and lake and reservoir levels hayes et al 1999 mishra et al 2007 moreover many researchers have advocated the use of spi over other drought indices while using it in different hydroclimatic conditions guttman 1998 hayes et al 1999 hughes and saunders 2002 it is also recommended to use the spi when there is at least 30 years of monthly rainfall data available keyantash 2018 the procedure for the computation of spi suggested by mckee et al 1993 and guttman 1999 can be briefly summarized in the following steps 1 the rainfall record of a long term time any base time may be chosen depending on the time scale of interest is fitted with a probability distribution generally by gamma distribution as it fits the rainfall time series well sonmez et al 2005 2 after fitting the probability distribution the cumulative probability of an observed rainfall is computed 3 the inverse normal gaussian function with mean zero and variance one is then applied to the cumulative probability distribution function which results in the spi 2 2 decision tree a decision tree is a decision support tool known for highly comprehensible classifier among data driven techniques iterative dichotomiser 3 id3 quinlan 1986 classification and regression tree cart breiman et al 1984 c4 5 quinlan 1993 and m5 model trees m5 quinlan 1992 are some of the algorithms for generating dt for the problems related to classification clustering and regression the dt generated by c4 5 algorithm has been used for knowledge extraction from ann hydrologic models in this study the c4 5 algorithm builds decision trees from a set of training data using the concept of divide and conquer or top down induction the advantage of c4 5 is that it can handle both continuous and discrete attributes handle training data with missing values of the attributes and can check for the over fitting issue during their training using method of pruning as shown in fig 1 the tree starts growing from the root node which is one of the input attributes and further gets divided into two sub nodes by the process of splitting a sub node can further split into either a decision node or a leaf node the node which stops splitting further are called leaf nodes and represent the final outcome in terms of decision the class in which the feature should lie a decision node can further split into a leaf or decision node the process ends when the c4 5 algorithm results into leaf nodes only representing class es the training data set s consists of already classified samples s 1 s 2 s 3 s i each sample s i consists of a d dimensional vector x 1 i x 2 i x j i x d i where x j i represent the attribute values orfeaturesof the sample as well as the class in which s i falls at every node of the tree the c4 5 algorithm chooses the attribute that most effectively splits its set of samples into subsets enriched in one class or the other the splitting criterion adopted by c4 5 algorithm is the normalizedinformation gainor the gain ratio which is robust and results in small trees quinlan 1993 the gain ratio is calculated on the basis of entropy of information shannon 1940 which is used to measure how informative is a node the attribute with the highest gain ratio is chosen to make the decision the c4 5 algorithm then recursively moves to the partitioned sub nodes the recursion of the algorithm stops when any of the following three criteria is reached 1 all the samples in the set belong to the same class this criterion simply creates a leaf node in the decision tree indicating to choose that class 2 if c4 5 cannot find a test that results in at least two outcomes having a minimum number of examples case parameter m in the leaf osei bryson 2007 3 finally if the list of candidate tests available to use at a node is empty this process often produces over elaborate trees namely over fitting that must be checked after developing the tree c4 5 algorithm simplifies it by pruning away various sub trees and replacing them with leaves to avoid over fitting it considers replacing each internal node by either a leaf or one of the node s branches in order to decide whether a change should be made c4 5 computes a confidence interval around the re substitution error rate of the node a change is made to a sub tree if the resulting re substitution error rate for the modified sub tree is within a c confidence interval of the error rate of unmodified sub tree the parameter c determines how conservative the pruning process should be and can be established by trial and error method the m for the leaf and c of c4 5 algorithm are problem specific and need to be determined separately for different problems more details of the c4 5 algorithm for developing dt can be found in witten et al 2011 2 3 model selection and performance evaluation the model selection and performance evaluation of various spi forecasting models were done using combination of different standard statistical measures average absolute relative error aare pearson coefficient of correlation r nash sutcliffe efficiency e root mean square error rmse and threshold statistics ts which are commonly employed error statistics their detailed description can be found elsewhere jain and indurthy 2003 chidthong et al 2009 the performance of drought classification models on the other hand was assessed using confusion matrix kohavi and provost 1998 and percentage of correct classification the confusion matrix is a standard tool for evaluating model performances for classification problems and widely employed by the machine learning community it contains information about actual and predicted classifications done by a classification system the performance of such systems is commonly evaluated using the data in the n by n matrix where n is the number of classes fig 2 shows a confusion matrix for a two class classifier where entries tp true positive and fp false positive in the confusion matrix are the number of correct and incorrect predictions that an instance is positive while tn true negative and fn false negative are the number of correct and incorrect predictions that an instance is negative on the basis of the entries tp fp tn and fn indices such as sensitivity or true positive rate tpr miss rate or false negative rate fnr specificity or true negative rate tnr fall out or false positive rate fpr precision or positive predictive value ppv false discovery rate fdr negative predictive value npv false omission rate for and accuracy acc can be calculated and given in fig 2 as obvious the values of ppv npv tpr tnr and acc closer to 100 from a model indicate the best performance accuracy of the model 3 study area and data monthly precipitation data from the gangetic west bengal gwb meteorological subdivision of india obtained from indian institute of tropical meteorology iitm pune available at www tropmet res in for 60 years period 1951 2010 were employed in this study fig 3 shows the map of gwb meteorological sub division which consists of 13 major districts of west bengal with a total area of 66 228 km2 2 3 of the total area of india this entire sub division contains a total of eleven rain gauge stations for which the spatial mean of the rainfall data is available the total data are divided into two sets 36 years for training set from 1951 to 1986 and 24 years for testing set from 1987 to 2010 the basic descriptive statistics of the rainfall data are presented in table 1 spi calculation a matlab code was developed using procedure mentioned earlier for the computation of spi the outcomes from the developed code were verified by those obtained from available open source software called as spi sl 6 nmdc developed by university of nebraska lincoln usa the kolgomorov smirnov and chi square test statistics suggest that the monthly rainfall series used in this study follows a gamma distribution the running series of total rainfall corresponding to 3 6 9 and 12 months was fitted with the gamma distribution and the corresponding spis spi3 spi6 spi9 and spi12 respectively were calculated the spi series for different time scales so obtained are shown in fig 4 mckee s drought categorization chart proposed by mckee et al 1993 to define drought intensities resulting from the spi values given in table 2 which has been used by many researchers hayes et al 1999 mishra et al 2007 is used in this study for discretization of spi series into seven different drought categories the discretization filter to convert drought index to drought class is shown in fig 5 4 model development for forecasting drought severity in the previous researches the ann models are developed to predict the abnormality of rainfall magnitude in terms of various drought indices and not in terms of the drought class severity the prediction of the future drought conditions in terms of its severity such as severe moderate normal etc would be desirable for many water resources applications some of them are agricultural and municipal water management for this purpose three ann models were developed for forecasting one month ahead drought class dc using three different strategies in enforcing discretization of data at various levels of model development in this study in the first strategy an ann model was developed using continuous inputs and continuous targets in second strategy an ann model was developed using continuous inputs and discretized targets and in the last strategy an ann model was developed using discretized inputs and discretized targets the enforcement of the discretization of data at various levels during model development was investigated to assess its effect on the model performance in forecasting future drought class the names assigned for these models are as follows dccc drought classification using continuous inputs and continuous targets dccd drought classification using continuous inputs and discretized targets dcdd drought classification using discretized inputs and discretized targets as mentioned earlier the spi was discretized by using popular drought classification table given by mckee et al 1993 to compare the performance of the ann drought classification models decision tree model is also developed the development of the three ann models and dt model is presented next 4 1 dccc model development the dccc model was developed in two steps in the first step ann model was developed for forecasting one month ahead spi using the past spi data and in the second step the discretization was enforced at the output level using drought classification table in the first step four ann models were developed for forecasting spi3 spi6 spi9 and spi12 the ann models developed in this study consist of three layers input hidden and output and are trained using levenberg marquardt lm algorithm hagan and menhaj 1994 hagan et al 1996 as spis are both negative and positive real values the hyperbolic tangent function a k a tan sigmoid at the hidden layer and the linear activation function at the output layer were found to be suitable in the development of the ann models a computer program written in matlab was developed for ann simulations in this study the input variables for these models were identified on the basis of autocorrelation function acf and partial autocorrelation pacf values between the spi at the time step t and the corresponding lagged spis the plots of acf and pacf for various spi series shown in fig 6 suggest that all the spis at time step t are in a good correlation with their immediate lagged value i e with time step t 1 therefore only one input variable was selected for the prediction of all the spis i e spi3 spi6 spi9 and spi12 with an ann architecture of 1 n 1 the optimum numbers of neurons n in the hidden layer of these models were determined using a trial and error procedure separately for each spi for this purpose the number of neurons in the hidden layer was varied from 1 to 15 and the resulting architectures were trained using lm algorithm the best architectures for ann models developed for predicting spis were selected on the basis of various error statistics such as aare r and rmse from different trial values of lm parameters known as damping factors µ their increasing and decreasing factors the values of µ 0 001 µdec 0 1 µinc 10 and µmax 1010 were found to be the best to train the ann models for forecasting various spis in this study the objective function was kept as mean square error mse the stopping criteria for training of all the models was kept as 50 000 as the maximum number of iterations or mse as 0 0001 whichever is achieved earlier the best architectures for spi3 spi6 spi9 and spi12 were thus obtained as 1 12 1 1 7 1 1 4 1 and 1 8 1 respectively in this study the spi12 is found to be the best suited index for one month ahead drought forecasting refer to section 5 and thus only spi12 is considered for the development of drought classification models and knowledge extraction analysis in rest of this study but similar study can be conducted using spi for any other assessment period also depending upon the need of the project in the last step of developing the dccc model the continuous output in terms of one month ahead spi12 obtained from the ann model at the output layer was discretized to convert it into drought class using the previously described drought classification table table 2 in terms of seven drought classes ew vw mw nr md sd and ed the performance of dccc model was evaluated using confusion matrix between the target and the forecasted drought classes and compared with other drought classification models developed in this study 4 2 dccd model development in the development of dccd model the continuous values of spi12 at time step t 1 and discretized drought class in binary form at time step t were used as input and target variables respectively to train the ann model the model can be mathematically expressed as follows 1 spi 12 d t f spi 12 c t 1 where spi12d t and spi12c t 1 are the discretized and continuous data at time steps t and t 1 respectively the drought classification table table 2 was used to discretize the target data three layered ann consisting of one input layer one hidden layer and one output layer was used to develop dccd model the skeleton of ann architecture which is to be explored is obtained as 1 n 7 where n is the number of hidden neurons in the hidden layer there are seven target output attributes one each for seven different drought classes ew vw mw nr md sd and ed the meaning of the binary form of the drought classes is that in any one binary target output string one outcome class must have a value of one and rest will be zero since at a time drought spi12 will lie only in one of the seven classes the ann used in dccd model is similar to that used for the spi forecasting model except for the activation function used at hidden and output layers and a mechanism to convert the continuous outputs which is in the range of 0 to 1 into binary format for continuous to binary conversion the position of the highest element in the output vector was used to obtain the drought class by using a matlab function vec2ind in contrast to the spi forecasting models sigmoid activation function at both hidden and output layers was found to be the best combination of activation functions for dccd model development the number of neurons in the hidden layer n was varied from 1 to 15 and the resulting ann architectures were trained using lm algorithm the confusion value c which is the fraction of samples misclassified was calculated for all the 15 architectures the architecture for which the confusion value was obtained to be the least during training was selected as the best dccd model the values of lm parameters used in developing the dccc model were found suitable for the development of dccd model also c during training for various architectures as shown in fig 7 a indicates that the architecture having seven hidden neuron 1 7 7 is the best architecture for dccd model used for further comparison of various drought classification models developed in this study 4 3 dcdd model development in dcdd model development the discretized class of spi12 at time steps t 1 and t were used as input and target variables respectively each input and target string has seven attributes each represents one of the seven different drought classes with binary outcomes i e 0 or 1 the drought of a particular month in terms of input target instance must lie in one of the seven drought classes and therefore one outcome of the seven attributes will have a value of 1 and rest will be 0 the model can be mathematically expressed as follows 2 spi 12 d t f spi 12 d t 1 where spi12d t and spi12d t 1 are the discretized spi12 at time steps t and t 1 respectively the process of discretization of data and the ann network used in dcdd model were same as used in the dccd model except for the activation function used at hidden and output layers in contrast to ann used in dccd model hyperbolic tangent activation function was found to be the best at both hidden and output layers in dcdd model development among all other combinations of activation functions following the similar procedure for finding optimum ann architecture among 7 n 7 where n is the number of hidden neurons in the hidden layer 7 3 7 ann model was found to be the best architecture as it is least misclassifying the target data in terms of confusion value shown in fig 7 b 4 4 dt model development the dt model is developed using the same input and target values which were used in the development of dccd model and therefore the continuous values of spi12 at time step t 1 and discretized drought class in binary form at time step t were used as input and target variables respectively the mckee classification table table 2 was used to discretize the target data for development of the dt model waikato environment for knowledge analysis weka data mining system version 3 6 13 developed by the university of waikato new zealand was utilized by inducting the c4 5 decision tree algorithm after selection of the input and target of dt model the parameters m and c were determined using a trial and error procedure various trial values of m and c were tried and the values 2 and 0 25 respectively were found to be suitable in development of the dt model in this study the performance of the dt model was evaluated using confusion matrix cm between the target and the forecasted drought classes and compared with other drought classification models developed in this study 5 discussion of results on drought classification models the results in terms of various error statistics obtained from four ann models for forecasting spi3 spi6 spi9 and spi12 during both training and testing data sets are presented in table 3 it is worth mentioning here that the table does not compare one model with the other model but shows the performances of ann models in predicting spis of shorter and longer assessment periods from table 3 it is clear that ann model performance in forecasting short term spi spi3 was reasonable with the values of error statistics during training are under acceptable limits the performance of ann model in forecasting medium term spis spi6 was good and in forecasting spi9 was found to be very good in terms of all error statistics during training the performance of ann model in forecasting spi for longer assessment period i e spi12 was found to be excellent during training with higher values of r 0 928 e 0 861 ts10 26 4 ts50 70 2 ts100 84 3 and lower value of rmse 0 137 it is also worth mentioning here that the performance of the ann models in forecasting spis improves with increase in the assessment period the performance during testing of these models follows the similar trend as that during training i e the ann model for forecasting the spi3 was reasonable spi6 was good spi9 was very good and spi12 was excellent the results obtained in terms of the statistical analysis are supported by the graphical representation of the results also by visualizing the scatter plots and the corresponding time series plots during testing shown in fig 8 and fig 9 respectively fig 8 shows that the ann model for prediction of spis continuously reaching perfection in matching the ideal line with the increase in the assessment period and in this way the spi12 matches the ideal line extremely well the time series plots during testing shown in fig 9 are plotted for the period of 1987 to 1994 for clear visualization of the model performances in terms of mapping various spi series and it is clear from these figures that the ann model moves towards perfection in matching spi3 spi6 spi9 to spi12 from the above analysis the spi12 is the best suited index for one month ahead drought forecasting and selected for the development of drought classification models i e dccc dccd dcdd and dt models and knowledge extraction analysis the performances of dccc dccd dcdd and dt models for forecasting the drought classes are analyzed during both training and testing data sets using the cm between target and the forecasted drought classes the procedure for calculating various components of the cm is discussed earlier out of the total 708 data points in target drought class on the basis of spi12 420 data points were used for training and rest of the 288 data points were used for testing all the drought classification models developed in this study the number of the target drought classes in various categories in all training and testing sets are presented in table 4 the results obtained from dccc model in terms of confusion matrix are shown in fig 10 a and b for training and testing respectively as shown in fig 10 a out of a total of 12 ew 14 vw 53 mw 268 nr 57 md and 16 sd events in the training data set the dccc model predicted them 11 8 36 250 37 and 9 times correctly with true positive rates of 91 7 57 1 67 9 93 3 64 9 and 56 3 respectively all 11 ew events predicted by dccc model were actually of ew class in the target data with 100 precision or positive predictive value ppv likewise out of total 12 vw predictions 8 66 7 of 12 were vw while rest 4 were of ew or mw 33 3 of 12 in the target data the values of ppv for rest of the events are shown in the last column of cm of fig 10 a although the prediction rate for vw and sd events were reasonable the overall accuracy of dccc model during training was 83 6 which shows its good performance in drought class forecasting out of a total of 45 ew 25 vw 53 mw 155 nr 6 md and 4 sd events in testing data set the dccc model predicted them 38 13 32 138 3 and 3 times correctly with true positive rates of 84 4 52 0 60 4 89 0 50 0 and 75 0 respectively as shown in fig 10 b the overall accuracy of dccc model was found to be 78 8 during testing which shows its good performance in drought class forecasting the confusion matrices during training and testing for dccd model are shown in fig 11 a and b respectively as shown in fig 11 a out of a total of 12 ew 14 vw 53 mw 268 nr 57 md and 16 sd events in training data set the dccd model predicted them 11 6 36 243 39 and 8 times correctly with true positive rates of 91 7 42 9 67 9 90 7 68 4 and 50 0 respectively out of a total of 13 ew predictions by dccd model 11 84 5 were actually of ew class and rest of the 2 15 4 were one each from vw and mw in the target data likewise out of total 10 vw predictions 6 60 0 were vw while rest 4 was of ew and mw 40 in target data the values of ppv for rest of the events are shown in the last column of confusion matrix of fig 11 a although the prediction rate for vw events was fair 42 9 and that of sd events reasonable 50 the overall accuracy of dccd model during training 81 7 was good nearly similar performance was observed during testing of dccd model as shown in fig 11 b where out of a total of 45 ew 25 vw 53 mw 155 nr 6 md and 4 sd events in testing data set the dccd model predicted them 41 10 30 135 3 and 3 times correctly with true positive rates of 91 1 40 0 56 6 87 1 50 0 and 75 0 respectively the overall accuracy of dccd model during testing was found to be 77 1 the confusion matrices during training and testing for dcdd model are shown in fig 12 a and fig 12 b respectively as shown in fig 12 a out of a total of 12 ew 14 vw 53 mw 268 nr 57 md and 16 sd events in training data set the dcdd model predicted them 11 7 34 236 38 and 9 times correctly with true positive rates of 91 7 50 0 64 2 88 1 66 7 and 56 3 respectively out of a total of 12 ew predictions by dcdd model 11 91 7 were actually of ew class and 1 8 3 was from vw in the target data set likewise out of total 14 vw predictions 7 50 0 were vw while rest 7 were of ew and mw 50 in target data set the overall accuracy of dcdd model during training was 79 8 out of a total of 45 ew 25 vw 53 mw 155 nr 6 md and 4 sd events in testing data set the dcdd model predicted them 38 10 31 135 3 and 3 times correctly with true positive rates of 84 4 40 0 58 5 87 1 50 0 and 75 0 respectively during testing with an overall accuracy of 76 4 the confusion matrices during training and testing for dt model are shown in fig 13 a and b respectively from fig 13 a out of a total of 12 ew 14 vw 53 mw 268 nr 57 md and 16 sd events in training set the dt model predicted them 12 5 36 239 46 and 8 times correctly with true positive rates of 100 35 7 67 9 89 2 80 7 and 50 respectively with an overall accuracy of 82 4 out of a total of 45 ew 25 vw 53 mw 155 nr 6 md and 4 sd events in testing data set the dt model predicted them 41 3 26 139 3 and 3 times correctly with true positive rates of 91 1 12 49 1 89 7 50 0 and 75 0 respectively during testing with an overall accuracy of 74 7 for comparing the performances of dccc dccd dcdd and dt models in forecasting drought classes accuracy in terms of the correct classification was assessed table 5 where the best classification rates are marked in bold font it is clear from the table that all the ann drought classification models forecasted ew events with similar performance rate of 91 7 during training although the performance of dccd model in forecasting the md events was slightly better than other ann models its performance was found to be reasonable in forecasting the vw and sd events during training the dccc and dcdd models forecasted the sd events with similar performance rate of 56 3 during training for forecasting the drought events dccc model was found to be the best for almost all drought events except for md event during training the overall accuracy in terms of the correct classification was found to be the best for dccc model with 83 6 during training during testing all the models forecasted the md and sd events similarly with 50 and 75 correct classification rates respectively the dccd model forecasted the ew events the best during testing but poor in forecasting vw events the overall accuracy was found to be the best for the dccc model during testing as well with 78 8 of correct classification rate comparing the performance of the best ann model i e dccc model with dt model from table 5 it is observed that the overall performance of the dt model is comparable with dccc model during training but the overall performance of the dt model during testing is the least among all the drought forecasting models moreover the dt model forecasted the vw events with a poor accuracy rate of 35 7 and 12 during training and testing respectively possibly due to the occurrence of information loss while implementing the discretization at the inner layers while ann model development and in dt model development the performance of forecasting the drought class by the dccd dcdd and dt models reduced from the dccc model where the data discretization was implemented at the last stage after development of ann model after comparison of these models the dccc model which forecasted drought classes the best was selected for the knowledge extraction analysis 6 knowledge extraction using decision tree the knowledge inherent in the data of the physical process gets embedded in an ann during its training process and it is acquired in the form of its massively parallel architecture and the weight parameters moreover the outputs from ann models are obtained using all the information and knowledge about the physical processes acquired during training therefore the techniques that can be adopted for knowledge extraction from trained ann models would use either the internal architecture or using input output relationship obtained from ann without using internal architecture and viewing ann as a black box some of the earlier attempts in knowledge extraction used internal architecture to illustrate that the hidden neurons of an optimum ann architecture represent specific process of the overall physical process wilby et al 2003 sudheer and jain 2004 jain and kumar 2009 while some other studies extracted the knowledge in terms of rules without using internal architecture of trained ann models in the field of science and technology other than hydrology benitez et al 1997 castro et al 2002 mantas et al 2006 the methods of extracting knowledge using internal architecture of ann are more suitable for function approximation type of problems in this study one of the comprehensible classification techniques known as decision tree has been induced to extract the knowledge in terms of rules without using internal architecture of trained ann hydrologic model the knowledge obtained from function approximation problems are limited to visualization purposes only as the direct use of the deciphered knowledge is difficult to utilize in operational hydrology however the knowledge deciphered for classification problem in this study can be easily utilized in the operational hydrology the ann is known for its accuracy while decision tree is highly comprehensible and provides better interpretability of its classification few researches have compared accuracy of ann with decision tree techniques in function approximation type of hydrologic problems and found that the accuracy of ann is better than decision tree bhattacharya and solomatine 2005 tsai et al 2012 and even performance increases further when the output attribute has several classes kim 2008 elshorbagy et al 2010 compared various data driven modeling techniques including ann and m5 model tree and reported that in highly nonlinear cases the anns are more successful than m5 model tree a brief description of the decision tree is provided earlier and the methodology adopted for knowledge extraction is presented here in the present study the ann training and knowledge extraction using decision tree phases are used in a sequential manner for generating accurate classification rules for this purpose decision tree is extracted from the previously developed best ann model for forecasting future drought class i e dccc model the same weka data mining system used earlier was utilized for induction of c4 5 algorithm in this analysis also the inputs and outputs of the dccc model were used as the inputs and the targets for decision tree induction fig 14 presents the schematic diagram of the complete procedure starting from the ann training and ending with the rule extraction using the decision tree technique where spi12c t 1 and spi12c t are the continuous spi12 at time step t 1 and t used as input and target during the development of dccc model the sp i 1 2 d t on the other hand is the modeled discretized drought classes in terms of ew vw mw nr md sd and ed at time step t from dccc model the decision tree extracted from dccc model named as dt dccc takes continuous spi12c t 1 data as input data of discretized drought classes sp i 1 2 d t as target and produces the sp i 1 2 d t as outputs in discretized form after selection of the input and target of dt dccc model the parameters m and c were determined using trial and error procedure various trial values of m and c were tried and the values 2 and 0 25 respectively were found to be suitable in development of decision tree in this analysis also the classification performance of decision tree dt dccc is then assessed by using components of confusion matrix between its output classes and the output classes of dccc model the predicted class obtained from dccc model contains a total of 11 ew 12 vw 55 mw 288 nr 43 md 11 sd events in training and a total of 45 ew 21 vw 52 mw 163 nr 4 md 3 sd events in testing data sets the results obtained from dt dccc in terms of confusion matrix are shown in fig 15 a and fig 15 b during training and testing respectively as shown in fig 15 a out of a total of 11 ew 12 vw 55 mw 288 nr 43 md and 11 sd events in training data set the dt dccc predicted them 11 11 55 288 43 and 11 times correctly with 100 true positive rates for all these events except for vw where the correct classification rate was found to be 91 7 the overall accuracy of dt dccc model during training was 99 8 which shows that the dt extracted from the dccc model classifies the dccc output data with perfect matching the dt dccc model performed excellently during testing also as shown in fig 15 b where out of a total of 45 ew 21 vw 52 mw 163 nr 4 md 3 sd events in testing data set the dt dccc predicted them 45 17 52 161 4 and 3 times correctly with 100 true positive rates for all these events except for vw and nr where the correct classification rates were found as 81 and 98 8 respectively the overall accuracy during testing of dt dccc was 97 9 the accuracy achieved by the decision tree dt dccc model in classifying the data of dccc model was found to be excellent and shows the resemblance of the model with its counterpart the next step is to generate the definite rules obtained from dt dccc model learned by dccc model during its training the decision tree extracted from dccc model is shown in fig 16 which contains a total of six leaves in the tree any leaf of the decision tree can be converted into a rule by combining the logical sequences from the root node to that leaf for example the rule 1 for ew event is obtained by combining the logical expressions from root node to leaf 1 i e by combining the logical expressions spi12 t 1 1 0336 spi12 t 1 1 6915 and spi12 t 1 1 9495 the first rule thus obtained is if spi12 t 1 1 9495 then ew the physical meaning of this rule is as follows if the value of spi12 for current month is greater than 1 9495 then the dccc model will predict that the next month will be extremely wet from table 6 it can be observed from the six rules that if the ranges of the spi12 for the current month are 1 6915 spi12 1 9495 1 0336 spi12 1 6915 1 1835 spi12 1 0336 1 745 spi12 1 1835 and spi12 1 745 then the next month will observe very wet moderately wet near normal moderately dry severely dry and extremely dry conditions respectively the accuracy of each rule was assessed by using the raw data of gwb sub basin for training and testing sets which were used in dccc model development and are presented in the last two columns of table 6 looking at these results it is clear that the accuracies of the rules for ew and nr events are extremely good when tested on the raw data of gwb sub division for both training and testing sets the accuracy is very good in the case of md events for both training and testing sets while for sd events the accuracies are good and perfect for training and testing sets respectively the accuracies for the vw and mw events on the other hand are reasonable when tested on both training and testing sets from this table it is clear that the extracted rules are able to predict the drought events from the raw data of gwb sub division with acceptable accuracies during both training and testing which can be used as a simple drought forecasting tool it is also important to compare the accuracy of rules obtained from dt dccc model with dt model for this purpose the rules obtained from the dt model developed on the raw gwb data set in section 5 are presented in table 7 it can be seen from table 7 that for the same gwb data the dt model created 7 rules with 2 different rules for mw event while dt dccc created 6 rules for 6 different drought categories the accuracy of rules for ew and nr events is very good from both dt dccc and dt models and comparable with each other during both training and testing the accuracy of rule for md event is also very good for both dt dccc and dt models and is comparable during training but it is good 75 for dt dccc model compared to reasonable 50 in case of dt model during testing the accuracy of rule for mw event for dt model is marginally better than dt dccc model during training while it is vice versa during testing the accuracy of the rules for vw and sd events for dt dccc model is far better than dt model during both training and testing from this analysis it is clear that the accuracies of rules from dt dccc model are either comparable or better than the accuracies of rules from dt model the dccc model which uses ann technique was not able to provide any explanation about how ann arrives at a certain result or output the proposed methodology which involves dt on the other hand provides the explanation capacity of ann by extraction of the knowledge from them using decision tree which makes ann more comprehensible validation and implementation of extracted rules the calculation of spi is dependent only on rainfall data in a region and does not use any other information of the region for which it is calculated therefore the rules which are extracted using spi12 employing the rainfall data of one region may be applicable for drought forecasting of other regions also keeping this in mind the forecasting accuracies of the rules extracted for gangetic west bengal sub division were assessed in five other meteorological sub divisions namely jharkhand jh orissa or bihar bh eastern madhya pradesh emp and western rajasthan wr of india for this purpose the spi12 was first calculated by using the rainfall data obtained from iitm pune for jh or bh emp and wr sub divisions for the years 1949 to 1987 the basic statistics of rainfall data and their corresponding spi12 for the gwb training set and for other sub divisions presented in table 8 indicate different rainfall pattern in these regions the continuous values of spi12 t of these sub divisions were then discretized into seven different drought classes ew vw mw nr md sd ed and sd using the same mckee drought classification table table 2 the number of the data under various drought categories in gwb training set and five other meteorological sub divisions data set is presented in table 9 total of 456 data points of each of the sub divisions were used for the verification of the extracted rules the extracted rules from dt dccc model obtained for the data of gwb sub division given in table 6 were applied to the data prepared for different sub divisions one by one and accuracy in terms of correct classification was calculated and are presented in table 10 from table 10 it can be seen that the performance of rules applying on jharkhand sub division is very good for vw nr and sd with accuracy of 80 0 84 7 and 84 0 respectively while it is good for ew mw and md with accuracy of 72 2 76 7 and 62 5 respectively the performance of rules applying on orissa sub division is 100 accurate for vw very good for ew nr and sd with accuracy of 84 6 90 3 and 90 0 respectively while it is moderate for mw and md with accuracy of 53 3 and 48 3 respectively the performance of rules applying on bihar sub division is very good for nr and sd with accuracy of 90 4 and 83 good for ew and vw with accuracy of 75 and 66 7 respectively reasonable for mw with accuracy 43 3 and poor for md event with accuracy of 32 4 for both eastern madhya pradesh and western rajasthan sub divisions the performance of rules for vw nr and sd are very good moderate for md event moderate and good for mw event for emp and wr sub divisions respectively the performances of rules for different categories are under acceptable limit for all the sub divisions except for ew event for emp and wr sub divisions which can be attributed to the less number of data in ew category in these sub divisions in all the sub divisions the accuracy of sd includes ed events also as there was no separate rule for ed event extracted from the gwb data previously from the above results it is clear that the rules extracted from the trained ann drought model for one region may be applicable to other region with varied but acceptable accuracy based on the above discussion the procedure for the implementation of definite rules on any new region for drought forecasting can be presented by the simple flow chart as shown in fig 17 7 conclusions this paper presents the findings of a study carried out with the aim of extracting knowledge from a trained ann model exclusively for classification type of problems in hydrology using decision tree as a tool a new approach is proposed in which the ann training and knowledge extraction using decision tree phases were applied in a sequential manner for generating accurate classification rules from trained ann model for forecasting future drought class using standard precipitation index spi following are the conclusions drawn from the study i the ann technique is capable of forecasting one month ahead drought index in terms of spi for different assessment periods and the model performance is improved as the assessment period of spi increased from 3 months to 12 months ii the ann drought classification model based on continuous input and continuous targets performed better than the ann drought classification model based on continuous input and discretized targets or discretized inputs and discretized targets iii the best ann drought class forecasting model performed better than the dt model iv it is possible to extract the knowledge in terms of simple rules from trained ann drought classification model using decision tree technique the obtained extracted rules are simply a set of current month s spi values which states the next month s drought severity conditions v there are definite rules which are learned by the ann models during their training by which they acquire particular results to solve a specific problem also the decision tree technique is potentially capable of improving the comprehensibility of the trained ann models by extracting the rules from them vi these extracted rules are very simple easily implementable and can be used as the drought forecasting tool in a drought management activity for operation and management of water resources system vii the performance of forecasting future drought classes in the raw data of gangetic west bengal sub division was excellent for most of the extracted rules from trained ann model viii the validation results from other contrasting regions show that the extracted rules for one region are reasonably suitable for drought assessment of other regions too it is hoped that this study will provide a platform from where to launch an extensive research initiative focusing on the knowledge extraction of trained ann models for the classification problems which will go a long way in removing the reluctance in their use and establishing the anns to be powerful and comprehensible tools of modeling and forecasting water resources systems credit authorship contribution statement vikas kumar vidyarthi conceptualization methodology software data curation validation formal analysis writing original draft visualization investigation writing review editing ashu jain supervision declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgement the data used in this work was obtained freely from the indian institute of tropical meteorology pune http www1 tropmet res in static page php page id 53 and is duly acknowledged the computational facility provided by the department of civil engineering iit kanpur to carry out this research is also duly acknowledged appendix a supplementary data supplementary data to this article can be found online at https doi org 10 1016 j jhydrol 2020 124804 appendix a supplementary data the following are the supplementary data to this article supplementary data 1 
5557,artificial neural networks anns are one of the most widely used techniques for solving a variety of problems including classification and function approximation type of problems however the use of anns in hydrology is limited to academics and research and hydrologists policymakers are skeptical to use the anns in operational hydrology especially where a premium is placed on the comprehensibility of the systems this is probably because of the perceived black box nature of the anns as they do not provide an insight into their learning process or elucidation of obtaining a particular result since a long time researchers have been trying to improve the comprehensibility of trained ann models by knowledge extraction for improving their reliability and acceptability among the decision makers for operation purposes there are few such attempts in hydrology particularly for ann models developed for function approximation problems such as flow forecasting and evaporation estimation in this paper a novel approach is proposed that is capable of extracting knowledge from trained ann models for classification type of problems in hydrology this is achieved by extracting knowledge in terms of rules by inducing a decision tree using input output relation of a trained ann model for forecasting drought classes with standardized precipitation index for indian meteorological sub divisions the reported researches on knowledge extraction in hydrology is primarily been for the function approximation type of problems however the present approach is fundamentally different from them and useful for knowledge extraction exclusively for classification problems in hydrology the findings of this research indicate that definite rules are learned by ann models during their training to forecast a specific drought class these extracted rules are simple easily implementable and can be used as the drought class forecasting tool in a drought management activity the results suggest that due to the nature of the drought index used the rules extracted from one region may be suitable for drought monitoring of other regions keywords drought classification standard precipitation index artificial neural network decision tree knowledge extraction water resources 1 introduction the artificial neural networks anns possess proven ability in solving many complex real world problems including function approximation and classification type of problems in spite of their popularity among the hydrologists and researchers the anns have not been adopted as operational tools for hydrological modeling in solving real life problems in hydrology one of the major reasons for the anns not being adopted as operational tools may be the perception that they are not able to explain the physical behavior of the process being modeled and viewed rather skeptically due to their black box nature see et al 2008 jain and kumar 2009 maier and dandy 2000 dawson and wilby 2001 and maier et al 2010 constantly stressed the need to increase model transparency and enable knowledge to be extracted from the trained anns in the applications of solving various hydrological problems the knowledge extraction ke is a commonly adopted term for those methods which offer the end user an insight into either the process by which an ann has arrived at a given result or in general the totality of knowledge actually embedded therein tickle et al 1998 the ke tools for function approximation and classification type of problems can be quite different although a plethora of ann applications are available in hydrology the hydrologists have not endeavored to construe the knowledge embedded in the trained ann models jain et al 2004 except for a few research attempts to extract the knowledge from trained ann models for function approximation type of problems in hydrology and mainly on rainfall runoff modeling wilby et al 2003 jain et al 2004 sudheer and jain 2004 sudheer 2005 kingston et al 2006 jain and kumar 2009 londhe and shah 2017a b in the reported researches simple graphical and statistical methods have only been explored for knowledge extraction of trained ann hydrological models recently chen et al 2018 designed a 2 d topological bubble map to visualize the interactive mechanism between surface water and groundwater over the river basin while using self organizing map a type of ann however such methods are not suitable for knowledge extraction from ann models developed for classification applications in applied hydrology some of the studies on knowledge extraction have been reported on classification problems in various fields of science and technology other than hydrology where the knowledge in terms of rules was extracted from the trained ann models to enhance the comprehensibility of the ann models using more comprehensible techniques such as fuzzy rule based systems formal concept analysis ant colony optimization particle swarm optimization etc benitez et al 1997 castro et al 2002 mantas et al 2006 zarate et al 2008 ozbakir et al 2010 and ozbakir and delice 2011 the adaptive network based fuzzy inference system and decision tree techniques are used widely for function approximation problems in hydrology londhe and dixit 2012 chang and tsai 2016 zhou et al 2019 and have a potential to one of the best classifiers a decision tree dt which is a decision support tool known for highly comprehensible classifier among data driven techniques has been used for ke by few of researchers in the field other than hydrology schmitz et al 1999 dancey et al 2007 the dt generated by c4 5 algorithm quinlan 1993 is used for solving classification problems dt is the most widely used tool in practice as aclassifier xindong et al 2008 witten et al 2011 as it has ability to deal with missing values of attribute continuous and discrete attributes and can check the overfitting by involving pruning step during its development however the dt in hydrology is used mostly for simulation of regression type of hydrological problems mostly for rainfall runoff process using m5 model tree solomatine and dulal 2003 bhattacharya and solomatine 2005 londhe and dixit 2012 and have never been used for classification problems and their ke in hydrology there are several classification type of problems in hydrology that are routinely encountered by hydrologists and scientists while dealing with various real world hydrologic processes such as rainfall occurrence drought classification flood categorization etc valdes and sastri 1989 paulo et al 2005 paulo and pereira 2007 and therefore research is needed as the knowledge extraction from such models is still a new research area in this study we attempt to extract the knowledge from the trained ann model in one of the most challenging classification problems in hydrology i e drought class forecasting drought is one of the hydrologic extremes often referred to as a creeping phenomenon and an insidious hazard which creates a water scarce situation affecting many socio economical sectors demanding high water supply such as agricultural ecological municipal and industrial sectors as per the federal emergency management agency federal emergency management agency 1995 a typical drought costs american farmers and businesses 6 8 billion dollars each year more than damages incurred from floods and hurricanes the consequences tend to be far more severe in areas where there is scarcity of well developed planning for natural hazards and the agriculture is the major economic driver such as in india therefore the proper assessment and monitoring system of drought is essentially required to mitigate the impacts of drought there are several methods used as drought quantification tool e g simple measurement of rainfall deficit stream flow shortage and various drought indices dis however dis have been the most commonly used tools for drought forecasting in operational hydrology because the drought index is expressed as numbers which is believed to be far more functional than the raw data during decision making hayes 2003 and also it is able to quantify the drought for different time scales though the yearly and monthly time scales are mostly used time scales the monthly time scale is more appropriate for monitoring the effects of a drought in situations related to agriculture water supply and ground water abstractions panu and sharma 2002 some of the most commonly used dis are the palmer drought severity index pdsi palmer 1965 which needs precipitation and temperature data crop moisture index cmi palmer 1968 which needs weekly values of temperature and precipitation data surface water supply index swsi shafer and dezman 1982 which needs snow water content stream flow rainfall and storage reservoir volume data standardized precipitation index spi mckee et al 1993 1995 and percent of normal pn hayes 2003 which need only precipitation data the multivariate drought indices hao and singh 2015 such as aggregated drought index adi keyantash and dracup 2004 and the drought index based on data fusion and integration azmi et al 2016 azmi et al 2017 azmi and rüdiger 2018 are some of the recently developed drought indices which needs all significant hydrometeorological variables within the hydrologic cycle however the rainfall based dis are more widely used than the other dis due to fewer input data requirements flexibility and simplicity in calculations mishra and singh 2010 the use of statistical and data driven techniques in drought forecasting began in mid of 20th century yevjevich 1967 rao and padmanabhan 1984 mishra and desai 2005 cancelliere et al 2007 modarres 2007 fernandez et al 2009 durdu 2010 han et al 2010 beyaztas and yaseen 2019 xu et al 2018 but the anns became popular in the development of drought forecasting models in the 21st century kim and valdes 2003 started the use of ann in drought forecasting using pdsi while mishra and desai 2006 has used the spi series first time in development of ann drought forecasting model in the kansabati river basin india and reported that the ann models can be very useful for local administrations and water resource planners in continuation mishra et al 2007 developed a hybrid model by combining linear stochastic model and nonlinear ann model for forecasting droughts in the same basin using spi series later many researchers used anns for forecasting various drought indices morid et al 2007 barros and bowden 2008 ochoa rivera 2008 cutore et al 2009 jamshidi et al 2011 barua et al 2012 santos et al 2014 maca and pech 2016 recently kisi et al 2019 used various heuristic methods for drought forecasting in most of the works discussed here the magnitude of one of the drought indices has been forecasted though the objective may lie in forecasting the future drought class in terms of drought severity for forecasting drought class the markov chain models have been largely utilized by many researchers gabriel and neumann 1962 lohani and loganathan 1997 lohani et al 1998 paulo et al 2005 paulo and pereira 2007 cancelliere et al 2007 besides markov chain models other data driven models have also been explored by few researchers paulo et al 2005 moreira et al 2006 moreira et al 2008 and kavalieratou et al 2012 used log linear modeling approach to forecast drought class transition probabilities the use of atmospheric patterns such as el nino southern oscillation enso and the north atlantic oscillation nao in drought class forecasting has been explored by chen et al 2013 and bonaccorso et al 2015 based on probabilistic approaches though anns are known to be one of the best classifiers they have not been explored so far for drought class forecasting anns have a potential to forecast the drought class but it needs to be explored this paper proposes a methodology for extraction of knowledge from the trained ann drought class forecasting model using comprehensible technique known as decision tree the specific objectives of this paper are to i develop ann models for drought forecasting using standard precipitation index ii employ anns to characterize drought in future as the classification type of problem iii extract rules from the trained ann drought classification model using dt to establish simple rules for drought forecasting and monitoring the monthly rainfall data in mm derived from one of the meteorological subdivisions in india i e gangetic west bengal are employed to test the methodologies proposed in this paper the paper starts with a brief description of the tools and techniques employed in this study the description of the study area and the data employed are then presented before describing the procedure for model development for future drought severity a detailed description of the procedure for knowledge extraction is then discussed the obtained results are discussed next before making concluding remarks 2 tools and techniques the modeling tools and techniques employed to carry out the investigations in this study include the standard precipitation index spi ann and the dt three layered an input layer one hidden layer and an output layer feed forward neural network trained with back propagation ffbp using levenberg marquartd lm algorithm is used in this study hagan and menhaj 1994 hagan et al 1996 a brief overview about the spi and its procedure for calculation and the dt technique is presented next 2 1 standard precipitation index the spi proposed by mckee et al 1993 which is based on the long term precipitation record for a desired period is used as drought assessment tool in this study it is an index to categorize the severity of a drought due to rainfall deficit locally or globally the spi was used in this study because it is based on rainfall data alone so the drought assessment is possible where even other hydrometeorological measurements are not available also it has a variable time scale and is thus conducive to monitor short term water supplies such as soil moisture which is important for agricultural production and long term water resources such as groundwater supplies stream flow and lake and reservoir levels hayes et al 1999 mishra et al 2007 moreover many researchers have advocated the use of spi over other drought indices while using it in different hydroclimatic conditions guttman 1998 hayes et al 1999 hughes and saunders 2002 it is also recommended to use the spi when there is at least 30 years of monthly rainfall data available keyantash 2018 the procedure for the computation of spi suggested by mckee et al 1993 and guttman 1999 can be briefly summarized in the following steps 1 the rainfall record of a long term time any base time may be chosen depending on the time scale of interest is fitted with a probability distribution generally by gamma distribution as it fits the rainfall time series well sonmez et al 2005 2 after fitting the probability distribution the cumulative probability of an observed rainfall is computed 3 the inverse normal gaussian function with mean zero and variance one is then applied to the cumulative probability distribution function which results in the spi 2 2 decision tree a decision tree is a decision support tool known for highly comprehensible classifier among data driven techniques iterative dichotomiser 3 id3 quinlan 1986 classification and regression tree cart breiman et al 1984 c4 5 quinlan 1993 and m5 model trees m5 quinlan 1992 are some of the algorithms for generating dt for the problems related to classification clustering and regression the dt generated by c4 5 algorithm has been used for knowledge extraction from ann hydrologic models in this study the c4 5 algorithm builds decision trees from a set of training data using the concept of divide and conquer or top down induction the advantage of c4 5 is that it can handle both continuous and discrete attributes handle training data with missing values of the attributes and can check for the over fitting issue during their training using method of pruning as shown in fig 1 the tree starts growing from the root node which is one of the input attributes and further gets divided into two sub nodes by the process of splitting a sub node can further split into either a decision node or a leaf node the node which stops splitting further are called leaf nodes and represent the final outcome in terms of decision the class in which the feature should lie a decision node can further split into a leaf or decision node the process ends when the c4 5 algorithm results into leaf nodes only representing class es the training data set s consists of already classified samples s 1 s 2 s 3 s i each sample s i consists of a d dimensional vector x 1 i x 2 i x j i x d i where x j i represent the attribute values orfeaturesof the sample as well as the class in which s i falls at every node of the tree the c4 5 algorithm chooses the attribute that most effectively splits its set of samples into subsets enriched in one class or the other the splitting criterion adopted by c4 5 algorithm is the normalizedinformation gainor the gain ratio which is robust and results in small trees quinlan 1993 the gain ratio is calculated on the basis of entropy of information shannon 1940 which is used to measure how informative is a node the attribute with the highest gain ratio is chosen to make the decision the c4 5 algorithm then recursively moves to the partitioned sub nodes the recursion of the algorithm stops when any of the following three criteria is reached 1 all the samples in the set belong to the same class this criterion simply creates a leaf node in the decision tree indicating to choose that class 2 if c4 5 cannot find a test that results in at least two outcomes having a minimum number of examples case parameter m in the leaf osei bryson 2007 3 finally if the list of candidate tests available to use at a node is empty this process often produces over elaborate trees namely over fitting that must be checked after developing the tree c4 5 algorithm simplifies it by pruning away various sub trees and replacing them with leaves to avoid over fitting it considers replacing each internal node by either a leaf or one of the node s branches in order to decide whether a change should be made c4 5 computes a confidence interval around the re substitution error rate of the node a change is made to a sub tree if the resulting re substitution error rate for the modified sub tree is within a c confidence interval of the error rate of unmodified sub tree the parameter c determines how conservative the pruning process should be and can be established by trial and error method the m for the leaf and c of c4 5 algorithm are problem specific and need to be determined separately for different problems more details of the c4 5 algorithm for developing dt can be found in witten et al 2011 2 3 model selection and performance evaluation the model selection and performance evaluation of various spi forecasting models were done using combination of different standard statistical measures average absolute relative error aare pearson coefficient of correlation r nash sutcliffe efficiency e root mean square error rmse and threshold statistics ts which are commonly employed error statistics their detailed description can be found elsewhere jain and indurthy 2003 chidthong et al 2009 the performance of drought classification models on the other hand was assessed using confusion matrix kohavi and provost 1998 and percentage of correct classification the confusion matrix is a standard tool for evaluating model performances for classification problems and widely employed by the machine learning community it contains information about actual and predicted classifications done by a classification system the performance of such systems is commonly evaluated using the data in the n by n matrix where n is the number of classes fig 2 shows a confusion matrix for a two class classifier where entries tp true positive and fp false positive in the confusion matrix are the number of correct and incorrect predictions that an instance is positive while tn true negative and fn false negative are the number of correct and incorrect predictions that an instance is negative on the basis of the entries tp fp tn and fn indices such as sensitivity or true positive rate tpr miss rate or false negative rate fnr specificity or true negative rate tnr fall out or false positive rate fpr precision or positive predictive value ppv false discovery rate fdr negative predictive value npv false omission rate for and accuracy acc can be calculated and given in fig 2 as obvious the values of ppv npv tpr tnr and acc closer to 100 from a model indicate the best performance accuracy of the model 3 study area and data monthly precipitation data from the gangetic west bengal gwb meteorological subdivision of india obtained from indian institute of tropical meteorology iitm pune available at www tropmet res in for 60 years period 1951 2010 were employed in this study fig 3 shows the map of gwb meteorological sub division which consists of 13 major districts of west bengal with a total area of 66 228 km2 2 3 of the total area of india this entire sub division contains a total of eleven rain gauge stations for which the spatial mean of the rainfall data is available the total data are divided into two sets 36 years for training set from 1951 to 1986 and 24 years for testing set from 1987 to 2010 the basic descriptive statistics of the rainfall data are presented in table 1 spi calculation a matlab code was developed using procedure mentioned earlier for the computation of spi the outcomes from the developed code were verified by those obtained from available open source software called as spi sl 6 nmdc developed by university of nebraska lincoln usa the kolgomorov smirnov and chi square test statistics suggest that the monthly rainfall series used in this study follows a gamma distribution the running series of total rainfall corresponding to 3 6 9 and 12 months was fitted with the gamma distribution and the corresponding spis spi3 spi6 spi9 and spi12 respectively were calculated the spi series for different time scales so obtained are shown in fig 4 mckee s drought categorization chart proposed by mckee et al 1993 to define drought intensities resulting from the spi values given in table 2 which has been used by many researchers hayes et al 1999 mishra et al 2007 is used in this study for discretization of spi series into seven different drought categories the discretization filter to convert drought index to drought class is shown in fig 5 4 model development for forecasting drought severity in the previous researches the ann models are developed to predict the abnormality of rainfall magnitude in terms of various drought indices and not in terms of the drought class severity the prediction of the future drought conditions in terms of its severity such as severe moderate normal etc would be desirable for many water resources applications some of them are agricultural and municipal water management for this purpose three ann models were developed for forecasting one month ahead drought class dc using three different strategies in enforcing discretization of data at various levels of model development in this study in the first strategy an ann model was developed using continuous inputs and continuous targets in second strategy an ann model was developed using continuous inputs and discretized targets and in the last strategy an ann model was developed using discretized inputs and discretized targets the enforcement of the discretization of data at various levels during model development was investigated to assess its effect on the model performance in forecasting future drought class the names assigned for these models are as follows dccc drought classification using continuous inputs and continuous targets dccd drought classification using continuous inputs and discretized targets dcdd drought classification using discretized inputs and discretized targets as mentioned earlier the spi was discretized by using popular drought classification table given by mckee et al 1993 to compare the performance of the ann drought classification models decision tree model is also developed the development of the three ann models and dt model is presented next 4 1 dccc model development the dccc model was developed in two steps in the first step ann model was developed for forecasting one month ahead spi using the past spi data and in the second step the discretization was enforced at the output level using drought classification table in the first step four ann models were developed for forecasting spi3 spi6 spi9 and spi12 the ann models developed in this study consist of three layers input hidden and output and are trained using levenberg marquardt lm algorithm hagan and menhaj 1994 hagan et al 1996 as spis are both negative and positive real values the hyperbolic tangent function a k a tan sigmoid at the hidden layer and the linear activation function at the output layer were found to be suitable in the development of the ann models a computer program written in matlab was developed for ann simulations in this study the input variables for these models were identified on the basis of autocorrelation function acf and partial autocorrelation pacf values between the spi at the time step t and the corresponding lagged spis the plots of acf and pacf for various spi series shown in fig 6 suggest that all the spis at time step t are in a good correlation with their immediate lagged value i e with time step t 1 therefore only one input variable was selected for the prediction of all the spis i e spi3 spi6 spi9 and spi12 with an ann architecture of 1 n 1 the optimum numbers of neurons n in the hidden layer of these models were determined using a trial and error procedure separately for each spi for this purpose the number of neurons in the hidden layer was varied from 1 to 15 and the resulting architectures were trained using lm algorithm the best architectures for ann models developed for predicting spis were selected on the basis of various error statistics such as aare r and rmse from different trial values of lm parameters known as damping factors µ their increasing and decreasing factors the values of µ 0 001 µdec 0 1 µinc 10 and µmax 1010 were found to be the best to train the ann models for forecasting various spis in this study the objective function was kept as mean square error mse the stopping criteria for training of all the models was kept as 50 000 as the maximum number of iterations or mse as 0 0001 whichever is achieved earlier the best architectures for spi3 spi6 spi9 and spi12 were thus obtained as 1 12 1 1 7 1 1 4 1 and 1 8 1 respectively in this study the spi12 is found to be the best suited index for one month ahead drought forecasting refer to section 5 and thus only spi12 is considered for the development of drought classification models and knowledge extraction analysis in rest of this study but similar study can be conducted using spi for any other assessment period also depending upon the need of the project in the last step of developing the dccc model the continuous output in terms of one month ahead spi12 obtained from the ann model at the output layer was discretized to convert it into drought class using the previously described drought classification table table 2 in terms of seven drought classes ew vw mw nr md sd and ed the performance of dccc model was evaluated using confusion matrix between the target and the forecasted drought classes and compared with other drought classification models developed in this study 4 2 dccd model development in the development of dccd model the continuous values of spi12 at time step t 1 and discretized drought class in binary form at time step t were used as input and target variables respectively to train the ann model the model can be mathematically expressed as follows 1 spi 12 d t f spi 12 c t 1 where spi12d t and spi12c t 1 are the discretized and continuous data at time steps t and t 1 respectively the drought classification table table 2 was used to discretize the target data three layered ann consisting of one input layer one hidden layer and one output layer was used to develop dccd model the skeleton of ann architecture which is to be explored is obtained as 1 n 7 where n is the number of hidden neurons in the hidden layer there are seven target output attributes one each for seven different drought classes ew vw mw nr md sd and ed the meaning of the binary form of the drought classes is that in any one binary target output string one outcome class must have a value of one and rest will be zero since at a time drought spi12 will lie only in one of the seven classes the ann used in dccd model is similar to that used for the spi forecasting model except for the activation function used at hidden and output layers and a mechanism to convert the continuous outputs which is in the range of 0 to 1 into binary format for continuous to binary conversion the position of the highest element in the output vector was used to obtain the drought class by using a matlab function vec2ind in contrast to the spi forecasting models sigmoid activation function at both hidden and output layers was found to be the best combination of activation functions for dccd model development the number of neurons in the hidden layer n was varied from 1 to 15 and the resulting ann architectures were trained using lm algorithm the confusion value c which is the fraction of samples misclassified was calculated for all the 15 architectures the architecture for which the confusion value was obtained to be the least during training was selected as the best dccd model the values of lm parameters used in developing the dccc model were found suitable for the development of dccd model also c during training for various architectures as shown in fig 7 a indicates that the architecture having seven hidden neuron 1 7 7 is the best architecture for dccd model used for further comparison of various drought classification models developed in this study 4 3 dcdd model development in dcdd model development the discretized class of spi12 at time steps t 1 and t were used as input and target variables respectively each input and target string has seven attributes each represents one of the seven different drought classes with binary outcomes i e 0 or 1 the drought of a particular month in terms of input target instance must lie in one of the seven drought classes and therefore one outcome of the seven attributes will have a value of 1 and rest will be 0 the model can be mathematically expressed as follows 2 spi 12 d t f spi 12 d t 1 where spi12d t and spi12d t 1 are the discretized spi12 at time steps t and t 1 respectively the process of discretization of data and the ann network used in dcdd model were same as used in the dccd model except for the activation function used at hidden and output layers in contrast to ann used in dccd model hyperbolic tangent activation function was found to be the best at both hidden and output layers in dcdd model development among all other combinations of activation functions following the similar procedure for finding optimum ann architecture among 7 n 7 where n is the number of hidden neurons in the hidden layer 7 3 7 ann model was found to be the best architecture as it is least misclassifying the target data in terms of confusion value shown in fig 7 b 4 4 dt model development the dt model is developed using the same input and target values which were used in the development of dccd model and therefore the continuous values of spi12 at time step t 1 and discretized drought class in binary form at time step t were used as input and target variables respectively the mckee classification table table 2 was used to discretize the target data for development of the dt model waikato environment for knowledge analysis weka data mining system version 3 6 13 developed by the university of waikato new zealand was utilized by inducting the c4 5 decision tree algorithm after selection of the input and target of dt model the parameters m and c were determined using a trial and error procedure various trial values of m and c were tried and the values 2 and 0 25 respectively were found to be suitable in development of the dt model in this study the performance of the dt model was evaluated using confusion matrix cm between the target and the forecasted drought classes and compared with other drought classification models developed in this study 5 discussion of results on drought classification models the results in terms of various error statistics obtained from four ann models for forecasting spi3 spi6 spi9 and spi12 during both training and testing data sets are presented in table 3 it is worth mentioning here that the table does not compare one model with the other model but shows the performances of ann models in predicting spis of shorter and longer assessment periods from table 3 it is clear that ann model performance in forecasting short term spi spi3 was reasonable with the values of error statistics during training are under acceptable limits the performance of ann model in forecasting medium term spis spi6 was good and in forecasting spi9 was found to be very good in terms of all error statistics during training the performance of ann model in forecasting spi for longer assessment period i e spi12 was found to be excellent during training with higher values of r 0 928 e 0 861 ts10 26 4 ts50 70 2 ts100 84 3 and lower value of rmse 0 137 it is also worth mentioning here that the performance of the ann models in forecasting spis improves with increase in the assessment period the performance during testing of these models follows the similar trend as that during training i e the ann model for forecasting the spi3 was reasonable spi6 was good spi9 was very good and spi12 was excellent the results obtained in terms of the statistical analysis are supported by the graphical representation of the results also by visualizing the scatter plots and the corresponding time series plots during testing shown in fig 8 and fig 9 respectively fig 8 shows that the ann model for prediction of spis continuously reaching perfection in matching the ideal line with the increase in the assessment period and in this way the spi12 matches the ideal line extremely well the time series plots during testing shown in fig 9 are plotted for the period of 1987 to 1994 for clear visualization of the model performances in terms of mapping various spi series and it is clear from these figures that the ann model moves towards perfection in matching spi3 spi6 spi9 to spi12 from the above analysis the spi12 is the best suited index for one month ahead drought forecasting and selected for the development of drought classification models i e dccc dccd dcdd and dt models and knowledge extraction analysis the performances of dccc dccd dcdd and dt models for forecasting the drought classes are analyzed during both training and testing data sets using the cm between target and the forecasted drought classes the procedure for calculating various components of the cm is discussed earlier out of the total 708 data points in target drought class on the basis of spi12 420 data points were used for training and rest of the 288 data points were used for testing all the drought classification models developed in this study the number of the target drought classes in various categories in all training and testing sets are presented in table 4 the results obtained from dccc model in terms of confusion matrix are shown in fig 10 a and b for training and testing respectively as shown in fig 10 a out of a total of 12 ew 14 vw 53 mw 268 nr 57 md and 16 sd events in the training data set the dccc model predicted them 11 8 36 250 37 and 9 times correctly with true positive rates of 91 7 57 1 67 9 93 3 64 9 and 56 3 respectively all 11 ew events predicted by dccc model were actually of ew class in the target data with 100 precision or positive predictive value ppv likewise out of total 12 vw predictions 8 66 7 of 12 were vw while rest 4 were of ew or mw 33 3 of 12 in the target data the values of ppv for rest of the events are shown in the last column of cm of fig 10 a although the prediction rate for vw and sd events were reasonable the overall accuracy of dccc model during training was 83 6 which shows its good performance in drought class forecasting out of a total of 45 ew 25 vw 53 mw 155 nr 6 md and 4 sd events in testing data set the dccc model predicted them 38 13 32 138 3 and 3 times correctly with true positive rates of 84 4 52 0 60 4 89 0 50 0 and 75 0 respectively as shown in fig 10 b the overall accuracy of dccc model was found to be 78 8 during testing which shows its good performance in drought class forecasting the confusion matrices during training and testing for dccd model are shown in fig 11 a and b respectively as shown in fig 11 a out of a total of 12 ew 14 vw 53 mw 268 nr 57 md and 16 sd events in training data set the dccd model predicted them 11 6 36 243 39 and 8 times correctly with true positive rates of 91 7 42 9 67 9 90 7 68 4 and 50 0 respectively out of a total of 13 ew predictions by dccd model 11 84 5 were actually of ew class and rest of the 2 15 4 were one each from vw and mw in the target data likewise out of total 10 vw predictions 6 60 0 were vw while rest 4 was of ew and mw 40 in target data the values of ppv for rest of the events are shown in the last column of confusion matrix of fig 11 a although the prediction rate for vw events was fair 42 9 and that of sd events reasonable 50 the overall accuracy of dccd model during training 81 7 was good nearly similar performance was observed during testing of dccd model as shown in fig 11 b where out of a total of 45 ew 25 vw 53 mw 155 nr 6 md and 4 sd events in testing data set the dccd model predicted them 41 10 30 135 3 and 3 times correctly with true positive rates of 91 1 40 0 56 6 87 1 50 0 and 75 0 respectively the overall accuracy of dccd model during testing was found to be 77 1 the confusion matrices during training and testing for dcdd model are shown in fig 12 a and fig 12 b respectively as shown in fig 12 a out of a total of 12 ew 14 vw 53 mw 268 nr 57 md and 16 sd events in training data set the dcdd model predicted them 11 7 34 236 38 and 9 times correctly with true positive rates of 91 7 50 0 64 2 88 1 66 7 and 56 3 respectively out of a total of 12 ew predictions by dcdd model 11 91 7 were actually of ew class and 1 8 3 was from vw in the target data set likewise out of total 14 vw predictions 7 50 0 were vw while rest 7 were of ew and mw 50 in target data set the overall accuracy of dcdd model during training was 79 8 out of a total of 45 ew 25 vw 53 mw 155 nr 6 md and 4 sd events in testing data set the dcdd model predicted them 38 10 31 135 3 and 3 times correctly with true positive rates of 84 4 40 0 58 5 87 1 50 0 and 75 0 respectively during testing with an overall accuracy of 76 4 the confusion matrices during training and testing for dt model are shown in fig 13 a and b respectively from fig 13 a out of a total of 12 ew 14 vw 53 mw 268 nr 57 md and 16 sd events in training set the dt model predicted them 12 5 36 239 46 and 8 times correctly with true positive rates of 100 35 7 67 9 89 2 80 7 and 50 respectively with an overall accuracy of 82 4 out of a total of 45 ew 25 vw 53 mw 155 nr 6 md and 4 sd events in testing data set the dt model predicted them 41 3 26 139 3 and 3 times correctly with true positive rates of 91 1 12 49 1 89 7 50 0 and 75 0 respectively during testing with an overall accuracy of 74 7 for comparing the performances of dccc dccd dcdd and dt models in forecasting drought classes accuracy in terms of the correct classification was assessed table 5 where the best classification rates are marked in bold font it is clear from the table that all the ann drought classification models forecasted ew events with similar performance rate of 91 7 during training although the performance of dccd model in forecasting the md events was slightly better than other ann models its performance was found to be reasonable in forecasting the vw and sd events during training the dccc and dcdd models forecasted the sd events with similar performance rate of 56 3 during training for forecasting the drought events dccc model was found to be the best for almost all drought events except for md event during training the overall accuracy in terms of the correct classification was found to be the best for dccc model with 83 6 during training during testing all the models forecasted the md and sd events similarly with 50 and 75 correct classification rates respectively the dccd model forecasted the ew events the best during testing but poor in forecasting vw events the overall accuracy was found to be the best for the dccc model during testing as well with 78 8 of correct classification rate comparing the performance of the best ann model i e dccc model with dt model from table 5 it is observed that the overall performance of the dt model is comparable with dccc model during training but the overall performance of the dt model during testing is the least among all the drought forecasting models moreover the dt model forecasted the vw events with a poor accuracy rate of 35 7 and 12 during training and testing respectively possibly due to the occurrence of information loss while implementing the discretization at the inner layers while ann model development and in dt model development the performance of forecasting the drought class by the dccd dcdd and dt models reduced from the dccc model where the data discretization was implemented at the last stage after development of ann model after comparison of these models the dccc model which forecasted drought classes the best was selected for the knowledge extraction analysis 6 knowledge extraction using decision tree the knowledge inherent in the data of the physical process gets embedded in an ann during its training process and it is acquired in the form of its massively parallel architecture and the weight parameters moreover the outputs from ann models are obtained using all the information and knowledge about the physical processes acquired during training therefore the techniques that can be adopted for knowledge extraction from trained ann models would use either the internal architecture or using input output relationship obtained from ann without using internal architecture and viewing ann as a black box some of the earlier attempts in knowledge extraction used internal architecture to illustrate that the hidden neurons of an optimum ann architecture represent specific process of the overall physical process wilby et al 2003 sudheer and jain 2004 jain and kumar 2009 while some other studies extracted the knowledge in terms of rules without using internal architecture of trained ann models in the field of science and technology other than hydrology benitez et al 1997 castro et al 2002 mantas et al 2006 the methods of extracting knowledge using internal architecture of ann are more suitable for function approximation type of problems in this study one of the comprehensible classification techniques known as decision tree has been induced to extract the knowledge in terms of rules without using internal architecture of trained ann hydrologic model the knowledge obtained from function approximation problems are limited to visualization purposes only as the direct use of the deciphered knowledge is difficult to utilize in operational hydrology however the knowledge deciphered for classification problem in this study can be easily utilized in the operational hydrology the ann is known for its accuracy while decision tree is highly comprehensible and provides better interpretability of its classification few researches have compared accuracy of ann with decision tree techniques in function approximation type of hydrologic problems and found that the accuracy of ann is better than decision tree bhattacharya and solomatine 2005 tsai et al 2012 and even performance increases further when the output attribute has several classes kim 2008 elshorbagy et al 2010 compared various data driven modeling techniques including ann and m5 model tree and reported that in highly nonlinear cases the anns are more successful than m5 model tree a brief description of the decision tree is provided earlier and the methodology adopted for knowledge extraction is presented here in the present study the ann training and knowledge extraction using decision tree phases are used in a sequential manner for generating accurate classification rules for this purpose decision tree is extracted from the previously developed best ann model for forecasting future drought class i e dccc model the same weka data mining system used earlier was utilized for induction of c4 5 algorithm in this analysis also the inputs and outputs of the dccc model were used as the inputs and the targets for decision tree induction fig 14 presents the schematic diagram of the complete procedure starting from the ann training and ending with the rule extraction using the decision tree technique where spi12c t 1 and spi12c t are the continuous spi12 at time step t 1 and t used as input and target during the development of dccc model the sp i 1 2 d t on the other hand is the modeled discretized drought classes in terms of ew vw mw nr md sd and ed at time step t from dccc model the decision tree extracted from dccc model named as dt dccc takes continuous spi12c t 1 data as input data of discretized drought classes sp i 1 2 d t as target and produces the sp i 1 2 d t as outputs in discretized form after selection of the input and target of dt dccc model the parameters m and c were determined using trial and error procedure various trial values of m and c were tried and the values 2 and 0 25 respectively were found to be suitable in development of decision tree in this analysis also the classification performance of decision tree dt dccc is then assessed by using components of confusion matrix between its output classes and the output classes of dccc model the predicted class obtained from dccc model contains a total of 11 ew 12 vw 55 mw 288 nr 43 md 11 sd events in training and a total of 45 ew 21 vw 52 mw 163 nr 4 md 3 sd events in testing data sets the results obtained from dt dccc in terms of confusion matrix are shown in fig 15 a and fig 15 b during training and testing respectively as shown in fig 15 a out of a total of 11 ew 12 vw 55 mw 288 nr 43 md and 11 sd events in training data set the dt dccc predicted them 11 11 55 288 43 and 11 times correctly with 100 true positive rates for all these events except for vw where the correct classification rate was found to be 91 7 the overall accuracy of dt dccc model during training was 99 8 which shows that the dt extracted from the dccc model classifies the dccc output data with perfect matching the dt dccc model performed excellently during testing also as shown in fig 15 b where out of a total of 45 ew 21 vw 52 mw 163 nr 4 md 3 sd events in testing data set the dt dccc predicted them 45 17 52 161 4 and 3 times correctly with 100 true positive rates for all these events except for vw and nr where the correct classification rates were found as 81 and 98 8 respectively the overall accuracy during testing of dt dccc was 97 9 the accuracy achieved by the decision tree dt dccc model in classifying the data of dccc model was found to be excellent and shows the resemblance of the model with its counterpart the next step is to generate the definite rules obtained from dt dccc model learned by dccc model during its training the decision tree extracted from dccc model is shown in fig 16 which contains a total of six leaves in the tree any leaf of the decision tree can be converted into a rule by combining the logical sequences from the root node to that leaf for example the rule 1 for ew event is obtained by combining the logical expressions from root node to leaf 1 i e by combining the logical expressions spi12 t 1 1 0336 spi12 t 1 1 6915 and spi12 t 1 1 9495 the first rule thus obtained is if spi12 t 1 1 9495 then ew the physical meaning of this rule is as follows if the value of spi12 for current month is greater than 1 9495 then the dccc model will predict that the next month will be extremely wet from table 6 it can be observed from the six rules that if the ranges of the spi12 for the current month are 1 6915 spi12 1 9495 1 0336 spi12 1 6915 1 1835 spi12 1 0336 1 745 spi12 1 1835 and spi12 1 745 then the next month will observe very wet moderately wet near normal moderately dry severely dry and extremely dry conditions respectively the accuracy of each rule was assessed by using the raw data of gwb sub basin for training and testing sets which were used in dccc model development and are presented in the last two columns of table 6 looking at these results it is clear that the accuracies of the rules for ew and nr events are extremely good when tested on the raw data of gwb sub division for both training and testing sets the accuracy is very good in the case of md events for both training and testing sets while for sd events the accuracies are good and perfect for training and testing sets respectively the accuracies for the vw and mw events on the other hand are reasonable when tested on both training and testing sets from this table it is clear that the extracted rules are able to predict the drought events from the raw data of gwb sub division with acceptable accuracies during both training and testing which can be used as a simple drought forecasting tool it is also important to compare the accuracy of rules obtained from dt dccc model with dt model for this purpose the rules obtained from the dt model developed on the raw gwb data set in section 5 are presented in table 7 it can be seen from table 7 that for the same gwb data the dt model created 7 rules with 2 different rules for mw event while dt dccc created 6 rules for 6 different drought categories the accuracy of rules for ew and nr events is very good from both dt dccc and dt models and comparable with each other during both training and testing the accuracy of rule for md event is also very good for both dt dccc and dt models and is comparable during training but it is good 75 for dt dccc model compared to reasonable 50 in case of dt model during testing the accuracy of rule for mw event for dt model is marginally better than dt dccc model during training while it is vice versa during testing the accuracy of the rules for vw and sd events for dt dccc model is far better than dt model during both training and testing from this analysis it is clear that the accuracies of rules from dt dccc model are either comparable or better than the accuracies of rules from dt model the dccc model which uses ann technique was not able to provide any explanation about how ann arrives at a certain result or output the proposed methodology which involves dt on the other hand provides the explanation capacity of ann by extraction of the knowledge from them using decision tree which makes ann more comprehensible validation and implementation of extracted rules the calculation of spi is dependent only on rainfall data in a region and does not use any other information of the region for which it is calculated therefore the rules which are extracted using spi12 employing the rainfall data of one region may be applicable for drought forecasting of other regions also keeping this in mind the forecasting accuracies of the rules extracted for gangetic west bengal sub division were assessed in five other meteorological sub divisions namely jharkhand jh orissa or bihar bh eastern madhya pradesh emp and western rajasthan wr of india for this purpose the spi12 was first calculated by using the rainfall data obtained from iitm pune for jh or bh emp and wr sub divisions for the years 1949 to 1987 the basic statistics of rainfall data and their corresponding spi12 for the gwb training set and for other sub divisions presented in table 8 indicate different rainfall pattern in these regions the continuous values of spi12 t of these sub divisions were then discretized into seven different drought classes ew vw mw nr md sd ed and sd using the same mckee drought classification table table 2 the number of the data under various drought categories in gwb training set and five other meteorological sub divisions data set is presented in table 9 total of 456 data points of each of the sub divisions were used for the verification of the extracted rules the extracted rules from dt dccc model obtained for the data of gwb sub division given in table 6 were applied to the data prepared for different sub divisions one by one and accuracy in terms of correct classification was calculated and are presented in table 10 from table 10 it can be seen that the performance of rules applying on jharkhand sub division is very good for vw nr and sd with accuracy of 80 0 84 7 and 84 0 respectively while it is good for ew mw and md with accuracy of 72 2 76 7 and 62 5 respectively the performance of rules applying on orissa sub division is 100 accurate for vw very good for ew nr and sd with accuracy of 84 6 90 3 and 90 0 respectively while it is moderate for mw and md with accuracy of 53 3 and 48 3 respectively the performance of rules applying on bihar sub division is very good for nr and sd with accuracy of 90 4 and 83 good for ew and vw with accuracy of 75 and 66 7 respectively reasonable for mw with accuracy 43 3 and poor for md event with accuracy of 32 4 for both eastern madhya pradesh and western rajasthan sub divisions the performance of rules for vw nr and sd are very good moderate for md event moderate and good for mw event for emp and wr sub divisions respectively the performances of rules for different categories are under acceptable limit for all the sub divisions except for ew event for emp and wr sub divisions which can be attributed to the less number of data in ew category in these sub divisions in all the sub divisions the accuracy of sd includes ed events also as there was no separate rule for ed event extracted from the gwb data previously from the above results it is clear that the rules extracted from the trained ann drought model for one region may be applicable to other region with varied but acceptable accuracy based on the above discussion the procedure for the implementation of definite rules on any new region for drought forecasting can be presented by the simple flow chart as shown in fig 17 7 conclusions this paper presents the findings of a study carried out with the aim of extracting knowledge from a trained ann model exclusively for classification type of problems in hydrology using decision tree as a tool a new approach is proposed in which the ann training and knowledge extraction using decision tree phases were applied in a sequential manner for generating accurate classification rules from trained ann model for forecasting future drought class using standard precipitation index spi following are the conclusions drawn from the study i the ann technique is capable of forecasting one month ahead drought index in terms of spi for different assessment periods and the model performance is improved as the assessment period of spi increased from 3 months to 12 months ii the ann drought classification model based on continuous input and continuous targets performed better than the ann drought classification model based on continuous input and discretized targets or discretized inputs and discretized targets iii the best ann drought class forecasting model performed better than the dt model iv it is possible to extract the knowledge in terms of simple rules from trained ann drought classification model using decision tree technique the obtained extracted rules are simply a set of current month s spi values which states the next month s drought severity conditions v there are definite rules which are learned by the ann models during their training by which they acquire particular results to solve a specific problem also the decision tree technique is potentially capable of improving the comprehensibility of the trained ann models by extracting the rules from them vi these extracted rules are very simple easily implementable and can be used as the drought forecasting tool in a drought management activity for operation and management of water resources system vii the performance of forecasting future drought classes in the raw data of gangetic west bengal sub division was excellent for most of the extracted rules from trained ann model viii the validation results from other contrasting regions show that the extracted rules for one region are reasonably suitable for drought assessment of other regions too it is hoped that this study will provide a platform from where to launch an extensive research initiative focusing on the knowledge extraction of trained ann models for the classification problems which will go a long way in removing the reluctance in their use and establishing the anns to be powerful and comprehensible tools of modeling and forecasting water resources systems credit authorship contribution statement vikas kumar vidyarthi conceptualization methodology software data curation validation formal analysis writing original draft visualization investigation writing review editing ashu jain supervision declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgement the data used in this work was obtained freely from the indian institute of tropical meteorology pune http www1 tropmet res in static page php page id 53 and is duly acknowledged the computational facility provided by the department of civil engineering iit kanpur to carry out this research is also duly acknowledged appendix a supplementary data supplementary data to this article can be found online at https doi org 10 1016 j jhydrol 2020 124804 appendix a supplementary data the following are the supplementary data to this article supplementary data 1 
5558,horizontal wells have gained considerable interest among petroleum engineers and hydrologists in the last decades many attempts were made to reach a better understanding of fluid flow behaviour inside the reservoir aquifer especially in the near wellbore regions in most of the previous studies on horizontal wells each well is treated as a volumetric source term in governing equations describing the fluid flow in the main reservoir aquifer many important features affecting the fluid flow such as the realistic wellbore geometry have been ignored for mathematical convenience in the present study the three dimensional single phase fluid flow through a large size reservoir block is coupled to wellbore flow through imposing the pressure and flux continuity at the reservoir well interface as the momentum equations the darcy and turbulent navier stokes equations are used in the reservoir block and wellbore respectively the governing equations are discretized on unstructured grids and solved by using the finite volume method using the computed pressure and velocity distributions the horizontal well characteristics are numerically estimated and compared with available analytic data for various cases it is shown that the calculated well index a coefficient in reflecting the geometric features of the well reservoir system deviates from its analytic value as a result of reservoir block boundary condition the pattern of the wellbore open intervals the horizontal well drilling path and its vertical eccentricity in addition the proposed approach is used to improve economides model an analytical model for horizontal well index by estimating its pseudo skin factor in various cases of the well vertical eccentricity horizontal orientation and reservoir block conditions keywords coupled free porous flow model turbulent wellbore flow influence radius of horizontal wells numerical well index nomenclature nomenclature a hw horizontal well drainage area m 2 a 1 area drained by the end of a horizontal well nearest the vertical section m 2 a 2 area drained along the horizontal length of the well m 2 a 3 area drained by the well tip m 2 l well horizontal length m k turbulent kinetic energy m 2 s 2 turbulent dissipation m 2 s 3 k absolute permeability tensor m 2 k xx permeability in x direction m 2 k yy permeability in y direction m 2 k k k max absolute permeability ratio k max the maximum absolute permeability md p bh well bottom hole pressure pa p r reservoir block pressure pa p w wellbore pressure pa p p r p bh p atm non dimensional pressure p p r r x p w r x p atm non dimensional pressure q volumetric flow rate of the production well m 3 s r radial distance m r r r max ratio of the radial distance to the maximum radial distance r w well radius m r ev vertical well equivalent radius m r eh horizontal well equivalent radius m w well index m 3 day bar w w w a dimensionless well index greek δ p l reservoir pressure difference and horizontal well head pa δ p 0 the pressure difference between reservoir and the horizontal well end pa δ p w l pressure drop in the horizontal well pa δ x block length m δ y block width m μ fluid viscosity pa s ρ fluid density kg m 3 φ wr the well potential defined as p r p w pa subscripts a analytic bh bottom hole h horizontal r reservoir v vertical w well abbreviations bc boundary condition cfd computational fluid dynamics oi open interval 1 introduction the simulation of fluid flow through petroleum reservoirs as well as aquifer plays a vital role in reservoir and groundwater engineering hydrologists as well as petroleum engineers have made extensive attempts to simulate fluid flow through the horizontal well reservoir systems the flow velocity in the reservoir rock is relatively low especially for the regions far from the drilling locations of production injection wells sun et al 2017 sun et al 2018 sun et al 2018 sun et al 2019 thus most of the numerical simulators usually use darcy s law to simulate the fluid flow inside the reservoir aquifer rock beside a proper well model for coupling of the reservoir conditions with the operating conditions of the wells williamson and chappelear 1981 a well model is a mathematical equation representing the mass flow rate of the reservoir fluid in the wellbore in terms of the difference between the reservoir and wellbore pressures by using a proportional coefficient named well index the well index incorporates the effects of some geometric features of wellbore and reservoir block as well as the rock permeability into the well model peaceman 1978 different mathematical models have been developed for describing the fluid flow through horizontal well reservoir aquifer systems having different applications in petroleum engineering palagi and aziz 1994 wolfsteiner et al 2000 wolfsteiner et al 2000 and hydrology park and zhan 2002 zhan and park 2002 sun and zhan 2006 wang and zhan 2017 park and zhan 2002 considered a finite diameter horizontal well inside an isotropic leaky aquifer and obtained the groundwater flow by incorporating the wellbore storage and the skin effects it has shown that skin effect and aquifer anisotropy considerably affect near well drawdown at the early flow time when compared with the solution of the line source zhan and park 2002 obtained the flow of horizontal well by solving the vapour flow to a point sink and superimposing the solution of the point sink along the well axial length in another study zhan and park 2003 they presented semi analytical solutions for three aquifer types of horizontal well hydraulics a leaky confined aquifer a leaky water table aquifer and a leaky aquifer under a water reservoir they concluded that drawdown is sensitive to the aquitard aquifer thickness ratio and the hydraulic conductivity ratio at the intermediate and later time sun and zhan 2006 linked the aquitard and the aquifer by imposing the flux and head continuity at their common interface they modelled the leakage as an internal boundary condition instead of the volumetric source in the governing equations known as the hantush s approximation and showed that this approximation provides a deviated solution during transient flow when compared with a solution based on actual leakage through the aquifer aquitard interface blumenthal and zhan 2016 derived a rapidly computed analytical solution for drawdown caused by a partially or fully penetrating directional wellbore vertical horizontal or slant via green s function method they optimized the solution for rapid computation via poisson resummation derivation of convergence rates and numerical optimization of integration techniques chen et al 2003 proposed a new approach to describe a finite diameter horizontal well and flow inside the pumping well jointly they applied a new treatment for in well hydraulics to eliminate the flux or head based boundary condition along the horizontal well wolfsteiner et al 2000 presented an approximate model for the production rate of unconventional wells in heterogeneous reservoirs and estimated the effect of well hydraulics and reservoir heterogeneity on the performance of unconventional wells wolfsteiner et al 2003 proposed a general approach for computing the index for unconventional wells in arbitrarily computational grids and applied it to both homogeneous and heterogeneous reservoir models they claimed that their proposed model can produce more accurate results than those of common well models used in commercial simulators in the recent decade the computational fluid dynamics cfd approach has been used as a powerful tool to simulate various complicated near wellbore flow problems based on a cfd approach byrne et al 2009 simulated the fluid flow in the vicinity of the wellbore region for a horizontal well and obtained the performance of the well in other studies bryne et al 2010 byrne et al 2011 presented a three dimensional model for the fluid flow near a vertical well which is fully connected to the reservoir and studied the effects of rock layer permeability on the near well pressure drop molina and tyagi 2015 numerically predicted the pressure drop and flow behaviour in the near wellbore region they compared the computed pressure drop with the analytic data to validate the proposed approach molina 2016 employed cfd to examine the production rate of a vertical gas well and estimated the well skin a parameter in an analytic well model they also investigated the effects of flow turbulence on a high production rate of the well szanyi et al 2018 examined a near well model for a horizontal well through the cfd they calculated the well mass flow rate under different reservoir conditions and obtained the effect of perforation patterns on the streamlines and also the pressure drop in the present work the single phase fluid flow through a typical block cell of a reservoir computational grid containing a horizontal well is simulated for the fluid production process the main objective is to describe the fluid flow behaviour inside the reservoir block connected to the horizontal well without using any well model this requires the simultaneous simulation of flow inside the reservoir block and the wellbore which is a challenging problem in terms of grid generation and solving the governing equations the reservoir block dimensions are very larger than the wellbore radius and the fluid flow velocity is very high in the wellbore region the well index and the drainage radius of the horizontal well are numerically estimated by using the obtained pressure and velocity fields under three different sets of block boundary conditions and three patterns for the well perforated regions open intervals including both full length and partially connected wells this work can have many applications in science and engineering such as recovery from hydrocarbon reservoirs and fluid flow in underground water resources based on the knowledge of the authors this is the first three dimensional cfd base simulation for the well reservoir flow problem without using any well model and its required assumptions which is used to estimate the well index and exhibiting the drainage influence volume of horizontal wells this approach simultaneously considers the effects of reservoir block boundary conditions pattern of the well open intervals the well drilling path and its eccentricity in an isotropic anisotropic reservoir block the numerical results of the proposed approach are finally used to estimate the proper values of the so called skin factor in the existing analytic well index models 2 problem definition in the production process the fluid flows through the reservoir enters the wellbore and then moves along the well axis toward the top surface of the reservoir a reservoir computational grid in general consists of a number of blocks cells which are usually large in size our problem is to simulate the single phase incompressible flow through a wellbore reservoir system this means that the production well is explicitly considered without using a well model the computational domain is a reservoir block containing a horizontal well according to fig 1 a constant pressure is imposed at the wellbore cross section located at the top surface of the reservoir block as this pressure is exerted at the bottom of the hole it is usually named well bottom hole pressure three sets of boundary conditions are applied on the faces of the block named as bc1 bc2 and bc3 the top view of the reservoir block with the aforementioned boundary conditions is shown in fig 2 the arrows and hatched lines represent the mass inflow and no flow boundaries respectively two faces of the block are under mass inflow condition in bc1 and bc2 while the flow enters only from one face which is perpendicular to the well horizontal axis in bc3 fig 2 in all cases the top and bottom faces of the reservoir block are supposed to be impermeable walls table 1 summarises the characteristics of the reservoir block the horizontal well and the fluid properties the geometric values are chosen based on the common size of a computational block and wellbore in petroleum reservoirs here a homogeneous reservoir rock with an isotropic absolute permeability tensor is assumed the horizontal part of the well is oriented in the reservoir block by an angle of θ as shown in fig 2 while for most cases θ 0 is considered the range of 30 θ 30 is used to study the fluid flow behaviour around the well in all cases it is assumed that the well is connected to the reservoir block through a set of open hole perforations three patterns for the open interval oi of the horizontal well are labelled as oi1 oi2 and oi3 as shown in fig 3 in oi1 the full length of the horizontal well is connected to the reservoir block fig 3a while one half of the well horizontal length is connected in oi2 and oi3 fig 3a to c 3 governing equations and mathematical models the described problem can numerically be simulated by solving the governing equations associated with the mass and momentum conservation laws dejam et al 2018 the reservoir block is a large size porous medium with relatively low flow velocity obeying darcy s law conversely the flow velocity through the wellbore is relatively high and the flow regime is practically turbulent therein in this region both axial and radial flows are dominant and therefore the navier stokes equations along with an appropriate turbulence model should be used to describe the fluid flow in the wellbore for other practical problems concerning the interaction between the channel and the porous medium one can refer to dejam 2019 dejam et al 2015 dejam 2018 in the following sections the governing equations for both wellbore and the reservoir block regions are explained in details 3 1 wellbore flow governing equations for turbulent incompressible steady state single phase flow in the wellbore the mass and momentum conservation equations can be written as wilcox 1998 1 u i x i 0 2 ρ u j u i x j p w x i x j μ u i x j u j x i ρ u i u j x j ρ g i 3 ρ u i u j μ t u i x j u j x i where the subscripts i and j denote the directions of the coordinate system the term x i is the position component p w is the wellbore pressure and u i stands for the flow velocity the parameter g i stands for the component of the gravitational acceleration in the direction i and ρ and μ are density and viscosity of fluid respectively according to the results of different turbulence models presented in asheim et al 1992 including the standard k model k ω model and reynolds stress model rsm the standard k turbulence model gives acceptable results regardless of its simplicity among the studied models azadi et al 2017 among these three turbulent models the k model is the most common two equation model that gives a general description of turbulence although it is not as complicated as rsm model it can describe fully turbulent flows more precisely than the k ω model which the latter model is more suitable for low reynolds turbulent flows with wall effects in the present work the k model is utilized to compute the turbulent flow properties in the wellbore region the transport equations for the standard k model are represented by wilcox 1998 4 ρ u i k x i x j μ μ t σ k k x j g k ρ 5 ρ u i x i x j μ μ t σ x j c 1 g k k c 2 ρ 2 k in which g k is the turbulent kinetic energy generation term denoting the production rate of k which is defined as g k μ t u i x j u j x i 2 the parameter μ t represents the eddy viscosity expressed as μ t ρ c μ k 2 in the k and equations σ k 1 and σ 1 3 are turbulent prandtl numbers and c μ 0 09 c 1 1 44 and c 2 1 92 are the model constants 3 2 reservoir block flow equations for a steady state single phase and incompressible flow through a rigid porous medium the mass conservation eq 1 is conveyed by darcy s law which is an alternative to the momentum equation the darcy velocity u r is represented in terms of the reservoir pressure gradient p r as chen et al 2006 6 u r k μ p r ρ g z where k is the absolute permeability tensor which is supposed to be homogeneous and isotropic and p r is the reservoir pressure also z and g are elevation and gravitational acceleration respectively 3 3 horizontal well model for a typical well completed in a single computational reservoir block peaceman model peaceman 1983 is a mathematical relation correlating the well potential p r p w with its flow rate q through the well index w as follows 7 q w p r p w the index of a well w can analytically be determined in terms of geometric properties of the reservoir block and the wellbore along with the components of the reservoir rock absolute permeability tensor mosharaf dehkordi and ghafouri 2018 various analytic well index models have been presented up to now such as the uniform flux babu and odeh 1989 and infinite conductivity models penmatcha and aziz 1998 in the first one it is assumed that the flux per unit length of the well is constant while no pressure drop along the wellbore is considered in infinite conductivity models these assumptions are only used for mathematical convenience however neither uniform flux nor no pressure drop in the wellbore assumptions do not happen in practice ozkan et al 1995 most of available analytic models are based on the 2 d flow assumption or 3 d flow is being decomposed into two 2 d problems like joshi s models joshi 1986 and there are limited 3 d well flow models ding 1996 uniform completion of the well in the reservoir block pseudo steady state flow and the alignment of the well drilling path with the principal permeability direction are the other applied assumptions in some well index models renard and dupuy 1991 zifei 1993 yeh and chang 2013 besides a fully radial flow is considered in aforementioned models however there exist some cases in which a fully radial flow cannot be achieved as an example no radial fluid flow may be observed around the wellbore due to its asymmetrical geometry and the boundary conditions of the reservoir block or even the existence of multiphase flow around the wellbore in the present study the main focus is on using the joshi horizontal well model in order to validate the presented numerical approach as well as studying the effective parameters on the well index value and drainage volume moreover deviations between numerically and analytically computed values of the horizontal well index at different cases are investigated using another analytic relation for well index called economides model these analytic well models are described in the next sections 3 3 1 joshi horizontal well model well index and drainage radius for a horizontal well completed in a cuboid reservoir block joshi s index is given by joshi 1986 8 w 2 π k h h μ ln a b h l ln bh r w b 1 for l bh where the subscripts h and v stand for horizontal and vertical directions respectively also a a a 2 l 2 2 0 5 l b k h k v 0 5 and a is expressed by joshi 1986 9 a l 2 1 2 1 4 1 0 5 l r eh 4 0 5 eq 8 is developed for a horizontal well drilled at the centre of the reservoir block in a vertical plane there exists a set of models considering the effect of the well vertical eccentricity with respect to the reservoir block centre such as the well model described in section 3 3 2 for a homogeneous rock the pressure distribution inside the reservoir block is pettersen 2006 10 p r p w q μ 2 π kh ln r r w s where r is the radial distance from the wellbore it is clear that r leads to infinite values for the reservoir pressure p which causes a non physical behaviour in fact a specific volume of the reservoir block is directly drained by the perforated regions of the well which is called drainage influence volume area the drainage region may be determined numerically or analytically in the numerical approach the computed pressure distribution around the wellbore is employed to estimate the drainage radius equivalent to the radius of influence in hydrology section 4 joshi 1986 proposed an analytic drainage radius for the horizontal well through the following methods as the first relation for the drainage area only geometric parameters are considered and the type of boundary conditions as well as the perforation patterns is neglected in the joshi s first method the drainage area is considered as a rectangle of length l along with two halves of a circle with radius r ev as shown in fig 4 a this surface of the drainage area a hw is equal to a hw π r ev 2 2 lr ev where l is the horizontal well length and r ev is the equivalent radius of a vertical well drilled in the reservoir block given by chen and zhang 2009 11 r ev 0 28 δ x 2 k yy k xx 0 5 δ y 2 k xx k yy 0 5 k yy k xx 0 5 k xx k yy 0 5 in the joshi s second method the drainage area is considered as an ellipse with two axes of sizes 2 a l 2 r ev and 2 b 2 r ev and area of a hw π ab as shown in fig 4b 3 3 2 economides horizontal well model economides et al 1996 proposed a general horizontal well model which can be applied for multi lateral wells with the laterals located in the same horizontal plane and also for the wells that their drilling direction is not parallel to the principal directions of the rock permeability tensor this model is developed based on infinite conductivity i e no pressure drop along the well axis and pseudo steady flow assumptions the well index is given by economides et al 1996 12 w k δ x μ p d s t p d δ x 2 π l s c δ xc h 4 π h where s t is an empirical constant named total skin factor considering the lumped effects of several aspects which are not directly considered in the developed well models the skin factor s t can consider the effects of turbulence possible wellbore damages non darcy flow and also flow convergence near the wellbore guo et al 2017 based on eq 12 the parameter p d is represented in terms of two geometric parameters s c and c h the first one is given by s c ln h 2 π r w h 6 l s e the effect of vertical eccentricity is incorporated into the model by using the parameter s e which is defined as s e h l 2 d z h 1 2 2 d z h 2 1 2 ln sin π d z h here d z is the minimum distance between the horizontal axis and horizontal boundaries of the reservoir block and h stands for the reservoir block thickness in the vertical direction the second parameter geometric parameters c h is given by a tabulated data in economides et al 1996 for limited cases of the well reservoir block dimensions and well configuration i e δ x δ y and l δ x for other possible cases it is necessary to approximate the c h value by interpolation between the available data of the mentioned table 4 solution methodology and some computational aspects the set of governing equations described in section 3 is solved numerically based on a cell centred finite volume approach here all of the flow variables are discretized by second order schemes and a set of internal conditions are imposed at the wellbore reservoir interface to couple the wellbore and reservoir flows these internal conditions provide connectivity of volumetric flux and pressure at the wellbore reservoir interface an implicit steady pressure based solver with absolute velocity formulation is used to solve the flow equations the pressure velocity coupling is achieved by using the semi implicit method for pressure linked equations simple algorithm that is a numerical procedure in the context of computational fluid dynamics which is extensively utilized to solve the navier stokes equations for details readers can refer to versteeg and malalasekera 2007 the convergence criterion specified tolerance within subsequent iterations for the mass velocity components turbulent kinetic energy and kinetic energy dissipation rate is set to 10 5 as the flow accelerate at the wellbore reservoir interface the special consideration should be taken into account to achieve accurate results an unstructured computational grid is generated for numerical computations with tetrahedral cells in the reservoir block and the boundary layer grid around the wellbore region two different slices x z and y z planes of the grid in the reservoir block can be seen in fig 5 to reduce the total number of computational cells the local grid refinement approach is employed and smaller cells in the near wellbore region are produced figs 5a and 5b in addition a set of under relaxation factors is also applied to speed up the convergence and improve the stability of the overall numerical solution process the under relaxation factors for the pressure and velocity components are 0 5 and 0 45 respectively under relaxation factor of 0 8 is utilized for both turbulent kinetic energy and turbulence dissipation energy to reduce the non linearity of the governing equations as turbulent flow is simulated and standard logarithmic wall function is utilized it is necessary to have special attention to the values of some turbulent flow parameters such as the wall coordinate parameter y wilcox 1998 this parameter is the dimensionless wall distance which can be interpreted as a local reynolds number defined as y yu t ν this means that y magnitude can be expected to determine the relative importance of viscous and turbulent processes here ν is the fluid kinematic viscosity and u t stands for the friction velocity defined as u t τ w ρ where τ w is the wall shear stress and ρ is the fluid density in each test case the wall coordinate parameter y on the computational cells adjacent to solid walls is checked to be remained in allowable range associated with the standard wall function all numerical results presented in section 5 are reported whenever grid independent results have been achieved 4 1 average pressure of the reservoir block and well drainage radius from the computational point of view the reservoir block is here represented by using a computational grid with a lot of computational cells by using the numerical results of the well reservoir flow problem i e the pressure and velocity fields associated with the reservoir and the wellbore it is possible to determine the well index numerically by a procedure presented in fig 6 to do this both of the wellbore and reservoir regions are divided into a specified number of segments n s each segment is bounded by two vertical planes which are perpendicular to the well axis the volumetric flux crossing the wellbore reservoir interface within each well segment is calculated by using the obtained velocity field in the form of q f l u f n da with l 1 n s here u u r u w represents the flow velocity at the wellbore reservoir interface associated with the segment l the total volumetric flux crossing the whole perforated length of the well is computed q wr l 1 n s q f l in the next step the wellbore average pressure for each well segment p w l is calculated then the reservoir average pressure in each reservoir segment p r l with l 1 n s is estimated for this purpose it is necessary to select a proper region around the wellbore within the reservoir segment in each vertical plane passing the well horizontal axis this region is generally introduced by an oval shape around the wellbore where its average pressure is nearly equal to the average pressure along its boundaries based on this point the average reservoir pressure in each segment is calculated through the numerically obtained pressure distribution a well potential for each well segment is defined by φ wr l p r l p w l the total value of the well potential φ wr is computed as the average value of the well segment potentials finally the numerical well index will be wi q wr φ wr l the drainage radius of the horizontal well is estimated based on calculated pressure distribution inside the reservoir block the reservoir pressure is reduced by moving along the radial direction measured with respect to the horizontal well axis the well drainage radius is the minimum radius where the radial component of the pressure gradient remains nearly constant accordingly it is possible to determine the drainage radius at any vertical plane across the horizontal axis of the well 5 numerical results and discussion to report the numerical results more effectively a number of dimensionless variables is introduced here a dimensionless pressure is defined as p p r p bh p atm where p bh is the well bottom hole pressure imposed as the boundary condition at a wellbore cross section located at a reference specific depth and p atm represents the atmospheric pressure here the top surface of the reservoir block is the reference depth as described in section 2 in addition the absolute permeability ratio and the well index ratio are defined as k k k max and w w w a respectively here k max is maximum rock permeability value among the considered values which is given in table 1 also w a is the analytic well index computed based on the joshi well model the dimensionless distance along the horizontal well axis is represented by x x l with l as the well total horizontal length fig 1 the numerical results are presented in the following sections in the first section the numerical results of the well index and non dimensional pressure distributions are compared to the analytic results in order to validate the numerical solution methodology in the second section the effects of block boundary conditions along with the well reservoir connection patterns on the calculated values of the well index and pressure distribution within the reservoir grid block are investigated in the third section first the radii of the drainage volume are estimated using obtained numerical solutions and also compared with those of analytic outputs in different cases then horizontal well drainage areas are illustrated at some selected slices of the reservoir block for different patterns of the well open intervals three dimensional drainage volumes of the horizontal well are illustrated using the pressure distribution inside the reservoir block finally the values of the pseudo skin factor utilized in the economides well model section 3 3 2 are estimated using cfd based well indices 5 1 validation of the numerical results to validate the proposed numerical methodology the well index is numerically estimated and compared with the analytic one which is computed by using the joshi model as discussed in section 3 3 the analytic index of a horizontal well is computed by eq 8 in terms of the geometric properties of the reservoir block and well along with the absolute permeability tensor the numerical well index can be computed in terms of the average reservoir block pressure and wellbore pressure using eq 7 considering a fully connected horizontal well drilled in a reservoir block with symmetric inflow boundary conditions with respect to the well horizontal axis the distribution of pressure in both reservoir block and wellbore regions is numerically determined then the average values of the wellbore pressure and reservoir block are computed section 4 1 and used to estimate the well index the obtained numerical results in comparison to the analytic ones are presented in figs 7a and 7 b as expected these results indicate that the well index value w increases and the block pressure p decreases by increasing the permeability values k in this case the difference between the numerical and analytic results is less than 3 for both p and w these results indicate that the analytic and numerical approaches produce similar solutions 5 2 block boundary conditions and the well open interval length the analytic well index is obtained based on a fully radial flow around the wellbore section 3 3 since the asymmetric boundary conditions may violate the condition of a symmetric and fully radial flow it is necessary to investigate the fluid flow behaviour inside the reservoir block with a set of asymmetric boundary conditions such as those introduced in section 2 the calculated values of the well index w and the pressure p for different boundary conditions bc1 bc2 and bc3 at oi1 oi2 and oi3 are compared with the analytic data joshi well model in figs 8 for different permeability values k ranging from 0 1 to 1 0 and three sets of boundary conditions the numerical index of the horizontal well with oi1 the full length connected well is plotted in fig 8a in this case the minimum and maximum difference between the numerical and analytic well index values is 6 for bc1 and 17 for bc3 respectively it can be seen that the numerical well index is always a bit larger than the analytic one this can be interpreted by considering the calculated block pressure which is always less than related analytic value according to eq 7 for a constant production rate q this results in a larger well index when compared to the analytic datum it should be noted that the main assumption of an analytic solution which is a fully radial flow in the reservoir block is not completely satisfied especially for bc2 and bc3 these results indicate that the reservoir block boundary conditions can generally affect the well index value which is not directly incorporated into analytic well index given by eq 8 for oi2 and different reservoir block boundary conditions the variation of the well index as well as the block average pressure is plotted versus the permeability values in figs 8c and 8d among the considered boundary conditions the minimum difference between the analytic and numerical well indices is observed for bc1 which changes from 18 to 22 depending on the permeability values the maximum well index deviation is some 30 which is related to bc3 like oi1 block boundary conditions affect the calculated well index values corresponding to oi2 considering fig 8d for different boundary conditions it can be shown that the maximum reservoir pressure deviation between the analytic and numerical results is 21 8 comparing fig 8b and d one can observe that the pressure distribution depends highly on the length of the well open interval l which is directly incorporated to the analytic well index given by eq 8 while the well perforated length is included its pattern is not considered in analytic well index equation therefore a deviation between the numerical and analytic results is expectable the variations of the well index associated with oi3 and block pressure versus permeability are depicted in figs 8e and 8f respectively in the case of oi3 the maximum difference between the analytic and numerical well index is 11 52 which is associated with bc3 comparing fig 8d and f for oi2 and oi3 it is clear that the pressure distribution depends on the pattern of the well open interval even at the same perforated length the obtained results indicate that the pattern of the well perforation in general has more effects on the well performance than the reservoir block boundary conditions both of these parameters are not directly incorporated into the analytic well index presented by joshi 1986 including a skin factor or shape factor it is possible to incorporate additional effects such as partial completion perforation pattern of the well and block boundary conditions into the analytic relation su 1995 5 3 illustration of the horizontal well drainage volume the pressure variation along a set of vertical lines passing through the points located at different positions of the well horizontal axis is illustrated in fig 9 here r r r max refers to the normalized vertical distance and x x l stands for the normalized distance along the well horizontal axis as shown in figs 1 and 9a for each studied boundary conditions of the reservoir block the pressure variations along the positive and negative directions of r are not the same e g compare figs 9b this means that the flow through the reservoir block in general is not symmetric due to the presence of gravity meanwhile the analytic well drainage radii are predicted as r 0 64 and r 0 5945 by the first and second joshi s methods respectively here it is assumed that the numerical drainage radius of the well is obtained where the radial pressure gradient p r r becomes nearly constant section 4 1 according to figs 9 one can conclude that the drainage radius is almost independent of the reservoir block boundary conditions the numerical drainage radius is about 4 and 12 larger than those predicted by using the first and second joshi methods for each case the radial flow is assumed in a specific region near the well the streamlines in two planes of the reservoir block are plotted in fig 10 the nearly radial flow region is highlighted by a circle in fig 10a the size of the radial region generally depends on various parameters such as the well drilling location well perforation pattern and block boundary conditions for different boundary conditions of the reservoir block and patterns of the well open intervals the pressure contours at a horizontal plane crossing the well axis z 0 are shown in figs 11 13 focusing on the full length connected well i e oi1 one can observe that block boundary conditions can generally affect the pressure contours for the regions far from the wellbore figs 11c for near wellbore regions it seems that the block boundary conditions have no considerable effect on the pressure contours for example compare the pressure levels below 8 0 in the related figures to clarify this subject pressure contour plots within the drainage area predicted by using the joshi second method are plotted in fig 11d it can be clearly seen that block boundary conditions have influence over the pressure contour inside the drainage area except in the regions very close to the wellbore considering figs 12 for oi2 and also figs 13 for oi3 it can be found that the pressure contours can be affected by block boundary conditions even within the well drainage area except near wellbore regions comparing figs 12d and 13d with the joshi drainage area it can be found that the pattern of the well open interval not only changes the shape of the pressure contours but also varies the pressure level even in cases with the same total perforated length of the well unlike the block boundary conditions pattern of the well open interval changes the shape of the pressure contours which is more visible in regions close to the wellbore compare figs 12 and 13 in order to have a better view from the drainage volume of a horizontal well three dimensional pressure contour plots associated with bc1 are plotted for different perforation patterns in figs 14 these pressure contours are plotted from the front and beside views to properly exhibit the drainage volume of the horizontal well looking at figs 14a and 14b one can observe that the drainage volume of full length perforated horizontal well drilled in the reservoir block with bc1 is very similar to that predicted by using joshi s second method proposed in joshi 1990 5 4 estimation of pseudo skin factors for the economides horizontal well model the effects of additional parameters such as the well perforation pattern can be incorporated into analytic relations of the well index by including a skin factor or shape factor su 1995 here the calculated cfd based well indices are used to estimate the pseudo skin factor s defined in term of s t in eq 12 for the economides analytic model economides et al 1991 table 2 summarises these cfd based pseudo skin factors for different cases of drilling eccentricity and horizontal orientations of the well in the reservoir block it is clear that both analytic and numerical methods predict similar well index values for the case of centred well with θ 0 as the pseudo skin factor is very small i e s 0 01 for other considered cases the skin factors are relatively large showing a deviation between the well indices estimated by using cfd approach and the economides model table 2 the results also indicate that the well index is more sensitive to the drilling eccentricity rather than the horizontal orientation and even the block boundary conditions 6 conclusions in the present study the single phase incompressible fluid flow through a coupled reservoir well system was numerically simulated to investigate the fluid flow behaviour through a reservoir grid block with a horizontal well the mass and momentum equations associated with the reservoir block and wellbore were simultaneously solved using a cell centred finite volume approach as the momentum equations the darcy and navier stokes equations were used for the reservoir block and wellbore region respectively the numerical results were utilized to estimate important characteristics of the horizontal wells including the well index and radius of drainage volume as well as skin factor used in analytic models these results indicated that in the case of a whole length perforated well with fully radial fluid flow both numerical well index and pressure velocity distribution inside the reservoir block have a very good agreement with the analytic results obtained by using joshi models except for the near wellbore open interval regions the level and the shape of the pressure contours inside the reservoir block can generally be affected by block boundary conditions even within the well drainage area unlike the block boundary conditions the pattern and the length of the well open interval influence the shape of pressure contours particularly in the regions close to the wellbore compared to the block boundary conditions the pattern of the well open interval has more effects on the well index and the fluid flow pattern inside the reservoir block neglecting the effects of reservoir block boundary conditions and the well open interval pattern the analytic drainage radius of the horizontal well predicted by using joshi s first and second methods are r 0 64 and r 0 5945 respectively the numerical drainage radius for a fully connected well i e oi1 under all considered boundary conditions for the reservoir block is about 0 67 this small deviation between the numerical and analytic data mainly stems from the block boundary conditions which are not directly incorporated into the analytic solution for the horizontal wells which are partially connected to the reservoir block i e oi2 and oi3 it was observed that there is a set of small oval shapes in the pressure contours around each open interval which is not affected by the block boundary conditions the shape of these small ovals is similar to the shape of the drainage area of the joshi s second method an interesting point is that these ovals are bounded within the overall drainage radius of the horizontal well it was found that the numerical well index is close to the analytic value calculated by using the economides model for a horizontal well without vertical eccentricity for the cases in which the horizontal well is drilled by an eccentricity a considerable deviation between the numerical and analytic well indices was observed this deviation is more sensitive to the eccentricity value rather than horizontal orientation of the well in the reservoir block and boundary conditions applying the presented cfd based approach one can develop a preprocessor for an existing reservoir simulator to determine the well index for unconventional conventional wells completed in an unstructured reservoir block and to estimate the pseudo skin factors in existing analytic well index models moreover the present approach can be extended to investigate the behaviour of compressible and multiphase flow behaviour inside the reservoir block and the wellbore region declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper 
5558,horizontal wells have gained considerable interest among petroleum engineers and hydrologists in the last decades many attempts were made to reach a better understanding of fluid flow behaviour inside the reservoir aquifer especially in the near wellbore regions in most of the previous studies on horizontal wells each well is treated as a volumetric source term in governing equations describing the fluid flow in the main reservoir aquifer many important features affecting the fluid flow such as the realistic wellbore geometry have been ignored for mathematical convenience in the present study the three dimensional single phase fluid flow through a large size reservoir block is coupled to wellbore flow through imposing the pressure and flux continuity at the reservoir well interface as the momentum equations the darcy and turbulent navier stokes equations are used in the reservoir block and wellbore respectively the governing equations are discretized on unstructured grids and solved by using the finite volume method using the computed pressure and velocity distributions the horizontal well characteristics are numerically estimated and compared with available analytic data for various cases it is shown that the calculated well index a coefficient in reflecting the geometric features of the well reservoir system deviates from its analytic value as a result of reservoir block boundary condition the pattern of the wellbore open intervals the horizontal well drilling path and its vertical eccentricity in addition the proposed approach is used to improve economides model an analytical model for horizontal well index by estimating its pseudo skin factor in various cases of the well vertical eccentricity horizontal orientation and reservoir block conditions keywords coupled free porous flow model turbulent wellbore flow influence radius of horizontal wells numerical well index nomenclature nomenclature a hw horizontal well drainage area m 2 a 1 area drained by the end of a horizontal well nearest the vertical section m 2 a 2 area drained along the horizontal length of the well m 2 a 3 area drained by the well tip m 2 l well horizontal length m k turbulent kinetic energy m 2 s 2 turbulent dissipation m 2 s 3 k absolute permeability tensor m 2 k xx permeability in x direction m 2 k yy permeability in y direction m 2 k k k max absolute permeability ratio k max the maximum absolute permeability md p bh well bottom hole pressure pa p r reservoir block pressure pa p w wellbore pressure pa p p r p bh p atm non dimensional pressure p p r r x p w r x p atm non dimensional pressure q volumetric flow rate of the production well m 3 s r radial distance m r r r max ratio of the radial distance to the maximum radial distance r w well radius m r ev vertical well equivalent radius m r eh horizontal well equivalent radius m w well index m 3 day bar w w w a dimensionless well index greek δ p l reservoir pressure difference and horizontal well head pa δ p 0 the pressure difference between reservoir and the horizontal well end pa δ p w l pressure drop in the horizontal well pa δ x block length m δ y block width m μ fluid viscosity pa s ρ fluid density kg m 3 φ wr the well potential defined as p r p w pa subscripts a analytic bh bottom hole h horizontal r reservoir v vertical w well abbreviations bc boundary condition cfd computational fluid dynamics oi open interval 1 introduction the simulation of fluid flow through petroleum reservoirs as well as aquifer plays a vital role in reservoir and groundwater engineering hydrologists as well as petroleum engineers have made extensive attempts to simulate fluid flow through the horizontal well reservoir systems the flow velocity in the reservoir rock is relatively low especially for the regions far from the drilling locations of production injection wells sun et al 2017 sun et al 2018 sun et al 2018 sun et al 2019 thus most of the numerical simulators usually use darcy s law to simulate the fluid flow inside the reservoir aquifer rock beside a proper well model for coupling of the reservoir conditions with the operating conditions of the wells williamson and chappelear 1981 a well model is a mathematical equation representing the mass flow rate of the reservoir fluid in the wellbore in terms of the difference between the reservoir and wellbore pressures by using a proportional coefficient named well index the well index incorporates the effects of some geometric features of wellbore and reservoir block as well as the rock permeability into the well model peaceman 1978 different mathematical models have been developed for describing the fluid flow through horizontal well reservoir aquifer systems having different applications in petroleum engineering palagi and aziz 1994 wolfsteiner et al 2000 wolfsteiner et al 2000 and hydrology park and zhan 2002 zhan and park 2002 sun and zhan 2006 wang and zhan 2017 park and zhan 2002 considered a finite diameter horizontal well inside an isotropic leaky aquifer and obtained the groundwater flow by incorporating the wellbore storage and the skin effects it has shown that skin effect and aquifer anisotropy considerably affect near well drawdown at the early flow time when compared with the solution of the line source zhan and park 2002 obtained the flow of horizontal well by solving the vapour flow to a point sink and superimposing the solution of the point sink along the well axial length in another study zhan and park 2003 they presented semi analytical solutions for three aquifer types of horizontal well hydraulics a leaky confined aquifer a leaky water table aquifer and a leaky aquifer under a water reservoir they concluded that drawdown is sensitive to the aquitard aquifer thickness ratio and the hydraulic conductivity ratio at the intermediate and later time sun and zhan 2006 linked the aquitard and the aquifer by imposing the flux and head continuity at their common interface they modelled the leakage as an internal boundary condition instead of the volumetric source in the governing equations known as the hantush s approximation and showed that this approximation provides a deviated solution during transient flow when compared with a solution based on actual leakage through the aquifer aquitard interface blumenthal and zhan 2016 derived a rapidly computed analytical solution for drawdown caused by a partially or fully penetrating directional wellbore vertical horizontal or slant via green s function method they optimized the solution for rapid computation via poisson resummation derivation of convergence rates and numerical optimization of integration techniques chen et al 2003 proposed a new approach to describe a finite diameter horizontal well and flow inside the pumping well jointly they applied a new treatment for in well hydraulics to eliminate the flux or head based boundary condition along the horizontal well wolfsteiner et al 2000 presented an approximate model for the production rate of unconventional wells in heterogeneous reservoirs and estimated the effect of well hydraulics and reservoir heterogeneity on the performance of unconventional wells wolfsteiner et al 2003 proposed a general approach for computing the index for unconventional wells in arbitrarily computational grids and applied it to both homogeneous and heterogeneous reservoir models they claimed that their proposed model can produce more accurate results than those of common well models used in commercial simulators in the recent decade the computational fluid dynamics cfd approach has been used as a powerful tool to simulate various complicated near wellbore flow problems based on a cfd approach byrne et al 2009 simulated the fluid flow in the vicinity of the wellbore region for a horizontal well and obtained the performance of the well in other studies bryne et al 2010 byrne et al 2011 presented a three dimensional model for the fluid flow near a vertical well which is fully connected to the reservoir and studied the effects of rock layer permeability on the near well pressure drop molina and tyagi 2015 numerically predicted the pressure drop and flow behaviour in the near wellbore region they compared the computed pressure drop with the analytic data to validate the proposed approach molina 2016 employed cfd to examine the production rate of a vertical gas well and estimated the well skin a parameter in an analytic well model they also investigated the effects of flow turbulence on a high production rate of the well szanyi et al 2018 examined a near well model for a horizontal well through the cfd they calculated the well mass flow rate under different reservoir conditions and obtained the effect of perforation patterns on the streamlines and also the pressure drop in the present work the single phase fluid flow through a typical block cell of a reservoir computational grid containing a horizontal well is simulated for the fluid production process the main objective is to describe the fluid flow behaviour inside the reservoir block connected to the horizontal well without using any well model this requires the simultaneous simulation of flow inside the reservoir block and the wellbore which is a challenging problem in terms of grid generation and solving the governing equations the reservoir block dimensions are very larger than the wellbore radius and the fluid flow velocity is very high in the wellbore region the well index and the drainage radius of the horizontal well are numerically estimated by using the obtained pressure and velocity fields under three different sets of block boundary conditions and three patterns for the well perforated regions open intervals including both full length and partially connected wells this work can have many applications in science and engineering such as recovery from hydrocarbon reservoirs and fluid flow in underground water resources based on the knowledge of the authors this is the first three dimensional cfd base simulation for the well reservoir flow problem without using any well model and its required assumptions which is used to estimate the well index and exhibiting the drainage influence volume of horizontal wells this approach simultaneously considers the effects of reservoir block boundary conditions pattern of the well open intervals the well drilling path and its eccentricity in an isotropic anisotropic reservoir block the numerical results of the proposed approach are finally used to estimate the proper values of the so called skin factor in the existing analytic well index models 2 problem definition in the production process the fluid flows through the reservoir enters the wellbore and then moves along the well axis toward the top surface of the reservoir a reservoir computational grid in general consists of a number of blocks cells which are usually large in size our problem is to simulate the single phase incompressible flow through a wellbore reservoir system this means that the production well is explicitly considered without using a well model the computational domain is a reservoir block containing a horizontal well according to fig 1 a constant pressure is imposed at the wellbore cross section located at the top surface of the reservoir block as this pressure is exerted at the bottom of the hole it is usually named well bottom hole pressure three sets of boundary conditions are applied on the faces of the block named as bc1 bc2 and bc3 the top view of the reservoir block with the aforementioned boundary conditions is shown in fig 2 the arrows and hatched lines represent the mass inflow and no flow boundaries respectively two faces of the block are under mass inflow condition in bc1 and bc2 while the flow enters only from one face which is perpendicular to the well horizontal axis in bc3 fig 2 in all cases the top and bottom faces of the reservoir block are supposed to be impermeable walls table 1 summarises the characteristics of the reservoir block the horizontal well and the fluid properties the geometric values are chosen based on the common size of a computational block and wellbore in petroleum reservoirs here a homogeneous reservoir rock with an isotropic absolute permeability tensor is assumed the horizontal part of the well is oriented in the reservoir block by an angle of θ as shown in fig 2 while for most cases θ 0 is considered the range of 30 θ 30 is used to study the fluid flow behaviour around the well in all cases it is assumed that the well is connected to the reservoir block through a set of open hole perforations three patterns for the open interval oi of the horizontal well are labelled as oi1 oi2 and oi3 as shown in fig 3 in oi1 the full length of the horizontal well is connected to the reservoir block fig 3a while one half of the well horizontal length is connected in oi2 and oi3 fig 3a to c 3 governing equations and mathematical models the described problem can numerically be simulated by solving the governing equations associated with the mass and momentum conservation laws dejam et al 2018 the reservoir block is a large size porous medium with relatively low flow velocity obeying darcy s law conversely the flow velocity through the wellbore is relatively high and the flow regime is practically turbulent therein in this region both axial and radial flows are dominant and therefore the navier stokes equations along with an appropriate turbulence model should be used to describe the fluid flow in the wellbore for other practical problems concerning the interaction between the channel and the porous medium one can refer to dejam 2019 dejam et al 2015 dejam 2018 in the following sections the governing equations for both wellbore and the reservoir block regions are explained in details 3 1 wellbore flow governing equations for turbulent incompressible steady state single phase flow in the wellbore the mass and momentum conservation equations can be written as wilcox 1998 1 u i x i 0 2 ρ u j u i x j p w x i x j μ u i x j u j x i ρ u i u j x j ρ g i 3 ρ u i u j μ t u i x j u j x i where the subscripts i and j denote the directions of the coordinate system the term x i is the position component p w is the wellbore pressure and u i stands for the flow velocity the parameter g i stands for the component of the gravitational acceleration in the direction i and ρ and μ are density and viscosity of fluid respectively according to the results of different turbulence models presented in asheim et al 1992 including the standard k model k ω model and reynolds stress model rsm the standard k turbulence model gives acceptable results regardless of its simplicity among the studied models azadi et al 2017 among these three turbulent models the k model is the most common two equation model that gives a general description of turbulence although it is not as complicated as rsm model it can describe fully turbulent flows more precisely than the k ω model which the latter model is more suitable for low reynolds turbulent flows with wall effects in the present work the k model is utilized to compute the turbulent flow properties in the wellbore region the transport equations for the standard k model are represented by wilcox 1998 4 ρ u i k x i x j μ μ t σ k k x j g k ρ 5 ρ u i x i x j μ μ t σ x j c 1 g k k c 2 ρ 2 k in which g k is the turbulent kinetic energy generation term denoting the production rate of k which is defined as g k μ t u i x j u j x i 2 the parameter μ t represents the eddy viscosity expressed as μ t ρ c μ k 2 in the k and equations σ k 1 and σ 1 3 are turbulent prandtl numbers and c μ 0 09 c 1 1 44 and c 2 1 92 are the model constants 3 2 reservoir block flow equations for a steady state single phase and incompressible flow through a rigid porous medium the mass conservation eq 1 is conveyed by darcy s law which is an alternative to the momentum equation the darcy velocity u r is represented in terms of the reservoir pressure gradient p r as chen et al 2006 6 u r k μ p r ρ g z where k is the absolute permeability tensor which is supposed to be homogeneous and isotropic and p r is the reservoir pressure also z and g are elevation and gravitational acceleration respectively 3 3 horizontal well model for a typical well completed in a single computational reservoir block peaceman model peaceman 1983 is a mathematical relation correlating the well potential p r p w with its flow rate q through the well index w as follows 7 q w p r p w the index of a well w can analytically be determined in terms of geometric properties of the reservoir block and the wellbore along with the components of the reservoir rock absolute permeability tensor mosharaf dehkordi and ghafouri 2018 various analytic well index models have been presented up to now such as the uniform flux babu and odeh 1989 and infinite conductivity models penmatcha and aziz 1998 in the first one it is assumed that the flux per unit length of the well is constant while no pressure drop along the wellbore is considered in infinite conductivity models these assumptions are only used for mathematical convenience however neither uniform flux nor no pressure drop in the wellbore assumptions do not happen in practice ozkan et al 1995 most of available analytic models are based on the 2 d flow assumption or 3 d flow is being decomposed into two 2 d problems like joshi s models joshi 1986 and there are limited 3 d well flow models ding 1996 uniform completion of the well in the reservoir block pseudo steady state flow and the alignment of the well drilling path with the principal permeability direction are the other applied assumptions in some well index models renard and dupuy 1991 zifei 1993 yeh and chang 2013 besides a fully radial flow is considered in aforementioned models however there exist some cases in which a fully radial flow cannot be achieved as an example no radial fluid flow may be observed around the wellbore due to its asymmetrical geometry and the boundary conditions of the reservoir block or even the existence of multiphase flow around the wellbore in the present study the main focus is on using the joshi horizontal well model in order to validate the presented numerical approach as well as studying the effective parameters on the well index value and drainage volume moreover deviations between numerically and analytically computed values of the horizontal well index at different cases are investigated using another analytic relation for well index called economides model these analytic well models are described in the next sections 3 3 1 joshi horizontal well model well index and drainage radius for a horizontal well completed in a cuboid reservoir block joshi s index is given by joshi 1986 8 w 2 π k h h μ ln a b h l ln bh r w b 1 for l bh where the subscripts h and v stand for horizontal and vertical directions respectively also a a a 2 l 2 2 0 5 l b k h k v 0 5 and a is expressed by joshi 1986 9 a l 2 1 2 1 4 1 0 5 l r eh 4 0 5 eq 8 is developed for a horizontal well drilled at the centre of the reservoir block in a vertical plane there exists a set of models considering the effect of the well vertical eccentricity with respect to the reservoir block centre such as the well model described in section 3 3 2 for a homogeneous rock the pressure distribution inside the reservoir block is pettersen 2006 10 p r p w q μ 2 π kh ln r r w s where r is the radial distance from the wellbore it is clear that r leads to infinite values for the reservoir pressure p which causes a non physical behaviour in fact a specific volume of the reservoir block is directly drained by the perforated regions of the well which is called drainage influence volume area the drainage region may be determined numerically or analytically in the numerical approach the computed pressure distribution around the wellbore is employed to estimate the drainage radius equivalent to the radius of influence in hydrology section 4 joshi 1986 proposed an analytic drainage radius for the horizontal well through the following methods as the first relation for the drainage area only geometric parameters are considered and the type of boundary conditions as well as the perforation patterns is neglected in the joshi s first method the drainage area is considered as a rectangle of length l along with two halves of a circle with radius r ev as shown in fig 4 a this surface of the drainage area a hw is equal to a hw π r ev 2 2 lr ev where l is the horizontal well length and r ev is the equivalent radius of a vertical well drilled in the reservoir block given by chen and zhang 2009 11 r ev 0 28 δ x 2 k yy k xx 0 5 δ y 2 k xx k yy 0 5 k yy k xx 0 5 k xx k yy 0 5 in the joshi s second method the drainage area is considered as an ellipse with two axes of sizes 2 a l 2 r ev and 2 b 2 r ev and area of a hw π ab as shown in fig 4b 3 3 2 economides horizontal well model economides et al 1996 proposed a general horizontal well model which can be applied for multi lateral wells with the laterals located in the same horizontal plane and also for the wells that their drilling direction is not parallel to the principal directions of the rock permeability tensor this model is developed based on infinite conductivity i e no pressure drop along the well axis and pseudo steady flow assumptions the well index is given by economides et al 1996 12 w k δ x μ p d s t p d δ x 2 π l s c δ xc h 4 π h where s t is an empirical constant named total skin factor considering the lumped effects of several aspects which are not directly considered in the developed well models the skin factor s t can consider the effects of turbulence possible wellbore damages non darcy flow and also flow convergence near the wellbore guo et al 2017 based on eq 12 the parameter p d is represented in terms of two geometric parameters s c and c h the first one is given by s c ln h 2 π r w h 6 l s e the effect of vertical eccentricity is incorporated into the model by using the parameter s e which is defined as s e h l 2 d z h 1 2 2 d z h 2 1 2 ln sin π d z h here d z is the minimum distance between the horizontal axis and horizontal boundaries of the reservoir block and h stands for the reservoir block thickness in the vertical direction the second parameter geometric parameters c h is given by a tabulated data in economides et al 1996 for limited cases of the well reservoir block dimensions and well configuration i e δ x δ y and l δ x for other possible cases it is necessary to approximate the c h value by interpolation between the available data of the mentioned table 4 solution methodology and some computational aspects the set of governing equations described in section 3 is solved numerically based on a cell centred finite volume approach here all of the flow variables are discretized by second order schemes and a set of internal conditions are imposed at the wellbore reservoir interface to couple the wellbore and reservoir flows these internal conditions provide connectivity of volumetric flux and pressure at the wellbore reservoir interface an implicit steady pressure based solver with absolute velocity formulation is used to solve the flow equations the pressure velocity coupling is achieved by using the semi implicit method for pressure linked equations simple algorithm that is a numerical procedure in the context of computational fluid dynamics which is extensively utilized to solve the navier stokes equations for details readers can refer to versteeg and malalasekera 2007 the convergence criterion specified tolerance within subsequent iterations for the mass velocity components turbulent kinetic energy and kinetic energy dissipation rate is set to 10 5 as the flow accelerate at the wellbore reservoir interface the special consideration should be taken into account to achieve accurate results an unstructured computational grid is generated for numerical computations with tetrahedral cells in the reservoir block and the boundary layer grid around the wellbore region two different slices x z and y z planes of the grid in the reservoir block can be seen in fig 5 to reduce the total number of computational cells the local grid refinement approach is employed and smaller cells in the near wellbore region are produced figs 5a and 5b in addition a set of under relaxation factors is also applied to speed up the convergence and improve the stability of the overall numerical solution process the under relaxation factors for the pressure and velocity components are 0 5 and 0 45 respectively under relaxation factor of 0 8 is utilized for both turbulent kinetic energy and turbulence dissipation energy to reduce the non linearity of the governing equations as turbulent flow is simulated and standard logarithmic wall function is utilized it is necessary to have special attention to the values of some turbulent flow parameters such as the wall coordinate parameter y wilcox 1998 this parameter is the dimensionless wall distance which can be interpreted as a local reynolds number defined as y yu t ν this means that y magnitude can be expected to determine the relative importance of viscous and turbulent processes here ν is the fluid kinematic viscosity and u t stands for the friction velocity defined as u t τ w ρ where τ w is the wall shear stress and ρ is the fluid density in each test case the wall coordinate parameter y on the computational cells adjacent to solid walls is checked to be remained in allowable range associated with the standard wall function all numerical results presented in section 5 are reported whenever grid independent results have been achieved 4 1 average pressure of the reservoir block and well drainage radius from the computational point of view the reservoir block is here represented by using a computational grid with a lot of computational cells by using the numerical results of the well reservoir flow problem i e the pressure and velocity fields associated with the reservoir and the wellbore it is possible to determine the well index numerically by a procedure presented in fig 6 to do this both of the wellbore and reservoir regions are divided into a specified number of segments n s each segment is bounded by two vertical planes which are perpendicular to the well axis the volumetric flux crossing the wellbore reservoir interface within each well segment is calculated by using the obtained velocity field in the form of q f l u f n da with l 1 n s here u u r u w represents the flow velocity at the wellbore reservoir interface associated with the segment l the total volumetric flux crossing the whole perforated length of the well is computed q wr l 1 n s q f l in the next step the wellbore average pressure for each well segment p w l is calculated then the reservoir average pressure in each reservoir segment p r l with l 1 n s is estimated for this purpose it is necessary to select a proper region around the wellbore within the reservoir segment in each vertical plane passing the well horizontal axis this region is generally introduced by an oval shape around the wellbore where its average pressure is nearly equal to the average pressure along its boundaries based on this point the average reservoir pressure in each segment is calculated through the numerically obtained pressure distribution a well potential for each well segment is defined by φ wr l p r l p w l the total value of the well potential φ wr is computed as the average value of the well segment potentials finally the numerical well index will be wi q wr φ wr l the drainage radius of the horizontal well is estimated based on calculated pressure distribution inside the reservoir block the reservoir pressure is reduced by moving along the radial direction measured with respect to the horizontal well axis the well drainage radius is the minimum radius where the radial component of the pressure gradient remains nearly constant accordingly it is possible to determine the drainage radius at any vertical plane across the horizontal axis of the well 5 numerical results and discussion to report the numerical results more effectively a number of dimensionless variables is introduced here a dimensionless pressure is defined as p p r p bh p atm where p bh is the well bottom hole pressure imposed as the boundary condition at a wellbore cross section located at a reference specific depth and p atm represents the atmospheric pressure here the top surface of the reservoir block is the reference depth as described in section 2 in addition the absolute permeability ratio and the well index ratio are defined as k k k max and w w w a respectively here k max is maximum rock permeability value among the considered values which is given in table 1 also w a is the analytic well index computed based on the joshi well model the dimensionless distance along the horizontal well axis is represented by x x l with l as the well total horizontal length fig 1 the numerical results are presented in the following sections in the first section the numerical results of the well index and non dimensional pressure distributions are compared to the analytic results in order to validate the numerical solution methodology in the second section the effects of block boundary conditions along with the well reservoir connection patterns on the calculated values of the well index and pressure distribution within the reservoir grid block are investigated in the third section first the radii of the drainage volume are estimated using obtained numerical solutions and also compared with those of analytic outputs in different cases then horizontal well drainage areas are illustrated at some selected slices of the reservoir block for different patterns of the well open intervals three dimensional drainage volumes of the horizontal well are illustrated using the pressure distribution inside the reservoir block finally the values of the pseudo skin factor utilized in the economides well model section 3 3 2 are estimated using cfd based well indices 5 1 validation of the numerical results to validate the proposed numerical methodology the well index is numerically estimated and compared with the analytic one which is computed by using the joshi model as discussed in section 3 3 the analytic index of a horizontal well is computed by eq 8 in terms of the geometric properties of the reservoir block and well along with the absolute permeability tensor the numerical well index can be computed in terms of the average reservoir block pressure and wellbore pressure using eq 7 considering a fully connected horizontal well drilled in a reservoir block with symmetric inflow boundary conditions with respect to the well horizontal axis the distribution of pressure in both reservoir block and wellbore regions is numerically determined then the average values of the wellbore pressure and reservoir block are computed section 4 1 and used to estimate the well index the obtained numerical results in comparison to the analytic ones are presented in figs 7a and 7 b as expected these results indicate that the well index value w increases and the block pressure p decreases by increasing the permeability values k in this case the difference between the numerical and analytic results is less than 3 for both p and w these results indicate that the analytic and numerical approaches produce similar solutions 5 2 block boundary conditions and the well open interval length the analytic well index is obtained based on a fully radial flow around the wellbore section 3 3 since the asymmetric boundary conditions may violate the condition of a symmetric and fully radial flow it is necessary to investigate the fluid flow behaviour inside the reservoir block with a set of asymmetric boundary conditions such as those introduced in section 2 the calculated values of the well index w and the pressure p for different boundary conditions bc1 bc2 and bc3 at oi1 oi2 and oi3 are compared with the analytic data joshi well model in figs 8 for different permeability values k ranging from 0 1 to 1 0 and three sets of boundary conditions the numerical index of the horizontal well with oi1 the full length connected well is plotted in fig 8a in this case the minimum and maximum difference between the numerical and analytic well index values is 6 for bc1 and 17 for bc3 respectively it can be seen that the numerical well index is always a bit larger than the analytic one this can be interpreted by considering the calculated block pressure which is always less than related analytic value according to eq 7 for a constant production rate q this results in a larger well index when compared to the analytic datum it should be noted that the main assumption of an analytic solution which is a fully radial flow in the reservoir block is not completely satisfied especially for bc2 and bc3 these results indicate that the reservoir block boundary conditions can generally affect the well index value which is not directly incorporated into analytic well index given by eq 8 for oi2 and different reservoir block boundary conditions the variation of the well index as well as the block average pressure is plotted versus the permeability values in figs 8c and 8d among the considered boundary conditions the minimum difference between the analytic and numerical well indices is observed for bc1 which changes from 18 to 22 depending on the permeability values the maximum well index deviation is some 30 which is related to bc3 like oi1 block boundary conditions affect the calculated well index values corresponding to oi2 considering fig 8d for different boundary conditions it can be shown that the maximum reservoir pressure deviation between the analytic and numerical results is 21 8 comparing fig 8b and d one can observe that the pressure distribution depends highly on the length of the well open interval l which is directly incorporated to the analytic well index given by eq 8 while the well perforated length is included its pattern is not considered in analytic well index equation therefore a deviation between the numerical and analytic results is expectable the variations of the well index associated with oi3 and block pressure versus permeability are depicted in figs 8e and 8f respectively in the case of oi3 the maximum difference between the analytic and numerical well index is 11 52 which is associated with bc3 comparing fig 8d and f for oi2 and oi3 it is clear that the pressure distribution depends on the pattern of the well open interval even at the same perforated length the obtained results indicate that the pattern of the well perforation in general has more effects on the well performance than the reservoir block boundary conditions both of these parameters are not directly incorporated into the analytic well index presented by joshi 1986 including a skin factor or shape factor it is possible to incorporate additional effects such as partial completion perforation pattern of the well and block boundary conditions into the analytic relation su 1995 5 3 illustration of the horizontal well drainage volume the pressure variation along a set of vertical lines passing through the points located at different positions of the well horizontal axis is illustrated in fig 9 here r r r max refers to the normalized vertical distance and x x l stands for the normalized distance along the well horizontal axis as shown in figs 1 and 9a for each studied boundary conditions of the reservoir block the pressure variations along the positive and negative directions of r are not the same e g compare figs 9b this means that the flow through the reservoir block in general is not symmetric due to the presence of gravity meanwhile the analytic well drainage radii are predicted as r 0 64 and r 0 5945 by the first and second joshi s methods respectively here it is assumed that the numerical drainage radius of the well is obtained where the radial pressure gradient p r r becomes nearly constant section 4 1 according to figs 9 one can conclude that the drainage radius is almost independent of the reservoir block boundary conditions the numerical drainage radius is about 4 and 12 larger than those predicted by using the first and second joshi methods for each case the radial flow is assumed in a specific region near the well the streamlines in two planes of the reservoir block are plotted in fig 10 the nearly radial flow region is highlighted by a circle in fig 10a the size of the radial region generally depends on various parameters such as the well drilling location well perforation pattern and block boundary conditions for different boundary conditions of the reservoir block and patterns of the well open intervals the pressure contours at a horizontal plane crossing the well axis z 0 are shown in figs 11 13 focusing on the full length connected well i e oi1 one can observe that block boundary conditions can generally affect the pressure contours for the regions far from the wellbore figs 11c for near wellbore regions it seems that the block boundary conditions have no considerable effect on the pressure contours for example compare the pressure levels below 8 0 in the related figures to clarify this subject pressure contour plots within the drainage area predicted by using the joshi second method are plotted in fig 11d it can be clearly seen that block boundary conditions have influence over the pressure contour inside the drainage area except in the regions very close to the wellbore considering figs 12 for oi2 and also figs 13 for oi3 it can be found that the pressure contours can be affected by block boundary conditions even within the well drainage area except near wellbore regions comparing figs 12d and 13d with the joshi drainage area it can be found that the pattern of the well open interval not only changes the shape of the pressure contours but also varies the pressure level even in cases with the same total perforated length of the well unlike the block boundary conditions pattern of the well open interval changes the shape of the pressure contours which is more visible in regions close to the wellbore compare figs 12 and 13 in order to have a better view from the drainage volume of a horizontal well three dimensional pressure contour plots associated with bc1 are plotted for different perforation patterns in figs 14 these pressure contours are plotted from the front and beside views to properly exhibit the drainage volume of the horizontal well looking at figs 14a and 14b one can observe that the drainage volume of full length perforated horizontal well drilled in the reservoir block with bc1 is very similar to that predicted by using joshi s second method proposed in joshi 1990 5 4 estimation of pseudo skin factors for the economides horizontal well model the effects of additional parameters such as the well perforation pattern can be incorporated into analytic relations of the well index by including a skin factor or shape factor su 1995 here the calculated cfd based well indices are used to estimate the pseudo skin factor s defined in term of s t in eq 12 for the economides analytic model economides et al 1991 table 2 summarises these cfd based pseudo skin factors for different cases of drilling eccentricity and horizontal orientations of the well in the reservoir block it is clear that both analytic and numerical methods predict similar well index values for the case of centred well with θ 0 as the pseudo skin factor is very small i e s 0 01 for other considered cases the skin factors are relatively large showing a deviation between the well indices estimated by using cfd approach and the economides model table 2 the results also indicate that the well index is more sensitive to the drilling eccentricity rather than the horizontal orientation and even the block boundary conditions 6 conclusions in the present study the single phase incompressible fluid flow through a coupled reservoir well system was numerically simulated to investigate the fluid flow behaviour through a reservoir grid block with a horizontal well the mass and momentum equations associated with the reservoir block and wellbore were simultaneously solved using a cell centred finite volume approach as the momentum equations the darcy and navier stokes equations were used for the reservoir block and wellbore region respectively the numerical results were utilized to estimate important characteristics of the horizontal wells including the well index and radius of drainage volume as well as skin factor used in analytic models these results indicated that in the case of a whole length perforated well with fully radial fluid flow both numerical well index and pressure velocity distribution inside the reservoir block have a very good agreement with the analytic results obtained by using joshi models except for the near wellbore open interval regions the level and the shape of the pressure contours inside the reservoir block can generally be affected by block boundary conditions even within the well drainage area unlike the block boundary conditions the pattern and the length of the well open interval influence the shape of pressure contours particularly in the regions close to the wellbore compared to the block boundary conditions the pattern of the well open interval has more effects on the well index and the fluid flow pattern inside the reservoir block neglecting the effects of reservoir block boundary conditions and the well open interval pattern the analytic drainage radius of the horizontal well predicted by using joshi s first and second methods are r 0 64 and r 0 5945 respectively the numerical drainage radius for a fully connected well i e oi1 under all considered boundary conditions for the reservoir block is about 0 67 this small deviation between the numerical and analytic data mainly stems from the block boundary conditions which are not directly incorporated into the analytic solution for the horizontal wells which are partially connected to the reservoir block i e oi2 and oi3 it was observed that there is a set of small oval shapes in the pressure contours around each open interval which is not affected by the block boundary conditions the shape of these small ovals is similar to the shape of the drainage area of the joshi s second method an interesting point is that these ovals are bounded within the overall drainage radius of the horizontal well it was found that the numerical well index is close to the analytic value calculated by using the economides model for a horizontal well without vertical eccentricity for the cases in which the horizontal well is drilled by an eccentricity a considerable deviation between the numerical and analytic well indices was observed this deviation is more sensitive to the eccentricity value rather than horizontal orientation of the well in the reservoir block and boundary conditions applying the presented cfd based approach one can develop a preprocessor for an existing reservoir simulator to determine the well index for unconventional conventional wells completed in an unstructured reservoir block and to estimate the pseudo skin factors in existing analytic well index models moreover the present approach can be extended to investigate the behaviour of compressible and multiphase flow behaviour inside the reservoir block and the wellbore region declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper 
5559,single well push pull swpp thermal tests have been widely used to characterize fracture matrix systems for storing and or exploring geothermal energy two important assumptions in previous mathematical models of the swpp thermal test are found to be problematic the thermal mixing effect in the wellbore is ignored and the fracture thermal conductance is omitted these two assumptions are not correct in many applications and have to be revoked meanwhile solutions associated with previous three stage injection resting and extraction models of swpp tests are computationally very expensive to obtain and need improvement for practical usage in this study a new three stage model is developed considering both the wellbore thermal mixing effect and the fracture thermal conductance and an analytical solution has been developed using laplace transform method and green s function method to test the new model a high resolution finite difference numerical solution is established and the results show that the analytical and numerical solutions agree with each other very well comparing with previous three stage analytical solution the computational cost is much less for the new solution of this study we find that breakthrough curves btcs in the wellbore for the extraction stage are not only dependent on the values of the injecting and pumping rates but also on the ratio between them the new model is most sensitive to fracture aperture and least sensitive to flow velocity in the fracture the previous models of ignoring the thermal mixing effect and or the fracture thermal conductance may cause great errors and should be avoided keywords heat transport tracer test geothermal exploration extended well hot dry rock nomenclature b the half fracture aperture width l b the height of the fracture l c f the average specific heat of rock and fluid in fracture jkg 1 c 1 c m c w the specific heat of rock matrix and water respectively jkg 1 c 1 h w i n j h w e x t the water levels in the wellbore in the injection and extraction stages respectively l k f the average thermal conductivity of rock and fluid in fracture wl 1 c 1 k m the thermal conductivity of rock matrix wl 1 c 1 q the flow rate l3t 1 of the well q inj q ext the flow rate of injection and extraction stages respectively l3t 1 t time t t inj t res t ext the ending time of injection chasing and extraction stages respectively t t 0 the initial temperature before the test c t inj the temperature of the injected water c t f t m the temperatures of fracture and rock matrix respectively c v the steady state flow velocity in the fracture lt 1 v w i n j v w e x t the volume of water of the wellbore in the injection and extraction stages respectively l3 x the distance along flow direction which is parallel to the fracture l z the distance normal to flow direction l ρ f the average density of rock and fluid in fracture ml 3 ρ m ρ w the densities of rock matrix and water respectively ml 3 ϕ f the porosity of fracture dimensionless subscript f bulk property of the fracture m bulk property of the matrix w the property of water d dimensionless terms acronyms swpp single well push pull btcs breakthrough curves hdr hot dry rock ode ordinary difference equations 1 introduction geothermal energy is a clean sustainable and renewable energy resource a common approach to exploit this type of energy is through injecting cold water into hot dry rock hdr firstly and then pumping the heated water out for usage eidesgaard et al 2019 kocabas 2005 as the water storage capacity of intact hdr is sometimes very low taron and elsworth 2009 zimmermann et al 2011 the cold water has to be injected under high pressure to generate and or expand rock fractures and to improve the recovery efficiencyof the geothermal systems the exploitation of geothermal energy could be completed by either inter well tests or single well push pull swpp tests inter well tests need two wells at least where the cold water is injected into a fracture matrix system by one well and is extracted by the other well s installed in the same system the swpp test is also named the single well injection withdrawal test kocabas 2005 and the injection pumping and observation are completed in the same well as the swpp test needs only one well it is more efficient than the inter well test in terms of reducing operational time and cost therefore this study only concerns the swpp test in the evaluation of geothermal resources parameter estimation or sensitivity analysis analytical solutions are preferred since they are free of numerical errors and are efficient in computation up to date a considerable amount of research on transport in a single fracture has been conducted in the past few decades such as neretnieks 1980 tang et al 1981 sudicky and frind 1982 sudicky and frind 1984 mahmoudzadeh et al 2013 zhu et al 2016 zhou et al 2017 liu et al 2018 zhou and zhan 2018 zhu and zhan 2018 trinchero and iraola 2020 and so on who developed analytical and semi analytical solutions for solute transport in single fractures for different sets of conceptual models for instance the model of neretnieks 1980 ignored the in plane dispersion effect in the single fracture and the matrix thickness was assumed to be infinite tang et al 1981 extended neretnieks model by including the longitudinal dispersion in the single fracture in the model of sudicky and frind 1982 they assumed that matrix thickness was finite sudicky and frind 1984 derived the analytical solution considering complex chemical reactions e g a two member decay chain in the single fracture mahmoudzadeh et al 2013 considered the stagnant water in the analytical solution of solute transport in the fracture and found that it might play important roles liu et al 2018 presented a new simple solution for the model of tang et al 1981 and named it the single flow path model in which the flow rate was the same spatially the new solution of liu et al 2018 was more stable and efficient in computation than that of tang et al 1981 and could be easily extended to the multi channel model where flow rates were different in various flow channels in a fracture recently zhan and co workers developed models for solute transport in fractures bounded by matrixes with asymmetric matrix properties zhou and zhan 2018 zhu and zhan 2018 while previous studies often assumed that the matrixes bounded the fracture were identical the works of zhou and zhan 2018 and zhu and zhan 2018 can be utilized to deal with transport in fractures bounded by different rock types or transport in stratified three layer systems due to the analogy between solute transport and heat transport carslaw and jaeger 1959 above mentioned models of solute transport might be applicable to describe heat transport in fractures however one might find that the initial conditions of these models were usually assumed to be free of solute thus these models may be applicable for describing the injection stage of the swpp test but they are usually not equipped to deal with other stages resting and extraction of the swpp test as for the models of the swpp test many specific analytical or semi analytical solutions have been developed such as gelhar and collins 1971 schroth and istok 2005 huang et al 2010 jung and pruess 2012 chen et al 2017 wang et al 2018 and so on all of them focused on the transport of chemical heat tracers in porous media as geothermal energy is commonly found in a fracture matrix system rather than conventional porous media aquifers those models may not work subsequently kocabas 2005 employed a double laplace transform method to develop a model of the thermal swpp test in a fracture matrix system assuming that the test contains two stages an injection stage and an extraction stage in many applications of the thermal swpp test a resting stage is usually employed after the injection stage to allow the injected cold water interacted with hdr to heat up before being pumped out this is the so called three stage swpp test jung and pruess 2012 extended the two stage model into the three stage model using the laplace fourier transform method both analytical solutions of kocabas 2005 and jung and pruess 2012 involved integrals that have to be solved numerically as commented by maier and kocabas 2013 the three stage swpp solution contained a six dimensional integral and took extremely long time more than 1 week in a personal computer to compute the computational time for such analytical solutions was much longer than that with the tough code which is a numerical model based on the integral finite difference method pruess et al 1999 however despite of the computational problem the advantages of previous analytical solutions should not be discredited entirely for instance the convective heat flux in the fracture and the heat flux into the matrix can be clearly distinguished in the analytical solution of jung and pruess 2012 while these two fluxes may not be easily distinguishable in a numerical solution one important conclusion obtained by jung and pruess 2013 was that the thermal breakthrough curves btcs in the wellbore were independent of the injection and extraction rates but dependent on the ratio between them jung and pruess 2012 jung and pruess 2013 maier and kocabas 2013 this conclusion is obtained based on the mathematical model of jung and pruess 2012 with two major and untested assumptions the wellbore thermal mixing effect and fracture thermal conductance are both negligible specifically the temperature is assumed to be constant in the wellbore during the entire operation of the swpp test for instance it is assumed to be equal to the temperature of the injected cold water for the injection stage actually when the injected cold water firstly mixes with the original hot water in the wellbore the temperature in the wellbore cannot remain constant instead it decreases with time as the interpretation of the swpp test is entirely based on the temperature information collected from the test well the mixing effect in such a well must be examined with great care for the sake of not violating any fundamental physical principles recognizing the importance of wellbore mixing effect wang et al 2018 developed a new model of chemical transport in the swpp test and found that ignoring the mixing effect could overestimate the concentration in the injection stage to advance the swpp thermal test study with more realistic conditions we will establish a new three stage mathematical model in this study by specifically including the thermal wellbore mixing effect and the fracture thermal conductance the laplace transform method and green s function method will be employed to derive the analytical solution of the established mathematical model to increase the computational efficiency to compare with the analytical solution a high resolution finite difference model is also developed a sensitivity analysis is conducted to investigate the influence of injection and extraction rates on the thermal btcs the new model of this study could also be used to describe the solute tracer transport in a similar fracture matrix system due to the mathematical equivalence between the heat and solute transport models 2 problem statement of the swpp test a realistic fractured aquifer could be extremely complex as multiple sets of fractures can intercept each other and each of those fractures could involve rough surfaces with spatiotemporally variable apertures with often limited information about those fractures one usually has to adopt some sorts of simplifications to make the problem amendable one of those simplifications involving a single rock fracture is to use a constant hydraulic aperture to deal with a realistic fracture with rough surfaces and variable aperture distribution the basic idea of the hydraulic aperture is that despite of the spatial variability of aperture and flow one can still employ the so called cubic law a form of darcy s law for flow in a single fracture with a constant aperture to describe the volumetric flux in the fracture lucas et al 2019 zheng et al 2008 in this study the conceptual model of the aquifer system used in jung and pruess 2013 will be employed where the well fully penetrates a single fracture with a uniform thickness the x axis of the coordinate system is parallel to the fracture face and the z axis is perpendicular to fracture the origin of the coordinate system is located at the well screen fracture interface and at the middle elevation of the fracture matrix system as shown in fig 1 the fracture can be either naturally occurred or generated by overpressure of injected fluid such as those in hydraulic fracturing operation the fracture aperture could be smaller and equal to the diameter of the wellbore the buoyancy flow in the vertical fracture is neglected and flow is horizontal during the entire operation of the swpp test to date this conceptual model has been widely used to describe the groundwater flow jenkins and prentice 1982 wen et al 2011 solute transport lucas et al 2019 zhou and zhan 2018 and heat transport jung and pruess 2012 kocabas 2005 in a fracture matrix system due to the differences of physical properties among the wellbore the fracture and the matrix e g conductivity porosity the mathematic models have three parts designated for the wellbore the fracture and the matrix respectively 2 1 models of heat transport in a fracture matrix system the governing equations of heat transport in a fracture matrix system are 1a ρ f c f t f x t k f 2 t f x x 2 ρ w c w v ϕ f t f x x k m b t m z z 0 t 0 x r w 1b ρ m c m t m x z t k m 2 t m x z z 2 t 0 z 0 where ρ f c f 1 ϕ f ρ m c m ϕ f ρ w c w c f is the average specific heat jkg 1 c 1 of rock and fluid in fracture ρ f is the average density ml 3 of rock and fluid in fracture ϕ f is the porosity dimensionless of fracture ρ m and ρ w the densities ml 3 of rock matrix and water respectively c m and c w are the specific heat values jkg 1 c 1 of rock matrix and water respectively b is the half fracture aperture width l k f is the average thermal conductivity wl 1 c 1 of rock and fluid in fracture and is a combination of the thermal conductivity and thermal dispersion k m is the thermal conductivity wl 1 c 1 of rock matrix t is time t x is the distance l along flow direction which is parallel to the fracture orientation z is the distance l normal to flow direction t f and t m are the temperatures c of fracture and rock matrix respectively v is the steady state flow velocity lt 1 in the fracture and the value of v could be calculated by 2 v q 4 b b ϕ f where q is the flow rate l3t 1 of the well and it is positive for injection and negative for extraction b is the height l of the fracture hereinafter all the symbols used in this study are listed and explained in nomenclature for reference eq 1a is a thermal energy conservation statement in the fracture in this equation the term on the left is the heat accumulation rate the first and second terms on the right represent the heat conductance and convection respectively and the last term on the right is the heat exchange between the fracture and matrix eq 1b is the heat diffusion equation in the matrix for a three stage swpp thermal test the initial condition for the injection stage is 3 t f x t 0 t m x z t 0 t 0 where t 0 is the initial temperature c before the test the initial condition in the resting stage is the solution at the end of the injection stage similarly the temperature distribution at the end of the resting stage serves as the initial condition for the extraction stage the boundary conditions could be described as follows 4 t f x t t 0 t 0 5 t m z t t 0 t 0 6 t f x 0 t t w t t 0 where t w t is the temperature c in the wellbore the temperature is assumed to be continuous at the fracture matrix interface and one has 7 t f x t t m x z 0 t t 0 2 2 model of heat transport in the wellbore in this study the model of heat variation in the wellbore will be established based on the energy conservation law considering the wellbore mixing effect in the injection stage one has 8a c w ρ w v w i n j t w t q inj c w ρ w t inj 4 b b ϕ f c w ρ w v t f k f t f x x 0 0 t t inj 8b t w t 0 t 0 where t inj is the ending time t of injection t inj is the temperature c of the injected water v w i n j represents the volume l3 of water of the wellbore in the injection stage and v w i n j π r w 2 h w i n j in which h w i n j is the water level l in the wellbore in the injection stage q inj represents the injection rate l3t 1 which is positive after injecting cold water into a wellbore holding hot water t w declines with time until it is equals to t inj in the resting stage the pumping rate is zero and the convective heat transfer in the fracture is neglected therefore eq 8a reduces to 9 c w ρ w v w r e s t w t 4 b b ϕ f k f t f x x 0 t inj t t res where t res is the ending time t of the resting stage v w r e s represents the volume l3 of water of the wellbore in the injection stage and v w r e s π r w 2 h 0 in which h 0 is the initial water level l in the extraction stage eq 8a becomes 10 c w ρ w v w e x t t w t q ext c w ρ w t w 4 b b ϕ f c w ρ w v t f k f t f x x 0 t t res where v w e x t is the volume l3 of water in the wellbore in the extraction stage and v w e x t π r w 2 h w e x t in which h w e x t is the water level in the wellbore in the extraction stage t ext is the ending time t of the extraction stage q inj represents the extraction rate l3t 1 which is positive while v is negative due to eq 2 3 solutions of the swpp thermal test 3 1 solutions in laplace domain to simplify the analysis the dimensionless parameters are defined as follows t fd t 0 t f t 0 t inj t md t 0 t m t 0 t inj x d k m x c w ρ w v ϕ f b 2 z d z b t d k m t c f ρ f b 2 θ c m ρ m c f ρ f and β c w ρ w v ϕ f b 2 k f k m where the subscript d represents the dimensionless terms hereinafter the detailed derivations of the analytical solution could be seen in appendix in the injection stage the solution of the swpp thermal test is 11a t md 1 s s α inj 1 ϕ f β δ 2 β s α inj 1 e x p 1 2 β δ x d e x p θ s z d 11b t fd 1 s s α inj 1 ϕ f β δ 2 β s α inj 1 e x p 1 2 β δ x d where over bar denotes the term in laplace domain hereinafter s denotes the laplace transform parameter in respect to the dimensionless time t d δ β 2 4 s θ s β and α inj v w i n j k m q inj c f ρ f b 2 in the resting stage the solution is 12a t md 0 g z d θ s η f η d η δ 1 δ 2 z d 12b t fd 0 g 1 x d s χ f 0 χ d χ where g z d θ s η b 1 e θ s z d b 2 e θ s z d 0 z d η b 3 e θ s z d b 4 e θ s z d η z d f η θ t md t injd θ s δ 1 δ 2 η g 1 x d s χ c 1 e β s 1 z ed x d c 2 e β s 1 z ed x d 0 x d χ c 3 e β s 1 z ed x d c 4 e β s 1 z ed x d χ x d f 0 χ β t fd t injd δ 1 t fd x d s δ 2 t fd x d s z ed b 1 1 2 θ s e x p θ s η η and χ are positive values varying between 0 and b 1 b 2 b 3 b 1 b 1 e x p 2 θ s η b 4 0 c 1 c 2 1 2 β s 1 z ed e x p β s 1 z ed χ c 3 c 1 c 1 e x p 2 β s 1 z ed χ and c 4 0 in the extraction stage the solutions are 13a t md 0 g z d θ s ς f 1 ς d ς a b z d 13b t fd 0 g x d s φ f 2 φ d φ m n x d where g z d θ s ς d 1 e x p θ s z d d 2 e x p θ s z d 0 z d ς d 3 e x p θ s z d d 4 e x p θ s z d ς z d f 1 ς θ t md ς t d t resd θ s a b ς g x d s φ e 1 exp 1 2 ε β x d e 2 exp 1 2 ε β x d 0 x d φ e 3 exp 1 2 ε β x d e 4 exp 1 2 ε β x d φ x d f 2 φ β t fd φ t resd β n β s 1 z ed m n φ a t f 2 d x d s b t f 2 d x d s z ed m n x ed n α ext t fd x d 0 t d t resd 1 α ext s x ed α ext v w e x t c w ρ w 2 v 4 b b c f ρ f k f ε β 2 4 s 1 z ed β φ and ς are positive values varying between 0 and d 1 d 2 d 2 1 2 θ s e x p θ s ς d 4 0 d 3 e x p θ s β e x p θ s ς 2 θ s e 1 w e 2 e 2 1 w ε exp 1 2 ε β φ e 4 w exp 1 2 ε β φ exp 1 2 ε β φ exp 1 2 ε β φ e 2 and e 3 0 3 2 solutions in real time domain eqs 11a 11b eqs 12a 12b and eqs 13a 13b are solutions of the swpp thermal test in laplace domain for the injection resting and extraction stages respectively it is not easy to analytically transform them to real time domain solutions fortunately many numerical inverse laplace transform methods are available and the de hoog method and the stehfest method have been found to be accurate and efficient in solving problems related to solute transport wang et al 2018 wang and zhan 2015 in this study the stehfest method will be employed for the inverse laplace transform on eqs 11a 11b eqs 12a 12b and eqs 13a 13b 3 3 special cases of the new solution in this study the new solution of the swpp thermal test considers both advection and conductance effects in the fracture the test is composed of three stages injection resting and extraction meanwhile the wellbore mixing effect is also included the new solution is the extension of many previous models for instance when the wellbore mixing effect and the fracture conductance effect are ignored e g r w 0 and k f 0 the new solution reduces to the solution of jung and pruess 2013 if the resting time is set as zero the three stage solution becomes the two stage solution as studied by kocabas 2005 as for the computational efficiency the computational time of the three stage solution of this study a few seconds in personal computer is much less than that involving six dimension integrals about 1 week in a personal computer as mentioned by maier and kocabas 2013 4 verifications of the analytical solutions in this study the solution of the swpp thermal test is derived in laplace domain and the numerical inverse laplace transform method is used to obtain the solution in real time domain to gain confidence on the accuracy and robustness of the new solution benchmark testing with a proven closed form analytical solution is desirable unfortunately such an analytical solution does not appear to be possible given the complexity of the problem therefore we are going to develop a high resolution finite difference solution for the sake of comparison where the high resolution means that sufficient care has been taken to reduce the numerical errors associated with the discretization and other approximations to negligible levels by comparing the semi analytical solution of this study and the high resolution numerical solution developed below one can get a sense of assurance of the developed semi analytical solution in the numerical modeling the horizontal spatial domain x 0 x e is discretized into n 1 subdomains i e n nodes where x 0 and x e represent the inner and outer boundary nodes along the axis respectively the distance of node x i is 14 x i x i 1 2 x i 1 2 2 i 1 2 n where x i 1 2 is calculated as follows log 10 x i 1 2 log 10 x 0 i log 10 x e log 10 x 0 n i 0 1 n similarly the spatial domain z 0 z e is discretized into m 1 subdomains i e m nodes where z 0 and z e represent the inner and outer boundary nodes along the z axis respectively the distance of node z i is 15 z j z j 1 2 z j 1 2 2 j 1 2 m where z j 1 2 is calculated as follows log 10 z j 1 2 log 10 z 0 j log 10 z e log 10 z 0 m j 0 1 m eqs 14 15 imply that a non uniform grid system is employed to minimize errors of the numerical solution and at the same time to optimize the computational efficiency specifically the entire domain is discretized logarithmically and the sizes of cells are smaller near the wellbore and the fracture matrix interface and become larger when moving away from the wellbore and or the fracture matrix interface the finite difference scheme of eqs 1a 1b is 16a t f i t k f ρ f c f t f i 1 t f i x i x i 1 k f ρ f c f t f i t f i 1 x i 1 x i x i 1 2 x i 1 2 ρ w c w v ϕ f ρ f c f t f i 1 2 t f i 1 2 x i 1 2 x i 1 2 k m ρ f c f b t m 3 2 t m 1 2 z 3 2 z 1 2 i 2 3 n 1 16b t m j t k m ρ m c m t m j 1 t m j z j z j 1 t m j t m j 1 z j 1 z j z j 1 2 z j 1 2 j 2 3 m 1 where the subscript indicates the location of relevant node x i and z j are the coordinates along the fracture at node i and the coordinate perpendicular to the fracture at node j respectively t f i and t m j represent the temperatures of fracture and rock matrix at nodes i and j respectively eqs 16a 16b are a set of ordinary differential equations with proper boundary and initial conditions they could be solved by stiff integrator ode 15s in matlab ashino et al 2000 shampine and reichelt 1997 shampine and thompson 2001 fig 2 shows the comparison of temperature between the semi analytical solution and the finite difference solution the legends of t t inj t t res and t t ext represent the ending time of injection resting and extraction stages respectively the parameters used in this case are k f 2 1 w m c k m 2 1 w m c ρ m 2650 kg m3 c m 1000 j kg c ρ w 1000 kg m3 c w 4200 j kg c ϕ f 0 5 b 0 1 m b 5 m q inj q ext 1 44 m3 hr r w 0 5 m t inj 1 day t res 0 5 day t ext 25 day h w i n j 50 m h w r e s 47 5 m and h w e x t 45 m the semi analytical solution agrees very well with the finite difference method demonstrating the accuracy of the new solution of this study 5 sensitivity analysis the new semi analytical solution involves a host of parameters of q inj q ext ϕ f β b h w and r w for practical purpose it is important to understand the priority of influences of those parameters this motivates us to conduct a sensitivity analysis of the new model the base values of parameters for the sensitivity analysis are the same as those in table 1 of jung and pruess 2012 k f 2 1 w m c k m 2 1 w m c ρ m 2650 kg m3 c m 1000 j kg c ρ w 1000 kg m3 v 4 10 4 m s c w 4200 j kg c ϕ f 0 5 b 0 01 m b 50 m t inj 5 hr t res 5 hr according to eq 2 one has q inj q ext 4 b b ϕ f v 1 44 m 3 h r the other parameters are r w 0 5 m h w i n j 65 m h w r e s 62 5 m and h w e x t 60 m 5 1 effect of the injecting and pumping rates in the study of the jung and pruess 2012 a dimensionless parameter of λ is defined to describe the relationship between the injection and pumping rates used in the swpp test 17 λ q inj q ext as q inj and q ext linearly change with flow velocity v in the fracture λ represents the ratio of flow velocities between the injection and extraction stages as well jung and pruess 2012 pointed out that btcs were independent of q inj and q ext as long as λ remained constant this conclusion is based on two important presumptions that the wellbore mixing effect and fracture thermal conductance are both negligible in this section the relationship between btcs and λ will be revisited based on the new solution of this study fig 3 shows btcs in the wellbore for different q inj but the same λ obviously the difference between btcs could not be negligible a smaller q inj results in a smaller t fd in the injection and resting stages this observation could be explained by eq 8a as t inj is specific the value t w t is dependent on the variation of v w i n j q inj t w t when the term of v w i n j q inj t w t is zero it means that the mixing effect is ignored and t w t is constant and equal to t inj or t fd x 0 t 1 mathematically it will take longer time for t fd x 0 t to approach 1 when q inj is smaller physically a smaller q inj means slower exchange of heat flux between the wellbore and the fracture matrix system thus t fd in the injection or resting stages is smaller as for btcs in the extraction stage the values are smaller for a smaller q inj because of the heat distributions at the end of the resting stage and the rate of decline of btcs is smaller as well fig 4 shows btcs in the wellbore for different λ but the same q inj implying that q ext is different as the injection rate remains constant btcs are the same for different λ in both injection and resting stages in the extraction stage a greater λ value results in larger btcs this is because a greater λ value means a smaller q ext value resulting in a greater t fd x 0 t 5 2 effect of fracture parameters figs 5 and 6 show the influence of ϕ f and β on btcs the parameters used in this section are the same with those used in figs 3 and 4 fig 5 shows btcs for different ϕ f which controls the flow velocity in the fracture as shown in eq 2 a greater ϕ f means a smaller flow velocity and the heat transport becomes slower therefore the values of btcs are smaller for smaller ϕ f values in the injection and resting stages in the extraction stage the values of btcs are the smallest at the beginning due to the effect of the initial condition of the extraction stage as the slopes of btcs are smaller for smaller ϕ f the values of btcs with the smallest ϕ f are above others when time increases fig 6 shows btcs for different β the influence of β on btcs in the wellbore is quite similar with the influence of ϕ f for instance the value of btc for the smallest β is below others in the injection and resting stages and the value of btc is the smallest at the beginning of the extraction stage then reaches a maximum one hour later this is because the parameter of β also controls the flow velocity in the fracture 5 3 sensitivity analysis fig 7 shows the sensitivity analysis on btcs and the vertical axis s c i j is computed by kabala 2001 yang and yeh 2009 18 s c i j i j c i i j δ i j c i i j δ i j where s c i j is the sensitivity coefficient c i is the temperature at the i th time i j represents the parameter of concern like h w v ϕ f and b and so on from this figure three observations could be made firstly the influences of these parameters are opposite in the injection and extraction stages for instance the values of s c i j are positive for b in the injection stage while become negative in the extraction stage similar findings could be seen for other parameters as well secondly the absolute values of s c i j are the largest for b and the smallest for v it implies that the most sensitive parameter is fracture aperture and the least sensitive parameter is flow velocity in the fracture meanwhile h w is the second most sensitive parameter thirdly in the injection stage the values of s c i j are positive for v ϕ f and b while they are negative for h w 6 discussions 6 1 comparison with previous models comparing with previous models the new model of this study includes two factors the mixing effect in the wellbore and the fracture thermal conductance to test the influences of these two factors on the results comparisons of models with the following constrains have been conducted a the model without the mixing effect and the fracture thermal conductance r w 0 and k f 0 b the model with the mixing effect but without the fracture thermal conductance r w 0 5 m and k f 0 c the model without the mixing effect but with the fracture thermal conductance r w 0 and k f 2 1 w m c d the model with the mixing effect and the fracture thermal conductance r w 0 5 m and k f 2 1 w m c such comparisons are shown in fig 8 several interesting observations could be made from this figure firstly the differences of btcs among above mentioned four scenarios are obvious in the extraction stage therefore both the wellbore mixing and fracture thermal conductance factors could not be ignored in general secondly the solution of r w 0 5 m and k f 0 is above others in the injection stage while the solution of jung and pruess 2012 is the smallest after 1 h in the extraction stage it implies that the solution of r w 0 5 m and k f 0 overestimates btcs and the solution of jung and pruess 2012 underestimates btcs thirdly the solution of r w 0 5 m and k f 0 is similar to the solution of r w 0 5 m and k f 2 1 w m c in the injection stage while the solution of r w 0 and k f 2 1 w m c is almost the same with the solution of r w 0 and k f 0 6 2 assumptions included in the new model of this study although the new model of this study represents a substantial extension of previous models by removing the two presumptions some other assumptions still remain and should be elaborated which will be explained as follows firstly the mixing effect is assumed to be completed instantaneously generally the radius of the injection pipe for the cold water is much smaller than the radius of the wellbore thus the injection process may cause non uniform distribution of heat inside the wellbore in other words the instantaneous and complete mixing of injected cold water with the pre injection wellbore hot water may be an oversimplification indeed to achieve the desirable instantaneous and complete mixing effect additional apparatus such as an auto mixer is recommended in the wellbore secondly this study only concerns a single fracture bounded by a homogeneous matrix and the well fully penetrates the vertical fracture when the spatial distribution of a complex fracture network is known numerical simulations are recommended to accommodate the actual fracture network thirdly the roughness of the fracture has not been considered specifically actually a real fracture usually has irregular surfaces with different roughness and aperture thus flow in a fracture is three dimensional in nature with commonly seen channeling flow tsang and tsang 1987 zhang et al 2019 indeed flow in a realistic fracture is often conducted through discrete channels rather than uniform over the entire thickness besides flow inside the fracture may deviate from the linear darcy s law if a sufficiently large reynold number has been reached and it has been commonly described by the navier stokes equations dou et al 2018 zhang et al 2019 such complexity of fracture flow has not be included in this study and must be examined in the future probably with the help of a high resolution three dimensional fracture flow simulator fourthly heat transport in the matrix is assumed to occur in direction perpendicular to the orientation of the fracture this assumption is commonly used in many previous studies of solute and heat transport in a fracture matrix system jung and pruess 2012 sudicky and frind 1982 trinchero and iraola 2020 and it is valid when the advective effect is much larger than conductive effect in the fracture by doing so the heat gradient along the flow direction or direction of the fracture orientation is ignored in the matrix if this is not the case then one should revisit the model to incorporate heat transport in directions both perpendicular and parallel to the fracture orientation fifthly the extent of the matrix is assumed to be infinite this assumption works well when the duration of the swpp test is relatively short like a few hours or days so that the influence distance of the test is limited and smaller than the matrix thickness for swpp tests which last much longer time such as months one usually needs to accommodate the finite thickness matrix into the model a task that cannot be handled with the model of this study and requires further investigations 7 summary and conclusions geothermal energy as a sustainable and clean energy resource has been increasingly exploited instead of the traditional fossil energy the efficiency of the enhanced geothermal system is critical and is evaluated in advance based on the in situ properties characterizing the fractured matrix system reservoir due to the low cost and high efficiency the swpp thermal test has been widely used to estimate the fracture matrix parameters by best fitting the observed btcs using a proper mathematic model however some assumptions included in previous mathematical models are in serious doubt after a careful examination for instance the mixing effect in the wellbore and the fracture thermal conductance were assumed to be negligible in almost all the previous models concerning two stage or three stage swpp thermal tests consequently btcs in the extraction stage was found to be independent on the values of the injecting and pumping rates but on the ratio between the injecting and pumping rates meanwhile the computational time required in many previous models is too long for practical use to remedy above mentioned issues a new three stage model is developed by considering both the mixing effect and the fracture thermal conductance for a swpp thermal test conducted in a fracture matrix system with a single vertical fracture bounded by much less permeable matrix the semi analytical solution has been developed using laplace transform method and green function method for the developed new mathematical model a high resolution finite difference numerical solution is also established and compared with the semi analytical solution with very good agreement the following conclusions could be drawn from this study 1 the mixing effect in the wellbore and the fracture thermal conductance are generally not negligible the new model accommodating the wellbore mixing effect and fracture thermal conductance is more robust for interpreting the swpp thermal test results the semi analytical solution derived for the new model is also more efficient in terms of computation than previous models 2 btcs in the wellbore are not only dependent on the ratio of the injection and extraction rates but also on the values of the injection and extraction rates themselves this finding is very different from previous models of ignoring the wellbore mixing effect and fracture thermal conductance in which btcs only depend on the ratio of the injection and extraction rates 3 the new model is most sensitive to the fracture aperture and the least sensitive to flow velocity in the fracture 4 the differences of btcs among models with and without the mixing effect and or the fracture thermal conductance are obvious in the extraction stage of the test demonstrating that both the wellbore mixing and fracture thermal conductance factors could not be ignored in general credit authorship contribution statement quanrong wang supervision conceptualization writing original draft wenguang shi derivation of the analytical solutions hongbin zhan writing review editing xun xiao investigation methodology declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgements this research was partially supported by programs of natural science foundation of china no 41772252 no 41972250 and no 41502229 innovative research groups of the national nature science foundation of china no 41521001 the natural science foundation of hubei province china 2018cfa028 the fundamental research funds for the central universities china university of geosciences wuhan no cuggc07 and china geological survey no dd20190263 2019040022 the authors would like to thank the associate editor and anonymous reviewers for their constructive comments which help us greatly improve the quality of the manuscript appendix derivation of solutions for the injection resting and extraction stages of a thermal swpp test a solutions in the injection stage eqs 11a 11b defining dimensionless parameters as follow t fd t 0 t f t 0 t inj t md t 0 t m t 0 t inj x d k m x c w ρ w v ϕ f b 2 z d z b t d k m t c f ρ f b 2 θ c m ρ m c f ρ f β c w ρ w v ϕ f b 2 k f k m where the subscript d represents the dimensionless terms hereinafter substituting these dimensionless parameters into eqs 1 10 one has 1a t fd t d t fd x d 1 β 2 t fd x d 2 t md z d z d 0 0 1b θ t md t d 2 t md z d 2 0 a2 t fd x d t d 0 t md x d z d t d 0 0 a3 t fd x d t d 0 a4 t md x d t d 0 a5 t fd x d 0 t d t wd t d a6 t md x d z d 0 t d t fd x d t d 7a α inj t wd t d 1 t wd ϕ f β t wd x d 0 t d t injd 7b t wd t d 0 0 8a v w r e s c w ρ w 2 v 4 b b c f ρ f k f t wd t d t wd x d t injd t d t resd 8b t wd x d 0 t injd t d t resd a9 α ext t wd t d t wd x d x d 0 t d t resd where α inj v w i n j k m q inj c f ρ f b 2 and α ext v w e x t c w ρ w 2 v 4 b b c f ρ f k f conducting laplace transform to eqs a1 a7 one has 10a s t fd t fd x d 1 β 2 t fd x d 2 t md z d z d 0 0 10b θ s t md 2 t md z d 2 0 11 t fd x d s 0 t md x d z d s 0 0 12 t fd x d s 0 13 t md x d z d s 0 14 t md x d z d 0 s t fd x d s 15 s α inj 1 t wd ϕ f β t wd x d 1 s where over bar denotes the term in laplace domain hereinafter s denotes the laplace transform parameter in respect to the dimensionless time t d t fd and t md represent the laplace transforms of t fd and t md respectively eqs a10b a11 and eqs a13 a14 compose a model of second order ordinary differential equation ode with boundary conditions the solution of eq a10b is t md t fd x d s e θ s z d a16 t fd 1 s s α inj 1 ϕ f β δ 2 β s α inj 1 e x p 1 2 β δ x d a17 δ β 2 4 s θ s β b solutions in the resting stage eqs 12a 12b in the resting stage the flow velocity is zero and the governing equation of heat transport in the fracture becomes 18 t fd t d 1 β 2 t fd x d 2 t md z d z d 0 0 conducting laplace transform to eq a18 and eq a1b one has 19a s t fd t fd t injd 1 β 2 t fd x d 2 t md z d z d 0 19b 2 t md z d 2 θ s t md θ t md t injd 20 t wd x d 0 where t injd represents the dimensionless form of the total injection time in this study we use the green s function method to derive the analytical solution of eq a19b and one has 21 t md ψ z d δ 1 δ 2 z d where δ 1 t fd x d s δ 2 t fd x d s z ed z ed represents z d ψ z d θ s η 0 g z d θ s η f η d η f η θ t md t injd θ s δ 1 δ 2 η g z d θ s η is the green s function and could be expressed as g z d θ s η g 1 z d θ s η b 1 e θ s z d b 2 e θ s z d 0 z d η g 2 z d θ s η b 3 e θ s z d b 4 e θ s z d η z d where b 1 1 2 θ s e x p θ s η b 1 b 2 b 3 b 1 b 1 e x p 2 θ s η and b 4 0 21 t fd 0 g 1 x d s χ f 0 χ d χ where f 0 χ β t fd t injd g 1 x d s χ c 1 e x p β s 1 z ed x d c 2 e x p β s 1 z ed x d 0 x d χ c 3 e x p β s 1 z ed x d c 4 e x p β s 1 z ed x d χ x d c 1 c 2 1 2 β s 1 z ed e x p β s 1 z ed χ c 3 c 1 c 1 e x p 2 β s 1 z ed χ c 4 0 c solutions in the extraction stage eqs 13a 13b in the extraction stage the inner boundary condition could be described as 22 t wd x d α ext s t wd x d 0 α ext t fd x d 0 t d t resd similarly we use the green s function method to derive the analytical solution of eq a38b and one has 23 t md m z d a b z d where a t f 2 d x d s b t f 2 d x d s z ed m z d θ s ς 0 g z d θ s ς f 1 ς d ς g z d θ s ς g 1 z d θ s ς d 1 e x p θ s z d d 2 e x p θ s z d 0 z d ς g 2 z d θ s ς d 3 e x p θ s z d d 4 e x p θ s z d ς z d d 1 d 2 d 2 1 2 θ s e x p θ s ς d 3 e x p θ s β e x p θ s ς 2 θ s d 4 0 24 t fd n x d m n x d where n α ext t fd x d 0 t d t resd 1 α ext s x ed m n x ed x ed represents x d n x d s φ 0 g x d s φ f 2 φ d φ g x d s φ e 1 exp 1 2 ε β x d e 2 exp 1 2 ε β x d 0 x d φ e 3 exp 1 2 ε β x d e 4 exp 1 2 ε β x d φ x d ε β 2 4 s 1 z ed β f 2 φ β t fd φ t d t resd β n β s 1 z ed m n φ e 1 w e 2 e 2 1 w ε exp 1 2 ε β φ e 3 0 e 4 w exp 1 2 ε β φ exp 1 2 ε β φ exp 1 2 ε β φ e 2 w 1 2 ε β α ext s 1 2 ε β α ext s 
5559,single well push pull swpp thermal tests have been widely used to characterize fracture matrix systems for storing and or exploring geothermal energy two important assumptions in previous mathematical models of the swpp thermal test are found to be problematic the thermal mixing effect in the wellbore is ignored and the fracture thermal conductance is omitted these two assumptions are not correct in many applications and have to be revoked meanwhile solutions associated with previous three stage injection resting and extraction models of swpp tests are computationally very expensive to obtain and need improvement for practical usage in this study a new three stage model is developed considering both the wellbore thermal mixing effect and the fracture thermal conductance and an analytical solution has been developed using laplace transform method and green s function method to test the new model a high resolution finite difference numerical solution is established and the results show that the analytical and numerical solutions agree with each other very well comparing with previous three stage analytical solution the computational cost is much less for the new solution of this study we find that breakthrough curves btcs in the wellbore for the extraction stage are not only dependent on the values of the injecting and pumping rates but also on the ratio between them the new model is most sensitive to fracture aperture and least sensitive to flow velocity in the fracture the previous models of ignoring the thermal mixing effect and or the fracture thermal conductance may cause great errors and should be avoided keywords heat transport tracer test geothermal exploration extended well hot dry rock nomenclature b the half fracture aperture width l b the height of the fracture l c f the average specific heat of rock and fluid in fracture jkg 1 c 1 c m c w the specific heat of rock matrix and water respectively jkg 1 c 1 h w i n j h w e x t the water levels in the wellbore in the injection and extraction stages respectively l k f the average thermal conductivity of rock and fluid in fracture wl 1 c 1 k m the thermal conductivity of rock matrix wl 1 c 1 q the flow rate l3t 1 of the well q inj q ext the flow rate of injection and extraction stages respectively l3t 1 t time t t inj t res t ext the ending time of injection chasing and extraction stages respectively t t 0 the initial temperature before the test c t inj the temperature of the injected water c t f t m the temperatures of fracture and rock matrix respectively c v the steady state flow velocity in the fracture lt 1 v w i n j v w e x t the volume of water of the wellbore in the injection and extraction stages respectively l3 x the distance along flow direction which is parallel to the fracture l z the distance normal to flow direction l ρ f the average density of rock and fluid in fracture ml 3 ρ m ρ w the densities of rock matrix and water respectively ml 3 ϕ f the porosity of fracture dimensionless subscript f bulk property of the fracture m bulk property of the matrix w the property of water d dimensionless terms acronyms swpp single well push pull btcs breakthrough curves hdr hot dry rock ode ordinary difference equations 1 introduction geothermal energy is a clean sustainable and renewable energy resource a common approach to exploit this type of energy is through injecting cold water into hot dry rock hdr firstly and then pumping the heated water out for usage eidesgaard et al 2019 kocabas 2005 as the water storage capacity of intact hdr is sometimes very low taron and elsworth 2009 zimmermann et al 2011 the cold water has to be injected under high pressure to generate and or expand rock fractures and to improve the recovery efficiencyof the geothermal systems the exploitation of geothermal energy could be completed by either inter well tests or single well push pull swpp tests inter well tests need two wells at least where the cold water is injected into a fracture matrix system by one well and is extracted by the other well s installed in the same system the swpp test is also named the single well injection withdrawal test kocabas 2005 and the injection pumping and observation are completed in the same well as the swpp test needs only one well it is more efficient than the inter well test in terms of reducing operational time and cost therefore this study only concerns the swpp test in the evaluation of geothermal resources parameter estimation or sensitivity analysis analytical solutions are preferred since they are free of numerical errors and are efficient in computation up to date a considerable amount of research on transport in a single fracture has been conducted in the past few decades such as neretnieks 1980 tang et al 1981 sudicky and frind 1982 sudicky and frind 1984 mahmoudzadeh et al 2013 zhu et al 2016 zhou et al 2017 liu et al 2018 zhou and zhan 2018 zhu and zhan 2018 trinchero and iraola 2020 and so on who developed analytical and semi analytical solutions for solute transport in single fractures for different sets of conceptual models for instance the model of neretnieks 1980 ignored the in plane dispersion effect in the single fracture and the matrix thickness was assumed to be infinite tang et al 1981 extended neretnieks model by including the longitudinal dispersion in the single fracture in the model of sudicky and frind 1982 they assumed that matrix thickness was finite sudicky and frind 1984 derived the analytical solution considering complex chemical reactions e g a two member decay chain in the single fracture mahmoudzadeh et al 2013 considered the stagnant water in the analytical solution of solute transport in the fracture and found that it might play important roles liu et al 2018 presented a new simple solution for the model of tang et al 1981 and named it the single flow path model in which the flow rate was the same spatially the new solution of liu et al 2018 was more stable and efficient in computation than that of tang et al 1981 and could be easily extended to the multi channel model where flow rates were different in various flow channels in a fracture recently zhan and co workers developed models for solute transport in fractures bounded by matrixes with asymmetric matrix properties zhou and zhan 2018 zhu and zhan 2018 while previous studies often assumed that the matrixes bounded the fracture were identical the works of zhou and zhan 2018 and zhu and zhan 2018 can be utilized to deal with transport in fractures bounded by different rock types or transport in stratified three layer systems due to the analogy between solute transport and heat transport carslaw and jaeger 1959 above mentioned models of solute transport might be applicable to describe heat transport in fractures however one might find that the initial conditions of these models were usually assumed to be free of solute thus these models may be applicable for describing the injection stage of the swpp test but they are usually not equipped to deal with other stages resting and extraction of the swpp test as for the models of the swpp test many specific analytical or semi analytical solutions have been developed such as gelhar and collins 1971 schroth and istok 2005 huang et al 2010 jung and pruess 2012 chen et al 2017 wang et al 2018 and so on all of them focused on the transport of chemical heat tracers in porous media as geothermal energy is commonly found in a fracture matrix system rather than conventional porous media aquifers those models may not work subsequently kocabas 2005 employed a double laplace transform method to develop a model of the thermal swpp test in a fracture matrix system assuming that the test contains two stages an injection stage and an extraction stage in many applications of the thermal swpp test a resting stage is usually employed after the injection stage to allow the injected cold water interacted with hdr to heat up before being pumped out this is the so called three stage swpp test jung and pruess 2012 extended the two stage model into the three stage model using the laplace fourier transform method both analytical solutions of kocabas 2005 and jung and pruess 2012 involved integrals that have to be solved numerically as commented by maier and kocabas 2013 the three stage swpp solution contained a six dimensional integral and took extremely long time more than 1 week in a personal computer to compute the computational time for such analytical solutions was much longer than that with the tough code which is a numerical model based on the integral finite difference method pruess et al 1999 however despite of the computational problem the advantages of previous analytical solutions should not be discredited entirely for instance the convective heat flux in the fracture and the heat flux into the matrix can be clearly distinguished in the analytical solution of jung and pruess 2012 while these two fluxes may not be easily distinguishable in a numerical solution one important conclusion obtained by jung and pruess 2013 was that the thermal breakthrough curves btcs in the wellbore were independent of the injection and extraction rates but dependent on the ratio between them jung and pruess 2012 jung and pruess 2013 maier and kocabas 2013 this conclusion is obtained based on the mathematical model of jung and pruess 2012 with two major and untested assumptions the wellbore thermal mixing effect and fracture thermal conductance are both negligible specifically the temperature is assumed to be constant in the wellbore during the entire operation of the swpp test for instance it is assumed to be equal to the temperature of the injected cold water for the injection stage actually when the injected cold water firstly mixes with the original hot water in the wellbore the temperature in the wellbore cannot remain constant instead it decreases with time as the interpretation of the swpp test is entirely based on the temperature information collected from the test well the mixing effect in such a well must be examined with great care for the sake of not violating any fundamental physical principles recognizing the importance of wellbore mixing effect wang et al 2018 developed a new model of chemical transport in the swpp test and found that ignoring the mixing effect could overestimate the concentration in the injection stage to advance the swpp thermal test study with more realistic conditions we will establish a new three stage mathematical model in this study by specifically including the thermal wellbore mixing effect and the fracture thermal conductance the laplace transform method and green s function method will be employed to derive the analytical solution of the established mathematical model to increase the computational efficiency to compare with the analytical solution a high resolution finite difference model is also developed a sensitivity analysis is conducted to investigate the influence of injection and extraction rates on the thermal btcs the new model of this study could also be used to describe the solute tracer transport in a similar fracture matrix system due to the mathematical equivalence between the heat and solute transport models 2 problem statement of the swpp test a realistic fractured aquifer could be extremely complex as multiple sets of fractures can intercept each other and each of those fractures could involve rough surfaces with spatiotemporally variable apertures with often limited information about those fractures one usually has to adopt some sorts of simplifications to make the problem amendable one of those simplifications involving a single rock fracture is to use a constant hydraulic aperture to deal with a realistic fracture with rough surfaces and variable aperture distribution the basic idea of the hydraulic aperture is that despite of the spatial variability of aperture and flow one can still employ the so called cubic law a form of darcy s law for flow in a single fracture with a constant aperture to describe the volumetric flux in the fracture lucas et al 2019 zheng et al 2008 in this study the conceptual model of the aquifer system used in jung and pruess 2013 will be employed where the well fully penetrates a single fracture with a uniform thickness the x axis of the coordinate system is parallel to the fracture face and the z axis is perpendicular to fracture the origin of the coordinate system is located at the well screen fracture interface and at the middle elevation of the fracture matrix system as shown in fig 1 the fracture can be either naturally occurred or generated by overpressure of injected fluid such as those in hydraulic fracturing operation the fracture aperture could be smaller and equal to the diameter of the wellbore the buoyancy flow in the vertical fracture is neglected and flow is horizontal during the entire operation of the swpp test to date this conceptual model has been widely used to describe the groundwater flow jenkins and prentice 1982 wen et al 2011 solute transport lucas et al 2019 zhou and zhan 2018 and heat transport jung and pruess 2012 kocabas 2005 in a fracture matrix system due to the differences of physical properties among the wellbore the fracture and the matrix e g conductivity porosity the mathematic models have three parts designated for the wellbore the fracture and the matrix respectively 2 1 models of heat transport in a fracture matrix system the governing equations of heat transport in a fracture matrix system are 1a ρ f c f t f x t k f 2 t f x x 2 ρ w c w v ϕ f t f x x k m b t m z z 0 t 0 x r w 1b ρ m c m t m x z t k m 2 t m x z z 2 t 0 z 0 where ρ f c f 1 ϕ f ρ m c m ϕ f ρ w c w c f is the average specific heat jkg 1 c 1 of rock and fluid in fracture ρ f is the average density ml 3 of rock and fluid in fracture ϕ f is the porosity dimensionless of fracture ρ m and ρ w the densities ml 3 of rock matrix and water respectively c m and c w are the specific heat values jkg 1 c 1 of rock matrix and water respectively b is the half fracture aperture width l k f is the average thermal conductivity wl 1 c 1 of rock and fluid in fracture and is a combination of the thermal conductivity and thermal dispersion k m is the thermal conductivity wl 1 c 1 of rock matrix t is time t x is the distance l along flow direction which is parallel to the fracture orientation z is the distance l normal to flow direction t f and t m are the temperatures c of fracture and rock matrix respectively v is the steady state flow velocity lt 1 in the fracture and the value of v could be calculated by 2 v q 4 b b ϕ f where q is the flow rate l3t 1 of the well and it is positive for injection and negative for extraction b is the height l of the fracture hereinafter all the symbols used in this study are listed and explained in nomenclature for reference eq 1a is a thermal energy conservation statement in the fracture in this equation the term on the left is the heat accumulation rate the first and second terms on the right represent the heat conductance and convection respectively and the last term on the right is the heat exchange between the fracture and matrix eq 1b is the heat diffusion equation in the matrix for a three stage swpp thermal test the initial condition for the injection stage is 3 t f x t 0 t m x z t 0 t 0 where t 0 is the initial temperature c before the test the initial condition in the resting stage is the solution at the end of the injection stage similarly the temperature distribution at the end of the resting stage serves as the initial condition for the extraction stage the boundary conditions could be described as follows 4 t f x t t 0 t 0 5 t m z t t 0 t 0 6 t f x 0 t t w t t 0 where t w t is the temperature c in the wellbore the temperature is assumed to be continuous at the fracture matrix interface and one has 7 t f x t t m x z 0 t t 0 2 2 model of heat transport in the wellbore in this study the model of heat variation in the wellbore will be established based on the energy conservation law considering the wellbore mixing effect in the injection stage one has 8a c w ρ w v w i n j t w t q inj c w ρ w t inj 4 b b ϕ f c w ρ w v t f k f t f x x 0 0 t t inj 8b t w t 0 t 0 where t inj is the ending time t of injection t inj is the temperature c of the injected water v w i n j represents the volume l3 of water of the wellbore in the injection stage and v w i n j π r w 2 h w i n j in which h w i n j is the water level l in the wellbore in the injection stage q inj represents the injection rate l3t 1 which is positive after injecting cold water into a wellbore holding hot water t w declines with time until it is equals to t inj in the resting stage the pumping rate is zero and the convective heat transfer in the fracture is neglected therefore eq 8a reduces to 9 c w ρ w v w r e s t w t 4 b b ϕ f k f t f x x 0 t inj t t res where t res is the ending time t of the resting stage v w r e s represents the volume l3 of water of the wellbore in the injection stage and v w r e s π r w 2 h 0 in which h 0 is the initial water level l in the extraction stage eq 8a becomes 10 c w ρ w v w e x t t w t q ext c w ρ w t w 4 b b ϕ f c w ρ w v t f k f t f x x 0 t t res where v w e x t is the volume l3 of water in the wellbore in the extraction stage and v w e x t π r w 2 h w e x t in which h w e x t is the water level in the wellbore in the extraction stage t ext is the ending time t of the extraction stage q inj represents the extraction rate l3t 1 which is positive while v is negative due to eq 2 3 solutions of the swpp thermal test 3 1 solutions in laplace domain to simplify the analysis the dimensionless parameters are defined as follows t fd t 0 t f t 0 t inj t md t 0 t m t 0 t inj x d k m x c w ρ w v ϕ f b 2 z d z b t d k m t c f ρ f b 2 θ c m ρ m c f ρ f and β c w ρ w v ϕ f b 2 k f k m where the subscript d represents the dimensionless terms hereinafter the detailed derivations of the analytical solution could be seen in appendix in the injection stage the solution of the swpp thermal test is 11a t md 1 s s α inj 1 ϕ f β δ 2 β s α inj 1 e x p 1 2 β δ x d e x p θ s z d 11b t fd 1 s s α inj 1 ϕ f β δ 2 β s α inj 1 e x p 1 2 β δ x d where over bar denotes the term in laplace domain hereinafter s denotes the laplace transform parameter in respect to the dimensionless time t d δ β 2 4 s θ s β and α inj v w i n j k m q inj c f ρ f b 2 in the resting stage the solution is 12a t md 0 g z d θ s η f η d η δ 1 δ 2 z d 12b t fd 0 g 1 x d s χ f 0 χ d χ where g z d θ s η b 1 e θ s z d b 2 e θ s z d 0 z d η b 3 e θ s z d b 4 e θ s z d η z d f η θ t md t injd θ s δ 1 δ 2 η g 1 x d s χ c 1 e β s 1 z ed x d c 2 e β s 1 z ed x d 0 x d χ c 3 e β s 1 z ed x d c 4 e β s 1 z ed x d χ x d f 0 χ β t fd t injd δ 1 t fd x d s δ 2 t fd x d s z ed b 1 1 2 θ s e x p θ s η η and χ are positive values varying between 0 and b 1 b 2 b 3 b 1 b 1 e x p 2 θ s η b 4 0 c 1 c 2 1 2 β s 1 z ed e x p β s 1 z ed χ c 3 c 1 c 1 e x p 2 β s 1 z ed χ and c 4 0 in the extraction stage the solutions are 13a t md 0 g z d θ s ς f 1 ς d ς a b z d 13b t fd 0 g x d s φ f 2 φ d φ m n x d where g z d θ s ς d 1 e x p θ s z d d 2 e x p θ s z d 0 z d ς d 3 e x p θ s z d d 4 e x p θ s z d ς z d f 1 ς θ t md ς t d t resd θ s a b ς g x d s φ e 1 exp 1 2 ε β x d e 2 exp 1 2 ε β x d 0 x d φ e 3 exp 1 2 ε β x d e 4 exp 1 2 ε β x d φ x d f 2 φ β t fd φ t resd β n β s 1 z ed m n φ a t f 2 d x d s b t f 2 d x d s z ed m n x ed n α ext t fd x d 0 t d t resd 1 α ext s x ed α ext v w e x t c w ρ w 2 v 4 b b c f ρ f k f ε β 2 4 s 1 z ed β φ and ς are positive values varying between 0 and d 1 d 2 d 2 1 2 θ s e x p θ s ς d 4 0 d 3 e x p θ s β e x p θ s ς 2 θ s e 1 w e 2 e 2 1 w ε exp 1 2 ε β φ e 4 w exp 1 2 ε β φ exp 1 2 ε β φ exp 1 2 ε β φ e 2 and e 3 0 3 2 solutions in real time domain eqs 11a 11b eqs 12a 12b and eqs 13a 13b are solutions of the swpp thermal test in laplace domain for the injection resting and extraction stages respectively it is not easy to analytically transform them to real time domain solutions fortunately many numerical inverse laplace transform methods are available and the de hoog method and the stehfest method have been found to be accurate and efficient in solving problems related to solute transport wang et al 2018 wang and zhan 2015 in this study the stehfest method will be employed for the inverse laplace transform on eqs 11a 11b eqs 12a 12b and eqs 13a 13b 3 3 special cases of the new solution in this study the new solution of the swpp thermal test considers both advection and conductance effects in the fracture the test is composed of three stages injection resting and extraction meanwhile the wellbore mixing effect is also included the new solution is the extension of many previous models for instance when the wellbore mixing effect and the fracture conductance effect are ignored e g r w 0 and k f 0 the new solution reduces to the solution of jung and pruess 2013 if the resting time is set as zero the three stage solution becomes the two stage solution as studied by kocabas 2005 as for the computational efficiency the computational time of the three stage solution of this study a few seconds in personal computer is much less than that involving six dimension integrals about 1 week in a personal computer as mentioned by maier and kocabas 2013 4 verifications of the analytical solutions in this study the solution of the swpp thermal test is derived in laplace domain and the numerical inverse laplace transform method is used to obtain the solution in real time domain to gain confidence on the accuracy and robustness of the new solution benchmark testing with a proven closed form analytical solution is desirable unfortunately such an analytical solution does not appear to be possible given the complexity of the problem therefore we are going to develop a high resolution finite difference solution for the sake of comparison where the high resolution means that sufficient care has been taken to reduce the numerical errors associated with the discretization and other approximations to negligible levels by comparing the semi analytical solution of this study and the high resolution numerical solution developed below one can get a sense of assurance of the developed semi analytical solution in the numerical modeling the horizontal spatial domain x 0 x e is discretized into n 1 subdomains i e n nodes where x 0 and x e represent the inner and outer boundary nodes along the axis respectively the distance of node x i is 14 x i x i 1 2 x i 1 2 2 i 1 2 n where x i 1 2 is calculated as follows log 10 x i 1 2 log 10 x 0 i log 10 x e log 10 x 0 n i 0 1 n similarly the spatial domain z 0 z e is discretized into m 1 subdomains i e m nodes where z 0 and z e represent the inner and outer boundary nodes along the z axis respectively the distance of node z i is 15 z j z j 1 2 z j 1 2 2 j 1 2 m where z j 1 2 is calculated as follows log 10 z j 1 2 log 10 z 0 j log 10 z e log 10 z 0 m j 0 1 m eqs 14 15 imply that a non uniform grid system is employed to minimize errors of the numerical solution and at the same time to optimize the computational efficiency specifically the entire domain is discretized logarithmically and the sizes of cells are smaller near the wellbore and the fracture matrix interface and become larger when moving away from the wellbore and or the fracture matrix interface the finite difference scheme of eqs 1a 1b is 16a t f i t k f ρ f c f t f i 1 t f i x i x i 1 k f ρ f c f t f i t f i 1 x i 1 x i x i 1 2 x i 1 2 ρ w c w v ϕ f ρ f c f t f i 1 2 t f i 1 2 x i 1 2 x i 1 2 k m ρ f c f b t m 3 2 t m 1 2 z 3 2 z 1 2 i 2 3 n 1 16b t m j t k m ρ m c m t m j 1 t m j z j z j 1 t m j t m j 1 z j 1 z j z j 1 2 z j 1 2 j 2 3 m 1 where the subscript indicates the location of relevant node x i and z j are the coordinates along the fracture at node i and the coordinate perpendicular to the fracture at node j respectively t f i and t m j represent the temperatures of fracture and rock matrix at nodes i and j respectively eqs 16a 16b are a set of ordinary differential equations with proper boundary and initial conditions they could be solved by stiff integrator ode 15s in matlab ashino et al 2000 shampine and reichelt 1997 shampine and thompson 2001 fig 2 shows the comparison of temperature between the semi analytical solution and the finite difference solution the legends of t t inj t t res and t t ext represent the ending time of injection resting and extraction stages respectively the parameters used in this case are k f 2 1 w m c k m 2 1 w m c ρ m 2650 kg m3 c m 1000 j kg c ρ w 1000 kg m3 c w 4200 j kg c ϕ f 0 5 b 0 1 m b 5 m q inj q ext 1 44 m3 hr r w 0 5 m t inj 1 day t res 0 5 day t ext 25 day h w i n j 50 m h w r e s 47 5 m and h w e x t 45 m the semi analytical solution agrees very well with the finite difference method demonstrating the accuracy of the new solution of this study 5 sensitivity analysis the new semi analytical solution involves a host of parameters of q inj q ext ϕ f β b h w and r w for practical purpose it is important to understand the priority of influences of those parameters this motivates us to conduct a sensitivity analysis of the new model the base values of parameters for the sensitivity analysis are the same as those in table 1 of jung and pruess 2012 k f 2 1 w m c k m 2 1 w m c ρ m 2650 kg m3 c m 1000 j kg c ρ w 1000 kg m3 v 4 10 4 m s c w 4200 j kg c ϕ f 0 5 b 0 01 m b 50 m t inj 5 hr t res 5 hr according to eq 2 one has q inj q ext 4 b b ϕ f v 1 44 m 3 h r the other parameters are r w 0 5 m h w i n j 65 m h w r e s 62 5 m and h w e x t 60 m 5 1 effect of the injecting and pumping rates in the study of the jung and pruess 2012 a dimensionless parameter of λ is defined to describe the relationship between the injection and pumping rates used in the swpp test 17 λ q inj q ext as q inj and q ext linearly change with flow velocity v in the fracture λ represents the ratio of flow velocities between the injection and extraction stages as well jung and pruess 2012 pointed out that btcs were independent of q inj and q ext as long as λ remained constant this conclusion is based on two important presumptions that the wellbore mixing effect and fracture thermal conductance are both negligible in this section the relationship between btcs and λ will be revisited based on the new solution of this study fig 3 shows btcs in the wellbore for different q inj but the same λ obviously the difference between btcs could not be negligible a smaller q inj results in a smaller t fd in the injection and resting stages this observation could be explained by eq 8a as t inj is specific the value t w t is dependent on the variation of v w i n j q inj t w t when the term of v w i n j q inj t w t is zero it means that the mixing effect is ignored and t w t is constant and equal to t inj or t fd x 0 t 1 mathematically it will take longer time for t fd x 0 t to approach 1 when q inj is smaller physically a smaller q inj means slower exchange of heat flux between the wellbore and the fracture matrix system thus t fd in the injection or resting stages is smaller as for btcs in the extraction stage the values are smaller for a smaller q inj because of the heat distributions at the end of the resting stage and the rate of decline of btcs is smaller as well fig 4 shows btcs in the wellbore for different λ but the same q inj implying that q ext is different as the injection rate remains constant btcs are the same for different λ in both injection and resting stages in the extraction stage a greater λ value results in larger btcs this is because a greater λ value means a smaller q ext value resulting in a greater t fd x 0 t 5 2 effect of fracture parameters figs 5 and 6 show the influence of ϕ f and β on btcs the parameters used in this section are the same with those used in figs 3 and 4 fig 5 shows btcs for different ϕ f which controls the flow velocity in the fracture as shown in eq 2 a greater ϕ f means a smaller flow velocity and the heat transport becomes slower therefore the values of btcs are smaller for smaller ϕ f values in the injection and resting stages in the extraction stage the values of btcs are the smallest at the beginning due to the effect of the initial condition of the extraction stage as the slopes of btcs are smaller for smaller ϕ f the values of btcs with the smallest ϕ f are above others when time increases fig 6 shows btcs for different β the influence of β on btcs in the wellbore is quite similar with the influence of ϕ f for instance the value of btc for the smallest β is below others in the injection and resting stages and the value of btc is the smallest at the beginning of the extraction stage then reaches a maximum one hour later this is because the parameter of β also controls the flow velocity in the fracture 5 3 sensitivity analysis fig 7 shows the sensitivity analysis on btcs and the vertical axis s c i j is computed by kabala 2001 yang and yeh 2009 18 s c i j i j c i i j δ i j c i i j δ i j where s c i j is the sensitivity coefficient c i is the temperature at the i th time i j represents the parameter of concern like h w v ϕ f and b and so on from this figure three observations could be made firstly the influences of these parameters are opposite in the injection and extraction stages for instance the values of s c i j are positive for b in the injection stage while become negative in the extraction stage similar findings could be seen for other parameters as well secondly the absolute values of s c i j are the largest for b and the smallest for v it implies that the most sensitive parameter is fracture aperture and the least sensitive parameter is flow velocity in the fracture meanwhile h w is the second most sensitive parameter thirdly in the injection stage the values of s c i j are positive for v ϕ f and b while they are negative for h w 6 discussions 6 1 comparison with previous models comparing with previous models the new model of this study includes two factors the mixing effect in the wellbore and the fracture thermal conductance to test the influences of these two factors on the results comparisons of models with the following constrains have been conducted a the model without the mixing effect and the fracture thermal conductance r w 0 and k f 0 b the model with the mixing effect but without the fracture thermal conductance r w 0 5 m and k f 0 c the model without the mixing effect but with the fracture thermal conductance r w 0 and k f 2 1 w m c d the model with the mixing effect and the fracture thermal conductance r w 0 5 m and k f 2 1 w m c such comparisons are shown in fig 8 several interesting observations could be made from this figure firstly the differences of btcs among above mentioned four scenarios are obvious in the extraction stage therefore both the wellbore mixing and fracture thermal conductance factors could not be ignored in general secondly the solution of r w 0 5 m and k f 0 is above others in the injection stage while the solution of jung and pruess 2012 is the smallest after 1 h in the extraction stage it implies that the solution of r w 0 5 m and k f 0 overestimates btcs and the solution of jung and pruess 2012 underestimates btcs thirdly the solution of r w 0 5 m and k f 0 is similar to the solution of r w 0 5 m and k f 2 1 w m c in the injection stage while the solution of r w 0 and k f 2 1 w m c is almost the same with the solution of r w 0 and k f 0 6 2 assumptions included in the new model of this study although the new model of this study represents a substantial extension of previous models by removing the two presumptions some other assumptions still remain and should be elaborated which will be explained as follows firstly the mixing effect is assumed to be completed instantaneously generally the radius of the injection pipe for the cold water is much smaller than the radius of the wellbore thus the injection process may cause non uniform distribution of heat inside the wellbore in other words the instantaneous and complete mixing of injected cold water with the pre injection wellbore hot water may be an oversimplification indeed to achieve the desirable instantaneous and complete mixing effect additional apparatus such as an auto mixer is recommended in the wellbore secondly this study only concerns a single fracture bounded by a homogeneous matrix and the well fully penetrates the vertical fracture when the spatial distribution of a complex fracture network is known numerical simulations are recommended to accommodate the actual fracture network thirdly the roughness of the fracture has not been considered specifically actually a real fracture usually has irregular surfaces with different roughness and aperture thus flow in a fracture is three dimensional in nature with commonly seen channeling flow tsang and tsang 1987 zhang et al 2019 indeed flow in a realistic fracture is often conducted through discrete channels rather than uniform over the entire thickness besides flow inside the fracture may deviate from the linear darcy s law if a sufficiently large reynold number has been reached and it has been commonly described by the navier stokes equations dou et al 2018 zhang et al 2019 such complexity of fracture flow has not be included in this study and must be examined in the future probably with the help of a high resolution three dimensional fracture flow simulator fourthly heat transport in the matrix is assumed to occur in direction perpendicular to the orientation of the fracture this assumption is commonly used in many previous studies of solute and heat transport in a fracture matrix system jung and pruess 2012 sudicky and frind 1982 trinchero and iraola 2020 and it is valid when the advective effect is much larger than conductive effect in the fracture by doing so the heat gradient along the flow direction or direction of the fracture orientation is ignored in the matrix if this is not the case then one should revisit the model to incorporate heat transport in directions both perpendicular and parallel to the fracture orientation fifthly the extent of the matrix is assumed to be infinite this assumption works well when the duration of the swpp test is relatively short like a few hours or days so that the influence distance of the test is limited and smaller than the matrix thickness for swpp tests which last much longer time such as months one usually needs to accommodate the finite thickness matrix into the model a task that cannot be handled with the model of this study and requires further investigations 7 summary and conclusions geothermal energy as a sustainable and clean energy resource has been increasingly exploited instead of the traditional fossil energy the efficiency of the enhanced geothermal system is critical and is evaluated in advance based on the in situ properties characterizing the fractured matrix system reservoir due to the low cost and high efficiency the swpp thermal test has been widely used to estimate the fracture matrix parameters by best fitting the observed btcs using a proper mathematic model however some assumptions included in previous mathematical models are in serious doubt after a careful examination for instance the mixing effect in the wellbore and the fracture thermal conductance were assumed to be negligible in almost all the previous models concerning two stage or three stage swpp thermal tests consequently btcs in the extraction stage was found to be independent on the values of the injecting and pumping rates but on the ratio between the injecting and pumping rates meanwhile the computational time required in many previous models is too long for practical use to remedy above mentioned issues a new three stage model is developed by considering both the mixing effect and the fracture thermal conductance for a swpp thermal test conducted in a fracture matrix system with a single vertical fracture bounded by much less permeable matrix the semi analytical solution has been developed using laplace transform method and green function method for the developed new mathematical model a high resolution finite difference numerical solution is also established and compared with the semi analytical solution with very good agreement the following conclusions could be drawn from this study 1 the mixing effect in the wellbore and the fracture thermal conductance are generally not negligible the new model accommodating the wellbore mixing effect and fracture thermal conductance is more robust for interpreting the swpp thermal test results the semi analytical solution derived for the new model is also more efficient in terms of computation than previous models 2 btcs in the wellbore are not only dependent on the ratio of the injection and extraction rates but also on the values of the injection and extraction rates themselves this finding is very different from previous models of ignoring the wellbore mixing effect and fracture thermal conductance in which btcs only depend on the ratio of the injection and extraction rates 3 the new model is most sensitive to the fracture aperture and the least sensitive to flow velocity in the fracture 4 the differences of btcs among models with and without the mixing effect and or the fracture thermal conductance are obvious in the extraction stage of the test demonstrating that both the wellbore mixing and fracture thermal conductance factors could not be ignored in general credit authorship contribution statement quanrong wang supervision conceptualization writing original draft wenguang shi derivation of the analytical solutions hongbin zhan writing review editing xun xiao investigation methodology declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgements this research was partially supported by programs of natural science foundation of china no 41772252 no 41972250 and no 41502229 innovative research groups of the national nature science foundation of china no 41521001 the natural science foundation of hubei province china 2018cfa028 the fundamental research funds for the central universities china university of geosciences wuhan no cuggc07 and china geological survey no dd20190263 2019040022 the authors would like to thank the associate editor and anonymous reviewers for their constructive comments which help us greatly improve the quality of the manuscript appendix derivation of solutions for the injection resting and extraction stages of a thermal swpp test a solutions in the injection stage eqs 11a 11b defining dimensionless parameters as follow t fd t 0 t f t 0 t inj t md t 0 t m t 0 t inj x d k m x c w ρ w v ϕ f b 2 z d z b t d k m t c f ρ f b 2 θ c m ρ m c f ρ f β c w ρ w v ϕ f b 2 k f k m where the subscript d represents the dimensionless terms hereinafter substituting these dimensionless parameters into eqs 1 10 one has 1a t fd t d t fd x d 1 β 2 t fd x d 2 t md z d z d 0 0 1b θ t md t d 2 t md z d 2 0 a2 t fd x d t d 0 t md x d z d t d 0 0 a3 t fd x d t d 0 a4 t md x d t d 0 a5 t fd x d 0 t d t wd t d a6 t md x d z d 0 t d t fd x d t d 7a α inj t wd t d 1 t wd ϕ f β t wd x d 0 t d t injd 7b t wd t d 0 0 8a v w r e s c w ρ w 2 v 4 b b c f ρ f k f t wd t d t wd x d t injd t d t resd 8b t wd x d 0 t injd t d t resd a9 α ext t wd t d t wd x d x d 0 t d t resd where α inj v w i n j k m q inj c f ρ f b 2 and α ext v w e x t c w ρ w 2 v 4 b b c f ρ f k f conducting laplace transform to eqs a1 a7 one has 10a s t fd t fd x d 1 β 2 t fd x d 2 t md z d z d 0 0 10b θ s t md 2 t md z d 2 0 11 t fd x d s 0 t md x d z d s 0 0 12 t fd x d s 0 13 t md x d z d s 0 14 t md x d z d 0 s t fd x d s 15 s α inj 1 t wd ϕ f β t wd x d 1 s where over bar denotes the term in laplace domain hereinafter s denotes the laplace transform parameter in respect to the dimensionless time t d t fd and t md represent the laplace transforms of t fd and t md respectively eqs a10b a11 and eqs a13 a14 compose a model of second order ordinary differential equation ode with boundary conditions the solution of eq a10b is t md t fd x d s e θ s z d a16 t fd 1 s s α inj 1 ϕ f β δ 2 β s α inj 1 e x p 1 2 β δ x d a17 δ β 2 4 s θ s β b solutions in the resting stage eqs 12a 12b in the resting stage the flow velocity is zero and the governing equation of heat transport in the fracture becomes 18 t fd t d 1 β 2 t fd x d 2 t md z d z d 0 0 conducting laplace transform to eq a18 and eq a1b one has 19a s t fd t fd t injd 1 β 2 t fd x d 2 t md z d z d 0 19b 2 t md z d 2 θ s t md θ t md t injd 20 t wd x d 0 where t injd represents the dimensionless form of the total injection time in this study we use the green s function method to derive the analytical solution of eq a19b and one has 21 t md ψ z d δ 1 δ 2 z d where δ 1 t fd x d s δ 2 t fd x d s z ed z ed represents z d ψ z d θ s η 0 g z d θ s η f η d η f η θ t md t injd θ s δ 1 δ 2 η g z d θ s η is the green s function and could be expressed as g z d θ s η g 1 z d θ s η b 1 e θ s z d b 2 e θ s z d 0 z d η g 2 z d θ s η b 3 e θ s z d b 4 e θ s z d η z d where b 1 1 2 θ s e x p θ s η b 1 b 2 b 3 b 1 b 1 e x p 2 θ s η and b 4 0 21 t fd 0 g 1 x d s χ f 0 χ d χ where f 0 χ β t fd t injd g 1 x d s χ c 1 e x p β s 1 z ed x d c 2 e x p β s 1 z ed x d 0 x d χ c 3 e x p β s 1 z ed x d c 4 e x p β s 1 z ed x d χ x d c 1 c 2 1 2 β s 1 z ed e x p β s 1 z ed χ c 3 c 1 c 1 e x p 2 β s 1 z ed χ c 4 0 c solutions in the extraction stage eqs 13a 13b in the extraction stage the inner boundary condition could be described as 22 t wd x d α ext s t wd x d 0 α ext t fd x d 0 t d t resd similarly we use the green s function method to derive the analytical solution of eq a38b and one has 23 t md m z d a b z d where a t f 2 d x d s b t f 2 d x d s z ed m z d θ s ς 0 g z d θ s ς f 1 ς d ς g z d θ s ς g 1 z d θ s ς d 1 e x p θ s z d d 2 e x p θ s z d 0 z d ς g 2 z d θ s ς d 3 e x p θ s z d d 4 e x p θ s z d ς z d d 1 d 2 d 2 1 2 θ s e x p θ s ς d 3 e x p θ s β e x p θ s ς 2 θ s d 4 0 24 t fd n x d m n x d where n α ext t fd x d 0 t d t resd 1 α ext s x ed m n x ed x ed represents x d n x d s φ 0 g x d s φ f 2 φ d φ g x d s φ e 1 exp 1 2 ε β x d e 2 exp 1 2 ε β x d 0 x d φ e 3 exp 1 2 ε β x d e 4 exp 1 2 ε β x d φ x d ε β 2 4 s 1 z ed β f 2 φ β t fd φ t d t resd β n β s 1 z ed m n φ e 1 w e 2 e 2 1 w ε exp 1 2 ε β φ e 3 0 e 4 w exp 1 2 ε β φ exp 1 2 ε β φ exp 1 2 ε β φ e 2 w 1 2 ε β α ext s 1 2 ε β α ext s 
