index,text
670,lateral flow l t is a major process during flood events which can be either gains positive or losses negative to the channel the inverse problem consists of evaluating l t knowing the inflow i t and the outflow o t on a channel however l t is very difficult to measure on real channels and we are always not sure to which extent the evaluated l t is close to the real one this paper aims at evaluating l t in a channel using the analytical solution of the inverse problem of the hayami diffusive wave equation dwe with l t uniformly distributed along the channel we conceived and built a novel experimental channel where i t o t and l t are highly controlled at 1 s time step and we realize 62 experimental hydrograph scenarios corresponding to different shapes of i t and l t we validate the hypotheses of both the dwe hayami model and the corresponding inverse model with very high criteria functions values for a large majority of scenarios which reflects the ability of the dwe inverse model to reproduce complex lateral flow hydrograph dynamics we discuss the limits of application of the dwe especially for short wave lengths the coupled experimental modelling approach proposed herein opens promising perspectives regarding the evaluation of lateral flow on real channels keywords diffusive wave equation dwe inverse problem hayami equation uniformly distributed lateral flow experimental channel 1 introduction during flood events lateral flow is one of the major processes along a channel reach lateral flow can be either gains to the channel considered as positive values such as surface runoff on hillslopes or aquifer contribution to the flow or losses from the channel considered as negative values such as overbank flow or infiltration to the aquifer lateral flow can also be due to anthropogenic water management such as water pumping or rejects despite recent progresses in measurements lateral flow cannot be measured and experimentations cannot be conducted in situ due to the difficulty to control all exchanges along a channel reach interactions channel hillslope channel aquifer channel flood zone hence in practical applications hydrological models are often used for lateral flow hydrograph simulation and the saint venant equations saint venant 1871 for non steady free surface flow routing in rivers with lateral flow e g morris 1980 moussa and bocquillon 1996a moramarco et al 1999 delestre et al 2013 usace 2016 finite difference e g moussa and bocquillon 1996a b finite element e g hauke 2002 szymkiewicz and gasiorowski 2012 villaret et al 2013 finite volume e g goutal and maurel 2002 guinot 2009 benkhaldoun and seaïd 2010 xing and shu 2011 hodges 2019 or hybrid finite volume finite difference e g lai and khan 2018 numerical methods are generally used to solve the saint venant equations however the inverse problem consisting of calculating the lateral flow hydrograph knowing inflow and outflow hydrographs on a channel remains an unsolved problem and one of the major challenges in hydrological and hydraulic modelling see a detailed review in moussa and cheviron 2015 cheviron and moussa 2016 in most practical applications of flood routing the acceleration terms in the saint venant equations can be neglected and the equation system is reduced to the well known diffusive wave equation dwe which was largely studied in the literature e g woolhiser and liggett 1967 ponce et al 1978 ponce 1990 singh and aravamuthan 1995 sivapalan et al 1997 yen and tsai 2001 chang and yeh 2015 the dwe has two parameters celerity and diffusivity taken as function of the discharge numerical methods such as finite difference methods are generally used to solve the dwe with lateral flow blandford and ormsbee 1993 moussa and bocquillon 1996b 2009 moramarco and singh 2002 kazezyılmaz alhan 2012 fan and li 2006 extended the solution of the dwe for open channel flows with uniform and concentrated lateral flow and more recently cimorelli et al 2014 proposed solutions of the dwe accounting for downstream boundary condition and uniform lateral flows spada et al 2017 estimated the lateral flow and also the discharge hydrographs at the upstream and downstream channel ends through the reverse routing modelling and solving the saint venant equations in diffusive form however when using numerical resolution methods numerical instabilities e g oscillations and divergence problems are encountered moussa and bocquillon 1996b on semi infinite reach if celerity and diffusivity can be assumed constant and if lateral flow is nil the dwe has an analytical solution unconditionally stable the hayami 1951 model wang et al 2014 improved the resolution technique using a discrete hayami convolution method moussa 1996 extended the hayami analytical solution to the case of uniformly distributed lateral flow and moreover proposed an analytical solution of the inverse problem in the particular case of the hayami hypotheses the inverse problem consists of calculating the lateral flow hydrograph under the hypothesis of lateral flow uniformly distributed along the channel using both the inflow and the outflow as inputs of the model and knowing the two parameters celerity and diffusivity this method is an easy to use analytical solution recently used by charlier et al 2015 as a diagnosis tool for evaluating lateral flows in karstic regions and extended by cholet et al 2017 for evaluating simultaneously the lateral flow hydrograph and the corresponding solute concentration however in all these applications no validation was possible because no experimentation can be conducted to measure lateral flow hydrograph in order to compare the modelled lateral flow to the measured one the validation of the model of the inverse problem needs necessarily measured experimental data of the lateral flow in order to validate the domain of application of the modelling approach the hayami hypotheses and the approximations used to get the solution of the inverse problem in the literature hydraulic model experiments were carried whether on small laboratory experimental channels e g vinatier et al 2017 or on real scale channels e g newson 2002 errico et al 2018 rudi et al 2018 these experiments had various purposes according to project features impact of vegetation on hydraulic resistance e g defina and peruzo 2010 vinatier et al 2017 errico et al 2018 impact of dikes on inundation e g ettema and muste 2004 impact of land use change and river management on floods e g jung et al 2012 or for river ecosystem management newson 2002 the experiment size should verify hydraulic laws of similitude and the full saint venant equations are generally used for hydraulic modelling chanson 1999 heller 2011 green 2014 however these studies were generally conducted without lateral flows gains and losses to our knowledge no experiments were done under the hypotheses of the dwe with uniformly lateral flows gains and losses under highly controlled time varying inflows and lateral flows it follows that we can rarely find a variety of time varying hydrograph scenarios that meet the hypotheses of the dwe and its resolution by the hayami model whereas a large number of time varying hydrograph scenarios is necessary to validate this modelling approach there is a need for rational experiments characterized by short time duration low water consumption high precision and large variety of hydrograph scenarios this paper aims at evaluating the lateral flow hydrograph in an experimental channel using the analytical solution of the inverse problem of the hayami diffusive wave equation dwe with time varying lateral flow uniformly distributed along the channel proposed by moussa 1996 unfortunately this model was never tested on real cases with measured lateral gains and losses however the model gave promising results in the understanding and the estimation of time varying lateral flows during flood events on real cases where only inflows and outflows were measured moussa 1996 charlier et al 2015 cholet et al 2017 but a large set of well controlled hydrographs inflow lateral gains or losses is needed to validate the hypotheses of both the dwe hayami model and the corresponding inverse model i e verification of the domain of application of the dwe celerity and diffusivity constants during the flood event time varying lateral flow uniformly distributed along the channel validation of the inverse model equations for real case applications there is a gap of information on the spatial distribution of lateral flow however the hypothesis of time variable and uniformly distributed lateral flow is the simplest for which an analytical solution of the inverse model exists the ideal would be to test the model on a real case study however there is a complete lack of data acquisition of lateral gains and losses during flood events this lack is due to the extreme difficulty long experimentation time during years material and human cost of measuring simultaneously gains from surface runoff exchange between the channel and groundwater and eventual losses by overbank flow therefore it was a challenge for us to meet the aforementioned natural processes in a laboratory scale experiment that must present the following properties p1 short time experimentation this implies low consumption of water as well as realizing several replicates of a same experiment which is necessary to obtain accurate reliable and reproducible experimental scenarios p2 well controlled hydrographs this implies reproducing time variable hydrographs at 1 s time step with exact discharge values p3 the use of hydrographs of p2 as the basis for scenarios of inflows representing the flood event lateral gains and or lateral losses p4 lateral gains and lateral losses should be uniformly distributed along the channel in space but variable in time according to different scenarios p5 the different hydrographs inflow gains and losses must be simultaneously controlled by a suitable automatic electronic device to address p1 to p5 we use an experimental channel length 4 m where inflow outflow and lateral flow gains and losses are highly controlled at a time step of 1 s and where a large number of time varying hydrograph scenarios were implemented by high precision peristaltic pumps the paper is organized into four sections section 2 presents the dwe with lateral flow the inverse problem and the criteria functions section 3 presents the experimental setup hydrograph scenarios and discusses the domain of application of the dwe section 4 presents the results of model sensitivity analysis model calibration and model validation strategies as well as uncertainty analysis and a discussion on the limit of application of the dwe inverse problem section 5 presents the conclusion appendix a gives the list of symbols the supplementary material gives the characteristics of experimental scenarios and additional results on uncertainty analysis 2 diffusive wave equation dwe 2 1 diffusive wave equation without lateral flow the saint venant equations saint venant 1871 of continuity and momentum are generally used to describe unsteady flow in rivers within this basic model different authors e g ponce and simons 1977 daluz vieira 1983 moussa and bocquillon 1996a classified river waves as dynamic gravity diffusion dwe or kinematic waves corresponding to different terms of the momentum equation in most practical applications of flood routing in natural channels the acceleration terms in the saint venant equations can be neglected and the system is reduced to the dwe moussa and bocquillon 1996a the dwe without lateral flow can be written as 1 q t c q q x d q 2 q x 2 0 where x l is the length along the channel t t is the time and the celerity c q lt 1 and the diffusivity d q l2t 1 are functions of the discharge q l3t 1 let i t and o t be the upstream inflow minus the baseflow and the downstream outflow minus the baseflow respectively 2 i t q 0 t q 0 0 3 o t q l t q l 0 with l l the channel length in the particular case of a semi infinite channel no physical downstream boundary condition exists and c q and d q are constant and the dwe has as solution the analytical hayami 1951 equation 4 o t 0 t i t τ k τ d τ i t k t the symbol represents the convolution relation and k t is the hayami kernel function defined as 5 k t l 2 π d 1 2 e c l 4 d 2 l c t c t l t 3 2 2 2 diffusive wave equation with lateral flow the dwe with lateral flow can be written as 6 q t c q q x q d q 2 q x 2 q x 0 the term q x t l2t 1 represents the lateral flow distribution let l t be the lateral inflow hydrograph 7 l t 0 l q x t d x moussa 1996 extended the solution of the dwe under hayami s hypotheses semi infinite channel c q and d q are constant to the case where lateral flows are uniformly distributed along the channel 8 o t φ t i t φ t k t where 9 φ t c l 0 t l θ l 0 d θ and so 10 l t l 0 l c d φ d t 2 3 inverse problem the inverse problem proposed by moussa 1996 enables the evaluation of the temporal distribution of the lateral flow l t over the channel reach by knowing i t and o t let 11 a t o t i t k t inserting eq 11 into 8 gives 12 φ t φ t k t a t using the laplace transforms an approximation of the solution of eq 12 is 13 φ t a t a t i 1 k i t with 14 k i t k k k i t i m e s then the lateral flow can be easily evaluated noted l c t by calculating i the hayami kernel function k t using eq 5 knowing c d and l ii a t using eq 11 iii the functions ki t iv the function φ t using eq 13 and v the lateral flow l c t using eq 10 in addition and in order to verify the model the calculated hydrograph l c t is routed jointly with i t using the dwe eq 8 we obtain the calculated outflow hydrograph oc t which can be compared to the measured one o t these algorithms were implemented into the modspa moussa 1991 moussa et al 2007 and the mhydas moussa et al 2002 spatially distributed hydrological models 2 4 criteria functions lateral flow l t can be either a gain l g t corresponding to l t 0 fig 1 a or a loss l l t corresponding to l t 0 fig 1b or a combination of gain and loss fig 1c in order to evaluate separately the gains and losses l t is separated into its two components l g t and l l t the calculated lateral hydrograph l c t is also separated into its two components gains l g c t corresponding to l c t 0 and losses l l c t corresponding to l c t 0 we have 15 l t l g t l l t and l c t l g c t l l c t let v l vg vl v l c vgc and vlc be the integrals corresponding to the volumes of l t l g t l l t l c t l g c t and l l c t note that vg and vgc are positive while vl and vlc are negative we have 16 v l v g v l and v l c v g c v l c let l g x l l x l g c x and l l c x be the peakflows of l g t l l t l g c t and l l c t note that l g x and l g c x are positive while l l x and l l c x are negative we have 17 l g x max l g l l x min l l l g c x max l g c and l l c x min l l c let tgx tlx tgcx and tlcx be the time of occurrence of the peakflows l g x l l x l g c x and l l c x fig 2 shows an example illustrating these variables the inflow i t is characterized by its volume vi which can be divided into two components the volume of the baseflow component vib and the volume of the surface component vis with 18 v i v i b v i s i t is also characterized by the peakflow amplitude ix and its time of occurrence tix similarly the outflow o t is characterized by its volume vo equal to the sum of inflow and lateral flow 19 v o v i v l o t is also characterized by the peakflow amplitude ox and its time of occurrence tox we characterize the time interval t l i between the time of occurrence of lateral flow peak for either gains or losses and inflow peak which reflects the relative position of the peaks t l i 0 if lateral flow peak occurs after the inflow peak t l i 0 if lateral peakflow occurs before the inflow peak and t l i 0 if both peaks are simultaneous the more negative or positive t l i value is the more the hydrographs have distinct peaks we characterize also a lag time corresponding to the time interval toi between the time of occurrence of the outflow peak ox and that of the inflow peak ix toi decreases when the celerity c increases the measured l t and the calculated l c t hydrographs are compared according to four categories of criteria functions error on volume let ε vg and ε vl be the relative errors on volume of the lateral gains l g t and lateral losses l l t 20 ε v g v g c v g v g and ε v l v l c v l v l error on peakflow let ε xg and ε xl be the relative errors on peakflow amplitude of l g t and l l t 21 ε x g l g c x l g x l g x and ε x l l l c x l l x l l x error on the time of occurrence of peakflow let ε tg and ε tl be the errors on the time of occurrence of peakflows of l g t and l l t 22 ε t g t g c x t g x and ε t l t l c x t l x the nash sutcliffe efficiency n s e l to compare the measured l t and the calculated l c t lateral flow 23 n s e l 1 t 1 τ l t l c t 2 t 1 τ l t l m 2 with l m the mean value of l t we define also the nash sutcliffe efficiency nseo comparing the measured o t and the calculated one oc t 24 n s e o 1 t 1 τ o t o c t 2 t 1 τ o t o m 2 with om the mean value of o t on the basis of experience from previous studies e g refsgaard and knudsen 1996 moussa et al 2007 we define five levels of performance table 1 excellent noted a very good b good c fair d and poor e note that ε vg ε vl ε xg ε xl n s e l and nseo are non dimensional while ε tg and ε tl have a dimension of time for these latter two criteria we define the levels of performance in comparison to toi measured on all scenarios 3 experimentation 3 1 experimental setup the experimental setup is shown in fig 3 a the experimental channel made of polymethyl methacrylate pmma extruded is 4 m long serpentine channel with four times 1 m 2 0 cm width and 4 0 cm height at the channel output there is a threshold that guaranties a minimum of 0 5 cm water height in the channel three peristaltic pumps 1 2 and 3 are used to simulate respectively the inflow i t and lateral gains l g t and lateral losses l l t the inflow is introduced at the channel input whereas both lateral gains and losses are uniformly distributed along the channel 8 tubes for each the scales 1 receives the outflow effluent the scales 2 receives the effluent from the peristaltic pump 3 that controls lateral losses the two scales 1 and 2 are connected to a data logger campbell scientific cr1000 that records the effluents mass each second which permits to deduce the flow rates of both the outflow and the lateral losses the flow ranges of the three peristaltic pumps are the following i pump 1 bt601s from 0 to 33 45 ml s 1 ii pump 2 gilson minipuls 3 from 0 to 3 70 ml s 1 and iii pump 3 gilson minipuls 3 from 0 to 3 70 ml s 1 the three pumps are related to an electronic device that controls automatically the pump flow the electronic device was developed in hydrosciences laboratory montpellier france the user can implement any variable flow scenario at the time step of one second to do this the user can put on a sd card an instruction file that traduces the desired flow scenarios for the three pumps the sd card is then introduced in the pump control device that regulates the voltage i e rotation speed of each pump according to the sd card instructions each pump flow range can be divided into 256 intervals going from zero to the maximum flow which permits to implement highly variable flow scenarios the choice of the channel length 4 m was not done arbitrarily we first tested a 0 5 m length channel 4 cm width and 4 cm height but the lag time toi was very short 5 10 s we then sought to increase the lag time by slowing down the flow with various procedures i counter slopes 2 and 4 ii higher roughness by filling the channel at 50 and 100 of the height with 8 mm glass beds iii 8 barriers 2 cm width 4 cm height uniformly distributed along the length of the 0 5 m channel all these tests gave a lag time toi similar to previously such lag time is too short to observe attenuation effects and to calculate accurately εtg and εtl at one second time step finally we adopted the 4 m channel length as shown in the experimental setup of fig 3a because its lag time toi was much longer around 65 s 3 2 scenarios inflows i t are the sum of a baseflow considered constant in time ib and a surface component is t 25 i t i b i s t is t has a hayami equation 26 i s t i 0 e z i 2 θ i t t θ i t 3 2 which needs four parameters ib l3t 1 the baseflow i0 l3t 1 a parameter regulating the amplitude of the discharge θι t the center of gravity of the hydrograph and zι a shape parameter both lateral flows gains l g t and losses l l t are also of the form of eq 26 with ib 0 and hence depend on only three parameters 27 l g t o r l l t f a 0 θ l z l with a0 θ l and z l replacing i0 θi and zi respectively where a0 0 for lateral gains and a0 0 for lateral losses we distinguish five categories of scenarios a reference without lateral flows noted r with lateral gains noted g with lateral losses noted l alternating one gain hydrograph and one loss hydrograph noted gl and lg and alternating multiple gains and losses noted glg lgl glgl lglg etc some of the experiments were done under a short duration i t signal while the others were done under long i t signal according to the following fig 3b i short duration i t signal a steady ib is imposed during 6 min in order to reach this steady condition at the channel output after that a 14 min scenario is imposed followed by 8 min of drainage the total experimental duration is then 28 min ii long duration i t signal a steady ib is imposed during 6 min in order to reach this steady condition at the channel output after that a 29 min scenario is imposed followed by 8 min of drainage the total experimental duration is then 43 min we realized 62 experimental scenarios corresponding to different shapes of i t and l t for each experiment three replicates were made and we consider the mean value of the outflow o t for the three replicates with a time step of 1 s fig 3b in model application the later outflow o t was smoothed using a moving average for ten points the supplementary material gives the characteristics of i t l t and o t the characteristics of the five categories of scenarios are i 19 reference scenarios noted r1 to r19 without any lateral flow supplementary material table s1 and figure s1 different inflows were tested corresponding to different values of the four parameters of eqs 25 and 26 ib 1 5 2 2 5 3 4 5 6 and 8 ml s 1 i0 1 5 2 2 5 3 4 5 6 8 and 16 ml s 1 θι 80 180 and 500 s zi 3 for the scenarios with lateral flows we mainly used r9 r10 and r17 that have a baseflow ib 4 ml s 1 which enables on one hand to use the gain and loss pumps to their maximum extent 3 ml s 1 and on the other hand to still have a positive outflow the volume vis of the surface component is t of the inflow i t ranges between 123 and 2945 ml the inflow peak ix between 3 3 and 23 3 ml s 1 the outflow peak ox between 2 4 and 22 4 ml s 1 and a lag time toi between 31 and 72 s ii 13 scenarios noted g1 to g13 with only lateral gains table s2 and figure s2 different lateral gains l g t were tested corresponding to different values of the three parameters of eq 27 a0 2 and 3 ml s 1 θ l 80 and 180 s z l 3 the volume of lateral gains vg ranges between 164 and 564 ml the lateral gain peak l g x between 2 4 and 3 7 ml s 1 and the outflow peak ox between 6 8 and 24 4 ml s 1 and a lag time toi between 27 and 236 s iii 5 scenarios noted l1 l9 with only lateral losses table s3 and figure s3 different lateral losses l l t were tested corresponding to different values of the three parameters of eq 27 a0 2 and 3 ml s 1 θ l 80 and 180 s z l 3 the volume of lateral losses vl ranges between 164 and 537 ml the lateral loss peak l l x between 2 4 and 3 7 ml s 1 and the outflow peak ox between 5 0 and 19 8 ml s 1 and a lag time toi between 39 and 97 s iv 17 scenarios combining one lateral gain hydrograph and one lateral loss hydrograph table s4 and figure s4 10 scenarios with gains followed by losses noted gl1 to gl10 and 7 scenarios with losses followed by gains noted lg1 to lg7 gains gi and losses li were tested with different parameters of eq 26 the volume of lateral flow v l ranges between 164 and 244 ml the volume of lateral gains vg between 14 and 432 ml the volume of lateral losses vl between 129 and 432 ml the peak of lateral gains l g x between 0 5 and 3 7 ml s 1 the peak of lateral losses l l x between 1 1 and 3 7 ml s 1 and the outflow peak ox between 5 7 and 11 2 ml s 1 the majority of these scenarios has equal volumes of gains and losses with v l vg vl 0 but differs in the order of occurrence of l g t and l l t their time of occurrence and their amplitude l g x and l l x v 8 scenarios combining multiple gain and loss hydrographs table s5 and figure s5 1 scenario glg noted glg1 2 scenarios glgl noted glgl1 and glgl2 and 5 scenarios lglg noted lglg1 to lglg5 these are more complicated scenarios of lateral flow with a series of alternating gains and losses the volume of lateral flow v l ranges between 0 and 250 ml the volume of lateral gains vg between 125 and 743 ml the volume of lateral losses vl between 125 and 743 ml the peak of lateral gains l g x between 2 6 and 3 7 ml s 1 the peak of lateral losses l l x between 2 6 and 3 7 ml s 1 and the outflow peak ox between 6 4 and 10 6 ml s 1 3 3 domain of application of the dwe before applying any hydraulic model we need to verify its domain of application therefore laboratory scale experiments are a powerful tool to check the model hypotheses and its domain of application since field data are very scarce and difficult to get especially for flood events hydraulic modellers usually rely on laboratory scale experiments to validate their models of course this does not mean that a successful model on a laboratory scale experiment would necessary be successful on real domain because the extrapolation from laboratory scale to real scale needs to verify and respect the laws of similitude based on the conservation of non dimensional hydraulic numbers e g froude and reynolds numbers therefore the success of a model on a laboratory scale is a necessary condition but not a sufficient one in this paper we focus on the validation of the model on laboratory scale which is a necessary condition before transferring it to a larger scale which is the next step in our study case of the dwe moussa and bocquillon 1996a established the domain of application of the dwe when the acceleration terms neglected in the saint venant equation are lower than 5 as 28 v g t s 0 011 where v lt 1 is the velocity calculated using the manning formula s is the slope t t is the wave length and g 9 81 m s² is the gravity acceleration eq 28 was deduced on the basis of a propagation of a theoretical small wave and an analysis using non dimensional hydraulic numbers on our experimental channel we made experimentation under steady state regime and we established a relationship between water depth and discharge we calculated a slope s 0 0016 and an average value of the manning strickler coefficient n 0 027 sm 1 3 which is consistent with a clean straight plastic channel for each scenario characterized by an inflow outflow and lateral flow we calculate the non dimensional term v gts for different values of the discharge the wave length can be estimated by adjusting a sinusoid on inflow outflow and lateral flow and can be approximated as t 2θ all inflows and outflows corresponding to the reference scenarios ri table s1 with long wave lengths θ 180 or 500 s r1 r3 r5 r7 r9 r11 r13 r15 r17 r18 and r19 verify eq 28 with values of v gts ranging between 0 002 and 0 010 for inflows and outflows corresponding to the reference scenarios ri with wave lengths θ 80 s eq 28 is verified for scenarios r2 r4 r6 r8 r10 and r12 with low values of ix and ox corresponding to low values of the velocity for the two remaining scenarios r14 and r16 v gts ranges between 0 007 and 0 014 note that v gts 0 014 corresponds to the case when acceleration terms in the saint venant represent around 8 of the value of all terms in the momentum equation moussa and bocquillon 1996a we observe similar results for the other scenarios with lateral gains and losses the domain of application of the dwe eq 28 is verified for all scenarios except for some scenarios with short wave lengths for lateral gains and losses such in scenarios lglg3 lglg4 and lglg5 where v gts ranges between 0 008 and 0 020 in the applications the scenarios r8 r9 r10 r17 r18 and r19 are generally used as inflows and in all these cases the domain of application of the dwe eq 28 is verified 4 results and discussion 4 1 sensitivity analysis one of the main difficulties of solving an inverse problem is the appearance of numerical instabilities when calculating l c t fig 4 a shows an example of lc t obtained with a time step of calculation of 1 s we observe important oscillations due to the numerical solution in order to reduce and avoid these oscillations l c t was smoothed using a moving average as shown in fig 4b c and d for 3 5 and 15 s window duration respectively we observe that the oscillation amplitude decreases when the window of the moving average increases and disappears totally around a value of 15 s finally in all applications we used a time step of calculation of 1 s similar to the time step of measurements followed by smoothing l c t using a moving average on a 15 s window the two parameters of the dwe are c and d a sensitivity analysis of the model for these two parameters was conducted as shown in fig 5 using the inverse problem solution l c t knowing i t an o t fig 5a around a reference solution c0 0 085 ms 1 and d0 0 135 m²s 1 in two cases i varying c c0 3 c0 2 c0 2c0 and 3c0 with a fixed d d0 fig 5b ii varying d d0 3 d0 2 d0 2d0 and 3d0 with a fixed c c0 fig 5c we observe that the model is more sensitive to the parameter c than d because varying c by a factor of 3 has a stronger impact on the results than varying d by the same factor these observations are in agreement with the literature moussa and bocquillon 1996b cheviron and moussa 2016 note that when routing each of the calculated l c t with the corresponding couple c and d we obtain a calculated oc t with an nseo comparing o t and oc t higher than 0 99 this result reflects two points first the dwe with lateral flow uniformly distributed under the hayami hypotheses is well adapted to simulate the outflow second for each set of the parameters c d we obtain a different shape of l c t however when i t and l c t are routed using the dwe with the corresponding c d we obtain excellent model performances with an nseo comparing the measured o t and the calculated oc t higher than 0 98 in all cases this last result reflects that different sets of c d and l c t can give the same outflow o t 4 2 model calibration different calibration validation strategies can be conducted first the calibration of the two parameters c and d was conducted separately on each of the 19 reference scenarios ri using the hayami solution of the dwe without lateral flow section 2 1 eq 4 the calibrated values of c and d and the corresponding nseo are shown in the last three columns of table s1 in the supplemetary material the performance criteria nseo is higher than 0 99 for 17 events and equal to 0 987 and 0 98 for the remaining two events these results show that the dwe and particularly the hayami solution under the hypotheses that c and d are constants is well adapted to the experimentation fig 6 shows the results on the 3 reference scenarios r9 r10 and r17 mostly used in scenarios with lateral flow oc t and o t are almost superposed second the calibration of the two parameters c and d was conducted separately on each of the remaining events with lateral gains and or losses for the 13 scenarios with lateral gains gi all scenarios have nseo higher than 0 99 for the 5 scenarios with lateral gains li 4 scenarios have nseo higher than 0 99 and equal to 0 97 for the remaining one for the 17 scenarios with lateral gains and losses gli and lgi 15 scenarios have nseo higher than 0 99 and equal to 0 98 for the remaining two for the 8 scenarios with multiple lateral gains and losses glgi glgli and lglgi 6 scenarios have nseo higher than 0 99 and equal to 0 98 for the remaining two these results confirm that the dwe and its hayami solution are well adapted to the experimentation with time variable lateral flow uniformly distributed along the channel 4 3 model validation for the validation of the inverse model we used all scenarios with lateral flow with gains gi with losses li alternating one gain and one loss gli and lgi alternating multiple gains and losses glgi lglgi and glgli each inflow i t for the validation scenario possesses the form of one of the calibrated references r1 to r19 table s1 and the corresponding calibrated values of c and d in table s1 are used all detailed results are given in the supplementary material i for the 13 scenarios with gains gi table s6 and figure s2 ii for the 5 scenarios with losses li table s7 and figure s3 iii for the 17 scenarios alternating gains and losses gli and lgi table s8 and figure s4 iv for the 8 scenarios alternating multiple gains and losses table s9 and figure s5 table 2 synthesizes all error criteria defined in section 2 4 on all scenarios and fig 7 shows examples comparing measured l t with calculated l c t lateral flow and measured o t with calculated oc t outflow the errors on volumes i for gains εvg is excellent very good or good for 37 scenarios among 38 15 excellent 17 very good and 5 good noted 15a 17b 5c and poor for the remaining scenario ii for losses εvl is excellent very good or good for 29 scenarios among 30 7a 15b and 7c and fair for the remaining scenario the errors on peakflow i for gains εxg is excellent very good or good for 32 scenarios among 38 6a 12b 14c and fair for the remaining 6 scenarios ii for losses εxl is excellent very good or good for 24 scenarios among 30 1a 12b 11c and fair or poor for the remaining 6 scenarios the errors on the time of occurrence of peakflow i for gains εtg is excellent very good or good for 33 scenarios among 38 15a 11b 7c and fair for the remaining 5 scenarios ii for losses εxl is excellent very good or good for 27 scenarios among 30 9a 11b 7c and fair for the remaining 3 scenarios the n s e l comparing the measured and calculated lateral flow is excellent very good or good for 39 scenarios among 43 20a 16b 3c and fair or poor for the remaining 4 scenarios the nseo comparing the measured and calculated outflow is higher than 0 96 for all 43 scenarios 4 4 uncertainty analysis in practical applications on natural or experimental channels we need a diagnosis tool to evaluate lateral flow even with uncertainty hence uncertainty analysis must be conducted in order to evaluate the impact of the approximations on modelling approach and parameters estimation on the calculated lateral flow l c t approximations on modelling concern not only the domain of application of the dwe under the hayami conditions c and d constant and the hypothesis of lateral flow uniformly distributed along the channel but also the approximations when using the laplace transforms moussa 1996 to calculate the analytical solution of the inverse problem eqs 10 and 13 approximations on model parameters concern the errors on the estimated values of the two parameters c and d another source of uncertainty concerns the measured inflows and outflows hence we conduct uncertainty analysis on model parameters the measured inflow and the measured outflow first for the uncertainty analysis on model parameters various approaches can be used to estimate c and d either using hydraulic formulas moussa and bocquillon 1996a delestre et al 2013 or calibrating c and d on inflow outflow flood events as in the previous two sections a third more simplified approach consists on establishing empirical relationships between the parameters c and d and some descriptors of the flow as an example we consider the peak inflow ix as a descriptor of the range of discharge fig 8 shows the relationship between c and ix and between d and ix obtained from the calibration conducted on the 19 reference scenarios ri we observe that c and d increase when ix increases which is consistent with hydraulic laws we can adjust simple linear relationships 29 c 0 0043 i x 0 0359 a n d d 0 0016 i x 0 1276 we obtain r² 0 84 and 0 46 respectively the uncertainty analysis can then be conducted for each validation scenario first c and d are calculated using eq 29 then we run the inverse model solution to calculate the lateral flow l c t using different values of c and d ranging in the intervals 1 α c 1 α c and 1 α d 1 α d α being a parameter characterizing the range of uncertainty on c and d fig 9 shows an example of applications on four scenarios g13 l2 gl8 and lglg1 representing each of the four studied scenario categories we consider α 0 25 and then we run 50 simulations selecting randomly c in the interval 0 75c 1 25c and d in 0 75d 1 25d we observe that despite the approximations on the estimated values of the parameters c and d the model enables to reproduce for all four scenario categories the global shape of the hydrograph the amplitude of the peakflow the time of occurrence of the peakflow and mainly the alternation between gains and losses this can be observed especially in the examples gl8 and lglg1 where the total volume of lateral flow is nil but with an alternation of one gain and one loss for gl8 and loss gain loss gain for lglg1 second we conduct three uncertainty analysis on inflows and or outflows i inflow 10 we run the model in three different cases corresponding to three different inflows 0 9 i t i t and 1 1 i t with o t and the calibrated set of parameters c and d ii outflow 10 we run the model in three different cases corresponding to three different outflows 0 9 o t o t and 1 1 o t with i t and the calibrated set of parameters c and d iii simultaneously on inflow 5 and outflow 5 we run the model for nine different cases corresponding to three different inflows 0 95 i t i t and 1 05 i t three different outflows 0 95 o t o t and 1 05 o t and the calibrated set of parameters c and d applications were conducted on the same four scenarios g13 l2 gl8 and lglg1 as previously and results are shown in supplementary material figures s6 s7 and s8 we observe that the inverse model is able to reproduce the dynamic of the simulated lateral hydrographs while the error on the simulated lateral volume increases due to uncertainty on inflow and or outflow the error on the time of occurrence of the peak of lateral flow gains or losses remains low and slightly higher than the value obtained when using i t and o t these results confirm that despite uncertainties on inflows and or outflows the hayami dwe inverse model is robust and enables to reproduce complex dynamics of lateral flow 4 5 discussion lateral flow is one of the major hydrological processes and can be observed at different spatial scales from runoff genesis on hillslopes to flood routing in the channel network it results from complex interactions channel hillslope channel aquifer channel flood zone but also due to anthropogenic water management pumping or rejects it can be either gains to the channel positive or losses from the channel negative but generally a succession of multiple gains and losses the main problem remains in the difficulty to measure lateral flow because experimentations can hardly be conducted in situ therefore there is a need to evaluate lateral flow gains and losses under non steady state conditions during flood events in both natural and anthropogenic systems at different spatial scales this study uses a coupled experimental modelling approach to evaluate lateral flow temporal evolution i an experimental approach measuring the inflow i t the outflow o t and lateral flow l t ii the resolution of the dwe inverse problem with lateral flow uniformly distributed using hayami s hypotheses the 62 scenarios studied cover a large panel of hydrograph shapes wave length peakflow and lateral flow gains and losses occurrence and amplitude for the four error criteria εvg εxg εtg and nsel we obtain excellent very good or good results for approximately 90 of the scenarios tested with nse 0 85 for 84 of the 43 scenarios with lateral flow these results reflect the ability of the inverse model to reproduce the lateral flow hydrograph dynamics its two components gains and losses and the corresponding volumes peakflows and times of occurrence of peakflows note that complicated lateral flow hydrographs e g gli lgi or multiple gains and losses figs 7 and 9 are also well reproduced for example in the particular case where the total volume of lateral flow is nil with equal volumes of gains and losses e g scenarios gl2 to gl10 lg3 to lg7 glgl1 glgl2 and lglg1 to lglg5 tables s4 and s5 the model identifies the alternation of gains and losses and gives very good evaluation of the hydrograph shape the scenarios with fair or poor performance criteria correspond either to scenarios where lateral flow volume is small compared to the inflow e g g3 l2 l3 and lg2 scenarios where numerical oscillations appears e g g6 and g7 or events with short wave lengths where the domain of application of the diffusive wave is not valid e g lglg4 and lglg5 see some examples on fig 7 these fair or poor simulations can be improved by calibrating the model parameters c and d on scenarios with gains and losses and not only on the reference scenarios ri the excellent results of nseo table 2 show that despite the approximations in the analytical solution of the inverse problem flood routing using dwe hayami solution under the hypothesis of c and d constants and with lateral flow uniformly distributed enables to reproduce the measured outflow the domain and limits of application of the solution of the dwe inverse problem model show the very good performance of dwe for a large panel of scenarios corresponding to long wave lengths the degradation of model performance occurs for scenarios with short wave lengths and in the cases of low volumes of lateral gains and losses in comparison with inflow finally uncertainty analysis fig 9 shows that even with a simplified approach to estimate the two parameters c and d the inverse dwe model can be used as a diagnosis tool that is able to detect the lateral flow hydrograph global shape as well as the alternation of gains and losses with a good approximation of their corresponding volumes and peakflows 5 conclusion a coupled experimental inverse modelling approach was developed to validate the analytical solution of the inverse problem of the dwe equation with lateral flow uniformly distributed along the channel the first result of this study was the development of a novel experimental design representing inflow and lateral flow hydrographs gains and losses uniformly distributed along a channel the experimental design was conceived and built so that i t o t and l t are highly controlled at 1 s time step 62 experimental hydrograph scenarios corresponding to different shapes of i t and l t were conducted on a 4 m laboratory channel in order to meet the hypotheses of the dwe model long wave length and its resolution by the hayami model constant values of the celerity c and the diffusivity d the experimentation is also characterized by short time duration low water consumption and high precision which enables a large variety of accurate reliable and reproducible hydrograph scenarios the second result is the validation of the analytical solution of the inverse problem of the dwe with lateral flow uniformly distributed along the channel proposed by moussa 1996 whereas a large number of time varying hydrograph scenarios is necessary to validate this modelling approach this method is an easy to use analytical solution for identifying the lateral flow hydrograph knowing the inflow the outflow and the model parameters c and d the domain and limits of application of the solution of the inverse problem of the dwe were discussed validating the limits of the dwe model for short wave lengths the limitations of the inverse problem dwe solution due to numerical oscillations and in the case of low volumes of lateral gains and losses in comparison with inflow the coupled experimental modelling approach proposed herein opens promising perspectives regarding the evaluation of lateral flow characteristics on real channels lateral flow gains and losses their volumes their durations and their peak amplitudes acknowledgement the authors thank jean philippe chazarin from the laboratory hydrosciences montpellier france for his help in developing the electronic devices used in the experiments supplementary materials supplementary material associated with this article can be found in the online version at doi 10 1016 j advwatres 2019 03 009 appendix b supplementary materials image application 1 image application 2 appendix a list of symbols a0 parameter for the calculation of l t l3t 1 c celerity lt 1 d diffusivity l²t 1 g acceleration due to gravity g 9 81 ms 2 lt 2 i t measured inflow l3t 1 ib baseflow component of i t l3t 1 is t surface component of i t l3t 1 ix inflow peak l3t 1 i0 parameter for the calculation of is t l3t 1 l channel length l l t measured lateral flow l3t 1 l c t calculated lateral flow l3t 1 l g t measured lateral gains corresponding to l t 0 l g c t calculated lateral gains corresponding to l c t 0 l g c x peakflow of l g c t l3t 1 l g x peakflow of l g t l3t 1 l l t measured lateral losses corresponding to l t 0 l l c t calculated lateral losses corresponding to l c t 0 l l c x peakflow of l l c t l3t 1 l l x peakflow of l l t l3t 1 k t hayami kernel function n manning strickler roughness coefficient tl 1 3 n s e l nash sutcliffe efficiency criteria comparing l t and l c t nseo nash sutcliffe efficiency criteria comparing o t and oc t o t measured outflow l3t 1 oc t calculated outflow l3t 1 ox outflow peak l3t 1 q t discharge l3t 1 s river bed slope t time t t wave length t tgcx time of occurrence of l g c x t tgx time of occurrence of l g x t tix time of occurrence of ix t t l i time interval between the of the time of occurrence of lateral flow peak and inflow peak t tlcx time of occurrence of l l c x t tlx time of occurrence of l l x t toi time interval between the time of occurrence of ox and ix t tox time of occurrence of ox t v flow velocity lt 1 vg volume of l g t l3 vgc volume of l g c t l3 vi volume of i t l3 vib volume of ib t l3 vis volume of is t l3 vl volume of l l t l3 vlc volume of l l c t l3 v l volume of l t l3 v l c volume of l c t l3 vo volume of o t l3 x length along the channel l zi shape parameter of is t in eq 26 z l shape parameter of l t in eq 27 ε tg time error on the time of occurrence of the peakflow of lateral gains t ε tl time error on the time of occurrence of the peakflow of lateral losses t ε vg relative error on volume of lateral gains ε vl relative error on volume of lateral losses ε xg relative error on peakflow of lateral gains ε xl relative error on peakflow of lateral losses θi parameter representing the time position of the centre of gravity of is t in eq 26 t θ l parameter representing the time position of the centre of gravity of l t in eq 27 t 
670,lateral flow l t is a major process during flood events which can be either gains positive or losses negative to the channel the inverse problem consists of evaluating l t knowing the inflow i t and the outflow o t on a channel however l t is very difficult to measure on real channels and we are always not sure to which extent the evaluated l t is close to the real one this paper aims at evaluating l t in a channel using the analytical solution of the inverse problem of the hayami diffusive wave equation dwe with l t uniformly distributed along the channel we conceived and built a novel experimental channel where i t o t and l t are highly controlled at 1 s time step and we realize 62 experimental hydrograph scenarios corresponding to different shapes of i t and l t we validate the hypotheses of both the dwe hayami model and the corresponding inverse model with very high criteria functions values for a large majority of scenarios which reflects the ability of the dwe inverse model to reproduce complex lateral flow hydrograph dynamics we discuss the limits of application of the dwe especially for short wave lengths the coupled experimental modelling approach proposed herein opens promising perspectives regarding the evaluation of lateral flow on real channels keywords diffusive wave equation dwe inverse problem hayami equation uniformly distributed lateral flow experimental channel 1 introduction during flood events lateral flow is one of the major processes along a channel reach lateral flow can be either gains to the channel considered as positive values such as surface runoff on hillslopes or aquifer contribution to the flow or losses from the channel considered as negative values such as overbank flow or infiltration to the aquifer lateral flow can also be due to anthropogenic water management such as water pumping or rejects despite recent progresses in measurements lateral flow cannot be measured and experimentations cannot be conducted in situ due to the difficulty to control all exchanges along a channel reach interactions channel hillslope channel aquifer channel flood zone hence in practical applications hydrological models are often used for lateral flow hydrograph simulation and the saint venant equations saint venant 1871 for non steady free surface flow routing in rivers with lateral flow e g morris 1980 moussa and bocquillon 1996a moramarco et al 1999 delestre et al 2013 usace 2016 finite difference e g moussa and bocquillon 1996a b finite element e g hauke 2002 szymkiewicz and gasiorowski 2012 villaret et al 2013 finite volume e g goutal and maurel 2002 guinot 2009 benkhaldoun and seaïd 2010 xing and shu 2011 hodges 2019 or hybrid finite volume finite difference e g lai and khan 2018 numerical methods are generally used to solve the saint venant equations however the inverse problem consisting of calculating the lateral flow hydrograph knowing inflow and outflow hydrographs on a channel remains an unsolved problem and one of the major challenges in hydrological and hydraulic modelling see a detailed review in moussa and cheviron 2015 cheviron and moussa 2016 in most practical applications of flood routing the acceleration terms in the saint venant equations can be neglected and the equation system is reduced to the well known diffusive wave equation dwe which was largely studied in the literature e g woolhiser and liggett 1967 ponce et al 1978 ponce 1990 singh and aravamuthan 1995 sivapalan et al 1997 yen and tsai 2001 chang and yeh 2015 the dwe has two parameters celerity and diffusivity taken as function of the discharge numerical methods such as finite difference methods are generally used to solve the dwe with lateral flow blandford and ormsbee 1993 moussa and bocquillon 1996b 2009 moramarco and singh 2002 kazezyılmaz alhan 2012 fan and li 2006 extended the solution of the dwe for open channel flows with uniform and concentrated lateral flow and more recently cimorelli et al 2014 proposed solutions of the dwe accounting for downstream boundary condition and uniform lateral flows spada et al 2017 estimated the lateral flow and also the discharge hydrographs at the upstream and downstream channel ends through the reverse routing modelling and solving the saint venant equations in diffusive form however when using numerical resolution methods numerical instabilities e g oscillations and divergence problems are encountered moussa and bocquillon 1996b on semi infinite reach if celerity and diffusivity can be assumed constant and if lateral flow is nil the dwe has an analytical solution unconditionally stable the hayami 1951 model wang et al 2014 improved the resolution technique using a discrete hayami convolution method moussa 1996 extended the hayami analytical solution to the case of uniformly distributed lateral flow and moreover proposed an analytical solution of the inverse problem in the particular case of the hayami hypotheses the inverse problem consists of calculating the lateral flow hydrograph under the hypothesis of lateral flow uniformly distributed along the channel using both the inflow and the outflow as inputs of the model and knowing the two parameters celerity and diffusivity this method is an easy to use analytical solution recently used by charlier et al 2015 as a diagnosis tool for evaluating lateral flows in karstic regions and extended by cholet et al 2017 for evaluating simultaneously the lateral flow hydrograph and the corresponding solute concentration however in all these applications no validation was possible because no experimentation can be conducted to measure lateral flow hydrograph in order to compare the modelled lateral flow to the measured one the validation of the model of the inverse problem needs necessarily measured experimental data of the lateral flow in order to validate the domain of application of the modelling approach the hayami hypotheses and the approximations used to get the solution of the inverse problem in the literature hydraulic model experiments were carried whether on small laboratory experimental channels e g vinatier et al 2017 or on real scale channels e g newson 2002 errico et al 2018 rudi et al 2018 these experiments had various purposes according to project features impact of vegetation on hydraulic resistance e g defina and peruzo 2010 vinatier et al 2017 errico et al 2018 impact of dikes on inundation e g ettema and muste 2004 impact of land use change and river management on floods e g jung et al 2012 or for river ecosystem management newson 2002 the experiment size should verify hydraulic laws of similitude and the full saint venant equations are generally used for hydraulic modelling chanson 1999 heller 2011 green 2014 however these studies were generally conducted without lateral flows gains and losses to our knowledge no experiments were done under the hypotheses of the dwe with uniformly lateral flows gains and losses under highly controlled time varying inflows and lateral flows it follows that we can rarely find a variety of time varying hydrograph scenarios that meet the hypotheses of the dwe and its resolution by the hayami model whereas a large number of time varying hydrograph scenarios is necessary to validate this modelling approach there is a need for rational experiments characterized by short time duration low water consumption high precision and large variety of hydrograph scenarios this paper aims at evaluating the lateral flow hydrograph in an experimental channel using the analytical solution of the inverse problem of the hayami diffusive wave equation dwe with time varying lateral flow uniformly distributed along the channel proposed by moussa 1996 unfortunately this model was never tested on real cases with measured lateral gains and losses however the model gave promising results in the understanding and the estimation of time varying lateral flows during flood events on real cases where only inflows and outflows were measured moussa 1996 charlier et al 2015 cholet et al 2017 but a large set of well controlled hydrographs inflow lateral gains or losses is needed to validate the hypotheses of both the dwe hayami model and the corresponding inverse model i e verification of the domain of application of the dwe celerity and diffusivity constants during the flood event time varying lateral flow uniformly distributed along the channel validation of the inverse model equations for real case applications there is a gap of information on the spatial distribution of lateral flow however the hypothesis of time variable and uniformly distributed lateral flow is the simplest for which an analytical solution of the inverse model exists the ideal would be to test the model on a real case study however there is a complete lack of data acquisition of lateral gains and losses during flood events this lack is due to the extreme difficulty long experimentation time during years material and human cost of measuring simultaneously gains from surface runoff exchange between the channel and groundwater and eventual losses by overbank flow therefore it was a challenge for us to meet the aforementioned natural processes in a laboratory scale experiment that must present the following properties p1 short time experimentation this implies low consumption of water as well as realizing several replicates of a same experiment which is necessary to obtain accurate reliable and reproducible experimental scenarios p2 well controlled hydrographs this implies reproducing time variable hydrographs at 1 s time step with exact discharge values p3 the use of hydrographs of p2 as the basis for scenarios of inflows representing the flood event lateral gains and or lateral losses p4 lateral gains and lateral losses should be uniformly distributed along the channel in space but variable in time according to different scenarios p5 the different hydrographs inflow gains and losses must be simultaneously controlled by a suitable automatic electronic device to address p1 to p5 we use an experimental channel length 4 m where inflow outflow and lateral flow gains and losses are highly controlled at a time step of 1 s and where a large number of time varying hydrograph scenarios were implemented by high precision peristaltic pumps the paper is organized into four sections section 2 presents the dwe with lateral flow the inverse problem and the criteria functions section 3 presents the experimental setup hydrograph scenarios and discusses the domain of application of the dwe section 4 presents the results of model sensitivity analysis model calibration and model validation strategies as well as uncertainty analysis and a discussion on the limit of application of the dwe inverse problem section 5 presents the conclusion appendix a gives the list of symbols the supplementary material gives the characteristics of experimental scenarios and additional results on uncertainty analysis 2 diffusive wave equation dwe 2 1 diffusive wave equation without lateral flow the saint venant equations saint venant 1871 of continuity and momentum are generally used to describe unsteady flow in rivers within this basic model different authors e g ponce and simons 1977 daluz vieira 1983 moussa and bocquillon 1996a classified river waves as dynamic gravity diffusion dwe or kinematic waves corresponding to different terms of the momentum equation in most practical applications of flood routing in natural channels the acceleration terms in the saint venant equations can be neglected and the system is reduced to the dwe moussa and bocquillon 1996a the dwe without lateral flow can be written as 1 q t c q q x d q 2 q x 2 0 where x l is the length along the channel t t is the time and the celerity c q lt 1 and the diffusivity d q l2t 1 are functions of the discharge q l3t 1 let i t and o t be the upstream inflow minus the baseflow and the downstream outflow minus the baseflow respectively 2 i t q 0 t q 0 0 3 o t q l t q l 0 with l l the channel length in the particular case of a semi infinite channel no physical downstream boundary condition exists and c q and d q are constant and the dwe has as solution the analytical hayami 1951 equation 4 o t 0 t i t τ k τ d τ i t k t the symbol represents the convolution relation and k t is the hayami kernel function defined as 5 k t l 2 π d 1 2 e c l 4 d 2 l c t c t l t 3 2 2 2 diffusive wave equation with lateral flow the dwe with lateral flow can be written as 6 q t c q q x q d q 2 q x 2 q x 0 the term q x t l2t 1 represents the lateral flow distribution let l t be the lateral inflow hydrograph 7 l t 0 l q x t d x moussa 1996 extended the solution of the dwe under hayami s hypotheses semi infinite channel c q and d q are constant to the case where lateral flows are uniformly distributed along the channel 8 o t φ t i t φ t k t where 9 φ t c l 0 t l θ l 0 d θ and so 10 l t l 0 l c d φ d t 2 3 inverse problem the inverse problem proposed by moussa 1996 enables the evaluation of the temporal distribution of the lateral flow l t over the channel reach by knowing i t and o t let 11 a t o t i t k t inserting eq 11 into 8 gives 12 φ t φ t k t a t using the laplace transforms an approximation of the solution of eq 12 is 13 φ t a t a t i 1 k i t with 14 k i t k k k i t i m e s then the lateral flow can be easily evaluated noted l c t by calculating i the hayami kernel function k t using eq 5 knowing c d and l ii a t using eq 11 iii the functions ki t iv the function φ t using eq 13 and v the lateral flow l c t using eq 10 in addition and in order to verify the model the calculated hydrograph l c t is routed jointly with i t using the dwe eq 8 we obtain the calculated outflow hydrograph oc t which can be compared to the measured one o t these algorithms were implemented into the modspa moussa 1991 moussa et al 2007 and the mhydas moussa et al 2002 spatially distributed hydrological models 2 4 criteria functions lateral flow l t can be either a gain l g t corresponding to l t 0 fig 1 a or a loss l l t corresponding to l t 0 fig 1b or a combination of gain and loss fig 1c in order to evaluate separately the gains and losses l t is separated into its two components l g t and l l t the calculated lateral hydrograph l c t is also separated into its two components gains l g c t corresponding to l c t 0 and losses l l c t corresponding to l c t 0 we have 15 l t l g t l l t and l c t l g c t l l c t let v l vg vl v l c vgc and vlc be the integrals corresponding to the volumes of l t l g t l l t l c t l g c t and l l c t note that vg and vgc are positive while vl and vlc are negative we have 16 v l v g v l and v l c v g c v l c let l g x l l x l g c x and l l c x be the peakflows of l g t l l t l g c t and l l c t note that l g x and l g c x are positive while l l x and l l c x are negative we have 17 l g x max l g l l x min l l l g c x max l g c and l l c x min l l c let tgx tlx tgcx and tlcx be the time of occurrence of the peakflows l g x l l x l g c x and l l c x fig 2 shows an example illustrating these variables the inflow i t is characterized by its volume vi which can be divided into two components the volume of the baseflow component vib and the volume of the surface component vis with 18 v i v i b v i s i t is also characterized by the peakflow amplitude ix and its time of occurrence tix similarly the outflow o t is characterized by its volume vo equal to the sum of inflow and lateral flow 19 v o v i v l o t is also characterized by the peakflow amplitude ox and its time of occurrence tox we characterize the time interval t l i between the time of occurrence of lateral flow peak for either gains or losses and inflow peak which reflects the relative position of the peaks t l i 0 if lateral flow peak occurs after the inflow peak t l i 0 if lateral peakflow occurs before the inflow peak and t l i 0 if both peaks are simultaneous the more negative or positive t l i value is the more the hydrographs have distinct peaks we characterize also a lag time corresponding to the time interval toi between the time of occurrence of the outflow peak ox and that of the inflow peak ix toi decreases when the celerity c increases the measured l t and the calculated l c t hydrographs are compared according to four categories of criteria functions error on volume let ε vg and ε vl be the relative errors on volume of the lateral gains l g t and lateral losses l l t 20 ε v g v g c v g v g and ε v l v l c v l v l error on peakflow let ε xg and ε xl be the relative errors on peakflow amplitude of l g t and l l t 21 ε x g l g c x l g x l g x and ε x l l l c x l l x l l x error on the time of occurrence of peakflow let ε tg and ε tl be the errors on the time of occurrence of peakflows of l g t and l l t 22 ε t g t g c x t g x and ε t l t l c x t l x the nash sutcliffe efficiency n s e l to compare the measured l t and the calculated l c t lateral flow 23 n s e l 1 t 1 τ l t l c t 2 t 1 τ l t l m 2 with l m the mean value of l t we define also the nash sutcliffe efficiency nseo comparing the measured o t and the calculated one oc t 24 n s e o 1 t 1 τ o t o c t 2 t 1 τ o t o m 2 with om the mean value of o t on the basis of experience from previous studies e g refsgaard and knudsen 1996 moussa et al 2007 we define five levels of performance table 1 excellent noted a very good b good c fair d and poor e note that ε vg ε vl ε xg ε xl n s e l and nseo are non dimensional while ε tg and ε tl have a dimension of time for these latter two criteria we define the levels of performance in comparison to toi measured on all scenarios 3 experimentation 3 1 experimental setup the experimental setup is shown in fig 3 a the experimental channel made of polymethyl methacrylate pmma extruded is 4 m long serpentine channel with four times 1 m 2 0 cm width and 4 0 cm height at the channel output there is a threshold that guaranties a minimum of 0 5 cm water height in the channel three peristaltic pumps 1 2 and 3 are used to simulate respectively the inflow i t and lateral gains l g t and lateral losses l l t the inflow is introduced at the channel input whereas both lateral gains and losses are uniformly distributed along the channel 8 tubes for each the scales 1 receives the outflow effluent the scales 2 receives the effluent from the peristaltic pump 3 that controls lateral losses the two scales 1 and 2 are connected to a data logger campbell scientific cr1000 that records the effluents mass each second which permits to deduce the flow rates of both the outflow and the lateral losses the flow ranges of the three peristaltic pumps are the following i pump 1 bt601s from 0 to 33 45 ml s 1 ii pump 2 gilson minipuls 3 from 0 to 3 70 ml s 1 and iii pump 3 gilson minipuls 3 from 0 to 3 70 ml s 1 the three pumps are related to an electronic device that controls automatically the pump flow the electronic device was developed in hydrosciences laboratory montpellier france the user can implement any variable flow scenario at the time step of one second to do this the user can put on a sd card an instruction file that traduces the desired flow scenarios for the three pumps the sd card is then introduced in the pump control device that regulates the voltage i e rotation speed of each pump according to the sd card instructions each pump flow range can be divided into 256 intervals going from zero to the maximum flow which permits to implement highly variable flow scenarios the choice of the channel length 4 m was not done arbitrarily we first tested a 0 5 m length channel 4 cm width and 4 cm height but the lag time toi was very short 5 10 s we then sought to increase the lag time by slowing down the flow with various procedures i counter slopes 2 and 4 ii higher roughness by filling the channel at 50 and 100 of the height with 8 mm glass beds iii 8 barriers 2 cm width 4 cm height uniformly distributed along the length of the 0 5 m channel all these tests gave a lag time toi similar to previously such lag time is too short to observe attenuation effects and to calculate accurately εtg and εtl at one second time step finally we adopted the 4 m channel length as shown in the experimental setup of fig 3a because its lag time toi was much longer around 65 s 3 2 scenarios inflows i t are the sum of a baseflow considered constant in time ib and a surface component is t 25 i t i b i s t is t has a hayami equation 26 i s t i 0 e z i 2 θ i t t θ i t 3 2 which needs four parameters ib l3t 1 the baseflow i0 l3t 1 a parameter regulating the amplitude of the discharge θι t the center of gravity of the hydrograph and zι a shape parameter both lateral flows gains l g t and losses l l t are also of the form of eq 26 with ib 0 and hence depend on only three parameters 27 l g t o r l l t f a 0 θ l z l with a0 θ l and z l replacing i0 θi and zi respectively where a0 0 for lateral gains and a0 0 for lateral losses we distinguish five categories of scenarios a reference without lateral flows noted r with lateral gains noted g with lateral losses noted l alternating one gain hydrograph and one loss hydrograph noted gl and lg and alternating multiple gains and losses noted glg lgl glgl lglg etc some of the experiments were done under a short duration i t signal while the others were done under long i t signal according to the following fig 3b i short duration i t signal a steady ib is imposed during 6 min in order to reach this steady condition at the channel output after that a 14 min scenario is imposed followed by 8 min of drainage the total experimental duration is then 28 min ii long duration i t signal a steady ib is imposed during 6 min in order to reach this steady condition at the channel output after that a 29 min scenario is imposed followed by 8 min of drainage the total experimental duration is then 43 min we realized 62 experimental scenarios corresponding to different shapes of i t and l t for each experiment three replicates were made and we consider the mean value of the outflow o t for the three replicates with a time step of 1 s fig 3b in model application the later outflow o t was smoothed using a moving average for ten points the supplementary material gives the characteristics of i t l t and o t the characteristics of the five categories of scenarios are i 19 reference scenarios noted r1 to r19 without any lateral flow supplementary material table s1 and figure s1 different inflows were tested corresponding to different values of the four parameters of eqs 25 and 26 ib 1 5 2 2 5 3 4 5 6 and 8 ml s 1 i0 1 5 2 2 5 3 4 5 6 8 and 16 ml s 1 θι 80 180 and 500 s zi 3 for the scenarios with lateral flows we mainly used r9 r10 and r17 that have a baseflow ib 4 ml s 1 which enables on one hand to use the gain and loss pumps to their maximum extent 3 ml s 1 and on the other hand to still have a positive outflow the volume vis of the surface component is t of the inflow i t ranges between 123 and 2945 ml the inflow peak ix between 3 3 and 23 3 ml s 1 the outflow peak ox between 2 4 and 22 4 ml s 1 and a lag time toi between 31 and 72 s ii 13 scenarios noted g1 to g13 with only lateral gains table s2 and figure s2 different lateral gains l g t were tested corresponding to different values of the three parameters of eq 27 a0 2 and 3 ml s 1 θ l 80 and 180 s z l 3 the volume of lateral gains vg ranges between 164 and 564 ml the lateral gain peak l g x between 2 4 and 3 7 ml s 1 and the outflow peak ox between 6 8 and 24 4 ml s 1 and a lag time toi between 27 and 236 s iii 5 scenarios noted l1 l9 with only lateral losses table s3 and figure s3 different lateral losses l l t were tested corresponding to different values of the three parameters of eq 27 a0 2 and 3 ml s 1 θ l 80 and 180 s z l 3 the volume of lateral losses vl ranges between 164 and 537 ml the lateral loss peak l l x between 2 4 and 3 7 ml s 1 and the outflow peak ox between 5 0 and 19 8 ml s 1 and a lag time toi between 39 and 97 s iv 17 scenarios combining one lateral gain hydrograph and one lateral loss hydrograph table s4 and figure s4 10 scenarios with gains followed by losses noted gl1 to gl10 and 7 scenarios with losses followed by gains noted lg1 to lg7 gains gi and losses li were tested with different parameters of eq 26 the volume of lateral flow v l ranges between 164 and 244 ml the volume of lateral gains vg between 14 and 432 ml the volume of lateral losses vl between 129 and 432 ml the peak of lateral gains l g x between 0 5 and 3 7 ml s 1 the peak of lateral losses l l x between 1 1 and 3 7 ml s 1 and the outflow peak ox between 5 7 and 11 2 ml s 1 the majority of these scenarios has equal volumes of gains and losses with v l vg vl 0 but differs in the order of occurrence of l g t and l l t their time of occurrence and their amplitude l g x and l l x v 8 scenarios combining multiple gain and loss hydrographs table s5 and figure s5 1 scenario glg noted glg1 2 scenarios glgl noted glgl1 and glgl2 and 5 scenarios lglg noted lglg1 to lglg5 these are more complicated scenarios of lateral flow with a series of alternating gains and losses the volume of lateral flow v l ranges between 0 and 250 ml the volume of lateral gains vg between 125 and 743 ml the volume of lateral losses vl between 125 and 743 ml the peak of lateral gains l g x between 2 6 and 3 7 ml s 1 the peak of lateral losses l l x between 2 6 and 3 7 ml s 1 and the outflow peak ox between 6 4 and 10 6 ml s 1 3 3 domain of application of the dwe before applying any hydraulic model we need to verify its domain of application therefore laboratory scale experiments are a powerful tool to check the model hypotheses and its domain of application since field data are very scarce and difficult to get especially for flood events hydraulic modellers usually rely on laboratory scale experiments to validate their models of course this does not mean that a successful model on a laboratory scale experiment would necessary be successful on real domain because the extrapolation from laboratory scale to real scale needs to verify and respect the laws of similitude based on the conservation of non dimensional hydraulic numbers e g froude and reynolds numbers therefore the success of a model on a laboratory scale is a necessary condition but not a sufficient one in this paper we focus on the validation of the model on laboratory scale which is a necessary condition before transferring it to a larger scale which is the next step in our study case of the dwe moussa and bocquillon 1996a established the domain of application of the dwe when the acceleration terms neglected in the saint venant equation are lower than 5 as 28 v g t s 0 011 where v lt 1 is the velocity calculated using the manning formula s is the slope t t is the wave length and g 9 81 m s² is the gravity acceleration eq 28 was deduced on the basis of a propagation of a theoretical small wave and an analysis using non dimensional hydraulic numbers on our experimental channel we made experimentation under steady state regime and we established a relationship between water depth and discharge we calculated a slope s 0 0016 and an average value of the manning strickler coefficient n 0 027 sm 1 3 which is consistent with a clean straight plastic channel for each scenario characterized by an inflow outflow and lateral flow we calculate the non dimensional term v gts for different values of the discharge the wave length can be estimated by adjusting a sinusoid on inflow outflow and lateral flow and can be approximated as t 2θ all inflows and outflows corresponding to the reference scenarios ri table s1 with long wave lengths θ 180 or 500 s r1 r3 r5 r7 r9 r11 r13 r15 r17 r18 and r19 verify eq 28 with values of v gts ranging between 0 002 and 0 010 for inflows and outflows corresponding to the reference scenarios ri with wave lengths θ 80 s eq 28 is verified for scenarios r2 r4 r6 r8 r10 and r12 with low values of ix and ox corresponding to low values of the velocity for the two remaining scenarios r14 and r16 v gts ranges between 0 007 and 0 014 note that v gts 0 014 corresponds to the case when acceleration terms in the saint venant represent around 8 of the value of all terms in the momentum equation moussa and bocquillon 1996a we observe similar results for the other scenarios with lateral gains and losses the domain of application of the dwe eq 28 is verified for all scenarios except for some scenarios with short wave lengths for lateral gains and losses such in scenarios lglg3 lglg4 and lglg5 where v gts ranges between 0 008 and 0 020 in the applications the scenarios r8 r9 r10 r17 r18 and r19 are generally used as inflows and in all these cases the domain of application of the dwe eq 28 is verified 4 results and discussion 4 1 sensitivity analysis one of the main difficulties of solving an inverse problem is the appearance of numerical instabilities when calculating l c t fig 4 a shows an example of lc t obtained with a time step of calculation of 1 s we observe important oscillations due to the numerical solution in order to reduce and avoid these oscillations l c t was smoothed using a moving average as shown in fig 4b c and d for 3 5 and 15 s window duration respectively we observe that the oscillation amplitude decreases when the window of the moving average increases and disappears totally around a value of 15 s finally in all applications we used a time step of calculation of 1 s similar to the time step of measurements followed by smoothing l c t using a moving average on a 15 s window the two parameters of the dwe are c and d a sensitivity analysis of the model for these two parameters was conducted as shown in fig 5 using the inverse problem solution l c t knowing i t an o t fig 5a around a reference solution c0 0 085 ms 1 and d0 0 135 m²s 1 in two cases i varying c c0 3 c0 2 c0 2c0 and 3c0 with a fixed d d0 fig 5b ii varying d d0 3 d0 2 d0 2d0 and 3d0 with a fixed c c0 fig 5c we observe that the model is more sensitive to the parameter c than d because varying c by a factor of 3 has a stronger impact on the results than varying d by the same factor these observations are in agreement with the literature moussa and bocquillon 1996b cheviron and moussa 2016 note that when routing each of the calculated l c t with the corresponding couple c and d we obtain a calculated oc t with an nseo comparing o t and oc t higher than 0 99 this result reflects two points first the dwe with lateral flow uniformly distributed under the hayami hypotheses is well adapted to simulate the outflow second for each set of the parameters c d we obtain a different shape of l c t however when i t and l c t are routed using the dwe with the corresponding c d we obtain excellent model performances with an nseo comparing the measured o t and the calculated oc t higher than 0 98 in all cases this last result reflects that different sets of c d and l c t can give the same outflow o t 4 2 model calibration different calibration validation strategies can be conducted first the calibration of the two parameters c and d was conducted separately on each of the 19 reference scenarios ri using the hayami solution of the dwe without lateral flow section 2 1 eq 4 the calibrated values of c and d and the corresponding nseo are shown in the last three columns of table s1 in the supplemetary material the performance criteria nseo is higher than 0 99 for 17 events and equal to 0 987 and 0 98 for the remaining two events these results show that the dwe and particularly the hayami solution under the hypotheses that c and d are constants is well adapted to the experimentation fig 6 shows the results on the 3 reference scenarios r9 r10 and r17 mostly used in scenarios with lateral flow oc t and o t are almost superposed second the calibration of the two parameters c and d was conducted separately on each of the remaining events with lateral gains and or losses for the 13 scenarios with lateral gains gi all scenarios have nseo higher than 0 99 for the 5 scenarios with lateral gains li 4 scenarios have nseo higher than 0 99 and equal to 0 97 for the remaining one for the 17 scenarios with lateral gains and losses gli and lgi 15 scenarios have nseo higher than 0 99 and equal to 0 98 for the remaining two for the 8 scenarios with multiple lateral gains and losses glgi glgli and lglgi 6 scenarios have nseo higher than 0 99 and equal to 0 98 for the remaining two these results confirm that the dwe and its hayami solution are well adapted to the experimentation with time variable lateral flow uniformly distributed along the channel 4 3 model validation for the validation of the inverse model we used all scenarios with lateral flow with gains gi with losses li alternating one gain and one loss gli and lgi alternating multiple gains and losses glgi lglgi and glgli each inflow i t for the validation scenario possesses the form of one of the calibrated references r1 to r19 table s1 and the corresponding calibrated values of c and d in table s1 are used all detailed results are given in the supplementary material i for the 13 scenarios with gains gi table s6 and figure s2 ii for the 5 scenarios with losses li table s7 and figure s3 iii for the 17 scenarios alternating gains and losses gli and lgi table s8 and figure s4 iv for the 8 scenarios alternating multiple gains and losses table s9 and figure s5 table 2 synthesizes all error criteria defined in section 2 4 on all scenarios and fig 7 shows examples comparing measured l t with calculated l c t lateral flow and measured o t with calculated oc t outflow the errors on volumes i for gains εvg is excellent very good or good for 37 scenarios among 38 15 excellent 17 very good and 5 good noted 15a 17b 5c and poor for the remaining scenario ii for losses εvl is excellent very good or good for 29 scenarios among 30 7a 15b and 7c and fair for the remaining scenario the errors on peakflow i for gains εxg is excellent very good or good for 32 scenarios among 38 6a 12b 14c and fair for the remaining 6 scenarios ii for losses εxl is excellent very good or good for 24 scenarios among 30 1a 12b 11c and fair or poor for the remaining 6 scenarios the errors on the time of occurrence of peakflow i for gains εtg is excellent very good or good for 33 scenarios among 38 15a 11b 7c and fair for the remaining 5 scenarios ii for losses εxl is excellent very good or good for 27 scenarios among 30 9a 11b 7c and fair for the remaining 3 scenarios the n s e l comparing the measured and calculated lateral flow is excellent very good or good for 39 scenarios among 43 20a 16b 3c and fair or poor for the remaining 4 scenarios the nseo comparing the measured and calculated outflow is higher than 0 96 for all 43 scenarios 4 4 uncertainty analysis in practical applications on natural or experimental channels we need a diagnosis tool to evaluate lateral flow even with uncertainty hence uncertainty analysis must be conducted in order to evaluate the impact of the approximations on modelling approach and parameters estimation on the calculated lateral flow l c t approximations on modelling concern not only the domain of application of the dwe under the hayami conditions c and d constant and the hypothesis of lateral flow uniformly distributed along the channel but also the approximations when using the laplace transforms moussa 1996 to calculate the analytical solution of the inverse problem eqs 10 and 13 approximations on model parameters concern the errors on the estimated values of the two parameters c and d another source of uncertainty concerns the measured inflows and outflows hence we conduct uncertainty analysis on model parameters the measured inflow and the measured outflow first for the uncertainty analysis on model parameters various approaches can be used to estimate c and d either using hydraulic formulas moussa and bocquillon 1996a delestre et al 2013 or calibrating c and d on inflow outflow flood events as in the previous two sections a third more simplified approach consists on establishing empirical relationships between the parameters c and d and some descriptors of the flow as an example we consider the peak inflow ix as a descriptor of the range of discharge fig 8 shows the relationship between c and ix and between d and ix obtained from the calibration conducted on the 19 reference scenarios ri we observe that c and d increase when ix increases which is consistent with hydraulic laws we can adjust simple linear relationships 29 c 0 0043 i x 0 0359 a n d d 0 0016 i x 0 1276 we obtain r² 0 84 and 0 46 respectively the uncertainty analysis can then be conducted for each validation scenario first c and d are calculated using eq 29 then we run the inverse model solution to calculate the lateral flow l c t using different values of c and d ranging in the intervals 1 α c 1 α c and 1 α d 1 α d α being a parameter characterizing the range of uncertainty on c and d fig 9 shows an example of applications on four scenarios g13 l2 gl8 and lglg1 representing each of the four studied scenario categories we consider α 0 25 and then we run 50 simulations selecting randomly c in the interval 0 75c 1 25c and d in 0 75d 1 25d we observe that despite the approximations on the estimated values of the parameters c and d the model enables to reproduce for all four scenario categories the global shape of the hydrograph the amplitude of the peakflow the time of occurrence of the peakflow and mainly the alternation between gains and losses this can be observed especially in the examples gl8 and lglg1 where the total volume of lateral flow is nil but with an alternation of one gain and one loss for gl8 and loss gain loss gain for lglg1 second we conduct three uncertainty analysis on inflows and or outflows i inflow 10 we run the model in three different cases corresponding to three different inflows 0 9 i t i t and 1 1 i t with o t and the calibrated set of parameters c and d ii outflow 10 we run the model in three different cases corresponding to three different outflows 0 9 o t o t and 1 1 o t with i t and the calibrated set of parameters c and d iii simultaneously on inflow 5 and outflow 5 we run the model for nine different cases corresponding to three different inflows 0 95 i t i t and 1 05 i t three different outflows 0 95 o t o t and 1 05 o t and the calibrated set of parameters c and d applications were conducted on the same four scenarios g13 l2 gl8 and lglg1 as previously and results are shown in supplementary material figures s6 s7 and s8 we observe that the inverse model is able to reproduce the dynamic of the simulated lateral hydrographs while the error on the simulated lateral volume increases due to uncertainty on inflow and or outflow the error on the time of occurrence of the peak of lateral flow gains or losses remains low and slightly higher than the value obtained when using i t and o t these results confirm that despite uncertainties on inflows and or outflows the hayami dwe inverse model is robust and enables to reproduce complex dynamics of lateral flow 4 5 discussion lateral flow is one of the major hydrological processes and can be observed at different spatial scales from runoff genesis on hillslopes to flood routing in the channel network it results from complex interactions channel hillslope channel aquifer channel flood zone but also due to anthropogenic water management pumping or rejects it can be either gains to the channel positive or losses from the channel negative but generally a succession of multiple gains and losses the main problem remains in the difficulty to measure lateral flow because experimentations can hardly be conducted in situ therefore there is a need to evaluate lateral flow gains and losses under non steady state conditions during flood events in both natural and anthropogenic systems at different spatial scales this study uses a coupled experimental modelling approach to evaluate lateral flow temporal evolution i an experimental approach measuring the inflow i t the outflow o t and lateral flow l t ii the resolution of the dwe inverse problem with lateral flow uniformly distributed using hayami s hypotheses the 62 scenarios studied cover a large panel of hydrograph shapes wave length peakflow and lateral flow gains and losses occurrence and amplitude for the four error criteria εvg εxg εtg and nsel we obtain excellent very good or good results for approximately 90 of the scenarios tested with nse 0 85 for 84 of the 43 scenarios with lateral flow these results reflect the ability of the inverse model to reproduce the lateral flow hydrograph dynamics its two components gains and losses and the corresponding volumes peakflows and times of occurrence of peakflows note that complicated lateral flow hydrographs e g gli lgi or multiple gains and losses figs 7 and 9 are also well reproduced for example in the particular case where the total volume of lateral flow is nil with equal volumes of gains and losses e g scenarios gl2 to gl10 lg3 to lg7 glgl1 glgl2 and lglg1 to lglg5 tables s4 and s5 the model identifies the alternation of gains and losses and gives very good evaluation of the hydrograph shape the scenarios with fair or poor performance criteria correspond either to scenarios where lateral flow volume is small compared to the inflow e g g3 l2 l3 and lg2 scenarios where numerical oscillations appears e g g6 and g7 or events with short wave lengths where the domain of application of the diffusive wave is not valid e g lglg4 and lglg5 see some examples on fig 7 these fair or poor simulations can be improved by calibrating the model parameters c and d on scenarios with gains and losses and not only on the reference scenarios ri the excellent results of nseo table 2 show that despite the approximations in the analytical solution of the inverse problem flood routing using dwe hayami solution under the hypothesis of c and d constants and with lateral flow uniformly distributed enables to reproduce the measured outflow the domain and limits of application of the solution of the dwe inverse problem model show the very good performance of dwe for a large panel of scenarios corresponding to long wave lengths the degradation of model performance occurs for scenarios with short wave lengths and in the cases of low volumes of lateral gains and losses in comparison with inflow finally uncertainty analysis fig 9 shows that even with a simplified approach to estimate the two parameters c and d the inverse dwe model can be used as a diagnosis tool that is able to detect the lateral flow hydrograph global shape as well as the alternation of gains and losses with a good approximation of their corresponding volumes and peakflows 5 conclusion a coupled experimental inverse modelling approach was developed to validate the analytical solution of the inverse problem of the dwe equation with lateral flow uniformly distributed along the channel the first result of this study was the development of a novel experimental design representing inflow and lateral flow hydrographs gains and losses uniformly distributed along a channel the experimental design was conceived and built so that i t o t and l t are highly controlled at 1 s time step 62 experimental hydrograph scenarios corresponding to different shapes of i t and l t were conducted on a 4 m laboratory channel in order to meet the hypotheses of the dwe model long wave length and its resolution by the hayami model constant values of the celerity c and the diffusivity d the experimentation is also characterized by short time duration low water consumption and high precision which enables a large variety of accurate reliable and reproducible hydrograph scenarios the second result is the validation of the analytical solution of the inverse problem of the dwe with lateral flow uniformly distributed along the channel proposed by moussa 1996 whereas a large number of time varying hydrograph scenarios is necessary to validate this modelling approach this method is an easy to use analytical solution for identifying the lateral flow hydrograph knowing the inflow the outflow and the model parameters c and d the domain and limits of application of the solution of the inverse problem of the dwe were discussed validating the limits of the dwe model for short wave lengths the limitations of the inverse problem dwe solution due to numerical oscillations and in the case of low volumes of lateral gains and losses in comparison with inflow the coupled experimental modelling approach proposed herein opens promising perspectives regarding the evaluation of lateral flow characteristics on real channels lateral flow gains and losses their volumes their durations and their peak amplitudes acknowledgement the authors thank jean philippe chazarin from the laboratory hydrosciences montpellier france for his help in developing the electronic devices used in the experiments supplementary materials supplementary material associated with this article can be found in the online version at doi 10 1016 j advwatres 2019 03 009 appendix b supplementary materials image application 1 image application 2 appendix a list of symbols a0 parameter for the calculation of l t l3t 1 c celerity lt 1 d diffusivity l²t 1 g acceleration due to gravity g 9 81 ms 2 lt 2 i t measured inflow l3t 1 ib baseflow component of i t l3t 1 is t surface component of i t l3t 1 ix inflow peak l3t 1 i0 parameter for the calculation of is t l3t 1 l channel length l l t measured lateral flow l3t 1 l c t calculated lateral flow l3t 1 l g t measured lateral gains corresponding to l t 0 l g c t calculated lateral gains corresponding to l c t 0 l g c x peakflow of l g c t l3t 1 l g x peakflow of l g t l3t 1 l l t measured lateral losses corresponding to l t 0 l l c t calculated lateral losses corresponding to l c t 0 l l c x peakflow of l l c t l3t 1 l l x peakflow of l l t l3t 1 k t hayami kernel function n manning strickler roughness coefficient tl 1 3 n s e l nash sutcliffe efficiency criteria comparing l t and l c t nseo nash sutcliffe efficiency criteria comparing o t and oc t o t measured outflow l3t 1 oc t calculated outflow l3t 1 ox outflow peak l3t 1 q t discharge l3t 1 s river bed slope t time t t wave length t tgcx time of occurrence of l g c x t tgx time of occurrence of l g x t tix time of occurrence of ix t t l i time interval between the of the time of occurrence of lateral flow peak and inflow peak t tlcx time of occurrence of l l c x t tlx time of occurrence of l l x t toi time interval between the time of occurrence of ox and ix t tox time of occurrence of ox t v flow velocity lt 1 vg volume of l g t l3 vgc volume of l g c t l3 vi volume of i t l3 vib volume of ib t l3 vis volume of is t l3 vl volume of l l t l3 vlc volume of l l c t l3 v l volume of l t l3 v l c volume of l c t l3 vo volume of o t l3 x length along the channel l zi shape parameter of is t in eq 26 z l shape parameter of l t in eq 27 ε tg time error on the time of occurrence of the peakflow of lateral gains t ε tl time error on the time of occurrence of the peakflow of lateral losses t ε vg relative error on volume of lateral gains ε vl relative error on volume of lateral losses ε xg relative error on peakflow of lateral gains ε xl relative error on peakflow of lateral losses θi parameter representing the time position of the centre of gravity of is t in eq 26 t θ l parameter representing the time position of the centre of gravity of l t in eq 27 t 
671,a parameter estimation methodology has been developed on the basis of model inversion using a quasi newton method and adaptive parameterization the continuous adjoint state equations for both flow and transport in porous media are employed as the tool calculating the gradient components of the objective function with respect to parameters solving the continuous form of the adjoint equations can be implemented independently of the code used to solve the forward problem which renders the technique non intrusive the developed methodology is applied to the identification of hydraulic conductivity and porosity fields conditioned by piezometric head data associated with steady state flow and transient solute concentrations synthetic numerical experiments have been undertaken for test cases of increasing complexity from an almost uniform flow sweeping the modeled domain with a prescribed uniform continuous injection of solute at the inflow boundary to spatially highly variable flow conditions obtained through source sink terms within the flow domain and a local stepwise solute injection the results of inversions are analyzed using criteria based on the comparisons between estimated concentration and reference concentration values as well as comparisons between estimated hydraulic conductivity and porosity for one test case and reference hydraulic conductivity fields the results show that employing a continuous adjoint state technique computed independently of the direct problem is an efficient option for parameter estimation relying jointly upon flow and transport data in the reported numerical examples that are characterized by the identifiability of the flow problem on the basis of hydraulic head observations concentration data from solute transport scenarios bring few added value to sought solutions of hydraulic conductivities the spatial structure of the conductivity fields is slightly improved compared with the reference but the overall system in terms of head distribution identification of main flow paths and solute transit times only inherits cosmetics keywords parameter estimation adjoint state adaptive parametrisation groundwater hydraulic conductivity porosity 1 introduction parameter estimation through inverse methods for flow and solute transport simulations is still challenging despite the variety of concepts and methods developed since the pioneer works in inverse methods of vemuri et al 1969 emsellem and de marsily 1971 and yeh and tauxe 1971 among others recent reviews of conceptual frameworks and methods can be found in hendricks franssen et al 2009 zhou et al 2014 and linde et al 2015 almost all the developed methods target the estimation of hydraulic conductivities or transmissivities constrained conditioned by hydraulic heads and through the last 40 years by additional data such as solute concentrations geological information or geophysical properties in this work we focus as a first goal on estimating spatially heterogeneous hydraulic conductivity and porosity fields conditioned by both hydraulic heads and solute concentrations many authors have already addressed this challenge and table 1 presents an overview of various approaches dedicated to this topic the table is not an exhaustive presentation of the existing literature but a selection of works 17 contributions ranked as they appear in time in the literature that we consider representative of methods and trends solving the inverse problem for flow and transport in ground water systems is tightly associated with methodological choices among the possible choices we exemplify via continuous adjoint state calculations how gradient based inversion techniques can cope with highly parameterized problems mixing data of various types and weighting them in the objective function of an inverse problem is also a key feature this is why this study emphasizes methodology as a second goal notably when modeling natural systems or synthetic test cases supposedly close to natural systems it is always complicated to discuss on identifiability uniqueness of inverse solutions quality of conditioning etc simply because highly parameterized inverse problems encompassing multiple elementary processes result in fuzzy theoretical frameworks that being said it cannot be overlooked that complex systems might result in multiple inverse solutions repeatability in the sense of estimating how similar various solutions are when initiated at different locations in the parameter space appears as a simple way to determine success or failure of inversions incidentally when dealing with synthetic test cases employing fully known reference problems the comparison between inverse solutions and references is also informative in this study observations associated with flow and transport parameter estimations are scarce piezometric head data from steady state flow conditions and solute concentrations under transient transport conditions these data are used to build an objective function assembling two terms the sum of the weighted squared differences between measured and computed piezometric heads fh and the sum of the weighted squared differences between measured and computed solute concentrations fc notably the weights may sometimes serve to narrow down the range spanned by the squared differences when data of different units are used this type of objective function is usually employed within i the non linear least square framework which also often adds a regularization term on model parameters or ii the maximum likelihood framework earlier proposed by carrera and neuman 1986 which allows for handling prior information on model parameters summing two quantities that have different units in an objective function requires an adapted strategy and or the use of a weighting coefficient applied to one of these terms usually fc in fact the weighting should be directly given by the probability density functions of errors between model outputs and observations the point is that these densities are generally conjectured which results in weights given to fh and fc becoming parameters of the inversion procedure pioneer works from umari et al 1979 strecker and chu 1986 and keidser and rosbjerg 1991 proposed a two stage procedure to minimize successively fh and fc simultaneous inversion of both heads and solute concentrations and simultaneously decreasing both fh and fc is nowadays the common way to estimate the parameters nevertheless the optimal weighting of the two terms fh and fc has been under debate carrera and neuman 1986 doherty 2003 medina and carrera 2003 and is still not fully resolved even though abundant literature and many studies are available for other inversion techniques gradient based methods are the most common algorithms applied to minimize the objective function the minimization employs either sensitivity coefficients with a gauss newton method levenberg 1944 marquardt 1963 or adjoint state variables coupled with a quasi newton method byrd et al 1994 over the last decade kalman filtering kalman 1960 and its extensions such as ensemble kalman filtering e g iglesias et al 2013 deng et al 2016 have been applied and improved to efficiently solve the inverse problem the method has become a valuable alternative approach to gradient based methods for estimating flow and transport parameters parameterization techniques have also shown an interesting evolution over the last 50 years zonation was the most popular method during the seventies period probably due to lack of powerful computers that hampered the deployment of stochastic monte carlo simulations stochastic parameterization now seems to be the standard approach for seeking hydraulic conductivity but recently pool et al 2015 recalled that zonation could be a relevant option to represent geological patterns for large scale aquifers i e systems of several tens of km extension with flow patterns modeled at the 100 1000 m scale in most applications transport parameters effective porosity and dispersivities are usually considered as uniform over the modeled domain and transport heterogeneity is mainly associated with heterogeneous hydraulic conductivity fields and subsequent variations of the mean fluid velocity in the system in this work we explore the capacity of the adaptive parametrization technique detailed in ackerer and delay 2010 and hassane and ackerer 2017 coupled with an independently computed adjoint equation delay et al 2017 to estimate hydraulic conductivity and porosity spatial distributions conditioned by head and concentration measurements in the following section the mathematical models describing the flow and transport processes are presented section 3 provides a synopsis of the continuous adjoint state method used to minimize the objective function under the constraints resulting from solving the flow and transport equations the detailed mathematical development of the continuous adjoint state for transport is reported in appendix a it is presented in a new convenient manner as done for flow in delay et al 2017 that allows for the derivation of the gradient of the objective function with respect to all types of factors including transport parameters initial and boundary conditions and source sink terms of the transport problem the objective function and the minimization strategies are presented in section 4 finally the numerical experiments are presented and discussed in section 5 emphasis is put on the comparison between inverse solutions obtained from calculations conditioned by head data only and by the joint use of head and concentration data 2 the forward problem steady state flow and transient transport conditions in a 2d confined aquifer are assumed these conditions are quite common for practical cases where steady state flow may represent average flow conditions these conditions also work for shallow unconfined aquifers that show small variations of water levels which keep the flow equations linear regarding hydraulic heads we also assume constant aquifer thickness for simplicity which allows for inverting hydraulic conductivities instead of transmissivities but without loss of generality under these conditions groundwater flow and solute transport are modeled over the domain ω and for transport over the time interval 0 t by e g bear 1972 1 q q w over ω q k h h h d over d ω h k h n γ q n w over n ω h 2 ω c t ω u c ω d c q c u q ω over ω and 0 t c c 0 over ω at t 0 c c d over d ω c and 0 t d c n γ q n c over n ω c and 0 t where h l is the hydraulic head k lt 1 is the hydraulic conductivity considered here as a scalar qw t 1 is the flow source sink term c ml 3 is the concentration ω is the effective porosity q lt 1 is the darcy flux u lt 1 is the average water velocity qc ml 3t 1 is the solute source sink term and d l2t 1 is the local dispersion tensor defined by 3 d x x α l u x 2 u α t u y 2 u d y y α t u x 2 u α l u y 2 u d y x d x y α l α t u x u y u where ux uy are the local components of the fluid velocity u is the velocity magnitude and α l α t are the longitudinal and transverse dispersities l respectively dirichlet boundary conditions apply to contours d ω h for flow and d ω c for transport as neumann boundary conditions apply to contours n ω h for flow and n ω c for transport n γ represents the outer vector normal to the contours where neumann boundary conditions are applied boundary conditions and source sink terms are assumed to be known and prescribed at constant values over time it is noticeable that for the above equations the porosity should not vary over time otherwise flow would no longer be steady state boundary conditions for flow and transport have also been written as independent from one another when it might not be the case for example neumann boundary conditions for flow with fluxes exiting the domain are often associated with neumann boundary conditions for concentrations but for entering water fluxes concentrations are often prescribed via dirichlet type boundary conditions 3 parameter identification methodology 3 1 the objective function the parameter identification procedure is based on the minimization of the quadratic differences between measured and computed variables these differences are gathered in a so called objective function defined as 4 f p h p c p f h p h p κ f c p c p with 5 f h p h p h h t w h h h f c p c p j 1 n t c j c j t w c j c j c j where t denotes the transpose operator h and c j are the vectors of computed heads and concentrations with a size corresponding to the number of observations j is the index of observation times for transport nt is the number of times at which concentrations have been measured p is the vector of parameters here hydraulic conductivity and porosity of size np and h and c j are the vectors of observed values h h and c j c j are usually named as measurement errors in the jargon of inverse problems as they simply are the difference between model outputs and observations in a framework considering that the model is exact for a given set of parameters and data are flawed in essence it must be understood that measurement errors encapsulate actual errors on measures differences between model outputs and data and the consequences of conceptual errors associated with a model or its settings that are always approximations of reality assuming that the measurement errors are not correlated in space and invariant over time the w matrices are diagonal and w k k ε k 1 where ε k is the variance of the measurement errors at location k finally κ is a weighting coefficient to ensure a balanced minimization of both fh p h p and fc p c p in the framework of the maximum likelihood and applying the assumptions made on the w matrices κ represents the ratio of the measurement error variance of heads to the measurement errors variance of concentrations these errors are usually unknown from a practical standpoint κ should avoid biased optimization by giving too much importance to either fh or fc medina and carrera 2003 and should therefore be modified during the minimization procedure different minimization techniques of the objective function f p h p c p exist because the number of estimated parameters might be large we rely upon the adjoint state method rendering an estimate of the gradient components of the objective function at a cost independent of the type and the number of parameters see appendix a even though the convergence toward a minimum of the quasi newton methods is usually slower compared with the gauss newton method cooley 1985 for highly parameterized problems it is wise to rely upon the adjoint method seeking gradient components which are then introduced into a quasi newton algorithm chavent 1979 neuman and carrera 1985 sun 1994 ackerer et al 2014 sun and sun 2015 delay et al 2017 variants of the adjoint state exist e g medina and carrera 2003 to calculate model sensitivity to parameters which then feed gauss newton algorithms the latter option is not employed here as the calculation costs strongly depend on the number of measurement values 3 2 the continuous adjoint state the adjoint state technique is associated with the class of problems ensuring the optimization minimization of an objective function under constraints e g bertsekas 1996 these constraints can be for example the equations that are solved by a model for which we seek the optimal parameters rendering model outputs close to observations recently delay et al 2017 presented a thorough discussion on the adjoint state to invert the spatially distributed problem of flow in dual porosity systems their discussion dealt with both the discrete and continuous forms of the adjoint state and with a comparison of their ability to assist inversions in providing rapid calculations of the gradients of the objective function the present work inherits the method proposed by delay et al 2017 and extends it to the inversion of solute transport treated via an advection dispersion equation the adjoint state is employed in its continuous form which can be differentiated and then implemented without prior knowledge about the structure of the discrete equations in the forward model let us take a forward problem as a continuous operator v c p 0 handling a single state variable c x t and a single type of parameter p x t over the domain ω and the period 0 t to space x and time t coordinates are dropped herein when feasible for better readability the objective function of the inverse problem is usually discrete because it compares a finite set of observations of c with equivalent simulated values see e g eqs 4 and 5 nevertheless the objective function is rewritten in a continuous form f c p 0 t ω f c p d ω d t with f an elementary function usually piecewise or pointwise non null at locations in time and space where observations are available it must be noted that the simple integrals over time and space defining f are here employed for ease of notation but without loss of generality when dealing with discrete objective functions as those in eq 5 the formulation of f becomes complicated with four integrals concealed in the continuous form see delay et al 2017 for example with point observations of concentrations c a b denoting a value at location x a and time tb a generalized least square objective function on concentrations in a continuous form could be written as 6 0 t 0 t ω ω m n i j c x t c m i w m n i j c y t c n j δ x x m δ y x n δ t t i δ t t j d x d y d t d t where w m n i j denotes the weight associated with the pair of observations c m i c n j and δ is the delta dirac function minimizing the objective function f knowing that the constraint v c p 0 is fulfilled assumes that both the objective function and the constraints are gathered in a lagrangian operator in the form 7 l c p μ 0 t ω f c p d ω d t 0 t ω v c p μ d ω d t as the second term in eq 7 is null the lagrangian l is equivalent to the objective function f even though it encloses the addition of the constraint v multiplied by the variable μ x t over ω and 0 t the variable μ is a lagrangian multiplier which is defined up to the addition of a constant or the multiplication by a constant μ multiplies a constraint expressed as a null term the lagrangian multiplier is named as the continuous adjoint state of the variable c if model parameters p are perturbed by δp with the consequence of generating a perturbation δc on the variable c such that v c δc p δp 0 a variation of the lagrangian l can be written as 8 δ l 0 t ω f c δ c d ω d t 0 t ω f p δ p d ω d t 0 t ω v c δ c p δ p v c p μ d ω d t where a first order taylor series expansion has been used to rearrange the terms in f identifying the equations ruling the adjoint state μ relies upon the development of the variations in the constraint v c δc p δp v c p while separating terms in δc from terms in δp cancelling out the terms in δc within δl poses the equations of the continuous adjoint state over ω and 0 t and its initial and boundary conditions solving these equations eliminates terms in δc which in turn modifies the variation of the lagrangian that becomes 9 δ l 0 t ω f p δ p d ω d t 0 t ω g c μ δ p d ω d t with g a continuous operator combining the state variable c and the adjoint state μ both previously calculated by the forward problem and the adjoint state equations respectively this operator g depends on the type of parameter the perturbation δp to which it is associated in the scalar product in eq 8 usually parameters in spatially distributed models are defined as uniform values over subdomains ω i of ω e g zones cells etc and eventually over periods δtn within 0 t denoting p i n as the restriction of the parameter p x t to the subdomain ω i and the period δtn the variation of the lagrangian δl in eq 8 renders an approximation of the gradient of the objective function with respect to p i n 10 δ l δ p i n d f d p i n δ t n ω i f p i n d ω d t δ t n ω i g c μ d ω d t where integrals in eq 10 are restricted to the subdomain ω i and the period δtn it is worth noting that the adjoint state μ is independent of the type of gradient component d f d p i n to be calculated stated differently and knowing that μ has been calculated beforehand in a single step very similar to that of the forward model see below the access to gradient components is very rapid irrespective of the type and the number of sought parameters this renders the adjoint state technique suited to highly parameterized problems when methods based on model sensitivities the calculation of each sensitivity being very similar to the forward problem are plagued by computation costs 3 3 adjoint state equations and gradients of the objective function a crucial point of the continuous adjoint state application is in developing the equations ruling the adjoint state and setting the operators g mentioned above for calculating the gradient components several attempts have appeared in the literature even though the technique has not been widely employed in hydrology the most important contribution is probably that proposed by sun and co workers sun 1994 who developed the continuous adjoint states for single phase flow two phase flow transport under various conditions and specific applications targeting the identification of a single type of parameter a specific form of the objective function or steady state problems delay et al 2017 proposed a unified development and presentation of the continuous adjoint state for flow in dual porosity systems which became available for the identification of all types of parameters initial and boundary conditions and source sink terms the continuous adjoint state equations for steady state single phase flow in eq 1 are an adaptation from delay et al 2017 the interested reader is referred to that work for further details regarding the transient solute transport in eq 2 the unified development of the adjoint state equations does not yet appear in the literature and is reported in appendix a regarding the inversion of the coupled problem of steady state flow and transient transport a variation of the continuous lagrangian operator can be written as 11 δ l h c p λ μ ω f h h δ h d ω ω f h p δ p d ω ω u h δ h p δ p u h p λ d ω 0 t ω f c c δ c d ω d t 0 t ω f c p δ p d ω d t 0 t ω v c δ c p δ p v c p μ d ω d t the elementary continuous objective function f has been dissociated in the two components fh and fc enclosing the state variable h head for flow and the state variable c concentration for transport respectively u h p 0 is the continuous steady state flow equation v c p 0 is the continuous transient transport equation λ and μ are the continuous adjoint states associated with flow and transport respectively and p is the undifferentiated vector of factors ruling the flow and transport equations it could include initial and boundary conditions source sink terms and flow and transport parameters here the aim is to retrieve hydraulic conductivity and porosity fields on the basis of head and concentration measurements for pre identified dispersivity parameters known source sink terms and known initial and boundary conditions that being said the hydraulic conductivity influences transport parameters such as the mean water velocity u and the dispersion tensor d see eq 2 it makes sense to calculate via the adjoint state the gradient components of the objective function with respect to u and d and link them with the total variation of the objective function with respect to k the continuous adjoint state equations for steady state flow ruled by eq 1 are derived as see delay et al 2017 12 k λ f h h 0 over ω λ 0 over d ω h k λ n γ 0 over n ω h transport equations in eq 2 are flanked with continuous adjoint state equations in the form see appendix a 13 ω μ t ω u μ ω d μ f c c 0 over ω and t 0 μ 0 over ω at t t μ 0 over d ω c and t 0 d μ n γ 0 over n ω c and t 0 the minus signs appearing in eq 13 for terms in t and in u assume that eq 13 is solved backward over time from t to 0 and with a reversed water velocity field u otherwise eq 13 lacks physical meaning by letting a negative diffusion tensor appear as told earlier continuous adjoint state equations look very similar to their equivalent forward problem in eqs 1 and 2 eqs 12 and 13 can be solved numerically by any means any discretization and numerical scheme independent of the way the forward problem is solved the forward model and the adjoint state calculations can be decoupled which is not the case of the discrete adjoint state technique which is differentiated from and calculated with the same discrete equations as those of the forward model e g ackerer et al 2014 for its part the independent implementation of the continuous adjoint state is able to work with any forward model both simply exchange information such as the source sink terms of the adjoint states fh h and fc c those inheriting from calculations performed by the forward model notably eqs 12 and 13 show that initial and boundary conditions for the adjoint states are always null stated differently we can say that adjoint states let local source sink terms diffuse or transport over domains that are partly disconnected from the domain of the forward problem one might for example invert part of the forward problem on a restriction of its domain of definition by simply calculating the continuous adjoint states on this restriction with appropriate types of boundary conditions with steady state flow and transient transport aimed at retrieving hydraulic conductivity fields with known porosity and dispersivity transport parameters as well as known initial and boundary conditions the gradient components of the objective function are of two types dfh dk linking heads with hydraulic conductivity and dfc dk linking concentrations with hydraulic conductivity via the mean water velocity u and the dispersion tensor d for the part of the objective function handling measured and simulated heads the gradient component with respect to k is given by see delay et al 2017 14 d f h d k ω f k d ω ω h λ d ω if there is no information or no prior guess on hydraulic conductivity values and their comparison with sought values the term f k cancels out in eq 14 and the gradient component of the objective function is a simple scalar product between simulated heads and the associated adjoint state for the part of the objective function handling concentrations the gradient component with respect to k can be obtained as 15 d f c d k f c k u f c k d with 16 f c u 0 t ω ω c μ d ω d t f c k u f c u t u k 0 t ω c μ t h d ω d t 17 f c d 0 t ω ω c μ t d ω d t f c k d 0 t ω ω μ t d k c d ω d t d k d u x u x k d u y u y k ω 1 d u x h x ω 1 d u y h x and 18 d x x u x u x u 3 α l u x 2 2 u y 2 α t u y 2 d y y u x u x u 3 α t u x 2 2 u y 2 α l u y 2 d x y u x d y x u x α l α t u y 3 u 3 d x x u y u y u 3 α t u y 2 2 u x 2 α l u x 2 d y y u y u y u 3 α l u y 2 2 u x 2 α t u x 2 d x y u y d y x u y α l α t u x 3 u 3 the gradient components of the objective function with respect to transport parameters source sink terms and initial and boundary conditions are derived in appendix a as mentioned earlier the non intrusive character of the continuous adjoint state implies exchanges of information between the forward model and the adjoint state this is also exemplified by the relations of eqs 14 17 showing that gradient components of the objective function combine values of the state variables calculated by the forward model and values of the adjoint states 4 parameter estimation strategy the objective function defined by eq 4 is a sum of two terms depending on two very different quantities piezometric heads expressed as a length and concentrations expressed as mass or moles per volume in addition to differences in measurement units the numerical values can also be significantly different as an example a difference of 1 0 m between computed and measured heads for heads varying between 100 m and 110 m is less significant than a difference of 1 0 mg l 1 between computed and measured concentrations for values varying between 0 0 mg l 1 and 2 0 mg l 1 in the context of the maximum likelihood or generalized least squares with regularization the coefficient κ in eq 4 has a physical meaning if the priors on measurement errors are known however this information is not often available doherty 2003 and carrera and neuman 1986 suggested including this coefficient in the parameter estimation procedure medina and carrera 2003 analyzed the optimal weight for identifying hydraulic conductivities conditioned by piezometric heads and concentrations and they tested different values the expected value of the likelihood function provides robust weights to be assigned to concentration and hydraulic conductivity data except for the steady state flow case we followed the suggestion of medina and carrera 2003 and define the weighting coefficient as 19 κ k 1 θ f h k p h p f c k p c p where θ is a user defined variable and k is the iteration index in the optimization procedure an alternative to evaluating hydraulic parameters using both types of data h and c is to consider fh p h p and fc p c p separately the algorithm suggested by strecker and chu 1986 for example consists of a first stage which estimates hydraulic conductivities conditioned by heads only and then is followed by a second stage which estimates hydraulic conductivities conditioned by concentrations only in this work we investigate the performance of the following strategies s1 hydraulic conductivities are estimated using head data only s2 hydraulic conductivities are estimated using head and concentration data simultaneously s3 the conditioning is alternated during the minimization in the sense that a first set of mh iterations considers head data only which is then followed by mc iterations handling both head and concentration data this swap is repeated until convergence in this work we set mh 20 and mc 5 alternated conditioning suggests that a highly flawed flow field could result in simulated concentrations far from data and eventual problems of convergence thus iterations handling head data only should first rough out the flow field then refined by using both heads and concentrations the number of iterations for each type of conditioning is problem dependent this number was chosen by trials counting solutions that converge for 10 runs started at different locations in the parameter space and also counting the mean number of iterations required per solution to converge notably we did not delineate any strategy seeking hydraulic conductivity on the basis of concentration measurements only in general when concentrations are measured in open wells over a groundwater system measures of heads in those wells are also available it would be counter productive to discard head data on the other hand there exist many actual systems where concentrations are never monitored another reason is that seeking hydraulic conductivity fields only via concentration measurements is usually not a convergence problem concentration distributions over time and space depend on the velocity field a quantity defined as the product of conductivity and head gradient lack of information on heads can result in many hydraulic conductivity fields rendering the same model outputs in other words concentrations mainly inform on transit times between two locations along a flow line this time is insensitive to various distributions of the velocities along the line provided their harmonic means are similar therefore with smoothly varying head gradients many distribution of hydraulic conductivities along a flow line would result in the same transit times that being said heads along a flow line are also mainly controlled by the harmonic mean of conductivities the point is that the flow equation is diffusive widespread head data inform on mean conductivities along all the segments joining the pairs of observations with a consequence of a better deciphering of hydraulic conductivity distributions 5 numerical experiments we rely upon synthetic test cases to evaluate the performance of the parameter estimation methodology measurement errors in data as they could be defined here by adding random fluctuations to heads and concentrations extracted from the reference problems are not considered in the inversion exercises as we mainly focus on comparisons between inversion strategies in their ability to identify reference parameter fields over diverse flow and transport conditions in the context of inverse problems the notion of measurement errors is often taken as the difference between outputs of a supposedly exact model and flawed data therefore the absence of noisy measures does not go against the use of an objective function inheriting from the notion of measurement errors 5 1 settings of the test cases the synthetic examples investigate a rectangular flow domain of 250 m in length and 150 m in width the aquifer thickness is constant at 20 m the domain is discretized by a mesh with 1566 triangular elements of 8 m average length four test cases are designed with increasing complexity in the flow field and the solute transport conditions table 2 the boundary conditions for flow are a prescribed uniform head of 100 m at the west boundary and a constant over time uniformly distributed outflow rate of 2 10 3 m3 s 1 over the east boundary the north and south boundaries are considered as impervious see fig 1 the hydraulic conductivity field follows a log normal statistical distribution generated with an exponential isotropic covariance function with an effective correlation length of 60 m and a variance of σ log k 2 0 12 hydraulic conductivity values vary between 3 10 3 m s 1 and 10 5 ms 1 fig 2 usually sequential gaussian simulation techniques when generating random fields over a rough mesh do not fully match the prescribed covariance in practice the effective covariance variogram of the reference hydraulic conductivity field is slightly distorted and shows a correlation length of approximately 85 m but the right prescribed variance this feature is unimportant when the question is to retrieve a reference parameter field via inversion without any prior guess on its structure in the case of inversion exercises seeking both hydraulic conductivity and porosity fields the reference porosity field follows a normal distribution generated with a spherical covariance function that has a correlation length of 80 m and a variance σ ω 2 0 002 porosity values vary between 0 04 and 0 36 fig 2 and as for hydraulic conductivity the effective covariance is slightly distorted with an effective correlation length of 100 m steady state flow is considered the test case c1 is designed without source sink terms whereas five pumping wells and two injection wells locations in fig 1 are added in the domain for the other test cases c2 and c3 see table 2 pumping and injection rates are set to 5 55 10 3 m3 s 1 the mathematical model for flow is solved using mixed finite elements younes et al 2010 with a code developed in the lab and checked for being rigorously mass conservative at the scale of each cell of the mesh it is worth noting that all the settings employed to generate the various flow fields are assumed to render a well posed problem for the inversion of hydraulic conductivities the existence of source sink terms or neumann boundary conditions in the flow equations avoids the evaluation of conductivity up to the multiplication by a constant nevertheless with only 20 head values available for the identification of more than 1500 parameters in essence one per cell of the discretized domain noting those 1500 values are not independent good inversion results are not guaranteed this motivates to complement the head data set with concentrations from transport scenarios incidentally rendering the flow field tortuous by adding injection pumping wells in the system tests cases c2 and c3 is supposed to complicate the inversion using head data only in these test cases concentrations following the main flow paths are expected to increase the degree of improvement of the inverse solutions conditioned on heads only regarding the simulation of solute transport a null dispersive flux is set at all boundaries except at the line x 0 m y 25 125 where a concentration of 1 kg m 3 is prescribed for test cases c1 and c2 and at the upstream western flow boundary of test case c3 where the solute concentration is set to zero for test case c3 a pulse of solute is injected over a rectangular domain of delineation x 5 10 m and y 65 85 m during 2 days with a rate of 8 0 10 3 kg m 3 s 1 the transport parameters are homogeneous and assumed to be known for test cases c1 c2 and c3 the effective porosity is equal to 0 05 and the longitudinal and transverse dispersivities are α l 10 m and α t 1 m respectively notably test case c4 re handles the settings of test case c2 but adds an unknown heterogeneous porosity field to be retrieved in addition to the hydraulic conductivity field for all test cases the solute transport simulations are run under transient conditions with initial null concentrations within the system and the simulations are performed over 120 days the transport equations are solved using a combination of mixed and discontinuous finite elements methods which limits the effects of numerical dispersion hassane et al 2017 steady state hydraulic heads and time varying concentrations are observed at 20 wells see fig 1 uniformly distributed in the domain concentrations are sampled every day overall the observations consist of 20 head values and 20 120 2400 concentration values it is worth noting that a large number of data points as is the case here for concentration values can mislead the inversion procedure when the corresponding computed variables are not sensitive to the parameter values as for example close to the boundary conditions the weighting parameter θ in the κ coefficient of the objective function see eq 19 is set to 10 4 for each test case the initial parameter mesh of the adaptive parameterization see e g ackerer and delay 2010 consists of 12 triangular elements and 11 nodes uniformly distributed over the domain the parameter mesh is refined 3 times and the total number of estimated hydraulic conductivities which may vary between runs according to the way the parameter mesh is refined is between approximately 60 and 80 each inversion is repeated 50 times and the initial parameter grid is assigned with initial parameter values chosen randomly in a uniform distribution the aim of this duplication is to evaluate the reproducibility of the results and compare them to the reference the sought hydraulic conductivity values are bounded between 1 0 10 5 m s 1 and 3 0 10 3 m s 1 during inversion and for test case c4 porosity is sought in the range 0 01 0 40 these upper and lower bounds of hydraulic conductivities and porosities are the only prior information on parameters brought to the inversion procedure adjoint state variables associated with both flow and transport are computed with a different numerical code but with the same grid and the same numerical methods as those employed for the calculation of the state variables codes for the adjoint states were developed in the lab as tools independent of the forward codes with the aim of building an inversion toolbox working in parallel with any forward model even on non proprietary codes for which the calculation structures are unknown separate codes between the forward problem and the adjoint state calculations also allowed us to check how the exchanges of information between the grids of adjoint states and that of the forward flow and transport models could eventually hamper inversions see e g delay et al 2017 this feature is not reported in this study as both the forward problems and adjoint state calculations share the same computation grids with exchanges of information free from any interpolation 5 2 inversion of the hydraulic conductivity with known uniform porosity the settings of the test cases are motivated by three objectives that are i to evaluate the different strategies for estimating the parameters strategies s1 to s3 ii to assess the effects of flow conditions by comparing test cases c1 and c2 and iii to assess the effects of transport boundary conditions by comparing test cases c2 to c3 irrespective of the addressed test cases the observed hydraulic heads are always matched within an error of 5 10 cm for maximal variations of heads over the flow fields of approximately 2 m this very good matching see also a comparison of heads between inverted and reference flow fields in fig 3 justifies that results on heads will not be addressed in the following discussion consequently the comparisons are based on different criteria and only involve concentration and hydraulic conductivities these criteria deal with the overall spatial distribution of concentrations at a given time the analysis of breakthrough curves btc at 3 locations see fig 1 and the calibrated parameter fields compared with the reference fifty different solutions per test were analyzed these solutions were obtained by starting the inversion procedure from different randomly picked locations in the parameter space it is also worth noting that the multiscale parameterization randomizes the current inverse solution each time the parameter grid is refined these solutions cannot be distinguished in view of the final values of the objective function meaning that they are of similar quality in terms of quadratic differences between the reference and estimated heads and concentrations regarding solute concentrations the btc stemming from 50 solutions were gathered into a confidence interval computed for each time step n and defined by c n σ c n where cn is the mean of the 50 concentration values at time step n and σ c n is the corresponding standard deviation preliminary computations show that the confidence intervals did not change significantly by running more simulations with these 50 realizations an average value of the decimal logarithm of the hydraulic conductivity log k e was computed for each element e of the mesh with its associated standard deviation an average error for each element e ε e was also used as an assessment criterion and defined by 20 ε e log k e log k e where ke is the exact value from the reference field of the hydraulic conductivity at element e and k e is the estimated value the variograms of log k e were also compared with the reference as an overall indicator of quality of estimated parameter fields in the same way as for breakthrough curves the 50 variogram functions were gathered into a confidence interval for each lag the concentration distributions are provided in fig 3 the main features of the reference concentration distributions are reproduced by the inverse solutions for all test cases and all inversion strategies regarding the objective function however the estimated concentrations show additional smearing compared with the reference even though the same mesh and same dispersivities were used for calculating reference and inverse solutions as shown hereafter the retrieved hydraulic conductivity fields are smoother than the reference this feature is consistent with the robustness of the flow equation with respect to hydraulic conductivity in the sense that the head variable is not very sensitive to local contrasts in hydraulic conductivity values e g giudici and vassena 2008 the strategy overlooking concentration data in the objective function s1 provides results as good as the other strategies accounting for concentrations in test cases c1 and c3 however in test case c2 the effects of the injection wells are not completely reproduced the quality of the match for test case c3 is still quite good even though solute concentrations remain null for some observation wells that are not downstream of the local injection source this means that including observations at locations that do not see any concentrations is helpful to retrieve the fluid velocity field and its subsequent relationship with hydraulic conductivities the different strategies can be distinguished when considering btc figs 4 6 as a quality criterion of the parameter estimation for test case c1 fig 4 the btc are well reproduced when employing the two strategies s1 and s2 for strategy s3 which consists of incorporating concentration data in the objective function while calculating the first iterations of convergence by relying upon head data only the method results in a few discrepancies regarding the arrival times of concentrations this bias on arrival times also occurs with strategy s1 concentration data are never used and test case c2 fig 5 these two attempts show that concentration data provide useful and valuable information on solute travel times which in turn inform on hydraulic conductivity values test case c3 is harder to decipher because solute concentrations remain equal to the initial conditions null concentration values at a significant number of monitored wells not located downstream of the local injection therefore test case c3 is more sensitive to flow direction variations within the domain than test cases c1 and c2 a poor estimation of the flow direction in test case c3 leads to either a difference in mean travel time or a difference in the total solute mass passing through the wells the mass being defined as the integral of the btc over time discrepancies in mass can be observed at wells p7 and p9 except for strategy s2 again strategy s2 which includes weighted information on both head and concentration data in the objective function is the most efficient strategy to retrieve the flow field it is worth noting that for all test cases and all strategies the early arrival times of concentrations are well estimated the accuracy of the estimated parameters decreases with the travel distance late arrival times as shown by the increase in the range of the confidence interval from well p11 to well p9 for test cases c1 and c2 the estimated hydraulic conductivities are analyzed by comparing the average value of log k its related standard deviation and the average error in eq 20 figs 7 9 the three test cases provide very similar results showing that in general the hydraulic conductivity field is fairly well reproduced irrespective of the inversion strategy employed the largest differences between estimated and reference log k are located close to the eastern boundary of the domain assigned with a prescribed flux for flow at these locations fluxes remain almost similar irrespective of the local conductivity values the reliability of the estimated parameters measured by the local standard deviation of log k is poor high standard deviation in this eastern area compared with the rest of the domain it is also worth noting that after 120 days of transport solute concentrations did not reach the eastern boundary and thus poorly inform the inverse problem on local hydraulic conductivity experienced during transport this could be an additional explanation for the poor evaluation of conductivities close to the eastern boundary of the domain the third strategy s3 leads to the poorest parameter estimation compared with the other two the ensemble of inverse solutions is wider for strategy s2 than for strategy s1 see test cases c2 and c3 in figs 8 9 these results may appear counter intuitive as it is usually expected that more information of good quality brought to the inverse problem should yield better results or at least more constrained solutions which is consistent with the robustness of these solutions this notwithstanding the additional information provided by concentrations does not have the same meaning as information on heads in short concentrations are sensitive to flow directions and associated travel times along these directions as heads are sensitive to conductivities in a neighborhood roughly centered on the head measurement location increasing the complexity of the inverse problem by multiplying the number of sensitive factors or phenomena is conducive to an increase of local minima this feature spreads out the set of possible inverse solutions even though these solutions resulted in similar values of the objective function finally the results were analyzed via a global criterion comparing the variogram of log k from the reference solution to the variograms computed from the estimated solutions fig 10 all variograms from inverse solutions underestimate the spatial variability of hydraulic conductivities within lag distances less than one half the size of the domain this feature is consistent with the fact evoked above stating that hydraulic head fields are not very sensitive to local contrasts in hydraulic conductivity values in addition concentrations at a given time and location depend on the average travel time between the source and the observation well therefore they are rather less sensitive to local hydraulic conductivity variations than to the mean of conductivities experienced along the flow path between injection and observation this could explain the inference of smaller variances for variograms from inverted conductivity fields in the same vein hydraulic heads as the variables of a diffusion process darcian flow are known to be rather more sensitive to mean values of conductivities over large patches than to contrasts between local values 5 3 identification of hydraulic conductivity and effective porosity distributions the additional test case c4 re handles the settings of test case c2 but considers the inversion of both the hydraulic conductivity field and a heterogeneous effective porosity field a single strategy s2 was employed to estimate the parameters with the minimization in a single phase of an objective function mixing both hydraulic head and concentration data eq 4 this choice of a single strategy is motivated by the inversions of hydraulic conductivity fields that showed strategy s2 to be the most efficient even though the three strategies employed render almost similar results it was thought that strategy s2 would also be the best suited to the joint inversion of hydraulic conductivity and porosity as the mean porosity of the heterogeneous field is approximately 0 12 0 15 in the western half of the domain compared with the uniform value of 0 05 in test case c2 the simulation time for transport is increased up to 280 days 120 days for test case c2 to let the solute plume widely invade the system the reliability of the simulated concentrations figs 11 and 12 and of the estimated parameters figs 13 and 14 has been significantly diminished compared with the test cases solely inverting hydraulic conductivities this can tentatively be explained by several features among which the most likely is that the main driver to solute concentration propagation is the mean water velocity which depends on the ratio of hydraulic conductivity to effective porosity it is always challenging to identify both terms of a ratio when the latter is the sensitive parameter even though both terms of the ratio in the present study are independent quantities with different correlation lengths etc it is worth noting that actual data may show relationships between porosity and conductivity values following for example the well known archie s law in its various forms however these relationships mainly apply to the fine scale of core samples but rarely apply to the elementary mesh of a regional aquifer model in the latter case small variations in porosity values do not generate enough variability in hydraulic conductivities that might vary over orders of magnitude that being said it seems that choosing independent porosity and conductivities values does not help hamper inversion more than choosing loosely correlated values another feature hampering inversion is the increased number of sought parameters which is approximately 70 hydraulic conductivity values in test case c2 inversions and becomes approximately 210 in our tests with two independent parameter grids one for conductivity and one for porosity in test case c4 inversions the difficulties experienced by the inverse procedure in test case c4 are also witnessed by the important variability in the estimated concentrations resulting from flow and transport through solution parameter fields fig 12 the spreading of the 50 different possible solutions and the mean local errors between solutions and the reference are also enlarged compare for log k plots fig 13 and test case c2 s2 in fig 8 the variograms of the solution parameter fields fig 14 render the same appraisal by underestimating the variability at small scales small lag distances they also highlight the difficulty in estimating with confidence the spatial distribution of porosity 6 conclusion we have provided a rigorous and detailed presentation of the partial differential equations ruling the continuous adjoint state associated with solute transport the adjoint state obeys an advection dispersion equation that must be solved backward in time and with a reversed flow field compared to the forward problem of transport it also obeys specific boundary conditions it can be identified uniquely in a single calculation very similar to that of the forward problem then it can serve as calculations for all gradients of the objective function with respect to parameters initial and boundary conditions and source sink terms we have also extended the adaptive parameterization technique to solute transport and to coupled inversion of flow and transport data the methodology has been applied to four synthetic test cases targeting the estimation of hydraulic conductivity and effective porosity fields using both piezometric heads and solute concentration data these numerical experiments showed 1 employing the continuous adjoint state solved via an independent numerical code that is in a non intrusive way with regard to existing proprietary transport models is a viable alternative to more common methods gauss newton and quasi newton methods with embedded computations of sensitivities or adjoint variables for joint parameter estimation 2 concentration data has to be taken into account in the parameter estimation and included in the objective function in a balanced way if the objective function is not weighted usually hydraulic head observations are rapidly fitted by the inverse procedure and the conditioning by concentrations will not bring any additional information in the weighting procedure the weighting coefficient can be adapted during the minimization and is not necessarily a parameter to include in the minimization 3 concentration data render information on travel times and flow directions as a valuable means to improve the inference of unknown hydraulic conductivity fields null concentrations at some locations are also helpful in the process of incorporating transport data to retrieve conductivity fields it could be conjectured that a poor prior knowledge of the fluid velocity field could mislead the inversion relying upon transport data the consequence would be to partly separate the inversion procedure in a first step predefining the flow field conductivities on the basis of hydraulic head measurements then in a second step launching calculations of transport even though successes of inversions are problem dependent we have shown that the above conjecture is wrong it is wise to invert both flow and transport scenarios in the same procedure which means that the objective function of the inverse problem should mix information on heads and concentrations the objective function would then be minimized in a single phase handling both terms in heads and concentrations 4 in the test cases reported by this study it is worth noting that hydraulic head observations were always rapidly fitted and when used alone these data rendered valuable hydraulic conductivity fields the addition of concentration data in the inversion procedure brought few cosmetic features to the conductivity fields except for better assessment of early and mean travel times in the system which applies to both sweeping uniform or tortuous flow fields a key question raised by this study can be formulated as is it worth a try to include concentration data for identifying hydraulic conductivities when it is known how cumbersome and costly concentration measurements can be acknowledgments the authors are indebted to the qatar national research foundation qnrf for partly funding this study under the grant nprp9 030 1 008 dual porosity modeling of qatar karst aquifers this study is also a contribution to the geotref project funded by the french government in the framework of the investissements d avenir program and tutored by ademe appendix a the development of the continuous adjoint state associated with the advection dispersion equation for solute transport in porous media is presented below the continuous expressions of the gradient components of the objective function are also provided the continuous operator that solves solute transport and that represents the constraint v c p 0 in the lagrangian operator of an optimization problem is written as a1 v c p 0 ω c t ω u c ω d c q c 0 over ω and 0 t with initial and boundary conditions a2 c c 0 over ω at t 0 c c d over d ω c and 0 t d c n γ q n c over n ω c and 0 t at this stage perturbations δp resulting in perturbations δc to keep v c δc p δp 0 only concern model parameters that is δp δω δu δd noting that u is a parameter for the transport equation but also an output of a flow model a later discussion will address perturbations regarding source sink terms initial conditions and boundary conditions a variation of the lagrangian operator is employed to derive the equations of the adjoint state which takes the form a3 δ l 0 t ω f c δ c d ω d t 0 t ω f p δ p d ω d t 0 t ω v c δ c p δ p v c p μ d ω d t with f the continuous objective function μ the continuous adjoint state and the constraint v c δc p δp 0 the latter is developed as a4 v c δ c p δ p 0 ω δ ω c δ c t ω δ ω u δ u c δ c ω δ ω d δ d c δ c q c 0 over ω and 0 t and flanked with initial and boundary conditions a5 c δ c c 0 over ω at t 0 c δ c c d over d ω c and 0 t d δ d c δ c n γ q n c over n ω c and 0 t developing to the first order i e by neglecting terms in δ2 the difference v δ v renders a6 v c δ c p δ p v c p 0 ω δ c t c δ ω t ω u δ c ω δ u c δ ω u c ω d δ c ω δ d c δ ω d c 0 over ω and 0 t with initial and boundary conditions a7 δ c 0 over ω at t 0 δ c 0 over d ω c and 0 t d δ c n γ δ d c n γ 0 over n ω c and 0 t the basic idea prevailing for the identification of the continuous adjoint state equations is to isolate the terms in δ in the integrals 0 t ω v δ v μ d ω d t of the operator δl in eq a3 this occurs via integration by parts for all terms in eq a6 which are handled below as they appear ranked in eq a6 a8 0 t ω ω δ c t μ d ω d t 0 t ω ω δ c μ t d ω d t ω ω δ c μ d ω 0 t 0 t ω ω δ c μ t d ω d t in eq a8 simplifications come from the following properties at t 0 δc 0 is due to boundary conditions in eq a7 at t t μ is set to zero as it is the initial condition for calculating μ see below and μ can be defined up to the addition of a constant a9 0 t ω c δ ω t μ d ω d t 0 t ω c δ ω μ t d ω d t ω c δ ω μ d ω 0 t 0 t ω c δ ω μ t d ω d t ω c 0 δ ω 0 μ 0 d ω where it has been accounted for the fact that μ 0 at t t we note that a10 0 t a t b d t 0 t b t a d t a b 0 t 0 t b t a d t a 0 b 0 i f b t 0 using the property μ 0 at t t and applying eq a10 in eq a9 results in a11 0 t ω c δ ω t μ d ω d t 0 t ω δ ω μ c t d ω d t a12 0 t ω ω u δ c μ d ω d t 0 t ω ω δ c u μ d ω d t 0 t n ω c ω δ c μ u n γ d γ d t in eq a12 the contour integral over the dirichlet type boundary d ω c has been cancelled out considering that δc 0 along this type of boundary see eq a7 a13 0 t ω ω δ u c μ d ω d t 0 t ω ω c δ u μ d ω d t 0 t ω ω c μ δ u n γ d γ d t 0 t ω ω c δ u μ d ω d t a14 0 t ω δ ω u c μ d ω d t 0 t ω δ ω c u μ d ω d t 0 t ω δ ω c μ u n γ d γ d t 0 t ω δ ω c u μ d ω d t in eqs a13 and a14 the contour integrals cancel out because the perturbations δu and δω are null along the boundaries ω and u are not defined straight at the boundary of the modeled domain they do not appear in the boundary conditions and incidentally the adjoint state μ which is defined up to the addition of a constant can be considered as null along a dirichlet type boundary a15 0 t ω ω d δ c μ d ω d t 0 t ω δ c ω d μ d ω d t 0 t ω δ c ω d μ n γ d γ d t 0 t ω ω μ d δ c n γ d γ d t 0 t ω δ c ω d μ d ω d t 0 t n ω c δ c ω d μ n γ d γ d t the expression in eq a15 has been integrated by parts twice to extract the perturbation δc from the operator the simplification of contour integrals results from μ 0 over the contour d ω c and the boundary conditions δc 0 over d ω c note also that d δ c n γ from a15 in addition to δ d c n γ which appear in a16 results in a null term over n ω c see boundary conditions a7 a16 0 t ω ω δ d c μ d ω d t 0 t ω ω μ t δ d c d ω d t 0 t ω ω μ δ d c n γ d γ d t 0 t ω ω μ t δ d c d ω d t in eq a16 the contour integral cancels out because μ 0 over the contour d ω c and δ d c n γ in addition to d δ c n γ in a15 cancel out over n ω c a17 0 t ω δ ω d c μ d ω d t 0 t ω δ ω μ t d c d ω d t 0 t ω δ ω μ d c n γ d γ d t 0 t ω δ ω μ t d c d ω d t in eq a17 the contour integral cancels out because μ 0 over the contour d ω c and the perturbationδω is zero over the whole contour ω gathering all terms in δc over the expressions in eqs a8 a17 then reintroducing them into the variation of the lagrangian operator δl in eq a3 and cancelling out the whole poses the continuous equations of the adjoint state which render a18 ω μ t ω u μ ω d μ f c 0 over ω and t 0 μ 0 over ω at t t μ 0 over d ω c and t 0 ω μ u ω d μ n γ 0 over n ω c and t 0 it is worth noting that eq a18 has to be solved backward in time and with a reversed velocity field u otherwise the problem lacks physical meaning with a negative dispersion tensor in the advection dispersion equation the neumann boundary condition of the forward problem in eq a2 has been transformed into a robin boundary condition with a reversed velocity field u along the contour n ω c usually in transport problems a so called homogeneous neumann boundary condition d c n γ 0 is associated with a no flow boundary yielding u n γ 0 in that case the robin boundary condition for the adjoint state simplifies into μ n γ 0 another possibility where the condition d c n γ 0 applies is that of a free advective flux exiting the system with no modification beyond the boundary in that case the robin boundary condition of the adjoint state with a reversed flow field simply consists in letting a prescribed value μ 0 enter into the domain solving the adjoint state equations in eq a18 changes the expression of the variation of the lagrangian operator in eq a3 which simplifies into a19 δ l 0 t ω f p δ p d ω d t 0 t ω δ p g c μ d ω d t with the three types of parameters ω u and d in p the operator δl can be separated into three components from eqs a11 a14 and a17 a20 δ l ω 0 t ω δ ω f ω d ω d t 0 t ω δ ω c t μ c u μ μ t d c d ω d t from eq a13 a21 δ l u 0 t ω δ u f u d ω d t 0 t ω ω c δ u μ d ω d t from eq a16 a22 δ l d 0 t ω δ d f d d ω d t 0 t ω ω μ t δ d c d ω d t the expressions in eqs a20 a22 give the form of the gradient components of the objective function with respect to parameters ω u and d for example let us take u x i n the velocity along the x direction over a subdomain ω i of ω and over the time step δtn within the period 0 t the gradient component of the objective function with respect to u x i n is expressed via eq a21 as a23 d f δ u x i n δ l δ u x i n δ t n ω i f u x i n d ω d t δ t n ω i ω c μ x d ω d t the strength of the continuous adjoint state also allows us to retrieve source sink terms initial conditions and boundary conditions by providing the gradient components of the objective function with respect to these factors regarding source sink terms the operator v δ v in eq a6 is modified to include a perturbation δqc as this perturbation is independent of that on the parameters δω δu and δd the integration 0 t ω v δ v μ d ω d t simply lets an additional term in the form 0 t ω δ q c μ d ω d t appear the latter does not alter the development between eqs a8 and a17 consequently the continuous adjoint state eq a18 and the gradient components of the objective function precisely the components of the operator δl with respect to parameters ω u and d eqs a20 a22 are unmodified after the adjoint state μ has been calculated by solving eq a18 the gradient components of the objective function with respect to source sink terms qc are calculated by employing a24 δ l q c 0 t ω δ q c f q c d ω d t 0 t ω δ q c μ d ω d t regarding initial and boundary conditions the operator v δ v in a6 is modified on its initial and boundary conditions in eq a7 the latter become a25 δ c δ c 0 over ω at t 0 δ c δ c d over d ω c and 0 t d δ c n γ δ d c n γ δ q n c over n ω c and 0 t with δc 0 the perturbation associated with initial conditions and δcd δ q n c the perturbations associated with dirichlet and neumann type boundary conditions respectively the general form of the operator 0 t ω v δ v μ d ω d t is not modified but the expansion of a few terms slightly changes δc 0 appears in eq a8 which becomes a26 0 t ω ω δ c t μ d ω d t 0 t ω ω δ c μ t d ω d t ω ω δ c μ d ω 0 t 0 t ω ω δ c μ t d ω d t ω ω δ c 0 μ 0 d ω where the properties μ 0 at t t and δc δc 0 at t 0 have been accounted for the perturbations δcd and δ q n c appear in the two successive integrations by parts of eq a15 and the integration by parts of a16 more precisely only the contour integrals are modified their sum from expressions in a15 and a16 renders a27 0 t ω δ c ω d μ n γ d γ d t 0 t ω ω μ d δ c n γ d γ d t 0 t ω ω μ δ d c n γ d γ d t 0 t n ω c δ c ω d μ n γ d γ d t 0 t d ω c δ c d ω d μ n γ d γ d t 0 t n ω c ω μ δ q n c n γ d γ d t the contour integrals of eq a27 take into account the following properties μ 0 over the contour d ω c the boundary condition δc δcd over d ω c and the boundary condition d δ c n γ δ d c n γ δ q n c over n ω c all the remaining terms in the development of 0 t ω v δ v μ d ω d t are unchanged which also comes down to unchanged continuous equations for the adjoint state μ and the components of lagrangian operator δl regarding perturbations on parameters δω δu and δd when the adjoint state has been calculated by solving eq a18 the gradient components of the objective function with respect to initial and boundary conditions are accessible via a28 δ l c 0 0 t ω δ c 0 f c 0 d ω d t ω δ c 0 ω μ 0 d ω δ l c d 0 t d ω c δ c d f c d d ω d t 0 t d ω c δ c d ω d μ n γ d γ d t δ l q n c 0 t n ω c δ q n c f q n c d ω d t 0 t n ω c ω μ δ q n c n γ d γ d t 
671,a parameter estimation methodology has been developed on the basis of model inversion using a quasi newton method and adaptive parameterization the continuous adjoint state equations for both flow and transport in porous media are employed as the tool calculating the gradient components of the objective function with respect to parameters solving the continuous form of the adjoint equations can be implemented independently of the code used to solve the forward problem which renders the technique non intrusive the developed methodology is applied to the identification of hydraulic conductivity and porosity fields conditioned by piezometric head data associated with steady state flow and transient solute concentrations synthetic numerical experiments have been undertaken for test cases of increasing complexity from an almost uniform flow sweeping the modeled domain with a prescribed uniform continuous injection of solute at the inflow boundary to spatially highly variable flow conditions obtained through source sink terms within the flow domain and a local stepwise solute injection the results of inversions are analyzed using criteria based on the comparisons between estimated concentration and reference concentration values as well as comparisons between estimated hydraulic conductivity and porosity for one test case and reference hydraulic conductivity fields the results show that employing a continuous adjoint state technique computed independently of the direct problem is an efficient option for parameter estimation relying jointly upon flow and transport data in the reported numerical examples that are characterized by the identifiability of the flow problem on the basis of hydraulic head observations concentration data from solute transport scenarios bring few added value to sought solutions of hydraulic conductivities the spatial structure of the conductivity fields is slightly improved compared with the reference but the overall system in terms of head distribution identification of main flow paths and solute transit times only inherits cosmetics keywords parameter estimation adjoint state adaptive parametrisation groundwater hydraulic conductivity porosity 1 introduction parameter estimation through inverse methods for flow and solute transport simulations is still challenging despite the variety of concepts and methods developed since the pioneer works in inverse methods of vemuri et al 1969 emsellem and de marsily 1971 and yeh and tauxe 1971 among others recent reviews of conceptual frameworks and methods can be found in hendricks franssen et al 2009 zhou et al 2014 and linde et al 2015 almost all the developed methods target the estimation of hydraulic conductivities or transmissivities constrained conditioned by hydraulic heads and through the last 40 years by additional data such as solute concentrations geological information or geophysical properties in this work we focus as a first goal on estimating spatially heterogeneous hydraulic conductivity and porosity fields conditioned by both hydraulic heads and solute concentrations many authors have already addressed this challenge and table 1 presents an overview of various approaches dedicated to this topic the table is not an exhaustive presentation of the existing literature but a selection of works 17 contributions ranked as they appear in time in the literature that we consider representative of methods and trends solving the inverse problem for flow and transport in ground water systems is tightly associated with methodological choices among the possible choices we exemplify via continuous adjoint state calculations how gradient based inversion techniques can cope with highly parameterized problems mixing data of various types and weighting them in the objective function of an inverse problem is also a key feature this is why this study emphasizes methodology as a second goal notably when modeling natural systems or synthetic test cases supposedly close to natural systems it is always complicated to discuss on identifiability uniqueness of inverse solutions quality of conditioning etc simply because highly parameterized inverse problems encompassing multiple elementary processes result in fuzzy theoretical frameworks that being said it cannot be overlooked that complex systems might result in multiple inverse solutions repeatability in the sense of estimating how similar various solutions are when initiated at different locations in the parameter space appears as a simple way to determine success or failure of inversions incidentally when dealing with synthetic test cases employing fully known reference problems the comparison between inverse solutions and references is also informative in this study observations associated with flow and transport parameter estimations are scarce piezometric head data from steady state flow conditions and solute concentrations under transient transport conditions these data are used to build an objective function assembling two terms the sum of the weighted squared differences between measured and computed piezometric heads fh and the sum of the weighted squared differences between measured and computed solute concentrations fc notably the weights may sometimes serve to narrow down the range spanned by the squared differences when data of different units are used this type of objective function is usually employed within i the non linear least square framework which also often adds a regularization term on model parameters or ii the maximum likelihood framework earlier proposed by carrera and neuman 1986 which allows for handling prior information on model parameters summing two quantities that have different units in an objective function requires an adapted strategy and or the use of a weighting coefficient applied to one of these terms usually fc in fact the weighting should be directly given by the probability density functions of errors between model outputs and observations the point is that these densities are generally conjectured which results in weights given to fh and fc becoming parameters of the inversion procedure pioneer works from umari et al 1979 strecker and chu 1986 and keidser and rosbjerg 1991 proposed a two stage procedure to minimize successively fh and fc simultaneous inversion of both heads and solute concentrations and simultaneously decreasing both fh and fc is nowadays the common way to estimate the parameters nevertheless the optimal weighting of the two terms fh and fc has been under debate carrera and neuman 1986 doherty 2003 medina and carrera 2003 and is still not fully resolved even though abundant literature and many studies are available for other inversion techniques gradient based methods are the most common algorithms applied to minimize the objective function the minimization employs either sensitivity coefficients with a gauss newton method levenberg 1944 marquardt 1963 or adjoint state variables coupled with a quasi newton method byrd et al 1994 over the last decade kalman filtering kalman 1960 and its extensions such as ensemble kalman filtering e g iglesias et al 2013 deng et al 2016 have been applied and improved to efficiently solve the inverse problem the method has become a valuable alternative approach to gradient based methods for estimating flow and transport parameters parameterization techniques have also shown an interesting evolution over the last 50 years zonation was the most popular method during the seventies period probably due to lack of powerful computers that hampered the deployment of stochastic monte carlo simulations stochastic parameterization now seems to be the standard approach for seeking hydraulic conductivity but recently pool et al 2015 recalled that zonation could be a relevant option to represent geological patterns for large scale aquifers i e systems of several tens of km extension with flow patterns modeled at the 100 1000 m scale in most applications transport parameters effective porosity and dispersivities are usually considered as uniform over the modeled domain and transport heterogeneity is mainly associated with heterogeneous hydraulic conductivity fields and subsequent variations of the mean fluid velocity in the system in this work we explore the capacity of the adaptive parametrization technique detailed in ackerer and delay 2010 and hassane and ackerer 2017 coupled with an independently computed adjoint equation delay et al 2017 to estimate hydraulic conductivity and porosity spatial distributions conditioned by head and concentration measurements in the following section the mathematical models describing the flow and transport processes are presented section 3 provides a synopsis of the continuous adjoint state method used to minimize the objective function under the constraints resulting from solving the flow and transport equations the detailed mathematical development of the continuous adjoint state for transport is reported in appendix a it is presented in a new convenient manner as done for flow in delay et al 2017 that allows for the derivation of the gradient of the objective function with respect to all types of factors including transport parameters initial and boundary conditions and source sink terms of the transport problem the objective function and the minimization strategies are presented in section 4 finally the numerical experiments are presented and discussed in section 5 emphasis is put on the comparison between inverse solutions obtained from calculations conditioned by head data only and by the joint use of head and concentration data 2 the forward problem steady state flow and transient transport conditions in a 2d confined aquifer are assumed these conditions are quite common for practical cases where steady state flow may represent average flow conditions these conditions also work for shallow unconfined aquifers that show small variations of water levels which keep the flow equations linear regarding hydraulic heads we also assume constant aquifer thickness for simplicity which allows for inverting hydraulic conductivities instead of transmissivities but without loss of generality under these conditions groundwater flow and solute transport are modeled over the domain ω and for transport over the time interval 0 t by e g bear 1972 1 q q w over ω q k h h h d over d ω h k h n γ q n w over n ω h 2 ω c t ω u c ω d c q c u q ω over ω and 0 t c c 0 over ω at t 0 c c d over d ω c and 0 t d c n γ q n c over n ω c and 0 t where h l is the hydraulic head k lt 1 is the hydraulic conductivity considered here as a scalar qw t 1 is the flow source sink term c ml 3 is the concentration ω is the effective porosity q lt 1 is the darcy flux u lt 1 is the average water velocity qc ml 3t 1 is the solute source sink term and d l2t 1 is the local dispersion tensor defined by 3 d x x α l u x 2 u α t u y 2 u d y y α t u x 2 u α l u y 2 u d y x d x y α l α t u x u y u where ux uy are the local components of the fluid velocity u is the velocity magnitude and α l α t are the longitudinal and transverse dispersities l respectively dirichlet boundary conditions apply to contours d ω h for flow and d ω c for transport as neumann boundary conditions apply to contours n ω h for flow and n ω c for transport n γ represents the outer vector normal to the contours where neumann boundary conditions are applied boundary conditions and source sink terms are assumed to be known and prescribed at constant values over time it is noticeable that for the above equations the porosity should not vary over time otherwise flow would no longer be steady state boundary conditions for flow and transport have also been written as independent from one another when it might not be the case for example neumann boundary conditions for flow with fluxes exiting the domain are often associated with neumann boundary conditions for concentrations but for entering water fluxes concentrations are often prescribed via dirichlet type boundary conditions 3 parameter identification methodology 3 1 the objective function the parameter identification procedure is based on the minimization of the quadratic differences between measured and computed variables these differences are gathered in a so called objective function defined as 4 f p h p c p f h p h p κ f c p c p with 5 f h p h p h h t w h h h f c p c p j 1 n t c j c j t w c j c j c j where t denotes the transpose operator h and c j are the vectors of computed heads and concentrations with a size corresponding to the number of observations j is the index of observation times for transport nt is the number of times at which concentrations have been measured p is the vector of parameters here hydraulic conductivity and porosity of size np and h and c j are the vectors of observed values h h and c j c j are usually named as measurement errors in the jargon of inverse problems as they simply are the difference between model outputs and observations in a framework considering that the model is exact for a given set of parameters and data are flawed in essence it must be understood that measurement errors encapsulate actual errors on measures differences between model outputs and data and the consequences of conceptual errors associated with a model or its settings that are always approximations of reality assuming that the measurement errors are not correlated in space and invariant over time the w matrices are diagonal and w k k ε k 1 where ε k is the variance of the measurement errors at location k finally κ is a weighting coefficient to ensure a balanced minimization of both fh p h p and fc p c p in the framework of the maximum likelihood and applying the assumptions made on the w matrices κ represents the ratio of the measurement error variance of heads to the measurement errors variance of concentrations these errors are usually unknown from a practical standpoint κ should avoid biased optimization by giving too much importance to either fh or fc medina and carrera 2003 and should therefore be modified during the minimization procedure different minimization techniques of the objective function f p h p c p exist because the number of estimated parameters might be large we rely upon the adjoint state method rendering an estimate of the gradient components of the objective function at a cost independent of the type and the number of parameters see appendix a even though the convergence toward a minimum of the quasi newton methods is usually slower compared with the gauss newton method cooley 1985 for highly parameterized problems it is wise to rely upon the adjoint method seeking gradient components which are then introduced into a quasi newton algorithm chavent 1979 neuman and carrera 1985 sun 1994 ackerer et al 2014 sun and sun 2015 delay et al 2017 variants of the adjoint state exist e g medina and carrera 2003 to calculate model sensitivity to parameters which then feed gauss newton algorithms the latter option is not employed here as the calculation costs strongly depend on the number of measurement values 3 2 the continuous adjoint state the adjoint state technique is associated with the class of problems ensuring the optimization minimization of an objective function under constraints e g bertsekas 1996 these constraints can be for example the equations that are solved by a model for which we seek the optimal parameters rendering model outputs close to observations recently delay et al 2017 presented a thorough discussion on the adjoint state to invert the spatially distributed problem of flow in dual porosity systems their discussion dealt with both the discrete and continuous forms of the adjoint state and with a comparison of their ability to assist inversions in providing rapid calculations of the gradients of the objective function the present work inherits the method proposed by delay et al 2017 and extends it to the inversion of solute transport treated via an advection dispersion equation the adjoint state is employed in its continuous form which can be differentiated and then implemented without prior knowledge about the structure of the discrete equations in the forward model let us take a forward problem as a continuous operator v c p 0 handling a single state variable c x t and a single type of parameter p x t over the domain ω and the period 0 t to space x and time t coordinates are dropped herein when feasible for better readability the objective function of the inverse problem is usually discrete because it compares a finite set of observations of c with equivalent simulated values see e g eqs 4 and 5 nevertheless the objective function is rewritten in a continuous form f c p 0 t ω f c p d ω d t with f an elementary function usually piecewise or pointwise non null at locations in time and space where observations are available it must be noted that the simple integrals over time and space defining f are here employed for ease of notation but without loss of generality when dealing with discrete objective functions as those in eq 5 the formulation of f becomes complicated with four integrals concealed in the continuous form see delay et al 2017 for example with point observations of concentrations c a b denoting a value at location x a and time tb a generalized least square objective function on concentrations in a continuous form could be written as 6 0 t 0 t ω ω m n i j c x t c m i w m n i j c y t c n j δ x x m δ y x n δ t t i δ t t j d x d y d t d t where w m n i j denotes the weight associated with the pair of observations c m i c n j and δ is the delta dirac function minimizing the objective function f knowing that the constraint v c p 0 is fulfilled assumes that both the objective function and the constraints are gathered in a lagrangian operator in the form 7 l c p μ 0 t ω f c p d ω d t 0 t ω v c p μ d ω d t as the second term in eq 7 is null the lagrangian l is equivalent to the objective function f even though it encloses the addition of the constraint v multiplied by the variable μ x t over ω and 0 t the variable μ is a lagrangian multiplier which is defined up to the addition of a constant or the multiplication by a constant μ multiplies a constraint expressed as a null term the lagrangian multiplier is named as the continuous adjoint state of the variable c if model parameters p are perturbed by δp with the consequence of generating a perturbation δc on the variable c such that v c δc p δp 0 a variation of the lagrangian l can be written as 8 δ l 0 t ω f c δ c d ω d t 0 t ω f p δ p d ω d t 0 t ω v c δ c p δ p v c p μ d ω d t where a first order taylor series expansion has been used to rearrange the terms in f identifying the equations ruling the adjoint state μ relies upon the development of the variations in the constraint v c δc p δp v c p while separating terms in δc from terms in δp cancelling out the terms in δc within δl poses the equations of the continuous adjoint state over ω and 0 t and its initial and boundary conditions solving these equations eliminates terms in δc which in turn modifies the variation of the lagrangian that becomes 9 δ l 0 t ω f p δ p d ω d t 0 t ω g c μ δ p d ω d t with g a continuous operator combining the state variable c and the adjoint state μ both previously calculated by the forward problem and the adjoint state equations respectively this operator g depends on the type of parameter the perturbation δp to which it is associated in the scalar product in eq 8 usually parameters in spatially distributed models are defined as uniform values over subdomains ω i of ω e g zones cells etc and eventually over periods δtn within 0 t denoting p i n as the restriction of the parameter p x t to the subdomain ω i and the period δtn the variation of the lagrangian δl in eq 8 renders an approximation of the gradient of the objective function with respect to p i n 10 δ l δ p i n d f d p i n δ t n ω i f p i n d ω d t δ t n ω i g c μ d ω d t where integrals in eq 10 are restricted to the subdomain ω i and the period δtn it is worth noting that the adjoint state μ is independent of the type of gradient component d f d p i n to be calculated stated differently and knowing that μ has been calculated beforehand in a single step very similar to that of the forward model see below the access to gradient components is very rapid irrespective of the type and the number of sought parameters this renders the adjoint state technique suited to highly parameterized problems when methods based on model sensitivities the calculation of each sensitivity being very similar to the forward problem are plagued by computation costs 3 3 adjoint state equations and gradients of the objective function a crucial point of the continuous adjoint state application is in developing the equations ruling the adjoint state and setting the operators g mentioned above for calculating the gradient components several attempts have appeared in the literature even though the technique has not been widely employed in hydrology the most important contribution is probably that proposed by sun and co workers sun 1994 who developed the continuous adjoint states for single phase flow two phase flow transport under various conditions and specific applications targeting the identification of a single type of parameter a specific form of the objective function or steady state problems delay et al 2017 proposed a unified development and presentation of the continuous adjoint state for flow in dual porosity systems which became available for the identification of all types of parameters initial and boundary conditions and source sink terms the continuous adjoint state equations for steady state single phase flow in eq 1 are an adaptation from delay et al 2017 the interested reader is referred to that work for further details regarding the transient solute transport in eq 2 the unified development of the adjoint state equations does not yet appear in the literature and is reported in appendix a regarding the inversion of the coupled problem of steady state flow and transient transport a variation of the continuous lagrangian operator can be written as 11 δ l h c p λ μ ω f h h δ h d ω ω f h p δ p d ω ω u h δ h p δ p u h p λ d ω 0 t ω f c c δ c d ω d t 0 t ω f c p δ p d ω d t 0 t ω v c δ c p δ p v c p μ d ω d t the elementary continuous objective function f has been dissociated in the two components fh and fc enclosing the state variable h head for flow and the state variable c concentration for transport respectively u h p 0 is the continuous steady state flow equation v c p 0 is the continuous transient transport equation λ and μ are the continuous adjoint states associated with flow and transport respectively and p is the undifferentiated vector of factors ruling the flow and transport equations it could include initial and boundary conditions source sink terms and flow and transport parameters here the aim is to retrieve hydraulic conductivity and porosity fields on the basis of head and concentration measurements for pre identified dispersivity parameters known source sink terms and known initial and boundary conditions that being said the hydraulic conductivity influences transport parameters such as the mean water velocity u and the dispersion tensor d see eq 2 it makes sense to calculate via the adjoint state the gradient components of the objective function with respect to u and d and link them with the total variation of the objective function with respect to k the continuous adjoint state equations for steady state flow ruled by eq 1 are derived as see delay et al 2017 12 k λ f h h 0 over ω λ 0 over d ω h k λ n γ 0 over n ω h transport equations in eq 2 are flanked with continuous adjoint state equations in the form see appendix a 13 ω μ t ω u μ ω d μ f c c 0 over ω and t 0 μ 0 over ω at t t μ 0 over d ω c and t 0 d μ n γ 0 over n ω c and t 0 the minus signs appearing in eq 13 for terms in t and in u assume that eq 13 is solved backward over time from t to 0 and with a reversed water velocity field u otherwise eq 13 lacks physical meaning by letting a negative diffusion tensor appear as told earlier continuous adjoint state equations look very similar to their equivalent forward problem in eqs 1 and 2 eqs 12 and 13 can be solved numerically by any means any discretization and numerical scheme independent of the way the forward problem is solved the forward model and the adjoint state calculations can be decoupled which is not the case of the discrete adjoint state technique which is differentiated from and calculated with the same discrete equations as those of the forward model e g ackerer et al 2014 for its part the independent implementation of the continuous adjoint state is able to work with any forward model both simply exchange information such as the source sink terms of the adjoint states fh h and fc c those inheriting from calculations performed by the forward model notably eqs 12 and 13 show that initial and boundary conditions for the adjoint states are always null stated differently we can say that adjoint states let local source sink terms diffuse or transport over domains that are partly disconnected from the domain of the forward problem one might for example invert part of the forward problem on a restriction of its domain of definition by simply calculating the continuous adjoint states on this restriction with appropriate types of boundary conditions with steady state flow and transient transport aimed at retrieving hydraulic conductivity fields with known porosity and dispersivity transport parameters as well as known initial and boundary conditions the gradient components of the objective function are of two types dfh dk linking heads with hydraulic conductivity and dfc dk linking concentrations with hydraulic conductivity via the mean water velocity u and the dispersion tensor d for the part of the objective function handling measured and simulated heads the gradient component with respect to k is given by see delay et al 2017 14 d f h d k ω f k d ω ω h λ d ω if there is no information or no prior guess on hydraulic conductivity values and their comparison with sought values the term f k cancels out in eq 14 and the gradient component of the objective function is a simple scalar product between simulated heads and the associated adjoint state for the part of the objective function handling concentrations the gradient component with respect to k can be obtained as 15 d f c d k f c k u f c k d with 16 f c u 0 t ω ω c μ d ω d t f c k u f c u t u k 0 t ω c μ t h d ω d t 17 f c d 0 t ω ω c μ t d ω d t f c k d 0 t ω ω μ t d k c d ω d t d k d u x u x k d u y u y k ω 1 d u x h x ω 1 d u y h x and 18 d x x u x u x u 3 α l u x 2 2 u y 2 α t u y 2 d y y u x u x u 3 α t u x 2 2 u y 2 α l u y 2 d x y u x d y x u x α l α t u y 3 u 3 d x x u y u y u 3 α t u y 2 2 u x 2 α l u x 2 d y y u y u y u 3 α l u y 2 2 u x 2 α t u x 2 d x y u y d y x u y α l α t u x 3 u 3 the gradient components of the objective function with respect to transport parameters source sink terms and initial and boundary conditions are derived in appendix a as mentioned earlier the non intrusive character of the continuous adjoint state implies exchanges of information between the forward model and the adjoint state this is also exemplified by the relations of eqs 14 17 showing that gradient components of the objective function combine values of the state variables calculated by the forward model and values of the adjoint states 4 parameter estimation strategy the objective function defined by eq 4 is a sum of two terms depending on two very different quantities piezometric heads expressed as a length and concentrations expressed as mass or moles per volume in addition to differences in measurement units the numerical values can also be significantly different as an example a difference of 1 0 m between computed and measured heads for heads varying between 100 m and 110 m is less significant than a difference of 1 0 mg l 1 between computed and measured concentrations for values varying between 0 0 mg l 1 and 2 0 mg l 1 in the context of the maximum likelihood or generalized least squares with regularization the coefficient κ in eq 4 has a physical meaning if the priors on measurement errors are known however this information is not often available doherty 2003 and carrera and neuman 1986 suggested including this coefficient in the parameter estimation procedure medina and carrera 2003 analyzed the optimal weight for identifying hydraulic conductivities conditioned by piezometric heads and concentrations and they tested different values the expected value of the likelihood function provides robust weights to be assigned to concentration and hydraulic conductivity data except for the steady state flow case we followed the suggestion of medina and carrera 2003 and define the weighting coefficient as 19 κ k 1 θ f h k p h p f c k p c p where θ is a user defined variable and k is the iteration index in the optimization procedure an alternative to evaluating hydraulic parameters using both types of data h and c is to consider fh p h p and fc p c p separately the algorithm suggested by strecker and chu 1986 for example consists of a first stage which estimates hydraulic conductivities conditioned by heads only and then is followed by a second stage which estimates hydraulic conductivities conditioned by concentrations only in this work we investigate the performance of the following strategies s1 hydraulic conductivities are estimated using head data only s2 hydraulic conductivities are estimated using head and concentration data simultaneously s3 the conditioning is alternated during the minimization in the sense that a first set of mh iterations considers head data only which is then followed by mc iterations handling both head and concentration data this swap is repeated until convergence in this work we set mh 20 and mc 5 alternated conditioning suggests that a highly flawed flow field could result in simulated concentrations far from data and eventual problems of convergence thus iterations handling head data only should first rough out the flow field then refined by using both heads and concentrations the number of iterations for each type of conditioning is problem dependent this number was chosen by trials counting solutions that converge for 10 runs started at different locations in the parameter space and also counting the mean number of iterations required per solution to converge notably we did not delineate any strategy seeking hydraulic conductivity on the basis of concentration measurements only in general when concentrations are measured in open wells over a groundwater system measures of heads in those wells are also available it would be counter productive to discard head data on the other hand there exist many actual systems where concentrations are never monitored another reason is that seeking hydraulic conductivity fields only via concentration measurements is usually not a convergence problem concentration distributions over time and space depend on the velocity field a quantity defined as the product of conductivity and head gradient lack of information on heads can result in many hydraulic conductivity fields rendering the same model outputs in other words concentrations mainly inform on transit times between two locations along a flow line this time is insensitive to various distributions of the velocities along the line provided their harmonic means are similar therefore with smoothly varying head gradients many distribution of hydraulic conductivities along a flow line would result in the same transit times that being said heads along a flow line are also mainly controlled by the harmonic mean of conductivities the point is that the flow equation is diffusive widespread head data inform on mean conductivities along all the segments joining the pairs of observations with a consequence of a better deciphering of hydraulic conductivity distributions 5 numerical experiments we rely upon synthetic test cases to evaluate the performance of the parameter estimation methodology measurement errors in data as they could be defined here by adding random fluctuations to heads and concentrations extracted from the reference problems are not considered in the inversion exercises as we mainly focus on comparisons between inversion strategies in their ability to identify reference parameter fields over diverse flow and transport conditions in the context of inverse problems the notion of measurement errors is often taken as the difference between outputs of a supposedly exact model and flawed data therefore the absence of noisy measures does not go against the use of an objective function inheriting from the notion of measurement errors 5 1 settings of the test cases the synthetic examples investigate a rectangular flow domain of 250 m in length and 150 m in width the aquifer thickness is constant at 20 m the domain is discretized by a mesh with 1566 triangular elements of 8 m average length four test cases are designed with increasing complexity in the flow field and the solute transport conditions table 2 the boundary conditions for flow are a prescribed uniform head of 100 m at the west boundary and a constant over time uniformly distributed outflow rate of 2 10 3 m3 s 1 over the east boundary the north and south boundaries are considered as impervious see fig 1 the hydraulic conductivity field follows a log normal statistical distribution generated with an exponential isotropic covariance function with an effective correlation length of 60 m and a variance of σ log k 2 0 12 hydraulic conductivity values vary between 3 10 3 m s 1 and 10 5 ms 1 fig 2 usually sequential gaussian simulation techniques when generating random fields over a rough mesh do not fully match the prescribed covariance in practice the effective covariance variogram of the reference hydraulic conductivity field is slightly distorted and shows a correlation length of approximately 85 m but the right prescribed variance this feature is unimportant when the question is to retrieve a reference parameter field via inversion without any prior guess on its structure in the case of inversion exercises seeking both hydraulic conductivity and porosity fields the reference porosity field follows a normal distribution generated with a spherical covariance function that has a correlation length of 80 m and a variance σ ω 2 0 002 porosity values vary between 0 04 and 0 36 fig 2 and as for hydraulic conductivity the effective covariance is slightly distorted with an effective correlation length of 100 m steady state flow is considered the test case c1 is designed without source sink terms whereas five pumping wells and two injection wells locations in fig 1 are added in the domain for the other test cases c2 and c3 see table 2 pumping and injection rates are set to 5 55 10 3 m3 s 1 the mathematical model for flow is solved using mixed finite elements younes et al 2010 with a code developed in the lab and checked for being rigorously mass conservative at the scale of each cell of the mesh it is worth noting that all the settings employed to generate the various flow fields are assumed to render a well posed problem for the inversion of hydraulic conductivities the existence of source sink terms or neumann boundary conditions in the flow equations avoids the evaluation of conductivity up to the multiplication by a constant nevertheless with only 20 head values available for the identification of more than 1500 parameters in essence one per cell of the discretized domain noting those 1500 values are not independent good inversion results are not guaranteed this motivates to complement the head data set with concentrations from transport scenarios incidentally rendering the flow field tortuous by adding injection pumping wells in the system tests cases c2 and c3 is supposed to complicate the inversion using head data only in these test cases concentrations following the main flow paths are expected to increase the degree of improvement of the inverse solutions conditioned on heads only regarding the simulation of solute transport a null dispersive flux is set at all boundaries except at the line x 0 m y 25 125 where a concentration of 1 kg m 3 is prescribed for test cases c1 and c2 and at the upstream western flow boundary of test case c3 where the solute concentration is set to zero for test case c3 a pulse of solute is injected over a rectangular domain of delineation x 5 10 m and y 65 85 m during 2 days with a rate of 8 0 10 3 kg m 3 s 1 the transport parameters are homogeneous and assumed to be known for test cases c1 c2 and c3 the effective porosity is equal to 0 05 and the longitudinal and transverse dispersivities are α l 10 m and α t 1 m respectively notably test case c4 re handles the settings of test case c2 but adds an unknown heterogeneous porosity field to be retrieved in addition to the hydraulic conductivity field for all test cases the solute transport simulations are run under transient conditions with initial null concentrations within the system and the simulations are performed over 120 days the transport equations are solved using a combination of mixed and discontinuous finite elements methods which limits the effects of numerical dispersion hassane et al 2017 steady state hydraulic heads and time varying concentrations are observed at 20 wells see fig 1 uniformly distributed in the domain concentrations are sampled every day overall the observations consist of 20 head values and 20 120 2400 concentration values it is worth noting that a large number of data points as is the case here for concentration values can mislead the inversion procedure when the corresponding computed variables are not sensitive to the parameter values as for example close to the boundary conditions the weighting parameter θ in the κ coefficient of the objective function see eq 19 is set to 10 4 for each test case the initial parameter mesh of the adaptive parameterization see e g ackerer and delay 2010 consists of 12 triangular elements and 11 nodes uniformly distributed over the domain the parameter mesh is refined 3 times and the total number of estimated hydraulic conductivities which may vary between runs according to the way the parameter mesh is refined is between approximately 60 and 80 each inversion is repeated 50 times and the initial parameter grid is assigned with initial parameter values chosen randomly in a uniform distribution the aim of this duplication is to evaluate the reproducibility of the results and compare them to the reference the sought hydraulic conductivity values are bounded between 1 0 10 5 m s 1 and 3 0 10 3 m s 1 during inversion and for test case c4 porosity is sought in the range 0 01 0 40 these upper and lower bounds of hydraulic conductivities and porosities are the only prior information on parameters brought to the inversion procedure adjoint state variables associated with both flow and transport are computed with a different numerical code but with the same grid and the same numerical methods as those employed for the calculation of the state variables codes for the adjoint states were developed in the lab as tools independent of the forward codes with the aim of building an inversion toolbox working in parallel with any forward model even on non proprietary codes for which the calculation structures are unknown separate codes between the forward problem and the adjoint state calculations also allowed us to check how the exchanges of information between the grids of adjoint states and that of the forward flow and transport models could eventually hamper inversions see e g delay et al 2017 this feature is not reported in this study as both the forward problems and adjoint state calculations share the same computation grids with exchanges of information free from any interpolation 5 2 inversion of the hydraulic conductivity with known uniform porosity the settings of the test cases are motivated by three objectives that are i to evaluate the different strategies for estimating the parameters strategies s1 to s3 ii to assess the effects of flow conditions by comparing test cases c1 and c2 and iii to assess the effects of transport boundary conditions by comparing test cases c2 to c3 irrespective of the addressed test cases the observed hydraulic heads are always matched within an error of 5 10 cm for maximal variations of heads over the flow fields of approximately 2 m this very good matching see also a comparison of heads between inverted and reference flow fields in fig 3 justifies that results on heads will not be addressed in the following discussion consequently the comparisons are based on different criteria and only involve concentration and hydraulic conductivities these criteria deal with the overall spatial distribution of concentrations at a given time the analysis of breakthrough curves btc at 3 locations see fig 1 and the calibrated parameter fields compared with the reference fifty different solutions per test were analyzed these solutions were obtained by starting the inversion procedure from different randomly picked locations in the parameter space it is also worth noting that the multiscale parameterization randomizes the current inverse solution each time the parameter grid is refined these solutions cannot be distinguished in view of the final values of the objective function meaning that they are of similar quality in terms of quadratic differences between the reference and estimated heads and concentrations regarding solute concentrations the btc stemming from 50 solutions were gathered into a confidence interval computed for each time step n and defined by c n σ c n where cn is the mean of the 50 concentration values at time step n and σ c n is the corresponding standard deviation preliminary computations show that the confidence intervals did not change significantly by running more simulations with these 50 realizations an average value of the decimal logarithm of the hydraulic conductivity log k e was computed for each element e of the mesh with its associated standard deviation an average error for each element e ε e was also used as an assessment criterion and defined by 20 ε e log k e log k e where ke is the exact value from the reference field of the hydraulic conductivity at element e and k e is the estimated value the variograms of log k e were also compared with the reference as an overall indicator of quality of estimated parameter fields in the same way as for breakthrough curves the 50 variogram functions were gathered into a confidence interval for each lag the concentration distributions are provided in fig 3 the main features of the reference concentration distributions are reproduced by the inverse solutions for all test cases and all inversion strategies regarding the objective function however the estimated concentrations show additional smearing compared with the reference even though the same mesh and same dispersivities were used for calculating reference and inverse solutions as shown hereafter the retrieved hydraulic conductivity fields are smoother than the reference this feature is consistent with the robustness of the flow equation with respect to hydraulic conductivity in the sense that the head variable is not very sensitive to local contrasts in hydraulic conductivity values e g giudici and vassena 2008 the strategy overlooking concentration data in the objective function s1 provides results as good as the other strategies accounting for concentrations in test cases c1 and c3 however in test case c2 the effects of the injection wells are not completely reproduced the quality of the match for test case c3 is still quite good even though solute concentrations remain null for some observation wells that are not downstream of the local injection source this means that including observations at locations that do not see any concentrations is helpful to retrieve the fluid velocity field and its subsequent relationship with hydraulic conductivities the different strategies can be distinguished when considering btc figs 4 6 as a quality criterion of the parameter estimation for test case c1 fig 4 the btc are well reproduced when employing the two strategies s1 and s2 for strategy s3 which consists of incorporating concentration data in the objective function while calculating the first iterations of convergence by relying upon head data only the method results in a few discrepancies regarding the arrival times of concentrations this bias on arrival times also occurs with strategy s1 concentration data are never used and test case c2 fig 5 these two attempts show that concentration data provide useful and valuable information on solute travel times which in turn inform on hydraulic conductivity values test case c3 is harder to decipher because solute concentrations remain equal to the initial conditions null concentration values at a significant number of monitored wells not located downstream of the local injection therefore test case c3 is more sensitive to flow direction variations within the domain than test cases c1 and c2 a poor estimation of the flow direction in test case c3 leads to either a difference in mean travel time or a difference in the total solute mass passing through the wells the mass being defined as the integral of the btc over time discrepancies in mass can be observed at wells p7 and p9 except for strategy s2 again strategy s2 which includes weighted information on both head and concentration data in the objective function is the most efficient strategy to retrieve the flow field it is worth noting that for all test cases and all strategies the early arrival times of concentrations are well estimated the accuracy of the estimated parameters decreases with the travel distance late arrival times as shown by the increase in the range of the confidence interval from well p11 to well p9 for test cases c1 and c2 the estimated hydraulic conductivities are analyzed by comparing the average value of log k its related standard deviation and the average error in eq 20 figs 7 9 the three test cases provide very similar results showing that in general the hydraulic conductivity field is fairly well reproduced irrespective of the inversion strategy employed the largest differences between estimated and reference log k are located close to the eastern boundary of the domain assigned with a prescribed flux for flow at these locations fluxes remain almost similar irrespective of the local conductivity values the reliability of the estimated parameters measured by the local standard deviation of log k is poor high standard deviation in this eastern area compared with the rest of the domain it is also worth noting that after 120 days of transport solute concentrations did not reach the eastern boundary and thus poorly inform the inverse problem on local hydraulic conductivity experienced during transport this could be an additional explanation for the poor evaluation of conductivities close to the eastern boundary of the domain the third strategy s3 leads to the poorest parameter estimation compared with the other two the ensemble of inverse solutions is wider for strategy s2 than for strategy s1 see test cases c2 and c3 in figs 8 9 these results may appear counter intuitive as it is usually expected that more information of good quality brought to the inverse problem should yield better results or at least more constrained solutions which is consistent with the robustness of these solutions this notwithstanding the additional information provided by concentrations does not have the same meaning as information on heads in short concentrations are sensitive to flow directions and associated travel times along these directions as heads are sensitive to conductivities in a neighborhood roughly centered on the head measurement location increasing the complexity of the inverse problem by multiplying the number of sensitive factors or phenomena is conducive to an increase of local minima this feature spreads out the set of possible inverse solutions even though these solutions resulted in similar values of the objective function finally the results were analyzed via a global criterion comparing the variogram of log k from the reference solution to the variograms computed from the estimated solutions fig 10 all variograms from inverse solutions underestimate the spatial variability of hydraulic conductivities within lag distances less than one half the size of the domain this feature is consistent with the fact evoked above stating that hydraulic head fields are not very sensitive to local contrasts in hydraulic conductivity values in addition concentrations at a given time and location depend on the average travel time between the source and the observation well therefore they are rather less sensitive to local hydraulic conductivity variations than to the mean of conductivities experienced along the flow path between injection and observation this could explain the inference of smaller variances for variograms from inverted conductivity fields in the same vein hydraulic heads as the variables of a diffusion process darcian flow are known to be rather more sensitive to mean values of conductivities over large patches than to contrasts between local values 5 3 identification of hydraulic conductivity and effective porosity distributions the additional test case c4 re handles the settings of test case c2 but considers the inversion of both the hydraulic conductivity field and a heterogeneous effective porosity field a single strategy s2 was employed to estimate the parameters with the minimization in a single phase of an objective function mixing both hydraulic head and concentration data eq 4 this choice of a single strategy is motivated by the inversions of hydraulic conductivity fields that showed strategy s2 to be the most efficient even though the three strategies employed render almost similar results it was thought that strategy s2 would also be the best suited to the joint inversion of hydraulic conductivity and porosity as the mean porosity of the heterogeneous field is approximately 0 12 0 15 in the western half of the domain compared with the uniform value of 0 05 in test case c2 the simulation time for transport is increased up to 280 days 120 days for test case c2 to let the solute plume widely invade the system the reliability of the simulated concentrations figs 11 and 12 and of the estimated parameters figs 13 and 14 has been significantly diminished compared with the test cases solely inverting hydraulic conductivities this can tentatively be explained by several features among which the most likely is that the main driver to solute concentration propagation is the mean water velocity which depends on the ratio of hydraulic conductivity to effective porosity it is always challenging to identify both terms of a ratio when the latter is the sensitive parameter even though both terms of the ratio in the present study are independent quantities with different correlation lengths etc it is worth noting that actual data may show relationships between porosity and conductivity values following for example the well known archie s law in its various forms however these relationships mainly apply to the fine scale of core samples but rarely apply to the elementary mesh of a regional aquifer model in the latter case small variations in porosity values do not generate enough variability in hydraulic conductivities that might vary over orders of magnitude that being said it seems that choosing independent porosity and conductivities values does not help hamper inversion more than choosing loosely correlated values another feature hampering inversion is the increased number of sought parameters which is approximately 70 hydraulic conductivity values in test case c2 inversions and becomes approximately 210 in our tests with two independent parameter grids one for conductivity and one for porosity in test case c4 inversions the difficulties experienced by the inverse procedure in test case c4 are also witnessed by the important variability in the estimated concentrations resulting from flow and transport through solution parameter fields fig 12 the spreading of the 50 different possible solutions and the mean local errors between solutions and the reference are also enlarged compare for log k plots fig 13 and test case c2 s2 in fig 8 the variograms of the solution parameter fields fig 14 render the same appraisal by underestimating the variability at small scales small lag distances they also highlight the difficulty in estimating with confidence the spatial distribution of porosity 6 conclusion we have provided a rigorous and detailed presentation of the partial differential equations ruling the continuous adjoint state associated with solute transport the adjoint state obeys an advection dispersion equation that must be solved backward in time and with a reversed flow field compared to the forward problem of transport it also obeys specific boundary conditions it can be identified uniquely in a single calculation very similar to that of the forward problem then it can serve as calculations for all gradients of the objective function with respect to parameters initial and boundary conditions and source sink terms we have also extended the adaptive parameterization technique to solute transport and to coupled inversion of flow and transport data the methodology has been applied to four synthetic test cases targeting the estimation of hydraulic conductivity and effective porosity fields using both piezometric heads and solute concentration data these numerical experiments showed 1 employing the continuous adjoint state solved via an independent numerical code that is in a non intrusive way with regard to existing proprietary transport models is a viable alternative to more common methods gauss newton and quasi newton methods with embedded computations of sensitivities or adjoint variables for joint parameter estimation 2 concentration data has to be taken into account in the parameter estimation and included in the objective function in a balanced way if the objective function is not weighted usually hydraulic head observations are rapidly fitted by the inverse procedure and the conditioning by concentrations will not bring any additional information in the weighting procedure the weighting coefficient can be adapted during the minimization and is not necessarily a parameter to include in the minimization 3 concentration data render information on travel times and flow directions as a valuable means to improve the inference of unknown hydraulic conductivity fields null concentrations at some locations are also helpful in the process of incorporating transport data to retrieve conductivity fields it could be conjectured that a poor prior knowledge of the fluid velocity field could mislead the inversion relying upon transport data the consequence would be to partly separate the inversion procedure in a first step predefining the flow field conductivities on the basis of hydraulic head measurements then in a second step launching calculations of transport even though successes of inversions are problem dependent we have shown that the above conjecture is wrong it is wise to invert both flow and transport scenarios in the same procedure which means that the objective function of the inverse problem should mix information on heads and concentrations the objective function would then be minimized in a single phase handling both terms in heads and concentrations 4 in the test cases reported by this study it is worth noting that hydraulic head observations were always rapidly fitted and when used alone these data rendered valuable hydraulic conductivity fields the addition of concentration data in the inversion procedure brought few cosmetic features to the conductivity fields except for better assessment of early and mean travel times in the system which applies to both sweeping uniform or tortuous flow fields a key question raised by this study can be formulated as is it worth a try to include concentration data for identifying hydraulic conductivities when it is known how cumbersome and costly concentration measurements can be acknowledgments the authors are indebted to the qatar national research foundation qnrf for partly funding this study under the grant nprp9 030 1 008 dual porosity modeling of qatar karst aquifers this study is also a contribution to the geotref project funded by the french government in the framework of the investissements d avenir program and tutored by ademe appendix a the development of the continuous adjoint state associated with the advection dispersion equation for solute transport in porous media is presented below the continuous expressions of the gradient components of the objective function are also provided the continuous operator that solves solute transport and that represents the constraint v c p 0 in the lagrangian operator of an optimization problem is written as a1 v c p 0 ω c t ω u c ω d c q c 0 over ω and 0 t with initial and boundary conditions a2 c c 0 over ω at t 0 c c d over d ω c and 0 t d c n γ q n c over n ω c and 0 t at this stage perturbations δp resulting in perturbations δc to keep v c δc p δp 0 only concern model parameters that is δp δω δu δd noting that u is a parameter for the transport equation but also an output of a flow model a later discussion will address perturbations regarding source sink terms initial conditions and boundary conditions a variation of the lagrangian operator is employed to derive the equations of the adjoint state which takes the form a3 δ l 0 t ω f c δ c d ω d t 0 t ω f p δ p d ω d t 0 t ω v c δ c p δ p v c p μ d ω d t with f the continuous objective function μ the continuous adjoint state and the constraint v c δc p δp 0 the latter is developed as a4 v c δ c p δ p 0 ω δ ω c δ c t ω δ ω u δ u c δ c ω δ ω d δ d c δ c q c 0 over ω and 0 t and flanked with initial and boundary conditions a5 c δ c c 0 over ω at t 0 c δ c c d over d ω c and 0 t d δ d c δ c n γ q n c over n ω c and 0 t developing to the first order i e by neglecting terms in δ2 the difference v δ v renders a6 v c δ c p δ p v c p 0 ω δ c t c δ ω t ω u δ c ω δ u c δ ω u c ω d δ c ω δ d c δ ω d c 0 over ω and 0 t with initial and boundary conditions a7 δ c 0 over ω at t 0 δ c 0 over d ω c and 0 t d δ c n γ δ d c n γ 0 over n ω c and 0 t the basic idea prevailing for the identification of the continuous adjoint state equations is to isolate the terms in δ in the integrals 0 t ω v δ v μ d ω d t of the operator δl in eq a3 this occurs via integration by parts for all terms in eq a6 which are handled below as they appear ranked in eq a6 a8 0 t ω ω δ c t μ d ω d t 0 t ω ω δ c μ t d ω d t ω ω δ c μ d ω 0 t 0 t ω ω δ c μ t d ω d t in eq a8 simplifications come from the following properties at t 0 δc 0 is due to boundary conditions in eq a7 at t t μ is set to zero as it is the initial condition for calculating μ see below and μ can be defined up to the addition of a constant a9 0 t ω c δ ω t μ d ω d t 0 t ω c δ ω μ t d ω d t ω c δ ω μ d ω 0 t 0 t ω c δ ω μ t d ω d t ω c 0 δ ω 0 μ 0 d ω where it has been accounted for the fact that μ 0 at t t we note that a10 0 t a t b d t 0 t b t a d t a b 0 t 0 t b t a d t a 0 b 0 i f b t 0 using the property μ 0 at t t and applying eq a10 in eq a9 results in a11 0 t ω c δ ω t μ d ω d t 0 t ω δ ω μ c t d ω d t a12 0 t ω ω u δ c μ d ω d t 0 t ω ω δ c u μ d ω d t 0 t n ω c ω δ c μ u n γ d γ d t in eq a12 the contour integral over the dirichlet type boundary d ω c has been cancelled out considering that δc 0 along this type of boundary see eq a7 a13 0 t ω ω δ u c μ d ω d t 0 t ω ω c δ u μ d ω d t 0 t ω ω c μ δ u n γ d γ d t 0 t ω ω c δ u μ d ω d t a14 0 t ω δ ω u c μ d ω d t 0 t ω δ ω c u μ d ω d t 0 t ω δ ω c μ u n γ d γ d t 0 t ω δ ω c u μ d ω d t in eqs a13 and a14 the contour integrals cancel out because the perturbations δu and δω are null along the boundaries ω and u are not defined straight at the boundary of the modeled domain they do not appear in the boundary conditions and incidentally the adjoint state μ which is defined up to the addition of a constant can be considered as null along a dirichlet type boundary a15 0 t ω ω d δ c μ d ω d t 0 t ω δ c ω d μ d ω d t 0 t ω δ c ω d μ n γ d γ d t 0 t ω ω μ d δ c n γ d γ d t 0 t ω δ c ω d μ d ω d t 0 t n ω c δ c ω d μ n γ d γ d t the expression in eq a15 has been integrated by parts twice to extract the perturbation δc from the operator the simplification of contour integrals results from μ 0 over the contour d ω c and the boundary conditions δc 0 over d ω c note also that d δ c n γ from a15 in addition to δ d c n γ which appear in a16 results in a null term over n ω c see boundary conditions a7 a16 0 t ω ω δ d c μ d ω d t 0 t ω ω μ t δ d c d ω d t 0 t ω ω μ δ d c n γ d γ d t 0 t ω ω μ t δ d c d ω d t in eq a16 the contour integral cancels out because μ 0 over the contour d ω c and δ d c n γ in addition to d δ c n γ in a15 cancel out over n ω c a17 0 t ω δ ω d c μ d ω d t 0 t ω δ ω μ t d c d ω d t 0 t ω δ ω μ d c n γ d γ d t 0 t ω δ ω μ t d c d ω d t in eq a17 the contour integral cancels out because μ 0 over the contour d ω c and the perturbationδω is zero over the whole contour ω gathering all terms in δc over the expressions in eqs a8 a17 then reintroducing them into the variation of the lagrangian operator δl in eq a3 and cancelling out the whole poses the continuous equations of the adjoint state which render a18 ω μ t ω u μ ω d μ f c 0 over ω and t 0 μ 0 over ω at t t μ 0 over d ω c and t 0 ω μ u ω d μ n γ 0 over n ω c and t 0 it is worth noting that eq a18 has to be solved backward in time and with a reversed velocity field u otherwise the problem lacks physical meaning with a negative dispersion tensor in the advection dispersion equation the neumann boundary condition of the forward problem in eq a2 has been transformed into a robin boundary condition with a reversed velocity field u along the contour n ω c usually in transport problems a so called homogeneous neumann boundary condition d c n γ 0 is associated with a no flow boundary yielding u n γ 0 in that case the robin boundary condition for the adjoint state simplifies into μ n γ 0 another possibility where the condition d c n γ 0 applies is that of a free advective flux exiting the system with no modification beyond the boundary in that case the robin boundary condition of the adjoint state with a reversed flow field simply consists in letting a prescribed value μ 0 enter into the domain solving the adjoint state equations in eq a18 changes the expression of the variation of the lagrangian operator in eq a3 which simplifies into a19 δ l 0 t ω f p δ p d ω d t 0 t ω δ p g c μ d ω d t with the three types of parameters ω u and d in p the operator δl can be separated into three components from eqs a11 a14 and a17 a20 δ l ω 0 t ω δ ω f ω d ω d t 0 t ω δ ω c t μ c u μ μ t d c d ω d t from eq a13 a21 δ l u 0 t ω δ u f u d ω d t 0 t ω ω c δ u μ d ω d t from eq a16 a22 δ l d 0 t ω δ d f d d ω d t 0 t ω ω μ t δ d c d ω d t the expressions in eqs a20 a22 give the form of the gradient components of the objective function with respect to parameters ω u and d for example let us take u x i n the velocity along the x direction over a subdomain ω i of ω and over the time step δtn within the period 0 t the gradient component of the objective function with respect to u x i n is expressed via eq a21 as a23 d f δ u x i n δ l δ u x i n δ t n ω i f u x i n d ω d t δ t n ω i ω c μ x d ω d t the strength of the continuous adjoint state also allows us to retrieve source sink terms initial conditions and boundary conditions by providing the gradient components of the objective function with respect to these factors regarding source sink terms the operator v δ v in eq a6 is modified to include a perturbation δqc as this perturbation is independent of that on the parameters δω δu and δd the integration 0 t ω v δ v μ d ω d t simply lets an additional term in the form 0 t ω δ q c μ d ω d t appear the latter does not alter the development between eqs a8 and a17 consequently the continuous adjoint state eq a18 and the gradient components of the objective function precisely the components of the operator δl with respect to parameters ω u and d eqs a20 a22 are unmodified after the adjoint state μ has been calculated by solving eq a18 the gradient components of the objective function with respect to source sink terms qc are calculated by employing a24 δ l q c 0 t ω δ q c f q c d ω d t 0 t ω δ q c μ d ω d t regarding initial and boundary conditions the operator v δ v in a6 is modified on its initial and boundary conditions in eq a7 the latter become a25 δ c δ c 0 over ω at t 0 δ c δ c d over d ω c and 0 t d δ c n γ δ d c n γ δ q n c over n ω c and 0 t with δc 0 the perturbation associated with initial conditions and δcd δ q n c the perturbations associated with dirichlet and neumann type boundary conditions respectively the general form of the operator 0 t ω v δ v μ d ω d t is not modified but the expansion of a few terms slightly changes δc 0 appears in eq a8 which becomes a26 0 t ω ω δ c t μ d ω d t 0 t ω ω δ c μ t d ω d t ω ω δ c μ d ω 0 t 0 t ω ω δ c μ t d ω d t ω ω δ c 0 μ 0 d ω where the properties μ 0 at t t and δc δc 0 at t 0 have been accounted for the perturbations δcd and δ q n c appear in the two successive integrations by parts of eq a15 and the integration by parts of a16 more precisely only the contour integrals are modified their sum from expressions in a15 and a16 renders a27 0 t ω δ c ω d μ n γ d γ d t 0 t ω ω μ d δ c n γ d γ d t 0 t ω ω μ δ d c n γ d γ d t 0 t n ω c δ c ω d μ n γ d γ d t 0 t d ω c δ c d ω d μ n γ d γ d t 0 t n ω c ω μ δ q n c n γ d γ d t the contour integrals of eq a27 take into account the following properties μ 0 over the contour d ω c the boundary condition δc δcd over d ω c and the boundary condition d δ c n γ δ d c n γ δ q n c over n ω c all the remaining terms in the development of 0 t ω v δ v μ d ω d t are unchanged which also comes down to unchanged continuous equations for the adjoint state μ and the components of lagrangian operator δl regarding perturbations on parameters δω δu and δd when the adjoint state has been calculated by solving eq a18 the gradient components of the objective function with respect to initial and boundary conditions are accessible via a28 δ l c 0 0 t ω δ c 0 f c 0 d ω d t ω δ c 0 ω μ 0 d ω δ l c d 0 t d ω c δ c d f c d d ω d t 0 t d ω c δ c d ω d μ n γ d γ d t δ l q n c 0 t n ω c δ q n c f q n c d ω d t 0 t n ω c ω μ δ q n c n γ d γ d t 
672,the need to attenuate hydrograph peaks is central to the design of stormwater and flood control systems however few guidelines exist for siting hydraulic control structures such that system scale benefits are maximized this study presents a new graph theoretic algorithm for stabilizing the hydrologic response of watersheds by placing controllers at strategic locations in the drainage network this algorithm identifies subcatchments that dominate the peak of the hydrograph and then finds the cuts in the drainage network that maximally isolate these subcatchments thereby flattening the hydrologic response evaluating the performance of the algorithm through an ensemble of hydrodynamic simulations we find that our controller placement algorithm produces consistently flatter discharges than randomized controller configurations both in terms of the peak discharge and the overall variance of the hydrograph by attenuating flashy flows our algorithm provides a powerful methodology for mitigating flash floods reducing erosion and protecting aquatic ecosystems more broadly we show that controller placement exerts an important influence on the hydrologic response and demonstrate that analysis of drainage network structure can inform more effective stormwater control policies keywords control systems controller placement graph theory stormwater control 1 introduction in the wake of rapid urbanization aging infrastructure and a changing climate effective stormwater management poses a major challenge for cities worldwide kerkez et al 2016 flash floods are one of the largest causes of natural disaster deaths in the developed world doocy et al 2013 and often occur when stormwater systems fail to convey runoff from urban areas wright and marchese 2017 at the same time many cities suffer from impaired water quality due to inadequate stormwater control walsh et al 2005 flashy flows erode streambeds release sediment bound pollutants and damage aquatic habitats booth and jackson 1997 finkenbine et al 2000 walsh et al 2005 wang et al 2001 while untreated runoff may trigger fish kills and toxic algal blooms sahagun 2013 wines 2014 engineers have historically responded to these problems by expanding and upsizing stormwater control infrastructure rosenberg et al 2010 however larger infrastructure frequently brings adverse side effects such as dam induced disruption of riparian ecosystems dam 2000 and erosive discharges due to overdesigned conveyance infrastructure kerkez et al 2016 as a result recent work has called for the replacement of traditional peak attenuation infrastructure with targeted solutions that better reduce environmental impacts arora et al 2015 hawley and vietz 2016 as the drawbacks of oversized stormwater infrastructure become more apparent many cities are turning towards decentralized stormwater solutions to regulate and treat urban runoff while reducing adverse impacts green infrastructure for instance uses low impact rain gardens bioswales and green roofs to condition flashy flows and remove contaminants askarizadeh et al 2015 coffman et al 1999 strecker et al 2000 smart stormwater systems take this idea further by retrofitting static infrastructure with dynamically controlled valves gates and pumps bartos et al 2018 kerkez et al 2016 mullapudi et al 2018 2017 by actuating small distributed storage basins and conveyance structures in real time smart stormwater systems can halt combined sewer overflows montestruque and lemmon 2015 mitigate flooding kerkez et al 2016 and improve water quality at a fraction of the cost of new construction bartos et al 2018 kerkez et al 2016 while decentralized stormwater management tools show promise towards mitigating urban water problems it is currently unclear how these systems can be designed to achieve maximal benefits at the watershed scale indeed some research suggests when stormwater control facilities are not designed in a global context local best management practices can lead to adverse system scale outcomes in some cases inducing downstream flows that are more intense than those produced under unregulated conditions emerson et al 2005 petrucci et al 2013 thus as cities begin to experiment with decentralized stormwater control the question of where to place control structures becomes crucial while many studies have investigated the ways in which active control can realize system scale benefits using techniques like feedback control wong and kerkez 2018 market based control montestruque and lemmon 2015 or model predictive control gelormino and ricker 1994 mollerup et al 2016 the location of control structures within the drainage network may serve an equally important function hydrologists have long recognized the role that drainage network topology plays in shaping hydrologic response gupta and mesa 1988 gupta et al 1986 kirkby 1976 mantilla et al 2011 marani et al 1991 mesa and mifflin 1986 tejedor et al 2015a b troutman and karlinger 1985 it follows that strategic placement of hydraulic control structures can shape the hydrograph to fulfill operational objectives such as maximally flattening flood waves and regulating erosion downstream to date however little research has been done to assess the problem of optimal placement of hydraulic control structures in drainage networks recent studies have investigated optimal placement of green infrastructure upgrades like green roofs rain tanks and bioswales meerow and newell 2017 norton et al 2015 schilling and logan 2008 schubert et al 2017 yao et al 2015 zellner et al 2016 zhang et al 2015 however these studies generally focus on quantifying the potential benefits of green infrastructure projects through representative case studies schubert et al 2017 yao et al 2015 zellner et al 2016 zhang et al 2015 and do not intend to present a generalized framework for placement of stormwater control structures as a result many of these studies focus on optimizing multiple objectives such as urban heat island mitigation norton et al 2015 air quality meerow and newell 2017 or quality of life considerations schilling and logan 2008 or use complex socio physical models and optimization frameworks zellner et al 2016 making it difficult to draw general conclusions about controller placement in drainage networks studies of pressurized water distribution networks have investigated the related problems of valve placement cattafi et al 2011 creaco et al 2010 sensor placement perelman and ostfeld 2013 subnetwork vulnerability assessment yazdani and jeffrey 2011 and network sectorization hajebi et al 2015 tzatchkov et al 2008 while these studies provide valuable insights into the ways that complex network theory can inform drinking water infrastructure design water distribution networks are pressure driven and cyclic and are thus governed by different dynamics than natural drainage networks which are mainly gravity driven and dendritic recent studies in distributed reservoir management have revealed that the placement of reservoirs plays an important role in flood control ayalew et al 2015 develop a framework that combines rainfall runoff modeling reservoir routing and monte carlo simulation to assess reservoir regulated flood response ayalew et al 2013 and then subsequently use this framework to investigate the effects of reservoir placement on flood frequency ayalew et al 2015 using a randomly generated 1 000 year rainfall time series along with a simulated catchment they find that two retention basins placed in parallel provide better flood control than either i two retention basis placed in series along the river main stem or ii a single large retention basin upstream of the watershed outlet this research demonstrates that placement of hydraulic control structures exerts a powerful influence on the performance of flood control infrastructure and raises questions about how larger numbers of control structures should best be distributed throughout a watershed to improve flood control inspiration for the controller placement problem can be drawn from recent theoretical work into the controllability of complex networks these studies show that the control properties of complex systems ranging from power grids to gene expression pathways are inextricably linked with topological properties of an underlying network representation liu and barabási 2016 the location of driver nodes needed for complete controllability of a linear system for instance can be determined from the maximum matching of a graph associated with that system s state space representation liu et al 2011 for systems in which complete control of the network is infeasible the relative performance of driver node configurations can be measured by detecting controllable substructures ruths and ruths 2014 or by leveraging the concept of control energy from classical control theory shirin et al 2017 summers and lygeros 2014 yan et al 2012 2015 while these studies bring a theoretical foundation to the problem of controller placement they generally assume linear system dynamics and may thus not be well suited for drainage networks which are driven by nonlinear runoff formation and channel routing processes recent studies have drawn on advances in complex network theory to examine the controllability of stream networks riasi and yeghiazarian 2017 and enhance understanding of geomorphological processes czuba and foufoula georgiou 2015 riasi and yeghiazarian apply several theoretical controllability metrics to real world drainage networks ultimately finding that control of dendritic river networks requires a relatively large proportion of driver nodes riasi and yeghiazarian 2017 czuba and foufoula georgiou investigate spatial and temporal patterns in sediment accumulation in a river network arising from the combined effects of transport dynamics and stream network topology czuba and foufoula georgiou 2015 they find that the emergence of persistent clusters of mass on the network is a major driver of geomorphological change and conclude that management efforts should seek to identify the source contributions that synchronize on the network to form clusters and then break the synchronization by reducing sediment generation in these regions despite the critical need for system scale stormwater control there is to our knowledge no robust theoretical framework to guide the placement of hydraulic control structures for the purposes of improving hydrograph peak attentuation to address this knowledge gap we formulate a new graph theoretic algorithm that uses the network structure of watersheds to determine the controller locations that will maximally de synchronize tributary flows by flattening the discharge hydrograph our algorithm provides a powerful method to mitigate flash floods and curtail water quality impairments in urban watersheds our approach is distinguished by the fact that it is theoretically motivated and links the control of stormwater systems with the underlying structure of the drainage network the result is a fast generalized algorithm that requires only digital elevation data for the watershed of interest more broadly through our graph theoretic framework we show that network structure plays a dominant role in the control of drainage basins and demonstrate how the study of watersheds as complex networks can inform more effective stormwater infrastructure design 2 algorithm description flashy flows occur when large volumes of runoff arrive synchronously at a given location in the drainage network if hydraulic control structures are placed at strategic locations flood waves can be mitigated by de synchronizing tributary flows before they arrive at a common junction with this in mind we introduce a controller placement algorithm that minimizes flashy flows by removing regions of the drainage network that contribute disproportionately to synchronous flows at the outlet in our approach the watershed is first transformed into a directed graph consisting of unit subcatchments vertices connected by flow paths edges next critical regions are identified by computing the catchment s width function an approximation of the distribution of travel times to the outlet and then weighting each vertex in the network in proportion to the number of vertices that share the same travel time to the outlet the weights are used to compute a weighted accumulation score for each vertex which sums the weights of every possible subcatchment in the watershed the graph is then partitioned recursively based on this weighted accumulation score with the most downstream vertex of each partition representing a controller location 2 1 definitions graph representation of a watershed watersheds can be represented as directed graphs in which subcatchments vertices or cells are connected by elevation dependent flow paths edges the directed graph can be formulated mathematically as an adjacency matrix a where for each element aij aij 0 if there exists a directed edge connecting vertex vj to vi and conversely a i j 0 if there does not exist a directed edge connecting vertex vj to vi nonzero edge weights can be specified to represent travel times distances or probabilities of transition between connected vertices flow paths between adjacent cells are established using a routing scheme typically based on directions of steepest descent see fig 1 in this study we determine the connectivity of the drainage network using a d8 routing scheme o callaghan and mark 1984 in this scheme elevation cells are treated as vertices in a 2 dimensional lattice meaning that each vertex vi is surrounded by eight neighbors n i a directed link is established from vertex vi to a neighboring vertex vj if the slope between vi and vj is steeper than the slope between vi and all of its other neighbors n i v j where vj has a lower elevation than vi the d8 routing scheme produces a directed acyclic graph where the indegree of each vertex is between 0 and 8 with an indegree of 8 indicating that the vertex is a sink and the outdegree of each vertex is 1 except for the watershed outlet which has an outdegree of 0 it should be noted that other schemes exist for determining drainage network structure such as the d infinity routing algorithm which better resolves drainage directions on hillslopes tarboton 1997 however because the routing scheme is not essential to the construction of the algorithm we focus on the simpler d8 routing scheme for this study similarly to simplify the construction of the algorithm we will assume that the vertices of the watershed are defined on a regular grid such that the area of each unit subcatchment is equal 1 1 thus for watershed models derived from a digital elevation model dem a unit subcatchment is equivalent to a single dem cell fig 1 shows the result of delineating a river network from a digital elevation model left along with an illustration of the underlying graph structure and adjacency matrix representation right controller in the context of this study a controller represents any structure or practice that can regulate flows from an upstream channel segment to a downstream one examples include retention basins dams weirs gates and other hydraulic control structures these structures may be either passively or actively controlled for the validation assessment presented later in this paper we will examine the controller placement problem in the context of volume capture meaning that controllers are passive and that they are large enough to completely remove flows from their upstream contributing areas however the algorithm itself does not require the controller to meet these particular conditions mathematically we can think of a controller as a cut in the graph that removes one of the edges this cut halts or inhibits flows across the affected edge because the watershed has a dendritic structure any cut in the network will split the network into two sub trees i the delineated region upstream of the cut and ii all the vertices that are not part of the delineated region placing controllers is thus equivalent to removing branches subcatchments from a tree the parent watershed delineation delineation returns the set of vertices upstream of a target vertex in other words this operation returns the contributing area of vertex vi expressed in terms of the adjacency matrix 1 v d a v i v j v a n i j 0 for some n d where an is the adjacency matrix a raised to the nth power i is the row index j is the column index v is the vertex set of a and d is the graph diameter note that an ij is nonzero only if vertex vj is located within an n hop neighborhood of vertex vi note that the delineation operation can also be performed in a single step by analyzing the null space of the graph laplacian of the watershed s adjacency matrix tejedor et al 2015a pruning pruning is the complement of delineation this operation returns the vertex set consisting of all vertices that are not upstream of the current vertex 2 v p a v i v v d a v i subgraphs induced by the delineated and pruned vertex sets are defined as follows 3 a d a v i a g v d a p a v i a g v p where a g v represents the adjacency matrix of the subgraph induced by the vertex set v width function the width function describes the distribution of travel times from each upstream vertex to some downstream vertex vi 2 2 the width function h x was originally defined by shreve to yield the number of links in the network at a topological distance x from the outlet shreve 1969 because travel times may vary between hillslope and channel links we present a generalized formulation of the width function here rodriguez iturbe and rinaldo 2001 in general terms the width function can be expressed as 4 h t v i γ γ i i γ t along with an indicator function i γ t 5 i γ t 1 t γ t 0 otherwise where γ i is the set of all directed paths to the target vertex vi and t γ is the travel time along path γ if the travel times between vertices are constant and equal for all vertices the width function of the graph at vertex vi can be described as a linear function of the adjacency matrix 3 3 while mathematically concise this equation is computationally inefficient see section s1 in the supplementary information for the efficient implementation used in our analysis 6 h t v i a t 1 i where 1 signifies the vector of all ones at represents the adjacency matrix a raised to the power t with t representing the discrete time step and at 1 i indicates the ith element of the vector at 1 in real world drainage networks travel times between grid cells are not uniform crucially the travel time for channelized cells will be roughly 1 2 orders of magnitude faster than the travel time in hillslope cells rodriguez iturbe and rinaldo 2001 tak and bras 1990 thus to account for this discrepancy we define ϕ to represent the ratio of hillslope to channel travel times 7 ϕ t h t c where th is the travel time for hillslopes and tc is the travel time for channels fig 2 left shows the width function for an example watershed under the assumption that channel velocity is ten times faster than hillslope velocity ϕ 10 the width functions for various values of ϕ are shown in figs s3 and s4 in the supplementary information note that when the effects of hydraulic dispersion are ignored the width function is equivalent to the geomorphological impulse unit hydrograph giuh of the basin rodriguez iturbe and rinaldo 2001 the giuh represents the response of the basin to an instantaneous impulse of rainfall distributed uniformly over the catchment or equivalently the probability that a particle injected randomly within the watershed at time t 0 exits the watershed through the outlet at time t t accumulation the accumulation at vertex vi describes the number of vertices located upstream of vi or alternatively the upstream area moore et al 1991 it is equivalent to the cumulative sum of the width function with respect to time 4 4 see section s1 in the supplementary information for the efficient implementation of the accumulation algorithm 8 c v i t 0 a t 1 i fig 3 left shows the accumulation at each vertex for an example catchment because upstream area is correlated with mean discharge rodriguez iturbe and rinaldo 2001 accumulation is frequently used to determine locations of channels within a drainage network moore et al 1991 weighting function to identify the vertices that contribute most to synchronous flows at the outlet we propose a weighting function that weights each vertex by its rank in the travel time distribution let τij represent the known travel time from a starting vertex vj to the outlet vertex vi then the weight associated with vertex vj can be expressed in terms of a weighting function w vi vj 9 w j w v i v j h τ i j v i max t h v i where τij represents the travel time from vertex vj to vertex vi h τij vi represents the width function for an outlet vertex vi evaluated at time τij and the normalizing factor max t h vi represents the maximum value of the width function over all time steps t in this formulation vertices are weighted by the rank of the associated travel time in the width function vertices that contribute to the maximum value of the width function the mode of the travel time distribution will receive the highest possible weight unity while vertices that contribute to the smallest values of the width function will receive small weights in other words vertices will be weighted in proportion to the number of vertices that share the same travel time to the outlet fig 2 shows the weights corresponding to each bin of the travel time distribution left along with the weights applied to each vertex right weights for varying values of ϕ are shown in figs s3 and s4 in the supplementary information weighted accumulation much like the accumulation describes the number of vertices upstream of each vertex vi the weighted accumulation yields the sum of the weights upstream of vi if each vertex vj is given a weight wj the weighted accumulation at vertex vi can be defined 10 c w v i w t 0 a t w i where w is a vector of weights with each weight wj associated with a vertex vj in the graph when the previously defined weighting function is used the weighted accumulation score measures the extent to which a subcatchment delineated at vertex vi contributes to synchronous flows at the outlet in other words if the ratio of weighted accumulation to accumulation is large for a particular vertex this means that the subcatchment upstream of that vertex contributes disproportionately to the peak of the hydrograph fig 3 right shows the ratio of weighted accumulation to accumulation for the example catchment the weighted accumulation provides a natural metric for detecting the cuts in the drainage network that will maximally remove synchronous flows and thus forms the basis of the controller placement algorithm 2 2 controller placement algorithm definition the controller placement algorithm is described as follows let a represent the adjacency matrix of a watershed delineated at some vertex vi additionally let k equal the desired number of controllers and c equal the maximum upstream accumulation allowed for each controller the graph is then partitioned according to the following scheme 1 compute the width function h t vi for the graph described by adjacency matrix a with an outlet at vertex vi 2 compute the accumulation c vj at each vertex vj 3 use h t vi to compute the weighted accumulation cw vj at each vertex vj 4 find the vertex vopt where the accumulation c vopt is less than the maximum allowable accumulation and the weighted accumulation cw vopt is maximized 11 v o p t argmax v s v s c w v s where vs is the set of vertices such that vertex vi is reachable from any vertex in vs and the accumulation c at any vertex in vs is less than c 5 prune the graph at vertex vopt a ap a vopt 6 if the cumulative number of partitions is equal to k end the algorithm otherwise start at 1 with the catchment described by the new a matrix the algorithm is described formally in algorithm 1 an open source implementation of the algorithm in the python programming language is also provided bartos 2018a along with the data needed to reproduce our results efficient implementations of the delineation accumulation and width function operations are provided via the pysheds toolkit which is maintained by the authors bartos 2018b fig 4 shows the controller configuration generated by applying the controller placement algorithm to the example watershed with k 15 controllers each with a maximum accumulation of c 900 i e each controller captures roughly 8 of the catchment s land area in the left panel partitions are shown in order of decreasing priority from dark to light i e darker regions are partitioned first by the algorithm the right panel shows the stacked width functions for each partition the sum of the width functions from each partition reconstitute the original width function for the catchment from the stacked width functions it can be seen that the algorithm tends to prioritize the pruning of subgraphs that align with the peaks of the travel time distribution note for instance how the least prioritized paritions gravitate towards the low end of the travel time distribution while the most prioritized partitions are centered around the mode controller placement schemes corresponding to different numbers of controllers are shown in fig s5 in the supplementary information 3 algorithm validation to evaluate the controller placement algorithm we simulate the controlled network using a hydrodynamic model and compare the performance to a series of randomized controller placement configurations performance is characterized by the flatness of the flow profile at the outlet of the watershed as measured by both the peak discharge and the variance of the hydrograph i e the extent to which the flow deviates from the mean flow over the course of the hydrologic response to establish a basis for comparison we simulate a volume capture scenario emerson et al 2005 wherein roughly half of the total contributing area is controlled and each controller completely captures the discharge from its respective upstream area additionally we simulate a delayed release scenario in which each controller continuously releases water from a large bottom mounted orifice thereby delaying rather than halting flows from the upstream channel network these scenarios are chosen as bounding cases given that most real world reservoir operation will fall somewhere between these two regimes the validation experiment is designed to test the central premises of the controller placement algorithm that synchronous cells can be identified from the structure of the drainage network and that maximally capturing these synchronous cells will lead to a flatter overall hydrologic response if these premises are accurate we expect to see two results first the controller placement algorithm will produce flatter flows than the randomized control trials second the performance of the algorithm will be maximized when using a large number of small partitions using many small partitions allows the algorithm to selectively target the highly weighted cells that contribute disproportionately to the peak of the hydrograph conversely large partitions capture many extraneous low weight cells that don t contribute to the peak of the hydrograph in other words if increasing the number of partitions improves the performance of the algorithm it not only confirms that the algorithm works for our particular experiment but also justifies the central premises on which the algorithm is based 3 1 experimental design we evaluate controller configurations based on their ability to flatten the outlet hydrograph of a test watershed when approximately 50 of the contributing area is controlled this test case is chosen because it presents a practical scenario with real world constraints and because it allows for direct comparison of many different controller placement strategies for our test case we use the sycamore creek watershed a heavily urbanized creekshed located in the dallas fort worth metroplex with a contributing area of roughly 83 km2 see fig 1 this site is the subject of a long term monitoring study led by the authors bartos et al 2018 and is chosen for this analysis because i it is known to experience issues with flash flooding and ii it is an appropriate size for our analysis being large enough to capture fine scale network topology but not so large that computation time becomes burdensome a model of the stream network is generated from a conditioned digital elevation model dem by determining flow directions from the elevation gradient and then assigning channels to cells that fall above an accumulation threshold conditioned dems and flow direction grids at a resolution of 3 arcseconds approximately 70 by 90 m are obtained from the usgs hydrosheds database lehner et al 2008 grid cells with an accumulation greater than 100 are defined to be channelized cells while those with less than 100 accumulation are defined as hillslope cells this threshold is based on visual comparison with the stream network defined in the national hydrography dataset nhd united states geological survey 2013 hillslope cells draining into a common channel are aggregated into subcatchments with a flow length corresponding to the longest path within each hillslope and a slope corresponding to the average slope over all flow paths in the subcatchment percent impervious area and land cover classifications for each subcatchment are obtained from the national land cover database homer et al 2015 allowing for overland flow velocities to be reasonably approximated see section s3 in the supplementary information channel geometries are assigned to each link within the channelized portion of the drainage network we assume that each stream segment can be represented by a wide rectangular channel which is generally accurate for natural river reaches in which the stream width is large compared to the stream depth mays 2010 to simulate channel width and depth we assume a power law relation between accumulation and channel size based on an empirical formulation from moody and troutman 2002 12 ω 7 2 q 0 50 0 02 h 0 27 q 0 30 0 01 where ω is stream width h is stream depth and q is the mean river discharge knowing the width and depth of the most downstream reach and assuming that the accumulation at a vertex is proportional to the mean flow we generate channel geometries using the mean parameter values from the above relations to simulate the effect of floodplain storage and prevent channel overflow a trapezoidal floodplain section is added to the top of each channel see section s4 of the supplementary information for additional implementation details controllers are implemented as retention basins regulated by outlet structures with controllable orifices orifices are mounted on the bottom of each outlet structure and have approximately 10 of the cross sectional area of the upstream channel section for the volume capture scenario the orifice is left closed while for the delayed release scenario the orifice is left open retention basins are sized using a linear relationship between depth and surface area and are checked against known real world retention basins to ensure realistic storage capacities for additional details see section s4 in the supplementary information using the controller placement algorithm control structures are placed such that approximately 50 3 of the catchment area is captured by storage basins to investigate the effect of the number of controllers on performance optimized controller strategies are generated using between k 1 and k 35 controllers the ratio of hillslope to channel travel times is estimated as ϕ 50 based on simulations of the catchment under uncontrolled conditions we compare the performance of our controller placement algorithm to randomized controller placement schemes in which approximately 50 3 of the catchment area is controlled but the placement of controllers is random for this comparison assessment we generate 50 randomized controller placement trials each using between k 1 and k 24 controllers 5 5 while the controller randomization code was programmed to use between 1 and 35 controllers the largest number of controllers achieved was 24 this result stems from the fact that the randomization algorithm struggled to achieve 30 partitions without selecting cells that fell below the channelization threshold 100 accumulation for each randomized trial the maximum and minimum accumulation that can be handled by each controller is selected then controllers are placed sequentially until 50 3 of the total catchment is upstream of at least one controller this procedure is similar to the controller placement algorithm except that at each iteration the controller is placed at a random candidate cell i e a cell with an accumulation in the appropriate range instead of the candidate cell with the greatest weighted accumulation see section s2 in the supplementary information for a detailed description of the procedure we simulate the hydrologic response using a hydrodynamic model and evaluate controller placement performance based on the flatness of the resulting hydrograph to capture the hydrologic response under various rainfall conditions we simulate small medium and large rainfall events corresponding to 11 2 16 9 and 23 4 mm of rainfall delivered instantaneously over the first five minutes of the simulation these rainfall volumes are based on the 1 year 10 year and 100 year design storms 5 minute duration from intensity duration frequency curves for tarrant county in texas iswm 2006 a hydrodynamic model is used to simulate the hydrologic response at the outlet by routing runoff through the channel network using the dynamic wave equations united states environmental protection agency 2018 the simulation performance is measured by both the peak discharge and the total variance of the hydrograph the variance of the hydrograph which we refer to as flashiness is defined as 13 σ 2 1 n i 1 n q i q 2 where q is the discharge q is the mean discharge in the storm window and n is the number of data points in the storm window this variance metric captures the flow s deviation from the mean over the course of the hydrologic response and thus provides a natural metric for the flatness of the hydrograph this metric is important for water quality considerations like first flush contamination or streambed erosion in which the volume of transported material e g contaminants or sediments depends not only on the maximum discharge but also on the duration of flow over a critical threshold wong and kerkez 2016 note that the validation experiment is not intended to faithfully reproduce the precise hydrologic response of our chosen study area but rather to test the basic premises of the controller placement algorithm as such site specific details such as soil types and existing infrastructure have been deliberately simplified for situations in which these characteristics exert an important influence on the hydrologic response one may account for these factors by adjusting the inter vertex travel times used in the controller placement algorithm 4 results the controller placement algorithm produces consistently flatter flows than randomized control trials fig 5 shows the results of the hydraulic simulation assessment in terms of the resulting hydrographs bottom left and the overall flashiness and peak discharge of each simulation right for the 1 year storm event under the volume capture scenario the best performance is achieved by using the controller placement algorithm with k 30 controllers see fig 5 top left comparing the overall variances and peak discharges it can be seen that this controller placement produces flatter outlet discharges than any of the randomized controller placement strategies 6 6 note that the controller placement algorithm results in a longer falling limb than the randomized trials this result stems from the fact that the algorithm prioritizes the removal of grid cells that contribute to the peak and rising limb of the hydrograph while grid cells contributing to the falling limb are ignored in other words the controller placement algorithm shifts discharges from the peak of the hydrograph to the falling limb specifically the best controller placement predicted by the algorithm achieves a peak discharge that is roughly 29 of that of the uncontrolled case while the randomized simulations by comparison achieve an average peak discharge that is more than 61 of that of the uncontrolled case similarly the hydrograph variance of the best controller placement predicted by the algorithm is roughly 9 1 of that of the uncontrolled case compared to 27 for the randomized simulations on average across all numbers of controllers considered the controller placement algorithm yields results in approximately 20 lower variance and 15 lower peak discharge on average compared to the randomized placement strategy the performance of the controller placement algorithm holds under varying rainfall scenarios and reservoir operating rules when tested against storm events of different sizes 10 year and 100 year storm events the controller placement algorithm continues to outperform randomized control trials with roughly 18 lower hydrograph variance and 13 lower peak discharge over all numbers of controllers considered see figs s6 s9 in the supplementary information moreover when tested under the delayed release scenario in which each reservoir continuously releases water from a bottom mounted orifice the controller placement algorithm performs better than under the volume capture scenario in particular the algorithm achieves 28 lower hydrograph variance on average while the best controller placement strategy obtained by the algorithm achieves 80 lower hydrograph variance than the average randomized placement see figs s10 s13 in the supplementary information while the performance of the algorithm holds under different rainfall and reservoir operation scenarios it should be noted that the within group performance varies with rain event size which could result from the nonlinearities inherent in wave propagation speed see the supplementary note in section s7 thus while the optimized controller placement still produces flatter flows than randomized control trials the performance of the controller placement algorithm could be further improved by tuning the assumed inter vertex travel times to correspond to the expected speed of wave propagation under the controller placement algorithm the best performance is achieved by using a large number of small scale controllers however more controllers does not generally lead to better performance for the randomized controller placement scheme given that increasing the number of controllers allows the algorithm to better target highly synchronous cells this result is consistent with the central premise that capturing synchronous cells will lead to a flatter hydrologic response fig 6 shows the hydrologic response when the controller placement algorithm is applied using varying numbers of controllers left along with associated hydrograph variances top right and peak discharges bottom right in all cases roughly 50 of the watershed is controlled however configurations using many small controllers consistently perform better than configurations using a few large controllers this trend does not hold for the randomized controller placement strategy see figs s14 and s15 in the supplementary information indeed the three best performing randomized controller placements use a median of k 17 controllers while the three worst performing randomized controller placements use a median of k 10 controllers where performance is measured in terms of the hydrograph variance by comparison when the controller placement algorithm is used the three best performing simulations use a median of k 30 controllers while the three worst performing simulations use a median of k 2 controllers the finding that the controller placement algorithm converges to a locally optimal solution follows from the fact that as the number of partitions increases controllers are better able to capture highly weighted regions without also capturing extraneous low weight cells this in turn implies that the weighting scheme used by the algorithm accurately identifies the regions of the watershed that contribute disproportionately to synchronized flows thus in spite of various sources of model and parameter uncertainty the experimental results confirm the central principles under which the controller placement algorithm operates namely that synchronous regions can be deduced from the graph structure alone and that controlling these regions results in a flatter hydrograph compared to randomized control trials in addition to demonstrating the efficacy of the controller placement algorithm the validation experiments reveal some general principles for organizing hydraulic control structures within drainage networks to achieve downstream streamflow objectives overall the controller placement strategies that perform best whether achieved through optimization or randomization tend to partition the watershed axially rather than laterally these lengthwise partitions result in a long thin drainage network that prevents tributary flows from piling up fig 7 shows the partitions corresponding to the best performing and worst performing controller placement strategies with respect to peak discharge left and center respectively along with the associated hydrographs right while the best performing controller placement strategy evenly distributes the partitions along the length of the watershed the worst performing controller placement strategy controls only the most upstream half of the watershed as a result the worst performing strategy removes the largest part of the peak but completely misses the portion of the peak originating from the downstream half of the watershed in order to achieve a flat downstream hydrograph controller placement strategies should seek to evenly distribute controllers along the length of the watershed 5 discussion the controller placement algorithm presented in this study provides a tool for designing stormwater control systems to better mitigate floods regulate contaminants and protect aquatic ecosystems by reducing peak discharge optimized placement of stormwater control structures may help to lessen the impact of flash floods existing flood control measures often focus on controlling large riverine floods typically through existing centralized assets like dams and levees however flash floods may occur in small tributaries canals and even normally dry areas for this reason flash floods are not typically addressed by large scale flood control measures despite the fact that they cause more fatalities than riverine floods in the developed world doocy et al 2013 by facilitating distributed control of urban flash floods our controller placement strategy could help reduce flash flood related mortality moreover by flattening the hydrologic response our controller placement algorithm promises to deliver a number of environmental and water quality benefits such as decreased first flush contamination wong and kerkez 2016 decreased sediment transport muschalla et al 2014 improved potential for treatment in downstream green infrastructure bartos et al 2018 kerkez et al 2016 and regulation of flows in sensitive aquatic ecosystems poresky et al 2015 5 1 key features of the algorithm the controller placement algorithm satisfies a number of important operational considerations theoretically motivated the controller placement algorithm has its foundation in the theory of the geomorphological impulse unit hydrograph a relatively mature theory supported by a established body of research gupta and mesa 1988 gupta et al 1986 kirkby 1976 marani et al 1991 mesa and mifflin 1986 rodriguez iturbe and rinaldo 2001 troutman and karlinger 1985 moreover the algorithm works in an intuitive way by recursively removing the subcatchments of a watershed that contribute most to synchronized flows this theoretical basis distinguishes our algorithm from other strategies that involve exhaustive optimization or direct application of existing graph theoretical constructs such as graph centrality metrics generalizable and extensible because it relies solely on network topology the controller placement algorithm will provide consistent results for any drainage network including both natural stream networks and constructed sewer systems moreover because each step in our algorithm has a clear meaning in terms of the underlying hydrology the algorithm can be modified to satisfy more complex control problems such as systems in which specific regulatory requirements must be met flexible to user objectives and constraints the controller placement algorithm permits specification of important practical constraints such as the amount of drainage area that each control site can capture and the number of control sites available moreover the weighting function can be adjusted to optimize for a variety of objectives such as the overall flatness of the hydrograph or removal of flows from a contaminated upstream region parsimonious with respect to data requirements the controller placement algorithm requires only a digital elevation model of the watershed of interest additional data such as land cover and existing hydraulic infrastructure can be used to fine tune estimates of travel times within the drainage network but are not required by the algorithm itself fast implementation for the watershed examined in this study consisting of about 12 000 vertices the controller placement algorithm computes optimal locations for k 15 controllers in roughly 3 0 s on a 2 9 ghz intel core i5 processor while the computational complexity of the algorithm is difficult to characterize 7 7 the computational complexity of the controller placement algorithm depends on the implementation of component functions such as delineation and accumulation computation which can in turn depend on the structure of the watershed itself it is faster than other comparable graph cutting algorithms such as recursive spectral bisection or spectral clustering both of which are o n 3 in computational complexity taken together our algorithm offers a solution to the controller placement problem that is suitable for research as well as for practical applications on one hand the algorithm is based in hydrologic and geomorphological theory and provides important insights into the connections between geomorphology and the design of the built environment on the other hand the algorithm is fast robust and easy to use making it a useful tool for practicing engineers and water resource managers 5 2 caveats and directions for future research while our controller placement algorithm is robust and broadly applicable there are a number of important considerations to keep in mind when applying this algorithm to real world problems the controller placement algorithm implicitly assumes that rainfall is uniform over the catchment of interest while this assumption is justified for small catchments in which the average spatial distribution of rainfall will be roughly uniform this assumption may not hold for large e g continent scale watersheds modifications to the algorithm would be necessary to account for a non uniform spatial distribution of rainfall the controller placement algorithm is sensitive to the chosen ratio of hillslope to channel speeds ϕ care should be taken to select an appropriate value of ϕ based on site specific land cover and morphological characteristics more generally for situations in which differential land cover soil types and existing hydraulic infrastructure play a dominating role the performance of the algorithm may be enhanced by adjusting inter vertex travel times to correspond to estimated overland flow and channel velocities our assessment of the algorithm s performance rests on the assumption that installed control structures e g retention basins are large enough to capture upstream discharges the algorithm itself does not explicitly account for endogenous upstream flooding that could be introduced by installing new control sites in this study experiments were conducted only for impulsive rainfall inputs i e with a short duration of rainfall future work should assess the performance of the distance weighted controller placement strategy under arbitrary rainfall durations our analysis assumes that reservoirs are initially empty before each storm event while some previous studies in distributed reservoir operation contend that an initially empty condition is the simplest and most defensible approach goldman 2001 other studies use random initialization of reservoir depths to simulate the effect of successive storm events when reservoir operation rules are unknown ayalew et al 2013 while this latter approach may provide more realistic results under unknown reservoir operating conditions we ultimately use an initially empty condition due to the combinatorial difficulty of assessing the effect of random initial depths alongside varying numbers of controllers controller placement strategies and rainfall scenarios random initialization could potentially effect the results by inducing overflows under the volume capture scenario or by quickening the rising limb under the delayed release scenario additional work is needed to understand how these effects would impact the performance of the controller placement algorithm compared to randomized control trials with this in mind it should be noted that new smart water systems are enabling more flexible control of distributed stormwater infrastructure kerkez et al 2016 which may in turn strengthen the assumption of initially empty storage conditions bartos et al for instance present a real world case study in which real time analytics and control are used to pre emptively evacuate retention basins before a storm event reducing the magnitude of the downstream hydrologic response bartos et al 2018 because initially emptying storage basins often leads to a favorable hydrologic response wong 2017 assuming empty or near empty initial storage conditions may be more realistic than assuming random initial depths for systems with real time control capabilities this study focuses primarily on event based diagnostics of system performance specifically by measuring the flatness of the hydrologic response under independent storm events however it should be noted that water infrastructure may also be evaluated in terms of long term performance for instance by measuring the response of the system to an extended stochastic rainfall time series while not computationally feasible for the model used in this study future work should investigate the performance of the controller placement algorithm under extended hydrodynamic simulations more broadly future research should investigate the problem of sensor placement in stream networks using the theoretical framework developed in this paper while this study focuses on the problem of placement of hydraulic control structures our algorithm also suggests a solution to the problem of sensor placement stated probabilistically the geomorphological impulse unit hydrograph giuh represents the probability that a particle injected randomly within the watershed at time t 0 exits the outlet at time t t thus the peaks of the giuh correspond to the portions of the hydrologic response where there is the greatest amount of ambiguity about where a given particle originated it follows that the same locations that maximally de synchronize flows may also be the best locations for disambiguating the locations from which synchronous flows originated future experiments should investigate the ability to estimate upstream states e g flows within the network given an outlet discharge along with internal state observers e g flow sensors placed using the algorithm developed in this study 6 conclusions we develop an algorithm for placement of hydraulic control structures that maximally flattens the hydrologic response of drainage networks this algorithm uses the geomorphological impulse unit hydrograph to locate subcatchments that dominate the peaks of the hydrograph then partitions the drainage network to minimize the contribution of these subcatchments we find that the controller placement algorithm produces flatter hydrographs than randomized controller placement trials both in terms of peak discharge and overall variance by reducing the flashiness of the hydrologic response our controller placement algorithm may one day help to mitigate flash floods and restore urban water quality through reduction of contaminant loads and prevention of streambed erosion we find that the performance of the algorithm is enhanced when using a large number of small distributed controllers in addition to confirming the central hypothesis that synchronous cells can be identified based on network structure of drainage basins this result lends justification to the development of decentralized smart stormwater systems in which active control of small scale retention basins canals and culverts enables more effective management of urban stormwater overall our algorithm is efficient requires only digital elevation model data and is robust to parameter and model uncertainty making it suitable both as a research tool and as a design tool for practicing water resources engineers declarations of interest none data availability code and data links are available at https github com klabum hydraulic controller placement acknowledgments funding for this project was provided by the national science foundation grants 1639640 and 1442735 and the university of michigan we would like to thank alex ritchie for exploring alternative approaches to the controller placement problem and for his help with literature review we would also like to thank dr alfred hero for his advice in formulating the problem supplementary material supplementary material associated with this article can be found in the online version at doi 10 1016 j advwatres 2019 03 016 appendix a supplementary materials supplementary data s1 supplementary raw research data this is open data under the cc by license http creativecommons org licenses by 4 0 supplementary data s1 
672,the need to attenuate hydrograph peaks is central to the design of stormwater and flood control systems however few guidelines exist for siting hydraulic control structures such that system scale benefits are maximized this study presents a new graph theoretic algorithm for stabilizing the hydrologic response of watersheds by placing controllers at strategic locations in the drainage network this algorithm identifies subcatchments that dominate the peak of the hydrograph and then finds the cuts in the drainage network that maximally isolate these subcatchments thereby flattening the hydrologic response evaluating the performance of the algorithm through an ensemble of hydrodynamic simulations we find that our controller placement algorithm produces consistently flatter discharges than randomized controller configurations both in terms of the peak discharge and the overall variance of the hydrograph by attenuating flashy flows our algorithm provides a powerful methodology for mitigating flash floods reducing erosion and protecting aquatic ecosystems more broadly we show that controller placement exerts an important influence on the hydrologic response and demonstrate that analysis of drainage network structure can inform more effective stormwater control policies keywords control systems controller placement graph theory stormwater control 1 introduction in the wake of rapid urbanization aging infrastructure and a changing climate effective stormwater management poses a major challenge for cities worldwide kerkez et al 2016 flash floods are one of the largest causes of natural disaster deaths in the developed world doocy et al 2013 and often occur when stormwater systems fail to convey runoff from urban areas wright and marchese 2017 at the same time many cities suffer from impaired water quality due to inadequate stormwater control walsh et al 2005 flashy flows erode streambeds release sediment bound pollutants and damage aquatic habitats booth and jackson 1997 finkenbine et al 2000 walsh et al 2005 wang et al 2001 while untreated runoff may trigger fish kills and toxic algal blooms sahagun 2013 wines 2014 engineers have historically responded to these problems by expanding and upsizing stormwater control infrastructure rosenberg et al 2010 however larger infrastructure frequently brings adverse side effects such as dam induced disruption of riparian ecosystems dam 2000 and erosive discharges due to overdesigned conveyance infrastructure kerkez et al 2016 as a result recent work has called for the replacement of traditional peak attenuation infrastructure with targeted solutions that better reduce environmental impacts arora et al 2015 hawley and vietz 2016 as the drawbacks of oversized stormwater infrastructure become more apparent many cities are turning towards decentralized stormwater solutions to regulate and treat urban runoff while reducing adverse impacts green infrastructure for instance uses low impact rain gardens bioswales and green roofs to condition flashy flows and remove contaminants askarizadeh et al 2015 coffman et al 1999 strecker et al 2000 smart stormwater systems take this idea further by retrofitting static infrastructure with dynamically controlled valves gates and pumps bartos et al 2018 kerkez et al 2016 mullapudi et al 2018 2017 by actuating small distributed storage basins and conveyance structures in real time smart stormwater systems can halt combined sewer overflows montestruque and lemmon 2015 mitigate flooding kerkez et al 2016 and improve water quality at a fraction of the cost of new construction bartos et al 2018 kerkez et al 2016 while decentralized stormwater management tools show promise towards mitigating urban water problems it is currently unclear how these systems can be designed to achieve maximal benefits at the watershed scale indeed some research suggests when stormwater control facilities are not designed in a global context local best management practices can lead to adverse system scale outcomes in some cases inducing downstream flows that are more intense than those produced under unregulated conditions emerson et al 2005 petrucci et al 2013 thus as cities begin to experiment with decentralized stormwater control the question of where to place control structures becomes crucial while many studies have investigated the ways in which active control can realize system scale benefits using techniques like feedback control wong and kerkez 2018 market based control montestruque and lemmon 2015 or model predictive control gelormino and ricker 1994 mollerup et al 2016 the location of control structures within the drainage network may serve an equally important function hydrologists have long recognized the role that drainage network topology plays in shaping hydrologic response gupta and mesa 1988 gupta et al 1986 kirkby 1976 mantilla et al 2011 marani et al 1991 mesa and mifflin 1986 tejedor et al 2015a b troutman and karlinger 1985 it follows that strategic placement of hydraulic control structures can shape the hydrograph to fulfill operational objectives such as maximally flattening flood waves and regulating erosion downstream to date however little research has been done to assess the problem of optimal placement of hydraulic control structures in drainage networks recent studies have investigated optimal placement of green infrastructure upgrades like green roofs rain tanks and bioswales meerow and newell 2017 norton et al 2015 schilling and logan 2008 schubert et al 2017 yao et al 2015 zellner et al 2016 zhang et al 2015 however these studies generally focus on quantifying the potential benefits of green infrastructure projects through representative case studies schubert et al 2017 yao et al 2015 zellner et al 2016 zhang et al 2015 and do not intend to present a generalized framework for placement of stormwater control structures as a result many of these studies focus on optimizing multiple objectives such as urban heat island mitigation norton et al 2015 air quality meerow and newell 2017 or quality of life considerations schilling and logan 2008 or use complex socio physical models and optimization frameworks zellner et al 2016 making it difficult to draw general conclusions about controller placement in drainage networks studies of pressurized water distribution networks have investigated the related problems of valve placement cattafi et al 2011 creaco et al 2010 sensor placement perelman and ostfeld 2013 subnetwork vulnerability assessment yazdani and jeffrey 2011 and network sectorization hajebi et al 2015 tzatchkov et al 2008 while these studies provide valuable insights into the ways that complex network theory can inform drinking water infrastructure design water distribution networks are pressure driven and cyclic and are thus governed by different dynamics than natural drainage networks which are mainly gravity driven and dendritic recent studies in distributed reservoir management have revealed that the placement of reservoirs plays an important role in flood control ayalew et al 2015 develop a framework that combines rainfall runoff modeling reservoir routing and monte carlo simulation to assess reservoir regulated flood response ayalew et al 2013 and then subsequently use this framework to investigate the effects of reservoir placement on flood frequency ayalew et al 2015 using a randomly generated 1 000 year rainfall time series along with a simulated catchment they find that two retention basins placed in parallel provide better flood control than either i two retention basis placed in series along the river main stem or ii a single large retention basin upstream of the watershed outlet this research demonstrates that placement of hydraulic control structures exerts a powerful influence on the performance of flood control infrastructure and raises questions about how larger numbers of control structures should best be distributed throughout a watershed to improve flood control inspiration for the controller placement problem can be drawn from recent theoretical work into the controllability of complex networks these studies show that the control properties of complex systems ranging from power grids to gene expression pathways are inextricably linked with topological properties of an underlying network representation liu and barabási 2016 the location of driver nodes needed for complete controllability of a linear system for instance can be determined from the maximum matching of a graph associated with that system s state space representation liu et al 2011 for systems in which complete control of the network is infeasible the relative performance of driver node configurations can be measured by detecting controllable substructures ruths and ruths 2014 or by leveraging the concept of control energy from classical control theory shirin et al 2017 summers and lygeros 2014 yan et al 2012 2015 while these studies bring a theoretical foundation to the problem of controller placement they generally assume linear system dynamics and may thus not be well suited for drainage networks which are driven by nonlinear runoff formation and channel routing processes recent studies have drawn on advances in complex network theory to examine the controllability of stream networks riasi and yeghiazarian 2017 and enhance understanding of geomorphological processes czuba and foufoula georgiou 2015 riasi and yeghiazarian apply several theoretical controllability metrics to real world drainage networks ultimately finding that control of dendritic river networks requires a relatively large proportion of driver nodes riasi and yeghiazarian 2017 czuba and foufoula georgiou investigate spatial and temporal patterns in sediment accumulation in a river network arising from the combined effects of transport dynamics and stream network topology czuba and foufoula georgiou 2015 they find that the emergence of persistent clusters of mass on the network is a major driver of geomorphological change and conclude that management efforts should seek to identify the source contributions that synchronize on the network to form clusters and then break the synchronization by reducing sediment generation in these regions despite the critical need for system scale stormwater control there is to our knowledge no robust theoretical framework to guide the placement of hydraulic control structures for the purposes of improving hydrograph peak attentuation to address this knowledge gap we formulate a new graph theoretic algorithm that uses the network structure of watersheds to determine the controller locations that will maximally de synchronize tributary flows by flattening the discharge hydrograph our algorithm provides a powerful method to mitigate flash floods and curtail water quality impairments in urban watersheds our approach is distinguished by the fact that it is theoretically motivated and links the control of stormwater systems with the underlying structure of the drainage network the result is a fast generalized algorithm that requires only digital elevation data for the watershed of interest more broadly through our graph theoretic framework we show that network structure plays a dominant role in the control of drainage basins and demonstrate how the study of watersheds as complex networks can inform more effective stormwater infrastructure design 2 algorithm description flashy flows occur when large volumes of runoff arrive synchronously at a given location in the drainage network if hydraulic control structures are placed at strategic locations flood waves can be mitigated by de synchronizing tributary flows before they arrive at a common junction with this in mind we introduce a controller placement algorithm that minimizes flashy flows by removing regions of the drainage network that contribute disproportionately to synchronous flows at the outlet in our approach the watershed is first transformed into a directed graph consisting of unit subcatchments vertices connected by flow paths edges next critical regions are identified by computing the catchment s width function an approximation of the distribution of travel times to the outlet and then weighting each vertex in the network in proportion to the number of vertices that share the same travel time to the outlet the weights are used to compute a weighted accumulation score for each vertex which sums the weights of every possible subcatchment in the watershed the graph is then partitioned recursively based on this weighted accumulation score with the most downstream vertex of each partition representing a controller location 2 1 definitions graph representation of a watershed watersheds can be represented as directed graphs in which subcatchments vertices or cells are connected by elevation dependent flow paths edges the directed graph can be formulated mathematically as an adjacency matrix a where for each element aij aij 0 if there exists a directed edge connecting vertex vj to vi and conversely a i j 0 if there does not exist a directed edge connecting vertex vj to vi nonzero edge weights can be specified to represent travel times distances or probabilities of transition between connected vertices flow paths between adjacent cells are established using a routing scheme typically based on directions of steepest descent see fig 1 in this study we determine the connectivity of the drainage network using a d8 routing scheme o callaghan and mark 1984 in this scheme elevation cells are treated as vertices in a 2 dimensional lattice meaning that each vertex vi is surrounded by eight neighbors n i a directed link is established from vertex vi to a neighboring vertex vj if the slope between vi and vj is steeper than the slope between vi and all of its other neighbors n i v j where vj has a lower elevation than vi the d8 routing scheme produces a directed acyclic graph where the indegree of each vertex is between 0 and 8 with an indegree of 8 indicating that the vertex is a sink and the outdegree of each vertex is 1 except for the watershed outlet which has an outdegree of 0 it should be noted that other schemes exist for determining drainage network structure such as the d infinity routing algorithm which better resolves drainage directions on hillslopes tarboton 1997 however because the routing scheme is not essential to the construction of the algorithm we focus on the simpler d8 routing scheme for this study similarly to simplify the construction of the algorithm we will assume that the vertices of the watershed are defined on a regular grid such that the area of each unit subcatchment is equal 1 1 thus for watershed models derived from a digital elevation model dem a unit subcatchment is equivalent to a single dem cell fig 1 shows the result of delineating a river network from a digital elevation model left along with an illustration of the underlying graph structure and adjacency matrix representation right controller in the context of this study a controller represents any structure or practice that can regulate flows from an upstream channel segment to a downstream one examples include retention basins dams weirs gates and other hydraulic control structures these structures may be either passively or actively controlled for the validation assessment presented later in this paper we will examine the controller placement problem in the context of volume capture meaning that controllers are passive and that they are large enough to completely remove flows from their upstream contributing areas however the algorithm itself does not require the controller to meet these particular conditions mathematically we can think of a controller as a cut in the graph that removes one of the edges this cut halts or inhibits flows across the affected edge because the watershed has a dendritic structure any cut in the network will split the network into two sub trees i the delineated region upstream of the cut and ii all the vertices that are not part of the delineated region placing controllers is thus equivalent to removing branches subcatchments from a tree the parent watershed delineation delineation returns the set of vertices upstream of a target vertex in other words this operation returns the contributing area of vertex vi expressed in terms of the adjacency matrix 1 v d a v i v j v a n i j 0 for some n d where an is the adjacency matrix a raised to the nth power i is the row index j is the column index v is the vertex set of a and d is the graph diameter note that an ij is nonzero only if vertex vj is located within an n hop neighborhood of vertex vi note that the delineation operation can also be performed in a single step by analyzing the null space of the graph laplacian of the watershed s adjacency matrix tejedor et al 2015a pruning pruning is the complement of delineation this operation returns the vertex set consisting of all vertices that are not upstream of the current vertex 2 v p a v i v v d a v i subgraphs induced by the delineated and pruned vertex sets are defined as follows 3 a d a v i a g v d a p a v i a g v p where a g v represents the adjacency matrix of the subgraph induced by the vertex set v width function the width function describes the distribution of travel times from each upstream vertex to some downstream vertex vi 2 2 the width function h x was originally defined by shreve to yield the number of links in the network at a topological distance x from the outlet shreve 1969 because travel times may vary between hillslope and channel links we present a generalized formulation of the width function here rodriguez iturbe and rinaldo 2001 in general terms the width function can be expressed as 4 h t v i γ γ i i γ t along with an indicator function i γ t 5 i γ t 1 t γ t 0 otherwise where γ i is the set of all directed paths to the target vertex vi and t γ is the travel time along path γ if the travel times between vertices are constant and equal for all vertices the width function of the graph at vertex vi can be described as a linear function of the adjacency matrix 3 3 while mathematically concise this equation is computationally inefficient see section s1 in the supplementary information for the efficient implementation used in our analysis 6 h t v i a t 1 i where 1 signifies the vector of all ones at represents the adjacency matrix a raised to the power t with t representing the discrete time step and at 1 i indicates the ith element of the vector at 1 in real world drainage networks travel times between grid cells are not uniform crucially the travel time for channelized cells will be roughly 1 2 orders of magnitude faster than the travel time in hillslope cells rodriguez iturbe and rinaldo 2001 tak and bras 1990 thus to account for this discrepancy we define ϕ to represent the ratio of hillslope to channel travel times 7 ϕ t h t c where th is the travel time for hillslopes and tc is the travel time for channels fig 2 left shows the width function for an example watershed under the assumption that channel velocity is ten times faster than hillslope velocity ϕ 10 the width functions for various values of ϕ are shown in figs s3 and s4 in the supplementary information note that when the effects of hydraulic dispersion are ignored the width function is equivalent to the geomorphological impulse unit hydrograph giuh of the basin rodriguez iturbe and rinaldo 2001 the giuh represents the response of the basin to an instantaneous impulse of rainfall distributed uniformly over the catchment or equivalently the probability that a particle injected randomly within the watershed at time t 0 exits the watershed through the outlet at time t t accumulation the accumulation at vertex vi describes the number of vertices located upstream of vi or alternatively the upstream area moore et al 1991 it is equivalent to the cumulative sum of the width function with respect to time 4 4 see section s1 in the supplementary information for the efficient implementation of the accumulation algorithm 8 c v i t 0 a t 1 i fig 3 left shows the accumulation at each vertex for an example catchment because upstream area is correlated with mean discharge rodriguez iturbe and rinaldo 2001 accumulation is frequently used to determine locations of channels within a drainage network moore et al 1991 weighting function to identify the vertices that contribute most to synchronous flows at the outlet we propose a weighting function that weights each vertex by its rank in the travel time distribution let τij represent the known travel time from a starting vertex vj to the outlet vertex vi then the weight associated with vertex vj can be expressed in terms of a weighting function w vi vj 9 w j w v i v j h τ i j v i max t h v i where τij represents the travel time from vertex vj to vertex vi h τij vi represents the width function for an outlet vertex vi evaluated at time τij and the normalizing factor max t h vi represents the maximum value of the width function over all time steps t in this formulation vertices are weighted by the rank of the associated travel time in the width function vertices that contribute to the maximum value of the width function the mode of the travel time distribution will receive the highest possible weight unity while vertices that contribute to the smallest values of the width function will receive small weights in other words vertices will be weighted in proportion to the number of vertices that share the same travel time to the outlet fig 2 shows the weights corresponding to each bin of the travel time distribution left along with the weights applied to each vertex right weights for varying values of ϕ are shown in figs s3 and s4 in the supplementary information weighted accumulation much like the accumulation describes the number of vertices upstream of each vertex vi the weighted accumulation yields the sum of the weights upstream of vi if each vertex vj is given a weight wj the weighted accumulation at vertex vi can be defined 10 c w v i w t 0 a t w i where w is a vector of weights with each weight wj associated with a vertex vj in the graph when the previously defined weighting function is used the weighted accumulation score measures the extent to which a subcatchment delineated at vertex vi contributes to synchronous flows at the outlet in other words if the ratio of weighted accumulation to accumulation is large for a particular vertex this means that the subcatchment upstream of that vertex contributes disproportionately to the peak of the hydrograph fig 3 right shows the ratio of weighted accumulation to accumulation for the example catchment the weighted accumulation provides a natural metric for detecting the cuts in the drainage network that will maximally remove synchronous flows and thus forms the basis of the controller placement algorithm 2 2 controller placement algorithm definition the controller placement algorithm is described as follows let a represent the adjacency matrix of a watershed delineated at some vertex vi additionally let k equal the desired number of controllers and c equal the maximum upstream accumulation allowed for each controller the graph is then partitioned according to the following scheme 1 compute the width function h t vi for the graph described by adjacency matrix a with an outlet at vertex vi 2 compute the accumulation c vj at each vertex vj 3 use h t vi to compute the weighted accumulation cw vj at each vertex vj 4 find the vertex vopt where the accumulation c vopt is less than the maximum allowable accumulation and the weighted accumulation cw vopt is maximized 11 v o p t argmax v s v s c w v s where vs is the set of vertices such that vertex vi is reachable from any vertex in vs and the accumulation c at any vertex in vs is less than c 5 prune the graph at vertex vopt a ap a vopt 6 if the cumulative number of partitions is equal to k end the algorithm otherwise start at 1 with the catchment described by the new a matrix the algorithm is described formally in algorithm 1 an open source implementation of the algorithm in the python programming language is also provided bartos 2018a along with the data needed to reproduce our results efficient implementations of the delineation accumulation and width function operations are provided via the pysheds toolkit which is maintained by the authors bartos 2018b fig 4 shows the controller configuration generated by applying the controller placement algorithm to the example watershed with k 15 controllers each with a maximum accumulation of c 900 i e each controller captures roughly 8 of the catchment s land area in the left panel partitions are shown in order of decreasing priority from dark to light i e darker regions are partitioned first by the algorithm the right panel shows the stacked width functions for each partition the sum of the width functions from each partition reconstitute the original width function for the catchment from the stacked width functions it can be seen that the algorithm tends to prioritize the pruning of subgraphs that align with the peaks of the travel time distribution note for instance how the least prioritized paritions gravitate towards the low end of the travel time distribution while the most prioritized partitions are centered around the mode controller placement schemes corresponding to different numbers of controllers are shown in fig s5 in the supplementary information 3 algorithm validation to evaluate the controller placement algorithm we simulate the controlled network using a hydrodynamic model and compare the performance to a series of randomized controller placement configurations performance is characterized by the flatness of the flow profile at the outlet of the watershed as measured by both the peak discharge and the variance of the hydrograph i e the extent to which the flow deviates from the mean flow over the course of the hydrologic response to establish a basis for comparison we simulate a volume capture scenario emerson et al 2005 wherein roughly half of the total contributing area is controlled and each controller completely captures the discharge from its respective upstream area additionally we simulate a delayed release scenario in which each controller continuously releases water from a large bottom mounted orifice thereby delaying rather than halting flows from the upstream channel network these scenarios are chosen as bounding cases given that most real world reservoir operation will fall somewhere between these two regimes the validation experiment is designed to test the central premises of the controller placement algorithm that synchronous cells can be identified from the structure of the drainage network and that maximally capturing these synchronous cells will lead to a flatter overall hydrologic response if these premises are accurate we expect to see two results first the controller placement algorithm will produce flatter flows than the randomized control trials second the performance of the algorithm will be maximized when using a large number of small partitions using many small partitions allows the algorithm to selectively target the highly weighted cells that contribute disproportionately to the peak of the hydrograph conversely large partitions capture many extraneous low weight cells that don t contribute to the peak of the hydrograph in other words if increasing the number of partitions improves the performance of the algorithm it not only confirms that the algorithm works for our particular experiment but also justifies the central premises on which the algorithm is based 3 1 experimental design we evaluate controller configurations based on their ability to flatten the outlet hydrograph of a test watershed when approximately 50 of the contributing area is controlled this test case is chosen because it presents a practical scenario with real world constraints and because it allows for direct comparison of many different controller placement strategies for our test case we use the sycamore creek watershed a heavily urbanized creekshed located in the dallas fort worth metroplex with a contributing area of roughly 83 km2 see fig 1 this site is the subject of a long term monitoring study led by the authors bartos et al 2018 and is chosen for this analysis because i it is known to experience issues with flash flooding and ii it is an appropriate size for our analysis being large enough to capture fine scale network topology but not so large that computation time becomes burdensome a model of the stream network is generated from a conditioned digital elevation model dem by determining flow directions from the elevation gradient and then assigning channels to cells that fall above an accumulation threshold conditioned dems and flow direction grids at a resolution of 3 arcseconds approximately 70 by 90 m are obtained from the usgs hydrosheds database lehner et al 2008 grid cells with an accumulation greater than 100 are defined to be channelized cells while those with less than 100 accumulation are defined as hillslope cells this threshold is based on visual comparison with the stream network defined in the national hydrography dataset nhd united states geological survey 2013 hillslope cells draining into a common channel are aggregated into subcatchments with a flow length corresponding to the longest path within each hillslope and a slope corresponding to the average slope over all flow paths in the subcatchment percent impervious area and land cover classifications for each subcatchment are obtained from the national land cover database homer et al 2015 allowing for overland flow velocities to be reasonably approximated see section s3 in the supplementary information channel geometries are assigned to each link within the channelized portion of the drainage network we assume that each stream segment can be represented by a wide rectangular channel which is generally accurate for natural river reaches in which the stream width is large compared to the stream depth mays 2010 to simulate channel width and depth we assume a power law relation between accumulation and channel size based on an empirical formulation from moody and troutman 2002 12 ω 7 2 q 0 50 0 02 h 0 27 q 0 30 0 01 where ω is stream width h is stream depth and q is the mean river discharge knowing the width and depth of the most downstream reach and assuming that the accumulation at a vertex is proportional to the mean flow we generate channel geometries using the mean parameter values from the above relations to simulate the effect of floodplain storage and prevent channel overflow a trapezoidal floodplain section is added to the top of each channel see section s4 of the supplementary information for additional implementation details controllers are implemented as retention basins regulated by outlet structures with controllable orifices orifices are mounted on the bottom of each outlet structure and have approximately 10 of the cross sectional area of the upstream channel section for the volume capture scenario the orifice is left closed while for the delayed release scenario the orifice is left open retention basins are sized using a linear relationship between depth and surface area and are checked against known real world retention basins to ensure realistic storage capacities for additional details see section s4 in the supplementary information using the controller placement algorithm control structures are placed such that approximately 50 3 of the catchment area is captured by storage basins to investigate the effect of the number of controllers on performance optimized controller strategies are generated using between k 1 and k 35 controllers the ratio of hillslope to channel travel times is estimated as ϕ 50 based on simulations of the catchment under uncontrolled conditions we compare the performance of our controller placement algorithm to randomized controller placement schemes in which approximately 50 3 of the catchment area is controlled but the placement of controllers is random for this comparison assessment we generate 50 randomized controller placement trials each using between k 1 and k 24 controllers 5 5 while the controller randomization code was programmed to use between 1 and 35 controllers the largest number of controllers achieved was 24 this result stems from the fact that the randomization algorithm struggled to achieve 30 partitions without selecting cells that fell below the channelization threshold 100 accumulation for each randomized trial the maximum and minimum accumulation that can be handled by each controller is selected then controllers are placed sequentially until 50 3 of the total catchment is upstream of at least one controller this procedure is similar to the controller placement algorithm except that at each iteration the controller is placed at a random candidate cell i e a cell with an accumulation in the appropriate range instead of the candidate cell with the greatest weighted accumulation see section s2 in the supplementary information for a detailed description of the procedure we simulate the hydrologic response using a hydrodynamic model and evaluate controller placement performance based on the flatness of the resulting hydrograph to capture the hydrologic response under various rainfall conditions we simulate small medium and large rainfall events corresponding to 11 2 16 9 and 23 4 mm of rainfall delivered instantaneously over the first five minutes of the simulation these rainfall volumes are based on the 1 year 10 year and 100 year design storms 5 minute duration from intensity duration frequency curves for tarrant county in texas iswm 2006 a hydrodynamic model is used to simulate the hydrologic response at the outlet by routing runoff through the channel network using the dynamic wave equations united states environmental protection agency 2018 the simulation performance is measured by both the peak discharge and the total variance of the hydrograph the variance of the hydrograph which we refer to as flashiness is defined as 13 σ 2 1 n i 1 n q i q 2 where q is the discharge q is the mean discharge in the storm window and n is the number of data points in the storm window this variance metric captures the flow s deviation from the mean over the course of the hydrologic response and thus provides a natural metric for the flatness of the hydrograph this metric is important for water quality considerations like first flush contamination or streambed erosion in which the volume of transported material e g contaminants or sediments depends not only on the maximum discharge but also on the duration of flow over a critical threshold wong and kerkez 2016 note that the validation experiment is not intended to faithfully reproduce the precise hydrologic response of our chosen study area but rather to test the basic premises of the controller placement algorithm as such site specific details such as soil types and existing infrastructure have been deliberately simplified for situations in which these characteristics exert an important influence on the hydrologic response one may account for these factors by adjusting the inter vertex travel times used in the controller placement algorithm 4 results the controller placement algorithm produces consistently flatter flows than randomized control trials fig 5 shows the results of the hydraulic simulation assessment in terms of the resulting hydrographs bottom left and the overall flashiness and peak discharge of each simulation right for the 1 year storm event under the volume capture scenario the best performance is achieved by using the controller placement algorithm with k 30 controllers see fig 5 top left comparing the overall variances and peak discharges it can be seen that this controller placement produces flatter outlet discharges than any of the randomized controller placement strategies 6 6 note that the controller placement algorithm results in a longer falling limb than the randomized trials this result stems from the fact that the algorithm prioritizes the removal of grid cells that contribute to the peak and rising limb of the hydrograph while grid cells contributing to the falling limb are ignored in other words the controller placement algorithm shifts discharges from the peak of the hydrograph to the falling limb specifically the best controller placement predicted by the algorithm achieves a peak discharge that is roughly 29 of that of the uncontrolled case while the randomized simulations by comparison achieve an average peak discharge that is more than 61 of that of the uncontrolled case similarly the hydrograph variance of the best controller placement predicted by the algorithm is roughly 9 1 of that of the uncontrolled case compared to 27 for the randomized simulations on average across all numbers of controllers considered the controller placement algorithm yields results in approximately 20 lower variance and 15 lower peak discharge on average compared to the randomized placement strategy the performance of the controller placement algorithm holds under varying rainfall scenarios and reservoir operating rules when tested against storm events of different sizes 10 year and 100 year storm events the controller placement algorithm continues to outperform randomized control trials with roughly 18 lower hydrograph variance and 13 lower peak discharge over all numbers of controllers considered see figs s6 s9 in the supplementary information moreover when tested under the delayed release scenario in which each reservoir continuously releases water from a bottom mounted orifice the controller placement algorithm performs better than under the volume capture scenario in particular the algorithm achieves 28 lower hydrograph variance on average while the best controller placement strategy obtained by the algorithm achieves 80 lower hydrograph variance than the average randomized placement see figs s10 s13 in the supplementary information while the performance of the algorithm holds under different rainfall and reservoir operation scenarios it should be noted that the within group performance varies with rain event size which could result from the nonlinearities inherent in wave propagation speed see the supplementary note in section s7 thus while the optimized controller placement still produces flatter flows than randomized control trials the performance of the controller placement algorithm could be further improved by tuning the assumed inter vertex travel times to correspond to the expected speed of wave propagation under the controller placement algorithm the best performance is achieved by using a large number of small scale controllers however more controllers does not generally lead to better performance for the randomized controller placement scheme given that increasing the number of controllers allows the algorithm to better target highly synchronous cells this result is consistent with the central premise that capturing synchronous cells will lead to a flatter hydrologic response fig 6 shows the hydrologic response when the controller placement algorithm is applied using varying numbers of controllers left along with associated hydrograph variances top right and peak discharges bottom right in all cases roughly 50 of the watershed is controlled however configurations using many small controllers consistently perform better than configurations using a few large controllers this trend does not hold for the randomized controller placement strategy see figs s14 and s15 in the supplementary information indeed the three best performing randomized controller placements use a median of k 17 controllers while the three worst performing randomized controller placements use a median of k 10 controllers where performance is measured in terms of the hydrograph variance by comparison when the controller placement algorithm is used the three best performing simulations use a median of k 30 controllers while the three worst performing simulations use a median of k 2 controllers the finding that the controller placement algorithm converges to a locally optimal solution follows from the fact that as the number of partitions increases controllers are better able to capture highly weighted regions without also capturing extraneous low weight cells this in turn implies that the weighting scheme used by the algorithm accurately identifies the regions of the watershed that contribute disproportionately to synchronized flows thus in spite of various sources of model and parameter uncertainty the experimental results confirm the central principles under which the controller placement algorithm operates namely that synchronous regions can be deduced from the graph structure alone and that controlling these regions results in a flatter hydrograph compared to randomized control trials in addition to demonstrating the efficacy of the controller placement algorithm the validation experiments reveal some general principles for organizing hydraulic control structures within drainage networks to achieve downstream streamflow objectives overall the controller placement strategies that perform best whether achieved through optimization or randomization tend to partition the watershed axially rather than laterally these lengthwise partitions result in a long thin drainage network that prevents tributary flows from piling up fig 7 shows the partitions corresponding to the best performing and worst performing controller placement strategies with respect to peak discharge left and center respectively along with the associated hydrographs right while the best performing controller placement strategy evenly distributes the partitions along the length of the watershed the worst performing controller placement strategy controls only the most upstream half of the watershed as a result the worst performing strategy removes the largest part of the peak but completely misses the portion of the peak originating from the downstream half of the watershed in order to achieve a flat downstream hydrograph controller placement strategies should seek to evenly distribute controllers along the length of the watershed 5 discussion the controller placement algorithm presented in this study provides a tool for designing stormwater control systems to better mitigate floods regulate contaminants and protect aquatic ecosystems by reducing peak discharge optimized placement of stormwater control structures may help to lessen the impact of flash floods existing flood control measures often focus on controlling large riverine floods typically through existing centralized assets like dams and levees however flash floods may occur in small tributaries canals and even normally dry areas for this reason flash floods are not typically addressed by large scale flood control measures despite the fact that they cause more fatalities than riverine floods in the developed world doocy et al 2013 by facilitating distributed control of urban flash floods our controller placement strategy could help reduce flash flood related mortality moreover by flattening the hydrologic response our controller placement algorithm promises to deliver a number of environmental and water quality benefits such as decreased first flush contamination wong and kerkez 2016 decreased sediment transport muschalla et al 2014 improved potential for treatment in downstream green infrastructure bartos et al 2018 kerkez et al 2016 and regulation of flows in sensitive aquatic ecosystems poresky et al 2015 5 1 key features of the algorithm the controller placement algorithm satisfies a number of important operational considerations theoretically motivated the controller placement algorithm has its foundation in the theory of the geomorphological impulse unit hydrograph a relatively mature theory supported by a established body of research gupta and mesa 1988 gupta et al 1986 kirkby 1976 marani et al 1991 mesa and mifflin 1986 rodriguez iturbe and rinaldo 2001 troutman and karlinger 1985 moreover the algorithm works in an intuitive way by recursively removing the subcatchments of a watershed that contribute most to synchronized flows this theoretical basis distinguishes our algorithm from other strategies that involve exhaustive optimization or direct application of existing graph theoretical constructs such as graph centrality metrics generalizable and extensible because it relies solely on network topology the controller placement algorithm will provide consistent results for any drainage network including both natural stream networks and constructed sewer systems moreover because each step in our algorithm has a clear meaning in terms of the underlying hydrology the algorithm can be modified to satisfy more complex control problems such as systems in which specific regulatory requirements must be met flexible to user objectives and constraints the controller placement algorithm permits specification of important practical constraints such as the amount of drainage area that each control site can capture and the number of control sites available moreover the weighting function can be adjusted to optimize for a variety of objectives such as the overall flatness of the hydrograph or removal of flows from a contaminated upstream region parsimonious with respect to data requirements the controller placement algorithm requires only a digital elevation model of the watershed of interest additional data such as land cover and existing hydraulic infrastructure can be used to fine tune estimates of travel times within the drainage network but are not required by the algorithm itself fast implementation for the watershed examined in this study consisting of about 12 000 vertices the controller placement algorithm computes optimal locations for k 15 controllers in roughly 3 0 s on a 2 9 ghz intel core i5 processor while the computational complexity of the algorithm is difficult to characterize 7 7 the computational complexity of the controller placement algorithm depends on the implementation of component functions such as delineation and accumulation computation which can in turn depend on the structure of the watershed itself it is faster than other comparable graph cutting algorithms such as recursive spectral bisection or spectral clustering both of which are o n 3 in computational complexity taken together our algorithm offers a solution to the controller placement problem that is suitable for research as well as for practical applications on one hand the algorithm is based in hydrologic and geomorphological theory and provides important insights into the connections between geomorphology and the design of the built environment on the other hand the algorithm is fast robust and easy to use making it a useful tool for practicing engineers and water resource managers 5 2 caveats and directions for future research while our controller placement algorithm is robust and broadly applicable there are a number of important considerations to keep in mind when applying this algorithm to real world problems the controller placement algorithm implicitly assumes that rainfall is uniform over the catchment of interest while this assumption is justified for small catchments in which the average spatial distribution of rainfall will be roughly uniform this assumption may not hold for large e g continent scale watersheds modifications to the algorithm would be necessary to account for a non uniform spatial distribution of rainfall the controller placement algorithm is sensitive to the chosen ratio of hillslope to channel speeds ϕ care should be taken to select an appropriate value of ϕ based on site specific land cover and morphological characteristics more generally for situations in which differential land cover soil types and existing hydraulic infrastructure play a dominating role the performance of the algorithm may be enhanced by adjusting inter vertex travel times to correspond to estimated overland flow and channel velocities our assessment of the algorithm s performance rests on the assumption that installed control structures e g retention basins are large enough to capture upstream discharges the algorithm itself does not explicitly account for endogenous upstream flooding that could be introduced by installing new control sites in this study experiments were conducted only for impulsive rainfall inputs i e with a short duration of rainfall future work should assess the performance of the distance weighted controller placement strategy under arbitrary rainfall durations our analysis assumes that reservoirs are initially empty before each storm event while some previous studies in distributed reservoir operation contend that an initially empty condition is the simplest and most defensible approach goldman 2001 other studies use random initialization of reservoir depths to simulate the effect of successive storm events when reservoir operation rules are unknown ayalew et al 2013 while this latter approach may provide more realistic results under unknown reservoir operating conditions we ultimately use an initially empty condition due to the combinatorial difficulty of assessing the effect of random initial depths alongside varying numbers of controllers controller placement strategies and rainfall scenarios random initialization could potentially effect the results by inducing overflows under the volume capture scenario or by quickening the rising limb under the delayed release scenario additional work is needed to understand how these effects would impact the performance of the controller placement algorithm compared to randomized control trials with this in mind it should be noted that new smart water systems are enabling more flexible control of distributed stormwater infrastructure kerkez et al 2016 which may in turn strengthen the assumption of initially empty storage conditions bartos et al for instance present a real world case study in which real time analytics and control are used to pre emptively evacuate retention basins before a storm event reducing the magnitude of the downstream hydrologic response bartos et al 2018 because initially emptying storage basins often leads to a favorable hydrologic response wong 2017 assuming empty or near empty initial storage conditions may be more realistic than assuming random initial depths for systems with real time control capabilities this study focuses primarily on event based diagnostics of system performance specifically by measuring the flatness of the hydrologic response under independent storm events however it should be noted that water infrastructure may also be evaluated in terms of long term performance for instance by measuring the response of the system to an extended stochastic rainfall time series while not computationally feasible for the model used in this study future work should investigate the performance of the controller placement algorithm under extended hydrodynamic simulations more broadly future research should investigate the problem of sensor placement in stream networks using the theoretical framework developed in this paper while this study focuses on the problem of placement of hydraulic control structures our algorithm also suggests a solution to the problem of sensor placement stated probabilistically the geomorphological impulse unit hydrograph giuh represents the probability that a particle injected randomly within the watershed at time t 0 exits the outlet at time t t thus the peaks of the giuh correspond to the portions of the hydrologic response where there is the greatest amount of ambiguity about where a given particle originated it follows that the same locations that maximally de synchronize flows may also be the best locations for disambiguating the locations from which synchronous flows originated future experiments should investigate the ability to estimate upstream states e g flows within the network given an outlet discharge along with internal state observers e g flow sensors placed using the algorithm developed in this study 6 conclusions we develop an algorithm for placement of hydraulic control structures that maximally flattens the hydrologic response of drainage networks this algorithm uses the geomorphological impulse unit hydrograph to locate subcatchments that dominate the peaks of the hydrograph then partitions the drainage network to minimize the contribution of these subcatchments we find that the controller placement algorithm produces flatter hydrographs than randomized controller placement trials both in terms of peak discharge and overall variance by reducing the flashiness of the hydrologic response our controller placement algorithm may one day help to mitigate flash floods and restore urban water quality through reduction of contaminant loads and prevention of streambed erosion we find that the performance of the algorithm is enhanced when using a large number of small distributed controllers in addition to confirming the central hypothesis that synchronous cells can be identified based on network structure of drainage basins this result lends justification to the development of decentralized smart stormwater systems in which active control of small scale retention basins canals and culverts enables more effective management of urban stormwater overall our algorithm is efficient requires only digital elevation model data and is robust to parameter and model uncertainty making it suitable both as a research tool and as a design tool for practicing water resources engineers declarations of interest none data availability code and data links are available at https github com klabum hydraulic controller placement acknowledgments funding for this project was provided by the national science foundation grants 1639640 and 1442735 and the university of michigan we would like to thank alex ritchie for exploring alternative approaches to the controller placement problem and for his help with literature review we would also like to thank dr alfred hero for his advice in formulating the problem supplementary material supplementary material associated with this article can be found in the online version at doi 10 1016 j advwatres 2019 03 016 appendix a supplementary materials supplementary data s1 supplementary raw research data this is open data under the cc by license http creativecommons org licenses by 4 0 supplementary data s1 
673,riparian shrubs and trees present a complex seasonally variable morphology with flexible stems and leaves efficiently adapting to the flow forcing reconfiguration the aim of this paper is to investigate how foliage and reconfiguration affect the flow and mixing in a partly vegetated channel specific attention was placed on the velocity statistics onset and coherence of turbulent structures and lateral momentum transport at the horizontal interface between vegetation and open water the experimental flume arrangement was novel in that it allowed investigating the lateral shear layer induced by flexible riparian plants the natural like vegetation consisted of emergent woody plants and a grassy understory with density morphology and reconfiguration behavior comparable to those found in real riparian areas investigations were conducted under foliated and leafless conditions to determine the seasonality effects the mean and turbulent flow structure was determined with acoustic doppler velocimetry and dynamic plant motions were investigated from video footage the presence of foliage enhanced the drag discontinuity at the interface resulting in more pronounced velocity gradients between the vegetated and open areas compared to the leafless conditions foliation induced stronger shear layer scale mixing whereas under leafless conditions the local mixing induced by stems was more important the reconfiguration decreased the coherence of the two dimensional large scale vortices at the interface while their characteristic frequency was consistent with the canonical mixing layer theory our results indicated that shear layer dynamics in partly vegetated channels was influenced strongly by morphology and reconfiguration of complex plants with more efficient lateral momentum transport at the interface in the foliated conditions than previously reported for shear layers induced by simpler vegetation keywords vegetation reconfiguration water vegetation interface shear layer turbulent structures acoustic doppler velocimetry 1 introduction across a wide range of environmental settings vegetation communities occur along river margins partially obstructing the river cross section examples include vegetated channel banks floodplains and patches of aquatic vegetation that typically extend in elongated shape in the streamwise direction e g dupuis et al 2017 hu et al 2018 liu et al 2017 ortiz et al 2013 white and nepf 2008 the lateral interactions between these vegetated areas and the adjacent main channel deeply affect the hydrodynamic structure of the flow influencing the lateral exchange of mass and momentum across the river section ben meftah et al 2014 rowiński et al 2018 white and nepf 2008 the lateral exchange controls the efficiency of cross sectional mixing white and nepf 2008 governing the routing and ultimate fate of dissolved and particulate substances gacia and duarte 2001 hu et al 2010 in partly vegetated channels i e river channels presenting long lateral regions of finite width of emergent vegetation the different drag conditions between the lateral vegetated area and the main channel lead to the formation of two nearly parallel streams of different velocity the consequent typical streamwise velocity lateral distribution is characterized by an inflection point that gives rise to kelvin helmholtz kh type instability lesieur 1995 in order to effectively model velocity and other quantities of practical interest the flow in these systems has been generally considered as canonical mixing layer ml white and nepf 2008 or boundary layer ben meftah et al 2014 even though these flow types in aquatic ecosystems generally deviate from their canonical forms nikora et al 2012 it remains important to define which types are more suitable for describing the overall flow structure in the analysis of vegetated flows the vegetation characteristics should be adequately taken into account floodplain and riparian vegetation generally presents a complex morphology with highly heterogeneous vertical distributions of the structural and bio mechanical properties niklas 1997 weissteiner et al 2015 in response to the flow forcing leaves and branches assume a streamlined configuration undergoing a process called reconfiguration västilä and järvelä 2017 vogel 1994 which reduces the pressure drag and is expected to affect the overall flow structure additionally riparian vegetation experiences periodic morphological variability through foliation and leaf shedding and senescence lim et al 2007 łoboda et al 2018 driven by annual and seasonal variation in e g temperature light availability and precipitation e g laine 2015 and further influenced by fluvial and hydrologic processes e g naiman and decamps 1997 this variability markedly affects e g hydraulic resistance flow structure sediment transport and erosion cotton et al 2006 shih and rahi 1982 västilä et al 2016 the effects of complex plant morphology reconfiguration and seasonality on hydraulic resistance and hydrodynamic flow structure have been investigated in uniformly vegetated flows järvelä 2002 rowiński and kubrak 2002 rubol et al 2018 siniscalchi et al 2012 västilä and järvelä 2014 while are still poorly explored in partly vegetated flows where plants have been simulated as rigid cylinders ben meftah et al 2014 choi and kang 2006 naot et al 1996 tsujimoto and kitamura 1992 white and nepf 2008 rigid cylinders neglect a variety of flow influencing mechanisms exhibited by real vegetation ghisalberti and nepf 2006 such as the dynamic plant motions for instance the periodical waving such as the monami ackerman and okubo 1993 affects the vegetation drag coherent structures and the cross sectional exchange of mass and momentum ghisalberti and nepf 2006 a crucial aspect of the experimental investigation of obstructed flows is the representativeness of point velocity measurements owing to the high local heterogeneity of flow characteristics to address this spatial variability the flow characteristics are generally double averaged both temporally and spatially across the direction of homogeneity of the flow nikora et al 2013 2007 nikora and rowiński 2008 the applicability of this procedure depends on the measurement technique and the type of obstruction for macro bed roughness coscarella et al 2017 rigid cylinders nezu and sanjou 2008 poggi et al 2004 or simple vegetation models nepf and vivoni 2000 righetti and armanini 2002 this task has been accomplished for complex vegetative morphologies the spatial variability has been mostly neglected e g siniscalchi et al 2012 sukhodolov and sukhodolova 2012 in the present work with complex dynamically moving and dense vegetative obstruction representing foliated shrub like vegetation the double averaging was not technically possible since the highly porous plants fulfilled most of the flow domain so that the removal of a plant would have significantly influenced the flow instead the flow velocity was measured along two transects carefully positioned within the flow domain which was expected to provide a sufficiently representative description of the major flow features the goal of this paper is to characterize the effects of morphologically complex vegetation and its seasonal variability on the lateral mixing and turbulent flow pattern in a partly vegetated channel we explore the effects of foliation and reconfiguration on the overall flow structure lateral distributions of velocity statistics on large coherent turbulent structures presence and strength and on the efficiency of lateral momentum transport across the vegetated interface in order to increase the understanding of vegetated shear layer type flows with reference to real riparian vegetation the fully developed flow in a partly vegetated channel with natural like emergent plant stands was experimentally investigated by using acoustic doppler velocimetry techniques 2 materials and methods experiments were conducted in a partly vegetated flume with emergent flexible woody plants fig 1 to enhance the representativeness of natural conditions where low grasses typically grow beneath shrubs and trees the bed roughness of the vegetated area of the flume consisted of dense artificial grasses we investigated two different vegetative conditions grasses with emergent foliated vegetation f and grasses with emergent leafless vegetation l a third vegetative condition where only grasses were present g was also tested not described herein to evaluate the influence of the flexibility induced reconfiguration the lateral structure of the flow was determined at three flow rates low medium and high resulting in altogether nine test runs all runs were conducted under uniform flow conditions in a spatially averaged sense with the water depth h of 0 17 m the experimental conditions are described in detail in sections 2 1 and 2 2 2 1 experimental facility experiments were carried out in a 20 m long 0 6 m wide and 0 8 m deep tilting glass walled recirculating flume in the environmental hydraulics lab of aalto university the flume bottom from x 4 m to x 14 m was covered with a 600 mm wide and 20 mm thick pvc base plate in which vegetation elements were installed in 2 5 mm diameter holes the x y and z axes of the coordinate system fig 1a refer to the longitudinal lateral and vertical normal to the flume bottom directions respectively the coordinate system origin was defined as x 0 at the inlet cross section positive downstream y 0 at the edge of the grassy bed see fig 1a and positive toward the unvegetated part of the channel and z 0 at the top of the pvc base plate and positive upwards in this right handed cartesian coordinate system velocity components were denoted as u v and w in the x y and z directions the flow into the experimental facility was driven and recirculated with a centrifugal pumping system the pumps were connected to the flume inlet via a hose ensuring the vibration isolation of the experimental section after entering the flume via a limited capacity reservoir with a dissipation plate the water flowed through a flow straightener which reduced inlet related turbulence and possible flow surface instabilities the discharge was measured with a magnetic flow meter accuracy 0 5 and recorded at 80 hz for the entire duration of the tests the free surface elevation along the partly vegetated reach was measured at 80 hz with 6 pressure transducers accuracy 3 mm tapped at the centerline of the flume at x 5 6 5 8 9 5 11 5 and 13 m respectively the bed slope of the flume and the position of a downstream tailgate were adjusted to achieve the desired spatially averaged uniform flow conditions the plants were just submerged at all runs with a negligible change in the submerged leaf area at different flow rates 2 2 vegetation setting and test runs approximately 40 of the flume bottom was covered by an array of emergent artificial plants fig 1a the modular vegetation elements were built starting from two different types of stems 205 and 270 mm tall with 3 mm average diameter and leaf clusters each made of 4 opposite aristate like leaves with entire margin connected to a short petiole stems were made of a steel wire coated with polyethylene presenting short lateral branches to which leaf clusters could be attached leaves were made of polyester fabric and were connected to short polyethylene petioles fig 1b the selected natural like plants had a reconfiguration behavior representative of natural riparian shrubs see section 3 1 e g västilä and järvelä 2014 and they allowed reproducing the central effects of the spatial morphologic variability of vegetation on the flow structure defina and bixio 2005 nepf and vivoni 2000 because a nearly uniform vertical distribution of longitudinal mean velocity is typically observed within vegetation kubrak et al 2008 liu et al 2008 we aimed to achieve as close to a uniform vertical distribution of the leaf area as possible at all flows considering that the orientation of leaves varied at each investigated flow velocity therefore by using the two different stems and modifying the number of leaf clusters 4 5 four different plant prototypes were designed two plants shown in fig 1b specifically a 0 5 m long repetitive pattern composed of the four different plants was used in the 10 m long vegetated section fig 1a the bed from y 0 to y 230 mm fig 1a was covered by a 20 mm tall artificial grass lining mimicking natural near bed conditions the dense bed grasses had a frontal area per canopy volume of 500 m 1 and exhibited a moderately flexible behavior remaining fairly erect during the tests the plants fig 1b were arranged in a staggered pattern with a longitudinal sx and lateral sy spacing of 250 and 125 mm respectively the number of stems per m2 of the total grass covered bed area n was equal to 35 taking into account both the main stem and the side twigs the characteristic diameter d of the non foliated plants was approximately equal to 3 8 mm and the solid volume fraction ϕ πd 2 n 4 to 0 039 the bulk one sided leaf area per unit volume al and the frontal projected area of the stems per unit volume as d sxsy equaled 4 1 and 0 13 m 1 respectively falling to the range of as 0 01 0 13 m 1 observed for natural riparian shrubs and bushes zinke 2011 but regarded as very sparse vegetation by nepf 2012a the leaf area to stem area ratio al as västilä et al 2013 was 31 comparable to those of common woody riparian species västilä and järvelä 2014 investigations were conducted in the foliated condition runs f1 f3 in the leafless condition by detaching the leaves l1 l3 and with the grassy bed only g1 g3 table 1 in order to compare the different test runs in terms of vegetative drag we evaluated the drag density parameter cda table 1 the product between the vegetation drag coefficient cd and the total vegetative reference area per unit canopy volume a nepf 2012a cda was estimated from the data for the region of the flow where the influence of the lateral shear layer was negligible i e where the lateral reynolds stress decayed to 10 of its maximum value see fig 5 in section 3 1 nepf 2012b thus as in white and nepf 2008 we assumed the equilibrium between the vegetative drag and the pressure gradient and neglected the contribution of turbulence stress 1 1 2 c d a u 1 2 g i where cda is the drag density parameter u 1 the velocity within the vegetated area g the gravitational acceleration and i the bed slope the momentum balance in the interface region experiencing high turbulent stresses is more complex vermaas et al 2011 because of the potential secondary currents and the laterally varying vegetative drag depending on the local velocity field and is beyond the scope of this work 2 3 determination of flow structure the flow in the partly vegetated channel was investigated along two lateral transects by measuring instantaneous three dimensional velocity components with acoustic doppler velocimetry velocity point data were measured at 200 hz with an acoustic doppler velocimeter adv nortek vectrino with a 4 beam side looking probe to the accuracy of 1 the sampling volume was 7 mm long with a 6 mm diameter 198 mm3 and the lowest appropriate velocity range of the instrument was selected depending on the flow characteristics mean velocity and turbulence intensity the flow was constantly seeded with solid glass micro spheres average particles diameter of 7 10 µm in order to achieve and maintain good signal to noise scores for the entire duration of the tests a recording time of 120 s 24 000 samples was found sufficient to achieve statistically time independent averaged velocity and turbulence parameters the adv raw data were pre filtered discarding the values with signal to noise ratio and correlation lower than 15 db and 70 respectively and despiked with the velocity signal analyser software v1 5 64 jesson et al 2015 the modified phase space thresholding method parsheh et al 2010 with c 1 c 2 1 48 parsheh et al 2010 wahl 2003 and the standard deviation as characteristic scalar were adopted based on the analyses of the effects of the software available spike replacement methods on the velocity statistics and spectral analysis the last good value method was selected as also recommended by jesson et al 2013 the overall average percentage of good data was greater than 95 based on pre tests measuring vertical velocity distributions z h 0 6 was selected as the most representative measurement elevation for the depth averaged velocity differently from studies with rigid cylinders e g white and nepf 2008 the within vegetation vertical profiles of longitudinal velocity exhibited a much higher variability caused by the complex velocity dependent streamlining and reconfiguration of the foliage as also reported by kubrak et al 2008 we observed an up to 23 difference between the mid depth longitudinal velocity and the depth averaged velocity to obtain a representative description of the flow within the heterogeneous vegetation arrangement two transects were measured between x 11 and 12 m 7 8 m downstream of the leading edge of the vegetation where the flow was fully developed based on pre tests the exact longitudinal location of the transects was selected aiming at obtaining high quality adv data under all the examined conditions by ensuring that the dynamically moving parts of the plants did not enter the path of the acoustic beam of the adv and that no plant parts had to be removed during the measurements to ensure that the flow properties at different lateral positions could be directly compared the transects were measured at the same relative position with respect to the stems approximately 40 mm upstream and 210 mm downstream to the closest plant fig 2 a owing to the obstruction provided by the foliated plants each transect was composed of two segments one covering the vegetated area from y 230 to y 130 mm and another shifted 125 mm upstream covering the remaining part of the cross section the transects were separated by a distance of 125 mm and 250 mm in the leafless and foliated runs respectively the lateral spacing of the measurement points ranged from 5 to 20 mm with a denser spacing placed at the interface where strong gradients in mean velocity and reynolds stress were observed the velocity statistics were obtained by averaging between the two transects 2 4 characterization of the dynamic plant motions organized plant motions caused by the downstream advection of large scale coherent structures were observed and video recorded for the foliated vegetation test runs owing to the local velocity field different reconfiguration behavior and dynamic motion were observed for the plants standing at the two lateral positions within the shear layer nevertheless we focused on the plants nearest to the main channel that experienced the strongest dynamic motions and the outermost elements which defined the position of the main channel vegetation interface the location of the interface y 0 was determined as the temporally and spatially averaged position of the outer edge of 3 5 well visible plants in the 1 m long measurement section from 25 s video recordings at 25 hz using the software tracker 5 0 video analysis and modeling tool fig 3 the amplitude of the lateral displacement table 2 was estimated similarly to the monami effect in submerged canopies ghisalberti and nepf 2002 further we obtained the frequency fv of the lateral motions and its standard deviation σ f v table 2 for the leafless vegetation runs with quasi rigid behavior the position of the interface was assumed to coincide with the edge of the grassy bed at y 0 mm this location was adopted as a reference position for the analysis of interfacial coherent structures and the general turbulence pattern of the flow in both the vegetative conditions 2 5 theoretical framework for flow structure investigation 2 5 1 mixing layer characteristic parameters and coherent structure scaling in the shear layer generated in partly vegetated channels the ambient velocity within the vegetation is referred to by u 1 and that in the main channel by u 2 with u 1 u 2 ben meftah et al 2014 white and nepf 2008 leaning on the theory of canonical plane ml pope 2000 the flow depends on two characteristic velocities 1 the convection velocity uc u 1 u 2 2 and 2 the velocity difference or differential velocity δu u 2 u 1 a third fundamental parameter which controls the spatially growing characteristic of the plane ml brown and roshko 1974 is represented by the normalized differential velocity or velocity ratio λ u 2 u 1 u 1 u 2 δu 2uc which measures the relative magnitude of the total shear compared to the convection velocity ho and huerre 1984 a characteristic length scale is represented by the ml width δ defined as the cross flow distance between positions where velocity reaches the 90 of the ambient flow value in the current study the momentum thickness θ was also adopted 2 θ 1 4 u y u c δ u 2 d y we evaluated θ by integrating between the lateral positions where u attained the ambient values u 1 and u 2 in the main channel the velocity approached an approximately constant value u 2 for all the tests u 1 was evaluated laterally averaging within the vegetated area considering that for leafless l and highly reconfigured vegetation f3 the velocity did not reach a constant value due to the local effects of the stems because of the inflection point in the velocity profile canonical mls are characterized by the formation of large coherent vortices resulting from a kh type instability these coherent structures strongly enhance the lateral transport of momentum and mass and are generated with a characteristic frequency fml corresponding to strouhal number st equal to 0 032 ho and huerre 1984 3 s t f m l θ u c 0 032 in contrast to plane mls vegetated shear layers attain stabilization at a certain distance from the origin of the layer because of the equilibrium between the production of shear layer scale turbulent kinetic energy and its dissipation within the canopy ghisalberti and nepf 2004 sukhodolova and sukhodolov 2012 moreover the stabilization is also controlled by the vertical and lateral confinement of the flow produced by the channel walls and the free surface together with the bed friction chu and babarutsi 1988 uijttewaal and booij 2000 considering the shear layer around a finite size patch of submerged filamentous flexible blades of sagittaria sagittifolia sukhodolov and sukhodolova 2012 proposed a scaling for the frequency of the coherent structures 4 f s u c δ s 2 u c c f δ u 1 3 where cf represents a bulk friction factor evaluated using the turbulent shear stress at the centerline of the shear layer and the convective velocity τ c 0 5ρcfuc 2 the ml width δ s in eq 4 must be evaluated as 2δu du dy max therefore differing from the shear layer width definition adopted in this study eq 4 was derived assuming the validity of the taylor s hypothesis of frozen turbulence with the assumption of local equilibrium between dissipation and mean turbulence production 2 5 2 selected turbulent statistics and spectral analysis the general description of the turbulent flow structure is based on temporally averaged velocity statistics with the lateral distributions computed by averaging between the two investigated transects to address the spatial variability of flow characteristics due to the heterogeneity of the vegetation the mean longitudinal velocity u the lateral longitudinal fluctuating velocities covariance covuv and the root mean square of the fluctuating velocity in the x and y directions urms and vrms respectively were evaluated furthermore the skewness of the longitudinal and lateral fluctuating velocity sku and skv respectively and the pearson correlation coefficient ruv between the longitudinal and lateral fluctuating velocities were considered spectral analysis was employed to detect coherent turbulent structures using the welch s method for the estimation of the power spectral density sii of the i th fluctuating velocity component ui t for quantifying the coherence of the large scale interfacial turbulent structures the autocorrelation function rii u i t u i t τ u i u i of ui t and the corresponding integral eulerian time scale ti 0 τ 0 r i i τ d τ were computed ti was evaluated by integrating rii τ up to τ0 the value of time lag τ corresponding to the first minimum of rii τ o neill et al 2004 tritton 1991 3 results and discussion 3 1 general description of the flow lateral distributions of spatially averaged mean longitudinal velocity fig 4 of both the foliated f and leafless l test runs exhibited a characteristic ml profile with an inflection point at the interface where the horizontal reynolds stress reached the maximum fig 5 owing to the different drag exerted by foliated and leafless vegetation table 1 the f cases presented higher velocity ratios λ for the f test runs λ varied with the flow rate table 1 as a result of the 11 5 m 1 96 decrease in the vegetative drag cda from f1 to f3 induced by the reconfiguration by contrast λ was independent of the flow rate for the quasi rigid leafless stems l for which cda decreased by only 0 25 m 1 from l1 to l3 the velocity ratio plays a key role in the shear layer dynamics setting the condition for the onset of large scale coherent structures as observed in shear layers in compound channels dupuis et al 2017 the local deceleration fig 4 and the change in the sign of the reynolds stress close to the location of the leafless stems fig 5 indicated that the leafless vegetation had a marked local effect on the flow the leafy vegetation introduced a global effect on the flow affecting the profile all over the vegetated area the effect being more pronounced as the drag density parameter increased for the foliated runs f1 and f2 the maximum shear was located in the vegetated area of the flow only for the high flow rate f3 for which strong reconfiguration was observed the maximum was located on the main channel side of the mean lateral position of the interface the lateral distribution of the root mean square value urms and vrms of the fluctuating velocity in the x and y direction provide information on the turbulence intensities shown in fig 6 normalized with the differential velocity δu all the profiles presented a peak in the interfacial region located at the grass edge y 0 mm for the leafless conditions and on the vegetated side of the main channel vegetation interface for the foliated conditions for the f runs the turbulence intensity was observed to decrease slightly asymmetrically toward the main channel and with relatively stronger gradients within the vegetation these observations are consistent with the turbulence intensity pattern observed for vertical shear layers induced by submerged vegetation ghisalberti and nepf 2006 nepf and vivoni 2000 nezu and sanjou 2008 for the leafless cases the additional peak in the turbulent intensity at y 55 mm coincides with the lateral position of stems the lateral distributions of skewness of the longitudinal sku and lateral skv fluctuating velocity were almost symmetric about the x axis for the f1 test case fig 7 a with increasing flow rate and vegetation reconfiguration the distributions resulted to be progressively less symmetric fig 7b c two different regions were clearly distinguishable a sweep dominated region where sku 0 and skv 0 on the vegetated side of the interface and an ejection dominated region on the other side where sku 0 and skv 0 the lateral position where the skewness changed sign coincided for sku and skv but was variable between the 3 foliated test cases and only for the high flow rate case where vegetation exhibited strong reconfiguration the point was located on the main channel side of y 0 stronger sku values within the vegetated area were observed for the f1 case and progressively decreased with decreasing cda this observation is consistent with the results of nezu and sanjou 2008 and poggi et al 2004 who investigated the effects of density on vertical vegetated shear layers observing higher skewness for canopy with higher density reconfiguration induced drag reduction in analogy with stem density reduction affected and limited the interactions across the interface for leafless cases for which only little reconfiguration was observed see table 1 no notable differences were visible in the lateral distribution of skewness between the three flow rates also for the l runs it was possible to identify the sweep and ejection dominated regions but differently from the leafy vegetation case the lateral position where the skewness sign changed coincided always with the edge of the grassy bed analogous occurrence was observed for strongly reconfigured vegetation f3 this circumstance suggests a prevalent role of the lateral bed roughness discontinuity in the shear layer dynamics both for leafless vegetation and strongly reconfigured foliated vegetation indeed lateral heterogeneity of bed roughness can generate strong shear layers vermaas et al 2011 as observed from the lateral distributions of figs 5 7 as the foliated vegetation progressively reconfigured with the increasing u 1 velocity the lateral distributions of velocity statistics tended to resemble those of leafless vegetation because of the decreasing cda value the global effects of the vegetation on the flow decreased and the local effect of each plant became increasingly important overall the variability of flow statistics between the two investigated transects was observed to progressively decrease with increasing flow rate figs 5 7 this can be reasonably explained by the reconfiguration of foliated vegetation and the drag density parameter for higher cda the flow had to adapt to the blockage conditions locally faced by the current conversely with streamlined plants the flow is channelized in the gaps defined by the reconfigured morphology of the vegetation in the leafless vegetation scenario only the local variability due to the presence of the stems was observed 3 2 coherent structures at the interface this section focuses on the large scale coherent structures occurring in the interface region generated by the drag discontinuity between the vegetated area and the adjacent main channel specifically the results discussed herein were derived from the upstream transect where not stated otherwise since no significant local between transect variability was observed in the coherent structures characteristics the foliated cases showed coherent quasi periodic fluctuations of the longitudinal and lateral velocity fig 8 a manifestation of the passage of large coherent structures the u and v velocity fluctuations were in opposite phase and contributed preponderantly to the overall reynolds stress with strong sweep u 0 v 0 and ejection events u 0 v 0 such a clear periodic signature of the velocity fluctuations was not observed for the leafless cases these differences are explained by the changes in the differential velocity generated by the presence of the foliage and reconfiguration table 3 the autocorrelation functions revealed that the turbulent structures of the foliated test cases were coherent over a much longer duration than those of leafless cases fig 9 as confirmed by the integral time scales table 3 with increasing flow rate the progressive loss of coherence with reconfiguration was accompanied with increasing ml re θ δuθ ν with ν being the kinematic viscosity and main channel reh u 2 h ν characteristic reynolds number increasing turbulence has been associated with the growth of three dimensional instabilities and the formation of small scale structures in analogous flows dominated by kh type instabilities rahmani et al 2014 the progressive loss of coherence with increasing flow rate for foliated vegetation and the corresponding λ and cda reduction can be considered ascribable also to the dynamic lateral motion of the vegetation interface the lateral plant motion described in section 2 4 induced instantaneously variable interface drag conditions that can strain the vortex structure and induce a loss of coherence this circumstance firstly addressed by ghisalberti and nepf 2006 considering the flow over rigid and flexible submerged vegetation is evident looking at the progressively increasing amplitude of the lateral motion of the plants and the instantaneous position of the outermost plant elements fig 3 the quantity vrms δu fig 6 interpretable as the relative speed of vortex rotation ghisalberti and nepf 2006 can provide an indirect measurement of the coherence of the interfacial large scale structures among the f cases a higher vrms δu at the interface was observed 0 17 for the f1 case where the amplitude of lateral plant motion was less pronounced 46 mm and the plant motion was observed to be more organized for the f2 and f3 cases for which the amplitudes reached 70 and 78 mm respectively lower values of vrms δu were observed 0 12 maximum values of the turbulence intensity found for rigid and flexible submerged vegetation were 0 15 and 0 11 respectively ghisalberti and nepf 2006 this suggests that the lateral motion caused by the presence of foliage and its complex distribution along the plant stands strongly affects the interface large scale structures coherence with implications on the lateral transport of momentum 3 3 velocity spectra spectra of the lateral velocity component at the interface y 0 mm revealed the presence of large scale coherent structures in all the foliated test cases visible as a clear peak in the power spectral density located in the energy containing range of frequencies fig 10 at the high frequency side of the peaks a slope of approximately 3 was observed indicating that the coherent structures were largely two dimensional proust et al 2017 uijttewaal and booij 2000 the concentration of energy at the frequency of the 2d vortices was observed all along the cross section with a progressively decreasing energy content moving away from the interfacial region not shown moreover a peak was observed at the same frequency in the u v cross spectra not shown proving that the detected coherent structures were responsible for the lateral momentum transport across the vegetation main channel interface in the leafless test cases even though an increased energy content at the strouhal numbers corresponding to the ml structures frequencies was registered the relative magnitude of the energy associated to this mode was notably lower kh vortices were present only in the foliated runs characterized by differential velocity ratio λ 0 3 table 1 according to dupuis et al 2017 and proust et al 2017 based on studies on ml in compound channels λ 0 3 represents the condition for the onset of kh coherent structures corresponding to the increase of the bulk flow velocity from f1 to f3 table 3 the progressive reconfiguration of vegetation produced a decreasing differential velocity ratio resulting in a loss of coherence of the interfacial structures as the vegetation progressively reconfigures the favorable conditions for the onset of kh structures can disappear with direct implications on the efficiency of the lateral mixing the blockage provided by the leafless vegetation was not sufficient for establishing favorable conditions to the onset of kh vortices moreover the differential velocity ratio did not depend on the flow condition for such non reconfiguring plants the density of the stems clearly plays the most important role on the shear layer characteristics white and nepf 2007 table 4 reports the frequency of the large coherent 2d structures f its standard deviation σ f over the shear layer the predictions of the scaling of eqs 3 and 4 and the frequency of the lateral plant motions fv the frequency deduced from the spectra was spatially averaged over the main channel shear layer width between y 0 and 270 mm and between the two transects congruently to the estimation of eqs 3 and 4 based on the temporal and spatial mean quantities of table 1 the peak frequency f of the lateral velocity spectra the predicted kh frequency fml and the observed frequency of vegetation lateral movement fv were in good agreement within the 17 of f while the fs values presented higher difference in respect to f up to 72 due to the high turbulence intensities the assumptions based on which fs in eq 4 is derived were not strictly satisfied for our case in addition eq 4 is referred to the vertical shear layer generated by submerged blade like vegetation in contrast to the horizontal shear layer of the present study generated by complex morphology emergent vegetation overall the variability of frequency of plant motion increased with the flow rate table 4 as observed during the tests when the frequency of the vortex shedding was higher the plant stands were not able to adapt quickly to the rapidly changing flow conditions resulting in a less organized motion moreover due to the variability of plant stands morphology along the elevation asynchronous motion was observed for the parts of the same plant stand 3 4 momentum transport across the interface to quantify the efficiency of the turbulent lateral transport of streamwise momentum and to explore the location size and strength of the detected interfacial vortices the lateral distributions of the pearson correlation coefficient between the lateral and longitudinal velocity ruv were evaluated fig 11 foliated cases presented a clear peak in ruv in the interfacial region while it remained highly stable across the interface for the leafless cases with the maximum value at the main channel side of the interface and additional peaks at the lateral position of stems these differences highlight the effects of foliation on the flow in the f cases large highly coherent turbulent structures were detected at the interface and correspondingly the efficiency of the lateral transport of streamwise momentum was observed to be notably higher while the leafless vegetation induced strong local mixing that was of the same order than the shear layer scale mixing the penetration of the coherent structures into the vegetation depended on the reconfiguration the highest lateral mixing efficiency was observed on the vegetated side of the interface y 0 for the f1 and f2 cases but in the main channel side for f3 the observed maximum values of the correlation between longitudinal and lateral velocities ruv 0 6 for foliated and 0 4 for leafless conditions suggest a stronger mixing for partly vegetated channels with complex foliated plants stands in comparison to analogous flows with simpler vegetation configurations values of 0 5 have been observed for terrestrial canopies raupach et al 1996 and aquatic flexible stripe like submerged canopies ghisalberti and nepf 2002 in boundary layer flows and canonical mls typical values of ruv are 0 32 and 0 44 respectively ghisalberti and nepf 2002 4 concluding remarks the experimental arrangement was novel in that the vegetation setup artificial flexible woody plants with grassy bed roughness and densities volumetric leaf area al 4 m 1 volumetric stem area as 0 13 m 1 closely represented conditions found along natural river margins in the partly vegetated channel different foliage and flow forcing conditions profoundly affected the flow characteristics at the interface between the vegetation and the main channel as summarized in fig 12 the presence of leaves markedly influenced the flow distribution resulting in higher velocity difference λ between the open and vegetated parts of the cross section in the leafless stage representing winter a vegetation exhibited a quasi rigid behavior analogous to rigid cylinders in this condition the bed roughness heterogeneity between the vegetated area and the open water played a major role in the lateral shear layer and was coupled with the local scale mixing induced by the stems for the foliated vegetation b and c in fig 12 the flow was dominated by large scale coherent interfacial structures which governed and enhanced the lateral interaction between the vegetated and unvegetated areas of the channel in addition the presence and reconfiguration of foliage induced major seasonal differences in flow paths within vegetation blue arrows in fig 12 the results underlined that complex shrub like vegetation undergoes drag reduction caused by both the seasonal shedding of leaves and the reconfiguration of plants with increasing hydrodynamic forcing increasing mean flow velocity from b to c in fig 12 this marked drag reduction the drag density parameter cda varied at 0 5 12 m 1 and at 0 18 0 4 m 1 for foliated and leafless vegetation respectively was associated with less strong and coherent interfacial shear layer scale structures resulting in notably lower lateral transport of longitudinal momentum fig 11 for leafless a compared to the foliated cases b and c the dominant frequency of the large coherent structures matched the lateral dynamic motions of the plants these frequencies were consistent with the canonical ml scaling with the applicability of the classical strouhal number st 0 032 indicating that they can be reliably predicted from the basic flow characteristics for dynamically moving natural like shrubs and bushes eq 3 overall the presence of leaves enhanced mixing at the shear layer scale in contrast to the local scale effects induced by the leafless plants therefore realistic representation of the seasonal variability and reconfiguration of vegetation is expected to improve the modeling of mass and momentum transport in partly vegetated channels acknowledgments this work was carried out while the first author was visiting the environmental hydraulics lab at the aalto university the authors would like to thank the technician antti louhio for his help in arranging the experiments the first author gratefully thanks prof paola gualtieri for her support and for providing useful comments and suggestions the second and third authors gratefully acknowledge the funding from maa ja vesitekniikan tuki ry grant no 33271 and maj and tor nessling foundation grant no 201800045 the fourth author gratefully acknowledges the funding from statutory activities no 3841 e 41 s 2018 of the ministry of science and higher education of poland 
673,riparian shrubs and trees present a complex seasonally variable morphology with flexible stems and leaves efficiently adapting to the flow forcing reconfiguration the aim of this paper is to investigate how foliage and reconfiguration affect the flow and mixing in a partly vegetated channel specific attention was placed on the velocity statistics onset and coherence of turbulent structures and lateral momentum transport at the horizontal interface between vegetation and open water the experimental flume arrangement was novel in that it allowed investigating the lateral shear layer induced by flexible riparian plants the natural like vegetation consisted of emergent woody plants and a grassy understory with density morphology and reconfiguration behavior comparable to those found in real riparian areas investigations were conducted under foliated and leafless conditions to determine the seasonality effects the mean and turbulent flow structure was determined with acoustic doppler velocimetry and dynamic plant motions were investigated from video footage the presence of foliage enhanced the drag discontinuity at the interface resulting in more pronounced velocity gradients between the vegetated and open areas compared to the leafless conditions foliation induced stronger shear layer scale mixing whereas under leafless conditions the local mixing induced by stems was more important the reconfiguration decreased the coherence of the two dimensional large scale vortices at the interface while their characteristic frequency was consistent with the canonical mixing layer theory our results indicated that shear layer dynamics in partly vegetated channels was influenced strongly by morphology and reconfiguration of complex plants with more efficient lateral momentum transport at the interface in the foliated conditions than previously reported for shear layers induced by simpler vegetation keywords vegetation reconfiguration water vegetation interface shear layer turbulent structures acoustic doppler velocimetry 1 introduction across a wide range of environmental settings vegetation communities occur along river margins partially obstructing the river cross section examples include vegetated channel banks floodplains and patches of aquatic vegetation that typically extend in elongated shape in the streamwise direction e g dupuis et al 2017 hu et al 2018 liu et al 2017 ortiz et al 2013 white and nepf 2008 the lateral interactions between these vegetated areas and the adjacent main channel deeply affect the hydrodynamic structure of the flow influencing the lateral exchange of mass and momentum across the river section ben meftah et al 2014 rowiński et al 2018 white and nepf 2008 the lateral exchange controls the efficiency of cross sectional mixing white and nepf 2008 governing the routing and ultimate fate of dissolved and particulate substances gacia and duarte 2001 hu et al 2010 in partly vegetated channels i e river channels presenting long lateral regions of finite width of emergent vegetation the different drag conditions between the lateral vegetated area and the main channel lead to the formation of two nearly parallel streams of different velocity the consequent typical streamwise velocity lateral distribution is characterized by an inflection point that gives rise to kelvin helmholtz kh type instability lesieur 1995 in order to effectively model velocity and other quantities of practical interest the flow in these systems has been generally considered as canonical mixing layer ml white and nepf 2008 or boundary layer ben meftah et al 2014 even though these flow types in aquatic ecosystems generally deviate from their canonical forms nikora et al 2012 it remains important to define which types are more suitable for describing the overall flow structure in the analysis of vegetated flows the vegetation characteristics should be adequately taken into account floodplain and riparian vegetation generally presents a complex morphology with highly heterogeneous vertical distributions of the structural and bio mechanical properties niklas 1997 weissteiner et al 2015 in response to the flow forcing leaves and branches assume a streamlined configuration undergoing a process called reconfiguration västilä and järvelä 2017 vogel 1994 which reduces the pressure drag and is expected to affect the overall flow structure additionally riparian vegetation experiences periodic morphological variability through foliation and leaf shedding and senescence lim et al 2007 łoboda et al 2018 driven by annual and seasonal variation in e g temperature light availability and precipitation e g laine 2015 and further influenced by fluvial and hydrologic processes e g naiman and decamps 1997 this variability markedly affects e g hydraulic resistance flow structure sediment transport and erosion cotton et al 2006 shih and rahi 1982 västilä et al 2016 the effects of complex plant morphology reconfiguration and seasonality on hydraulic resistance and hydrodynamic flow structure have been investigated in uniformly vegetated flows järvelä 2002 rowiński and kubrak 2002 rubol et al 2018 siniscalchi et al 2012 västilä and järvelä 2014 while are still poorly explored in partly vegetated flows where plants have been simulated as rigid cylinders ben meftah et al 2014 choi and kang 2006 naot et al 1996 tsujimoto and kitamura 1992 white and nepf 2008 rigid cylinders neglect a variety of flow influencing mechanisms exhibited by real vegetation ghisalberti and nepf 2006 such as the dynamic plant motions for instance the periodical waving such as the monami ackerman and okubo 1993 affects the vegetation drag coherent structures and the cross sectional exchange of mass and momentum ghisalberti and nepf 2006 a crucial aspect of the experimental investigation of obstructed flows is the representativeness of point velocity measurements owing to the high local heterogeneity of flow characteristics to address this spatial variability the flow characteristics are generally double averaged both temporally and spatially across the direction of homogeneity of the flow nikora et al 2013 2007 nikora and rowiński 2008 the applicability of this procedure depends on the measurement technique and the type of obstruction for macro bed roughness coscarella et al 2017 rigid cylinders nezu and sanjou 2008 poggi et al 2004 or simple vegetation models nepf and vivoni 2000 righetti and armanini 2002 this task has been accomplished for complex vegetative morphologies the spatial variability has been mostly neglected e g siniscalchi et al 2012 sukhodolov and sukhodolova 2012 in the present work with complex dynamically moving and dense vegetative obstruction representing foliated shrub like vegetation the double averaging was not technically possible since the highly porous plants fulfilled most of the flow domain so that the removal of a plant would have significantly influenced the flow instead the flow velocity was measured along two transects carefully positioned within the flow domain which was expected to provide a sufficiently representative description of the major flow features the goal of this paper is to characterize the effects of morphologically complex vegetation and its seasonal variability on the lateral mixing and turbulent flow pattern in a partly vegetated channel we explore the effects of foliation and reconfiguration on the overall flow structure lateral distributions of velocity statistics on large coherent turbulent structures presence and strength and on the efficiency of lateral momentum transport across the vegetated interface in order to increase the understanding of vegetated shear layer type flows with reference to real riparian vegetation the fully developed flow in a partly vegetated channel with natural like emergent plant stands was experimentally investigated by using acoustic doppler velocimetry techniques 2 materials and methods experiments were conducted in a partly vegetated flume with emergent flexible woody plants fig 1 to enhance the representativeness of natural conditions where low grasses typically grow beneath shrubs and trees the bed roughness of the vegetated area of the flume consisted of dense artificial grasses we investigated two different vegetative conditions grasses with emergent foliated vegetation f and grasses with emergent leafless vegetation l a third vegetative condition where only grasses were present g was also tested not described herein to evaluate the influence of the flexibility induced reconfiguration the lateral structure of the flow was determined at three flow rates low medium and high resulting in altogether nine test runs all runs were conducted under uniform flow conditions in a spatially averaged sense with the water depth h of 0 17 m the experimental conditions are described in detail in sections 2 1 and 2 2 2 1 experimental facility experiments were carried out in a 20 m long 0 6 m wide and 0 8 m deep tilting glass walled recirculating flume in the environmental hydraulics lab of aalto university the flume bottom from x 4 m to x 14 m was covered with a 600 mm wide and 20 mm thick pvc base plate in which vegetation elements were installed in 2 5 mm diameter holes the x y and z axes of the coordinate system fig 1a refer to the longitudinal lateral and vertical normal to the flume bottom directions respectively the coordinate system origin was defined as x 0 at the inlet cross section positive downstream y 0 at the edge of the grassy bed see fig 1a and positive toward the unvegetated part of the channel and z 0 at the top of the pvc base plate and positive upwards in this right handed cartesian coordinate system velocity components were denoted as u v and w in the x y and z directions the flow into the experimental facility was driven and recirculated with a centrifugal pumping system the pumps were connected to the flume inlet via a hose ensuring the vibration isolation of the experimental section after entering the flume via a limited capacity reservoir with a dissipation plate the water flowed through a flow straightener which reduced inlet related turbulence and possible flow surface instabilities the discharge was measured with a magnetic flow meter accuracy 0 5 and recorded at 80 hz for the entire duration of the tests the free surface elevation along the partly vegetated reach was measured at 80 hz with 6 pressure transducers accuracy 3 mm tapped at the centerline of the flume at x 5 6 5 8 9 5 11 5 and 13 m respectively the bed slope of the flume and the position of a downstream tailgate were adjusted to achieve the desired spatially averaged uniform flow conditions the plants were just submerged at all runs with a negligible change in the submerged leaf area at different flow rates 2 2 vegetation setting and test runs approximately 40 of the flume bottom was covered by an array of emergent artificial plants fig 1a the modular vegetation elements were built starting from two different types of stems 205 and 270 mm tall with 3 mm average diameter and leaf clusters each made of 4 opposite aristate like leaves with entire margin connected to a short petiole stems were made of a steel wire coated with polyethylene presenting short lateral branches to which leaf clusters could be attached leaves were made of polyester fabric and were connected to short polyethylene petioles fig 1b the selected natural like plants had a reconfiguration behavior representative of natural riparian shrubs see section 3 1 e g västilä and järvelä 2014 and they allowed reproducing the central effects of the spatial morphologic variability of vegetation on the flow structure defina and bixio 2005 nepf and vivoni 2000 because a nearly uniform vertical distribution of longitudinal mean velocity is typically observed within vegetation kubrak et al 2008 liu et al 2008 we aimed to achieve as close to a uniform vertical distribution of the leaf area as possible at all flows considering that the orientation of leaves varied at each investigated flow velocity therefore by using the two different stems and modifying the number of leaf clusters 4 5 four different plant prototypes were designed two plants shown in fig 1b specifically a 0 5 m long repetitive pattern composed of the four different plants was used in the 10 m long vegetated section fig 1a the bed from y 0 to y 230 mm fig 1a was covered by a 20 mm tall artificial grass lining mimicking natural near bed conditions the dense bed grasses had a frontal area per canopy volume of 500 m 1 and exhibited a moderately flexible behavior remaining fairly erect during the tests the plants fig 1b were arranged in a staggered pattern with a longitudinal sx and lateral sy spacing of 250 and 125 mm respectively the number of stems per m2 of the total grass covered bed area n was equal to 35 taking into account both the main stem and the side twigs the characteristic diameter d of the non foliated plants was approximately equal to 3 8 mm and the solid volume fraction ϕ πd 2 n 4 to 0 039 the bulk one sided leaf area per unit volume al and the frontal projected area of the stems per unit volume as d sxsy equaled 4 1 and 0 13 m 1 respectively falling to the range of as 0 01 0 13 m 1 observed for natural riparian shrubs and bushes zinke 2011 but regarded as very sparse vegetation by nepf 2012a the leaf area to stem area ratio al as västilä et al 2013 was 31 comparable to those of common woody riparian species västilä and järvelä 2014 investigations were conducted in the foliated condition runs f1 f3 in the leafless condition by detaching the leaves l1 l3 and with the grassy bed only g1 g3 table 1 in order to compare the different test runs in terms of vegetative drag we evaluated the drag density parameter cda table 1 the product between the vegetation drag coefficient cd and the total vegetative reference area per unit canopy volume a nepf 2012a cda was estimated from the data for the region of the flow where the influence of the lateral shear layer was negligible i e where the lateral reynolds stress decayed to 10 of its maximum value see fig 5 in section 3 1 nepf 2012b thus as in white and nepf 2008 we assumed the equilibrium between the vegetative drag and the pressure gradient and neglected the contribution of turbulence stress 1 1 2 c d a u 1 2 g i where cda is the drag density parameter u 1 the velocity within the vegetated area g the gravitational acceleration and i the bed slope the momentum balance in the interface region experiencing high turbulent stresses is more complex vermaas et al 2011 because of the potential secondary currents and the laterally varying vegetative drag depending on the local velocity field and is beyond the scope of this work 2 3 determination of flow structure the flow in the partly vegetated channel was investigated along two lateral transects by measuring instantaneous three dimensional velocity components with acoustic doppler velocimetry velocity point data were measured at 200 hz with an acoustic doppler velocimeter adv nortek vectrino with a 4 beam side looking probe to the accuracy of 1 the sampling volume was 7 mm long with a 6 mm diameter 198 mm3 and the lowest appropriate velocity range of the instrument was selected depending on the flow characteristics mean velocity and turbulence intensity the flow was constantly seeded with solid glass micro spheres average particles diameter of 7 10 µm in order to achieve and maintain good signal to noise scores for the entire duration of the tests a recording time of 120 s 24 000 samples was found sufficient to achieve statistically time independent averaged velocity and turbulence parameters the adv raw data were pre filtered discarding the values with signal to noise ratio and correlation lower than 15 db and 70 respectively and despiked with the velocity signal analyser software v1 5 64 jesson et al 2015 the modified phase space thresholding method parsheh et al 2010 with c 1 c 2 1 48 parsheh et al 2010 wahl 2003 and the standard deviation as characteristic scalar were adopted based on the analyses of the effects of the software available spike replacement methods on the velocity statistics and spectral analysis the last good value method was selected as also recommended by jesson et al 2013 the overall average percentage of good data was greater than 95 based on pre tests measuring vertical velocity distributions z h 0 6 was selected as the most representative measurement elevation for the depth averaged velocity differently from studies with rigid cylinders e g white and nepf 2008 the within vegetation vertical profiles of longitudinal velocity exhibited a much higher variability caused by the complex velocity dependent streamlining and reconfiguration of the foliage as also reported by kubrak et al 2008 we observed an up to 23 difference between the mid depth longitudinal velocity and the depth averaged velocity to obtain a representative description of the flow within the heterogeneous vegetation arrangement two transects were measured between x 11 and 12 m 7 8 m downstream of the leading edge of the vegetation where the flow was fully developed based on pre tests the exact longitudinal location of the transects was selected aiming at obtaining high quality adv data under all the examined conditions by ensuring that the dynamically moving parts of the plants did not enter the path of the acoustic beam of the adv and that no plant parts had to be removed during the measurements to ensure that the flow properties at different lateral positions could be directly compared the transects were measured at the same relative position with respect to the stems approximately 40 mm upstream and 210 mm downstream to the closest plant fig 2 a owing to the obstruction provided by the foliated plants each transect was composed of two segments one covering the vegetated area from y 230 to y 130 mm and another shifted 125 mm upstream covering the remaining part of the cross section the transects were separated by a distance of 125 mm and 250 mm in the leafless and foliated runs respectively the lateral spacing of the measurement points ranged from 5 to 20 mm with a denser spacing placed at the interface where strong gradients in mean velocity and reynolds stress were observed the velocity statistics were obtained by averaging between the two transects 2 4 characterization of the dynamic plant motions organized plant motions caused by the downstream advection of large scale coherent structures were observed and video recorded for the foliated vegetation test runs owing to the local velocity field different reconfiguration behavior and dynamic motion were observed for the plants standing at the two lateral positions within the shear layer nevertheless we focused on the plants nearest to the main channel that experienced the strongest dynamic motions and the outermost elements which defined the position of the main channel vegetation interface the location of the interface y 0 was determined as the temporally and spatially averaged position of the outer edge of 3 5 well visible plants in the 1 m long measurement section from 25 s video recordings at 25 hz using the software tracker 5 0 video analysis and modeling tool fig 3 the amplitude of the lateral displacement table 2 was estimated similarly to the monami effect in submerged canopies ghisalberti and nepf 2002 further we obtained the frequency fv of the lateral motions and its standard deviation σ f v table 2 for the leafless vegetation runs with quasi rigid behavior the position of the interface was assumed to coincide with the edge of the grassy bed at y 0 mm this location was adopted as a reference position for the analysis of interfacial coherent structures and the general turbulence pattern of the flow in both the vegetative conditions 2 5 theoretical framework for flow structure investigation 2 5 1 mixing layer characteristic parameters and coherent structure scaling in the shear layer generated in partly vegetated channels the ambient velocity within the vegetation is referred to by u 1 and that in the main channel by u 2 with u 1 u 2 ben meftah et al 2014 white and nepf 2008 leaning on the theory of canonical plane ml pope 2000 the flow depends on two characteristic velocities 1 the convection velocity uc u 1 u 2 2 and 2 the velocity difference or differential velocity δu u 2 u 1 a third fundamental parameter which controls the spatially growing characteristic of the plane ml brown and roshko 1974 is represented by the normalized differential velocity or velocity ratio λ u 2 u 1 u 1 u 2 δu 2uc which measures the relative magnitude of the total shear compared to the convection velocity ho and huerre 1984 a characteristic length scale is represented by the ml width δ defined as the cross flow distance between positions where velocity reaches the 90 of the ambient flow value in the current study the momentum thickness θ was also adopted 2 θ 1 4 u y u c δ u 2 d y we evaluated θ by integrating between the lateral positions where u attained the ambient values u 1 and u 2 in the main channel the velocity approached an approximately constant value u 2 for all the tests u 1 was evaluated laterally averaging within the vegetated area considering that for leafless l and highly reconfigured vegetation f3 the velocity did not reach a constant value due to the local effects of the stems because of the inflection point in the velocity profile canonical mls are characterized by the formation of large coherent vortices resulting from a kh type instability these coherent structures strongly enhance the lateral transport of momentum and mass and are generated with a characteristic frequency fml corresponding to strouhal number st equal to 0 032 ho and huerre 1984 3 s t f m l θ u c 0 032 in contrast to plane mls vegetated shear layers attain stabilization at a certain distance from the origin of the layer because of the equilibrium between the production of shear layer scale turbulent kinetic energy and its dissipation within the canopy ghisalberti and nepf 2004 sukhodolova and sukhodolov 2012 moreover the stabilization is also controlled by the vertical and lateral confinement of the flow produced by the channel walls and the free surface together with the bed friction chu and babarutsi 1988 uijttewaal and booij 2000 considering the shear layer around a finite size patch of submerged filamentous flexible blades of sagittaria sagittifolia sukhodolov and sukhodolova 2012 proposed a scaling for the frequency of the coherent structures 4 f s u c δ s 2 u c c f δ u 1 3 where cf represents a bulk friction factor evaluated using the turbulent shear stress at the centerline of the shear layer and the convective velocity τ c 0 5ρcfuc 2 the ml width δ s in eq 4 must be evaluated as 2δu du dy max therefore differing from the shear layer width definition adopted in this study eq 4 was derived assuming the validity of the taylor s hypothesis of frozen turbulence with the assumption of local equilibrium between dissipation and mean turbulence production 2 5 2 selected turbulent statistics and spectral analysis the general description of the turbulent flow structure is based on temporally averaged velocity statistics with the lateral distributions computed by averaging between the two investigated transects to address the spatial variability of flow characteristics due to the heterogeneity of the vegetation the mean longitudinal velocity u the lateral longitudinal fluctuating velocities covariance covuv and the root mean square of the fluctuating velocity in the x and y directions urms and vrms respectively were evaluated furthermore the skewness of the longitudinal and lateral fluctuating velocity sku and skv respectively and the pearson correlation coefficient ruv between the longitudinal and lateral fluctuating velocities were considered spectral analysis was employed to detect coherent turbulent structures using the welch s method for the estimation of the power spectral density sii of the i th fluctuating velocity component ui t for quantifying the coherence of the large scale interfacial turbulent structures the autocorrelation function rii u i t u i t τ u i u i of ui t and the corresponding integral eulerian time scale ti 0 τ 0 r i i τ d τ were computed ti was evaluated by integrating rii τ up to τ0 the value of time lag τ corresponding to the first minimum of rii τ o neill et al 2004 tritton 1991 3 results and discussion 3 1 general description of the flow lateral distributions of spatially averaged mean longitudinal velocity fig 4 of both the foliated f and leafless l test runs exhibited a characteristic ml profile with an inflection point at the interface where the horizontal reynolds stress reached the maximum fig 5 owing to the different drag exerted by foliated and leafless vegetation table 1 the f cases presented higher velocity ratios λ for the f test runs λ varied with the flow rate table 1 as a result of the 11 5 m 1 96 decrease in the vegetative drag cda from f1 to f3 induced by the reconfiguration by contrast λ was independent of the flow rate for the quasi rigid leafless stems l for which cda decreased by only 0 25 m 1 from l1 to l3 the velocity ratio plays a key role in the shear layer dynamics setting the condition for the onset of large scale coherent structures as observed in shear layers in compound channels dupuis et al 2017 the local deceleration fig 4 and the change in the sign of the reynolds stress close to the location of the leafless stems fig 5 indicated that the leafless vegetation had a marked local effect on the flow the leafy vegetation introduced a global effect on the flow affecting the profile all over the vegetated area the effect being more pronounced as the drag density parameter increased for the foliated runs f1 and f2 the maximum shear was located in the vegetated area of the flow only for the high flow rate f3 for which strong reconfiguration was observed the maximum was located on the main channel side of the mean lateral position of the interface the lateral distribution of the root mean square value urms and vrms of the fluctuating velocity in the x and y direction provide information on the turbulence intensities shown in fig 6 normalized with the differential velocity δu all the profiles presented a peak in the interfacial region located at the grass edge y 0 mm for the leafless conditions and on the vegetated side of the main channel vegetation interface for the foliated conditions for the f runs the turbulence intensity was observed to decrease slightly asymmetrically toward the main channel and with relatively stronger gradients within the vegetation these observations are consistent with the turbulence intensity pattern observed for vertical shear layers induced by submerged vegetation ghisalberti and nepf 2006 nepf and vivoni 2000 nezu and sanjou 2008 for the leafless cases the additional peak in the turbulent intensity at y 55 mm coincides with the lateral position of stems the lateral distributions of skewness of the longitudinal sku and lateral skv fluctuating velocity were almost symmetric about the x axis for the f1 test case fig 7 a with increasing flow rate and vegetation reconfiguration the distributions resulted to be progressively less symmetric fig 7b c two different regions were clearly distinguishable a sweep dominated region where sku 0 and skv 0 on the vegetated side of the interface and an ejection dominated region on the other side where sku 0 and skv 0 the lateral position where the skewness changed sign coincided for sku and skv but was variable between the 3 foliated test cases and only for the high flow rate case where vegetation exhibited strong reconfiguration the point was located on the main channel side of y 0 stronger sku values within the vegetated area were observed for the f1 case and progressively decreased with decreasing cda this observation is consistent with the results of nezu and sanjou 2008 and poggi et al 2004 who investigated the effects of density on vertical vegetated shear layers observing higher skewness for canopy with higher density reconfiguration induced drag reduction in analogy with stem density reduction affected and limited the interactions across the interface for leafless cases for which only little reconfiguration was observed see table 1 no notable differences were visible in the lateral distribution of skewness between the three flow rates also for the l runs it was possible to identify the sweep and ejection dominated regions but differently from the leafy vegetation case the lateral position where the skewness sign changed coincided always with the edge of the grassy bed analogous occurrence was observed for strongly reconfigured vegetation f3 this circumstance suggests a prevalent role of the lateral bed roughness discontinuity in the shear layer dynamics both for leafless vegetation and strongly reconfigured foliated vegetation indeed lateral heterogeneity of bed roughness can generate strong shear layers vermaas et al 2011 as observed from the lateral distributions of figs 5 7 as the foliated vegetation progressively reconfigured with the increasing u 1 velocity the lateral distributions of velocity statistics tended to resemble those of leafless vegetation because of the decreasing cda value the global effects of the vegetation on the flow decreased and the local effect of each plant became increasingly important overall the variability of flow statistics between the two investigated transects was observed to progressively decrease with increasing flow rate figs 5 7 this can be reasonably explained by the reconfiguration of foliated vegetation and the drag density parameter for higher cda the flow had to adapt to the blockage conditions locally faced by the current conversely with streamlined plants the flow is channelized in the gaps defined by the reconfigured morphology of the vegetation in the leafless vegetation scenario only the local variability due to the presence of the stems was observed 3 2 coherent structures at the interface this section focuses on the large scale coherent structures occurring in the interface region generated by the drag discontinuity between the vegetated area and the adjacent main channel specifically the results discussed herein were derived from the upstream transect where not stated otherwise since no significant local between transect variability was observed in the coherent structures characteristics the foliated cases showed coherent quasi periodic fluctuations of the longitudinal and lateral velocity fig 8 a manifestation of the passage of large coherent structures the u and v velocity fluctuations were in opposite phase and contributed preponderantly to the overall reynolds stress with strong sweep u 0 v 0 and ejection events u 0 v 0 such a clear periodic signature of the velocity fluctuations was not observed for the leafless cases these differences are explained by the changes in the differential velocity generated by the presence of the foliage and reconfiguration table 3 the autocorrelation functions revealed that the turbulent structures of the foliated test cases were coherent over a much longer duration than those of leafless cases fig 9 as confirmed by the integral time scales table 3 with increasing flow rate the progressive loss of coherence with reconfiguration was accompanied with increasing ml re θ δuθ ν with ν being the kinematic viscosity and main channel reh u 2 h ν characteristic reynolds number increasing turbulence has been associated with the growth of three dimensional instabilities and the formation of small scale structures in analogous flows dominated by kh type instabilities rahmani et al 2014 the progressive loss of coherence with increasing flow rate for foliated vegetation and the corresponding λ and cda reduction can be considered ascribable also to the dynamic lateral motion of the vegetation interface the lateral plant motion described in section 2 4 induced instantaneously variable interface drag conditions that can strain the vortex structure and induce a loss of coherence this circumstance firstly addressed by ghisalberti and nepf 2006 considering the flow over rigid and flexible submerged vegetation is evident looking at the progressively increasing amplitude of the lateral motion of the plants and the instantaneous position of the outermost plant elements fig 3 the quantity vrms δu fig 6 interpretable as the relative speed of vortex rotation ghisalberti and nepf 2006 can provide an indirect measurement of the coherence of the interfacial large scale structures among the f cases a higher vrms δu at the interface was observed 0 17 for the f1 case where the amplitude of lateral plant motion was less pronounced 46 mm and the plant motion was observed to be more organized for the f2 and f3 cases for which the amplitudes reached 70 and 78 mm respectively lower values of vrms δu were observed 0 12 maximum values of the turbulence intensity found for rigid and flexible submerged vegetation were 0 15 and 0 11 respectively ghisalberti and nepf 2006 this suggests that the lateral motion caused by the presence of foliage and its complex distribution along the plant stands strongly affects the interface large scale structures coherence with implications on the lateral transport of momentum 3 3 velocity spectra spectra of the lateral velocity component at the interface y 0 mm revealed the presence of large scale coherent structures in all the foliated test cases visible as a clear peak in the power spectral density located in the energy containing range of frequencies fig 10 at the high frequency side of the peaks a slope of approximately 3 was observed indicating that the coherent structures were largely two dimensional proust et al 2017 uijttewaal and booij 2000 the concentration of energy at the frequency of the 2d vortices was observed all along the cross section with a progressively decreasing energy content moving away from the interfacial region not shown moreover a peak was observed at the same frequency in the u v cross spectra not shown proving that the detected coherent structures were responsible for the lateral momentum transport across the vegetation main channel interface in the leafless test cases even though an increased energy content at the strouhal numbers corresponding to the ml structures frequencies was registered the relative magnitude of the energy associated to this mode was notably lower kh vortices were present only in the foliated runs characterized by differential velocity ratio λ 0 3 table 1 according to dupuis et al 2017 and proust et al 2017 based on studies on ml in compound channels λ 0 3 represents the condition for the onset of kh coherent structures corresponding to the increase of the bulk flow velocity from f1 to f3 table 3 the progressive reconfiguration of vegetation produced a decreasing differential velocity ratio resulting in a loss of coherence of the interfacial structures as the vegetation progressively reconfigures the favorable conditions for the onset of kh structures can disappear with direct implications on the efficiency of the lateral mixing the blockage provided by the leafless vegetation was not sufficient for establishing favorable conditions to the onset of kh vortices moreover the differential velocity ratio did not depend on the flow condition for such non reconfiguring plants the density of the stems clearly plays the most important role on the shear layer characteristics white and nepf 2007 table 4 reports the frequency of the large coherent 2d structures f its standard deviation σ f over the shear layer the predictions of the scaling of eqs 3 and 4 and the frequency of the lateral plant motions fv the frequency deduced from the spectra was spatially averaged over the main channel shear layer width between y 0 and 270 mm and between the two transects congruently to the estimation of eqs 3 and 4 based on the temporal and spatial mean quantities of table 1 the peak frequency f of the lateral velocity spectra the predicted kh frequency fml and the observed frequency of vegetation lateral movement fv were in good agreement within the 17 of f while the fs values presented higher difference in respect to f up to 72 due to the high turbulence intensities the assumptions based on which fs in eq 4 is derived were not strictly satisfied for our case in addition eq 4 is referred to the vertical shear layer generated by submerged blade like vegetation in contrast to the horizontal shear layer of the present study generated by complex morphology emergent vegetation overall the variability of frequency of plant motion increased with the flow rate table 4 as observed during the tests when the frequency of the vortex shedding was higher the plant stands were not able to adapt quickly to the rapidly changing flow conditions resulting in a less organized motion moreover due to the variability of plant stands morphology along the elevation asynchronous motion was observed for the parts of the same plant stand 3 4 momentum transport across the interface to quantify the efficiency of the turbulent lateral transport of streamwise momentum and to explore the location size and strength of the detected interfacial vortices the lateral distributions of the pearson correlation coefficient between the lateral and longitudinal velocity ruv were evaluated fig 11 foliated cases presented a clear peak in ruv in the interfacial region while it remained highly stable across the interface for the leafless cases with the maximum value at the main channel side of the interface and additional peaks at the lateral position of stems these differences highlight the effects of foliation on the flow in the f cases large highly coherent turbulent structures were detected at the interface and correspondingly the efficiency of the lateral transport of streamwise momentum was observed to be notably higher while the leafless vegetation induced strong local mixing that was of the same order than the shear layer scale mixing the penetration of the coherent structures into the vegetation depended on the reconfiguration the highest lateral mixing efficiency was observed on the vegetated side of the interface y 0 for the f1 and f2 cases but in the main channel side for f3 the observed maximum values of the correlation between longitudinal and lateral velocities ruv 0 6 for foliated and 0 4 for leafless conditions suggest a stronger mixing for partly vegetated channels with complex foliated plants stands in comparison to analogous flows with simpler vegetation configurations values of 0 5 have been observed for terrestrial canopies raupach et al 1996 and aquatic flexible stripe like submerged canopies ghisalberti and nepf 2002 in boundary layer flows and canonical mls typical values of ruv are 0 32 and 0 44 respectively ghisalberti and nepf 2002 4 concluding remarks the experimental arrangement was novel in that the vegetation setup artificial flexible woody plants with grassy bed roughness and densities volumetric leaf area al 4 m 1 volumetric stem area as 0 13 m 1 closely represented conditions found along natural river margins in the partly vegetated channel different foliage and flow forcing conditions profoundly affected the flow characteristics at the interface between the vegetation and the main channel as summarized in fig 12 the presence of leaves markedly influenced the flow distribution resulting in higher velocity difference λ between the open and vegetated parts of the cross section in the leafless stage representing winter a vegetation exhibited a quasi rigid behavior analogous to rigid cylinders in this condition the bed roughness heterogeneity between the vegetated area and the open water played a major role in the lateral shear layer and was coupled with the local scale mixing induced by the stems for the foliated vegetation b and c in fig 12 the flow was dominated by large scale coherent interfacial structures which governed and enhanced the lateral interaction between the vegetated and unvegetated areas of the channel in addition the presence and reconfiguration of foliage induced major seasonal differences in flow paths within vegetation blue arrows in fig 12 the results underlined that complex shrub like vegetation undergoes drag reduction caused by both the seasonal shedding of leaves and the reconfiguration of plants with increasing hydrodynamic forcing increasing mean flow velocity from b to c in fig 12 this marked drag reduction the drag density parameter cda varied at 0 5 12 m 1 and at 0 18 0 4 m 1 for foliated and leafless vegetation respectively was associated with less strong and coherent interfacial shear layer scale structures resulting in notably lower lateral transport of longitudinal momentum fig 11 for leafless a compared to the foliated cases b and c the dominant frequency of the large coherent structures matched the lateral dynamic motions of the plants these frequencies were consistent with the canonical ml scaling with the applicability of the classical strouhal number st 0 032 indicating that they can be reliably predicted from the basic flow characteristics for dynamically moving natural like shrubs and bushes eq 3 overall the presence of leaves enhanced mixing at the shear layer scale in contrast to the local scale effects induced by the leafless plants therefore realistic representation of the seasonal variability and reconfiguration of vegetation is expected to improve the modeling of mass and momentum transport in partly vegetated channels acknowledgments this work was carried out while the first author was visiting the environmental hydraulics lab at the aalto university the authors would like to thank the technician antti louhio for his help in arranging the experiments the first author gratefully thanks prof paola gualtieri for her support and for providing useful comments and suggestions the second and third authors gratefully acknowledge the funding from maa ja vesitekniikan tuki ry grant no 33271 and maj and tor nessling foundation grant no 201800045 the fourth author gratefully acknowledges the funding from statutory activities no 3841 e 41 s 2018 of the ministry of science and higher education of poland 
674,irrigated agriculture is the primary user of world s fresh water resources on one hand and the producer of food to feed the world s growing population on the other hand water food and energy are intertwined in irrigated agricultural systems and an effective and coordinated management of the water food energy nexus is needed for the sustainable development of agriculture which is challenging because of large uncertainties involved therein this paper developed an optimization model for the allocation of resources toward the sustainable management of agricultural water food and energy nexus under uncertainty the model is capable of providing policy makers with the ability to determine optimal policy options among water energy and land resources to obtain the maximum system economic benefit and simultaneously minimize environmental impacts the model is also capable of handling complex uncertainties of random boundary intervals the model is demonstrated to solve a real world nexus management problem in an irrigation district in northeast china results highlight the sensitivity of food production and environmental pollution to the utilization of water energy and land resources the model is applicable for similar agriculture centered regions with limited resources keywords water food energy nexus irrigated agriculture optimization multi objective random boundary interval 1 introduction water food and energy are three basic resources for the maintenance of life and the development of social economy and they are inextricably linked agriculture is the backbone of food security but is also the largest user of freshwater resources which influence energy security tian et al 2018 globally food production accounts for about 90 of freshwater consumption and about 30 of energy use is for food production and its supply chain zhang and vesselinov 2017 however the increase of world population and the development of economy have posed challenges because of the expected demand of 50 more food 40 more energy and 30 more water by 2030 which will exacerbate the water and energy shortage yang et al 2016 therefore it is challenging for the integrated management of limited water and energy resources to meet the increasing food demand from the integrated agricultural sector nexus is an effective tool to jointly address various complex issues that link water food and energy ai saidi and elagib 2017 shed light on the drives behind the emergence of nexus thinking and emphasized the need for incorporation and cross linking of issues among water food and energy resources kurian 2017 expounded that the implementation of water food energy nexus could be supported by robust science and indicated the challenges of nexus approach by introducing concepts of trade offs synergies and resource optimization cai et al 2018 discussed how the water food energy nexus pertained to the water resources community which could help identify articulate utilize and extend the disciplinary strengths within the water food energy community in an irrigated agricultural system water availability affects food production in arid regions especially irrigation directly decides crop yields and consequent agricultural profits while food production in turn consumes water and energy energy availability restricts some agricultural practices for food production such as tillage and harvesting in the field and food processing and in turn food production consumes energy and the wastes of food production contribute to biofuel generation energy is used for water abstraction pumping irrigation and drainage for crop growth while water contributes to energy generation more recently some studies have reported the management of agricultural water food energy nexus for example yang et al 2016 evaluated the agricultural water energy and food nexus and modeled the impacts of a range of climate change scenarios on the nexus in the indus river basin in pakistan tian et al 2018 systematically optimized resource use efficiencies in the water food energy nexus for sustainable agriculture using a conceptual model for the decision support system these investigators highlighted the significance of integrated management of agricultural water food energy nexus bazilian et al 2011 put forward an integrated modeling approach considering the water food energy nexus since then investigations have been reported on nexus modeling tools used for integrated water energy and food policy making kaddoura and khatib 2017 thereinto optimization modeling is a powerful tool for quantifying the interactions and sustainable management of agricultural water food energy nexus however limited studies have been reported on incorporating the interactions while allocating resources of agricultural water food energy nexus in an optimization modeling framework optimization of water food energy nexus in an irrigated agricultural system is complicated the integrated management of water energy and land resources contributes to food production which brings economic benefits but agricultural production uses large amounts of water land fertilizer and pesticide inputs which lead to environmental changes such as greenhouse gas emission and non point source pollution tan et al 2011 2017 ji et al 2016 this leads to the complexity in how to balance the contradictory targets i e economic benefits and environmental impacts to promote the sustainable management of water food energy nexus in an irrigated agricultural system multi objective programming mop is deemed effective to address this complexity moreover integrated management for water food energy nexus in an irrigated agricultural system actually involves a variety of uncertainties for example intricate interactions exist between different subsystems such as economy society environment and administration which produce a variety of uncertainties the subjective judgments from stakeholders and experts impact data acquisition and system reliability this leads to the fuzziness in the policymaking process further a high degree of uncertainty may exist among some coefficients and parameters of the optimization model for water food energy nexus in an irrigated agricultural system for example the availability of water resources is sensitive to natural and geographic conditions technology selection and utilization efficiency causing difficulties to related data acquisition even the determination of interval numbers cannot reflect such a complex uncertainty because the lower bound and upper bound might correlate to each other and the intersection could exist between them dong et al 2014 a concept of random boundary interval rbi has been found to be an effective tool to reflect such a dual uncertainty cao et al 2010 therefore to tackle the above complexity of uncertainties integrating the multi objective programming rbi and fuzzy set theory into the optimization modeling framework for the sustainable management of water food energy nexus in an irrigated agricultural system is necessary and significant but has been barely considered in the existing literature see table 1 the main contributions of this paper therefore are the following 1 the interactions among water energy and food subsystems in an irrigated agricultural system are identified for mathematical modeling which helps optimally allocate limited water land and energy resources 2 a multi objective programming is incorporated into the modeling framework which helps develop schemes for more sustainable allocation of resources by simultaneously considering economic development and environmental protection 3 rbi is coupled to cope with the high degree of uncertainty in water availability which helps generate more realistic solutions and is conducive to providing managerial insights the remainder of the paper is organized as follows section 2 presents the methodology of a fuzzy multi objective programming model with random boundary interval fmop rbi section 3 formulates the mathematical model for water food energy nexus for irrigated agriculture based on fmop rbi section 4 applies the developed model in a real world case study in northeast china section 5 presents analysis and discussion of results and section 6 draws conclusions and discusses extensions 2 methodology 2 1 random boundary interval in many practical problems highly uncertain components are inherent in the management process for example in the water food energy nexus for irrigated agriculture systems water supply which dominates the harmonious collocation of water food and energy resources has a large uncertainty due to natural variations and human activities in such cases the lower and upper bounds of parameters with a high degree of randomness can rarely be acquired as deterministic values and even intervals or random variables can hardly address the complex characteristics lu et al 2015 instead a data can be presented as an rbi to cope with highly uncertain components an rbi parameter can be expressed as b b b with both the lower bound b and the upper bound b being random variables which leads to dual uncertainties to acquire an rbi samples of possible intervals for an rbi can be collected r 1 s 1 r 2 s 2 rn sn where r 1 r 2 rn and s 1 s 2 sn are the random numbers of lower and upper bounds of b based on the samples the mean vector and covariance matrix can be calculated as cao et al 2010 1a μ 1 n i 1 n r i 1 n i 1 n s i 1b d σ 1 2 ρ σ 1 σ 2 ρ σ 1 σ 2 σ 2 2 where σ 1 2 1 n i 1 n r i μ 1 2 σ 2 2 1 n i 1 n s i μ 2 2 and ρ 1 n σ 1 σ 2 i n r i μ 1 s i μ 2 2 2 fuzzy multi objective programming with rbi an mop model can generally be expressed as follows 2a max f k x j 1 t c k j x j k 1 2 k 1 2b min f k x j 1 t c k j x j k k 1 1 k 1 2 k subject to 2c j 1 t a i j x j b i i 1 2 m 2d x j 0 j 1 2 t where fk x k 1 2 k 1 fk x k k 1 1 k 1 2 k are the maximum and minimum objective functions respectively xj represent the jth decision variable ckj aij and bi r and r denote a set of real numbers in real world problems parameters in objective functions change with the changes of external stressors such as climate change water shortage and land utilization the uncertain changes in the parameters render the objectives of the mop in an imprecise and uncertain situation fuzzy logic is gaining strength in mop because of its simple and flexible construct that reorganizes a multi objective planning problem into a single objective environment morankar et al 2013 thus a fuzzy multi objective programming fmop model can be formulated where the key to the solution is to transform the fmop into a deterministic model based on membership functions generally it is difficult to determine the membership function of objectives the linear membership function is the most widely used function due to its simplicity for further details on other membership functions such as nonlinear hyperbolic and exponential membership readers can refer to sasikumar and mujumdar 1998 rani and moreira 2010 and morankar et al 2013 let fk x be any objective function then the linear membership function can be expressed as follows for the maximization scenario i e k 1 2 k 1 3a μ f k x 0 f k x f k min f k x f k min f k max f k min f k min f k x f k max 1 f k x f k max for the minimization scenario i e k k 1 1 k 1 2 k 3b μ f k x 1 f k x f k min f k max f k x f k max f k min f k min f k x f k max 0 f k x f k max where μfk x denotes the linear membership function of objective fk x and f k min and f k max are the minimum and maximum acceptable levels of the objective in order to obtain μfk x the value of f k min and f k max should be obtained one solves the developed fmop problem by considering one function at a time and ignoring all others the process is repeated k times for k different objective functions let the solutions obtained be x 1 x 2 xk respectively let n x k k 1 2 k one finds the values of objective functions fk x k 1 2 k at each point in n then one finds the minimum f k min and maximum f k max values of the objective functions i e f k min min f k x x n and f k max max f k x x n based on the membership function the problem is reduced to increase the satisfaction level of the policymaker subject to given constraints let λ min μfk x k 1 2 k then the fmop can be described as how to make a reasonable plan so that the policymaker is most satisfied with the objectives subject to the constraints that is there should be the highest degree of balance between objectives and constraints therefore λ can be defined as a control decision variable corresponding to the degree of satisfaction membership grade to which x solutions fulfill the objectives and constraints the larger the value of λ is the more satisfaction of the policymaker on decision schemes is then by introducing λ the fmop model can be formulated as follows 4a max λ subject to 4b μ f k x λ j 1 t c k j x j f k min λ f k max f k min k 1 2 k 1 4c μ f k x λ j 1 t c kj x j f k max λ f k max f k min k k 1 1 k 1 2 k 4d j 1 t a i j x j b i i 1 2 m 4e x j 0 j 1 2 t 4f 0 λ 1 in order to tackle high uncertainty when dealing with multi objective problems in an uncertain environment random boundary interval can be introduced thus an fmop model with random boundary interval fmop rbi was developed assuming bi in the constraint 4c to be an rbi b b b constraint 4d in the fmop rbi can be expressed as dong et al 2014 5 j 1 t a i j x j b i λ b i b i i 1 2 m therefore the fmop rbi can be formulated as model expressed by model 4 with the constraint expressed by eq 4c being replaced by constraint expressed by eq 5 in order to transform the uncertain constraint i e eq 5 into a deterministic one let z i b i λ b i b i λ b i 1 λ b i then f v w can be defined as the joint probability distribution of b b b where v is the variable referring to b and w is the variable referring to b then the distribution function of zi can be calculated as follows 6 g i z λ pr z i λ b i 1 λ b i z λ b i 1 λ b i z f v w d v d w based on the technique of chance constrained programming li et al 2008 the random variable on the right hand side of the constraint i e z i λ b i 1 λ b i can be discretized to several deterministic numbers corresponding to different violation probabilities hence constraint eq 5 can be transformed into the following form 7 j 1 t a i j x j z i p i i 1 2 m where z i p i g i 1 p i λ which is the inverse function of gi z λ z i p i is a function of λ corresponding to different violation probabilities pi based on the above methodology the fmop rbi model can be transformed into a single objective deterministic programming model by introducing λ in this problem λ not only represents the possibility of satisfying the objectives and constraints but also a linear combination parameter of the lower and upper bounds of an rbi 2 3 method of solution the steps for solving the fmop rbi problem can be summarized as follows step 1 model the fmop rbi problem step 2 calculate the mean vector and covariance matrix of an rbi based on samples then formulate the joint probability distribution of an rbi step 3 obtain the maximum and minimum values of each objective and the corresponding results by solving each objective function individually step 4 define the membership function of each objective function step 5 transform the fmop rbi model into a single objective function with the objective of maximizing λ step 6 transform the uncertainty constraint with the rbi into its equivalent deterministic form by introducing λ based on the technique of chance constrained programming with given violation probability pi step 7 solve the transformed model with different values of pi and generate schemes 3 model development this section develops a water food energy nexus optimization model for sustainable irrigated agriculture which can be abbreviated with wfeo sia model the framework for the wfeo sia model is fmop rbi a stochastic multi objective approach interactions between water food and energy components in an irrigated agricultural system are represented in the model the wfeo sia model focuses on reconciling contradictions between socioeconomic and environmental development hence the objective of the model is to maximize total net economic benefits the difference between revenues and costs and minimize the side effect of food production on the environment co2 emission and water quality in an irrigated agricultural system five major sets of constraints are included which relate to water availability energy availability food security resources allocation equity and land policy quantities of surface water and groundwater for food production energy supplies for food production and water abstraction pumping and drainage and land utilization can be determined the decision making framework is depicted in fig 1 the wfeo sia model is presented below 3 1 notations to clearly present the modeling framework the following list of notations is provided indices i index of subarea i 1 2 i k index of crop k 1 2 k 1 for paddy field crop k k 1 1 k 1 2 k for dry crop sur superscript for surface water gro superscript for groundwater max superscript for maximum min superscript for minimum codcr superscript for chemical oxygen demand nh 3 n superscript for ammonia nitrogen tn superscript for total nitrogen tp superscript for total phosphorus pf superscript for paddy field dl superscript for dry land symbols fnb objective function of net benefit yuan fei objective function of environmental impact kg r revenue yuan c cost yuan ecw energy cost for water yuan ecisur energy cost for irrigation using surface water yuan ecigro energy cost for irrigation using groundwater yuan ecd energy cost for drainage yuan ecf energy cost for food yuan wcf water cost for food yuan ae atmosphere effect kg wep water environmental pollution kg parameters pck price of crop k yuan kg yaik yield per unit area of crop k in subarea i kg ha ec energy cost yuan kw h hisur hydraulic head related to surface water m μ sur efficiency for surface water abstraction i q i k s u r surface irrigation quota of crop k in subarea i m3 ha i q i k g r o groundwater irrigation quota of crop k in subarea i m3 ha hlift pumping lift head m hnop nominal operating pressure m hlossess head loss m μ pump pump efficiency μ motor motor efficiency hdi drainage head in subarea i m μ i d r a drainage efficiency for subarea i dmk drainage modulus of crop k m3 d ha tk drainage days of crop k in subarea i d δ k f e r cost of fertilizer of crop k yuan ha δ k p e s cost of pesticide of crop k yuan ha δ k m a c cost of diesel of agricultural machinery of crop k yuan ha δ k f i l m cost of agricultural film of crop k yuan ha δ k s e e d cost of seed of crop k yuan ha δ k l a b o r labor cost of crop k yuan ha w p i s u r surface water price yuan m3 w p i g r o groundwater price yuan m3 cef carbon emission factor for fertilizer kgco2 kg fi fertilizer utilization in subarea i kg ha cep carbon emission factor for pesticide kgco2 kg pi pesticide utilization in subarea i kg ha ced carbon emission factor for diesel of agricultural machinery kgco2 kg ami diesel utilization of agricultural machinery in subarea i kg ha ceaf carbon emission factor for agricultural film kgco2 kg afi agricultural film utilization in subarea i kg ha cepl carbon emission factor for plough kgco2 ha cei carbon emission factor for irrigation kgco2 ha p e i c o d c r pollution emission intensity for codcr kg ha p e i n h 3 n pollution emission intensity for nh 3 n kg ha peitn pollution emission intensity for total nitrogen kg ha peitp pollution emission intensity for total phosphorus kg ha lni nitrogen leaching in subarea i kg ha lpi phosphorus leaching in subarea i kg ha η sur pf surface water utilization efficiency for paddy field η sur dl surface water utilization efficiency for dry land r the ratio of water diversion from rivers q runoff volume m3 η gro pf groundwater utilization efficiency for paddy field η gro dl groundwater utilization efficiency for dry land gwiai groundwater availability for irrigated agriculture for subarea i m3 gwli groundwater utilization for living for subarea i m3 gwii groundwater utilization for industry for subarea i m3 tgwa total groundwater availability m3 ewa total energy availability for water kw h poi population for subarea i people fd food demand kg per capita er effective rainfall m3 ha θ equity threshold a i k min the lower limit of land availability for crop k in subarea i ha a i k max the upper limit of land availability for crop k in subarea i ha decision variables aik irrigation area of crop k in subarea i ha swai surface water availability for subarea i m3 gwaii groundwater availability for irrigated agriculture for subarea i m3 ewi energy availability for water for subarea i kw h note yuan is the chinese currency unit 3 2 objective function 1 maximize net economic benefit the economic benefit is an essential target reflecting regional economic development the net economic benefit is the difference between revenues and costs the objective function of net economic benefit can be expressed as 8a max f n b max r c the revenues mainly originate from food production and can be expressed as 8b r i 1 i k 1 k p c k y a i k a i k many aspects contribute to the total cost such as energy cost for surface water abstraction groundwater pumping and drainage cost for food production mainly includes costs of fertilizer pesticide agricultural machinery agricultural films seed and labor and cost of water utilization for food production thus costs can be expressed as 8c c e c w e c f w c f where 8d e c w e c i s u r e c i g r o e c d the energy required for surface water abstraction groundwater pumping and drainage is a function of water source and is directly related to pump heads for pumping water from aquifer the pumping lift nominal operating pressure and friction losses should be taken into account thus the energy cost for irrigation water ecisur ecigro and ecd can be expressed as follows de vito et al 2017 8e e c i s u r e c h i s u r 102 3 6 μ s u r i 1 i k 1 k i q i k s u r a i k 8f e c i g r o e c h l i f t h n o p f l o s s e s s 102 3 6 μ p u m p μ m o t o r i 1 i k 1 k i q i k g r o a i k 8g e c d e c i 1 i h d i 102 3 6 μ i d r a k 1 k d m k t k a i k the energy cost for food production that mainly embodies the utilization of chemical fertilizers pesticides agricultural machinery films seeds and labor can be expressed as 8h e c f i 1 i a i k k 1 k δ k f e r δ k p e s δ k m a c δ k f i l m δ k s e e d δ k l a b o u r the water cost for food production is quantified by the water price for irrigation with both surface water and groundwater and is expressed as 8i w c f i 1 i w p i s u r k 1 k i q i k s u r a i k i 1 i w p i g r o k 1 k i q i k g r o a i k 2 minimize negative environmental impacts during the growth of crops greenhouse gases and water pollutants are generated which affect the atmosphere and the water environment thus the objective of negative environmental impacts is to minimize co2 emission and water environment pollution this objective can be expressed as 8j min f e i min a e w e p the co2 emission mainly stems from the usage of pesticides fertilizers and agricultural machines agricultural films and irrigation plough thus ae can be expressed as 8k a e i 1 i k 1 k c e f f i c e p p i c e d a m i c e a f a f i a i k c e p l c e i a i k water environment pollution considers the reduction of pollutant concentration in surface drainage chiefly including codcr nh3 n tn and tp besides nitrogen and phosphorus leaching is also taken into account thus the wep can be expressed as 8l w e p i 1 i k 1 k p e i c o d c r p e i n h 3 n p e i t n p e i t p a i k l n l p a i k 3 3 constraints the wfeo sia model is characterized by the following management constraints 1 surface water availability surface water allocation for both paddy field and dry land should not be larger than surface water supply for each subarea generally the available surface water is taken from river flow runoff and the total water availability for all subareas should not be larger than the runoff volume that can be used for this area runoff which affects allocation results has high uncertainty due to natural factors and human activities therefore the runoff volume in this study was expressed as an rbi this constraint can be expressed as 8m k 1 k 1 i q i k s u r a i k η s u r p f k k 1 1 k i q i k s u r a i k η s u r d l s w a i i 8n i 1 i s w a i r q 2 groundwater availability similar to surface water groundwater allocated to both paddy field and dry land in each subarea should not be larger than groundwater availability for irrigated agriculture from well pumping the groundwater availability for irrigated agriculture equals the total groundwater availability minus water use for drinking and industry this constraint can be expressed as 8o k 1 k 1 i q i k g r o a i k η g r o p f k k 1 1 k i q i k g r o a i k η g r o d l g w i a i i 8p i 1 i g w i a i g w l i g w i i t g w a 3 energy availability in irrigated agricultural systems energy is mainly used for surface water abstraction groundwater pumping and drainage and the electricity consumed should not be larger than the allowable quantity for each subarea and the total energy availability this constraint can be expressed as follows 8q h i s u r μ s u r k 1 k i q i k s u r a i k h l i f t h n o p f l o s s e s s μ p u m p μ m o t o r k 1 k i q i k g r o a i k h d i μ i d r a k 1 k d m i k t i k a i k 102 3 6 e w i i 8r i 1 i e w i e w a 4 food security the yield for food grain in each subarea should satisfy the food grain requirement that is associated with population to guarantee food security this constraint can be expressed as 8s k 1 k y a i k a i k p o i f d i 5 resources allocation equity the gini coefficient is used to describe the allocation equity among different subareas the gini coefficient can be expressed according to lorenz curve hu et al 2016 smaller gini coefficient indicates that the allocation is more even which contributes to social stability the range of gini coefficient is from 0 perfect equality to 1 maximal inequality as this study focuses on an irrigated agricultural system and water is the main restricted element the equity of irrigation water allocation was considered this constraint can be expressed as 8t 1 2 i i 1 i k 1 k i q ik er a ik p o i m 1 i n 1 i k 1 k i q mk er a mk p o m k 1 k i q nk er a nk p o n θ 6 land policy for each crop in different subareas and for each crop type in all subareas the lower and upper limits of irrigation area should be considered to keep in view the food requirement and prevailing crop production practices this constraint can be expressed as follows 8u a i k min a i k a i k max i k 7 non negative constraint the decision variables should not be negative 8v a i k 0 i k 8w s w a i 0 i 8x g w i a i 0 i 8y e w i 0 i 4 application 4 1 study area a real world case study was used to demonstrate the feasibility of the developed wfeo sia model and the fmop rbi approach the study area is in jinxi irrigation district jxid in fujin city heilongjiang province northeast china the longitude is from 131 30 to 132 37 e and the latitude is from 46 48 to 47 14 n jxid is located on the right bank and in the lower reaches of the trunk steam of songhuajiang river with a cultivated land of 1 011 105 ha fig 2 shows the map of jxid including the geographic location and river system irrigation district partition and irrigation and drainage network the annual mean precipitation and evaporation are 542 mm and 720 mm respectively jxid contains four subareas which are songhuajiang subarea jinshan subarea huama subarea and toulin subarea irrigated agriculture is the largest water consumer of jxid accounting for nearly 90 of the total water consumption both surface water and groundwater are supplied to jxid and songhua river is the main surface water supply the development speed of agriculture in jxid is fast leading to the over exploitation of groundwater because of a lack of water diversion and pumping engineering in order to reform the unbalanced utilization of water resources the headwork pump stations and the drainage pump stations were established the headwork pump is used to lift water from songhua river and there are six feedwater pumps with a hydraulic head of 7 54 m there are six drainage pump stations in jxid including shanxi huama duijin shuangyushu toulin and erlin drainage pump stations detailed information on the drainage system can be seen from fig 2 the distribution drainage receiver hydraulic head and flow of the six drainage pump stations are described in supplemental materials these pump stations contribute to the electricity consumption of surface water jxid is an important food production base of heilongjiang province in china the main crops are rice corn soybean vegetables and melons among them the grain food occupied nearly 90 of the total cultivated area in the past five years of which rice was principal crop therefore rice corn and soybean were chosen as the studied crops in this study and they were plowed in each subarea in jxid in order to ensure the advantage of food production the safety of water supply and food production security should be guaranteed and the water and energy resources should be reallocated in a sustainable way that is considering both economic development and environment protection fluctuating water availability makes the management more difficult therefore the developed model was applied in jxid to tackle these problems 4 2 data collection the water food energy nexus for irrigated agriculture is a complex system involving many parameters the values of these parameters were obtained from the hydrometric station from 1954 to 2015 some government reports of jxid statistical yearbook from 2009 to 2016 and published references table 2 shows the crop parameters in the wfeo sia model including crop price cost related parameters due to food production and drainage related parameters among them crop price was obtained from the agricultural product price information network of heilongjiang province cost related parameters were obtained from the statistical yearbook of fujin city the drainage modulus was obtained from engineering feasibility study report of jinxi irrigation district the drainage duration was related to crop tolerance to waterlogging how to determine the drainage duration can be found in supplemental materials based on the data of drainage modulus and duration the irrigation drainage volume can be obtained then the energy cost for drainage i e ecd can be calculated according to the method from de vito et al 2017 detailed information on how to determine ecd can be seen in supplemental materials the surface water price and groundwater price were 0 16 and 0 29 yuan m3 respectively table 3 shows the subarea related parameters in the wfeo sia model including utilization of fertilizers pesticides film and agricultural machinery groundwater use and population all the data except for groundwater use were obtained from the statistical yearbook of fujin city and data of groundwater use was from water resources verification report of jinxi irrigation district there are still some parameters that are associated with both crops and subareas as shown in table 4 including the lower and upper limits of land availability yield per unit area and irrigation quota for both surface water and groundwater among them the yield per unit area was calculated by dividing the crop yield by crop area for different crops in different subareas data for crop yield were collected from the statistical yearbook of fujin city other data in table 4 were derived from the water resources verification report of jinxi irrigation district water resources argumentation report of jinxi irrigation district and engineering feasibility study report of jinxi irrigation district according to the planning requirements of jxid the minimal values of crop area were set to ensure the grain output of the irrigation district this can also guarantee the boundedness of wfeo sia model the crop areas of different crops in different subareas can be adjusted within their respective scopes as eq 8u shows specifically the adjustable range of rice was from 5 02 104 to 8 104 ha that of corn was from 1 43 104 to 3 88 104 ha and that of soybean was from 0 71 104 to 1 88 104 ha the food demand per capital was set as 400 kg per capita the value of the equity threshold in this study was set to 0 4 which represents the relatively reasonable allocation yang et al 2015 the wfeo sia model also involves some efficiency coefficients including efficiency for energy consumption and efficiency for irrigation the efficiency for energy consumption included efficiencies for surface water abstraction groundwater pumping and drainage specifically the efficiency for surface water abstraction was 0 5 for the efficiencies for pumping there were two efficiency values involved i e pump efficiency μ pump and motor efficiency μ motor in this study μ pump was set as 0 8 and μ motor was set as 0 4 daccache et al 2014 the efficiencies for shanxi huama duijin shuangyushu toulin and erlin drainage stations were 0 52 0 56 0 48 0 53 0 60 and 0 52 respectively the methods for the acquisition of efficiency for energy consumption were described in supplemental materials irrigation efficiency related to irrigation network and farm management techniques and the values vary with different crops and different water sources according to the engineering feasibility study report of jinxi irrigation district surface water use efficiency was 0 51 for paddy field and was 0 53 for dry land the groundwater use efficiency was 0 75 for paddy field and was 0 78 for dry land other important parameters were those related to the environment the co2 emission coefficients were used to estimate the co2 emission volume they were 0 9 kgco2 kg for fertilizer 4 93 kgco2 kg for pesticide 0 5927 kgco2 kg for diesel oil 5 18 kgco2 kg for films 312 6 kgco2 ha for plough and 226 48 kgco2 ha the pollution emission intensity coefficients and leaching coefficients are variable with different areas crops theoretically however for jxid the corresponding values for certain pollutants for different areas crops were the same specifically the pollution emission intensity of chemical oxygen demand codcr ammonia nitrogen nh3 n total nitrogen tn and total phosphorus tp were 150 11 85 171 75 and 65 25 kg ha respectively the leaching coefficients of nitrogen and phosphorus were 0 687 kg ha and 0 261 kg ha these environmental data were obtained from the engineering environmental impact report of jinxi irrigation district and the data are available in the data center of the ministry of environmental protection of the people s republic of china resource availabilities are critical limiting parameters for the wfeo sia model in this study the runoff volume of songhua river was expressed as an rbi in this study the runoff volume was assumed to obey the two dimensional normal distribution based on the historical data for 62 years and the water diversion ratio the joint probability distribution of the lower and upper bounds of the surface water availability 108 m3 can be obtained i e n 4 23 4 99 1 42 1 612 0 9 based on the methodology λ q i 1 λ q i n μ σ with μ 4 99 0 76λ and σ 1 96 λ 2 2 0286 λ 1 λ 2 59 1 λ 2 then given different violation probabilities z i p i g i 1 p i λ can be obtained from the standard normal distribution table z i p i g i 1 p i λ was a function of satisfactory degree λ and it was coupled in the wfeo sia model in this study violation probabilities of 0 01 0 05 0 1 0 15 and 0 2 were chosen according to previous studies the total groundwater availability was 1 1685 108 m3 and the total energy availability for all subareas was 1 3866 108 kw h 5 analysis of results and discussion 5 1 changes of economic benefits and environmental impacts using the wfeo sia model a series of related schemes were generated the objectives of the wfeo sia model were to maximize in the net benefits nb and minimize environmental impacts ei the value of net benefits was the difference between revenues and costs and the environmental impact was the comprehensive effect of both co2 emission and water quality fig 3 shows the variation of objectives under different scenarios considering the variations of different violation probabilities and the lower upper and average values of surface water availability which were expressed as an rbi it can be obtained from the figure that both revenues and costs increased as the violation probabilities p increased however the rate of increase of revenues was higher than costs leading to an increase in the trend of net benefit under different violation probabilities they were 15 50 108 15 56 108 15 63 108 15 71 108 and 15 71 108 yuan corresponding to the violation probabilities of 0 01 0 05 0 1 0 15 and 0 2 respectively on the contrary the environmental impacts decreased slightly under different violation probabilities from 1 31 108 kg to 1 29 108 kg among which the co2 emission contributed to the shift taking the benefits under p 0 01 as the baseline the increase rates were 0 51 p 0 05 1 09 p 0 1 1 68 p 0 15 and 1 73 p 0 2 each percentage point rise in benefits was roughly equivalent to the benefits of 43 million kg of rice this was the comprehensive result of considering both system benefits and environmental impacts however if the system benefit was the only consideration the increase rates were 2 3 p 0 05 5 1 p 0 1 7 9 p 0 15 and 10 5 p 0 2 compared to the value under p 0 01 such results indicated that the two objectives i e system benefit and environmental impacts were in conflict because more benefits were derived from more food production which would bring more environmental pollution therefore one of the effects of the developed wfeo sia model was to pursue a balance of economic growth and environmental pollution results in fig 3 showed that larger violation probabilities were more lucrative because higher net benefits and smaller environment impacts could be generated larger violation probabilities indicated larger water availability which would bring higher synthetic benefits yet at the same time larger violation probabilities also meant larger risks this was because if the water availability failed to achieve the value corresponding to a certain violation probability the punitive compensation would be generated which might cause economic losses usually facing different violation probabilities the risk averse policymakers might choose the allocation results corresponding to smaller violation probabilities while the risk taking policymakers might choose the results corresponding to larger violation probabilities in terms of this study p 0 15 can be adopted from the perspective of the performance of the system s comprehensive benefits because at this point the value of both net economic benefit and environmental impacts achieved their relative ideal points in other words when the violation probabilities were larger than 0 15 the values of the two objectives tended to stabilize however it was just a reference and whether the policymakers would choose this violation probability depends on their preferences and practical situations in addition assuming one optimized his her decision under a particular violation probability for example p 0 15 with the water availability was 5 11 108 m3 which could be calculated based on the joint probability distribution of the lower and upper bounds of the surface water availability if the actual water availability was lower assuming the water availability was 4 93 108 m3 corresponding to p 0 1 the actual benefit would fall short of the promised benefit then the policymakers might identify a way to obtain more water to make up the economic losses by buying water from adjacent and well watered regions or continually exploring groundwater within the exploitable capacity of groundwater for the former means 1 26 107 yuan cost would be generated with the purchase price of water as 0 7 yuan m3 and for the latter means 5 2 106 yuan cost would be generated with the price of groundwater as 0 29 yuan m3 on the other hand if the actual water availability was higher assuming the water availability reaches 5 31 108m3 corresponding to p 0 2 this situation was optimistic with the benefit increased by 1 2 107 yuan compared with scenarios corresponding to different violation probabilities the objective values considering different bounds of surface water availability expressed as an rbi were smaller the revenues were 17 55 18 85 and 20 108 yuan and the costs were 3 93 4 21 and 4 47 108 yuan corresponding to the lower bound the average value and the upper bound of surface water availability being considered respectively the co2 emission amounts were 0 87 0 92 and 0 96 108 kg and the pollutants in water were 1 17 1 24 and 1 30 108 kg such results were due to the no consideration of violation risks as well as the correlations between the lower bound and upper bound of surface water availability 5 2 resources allocation results fig 4 shows the land and water resources allocation considering both economic benefits and environmental impacts when the surface water availability was deterministic the average value of the lower and upper bounds of surface water availability i e the randomness of surface water availability was not considered it can be seen that there was a sufficient preponderance of planting rice the preponderance reflected in two aspects one was that the crop area allocation amount for rice was much larger than that for corn and soybean it was the planning requirement of jxid that led to such a result for the high quality of rice because of the black soil in jxid which absorbed more mineral elements such as nitrogen phosphorus and kalium the quality of rice in jxid was good the second aspect was that through optimization the wfeo sia model compromised the two contradictory objectives i e maximize net economic benefit and minimize negative environmental impacts leading to the optimal crop areas for different crops which would be within their specific adjustable ranges see table 4 specifically if we set the minimum areas of crops as the starting points and the maximum areas of crops as the endpoints and the distance between the starting points and the endpoints which could represent the adjustable range of crop areas was set as 1 then for rice the distance between the optimal area and the starting point was 0 18 for corn the distance was 0 14 and for soybean the distance was close to zero such results indicated the wfeo sia model tended to allocate more area for rice first this was mainly attributed to the much higher yield of rice than soybean per unit area and higher market price than corn the land allocation proportion of rice was 96 for songhuajiang subarea 82 for jinshan subarea 81 for huama subarea and 47 for toulin subarea the allocation trend of water was similar to that of land because water allocation amounts can be determined by multiplying the allocated crop areas with the irrigation quota surface water allocation attracted the majority of the total water availability which changed previous water resources policies of jxid that groundwater was the main source for irrigation the optimized energy allocation amount proportion was 687 104 kw h 5 9 for songhuajiang subarea 2872 104 kw h 24 7 for jinshan subarea 4485 104 kw h 38 5 for huama subarea and 3591 104 kw h 30 9 for toulin subarea the above results were the comprehensive effect of considering both economic benefit and environment impacts if the objective of economic benefit was considered only the total land allocation amount was 8 79 104 ha surface water allocation amount was 4 66 108 m3 groundwater allocation amount was 1 04 108 m3 and energy allocation amount was 1 21 104 kw h while if the objective of environmental impact was considered only the total land allocation amount was 7 21 104 ha surface water allocation amount was 4 35 108 m3 groundwater allocation amount was 1 01 108 m3 and energy allocation amount was 1 12 104 kw h when both of the two objectives were considered simultaneously the optimal resources allocation results were within the range of considering single objective more specifically the total land allocation amount was 8 02 104 ha surface water allocation amount was 4 61 108 m3 groundwater allocation amount was 1 04 108 m3 and energy allocation amount was 1 16 104 kw h when both economic benefit and negative environmental impact were taken into account this shows that there was a resources tradeoff between land water and energy for different crops and different subareas to achieve a relative balance of system economic benefit and environment impacts these results could provide policy makers more alternatives for resources allocation schemes based on actual development requirements of the studied irrigation district for example one could emphasize economic benefits or environmental impacts or give consideration to both economy and environment the above results were obtained without considering uncertainties when the randomness of water availability was considered the resources allocation results would change with different violation probabilities as shown in methodology z i p i g i 1 p i λ was involved when solving the wfeo sia model which was a function of both satisfactory degree λ and violation probabilities p as fig 5 shows the values of λ increased as p increased indicating that larger violation probabilities would improve policymaker s satisfaction for decision schemes this was mainly because larger violation probabilities corresponded to larger water availability similar changing trends also applied to the resources allocation of water supply and energy supply however the amounts of fluctuations were different when the value of violation probability was larger than 0 15 the increasing rate diminished however for land resources allocation the changing trend was different from that of water and energy allocation likewise the allocation amount of land barely changed after p 0 15 therefore from a resources allocation perspective the allocation scheme corresponding to p 0 15 was desirable which had been expounded in the analysis of the changes of economic benefits and environmental impacts 5 3 changes of components in the objectives many components collectively contributed to the values of objectives for the objective of net benefits the revenues mainly originated from food production however there were many aspects of costs fig 6 shows cost ratios under different scenarios i e under different violation probabilities based on the figure the changing trends of the percentage of each category of cost were basically consistent and experienced slight changes under the five selected violation probabilities for example the percentage of costs of agricultural machinery labor and fertilizer which were the three biggest contributors to the total cost were 67 41 for p 0 01 67 18 for p 0 05 66 82 for p 0 1 66 49 for p 0 15 and 66 47 for p 0 2 respectively some cost percentages increased as the violation probabilities increased consider example of the percentage of energy cost for water abstraction when p 0 01 and p 0 05 this cost was lower than its previous term i e cost for seeds the percentage values of seed were 6 92 and 6 8 under p 0 01 and p 0 05 respectively and the percentage values of energy cost were 6 45 and 6 55 under p 0 01 and p 0 05 respectively however when the violation probability was larger than 0 05 the percentage of energy cost for surface water abstraction was higher than the cost for seed the percentage values of seed were 6 64 6 48 and 6 46 under p 0 1 p 0 15 and p 0 2 respectively while the percentage values of energy cost were 6 69 6 83 and 6 84 under p 0 1 p 0 15 and p 0 2 respectively this was mainly because the energy cost for surface water abstraction had a direct relationship with surface irrigation amount and larger violation probabilities indicated larger irrigation amounts however the cost for seed depended on land use which had a downward trend as violation probabilities increased however there were obvious changes in the absolute values of different categories of costs taking agricultural machinery as an example and taking the cost under p 0 01 as the baseline the cost of agricultural machinery increased 1 2 under p 0 01 2 4 under p 0 1 3 7 under p 0 15 and 3 9 under p 0 2 this was because as the violation probabilities increased the absolute value of each category of cost increased the cost for field measures including cost for agricultural machinery labor fertilizer seed pesticide and agricultural film occupied the most proportion of the total cost 77 8 79 1 followed by the energy cost for water abstraction pumping and drainage 11 7 12 4 and the last was the cost for water utilization for both surface water and groundwater 9 2 9 8 such results can provide instructive suggestions for policy makers as to the part that should be focused on in terms of reducing expenses and thus increasing net benefits when planning resources of the studied irrigation district two aspects affected the environment co2 emission and water quality the co2 emission was generated mainly because of field measures such as the utilization of fertilizer pesticide agricultural machinery and film irrigation and plough and these activities were connected with crop species taking huama subarea as an example fig 7 shows the contribution rates of different field activities and different crops for all the field activities the utilization of fertilizer irrigation and plough generated much more co2 than other did field activities accounting for more than 90 of the total co2 emission therefore when the reduction of co2 emission was desired these three parts were of the primary concern the paddy field rice contributed more co2 than did the dry land corn and soybean attributed to the larger irrigation area as the violation probabilities increased the percentage of paddy field increased while the percentage of dry land decreased another aspect that impacted the environment was water quality which was quantified by the main pollutants including codcr nh3 h tn and tp among them codcr and nh3 h were the main pollutants and the variations mainly embodied rice and corn as shown in fig 8 water quality had a direct relationship with irrigation area which remained nearly the same for soybean under different violation probabilities based on the results of the wfeo sia model 5 4 sensitivity analysis the aforementioned results shed light on how the uncertainty of water supply affected model performance besides water supply economic data were also constantly changing in order to learn the impact of crop price and production cost on the net system benefit negative environmental impacts and resources allocation equity sensitivity analysis was conducted as shown in fig 9 from the figure the net benefit environmental impacts and resources allocation expressed as gini coefficient were all sensitive to the price of rice while showing low sensitivity to the price of corn and soybean results showed that the price of rice had a potential to increase the net system benefit and decrease negative environmental impacts compared with the baseline the results without considering the changes of sensitive parameters the net benefit range was 5 4 9 5 the minus sign represented a decrease in value and the environment impacts range was 1 4 9 when the price of rice was 10 the changing ranges of both net benefit and environmental impacts were smaller than when the price of corn and soybean was 10 as seen from the figure based on the results of fig 6 agricultural machinery labor and fertilizer contributed most to the total cost therefore these three parts were selected as the sensitive parameters of production cost based on fig 9 both the net benefit and environment impacts presented a linear relation with the three kinds of cost it showed a negative correlation for the net benefit but showed a positive correlation for the environmental impacts indicating that the increase of production cost would decrease the net benefit and increase environmental pollution therefore reducing production costs would be beneficial for the sustainable management of water food energy nexus either from the angle of economy or environment among the production costs the objectives were most sensitive to the cost of agricultural machinery because of the larger slope followed by the cost of labor and the last was the cost of fertilizer all these three costs had the potential to lower system cost especially the cost of agricultural machinery such results were also evident from fig 6 for resources allocation equity the changes of gini coefficient for each case case 1 changes of crop price case 2 changes of production cost were slight specifically in case 1 the changing range of gini coefficient was 0 3443 0 3680 for rice 0 3603 0 3626 for corn and 0 3610 0 3639 for soybean in case 2 the changing range of gini coefficient was 0 3605 0 3642 for agricultural machinery 0 3608 0 3641 for labor and 0 3613 0 3636 for fertilizer these values of gini coefficient belonged to the scope of relatively reasonable allocation such results indicated that the variation of resources allocation results was not distinct and a robust solution could be generated with the changes of economically sensitive parameters 5 5 discussion the developed wfeo sia model supported the management of water food and energy for irrigated agriculture in a sustainable way with the interrelationships among the main components of water food energy nexus being quantified by an optimization model one of the innovations of the study was that the wfeo sia model balanced two contradictory but important objectives of economic benefits and environmental impacts with the tradeoffs among resources of water land and energy being handled this was an improvement of the traditional management mode for the jxid that gave priority to economic benefit to demonstrate the potential of the wfeo sia model comparison of the optimal results without considering the uncertainty of streamflow with the status quo was conducted based on optimal results land and water allocation patterns had been adjusted the total allocation amount of land decreased by 11 3 that of water decreased by 7 8 and that of electricity decreased by 7 3 compared with the corresponding current patterns specifically the land allocation for rice decreased by 2 4 that for corn decreased by 8 1 and that for soybean decreased by close to 50 this was mainly because the food productivity of soybean was much lower than that of rice and corn leading to its competitive disadvantages in planting as the total land allocation of the optimal results decreased both benefits and costs decreased leading to an 8 24 reduction of system net benefit compared with the current situation however as this study focused on the comprehensive effect of both economic benefit and environmental protection the discharge of pollutants including the co2 emission in the field and the pollutant concentration in surface drainage decreased by 20 5 moreover the groundwater utilization amount for agricultural irrigation of optimal results was 1 048 108 m3 while that of the current situation was 1 137 108 m3 which exceeded the allowable amount of groundwater exploitation of jxid 1 05 108 m3 according to the engineering feasibility study report of jinxi irrigation district the optimal results alleviated the current situation of groundwater overdraft further by adjusting the planting structure the water utilization structure changed consequently which led to the increase in irrigation water use efficiency defined as the ratio of grain yield to the total amount of irrigation water xiao et al 2019 from 1 13 kg m3 current situation to 1 14 kg m3 optimal results such a result was positive for irrigation district with limited water availability like jxid these results indicated that the wfeo sia model allocated the water land and energy resources in a sustainable and efficient way another major innovation of the study was that the dual uncertainty of streamflow was considered in the wfeo sia model based on the analysis of results the water supply land use and energy supply were sensitive to the surface water availability which was taken from the streamflow of songhua river this showed that the costs of different components of the water food energy nexus the co2 emission with different farming practices and the pollutant discharge in surface drainage were sensitive the uncertain streamflow conditions the details were demonstrated by the analysis of results from figs 5 to 8 this indicated that the changes of streamflow would directly affect the performance of the water food energy nexus and the changes of streamflow were ubiquitous because of the variation of natural factors and human activities therefore the high degree of uncertainty of surface water availability was considered in the wfeo sia model the dual uncertainty was expressed as an rbi with both lower and upper bounds having a random characteristic and the correlations between the upper and lower bounds can be addressed it was integrated into a multi objective programming framework and the corresponding solution method was developed this study attempted to develop an integrated optimization model to manage the water food energy nexus in irrigated agriculture which was capable of addressing complex interrelationships among water food and energy components from a holistic perspective generally the framework of wfeo sia model was portable and can be applied to most irrigation districts when 1 the resources availability e g water energy and land resources was limited and it was necessary to reallocate the limited resources in a sustainable way to improve the synthesis benefits of economy and environment and 2 the main limiting factors water availability in this study were highly uncertain the wfeo sia model provided the basic objectives and constraints in addressing the above problems however the concrete expressions of the model can be perfected in specific conditions of the selected irrigation districts without changing the model structure for example if there were production requirements for some crops the corresponding constraints would be added for a specified study area a decision support system can also be developed based on the wfeo sia model which would help managers easily plan and manage water land and energy resources in an irrigated agricultural system this can improve the universalism of the wfeo sia model further analysis of results of the wfeo sia model contributed to real applications and policy implications for example the changing trends of resources allocations and objective function values under different violation probabilities can help decision makers gain insight into when water supply can maximize the effectiveness for this study water supply under p 0 15 4 95 108 m3 was favorable because at this point the net economic benefit can reach the maximum value while the environmental impacts remained unchanged more water supply p 0 15 seemed a waste also for example analysis of each component of objective functions can help decision makers reduce costs of food production for this study field measures were the most costly part among which agricultural machinery and fertilizer utilization were major contributors therefore improving the utilization efficiency of these parts would largely increase the net system benefit for the study area the wfeo sia model focused on the most essential water food energy nexus in the irrigated agricultural system in jxid such as food production surface water abstraction groundwater pumping and drainage energy supply co2 emission and water environment pollution control specifically irrigation contributed to food production and the consequent system profits through land use in this study the land use amount was considered as an intermediate variable of water food energy nexus which can be transformed into water use amount by irrigation quota expressed as eqs 8b and 8i thus both water and land availabilities would restrict food production see eqs 8m 8n 8o 8p and 8u energy is used for surface water abstraction groundwater pumping and drainage and it affected the system profits on the one hand as expressed from eqs 8e to 8g on the other hand it affected the amount of irrigation water and thus affected the food production because of the limited energy availability eqs 8q and 8r food production consumed water and energy which affected water allocation through land use eq 8s contaminated water eq 8l and generated co2 through farming practices such as the utilization of fertilizer pesticide films agricultural machinery and plough eq 8k all these were also restricted by the availability of limited resources eqs 8m 8n 8o 8p 8q and 8r and 8u detailed interactions among sub systems of the wfeo sia model was demonstrated in fig 1 however the interrelation among water food and energy in an irrigated agricultural system was complex and this study was not providing an exhaustive representation of all the possible components and processes for example because of the own features of jxid the energy water nexus in the model only focused on the energy consumption for water abstraction pumping and drainage while the water for electricity generation was not considered the dashed line in fig 1 this was because that there was no hydropower station in the study area therefore decision makers can develop their own site specific applications on the basis of the framework of the developed wfeo sia model the generation of the new type of energy based on agricultural wastes such as crop straw and the excrements of livestock was another aspect in the energy food nexus this study ignored it for its complex chemical conversion and this will be considered as the focus of a future study the wfeo sia model in the fmop rbi framework was solved using the fuzzy set theory with the assumption that the membership function was linear generally it is difficult to determine the membership function of each objective the linear membership function could reduce the complexity of solution and it had been widely used in solving multi objective programming models using fuzzy set theory in fact the membership function might be nonlinear hyperbolic or exponential and these would generate more alternative solutions which would generate more decisions moreover many parameters were required for the wfeo sia model whose implementation might be limited by data availability some of them can be obtained directly from the corresponding reports and statistical yearbooks some of them should be guaranteed by extensive monitoring activities and some of them had to be estimated by empirical equations this would result in plenty of uncertainty for example the economic parameters of crop price and production cost which could change the optimized results might be expressed as interval values li et al 2010 however this study only considered the complex uncertainty of water availability which directly affected decision schemes for other parameters their deterministic forms were adopted the main reason was that the developed wfeo sia model was nonlinear because of resources allocation equity constraint i e eq 8t if interval numbers were incorporated the problem would become an inexact nonlinear mop with rbi and there were difficulties in the solution method which needed further study nevertheless in order to study how such parameters affected the model solutions sensitive analysis was conducted furthermore as the proposed model was applied to a real case study large amounts of data were needed and because of the data limitation the relationships among water food and energy were expressed by quota methods for simplification this also led to the simplification of the developed wfeo sia model without considering the dynamics of water food energy nexus for example the food production was an essential ingredient of the nexus the crop growth status varied with different crop growth periods and was concerned with the growing environment e g hydrometeorology conditions and agronomic measures this can be quantified as crop growth functions the acquisition of which would need years of field experiments for a real world case study subsequent research would focus on the nexus dynamics to improve the applicability and portability of the wfeo sia model 6 conclusion the novelty of this paper is the development of a water food energy nexus optimization model for sustainable irrigated agriculture called wfeo sia model the aim of the model is to optimally allocate limited water energy and land resources to different crops in different regions to obtain optimal comprehensive benefits the framework for the wfeo sia model is fuzzy multi objective programming model with random boundary intervals fmop rbi and stochastic chance constrained programming based on joint probability distribution function of the rbi was used to solve the model the wfeo sia model is capable of 1 simultaneously addressing interactions among water food and energy subsystems in an irrigated agricultural system 2 generating cost effective and environmental friendly strategies and policies and 3 reflecting the complexities of system uncertainties a real world case study was used for demonstrating the applicability of the developed model analysis of results is useful for decision makers to quantify tradeoffs among complex interrelationships of agricultural water food and energy subsystems results indicated that rbi was effective in dealing with high uncertainty in the management of water food energy nexus the wfeo sia model is computationally efficient and is suitable for regions dominated by agriculture with resource scarcity this study focused on the management of water energy and food in an irrigated agricultural system therefore the water for electricity generation and biofuels based on the agricultural wastes was negligible further studies are desired to extend the developed model to a grander scale considering more complex correlations between water food and energy and considering more forms of uncertainties to enhance its practicability and applicability acknowledgments this research was supported by the national natural science foundation of china 51809040 the national science fund for distinguished yong scholars of china 51825901 and china postdoctoral science foundation 2018t110264 and 2018m630332 supplementary material supplementary material associated with this article can be found in the online version at doi 10 1016 j advwatres 2019 03 015 appendix a supplementary materials supplementary data s1 supplementary data s1 appendix some details including detailed description about the drainage system of jxid determination of drainage duration and energy cost of drainage and determination of the efficiency for energy consumption can be found in supplemental materials 
674,irrigated agriculture is the primary user of world s fresh water resources on one hand and the producer of food to feed the world s growing population on the other hand water food and energy are intertwined in irrigated agricultural systems and an effective and coordinated management of the water food energy nexus is needed for the sustainable development of agriculture which is challenging because of large uncertainties involved therein this paper developed an optimization model for the allocation of resources toward the sustainable management of agricultural water food and energy nexus under uncertainty the model is capable of providing policy makers with the ability to determine optimal policy options among water energy and land resources to obtain the maximum system economic benefit and simultaneously minimize environmental impacts the model is also capable of handling complex uncertainties of random boundary intervals the model is demonstrated to solve a real world nexus management problem in an irrigation district in northeast china results highlight the sensitivity of food production and environmental pollution to the utilization of water energy and land resources the model is applicable for similar agriculture centered regions with limited resources keywords water food energy nexus irrigated agriculture optimization multi objective random boundary interval 1 introduction water food and energy are three basic resources for the maintenance of life and the development of social economy and they are inextricably linked agriculture is the backbone of food security but is also the largest user of freshwater resources which influence energy security tian et al 2018 globally food production accounts for about 90 of freshwater consumption and about 30 of energy use is for food production and its supply chain zhang and vesselinov 2017 however the increase of world population and the development of economy have posed challenges because of the expected demand of 50 more food 40 more energy and 30 more water by 2030 which will exacerbate the water and energy shortage yang et al 2016 therefore it is challenging for the integrated management of limited water and energy resources to meet the increasing food demand from the integrated agricultural sector nexus is an effective tool to jointly address various complex issues that link water food and energy ai saidi and elagib 2017 shed light on the drives behind the emergence of nexus thinking and emphasized the need for incorporation and cross linking of issues among water food and energy resources kurian 2017 expounded that the implementation of water food energy nexus could be supported by robust science and indicated the challenges of nexus approach by introducing concepts of trade offs synergies and resource optimization cai et al 2018 discussed how the water food energy nexus pertained to the water resources community which could help identify articulate utilize and extend the disciplinary strengths within the water food energy community in an irrigated agricultural system water availability affects food production in arid regions especially irrigation directly decides crop yields and consequent agricultural profits while food production in turn consumes water and energy energy availability restricts some agricultural practices for food production such as tillage and harvesting in the field and food processing and in turn food production consumes energy and the wastes of food production contribute to biofuel generation energy is used for water abstraction pumping irrigation and drainage for crop growth while water contributes to energy generation more recently some studies have reported the management of agricultural water food energy nexus for example yang et al 2016 evaluated the agricultural water energy and food nexus and modeled the impacts of a range of climate change scenarios on the nexus in the indus river basin in pakistan tian et al 2018 systematically optimized resource use efficiencies in the water food energy nexus for sustainable agriculture using a conceptual model for the decision support system these investigators highlighted the significance of integrated management of agricultural water food energy nexus bazilian et al 2011 put forward an integrated modeling approach considering the water food energy nexus since then investigations have been reported on nexus modeling tools used for integrated water energy and food policy making kaddoura and khatib 2017 thereinto optimization modeling is a powerful tool for quantifying the interactions and sustainable management of agricultural water food energy nexus however limited studies have been reported on incorporating the interactions while allocating resources of agricultural water food energy nexus in an optimization modeling framework optimization of water food energy nexus in an irrigated agricultural system is complicated the integrated management of water energy and land resources contributes to food production which brings economic benefits but agricultural production uses large amounts of water land fertilizer and pesticide inputs which lead to environmental changes such as greenhouse gas emission and non point source pollution tan et al 2011 2017 ji et al 2016 this leads to the complexity in how to balance the contradictory targets i e economic benefits and environmental impacts to promote the sustainable management of water food energy nexus in an irrigated agricultural system multi objective programming mop is deemed effective to address this complexity moreover integrated management for water food energy nexus in an irrigated agricultural system actually involves a variety of uncertainties for example intricate interactions exist between different subsystems such as economy society environment and administration which produce a variety of uncertainties the subjective judgments from stakeholders and experts impact data acquisition and system reliability this leads to the fuzziness in the policymaking process further a high degree of uncertainty may exist among some coefficients and parameters of the optimization model for water food energy nexus in an irrigated agricultural system for example the availability of water resources is sensitive to natural and geographic conditions technology selection and utilization efficiency causing difficulties to related data acquisition even the determination of interval numbers cannot reflect such a complex uncertainty because the lower bound and upper bound might correlate to each other and the intersection could exist between them dong et al 2014 a concept of random boundary interval rbi has been found to be an effective tool to reflect such a dual uncertainty cao et al 2010 therefore to tackle the above complexity of uncertainties integrating the multi objective programming rbi and fuzzy set theory into the optimization modeling framework for the sustainable management of water food energy nexus in an irrigated agricultural system is necessary and significant but has been barely considered in the existing literature see table 1 the main contributions of this paper therefore are the following 1 the interactions among water energy and food subsystems in an irrigated agricultural system are identified for mathematical modeling which helps optimally allocate limited water land and energy resources 2 a multi objective programming is incorporated into the modeling framework which helps develop schemes for more sustainable allocation of resources by simultaneously considering economic development and environmental protection 3 rbi is coupled to cope with the high degree of uncertainty in water availability which helps generate more realistic solutions and is conducive to providing managerial insights the remainder of the paper is organized as follows section 2 presents the methodology of a fuzzy multi objective programming model with random boundary interval fmop rbi section 3 formulates the mathematical model for water food energy nexus for irrigated agriculture based on fmop rbi section 4 applies the developed model in a real world case study in northeast china section 5 presents analysis and discussion of results and section 6 draws conclusions and discusses extensions 2 methodology 2 1 random boundary interval in many practical problems highly uncertain components are inherent in the management process for example in the water food energy nexus for irrigated agriculture systems water supply which dominates the harmonious collocation of water food and energy resources has a large uncertainty due to natural variations and human activities in such cases the lower and upper bounds of parameters with a high degree of randomness can rarely be acquired as deterministic values and even intervals or random variables can hardly address the complex characteristics lu et al 2015 instead a data can be presented as an rbi to cope with highly uncertain components an rbi parameter can be expressed as b b b with both the lower bound b and the upper bound b being random variables which leads to dual uncertainties to acquire an rbi samples of possible intervals for an rbi can be collected r 1 s 1 r 2 s 2 rn sn where r 1 r 2 rn and s 1 s 2 sn are the random numbers of lower and upper bounds of b based on the samples the mean vector and covariance matrix can be calculated as cao et al 2010 1a μ 1 n i 1 n r i 1 n i 1 n s i 1b d σ 1 2 ρ σ 1 σ 2 ρ σ 1 σ 2 σ 2 2 where σ 1 2 1 n i 1 n r i μ 1 2 σ 2 2 1 n i 1 n s i μ 2 2 and ρ 1 n σ 1 σ 2 i n r i μ 1 s i μ 2 2 2 fuzzy multi objective programming with rbi an mop model can generally be expressed as follows 2a max f k x j 1 t c k j x j k 1 2 k 1 2b min f k x j 1 t c k j x j k k 1 1 k 1 2 k subject to 2c j 1 t a i j x j b i i 1 2 m 2d x j 0 j 1 2 t where fk x k 1 2 k 1 fk x k k 1 1 k 1 2 k are the maximum and minimum objective functions respectively xj represent the jth decision variable ckj aij and bi r and r denote a set of real numbers in real world problems parameters in objective functions change with the changes of external stressors such as climate change water shortage and land utilization the uncertain changes in the parameters render the objectives of the mop in an imprecise and uncertain situation fuzzy logic is gaining strength in mop because of its simple and flexible construct that reorganizes a multi objective planning problem into a single objective environment morankar et al 2013 thus a fuzzy multi objective programming fmop model can be formulated where the key to the solution is to transform the fmop into a deterministic model based on membership functions generally it is difficult to determine the membership function of objectives the linear membership function is the most widely used function due to its simplicity for further details on other membership functions such as nonlinear hyperbolic and exponential membership readers can refer to sasikumar and mujumdar 1998 rani and moreira 2010 and morankar et al 2013 let fk x be any objective function then the linear membership function can be expressed as follows for the maximization scenario i e k 1 2 k 1 3a μ f k x 0 f k x f k min f k x f k min f k max f k min f k min f k x f k max 1 f k x f k max for the minimization scenario i e k k 1 1 k 1 2 k 3b μ f k x 1 f k x f k min f k max f k x f k max f k min f k min f k x f k max 0 f k x f k max where μfk x denotes the linear membership function of objective fk x and f k min and f k max are the minimum and maximum acceptable levels of the objective in order to obtain μfk x the value of f k min and f k max should be obtained one solves the developed fmop problem by considering one function at a time and ignoring all others the process is repeated k times for k different objective functions let the solutions obtained be x 1 x 2 xk respectively let n x k k 1 2 k one finds the values of objective functions fk x k 1 2 k at each point in n then one finds the minimum f k min and maximum f k max values of the objective functions i e f k min min f k x x n and f k max max f k x x n based on the membership function the problem is reduced to increase the satisfaction level of the policymaker subject to given constraints let λ min μfk x k 1 2 k then the fmop can be described as how to make a reasonable plan so that the policymaker is most satisfied with the objectives subject to the constraints that is there should be the highest degree of balance between objectives and constraints therefore λ can be defined as a control decision variable corresponding to the degree of satisfaction membership grade to which x solutions fulfill the objectives and constraints the larger the value of λ is the more satisfaction of the policymaker on decision schemes is then by introducing λ the fmop model can be formulated as follows 4a max λ subject to 4b μ f k x λ j 1 t c k j x j f k min λ f k max f k min k 1 2 k 1 4c μ f k x λ j 1 t c kj x j f k max λ f k max f k min k k 1 1 k 1 2 k 4d j 1 t a i j x j b i i 1 2 m 4e x j 0 j 1 2 t 4f 0 λ 1 in order to tackle high uncertainty when dealing with multi objective problems in an uncertain environment random boundary interval can be introduced thus an fmop model with random boundary interval fmop rbi was developed assuming bi in the constraint 4c to be an rbi b b b constraint 4d in the fmop rbi can be expressed as dong et al 2014 5 j 1 t a i j x j b i λ b i b i i 1 2 m therefore the fmop rbi can be formulated as model expressed by model 4 with the constraint expressed by eq 4c being replaced by constraint expressed by eq 5 in order to transform the uncertain constraint i e eq 5 into a deterministic one let z i b i λ b i b i λ b i 1 λ b i then f v w can be defined as the joint probability distribution of b b b where v is the variable referring to b and w is the variable referring to b then the distribution function of zi can be calculated as follows 6 g i z λ pr z i λ b i 1 λ b i z λ b i 1 λ b i z f v w d v d w based on the technique of chance constrained programming li et al 2008 the random variable on the right hand side of the constraint i e z i λ b i 1 λ b i can be discretized to several deterministic numbers corresponding to different violation probabilities hence constraint eq 5 can be transformed into the following form 7 j 1 t a i j x j z i p i i 1 2 m where z i p i g i 1 p i λ which is the inverse function of gi z λ z i p i is a function of λ corresponding to different violation probabilities pi based on the above methodology the fmop rbi model can be transformed into a single objective deterministic programming model by introducing λ in this problem λ not only represents the possibility of satisfying the objectives and constraints but also a linear combination parameter of the lower and upper bounds of an rbi 2 3 method of solution the steps for solving the fmop rbi problem can be summarized as follows step 1 model the fmop rbi problem step 2 calculate the mean vector and covariance matrix of an rbi based on samples then formulate the joint probability distribution of an rbi step 3 obtain the maximum and minimum values of each objective and the corresponding results by solving each objective function individually step 4 define the membership function of each objective function step 5 transform the fmop rbi model into a single objective function with the objective of maximizing λ step 6 transform the uncertainty constraint with the rbi into its equivalent deterministic form by introducing λ based on the technique of chance constrained programming with given violation probability pi step 7 solve the transformed model with different values of pi and generate schemes 3 model development this section develops a water food energy nexus optimization model for sustainable irrigated agriculture which can be abbreviated with wfeo sia model the framework for the wfeo sia model is fmop rbi a stochastic multi objective approach interactions between water food and energy components in an irrigated agricultural system are represented in the model the wfeo sia model focuses on reconciling contradictions between socioeconomic and environmental development hence the objective of the model is to maximize total net economic benefits the difference between revenues and costs and minimize the side effect of food production on the environment co2 emission and water quality in an irrigated agricultural system five major sets of constraints are included which relate to water availability energy availability food security resources allocation equity and land policy quantities of surface water and groundwater for food production energy supplies for food production and water abstraction pumping and drainage and land utilization can be determined the decision making framework is depicted in fig 1 the wfeo sia model is presented below 3 1 notations to clearly present the modeling framework the following list of notations is provided indices i index of subarea i 1 2 i k index of crop k 1 2 k 1 for paddy field crop k k 1 1 k 1 2 k for dry crop sur superscript for surface water gro superscript for groundwater max superscript for maximum min superscript for minimum codcr superscript for chemical oxygen demand nh 3 n superscript for ammonia nitrogen tn superscript for total nitrogen tp superscript for total phosphorus pf superscript for paddy field dl superscript for dry land symbols fnb objective function of net benefit yuan fei objective function of environmental impact kg r revenue yuan c cost yuan ecw energy cost for water yuan ecisur energy cost for irrigation using surface water yuan ecigro energy cost for irrigation using groundwater yuan ecd energy cost for drainage yuan ecf energy cost for food yuan wcf water cost for food yuan ae atmosphere effect kg wep water environmental pollution kg parameters pck price of crop k yuan kg yaik yield per unit area of crop k in subarea i kg ha ec energy cost yuan kw h hisur hydraulic head related to surface water m μ sur efficiency for surface water abstraction i q i k s u r surface irrigation quota of crop k in subarea i m3 ha i q i k g r o groundwater irrigation quota of crop k in subarea i m3 ha hlift pumping lift head m hnop nominal operating pressure m hlossess head loss m μ pump pump efficiency μ motor motor efficiency hdi drainage head in subarea i m μ i d r a drainage efficiency for subarea i dmk drainage modulus of crop k m3 d ha tk drainage days of crop k in subarea i d δ k f e r cost of fertilizer of crop k yuan ha δ k p e s cost of pesticide of crop k yuan ha δ k m a c cost of diesel of agricultural machinery of crop k yuan ha δ k f i l m cost of agricultural film of crop k yuan ha δ k s e e d cost of seed of crop k yuan ha δ k l a b o r labor cost of crop k yuan ha w p i s u r surface water price yuan m3 w p i g r o groundwater price yuan m3 cef carbon emission factor for fertilizer kgco2 kg fi fertilizer utilization in subarea i kg ha cep carbon emission factor for pesticide kgco2 kg pi pesticide utilization in subarea i kg ha ced carbon emission factor for diesel of agricultural machinery kgco2 kg ami diesel utilization of agricultural machinery in subarea i kg ha ceaf carbon emission factor for agricultural film kgco2 kg afi agricultural film utilization in subarea i kg ha cepl carbon emission factor for plough kgco2 ha cei carbon emission factor for irrigation kgco2 ha p e i c o d c r pollution emission intensity for codcr kg ha p e i n h 3 n pollution emission intensity for nh 3 n kg ha peitn pollution emission intensity for total nitrogen kg ha peitp pollution emission intensity for total phosphorus kg ha lni nitrogen leaching in subarea i kg ha lpi phosphorus leaching in subarea i kg ha η sur pf surface water utilization efficiency for paddy field η sur dl surface water utilization efficiency for dry land r the ratio of water diversion from rivers q runoff volume m3 η gro pf groundwater utilization efficiency for paddy field η gro dl groundwater utilization efficiency for dry land gwiai groundwater availability for irrigated agriculture for subarea i m3 gwli groundwater utilization for living for subarea i m3 gwii groundwater utilization for industry for subarea i m3 tgwa total groundwater availability m3 ewa total energy availability for water kw h poi population for subarea i people fd food demand kg per capita er effective rainfall m3 ha θ equity threshold a i k min the lower limit of land availability for crop k in subarea i ha a i k max the upper limit of land availability for crop k in subarea i ha decision variables aik irrigation area of crop k in subarea i ha swai surface water availability for subarea i m3 gwaii groundwater availability for irrigated agriculture for subarea i m3 ewi energy availability for water for subarea i kw h note yuan is the chinese currency unit 3 2 objective function 1 maximize net economic benefit the economic benefit is an essential target reflecting regional economic development the net economic benefit is the difference between revenues and costs the objective function of net economic benefit can be expressed as 8a max f n b max r c the revenues mainly originate from food production and can be expressed as 8b r i 1 i k 1 k p c k y a i k a i k many aspects contribute to the total cost such as energy cost for surface water abstraction groundwater pumping and drainage cost for food production mainly includes costs of fertilizer pesticide agricultural machinery agricultural films seed and labor and cost of water utilization for food production thus costs can be expressed as 8c c e c w e c f w c f where 8d e c w e c i s u r e c i g r o e c d the energy required for surface water abstraction groundwater pumping and drainage is a function of water source and is directly related to pump heads for pumping water from aquifer the pumping lift nominal operating pressure and friction losses should be taken into account thus the energy cost for irrigation water ecisur ecigro and ecd can be expressed as follows de vito et al 2017 8e e c i s u r e c h i s u r 102 3 6 μ s u r i 1 i k 1 k i q i k s u r a i k 8f e c i g r o e c h l i f t h n o p f l o s s e s s 102 3 6 μ p u m p μ m o t o r i 1 i k 1 k i q i k g r o a i k 8g e c d e c i 1 i h d i 102 3 6 μ i d r a k 1 k d m k t k a i k the energy cost for food production that mainly embodies the utilization of chemical fertilizers pesticides agricultural machinery films seeds and labor can be expressed as 8h e c f i 1 i a i k k 1 k δ k f e r δ k p e s δ k m a c δ k f i l m δ k s e e d δ k l a b o u r the water cost for food production is quantified by the water price for irrigation with both surface water and groundwater and is expressed as 8i w c f i 1 i w p i s u r k 1 k i q i k s u r a i k i 1 i w p i g r o k 1 k i q i k g r o a i k 2 minimize negative environmental impacts during the growth of crops greenhouse gases and water pollutants are generated which affect the atmosphere and the water environment thus the objective of negative environmental impacts is to minimize co2 emission and water environment pollution this objective can be expressed as 8j min f e i min a e w e p the co2 emission mainly stems from the usage of pesticides fertilizers and agricultural machines agricultural films and irrigation plough thus ae can be expressed as 8k a e i 1 i k 1 k c e f f i c e p p i c e d a m i c e a f a f i a i k c e p l c e i a i k water environment pollution considers the reduction of pollutant concentration in surface drainage chiefly including codcr nh3 n tn and tp besides nitrogen and phosphorus leaching is also taken into account thus the wep can be expressed as 8l w e p i 1 i k 1 k p e i c o d c r p e i n h 3 n p e i t n p e i t p a i k l n l p a i k 3 3 constraints the wfeo sia model is characterized by the following management constraints 1 surface water availability surface water allocation for both paddy field and dry land should not be larger than surface water supply for each subarea generally the available surface water is taken from river flow runoff and the total water availability for all subareas should not be larger than the runoff volume that can be used for this area runoff which affects allocation results has high uncertainty due to natural factors and human activities therefore the runoff volume in this study was expressed as an rbi this constraint can be expressed as 8m k 1 k 1 i q i k s u r a i k η s u r p f k k 1 1 k i q i k s u r a i k η s u r d l s w a i i 8n i 1 i s w a i r q 2 groundwater availability similar to surface water groundwater allocated to both paddy field and dry land in each subarea should not be larger than groundwater availability for irrigated agriculture from well pumping the groundwater availability for irrigated agriculture equals the total groundwater availability minus water use for drinking and industry this constraint can be expressed as 8o k 1 k 1 i q i k g r o a i k η g r o p f k k 1 1 k i q i k g r o a i k η g r o d l g w i a i i 8p i 1 i g w i a i g w l i g w i i t g w a 3 energy availability in irrigated agricultural systems energy is mainly used for surface water abstraction groundwater pumping and drainage and the electricity consumed should not be larger than the allowable quantity for each subarea and the total energy availability this constraint can be expressed as follows 8q h i s u r μ s u r k 1 k i q i k s u r a i k h l i f t h n o p f l o s s e s s μ p u m p μ m o t o r k 1 k i q i k g r o a i k h d i μ i d r a k 1 k d m i k t i k a i k 102 3 6 e w i i 8r i 1 i e w i e w a 4 food security the yield for food grain in each subarea should satisfy the food grain requirement that is associated with population to guarantee food security this constraint can be expressed as 8s k 1 k y a i k a i k p o i f d i 5 resources allocation equity the gini coefficient is used to describe the allocation equity among different subareas the gini coefficient can be expressed according to lorenz curve hu et al 2016 smaller gini coefficient indicates that the allocation is more even which contributes to social stability the range of gini coefficient is from 0 perfect equality to 1 maximal inequality as this study focuses on an irrigated agricultural system and water is the main restricted element the equity of irrigation water allocation was considered this constraint can be expressed as 8t 1 2 i i 1 i k 1 k i q ik er a ik p o i m 1 i n 1 i k 1 k i q mk er a mk p o m k 1 k i q nk er a nk p o n θ 6 land policy for each crop in different subareas and for each crop type in all subareas the lower and upper limits of irrigation area should be considered to keep in view the food requirement and prevailing crop production practices this constraint can be expressed as follows 8u a i k min a i k a i k max i k 7 non negative constraint the decision variables should not be negative 8v a i k 0 i k 8w s w a i 0 i 8x g w i a i 0 i 8y e w i 0 i 4 application 4 1 study area a real world case study was used to demonstrate the feasibility of the developed wfeo sia model and the fmop rbi approach the study area is in jinxi irrigation district jxid in fujin city heilongjiang province northeast china the longitude is from 131 30 to 132 37 e and the latitude is from 46 48 to 47 14 n jxid is located on the right bank and in the lower reaches of the trunk steam of songhuajiang river with a cultivated land of 1 011 105 ha fig 2 shows the map of jxid including the geographic location and river system irrigation district partition and irrigation and drainage network the annual mean precipitation and evaporation are 542 mm and 720 mm respectively jxid contains four subareas which are songhuajiang subarea jinshan subarea huama subarea and toulin subarea irrigated agriculture is the largest water consumer of jxid accounting for nearly 90 of the total water consumption both surface water and groundwater are supplied to jxid and songhua river is the main surface water supply the development speed of agriculture in jxid is fast leading to the over exploitation of groundwater because of a lack of water diversion and pumping engineering in order to reform the unbalanced utilization of water resources the headwork pump stations and the drainage pump stations were established the headwork pump is used to lift water from songhua river and there are six feedwater pumps with a hydraulic head of 7 54 m there are six drainage pump stations in jxid including shanxi huama duijin shuangyushu toulin and erlin drainage pump stations detailed information on the drainage system can be seen from fig 2 the distribution drainage receiver hydraulic head and flow of the six drainage pump stations are described in supplemental materials these pump stations contribute to the electricity consumption of surface water jxid is an important food production base of heilongjiang province in china the main crops are rice corn soybean vegetables and melons among them the grain food occupied nearly 90 of the total cultivated area in the past five years of which rice was principal crop therefore rice corn and soybean were chosen as the studied crops in this study and they were plowed in each subarea in jxid in order to ensure the advantage of food production the safety of water supply and food production security should be guaranteed and the water and energy resources should be reallocated in a sustainable way that is considering both economic development and environment protection fluctuating water availability makes the management more difficult therefore the developed model was applied in jxid to tackle these problems 4 2 data collection the water food energy nexus for irrigated agriculture is a complex system involving many parameters the values of these parameters were obtained from the hydrometric station from 1954 to 2015 some government reports of jxid statistical yearbook from 2009 to 2016 and published references table 2 shows the crop parameters in the wfeo sia model including crop price cost related parameters due to food production and drainage related parameters among them crop price was obtained from the agricultural product price information network of heilongjiang province cost related parameters were obtained from the statistical yearbook of fujin city the drainage modulus was obtained from engineering feasibility study report of jinxi irrigation district the drainage duration was related to crop tolerance to waterlogging how to determine the drainage duration can be found in supplemental materials based on the data of drainage modulus and duration the irrigation drainage volume can be obtained then the energy cost for drainage i e ecd can be calculated according to the method from de vito et al 2017 detailed information on how to determine ecd can be seen in supplemental materials the surface water price and groundwater price were 0 16 and 0 29 yuan m3 respectively table 3 shows the subarea related parameters in the wfeo sia model including utilization of fertilizers pesticides film and agricultural machinery groundwater use and population all the data except for groundwater use were obtained from the statistical yearbook of fujin city and data of groundwater use was from water resources verification report of jinxi irrigation district there are still some parameters that are associated with both crops and subareas as shown in table 4 including the lower and upper limits of land availability yield per unit area and irrigation quota for both surface water and groundwater among them the yield per unit area was calculated by dividing the crop yield by crop area for different crops in different subareas data for crop yield were collected from the statistical yearbook of fujin city other data in table 4 were derived from the water resources verification report of jinxi irrigation district water resources argumentation report of jinxi irrigation district and engineering feasibility study report of jinxi irrigation district according to the planning requirements of jxid the minimal values of crop area were set to ensure the grain output of the irrigation district this can also guarantee the boundedness of wfeo sia model the crop areas of different crops in different subareas can be adjusted within their respective scopes as eq 8u shows specifically the adjustable range of rice was from 5 02 104 to 8 104 ha that of corn was from 1 43 104 to 3 88 104 ha and that of soybean was from 0 71 104 to 1 88 104 ha the food demand per capital was set as 400 kg per capita the value of the equity threshold in this study was set to 0 4 which represents the relatively reasonable allocation yang et al 2015 the wfeo sia model also involves some efficiency coefficients including efficiency for energy consumption and efficiency for irrigation the efficiency for energy consumption included efficiencies for surface water abstraction groundwater pumping and drainage specifically the efficiency for surface water abstraction was 0 5 for the efficiencies for pumping there were two efficiency values involved i e pump efficiency μ pump and motor efficiency μ motor in this study μ pump was set as 0 8 and μ motor was set as 0 4 daccache et al 2014 the efficiencies for shanxi huama duijin shuangyushu toulin and erlin drainage stations were 0 52 0 56 0 48 0 53 0 60 and 0 52 respectively the methods for the acquisition of efficiency for energy consumption were described in supplemental materials irrigation efficiency related to irrigation network and farm management techniques and the values vary with different crops and different water sources according to the engineering feasibility study report of jinxi irrigation district surface water use efficiency was 0 51 for paddy field and was 0 53 for dry land the groundwater use efficiency was 0 75 for paddy field and was 0 78 for dry land other important parameters were those related to the environment the co2 emission coefficients were used to estimate the co2 emission volume they were 0 9 kgco2 kg for fertilizer 4 93 kgco2 kg for pesticide 0 5927 kgco2 kg for diesel oil 5 18 kgco2 kg for films 312 6 kgco2 ha for plough and 226 48 kgco2 ha the pollution emission intensity coefficients and leaching coefficients are variable with different areas crops theoretically however for jxid the corresponding values for certain pollutants for different areas crops were the same specifically the pollution emission intensity of chemical oxygen demand codcr ammonia nitrogen nh3 n total nitrogen tn and total phosphorus tp were 150 11 85 171 75 and 65 25 kg ha respectively the leaching coefficients of nitrogen and phosphorus were 0 687 kg ha and 0 261 kg ha these environmental data were obtained from the engineering environmental impact report of jinxi irrigation district and the data are available in the data center of the ministry of environmental protection of the people s republic of china resource availabilities are critical limiting parameters for the wfeo sia model in this study the runoff volume of songhua river was expressed as an rbi in this study the runoff volume was assumed to obey the two dimensional normal distribution based on the historical data for 62 years and the water diversion ratio the joint probability distribution of the lower and upper bounds of the surface water availability 108 m3 can be obtained i e n 4 23 4 99 1 42 1 612 0 9 based on the methodology λ q i 1 λ q i n μ σ with μ 4 99 0 76λ and σ 1 96 λ 2 2 0286 λ 1 λ 2 59 1 λ 2 then given different violation probabilities z i p i g i 1 p i λ can be obtained from the standard normal distribution table z i p i g i 1 p i λ was a function of satisfactory degree λ and it was coupled in the wfeo sia model in this study violation probabilities of 0 01 0 05 0 1 0 15 and 0 2 were chosen according to previous studies the total groundwater availability was 1 1685 108 m3 and the total energy availability for all subareas was 1 3866 108 kw h 5 analysis of results and discussion 5 1 changes of economic benefits and environmental impacts using the wfeo sia model a series of related schemes were generated the objectives of the wfeo sia model were to maximize in the net benefits nb and minimize environmental impacts ei the value of net benefits was the difference between revenues and costs and the environmental impact was the comprehensive effect of both co2 emission and water quality fig 3 shows the variation of objectives under different scenarios considering the variations of different violation probabilities and the lower upper and average values of surface water availability which were expressed as an rbi it can be obtained from the figure that both revenues and costs increased as the violation probabilities p increased however the rate of increase of revenues was higher than costs leading to an increase in the trend of net benefit under different violation probabilities they were 15 50 108 15 56 108 15 63 108 15 71 108 and 15 71 108 yuan corresponding to the violation probabilities of 0 01 0 05 0 1 0 15 and 0 2 respectively on the contrary the environmental impacts decreased slightly under different violation probabilities from 1 31 108 kg to 1 29 108 kg among which the co2 emission contributed to the shift taking the benefits under p 0 01 as the baseline the increase rates were 0 51 p 0 05 1 09 p 0 1 1 68 p 0 15 and 1 73 p 0 2 each percentage point rise in benefits was roughly equivalent to the benefits of 43 million kg of rice this was the comprehensive result of considering both system benefits and environmental impacts however if the system benefit was the only consideration the increase rates were 2 3 p 0 05 5 1 p 0 1 7 9 p 0 15 and 10 5 p 0 2 compared to the value under p 0 01 such results indicated that the two objectives i e system benefit and environmental impacts were in conflict because more benefits were derived from more food production which would bring more environmental pollution therefore one of the effects of the developed wfeo sia model was to pursue a balance of economic growth and environmental pollution results in fig 3 showed that larger violation probabilities were more lucrative because higher net benefits and smaller environment impacts could be generated larger violation probabilities indicated larger water availability which would bring higher synthetic benefits yet at the same time larger violation probabilities also meant larger risks this was because if the water availability failed to achieve the value corresponding to a certain violation probability the punitive compensation would be generated which might cause economic losses usually facing different violation probabilities the risk averse policymakers might choose the allocation results corresponding to smaller violation probabilities while the risk taking policymakers might choose the results corresponding to larger violation probabilities in terms of this study p 0 15 can be adopted from the perspective of the performance of the system s comprehensive benefits because at this point the value of both net economic benefit and environmental impacts achieved their relative ideal points in other words when the violation probabilities were larger than 0 15 the values of the two objectives tended to stabilize however it was just a reference and whether the policymakers would choose this violation probability depends on their preferences and practical situations in addition assuming one optimized his her decision under a particular violation probability for example p 0 15 with the water availability was 5 11 108 m3 which could be calculated based on the joint probability distribution of the lower and upper bounds of the surface water availability if the actual water availability was lower assuming the water availability was 4 93 108 m3 corresponding to p 0 1 the actual benefit would fall short of the promised benefit then the policymakers might identify a way to obtain more water to make up the economic losses by buying water from adjacent and well watered regions or continually exploring groundwater within the exploitable capacity of groundwater for the former means 1 26 107 yuan cost would be generated with the purchase price of water as 0 7 yuan m3 and for the latter means 5 2 106 yuan cost would be generated with the price of groundwater as 0 29 yuan m3 on the other hand if the actual water availability was higher assuming the water availability reaches 5 31 108m3 corresponding to p 0 2 this situation was optimistic with the benefit increased by 1 2 107 yuan compared with scenarios corresponding to different violation probabilities the objective values considering different bounds of surface water availability expressed as an rbi were smaller the revenues were 17 55 18 85 and 20 108 yuan and the costs were 3 93 4 21 and 4 47 108 yuan corresponding to the lower bound the average value and the upper bound of surface water availability being considered respectively the co2 emission amounts were 0 87 0 92 and 0 96 108 kg and the pollutants in water were 1 17 1 24 and 1 30 108 kg such results were due to the no consideration of violation risks as well as the correlations between the lower bound and upper bound of surface water availability 5 2 resources allocation results fig 4 shows the land and water resources allocation considering both economic benefits and environmental impacts when the surface water availability was deterministic the average value of the lower and upper bounds of surface water availability i e the randomness of surface water availability was not considered it can be seen that there was a sufficient preponderance of planting rice the preponderance reflected in two aspects one was that the crop area allocation amount for rice was much larger than that for corn and soybean it was the planning requirement of jxid that led to such a result for the high quality of rice because of the black soil in jxid which absorbed more mineral elements such as nitrogen phosphorus and kalium the quality of rice in jxid was good the second aspect was that through optimization the wfeo sia model compromised the two contradictory objectives i e maximize net economic benefit and minimize negative environmental impacts leading to the optimal crop areas for different crops which would be within their specific adjustable ranges see table 4 specifically if we set the minimum areas of crops as the starting points and the maximum areas of crops as the endpoints and the distance between the starting points and the endpoints which could represent the adjustable range of crop areas was set as 1 then for rice the distance between the optimal area and the starting point was 0 18 for corn the distance was 0 14 and for soybean the distance was close to zero such results indicated the wfeo sia model tended to allocate more area for rice first this was mainly attributed to the much higher yield of rice than soybean per unit area and higher market price than corn the land allocation proportion of rice was 96 for songhuajiang subarea 82 for jinshan subarea 81 for huama subarea and 47 for toulin subarea the allocation trend of water was similar to that of land because water allocation amounts can be determined by multiplying the allocated crop areas with the irrigation quota surface water allocation attracted the majority of the total water availability which changed previous water resources policies of jxid that groundwater was the main source for irrigation the optimized energy allocation amount proportion was 687 104 kw h 5 9 for songhuajiang subarea 2872 104 kw h 24 7 for jinshan subarea 4485 104 kw h 38 5 for huama subarea and 3591 104 kw h 30 9 for toulin subarea the above results were the comprehensive effect of considering both economic benefit and environment impacts if the objective of economic benefit was considered only the total land allocation amount was 8 79 104 ha surface water allocation amount was 4 66 108 m3 groundwater allocation amount was 1 04 108 m3 and energy allocation amount was 1 21 104 kw h while if the objective of environmental impact was considered only the total land allocation amount was 7 21 104 ha surface water allocation amount was 4 35 108 m3 groundwater allocation amount was 1 01 108 m3 and energy allocation amount was 1 12 104 kw h when both of the two objectives were considered simultaneously the optimal resources allocation results were within the range of considering single objective more specifically the total land allocation amount was 8 02 104 ha surface water allocation amount was 4 61 108 m3 groundwater allocation amount was 1 04 108 m3 and energy allocation amount was 1 16 104 kw h when both economic benefit and negative environmental impact were taken into account this shows that there was a resources tradeoff between land water and energy for different crops and different subareas to achieve a relative balance of system economic benefit and environment impacts these results could provide policy makers more alternatives for resources allocation schemes based on actual development requirements of the studied irrigation district for example one could emphasize economic benefits or environmental impacts or give consideration to both economy and environment the above results were obtained without considering uncertainties when the randomness of water availability was considered the resources allocation results would change with different violation probabilities as shown in methodology z i p i g i 1 p i λ was involved when solving the wfeo sia model which was a function of both satisfactory degree λ and violation probabilities p as fig 5 shows the values of λ increased as p increased indicating that larger violation probabilities would improve policymaker s satisfaction for decision schemes this was mainly because larger violation probabilities corresponded to larger water availability similar changing trends also applied to the resources allocation of water supply and energy supply however the amounts of fluctuations were different when the value of violation probability was larger than 0 15 the increasing rate diminished however for land resources allocation the changing trend was different from that of water and energy allocation likewise the allocation amount of land barely changed after p 0 15 therefore from a resources allocation perspective the allocation scheme corresponding to p 0 15 was desirable which had been expounded in the analysis of the changes of economic benefits and environmental impacts 5 3 changes of components in the objectives many components collectively contributed to the values of objectives for the objective of net benefits the revenues mainly originated from food production however there were many aspects of costs fig 6 shows cost ratios under different scenarios i e under different violation probabilities based on the figure the changing trends of the percentage of each category of cost were basically consistent and experienced slight changes under the five selected violation probabilities for example the percentage of costs of agricultural machinery labor and fertilizer which were the three biggest contributors to the total cost were 67 41 for p 0 01 67 18 for p 0 05 66 82 for p 0 1 66 49 for p 0 15 and 66 47 for p 0 2 respectively some cost percentages increased as the violation probabilities increased consider example of the percentage of energy cost for water abstraction when p 0 01 and p 0 05 this cost was lower than its previous term i e cost for seeds the percentage values of seed were 6 92 and 6 8 under p 0 01 and p 0 05 respectively and the percentage values of energy cost were 6 45 and 6 55 under p 0 01 and p 0 05 respectively however when the violation probability was larger than 0 05 the percentage of energy cost for surface water abstraction was higher than the cost for seed the percentage values of seed were 6 64 6 48 and 6 46 under p 0 1 p 0 15 and p 0 2 respectively while the percentage values of energy cost were 6 69 6 83 and 6 84 under p 0 1 p 0 15 and p 0 2 respectively this was mainly because the energy cost for surface water abstraction had a direct relationship with surface irrigation amount and larger violation probabilities indicated larger irrigation amounts however the cost for seed depended on land use which had a downward trend as violation probabilities increased however there were obvious changes in the absolute values of different categories of costs taking agricultural machinery as an example and taking the cost under p 0 01 as the baseline the cost of agricultural machinery increased 1 2 under p 0 01 2 4 under p 0 1 3 7 under p 0 15 and 3 9 under p 0 2 this was because as the violation probabilities increased the absolute value of each category of cost increased the cost for field measures including cost for agricultural machinery labor fertilizer seed pesticide and agricultural film occupied the most proportion of the total cost 77 8 79 1 followed by the energy cost for water abstraction pumping and drainage 11 7 12 4 and the last was the cost for water utilization for both surface water and groundwater 9 2 9 8 such results can provide instructive suggestions for policy makers as to the part that should be focused on in terms of reducing expenses and thus increasing net benefits when planning resources of the studied irrigation district two aspects affected the environment co2 emission and water quality the co2 emission was generated mainly because of field measures such as the utilization of fertilizer pesticide agricultural machinery and film irrigation and plough and these activities were connected with crop species taking huama subarea as an example fig 7 shows the contribution rates of different field activities and different crops for all the field activities the utilization of fertilizer irrigation and plough generated much more co2 than other did field activities accounting for more than 90 of the total co2 emission therefore when the reduction of co2 emission was desired these three parts were of the primary concern the paddy field rice contributed more co2 than did the dry land corn and soybean attributed to the larger irrigation area as the violation probabilities increased the percentage of paddy field increased while the percentage of dry land decreased another aspect that impacted the environment was water quality which was quantified by the main pollutants including codcr nh3 h tn and tp among them codcr and nh3 h were the main pollutants and the variations mainly embodied rice and corn as shown in fig 8 water quality had a direct relationship with irrigation area which remained nearly the same for soybean under different violation probabilities based on the results of the wfeo sia model 5 4 sensitivity analysis the aforementioned results shed light on how the uncertainty of water supply affected model performance besides water supply economic data were also constantly changing in order to learn the impact of crop price and production cost on the net system benefit negative environmental impacts and resources allocation equity sensitivity analysis was conducted as shown in fig 9 from the figure the net benefit environmental impacts and resources allocation expressed as gini coefficient were all sensitive to the price of rice while showing low sensitivity to the price of corn and soybean results showed that the price of rice had a potential to increase the net system benefit and decrease negative environmental impacts compared with the baseline the results without considering the changes of sensitive parameters the net benefit range was 5 4 9 5 the minus sign represented a decrease in value and the environment impacts range was 1 4 9 when the price of rice was 10 the changing ranges of both net benefit and environmental impacts were smaller than when the price of corn and soybean was 10 as seen from the figure based on the results of fig 6 agricultural machinery labor and fertilizer contributed most to the total cost therefore these three parts were selected as the sensitive parameters of production cost based on fig 9 both the net benefit and environment impacts presented a linear relation with the three kinds of cost it showed a negative correlation for the net benefit but showed a positive correlation for the environmental impacts indicating that the increase of production cost would decrease the net benefit and increase environmental pollution therefore reducing production costs would be beneficial for the sustainable management of water food energy nexus either from the angle of economy or environment among the production costs the objectives were most sensitive to the cost of agricultural machinery because of the larger slope followed by the cost of labor and the last was the cost of fertilizer all these three costs had the potential to lower system cost especially the cost of agricultural machinery such results were also evident from fig 6 for resources allocation equity the changes of gini coefficient for each case case 1 changes of crop price case 2 changes of production cost were slight specifically in case 1 the changing range of gini coefficient was 0 3443 0 3680 for rice 0 3603 0 3626 for corn and 0 3610 0 3639 for soybean in case 2 the changing range of gini coefficient was 0 3605 0 3642 for agricultural machinery 0 3608 0 3641 for labor and 0 3613 0 3636 for fertilizer these values of gini coefficient belonged to the scope of relatively reasonable allocation such results indicated that the variation of resources allocation results was not distinct and a robust solution could be generated with the changes of economically sensitive parameters 5 5 discussion the developed wfeo sia model supported the management of water food and energy for irrigated agriculture in a sustainable way with the interrelationships among the main components of water food energy nexus being quantified by an optimization model one of the innovations of the study was that the wfeo sia model balanced two contradictory but important objectives of economic benefits and environmental impacts with the tradeoffs among resources of water land and energy being handled this was an improvement of the traditional management mode for the jxid that gave priority to economic benefit to demonstrate the potential of the wfeo sia model comparison of the optimal results without considering the uncertainty of streamflow with the status quo was conducted based on optimal results land and water allocation patterns had been adjusted the total allocation amount of land decreased by 11 3 that of water decreased by 7 8 and that of electricity decreased by 7 3 compared with the corresponding current patterns specifically the land allocation for rice decreased by 2 4 that for corn decreased by 8 1 and that for soybean decreased by close to 50 this was mainly because the food productivity of soybean was much lower than that of rice and corn leading to its competitive disadvantages in planting as the total land allocation of the optimal results decreased both benefits and costs decreased leading to an 8 24 reduction of system net benefit compared with the current situation however as this study focused on the comprehensive effect of both economic benefit and environmental protection the discharge of pollutants including the co2 emission in the field and the pollutant concentration in surface drainage decreased by 20 5 moreover the groundwater utilization amount for agricultural irrigation of optimal results was 1 048 108 m3 while that of the current situation was 1 137 108 m3 which exceeded the allowable amount of groundwater exploitation of jxid 1 05 108 m3 according to the engineering feasibility study report of jinxi irrigation district the optimal results alleviated the current situation of groundwater overdraft further by adjusting the planting structure the water utilization structure changed consequently which led to the increase in irrigation water use efficiency defined as the ratio of grain yield to the total amount of irrigation water xiao et al 2019 from 1 13 kg m3 current situation to 1 14 kg m3 optimal results such a result was positive for irrigation district with limited water availability like jxid these results indicated that the wfeo sia model allocated the water land and energy resources in a sustainable and efficient way another major innovation of the study was that the dual uncertainty of streamflow was considered in the wfeo sia model based on the analysis of results the water supply land use and energy supply were sensitive to the surface water availability which was taken from the streamflow of songhua river this showed that the costs of different components of the water food energy nexus the co2 emission with different farming practices and the pollutant discharge in surface drainage were sensitive the uncertain streamflow conditions the details were demonstrated by the analysis of results from figs 5 to 8 this indicated that the changes of streamflow would directly affect the performance of the water food energy nexus and the changes of streamflow were ubiquitous because of the variation of natural factors and human activities therefore the high degree of uncertainty of surface water availability was considered in the wfeo sia model the dual uncertainty was expressed as an rbi with both lower and upper bounds having a random characteristic and the correlations between the upper and lower bounds can be addressed it was integrated into a multi objective programming framework and the corresponding solution method was developed this study attempted to develop an integrated optimization model to manage the water food energy nexus in irrigated agriculture which was capable of addressing complex interrelationships among water food and energy components from a holistic perspective generally the framework of wfeo sia model was portable and can be applied to most irrigation districts when 1 the resources availability e g water energy and land resources was limited and it was necessary to reallocate the limited resources in a sustainable way to improve the synthesis benefits of economy and environment and 2 the main limiting factors water availability in this study were highly uncertain the wfeo sia model provided the basic objectives and constraints in addressing the above problems however the concrete expressions of the model can be perfected in specific conditions of the selected irrigation districts without changing the model structure for example if there were production requirements for some crops the corresponding constraints would be added for a specified study area a decision support system can also be developed based on the wfeo sia model which would help managers easily plan and manage water land and energy resources in an irrigated agricultural system this can improve the universalism of the wfeo sia model further analysis of results of the wfeo sia model contributed to real applications and policy implications for example the changing trends of resources allocations and objective function values under different violation probabilities can help decision makers gain insight into when water supply can maximize the effectiveness for this study water supply under p 0 15 4 95 108 m3 was favorable because at this point the net economic benefit can reach the maximum value while the environmental impacts remained unchanged more water supply p 0 15 seemed a waste also for example analysis of each component of objective functions can help decision makers reduce costs of food production for this study field measures were the most costly part among which agricultural machinery and fertilizer utilization were major contributors therefore improving the utilization efficiency of these parts would largely increase the net system benefit for the study area the wfeo sia model focused on the most essential water food energy nexus in the irrigated agricultural system in jxid such as food production surface water abstraction groundwater pumping and drainage energy supply co2 emission and water environment pollution control specifically irrigation contributed to food production and the consequent system profits through land use in this study the land use amount was considered as an intermediate variable of water food energy nexus which can be transformed into water use amount by irrigation quota expressed as eqs 8b and 8i thus both water and land availabilities would restrict food production see eqs 8m 8n 8o 8p and 8u energy is used for surface water abstraction groundwater pumping and drainage and it affected the system profits on the one hand as expressed from eqs 8e to 8g on the other hand it affected the amount of irrigation water and thus affected the food production because of the limited energy availability eqs 8q and 8r food production consumed water and energy which affected water allocation through land use eq 8s contaminated water eq 8l and generated co2 through farming practices such as the utilization of fertilizer pesticide films agricultural machinery and plough eq 8k all these were also restricted by the availability of limited resources eqs 8m 8n 8o 8p 8q and 8r and 8u detailed interactions among sub systems of the wfeo sia model was demonstrated in fig 1 however the interrelation among water food and energy in an irrigated agricultural system was complex and this study was not providing an exhaustive representation of all the possible components and processes for example because of the own features of jxid the energy water nexus in the model only focused on the energy consumption for water abstraction pumping and drainage while the water for electricity generation was not considered the dashed line in fig 1 this was because that there was no hydropower station in the study area therefore decision makers can develop their own site specific applications on the basis of the framework of the developed wfeo sia model the generation of the new type of energy based on agricultural wastes such as crop straw and the excrements of livestock was another aspect in the energy food nexus this study ignored it for its complex chemical conversion and this will be considered as the focus of a future study the wfeo sia model in the fmop rbi framework was solved using the fuzzy set theory with the assumption that the membership function was linear generally it is difficult to determine the membership function of each objective the linear membership function could reduce the complexity of solution and it had been widely used in solving multi objective programming models using fuzzy set theory in fact the membership function might be nonlinear hyperbolic or exponential and these would generate more alternative solutions which would generate more decisions moreover many parameters were required for the wfeo sia model whose implementation might be limited by data availability some of them can be obtained directly from the corresponding reports and statistical yearbooks some of them should be guaranteed by extensive monitoring activities and some of them had to be estimated by empirical equations this would result in plenty of uncertainty for example the economic parameters of crop price and production cost which could change the optimized results might be expressed as interval values li et al 2010 however this study only considered the complex uncertainty of water availability which directly affected decision schemes for other parameters their deterministic forms were adopted the main reason was that the developed wfeo sia model was nonlinear because of resources allocation equity constraint i e eq 8t if interval numbers were incorporated the problem would become an inexact nonlinear mop with rbi and there were difficulties in the solution method which needed further study nevertheless in order to study how such parameters affected the model solutions sensitive analysis was conducted furthermore as the proposed model was applied to a real case study large amounts of data were needed and because of the data limitation the relationships among water food and energy were expressed by quota methods for simplification this also led to the simplification of the developed wfeo sia model without considering the dynamics of water food energy nexus for example the food production was an essential ingredient of the nexus the crop growth status varied with different crop growth periods and was concerned with the growing environment e g hydrometeorology conditions and agronomic measures this can be quantified as crop growth functions the acquisition of which would need years of field experiments for a real world case study subsequent research would focus on the nexus dynamics to improve the applicability and portability of the wfeo sia model 6 conclusion the novelty of this paper is the development of a water food energy nexus optimization model for sustainable irrigated agriculture called wfeo sia model the aim of the model is to optimally allocate limited water energy and land resources to different crops in different regions to obtain optimal comprehensive benefits the framework for the wfeo sia model is fuzzy multi objective programming model with random boundary intervals fmop rbi and stochastic chance constrained programming based on joint probability distribution function of the rbi was used to solve the model the wfeo sia model is capable of 1 simultaneously addressing interactions among water food and energy subsystems in an irrigated agricultural system 2 generating cost effective and environmental friendly strategies and policies and 3 reflecting the complexities of system uncertainties a real world case study was used for demonstrating the applicability of the developed model analysis of results is useful for decision makers to quantify tradeoffs among complex interrelationships of agricultural water food and energy subsystems results indicated that rbi was effective in dealing with high uncertainty in the management of water food energy nexus the wfeo sia model is computationally efficient and is suitable for regions dominated by agriculture with resource scarcity this study focused on the management of water energy and food in an irrigated agricultural system therefore the water for electricity generation and biofuels based on the agricultural wastes was negligible further studies are desired to extend the developed model to a grander scale considering more complex correlations between water food and energy and considering more forms of uncertainties to enhance its practicability and applicability acknowledgments this research was supported by the national natural science foundation of china 51809040 the national science fund for distinguished yong scholars of china 51825901 and china postdoctoral science foundation 2018t110264 and 2018m630332 supplementary material supplementary material associated with this article can be found in the online version at doi 10 1016 j advwatres 2019 03 015 appendix a supplementary materials supplementary data s1 supplementary data s1 appendix some details including detailed description about the drainage system of jxid determination of drainage duration and energy cost of drainage and determination of the efficiency for energy consumption can be found in supplemental materials 
